#Использование средств командной строки Azure для Mac и Linux

В этом руководстве рассматривается, как использовать программы командной строки Mac и Linux для создания и управления службами в Azure. Рассмотрены следующие сценарии: **Установка средств**, **Импорт параметров публикации**, **Создание и управление веб-сайтами Azure** и **Создание и управление виртуальными машинами Azure**. Полную справочную документацию см. в [документации средства командной строки Azure для Linux и Mac][reference-docs]. 

##Оглавление
* [Программы командной строки Azure для Mac и Linux](#Overview)
* [Установка программ командной строки Azure для Mac и Linux](#Download)
* [Создание учетной записи Azure](#CreateAccount)
* [Загрузка и импорт параметров публикации](#Account)
* [Создание и управление веб-сайтом Azure](#WebSites)
* [Создание и управление виртуальной машиной Azure](#VMs)


<h2><a id="Overview"></a>Программы командной строки Azure для Mac и Linux</h2>

Программы командной строки Azure для Mac и Linux — это программы командной строки для развертывания служб Azure и управления ими.
 
Ниже перечислены поддерживаемые задачи:

* Параметры импорта публикации.
* Создание и управление веб-сайтами Azure.
* Создание и управление виртуальными машинами Azure.

Для получения полного списка поддерживаемых команд введите `azure -help` в командной строке после установки средств или см. [справочную документацию][reference-docs].

<h2><a id="Download">Установка программ командной строки Azure для Mac и Linux</a></h2>

Следующий список содержит сведения по установке программ командной строки в зависимости от операционной системы:

* **Mac**: загрузите [установщик Azure SDK][mac-installer]. Откройте загруженный файл .pkg и выполните установку.

* **Linux**: установите последнюю версию [Node.js][nodejs-org] (см. раздел [Установка Node.js через диспетчер пакетов][install-node-linux]), затем выполните следующую команду:

		npm install azure-cli -g

	**Примечание**. Возможно, будет необходимо выполнить эту команду с повышенными привилегиями:

		sudo npm install azure-cli -g

* **Windows**: запустите установщика Windows (файл .msi), который доступен здесь: [программы командной строки Azure][windows-installer].


Чтобы проверить правильность установки, введите `azure` в командной строке. Если установка прошла успешно, вы увидите список всех доступных команд `azure`.

<h2><a id="CreateAccount"></a>Создание учетной записи Azure</h2>

Чтобы использовать программы командной строки Azure для Mac и Linux, будет необходима учетная запись Azure.

Откройте браузер, перейдите к [http://www.windowsazure.com][windowsazuredotcom] и щелкните **Бесплатное пробное использование** в правом верхнем углу.

![Веб-сайт Azure][Azure Web Site]

Следуйте инструкциям по созданию учетной записи.

<h2><a id="Account"></a>Загрузка и импорт параметров публикации</h2>

Чтобы начать работу, необходимо сначала загрузить и импортировать параметры публикации. Это позволит вам использовать средства для создания и управления службами Azure. Чтобы загрузить параметры публикации, используйте команду `account download`:

	azure account download

Откройте браузер по умолчанию и войдите на портал управления. После входа файл `.publishsettings` будет загружен. Запишите место сохранения этого файла.

Далее импортируйте файл `.publishsettings` с помощью следующей команды, заменив `{path to .publishsettings file}` путем к файлу `.publishsettings`:

	azure account import {path to .publishsettings file}

Все сведения, сохраненные в с помощью команды <code>import</code>, можно удалить командой <code>account clear</code>:

	azure account clear

Чтобы просмотреть список параметров для команд `account`, используйте параметр `-help`:

	azure account -help

После импорта настроек публикации следует удалить файл `.publishsettings` по соображениям безопасности.

<div class="dev-callout"> 
<b>Примечание</b>. 
<p>При импорте параметров публикации учетные данные для доступа к подписке Azure хранятся внутри вашей папки <code>user</code>. Папка <code>user</code> защищена операционной системой. Тем не менее, рекомендуется принять дополнительные меры для шифрования папки <code>user</code>. Это можно сделать одним из следующих способов:</p>

<ul>
<li>На Windows измените свойства папки или используйте BitLocker.</li>
<li>На Mac включите FileVault для папки.</li>
<li>На Ubuntu используйте функцию каталога Encrypted Home. В других дистрибутивах Linux есть аналогичные функции.</li>
</ul>

</div>

Теперь можно приступать к созданию и управлению веб-сайтами Azure и виртуальными машинами Azure.  

<h2><a id="WebSites"></a>Создание и управление веб-сайтом Azure</h2>

###Создание веб-сайта

Чтобы создать веб-сайт Azure, необходимо сначала создать пустой каталог с именем `MySite` и перейти в этот каталог.

Затем выполните следующую команду:

	azure site create MySite --git

Вывод этой команды будет содержать URL-адрес по умолчанию созданного веб-сайта. Параметр `--git` позволяет использовать git для публикации на веб-сайте путем создания репозиториев git в каталоге локального приложения и центре данных веб-сайта. Обратите внимание, что если локальная папка уже является репозиторием git, команда добавит новый удаленный к существующему репозиторию, с указанием на репозиторий в центре обработки данных веб-сайта.

Обратите внимание, что команду `azure site create` можно выполнить с любым из следующих параметров:

* `--location [имя расположения]`. Этот параметр позволяет указать расположение центра обработки данных, в котором создается веб-сайт (например, "Запад США"). Если этот параметр опущен, появится запрос выбрать расположение.
* `--hostname [пользовательское имя узла]`. Этот параметр позволяет задать пользовательское имя узла для веб-сайта.

Затем можно добавить содержимое в каталог веб-сайта. Используйте обычный поток git (`git add`, `git commit`) для применения контента. Используйте следующую команду git для передачи контента веб-сайта на Azure: 

	git push azure master

###Настройка публикации из GitHub

Чтобы настроить непрерывную публикацию из репозитория GitHub, используйте параметр `--GitHub` при создании сайта:

	auzre site create MySite --github --githubusername username --githubpassword password --githubrepository githubuser/reponame

Если у вас есть локальная копия репозитория GitHub или если репозиторий со ссылкой на один удаленный репозиторий GitHub, эта команда автоматически опубликует код в репозитории GitHub для веб-сайта. В дальнейшем любые изменения в репозитории GitHub автоматически публикуются на сайте.

При настройке публикации из GitHub ветвь по умолчанию является главной ветвью. Чтобы указать другую ветвь, выполните следующую команду из локального репозитория:

	azure site repository <branch name>

###Настройка параметров приложения

Параметры приложения являются парами "ключ/значение", доступными для приложения в среде выполнения. При установке для веб-сайта Azure значения параметров приложения переопределяют параметры с тем же ключом, который определен в файле сайта Web.config. Для приложений Node.js и PHP параметры приложений доступны как переменные среды. В следующем примере показано, как задать пару "ключ/значение":

	azure site config add <key>=<value> 

Чтобы просмотреть список всех пар "ключ/значение", используйте следующее:

	azure site config list 

Или если вы знаете ключ и желаете посмотреть, можете использовать:

	azure site config get <key> 

Чтобы изменить значение существующего ключа, необходимо сначала удалить существующий ключ и повторно добавить его. Команда "Очистить":

	azure site config clear <key> 

###Отображение сайтов

Чтобы просмотреть список веб-сайтов, введите следующую команду:

	azure site list

Чтобы получить подробные сведения о веб-сайте, используйте команду `site show`. В следующем примере отображаются сведения для `MySite`:

	azure site show MySite

###Остановка, запуск и перезапуск сайта

Остановить, запустить или перезапустить веб-сайт можно с помощью команд `site stop`, `site start` и `site restart`:

	azure site stop MySite
	azure site start MySite
	azure site restart MySite

###Удаление сайта

Сайт можно удалить с помощью команды `site delete`:

	azure site delete MySite

Обратите внимание, что при выполнении перечисленных выше команд в папке, где выполняется `site create`, необходимо указать имя сайта `MySite` как последний параметр.

Чтобы просмотреть список команд `site`, используйте параметр `-help`:

	azure site -help 

<h2><a id="VMs"></a>Создание и управление виртуальной машиной Azure</h2>

Виртуальная машина Azure создается из образа виртуальной машины (VHD-файл), предоставленного пользователем или доступного в коллекции образов. Чтобы просмотреть доступные образы, используйте команду `vm image list`:

	azure vm image list

Виртуальную машину можно готовить и запускать из доступных образов с помощью команды `vm create`. В следующем примере показано, как создать виртуальную машину Linux (с именем `myVM`) из образа из коллекции образов (CentOS 6.2). Имя пользователя root и пароль для виртуальной машины: `myusername` и `Mypassw0rd` соответственно. (Обратите внимание, что параметр `--location` указывает центр обработки данных, в котором создается виртуальная машина. Если параметр `--location` опущен, появится запрос выбрать расположение.)

	azure vm create myVM OpenLogic__OpenLogic-CentOS-62-20120509-en-us-30GB.vhd myusername --location "West US"

Следует рассмотреть возможность передачи флага `--ssh` (Linux) или флага `--rdp` (Windows) в `vm create`, чтобы включить удаленный доступ к созданной виртуальной машине.

Если необходимо подготовить виртуальную машину из образа, можно создать образ из VHD-файла с помощью команды `vm image create`, а затем использовать команду `vm create` для подготовки виртуальной машины. В следующем примере показано, как создать образ Linux (с именем `myImage`) из локального VHD-файла. (Параметр `--location` указывает данные, в которых хранится образ.)

	azure vm image create myImage /path/to/myImage.vhd --os linux --location "West US"

Вместо создания образа из локального VHD-файла можно создать образ из VHD-файла, хранящегося в хранилище BLOB-объектов Azure. Это можно сделать с помощью параметра `blob-url`:

	azure vm image create myImage --blob-url <url to .vhd in Blob Storage> --os linux

После создания образа можно подготовить виртуальную машину из образа с помощью команды `vm create`. Нижеприведенная команда создает виртуальную машину с именем `myVM` из образа, созданного ранее (`myImage`).

	azure vm create myVM myImage myusername --location "West US"

После подготовки виртуальной машины можно создать конечные точки, чтобы разрешить удаленный доступ к виртуальной машине (например). В следующем примере используется команда `vm create endpoint` для открытия внешнего порта 22 и локального порта 22 на `myVM`:

	azure vm endpoint create myVM 22 22

Подробные сведения о виртуальной машине (включая IP-адрес, DNS-имя и сведения о конечной точке) можно получить с помощью команды `vm show`:

	azure vm show myVM

Для завершения работы, запуска или перезапуска виртуальной машины используйте одну из следующих команд:

	azure vm shutdown myVM
	azure vm start myVM
	azure vm restart myVM

И наконец, чтобы удалить виртуальную машину, используйте команду `vm delete`:

	azure vm delete myVM

Для отображения полного списка команд для создания и управления виртуальными машинами используйте параметр `-h`:

	azure vm -h

<!-- IMAGES -->
[Azure Web Site]: ./media/crossplat-cmd-tools/freetrial.png

<!-- LINKS -->
[nodejs-org]: http://nodejs.org/
[install-node-linux]: https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager
[mac-installer]: http://go.microsoft.com/fwlink/?LinkId=252249
[windows-installer]: http://go.microsoft.com/fwlink/?LinkID=275464
[reference-docs]: http://go.microsoft.com/fwlink/?LinkId=252246
[windowsazuredotcom]: http://www.windowsazure.com


