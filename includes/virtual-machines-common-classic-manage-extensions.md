


##Использование расширений виртуальной машины

Расширения VM Azure реализуют реакции на события или функции, которые помогают другим программам работать на виртуальных машинах Azure (например, расширение **WebDeployForVSDevTest** позволяет Visual Studio использовать веб-развертывание решений на VM Azure) или предоставляют возможность взаимодействия с виртуальной машиной для поддержки другой реакции на события (например, вы можете использовать расширения доступа к виртуальной машине через клиенты Powershell, Azure CLI или REST для сброса или изменения значений удаленного доступа на VM Azure).

>[AZURE.IMPORTANT] Полный список расширений с разбивкой по поддерживаемым ими функциям см. в статье [Обзор расширений и компонентов виртуальной машины](../articles/virtual-machines/virtual-machines-windows-extensions-features.md). Так как каждое расширение виртуальной машины поддерживает конкретную функцию, возможности и ограничения каждого расширения индивидуальны. Поэтому перед любым изменением ВМ вам следует обязательно прочитать документацию по конкретному расширению ВМ, которое вы собираетесь использовать. Одни расширения ВМ нельзя удалить, а другие имеют такие свойства, изменение которых радикальным образом меняет реакцию ВМ на события.

Ниже перечислены наиболее распространенные задачи:

1.  Поиск доступных расширений.

2.  Обновление загруженных расширений.

3.  Добавление расширений.

4.  Удаление расширений.

##Поиск доступных расширений

Вы можете найти расширения и дополнительную информацию, используя:

-   PowerShell
-   Использование кросс-платформенного интерфейса командной строки Azure (Azure CLI)
-   Интерфейс API REST управления службой

###Azure PowerShell

Некоторые расширения имеют собственные командлеты Powershell, что позволяет упростить их настройку через PowerShell. Следующие командлеты будут работать для всех расширений виртуальных машин.

Для получения сведений о доступных расширениях вы можете использовать следующие командлеты:

-   Для экземпляров веб-ролей или рабочих ролей можно использовать командлет [Get AzureServiceAvailableExtension](https://msdn.microsoft.com/library/azure/dn722498.aspx).
-   Для экземпляров виртуальных машин можно использовать командлет [Get AzureServiceAvailableExtension](https://msdn.microsoft.com/library/azure/dn722480.aspx).

     Например, в следующем примере кода показано, как с помощью PowerShell отобразить информацию о расширении **IaaSDiagnostics**.

        PS C:\> Get-AzureVMAvailableExtension -ExtensionName IaaSDiagnostics

        Publisher                   : Microsoft.Azure.Diagnostics
        ExtensionName               : IaaSDiagnostics
        Version                     : 1.2
        Label                       : Microsoft Monitoring Agent Diagnostics
        Description                 : Microsoft Monitoring Agent Extension
        PublicConfigurationSchema   :
        PrivateConfigurationSchema  :
        IsInternalExtension         : False
        SampleConfig                :
        ReplicationCompleted        : True
        Eula                        :
        PrivacyUri                  :
        HomepageUri                 :
        IsJsonExtension             : True
        DisallowMajorVersionUpgrade : False
        SupportedOS                 :
        PublishedDate               :
        CompanyName                 :


###Интерфейс командной строки Azure (Azure CLI)

Некоторые расширения имеют собственные команды Azure CLI (например, расширение VM Docker), что упрощает их настройку. Указанные ниже команды поддерживаются всеми расширениями VM.

Вы можете использовать команду **azure vm extension list** для получения информации о доступных расширениях, а также применить параметр **–-json** для отображения всех доступных сведений об одном или нескольких расширениях. Если не указывать в команде имя расширения, будет выдано описание JSON для всех доступных расширений.

Например, в следующем примере кода показано, как с помощью команды **azure vm extension list** Azure CLI отобразить сведения о расширении **IaaSDiagnostics**, и использовать параметр **–-json** для получения полной информации.


    $ azure vm extension list -n IaaSDiagnostics --json
    [
      {
        "publisher": "Microsoft.Azure.Diagnostics",
        "name": "IaaSDiagnostics",
        "version": "1.2",
        "label": "Microsoft Monitoring Agent Diagnostics",
        "description": "Microsoft Monitoring Agent Extension",
        "replicationCompleted": true,
        "isJsonExtension": true
      }
    ]



###Справочник по API-интерфейсу управления службами REST

Для получения сведений о доступных расширениях вы можете использовать следующие REST API:

-   Для экземпляров веб-ролей или рабочих ролей можно использовать операцию [List Available Extensions](https://msdn.microsoft.com/library/dn169559.aspx). Чтобы вывести список доступных расширений, можно использовать операцию [List Extension Versions](https://msdn.microsoft.com/library/dn495437.aspx).

-   Для экземпляров виртуальных машин можно использовать операцию [List Resource Extensions](https://msdn.microsoft.com/library/dn495441.aspx). Чтобы вывести список версий доступных расширений, можно использовать операцию [List Resource Extension Versions](https://msdn.microsoft.com/library/dn495440.aspx).

##Добавление, обновление или отключение расширений

Вы можете добавить расширения во время создания экземпляра или добавить их позднее к запущенному экземпляру. Расширения можно обновить, отключить или удалить. Эти действия вы можете выполнить с помощью командлетов Azure PowerShell или с помощью операций REST API управления службами. Для установки и настройки некоторых расширений используются определенные параметры. Для расширений поддерживаются общедоступные и частные параметры.


###Azure PowerShell

Самым простым способом добавления и обновления расширений является использование командлетов Azure PowerShell. При использовании командлетов расширения они выполнят за вас основную часть работы по настройке расширения. В некоторых случаях может потребоваться добавить расширение программно. В таких случаях вам нужно будет предоставить конфигурацию расширения.

Чтобы выяснить, требуется ли настройка общедоступных и частных параметров для определенного расширения, вы можете использовать следующие командлеты:

-   Для экземпляров веб-ролей или рабочих ролей можно использовать командлет **Get AzureServiceAvailableExtension**.

-   Для экземпляров виртуальных машин можно использовать командлет **Get-AzureVMAvailableExtension**.

###Справочник по API-интерфейсу управления службами REST

При запросе списка доступных расширений через интерфейсы REST API вы получите информацию о том, как следует настраивать каждое расширение. Возвращаемая информация может содержать сведения о параметрах в виде общедоступной схемы и частной схемы. Значения общедоступных параметров возвращаются в запросах об экземплярах. Значения частных параметров не возвращаются.

Чтобы выяснить, требуется ли настройка общедоступных и частных параметров для определенного расширения, вы можете использовать следующие REST API:

-   Для экземпляров веб-ролей или рабочих ролей элементы **PublicConfigurationSchema** и **PrivateConfigurationSchema** содержат информацию, полученную в ответе на операцию [List Available Extensions](https://msdn.microsoft.com/library/dn169559.aspx).

-   Для экземпляров виртуальных машин элементы **PublicConfigurationSchema** и **PrivateConfigurationSchema** содержат информацию, полученную в ответе на операцию [List Resource Extensions](https://msdn.microsoft.com/library/dn495441.aspx).

>[AZURE.NOTE]Кроме того, расширения могут использовать конфигурации, заданные с помощью JSON. При использовании расширений такого типа задействуется только элемент **SampleConfig**.

<!---HONumber=AcomDC_0706_2016-->