#Сеть Azure

Проще всего подключиться к приложениям и данным Azure через обычное интернет-соединение. Но такое простое решение не всегда является наилучшим. Для подключения пользователей к центрам обработки данных Azure предлагаются три дополнительные технологии.  В этой статье рассматривается каждая из технологий. 

##Оглавление      
- [Виртуальная сеть Azure](#Vnet)
- [Azure Traffic Manager](#TrafficMngr)

<a name="Vnet"></a>
##Виртуальная сеть Azure

Azure позволяет создавать виртуальные машины, работающие в центрах обработки данных корпорации Майкрософт. Предположим, что вашей организации требуется использовать эти виртуальные машины для запуска корпоративных приложений или другого программного обеспечения, необходимого вашим сотрудникам. Вам может потребоваться, например, создать ферму SharePoint в облаке или запустить приложение управления инвентаризацией. В целях обеспечения максимального удобства для пользователей доступность этих приложений должна быть такой же, как если бы они выполнялись в вашем центре обработки данных.

Существует стандартное решение для такого рода проблем: создание виртуальной частной сети (VPN). В наши дни таким каналом пользуются организации самых разных размеров — от филиала с несколькими компьютерами до главного центра обработки данных компании. Такой подход может работать и для виртуальных машин Azure, как показано на рисунке 1.

<a name="Fig1"></a>
  
![01_Networking][01_Networking]

**Рисунок 1. Виртуальная сеть Azure позволяет создать в облаке виртуальную сеть, связанную с вашим локальным центром обработки данных.**

Как показано на рисунке, виртуальная сеть Azure позволяет создать логическую границу вокруг группы виртуальных машин, называемой *виртуальной сетью или VNET*, в центре обработки данных Azure. Это позволяет установить соединение IPsec между данной сетью VNET и локальной сетью.  Виртуальные машины в сети VNET можно создавать с помощью компонента виртуальных машин Azure, облачных служб Azure или используя и то, и другое. Другими словами, это могут быть виртуальные машины, созданные как технологией "инфраструктура как услуга" (IaaS) Azure, так и технологией "платформа как услуга" (PaaS) Azure.
Что бы вы ни выбрали, для создания соединения IPsec требуется устройство шлюза VPN — специализированное оборудование, подключаемое к вашей локальной сети, — и действия администратора сети. После установки этого соединения виртуальные машины Azure, работающие в сети VNET, выглядят частью сети организации.

Как показано на [рисунке 1](#Fig1), вы можете выделить IP-адреса для виртуальных машин Azure из того же пространства IP-адресов, которое используется в вашей сети. В приведенном здесь сценарии используются частные IP-адреса, поэтому виртуальные машины в облаке представляют собой очередную IP-подсеть. Программное обеспечение, выполняемое в локальной сети, будет считать эти виртуальные машины локальными, как и при использовании традиционных сетей VPN. Важно отметить, что благодаря установке такого соединения на уровне IP, виртуальные машины и физические компьютеры с обеих сторон могут работать под управлением любой операционной системы. Виртуальные машины Azure, работающие под управлением Windows Server или Linux, могут взаимодействовать с локальными компьютерами, работающими под управлением Windows, Linux или других систем. Для управления облачными виртуальными машинами и содержащимися в них приложениями можно также использовать популярные средства управления, в том числе System Center и другие.

Использование виртуальной сети Azure оказывается целесообразным во многих ситуациях. Как уже упоминалось, данный подход позволяет корпоративным пользователям легко получать доступ к облачным приложениям. Важным аспектом такой простоты использования является возможность сделать виртуальные машины Azure частью локального домена Active Directory, чтобы пользователи могли осуществлять единый вход в запущенные приложения. При необходимости вы также можете создать домен Active Directory в облаке, а затем подключить этот домен к локальной сети.

Создание сети VNET в центре обработки данных Azure предоставляет эффективный доступ к обширному набору ресурсов по запросу. Вы можете создавать виртуальные машины по запросу, платить за них во время использования и удалять эти виртуальные машины (и прекращать платить за них), когда они больше не требуются. Это может оказаться удобным в сценариях, когда требуется быстрый доступ к предварительно настроенному компьютеру, например при построении нового программного обеспечения группой разработчиков. Вместо того чтобы дожидаться настройки требуемых ресурсов локальным администратором, они могут самостоятельно создать эти ресурсы в общедоступном облаке. 

Благодаря виртуальной сети виртуальные машины Azure воспринимаются локальными ресурсами как локальные, но верно и обратное: программное обеспечение, работающее в вашей локальной сети, теперь воспринимается как локальное приложениями, выполняющимися в вашей виртуальной сети Azure. Предположим, что вы хотите переместить имеющееся локальное приложение в Azure, например, для сокращения расходов на его эксплуатацию. Но как быть, если данные, используемые этим приложением, в соответствии с законодательством требуется хранить локально? В такой ситуации использование виртуальной сети позволяет облачному приложению определять локальную систему базы данных как локальную и осуществлять с ней соответствующее взаимодействие. Какой бы сценарий вы ни выбрали, результат одинаков: Azure становится расширением вашего собственного центра обработки данных.

<a name="TrafficMngr"></a>
##Azure Traffic Manager

Представьте, что вы создали успешное приложение Azure. Его использует множество людей в разных странах по всему миру. Все это замечательно, однако такой успех часто приносит новые проблемы. Например, в данном случае ваше приложение, вероятнее всего, выполняется в нескольких центрах обработки данных Azure в разных частях света. Как можно осуществить интеллектуальную маршрутизацию запросов пользователей через эти центры обработки данных, чтобы обеспечить наилучшее взаимодействие с вашими пользователями?

Для решения этой проблемы предназначен компонент Azure Traffic Manager. На рисунке 2 показано, как именно это реализуется.

<a name="Fig3"></a>
   
![03_TrafficManager][03_TrafficManager]
   
**Рисунок 2. Azure Traffic Manager осуществляет интеллектуальное перенаправление запросов пользователей по экземплярам приложения, выполняющимся в разных центрах обработки данных Azure.**

В этом примере приложение выполняется на виртуальных машинах, которые распределены между четырьмя центрами обработки данных: два в США, один в Европе и один в Азии. Предположим, что пользователь в Берлине хочет получить доступ к приложению. При использовании Traffic Manager происходит следующее.

Как обычно, система пользователя находит DNS-имя приложения (шаг 1). Этот запрос перенаправляется в DNS-систему Azure (шаг 2), после чего выполняется поиск политики Traffic Manager для данного приложения. Каждая политика создается владельцем конкретного приложения Azure с помощью графического интерфейса или REST API. Независимо от способа создания, такая политика задает один из трех параметров балансировки нагрузки:

- **Производительность:** все запросы отправляются в центр обработки данных с минимальной задержкой по отношению к системе пользователя. 
- **Отработка отказа:** все запросы отправляются в центр обработки данных, указанный создателем этой политики, если только этот центр доступен. В случае его недоступности запросы перенаправляются в другие центры обработки данных в порядке приоритета, определенного создателем политики.
- **Циклический перебор:** все запросы в равной степени распределяются между всеми центрами обработки данных, в которых выполняется приложение.

После получения политики Traffic Manager определяет подходящий центр обработки данных для направления запроса в зависимости от заданного в политике параметра (шаг 3). После этого компонент сообщает расположение выбранного центра обработки данных пользователю (шаг 4), который осуществляет доступ к соответствующему экземпляру приложения (шаг 5).

Чтобы все это работало, Traffic Manager должен располагать актуальными данными о том, какие экземпляры приложения выполняются в каждом из центров обработки данных. Для этого Traffic Manager периодически проверяет связь с каждой копией приложения с помощью HTTP GET, а затем регистрирует получение или отсутствие ответа. Если экземпляр приложения прекращает отвечать, Traffic Manager перестает направлять в него пользователей, пока этот экземпляр снова не начнет отвечать на проверку связи. 

Не каждое приложение является достаточно большим или глобальным, чтобы требовалось использовать Traffic Manager. Однако для тех приложений, которые нуждаются в таком механизме, использование этой службы может принести существенную пользу.

[01_Networking]: ./media/azure-networking/Networking_01Networking.png
[03_TrafficManager]: ./media/azure-networking/Networking_03TrafficManager.png




