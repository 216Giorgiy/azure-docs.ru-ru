Библиотека клиента хранилища Azure для .NET поддерживает использование строки подключения для настройки конечных точек и учетных данных для доступа к службам хранилища. Рекомендуется хранить строку подключения хранилища в файле конфигурации, а не встраивать ее в приложение. Вы можете сохранить строку подключения двумя способами.

-   Если приложение запущено в облачной службе Azure, сохраните строку подключения с помощью системы конфигурации службы Azure (файлы `*.csdef` и `*.cscfg`).
-   Если приложение запущено в виртуальных машинах Azure или вы создаете приложения .NET, которые будут запускаться за пределами Azure, сохраните строку подключения, используя систему конфигурации .NET (например, файл `web.config` или `app.config`).

Далее в этом учебнике будет показано, как получить строку подключения из кода.

### Настройка строки подключения из облачной службы Azure

Облачные службы Azure обладают уникальным механизмом настройки службы, который позволяет динамически изменять параметры настройки на портале управления Azure, не развертывания приложение повторно.

Настройка строки подключения в конфигурации службы Azure.

1.  В обозревателе решений Visual Studio щелкните правой кнопкой мыши веб-роль или рабочую роль в папке **Роли**
    проекта развертывания Azure
    и нажмите кнопку **Свойства**.
    ![Выбор свойств в роли облачной службы в Visual Studio][]

2.  Откройте вкладку **Параметры** и нажмите кнопку **Добавить параметр**.
    ![Добавление параметра облачной службы в Visual Studio][]

    В таблице параметров появится новая запись **Setting1**.

3.  В раскрывающемся списке **Тип** новой записи **Параметр1** выберите
    **Строка подключения**.
    ![Установка типа строки подключения][]

4.  Нажмите кнопку **...** в правом конце записи **Параметр1**.
    Откроется диалоговое окно **Строка подключения учетной записи хранения**.

5.  Выберите для использования целевой эмулятор хранилища (хранилище Windows
    Azure, смоделированное на локальном компьютере) или учетную запись
    хранения в облаке. Код, представленный в этом руководстве, работает в
    любом случае. Введите **Первичный ключ доступа**, скопированный на
    предыдущем шаге этого учебника, чтобы указать
    учетную запись хранения, созданную ранее в Azure.

    > [WACOM.NOTE] Вы можете указать эмулятор хранилища, чтобы избежать затрат, связанных с хранилищем Windows Azure. Однако если вы выберете учетную запись хранения Azure в облаке, затраты на выполнение заданий в учебнике будут незначительны.

    ![Выбор целевой среды][]

6.  Измените **Имя** записи с **Параметр1** на более понятное,
    например **StorageConnectionString**. Эта строка подключения
    будет использоваться далее в этом руководстве.
    ![Изменение имени строки подключения][]

### Настройка строки подключения с помощью конфигурации .NET

При написании приложения, которое не является облачной службой Azure (см. предыдущий раздел), рекомендуется использовать систему конфигурации .NET (например, `web.config` или `app.config`). Это относится к веб-сайтам Azure или виртуальным машинам Azure, а также приложениям, разработанным для работы вне Azure. Строка подключения хранится с помощью элемента `<appSettings>` следующим образом. Замените `account-name` именем учетной записи хранения, а `account-key` — ключом доступа учетной записи:

    <configuration>
        <appSettings>
            <add key="StorageConnectionString" value="DefaultEndpointsProtocol=https;AccountName=account-name;AccountKey=account-key" />
        </appSettings>
    </configuration>

Например, параметр конфигурации в файле конфигурации может быть аналогичным следующему:

    <configuration>
        <appSettings>
            <add key="StorageConnectionString" value="DefaultEndpointsProtocol=https;AccountName=storagesample;AccountKey=nYV0gln9fT7bvY+rxu2iWAEyzPNITGkhM88J8HUoyofpK7C8fHcZc2kIZp6cKgYRUM74lHI84L50Iau1+9hPjB==" />
        </appSettings>
    </configuration>

Дополнительные сведения о строках подключения хранилища см. в разделе [Настройка строк подключения][].

Теперь все готово для выполнения задач, описанных в данном руководстве.

  [Выбор свойств в роли облачной службы в Visual Studio]: ./media/storage-configure-connection-string/connection-string1.png
  [Добавление параметра облачной службы в Visual Studio]: ./media/storage-configure-connection-string/connection-string2.png
  [Установка типа строки подключения]: ./media/storage-configure-connection-string/connection-string3.png
  [Выбор целевой среды]: ./media/storage-configure-connection-string/connection-string4.png
  [Изменение имени строки подключения]: ./media/storage-configure-connection-string/connection-string5.png
  [Настройка строк подключения]: http://msdn.microsoft.com/en-us/library/windowsazure/ee758697.aspx
