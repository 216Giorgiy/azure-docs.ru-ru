# Настройка пользовательского доменного имени для облачной службы Azure

> [AZURE.NOTE]
> Приступите к работе быстрее - воспользуйтесь НОВЫМ [пошаговым руководством](http://support.microsoft.com/kb/2990804) Azure!  Оно поможет легко и быстро связать пользовательское имя домена И защитить обмен данными (SSL) с облачными службами Azure или веб-сайтами Azure.

При создании приложения в Azure система Azure предоставляет дочерний домен в домене cloudapp.net, поэтому пользователи могут получить доступ к приложению по URL-адресу, такому как http://&lt;*myapp*>.cloudapp.net. Однако вы можете сделать свое приложение доступным на своем собственном имени домена, например contoso.com.

> [AZURE.NOTE] 
> Процедуры в этом задании применяются для облачных служб Azure. Сведения об учетных записях хранения см. в разделе [Настройка пользовательского доменного имени для учетной записи хранения Azure](../storage-custom-domain-name/). Сведения о веб-сайтах см. в разделе [Настройка пользовательского доменного имени для веб-сайта Azure](../web-sites-custom-domain-name/).

Содержание:

-   [Общие сведения о записях CNAME и записях A](#access-app)
-   [Добавление записи CNAME для пользовательского домена](#add-cname)
-   [Добавление записи A для пользовательского домена](#add-aname)

<h2><a name="access-app"></a>Общие сведения о записях CNAME и записях A</h2>

И записи CNAME (или записи псевдонимов), и записи А позволяют связать имя домена с конкретным сервером (или службой в данном случае), но они работают по-разному. При использовании записей А с облачными службами Azure существуют также некоторые особые соображения, которые следует учесть, принимая решение, какие именно записи использовать.

###Запись CNAME или запись псевдонима

Запись CNAME сопоставляет *specific* домен, такой как **contoso.com** или **www.contoso.com**, с каноническим доменным именем. В этом случае каноническим доменным именем является доменное имя **&lt;myapp>.cloudapp.net** размещенного приложения Azure. После создания запись CNAME создает псевдоним для **&lt;myapp>.cloudapp.net**. Запись CNAME будет автоматически разрешаться в IP-адрес вашей службы **&lt;myapp>.cloudapp.net**, поэтому при изменении IP-адреса облачной службы не нужно предпринимать никаких действий.

> [AZURE.NOTE] 
> Некоторые регистраторы доменов позволяют сопоставлять дочерние домены только при использовании записи CNAME, например www.contoso.com, а не корневых имен, таких как contoso.com. Дополнительные сведения о записи CNAME см. в документации вашего регистратора, <a href="http://en.wikipedia.org/wiki/CNAME_record">информации в Википедии о записи CNAME</a> или в документе <a href="http://tools.ietf.org/html/rfc1035">Доменные имена IETF - реализация и спецификация</a>.

###Запись А

Запись A сопоставляет домен, например **contoso.com** или **www.contoso.com**, *or a wildcard domain* такими как **\*.contoso.com**, с IP-адресом. В случае облачной службы Azure - виртуальный IP-адрес службы. Так что основным преимуществом записи А перед записью CNAME является то, что у вас может быть одна запись, использующая подстановочные знаки, например ***.contoso.com**, которая будет обрабатывать запросы для нескольких дочерних доменов, например **mail.contoso.com**, **login.contoso.com** или **www.contso.com**.

> [AZURE.NOTE]
> Так как запись А сопоставляется со статическим IP-адресом, она не может автоматически разрешаться в IP-адрес вашей облачной службы. IP-адрес, используемый службой облака, выделяется при первом развертывании в пустую область (производственном или промежуточном). При удалении развертывания для слота Azure освобождает IP-адрес, и все будущие развертывания в область могут получить новый IP-адрес.
> 
> Удобно, что IP-адрес данного слота развертывания (производственного или промежуточного) сохраняется при переходе от промежуточного к производственному развертыванию или при выполнении обновления на месте существующего развертывания. Дополнительные сведения о том, как производить эти действия, см. в разделе [Управление облачными службами](../cloud-services-how-to-manage/).


<h2><a name="add-cname"></a>Добавление записи CNAME для пользовательского домена</h2>

Чтобы создать запись CNAME, необходимо с помощью средств, предоставляемых вашим регистратором, добавить в таблице DNS новую запись для пользовательского домена. Каждый регистратор имеет похожий, но немного отличный способ указания записи CNAME, хотя используется одна и та же концепция.

1. Чтобы найти доменное имя **.cloudapp.net**, назначенное для вашей облачной службы, используйте один из этих методов.

  * Войдите на [портал управления Azure], выберите облачную службу, щелкните **Панель мониторинга** и найдите **URL-адрес сайта** в разделе **краткое описание**.

  		  ![Раздел краткого описания, в котором отображается URL-адрес][csurl]

  * Установите и настройте [Azure Powershell](../install-configure-powershell/), а затем используйте следующую команду:

    Get-AzureDeployment -ServiceName yourservicename | Select Url

  Сохраните имя домена, используемое в URL-адресе, возвращаемом любым методом, так как он понадобится при создании записи CNAME.

1.  Войдите на веб-сайт своего регистратора DNS и перейдите на страницу управления DNS. Найдите ссылки или области сайта, обозначенные как **Имя домена**, **DNS** или **Управление сервером доменных имен**.

2.  Теперь найдите место, где можно выбрать или ввести CNAME. Может потребоваться выбрать тип записи из раскрывающегося списка или перейти на страницу дополнительных параметров. Ищите слова **CNAME**, **Псевдоним** или **Поддомены**.

3.  Необходимо также указать псевдоним домена или дочернего домена для CNAME, такой как **www**, если вы хотите создать псевдоним для **www.customdomain.com**. Если вы хотите создать псевдоним для корневого домена, он может отображаться как символ "**@**" в средствах DNS вашего регистратора.

4. Затем необходимо предоставить каноническое имя узла, которым в данном случае является домен **cloudapp.net** вашего приложения.

Например, следующая запись CNAME пересылает весь трафик из **www.contoso.com** в **contoso.cloudapp.net**, пользовательское доменное имя вашего развернутого приложения:

<table border="1" cellspacing="0" cellpadding="5" style="border: 1px solid #000000;">
<tr>
<td><strong>Псевдоним, имя узла, поддомен</strong></td>
<td><strong>Канонический домен</strong></td>
</tr>
<tr>
<td>www</td>
<td>contoso.cloudapp.net</td>
</tr>
</table>

Посетитель **www.contoso.com** никогда не увидит настоящий узел
(contoso.cloudapp.net), так что процесс перенаправления незаметен для
конечного пользователя.

> [AZURE.NOTE]
> Приведенный выше пример применим только к трафику поддомена <strong>www</strong>. Поскольку с записями CNAME нельзя использовать подстановочные знаки, необходимо создать один CNAME для каждого домена или поддомена. Если вы хотите направить трафик из поддоменов, таких как *.contoso.com, на адрес azurewebsite.net, можно настроить элемент <strong>URL-адрес перенаправления</strong> или <strong>URL-адрес переадресации</strong> в параметрах DNS или создать запись A.


<h2><a name="add-aname"></a>Добавление записи A для пользовательского домена</h2>

Чтобы создать запись А, сначала необходимо найти виртуальный IP-адрес облачной службы. Затем необходимо с помощью средств, предоставляемых вашим регистратором, добавить в таблице DNS новую запись для пользовательского домена. Каждый регистратор имеет похожий, но немного отличный способ указания записи А, хотя используется одна и та же концепция.

1. Чтобы получить IP-адрес для своей облачной службы, используйте один из следующих способов.

  * Войдите на [портал управления Azure], выберите облачную службу, щелкните **Панель мониторинга** и найдите **Общедоступный виртуальный IP-адрес (VIP-адрес)** в разделе **краткое описание**.

   		 ![Раздел краткого описания, в котором отображается VIP-адрес][vip]

  * Установите и настройте [Azure Powershell](../install-configure-powershell/), а затем используйте следующую команду:

      get-azurevm -servicename yourservicename | get-azureendpoint -VM {$_.VM} | select Vip

    При наличии нескольких конечных точек, связанных с облачной службой, вы получите несколько строк, содержащих IP-адрес, но все они должны отображать один и тот же адрес.

  Сохраните IP-адрес, поскольку он понадобится при создании записи А.

1.  Войдите на веб-сайт своего регистратора DNS и перейдите на страницу управления DNS. Найдите ссылки или области сайта, обозначенные как **Имя домена**, **DNS** или **Управление сервером доменных имен**.

2.  Теперь найдите место, где можно выбрать или ввести запись А. Может потребоваться выбрать тип записи из раскрывающегося списка или перейти на страницу дополнительных параметров.

3. Выберите или введите домен или дочерний домен, который будет использовать эту запись А. Например, выберите **www**, если хотите создать псевдоним для **www.customdomain.com**. Если вы хотите создать запись с подстановочными знаками для всех поддоменов, введите '__*__'.. Эта запись охватит все поддомены, такие как **mail.customdomain.com**, **login.customdomain.com** и **www.customdomain.com**.

  Если вы хотите создать запись А для корневого домена, он может отображаться как символ "**@**" в средствах DNS вашего регистратора.

4. Введите IP-адрес вашей облачной службы в предоставленном поле. Это связывает запись домена, используемую в записи А, с IP-адресом развертывания облачной службы.

Например, следующая запись A перенаправляет весь трафик из **contoso.com** на **137.135.70.239**, IP-адрес развертываемого приложения:

<table border="1" cellspacing="0" cellpadding="5" style="border: 1px solid #000000;">
<tr>
<td><strong>Имя узла и поддомен</strong></td>
<td><strong>IP-адрес</strong></td>
</tr>
<tr>
<td>@</td>
<td>137.135.70.239</td>
</tr>
</table>

В этом примере показано создание записи А для корневого домена. Если вы хотите создать запись с подстановочными знаками, чтобы охватить все поддомены, введите '__*__' в качестве поддомена.

## Дальнейшие действия

-   [Управление облачными службами](../cloud-services-how-to-manage/)
-   [Сопоставление содержимого CDN с пользовательским доменом][]

  [Предоставление приложения на пользовательском домене]: #access-app
  [Добавление записи CNAME для пользовательского домена]: #add-cname
  [Предоставление данных на пользовательском домене]: #access-data
  [Переключение виртуальных IP-адресов]: http://msdn.microsoft.com/ru-ru/library/ee517253.aspx
  [Создание записи CNAME, связывающей дочерний домен с учетной записью хранения]: #create-cname
  [Портал управления Azure]: https://manage.windowsazure.com
  [Диалоговое окно "Проверка пользовательского домена"]: http://i.msdn.microsoft.com/dynimg/IC544437.jpg
  [Сопоставление содержимого CDN с пользовательским доменом]: http://msdn.microsoft.com/ru-ru/library/windowsazure/gg680307.aspx
  [виртуальный IP-адрес]: ./media/custom-dns/csvip.png
  [csurl]: ./media/custom-dns/csurl.png
<!--HONumber=42-->
