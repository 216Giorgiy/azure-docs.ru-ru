

## <a name="memory-preserving-updates"></a>Обновления с сохранением памяти
При применении таких обновлений в Microsoft Azure клиенты не заметят какого-либо влияния на работу их виртуальных машин. Многие из этих обновлений предназначены для компонентов или служб, которые могут обновляться без влияния на запущенный экземпляр. Некоторые из этих обновлений предназначены для инфраструктуры платформы в операционной системе хост-компьютера, и их можно применять без полной перезагрузки виртуальных машин.

Эти обновления выполняются с помощью технологии, позволяющей использовать динамический перенос (т. н. обновление с "сохранением памяти"). При обновлении виртуальная машина переводится в состояние приостановки, сохраняя память в ОЗУ, пока операционная система хост-компьютера получает необходимые обновления и исправления. Виртуальная машина возобновляет работу не позже 30 секунд с момента ее приостановки. После возобновления работы часы виртуальной машины автоматически синхронизируются.

Не все обновления можно развернуть с помощью этого механизма, но благодаря короткому периоду приостановки такой способ развертывания обновлений значительно уменьшает влияние на виртуальные машины.

Обновления для нескольких экземпляров (для виртуальных машин в группе доступности) применяются для одного домена обновления за раз.  

## <a name="virtual-machine-configurations"></a>Конфигурации виртуальных машин
Существует два вида конфигураций виртуальных машин: с несколькими экземплярами и с одним экземпляром. В конфигурации с несколькими экземплярами похожие виртуальные машины помещаются в группу доступности.

Конфигурация с несколькими экземплярами обеспечивает избыточность физических машин, питания и сети и рекомендуется для гарантии доступности приложения. Все виртуальные машины в группе доступности должны служить одной цели в приложении.

Дополнительные сведения о настройке виртуальных машин для обеспечения высокой доступности см. в статьях [Управление доступностью виртуальных машин Windows](../articles/virtual-machines/virtual-machines-windows-manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) и [Управление доступностью виртуальных машин Linux](../articles/virtual-machines/virtual-machines-linux-manage-availability.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

В противоположность этому конфигурация с одним экземпляром используется для автономных виртуальных машин, не размещенных в группе доступности. Эти виртуальные машины неспособны удовлетворить требования соглашений об уровне обслуживания, так как для этого необходимо развернуть не менее двух виртуальных машин в одной и той же группе доступности.

Дополнительные сведения о соглашениях об уровне обслуживания см. в разделе "Облачные службы, виртуальные машины и виртуальная сеть" статьи [Соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/).

## <a name="multi-instance-configuration-updates"></a>Обновление конфигурации с несколькими экземплярами
Во время планового обслуживания платформа Azure в первую очередь обновляет набор виртуальных машин, размещенных в конфигурации с несколькими экземплярами. Это приводит к перезапуску виртуальных машин с 15-минутным простоем.

При обновлении конфигурации с несколькими экземплярами виртуальные машины обновляются способом, позволяющим сохранить их доступность в течение процесса обновления, при условии, что каждая виртуальная машина выполняет ту же функцию, что и остальные машины в группе.

Платформа Azure назначает каждой виртуальной машине в группе доступности домен обновления и домен сбоя. Каждый домен обновления — это группа виртуальных машин, которые будут перезапущены в рамках одного временного окна. Каждый домен сбоя — это группа виртуальных машин, совместно использующих общий источник питания и сетевой коммутатор.

Дополнительные сведения о доменах обновления и доменах сбоя см. в разделе [Настройка нескольких виртуальных машин в группе доступности для обеспечения избыточности](../articles/virtual-machines/virtual-machines-windows-manage-availability.md#configure-multiple-virtual-machines-in-an-availability-set-for-redundancy).

Чтобы не допустить одновременного перехода доменов обновления в автономный режим, при обслуживании выполняется завершение работы каждой виртуальной машины в домене обновления, установка обновления на хост-компьютерах, перезапуск виртуальных машин и переход на следующий домен обновления. Событие планового обслуживания завершается после обновления всех доменов обновления.

Во время планового обслуживания домены обновления могут перезапускаться не по порядку, но при этом одновременно перезапускается не более одного домена обновления. Сейчас Azure присылает предварительное уведомление за 1 неделю до планового обслуживания виртуальных машин в конфигурации с несколькими экземплярами.

Ниже показан пример того, что может отображать средство просмотра событий Windows после восстановления виртуальной машины.

<!--Image reference-->
![][image2]

Используйте средство просмотра, чтобы определить, какие виртуальные машины настроены в конфигурации с несколькими экземплярами, с помощью портала Azure, оболочки Azure PowerShell или интерфейса командной строки Azure. Например, чтобы определить, какие виртуальные машины должны находиться в конфигурации с несколькими экземплярами, вы можете просмотреть список виртуальных машин (при этом столбец группы доступности должен быть добавлен в диалоговое окно обзора виртуальных машин). В приведенном ниже примере виртуальные машины-образцы VM1 и VM2 находятся в конфигурации с несколькими экземплярами.

<!--Image reference-->
![][image4]

## <a name="single-instance-configuration-updates"></a>Обновления конфигурации с одним экземпляром
После завершения обновления конфигурации с несколькими экземплярами Azure перейдет к обновлению конфигурации с одним экземпляром. Это обновление приводит к перезагрузке виртуальных машин, не входящих в группы доступности.

Обратите внимание, что даже если в группе доступности работает только один экземпляр, платформа Azure выполняет обновление для конфигурации с несколькими экземплярами.

В конфигурации с одним экземпляром обновление виртуальных машин происходит следующим образом: завершается работа виртуальных машин, применяются обновления для главного компьютера, а затем виртуальные машины запускаются приблизительно с 15-минутным простоем. Эти обновления выполняются для всех виртуальных машин в регионе в рамках одного окна обслуживания.

Такое событие планового обслуживания будет влиять на доступность приложения для данного типа конфигурации. В настоящее время Azure предлагает предварительное уведомление за 1 неделю о плановом обслуживании для виртуальных машин в конфигурации с одним экземпляром.

## <a name="email-notification"></a>Уведомление по электронной почте
Только для конфигураций виртуальных машин с одним и несколькими экземплярами Azure отправляет предварительное электронное сообщение, чтобы оповестить вас о предстоящем плановом обслуживании (за 1 неделю). Это сообщение будет отправляться на адреса электронной почты администратора и соадминистратора подписки указанные в учетной записи. Ниже приведен пример такого электронного письма.

<!--Image reference-->
![][image1]

## <a name="region-pairs"></a>Пары регионов
При выполнении обслуживания Azure обновляет экземпляры виртуальной машины только в одном регионе пары. Например, при обновлении виртуальных машин в северо-центральном регионе США Azure не будет одновременно обновлять виртуальные машины в юго-центральном регионе США. Это обновление будет запланировано на отдельное время с включением отработки отказа или балансировки нагрузки между регионами. Однако в других регионах, например в Северной Европе, обслуживание может происходить одновременно с обслуживанием в восточной части США.

В таблице ниже приведены сведения о текущих парах регионов.

| Регион 1 | Регион 2 |
|:--- | ---:|
| Северо-центральный регион США |Южно-центральный регион США |
| Восток США |Запад США |
| Восточная часть США 2 |Центральный регион США |
| Северная Европа |Западная Европа |
| Юго-Восточная Азия |Восточная Азия |
| Восточный Китай |Северный Китай |
| Восточная часть Японии |Западная часть Японии |
| Южная часть Бразилии |Южно-центральный регион США |
| Юго-Восточная часть Австралии |Восточная часть Австралии |
| Центральная Индия |Южная Индия |
| Западная Индия |Южная Индия |
| Правительство штата Айова |Правительство штата Вирджиния |

<!--Anchors-->
[image1]: ./media/virtual-machines-common-planned-maintenance/vmplanned1.png
[image2]: ./media/virtual-machines-common-planned-maintenance/EventViewerPostReboot.png
[image3]: ./media/virtual-machines-planned-maintenance/RegionPairs.PNG
[image4]: ./media/virtual-machines-common-planned-maintenance/AvailabilitySetExample.png


<!--Link references-->
[Управление доступностью виртуальных машин]: ../articles/virtual-machines/virtual-machines-windows-hero-tutorial.md

[Узнайте, чем отличается запланированное обслуживание от незапланированного]: ../articles/virtual-machines/virtual-machines-windows-manage-availability.md#Understand-planned-versus-unplanned-maintenance/



<!--HONumber=Nov16_HO3-->


