

## <a name="memory-preserving-updates"></a>Обновления с сохранением памяти
При применении таких обновлений в Microsoft Azure клиенты не заметят какого-либо влияния на работу их виртуальных машин. Многие из этих обновлений предназначены для компонентов или служб, которые могут обновляться без влияния на запущенный экземпляр. Некоторые из этих обновлений предназначены для инфраструктуры платформы в операционной системе хост-компьютера, и их можно применять без полной перезагрузки виртуальных машин.

Эти обновления выполняются с помощью технологии, позволяющей использовать динамический перенос (т. н. обновление с "сохранением памяти"). При обновлении виртуальная машина переводится в состояние приостановки, сохраняя память в ОЗУ, пока операционная система хост-компьютера получает необходимые обновления и исправления. Виртуальная машина возобновляет работу не позже 30 секунд с момента ее приостановки. После возобновления работы часы виртуальной машины автоматически синхронизируются.

Не все обновления можно развернуть с помощью этого механизма, но благодаря короткому периоду приостановки такой способ развертывания обновлений значительно уменьшает влияние на виртуальные машины.

Обновления для нескольких экземпляров (для виртуальных машин в группе доступности) применяются для одного домена обновления за раз.  

## <a name="virtual-machine-configurations"></a>Конфигурации виртуальных машин
Существует два вида конфигураций виртуальных машин: с несколькими экземплярами и с одним экземпляром. В конфигурации с несколькими экземплярами похожие виртуальные машины помещаются в группу доступности.

Конфигурация с несколькими экземплярами обеспечивает избыточность физических машин, питания и сети и рекомендуется для гарантии доступности приложения. Все виртуальные машины в группе доступности должны служить одной цели в приложении.

Дополнительные сведения о настройке виртуальных машин для обеспечения высокой доступности см. в статьях об [управлении доступностью виртуальных машин Windows](../articles/virtual-machines/windows/manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) и [Linux](../articles/virtual-machines/linux/manage-availability.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

В противоположность этому конфигурация с одним экземпляром используется для автономных виртуальных машин, не размещенных в группе доступности. Эти виртуальные машины неспособны выполнить требования соглашений об уровне обслуживания, так как для этого необходимо развернуть не менее двух виртуальных машин в одной и той же группе доступности.

Дополнительные сведения о соглашениях об уровне обслуживания см. в разделах "Облачные службы" и "Виртуальные машины" страницы [Соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/).

## <a name="multi-instance-configuration-updates"></a>Обновление конфигурации с несколькими экземплярами
Во время планового обслуживания платформа Azure в первую очередь обновляет набор виртуальных машин, размещенных в конфигурации с несколькими экземплярами. Это приводит к перезапуску виртуальных машин с 15-минутным простоем.

Обновление многоэкземплярной конфигурации предполагает, что каждая виртуальная машина выполняет ту же функцию, что и остальные виртуальные машины в группе доступности. При обновлении виртуальные машины остаются доступными в течение всего процесса.

Платформа Azure назначает каждой виртуальной машине в группе доступности домен обновления и домен сбоя. Каждый домен обновления — это группа виртуальных машин, которые будут перезапущены в рамках одного временного окна. Каждый домен сбоя — это группа виртуальных машин, совместно использующих общий источник питания и сетевой коммутатор.


Дополнительные сведения о доменах обновления и доменах сбоя см. в разделе [Настройка нескольких виртуальных машин в группе доступности для обеспечения избыточности](../articles/virtual-machines/windows/manage-availability.md#configure-multiple-virtual-machines-in-an-availability-set-for-redundancy).

Чтобы поддерживать доступность во время обновления, Azure выполняет обслуживание по домену обновления, обновляя по одному домену за раз. Обслуживание выполняется путем остановки работы каждой виртуальной машины в домене, применения обновления к хост-компьютерам и перезапуска виртуальных машин. По завершении обслуживания в домене Azure повторяет этот процесс в каждом домене, пока не будет обновлен каждый домен.

Во время планового обслуживания домены обновления могут перезапускаться не по порядку, но при этом одновременно перезапускается не более одного домена обновления. Сейчас Azure присылает предварительное уведомление за 1 неделю до планового обслуживания виртуальных машин в конфигурации с несколькими экземплярами.

Ниже показан пример того, что может отображать средство просмотра событий Windows после восстановления виртуальной машины.

<!--Image reference-->
![][image2]


Используйте средство просмотра, чтобы определить, какие виртуальные машины настроены в конфигурации с несколькими экземплярами, с помощью портала Azure, оболочки Azure PowerShell или Azure CLI. Например, с помощью портала Azure можно добавить _группу доступности_ в диалоговом окне обзора **виртуальных машин (классических)**. Виртуальные машины, которые находятся в одной группе доступности, являются частью многоэкземплярной конфигурации. В следующем примере многоэкземплярная конфигурация состоит из виртуальных машин SQLContoso01 и SQLContoso02.

<!--Image reference-->
  ![Представление виртуальных машин (классических ) на портале Azure][image4]

## <a name="single-instance-configuration-updates"></a>Обновления конфигурации с одним экземпляром
После завершения обновления конфигурации с несколькими экземплярами Azure перейдет к обновлению конфигурации с одним экземпляром. Эти обновления приводят к перезагрузке виртуальных машин, не входящих в группы доступности.

> [!NOTE]
> Если в группе доступности работает только один экземпляр виртуальной машины, платформа Azure выполняет обновление для конфигурации с несколькими экземплярами.
>

Обслуживание одноэкземплярных конфигураций включает в себя завершение работы каждой виртуальной машины, работающей на хост-компьютере, обновление хост-компьютера, а затем перезапуск виртуальных машин. Для выполнения обслуживания требуется около 15 минут простоя. Плановое обслуживание выполняется для всех виртуальных машин в регионе в рамках одного окна обслуживания.


События планового обслуживания влияют на доступность приложения для одноэкземплярных конфигураций. В настоящее время Azure предлагает предварительное уведомление за 1 неделю о плановом обслуживании для виртуальных машин в конфигурации с одним экземпляром.

## <a name="email-notification"></a>Уведомление по электронной почте
Чтобы оповестить вас о предстоящем плановом обслуживании (за 1 неделю), Azure отправляет оповещение по электронной почте, но это касается только конфигураций виртуальных машин с одним и несколькими экземплярами. Это сообщение отправляется по адресам электронной почты администратора и соадминистратора подписки, указанным в учетной записи. Ниже приведен пример такого электронного письма.

<!--Image reference-->
![][image1]

## <a name="region-pairs"></a>Пары регионов

При выполнении обслуживания Azure обновляет экземпляры виртуальной машины только в одном регионе пары. Например, при обновлении виртуальных машин в северо-центральном регионе США Azure не будет одновременно обновлять виртуальные машины в юго-центральном регионе США. Это обновление будет запланировано на отдельное время с включением отработки отказа или балансировки нагрузки между регионами. Однако в других регионах, например в Северной Европе, обслуживание может происходить одновременно с обслуживанием в восточной части США.

Список текущих пар регионов см. в следующей таблице.

| Регион 1 | Регион 2 |
|:--- | ---:|
| Восток США |Запад США |
| Восток США 2 |Центральный регион США |
| Северо-центральный регион США |Южно-центральный регион США |
| Западно-центральная часть США |Западный регион США 2 |
| Восточная Канада |Центральная Канада |
| Южная часть Бразилии |Южно-центральный регион США |
| Правительство штата Айова |Правительство штата Вирджиния |
| Восточная часть US DoD |Центральная часть US DoD |
| Северная Европа |Западная Европа |
| Западная часть Великобритании |Южная часть Великобритании |
| Центральная Германия |Северо-восточная Германия |
| Юго-Восточная Азия |Восточная Азия |
| Юго-Восточная часть Австралии |Восточная часть Австралии |
| Центральная Индия |Южная Индия |
| Западная Индия |Южная Индия |
| Восточная часть Японии |Западная часть Японии |
| Центральная Корея |Южная Корея |
| Восточный Китай |Северный Китай |


<!--Anchors-->
[image1]: ./media/virtual-machines-common-planned-maintenance/vmplanned1.png
[image2]: ./media/virtual-machines-common-planned-maintenance/EventViewerPostReboot.png
[image3]: ./media/virtual-machines-planned-maintenance/RegionPairs.PNG
[image4]: ./media/virtual-machines-common-planned-maintenance/availabilitysetexample.png


<!--Link references-->
[Virtual Machines Manage Availability]: ../articles/virtual-machines/virtual-machines-windows-hero-tutorial.md

[Understand planned versus unplanned maintenance]: ../articles/virtual-machines/windows/manage-availability.md#Understand-planned-versus-unplanned-maintenance/
