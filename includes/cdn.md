# Использование CDN для Azure

Сеть доставки содержимого (CDN) Azure предоставляет разработчикам
глобальное решение для доставки большого объема содержимого с возможностью кэширования BLOB-объектов
и статического содержимого на физических узлах в США,
Европе, Азии, Австралии и Южной Америке. Для получения текущего списка
местоположений узлов CDN см. [Расположение узлов сети CDN для Azure][Расположение узлов сети CDN для Azure].

Эта задача включает следующие шаги:

-   [Шаг 1: Создание учетной записи хранения][Шаг 1: Создание учетной записи хранения]
-   [Шаг 2: Создание новой конечной точки CDN для вашей учетной записи хранения][Шаг 2: Создание новой конечной точки CDN для вашей учетной записи хранения]
-   [Шаг 3: Получение доступа к содержимому CDN][Шаг 3: Получение доступа к содержимому CDN]
-   [Шаг 4: Удаление содержимого CDN][Шаг 4: Удаление содержимого CDN]

Использование сети CDN для кэширования данных Azure приносит следующие преимущества.

-   Повышенная производительность и впечатления от использования для конечных пользователей, которые находятся далеко от источника содержимого и работают с приложениями, в которых для загрузки содержимого требуется множество обращений в Интернет.
-   Крупномасштабное распределение для улучшения мгновенной обработки высокой нагрузки, например, в начале события, такого как запуск продукта.

Существующие клиенты сети CDN теперь могут использовать сеть Azure CDN на [портале управления Azure][портале управления Azure]. CDN является функцией расширения для подписки и имеет отдельный [план выставления счетов][план выставления счетов]

<span id="Step1"></span> </a>

## Шаг 1. Создание учетной записи хранения

</p>
Чтобы создать новую учетную запись хранения для подписки Azure,
воспользуйтесь следующей процедурой. Учетная запись хранения предоставляет доступ к
службам хранения Azure. Учетная запись хранения представляет собой самый высокий уровень
пространства имен для доступа ко всем компонентам служб хранения
Azure: службам BLOB-объектов, службам очередей и службам таблиц. Дополнительные
сведения о службах хранения Azure см. в разделе [Использование
служб хранения Azure].

Чтобы создать учетную запись хранения, пользователь должен быть администратором
службы или соадминистратором для связанной подписки.

<div class="dev-callout">

**Примечание.**
Сведения о выполнении этой операции с помощью API управления службами Azure см. в справочном разделе [Создание учетной записи хранения][Создание учетной записи хранения].

</div>

**Чтобы создать учетную запись хранения для подписки Azure**

1.  Выполните вход на [портал управления Azure][портале управления Azure].
2.  В нижнем левом углу нажмите кнопку **Создать**, а затем — кнопку **Хранилище**.
3.  Щелкните **Быстрое создание**.

    Откроется диалоговое окно **Создание учетной записи хранения**.

    ![Создать учетную запись хранения][Создать учетную запись хранения]

4.  В поле **URL-адрес** введите имя поддомена. Запись может содержать от 3 до 24 строчных букв и цифр.

    Это значение становится именем узла в URI, который используется для
    адресации ресурсов BLOB-объектов, очереди и таблицы для подписки. Чтобы
    обратиться по адресу ресурса контейнера в службе BLOB-объектов, следует использовать
    URI в следующем формате, где *\<StorageAccountLabel\>* указывает
    значение, введенное в поле **Введите URL-адрес**:

    http://*\<StorageAcountLabel\>*.blob.core.windows.net/*\<mycontainer\>*

    **Важно!** Метка URL-адреса образует поддомен URI учетной записи
    хранения и должна быть уникальной на уровне всех размещенных служб
    в Azure.

    Это значение также используется как имя этой учетной записи хранения на портале или при доступе к данной учетной записи программным способом.

5.  В раскрывающемся списке **Регион или территориальная группа** выберите регион или территориальную группу для этой учетной записи хранения. Выберите территориальную группу вместо региона, если необходимо размещение служб хранилища в одном центре обработки данных с другими используемыми службами Windows Azure. Это может повысить производительность без дополнительных затрат на передачу данных.

    **Примечание.** Чтобы создать территориальную группу, откройте раздел **Параметры** на портале управления, перейдите на страницу **Территориальные группы** и затем щелкните либо **Добавить территориальную группу**, либо **Добавить**. Можно также создавать территориальные группы и управлять ими с помощью API управления службами Windows Azure. Дополнительные сведения см. в разделе [Операции с территориальными группами][Операции с территориальными группами].

6.  В раскрывающемся списке **Подписка** выберите подписку, с которой будет использоваться данная учетная запись хранения.
7.  Щелкните **Создать учетную запись хранения**. Процесс создания учетной записи хранения может занять несколько минут.
8.  Чтобы удостовериться, что учетная запись хранения создана успешно, убедитесь, что эта учетная запись отображается в элементах списка **Хранилище** со статусом **В сети**.

<span id="Step2"></span> </a>

## Шаг 2. Создание новой конечной точки CDN для вашей учетной записи хранения

</p>
После включения CDN-доступа к учетной записи хранения или размещенной службе все
общедоступные объекты будут пригодны для пограничного кэширования CDN. Если
изменить объект, находящийся в данный момент в кэше сети CDN, новое содержимое
будет недоступно через сеть CDN до обновления содержимого CDN
по истечении срока действия кэшированного содержимого.

**Чтобы создать новую конечную точку CDN для вашей учетной записи хранения**

1.  На [портале управления Azure][портале управления Azure] на панели управления выберите **CDN**.

2.  На ленте щелкните **Создать** В диалоговом окне **Создать** выберите **Служба приложений**, затем **CDN**, затем **Быстрое создание**.

3.  В раскрывающемся списке **Исходный домен** выберите учетную запись хранения, созданную в предыдущем разделе, в списке доступных учетных записей хранения.

4.  Нажмите кнопку **Создать**, чтобы создать новую конечную точку.

5.  После создания конечной точки, она отображается в списке конечных точек для этой подписки. В режиме списка отображается URL-адрес для доступа к кэшированному содержимому, а также исходному домену.

    Исходный домен представляет собой расположение, содержимое из которого кэшируется
    в CDN. Исходный домен может быть учетной записью хранения или облачной службой; для целей этого примера используется учетная запись хранения. Содержимое хранилища кэшируется на пограничных серверах в соответствии с указанным параметром управления кэшем или эвристикой по умолчанию для сети кэширования. Дополнительные сведения см. в разделе [Управление сроком действия содержимого BLOB-объекта][Управление сроком действия содержимого BLOB-объекта].

    <div class="dev-callout">

    **Примечание.**
    Конфигурация, созданная для конечной точки, недоступна незамедлительно. Может потребоваться до 60 минут для распространения регистрации по сети CDN. Если пользователь попытается незамедлительно воспользоваться именем домена CDN, он может столкнуться с кодом состояния 400 (неверный запрос), пока содержимое не станет доступно через CDN.

    </div>

<span id="Step3"></span> </a>

## Шаг 3. Получение доступа к содержимому CDN

</p>
Для доступа к кэшированному содержимому в сети CDN воспользуйтесь URL-адресом CDN, отображаемым в портале. Адрес для кэшированного BLOB-объекта будет иметь следующий вид:

http://\<*CDNNamespace*\>.vo.msecnd.net/\<*myPublicContainer*\>/\<*BlobName*\>

<span id="Step4"></span> </a>

## Шаг 4. Удаление содержимого из сети CDN

</p>
Если кэширование объекта в сети CDN Azure больше не требуется,
можно выполнить одно из следующих действий.

-   Для BLOB-объекта Azure можно удалить этот объект из общедоступного
    контейнера.
-   Можно сделать контейнер закрытым, а не общедоступным. Дополнительные сведения см. в разделе [Ограничение доступа к контейнерам и BLOB-объектам][Ограничение доступа к контейнерам и BLOB-объектам].
-   Можно отключить или удалить конечную точку CDN на портале
    управления.
-   Можно изменить размещенную службу, чтобы она перестала отвечать на запросы
    объекта.

Объект, уже кэшированный в сети CDN, останется в кэше до
истечения срока действия этого объекта. По истечении срока действия
CDN выполнит проверку конечной точки CDN, чтобы выяснить, что она еще
действует и объект по-прежнему находится в анонимном доступе. Если это не так,
объект больше не будет кэшироваться.

В настоящее время средство явной "очистки" для сети Azure CDN
недоступно.

## Дополнительные ресурсы

-   [Создание территориальной группы в Azure]
-   [Практическое руководство. Управление учетными записями хранения для подписки Azure][Практическое руководство. Управление учетными записями хранения для подписки Azure]
-   [Об API управления службами][Об API управления службами]
-   [Сопоставление содержимого CDN с пользовательским доменом][Сопоставление содержимого CDN с пользовательским доменом]

  [Расположение узлов сети CDN для Azure]: http://msdn.microsoft.com/ru-ru/library/windowsazure/gg680302.aspx
  [Шаг 1: Создание учетной записи хранения]: #Step1
  [Шаг 2: Создание новой конечной точки CDN для вашей учетной записи хранения]: #Step2
  [Шаг 3: Получение доступа к содержимому CDN]: #Step3
  [Шаг 4: Удаление содержимого CDN]: #Step4
  [портале управления Azure]: https://manage.windowsazure.com/
  [план выставления счетов]: /ru-ru/pricing/calculator/?scenario=full
  [Создание учетной записи хранения]: http://msdn.microsoft.com/ru-ru/library/windowsazure/hh264518.aspx
  [Создать учетную запись хранения]: ./media/cdn/CDN_CreateNewStorageAcct.png
  [Операции с территориальными группами]: http://msdn.microsoft.com/library/azure/ee460798.aspx
  [Управление сроком действия содержимого BLOB-объекта]: http://msdn.microsoft.com/ru-ru/library/gg680306.aspx
  [Ограничение доступа к контейнерам и BLOB-объектам]: http://msdn.microsoft.com/ru-ru/library/dd179354.aspx
  [Практическое руководство. Управление учетными записями хранения для подписки Azure]: http://msdn.microsoft.com/ru-ru/library/windowsazure/hh531567.aspx
  [Об API управления службами]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee460807.aspx
  [Сопоставление содержимого CDN с пользовательским доменом]: http://msdn.microsoft.com/ru-ru/library/windowsazure/gg680307.aspx
