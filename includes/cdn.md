# Использование CDN для Azure

Сеть доставки содержимого Azure (CDN) предлагает разработчикам глобальное решение для доставки большого объема содержимого с возможностью кэширования BLOB-объектов и статического содержимого на физических узлах в США, Европе, Азии, Австралии и Южной Америке. Для получения текущего списка местоположений узлов CDN см. [Расположение узлов сети CDN для Azure]

Эта задача включает следующие шаги:

* [Шаг 1. Создание учетной записи хранения](#Step1)
* [Шаг 2. Создание новой конечной точки CDN для вашей учетной записи хранения](#Step2)
* [Шаг 3. Получение доступа к содержимому CDN](#Step3)
* [Шаг 4. Удаление содержимого CDN](#Step4)

Преимущества использования сети CDN для кэширования данных Azure включают следующее:

-   Улучшенная производительность и взаимодействие с пользователем для конечных пользователей, которые находятся далеко от источника содержимого и используют приложения, где для загрузки содержимого требуется множество "Интернет-обращений".
-   Масштабная распределенная обработка для улучшения обработки мгновенной высокой нагрузки, скажем, в начале события, например запуска продукта

Существующие клиенты сети CDN теперь могут использовать сеть Azure CDN в [портале управления Azure]. CDN является функцией расширения для подписки и имеет отдельный [план выставления счетов]

<a id="Step1"> </a>
<h2>Шаг 1. Создание учетной записи хранения</h2>

Чтобы создать новую учетную запись хранения для подписки Azure, воспользуйтесь следующей процедурой. Учетная запись хранения предоставляет доступ к службам хранения Azure. Учетная запись хранения представляет собой высший уровень пространства имен для доступа ко всем компонентам службы хранения Azure: службам BLOB-объекта, службам очередей и службам таблиц. Дополнительные сведения о службах хранения Azure см. в разделе [Использование служб хранения Azure].

Чтобы создать учетную запись хранения, пользователь должен быть администратором службы или соадминистратором для связанной подписки.

<div class="dev-callout">
<strong>Примечание.</strong>
<p>Сведения о выполнении этой операции с помощью API управления службой Azure см. в справочном разделе <a href="http://msdn.microsoft.com/ru-ru/library/windowsazure/hh264518.aspx">Создание учетной записи хранения</a>.</p>
</div>

**Чтобы создать учетную запись хранения для подписки Azure**

1.  Войдите на [портал управления Azure].
2.  В нижнем левом углу нажмите кнопку **Создать**, а затем — кнопку **Хранилище**.
3.  Щелкните **Быстрое создание**.

    Откроется диалоговое окно **Создание учетной записи хранения**.

    ![Создать учетную запись хранения][create-new-storage-account]

4. В поле **URL-адрес** введите имя поддомена. Запись может содержать от 3 до 24 строчных букв и цифр.

    Это значение становится именем узла в URI, который используется для адресации ресурсов BLOB-объекта, очереди и таблицы для подписки. Чтобы обратиться по адресу ресурса контейнера в службе BLOB-объекта, следует использовать URI в следующем формате, где *&lt;StorageAccountLabel&gt;* указывает значение, введенное в поле **Введите URL-адрес**

    http://*&lt;StorageAcountLabel&gt;*.blob.core.windows.net/*&lt;mycontainer&gt;*

    **Важно.** Метка URL-адреса образует поддомен URI учетной записи хранения и должна быть уникальной на уровне всех размещенных служб в Azure.

	Это значение также используется как имя этой учетной записи хранения на портале или при доступе к данной учетной записи программным способом.

5.  В раскрывающемся списке **Регион или территориальная группа** выберите географическое расположение для этой учетной записи хранения. Можно также использовать территориальную группу. Инструкции по созданию территориальной группы см. в разделе [Создание территориальной группы в Azure].
6. В раскрывающемся списке **Подписка** выберите подписку, с которой будет использоваться данная учетная запись хранения.
7.  Щелкните **Создать учетную запись хранения**. Процесс создания учетной записи хранения может занять несколько минут.
8.  Чтобы удостовериться, что учетная запись хранения создана успешно, убедитесь, что эта учетная запись отображается в элементах списка **Хранилище** со статусом **В сети**.

<a id="Step2"> </a>
<h2>Шаг 2. Создание новой конечной точки CDN для вашей учетной записи хранения</h2>

После включения CDN-доступа к учетной записи хранения или размещенной службе все публично доступные объекты будут пригодны для пограничного кэширования CDN. Если изменить объект, находящийся в данный момент в кэше сети CDN, новое содержимое будет недоступно через сеть CDN до момента обновления содержимого CDN по истечении срока действия кэшированного содержимого.

**Чтобы создать новую конечную точку CDN для вашей учетной записи хранения**

1. В [портале управления Azure] на панели управления щелкните **CDN**.

2. На ленте щелкните **Создать** В диалоговом окне **Создать** выберите **Служба приложений**, затем **CDN**, затем **Быстрое создание**.

3. В раскрывающемся списке **Исходный домен** выберите учетную запись хранения, созданную в предыдущем разделе, в списке доступных учетных записей хранения. 

4. Нажмите кнопку **Создать**, чтобы создать новую конечную точку.

5. После создания конечной точки, она отображается в списке конечных точек для этой подписки. В режиме списка отображается URL-адрес для доступа к кэшированному содержимому, а также исходному домену. 

	Исходный домен представляет собой расположение, содержимое из которого кэшируется в CDN. Исходный домен может быть учетной записью хранения или облачной службой; для целей этого примера используется учетная запись хранения. Содержимое хранилища кэшируется на пограничных серверах в соответствии с указанным параметром управления кэшем или эвристикой по умолчанию для сети кэширования. Дополнительные сведения см. в разделе [Управление сроком действия содержимого BLOB-объекта](http://msdn.microsoft.com/ru-ru/library/gg680306.aspx). 


    <div class="dev-callout">
    <strong>Примечание.</strong>
    <p>Конфигурация, созданная для конечной точки, не будет доступна незамедлительно. Для распространения регистрации по сети CDN может потребоваться до 60 минут. Если пользователь попытается незамедлительно воспользоваться именем домена CDN, он может столкнуться с кодом состояния 400 (Неверный запрос), пока содержимое не станет доступно через CDN.</p>
    </div>

<a id="Step3"> </a>
<h2>Шаг 3. Получение доступа к содержимому CDN</h2> 

Для доступа к кэшированному содержимому в сети CDN воспользуйтесь URL-адресом CDN, отображаемым в портале. Адрес для кэшированного BLOB-объекта будет иметь следующий вид:

http://<*CDNNamespace*\>.vo.msecnd.net/<*myPublicContainer*\>/<*BlobName*\>

<a id="Step4"> </a>
<h2>Шаг 4. Удаление содержимого из сети CDN</h2>

Если кэширование объекта в сети CDN Azure больше не требуется, можно выполнить одно из следующих действий:

-   Для BLOB-объекта Azure можно удалить этот объект из открытого контейнера.
-   Можно сделать контейнер закрытым, а не открытым. Дополнительные сведения см. в разделе [Ограничение доступа к контейнерам и BLOB-объектам](http://msdn.microsoft.com/ru-ru/library/dd179354.aspx).
-   Можно отключить или удалить конечную точку CDN в портале управления.
-   Можно изменить размещенную службу, чтобы она перестала отвечать на запросы объекта.

Объект, который уже кэширован в сети CDN, останется в кэше до истечения срока действия этого объекта. По истечении срока действия CDN выполнит проверку конечной точки CDN, чтобы убедиться, что она еще действует и объект по-прежнему находится в анонимном доступе. Если это не так, объект больше не будет кэшироваться.

В настоящее время средство явной "очистки" для сети Azure CDN недоступно.

## Дополнительные ресурсы

-   [Создание территориальной группы в Azure]
-   [Управление учетной записи хранения для подписки Azure]
-   [Об API управления службами]
-   [Сопоставление содержимого CDN с пользовательским доменом]

  [Создание учетной записи хранения]: http://msdn.microsoft.com/ru-ru/library/windowsazure/hh264518.aspx
  [Расположение узлов сети CDN для Azure]: http://msdn.microsoft.com/ru-ru/library/windowsazure/gg680302.aspx
  [портале управления Azure]: https://manage.windowsazure.com/
  [план выставления счетов]: /ru-ru/pricing/calculator/?scenario=full
  [Использование служб хранения Azure]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee924681.aspx
  [Регистрация имени пользовательского поддомена для доступа к BLOB-объектам в Azure]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee795179.aspx
  [Создание территориальной группы в Azure]: http://msdn.microsoft.com/ru-ru/library/windowsazure/hh531560.aspx
  [Обзор Azure CDN]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ff919703.aspx
  [Управление учетной записи хранения для подписки Azure]: http://msdn.microsoft.com/ru-ru/library/windowsazure/hh531567.aspx
  [Об API управления службами]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee460807.aspx
  [Сопоставление содержимого CDN с пользовательским доменом]: http://msdn.microsoft.com/ru-ru/library/windowsazure/gg680307.aspx


[create-new-storage-account]: ./media/cdn/CDN_CreateNewStorageAcct.png
[Previous Management Portal]: ../../Shared/Media/previous-portal.png


