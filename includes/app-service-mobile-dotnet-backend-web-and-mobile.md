В этой статье рассказывается, как создать приложение, у которого будет как мобильный клиент, так и веб-клиент. Вы создадите мобильное приложение и веб-приложение и для каждого из них используете одну и ту же основную базу данных.

Сначала вы создадите новую серверную часть мобильного приложения и простое приложение *списка дел*, которое будет хранить свои данные в новой серверной части. Серверная часть мобильного приложения использует для серверной бизнес-логики поддерживаемые языки .NET. Клиентское приложение может использовать любую клиентскую платформу, поддерживаемую мобильным приложением, включая iOS, Windows, Xamarin iOS и Xamarin Android.

Затем вы создадите веб-приложение, которое будет использовать ту же базу данных, что и мобильное приложение. К концу работы с учебником у вас будет веб-клиент и мобильный клиент, работающие с одной базой данных.

>[AZURE.NOTE]Если вы хотите приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.

## Создание серверной части мобильного приложения и клиента

* Чтобы создать серверную часть мобильного приложения и клиент, выполните действия, описанные в учебнике [Создание мобильного приложения]. Вы можете использовать любую клиентскую платформу, поддерживаемую мобильными приложениями, включая iOS, Windows, Xamarin iOS и Xamarin Android.

* Убедитесь, что серверная часть мобильного приложения развернута в Azure, а клиентское мобильное приложение подключено к размещенной серверной части. Проект кода мобильного приложения использует Entity Framework Code First и после первого запроса REST от мобильного клиентского приложения инициализирует базу данных.

## Публикация веб-API приложения TodoList из Visual Studio

Сейчас вы создадите новое веб-приложение, используя пример решения для веб-приложения. Вы измените пример так, чтобы он использовал то же имя схемы базы данных и ту же строку подключения, что и мобильное приложение.

>[AZURE.NOTE]Перед выполнением этих действий убедитесь, что вы инициализировали базу данных серверной части вашего мобильного приложения, подключив к ней клиент. Иначе веб-приложение не сможет подключиться к той же базе данных.

1. На [портале Azure](https://portal.azure.com/) создайте новое веб-приложение. Используйте группу ресурсов и план веб-хостинга, которые заданы для вашего мобильного приложения.

2. Загрузите пример решения [MultiChannelToDo] и откройте его в Visual Studio. Решение содержит проект веб-API и проект веб-приложения для пользовательского интерфейса веб-клиента.

3. В проекте веб-API отредактируйте файл MultiChannelToDoContext.cs. В `OnModelCreating` измените имя схемы, чтобы оно было таким же, как и имя вашего мобильного приложения.

        modelBuilder.HasDefaultSchema("your_mobile_app"); // your service name, replacing dashes with underscore

4. Далее мы получим строку подключения мобильного приложения с портала Azure.

    - Выберите свое мобильное приложение на портале и щелкните часть с меткой **Пользовательский код**.

    - В открывшейся колонке выберите **Все параметры**, а затем — **Параметры приложения**.

    - В разделе **Строки подключения** щелкните элемент **Показать строки подключения**. Скопируйте значение параметра **MS_TableConnectionString**. Это и будет строка подключения, которую ваше мобильное приложение использует для подключения к базе данных SQL.

5. В Visual Studio щелкните правой кнопкой мыши проект веб-API и выберите команду **Опубликовать**. В качестве цели публикации выберите **Веб-приложения Azure**, после чего выберите свое созданное веб-приложение (см. выше). Нажимайте кнопку **Далее**, пока в мастере веб-публикации не перейдете к разделу **Параметры**.

6. В разделе **Базы данных** в качестве значения параметра **MultiChannelToDoContext** вставьте строку подключения мобильного приложения. Установите только флажок **Использовать эту строку подключения в среде выполнения**.

7. После успешной публикации веб-API в Azure отобразится страница подтверждения. Скопируйте URL-адрес опубликованной службы.

## Публикация пользовательского интерфейса веб-клиента TodoList из Visual Studio

Сейчас вы будете использовать пример приложения веб-клиента, реализованного с помощью AngularJS. Затем с помощью Visual Studio вы опубликуете проект в новом размещенном веб-приложении в службе приложений Azure.

1. В Visual Studio откройте проект **MultiChannelToDo.Web**. Измените файл `js/service/ToDoService.js`, добавив URL-адрес только что опубликованного веб-API.

        var apiPath = "https://your-web-api-site-name.azurewebsites.net";

2. Щелкните правой кнопкой мыши проект **MultiChannelToDo.Web** и выберите команду **Опубликовать**.

3. В мастере **Публикация веб-сайта** в качестве объекта публикации выберите пункт **Веб-приложение Azure** и создайте новое веб-приложение без базы данных.

4. После публикации проекта в браузере отобразится пользовательский веб-интерфейс.

## Тестирование веб-приложений и мобильных приложений

1. В пользовательском веб-интерфейсе добавьте или измените некоторые пункты списка дел.

    ![Просмотр веб-приложения в браузере](./media/app-service-mobile-dotnet-backend-web-and-mobile/web-app-in-browser.png)

2. Запустите мобильное приложение, созданное во время прохождения учебника [Создание мобильного приложения]. Отобразятся такие же пункты списка дел, что и в веб-приложении.

    ![Просмотр мобильного приложения Xamarin](./media/app-service-mobile-dotnet-backend-web-and-mobile/xamarin-ios-quickstart-device.png)

## Дальнейшие действия

В этом примере мы показали вам, как использовать одну и ту же основную базу данных для приложения с веб-клиентом и мобильным клиентом. В серверной части не было бизнес-логики, которую нужно было повторно использовать в обоих клиентах, поэтому было достаточно просто использовать одну и ту же базу данных. В одном из следующих учебников вы узнаете, как добавить бизнес-логику в веб-API и повторно использовать ее в коде серверной части мобильного приложения.

## Изменения
* Указания по изменениям при переходе от веб-сайтов к службе приложений см. в разделе [Служба приложений Azure и ее влияние на существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714).
* Руководство по смене старого портала на новый портал см. в разделе [Справочник по навигации на предварительной версии портала](http://go.microsoft.com/fwlink/?LinkId=529715).

<!-- Links -->

[MultiChannelToDo]: https://github.com/Azure/mobile-services-samples/tree/web-mobile/MultiChannelToDo
[Создание мобильного приложения]: ../article/app-service-mobile/app-service-mobile-dotnet-backend-xamarin-ios-get-started-preview.md

<!---HONumber=62-->