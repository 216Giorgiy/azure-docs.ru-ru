## Настройка строки подключения к хранилищу

Библиотека клиента хранилища Azure для .NET поддерживает использование строки подключения для настройки конечных точек и учетных данных для доступа к службам хранилища. Рекомендуется хранить строку подключения хранилища в файле конфигурации, а не встраивать ее в приложение. Вы можете сохранить строку подключения двумя способами.

- Если приложение запущено в облачной службе Azure, сохраните строку подключения с помощью системы конфигурации службы Azure (файлы `*.csdef` и `*.cscfg`). Дополнительную информацию о конфигурации облачной службы Azure см. в разделе [Создание и развертывание облачной службы](../articles/cloud-services/cloud-services-how-to-create-deploy.md).
- Если вы запустили приложение в виртуальных машинах Azure, или вы создаете приложения .NET, которые будут запускаться за пределами Azure, сохраните строку подключения, используя систему конфигурации .NET (например, файл `web.config` или `app.config`).

Далее в этом учебнике будет показано, как получить строку подключения из кода.

### Настройка строки подключения из облачной службы Azure

Облачные службы Azure обладают уникальным механизмом настройки службы, который позволяет динамически изменять параметры настройки на портале управления Azure, не развертывания приложение повторно.

Настройка строки подключения в конфигурации службы Azure.

1.  В обозревателе решений Visual Studio в папке **Роли** вашего проекта развертывания Azure щелкните правой кнопкой мыши свою веб-роль или рабочую роль и выберите **Свойства**. ![Выбор свойств роли облачной службы в Visual Studio][connection-string1]

2.  Откройте вкладку **Параметры** и нажмите кнопку **Добавить параметр**. ![Добавление параметра облачной службы в Visual Studio][connection-string2]

    В таблице параметров появится новая запись **Setting1**.

3.  В раскрывающемся списке **Тип** новой записи **Setting1** выберите **Строка подключения**.![Определение типа строки подключения][connection-string3]

4.  Нажмите кнопку **...** в правой части записи **Setting1**. Откроется диалоговое окно **Строка подключения учетной записи хранения**.

5.  Назначьте для использования эмулятор хранения (хранилище Microsoft Azure, смоделированное на вашем локальном компьютере) или учетную запись хранения в облаке. Код, представленный в этом руководстве, работает в любом случае.

	> [AZURE.NOTE]Вы можете указать эмулятор хранения, чтобы избежать затрат, связанных с хранилищем Azure. Однако если вы выберете учетную запись хранения Azure в облаке, затраты на выполнение заданий в учебнике будут незначительны.

	Выбрав учетную запись хранения в облаке, введите первичный ключ доступа для этой учетной записи. Сведения о том, как скопировать первичный ключ доступа через портал управления Azure, см. в разделе [Просмотр, копирование и повторное создание ключей доступа к хранилищу](storage-create-storage-account.md#view-copy-and-regenerate-storage-access-keys).

	> [AZURE.NOTE]Ключ учетной записи хранения похож на корневой пароль для вашей учетной записи хранения. Убедитесь, что ключ защищен. Не сообщайте его другим пользователям и не храните его в текстовом файле, доступном другим пользователям. Повторно создайте ключ с помощью портала управления, если вы считаете, что он был взломан.
	
    ![Выбор целевой среды][connection-string4]

6.  Измените **Имя записи** с **Setting1** на более понятное имя, например **StorageConnectionString**. Эта строка подключения будет использоваться далее в настоящем руководстве. ![Изменение имени строки подключения][connection-string5]
	
### Настройка строки подключения с помощью конфигурации .NET

При написании приложения, которое не является облачной службой Azure (см. предыдущий раздел), рекомендуется использовать систему конфигурации .NET (например, `web.config` или `app.config`). Это относится к веб-сайтам Azure или виртуальным машинам Azure, а также приложениям, разработанным для работы вне Azure. Строка подключения хранится в элементе `<appSettings>`: Замените `account-name` именем своей учетной записи хранения, а `account-key` — ключом доступа своей учетной записи:

	<configuration>
  		<appSettings>
    		<add key="StorageConnectionString" value="DefaultEndpointsProtocol=https;AccountName=account-name;AccountKey=account-key" />
  		</appSettings>
	</configuration>

Например, параметр конфигурации в файле конфигурации может быть аналогичным следующему:

	<configuration>
    	<appSettings>
      		<add key="StorageConnectionString" value="DefaultEndpointsProtocol=https;AccountName=storagesample;AccountKey=nYV0gln9fT7bvY+rxu2iWAEyzPNITGkhM88J8HUoyofpK7C8fHcZc2kIZp6cKgYRUM74lHI84L50Iau1+9hPjB==" />
    	</appSettings>
	</configuration>

Теперь все готово для выполнения задач, описанных в данном руководстве.

[connection-string1]: ./media/storage-configure-connection-string-include/connection-string1.png
[connection-string2]: ./media/storage-configure-connection-string-include/connection-string2.png
[connection-string3]: ./media/storage-configure-connection-string-include/connection-string3.png
[connection-string4]: ./media/storage-configure-connection-string-include/connection-string4.png
[connection-string5]: ./media/storage-configure-connection-string-include/connection-string5.png

[Configuring Connection Strings]: http://msdn.microsoft.com/library/azure/ee758697.aspx

<!---HONumber=July15_HO2-->