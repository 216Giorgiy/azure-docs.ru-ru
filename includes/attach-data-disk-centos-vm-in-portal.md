1. На [портале управления Azure](http://manage.windowsazure.com) щелкните **Виртуальные машины**, а затем выберите только что созданную виртуальную машину (**testlinuxvm**).
2. На панели команд нажмите кнопку **Присоединить**, а затем выберите **Присоединить пустой диск**.
   
    Откроется диалоговое окно **Присоединение пустого диска** .
3. Значения **Имя виртуальной машины**, **Расположение хранилища** и **Имя файла** уже определены. Достаточно ввести размер диска. Введите **5** в поле **Размер**.
   
    ![Присоединить пустой диск][Image2]
   
    **Примечание**. Все диски создаются из файла виртуального жесткого диска в хранилище Azure. Можно ввести имя для добавляемого в хранилище VHD-файла, однако Azure создаст имя диска автоматически.
4. Установите флажок, чтобы присоединить диск данных к виртуальной машине.
5. Щелкните имя виртуальной машины для отображения панели мониторинга. Это позволит убедиться, что диск данных был успешно присоединен к виртуальной машине. Присоединенный диск отображается в таблице **Диски**.
   
    Когда вы присоединяете диск данных, он не будет готов к использованию, пока вы не выполните вход и не завершите процесс настройки.

## <a name="connect-to-the-virtual-machine-using-ssh-or-putty-and-complete-setup"></a>Подключение к виртуальной машине с использованием SSH или PuTTY и полная настройка
Чтобы использовать диск для хранения данных, войдите в систему на виртуальной машине и завершите настройку диска.

1. После подготовки виртуальной машины подключитесь с использованием SSH или PuTTY и войдите в систему под именем **newuser** (как описано в шагах выше).    
2. В типе окна SSH или PuTTY введите следующую команду, а затем введите пароль данной учетной записи:
   
    `$ sudo grep SCSI /var/log/messages`
   
    Можно найти идентификатор последнего добавленного диска данных в отображаемых сообщениях (**sdc**в этом примере).
   
    ![GREP][Image4]
3. В окне SSH или PuTTY введите следующую команду для создания разделов на диске **/dev/sdc**:
   
    `$ sudo fdisk /dev/sdc`
4. Введите **n** для создания нового раздела.
   
    ![FDISK][Image5]
5. Введите **р**, чтобы сделать раздел основным, и **1**, чтобы сделать его первым разделом, а затем нажмите клавишу ВВОД, чтобы принять значение по умолчанию (1) для цилиндра.
   
    ![FDISK][Image6]
6. Введите **p** , чтобы просмотреть сведения о диске, на котором создаются разделы.
   
    ![FDISK][Image7]
7. Введите **w** , чтобы записать параметры данного диска.
   
    ![FDISK][Image8]
8. Отформатируйте новый диск при помощи команды **mkfs** :
   
    `$ sudo mkfs -t ext4 /dev/sdc1`
9. Далее необходимо подготовить каталог для подключения новой файловой системы. Например, введите следующую команду, чтобы создать каталог для монтирования диска, а затем введите пароль учетной записи:
   
    `sudo mkdir /datadrive`
10. Введите следующую команду, чтобы установить диск:
    
    `sudo mount /dev/sdc1 /datadrive`
    
    Диск данных теперь готов для использования как **/datadrive**.
11. Добавьте новый диск в /etc/fstab:
    
    Чтобы обеспечить автоматическую переустановку диска после перезагрузки, его необходимо добавить в файл /etc/fstab. Кроме того, для ссылки на диск настоятельно рекомендуется использовать идентификатор UUID (глобально уникальный идентификатор) в /etc/fstab, а не просто имя устройства (т. е. /dev/sdc1). Чтобы найти идентификатор UUID нового диска, можно использовать служебную программу **blkid**:
    
        `sudo -i blkid`
    
    Вывод будет выглядеть примерно следующим образом:
    
        `/dev/sda1: UUID="11111111-1b1b-1c1c-1d1d-1e1e1e1e1e1e" TYPE="ext4"`
        `/dev/sdb1: UUID="22222222-2b2b-2c2c-2d2d-2e2e2e2e2e2e" TYPE="ext4"`
        `/dev/sdc1: UUID="33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e" TYPE="ext4"`
    
    > [!NOTE]
    > Для blkid может не требоваться доступ sudo во всех случаях, однако может быть проще выполнить `sudo -i` на некоторых дистрибутивах, если/sbin или/usr/sbin не находятся в `$PATH`.
    > 
    > 
    
    **Внимание!** Некорректное изменение файла /etc/fstab может привести к проблемам с загрузкой системы. Если не уверены, обратитесь к документации дистрибутива за сведениями о том, как правильно изменить этот файл. Также рекомендуется перед внесением изменений создать резервную копию файла /etc/fstab.
    
    С помощью текстового редактора введите сведения о новой файловой системе в конце файла /etc/fstab.  В этом примере мы используем значение UUID для нового устройства **/dev/sdc1**, созданного в предыдущих шагах, и точку подключения **/datadrive**.
    
        `UUID=33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /datadrive   ext4   defaults   1   2`
    
    При создании дополнительных дисков данных и разделов нужно будет также ввести их в файл /etc/fstab отдельно.
    
    Теперь можно проверить, правильно ли подключена файловая система, просто отключив и повторно подключив файловую систему, т. е. используя типовую точку подключения `/datadrive`, созданную на предыдущих этапах: 
    
        `sudo umount /datadrive`
        `sudo mount /datadrive`
    
    Если вторая команда приводит к ошибке, проверьте правильность синтаксиса в файле /etc/fstab.

    >[AZURE.NOTE] Последующее удаление диска данных без редактирования fstab может привести к тому, что виртуальная машина не загрузится. Если это происходит часто, то большинство дистрибутивов предоставляют параметры fstab `nofail` и (или) `nobootwait`, которые позволяют системе загружаться, даже если диск отсутствует. Дополнительные сведения об этих параметрах можно найти в документации по вашему дистрибутиву.


[Image2]: ./media/attach-data-disk-centos-vm-in-portal/AttachDataDiskLinuxVM2.png
[Image4]: ./media/attach-data-disk-centos-vm-in-portal/GrepScsiMessages.png
[Image5]: ./media/attach-data-disk-centos-vm-in-portal/fdisk1.png
[Image6]: ./media/attach-data-disk-centos-vm-in-portal/fdisk2.png
[Image7]: ./media/attach-data-disk-centos-vm-in-portal/fdisk3.png
[Image8]: ./media/attach-data-disk-centos-vm-in-portal/fdisk4.png
[Image9]: ./media/attach-data-disk-centos-vm-in-portal/mkfs.png



<!--HONumber=Jan17_HO3-->


