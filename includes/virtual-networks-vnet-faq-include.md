## Основные сведения о виртуальных сетях

### Что представляет собой виртуальная сеть Azure?

С помощью виртуальной сети можно подготовить VPN к работе в Azure и управлять ею. Кроме того, при необходимости можно связать виртуальную сеть с другими виртуальными сетями в Azure или с локальной ИТ-инфраструктурой для создания гибридных или распределенных решений. Каждая создаваемая виртуальная сеть имеет собственный блок CIDR. Ее можно связать с другими виртуальными сетями и локальными сетями при условии отсутствия конфликтов между блоками CIDR. Кроме того, существуют средства для настройки DNS-серверов для работы в виртуальных сетях, а также для сегментации виртуальных сетей на подсети.

Вы можете использовать виртуальные сети для указанных ниже целей.

- Создание выделенной виртуальной сети, действующей в пределах частного облака
									
	Иногда для вашего решения не нужна распределенная конфигурация. При создании виртуальной сети подключенные к ней службы и виртуальные машины могут безопасно обмениваться данными непосредственно друг с другом в облаке. Это позволяет безопасно ограничить трафик пределами виртуальной сети. При этом в рамках вашего решения вы можете настроить подключения конечных точек для виртуальных машин и служб, которым необходимо подключение к Интернету.

- Безопасное расширение центра обработки данных
									
	С помощью виртуальных сетей можно создавать традиционные VPN типа "сеть-сеть" для безопасного масштабирования центра обработки данных. Для создания безопасного подключения между корпоративным VPN-шлюзом и Azure в VPN типа "сеть-сеть" используется IPsec.

- Поддержка сценариев гибридного облака
									
	Виртуальные сети предоставляют гибкие возможности для использования целого ряда сценариев гибридного облака. Вы можете безопасно подключать облачные приложения к локальным системам любого типа, например к большим ЭВМ и системам под управлением ОС Unix.

### Как узнать, требуется ли виртуальная сеть?

На странице [Общие сведения о виртуальных сетях](http://go.microsoft.com/fwlink/?LinkId=296649) есть таблица решений, с помощью которой можно подобрать лучший вариант сети.

### Как начать работу?

Чтобы начать работу, посетите страницу [Документация по виртуальным сетям](http://azure.microsoft.com/documentation/services/virtual-network/). На этой странице имеются ссылки на общие действия по настройке, а также сведения о том, что необходимо учесть при создании виртуальной сети.

### Какие службы можно использовать в виртуальных сетях?

Совместно с виртуальными сетями можно использовать самые разные службы Azure, например облачные службы (платформа как услуга), виртуальные машины и веб-приложения. Тем не менее, существует несколько служб, которые не поддерживаются в виртуальной сети. Прежде чем использовать какие-либо службы, убедитесь, что они совместимы с виртуальными сетями.

### Можно ли использовать виртуальные сети без распределенных подключений?

Да. Вы можете использовать виртуальную сеть без использования подключений типа "сеть-сеть". Это особенно удобно, если вы хотите запустить контроллеры доменов и фермы SharePoint в Azure.

## Настройка виртуальной сети

### Какие средства необходимо использовать для создания виртуальной сети?

Для создания или настройки виртуальной сети можно использовать указанные ниже средства.

- Портал управления. См. статью [Управление свойствами виртуальной сети](./virtual-networks-settings).

- Файл конфигурации сети (netcfg). См. статью [Настройка виртуальной сети с помощью файла конфигурации сети](./virtual-networks-using-network-configuration-file).

### Какие диапазоны адресов можно использовать в виртуальных сетях?

Можно использовать диапазоны общедоступных IP-адресов и любые диапазоны IP-адресов, определенные в документе [RFC 1918](http://tools.ietf.org/html/rfc1918).

### Можно ли в виртуальных сетях использовать общедоступные IP-адреса?

Да. Дополнительные сведения о диапазонах общедоступных IP-адресов см. в статье [Пространство общедоступных IP-адресов в виртуальной сети](./virtual-networks-public-ip-within-vnet). Имейте в виду, что ваши общедоступные IP-адреса не будут доступны непосредственно из Интернета.

### Существует ли ограничение на количество подсетей в виртуальной сети?

Ограничения на количество подсетей в виртуальной сети нет. Все подсети должны полностью содержаться в адресном пространстве виртуальной сети и не должны перекрываться друг с другом.

### Существуют ли ограничения на использование IP-адресов в пределах этих подсетей?

Azure резервирует некоторые IP-адреса в каждой подсети. Зарезервированы первый и последний IP-адреса подсетей (для соответствия требованиям протокола), а также еще два адреса, используемые для служб Azure.

### Насколько большими или малыми могут быть виртуальные сети и подсети?

Самая маленькая поддерживаемая подсеть — /29, а самая большая — /8 (согласно определениям подсети CIDR).

### Можно ли переносить виртуальные локальные сети в Azure с помощью виртуальных сетей?

Нет. Виртуальные сети представляют собой наложения Layer-3. Azure не поддерживает семантику Layer-2.

### Можно ли в виртуальных сетях и подсетях задавать настраиваемые политики маршрутизации?

Да. Вы можете использовать пользовательскую маршрутизацию. Дополнительные сведения о пользовательской маршрутизации см. в статье [Пользовательские маршруты и перенаправление IP-адресов](./virtual-networks-udr-overview).

### Поддерживают ли виртуальные сети технологии многоадресной или широковещательной рассылки?

Нет. Технологии многоадресной или широковещательной рассылки не поддерживаются.

### Какие протоколы можно использовать в рамках виртуальных сетей?

В виртуальных сетях можно использовать стандартные IP-протоколы. Тем не менее, в виртуальных сетях блокируются многоадресные и широковещательные рассылки, инкапсулированные пакеты IP-в-IP и пакеты, передаваемые по протоколу GRE. Ниже перечислены поддерживаемые стандартные протоколы.

- TCP
- UDP
- ICMP

### Можно ли в виртуальной сети проверять связь с маршрутизаторами по умолчанию?

№

### Можно ли использовать команду tracert для диагностики подключения?

№

### Можно ли добавлять подсети после создания виртуальной сети?

Да. Вы можете в любое время добавлять подсети в виртуальные сети при условии, что адрес добавляемой подсети не принадлежит другой подсети виртуальной сети.

### Можно ли изменить размер виртуальной сети после ее создания?

Вы можете добавлять, удалять, расширять или уменьшать подсеть (если в ней не развернуты виртуальные машины и службы) с помощью командлетов PowerShell или файла NETCFG. Кроме того, можно добавлять, удалять, расширять и уменьшать любые префиксы при условии, что такие изменения не влияют на подсети, содержащие виртуальные машины или службы.

### Можно ли изменять подсети после их создания?

Да. Вы можете добавлять, удалять и изменять блоки CIDR, используемые виртуальной сетью.

### Могут ли службы, работающие в виртуальной сети, подключиться к Интернету?

Да. Все службы, развернутые в виртуальной сети, могут подключаться к Интернету. У каждой облачной службы, развернутой в Azure, есть виртуальный IP-адрес. Чтобы эти службы могли принимать подключения из Интернета, необходимо определить входные конечные точки для ролей "платформа как услуга" и конечные точки для виртуальных машин.

### Поддерживают ли виртуальные сети протокол IPv6?

Нет. В настоящее время невозможно использовать протокол IPv6 в виртуальных сетях.

### Может ли виртуальная сеть охватывать несколько регионов?

Нет. Виртуальную сеть можно использовать только в пределах одного региона.

### Можно ли подключить виртуальную сеть к другой виртуальной сети в Azure?

Да. Вы можете организовать обмен данными между виртуальными сетями с помощью REST API или Windows PowerShell. См. статью [Настройка подключения между виртуальными сетями](./virtual-networks-configure-vnet-to-vnet-connection).

## Разрешение имен (DNS)

### Каковы параметры DNS для виртуальных сетей?

Все доступные параметры DNS имеются в таблице решений на странице [Разрешение имен для виртуальных машин и экземпляров ролей](https://msdn.microsoft.com/library/azure/jj156088.aspx).

### Можно ли указать DNS-серверы для виртуальной сети?

Да. Вы можете указать IP-адреса DNS-сервера в параметрах виртуальной сети. Он будет использоваться в качестве DNS-сервера по умолчанию для всех виртуальных машин в виртуальной сети.

### Сколько DNS-серверов можно указать?

Можно указать до 12 DNS-серверов.

### Можно ли изменять DNS-серверы после создания сети?

Да. Вы можете в любое время изменить список DNS-серверов для виртуальной сети. После изменения списка DNS-серверов необходимо перезапустить все виртуальные машины в виртуальной сети, чтобы они начали использовать параметры нового DNS-сервера.


### Что такое DNS, предоставленная Azure, и работает ли она с виртуальными сетями?

DNS, предоставленная Azure, — это мультитенантная служба DNS, предлагаемая корпорацией Майкрософт. Azure регистрирует все ваши виртуальные машины и экземпляры ролей в этой службе. Эта служба выполняет разрешение имен по имени узла для виртуальных машин и экземпляров ролей, содержащихся в одной и той же облачной службе, и по FQDN для виртуальных машин и экземпляров ролей в одной и той же виртуальной сети.

> [AZURE.NOTE]В настоящее время действует ограничение: если разрешение имен выполняется для нескольких клиентов с помощью DNS-серверов, предоставленных Azure, то оно выполняется только для первых 100 облачных служб в виртуальной сети. Если вы используете собственный DNS-сервер, то это ограничение не применяется.

### Можно ли переопределять параметры DNS для каждой виртуальной машины или службы?

Да. Чтобы переопределить параметры сети по умолчанию, можно задать DNS-серверы для каждой службы. Тем не менее, мы рекомендуем максимально широко использовать DNS уровня сети.

### Можно использовать собственный суффикс DNS?

Нет. Невозможно указать пользовательский суффикс DNS для виртуальных сетей.

## Виртуальные сети и виртуальные машины

### Можно ли развертывать виртуальные машины в виртуальной сети?

Да.

### Можно ли развертывать виртуальные машины Linux в виртуальной сети?

Да. Вы можете развернуть любой дистрибутив Linux, поддерживаемый Azure.

### Какова разница между общедоступным виртуальным IP-адресом и внутренним IP-адресом?

- Внутренний IP-адрес — это IP-адрес, назначаемый DHCP-сервером каждой виртуальной машине в виртуальной сети. Он не является общедоступным. Если вы создали виртуальную сеть, внутренний IP-адрес будет назначен из диапазона, указанного в параметрах подсети виртуальной сети. Если у вас нет виртуальной сети, то внутренний IP-адрес все равно будет назначен. Внутренний IP-адрес закрепляется за виртуальной машиной на протяжении всего времени ее существования до тех пор, пока она не будет освобождена.

- Общедоступный виртуальный IP-адрес — это общедоступный IP-адрес, назначенный вашей облачной службе или балансировщику нагрузки. Он не назначается непосредственно сетевой карте виртуальной машины. Виртуальный IP-адрес закрепляется за облачной службой, которой он назначен, до тех пор, пока все виртуальные машины в ней не будут освобождены или удалены. В этот момент он будет освобожден.

### Какой IP-адрес получит виртуальная машина?

- **Внутренний IP-адрес.** При развертывании виртуальной машины в виртуальной сети виртуальная машина получает внутренний IP-адрес из пула указанных вами внутренних IP-адресов. В виртуальных сетях виртуальные машины обмениваются данными друг с другом с помощью внутренних IP-адресов. Несмотря на то что Azure назначает динамический внутренний IP-адрес, можно запросить статический адрес для виртуальной машины. Дополнительные сведения о статических внутренних IP-адресах см. в статье [Настройка статического внутреннего частного IP-адреса](./virtual-networks-reserved-private-ip).

- **Виртуальный IP-адрес.** Виртуальная машина сопоставлена с виртуальным IP-адресом, хотя он никогда не назначается ей напрямую. Виртуальный IP-адрес — это общедоступный IP-адрес, который можно назначить облачной службе. При необходимости можно зарезервировать виртуальный IP-адрес для облачной службы. См. статью [Зарезервированный общедоступный IP-адрес](./virtual-networks-reserved-public-ip).

- **Общедоступный IP-адрес уровня экземпляра.** Вы можете настроить общедоступный IP-адрес уровня экземпляра. Общедоступные IP-адреса уровня экземпляра сопоставляются с виртуальной машиной, а не c облачной службой. Дополнительные сведения об общедоступных IP-адресах уровня экземпляра см. в статье [Общие сведения об общедоступных IP-адресах уровня экземпляра](./virtual-networks-instance-level-public-ip).

### Можно ли зарезервировать внутренний IP-адрес для виртуальной машины, которую собираюсь создать позже?

Нет. Зарезервировать внутренний IP-адрес невозможно. Если внутренний IP-адрес доступен, DHCP-сервер назначит его виртуальной машине или экземпляру роли. Это может быть не та виртуальная машина, которой вы хотели бы назначить определенный внутренний IP-адрес. Тем не менее, можно изменить внутренний IP-адрес уже созданной виртуальной машины на любой доступный внутренний IP-адрес.

### Изменяются ли внутренние IP адреса виртуальных машин в виртуальной сети?

Да. Внутренние IP-адреса закрепляются за виртуальной машиной на все время ее существования, пока она не будет освобождена. Если виртуальная машина освобождена, внутренний IP-адрес также будет освобожден, если только для виртуальной машины не задан статический IP-адрес. Если виртуальная машина просто остановлена и не переведена в состояние **Остановлена (Освобождена)**, то IP-адрес будет по-прежнему закреплен за ней.

### Можно ли вручную назначать IP-адреса сетевым картам виртуальных машин?

Нет. Изменять свойства интерфейсов виртуальных машин запрещено. Любые изменения могут привести к потере подключения к виртуальной машине.

### Что происходит с IP-адресами при выключении виртуальной машины?

Ничего. IP-адреса (общедоступные виртуальные IP-адреса и внутренние IP-адреса) останутся закрепленными за облачной службой или виртуальной машиной.

> [AZURE.NOTE]Если вы хотите просто завершить работу виртуальной машины, не используйте для этого портал управления. В настоящее время нажатие кнопки завершения работы приводит к освобождению виртуальной машины.

### Можно ли перемещать виртуальные машины между подсетями виртуальной сети без повторного развертывания?

Да. Дополнительные сведения см. [здесь](./virtual-networks-move-vm-role-to-subnet).

### Можно ли настроить статический MAC-адрес для виртуальной машины?

Нет. Настроить MAC-адрес статически невозможно.

### Остается ли MAC-адрес виртуальной машины неизменным после ее создания?

Нет. MAC-адрес виртуальной машины может быть изменен по различным причинам. Если виртуальная машина переведена в состояние "Остановлена" ("Освобождена"), то при изменении ее размера, восстановлении работоспособности службы или плановом обслуживании хост-сервера MAC-адрес не будет сохранен.

### Можно ли подключиться к Интернету из виртуальной машины, находящейся в виртуальной сети?

Да. Все службы, развернутые в виртуальной сети, могут подключаться к Интернету. Кроме того, каждой облачной службе, развернутой в Azure, назначен общедоступный виртуальный IP-адрес. Чтобы эти службы могли принимать подключения из Интернета, необходимо определить входные конечные точки ролей "платформа как услуга" и конечные точки для виртуальных машин.

## Виртуальные сети и службы

### Какие службы можно использовать в виртуальных сетях?

В виртуальных сетях можно использовать только службы вычислений. Службы вычислений ограничены облачными службами (рабочая и веб-роль) и виртуальными машинами.

### Можно ли использовать веб-приложения совместно с виртуальной сетью?

Нет. Развернуть веб-приложение Azure в виртуальной сети невозможно. Тем не менее, веб-приложения могут безопасно подключаться к виртуальной сети Azure и получать доступ к ее ресурсам, если для нее настроено подключение типа "точка-сеть". Дополнительные сведения см. в следующих разделах.

- [Интеграция виртуальной сети веб-сайтов Azure](http://azure.microsoft.com/blog/2014/09/15/azure-websites-virtual-network-integration/)

- [Использование интеграции виртуальной сети и гибридных подключений с веб-приложениями](http://azure.microsoft.com/blog/2014/10/30/using-vnet-or-hybrid-conn-with-websites/)

- [Интеграция веб-приложения с виртуальной сетью Azure](./web-sites-integrate-with-vnet)


### Можно ли развернуть облачные службы с веб-ролями и рабочими ролями (платформа как услуга) в виртуальной сети?

Да. Вы можете развертывать службы модели "платформа как услуга" в виртуальных сетях.

### Как развертывать роли "платформа как услуга" в виртуальной сети?

Это можно сделать, указав имя виртуальной сети и сопоставления роли или подсети в разделе конфигурации сети в конфигурации службы. Не нужно обновлять никакие двоичные файлы.

### Можно ли перемещать службы в виртуальные сети и из них?

Нет. Невозможно перемещать службы в виртуальные сети и из них. Чтобы переместить службу в другую виртуальную сеть, потребуется удалить ее, а затем повторно развернуть.

## Виртуальные сети и безопасность

### Какова модель безопасности для виртуальных сетей?

Виртуальные сети полностью изолированы друг от друга и от других служб, размещенных в инфраструктуре Azure. Виртуальная сеть — это граница доверия.

### Можно ли задать ACL или NSG в виртуальных сетях?

Нет. Невозможно сопоставить ACL или NSG с виртуальными сетями. Тем не менее, можно задать ACL на входных конечных точках для виртуальных машин, развернутых в виртуальных сетях, и сопоставить NSG с подсетями или сетевыми картами.

### Существует ли технический документ, посвященный вопросам безопасности виртуальных сетей?

Да. Его можно скачать [здесь](http://go.microsoft.com/fwlink/?LinkId=386611).

## API-интерфейсы, схемы и средства

### Можно ли управлять виртуальными сетями из кода?

Да. Для управления виртуальными сетями и распределенными подключениями можно использовать REST API. Дополнительную информацию см. [здесь](http://go.microsoft.com/fwlink/?LinkId=296833).

### Существуют ли специальные программные средства для работы с виртуальными сетями?

Да. Вы можете использовать PowerShell и средства командной строки для различных платформ. Дополнительную информацию см. [здесь](http://go.microsoft.com/fwlink/?LinkId=317721).

<!---HONumber=July15_HO3-->