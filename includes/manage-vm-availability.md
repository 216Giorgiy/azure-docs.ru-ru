<properties writer="kathydav" editor="tysonn" manager="jeffreyg" /> 

#Управление доступностью виртуальных машин#

Чтобы обеспечить доступность приложения, настоятельно рекомендуется использовать несколько виртуальных машин, что обеспечит избыточность. Для обеспечения избыточности настройте несколько виртуальных машин для выполнения одной и той же функции или роли. Такая избыточность нужна, чтобы получить гарантированный уровень обслуживания. Также необходимо принять во внимание зависимости. Например, если виртуальная машина "IIS1" зависит от служб, предоставляемых виртуальной машиной "SQL1", избыточность для виртуальной машины "SQL1" обеспечивается "SQL2", чтобы избежать перерывов в обслуживании. Дополнительные сведения о соглашениях об уровне обслуживания см. в разделе "Облачные службы, виртуальные машины и виртуальные сети" в [Соглашении об уровне обслуживания](http://www.windowsazure.com/ru-ru/support/legal/sla/)

Такой подход обеспечивает, что ваше приложение остается доступным во время сбоев локальной сети или локальных жестких дисков, а также при плановых простоях, которые могут понадобиться платформе.

Вы управляете доступностью приложения, использующего несколько виртуальных машин, добавляя виртуальные машины к группе доступности. Группы доступности напрямую связаны с доменами сбоя и доменами обновления. Домен сбоя в Azure определяется избеганием одиночных точек отказа, таких как сетевой коммутатор или единица управления питанием стойки серверов. По сути, домен сбоя — близкий эквивалентно стойки физических серверов. При подключении нескольких виртуальных машин к облачной службе, группа доступности размещает виртуальные машины в различные домены сбоев. На следующей диаграмме показаны две группы доступности с двумя виртуальными машинами в каждой группе.

![Домены обновления](./media/manage-vm-availability/UpdateDomains.png)

Azure периодически обновляет операционную систему, где размещены экземпляры приложения. При применении обновления работа виртуальной машины завершается. Домен обновления используется, чтобы обеспечить, что не все экземпляры виртуальной машины обновляются одновременно. При назначении в группу доступности нескольких виртуальных машин, Azure обеспечивает, что компьютеры назначаются различным доменам обновления. На предыдущей схеме показаны два виртуальных машины, выполняющие Internet Information Services (IIS) в раздельных доменах обновления, и две виртуальные машины, работающие с SQL Server, также в раздельных доменах обновления.

Чтобы обеспечить, что приложение всегда будет доступно и работает эффективно, следует использовать сочетание групп доступности и балансировку нагрузки конечных точек. Дополнительные сведения о балансировке нагрузки конечных точек см. в разделе [Балансировка нагрузки виртуальных машин] [].

Эта задача включает следующие шаги:

- [Шаг 1. Создайте виртуальную машину и группу доступности] []
- [Шаг 2. Добавьте виртуальную машину в облачную службу и назначьте ее к группе доступности во время процесса создания] []
- [Шаг 3 (необязательно). Создайте группу доступности для ранее созданных виртуальных машин] []
- [Шаг 4 (необязательно). Добавьте ранее созданную виртуальную машину в группу доступности] []

## <a id="createset"> </a>Шаг 1. Создайте виртуальную машину и группу доступности ##

Для создания группы доступности, которая содержит виртуальные машины, можно одновременно создать первую виртуальную машину и группу доступности, а затем добавлять виртуальные машины в группу доступностью, после их создания. Можно также создать виртуальные машины, создать группу доступности и добавить все машины в группу.

**Для создания виртуальной машины и группы доступности**

1. Войдите на портал управления Azure, если вы еще этого не сделали.

2. На панели команд нажмите **Создать**.

	![Создание виртуальной машины](./media/manage-vm-availability/Create.png)

3. Нажмите **Виртуальная машина** и **Из коллекции**.


	Появится диалоговое окно **Выберите операционную систему для виртуальной машины**. 
	
4. Выберите изображение на странице **Образы платформы** и нажмите стрелку, чтобы продолжить.

	Откроется диалоговое окно **Конфигурация виртуальной машины**.

5. В поле **Имя виртуальной машины** введите имя, которое вы хотите использовать для виртуальной машины.

6. В поле **Новое имя пользователя** введите имя учетной записи администратора, которую требуется использовать для управления сервером. 

7. В поле **Новый пароль** введите надежный пароль для учетной записи администратора. В поле **Подтвердите пароль**, повторно введите пароль, введенные ранее.

8. В поле **Размер** выберите размер, который вы хотите использовать для виртуальной машины. Выбранный размер зависит от числа ядер, которые необходимы для приложения.

9. Щелкните стрелку для продолжения.

	Откроется диалоговое окно **Режим виртуальной машины**.
	
10. Выберите режим **Автономная виртуальная машина**.

11.	В поле **DNS-имя** введите имя для облачной службы, созданной для данной машины. Имя может содержать от 3 до 24 строчных букв нижнего регистра и цифр.

12.	В поле **Учетная запись хранения** выберите учетную запись хранения, где хранится VHD-файл, или выберите автоматическое создание учетной записи хранения. Автоматически будет создана только одна учетная запись хранения для одного региона. Все остальные виртуальные машины, созданные с помощью этого параметра, находятся в этой учетной записи хранения. Вы можете иметь не более 20 учетных записей хранения.

13.	В поле **Регион/Территориальная группа/Виртуальная сеть** выберите регион, территориальную группу или виртуальную сеть, которые требуется использовать для виртуальной машины. Дополнительные сведения о территориальных группах см. в разделе [О территориальных группах для виртуальной сети] [].

14. Щелкните стрелку для продолжения.

	Откроется диалоговое окно **Параметры виртуальной машины**.

15. В поле **Группа доступности** выберите **Создать группу доступности**.
 
16. В поле **Имя группы доступности** введите имя для группы доступности.

17.	Щелкните стрелку, чтобы создать виртуальную машину и группу доступности.

	Из панели мониторинга новой виртуальной машины щелкните **Настройки** и вы увидите, что виртуальная машина является членом новой группы доступности.

## <a id="addmachine"> </a>Шаг 2. Добавьте виртуальную машину в облачную службу и назначьте ее к группе доступности во время процесса создания ##

В предыдущем шаге показано, как одновременно создать виртуальную машину и группу доступности. Теперь можно создать новую виртуальную машину, подключить ее к облачной службе первой виртуальной машины и добавить в ранее созданную группу доступности.

**Для подключения новой виртуальной машины и добавления ее в группу доступности**

1. Войдите на портал управления Azure, если вы еще этого не сделали.

2. На панели команд нажмите **Создать**.

	![Создание виртуальной машины](./media/manage-vm-availability/Create.png)

3. Щелкните **Виртуальная машина** и **Из коллекции**.

	![Создание из коллекции](./media/manage-vm-availability/CreateNew.png)

	Появится диалоговое окно **Выберите операционную систему для виртуальной машины**. Теперь можно выбрать изображение из коллекции изображений.

	
4. Нажмите **Образы платформы** и выберите образ платформы, который вы хотите использовать, затем нажмите стрелку, чтобы продолжить.

	Откроется диалоговое окно **Конфигурация виртуальной машины**.

5. В поле **Имя виртуальной машины** введите имя, которое вы хотите использовать для виртуальной машины.

6. 6. В поле **Новое имя пользователя** введите имя учетной записи администратора, которую требуется использовать для управления сервером. 

7. В поле **Новый пароль** введите надежный пароль для учетной записи администратора на виртуальной машине. В поле **Подтвердите пароль** введите пароль еще раз.

8. В поле **Размер** выберите размер, который вы хотите использовать для виртуальной машины. Выбранный размер зависит от числа ядер, которые необходимы для приложения.

9. Виртуальную машину под управлением операционной системы Linux можно защитить с помощью ключа SSH.

10.	Щелкните стрелку для продолжения.

	Откроется диалоговое окно **Режим виртуальной машины**.

	
11. Выберите **Подключиться к существующей виртуальной машине** для создания новой виртуальной машины, которая будет связана с первой виртуальной машиной в группе доступности.  Выберите облачную службу, которая содержит виртуальную машину в группе доступности.

12. В поле **Учетная запись хранения** выберите учетную запись хранения, где хранится файл VHD.

13. В поле **Регион, территориальная группа, виртуальная сеть** выберите регион, где будет располагаться виртуальная машина.

14. Щелкните стрелку для продолжения.

	Откроется диалоговое окно **Параметры виртуальной машины**.

15. Выберите группу доступности, которая была создана при создании первой виртуальной машины.

16. Снимите флажок, чтобы создать связанную виртуальную машину и добавьте ее в группу доступности.

	Из панели мониторинга новой виртуальной машины щелкните **Настройки** и вы увидите, что виртуальная машина является членом новой группы доступности.

## <a id="previousmachine"> </a>Шаг 3 (необязательно). Создайте группу доступности для ранее созданных виртуальных машин ##

Можно также создать группу доступности и добавлять в нее виртуальные машины после их создания. После создания виртуальной машины можно настроить размер машины и то, является ли она членом группы доступности.

**Для создания новой группы доступности**

1. Войдите на портал управления Azure, если вы еще этого не сделали.

2. Нажмите кнопку **Виртуальные машины**, а затем выберите виртуальную машину, которую требуется настроить.

3. Нажмите **Настроить**.

4. В поле **Группа доступности** выберите **Создать группу доступности**, а затем введите имя для группы.


5. Щелкните **Сохранить**.

	**Примечание.** Это может привести к перезагрузке виртуальной машины для утверждения ее членства в группе доступности. 

## <a id="existingset"> </a>Шаг 4 (необязательно). Добавьте ранее созданную виртуальную машину в группу доступности ##

Можно легко добавить существующую виртуальную машину к группе доступности, созданной ранее. Чтобы добавить виртуальную машину к группе доступности, она должна быть подключена к той же облачной службе, что и другие виртуальные машины из группы. Дополнительные сведения о подключении виртуальных машин см. в разделе [Подключение виртуальных машин в облачной службе] [].

**Добавление существующей виртуальной машины к группе доступности**

1. Войдите на портал управления Azure, если вы еще этого не сделали.

2. Нажмите **Виртуальные машины** и выберите виртуальную машину, которую требуется присоединить к группе доступности.

3. Нажмите **Настроить**.

4. В роле **Группа доступности** выберите ранее созданную группу доступности.

5. Щелкните **Сохранить**. 

	**Примечание.** Это может привести к перезагрузке виртуальной машины для утверждения ее членства в группе доступности.


[Шаг 1. Создайте виртуальную машину и группу доступности]: #createset
[Шаг 2. Добавьте виртуальную машину в облачную службу и назначьте ее к группе доступности во время процесса создания]: #addmachine
[Шаг 3 (необязательно). Создайте группу доступности для ранее созданных виртуальных машин]: #previousmachine
[Шаг 4 (необязательно). Добавьте ранее созданную виртуальную машину в группу доступности]: #existingset


<!-- LINKS -->
[Балансировка нагрузки виртуальных машин]: ../load-balance-virtual-machines
[О территориальных группах для виртуальной сети]: http://msdn.microsoft.com/library/windowsazure/jj156085.aspx
[Подключение виртуальных машин в облачной службе]: ../virtual-machines-connect-cloud-service

