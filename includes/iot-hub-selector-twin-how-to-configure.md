> [!div class="op_single_selector"]
> * [Node.js](../articles/iot-hub/iot-hub-node-node-twin-how-to-configure.md)
> * [C#](../articles/iot-hub/iot-hub-csharp-node-twin-how-to-configure.md)
> 
> 

## <a name="introduction"></a>Введение
Изучив руководство [Приступая к работе с двойниками устройств (предварительная версия)][lnk-twin-tutorial], вы узнали, как задать метаданные устройства в серверной части решения с помощью *тегов*, сообщить об условиях устройства из приложения устройства с помощью *сообщаемых свойств* и запросить эти сведения с помощью языка запросов, аналогичного SQL.

В этом руководстве представлены сведения об удаленной настройке приложений устройства с помощью *требуемых свойств* и *сообщаемых свойств* двойника устройства. В частности, здесь показано, как на основе требуемых и сообщаемых свойств двойника устройства реализовать многошаговую настройку параметров приложения устройства, а также обеспечить полную видимость состояния этой операции на всех устройствах в серверной части решения.

В общем управление устройством в этом руководстве осуществляется на основе *шаблона требуемого состояния*. Основная идея этого шаблона заключается в создании серверной части решения и определении требуемого состояния для управляемых устройств вместо отправки определенных команд. Таким образом, устройство может определять оптимальный способ достижения требуемого состояния (это особенно важно в сценариях Интернета вещей, где определенные условия устройства влияют на возможность мгновенно выполнять некоторые команды), а также постоянно отправлять отчеты о текущем состоянии и возможные условия возникновения ошибки в серверную часть. Шаблон требуемого состояния играет важную роль в управлении большими наборами устройств, так как он обеспечивает для серверной части полную видимость состояния процесса настройки на всех устройствах.
Дополнительные сведения о роли шаблона требуемого состояния в управлении устройством см. в статье [Общие сведения об управлении устройствами с помощью Центра Интернета вещей (предварительная версия)][lnk-dm-overview].

> [!NOTE]
> В сценариях, где управление устройствами осуществляется в интерактивном режиме (включение вентилятора с помощью пользовательского приложения), используйте [прямые методы][lnk-methods].
> 
> 

В этом руководстве серверная часть приложения изменяет конфигурацию телеметрии целевого устройства, в результате чего приложение устройства выполняет многошаговый процесс для применения обновлений конфигурации (например, принудительная перезагрузка модуля приложения, которая в этом руководстве выполняется с небольшой задержкой).

Серверная часть сохраняет конфигурацию в требуемых свойствах двойника устройства следующим образом.

        {
            ...
            "properties": {
                ...
                "desired": {
                    "telemetryConfig": {
                        "configId": "{id of the configuration}",
                        "sendFrequency": "{config}"
                    }
                }
                ...
            }
            ...
        }

> [!NOTE]
> Так как конфигурации могут быть сложными объектами, обычно им назначаются уникальные идентификаторы (хэши или [идентификаторы GUID][lnk-guid]). Это позволяет упростить их сравнение.
> 
> 

Приложение устройства сообщает о своей текущей конфигурации, отображая требуемое свойство **telemetryConfig** в сообщаемых свойствах.

        {
            "properties": {
                ...
                "reported": {
                    "telemetryConfig": {
                        "changeId": "{id of the current configuration}",
                        "sendFrequency": "{current configuration}",
                        "status": "Success",
                    }
                }
                ...
            }
        }

Обратите внимание, что свойство **telemetryConfig** имеет дополнительное свойство **status**, используемое для сообщения состояния процесса обновления конфигурации.

Получив новую требуемую конфигурацию, приложение устройства сообщает об ожидающей конфигурации, изменяя определенные сведения.

        {
            "properties": {
                ...
                "reported": {
                    "telemetryConfig": {
                        "changeId": "{id of the current configuration}",
                        "sendFrequency": "{current configuration}",
                        "status": "Pending",
                        "pendingConfig": {
                            "changeId": "{id of the pending configuration}",
                            "sendFrequency": "{pending configuration}"
                        }
                    }
                }
                ...
            }
        }

Через некоторое время приложение устройства сообщит об успешном выполнении или сбое этой операции, обновив свойство выше.
Обратите внимание, что серверная часть может в любое время запросить состояние процесса конфигурации на всех устройствах.

В этом учебнике описаны следующие процедуры.

* создание имитированного устройства, которое получает обновления конфигурации из серверной части и сообщает о нескольких обновлениях как о *сообщаемых свойствах* в процессе обновления конфигурации;
* создание внутреннего приложения, которое обновляет требуемую конфигурацию устройства, а затем запрашивает процесс обновления конфигурации.

<!-- links -->

[lnk-methods]: ../articles/iot-hub/iot-hub-devguide-direct-methods.md
[lnk-dm-overview]: ../articles/iot-hub/iot-hub-device-management-overview.md
[lnk-twin-tutorial]: ../articles/iot-hub/iot-hub-node-node-twin-getstarted.md
[lnk-guid]: https://en.wikipedia.org/wiki/Globally_unique_identifier

<!--HONumber=Nov16_HO3-->


