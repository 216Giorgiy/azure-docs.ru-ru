#Как присоединить диск данных к виртуальной машине




- [Основные понятия](#concepts)
- [Инструкция. Присоединение существующего диска](#attachexisting)
- [Инструкция. Присоединение пустого диска](#attachempty)
- [Инструкция. Инициализация нового диска данных в Windows Server 2008 R2](#initializeinWS)
- [Инструкция. Инициализация нового диска данных в Linux](#initializeinlinux)



##<a id="concepts"></a>Основные понятия



Вы также можете присоединить к виртуальной машине диск данных для хранения данных приложения. Диск данных является виртуальным жестким диском (VHD), который можно создать в облаке с помощью Windows Azure или локально с собственного компьютера. Дисками данных на виртуальной машине можно управлять точно так же, как на сервере в вашем офисе.

Портал управления можно использовать для загрузки и присоединения к виртуальной машине диска данных, а также для добавления пустого диска из той же учетной записи хранения, которую использует виртуальная машина. В данной статье описываются эти процессы. Чтобы присоединить пустой диск, расположенный в другой учетной записи хранения, используйте командлет [Добавить AzureDataDisk](http://go.microsoft.com/fwlink/p/?LinkId=391661), доступный в модуле Windows Azure PowerShell. Чтобы загрузить модуль, см. страницу [Загрузки](http://www.windowsazure.com/ru-ru/downloads/).

Чтобы добавить диск на виртуальную машину, ее не нужно останавливать. Количество дисков, которые можно присоединить к виртуальной, основано на размере виртуальной машины. Дополнительные сведения о виртуальной машине и размерах дисков см. в разделе [Размеры виртуальных машин для Windows Azure](http://go.microsoft.com/FWLink/p/?LinkID=294683).

> [WACOM.NOTE] 
> Хранилище Windows Azure поддерживает BLOB-объекты размером до 1 ТБ, что позволяет разместить VHD-файл с виртуальным размером не более 999 ГБ. Однако, если для создания нового виртуального жесткого диска используется Hyper-V, указанный вами размер представляет виртуальный размер. Чтобы использовать VHD в Windows Azure, укажите размер не более 999 ГБ.

**Диск данных и диск ресурсов**  
Диски данных хранятся в хранилище Windows Azure и могут использоваться для постоянного хранения файлов и данных приложений.

Каждая виртуальная машина также имеет присоединенный временный локальный *Диск ресурсов*. Так как данные на диске ресурсов могут плохо переносить перезагрузки, его часто используют приложения и процессы, выполняющиеся на виртуальной машине, для временного хранения данных. Он также используется для хранения страниц или замены файлов операционной системы.

В системе Windows диск ресурсов помечается как диск **D:**.  В системе Linux диск ресурсов обычно управляется агентом Linux Windows Azure, и он автоматически подключается к **/mnt/resource** (или **/mnt** на образах Ubuntu). Дополнительные сведения см. в [руководстве пользователя агента Linux Windows Azure](http://www.windowsazure.com/ru-ru/manage/linux/how-to-guides/linux-agent-guide/).

Дополнительные сведения об использовании дисков данных см. в разделе [Управление дисками и образами](http://go.microsoft.com/fwlink/p/?LinkId=391660).

##<a id="attachexisting"></a>Инструкция. Присоединение существующего диска


1. Войдите на [портал управления Windows Azure](http://manage.windowsazure.com), если вы еще этого не сделали.

2. Нажмите кнопку **Виртуальные машины**, а затем выберите виртуальную машину, к которой требуется присоединить диск.

3. На панели команд нажмите кнопку **Присоединить**, а затем выберите **Присоединить диск**.


	![Присоединение диска данных](./media/howto-attach-disk-window-linux/AttachExistingDiskWindows.png)

	Откроется диалоговое окно **Присоединить диск**.



	![Введите сведения о диске данных](./media/howto-attach-disk-window-linux/AttachExistingDisk.png)

3. Выберите диск данных, который требуется присоединить к виртуальной машине.
4. Установите флажок, чтобы присоединить диск данных к виртуальной машине.
  
 
	Диск данных отобразится в списке на панели мониторинга виртуальной машины.


	![Диск данных успешно подключен](./media/howto-attach-disk-window-linux/AttachSuccess.png)

##<a id="attachempty"></a>Инструкция. Присоединение пустого диска

После создания и загрузки VHD-файла для использования в качестве пустого диска его можно присоединить к виртуальной машине. Для загрузки VHD-файла учетной записи хранения используйте командлет [Добавить AzureVhd](http://go.microsoft.com/FWLink/p/?LinkID=391684).  

1. Нажмите кнопку **Виртуальные машины** и выберите виртуальную машину, к которой требуется присоединить диск данных.



2. На панели команд нажмите **Присоединить** и выберите **Присоединить пустой диск**.


	![Присоединить пустой диск](./media/howto-attach-disk-window-linux/AttachDiskWindows.png)



	Откроется диалоговое окно **Присоединение пустого диска**.



	![Присоединить новый пустой диск](./media/howto-attach-disk-window-linux/AttachNewDiskWindows.png)

 
3. В поле **имя файла** примите автоматически созданное имя или введите имя, которое требуется использовать для файла VHD, который хранится. Диск данных, который создается из файла VHD, всегда использует автоматически созданное имя.



4. В поле **размер** введите размер диска данных. 



5. Установите флажок, чтобы присоединить пустой диск данных.

	Диск данных отобразится в списке на панели мониторинга виртуальной машины.


	![Пустой диск данных успешно подключен](./media/howto-attach-disk-window-linux/AttachEmptySuccess.png)


> [WACOM.NOTE] 
> После добавления диска данных необходимо войти в систему на виртуальной машине и инициализировать диск, чтобы виртуальная машина могла использовать его для хранения данных.



##<a id="initializeinWS"></a>Инструкция. Инициализация нового диска данных в Windows Server

1. Подключитесь к виртуальной машине, выполнив действия, описанные в разделе [Как войти в систему на виртуальной машине, работающей под управлением Windows Server][logon].



2. После входа в систему откройте **Диспетчер сервера**, на левой панели разверните вкладку **Хранилище** и нажмите кнопку **Управление дисками**.



	![Откройте диспетчер сервера.](./media/howto-attach-disk-window-linux/ServerManager.png)



3. Щелкните правой кнопкой мыши **Диск 2** и щелкните **Инициализировать диск**.



	![Инициализировать диск](./media/howto-attach-disk-window-linux/InitializeDisk.png)

4. Щелкните **ОК** для начала процесса инициализации.



5. Щелкните правой кнопкой мыши область выделения места на диске 2, нажмите кнопку **Создать простой том**, а затем завершите работу мастера со значениями по умолчанию.
 

	![Инициализация тома](./media/howto-attach-disk-window-linux/InitializeDiskVolume.png)



	Диск подключен и готов для использования с новой буквой диска.



	![Том успешно инициализирован](./media/howto-attach-disk-window-linux/InitializeSuccess.png)




##<a id="initializeinlinux"></a>Инструкция. Инициализация нового диска данных в Linux



1. Подключитесь к виртуальной машине, выполнив действия, описанные в разделе [Как войти в систему на виртуальной машине, работающей под управлением Linux][logonlinux].



2. В окне SSH введите следующую команду, а затем введите пароль для учетной записи, которую вы создали для управления виртуальной машиной:

	`sudo grep SCSI /var/log/messages`

	Идентификатор последнего добавленного диска данных можно найти в отображаемых сообщениях.



	![Получение сообщений диска](./media/howto-attach-disk-window-linux/DiskMessages.png)



3. В окне SSH введите следующую команду для создания нового устройства, а затем введите пароль учетной записи:

	`sudo fdisk /dev/sdc`



4. Введите **n** для создания нового раздела.


	![Создание нового устройства](./media/howto-attach-disk-window-linux/DiskPartition.png)

5. Введите **p**, чтобы сделать раздел основным, введите **1**, чтобы сделать его первым разделом, а затем нажмите клавишу ВВОД, чтобы принять значение по умолчанию для цилиндра.


	![Создание раздела](./media/howto-attach-disk-window-linux/DiskCylinder.png)



6. Введите **p**, чтобы просмотреть сведения о диске, на котором создаются разделы.


	![Просмотр сведений о диске](./media/howto-attach-disk-window-linux/DiskInfo.png)



7. Введите **w**, чтобы записать параметры данного диска.


	![Запись изменений на диске](./media/howto-attach-disk-window-linux/DiskWrite.png)

8. Необходимо создать файловую систему в новом разделе. Введите следующую команду для создания файловой системы, а затем введите пароль учетной записи:

	`sudo mkfs -t ext4 /dev/sdc1`


	![Создание файловой системы](./media/howto-attach-disk-window-linux/DiskFileSystem.png)

9. Введите следующую команду, чтобы создать каталог для монтирования диска, а затем введите пароль учетной записи:

	`sudo mkdir /mnt/datadrive`



10. Введите следующую команду, чтобы установить диск:

	`sudo mount /dev/sdc1 /mnt/datadrive`

	Диск данных теперь готов для использования как **/mnt/datadrive**.



11. Добавьте новый диск в /etc/fstab:

	Чтобы обеспечить автоматическую переустановку диска после перезагрузки, его необходимо добавить в файл /etc/fstab. Кроме того, для ссылки на диск настоятельно рекомендуется использовать идентификатор UUID (глобально уникальный идентификатор) в /etc/fstab, а не просто имя устройства (т. е. /dev/sdc1). Чтобы найти идентификатор UUID нового диска, можно использовать программу **blkid**:
	
	`sudo -i blkid`

	Вывод будет выглядеть примерно следующим образом:

		`/dev/sda1: UUID="11111111-1b1b-1c1c-1d1d-1e1e1e1e1e1e" TYPE="ext4"`
		`/dev/sdb1: UUID="22222222-2b2b-2c2c-2d2d-2e2e2e2e2e2e" TYPE="ext4"`
		`/dev/sdc1: UUID="33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e" TYPE="ext4"`

	>[WACOM.NOTE] Программе blkid может не требоваться доступ sudo во всех случаях; однако на некоторых дистрибутивах может быть проще выполнить "sudo -i", если /sbin и/или /usr/sbin не в вашем $PATH.

	**Внимание!** Неправильное редактирование файла /etc/fstab может привести к невозможности загрузить систему. Если не уверены, обратитесь к документации дистрибутива за сведениями о том, как правильно изменить этот файл. Также рекомендуется перед внесением изменений создать резервную копию файла /etc/fstab.

	С помощью текстового редактора введите сведения о новой файловой системе в конце файла /etc/fstab.  В этом примере мы используем значение UUID для нового устройства **/dev/sdc1**, созданного в предыдущих шагах, и точку установки **/mnt/datadrive**:

	`UUID=33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e    /mnt/datadrive    ext4    defaults    1    1`

	При создании дополнительных дисков данных и разделов нужно будет также ввести их в файл /etc/fstab.

	Теперь можно проверить, правильно ли установлена файловая система, просто отключив и повторно установив файловую систему, т. е. используя типовую точку установки "/mnt/datadrive", созданную на предыдущих этапах: 

		`sudo umount /mnt/datadrive`
		`sudo mount /mnt/datadrive`

	Если вторая команда приводит к ошибке, проверьте правильность синтаксиса в файле /etc/fstab.





[logon]: ../virtual-machines-log-on-windows-server/
[logonlinux]: ../virtual-machines-linux-how-to-log-on/



