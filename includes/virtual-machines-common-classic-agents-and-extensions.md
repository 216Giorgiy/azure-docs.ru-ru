



Расширения ВМ можно использовать в следующих целях.

-   Изменение функций безопасности и идентификации, в том числе сброс значений учетных записей и использование защиты от вредоносных программ.
-   Запуск, остановка и настройка функций мониторинга и диагностики.
-   Сброс или установка функций подключения, например RDP и SSH.
-   Диагностика и мониторинг виртуальных машин, а также управление ими.

Существует и множество других функций расширения виртуальной машины, ассортимент которых регулярно пополняется. В этой статье описываются агенты виртуальной машины Azure для Windows и Linux, а также их поддержка работы расширений виртуальных машин. Список расширений VM, в котором указаны категории компонентов, приводится в статье [Расширения и компоненты виртуальной машины Azure](../articles/virtual-machines/virtual-machines-windows-extensions-features.md).

##Агенты виртуальной машины Azure для Windows и Linux

Агент виртуальной машины Azure (агент ВМ) — это защищенный и нетребовательный к ресурсам процесс, который устанавливает, настраивает и удаляет расширения ВМ на экземплярах виртуальных машин Azure из коллекции образов и на пользовательских экземплярах виртуальных машин при наличии установленного агента ВМ. Агент ВМ выполняет роль локальной службы безопасности виртуальной машины Azure. Расширения, которые загружает агент, отвечают за определенные функции для повышения производительности во время работы экземпляра.

Существует два агента ВМ Azure: для виртуальных машин Windows и для виртуальных машин Linux. По умолчанию агент виртуальной машины устанавливается автоматически при создании виртуальной машины из коллекции образов, но вы можете установить его и после создания экземпляра. Кроме того, вы можете установить агент виртуальной машины в настраиваемом образе виртуальной машины и самостоятельно передать этот образ на сервер.

>[AZURE.IMPORTANT] Агенты виртуальной машины представляют собой очень простые службы, обеспечивающие защищенное администрирование экземпляров виртуальных машин. Возможны ситуации, в которых вы захотите отключить агент виртуальной машины. В этом случае вам следует создать виртуальную машину, в которой не установлен агент ВМ. Агент ВМ можно удалить физически, но при этом реакция на события расширений ВМ на этом экземпляре будет неопределенной. Поэтому в настоящее время удаление агента виртуальной машины после его установки не поддерживается.

Агент ВМ включается в следующих ситуациях.

-   Когда вы создаете экземпляр виртуальной машины на классическом портале Azure с помощью метода **Быстрое создание** или метода **Настраиваемое создание** и ставите флажок **Установить агент ВМ** (как показано на рисунке ниже). Дополнительные сведения см. в статье [Создание настраиваемой виртуальной машины](../articles/virtual-machines/virtual-machines-windows-classic-createportal.md).

    ![Флажок агента ВМ](./media/virtual-machines-common-classic-agents-and-extensions/IC719409.png)

-   Когда вы создаете экземпляр виртуальной машины с помощью командлета [New-AzureVM](https://msdn.microsoft.com/library/azure/dn495254.aspx) или [New-AzureQuickVM](https://msdn.microsoft.com/library/azure/dn495183.aspx). Вы можете создать виртуальную машину и без установленного агента виртуальной машины. Для этого добавьте в командлет [Add-AzureProvisioningConfig](https://msdn.microsoft.com/library/azure/dn495299.aspx) параметр **–DisableGuestAgent**.

-   Если вы вручную загрузите агент виртуальной машины (версию для Windows или Linux) и установите его на существующем экземпляре виртуальной машины, а затем установите значение **true** для параметра **ProvisionGuestAgent** с помощью Powershell или вызова REST. (Если вы не установите это значение после установки агента ВМ вручную, добавление агента ВМ не будет обнаружено). В следующем примере кода показано, как вы можете это сделать с помощью PowerShell, когда аргументы `$svc` и `$name` уже определены.

        $vm = Get-AzureVM –ServiceName $svc –Name $name
        $vm.VM.ProvisionGuestAgent = $TRUE
        Update-AzureVM –Name $name –VM $vm.VM –ServiceName $svc

-   Когда вы создаете образ виртуальной машины, в котором до передачи в Azure был установлен агент виртуальной машины. Для виртуальной машины Windows вы можете установить агент, скачав [MSI-файл агента виртуальной машины Windows](http://go.microsoft.com/fwlink/?LinkID=394789). Для виртуальной машины Linux установка выполняется из репозитория GitHub, расположенного по адресу <https://github.com/Azure/WALinuxAgent>. Дополнительные сведения об установке агента виртуальной машины в Linux можно найти в статье [Руководство пользователя по агенту виртуальной машины Azure](../articles/virtual-machines/virtual-machines-linux-agent-user-guide.md).

>[AZURE.NOTE]В PaaS агент виртуальной машины называется **WindowsAzureGuestAgent** и всегда доступен в виртуальных машинах с веб-ролью и рабочей ролью. (Дополнительную информацию можно найти в статье [Архитектура ролей Azure](http://blogs.msdn.com/b/kwill/archive/2011/05/05/windows-azure-role-architecture.aspx).) Теперь агент виртуальной машины для виртуальных машин с ролями может добавлять расширения в виртуальные машины облачных служб таким же образом, как и в постоянные виртуальные машины. Основное различие между расширениями ВМ на виртуальных машинах с ролями и на постоянных виртуальных машинах заключается в том, что на ВМ с ролями расширения добавляются сначала в облачную службу, а затем в развертывания в этой службе.

>Используйте командлет [Get AzureServiceAvailableExtension](https://msdn.microsoft.com/library/azure/dn722498.aspx), чтобы получить список всех доступных расширений для виртуальных машин с ролями.

##Поиск, добавление, обновление и удаление расширений виртуальной машины  

Дополнительные сведения об этих задачах можно найти в статье [Добавление, поиск, обновление и удаление расширений виртуальной машины Azure](../articles/virtual-machines/virtual-machines-windows-classic-manage-extensions.md).

<!---HONumber=AcomDC_0427_2016-->