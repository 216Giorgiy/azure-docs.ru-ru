
 

Azure предлагает отличные облачные решения на основе виртуальных машин (эмуляции оборудовании физического компьютера), чтобы обеспечить гибкое перемещение развертывания программного обеспечения и получить значительно более высокую эффективность консолидации ресурсов, чем в случае использования физического оборудования. В последние несколько лет во многом благодаря подходу [Docker](https://www.docker.com) к контейнерам и экосистеме docker технология контейнеров Linux значительно расширила ряд доступных способов разработки распределенного программного обеспечения и управления им. Код приложения в контейнере изолирован от основной виртуальной машины Azure, так же как и другие контейнеры в той же виртуальной машине, что обеспечивает большую гибкость разработки и развертывания на уровне приложения, помимо гибкости, которую обеспечивают сами виртуальные машины Azure.

**Но это уже устаревшие новости.** А вот *свежие* новости — Azure предоставляет еще больше удобств Docker:

- [много](../articles/virtual-machines/virtual-machines-linux-classic-cli-use-docker.md) [разных](virtual-machines-linux-classic-portal-use-docker.md) [способов](virtual-machines-linux-classic-docker-quickstart.md) [создания узлов Docker](https://github.com/Azure/azure-quickstart-templates/tree/master/docker-simple-on-ubuntu) для контейнеров в соответствии с конкретной ситуацией;
- [диспетчер ресурсов Azure](../articles/resource-group-overview.md) и [шаблоны групп ресурсов](../articles/resource-group-authoring-templates.md) упрощают развертывание и обновление сложных распределенных приложений;
- интеграцию с большим массивом частных инструментов управления конфигурациями и инструментов управления конфигурациями с открытым исходным кодом.

Так как есть возможность программным путем создавать виртуальные машины и контейнеры Linux в Azure, можно также использовать инструменты *оркестрации* виртуальных машин и контейнеров для создания групп виртуальных машин и развертывания приложений в контейнерах Linux, а вскоре и в [контейнерах Windows](https://msdn.microsoft.com/virtualization/windowscontainers/about/about_overview).

В этой статье не только рассматриваются общие черты этих понятий, но и содержится множество ссылок на дополнительную информацию, учебники и продукты, связанные с использованием контейнеров и кластеров в Azure. Если вы все это знаете и вам нужны только ссылки, их можно найти в статье [Инструменты для работы с контейнерами](#tools-for-working-with-containers).

## Разница между виртуальными машинами и контейнерами

Виртуальные машины работают в изолированной аппаратной среде виртуализации, предоставляемой [гипервизором](http://en.wikipedia.org/wiki/Hypervisor). В Azure служба [виртуальных машин](https://azure.microsoft.com/services/virtual-machines/) делает все за вас: вы только создаете виртуальные машины, выбрав операционную систему и настроив ее для запуска должным образом или загрузив собственный пользовательский образ виртуальной машины. Виртуальные машины — это проверенная временем, «закаленная» технология, и для нее уже существует множество различных инструментов по управлению операционными системами и настройке установки и запуска приложений. Содержимое виртуальной машины скрыто для операционной системы сервера виртуальных машин, и с точки зрения приложения или пользователя, который работает на виртуальной машине, виртуальная машина является автономным физическим компьютером.

[Контейнеры Linux](http://en.wikipedia.org/wiki/LXC), в том числе созданные и размещенные с помощью инструментов Docker и прочих средств, не требуют и не используют гипервизор для изоляции. Вместо этого узел контейнера использует изоляцию процессов и файловой системы в ядре Linux для получения контейнером (и его приложением) доступа только к определенным компонентам ядра и собственной изолированной файловой системе (как минимум). С точки зрения приложения, работающего в контейнере, этот контейнер является экземпляром уникальной операционной системы. Приложения в контейнере не могут видеть процессы или другие ресурсы за пределами своего контейнера.

Так как в этой модели изоляции и выполнения ядро узла Docker является общим, а дисковые требования контейнера теперь не включают всей операционной системы, время запуска контейнера и дополнительные затраты на дисковое пространство для хранения гораздо ниже.

Это замечательно.

Контейнеры Windows предоставляют те же преимущества, что и контейнеры Linux, но предназначены для приложений, работающих в Windows. Контейнеры Windows поддерживают формат образов и API Docker, но ими также можно управлять с помощью PowerShell. Для работы с контейнерами Windows, Windows Server и Hyper-V доступны две среды выполнения. Контейнеры Hyper-V обеспечивают дополнительный уровень защиты, поскольку каждый контейнер размещается на оптимизированной виртуальной машине. Дополнительные сведения о контейнерах Windows см. в разделе [О контейнерах Windows](https://msdn.microsoft.com/virtualization/windowscontainers/about/about_overview). Чтобы опробовать контейнеры Windows в Azure, обратитесь к [руководству Azure по быстрому запуску контейнеров Windows](https://msdn.microsoft.com/virtualization/windowscontainers/quick_start/azure_setup).

Это тоже замечательно.

### Звучит слишком хорошо, чтобы быть правдой?

И да, и нет. Контейнеры, как и любая другая технология, не позволят волшебным образом немедленно выполнить всю тяжелую работу, которая нужна для распределенных приложений. В то же время контейнеры действительно кое-что меняют:

- скорость разработки и распространения кода приложений;
- скорость и надежность тестирования;
- скорость и надежность развертывания.

С другой стороны помните, что контейнеры выполняются на узле контейнеров (в операционной системе), и в Azure это означает виртуальную машину Azure. Даже если вам уже нравится идея контейнеров, вам все еще требуется инфраструктура виртуальных машин для размещения контейнеров, но преимущество этого состоит в том, что для контейнеров не важно, в каких виртуальных машинах они работают (хотя для контейнера имеет значение среда выполнения — Linux или Windows, например).

## Для чего же контейнеры подходят лучше всего?

Они отлично подходят для многого, но мы советуем использовать их (в случае [облачных служб Azure](https://azure.microsoft.com/services/cloud-services/) и [Azure Service Fabric](../articles/service-fabric/service-fabric-overview.md)) для создания ориентированных на [микрослужбы] распределенных приложений с одной службой, когда структура приложения состоит из нескольких небольших составных частей, а не компонентов большего размера, которые сильнее связаны друг с другом.

Это особенно важно в общедоступном облаке, например в Azure, где можно сдавать виртуальные машины там, где нужно, и тогда, когда нужно. Вы получаете не только изоляцию, быстрое развертывание и инструменты оркестрации, но и можете создавать более эффективные решения для инфраструктуры приложений.

Например, у вас есть развертывание, состоящее из 9 виртуальных машин Azure большого размера для высокодоступного распределенного приложения. Если компоненты этого приложения можно развернуть в контейнерах, можно использовать только 4 виртуальных машины и развернуть компоненты приложения в 20 контейнерах для обеспечения избыточности и балансировки нагрузки.

Это лишь пример, конечно же, но если реализовать это в вашем сценарии, то на случай пиков использования можно добавить дополнительные контейнеры, а не дополнительные виртуальные машины Azure, и использовать оставшуюся общую нагрузку на ЦП гораздо эффективнее, чем ранее.

Кроме того, существует множество сценариев, которые не подходят для реализации микрослужб. Вы будете лучше знать, помогут ли вам микрослужбы и контейнеры.

### Преимущества контейнеров для разработчиков

Как правило, нетрудно увидеть, что технология контейнеров — это шаг вперед, но здесь кроются также и более специфичные преимущества. Рассмотрим пример контейнеров Docker. В этом разделе мы не будем углубляться в возможности Docker (более подробную информацию можно найти в статье [Возможности Docker](https://www.docker.com/whatisdocker/) или на соответствующей странице [Википедии](http://wikipedia.org/wiki/Docker_%28software%29)), но Docker и сопутствующая экосистема обеспечивают значительные преимущества для разработчиков и ИТ-специалистов.

Разработчики переходят на контейнеры Docker быстрее, так как в первую очередь он упрощает использование контейнеров Linux.

- Они могут использовать простые, составные команды для создания основного образа, который можно легко развернуть, и автоматизировать создание таких образов с помощью dockerfile.
- Они могут совместно использовать эти образы с помощью простых команд запроса и передачи в стиле [git](https://git-scm.com/) для [открытых](https://registry.hub.docker.com/) или [закрытых реестров Docker](../articles/virtual-machines/virtual-machines-linux-docker-registry-in-blob-storage.md). 
- Они могут использовать изолированные компоненты приложений вместо компьютеров.
- Они могут использовать большое количество инструментов, которые понимают контейнеры Docker и различные основные образы.

### Преимущества контейнеров для производственных и ИТ-специалистов

Производственные и ИТ-специалисты также получают преимущества, сочетая контейнеры и виртуальные машины.

- Службы в контейнерах изолируются от среды выполнения узла виртуальной машины.
- Код в контейнерах идентичен, и это можно проверить.
- Службы в контейнерах можно запускать, останавливать и быстро перемещать между средами разработки, тестирования и рабочей средой.

Эти (и другие) функции крайне актуальны для развитых предприятий, на которых профильным ИТ-организациям приходится корректировать ресурсы, включая чисто производственные мощности, для задач, которые должны не только обеспечивать сохранение функциональности, но и повышение удовлетворенности и доступности заказчиков. Малый бизнес, независимые поставщики программного обеспечения и стартапы — их требования мало отличаются, но они могут описываться по-разному.

## Какие виртуальные машины подходят лучше всего?

Виртуальные машины, бесспорно, являются фундаментом облачных вычислений. Если виртуальные машины запускаются медленнее, занимают больше дискового пространства и не сопоставляются непосредственно с архитектурой микрослужб, они имеют ряд очень важных преимуществ:

1. по умолчанию они обладают гораздо более надежной защитой для узла;
2. они поддерживают все основные операционные системы и конфигурации приложений;
3. они оснащены проверенными временем экосистемами инструментов управления;
4. они предоставляют среду выполнения для размещения контейнеров.

Последний элемент важен, так как автономные приложения по-прежнему требуют определенной операционной системы и типа ЦП, в зависимости от вызовов, осуществляемых приложением. Важно помнить, что контейнеры устанавливаются на виртуальных машинах, так как они содержат приложения, которые требуется развернуть. Контейнеры не являются заменой операционных систем или виртуальных машин.

## Сравнение основных функций виртуальных машин и контейнеров

В следующей таблице описаны основные различия между функциями (не вдаваясь в подробности) виртуальных машин и контейнеров Linux. Обратите внимание, что некоторые функции могут быть более или менее желательными в зависимости от требований приложения, и, как и с любым другим ПО, при незначительных усилиях можно получить поддержку дополнительных функций, особенно с точки зрения безопасности.

| Функция | Виртуальные машины | Контейнеры |
| :------------- |-------------| ----------- |
| Поддержка безопасности «по умолчанию» | В большей степени | Немного в меньшей степени |
| Требуется память на диске | Полная версия ОС и приложения | Только требования приложений |
| Время для запуска | Значительно дольше: загрузка ОС и приложений | Значительно быстрее: необходим только запуск приложений, так как ядро уже работает |
| Переносимость | Переносимость при правильной подготовке | Переносимость в формате образа, обычно ниже | 
| Автоматизация образов | Зависит от ОС и приложений | [Реестр Docker](https://registry.hub.docker.com/) и другие

## Создание групп виртуальных машин и контейнеров и управление ими

На этом этапе любой архитектор, разработчик, производственный или ИТ-специалист может подумать, что можно ВСЕ это автоматизировать — ведь это НАСТОЯЩИЙ «ЦОД как служба».

И это действительно так. Во множестве систем, многие из которых, вероятно, уже используются, можно управлять группами виртуальных машин Azure и внедрять пользовательский код с помощью сценариев, в частности [CustomScriptingExtension для Windows](https://msdn.microsoft.com/library/azure/dn781373.aspx) или [CustomScriptingExtension для Linux](https://azure.microsoft.com/blog/2014/08/20/automate-linux-vm-customization-tasks-using-customscript-extension/). Вы можете автоматизировать развертывание Azure (и, возможно, уже делаете это) с помощью сценариев PowerShell или интерфейса командной строки Azure [следующим образом](../articles/virtual-machines/virtual-machines-windows-create-powershell.md).

Эти возможности часто затем переносятся в такие инструменты, как [Puppet](https://puppetlabs.com/) и [Chef](https://www.chef.io/), для автоматизации создания и настройки виртуальных машин при масштабировании. (Ссылки на использование этих инструментов в Azure см. [здесь](#tools-for-working-with-containers).)

### Шаблоны групп ресурсов Azure

Недавно для Azure выпущен интерфейс REST API [управления ресурсами Azure](../articles/virtual-machines/virtual-machines-windows-compare-deployment-models.md) и обновленные инструменты интерфейса командной строки Azure и PowerShell, которыми легко пользоваться. С помощью [шаблонов диспетчера ресурсов Azure](../articles/resource-group-authoring-templates.md) и API управления ресурсами Azure можно выполнять развертывание, изменение или повторное развертывание топологий всего приложения, используя:

- [портал Azure с помощью шаблонов](https://github.com/Azure/azure-quickstart-templates) (совет: используйте кнопку DeployToAzure);
- [Azure CLI](../articles/virtual-machines/virtual-machines-linux-cli-deploy-templates.md);
- [модули Azure PowerShell](../articles/virtual-machines/virtual-machines-linux-cli-deploy-templates.md).


### Развертывание всей группы виртуальных машин Azure и контейнеров и управление ими

Существует несколько популярных систем, которые позволяют развертывать целые группы виртуальных машин и устанавливать Docker (или другие узлы контейнеров Linux) в виде автоматизируемой группы. Прямые ссылки см. в разделе [контейнеров и инструментов](#containers-and-vm-technologies) ниже. Существует несколько систем, которые в большей или меньшей степени позволяют сделать это, и этот список не является исчерпывающим. В зависимости от доступных навыков и сценариев, они могут быть или не быть полезными.

У Docker есть собственный набор инструментов для создания виртуальной машины ([docker-machine](../articles/virtual-machines/virtual-machines-linux-classic-docker-machine.md)) и инструмент управления кластерами контейнеров Docker с балансировкой нагрузки ([swarm](../articles/virtual-machines/virtual-machines-linux-docker-swarm.md)). Кроме того, расширение [Docker для виртуальных машин Azure](https://github.com/Azure/azure-docker-extension/blob/master/README.md) по умолчанию поддерживает [`docker-compose`](https://docs.docker.com/compose/), который позволяет развертывать настроенные контейнеры приложений в нескольких контейнерах.

Вы также можете попробовать ОС [Data Center Operating System (DCOS)](http://docs.mesosphere.com/install/azurecluster/) от Mesosphere. DCOS основана на проекте с открытым исходным кодом [mesos](http://mesos.apache.org/) для ядра распределенных систем, который позволяет реализовать центр обработки данных как одну адресуемую службу. DCOS оснащена встроенными пакетами для нескольких важных систем, таких как [Spark](http://spark.apache.org/) и [Kafka](http://kafka.apache.org/) (и др.), а также встроенными службами, такими как [Marathon](https://mesosphere.github.io/marathon/) (система управления контейнерами) и [Chronos](https://mesosphere.github.io/chronos/) (распределенный планировщик). Mesos создан с учетом уроков, полученных при развитии Twitter, AirBnb и других веб-масштабируемых компаний.

Кроме того, [kubernetes](https://azure.microsoft.com/blog/2014/08/28/hackathon-with-kubernetes-on-azure/) — это система для управления группами виртуальных машин и контейнеров с открытым исходным кодом, созданная с учетом опыта Google. Вы даже можете использовать [kubernetes совместно с weave для обеспечения поддержки сети](https://github.com/GoogleCloudPlatform/kubernetes/blob/master/docs/getting-started-guides/coreos/azure/README.md#kubernetes-on-azure-with-coreos-and-weave).

[Deis](http://deis.io/overview/) является проектом с открытым исходным кодом класса "Платформа как услуга" (PaaS), который упрощает развертывание приложений и управление ими на собственных серверах. Deis собран на основе Docker и CoreOS для предоставления упрощенной PaaS и рабочего процесса в стиле Heroku. Вы можете легко [создать 3-узловую группу виртуальных машин Azure и установить Deis](../articles/virtual-machines/virtual-machines-linux-deis-cluster.md) в Azure, а затем [установить приложение Hello World Go](../articles/virtual-machines/virtual-machines-linux-deis-cluster.md#deploy-and-scale-a-hello-world-application).

[CoreOS](./articles/virtual-machines/virtual-machines-linux-classic-coreos-howto.md) — это оптимизированный по размеру дистрибутив Linux с поддержкой Docker, собственной системой контейнеров [rkt](https://github.com/coreos/rkt) и инструментом управления группами контейнеров под названием [fleet](../articles/virtual-machines/virtual-machines-linux-classic-coreos-fleet-get-started.md).

Ubuntu — другой популярный дистрибутив Linux, который очень хорошо поддерживает Docker и при этом также поддерживает [кластеры Linux (LXC)](https://help.ubuntu.com/lts/serverguide/lxc.html).

## Инструменты для работы с виртуальными машинами и контейнерами Azure

Для работы с контейнерами и виртуальными машинами в Azure используются определенные инструменты. В этом разделе содержится перечень лишь некоторых из наиболее полезных или важных основных понятий и инструментов для работы с контейнерами, группами и крупными конфигурациями, а также используемые с ними инструменты оркестрации.

> [AZURE.NOTE] В этой области изменения происходят невероятно быстро, и хотя мы сделаем все возможное для сохранения актуальности этого раздела и ссылок в нем, это может оказаться непосильной задачей. Чтобы всегда быть в курсе происходящего, воспользуйтесь поиском интересующих вас тем!

### Технологии контейнеров и виртуальных машин

Некоторые технологии контейнеров Linux:

- [Docker](https://www.docker.com)
- [LXC](https://linuxcontainers.org/)
- [CoreOS и rkt](https://github.com/coreos/rkt)
- [Open Container Project](http://opencontainers.org/)
- [RancherOS](http://rancher.com/rancher-os/)

Ссылки на контейнеры Windows:

- [Контейнеры Windows](https://msdn.microsoft.com/virtualization/windowscontainers/about/about_overview)

Ссылки на Visual Studio Docker:

- [Инструменты Visual Studio 2015 RC для Docker. Версия для предварительного просмотра](https://visualstudiogallery.msdn.microsoft.com/6f638067-027d-4817-bcc7-aa94163338f0)

Инструменты Docker:

- [Управляющая программа Docker](https://docs.docker.com/installation/#installation)
- Клиенты Docker
	- [Клиент Windows Docker на Chocolatey](https://chocolatey.org/packages/docker)
	- [Указания по установке Docker](https://docs.docker.com/installation/#installation)


Docker в Microsoft Azure:

- [Расширение виртуальных машин Docker для Linux в Azure](../articles/virtual-machines/virtual-machines-linux-dockerextension.md)
- [Руководство пользователя для Azure Docker VM Extension](https://github.com/Azure/azure-docker-extension/blob/master/README.md)
- [Использование расширения виртуальных машин Docker в интерфейсе командной строки Azure (CLI Azure)](../articles/virtual-machines/virtual-machines-linux-classic-cli-use-docker.md)
- [Использование расширения виртуальных машин Docker на портале Azure](../articles/virtual-machines/virtual-machines-linux-classic-portal-use-docker.md)
- [Как быстро приступить к работе с Docker в Azure Marketplace](../articles/virtual-machines/virtual-machines-linux-classic-docker-quickstart.md)
- [Использование docker-machine в Azure](../articles/virtual-machines/virtual-machines-linux-classic-docker-machine.md)
- [Как использовать Docker со Swarm в Azure](../articles/virtual-machines/virtual-machines-linux-docker-swarm.md)
- [Начало работы с решениями Docker и Compose в Azure](../articles/virtual-machines/virtual-machines-linux-docker-compose-quickstart.md)
- [Использование шаблона группы ресурсов Azure для быстрого создания узла Docker в Azure](https://github.com/Azure/azure-quickstart-templates/tree/master/docker-simple-on-ubuntu)
- [Встроенная поддержка `compose`](https://github.com/Azure/azure-docker-extension#11-public-configuration-keys) для приложений в контейнерах
- [Реализация закрытого реестра Docker в Azure](virtual-machines-linux-docker-registry-in-blob-storage.md)

Дистрибутивы Linux и примеры для Azure:

- [CoreOS](../articles/virtual-machines/virtual-machines-linux-classic-coreos-howto.md)

настройка, управление кластером и оркестрация контейнеров:

- [Fleet в CoreOS](../articles/virtual-machines/virtual-machines-linux-classic-coreos-fleet-get-started.md)

-	Deis
	- [Создание 3-узловой виртуальной машины Azure, установка Deis и запуск приложения Hello World Go](../articles/virtual-machines/virtual-machines-linux-deis-cluster.md)
	
-	Kubernetes
	- [Полное руководство по автоматизированному развертыванию кластера Kubernetes с помощью CoreOS и Weave](https://github.com/GoogleCloudPlatform/kubernetes/blob/master/docs/getting-started-guides/coreos/azure/README.md#kubernetes-on-azure-with-coreos-and-weave)
	- [Kubernetes Visualizer](https://azure.microsoft.com/blog/2014/08/28/hackathon-with-kubernetes-on-azure/)
	
-	[Mesos](http://mesos.apache.org/)
	-	[Mesosphere Data Center Operating System (DCOS)](http://beta-docs.mesosphere.com/install/azurecluster/)
	
-	[Jenkins](https://jenkins-ci.org/) и [Hudson](http://hudson-ci.org/)
	- [Блог. Подключаемый модуль ведомого режима Jenkins для Azure](http://msopentech.com/blog/2014/09/23/announcing-jenkins-slave-plugin-azure/)
	- [Репозиторий GitHub. Подключаемый модуль хранилища Jenkins для Azure](https://github.com/jenkinsci/windows-azure-storage-plugin)
	- [Сторонние решения. Подключаемый модуль ведомого режима Hudson для Azure](http://wiki.hudson-ci.org/display/HUDSON/Azure+Slave+Plugin)
	- [Сторонние решения. Подключаемый модуль хранилища Hudson для Azure](https://github.com/hudson3-plugins/windows-azure-storage-plugin)
	
-	[Chef](https://docs.chef.io/index.html)
	- [Chef и виртуальные машины](../articles/virtual-machines/virtual-machines-windows-install-chef-client.md)
	- [Видео. Что такое Chef и как это работает?](https://msopentech.com/blog/2014/03/31/using-chef-to-manage-azure-resources/)

-	[Служба автоматизации Azure](https://azure.microsoft.com/services/automation/)
	- [Видео. Использование службы автоматизации Azure для виртуальных машин Linux](http://channel9.msdn.com/Shows/Azure-Friday/Azure-Automation-104-managing-Linux-and-creating-Modules-with-Joe-Levy)
	
-	Powershell DSC для Linux
    - [Блог. Как сделать Powershell DSC для Linux](http://blogs.technet.com/b/privatecloud/archive/2014/05/19/powershell-dsc-for-linux-step-by-step.aspx)
    - [Github. DSC клиента Docker](https://github.com/anweiss/DockerClientDSC)

## Дальнейшие действия

Извлечение контейнеров [Docker](https://www.docker.com) и [Windows](https://msdn.microsoft.com/virtualization/windowscontainers/about/about_overview).

<!--Anchors-->
[microservices]: http://martinfowler.com/articles/microservices.html
[микрослужбы]: http://martinfowler.com/articles/microservices.html
<!--Image references-->

<!---HONumber=AcomDC_0330_2016-->