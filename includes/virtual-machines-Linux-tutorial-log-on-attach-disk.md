## <span id="logon"></span> </a>Как войти в виртуальную машину после ее создания

Для управления параметрами виртуальной машины и приложениями, выполняющимися на компьютере, можно использовать SSH-клиент. Для этого необходимо установить клиент SSH на компьютер, который будет использоваться для входа на виртуальную машину. Существует множество клиентских программ SSH. Вы можете выбрать один из следующих вариантов.

-   При использовании компьютера под управлением Windows вы можете использовать такой клиент SSH, как PuTTY. Дополнительные сведения см. на [странице загрузки PuTTY][странице загрузки PuTTY].
-   При использовании компьютера под управлением Linux вы можете использовать такой клиент SSH, как OpenSSH. Дополнительные сведения см. на странице [OpenSSH][OpenSSH].

В этом руководстве рассматривается использование программы PuTTY для доступа к виртуальной машине.

1.  Найдите **Имя узла** и **Данные порта** с портала управления. Необходимые сведения можно найти на панели мониторинга виртуальной машины. Щелкните имя виртуальной машины и найдите **Сведения об SSH** в разделе **Сводка** панели мониторинга.

    ![Найдите сведения об SSH][Найдите сведения об SSH]

2.  Откройте программу PuTTY.

3.  Введите **Имя узла** и **Данные порта** с панели мониторинга и щелкните **Открыть**.

    ![Введите имя узла и данные порта][Введите имя узла и данные порта]

4.  Войдите в виртуальную машину с помощью учетной записи NewUser1, добавленной при создании машины.

    ![Войдите на новую виртуальную машину][Войдите на новую виртуальную машину]

    Теперь вы сможете работать с виртуальной машиной, так же как и с любым сервером.

## <span id="attachdisk"></span> </a>Как присоединить диск данных к новой виртуальной машине

Приложение может сохранять данные. Чтобы выполнить такую настройку, подключите диск данных к ранее созданной виртуальной машине. Для этого проще всего подключить пустой диск данных к машине.

В системе Linux диск ресурсов обычно управляется агентом Linux Azure, и он автоматически подключается к **/mnt/resource** (или **/mnt** на образах Ubuntu). С другой стороны, диск данных Linux можно назвать по ядру, например, `/dev/sdc`, и пользователям потребуется разделять, форматировать и подключать этот ресурс. Дополнительные сведения см. в [руководстве пользователя агента Linux Azure][руководстве пользователя агента Linux Azure].

> [WACOM.NOTE] Не рекомендуется хранить данные на диске ресурсов. Этот диск выступает в роли временного хранилища для различных приложений и процессов и используется для данных, не предназначенных для длительного хранения, например для файлов подкачки. Диски данных размещаются в хранилище Azure в виде файлов с расширением ".vhd" в страничных BLOB-объектах и обеспечивают резерв места в хранилище, что необходимо для защиты данных. С более подробной информацией можно ознакомиться в разделе [О дисках и образах в Azure][О дисках и образах в Azure].

1.  Войдите на портал управления Azure, если вы еще этого не сделали.

2.  Щелкните **Виртуальные машины**, а затем выберите предварительно созданную виртуальную машину **MyTestVM1**.

3.  На панели команд нажмите кнопку **Присоединить**, а затем — **Присоединить пустой диск**.

    Откроется диалоговое окно **Присоединение пустого диска**.

    ![Определение сведений о диске][Определение сведений о диске]

4.  Значения **Имя виртуальной машины**, **Расположение хранилища** и **Имя файла** уже определены. Достаточно ввести размер диска. Введите **5** в поле **Размер**.

    **Примечание.** Все диски создаются из файла виртуального жесткого диска в хранилище Azure. Можно ввести имя для добавляемого в хранилище файла виртуального жесткого диска, однако имя диска будет создано автоматически.

5.  Установите флажок, чтобы присоединить диск данных к виртуальной машине.

6.  Проверить присоединение диска данных к виртуальной машине можно с помощью панели мониторинга. Щелкните имя виртуальной машины для отображения панели мониторинга.

    Для виртуальной машины число дисков теперь 2. Присоединенный диск отображается в таблице **Диски**.

    ![Присоединение диска выполнено][Присоединение диска выполнено]

После присоединения диска данных к виртуальной машине диск будет отключен и не инициализирован. Чтобы использовать этот диск для хранения данных, необходимо предварительно войти в систему на данном компьютере и инициализировать диск.

1.  Подключитесь к виртуальной машине, выполнив действия, описанные выше в разделе **Как войти в систему на виртуальной машине после ее создания**.

2.  В окне SSH введите следующую команду, а затем введите пароль данной учетной записи:

    `sudo grep SCSI /var/log/messages`

    Идентификатор последнего добавленного диска данных можно найти в отображаемых сообщениях.

    ![Идентификация диска][Идентификация диска]

3.  В окне SSH введите следующую команду для создания нового устройства, а затем введите пароль учетной записи:

    `sudo fdisk /dev/sdc`

    > [WACOM.NOTE] В этом примере в некоторых дистрибутивах, возможно, потребуется использовать `sudo -i`, если /sbin или /usr/sbin находятся не в `$PATH`.

4.  Введите **n** для создания нового раздела.

    ![Создание нового устройства][Создание нового устройства]

5.  Введите **p**, чтобы сделать раздел основным, введите **1**, чтобы сделать его первым разделом, а затем нажмите клавишу ВВОД, чтобы принять значение по умолчанию для цилиндра.

    ![Создание раздела][Создание раздела]

6.  Введите **p**, чтобы просмотреть сведения о диске, на котором создаются разделы.

    ![Просмотр сведений о диске][Просмотр сведений о диске]

7.  Введите **w**, чтобы записать параметры данного диска.

    ![Запись изменений на диске][Запись изменений на диске]

8.  Необходимо создать файловую систему в новом разделе. Например, введите следующую команду для создания новой файловой системы, а затем введите пароль учетной записи:

    `sudo mkfs -t ext4 /dev/sdc1`

    ![Создание файловой системы][Создание файловой системы]

    > [WACOM.NOTE] Обратите внимание, что системы SUSE Linux Enterprise 11 предоставляют доступ только для чтения в файловых системах ext4. В этих системах для форматирования новых дисковых разделов рекомендуется использовать файловую систему ext3, а не ext4.

9.  Создайте каталог для установки новой файловой системы. В качестве примера введите следующую команду, а затем укажите пароль учетной записи:

    `sudo mkdir /datadrive`

10. Введите следующую команду, чтобы установить диск:

    `sudo mount /dev/sdc1 /datadrive`

    Диск данных теперь готов для использования как **/datadrive**.

11. Добавьте новый диск в /etc/fstab:

    Чтобы обеспечить автоматическую переустановку диска после перезагрузки, его необходимо добавить в файл /etc/fstab. Кроме того, для ссылки на диск настоятельно рекомендуется использовать идентификатор UUID (глобально уникальный идентификатор) в /etc/fstab, а не просто имя устройства (т. е. /dev/sdc1). Чтобы найти идентификатор UUID нового диска, можно использовать программу **blkid**:

        `sudo -i blkid`

    Вывод будет выглядеть примерно следующим образом:

        `/dev/sda1: UUID="11111111-1b1b-1c1c-1d1d-1e1e1e1e1e1e" TYPE="ext4"`
        `/dev/sdb1: UUID="22222222-2b2b-2c2c-2d2d-2e2e2e2e2e2e" TYPE="ext4"`
        `/dev/sdc1: UUID="33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e" TYPE="ext4"`

    > [WACOM.NOTE] blkid может требовать доступ к sudo не во всех случаях, однако в некоторых дистрибутивах его может оказаться проще запустить с помощью `sudo -i`, если /sbin или /usr/sbin находятся не в `$PATH`.

    **Внимание!** Некорректное изменение файла /etc/fstab может привести к невозможности загрузить систему. Если не уверены, обратитесь к документации дистрибутива за сведениями о том, как правильно изменить этот файл. Также рекомендуется перед внесением изменений создать резервную копию файла /etc/fstab.

    С помощью текстового редактора введите сведения о новой файловой системе в конце файла /etc/fstab. В этом примере мы используем значение UUID для нового устройства **/dev/sdc1**, созданного в предыдущих шагах, и точку установки **/datadrive**:

        `UUID=33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /datadrive   ext4   defaults   1   2`

    Или в системах на основе SUSE Linux может потребоваться использовать другой формат:

        `/dev/disk/by-uuid/33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /   ext3   defaults   1   2`

    При создании дополнительных дисков данных и разделов нужно будет также ввести их в файл /etc/fstab отдельно.

    Теперь можно проверить, правильно ли подключена файловая система, просто отключив и повторно подключив файловую систему, т. е. используя типовую точку подключения `/datadrive`, созданную на предыдущих этапах:

        `sudo umount /datadrive`
        `sudo mount /datadrive`

    Если вторая команда приводит к ошибке, проверьте правильность синтаксиса в файле /etc/fstab.

    > [WACOM.NOTE] Последующее удаление диска данных без редактирования fstab может привести к тому, что виртуальная машина не загрузится. Если это происходит часто, то большинство дистрибутивов предоставляют варианты `nofail` и (или) fstab `nobootwait`, которые позволяют системе загружаться, даже если диск отсутствует. Дополнительные сведения об этих параметрах см. в документации по вашему дистрибутиву.

  [странице загрузки PuTTY]: http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html
  [OpenSSH]: http://www.openssh.org/
  [Найдите сведения об SSH]: ./media/virtual-machines-Linux-tutorial-log-on-attach-disk/SSHdetails.png
  [Введите имя узла и данные порта]: ./media/virtual-machines-Linux-tutorial-log-on-attach-disk/putty.png
  [Войдите на новую виртуальную машину]: ./media/virtual-machines-Linux-tutorial-log-on-attach-disk/sshlogin.png
  [руководстве пользователя агента Linux Azure]: http://www.windowsazure.com/ru-ru/manage/linux/how-to-guides/linux-agent-guide/
  [О дисках и образах в Azure]: http://msdn.microsoft.com/ru-ru/library/jj672979.aspx
  [Определение сведений о диске]: ./media/virtual-machines-Linux-tutorial-log-on-attach-disk/attachnewdisklinux.png
  [Присоединение диска выполнено]: ./media/virtual-machines-Linux-tutorial-log-on-attach-disk/attachemptysuccess.png
  [Идентификация диска]: ./media/virtual-machines-Linux-tutorial-log-on-attach-disk/diskmessages.png
  [Создание нового устройства]: ./media/virtual-machines-Linux-tutorial-log-on-attach-disk/diskpartition.png
  [Создание раздела]: ./media/virtual-machines-Linux-tutorial-log-on-attach-disk/diskcylinder.png
  [Просмотр сведений о диске]: ./media/virtual-machines-Linux-tutorial-log-on-attach-disk/diskinfo.png
  [Запись изменений на диске]: ./media/virtual-machines-Linux-tutorial-log-on-attach-disk/diskwrite.png
  [Создание файловой системы]: ./media/virtual-machines-Linux-tutorial-log-on-attach-disk/diskfilesystem.png
