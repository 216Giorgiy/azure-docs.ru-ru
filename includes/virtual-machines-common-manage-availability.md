## <a name="understand-planned-vs-unplanned-maintenance"></a>Сравнение планового и внепланового обслуживания
На доступность ваших виртуальных машин могут повлиять такие два типа событий платформы Microsoft Azure: плановое и внеплановое обслуживание.

* **События запланированного обслуживания** — это периодические обновления, осуществляемые корпорацией Майкрософт на базовой платформе Azure для улучшения общей надежности, производительности и безопасности инфраструктуры платформы, на которой работают ваши виртуальные машины. Большинство таких обновлений выполняется без какого-либо воздействия на ваши виртуальные машины или облачные службы. Тем не менее в некоторых случаях требуется перезагрузить виртуальную машину, чтобы применить необходимые обновления к инфраструктуре платформы.
* **События незапланированного обслуживания** происходят в тех случаях, когда в оборудовании или физической инфраструктуре, на основе которых работает виртуальная машина, происходит какая-либо ошибка. Это могут быть сбои локальной сети или локальных жестких дисков, а также другие ошибки на уровне стойки. При выявлении такой ошибки платформа Azure автоматически выполнит перенос вашей виртуальной машины с неработоспособной физической машины, где она размещена, на исправную. Это происходит редко, но также может быть причиной перезагрузки вашей виртуальной машины.

Чтобы уменьшить воздействие простоя из-за одного или нескольких из описанных здесь событий, мы рекомендуем вам выполнить на своих виртуальных машинах следующие действия по обеспечению высокого уровня доступности.

* [Настройка нескольких виртуальных машин в группе доступности для обеспечения избыточности]
* [Настройка каждого уровня приложений в отдельных группах доступности]
* [Объединение балансировщика нагрузки с группами доступности]
* [Использование нескольких учетных записей хранения для каждой группы доступности]

## <a name="configure-multiple-virtual-machines-in-an-availability-set-for-redundancy"></a>Настройка нескольких виртуальных машин в группе доступности для обеспечения избыточности
Чтобы обеспечить избыточность приложения, мы рекомендуем включить две или несколько виртуальных машин в группу доступности. Эта конфигурация обеспечит доступность не менее одной виртуальной машины и достижение показателя 99,95 % уровня обслуживания (SLA) Azure как при событиях запланированного обслуживания, так и при незапланированного. Дополнительные сведения см. в статье о [соглашении об уровне обслуживания для виртуальных машин](https://azure.microsoft.com/support/legal/sla/virtual-machines/).

> [!IMPORTANT]
> Не рекомендуется оставлять в группе доступности один экземпляр виртуальной машины. В такой конфигурации виртуальные машины не смогут обеспечивать уровень обслуживания, предусмотренный соглашением об уровне обслуживания, и будут простаивать во время плановых сеансов обслуживания Azure.
> 
> 

Платформа Azure назначает каждой виртуальной машине в группе доступности **домен обновления** и **домен сбоя**. Для заданной группы доступности по умолчанию назначается пять доменов обновления без возможности изменения пользователем (в дальнейшем службы, развернутые с помощью Resource Manager, можно будет расширить до 20 доменов обновления). Это позволяет указывать группы виртуальных машин и базовое физическое оборудование, которые можно одновременно перезагружать. Если в одной группе доступности настраивается более пяти виртуальных машин, шестая виртуальная машина помещается в тот же домен обновления, что и первая виртуальная машина, седьмая — что и вторая, и т. д. Порядок перезагрузки доменов обновления при выполнении запланированного обслуживания может не быть последовательным, но за один раз будет перезагружаться только один домен обновления.

Домены сбоя определяют группу виртуальных машин, которые совместно используют общий источник питания и сетевой коммутатор. По умолчанию виртуальные машины, настроенные в группе доступности, разделяются на три домена сбоя для служб, развернутых с помощью Resource Manager, и на два домена сбоя для классического развертывания. Включение виртуальных машин в группу доступности не защитит ваше приложение от сбоев, связанных с операционной системой или приложениями, но минимизирует последствия сбоев физического оборудования, сети и электропитания.

<!--Image reference-->
   ![Схема конфигурации домена обновления и домена сбоя](./media/virtual-machines-common-manage-availability/ud-fd-configuration.png)

## <a name="configure-each-application-tier-into-separate-availability-sets"></a>Настройка каждого уровня приложений в отдельных группах доступности
Если у вас условно сопоставимые виртуальные машины, которые выполняют для приложения одни и те же задачи, мы рекомендуем настраивать по одной группе доступности для каждого уровня приложения.  Если включить в одну группу доступности два разных уровня, вы сможете одновременно перезапускать все виртуальные машины в рамках одного уровня приложения. Настроив хотя бы по две виртуальные машины в группе доступности для каждого уровня, вы обеспечите доступность хотя бы одной виртуальной машины на каждом уровне.

Например, вы можете включить в одну группу доступности все виртуальные машины, относящиеся к внешнему интерфейсу приложения под управлением IIS, Apache и Nginx. Убедитесь, что в одну группу доступности включены только соответствующие виртуальные машины. Аналогичным образом убедитесь, что в другую группу доступности включены только виртуальные машины, относящиеся к уровню данных, например реплицированные виртуальные машины SQL Server или MySQL.

<!--Image reference-->
   ![Уровни приложений](./media/virtual-machines-common-manage-availability/application-tiers.png)

## <a name="combine-a-load-balancer-with-availability-sets"></a>Объединение подсистемы балансировки нагрузки с группами доступности
Чтобы обеспечить максимальную устойчивость приложения, объедините [Azure Load Balancer](../articles/load-balancer/load-balancer-overview.md) с группой доступности. Подсистема балансировки нагрузки Azure распределяет трафик между несколькими виртуальными машинами. Наши виртуальные машины стандартного уровня включают в себя подсистему балансировки нагрузки Azure. Не все уровни виртуальных машин имеют балансировщик нагрузки Azure. Дополнительные сведения о балансировке нагрузки виртуальных машин см. в статье [Балансировка нагрузки для служб инфраструктуры Azure](../articles/virtual-machines/virtual-machines-linux-load-balance.md).

Если балансировщик нагрузки не настроен для балансировки трафика между несколькими виртуальными машинами, то любое запланированное событие обслуживания оказывает воздействие на единственную виртуальную машину, обслуживающую трафик, что приведет к сбою на уровне приложений. Если включить несколько виртуальных машин одного уровня в одну подсистему балансировки нагрузки и группу доступности, трафик непрерывно будет обслуживаться хотя бы одним экземпляром.

## <a name="use-multiple-storage-accounts-for-each-availability-set"></a>Использование нескольких учетных записей хранения для каждой группы доступности
Эти рекомендации следует соблюдать в отношении учетных записей хранения, используемых для хранения виртуальных жестких дисков (VHD) виртуальной машины. Каждый такой диск (VHD) представляет собой страничный BLOB-объект в учетной записи хранения Azure. Важно обеспечить избыточность и изоляцию между учетными записями хранения, чтобы гарантировать высокую доступность виртуальных машин в группе доступности.

1. **Храните все диски (операционной системы и данных), связанные с одной виртуальной машиной, в одной учетной записи хранения**.
2. Когда вы добавляете новые виртуальные жесткие диски в учетную запись хранения, **важно помнить об [ограничениях](../articles/storage/storage-scalability-targets.md) для учетной записи хранения**.
3. **Используйте несколько учетных записей хранения для каждой группы доступности.** Используйте отдельные учетные записи хранения для каждой виртуальной машины в группе доступности. Несколько виртуальных машин в одной группе доступности НЕ должны совместно использовать одну учетную запись хранения. Это допустимо для виртуальных машин из разных групп доступности, если соблюдаются все описанные выше рекомендации.

<!-- Link references -->
[Настройка нескольких виртуальных машин в группе доступности для обеспечения избыточности]: #configure-multiple-virtual-machines-in-an-availability-set-for-redundancy
[Настройка каждого уровня приложений в отдельных группах доступности]: #configure-each-application-tier-into-separate-availability-sets
[Объединение балансировщика нагрузки с группами доступности]: #combine-a-load-balancer-with-availability-sets
[Предотвращение наличия одиночных экземпляров виртуальных машин в группах доступности]: #avoid-single-instance-virtual-machines-in-availability-sets
[Использование нескольких учетных записей хранения для каждой группы доступности]: #use-multiple-storage-accounts-for-each-availability-set



<!--HONumber=Nov16_HO4-->


