



В зависимости от вашей среды и предпочтений скрипт может создать всю инфраструктуру кластера, в том числе виртуальную сеть Azure, учетные записи хранения, облачные службы, контроллер домена, удаленные и локальные базы данных SQL, головной узел, узлы-посредники, вычислительные узлы и облачную службу Azure (PaaS). Скрипт также может использовать существующую инфраструктуру Azure и создать для HPC-кластера головной узел, узлы-посредники, вычислительные узлы и узлы Azure PaaS («burst»).


Общие сведения о планировании HPC-кластера см. в статьях [Оценка и продукта и планирование](https://technet.microsoft.com/library/jj899596.aspx) и [Приступая к работе](https://technet.microsoft.com/library/jj899590.aspx) библиотеки TechNet, посвященных пакету HPC.



## Предварительные требования

* **Подписка на Azure**. Вы можете использовать подписку на службу Azure Global или Azure China. Ограничения подписки влияют на количество и тип узлов кластера, которые вы можете развернуть. Дополнительные сведения см. в статье [Подписка Azure, границы, квоты и ограничения службы](../articles/azure-subscription-service-limits.md).


* **Компьютеры под управлением Windows с установленным и настроенным Azure PowerShell 0.8.7 или более поздней версии**. См. статью [Установка и настройка Azure PowerShell](../articles/powershell-install-configure.md). Сценарий выполняется в режиме управления службами Azure (ASM).


* **Скрипт развертывания IaaS из пакета HPC**. Скачайте и распакуйте последнюю версию скрипта из [Центра загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=44949). Проверьте версию сценария, запустив `New-HPCIaaSCluster.ps1 –Version`. В этой статье предполагается использование скрипта версии 4.4.0 или выше.

* **Файл конфигурации скрипта**. Вам потребуется создать XML-файл, с помощью которого скрипт настраивает HPC-кластер. Дополнительные сведения и примеры приведены далее.


## Синтаксис

```
New-HPCIaaSCluster.ps1 [-ConfigFile] <String> [-AdminUserName]<String> [[-AdminPassword] <String>] [[-HPCImageName] <String>] [[-LogFile] <String>] [-Force] [-NoCleanOnFailure] [-PSSessionSkipCACheck] [<CommonParameters>]
```
>[AZURE.NOTE]Скрипт необходимо запускать от имени администратора.

### Параметры

* **ConfigFile** — путь к файлу конфигурации HPC-кластера. Дополнительные сведения см. в разделе [Файл конфигурации](#Configuration-file) этой статьи или в файле Manual.rtf в папке со скриптом.

* **AdminUserName**. Задает имя пользователя. Если с помощью скрипта создается доменный лес, указанное здесь значение становится именем пользователя локального администратора для всех виртуальных машин, а также именем пользователя администратора домена. Если доменный лес уже существует, указанное здесь значение становится именем пользователя локального администратора, которое будет использоваться для установки пакета HPC.

* **AdminPassword** — пароль администратора. Если значение не указано в командной строке, скрипт предложит ввести пароль.

* **HPCImageName** (необязательно) — образ виртуальной машины с пакетом HPC, используемый для развертывания HPC-кластера. Это должен быть образ пакета HPC от корпорации Майкрософт (доступен в Azure Marketplace). Если значение не указано (рекомендуется в большинстве случаев), скрипт выбирает последний опубликованный образ пакета HPC.

    >[AZURE.NOTE] Если не указать действительный образ пакета HPC, развертывание завершится с ошибкой.

* **LogFile** (необязательно) — путь к файлу журнала развертывания. Если значение не указано, скрипт создаст файл журнала во временной папке на компьютере, на котором выполняется скрипт.

* **Force** (необязательно). Подавляет все окна с запросами подтверждения.

* **NoCleanOnFailure** (необязательно). Указывает, что виртуальные машины Azure, развертывание которых не удалось, не должны удаляться. Перед повторным выполнением скрипта необходимо удалить такие виртуальные машины вручную. В противном случае может произойти сбой развертывания.

* **PSSessionSkipCACheck** (необязательно). Для каждой облачной службы с виртуальными машинами, развернутыми с помощью сценария, Azure автоматически создает самозаверяющий сертификат, и все виртуальные машины в облачной службе используют его как стандартный сертификат удаленного управления Windows (WinRM). Чтобы развернуть компоненты HPC на этих виртуальных машинах Azure, по умолчанию скрипт временно устанавливает эти сертификаты в хранилище "Локальный компьютер\\Доверенные корневые центры сертификации", чтобы подавить ошибки безопасности "Не является доверенным ЦС" во время его выполнения. После завершения выполнения скрипта сертификаты удаляются. Если этот параметр задан, сертификаты не устанавливаются на локальный компьютер, а предупреждения системы безопасности подавляются.

    >[AZURE.IMPORTANT] Не рекомендуется использовать этот параметр для развертывания в рабочей среде.

### Пример

В следующем примере создается новый кластер пакета HPC с помощью файла конфигурации *MyConfigFile.xml*, а также указываются учетные данные администратора для установки кластера.

```
New-HPCIaaSCluster.ps1 –ConfigFile MyConfigFile.xml -AdminUserName <username> –AdminPassword <password>
```

### Дополнительные замечания

* Скрипт использует образ виртуальной машины на основе пакета HPC, доступный в Azure Marketplace, для создания головного узла кластера. Последняя версия образа предполагает, что установлена ОС Windows Server 2012 R2 Datacenter с пакетом HPC 2012 R2 с обновлением 3.

* Скрипт дополнительно может включать отправку заданий через веб-портал для пакета HPC или с помощью REST API для пакета HPC.

* Скрипт может дополнительно запускать другие скрипты до и после настройки головного узла (если нужно установить дополнительное программное обеспечение или настроить другие параметры).


## Файл конфигурации

Скрипт развертывания использует файл конфигурации в формате XML. Файл схемы HPCIaaSClusterConfig.xsd находится в папке скрипта развертывания пакета HPC по модели IaaS. **IaaSClusterConfig** — это корневой элемент файла конфигурации. Его дочерние элементы подробно описаны в файле Manual.rtf в папке скрипта развертывания. Файлы для разных сценариев см. в разделе [Примеры файлов конфигурации](#Example-configuration-files) этой статьи.

<!---HONumber=AcomDC_0406_2016-->