



В зависимости от вашей среды и предпочтений скрипт может создать всю инфраструктуру кластера, в том числе виртуальную сеть Azure, учетные записи хранения, облачные службы, контроллер домена, удаленные и локальные базы данных SQL, головной узел и дополнительные узлы кластера. Или скрипт может с помощью уже существующей инфраструктуры Azure ограничиться созданием узлов кластера HPC.

Общие сведения о планировании кластера пакета HPC см. в статьях [Product Evaluation and Planning](https://technet.microsoft.com/library/jj899596.aspx) (Оценка и планирование продукта) и [Getting Started](https://technet.microsoft.com/library/jj899590.aspx) (Приступая к работе), посвященных пакету HPC 2012 R2, в библиотеке TechNet.

## <a name="prerequisites"></a>предварительным требованиям
* **Подписка Azure**. Вы можете использовать подписку на глобальную службу Azure или Azure для Китая. Ограничения подписки влияют на количество и тип узлов кластера, которые вы можете развернуть. Дополнительные сведения см. в статье [Подписка Azure, границы, квоты и ограничения службы](../articles/azure-subscription-service-limits.md).
* **Клиентские компьютеры под управлением Windows с установленной и настроенной средой Azure PowerShell 0.8.10 или более поздней версии**. Пошаговые инструкции по установке и подключению к подписке Azure см. в статье [Get started with Azure PowerShell cmdlets](/powershell/azureps-cmdlets-docs) (Начало работы с командлетами Azure PowerShell).
* **Скрипт развертывания IaaS из пакета HPC**. Скачайте и распакуйте последнюю версию скрипта из [Центра загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=44949). Проверьте версию сценария, запустив `New-HPCIaaSCluster.ps1 –Version`. В этой статье предполагается использование скрипта версии 4.5.2.
* **Файл конфигурации скрипта**. Создайте XML-файл, с помощью которого скрипт настраивает кластер HPC. Информацию и примеры см. в следующих разделах этой статьи и в файле Manual.rtf, сопровождающем скрипт развертывания.

## <a name="syntax"></a>Синтаксис
```PowerShell
New-HPCIaaSCluster.ps1 [-ConfigFile] <String> [-AdminUserName]<String> [[-AdminPassword] <String>] [[-HPCImageName] <String>] [[-LogFile] <String>] [-Force] [-NoCleanOnFailure] [-PSSessionSkipCACheck] [<CommonParameters>]
```
> [!NOTE]
> Запустите скрипт от имени администратора.
> 
> 

### <a name="parameters"></a>Параметры
* **ConfigFile**. Указывает путь к файлу конфигурации кластера HPC. Дополнительные сведения о файле конфигурации см. в этой статье или в файле Manual.rtf в папке со скриптом.
* **AdminUserName** — имя пользователя. Если с помощью скрипта создается лес доменов, указанное здесь значение становится именем локального администратора для всех виртуальных машин, а также именем администратора домена. Если доменный лес уже существует, указанное здесь значение становится именем пользователя локального администратора, которое будет использоваться для установки пакета HPC.
* **AdminPassword** — пароль администратора. Если значение не указано в командной строке, скрипт предложит ввести пароль.
* **HPCImageName** (необязательно) — образ виртуальной машины с пакетом HPC, используемый для развертывания кластера HPC. Это должен быть образ пакета HPC от корпорации Майкрософт (доступен в Azure Marketplace). Если значение не указано (рекомендуется в большинстве случаев), скрипт выбирает последний опубликованный [образ пакета HPC 2012 R2](https://azure.microsoft.com/marketplace/partners/microsoft/hpcpack2012r2onwindowsserver2012r2/). Последняя версия образа предполагает, что установлена ОС Windows Server 2012 R2 Datacenter с пакетом HPC 2012 R2 с обновлением 3.
  
  > [!NOTE]
  > Если не указать действительный образ пакета HPC, развертывание завершится ошибкой.
  > 
  > 
* **LogFile** (необязательно) — путь к файлу журнала развертывания. Если значение не указано, скрипт создаст файл журнала во временной папке на компьютере, на котором выполняется скрипт.
* **Force** (необязательно). Скрывает все окна с запросами подтверждения.
* **NoCleanOnFailure** (необязательно). Указывает, что виртуальные машины Azure, которые не удалось развернуть, не удаляются. Перед повторным выполнением скрипта следует удалить такие виртуальные машины вручную. В противном случае может произойти сбой развертывания.
* **PSSessionSkipCACheck** (необязательно). Для каждой облачной службы с виртуальными машинами, развернутыми с помощью этого скрипта, Azure автоматически создает самозаверяющий сертификат, и все виртуальные машины в облачной службе используют его как стандартный сертификат удаленного управления Windows (WinRM). Чтобы развернуть компоненты HPC на этих виртуальных машинах Azure, по умолчанию скрипт временно устанавливает эти сертификаты в хранилище "Локальный компьютер\\Доверенные корневые центры сертификации". Это делается для того, чтобы во время выполнения скрипта подавить ошибки безопасности, связанные с ЦС, который не является доверенным. После завершения выполнения скрипта сертификаты удаляются. Если этот параметр задан, сертификаты не устанавливаются на локальный компьютер, а предупреждения системы безопасности подавляются.
  
  > [!IMPORTANT]
  > Не рекомендуется использовать этот параметр для развертывания в рабочей среде.
  > 
  > 

### <a name="example"></a>Пример
В следующем примере создается HPC-кластер с помощью файла конфигурации *MyConfigFile.xml*, а также указываются учетные данные администратора для установки кластера.

```PowerShell
.\New-HPCIaaSCluster.ps1 –ConfigFile MyConfigFile.xml -AdminUserName <username> –AdminPassword <password>
```

### <a name="additional-considerations"></a>Дополнительные замечания
* Скрипт дополнительно может включать отправку заданий через веб-портал для пакета HPC или с помощью REST API для пакета HPC.
* Скрипт может дополнительно запускать другие скрипты до и после настройки головного узла (если нужно установить дополнительное программное обеспечение или настроить другие параметры).

## <a name="configuration-file"></a>Файл конфигурации
Скрипт развертывания использует файл конфигурации в формате XML. Файл схемы HPCIaaSClusterConfig.xsd находится в папке скрипта развертывания пакета HPC по модели IaaS. **IaaSClusterConfig** — это корневой элемент файла конфигурации. Его дочерние элементы подробно описаны в файле Manual.rtf в папке со скриптом развертывания.

