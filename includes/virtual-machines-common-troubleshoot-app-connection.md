


В этой статье можно узнать о методах выявления причин возникновения и исправления проблемы, из-за которой не удается получить доступ к приложению, выполняющемуся в виртуальной машине Azure.

> [AZURE.NOTE]  Чтобы получить справку по подключению к виртуальной машине Azure, см. раздел [Устранение неполадок подключений к удаленному рабочему столу виртуальной машины Azure на основе Windows](virtual-machines-windows-troubleshoot-rdp-connection.md) или [Устранение неполадок SSH-подключений к виртуальной машине Azure на основе Linux](virtual-machines-linux-troubleshoot-ssh-connection.md).

Если вам потребуется дополнительная помощь по любому из вопросов, рассматриваемых в статье, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт службы поддержки Azure](https://azure.microsoft.com/support/options/) и щелкните **Поддержка**.


Существуют четыре основных области для устранения неполадок доступа к приложению, которое выполняется в виртуальной машине Azure.

![](./media/virtual-machines-common-troubleshoot-app-connection/tshoot_app_access1.png)

1.	Приложение, которое выполняется в виртуальной машине Azure.
2.	Виртуальная машина Azure
3.	Конечные точки Azure для облачной службы, содержащей виртуальную машину (для виртуальных машин в классической модели развертывания), правила преобразования сетевых адресов для входящих подключений (для виртуальных машин в модели развертывания Resource Manager) и группы безопасности сети.
4.	Пограничное устройство Интернета.

Для клиентских компьютеров, которые получают доступ к приложению через подключение VPN типа «сеть-сеть» или ExpressRoute, проблемы в первую очередь могут возникать из-за приложения и виртуальной машины Azure. Чтобы определить источник проблемы и исправить ее, выполните приведенные ниже действия.

## Шаг 1. У вас есть доступ к приложению из целевой виртуальной машины?

Попробуйте обратиться к приложению с помощью соответствующей клиентской программы из виртуальной машины, на которой оно работает. Используйте имя локального узла, локальный IP-адрес или петлевой адрес (127.0.0.1).

![](./media/virtual-machines-common-troubleshoot-app-connection/tshoot_app_access2.png)

Например, если приложение является веб-сервером, запустите браузер в виртуальной машине и попытайтесь обратиться к веб-странице, размещенной в виртуальной машине.

Если доступ к приложению есть, перейдите к [шагу 2](#step2).

Если доступ к приложению получить не удается, проверьте, удовлетворены ли следующие требования.

- Приложение выполняется в целевой виртуальной машине.
- Приложение прослушивает ожидаемые порты TCP и UDP.

В виртуальных машин на основе Windows и Linux используйте команду **netstat -a**, чтобы отобразить активные порты прослушивания. Изучите выходные данные для ожидаемых портов, которые должно прослушивать приложение. При необходимости перезапустите приложение или настройте его для использования ожидаемых портов.

## <a id="step2"></a>Шаг 2. У вас есть доступ к приложению из другой виртуальной машины в той же виртуальной сети?

Попробуйте обратиться к приложению из другой виртуальной машины в той же виртуальной сети, используя имя узла виртуальной машины или ее назначенный в Azure общедоступный, частный или предоставленный поставщиком интернет-услуг IP-адрес. Для виртуальных машин, созданных с помощью классической модели развертывания, не используйте общедоступный IP-адрес облачной службы.

![](./media/virtual-machines-common-troubleshoot-app-connection/tshoot_app_access3.png)

Например, если приложение является веб-сервером, попробуйте обратиться к веб-странице из браузера в другой виртуальной машине из той же виртуальной сети.

Если у вас есть доступ к приложению, перейдите к [шагу 3](#step3).

Если доступ к приложению получить не удается, проверьте, удовлетворены ли следующие требования.

- Брандмауэр узла в целевой виртуальной машине пропускает трафик входящих запросов и исходящих ответов.
- Программы для обнаружения вторжений или мониторинга сети, работающие в целевой виртуальной машине, разрешают прохождение сетевого трафика.
- Группы безопасности сети разрешают прохождение трафика.
- Отдельный компонент, выполняющийся в виртуальной сети на пути между тестовой виртуальной машиной и вашей виртуальной машиной, такой, как, например, подсистема балансировки нагрузки или брандмауэр, разрешает прохождение трафика.

На виртуальной машине под управлением Windows используйте брандмауэр Windows в режиме повышенной безопасности для определения того, исключают ли правила брандмауэра входящий и исходящий трафик вашего приложения.

## <a id="step3"></a>Шаг 3. Можете ли вы получить доступ к приложению с компьютера, который находится за пределами виртуальной сети, но не подключен к сети, в которой находится ваш компьютер?

Попытайтесь обратиться к приложению с компьютера за пределами виртуальной сети, где находится виртуальная машина, в которой выполняется приложение, но не из сети исходного клиентского компьютера.

![](./media/virtual-machines-common-troubleshoot-app-connection/tshoot_app_access4.png)

Например, если приложение является веб-сервером, попробуйте получить доступ к веб-странице из браузера на компьютере, который находится не в виртуальной сети.

Если доступ к приложению получить не удается, проверьте, удовлетворены ли следующие требования.

- Для виртуальных машин, созданных с помощью классической модели развертывания, конфигурация конечной точки для виртуальной машины разрешает входящий трафик, в частности для протокола (TCP или UDP), а также общедоступных и частных номеров портов. Дополнительные сведения см. в разделе [Настройка конечных точек виртуальной машины](virtual-machines-windows-classic-setup-endpoints.md).
- Для виртуальных машин, созданных с помощью классической модели развертывания, списки управления доступом (ACL) для конечной точки не блокируют входящий трафик из Интернета. Дополнительные сведения см. в разделе [Настройка конечных точек виртуальной машины](virtual-machines-windows-classic-setup-endpoints.md).
- Для виртуальных машин, созданных с помощью модели развертывания Resource Manager, конфигурация правила NAT входящего трафика для виртуальной машины разрешает входящий трафик, в частности для протокола (TCP или UDP), а также общедоступных и частных номеров портов.
- Группы безопасности сети разрешают трафик входящих запросов и исходящих ответов. Дополнительные сведения см. в разделе [Что такое группа безопасности сети?](../virtual-network/virtual-networks-nsg.md).

Если виртуальная машина или конечная точка входит в комплект балансировки нагрузки, сделайте следующее.

- Проверьте правильность протокола зонда (TCP или UDP) и номера порта.
- Если протокол зонда и порт отличаются от протокола и порта для комплекта балансировки нагрузки, сделайте следующее.
	- Убедитесь, что приложение прослушивает протокол пробы (TCP или UDP) и номер порта (используйте **netstat -a** на целевой виртуальной машине).
	- Брандмауэр узла в целевой виртуальной машине разрешает трафик входящих запросов и исходящих ответов пробы.

Если у вас есть доступ к приложению, убедитесь, что пограничное устройство Интернета разрешает следующее:

- трафик исходящих запросов приложения с клиентского компьютера в виртуальную машину Azure;
- трафик входящих ответов приложения из виртуальной машины Azure.

## Устранение проблем с подключением к конечной точке

При возникновении проблем при подключении к конечной точке, например к конечной точке удаленного рабочего стола, для устранения общих неполадок попробуйте следующее:

- Перезапуск виртуальной машины
- Повторное создание конечной точки
- Подключение из другого расположения
- Изменение размера виртуальной машины
- Повторное создание виртуальной машины

Дополнительные сведения см. в разделе [Устранение неполадок подключения к конечной точке (сбои RDP, SSH, HTTP и другие сбои)](https://social.msdn.microsoft.com/Forums/azure/ru-RU/538a8f18-7c1f-4d6e-b81c-70c00e25c93d/troubleshooting-endpoint-connectivity-rdpsshhttp-etc-failures?forum=WAVirtualMachinesforWindows).



## Дополнительные ресурсы

[Устранение неполадок с подключением к удаленному рабочему столу виртуальной машины Windows в службе Azure](virtual-machines-windows-troubleshoot-rdp-connection.md)

[Устранение неполадок с подключением Secure Shell (SSH) к виртуальной машине Azure под управлением Linux](virtual-machines-linux-troubleshoot-ssh-connection.md)

<!---HONumber=AcomDC_0323_2016-->