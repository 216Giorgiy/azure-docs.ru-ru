

Azure — отличная платформа для реализации конфигураций разработки, тестирования или экспериментов, так как для тестирования того или иного варианта реализации решений требуется совсем немного инвестиций. Тем не менее вам следует отличать простые методы для сред разработки и тестирования от более сложных, детальных методов для полнофункционального, готового к работе варианта реализации для выполнения рабочей нагрузки ИТ-среды.

В этом руководстве указаны многие области, требующие обязательного планирования для успешного выполнения рабочей нагрузки ИТ-среды в Azure. Кроме того, планирование позволяет определить порядок создания необходимых ресурсов. Некоторая гибкость вполне возможна, но мы рекомендуем применять при планировании и принятии решений указанный в данной статье порядок.

Эта статья написана на основе записи блога [Рекомендации по реализации Azure](http://blogs.msdn.com/b/thecolorofazure/archive/2014/05/13/azure-implementation-guidelines.aspx) . Благодарим Сантьяго Канепу (Santiago Cánepa) и Хьюго Сальседо (Hugo Salcedo) (руководителей отдела разработки приложений корпорации Майкрософт) за предоставленные исходные материалы.

> [!NOTE]
> Территориальные группы являются устаревшими. Их использование здесь не описывается. См. дополнительные сведения о [региональных виртуальных сетях и территориальных группах](../articles/virtual-network/virtual-networks-migrate-to-regional-vnet.md).
> 
> 

## <a name="1-naming-conventions"></a>1. Соглашения об именовании.
Прежде чем создавать что-либо в Azure, следует задать надлежащее соглашение об именовании. Такое соглашение гарантирует предсказуемость имен всех ресурсов, позволяющую снизить административную нагрузку, связанную с управлением этими ресурсами.

Вы можете следовать некоторому набору соглашений об именовании, определенному для всей вашей организации, конкретной подписки Azure или учетной записи Azure. Хотя сотрудники организации могут с легкостью устанавливать неявные правила при работе с ресурсами Azure, такая модель плохо масштабируется, если команде нужно работать над проектом в Azure.

Соглашения об именовании следует установить заранее. Некоторые рекомендации в отношении соглашений об именовании касаются набора правил, составляющих эти соглашения.

### <a name="affixes"></a>Аффиксы
При создании определенных ресурсов Azure использует некоторые значения по умолчанию, чтобы упростить управление ресурсами, сопоставленными с создаваемыми. Например, при создании первой виртуальной машины для новой облачной службы классический портал Azure попытается использовать имя виртуальной машины в качестве имени новой облачной службы для нее.

Следовательно, полезно определять типы ресурсов, для определения которых требуются аффиксы. Кроме того, необходимо явно указывать, где будет находиться аффикс:

* в начале имени (префикс);
* в конце имени (суффикс).

Например, группа ресурсов, в которой размещено вычислительное ядро, может иметь такие два имени:

* Rg-CalculationEngine (префикс);
* CalculationEngine-Rg (суффикс).

Аффиксы относятся к различным аспектам, описывающим конкретные ресурсы. В следующей таблице приведены примеры типичных случаев.

| Аспект | Примеры | Примечания |
| --- | --- | --- |
| Среда |dev, stg, prod |Зависит от назначения и имени каждой среды. |
| Расположение |usw (западная часть США), use (восточная часть США 2) |Зависит от региона, в котором располагается центр обработки данных или организация. |
| Служба, продукт или компонент Azure |RG — группа ресурсов, SVC — облачная служба, VNET — виртуальная сеть |Зависит от продукта, для которого ресурс обеспечивает поддержку. |
| Роль |sql, ora, sp, iis |Зависит от роли виртуальной машины. |
| Экземпляр |01, 02, 03 и т. д. |Для ресурсов, которые имеют более одного экземпляра. Например, веб-серверы с балансировкой нагрузки, размещенные в облачной службе. |

При установке соглашений об именовании убедитесь, что они явно указывают, какие аффиксы используются для каждого типа ресурсов, и их расположение (префикс или суффикс).

### <a name="dates"></a>Даты
Часто крайне важно определять дату создания по имени ресурса. Мы рекомендуем использовать формат даты ГГГГММДД. Этот формат обеспечивает не только запись полной даты, но и то, что два ресурса, имена которых отличаются только датой, будут отсортированы в алфавитном и хронологическом порядке одновременно.

### <a name="naming-resources"></a>Именование ресурсов
В соглашении об именовании необходимо определить каждый тип ресурсов и правила назначения имен каждому создаваемому ресурсу. Эти правила применяются ко всем типам ресурсов, например:

* Подписки
* Учетные записи
* учетные записи хранения;
* виртуальные сети;
* Подсети
* Группы доступности
* Группы ресурсов
* Облачных служб
* Виртуальные машины
* Endpoints
* Группы безопасности сети
* Роли

Используйте содержательные имена, которые позволяют безошибочно определить ресурсы, к которым они относятся.

### <a name="computer-names"></a>Имена компьютеров 
Когда администратор создает виртуальную машину, Microsoft Azure требует указать ее имя, которое должно содержать не более 15 знаков. Microsoft Azure использует имя виртуальной машины в качестве имени ресурса виртуальной машины Azure. То же имя виртуальной машины Azure использует в качестве имени компьютера, заданного в операционной системе виртуальной машины. Однако эти имена могут и не совпадать.

Если виртуальная машина создается с помощью VHD-файла образа, в котором уже определена операционная система, имя виртуальной машины в Azure может отличаться от имени компьютера, заданного в операционной системе виртуальной машины. В таком случае управление виртуальной машиной может усложниться, поэтому мы рекомендуем не допускать этого. Используйте имя ресурса виртуальной машины Azure, совпадающее с именем компьютера, заданным в операционной системе этой виртуальной машины.

Мы рекомендуем использовать имя виртуальной машины Azure, совпадающее с именем компьютера основной операционной системы. По этой причине старайтесь следовать правилам именования NetBIOS, как описано в статье [Соглашения об именовании компьютеров Microsoft NetBIOS](https://support.microsoft.com/kb/188997/).

### <a name="storage-account-names"></a>Имена учетных записей хранения
Имена учетных записей хранения создаются по особым правилам. Вы можете использовать только строчные буквы и цифры. Дополнительные сведения см. в разделе [Создание учетной записи хранения](../articles/storage/storage-create-storage-account.md#create-a-storage-account). Кроме того, имя учетной записи хранения в сочетании с core.windows.net должно являться глобально допустимым уникальным именем DNS. Например, если учетная запись хранения называется mystorageaccount, уникальными должны быть следующие имена DNS:

* mystorageaccount.blob.core.windows.net;
* mystorageaccount.table.core.windows.net;
* mystorageaccount.queue.core.windows.net.

### <a name="azure-building-block-names"></a>Имена стандартных блоков Azure
Стандартные блоки Azure — это службы на уровне приложений, доступные в Azure, как правило, для приложений, использующих функции PaaS. Однако ресурсы IaaS могут использовать некоторые из них, например базы данных SQL, диспетчер трафика и др.

Эти службы зависят от массива артефактов, созданных и зарегистрированных в Azure. Кроме того, они должны учитываться в ваших соглашениях об именовании.

### <a name="implementation-guidelines-recap-for-naming-conventions"></a>Обобщение рекомендаций по реализации, касающихся соглашений об именовании
Решение

* Каковы соглашения об именовании для ресурсов Azure?

Задача

* Определить соглашения об именовании с учетом применения аффиксов, иерархии, строковых значений и других политик для ресурсов Azure.

## <a name="2-subscriptions-and-accounts"></a>2) Подписки и учетные записи
Для работы с Azure требуется одна или несколько подписок на Azure. Такие ресурсы, как облачные службы или виртуальные машины, доступны только при использовании этих подписок.

* Как правило, у корпоративных клиентов есть Соглашение о регистрации Enterprise, которое считается ресурсом самого верхнего уровня в иерархии и сопоставлено с одной или несколькими учетными записями.
* Для клиентов без Соглашения о регистрации Enterprise ресурсом верхнего уровня считается учетная запись.
* Подписки сопоставлены с учетными записями. С одной учетной записью может быть связано несколько подписок. Azure хранит данные для выставления счетов на уровне подписки.

Так как количество уровней иерархии для связи между учетной записью и подпиской ограничено двумя, важно, чтобы соглашение об именовании для учетных записей и подписок соответствовало требованиям к выставлению счетов. Например, если в транснациональной компании используется Azure, можно создать по одной учетной записи на регион и управлять подписками на уровне региона.

![](./media/virtual-machines-common-infrastructure-service-guidelines/sub01.png)

Например, можно использовать указанную ниже структуру.

![](./media/virtual-machines-common-infrastructure-service-guidelines/sub02.png)

Если в рамках нашего примера нужно сопоставить несколько подписок для региона с определенной группой, соглашение об именовании должно предусматривать способ указания дополнительных данных в имени учетной записи или подписки. Такая организация позволяет уплотнять данные для выставления счетов, чтобы можно было создавать уровни иерархии во время отправки отчетов о выставлении счетов.

![](./media/virtual-machines-common-infrastructure-service-guidelines/sub03.png)

Организация может выглядеть следующим образом.

![](./media/virtual-machines-common-infrastructure-service-guidelines/sub04.png)

Корпорация Майкрософт выставляет детализированные счета в виде загружаемого файла для одной учетной записи или для всех учетных записей, включенных в Соглашение Enterprise. Вы можете обработать этот файл с помощью Microsoft Excel или других приложений. При этом будут приняты данные и разделены ресурсы, которые кодируют несколько уровней иерархии, на отдельные столбцы, а также будет использована сводная таблица или PowerPivot для предоставления возможностей динамических отчетов.

### <a name="implementation-guidelines-recap-for-subscriptions-and-accounts"></a>Обзор рекомендаций по реализации, касающихся учетных записей и подписок
Решение

* Какие подписки и учетные записи необходимы для размещения рабочей нагрузки ИТ-среды или ИТ-инфраструктуры?

Задача

* Создайте набор подписок и учетных записей с использованием соглашения об именовании.

## <a name="3-storage"></a>3. Хранилище
Хранилище Azure — неотъемлемая часть многих решений Azure. Хранилища Azure предоставляет службы для хранения файловых данных, неструктурированных данных и сообщений, а также является частью инфраструктуры, поддерживающей виртуальные машины.

В Azure доступны учетные записи хранения двух типов. Стандартная учетная запись хранения предоставляет доступ к хранилищу больших двоичных объектов (которое используется для хранения дисков виртуальных машин Azure), хранилищам таблиц, очередей и файлов. Хранилище Premium предназначено для высокопроизводительных приложений, например серверов SQL Server в кластере AlwaysOn, и сейчас поддерживает только диски виртуальных машин Azure.

Учетные записи хранения привязаны к целевым показателям масштабируемости. Чтобы ознакомиться с текущими ограничения хранилища Azure, см. сведения об [ограничениях и квотах для подписки и службы Microsoft Azure](../articles/azure-subscription-service-limits.md#storage-limits). Ознакомьтесь также со статьей [Целевые показатели масштабируемости и производительности хранилища Azure](../articles/storage/storage-scalability-targets.md).

Azure создает виртуальные машины с диском операционной системы, временным диском и любым количеством дополнительных дисков данных. Диск операционной системы и диски данных — страничные BLOB-объекты Azure, тогда как временный диск хранится на локальном узле, на котором запущена виртуальная машина. По этой причине временный диск не подходит для данных, которые должны сохраняться во время перезапуска системы, ведь виртуальная машина может быть перенесена в другой узел без предупреждения с потерей всех данных на этом диске. Не храните ничего на временном диске.

Максимальный размер дисков операционной системы и дисков данных составляет 1023 ГБ (гигабайт), так как максимальный размер большого двоичного объекта составляет 1024 ГБ и он должен содержать метаданные (нижний колонтитул) VHD-файла (ГБ — это 1024<sup>3</sup> байта). Чтобы преодолеть это ограничение, в Windows можно реализовать чередование дисков.

### <a name="striped-disks"></a>Диски с чередованием
Использование чередования для дисков данных, помимо возможности создавать диски размером более 1023 ГБ, во многих случаях увеличивает производительность благодаря тому, что для единого тома хранилища используются несколько больших двоичных объектов. При чередовании дисков операции ввода-вывода для одного логического диска могут выполняться параллельно.

Azure налагает ограничения на количество дисков данных и пропускную способность в зависимости от размера виртуальной машины. Дополнительную информацию см. в статье [Размеры виртуальных машин](../articles/virtual-machines/virtual-machines-linux-sizes.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

При использовании чередования дисков данных Azure придерживайтесь следующих рекомендаций:

* Диски данных всегда должны иметь максимальный размер (1023 ГБ).
* Присоединяйте столько дисков данных, сколько позволяет размер виртуальной машины.
* Используйте конфигурацию дисковых пространств.
* Используйте конфигурацию чередования дисков.
* Избегайте кэширования дисков данных Azure (для политики кэширования нужно выбрать параметр "Нет").

Дополнительные сведения см. в статье [Дисковые пространства: повышение производительности](http://social.technet.microsoft.com/wiki/contents/articles/15200.storage-spaces-designing-for-performance.aspx).

### <a name="multiple-storage-accounts"></a>Несколько учетных записей хранения
Использование нескольких учетных записей хранения для поддержки дисков, сопоставленных с несколькими виртуальными машинами, гарантирует, что общий объем вводимых и выводимых данных на этих дисках будет намного ниже целевых показателей масштабируемости для каждой из этих учетных записей.

Корпорация Майкрософт рекомендует для начала развернуть по одной виртуальной машине на каждую учетную запись хранения.

### <a name="storage-layout-design"></a>Проектирование структуры хранилища
Чтобы можно было реализовать эти стратегии создания дисковой подсистемы виртуальных машин высокой производительности, для рабочей нагрузки ИТ-среды или ИТ-инфраструктуры обычно используется несколько учетных записей хранения. В них размещаются несколько больших двоичных объектов виртуальных жестких дисков. В некоторых случаях с одним томом на виртуальной машине сопоставляются несколько больших двоичных объектов.

Это может усложнить задачи управления. Крайне важно разработать удачную стратегию хранения, включая соответствующие имена дисков и сопоставленных больших двоичных объектов для виртуальных жестких дисков.

### <a name="implementation-guidelines-recap-for-storage"></a>Обзор рекомендаций по реализации, касающихся хранилищ
Решения

* Требуется ли чередование для создания дисков размером более 500 ТБ?
* Требуется ли чередование дисков для достижения оптимальной производительности рабочей нагрузки?
* Какие учетные записи хранения необходимы для размещения рабочей нагрузки в ИТ-среде или ИТ-инфраструктуры?

Задача

* Создать набор учетных записей хранения с использованием соглашения об именовании. Вы можете использовать портал Azure, классический портал Azure или командлет PowerShell ( **New-AzureStorageAccount** ).

## <a name="4-cloud-services"></a>4. Облачных служб
Облачные службы являются в системе Azure стандартным строительным блоком для управления службами PaaS и IaaS. В случае PaaS облачные службы представляют группу ролей, экземпляры которых могут взаимодействовать между собой. Облачные службы сопоставлены с общедоступным виртуальным IP-адресом и подсистемой балансировки нагрузки, которая принимает входящий трафик из Интернета и балансирует его нагрузку для ролей, настроенных на прием этого трафика.

В случае IaaS облачные службы предоставляют аналогичные функции, хотя в большинстве случаев возможности подсистемы балансировки нагрузки используются для перенаправления трафика из Интернета в определенные TCP- или UDP-порты на нескольких виртуальных машинах в облачных службах.

> [!NOTE]
> В диспетчере ресурсов Azure отсутствуют облачные службы. Чтобы ознакомиться с преимуществами использования Resource Manager, см. общие сведения о [поставщиках вычислительных и сетевых ресурсов, а также ресурсов хранения Azure в Azure Resource Manager](../articles/virtual-machines/virtual-machines-windows-compare-deployment-models.md).
> 
> 

Имена облачных служб особо важны для IaaS, так как Azure использует их как составляющую соглашения об именовании по умолчанию для дисков. Имя облачной службы может содержать только буквы, цифры и дефисы. Первый и последний символ в поле должны быть буквами или цифрами.

Azure показывает имена облачных служб в домене cloudapp.net, так как они сопоставлены с виртуальным IP-адресом. Для удобства пользователя приложения следует выбрать запоминающееся имя вместо полного имени облачной службы. Обычно это делается с помощью записи CNAME в общедоступном DNS-сервере, который сопоставляет общедоступное DNS-имя ресурса (например, www.contoso.com) с DNS-именем облачной службы, в которой размещается ресурс (например, облачной службы с веб-серверами для www.contoso.com).

Кроме того, может потребоваться, чтобы соглашение об именовании для облачных служб допускало исключения, так как имена облачных служб должны быть уникальными и отличаться от всех остальных облачных служб Microsoft Azure независимо от клиента Microsoft Azure.

Одним важным ограничением облачных служб, которое следует учитывать, является то, что за раз можно выполнять только одну операцию управления виртуальной машиной в облачной службе. При выполнении операции управления на одной виртуальной машине в облачной службе вам следует дождаться ее завершения, прежде чем начинать следующую операцию управления на другой виртуальной машине. Поэтому в облачной службе следует хранить небольшое количество виртуальных машин.

Подписки на Azure могут поддерживать до 200 облачных служб.

### <a name="implementation-guidelines-recap-for-cloud-services"></a>Обзор рекомендаций по реализации, касающихся облачных служб
Решение

* Какие облачные службы необходимы для размещения рабочей нагрузки в ИТ-среде или ИТ-инфраструктуры?

Задача

* Создать набор облачных служб с использованием соглашения об именовании. Вы можете использовать классический портал Azure или командлет PowerShell ( **New-AzureService** ).

## <a name="5-virtual-networks"></a>5. виртуальные сети;
Следующий логический шаг — создание виртуальных сетей, необходимых для поддержки взаимодействия между виртуальными машинами в решении. Несмотря на то, что несколько виртуальных машин для рабочей нагрузки ИТ-среды можно разместить в одной облачной службе, рекомендуется использовать виртуальные сети.

Виртуальные сети — это контейнер для виртуальных машин, для которого также можно указать подсети, пользовательские адреса и параметры конфигурации DNS. Виртуальные машины в одной виртуальной сети могут взаимодействовать непосредственно с другими компьютерами в той же виртуальной сети независимо от того, в какие облачные службы они входят. В виртуальной сети это взаимодействие остается закрытым, и общедоступные конечные точки при этом не используются. Это взаимодействие может происходить с использованием IP-адреса или имени, с помощью DNS-сервера, установленного в виртуальной сети или локально, если виртуальная машина подключена к корпоративной сети.

### <a name="site-connectivity"></a>Подключение сайтов
Если локальным пользователям и компьютерам не требуется постоянное подключение к виртуальным машинам в виртуальной сети Azure, создайте виртуальную сеть только в облаке.

![](./media/virtual-machines-common-infrastructure-service-guidelines/vnet01.png)

Как правило, это практикуется при таких рабочих нагрузках, когда необходимо подключение к Интернету, например, в случае веб-серверов. Вы можете управлять этими виртуальными машинами с помощью подключений к удаленному рабочему столу, удаленных сеансов PowerShell, подключений Secure Shell (SSH) и VPN-подключений типа "точка-сеть".

Облачные виртуальные сети могут использовать любую часть пространства внутренних IP-адресов, так как они не подключаются к локальной сети.

Если локальным пользователям и компьютерам необходимо постоянное подключение к виртуальным машинам в виртуальной сети Azure, создайте распределенную виртуальную сеть и подключите ее к локальной сети с помощью ExpressRoute или VPN-подключения типа "сеть-сеть".

![](./media/virtual-machines-common-infrastructure-service-guidelines/vnet02.png)

В этой конфигурации виртуальная сеть Azure по сути является облачным расширением локальной сети.

Так как распределенные виртуальные сети подключаются к локальной сети, они должны использовать уникальную часть используемого организацией адресного пространства, а инфраструктура маршрутизации должна поддерживать отправку трафика в эту часть путем его перенаправления на локальное VPN-устройство.

Чтобы разрешить передачу пакетов из распределенной виртуальной сети в локальную сеть, необходимо настроить набор соответствующих префиксов локальных адресов в рамках определения локальной сети для виртуальной сети. В зависимости от адресного пространства виртуальной сети и набора соответствующих локальных расположений, в локальной сети может быть много префиксов адресов.

Облачную виртуальную сеть можно преобразовать в распределенную, но для этого, скорее всего, потребуется повторная нумерация адресного пространства виртуальной сети, подсетей и виртуальных машин, использующих назначенные для Azure статические IP-адреса, также называемые динамическими IP-адресами (DIP). Следовательно, необходимо точно определить, какой тип виртуальных сетей нужен (облачные или распределенные), прежде чем создавать их.

### <a name="subnets"></a>Подсети
Подсети позволяют упорядочивать связанные ресурсы либо логически (например, одна подсеть для виртуальных машин, сопоставленных с одним приложением), либо физически (например, одна подсеть для каждой облачной службы), а также использовать методы изоляции подсетей для повышения безопасности.

В случае распределенных виртуальных сетей необходимо проектировать подсети по тем же правилам, которые используются для локальных ресурсов, учитывая, что **Azure всегда использует первые три IP-адреса в адресном пространстве для каждой подсети**. Чтобы определить количество адресов, необходимых для подсети, посчитайте виртуальные машины, которые необходимы сейчас, рассчитайте дальнейший рост, а затем используйте следующую таблицу для определения размера подсети.

| Необходимое количество виртуальных машин | Необходимое количество битов узла | Размер подсети |
| --- | --- | --- |
| 1–3 |3 |/29 |
| 4–11 |4 |/28 |
| 12–27 |5 |/27 |
| 28–59 |6 |/26 |
| 60–123 |7 |/25 |

> [!NOTE]
> В случае обычной локальной подсети с n битов узла максимальное количество адресов узла составляет 2<sup>n</sup> – 2. В случае подсети Azure с n битов узла максимальное количество адресов узла составляет 2<sup>n</sup> – 5 (2 плюс 3 в случае адресов, используемых Azure в каждой подсети).
> 
> 

Если выбранный размер подсети слишком мал, потребуются повторные нумерация и развертывание виртуальных машин в подсети.

### <a name="implementation-guidelines-recap-for-virtual-networks"></a>Обзор рекомендаций по реализации, касающихся виртуальных сетей
Решения

* Какой тип виртуальной сети необходим, чтобы разместить рабочую нагрузку ИТ-среды или ИТ-инфраструктуру (облачная или распределенная)?
* Какое адресное пространство необходимо для размещения подсетей и виртуальных машин сейчас и при будущем целесообразном расширении, если используются распределенные виртуальные сети?

Задачи

* Определить адресное пространство виртуальной сети.
* Определить набор подсетей и адресного пространства для каждой из них.
* Если используются распределенные виртуальные сети, определите набор адресных пространств локальной сети для локальных расположений, доступ к которым необходим виртуальным машинам в виртуальной сети.
* Создайте виртуальную сеть, следуя соглашению об именовании. Вы можете использовать портал Azure или классический портал Azure.

## <a name="6-availability-sets"></a>6. Группы доступности
При использовании модели PaaS в Azure облачные службы содержат одну или несколько ролей, выполняющих код приложений. Для ролей могут быть предусмотрены один или несколько экземпляров виртуальных машин, которые автоматически подготавливаются структурой. Azure может обновлять экземпляры, предусмотренные для этих ролей, в любой момент, но так как они относятся к одной и той же роли, Azure не обновляет все экземпляры одновременно во избежание перерыва в обслуживании.

При использовании модели IaaS в Azure понятие роли не имеет значения, так как каждая виртуальная машина IaaS представляет роль с одним экземпляром. Чтобы запретить Azure останавливать работу сразу нескольких сопоставленных виртуальных машин (например, для обновления операционной системы узлов, на которых они развернуты), было введено понятие групп доступности. Группа доступности не позволяет Azure останавливать работу всех виртуальных машин, входящих в такую группу, одновременно, чтобы не было перерыва в обслуживании. На виртуальные машины в группе доступности действует соглашение об уровне обслуживания, предусматривающее непрерывную работу в течение 99,95 % времени.

Группы доступности необходимо учитывать при планировании решения с высоким уровнем доступности. Группа доступности определяется как набор виртуальных машин в одной облачной службе, для которых указаны одинаковые имена группы доступности. Группы доступности можно создать после создания облачных служб.

### <a name="implementation-guidelines-recap-for-availability-sets"></a>Обзор рекомендаций по реализации, касающиеся групп доступности
Решение

* Сколько нужно групп доступности для различных ролей и уровней, предусмотренных для рабочей нагрузки ИТ-среды или ИТ-инфраструктуры?

Задача

* Определить набор групп доступности, следуя соглашению об именовании. Вы можете сопоставить виртуальную машину с группой доступности при создании виртуальной машины или после этого.

## <a name="7-virtual-machines"></a>7. Виртуальные машины
При использовании модели PaaS Azure управляет виртуальными машинами и сопоставленными с ними дисками. Вам следует создать облачные службы и роли, а также присвоить им имена, после чего Azure создает экземпляры, сопоставленные с этими ролями. В случае использования модели IaaS в Azure необходимо указать имена облачных служб, виртуальных машин и сопоставленных с ними дисков.

Чтобы снизить административную нагрузку, классический портал Azure использует имя компьютера в качестве имени по умолчанию для сопоставленной облачной службы (если пользователь решит создать облачную службу с помощью мастера создания виртуальных машин).

Кроме того, Azure присваивает имена дискам и их вспомогательным большим двоичным объектам виртуальных жестких дисков, используя сочетание имени облачной службы, имени компьютера и даты создания.

Обычно количество дисков значительно больше, чем количество виртуальных машин. При управлении виртуальными машинами необходимо соблюдать осторожность, чтобы избежать их потери для дисков. Кроме того, вы можете удалять диски, не удаляя вспомогательный большой двоичный объект. В таком случае большой двоичный объект остается в учетной записи хранения, пока он не будет удален вручную.

### <a name="implementation-guidelines-recap-for-virtual-machines"></a>Обзор рекомендаций по реализации, касающихся виртуальных машин
Решение

* Сколько виртуальных машин необходимо предоставить для рабочей нагрузки ИТ-среды или ИТ-инфраструктуры?

Задачи

* Определить имя каждой виртуальной машины, следуя соглашению об именовании.
* Вы можете создать виртуальные машины с помощью портала Azure, классического портала Azure, командлета PowerShell **New-AzureVM** , Azure CLI или шаблонов диспетчера ресурсов.

## <a name="example-of-an-it-workload-the-contoso-financial-analysis-engine"></a>Пример рабочей нагрузки ИТ-среды: система финансового анализа Contoso
Корпорация Contoso разработала систему финансового анализа нового поколения на основе собственных передовых алгоритмов, упрощающих торговлю на фьючерсной бирже. Эта система должна быть доступна клиентам корпорации благодаря набору серверов в Azure, содержащему следующее:

* Два (в дальнейшем — больше) веб-сервера на основе IIS с настраиваемыми веб-службами на уровне сети.
* Два (в дальнейшем — больше) сервера приложений на основе IIS, выполняющих вычисления на уровне приложений.
* Кластер SQL Server 2014 с группами доступности AlwaysOn (два сервера SQL Server и следящий сервер основных узлов), в котором хранятся данные журнала и данные о текущих вычислениях на уровне базы данных.
* Два контроллера домена Active Directory для автономных леса и домена на уровне проверки подлинности, что необходимо для кластеризации SQL Server.
* Все серверы располагаются в двух подсетях: подсети переднего плана для веб-серверов и внутренней подсети для серверов приложений, кластера SQL Server 2014 и контроллеров домена.

![](./media/virtual-machines-common-infrastructure-service-guidelines/example-tiers.png)

В случае защищенного входящего веб-трафика от клиентов Contoso через Интернет необходима балансировка нагрузки для веб-серверов. Трафик запросов на вычисления в виде HTTP-запросов с веб-серверов должен быть распределен между серверами приложений. Кроме того, система должна быть рассчитана на высокий уровень доступности.

В результате проект должен включать:

* подписку на Azure и учетную запись Azure для Contoso;
* учетные записи хранения;
* виртуальную сеть с двумя подсетями;
* группы доступности для групп серверов с аналогичной ролью;
* Виртуальные машины
* одну группу ресурсов.

Все вышеуказанное должно соответствовать соглашению об именовании Contoso.

* В Contoso используется префикс [рабочая нагрузка ИТ-среды]-[расположение]-[ресурс Azure]. В этом примере azfae (система финансового анализа Azure) — это имя рабочей нагрузки ИТ-среды, а use (восточная часть США 2) — это расположение, так как большинство первых клиентов компании Contoso проживают на восточном побережье США.
* Для учетных записей хранения используется формат contosoazfaeusesa[описание]. Обратите внимание, что для уникальности к префиксу добавлено слово contoso, а имена учетных записей хранения не могут содержать дефисы.
* Для виртуальных сетей используется формат AZFAE-USE-VN[номер].
* Для групп доступности используется формат azfae-use-as-[роль].
* Для имен виртуальных машин используется формат azfae-use-vm-[имя_виртуальной_машины].

### <a name="azure-subscriptions-and-accounts"></a>Подписки на Azure и учетные записи Azure
Компания Contoso использует подписку Enterprise Subscription под названием "Enterprise Subscription Contoso" для выставления счетов по этой рабочей нагрузке ИТ-среды.

### <a name="storage-accounts"></a>учетные записи хранения;
Компании Contoso нужны две учетных записи хранения:

* **contosoazfaeusesawebapp** в качестве обычного хранилища для веб-серверов, серверов приложений, контроллеров доменов и дополнительных дисков с данными.
* **contosoazfaeusesasqlclust** в случае хранилище Premium для кластера SQL Server и дополнительных дисков с данными.

### <a name="a-virtual-network-with-subnets"></a>Виртуальная сеть с подсетями
Так как виртуальная сеть не требует постоянного подключения к локальной сети Contoso, компания Contoso выбрала облачную виртуальную сеть.

Облачная виртуальная сеть создана на портале Azure с указанием следующих параметров:

* Имя: AZFAE-USE-VN01.
* Расположение: восточная часть США 2.
* Адресное пространство виртуальной сети: 10.0.0.0/8.
* Первая подсеть:
  * Имя: FrontEnd.
  * Адресное пространство: 10.0.1.0/24.
* Вторая подсеть:
  * Имя: BackEnd.
  * Адресное пространство: 10.0.2.0/24.

### <a name="availability-sets"></a>Группы доступности
Чтобы обеспечить высокий уровень доступности всех четырех уровней системы финансового анализа, компания Contoso использует четыре группы доступности:

* **azfae-use-as-dc** для контроллеров домена;
* **azfae-use-as-web** для веб-серверов;
* **azfae-use-as-app** для серверов приложений;
* **azfae-use-as-sql** для серверов в кластере SQL Server.

Эти группы доступности будут созданы вместе с виртуальными машинами.

### <a name="virtual-machines"></a>Виртуальные машины
Компания Contoso использует следующие имена для своих виртуальных машин Azure:

* **azfae-use-vm-dc01** для первого контроллера домена;
* **azfae-use-vm-dc02** для второго контроллера домена;
* **azfae-use-vm-web01** для первого веб-сервера;
* **azfae-use-vm-web02** для второго веб-сервера;
* **azfae-use-vm-app01** для первого сервера приложений;
* **azfae-use-vm-app02** для второго сервера приложений;
* **azfae-use-vm-sql01** для первого сервера SQL в кластере SQL Server;
* **azfae-use-vm-sql02** для второго сервера SQL в кластере SQL Server;
* **azfae-use-vm-sqlmn01** для следящего сервера основных узлов в кластере SQL Server.

Это конфигурация, которая получается в результате.

![](./media/virtual-machines-common-infrastructure-service-guidelines/example-config.png)

Эта конфигурация включает:

* облачную виртуальную сеть с двумя подсетями (FrontEnd и BackEnd);
* две учетные записи хранения;
* четыре группы доступности, по одной для каждого уровня системы финансового анализа;
* виртуальные машины для четырех уровней;
* внешний набор с балансировкой нагрузки для веб-трафика HTTPS из Интернета на веб-серверы;
* внешний набор с балансировкой нагрузки для незашифрованного веб-трафика с веб-серверов на серверы приложений.
* одну группу ресурсов.

## <a name="additional-resources"></a>Дополнительные ресурсы
[Лимиты, квоты и ограничения подписки и обслуживания Microsoft Azure](../articles/azure-subscription-service-limits.md#storage-limits)

[Размеры виртуальных машин](../articles/virtual-machines/virtual-machines-linux-sizes.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

[Целевые показатели масштабируемости и производительности хранилища Azure](../articles/storage/storage-scalability-targets.md)

[Примерная диаграмма архитектуры для расширения центра данных](https://gallery.technet.microsoft.com/Datacenter-extension-687b1d84)

[Поставщики вычислительных и сетевых ресурсов, а также ресурсов хранения Azure в диспетчере ресурсов Azure](../articles/virtual-machines/virtual-machines-windows-compare-deployment-models.md)



<!--HONumber=Jan17_HO3-->


