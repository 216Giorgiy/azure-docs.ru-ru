#Настройка пользовательского имени домена для веб-сайта Azure

При создании веб-сайта Azure предоставляет дочерний домен (поддомен) с понятным именем в домене azurewebsites.net, поэтому пользователи могут получить доступ к вашему веб-сайту, используя такой URL-адрес, как http://&lt;mysite>.azurewebsites.net. Однако, если настроить веб-сайты для режима общего доступа или стандартного режима, можно сопоставить ваш веб-сайт с вашим собственным именем домена.

При необходимости можно использовать Azure Traffic Manager для балансировки нагрузки входящего трафика на вашем веб-сайте. Дополнительные сведения о работе Traffic Manager с веб-сайтами Azure см. в статье [Управление трафиком веб-сайтов Azure с помощью Azure Traffic Manager][trafficmanager].

> [WACOM.NOTE] Процедуры в этой задаче применяются к веб-сайтам Azure; для облачных служб см. раздел <a href="http://www.windowsazure.com/ru-ru/develop/net/common-tasks/custom-dns/">Настройка имени пользовательского домена в Azure</a>.

> [WACOM.NOTE] Для выполнения действий в этой задаче требуется настроить веб-сайты для режима общего доступа или стандартного режима, что может повлиять на стоимость вашей подписки. Дополнительные сведения см. в разделе <a href="http://www.windowsazure.com/ru-ru/pricing/details/web-sites/">Сведения о ценах — веб-сайты</a>.

Содержание:

-   [Что такое записи CNAME и A](#understanding-records)
-   [Настройка веб-сайтов для режима общего доступа или стандартного режима](#bkmk_configsharedmode)
-   [Добавление веб-сайтов в Traffic Manager](#trafficmanager)
-   [Добавление записи CNAME для пользовательского домена](#bkmk_configurecname)
-   [Добавление записи A для пользовательского домена](#bkmk_configurearecord)

<h2><a name="understanding-records"></a>Что такое записи CNAME и A</h2>

И записи CNAME (или записи псевдонимов), и записи А позволяют связать имя домена с веб-сайтом, однако работают они по-разному.

###Запись CNAME, или запись псевдонима

Запись CNAME сопоставляет *конкретный* домен, такой как **contoso.com** или **www.contoso.com**, с каноническим именем домена. В этом случае каноническим именем домена является имя домена **&lt;myapp>.azurewebsites.net** веб-сайта Azure или доменное имя **&lt;myapp>.trafficmgr.com** профиля Traffic Manager. После создания запись CNAME создает псевдоним для имени домена **&lt;myapp>.azurewebsites.net** или **&lt;myapp>.trafficmgr.com**. Запись CNAME будет автоматически разрешаться в IP-адрес имени вашего домена **&lt;myapp>.azurewebsites.net** или **&lt;myapp>.trafficmgr.com**, поэтому при изменении IP-адреса веб-сайта не нужно предпринимать никаких действий.

> [WACOM.NOTE] Некоторые регистраторы доменов позволяют сопоставлять дочерние домены только при использовании записи CNAME, например www.contoso.com, а не корневых имен, таких как contoso.com. Дополнительные сведения о записи CNAME см. в документации вашего регистратора, <a href="http://en.wikipedia.org/wiki/CNAME_record">в информации Википедии о записи CNAME</a> или в документе <a href="http://tools.ietf.org/html/rfc1035">Имена доменов IETF - реализация и спецификация</a>.

###Запись А

Запись A сопоставляет домен, например **contoso.com**, или **www.contoso.com**, *или домен с подстановочными знаками*, такими как **\*.contoso.com**, с IP-адресом. В случае веб-сайта Azure это либо виртуальный IP-адрес службы, либо конкретный IP-адрес, который был приобретен для веб-сайта. Так что основным преимуществом записи А перед записью CNAME является то, что у вас может быть одна запись, использующая подстановочные знаки, например ***.contoso.com**, которая будет обрабатывать запросы для нескольких дочерних доменов, например **mail.contoso.com**, **login.contoso.com** или **www.contso.com**.

> [WACOM.NOTE] Поскольку запись А сопоставляется со статическим IP-адресом, она не может автоматически разрешаться в IP-адрес вашего веб-сайта. IP-адрес для использования с записями А предоставляется при настройке параметров имени пользовательского домена для веб-сайта; однако это значение может измениться, если удалить и заново создать веб-сайт или изменить режим веб-сайта снова на бесплатный.

> [WACOM.NOTE] Записи A не могут использоваться для балансировки с помощью Traffic Manager. Дополнительные сведения см. в разделе [Управление трафиком веб-сайтов Azure с помощью Azure Traffic Manager][trafficmanager].
 
<a name="bkmk_configsharedmode"></a><h2>Настройка веб-сайтов для режима общего доступа или стандартного режима</h2>

Задание имени пользовательского домена на веб-сайте доступно только для режима общего доступа и стандартного режимов для веб-сайтов Azure. Прежде чем перевести веб-сайт с бесплатного режима на режим общего доступа или стандартный режим, необходимо сначала снять существующие ограничения расходов, установленные для вашей подписки на веб-сайт. Дополнительные сведения о ценах на общий и стандартный режим см. в разделе [Сведения о ценах][PricingDetails].

1. Откройте в браузере [портал управления][portal].
2. На вкладке **Веб-сайты** щелкните имя вашего сайта.

	![][standardmode1]

3. Щелкните вкладку **МАСШТАБ**.

	![][standardmode2]

	
4. В разделе **Общие** установите режим веб-сайта, щелкнув **ОБЩИЙ ДОСТУП**.

	![][standardmode3]

	> [WACOM.NOTE] При использовании Traffic Manager с этим веб-сайтом необходимо выбрать стандартный режим вместо режима общего доступа.

5. Щелкните **Сохранить**.
6. При появлении запроса об увеличении затрат при переходе к режиму общего доступа (или стандартному режиму, если вы выбрали этот режим) нажмите кнопку **Да**, если вы согласны.

	<!--![][standardmode4]-->

	**Примечание**<br /> 
	Если появляется ошибка "Не выполнена настройка масштабирования для веб-сайта "имя веб-сайта"", для получения дополнительных сведений можно использовать кнопку "Сведения". 

<a name="trafficmanager"></a><h2>(Необязательно) Добавление веб-сайтов в Traffic Manager</h2>

Если вы хотите использовать веб-сайт с Traffic Manager, выполните следующие действия.

1. Если профиля Traffic Manager еще нет, используйте для его создания сведения из раздела [Создание профиля Traffic Manager с помощью "Быстрого создания"][createprofile]. Запомните доменное имя **.trafficmgr.com**, связанное с профилем Traffic Manager. Оно будет использоваться в дальнейшем.

2. Используйте сведения из раздела [Добавление и удаление конечных точек][addendpoint] для добавления вашего веб-сайта в качестве конечной точки в ваш профиль Traffic Manager.

	> [WACOM.NOTE] Если ваш веб-сайт не отображается при добавлении конечной точки, убедитесь, что он настроен для стандартного режима. Стандартный режим для веб-сайта следует использовать для работы с помощью диспетчера трафика.

3. Войдите на веб-сайт своего регистратора DNS и перейдите на страницу управления DNS. Найдите ссылки или области сайта, обозначенные как **Имя домена**, **DNS** или **Управление сервером доменных имен**.

4. Теперь найдите место, где можно выбрать или ввести записи CNAME. Может потребоваться выбрать тип записи из раскрывающегося списка или перейти на страницу дополнительных параметров. Ищите слова **CNAME**, **Псевдоним** или **Поддомены**.

5. Необходимо также указать псевдоним домена или поддомена для CNAME. Например, выберите **www**, если вы хотите создать псевдоним для **www.customdomain.com**.

5. Необходимо также указать имя узла, которое является каноническим именем домена для этого псевдонима CNAME. Это имя **.trafficmgr.com** для вашего веб-сайта.

Например, следующая запись CNAME перенаправляет весь трафик из **www.contoso.com** в **contoso.trafficmgr.com**, имя домена веб-сайта:

<table border="1" cellspacing="0" cellpadding="5" style="border: 1px solid #000000;">
<tr>
<td><strong>Псевдоним/Имя узла/Поддомен</strong></td>
<td><strong>Канонический домен</strong></td>
</tr>
<tr>
<td>www</td>
<td>contoso.trafficmgr.com</td>
</tr>
</table>

Посетитель сайта **www.contoso.com** никогда не увидит настоящий узел (contoso.azurewebsite.net), поэтому процесс перенаправления невидим для конечного пользователя.

> [WACOM.NOTE] Если вы используете Traffic Manager с веб-сайтом, нет необходимости выполнять действия, описанные в следующих разделах **Добавление записи CNAME для пользовательского домена** и **Добавление записи A для своего пользовательского домена**. Запись CNAME, созданная на предыдущих этапах, маршрутизирует входящий трафик в Traffic Manager, который затем направляет трафик на конечные точки веб-сайта.

<a name="bkmk_configurecname"></a><h2>Добавление записи CNAME для пользовательского домена</h2>

Чтобы создать запись CNAME, необходимо с помощью средств, предоставленных вашим регистратором, добавить в таблице DNS новую запись для пользовательского домена. Каждый регистратор имеет похожий, но немного отличный способ указания записи CNAME, хотя используется одна и та же концепция.

1. Чтобы найти имя домена **.azurewebsite.net**, назначенное для вашего веб-сайта, используйте один из следующих методов.

	* Войдите на [портал управления Azure][portal], выберите ваш веб-сайт, выберите **Панель мониторинга** и найдите **URL-адрес сайта** в разделе **Сводка**.

	* Установите и настройте [Powershell Azure](http://www.windowsazure.com/ru-ru/manage/install-and-configure-windows-powershell/), а затем используйте следующую команду:

			get-azurewebsite yoursitename | select hostnames

	*Установите и настройте [Межплатформенный интерфейс командной строки Azure](http://www.windowsazure.com/ru-ru/manage/install-and-configure-cli/), а затем выполните следующую команду:

			azure site domain list yoursitename

	Сохраните это имя **.azurewebsite.net**, так как оно будет использоваться при выполнении следующих действий.

3. Войдите на веб-сайт своего регистратора DNS и перейдите на страницу управления DNS. Найдите ссылки или области сайта, обозначенные как **Имя домена**, **DNS** или **Управление сервером доменных имен**.

4. Теперь найдите место, где можно выбрать или ввести записи CNAME. Может потребоваться выбрать тип записи из раскрывающегося списка или перейти на страницу дополнительных параметров. Ищите слова **CNAME**, **Псевдоним** или **Поддомены**.

5. Необходимо также указать псевдоним домена или поддомена для CNAME. Например, выберите **www**, если вы хотите создать псевдоним для **www.customdomain.com**. Если вы хотите создать псевдоним для корневого домена, он может отображаться как символ "**@**" в средствах DNS вашего регистратора.

5. Необходимо также указать имя узла, которое является каноническим именем домена для этого псевдонима CNAME. Это имя **.azurewebsite.net** для вашего веб-сайта.

Например, следующая запись CNAME перенаправляет весь трафик из **www.contoso.com** в **contoso.azurewebsite.net**, имя домена веб-сайта:

<table border="1" cellspacing="0" cellpadding="5" style="border: 1px solid #000000;">
<tr>
<td><strong>Псевдоним/Имя узла/Поддомен</strong></td>
<td><strong>Канонический домен</strong></td>
</tr>
<tr>
<td>www</td>
<td>contoso.azurewebsite.net</td>
</tr>
</table>

Посетитель сайта **www.contoso.com** никогда не увидит настоящий узел (contoso.azurewebsite.net), поэтому процесс перенаправления невидим для конечного пользователя.

> [WACOM.NOTE] Приведенный выше пример применим только к трафику дочернего домена __www__. Поскольку с записями CNAME нельзя использовать подстановочные знаки, необходимо создать один CNAME для каждого домена или поддомена. Если вы хотите направить трафик из поддоменов, таких как *.contoso.com,, на адрес azurewebsite.net, можно настроить элемент __URL-адрес перенаправления__ или __URL-адрес переадресации__ в настройках DNS или создать запись A.

> [WACOM.NOTE] Распространение CNAME через систему DNS может занять некоторое время. Нельзя задать запись CNAME для веб-сайта до завершения распространения записи CNAME. Чтобы проверить доступность CNAME, можно воспользоваться службой, например <a href="http://www.digwebinterface.com/">http://www.digwebinterface.com/</a>.

###Добавление имени домена на веб-сайт

После завершения распространения записи CNAME для имени домена необходимо связать ее с веб-сайтом. Можно добавить пользовательское имя домена, определенное записью CNAME, на веб-сайт либо с помощью межплатформенного интерфейса командной строки Azure, либо с помощью портала управления Azure.

**Добавление имени домена с помощью средств командной строки**

Установите и настройте [межплатформенный интерфейс командной строки Azure](http://www.windowsazure.com/ru-ru/manage/install-and-configure-cli/), а затем выполните следующую команду:

	azure site domain add customdomain yoursitename

Например, следующая команда добавит пользовательское имя домена **www.contoso.com** на веб-сайт **contoso.azurewebsite.net**:

	azure site domain add www.contoso.com contoso

С помощью следующей команды можно проверить, что пользовательское имя домена было добавлено на веб-сайт:

	azure site domain list yoursitename

Список, возвращаемый этой командой, должен содержать пользовательское имя домена, а также запись по умолчанию **.azurewebsite.net**.

**Добавление имени домена с помощью портала управления Azure**

1. Откройте в браузере [портал управления Azure][portal].

2. На вкладке **Веб-сайты** щелкните имя вашего веб-сайта, выберите **Панель мониторинга**, а затем выберите **Управление доменами** в нижней части страницы.

	![][setcname2]

6. В текстовом поле **ИМЕНА ДОМЕНОВ** введите имя домена, которое было настроено. 

	![][setcname3]

6. Щелкните флажок, чтобы принять имя домена.

После завершения настройки пользовательское имя домена будет указано в разделе **имен доменов** страницы **Настройка** веб-сайта. 

<a name="bkmk_configurearecord"></a><h2>Добавление записи A для пользовательского домена</h2>

Чтобы создать запись А, сначала необходимо найти IP-адрес веб-сайта. Затем необходимо с помощью средств, предоставленных вашим регистратором, добавить в таблице DNS запись для пользовательского домена. Каждый регистратор имеет похожий, но немного отличный способ указания записи А, хотя используется одна и та же концепция. Кроме записи А, необходимо также создать запись CNAME, которую Azure использует для проверки записи А.

1. Откройте в браузере [портал управления Azure][portal].

2. На вкладке **Веб-сайты** щелкните имя веб-сайта, выберите **Панель мониторинга**, а затем выберите **Управление доменами** в нижней части экрана.

	![][setcname2]

5. В диалоговом окне **Управление пользовательскими доменами** найдите **IP-адрес для настройки записи А**. Скопируйте IP-адрес. Он будет использоваться при создании записи А.

5. В диалоговом окне **Управление пользовательскими доменами** обратите внимание на имя домена awverify в конце текста в верхней части диалогового окна. Оно должно быть **awverify.mysite.azurewebsites.net**, где **mysite** — имя вашего веб-сайта. Скопируйте его, поскольку это имя домена, используемое при создании проверочной записи CNAME.

6. Войдите на веб-сайт своего регистратора DNS и перейдите на страницу управления DNS. Найдите ссылки или области сайта, обозначенные как **Имя домена**, **DNS** или **Управление сервером доменных имен**.

6. Найдите место, где можно выбрать или ввести записи А и CNAME. Может потребоваться выбрать тип записи из раскрывающегося списка или перейти на страницу дополнительных параметров.

7. Выполните следующие действия, чтобы создать запись А:

	1. Выберите или введите домен или дочерний домен, который будет использовать эту запись А. Например, выберите **www**, если вы хотите создать псевдоним для **www.customdomain.com**. Если вы хотите создать запись с подстановочными знаками для всех поддоменов, введите "__*__". Так будут охвачены все поддомены, такие как **mail.customdomain.com**, **login.customdomain.com** и **www.customdomain.com**.

		Если вы хотите создать запись А для корневого домена, он может отображаться как символ "**@**" в средствах DNS вашего регистратора.

	2. Введите IP-адрес вашей облачной службы в предоставленном поле. Это связывает запись домена, используемую в записи А, с IP-адресом развертывания облачной службы.

		Например, следующая запись A перенаправляет весь трафик из **contoso.com** на **137.135.70.239**, IP-адрес развертываемого приложения:

		<table border="1" cellspacing="0" cellpadding="5" style="border: 1px solid #000000;">
		<tr>
		<td><strong>Имя узла/Поддомен</strong></td>
		<td><strong>IP-адрес</strong></td>
		</tr>
		<tr>
		<td>@</td>
		<td>137.135.70.239</td>
		</tr>
		</table>

		В этом примере показано создание записи А для корневого домена. Если вы хотите создать запись с подстановочными знаками, чтобы охватить все поддомены, введите "__*__" в качестве поддомена.

7. Теперь создайте запись CNAME с псевдонимом **awverify** и каноническим доменом **awverify.mysite.azurewebsites.net**, полученным ранее.

	> [WACOM.NOTE] Хотя псевдоним awverify может работать для некоторых регистраторов, другие могут требовать полное имя домена псевдонима awverify.www.customdomainname.com или awverify.customdomainname.com.

	Например, следующие операции создадут запись CNAME, которую Azure может использовать для проверки конфигурации записи A.

	<table border="1" cellspacing="0" cellpadding="5" style="border: 1px solid #000000;">
	<tr>
	<td><strong>Псевдоним/Имя узла/Поддомен</strong></td>
	<td><strong>Канонический домен</strong></td>
	</tr>
	<tr>
	<td>awverify</td>
	<td>awverify.contoso.azurewebsites.net</td>
	</tr>
	</table>

> [WACOM.NOTE] Распространение CNAME awverify через систему DNS может занять некоторое время. Невозможно задать пользовательское имя домена, определенное записью А, для веб-сайта до завершения распространения CNAME awverify. Чтобы проверить доступность CNAME, можно воспользоваться службой, например <a href="http://www.digwebinterface.com/">http://www.digwebinterface.com/</a>.

###Добавление имени домена на веб-сайт

После завершения распространения записи CNAME **awverify** для имени домена можно связать пользовательский домен, определенный записью А, с веб-сайтом. Пользовательское имя домена, определенное записью А, можно добавить к веб-сайту либо с помощью межплатформенного интерфейса командной строки Azure, либо с помощью портала управления Azure.

**Добавление имени домена с помощью средств командной строки**

Установите и настройте [межплатформенный интерфейс командной строки Azure](http://www.windowsazure.com/ru-ru/manage/install-and-configure-cli/), а затем выполните следующую команду:

	azure site domain add customdomain yoursitename

Например, следующая команда добавит пользовательское имя домена **contoso.com** на веб-сайт **contoso.azurewebsite.net**:

	azure site domain add contoso.com contoso

С помощью следующей команды можно проверить, что пользовательское имя домена было добавлено на веб-сайт:

	azure site domain list yoursitename

Список, возвращаемый этой командой, должен содержать пользовательское имя домена, а также запись по умолчанию **.azurewebsite.net**.

**Добавление имени домена с помощью портала управления Azure**

1. Откройте в браузере [портал управления Azure][portal].

2. На вкладке **Веб-сайты** щелкните имя вашего веб-сайта, выберите **Панель мониторинга**, а затем выберите **Управление доменами** в нижней части страницы.

	![][setcname2]

6. В текстовом поле **ИМЕНА ДОМЕНОВ** введите имя домена, которое было настроено. 

	![][setcname3]

6. Щелкните флажок, чтобы принять имя домена.

После завершения настройки пользовательское имя домена будет указано в разделе **имен доменов** страницы **Настройка** веб-сайта.

> [WACOM.NOTE] После добавления пользовательского имени домена, определенного записью A, на веб-сайт запись CNAME awverify можно удалить с помощью средств, предоставляемых регистратором. Однако, если вы хотите в будущем добавить другую запись А, необходимо заново создать запись awverify, прежде чем можно будет связать новое имя домена, определенное новой записью А, с веб-сайтом.

## Дальнейшие действия

-   [Как управлять веб-сайтами](http://www.windowsazure.com/ru-ru/manage/services/web-sites/how-to-manage-websites/)

-   [Настройка сертификата SSL для веб-сайтов](http://www.windowsazure.com/ru-ru/develop/net/common-tasks/enable-ssl-web-site/)


<!-- Bookmarks -->

[Настройка веб-сайтов для режима общего доступа]: #bkmk_configsharedmode
[Настройка записи CNAME на сайте регистратора домена]: #bkmk_configurecname
[Настройка записи проверки CNAME на сайте регистратора домена]: #bkmk_configurecname
[Настройка записи A для имени домена]:#bkmk_configurearecord
[Настройка имени домена на портале управления]: #bkmk_setcname

<!-- Links -->

[PricingDetails]: https://www.windowsazure.com/ru-ru/pricing/details/
[portal]: http://manage.windowsazure.com
[digweb]: http://www.digwebinterface.com/
[cloudservicedns]: ../custom-dns/
[trafficmanager]: /ru-ru/documentation/articles/web-sites-traffic-manager/
[addendpoint]: http://msdn.microsoft.com/ru-ru/library/windowsazure/hh744839.aspx
[createprofile]: http://msdn.microsoft.com/ru-ru/library/windowsazure/dn339012.aspx

<!-- images -->

[setcname1]: ../media/dncmntask-cname-5.png


<!-- images -->
[standardmode1]: ./media/custom-dns-web-site/dncmntask-cname-1.png
[standardmode2]: ./media/custom-dns-web-site/dncmntask-cname-2.png
[standardmode3]: ./media/custom-dns-web-site/dncmntask-cname-3.png
[standardmode4]: ./media/custom-dns-web-site/dncmntask-cname-4.png 


[setcname2]: ./media/custom-dns-web-site/dncmntask-cname-6.png
[setcname3]: ./media/custom-dns-web-site/dncmntask-cname-7.png

