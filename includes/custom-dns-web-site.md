# Настройка пользовательского имени домена для веб-сайта Azure

При создании веб-сайта Azure предоставляет удобный поддомен в домене azurewebsites.net, чтобы пользователи могли обращаться к веб-сайту с помощью URL-адреса вида [http://\<мой\_сайт][http://\<мой\_сайт]\>.azurewebsites.net. Однако, если ваш веб-сайт настроен для общего или стандартного режима, вы можете сопоставить его с собственным именем домена.

При необходимости можно использовать Azure Traffic Manager для балансировки нагрузки входящего трафика на вашем веб-сайте. Дополнительные сведения о работе Traffic Manager с веб-сайтами Azure см. в статье [Управление трафиком веб-сайтов Azure с помощью Azure Traffic Manager][Управление трафиком веб-сайтов Azure с помощью Azure Traffic Manager].

> [WACOM.NOTE] Процедуры в этой задаче применяются к веб-сайтам Azure, для облачных служб см. раздел [Настройка имени пользовательского домена в Azure][Настройка имени пользовательского домена в Azure].

> [WACOM.NOTE] Для выполнения действий в этой задаче требуется настроить веб-сайты для режима общего доступа или стандартного режима, что может повлиять на стоимость вашей подписки. Дополнительные сведения см. в разделе [Сведения о ценах — веб-сайты][Сведения о ценах — веб-сайты].

Содержание:

-   [Что такое записи CNAME и A][Что такое записи CNAME и A]
-   [Настройка веб-сайтов для режима общего доступа или стандартного режима][Настройка веб-сайтов для режима общего доступа или стандартного режима]
-   [Добавление веб-сайтов в Traffic Manager][Добавление веб-сайтов в Traffic Manager]
-   [Добавление записи CNAME для пользовательского домена][Добавление записи CNAME для пользовательского домена]
-   [Добавление записи A для пользовательского домена][Добавление записи A для пользовательского домена]

## <a name="understanding-records"></a>Общие сведения о записях CNAME и записях A

Записи CNAME (или записи псевдонимов) и записи А позволяют связать имя домена с веб-сайтом, однако работают они по-разному.

### Запись CNAME или запись псевдонима

Запись CNAME сопоставляет *конкретный* домен, такой как **contoso.com** или **www.contoso.com**, с каноническим именем домена. В этом случае каноническим именем домена является имя **\<myapp\>.azurewebsites.net** веб-сайта Azure или доменное имя **\<myapp\>.trafficmgr.com** профиля Traffic Manager. После создания запись CNAME создает псевдоним для имени домена **\<myapp\>.azurewebsites.net** или **\<myapp\>.trafficmgr.com**. Запись CNAME будет автоматически разрешаться в IP-адрес имени вашего домена **\<myapp\>.azurewebsites.net** или **\<myapp\>.trafficmgr.com**, поэтому при изменении IP-адреса веб-сайта не нужно предпринимать никаких действий.

> [WACOM.NOTE] Некоторые регистраторы доменов позволяют сопоставлять дочерние домены только при использовании записи CNAME, например www.contoso.com, а не корневых имен, таких как contoso.com. Дополнительные сведения о записи CNAME см. в документации вашего регистратора, [в информации Википедии о записи CNAME][в информации Википедии о записи CNAME] или в документе [Доменные имена IETF — реализация и спецификация][Доменные имена IETF — реализация и спецификация].

### Запись А

Запись A сопоставляет домен, например, **contoso.com** или **www.contoso.com**, *или домен с подстановочными знаками*, такими как **\*.contoso.com**, с IP-адресом. В случае веб-сайта Azure это либо виртуальный IP-адрес службы, либо конкретный IP-адрес, который был приобретен для веб-сайта. Так что основным преимуществом записи А перед записью CNAME является то, что у вас может быть одна запись, использующая подстановочные знаки, например \***.contoso.com**, которая будет обрабатывать запросы для нескольких дочерних доменов, например **mail.contoso.com**, **login.contoso.com** или **www.contso.com**.

> [WACOM.NOTE]Поскольку запись А сопоставляется со статическим IP-адресом, она не может автоматически разрешаться в IP-адрес веб-сайта. IP-адрес для использования с записями А предоставляется при настройке параметров пользовательского доменного имени для веб-сайта; однако это значение может измениться, если удалить и заново создать веб-сайт или изменить режим веб-сайта снова на бесплатный.

> [WACOM.NOTE] Записи A не могут использоваться для балансировки с помощью Traffic Manager. Дополнительные сведения см. в разделе [Управление трафиком веб-сайтов Azure с помощью Azure Traffic Manager][Управление трафиком веб-сайтов Azure с помощью Azure Traffic Manager].

<a name="bkmk_configsharedmode"></a>

## Настройка веб-сайтов для режима общего доступа или стандартного режима

</p>
Задание пользовательского доменного имени на веб-сайте доступно только для режима общего доступа и стандартного режима для веб-сайтов Azure. Прежде чем перевести веб-сайт с бесплатного режима работы на режим общего доступа или стандартный режим, необходимо сначала снять существующие ограничения расходов, установленные для вашей подписки на веб-сайт. Дополнительные сведения о ценах на общий и стандартный режим см. в разделе [Сведения о ценах][Сведения о ценах].

1.  Откройте в браузере [портал управления][портал управления]
2.  Во вкладке **Веб-сайты** щелкните по имени вашего сайта.

    ![][]

3.  Щелкните вкладку **МАСШТАБ**.

    ![][1]

4.  В разделе **Общие** установите режим веб-сайта, щелкнув **В ОБЩЕМ ДОСТУПЕ**.

    ![][2]

    > [WACOM.NOTE] При использовании Traffic Manager с этим веб-сайтом необходимо выбрать стандартный режим вместо режима общего доступа.

5.  Щелкните **Сохранить**.
6.  При появлении запроса об увеличении затрат при переходе к режиму общего доступа (или стандартному режиму, если вы выбрали этот режим) нажмите кнопку **Да**, если вы согласны.

    <!--![][standardmode4]-->

    **Примечание.**
    Если появляется ошибка "Сбой настройки масштабирования для веб-сайта \<имя веб-сайта\>", для получения дополнительных сведений можно использовать кнопку "Сведения".

<a name="trafficmanager"></a>

## (Необязательно) Добавление веб-сайтов в Traffic Manager

</p>
Если вы хотите использовать веб-сайт с Traffic Manager, выполните следующие действия.

1.  Если профиля Traffic Manager еще нет, используйте для его создания сведения из раздела [Создание профиля Traffic Manager с помощью "Быстрого создания"][Создание профиля Traffic Manager с помощью "Быстрого создания"]. Запомните доменное имя **.trafficmgr.com**, связанное с профилем Traffic Manager. Оно будет использоваться в дальнейшем.

2.  Используйте сведения из раздела [Добавление и удаление конечных точек][Добавление и удаление конечных точек] для добавления вашего веб-сайта в качестве конечной точки в ваш профиль Traffic Manager.

    > Если ваш веб-сайт не отображается при добавлении конечной точки, убедитесь, что он настроен для стандартного режима. Стандартный режим для веб-сайта следует использовать для работы с помощью Traffic Manager.

3.  Войдите на веб-сайт своего регистратора DNS и перейдите на страницу управления DNS. Найдите ссылки или области сайта, обозначенные как **Имя домена**, **DNS** или **Управление сервером доменных имен**.

4.  Теперь найдите место, где можно выбрать или ввести записи CNAME. Может потребоваться выбрать тип записи из раскрывающегося списка или перейти на страницу дополнительных параметров. Ищите слова **CNAME**, **Псевдоним** или **Поддомены**.

5.  Необходимо также указать псевдоним домена или поддомена для CNAME. Например, выберите **www**, если вы хотите создать псевдоним для **www.customdomain.com**.

6.  Необходимо также указать имя узла, которое является каноническим именем домена для этого псевдонима CNAME. Это имя **.trafficmgr.com** для вашего веб-сайта.

Например, следующая запись CNAME перенаправляет весь трафик из **www.contoso.com** в **contoso.trafficmgr.com**, имя домена веб-сайта.

|---------------------------------|------------------------|
| **Псевдоним/Имя узла/Поддомен** | **Канонический домен** |
| www                             | contoso.trafficmgr.com |

Посетитель сайта **www.contoso.com** никогда не увидит настоящего узла
(contoso.azurewebsite.net), поэтому процесс перенаправления невидим для конечного пользователя.

> [WACOM.NOTE] Если вы используете Traffic Manager с веб-сайтом, нет необходимости выполнять действия, описанные в разделах **Добавление записи CNAME для пользовательского домена** и **Добавление записи A для своего пользовательского домена**. Запись CNAME, созданная на предыдущих этапах, маршрутизирует входящий трафик в Traffic Manager, который затем направляет трафик на конечные точки веб-сайта.

<a name="bkmk_configurecname"></a>

## Добавление записи CNAME для пользовательского домена

</p>
Чтобы создать запись CNAME, необходимо с помощью средств, предоставленных вашим регистратором, добавить в таблице DNS новую запись для пользовательского домена. Каждый регистратор имеет похожий, но немного отличный способ указания записи CNAME, хотя используется одна и та же концепция.

1.  Чтобы найти имя домена **.azurewebsite.net**, назначенное для вашего веб-сайта, используйте один из следующих методов.

    -   Войдите на [портал управления Azure][портал управления], выберите веб-сайт, щелкните **Панель мониторинга** и найдите **URL-адрес сайта** в разделе **краткое описание**.

    -   Установите и настройте [Azure Powershell][Azure Powershell], а затем используйте следующую команду:

            get-azurewebsite yoursitename | select hostnames

    -   Установите и настройте [межплатформенный интерфейс командной строки Azure][межплатформенный интерфейс командной строки Azure], а затем выполните следующую команду:

            azure site domain list yoursitename

    Сохраните это имя **.azurewebsite.net**, так как оно будет использоваться при выполнении следующих действий.

2.  Войдите на веб-сайт своего регистратора DNS и перейдите на страницу управления DNS. Найдите ссылки или области сайта, обозначенные как **Имя домена**, **DNS** или **Управление сервером доменных имен**.

3.  Теперь найдите место, где можно выбрать или ввести записи CNAME. Может потребоваться выбрать тип записи из раскрывающегося списка или перейти на страницу дополнительных параметров. Ищите слова **CNAME**, **Псевдоним** или **Поддомены**.

4.  Необходимо также указать псевдоним домена или поддомена для CNAME. Например, выберите **www**, если вы хотите создать псевдоним для **www.customdomain.com**. Если вы хотите создать псевдоним для корневого домена, он может быть указан как символ <'**@**> в средствах DNS вашего регистратора.

5.  Необходимо также указать имя узла, которое является каноническим именем домена для этого псевдонима CNAME. Это имя **.azurewebsite.net** для вашего веб-сайта.

Например, следующая запись CNAME перенаправляет весь трафик из **www.contoso.com** в **contoso.azurewebsite.net**, имя домена веб-сайта.

|---------------------------------|--------------------------|
| **Псевдоним/Имя узла/Поддомен** | **Канонический домен**   |
| www                             | contoso.azurewebsite.net |

Посетитель сайта **www.contoso.com** никогда не увидит настоящего узла
(contoso.azurewebsite.net), поэтому процесс перенаправления невидим для
конечного пользователя.

> [WACOM.NOTE] Приведенный выше пример применим только к трафику дочернего домена **www**. Поскольку с записями CNAME нельзя использовать подстановочные знаки, необходимо создать один CNAME для каждого домена или поддомена. Если вы хотите направить трафик из поддоменов, таких как \*.contoso.com, на адрес azurewebsite.net, можно настроить элемент **URL-адрес перенаправления** или **URL-адрес переадресации** в параметрах DNS или создать запись A.

> Распространение CNAME через систему DNS может занять некоторое время. Нельзя задать запись CNAME для веб-сайта до завершения распространения записи CNAME. Чтобы проверить доступность CNAME, можно воспользоваться службой, например <http://www.digwebinterface.com/>.

### Добавление имени домена на веб-сайт

После завершения распространения записи CNAME для имени домена необходимо связать ее с веб-сайтом. Можно добавить пользовательское имя домена, определенное записью CNAME, на веб-сайт либо с помощью межплатформенного интерфейса командной строки Azure, либо с помощью портала управления Azure.

**Добавление имени домена с помощью средств командной строки**

Установите и настройте [межплатформенный интерфейс командной строки Azure][межплатформенный интерфейс командной строки Azure], а затем выполните следующую команду:

    azure site domain add customdomain yoursitename

Например, следующая команда добавит пользовательское имя домена **www.contoso.com** на веб-сайт **contoso.azurewebsite.net**:

    azure site domain add www.contoso.com contoso

С помощью следующей команды можно проверить, что пользовательское имя домена было добавлено на веб-сайт:

    azure site domain list yoursitename

Список, возвращаемый этой командой, должен содержать пользовательское имя домена, а также запись по умолчанию **.azurewebsite.net**.

**Добавление имени домена с помощью портала управления Azure**

1.  Откройте в браузере [портал управления Azure][портал управления].

2.  На вкладке **Веб-сайты** щелкните имя веб-сайта, выберите **Панель мониторинга**, а затем выберите **Управление доменами** в нижней части страницы.

    ![][3]

3.  В текстовом поле **ИМЕНА ДОМЕНОВ** введите имя домена, которое было настроено.

    ![][4]

4.  Щелкните флажок, чтобы принять имя домена.

После завершения настройки пользовательское доменное имя будет указано в разделе **доменные имена** страницы **Настройка** веб-сайта.

<a name="bkmk_configurearecord"></a>

## Добавление записи A для пользовательского домена

</p>
Чтобы создать запись А, сначала необходимо найти IP-адрес веб-сайта. Затем необходимо с помощью средств, предоставленных вашим регистратором, добавить в таблице DNS запись для пользовательского домена. Каждый регистратор имеет похожий, но немного отличный способ указания записи А, хотя используется одна и та же концепция. Кроме записи А, необходимо также создать запись CNAME, которую Azure использует для проверки записи А.

1.  Откройте в браузере [портал управления Azure][портал управления].

2.  На вкладке **Веб-сайты** щелкните по имени веб-сайта, выберите **Панель мониторинга**, а затем выберите **Управление доменами** в нижней части экрана.

    ![][3]

3.  В диалоговом окне **Управление пользовательскими доменами** найдите **IP-адрес для настройки записи А** Скопируйте IP-адрес. Он будет использоваться при создании записи А.

4.  В диалоговом окне **Управление пользовательскими доменами** обратите внимание на имя домена awverify в конце текста в верхней части диалогового окна. Оно должно быть **awverify.mysite.azurewebsites.net**, где **mysite** — имя вашего веб-сайта. Скопируйте его, поскольку это имя домена, используемое при создании проверочной записи CNAME.

5.  Войдите на веб-сайт своего регистратора DNS и перейдите на страницу управления DNS. Найдите ссылки или области сайта, обозначенные как **Имя домена**, **DNS** или **Управление сервером доменных имен**.

6.  Найдите место, где можно выбрать или ввести записи А и CNAME. Может потребоваться выбрать тип записи из раскрывающегося списка или перейти на страницу дополнительных параметров.

7.  Выполните следующие действия, чтобы создать запись А:

    1.  Выберите или введите домен или поддомен, который будет использовать запись А. Например, выберите **www**, если вы хотите создать псевдоним для **www.customdomain.com**. Если вы хотите создать запись с подстановочными знаками для всех поддоменов, введите "\_\_\*\_\_". Так будут охвачены все поддомены, такие как **mail.customdomain.com**, **login.customdomain.com** и **www.customdomain.com**.

        Если вы хотите создать запись A для корневого домена, она может быть указан как символ <'**@**> в средствах DNS вашего регистратора.

    2.  Введите IP-адрес вашей облачной службы в предоставленном поле. Это связывает запись домена, используемую в записи А, с IP-адресом развертывания облачной службы.

        Например, следующая запись A перенаправляет весь трафик из **contoso.com** на **137.135.70.239**, IP-адрес развертываемого приложения:

        |-----------------------|----------------|
        | **Имя узла/Поддомен** | **IP-адрес**   |
        | @                     | 137.135.70.239 |

        В этом примере показано создание записи А для корневого домена. Если вы хотите создать запись с подстановочными знаками, чтобы охватить все поддомены, введите "\_\_\*\_\_" в качестве поддомена.

8.  Теперь создайте запись CNAME с псевдонимом **awverify** и каноническим доменом **awverify.mysite.azurewebsites.net**, полученным ранее.

    > [WACOM.NOTE] Хотя псевдоним awverify может работать для некоторых регистраторов, другие могут требовать полное имя домена псевдонима awverify.www.customdomainname.com или awverify.customdomainname.com.

    Например, следующие операции создадут запись CNAME, которую Azure может использовать для проверки конфигурации записи A.

    |---------------------------------|------------------------------------|
    | **Псевдоним/Имя узла/Поддомен** | **Канонический домен**             |
    | awverify                        | awverify.contoso.azurewebsites.net |

> [WACOM.NOTE] Распространение CNAME awverify через систему DNS может занять некоторое время. Невозможно задать пользовательское имя домена, определенное записью А, для веб-сайта до завершения распространения CNAME awverify. Чтобы проверить доступность CNAME, можно воспользоваться службой, например <http://www.digwebinterface.com/>.

### Добавление имени домена на веб-сайт

После завершения распространения записи CNAME **awverify** для имени домена можно связать пользовательский домен, определенный записью А, с веб-сайтом. Можно добавить на веб-сайт пользовательское имя домена, определенное записью A, либо с помощью межплатформенного интерфейса командной строки Azure, либо с помощью портала управления Azure.

**Добавление имени домена с помощью средств командной строки**

Установите и настройте [межплатформенный интерфейс командной строки Azure][межплатформенный интерфейс командной строки Azure], а затем выполните следующую команду:

    azure site domain add customdomain yoursitename

Например, следующая команда добавит пользовательское имя домена **contoso.com** на веб-сайт **contoso.azurewebsite.net**:

    azure site domain add contoso.com contoso

С помощью следующей команды можно проверить, что пользовательское имя домена было добавлено на веб-сайт:

    azure site domain list yoursitename

Список, возвращаемый этой командой, должен содержать пользовательское имя домена, а также запись по умолчанию **.azurewebsite.net**.

**Добавление имени домена с помощью портала управления Azure**

1.  Откройте в браузере [портал управления Azure][портал управления].

2.  На вкладке **Веб-сайты** щелкните имя веб-сайта, выберите **Панель мониторинга**, а затем выберите **Управление доменами** в нижней части страницы.

    ![][3]

3.  В текстовом поле **ИМЕНА ДОМЕНОВ** введите имя домена, которое было настроено.

    ![][4]

4.  Щелкните флажок, чтобы принять имя домена.

После завершения настройки пользовательское доменное имя будет указано в разделе **доменные имена** страницы **Настройка** веб-сайта.

> [WACOM.NOTE] После добавления пользовательского имени домена, определенного записью A, на веб-сайт запись CNAME awverify можно удалить с помощью средств, предоставляемых регистратором. Однако, если вы хотите в будущем добавить другую запись А, необходимо заново создать запись awverify, прежде чем можно будет связать новое имя домена, определенное новой записью А, с веб-сайтом.

## Дальнейшие действия

-   [Как управлять веб-сайтами][Как управлять веб-сайтами]

-   [Настройка сертификата SSL для веб-сайтов][Настройка сертификата SSL для веб-сайтов]

<!-- Bookmarks --> <!-- Links --> <!-- images --> <!-- images -->

  [http://\<мой\_сайт]: http://<mysite
  [Управление трафиком веб-сайтов Azure с помощью Azure Traffic Manager]: /ru-ru/documentation/articles/web-sites-traffic-manager/
  [Настройка имени пользовательского домена в Azure]: /ru-ru/develop/net/common-tasks/custom-dns/
  [Сведения о ценах — веб-сайты]: /ru-ru/pricing/details/web-sites/
  [Что такое записи CNAME и A]: #understanding-records
  [Настройка веб-сайтов для режима общего доступа или стандартного режима]: #bkmk_configsharedmode
  [Добавление веб-сайтов в Traffic Manager]: #trafficmanager
  [Добавление записи CNAME для пользовательского домена]: #bkmk_configurecname
  [Добавление записи A для пользовательского домена]: #bkmk_configurearecord
  [в информации Википедии о записи CNAME]: http://en.wikipedia.org/wiki/CNAME_record
  [Доменные имена IETF — реализация и спецификация]: http://tools.ietf.org/html/rfc1035
  [Сведения о ценах]: /ru-ru/pricing/details/
  [портал управления]: http://manage.windowsazure.com
  []: ./media/custom-dns-web-site/dncmntask-cname-1.png
  [1]: ./media/custom-dns-web-site/dncmntask-cname-2.png
  [2]: ./media/custom-dns-web-site/dncmntask-cname-3.png
  [Создание профиля Traffic Manager с помощью "Быстрого создания"]: http://msdn.microsoft.com/ru-ru/library/windowsazure/dn339012.aspx
  [Добавление и удаление конечных точек]: http://msdn.microsoft.com/ru-ru/library/windowsazure/hh744839.aspx
  [Azure Powershell]: /ru-ru/manage/install-and-configure-windows-powershell/
  [межплатформенный интерфейс командной строки Azure]: /ru-ru/manage/install-and-configure-cli/
  [3]: ./media/custom-dns-web-site/dncmntask-cname-6.png
  [4]: ./media/custom-dns-web-site/dncmntask-cname-7.png
  [Как управлять веб-сайтами]: /ru-ru/manage/services/web-sites/how-to-manage-websites/
  [Настройка сертификата SSL для веб-сайтов]: /ru-ru/develop/net/common-tasks/enable-ssl-web-site/
