<!---
Don't use this file. It's deprecated and will be removed. Instead use, virtual-machines-Linux-tutorial-log-on-attach-disk.md
-->

## <a id="logon"> </a>Как войти в систему на виртуальной машине после ее создания ##

Для управления параметрами виртуальной машины и приложениями, выполняющимися на компьютере, можно использовать SSH-клиент. Для этого необходимо установить клиент SSH на компьютер, который будет использоваться для входа на виртуальную машину. Существует множество клиентских программ SSH. Вы можете выбрать один из следующих вариантов.

- При использовании компьютера под управлением Windows вы можете использовать такой клиент SSH, как PuTTY. Дополнительные сведения см. на [странице загрузки PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).
- При использовании компьютера под управлением Linux вы можете использовать такой клиент SSH, как OpenSSH. Дополнительные сведения см. на странице [OpenSSH](http://www.openssh.org/).

В этом руководстве рассматривается использование программы PuTTY для доступа к виртуальной машине.

1. Найдите **Имя узла** и **Данные порта** с портала управления. Необходимые сведения можно найти на панели мониторинга виртуальной машины. Щелкните имя виртуальной машины и найдите **Сведения об SSH** в разделе **Сводка** панели мониторинга.

	![Найдите сведения об SSH](./media/CreateVirtualMachineLinuxTutorial/SSHdetails.png)

2. Откройте программу PuTTY.

3. Введите **Имя узла** и **Данные порта** с панели мониторинга и щелкните **Открыть**.

	![Введите имя узла и данные порта](./media/CreateVirtualMachineLinuxTutorial/putty.png)

4. Войдите в систему на виртуальной машине с помощью учетной записи NewUser1, указанной при создании машины.

	![Войдите на новую виртуальную машину](./media/CreateVirtualMachineLinuxTutorial/sshlogin.png)

	Теперь вы сможете работать с виртуальной машиной, так же как и с любым сервером.


## <a id="attachdisk"> </a>Как присоединить диск данных к новой виртуальной машине ##

Приложение может сохранять данные. Чтобы выполнить такую настройку, подключите диск данных к ранее созданной виртуальной машине. Для этого проще всего подключить пустой диск данных к машине.

**Примечание. Сравнение диска данных и диска ресурсов** Диски данных хранятся в хранилище Azure и могут использоваться для постоянного хранения файлов и данных приложений.

Каждая созданная виртуальная машина также имеет присоединенный временный локальный *Диск ресурсов*. Так как данные на диске ресурсов могут плохо переносить перезагрузки, его часто используют приложения и процессы, выполняющиеся на виртуальной машине, для временного хранения данных. Он также используется для хранения страниц или замены файлов операционной системы.

В системе Linux диск ресурсов обычно управляется агентом Linux Azure, и он автоматически подключается к **/mnt/resource** (или **/mnt** на образах Ubuntu). Следует отметить, что диск ресурсов является *временным* диском и должен быть очищен при отмене подготовки ВМ. С другой стороны, диск данных Linux может быть назван по ядру, например `/dev/sdc`, и пользователям потребуется разделять, форматировать и подключать этот ресурс. Дополнительные сведения см. в [руководстве пользователя агента Linux Azure](http://azure.microsoft.com/manage/linux/how-to-guides/linux-agent-guide/).



1. Войдите на портал управления Azure, если вы еще этого не сделали.

2. Щелкните **Виртуальные машины**, а затем выберите предварительно созданную виртуальную машину **MyTestVM1**.

3. На панели команд нажмите кнопку **Присоединить**, а затем — **Присоединить пустой диск**.
	
	Откроется диалоговое окно **Присоединение пустого диска**.

	![Определение сведений о диске](./media/CreateVirtualMachineLinuxTutorial/attachnewdisklinux.png)

4. Значения **Имя виртуальной машины**, **Расположение хранилища** и **Имя файла** уже определены. Достаточно ввести размер диска. Введите **5** в поле **Размер**.

	**Примечание**. Все диски создаются из файла виртуального жесткого диска в хранилище Azure. Можно ввести имя для добавляемого в хранилище файла виртуального жесткого диска, однако имя диска будет создано автоматически.

5. Установите флажок, чтобы присоединить диск данных к виртуальной машине.

6. Проверить присоединение диска данных к виртуальной машине можно с помощью панели мониторинга. Щелкните имя виртуальной машины для отображения панели мониторинга.

	Для виртуальной машины число дисков теперь 2. Присоединенный диск отображается в таблице **Диски**.

	![Присоединение диска выполнено](./media/CreateVirtualMachineLinuxTutorial/attachemptysuccess.png)


После присоединения диска данных к виртуальной машине диск будет отключен и не инициализирован. Чтобы использовать этот диск для хранения данных, необходимо предварительно войти в систему на данном компьютере и инициализировать диск.

1. Подключитесь к виртуальной машине, выполнив действия, описанные выше в разделе **Как войти в систему на виртуальной машине после ее создания**.


2. В окне SSH введите следующую команду, а затем введите пароль данной учетной записи:

	`sudo grep SCSI /var/log/messages`

	Идентификатор последнего добавленного диска данных можно найти в отображаемых сообщениях.

	![Идентификация диска](./media/CreateVirtualMachineLinuxTutorial/diskmessages.png)


3. В окне SSH введите следующую команду для создания нового устройства, а затем введите пароль учетной записи:

	`sudo fdisk /dev/sdc`

	>[AZURE.NOTE]В этом примере в некоторых дистрибутивах, возможно, потребуется использовать `sudo -i`, если /sbin или /usr/sbin находятся не в `$PATH`.


4. Введите **n** для создания нового раздела.

	![Создание нового устройства](./media/CreateVirtualMachineLinuxTutorial/diskpartition.png)


5. Введите **p**, чтобы сделать раздел основным, введите **1**, чтобы сделать его первым разделом, а затем нажмите клавишу ВВОД, чтобы принять значение по умолчанию для цилиндра.

	![Создание раздела](./media/CreateVirtualMachineLinuxTutorial/diskcylinder.png)


6. Введите **p**, чтобы просмотреть сведения о диске, на котором создаются разделы.

	![Просмотр сведений о диске](./media/CreateVirtualMachineLinuxTutorial/diskinfo.png)


7. Введите **w**, чтобы записать параметры данного диска.

	![Запись изменений на диске](./media/CreateVirtualMachineLinuxTutorial/diskwrite.png)


8. Необходимо создать файловую систему в новом разделе. Например, введите следующую команду для создания новой файловой системы, а затем введите пароль учетной записи:

	`sudo mkfs -t ext4 /dev/sdc1`

	![Создание файловой системы](./media/CreateVirtualMachineLinuxTutorial/diskfilesystem.png)

	>[AZURE.NOTE]Обратите внимание, что системы SUSE Linux Enterprise 11 предоставляют доступ только для чтения в файловых системах ext4. Для этих систем рекомендуется форматировать новую файловую систему ext3, а не ext4.


9. Далее необходимо подготовить каталог для подключения новой файловой системы. Например, введите следующую команду, чтобы создать каталог для монтирования диска, а затем введите пароль учетной записи:

	`sudo mkdir /datadrive`


10. Введите следующую команду, чтобы установить диск:

	`sudo mount /dev/sdc1 /datadrive`

	Диск данных теперь готов для использования как **/datadrive**.


11. Добавьте новый диск в /etc/fstab:

	Чтобы обеспечить автоматическую переустановку диска после перезагрузки, его необходимо добавить в файл /etc/fstab. Кроме того, для ссылки на диск настоятельно рекомендуется использовать идентификатор UUID (глобально уникальный идентификатор) в /etc/fstab, а не просто имя устройства (т. е. /dev/sdc1). Чтобы найти идентификатор UUID нового диска, можно использовать программу **blkid**:
	
		`sudo -i blkid`

	Вывод будет выглядеть примерно следующим образом:

		`/dev/sda1: UUID="11111111-1b1b-1c1c-1d1d-1e1e1e1e1e1e" TYPE="ext4"`
		`/dev/sdb1: UUID="22222222-2b2b-2c2c-2d2d-2e2e2e2e2e2e" TYPE="ext4"`
		`/dev/sdc1: UUID="33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e" TYPE="ext4"`

	>[AZURE.NOTE]Для blkid может не требоваться доступ sudo во всех случаях, однако может быть проще выполнить `sudo -i` на некоторых дистрибутивах, если/sbin или/usr/sbin не находятся в `$PATH`.

	**Внимание**! Некорректное изменение файла /etc/fstab может привести к невозможности загрузить систему. Если не уверены, обратитесь к документации дистрибутива за сведениями о том, как правильно изменить этот файл. Также рекомендуется перед внесением изменений создать резервную копию файла /etc/fstab.

	С помощью текстового редактора введите сведения о новой файловой системе в конце файла /etc/fstab. В этом примере мы используем значение UUID для нового устройства **/dev/sdc1**, созданного в предыдущих шагах, и точку установки **/datadrive**:

		`UUID=33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /datadrive   ext4   defaults   1   2`

	Или в системах на основе SUSE Linux может потребоваться использовать другой формат:

		`/dev/disk/by-uuid/33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /   ext3   defaults   1   2`

	При создании дополнительных дисков данных и разделов нужно будет также ввести их в файл /etc/fstab отдельно.

	Теперь можно проверить, правильно ли подключена файловая система, просто отключив и повторно подключив файловую систему, т. е. используя типовую точку подключения `/datadrive`, созданную на предыдущих этапах:

		`sudo umount /datadrive`
		`sudo mount /datadrive`

	Если вторая команда приводит к ошибке, проверьте правильность синтаксиса в файле /etc/fstab.


	>[AZURE.NOTE]Последующее удаление диска данных без редактирования fstab может привести к тому, что виртуальная машина не загрузится. Если это происходит часто, то большинство дистрибутивов предоставляют параметры fstab `nofail` и (или) `nobootwait`, которые позволяют системе загружаться, даже если диск отсутствует. Дополнительные сведения об этих параметрах можно найти в документации по вашему дистрибутиву.

<!---HONumber=July15_HO4-->