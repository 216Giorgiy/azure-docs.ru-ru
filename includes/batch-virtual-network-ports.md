---
title: включение файла
description: включение файла
services: batch
documentationcenter: ''
author: dlepow
manager: jeconnoc
editor: ''
ms.assetid: ''
ms.service: batch
ms.devlang: na
ms.topic: include
ms.tgt_pltfrm: na
ms.workload: ''
ms.date: 10/05/2018
ms.author: danlep
ms.custom: include file
ms.openlocfilehash: 9246dea7fa12e5ac9378203e96352e917679525b
ms.sourcegitcommit: 4047b262cf2a1441a7ae82f8ac7a80ec148c40c4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2018
ms.locfileid: "49312492"
---
### <a name="general-requirements"></a>Общие требования

* Виртуальная сеть должна находиться в тех же подписке и регионе, что и учетная запись пакетной службы, которую вы используете для создания пула.

* Размер пула, использующий виртуальную сеть, не может превышать 4096 узлов.

* Указанная для пула подсеть должна иметь достаточное количество свободных IP-адресов для всех виртуальных машин, предназначенных для пула, то есть сумму свойств `targetDedicatedNodes` и `targetLowPriorityNodes` этого пула. Если в подсети недостаточно свободных IP-адресов, пакетная служба ограничивает выделение вычислительных узлов для пула и генерирует ошибку изменения размера. 

* Необходимо, чтобы конечная точка службы хранилища Azure могла быть разрешена на всех пользовательских DNS-серверах, используемых в виртуальной сети. В частности, должны разрешаться URL-адреса в формате `<account>.table.core.windows.net`, `<account>.queue.core.windows.net` и `<account>.blob.core.windows.net`. 

Дополнительные требования к виртуальной сети различаются в зависимости от того, где указан пул пакетной службы: в конфигурации виртуальной машины или конфигурации облачных служб. Для новых развертываний пула в виртуальной сети рекомендуется конфигурация виртуальной машины.

### <a name="pools-in-the-virtual-machine-configuration"></a>Пулы в конфигурации виртуальной машины

**Поддерживаемые виртуальные сети** — только виртуальные сети на основе Azure Resource Manager.

**Идентификатор подсети** — при указании подсети с помощью API пакетной службы используйте *идентификатор ресурса* подсети. Идентификатор подсети имеет вид:

  ```
  /subscriptions/{subscription}/resourceGroups/{group}/providers/Microsoft.Network/virtualNetworks/{network}/subnets/{subnet}
  ```

**Разрешения** — проверьте, ограничивают ли ваши политики безопасности или блокировки в подписке или группе ресурсов виртуальной сети разрешения пользователя на управление виртуальной сетью.

**Дополнительные сетевые ресурсы** — пакетная служба автоматически выделяет дополнительные сетевые ресурсы в группе ресурсов, содержащей виртуальную сеть. Для каждого из 50 выделенных узлов (или для каждого из 20 низкоприоритетных узлов) пакетная служба выделяет: 1 группу безопасности сети (NSG), 1 общедоступный IP-адрес и 1 балансировщик нагрузки. Эти ресурсы ограничены [квотами ресурсов](../articles/azure-subscription-service-limits.md) в подписке. Для больших пулов вам может потребоваться увеличить квоту на один или несколько из этих ресурсов.

#### <a name="network-security-groups"></a>Группы безопасности сети

Подсеть должна разрешать входящую связь из пакетной службы, чтобы иметь возможность планировать задачи на вычислительных узлах, и исходящую связь для связи со службой хранилища Azure или другими ресурсами. Для пулов в конфигурации виртуальной машины пакетная служба добавляет группы безопасности сети на уровне сетевых интерфейсов, подключенных к виртуальным машинам. Эти группы безопасности сети автоматически настраивают правила для входящего и исходящего трафика, чтобы разрешить следующий трафик:

* Входящий трафик TCP через порты 29876 и 29877 с IP-адресов с ролью пакетной службы. 
* Входящий трафик TCP через порт 22 (узлы Linux) или 3389 (узлы Windows), чтобы разрешить удаленный доступ.
* Исходящий трафик в виртуальную сеть на любом порту.
* Исходящий трафик в Интернет на любом порту.

> [!IMPORTANT]
> Соблюдайте осторожность, если вы изменяете или добавляете правила для входящего и исходящего трафика в группах безопасности сети, настроенных для пакетной службы. Если группа безопасности сети (NSG), связанная с назначенной подсетью, запрещает взаимодействие с вычислительными узлами, пакетная служба установит для вычислительных узлов состояние **Непригоден**.

Вам не нужно указывать группы безопасности сети на уровне подсети, так как пакетная служба настраивает собственные такие группы. Однако если указанной подсети уже назначены группы безопасности сети и (или) брандмауэр, настройте правила безопасности для входящего и исходящего трафика, как показано в следующих таблицах. Настройте входящий трафик через порт 3389 (Windows) или 22 (Linux) только в том случае, если необходимо разрешить удаленный доступ к виртуальным машинам пула. Виртуальные машины пула можно использовать и без этой настройки.

**Правила безопасности для входящего трафика**

| Исходные IP-адреса | Исходные порты | Место назначения | Конечные порты | Протокол | Действие |
| --- | --- | --- | --- | --- | --- |
Любой <br /><br />Хотя по факту для подключений используются все порты, пакетная служба применяет группу безопасности сети на уровне сетевого интерфейса на каждой виртуальной машине, созданной в конфигурации виртуальных машин, которая отфильтровывает все IP-адреса, не связанные с пакетной службой. | * | Любой | 29876–29877 | TCP | РАЗРЕШИТЬ |
| Компьютеры пользователя, используемые для отладки и удаленного доступа к виртуальным машинам пула. | * | Любой |  3389 (Windows), 22 (Linux) | TCP | РАЗРЕШИТЬ |

**Правила безопасности для исходящего трафика**

| Источник | Исходные порты | Место назначения | Тег целевой службы | Протокол | Действие |
| --- | --- | --- | --- | --- | --- |
| Любой | 443 | [Тег службы](../articles/virtual-network/security-overview.md#service-tags) | Хранилище (в одном регионе с вашей учетной записью пакетной службы и виртуальной сетью)  | Любой | РАЗРЕШИТЬ |

### <a name="pools-in-the-cloud-services-configuration"></a>Пулы в конфигурации облачных служб

**Поддерживаемые виртуальные сети** — только классические виртуальные сети.

**Идентификатор подсети** — при указании подсети с помощью API пакетной службы используйте *идентификатор ресурса* подсети. Идентификатор подсети имеет вид:

  ```
  /subscriptions/{subscription}/resourceGroups/{group}/providers/Microsoft.ClassicVirtualNetwork /virtualNetworks/{network}/subnets/{subnet}
  ```

**Разрешения`MicrosoftAzureBatch` — субъекту-службе**  должна быть назначена роль управления доступом на основе ролей `Classic Virtual Machine Contributor` для указанной виртуальной сети.

#### <a name="network-security-groups"></a>Группы безопасности сети

Подсеть должна разрешать входящую связь из пакетной службы, чтобы иметь возможность планировать задачи на вычислительных узлах, и исходящую связь для связи со службой хранилища Azure или другими ресурсами.

Вам не нужно указывать группу безопасности сети, так как пакетная служба настраивает входящий трафик только с IP-адресов пакетной службы на узлах пула. Если указанной подсети уже назначены группы безопасности сети и (или) брандмауэр, настройте правила безопасности для входящего и исходящего трафика, как показано в следующих таблицах. Если группа безопасности сети (NSG), связанная с назначенной подсетью, запрещает взаимодействие с вычислительными узлами, пакетная служба установит для вычислительных узлов состояние **Непригоден**.

 Настройте входящий трафик через порт 3389 (Windows) или 22 (Linux) только в том случае, если необходимо разрешить удаленный доступ к узлам пула. Узлы пула можно использовать и без этой настройки.

**Правила безопасности для входящего трафика**

| Исходные IP-адреса | Исходные порты | Место назначения | Конечные порты | Протокол | Действие |
| --- | --- | --- | --- | --- | --- |
Любой <br /><br />Хотя фактически это разрешает доступ со всех адресов, пакетная служба применяет правило списка управления доступом на уровне каждого узла, которое отфильтровывает все IP-адреса, не относящиеся к пакетной службе. | * | Любой | 10100, 20100, 30100 | TCP | РАЗРЕШИТЬ |
| Компьютеры пользователя, используемые для отладки и удаленного доступа к виртуальным машинам пула. | * | Любой |  3389 (Windows), 22 (Linux) | TCP | РАЗРЕШИТЬ |

**Правила безопасности для исходящего трафика**

| Источник | Исходные порты | Место назначения | Конечные порты | Протокол | Действие |
| --- | --- | --- | --- | --- | --- |
| Любой | * | Любой | 443  | Любой | РАЗРЕШИТЬ |