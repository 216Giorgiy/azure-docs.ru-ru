<properties linkid="dev-net-common-tasks-publishing-with-vso" urlDisplayName="Публикация с помощью TFS" pageTitle="Непрерывная доставка с использованием Visual Studio Online в Azure" metaKeywords="" description="Узнайте, как настроить командные проекты Visual Studio Online для автоматического построения и развертывания облачных служб и веб-сайтов Azure." metaCanonical="" services="web-sites" documentationCenter=".NET" title="Непрерывная доставка в Azure с использованием Visual Studio Online" authors="ghogen" solutions="" manager="" editor="" />




# Непрерывная доставка в Azure с использованием Visual Studio Online

Visual Studio Online (ранее Team Foundation Service) — это размещаемая в облаке версия популярной службы Microsoft Team Foundation Server (TFS), которая предоставляет широкие возможности для настройки исходного кода, управления построением, разработки, реализации командных процессов, отслеживания проблем и рабочих элементов, а также многие другие функции.  Вы можете настроить командные проекты Visual Studio Online для автоматического построения облачных служб и веб-сайтов Azure.  Дополнительные сведения о настройке непрерывного процесса построения и развертывания системы с использованием локального решения Team Foundation Server см. в разделе [Непрерывная доставка для облачных служб в Azure](../cloud-services-dotnet-continuous-delivery).

В данном учебнике предполагается, что у вас установлены решения Visual Studio 2013 и пакет SDK Azure. Чтобы загрузить Visual Studio 2013, щелкните ссылку **Начните работу бесплатно** на сайте [www.visualstudio.com](http://www.visualstudio.com). Пакет SDK Azure можно установить по [этой ссылке](http://go.microsoft.com/fwlink/?LinkId=239540).

Чтобы настроить облачную службу для автоматического построения и развертывания в Azure с использованием Visual Studio Online, выполните следующие действия:

-   [Шаг 1. Регистрация в Visual Studio Online.][]

-   [Шаг 2. Регистрация проекта в системе управления версиями.][]

-   [Шаг 3. Подключение проекта к Azure.][]

-   [Шаг 4. Внесение необходимых изменений и запуск процессов повторного построения и развертывания.][]

-   [Шаг 5. Повторное развертывание предыдущей сборки (необязательно).][]

-   [Шаг 6. Изменение рабочего развертывания (только для облачных служб).][]

<h2> <a name="step1"></a><span class="short-header">Регистрация в Visual Studio Online</span>Шаг 1. Регистрация в Visual Studio Online</h2>

1. Создайте учетную запись в Visual Studio Online на сайте [http://www.visualstudio.com](http://www.visualstudio.com). Щелкните ссылку **Войти в систему**.
  Для входа в систему вам потребуется учетная запись Microsoft. При первом входе в систему появится запрос на ввод определенных сведений о вас, включая ваши имя и адрес электронной почты.
![][0]
  
2. При последующем входе в систему появится следующий экран. Щелкните ссылку **Создать бесплатную учетную запись**.<br/>
![][36]

3. Создайте URL-адрес учетной записи для нового проекта. Учетная запись определяется в формате https://&lt;имя_учетной_записи&gt;.visualstudio.com.<br/>
![][37]
 
4. Теперь вы можете создать первый проект. Введите имя и описание проекта. Выберите нужную систему управления версиями. Поддерживаются решения Team Foundation Version Control (TFVC) и Git.  Дополнительные сведения об этих вариантах см. в разделе [Использование управления версиями](http://go.microsoft.com/fwlink/?LinkId=324037). В этом руководстве применяется решение TFVC. Выберите шаблон используемого в вашей организации процесса и нажмите кнопку **Создать проект**. Дополнительные сведения о шаблонах процессов см. в разделе [Работа с артефактами командного проекта, выбор шаблона процесса](http://go.microsoft.com/fwlink/?LinkId=324035).<br/>
![][1]

5. После того, как проект создан, нажмите кнопку **Открыть в Visual Studio для подключения**, чтобы автоматически запустить решение Visual Studio, связанное с вашим командным проектом. В появляющихся диалоговых окнах системы безопасности выберите "Разрешить".<br/>
![][2]

<h2><a name="step2"> </a><span class="short-header">Регистрация проекта в системе управления версиями.</span>Шаг 2. Регистрация проекта в системе управления версиями</h2>

1. В Visual Studio откройте решение, которое вы хотите развернуть, или создайте новое.
В этом пошаговом руководстве представлены инструкции по развертыванию веб-сайта или облачной службы (приложение Azure).
Чтобы создать новое решение, создайте новый проект облачной службы Azure
или новый проект ASP.NET MVC. Убедитесь, что в проекте используется платформа .NET Framework 4 или 4.5 и создается проект облачной службы, добавьте рабочую роль и веб-роль ASP.NET MVC, после чего выберите интернет-приложение для веб-роли. При появлении запроса выберите **Интернет-приложение**.
Чтобы создать веб-сайт, выберите шаблон проекта "Веб-приложение ASP.NET" и затем выберите MVC. См. раздел [Начало работы с Azure и ASP.NET](http://www.windowsazure.com/ru-ru/documentation/articles/web-sites-dotnet-get-started/).

2. Откройте контекстное меню решения и выберите **Добавить решение в систему управления версиями**.<br/>
![][5]

3. Примите предлагаемые по умолчанию параметры или измените их, после чего нажмите кнопку **ОК**. По завершении обработки в обозревателе решений появится значок системы управления версиями.<br/>
![][6]

4. Откройте контекстное меню решения и выберите **Регистрация**.<br/>
![][7]

5. В области "Ожидающие изменения" в обозревателе Team Explorer введите примечания к регистрации и нажмите кнопку **Регистрация**.<br/>
![][8]

<br/>
Обратите внимание на параметры, позволяющие включить или исключить отдельные изменения при регистрации. Если нужные изменения исключены, щелкните ссылку **Включить все**.<br/>
![][9]

<h2> <a name="step3"> </a><span class="short-header">Подключение проекта к Azure</span>Шаг 3. Подключение проекта к Azure</h2>

1. После того как был создан командный проект VSO с определенным исходным кодом, вы можете подключить его к Azure.  Выполните вход на [портал Azure](http://manage.windowsazure.com), выберите существующие облачную службу или веб-сайт либо создайте новые с помощью значка "+" в нижнем левом углу, после чего выберите **Облачная служба** или **Веб-сайт** и щелкните **Быстрое создание**. Щелкните ссылку **Настройка публикации в Visual Studio Online**.<br/>
![][10]

2. В текстовом поле в мастере введите имя своей учетной записи Visual Studio Online и щелкните ссылку **Авторизовать сейчас**. Может появиться запрос на вход в систему.<br/>
![][11]

3. Во всплывающем диалоговом окне OAuth щелкните **Принять**, чтобы предоставить Azure полномочия для настройки командного проекта в VSO.<br/>
![][12]

4. После успешной авторизации появится раскрывающийся список, в котором будут представлены ваши командные проекты Visual Studio Online.  Щелкните имя созданного на предыдущих шагах командного проекта и нажмите кнопку с галочкой в мастере.<br/>
![][13]

5. После привязки проекта появятся инструкции по проверке изменений в командном проекте Visual Studio Online.  При следующей регистрации Visual Studio Online будет строить и развертывать ваш проект в Azure.  Чтобы проверить реализованное поведение, щелкните ссылку **Регистрация из Visual Studio**, а затем ссылку **Запустить Visual Studio** (или аналогичную кнопку **Visual Studio** в нижней части окна портала).<br/>
![][14]

<h2><a name="step4"> </a><span class="short-header">Запуск повторного построения</span>Шаг 4. Запуск процессов повторного построения и развертывания проекта</h2>

1. В обозревателе Visual Studio Team Explorer щелкните ссылку **Обозреватель управления исходным кодом**.<br/>
![][15]

2. Перейдите к файлу решения и откройте его.<br/>
![][16]

3. Откройте и измените файл в обозревателе решений. Например, измените файл _Layout.cshtml в папке Views\Shared веб-роли MVC.<br/>
![][17]

4. Измените логотип сайта и сохраните файл с помощью клавиш CTRL+S.<br/>
![][18]

5. В обозревателе Team Explorer щелкните ссылку **Ожидающие изменения**.<br/>
![][19]

6. Введите примечания и нажмите кнопку **Регистрация**.<br/>
![][20]

7. Нажмите кнопку "Главная", чтобы вернуться на главную страницу Team Explorer.<br/>
![][21]

8. Щелкните ссылку **Сборки**, чтобы просмотреть выполняющиеся сборки.<br/>
![][22]
<br/>
В обозревателе Team Explorer будут показаны сведения о том, что для вашей регистрации был запущен процесс построения.<br/>
![][23]

9. Дважды щелкните имя выполняемой сборки, чтобы просмотреть подробный журнал процесса построения.<br/>
![][24]

10. В процессе построения вы можете просмотреть определение сборки, созданное во время привязки TFS к Azure с помощью мастера.  Откройте контекстное меню определения сборки и выберите **Редактировать определение сборки**.<br/>
![][25]
<br/>
На вкладке **Триггер** указывается, что в определении сборки по умолчанию настроено построение при каждой регистрации.<br/>
![][26]
<br/>
На вкладке **Процесс** указывается, что в среде разработки настроено имя ваших облачной веб-службы или веб-сайта. При работе с веб-сайтами здесь будут показаны другие свойства.<br/>
![][27]
<br/>
При необходимости измените установленные по умолчанию значения свойств.
В следующей таблице приводятся значения по умолчанию для свойств облачной службы:
	<table>
<tr><td><b>Свойство</b></td><td><b>Значение по умолчанию</b></td></tr>
<tr><td>Разрешить обновление</td><td>true</td></tr>
<tr><td>Среда облачной службы</td><td>Промежуточная</td></tr>
<tr><td>Имя облачной службы</td><td>Имя службы, к которой устанавливается подключение</td></tr>
<tr><td>Метка развертывания</td><td>Совпадает с именем службы</td></tr>
<tr><td>Конфигурация службы</td><td>ServiceConfiguration.Cloud.cscfg</td></tr>
<tr><td>Имя учетной записи хранения</td><td>Пусто; будет выполнен поиск учетной записи хранения</td></tr>
<tr><td>Профиль публикации</td><td>Файл .azurePubxml; здесь можно выбрать зарегистрированный файл</td></tr>
</table>
<br/>
Если свойство учетной записи хранения не заполнено, система Azure выполнит его поиск. Если будет найдена учетная запись
хранения, имя которой совпадает с именем службы, будет использоваться именно она. В противном случае используется другая учетная запись хранения
или создается новая. Учетная запись хранения предоставляет в Azure место для хранения файлов и других данных. Дополнительные сведения см. в разделе [Что такое учетная запись хранения?](http://www.windowsazure.com/ru-ru/documentation/articles/storage-whatis-account).

11. К этому моменту процесс построения должен быть успешно завершен.<br/>
![][28]

12. Чтобы открыть окно **Сводка сборки** в Visual Studio и просмотреть результаты проверки из связанных проектов модульного тестирования, дважды щелкните имя сборки.<br/>
![][29]

13. Если выбрана промежуточная среда, на вкладке "Развертывания" [портала Azure](http://manage.windowsazure.com) вы можете просмотреть связанные развертывания.<br/>
![][30]

14.	Перейдите по URL-адресу вашего сайта. Для веб-сайта достаточно нажать кнопку "Обзор" на панели команд. Для облачной службы выберите URL-адрес в разделе **Сводка** на странице **Панель мониторинга**, где отображается промежуточная среда для облачной службы. Развертывания из решений непрерывной интеграции для облачных служб по умолчанию публикуются в промежуточной среде. Чтобы изменить это поведение, присвойте свойству "Альтернативная среда облачной службы" значение "Рабочая". На этом снимке экрана показано местонахождение URL-адреса сайта на странице "Панель мониторинга" облачной службы: <br/>
![][31]
<br/>
Сайт откроется на новой вкладке браузера.<br/>
![][32]

15.	При внесении других изменений в проект для облачных служб запускаются дополнительные процессы построения, в результате чего создается несколько развертываний, последнее из которых отмечается как активное.<br/>
![][33]

<h2> <a name="step5"> </a><span class="short-header">Повторное развертывание предыдущей сборки</span>Шаг 5. Повторное развертывание предыдущей сборки</h2>

Этот шаг необязателен и применяется к облачным службам. Чтобы восстановить состояние сайта на момент более ранней регистрации, выберите предыдущее развертывание на портале управления и нажмите кнопку **Повторное развертывание**.  Обратите внимание, что при этом в TFS будет запущен новый процесс построения, а в историю развертывания будет добавлена новая запись.<br/>
![][34]

<h2> <a name="step6"> </a><span class="short-header">Изменение рабочего развертывания</span>Шаг 6. Изменение рабочего развертывания</h2>

Этот шаг применяется только к облачным службам и недоступен для веб-сайтов. Выполнив все необходимые действия, вы можете повысить промежуточную среду до рабочей с помощью кнопки "Переключить" портала управления. Вновь развернутая промежуточная среда повышается до уровня рабочей, а ранее установленная рабочая среда становится промежуточной. Рабочая и промежуточная среды могут использовать разные активные развертывания, однако история развертывания последних сборок будет содержать одинаковые записи независимо от выбранной среды.<br/>
![][35]

Дополнительные сведения см. в разделе [Visual Studio Online](http://go.microsoft.com/fwlink/?LinkId=253861). При работе с Git см. разделы [Совместный доступ к коду с помощью Git](http://www.visualstudio.com/get-started/share-your-code-in-git-vs.aspx) и [Публикация из системы управления версиями для веб-сайтов Azure](http://www.windowsazure.com/ru-ru/documentation/articles/web-sites-publish-source-control).

[Шаг 1. Регистрация в Visual Studio Online.]: #step1
[Шаг 2. Регистрация проекта в системе управления версиями.]: #step2
[Шаг 3. Подключение проекта к Azure.]: #step3
[Шаг 4. Внесение необходимых изменений и запуск процессов повторного построения и развертывания.]: #step4
[Шаг 5. Повторное развертывание предыдущей сборки (необязательно).]: #step5
[Шаг 6. Изменение рабочего развертывания (только для облачных служб).]: #step6
[0]: ./media/cloud-services-continuous-delivery-use-vso/tfs0.PNG
[1]: ./media/cloud-services-continuous-delivery-use-vso/tfs1.png
[2]: ./media/cloud-services-continuous-delivery-use-vso/tfs2.png


[5]: ./media/cloud-services-continuous-delivery-use-vso/tfs5.png
[6]: ./media/cloud-services-continuous-delivery-use-vso/tfs6.png
[7]: ./media/cloud-services-continuous-delivery-use-vso/tfs7.png
[8]: ./media/cloud-services-continuous-delivery-use-vso/tfs8.png
[9]: ./media/cloud-services-continuous-delivery-use-vso/tfs9.png
[10]: ./media/cloud-services-continuous-delivery-use-vso/tfs10.png
[11]: ./media/cloud-services-continuous-delivery-use-vso/tfs11.png
[12]: ./media/cloud-services-continuous-delivery-use-vso/tfs12.png
[13]: ./media/cloud-services-continuous-delivery-use-vso/tfs13.png
[14]: ./media/cloud-services-continuous-delivery-use-vso/tfs14.png
[15]: ./media/cloud-services-continuous-delivery-use-vso/tfs15.png
[16]: ./media/cloud-services-continuous-delivery-use-vso/tfs16.png
[17]: ./media/cloud-services-continuous-delivery-use-vso/tfs17.png
[18]: ./media/cloud-services-continuous-delivery-use-vso/tfs18.png
[19]: ./media/cloud-services-continuous-delivery-use-vso/tfs19.png
[20]: ./media/cloud-services-continuous-delivery-use-vso/tfs20.png
[21]: ./media/cloud-services-continuous-delivery-use-vso/tfs21.png
[22]: ./media/cloud-services-continuous-delivery-use-vso/tfs22.png
[23]: ./media/cloud-services-continuous-delivery-use-vso/tfs23.png
[24]: ./media/cloud-services-continuous-delivery-use-vso/tfs24.png
[25]: ./media/cloud-services-continuous-delivery-use-vso/tfs25.png
[26]: ./media/cloud-services-continuous-delivery-use-vso/tfs26.png
[27]: ./media/cloud-services-continuous-delivery-use-vso/tfs27.png
[28]: ./media/cloud-services-continuous-delivery-use-vso/tfs28.png
[29]: ./media/cloud-services-continuous-delivery-use-vso/tfs29.png
[30]: ./media/cloud-services-continuous-delivery-use-vso/tfs30.png
[31]: ./media/cloud-services-continuous-delivery-use-vso/tfs31.png
[32]: ./media/cloud-services-continuous-delivery-use-vso/tfs32.png
[33]: ./media/cloud-services-continuous-delivery-use-vso/tfs33.png
[34]: ./media/cloud-services-continuous-delivery-use-vso/tfs34.png
[35]: ./media/cloud-services-continuous-delivery-use-vso/tfs35.png
[36]: ./media/cloud-services-continuous-delivery-use-vso/tfs36.PNG
[37]: ./media/cloud-services-continuous-delivery-use-vso/tfs37.PNG

