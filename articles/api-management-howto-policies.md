<properties 
	pageTitle="Политики в Azure API Management" 
	description="Сведения о создании, изменении и настройке политик в службе управления API." 
	services="api-management" 
	documentationCenter="" 
	authors="steved0x" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="api-management" 
	ms.workload="mobile" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="1/28/2015" 
	ms.author="sdanie"/>

# Политики в Azure API Management

В Azure API Management (предварительная версия) политики представляют собой одну из мощных функций системы, позволяющих издателю изменять поведение интерфейса API путем его настройки. Политика — это коллекция операторов, которые выполняются последовательно по запросу интерфейса API или при получении из него ответа. К часто используемым операторам относятся преобразование формата из XML в JSON, а также ограничение скорости вызовов, позволяющее ограничивать количество входящих вызовов от разработчика. Также существует много готовых политик.

Полный перечень операторов политик и их параметров см. в документе [Справочник по политикам][Справочник по политикам].

Политики применяются внутри прокси-сервера, который находится между потребителем интерфейса API и управляемым API. Прокси-сервер получает все запросы и обычно отправляет их без изменения в базовый API. Однако политика может применять изменения как для входящего запроса, так и для исходящего ответа.

## Как настраивать политики

Политики можно настраивать глобально или на уровне [продукта][продукта], [API][API] или [операции][операции]. Для настройки политики перейдите в редактор политик на портале Publisher.

![Меню «Политики»][Меню «Политики»]

Редактор политик состоит из трех основных разделов: область политики (наверху), определение политики, где политики можно редактировать (слева) и список операторов (справа):

![Редактор политик][Редактор политик]

Чтобы начать процесс настройки политики, необходимо сначала выбрать область, в которой эта политика должна применяться. На снимке экрана ниже выбран продукт 15 Day Free Trial. Следует отметить, что символ квадрата рядом с именем политики указывает, что политика уже применена на этом уровне.

![Область][Область]

Так как политика уже применена, конфигурация показана в виде определения.

![Настройка][Настройка]

Сначала политика отображается в режиме «только для чтения». Для изменения определения щелкните действие «Настроить политику».

![Редактирование][Редактирование]

Определение политики представляет собой простой XML-документ, который описывает последовательность входящих и исходящих операторов. Файл XML можно редактировать прямо в окне определения. Перечень операторов отображается справа, а операторы, применимые к текущей области, включены и выделены (как показано в примере «Ограничить скорость вызовов» на снимке экрана выше).

При щелчке разрешенного оператора будет добавлен соответствующий XML-код в местоположении курсора в виде определения.

Полный перечень операторов политик и их параметров см. в документе [Справочник по политикам][Справочник по политикам].

Например, для добавления нового оператора с целью ограничения входящих запросов на указанные IP-адреса поместите курсор внутрь «входящего» XML-элемента и щелкните оператор «Ограничить IP-адреса вызывающего объекта».

![Политики ограничения][Политики ограничения]

При этом будет добавлен фрагмент XML-кода во «входящий» элемент, который будет содержать указания о том, как настроить оператор.

    <ip-filter action="allow | forbid">
        <address>address</address>
        <address-range from="address" to="address"/>
    </ip-filter>

Для ограничения входящих запросов и принятия только тех запросов, которые поступают с IP-адреса 1.2.3.4, измените XML-код следующим образом:

    <ip-filter action="allow">
        <address>1.2.3.4</address>
    </ip-filter>

![Сохранить][Сохранить]

По окончании процесса настройки операторов для политики щелкните «Сохранить», и изменения будут немедленно распространены на прокси-сервер API Management.

# Общие сведения о конфигурации политики

Политика — это набор операторов, которые выполняются для создания запроса и получения ответа. Конфигурация делится соответствующим образом на входящую часть (запрос) и исходящую часть (политика), как показано в конфигурации.

    <policies>
        <inbound>
            <!-- statements to be applied to the request go here -->
        </inbound>
        <outboud>
            <!-- statements to be applied to the response go here -->
        <outbound>
    </policies>

Так как политики могут быть указаны на разных уровнях (глобальном, продукта, api и операции), то конфигурация позволяет указать порядок, в котором операторы данного определения будут выполняться применительно к родительской политике.

Например, если у вас есть политика на глобальном уровне и политика, настроенная для API, то при каждом использовании этого API будут применяться обе политики. API Management позволяет детерминированным образом упорядочивать объединенные операторы политик через основной элемент.

    <policies>
        <inbound>
            <cross-domain />
            <base />
            <find-and-replace from="xyz" to="abc" />
        </inbound>
    </policies>

В примере определения политики, приведенном выше, кросс-доменный оператор будет выполняться перед любыми более высокими политиками, после которых, в свою очередь, будет следовать политика «найти и заменить».

Примечание. Для глобальной политики более высокой политики не существует; *основным* элементом всегда является *no-op*, или не оказывает никакого влияния.

  [Справочник по политикам]: ../api-management-policy-reference
  [продукта]: ../api-management-howto-add-products
  [API]: ../api-management-howto-add-products/#add-apis
  [операции]: ../api-management-howto-add-operations
  [Меню «Политики»]: ./media/api-management-howto-policies/api-management-policies-menu.png
  [Редактор политик]: ./media/api-management-howto-policies/api-management-policies-editor.png
  [Область]: ./media/api-management-howto-policies/api-management-policies-scope.png
  [Настройка]: ./media/api-management-howto-policies/api-management-policies-configure.png
  [Редактирование]: ./media/api-management-howto-policies/api-management-policies-edit.png
  [Политики ограничения]: ./media/api-management-howto-policies/api-management-policies-restrict.png
  [Сохранить]: ./media/api-management-howto-policies/api-management-policies-save.png

<!--HONumber=46--> 
