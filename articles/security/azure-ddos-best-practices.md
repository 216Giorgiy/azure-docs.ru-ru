---
title: Рекомендации по обеспечению защиты от атак DDoS Azure и эталонная архитектура | Документация Майкрософт
description: Узнайте, как использовать данные журналов для получения подробных сведений о приложении.
services: security
author: barclayn
manager: mbaldwin
editor: TomSh
ms.assetid: ''
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/20/2018
ms.author: barclayn
ms.openlocfilehash: 4b2d785f5b9095a2decfc65ec46808ff6f65c38e
ms.sourcegitcommit: fa493b66552af11260db48d89e3ddfcdcb5e3152
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2018
---
# <a name="azure-ddos-protection-best-practices-and-reference-architecture"></a>Защита от атак DDoS Azure. Рекомендации и эталонная архитектура

Этот документ предназначен для ответственных за принятие решений в сфере ИТ, а также для сотрудников служб безопасности. Предполагается, что вы уже ознакомлены с Azure, сетью и безопасностью.

Для обеспечения устойчивости к распределенным атакам типа "отказ в обслуживании" (DDoS) необходимо планирование и проектирование различных режимов сбоев. В этом документе приведены рекомендации по разработке приложений в Azure для обеспечения устойчивости к атакам DDoS.

## <a name="types-of-attacks"></a>Типы атак

DDoS — это тип атаки, используемый в целях исчерпания ресурсов приложения. Цель: влияние на доступность и возможность обработки допустимых запросов приложения. Атаки становятся все более сложными и крупными по размеру и влиянию. DDoS-атаку можно направить на любую конечную точку, публично доступную через Интернет.

Azure предоставляет постоянную защиту от атак DDoS. Такая защита интегрирована в платформу Azure по умолчанию и предоставляется без дополнительных затрат. В дополнение к основной защите от атак DDoS, предоставляемой на платформе, у нас также есть новое предложение под названием [Защита от атак DDoS Azure уровня "Стандартный"](https://azure.microsoft.com/services/ddos-protection/), которое обеспечивает расширенные возможности предотвращения сетевых атак DDoS. Оно автоматически настраивается для защиты конкретных ресурсов Azure. Защиту можно включить во время создания виртуальных сетей. Кроме того, это можно сделать после первоначального создания. При этом не требуются никакие изменения приложения или ресурса.

![](media/azure-ddos-best-practices/image1.png)

Атаки DDoS можно условно разделить на три категории.

### <a name="volumetric-attacks"></a>Объемные атаки

Это наиболее распространенный тип атак DDoS. Объемные атаки — это атаки методом подбора, нацеленные на сетевой и транспортный уровни. Они пытаются исчерпать такие ресурсы, как сетевые соединения. Во время этих атак, чтобы заполнить сетевые уровни значительным объемом сетевого трафика, который очень похож на обычный, часто используются зараженные системы. Кроме того, используются различные протоколы сетевого уровня, например протокол ICMP, UDP и TCP.

Распространенными атаками DDoS сетевого уровня являются TCP SYN-флуд, эхо ICMP, UDP-флуд, усиление DNS и NTP. Этот тип атаки можно использовать не только для нарушения работы службы, но и как "дымовую завесу" для более целенаправленных сетевых вторжений. Примером объемной атаки является недавний [эксплойт Memcached](https://www.wired.com/story/github-ddos-memcached/), направленный на GitHub. Эта атака была направлена против UDP-порта 11211. Она создала 1,35 ТБ/с объема атаки.

### <a name="protocol-attacks"></a>Атаки протоколов

Атаки протоколов направлены на протоколы приложений. Они пытаются использовать все доступные ресурсы в устройствах инфраструктуры, например брандмауэры, серверы приложений и подсистемы балансировки нагрузки. Атаки протоколов используют пакеты неправильного формата или содержащие аномалии протокола. Эти атаки отправляют большее количество открытых запросов, серверов и других устройств связи, отвечающих на запрос пакета и ожидающих его ответа. Они пытаются ответить на открытые запросы, в результате чего целевая система выходит из строя.

Наиболее распространенным примером атаки DDoS на основе протокола является TCP SYN-флуд. В этой атаке на целевой объект направлена последовательность запросов TCP SYN. Она может быть использована для перегрузки объекта. Цель состоит в том, чтобы целевой объект перестал отвечать. Сбой Dyn в 2016 году, помимо атак на уровне приложений, был вызван также атаками TCP SYN-флуд на порт 53 DNS-серверов.

### <a name="resource-attacks"></a>Атаки ресурсов

Атаки ресурсов направлены на прикладной уровень. Они запускают фоновые процессы с целью перегрузки целевой системы. Атаки ресурсов направлены на трафик, который выглядит обычным, но загружает на сервер запросы, интенсивно использующие ЦП. Объем трафика, необходимый для исчерпания ресурсов, сравнительно ниже, чем у других типов атак. Трафик в атаке ресурсов неотличим от допустимого трафика, что затрудняет обнаружение. Наиболее распространенными атаками ресурсов являются атаки на службы HTTP или HTTPS и DNS.

## <a name="shared-responsibility-in-the-cloud"></a>Разделение ответственности в облаке

Для борьбы с разными типами и возрастающей изощренностью атак требуется комплексная стратегия защиты. Ответственность за безопасность лежит как на клиенте, так и на корпорации Майкрософт. Корпорация Майкрософт называет это [моделью разделения ответственности](https://azure.microsoft.com/blog/microsoft-incident-response-and-shared-responsibility-for-cloud-computing/). Это разделение ответственности представлено на рисунке ниже.

![](media/azure-ddos-best-practices/image2.png)

Мы рекомендуем клиентам Azure ознакомиться с рекомендациями и создать глобально распределенные приложения, разработанные и проверенные с учетом сбоев.

## <a name="fundamental-best-practices"></a>Основные рекомендации

Количество атак DDoS увеличивается. В следующем разделе описано руководство для создания служб Azure, которые могут устоять против атак DDoS.

### <a name="design-for-security"></a>Проектирование для безопасности

Клиенты должны учитывать аспекты безопасности на протяжении всего жизненного цикла приложения — от разработки и реализации до развертывания и эксплуатации. В приложениях могут быть ошибки, позволяющие относительно малому объему обработанных запросов использовать чрезмерное количество ресурсов, что вызывает сбой службы. Чтобы защитить службу, запущенную в Microsoft Azure, клиенты должны изучить архитектуру своего приложения и сосредоточиться на [5 основных аспектах качества программного обеспечения](https://docs.microsoft.com/azure/architecture/guide/pillars).
Они должны знать типичные объемы трафика, модель подключения между приложениями, а также конечные точки службы, к которым предоставлен доступ через Интернет.

Кроме того, в первую очередь они должны убедиться, что приложение достаточно устойчиво для обработки отказа в службе, предназначенной для самого приложения. Безопасность и конфиденциальность создаются прямо на платформе Azure, начиная с [жизненного цикла безопасности ПО (SDL)](https://www.microsoft.com/sdl/default.aspx). SDL обеспечивает защиту на каждом этапе разработки и гарантирует постоянное обновление платформы Azure, чтобы сделать ее более безопасной.

### <a name="design-for-scalability"></a>Проектирование для масштабируемости

Масштабируемость — это способность системы успешно функционировать при повышении нагрузки. Клиенты должны проектировать свои приложения таким образом, чтобы они могли выполнять [горизонтальное масштабирование](https://docs.microsoft.com/azure/architecture/guide/design-principles/scale-out) для удовлетворения запроса на усиленную нагрузку, особенно в случае атаки DDoS. Если приложение зависит от одного экземпляра службы, создается единая точка отказа. Подготовка нескольких экземпляров улучшает как отказоустойчивость, так и масштабируемость.

Для [службы приложений Azure](../app-service/app-service-value-prop-what-is.md) выберите [план служб приложений](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md), где есть несколько экземпляров. Для облачных служб Azure настройте каждую роль для применения [нескольких экземпляров](../cloud-services/cloud-services-choose-me.md). Для [виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) убедитесь, что архитектура виртуальных машин содержит несколько виртуальных машин, а также что каждая виртуальная машина входит в [группу доступности](../virtual-machines/virtual-machines-windows-manage-availability.md). Мы рекомендуем использовать [масштабируемый набор виртуальных машин](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md), чтобы получить возможности автомасштабирования.

### <a name="defense-in-depth"></a>Глубинная защита

Целью глубинной защиты является управление риском с помощью различных защитных стратегий. Иерархическое распределение способов защиты в приложении уменьшает вероятность успешной атаки. Мы рекомендуем клиентам внедрять безопасные проекты для своих приложений через встроенные возможности платформы Azure.

Например, риск атаки увеличивается с размером или контактной зоной приложения. Мы рекомендуем уменьшать контактную зону с помощью списка расширений для закрытия диапазона IP-адресов и прослушивающих портов, которые не нужны для подсистемы балансировки нагрузки ([ALB](../load-balancer/load-balancer-get-started-internet-portal.md)/[App Gateway](../application-gateway/application-gateway-create-probe-portal.md)) или через [группы безопасности сети (NSG).](../virtual-network/virtual-networks-nsg.md)
С помощью [тегов служб](/virtual-network/security-overview.md) и [групп безопасности приложений](/virtual-network/security-overview.md) можно упростить создание правил безопасности и настроить сетевую безопасность как гармоничное расширение структуры приложения.

По возможности клиенты должны развертывать службы Azure в [виртуальной сети](../virtual-network/virtual-networks-overview.md). Это позволит ресурсам службы взаимодействовать через частные IP-адреса. По умолчанию трафик служб Azure из виртуальной сети использует общедоступные IP-адреса в качестве исходных. При помощи [конечных точек служб](../virtual-network/virtual-network-service-endpoints-overview.md) трафик службы в качестве исходных IP-адресов использует частные адреса виртуальной сети при обращении к службе Azure из виртуальной сети.

Локальные ресурсы клиентов часто подвергаются атакам наряду с ресурсами в Azure. Если вы подключаете локальную среду к Azure, мы рекомендуем свести к минимуму предоставление доступа к локальным ресурсам через Интернет. Вы можете использовать возможности масштабирования и расширенной защиты от атак DDoS для Azure, развернув в Azure общедоступные объекты. Так как подобные общедоступные объекты часто являются целью для атак DDoS, их размещение в Azure снижает влияние на локальные ресурсы.

## <a name="azure-ddos-protection"></a>Защита от атак DDoS Azure

Azure предлагает два вида услуг DDoS, которые обеспечивают защиту от сетевых атак (уровня 3 и 4) — защита от атак DDoS уровня "Базовый " и "Стандартный". 

### <a name="azure-ddos-basic-protection"></a>Защита от атак DDoS Azure уровня "Базовый"

Защита уровня "Базовый" интегрирована в Azure по умолчанию и предоставляется без каких-либо дополнительных затрат. Полный масштаб и емкость глобально развернутой сети Azure обеспечивают защиту от распространенных атак сетевого уровня за счет постоянно контролируемого мониторинга трафика и устранения атак в режиме реального времени. Защита от атак DDoS уровня "Базовый" не требует изменений конфигурации пользователя или приложения. Все службы Azure, включая службы PaaS, такие как Azure DNS, используют защиту от атак DDoS уровня "Базовый".

![](media/azure-ddos-best-practices/image3.png)

Защита от атак DDoS Azure уровня "Базовый" состоит из компонентов программного обеспечения и оборудования. Плоскость управления программным обеспечением решает, когда, где и каким типом трафика нужно управлять с помощью устройств, которые анализируют и удаляют трафик атаки. Эта плоскость принимает решение на основе общедоступной *политики* защиты от атак DDoS, которая статически устанавливается и универсально применяется ко всем клиентам Azure.

Например, в политике защиты от атак DDoS указывается, какой должен быть *установлен* объем трафика (т. е. трафик клиента должен проходить через устройства для очистки), а затем, как очищающие устройства должны *устранять* атаки.

Служба защиты от атак DDoS Azure уровня "Базовый" предназначена для защиты инфраструктуры и платформы Azure. Она снижает трафик, если он превышает скорость, которая может влиять на нескольких клиентов в многопользовательской среде. Она не предоставляет предупреждения или настраиваемые политики для каждого клиента.

### <a name="azure-ddos-standard-protection"></a>Защита от атак DDoS Azure уровня "Стандартный"

Защита уровня "Стандартный" предоставляет улучшенные функции устранения атак DDoS и автоматически настраивается для защиты конкретных ресурсов Azure в виртуальной сети. Защита проста в использовании для любой новой или имеющейся виртуальной сети и не требует изменений приложений или ресурсов. Она имеет несколько преимуществ в сравнении с базовой службой, например ведение журнала, оповещения и данные телеметрии. Ниже перечислены основные отличия службы защиты от атак DDoS Azure уровня "Стандартный".

#### <a name="adaptive-realtime-tuning"></a>Адаптивная настройка в режиме реального времени

Защита от атак DDoS Azure уровня "Базовый" защищает клиентов, но только от влияния других клиентов. Например, если служба предоставляется для типичного объема допустимого входящего трафика, который меньше *доли срабатывания триггеров* общей политики защиты от атак DDoS, атака DDoS на ресурсы этого клиента может остаться незамеченной. В более широком смысле сложный характер недавних атак (например, многовекторные атаки DDoS), а также поведение клиентов, связанное с конкретными приложениями, требуют настраиваемых политик для каждого клиента.
Это достигается с помощью двух аналитических инструментов:

1. Автоматическое изучение шаблонов трафика 3/4 уровней для каждого клиента (протокола IP).
2. Минимизация ложных срабатываний, учитывая, что масштаб Azure позволяет поглощать значительный объем трафика.

![](media/azure-ddos-best-practices/image5.png)

#### <a name="ddos-protection-telemetry-monitoring--alerting"></a>Телеметрия, мониторинг и предупреждение системы защиты от атак DDoS

Служба "Защита от атак DDoS" Azure уровня "Стандартный" предоставляет богатую телеметрию с помощью [Azure Monitor](/monitoring-and-diagnostics/monitoring-overview-azure-monitor.md) во время атаки DDoS. Предупреждения можно настроить для любой метрики Azure Monitor, предоставленной с помощью службы "Защита от атак DDoS". Ведение журналов может быть интегрировано со Splunk (концентраторами событий Azure), Azure Log Analytics и службой хранилища Azure для расширенного анализа через интерфейс диагностики Azure Monitor.

##### <a name="ddos-mitigation-policies"></a>Политики устранения атак DDoS

На портале Azure щелкните **Мониторинг** \> **Метрики**. На экране **Метрики** выберите группу ресурсов, тип ресурса "Общедоступный IP-адрес" и свой общедоступный IP-адрес Azure. Метрики DDoS будут видны в области доступных метрик.

"Защита от атак DDoS" уровня "Стандартный" применяет **три политики автоматического устранения атак (TCP SYN, TCP и UDP)** для каждого открытого IP-адреса защищенного ресурса в виртуальной сети с включенной защитой от атак DDoS. Вы можете просмотреть пороговые значения политики, выбрав метрику **Inbound packets to trigger DDoS mitigation** (Входящие пакеты для активации устранения рисков DDoS).

![](media/azure-ddos-best-practices/image7.png)

Пороговые значения политики настраиваются автоматически через профилирование сетевого трафика на основе машинного обучения. Устранение атак DDoS выполняется для атакованного IP-адреса, только если превышены пороговые значения политики.

##### <a name="under-ddos-attack"></a>Атака DDoS

Если общедоступный IP-адрес находится под атакой, значение метрики "Выполняется ли атака DDoS" изменяется на 1, так как выполняется устранение атаки трафика.

![](media/azure-ddos-best-practices/image8.png)

Мы рекомендуем настроить оповещение на основе этой метрики, чтобы получать уведомления о выполнении активного устранения атак DDoS на общедоступном IP-адресе.

Дополнительные сведения см. в статье [Manage Azure DDoS Protection Standard using the Azure portal](../virtual-network/ddos-protection-manage-portal.md) (Управление службой "Защита от атак DDoS Azure" уровня "Стандартный" с помощью портала Azure).

#### <a name="resource-attacks"></a>Атаки ресурсов

При атаках конкретных ресурсов на уровне приложения клиенты должны настроить брандмауэр веб-приложений (WAF), чтобы защитить веб-приложения. WAF проверяет входящий веб-трафик, чтобы блокировать внедрения кода SQL, межсайтовые сценарии, атаки DDoS и другие атаки уровня 7. Azure предоставляет [компонент шлюза приложений WAF](../application-gateway/application-gateway-web-application-firewall-overview.md) для централизованной защиты веб-приложений от распространенных эксплойтов и уязвимостей. В [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps?search=WAF&page=1) можно найти разные предложения WAF от партнеров Azure, соответствующие вашим требованиям.

Даже брандмауэры веб-приложений подвержены объемным атакам. Мы настоятельно рекомендуем включить защиту от атак DDoS уровня "Стандартный" в виртуальной сети WAF для защиты от объемных и протокольных атак. Дополнительные сведения см. в разделе об эталонной архитектуре.

### <a name="protection-planning"></a>Планирование защиты

Планирование и подготовка важны для понимания работы системы во время атаки DDoS. С их помощью также можно разработать план управления реагированием на инциденты.

Клиенты должны убедиться, что служба "Защита от атак DDoS" уровня "Стандартный" включена в виртуальной сети, подключенной к конечной точке с доступом к Интернету. Настройка предупреждений об атаках DDoS помогает постоянно следить за любыми потенциальными атаками, направленными на вашу инфраструктуру. Клиенты должны самостоятельно отслеживать свои приложения. Они должны распознавать нормальное поведение приложения. Если приложение во время атаки DDoS не будет вести себя так, как ожидалось, необходимо предпринять шаги.

#### <a name="ddos-attacks-orchestration"></a>Оркестрация атак DDoS

Мы рекомендуем заранее проверять реакцию служб на атаку, проводя периодическое моделирование. Во время тестирования проверьте, продолжают ли службы или приложения функционировать должным образом и возникают ли проблемы в работе конечного пользователя. Определите пробелы с точки зрения технологии и процесса и учтите их при разработке стратегии реагирования на атаки DDoS. Общая рекомендация — выполнять подобные проверки в промежуточных средах или в периоды низкой загрузки, чтобы свести к минимуму воздействие на производственную среду.

Вместе с [BreakingPoint Cloud](https://www.ixiacom.com/products/breakingpoint-cloud) мы разработали интерфейс, в котором клиенты Azure смогут создавать трафик для защиты от атак DDoS с помощью общедоступных конечных точек для моделирования. Моделирование [BreakPoint Cloud](https://www.ixiacom.com/products/breakingpoint-cloud) позволит вам:

- Проверить, как служба "Защита от атак DDoS Microsoft Azure" защищает ваши ресурсы Azure.

- Оптимизировать процесс реагирования на инциденты во время атаки DDoS.

- Обеспечить соответствие документации по защите от атак DDoS.

- Обучить команды безопасности сети.

Кибербезопасность — это непрекращающаяся битва, требующая постоянных инноваций в защите. "Защита от атак DDoS Azure" уровня "Стандартный" — это современное предложение, предоставляющее эффективные решения для борьбы со все более и более сложными атаками DDoS.

## <a name="components-of-a-ddos-response-strategy"></a>Компоненты стратегии реагирования на атаки DDoS

В большинстве случаев, если атака DDoS нацелена на ресурсы Azure, требуется минимальное вмешательство пользователя. Тем не менее включение устранения атак DDoS в рамках стратегии реагирования на инциденты организации обеспечит минимальное влияние на непрерывность бизнес-процессов.

### <a name="microsoft-threat-intelligence"></a>Анализ угроз корпорации Майкрософт

Корпорация Майкрософт имеет обширную сеть интеллектуальных угроз, которая использует общий набор знаний расширенного сообщества по безопасности, поддерживающее веб-службы и партнеров Майкрософт, а также отношения в сообществе по интернет-безопасности. Как поставщик ключевой инфраструктуры корпорация Майкрософт первой получает предупреждения об угрозах, анализирует угрозы, полученные от других веб-служб и глобальной клиентской базы Майкрософт. Вся информация об угрозах корпорации Майкрософт включена в продукты защиты от атак DDoS Azure.

Кроме того, команда Microsoft Digital Crimes Unit (DCU) реализует наступательные стратегии против ботнетов, распространенного источника управления и контроля для атак DDoS.

### <a name="perform-a-risk-evaluation-of-your-azure-resources"></a>Выполнение оценки риска ресурсов Azure

Необходимо определить область риска от атаки DDoS на постоянной основе. Должны ли клиенты периодически проверять, какие новые общедоступные ресурсы Azure нуждаются в защите? Существует ли в службе единая точка отказа? Как изолировать службы, чтобы ограничить влияние атаки, и по-прежнему предоставлять услуги допустимым клиентам? Есть ли виртуальные сети без защиты от атак DDoS уровня "Стандартный", хотя она и должна быть включена? Активны ли службы с отработкой отказа в нескольких регионах?

### <a name="customer-ddos-response-team"></a>Команда реагирования на атаки DDoS

Создание команды реагирования на атаки DDoS является ключевым шагом в обеспечении эффективного и быстрого реагирования на атаку. Клиенты должны определить различные контакты в организации, которые будут контролировать планирование и выполнение. Команда реагирования на атаки DDoS должна иметь полное представление о службе "Защита от атак DDoS Azure" уровня "Стандартный". Она должна определять и устранять атаку, чтобы обеспечить взаимодействие с различными внутренними и внешними клиентами, при необходимости включая группу поддержки Майкрософт.

Корпорация Майкрософт рекомендует включить планирование и упражнения по симуляции команды реагирования на атаки DDoS, в том числе тестирование масштабирования, в качестве обычной части плана по обеспечению доступности и непрерывной работы службы. 

### <a name="during-an-attack"></a>Во время атаки

"Защита от атак DDoS Azure" уровня "Стандартный" будет определять и устранять атаки DDoS без вмешательства пользователя. Чтобы получать уведомление о наличии активного устранения атак для защищенного общедоступного IP-адреса, вы можете [настроить предупреждение](../virtual-network/ddos-protection-manage-portal.md) на основе метрики "Выполняется ли атака DDoS". При желании вы можете дополнительно просмотреть и создать оповещения для других метрик атак DDoS, чтобы изучить масштабирование атаки, снижающийся трафик и т. д.

#### <a name="when-to-contact-microsoft-support"></a>Обращаться в службу поддержки Майкрософт необходимо в следующих случаях:

- Если во время атаки DDoS защищенный ресурс становится недоступным или его производительность сильно ухудшается.

- Если вы считаете, что служба "Защита от атак DDoS" ведет себя неожиданно. Служба "Защита от атак DDoS" устраняет атаки, если соблюдены следующие критерии:

    - Значение показателя "Политика запуска устранения атак DDoS (TCP/TCP SYN /UDP)" ниже, чем трафик, полученный на защищенном ресурсе общедоступного IP-адреса.

- Если вы планируете вирусное событие, которое значительно увеличит ваш сетевой трафик.

- Если субъект собирается запустить атаку DDoS против ваших ресурсов.

Для решения критических проблем, влияющих на бизнес, создайте [запрос в службу поддержки](https://ms.portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest) с уровнем серьезности А.

### <a name="post-attack-steps"></a>Действия после атаки

Рекомендуем после атаки выполнить итоговый анализ и при необходимости изменить стратегию реагирования на атаки DDoS. Необходимо учитывать следующее:

- Было ли обнаружено какое-либо нарушение работы службы или пользователя из-за отсутствия масштабируемой архитектуры?

- Какие приложения или службы пострадали больше всего?

- Насколько эффективна стратегия реагирования на атаки DDoS и как ее можно улучшить?

Если вы подозреваете, что находитесь под атакой DDoS, используйте обычные каналы поддержки Azure.

## <a name="ddos-protection-reference-architectures"></a>Эталонные архитектуры защиты от атак DDoS

"Защита от атак DDoS" уровня "Стандартный" разработана [для служб, которые развертываются в виртуальной сети.](../virtual-network/virtual-network-for-azure-services.md) Для остальных служб применяется "Защита от атак DDoS" уровня "Базовый". Конкретные эталонные архитектуры, описанные ниже, упорядочены по сценариям. Образцы архитектуры сгруппированы.

### <a name="virtual-machine-windowslinux-workloads"></a>Рабочие нагрузки виртуальной машины (Windows и Linux)

#### <a name="application-running-on-load-balanced-vms"></a>Приложение, запущенное на виртуальных машинах с балансировкой нагрузки

На этой схеме эталонной архитектуры представлены утвержденные способы запуска нескольких виртуальных машин Linux в масштабируемом наборе за подсистемой балансировки нагрузки для повышения доступности и масштабируемости. Эта архитектура может использоваться для любой рабочей нагрузки без учета состояния, например для веб-сервера.

![](media/azure-ddos-best-practices/image9.png)

В этой архитектуре рабочая нагрузка распределяется между несколькими экземплярами виртуальных машин. Здесь приведен один общедоступный IP-адрес, а интернет-трафик распределяется между виртуальными машинами с помощью подсистемы балансировки нагрузки. "Защита от атак DDoS" уровня "Стандартный" включена в виртуальной сети подсистемы балансировки нагрузки Azure (Интернет) с общедоступным IP-адресом.

Подсистема балансировки нагрузки распределяет входящие запросы из Интернета между экземплярами виртуальных машин. Масштабируемые наборы виртуальной машины позволяют масштабировать определенное число виртуальных машин вручную или автоматически на основе предопределенных правил. Это важно, если ресурс находится под атакой DDoS. Дополнительные сведения об этой эталонной архитектуре см. в статье [Запуск виртуальных машин с балансировкой нагрузки для обеспечения масштабируемости и доступности](https://docs.microsoft.com/azure/architecture/reference-architectures/virtual-machines-windows/multi-vm).

#### <a name="applications-running-on-windows-n-tier"></a>N-уровневые приложения, выполняющиеся на компьютере Windows

Существует много способов реализовать n-уровневую архитектуру. На диаграмме показано стандартное трехуровневое веб-приложение. Эта архитектура создана на основе архитектуры из статьи [Запуск виртуальных машин с балансировкой нагрузки для обеспечения масштабируемости и доступности](https://docs.microsoft.com/azure/architecture/reference-architectures/virtual-machines-windows/multi-vm). На веб- и бизнес-уровнях используются виртуальные машины с балансировкой нагрузки.

![](media/azure-ddos-best-practices/image10.png)

В приведенной выше архитектуре "Защита от атак DDoS" уровня "Стандартный" включена в виртуальной сети. Все общедоступные IP-адреса в виртуальной сети получат защиту от атак DDoS уровня 3 или 4. Для защиты от атак уровня 7 необходимо развернуть шлюз приложений в WAF SKU. Дополнительные сведения об этой эталонной архитектуре см. в статье [Запуск виртуальных машин Windows для n-уровневого приложения](https://docs.microsoft.com/azure/architecture/reference-architectures/virtual-machines-windows/n-tier).

#### <a name="paas-web-application"></a>Веб-приложение PaaS

Эталонная архитектура демонстрирует запуск приложения службы приложений Azure в одном регионе. Архитектура демонстрирует набор проверенных методов для создания веб-приложения, в котором используются [служба приложений Azure](https://azure.microsoft.com/documentation/services/app-service/) и служба [База данных SQL Azure](https://azure.microsoft.com/documentation/services/sql-database/).
Резервный регион настроен для сценариев отработки отказа.

![](media/azure-ddos-best-practices/image11.png)

Диспетчер трафика направляет входящие запросы к шлюзу приложений в одном из регионов. При обычной работе он направляет запросы в шлюз приложений в активном регионе. Если этот регион становится недоступным, диспетчер трафика выполняет отработку отказа в шлюз приложений в резервном регионе.

Весь интернет-трафик, предназначенный для веб-приложения, перенаправляется на [общедоступный IP-адрес шлюза приложений](https://docs.microsoft.com/azure/application-gateway/application-gateway-web-app-overview) через диспетчер трафика. В этом случае сама служба приложения (веб-приложения) не является общедоступной — она защищена шлюзом приложений. Для защиты от атак уровня 7 (HTTP, HTTPS, Web Socket) рекомендуем настроить шлюз приложений WAF SKU (режим предотвращения). Кроме того, веб-приложения настроены для [принятия трафика только с IP-адресов шлюза приложений](https://azure.microsoft.com/blog/ip-and-domain-restrictions-for-windows-azure-web-sites/).

Дополнительные сведения об этой эталонной архитектуре см. в статье [Выполнение веб-приложения в нескольких регионах](https://docs.microsoft.com/azure/architecture/reference-architectures/app-service-web-app/multi-region).

### <a name="mitigation-for-non-web-paas-services"></a>Устранение рисков для служб PaaS

#### <a name="hdinsight-on-azure"></a>HDInsight в Azure

Эта эталонная архитектура демонстрирует настройку службы "Защита от атак DDoS" уровня "Стандартный" для [кластера HDInsight](https://docs.microsoft.com/azure/hdinsight/) в Azure. Вы должны убедиться, что кластер HDInsight связан с виртуальной сетью, а "Защита от атак DDoS" включена в этой виртуальной сети.

![](media/azure-ddos-best-practices/image12.png)

![](media/azure-ddos-best-practices/image13.png)

В этой архитектуре трафик, предназначенный для кластера HDInsight, перенаправляется из Интернета на общедоступный IP-адрес, связанный с подсистемой балансировки нагрузки шлюза HDInsight. Затем подсистема балансировки нагрузки шлюза отправляет трафик на головные или рабочие узлы напрямую. Данная "Защита от атак DDoS" уровня "Стандартный" включена в виртуальной сети HDInsight. Все общедоступные IP-адреса в виртуальной сети получат защиту от атак DDoS уровня 3 или 4. Вышеупомянутая эталонная архитектура может объединяться с эталонными архитектурами N-уровневого приложения в нескольких регионах.

Дополнительные сведения об этой эталонной архитектуре см. в статье [Расширение возможностей HDInsight с помощью виртуальной сети Azure](https://docs.microsoft.com/azure/hdinsight/hdinsight-extend-hadoop-virtual-network?toc=%2fazure%2fvirtual-network%2ftoc.json).

### <a name="azure-api-management"></a>Служба управления Azure API

Эта эталонная архитектура защищает общедоступную конечную точку API ресурсов публикации [управления API](../api-management/api-management-key-concepts.md) для клиентов, внешних по отношению к организации. Чтобы включить службу "Защита от атак DDoS", разверните APIM во внешней виртуальной сети.

![](media/azure-ddos-best-practices/image15.png)

Настраивая внешнюю виртуальную сеть, шлюз управления API и портал разработчика становятся доступными из общедоступного Интернета через общедоступную подсистему балансировки нагрузки. В этой архитектуре "Защита от атак DDoS" уровня "Стандартный" включена во внешней виртуальной сети APIM. Трафик направляется из Интернета на общедоступный IP-адрес APIM, который защищен от сетевых атак уровня 3 и 4. Для защиты от атак HTTP и HTTP уровня 7 вы можете настроить шлюз приложений в режиме WAF.

Список дополнительных служб, которые можно развернуть в виртуальной сети, а также настроить для службы "Защита от атак DDoS" уровня "Стандартный" см. в статье [Интеграция виртуальной сети для служб Azure](../virtual-network/virtual-network-for-azure-services.md). "Защита от атак DDoS" уровня "Стандартный" поддерживает только ресурсы Azure Resource Manager. *Внедренное развертывание среды службы приложения (ASE) в виртуальной сети с общедоступным IP-адресом не поддерживается.*  Дополнительные сведения о защите среды ASE см. в этом разделе.

## <a name="next-steps"></a>Дополнительная информация

* [Защита от атак DDoS Azure](https://azure.microsoft.com/services/ddos-protection/)

* [Azure DDoS Protection for virtual networks generally available](http://aka.ms/ddosblog) (Общедоступная версия службы "Защита от атак DDoS Azure" для виртуальных сетей)

* [Общие сведения о защите от атак DDoS Azure уровня "Стандартный"](../virtual-network/ddos-protection-overview.md)
