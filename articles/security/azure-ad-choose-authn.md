---
title: Выбор правильного метода аутентификации для гибридного решения для идентификации Azure AD | Документация Майкрософт
description: Это руководство предназначено для оказания помощи руководителям, ИТ-директорам, руководителям по информационной безопасности, старшим архитекторам по идентификации, корпоративным архитекторам и руководителям отделов безопасности и ИТ-отделов, ответственным за выбор метода аутентификации для своего гибридного решения для идентификации Azure AD в средних и крупных организациях.
services: active-directory
keywords: ''
author: martincoetzer
ms.author: martincoetzer
ms.date: 04/12/2018
ms.topic: article
ms.service: active-directory
ms.workload: identity
ms.openlocfilehash: 102fa06be3734fa6993616f752922433ee0dee7f
ms.sourcegitcommit: fa493b66552af11260db48d89e3ddfcdcb5e3152
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2018
---
# <a name="choosing-the-right-authentication-method-for-your-azure-active-directory-hybrid-identity-solution"></a>Выбор правильного метода аутентификации для гибридного решения для идентификации Azure Active Directory 

Эта статья является первой в серии статей, написанных, чтобы помочь организациям реализовать полное гибридное решение для идентификации Azure AD. Полное гибридное решение для идентификации Azure AD было обозначено как гибридная платформа цифрового преобразования идентификации и охватывает результаты в сфере бизнеса и цели, на которых должны сосредоточиться организации, чтобы убедиться, что они реализовали надежное и безопасное гибридное решение для идентификации. Первый бизнес-результат этой платформы разъясняет требования к организациям для обеспечения аутентификации при доступе пользователей к облачным приложениям. Первой целью организации в бизнес-результате, защищенном с помощью аутентификации, является способность пользователей входить в облачные приложения с помощью локальных имен пользователей и паролей. Этот процесс входа в систему и способ аутентификации пользователей делает возможным выполнение других операций в облаке.

Выбор правильного метода аутентификации является первой задачей для организаций, которые хотят переместить свои приложения в облако. Это решение не должно приниматься легкомысленно по следующим причинам:

1. Это первое решение для организации, желающей перейти в облако. 

2. Метод аутентификации является критическим компонентом присутствия организации в облаке, контролирующим доступ ко всем облачным данным и ресурсам.

3. Это основа всех других дополнительных функций безопасности и пользовательского интерфейса в Azure AD.

4. Метод аутентификации после реализации сложно изменить.

Так как удостоверение — это новый уровень управления ИТ-безопасности, аутентификация является инструментом защиты доступа организации к новому облачному миру. Организации должны убедиться, что уровень управления идентификатором обеспечивает надежную безопасность и защищает облачные приложения от атак злоумышленников.

### <a name="out-of-scope"></a>Вне области

Организации, у которых нет локального каталога, в этой статье не рассматриваются. Как правило, эти предприятия создают идентификаторы только в облаке, что не требует гибридного решения для идентификации. Удостоверения только для облаков есть исключительно в облаке и не связаны с соответствующими локальными удостоверениями.  

## <a name="choosing-the-right-authentication-method"></a>Выбор правильного метода аутентификации

С решением для гибридной идентификации Azure AD в качестве нового уровня управления аутентификация является основой доступа к облаку. Выбор правильного метода аутентификации является основным первым решением при настройке решения для гибридной идентификации Azure AD. Реализация метода аутентификации настраивается с помощью Azure AD Connect, что также дает возможность подготовить пользователей в облаке. 

Чтобы выбрать метод аутентификации, необходимо учитывать время, имеющуюся инфраструктуру, сложность и стоимость реализации решения. Эти факторы отличаются для каждой организации и могут изменяться с течением времени. 

Azure AD поддерживает следующие методы аутентификации для решений для гибридной идентификации:

### <a name="cloud-authentication"></a>Облачная аутентификация
При выборе этого метода аутентификации Azure AD обрабатывает процесс входа для пользователей. В сочетании с простым единым входом (SSO) пользователи могут войти в облачные приложения без необходимости повторного ввода своих учетных данных. При использовании облачной аутентификации вы можете выбрать один из двух вариантов: 

**Синхронизация хэша паролей (PHS)** — самый простой способ включить аутентификацию объектов локального каталога в Azure AD. Синхронизация хэша паролей позволяет пользователям использовать те же имя пользователя и пароль, которые они используют в локальной среде, без необходимости развертывания какой-либо дополнительной инфраструктуры. Некоторые функции уровня "Премиум" Azure AD, такие как "Защита идентификации", требуют синхронизации хэша паролей независимо от выбранного метода аутентификации.

> [!NOTE] 
> Пароли никогда не сохраняются в виде открытого текста или зашифровываются с помощью обратимого алгоритма в Azure AD. Для получения дополнительной информации о фактическом процессе синхронизации хэша паролей см. статью [Реализация синхронизации хэшированных паролей в службе синхронизации Azure AD Connect](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnectsync-implement-password-synchronization). 

**Сквозная аутентификация (PTA)** — предоставляет простую проверку пароля для служб аутентификации Azure AD с помощью агента программного обеспечения, работающего на одном или нескольких локальных серверах, для проверки пользователей непосредственно с помощью локального каталога Active Directory, гарантируя отсутствие проверки пароля в облаке. Компании с нормативным требованием, которое не допускает хранение хэшированных паролей в облаке, из-за чего не может использоваться синхронизация хэша паролей, будут использовать этот метод аутентификации. Для получения дополнительной информации о фактическом процессе сквозной аутентификации см. статью [Вход пользователей с помощью сквозной проверки подлинности Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-pass-through-authentication).

### <a name="federated-authentication"></a>Федеративная аутентификация
При выборе этого метода аутентификации Azure AD передает процесс аутентификации отдельной доверенной системе аутентификации, например локальным службам федерации Active Directory (AD FS), для проверки пароля пользователя. Система аутентификации может предоставлять дополнительные требования к аутентификации, такие как аутентификация на основе смарт-карт или сторонняя многофакторная проверка подлинности. Дополнительные сведения см. в статье о [развертывании служб федерации Active Directory](https://docs.microsoft.com/en-us/windows-server/identity/ad-fs/deployment/windows-server-2012-r2-ad-fs-deployment-guide).

В следующем разделе с помощью дерева принятия решений вы узнаете, какой метод аутентификации подходит вам. Это поможет вам определить, следует ли развертывать облачную или федеративную аутентификацию для своего решения для гибридной идентификации Azure AD.

## <a name="azure-ad-authentication-decision-tree"></a>Дерево принятия решений аутентификации Azure AD

![рисунок 1](media/azure-ad/azure-ad-authn-image1.png)

## <a name="detailed-considerations-on-authentication-methods"></a>Подробные рекомендации по методам аутентификации

### <a name="cloud-authentication-password-hash-sync"></a>Облачная аутентификация: синхронизация хэша паролей 

* **Трудозатраты:** синхронизация хэша паролей требует минимальных усилий по развертыванию, обслуживанию и инфраструктуре для организаций, которым требуется только обеспечить вход своих пользователей в Office 365, приложения SaaS и другие ресурсы на основе Azure AD. После включения синхронизация хэша паролей является частью процесса синхронизации Azure AD Connect и запускается каждые две минуты. 

* **Возможности для пользователя:** рекомендуется, чтобы организации развертывали простой единый вход (SSO) с помощью синхронизации хэша паролей, чтобы улучшить интерфейс для входа пользователя, избегая ненужных запросов после их входа в систему.

* **Сложные сценарии:** при заинтересованности организаций можно использовать варианты из удостоверений с отчетами по защите идентификации Azure AD, например отчет об утечке учетных данных. Windows Hello для бизнеса — это другой вариант, который включает [особые требования при использовании синхронизации хэша паролей](https://docs.microsoft.com/en-us/windows/access-protection/hello-for-business/hello-identity-verification). Организации, требующие многофакторную проверку подлинности с помощью синхронизации хэша паролей, должны использовать многофакторную проверку подлинности Azure AD и не могут использовать сторонние или локальные методы многофакторной проверки подлинности.

* **Непрерывность бизнес-процессов:** синхронизация хэша паролей по своей сути высокодоступна как облачная служба, которая масштабируется для всех центров обработки данных Майкрософт. Рекомендуется, чтобы второй сервер Azure AD Connect был развернут в промежуточном режиме в резервной конфигурации для целей аварийного восстановления.

* **Рекомендации:** синхронизация хэша паролей не обеспечивает немедленное внесение изменений в состояния локальных учетных записей. В этой ситуации пользователь будет иметь доступ к облачным приложениям, пока состояние учетной записи пользователя не будет синхронизировано с Azure AD. Если организации хотят преодолеть это ограничение, рекомендуется, чтобы новый цикл синхронизации активировался после того, как администраторы выполнят массовые процедуры обновления состояния локальных учетных записей пользователей, такие как отключение учетных записей. Заблокированные учетные записи — это другое состояние учетной записи пользователя, которое синхронизируется в следующем цикле. 

> [!NOTE] 
> Состояние с истекшим сроком действия пароля в настоящее время не синхронизируется с Azure AD с Azure AD Connect. 

Ознакомьтесь с [реализацией синхронизации хэша паролей](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnectsync-implement-password-synchronization), чтобы узнать о шагах по развертыванию.

### <a name="cloud-authentication-pass-through-authentication"></a>Облачная аутентификация: сквозная аутентификация  

* **Трудозатраты:** для сквозной аутентификации вам необходим один или несколько (рекомендуется три) упрощенных агента, установленных на имеющихся серверах с доступом к локальным доменным службам Active Directory, включая доступ к локальным контроллерам домена AD. Этим агентам необходим исходящий доступ к Интернету и доступ к контроллерам домена. Поэтому не поддерживается развертывание агентов в сети периметра, так как для этого требуется неограниченный сетевой доступ к контроллерам домена. Весь сетевой трафик зашифрован и ограничен запросами аутентификации. Дополнительные сведения об этом процессе см. в статье [о безопасности](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-pass-through-authentication-security-deep-dive) в сквозной аутентификации.

* **Возможности для пользователя:** рекомендуется, чтобы организации развертывали простой единый вход с помощью сквозной аутентификации, чтобы улучшить интерфейс для входа пользователя, избегая ненужных запросов после их входа в систему.

* **Сложные сценарии:** сквозная аутентификация позволяет сразу отклонять запросы на аутентификацию, если локальная учетная запись пользователя отключена, заблокирована, ее пароль просрочен или пользователь пытается войти в систему в непредусмотренное время. Организации, требующие многофакторную проверку подлинности с помощью сквозной аутентификации, должны использовать многофакторную проверку подлинности Azure AD и не могут использовать сторонние или локальные методы многофакторной проверки подлинности. Дополнительные функции, такие как отчет об утечке учетных данных защиты идентификации, требуют, чтобы синхронизация хэша паролей была развернута независимо от того, выбрали ли вы сквозную аутентификацию.

* **Непрерывность бизнес-процессов:** рекомендуется обеспечить развертывание двух дополнительных агентов сквозного доступа, кроме первого агента на сервере Azure AD Connect, для обеспечения высокого уровня доступности запросов на аутентификацию. Если развернуты три агента, один агент все еще может выйти из строя, если другой агент отключен для обслуживания. Еще одним преимуществом развертывания синхронизации хэша паролей в дополнение к сквозной аутентификации является то, что она может действовать как резервный метод аутентификации, когда основной метод аутентификации больше недоступен, например, когда локальные серверы недоступны.

* **Рекомендации:** если вы используете синхронизацию хэша паролей в качестве резервного метода аутентификации для сквозной аутентификации и агенты не могут проверить учетные данные пользователя, то отработка отказа для синхронизации хэшей паролей не произойдет автоматически. Необходимо вручную переключить метод входа с помощью Azure AD Connect. Сквозная аутентификация поддерживает только облачные приложения, которые используют современную аутентификацию и специальные протоколы Exchange Online, такие как ActiveSync, POP3 и IMAP4. Например, ознакомьтесь с записью блога о [Microsoft Office 2013 и более поздних версий, поддерживающих современную аутентификацию](https://blogs.office.com/en-us/2015/11/19/updated-office-365-modern-authentication-public-preview/), чтобы узнать о поддержке приложений Office. Ознакомьтесь с [часто задаваемыми вопросами](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-pass-through-authentication-faq) и другими вопросами о сквозной аутентификации, включая поддержку альтернативного идентификатора.

Ознакомьтесь с [реализацией сквозной аутентификации](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-pass-through-authentication), чтобы узнать о шагах по развертыванию.

### <a name="federated-authentication"></a>Федеративная проверка подлинности

* **Трудозатраты:** использование федеративной системы аутентификации зависит от внешней системы аутентификации пользователей. Некоторые компании хотят повторно использовать имеющиеся инвестиции федеративной системы с решением для гибридной идентификации Azure AD. Обслуживание федеративной системы и управление ею выходит за рамки контроля Azure AD. Именно от организации, использующей федеративную систему, зависит ее безопасное развертывание и способность обрабатывать нагрузку аутентификации. 

* **Возможности для пользователя:** пользовательские возможности федеративной аутентификации зависят от реализации функций, топологии и конфигурации фермы федерации. Некоторым организациям требуется такая гибкость для адаптации и настройки доступа к ферме федерации в соответствии с их требованиями к безопасности. Например, можно настроить внутренне подключенных пользователей и устройства для автоматического входа в систему, не запрашивая учетные данные, так как вход на устройства уже выполнен. С другой стороны, при необходимости некоторые усовершенствованные функции безопасности могут усложнить процесс входа пользователя.

* **Сложные сценарии:** решение для федеративной аутентификации обычно требуется, когда у клиентов есть требование к аутентификации, изначально не поддерживаемое Azure AD. Подробная информация содержится [здесь](https://blogs.msdn.microsoft.com/samueld/2017/06/13/choosing-the-right-sign-in-option-to-connect-to-azure-ad-office-365/), но общие требования включают следующее:

    * Аутентификация, требующая смарт-карты или сертификаты.
    * Использование локального сервера MFA или стороннего поставщика многофакторной проверки подлинности.
    * Аутентификация с использованием стороннего решения аутентификации. Ознакомьтесь со [списком совместимости с федерацией Azure AD](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-federation-compatibility).
    * Пользователи должны войти в систему, используя имя sAMAccountName, например DOMAIN\имя пользователя, а не имя участника-пользователя (UPN), например user@domain.com.
    * Реализация Windows Hello для бизнеса зависит от внутренней инфраструктуры корпоративного открытого ключа (PKI) для доверия сертификата.

* **Непрерывность бизнес-процессов:** в федеративных системах обычно требуется массив серверов с подсистемой балансировки нагрузки, также известный как ферма, настроенный во внутренней сети, и топология сети периметра, чтобы обеспечить высокую доступность для запросов аутентификации. Синхронизацию хэша паролей можно развернуть с федеративной аутентификацией как резервный метод аутентификации, когда основной метод аутентификации больше недоступен, например когда локальные серверы недоступны. Некоторым крупным корпоративным организациям требуется решение федерации для поддержки нескольких точек доступа в Интернет, настроенных с использованием гео-DNS для запросов аутентификации с низкой задержкой.

* **Рекомендации:** федеративные системы обычно требуют более значительных инвестиций в локальную инфраструктуру. Большинство организаций выбирают этот вариант, если у них уже есть инвестиции в локальной федерации, и это важное бизнес-требование для использования единого поставщика удостоверений. Федерация более сложна с точки зрения работы и устранения неполадок по сравнению с облачными решениями аутентификации. Использование идентификаторов пользователей с доменом, не поддерживающим маршрутизацию, который нельзя проверить в Azure AD для входа, требует реализации дополнительной конфигурации. Это требование называется поддержкой альтернативного имени для входа. Ознакомьтесь со статьей о [настройке альтернативного имени для входа](https://docs.microsoft.com/en-us/windows-server/identity/ad-fs/operations/configuring-alternate-login-id), чтобы узнать об ограничениях и требованиях.

Ознакомьтесь с [реализацией служб федерации](https://docs.microsoft.com/en-us/windows-server/identity/ad-fs/deployment/deploying-federation-servers), чтобы узнать о шагах по развертыванию.

> [!NOTE] 
> При развертывании гибридного решения для идентификации Azure AD вы должны обеспечить реализацию одной из поддерживаемых топологий Azure AD Connect. Дополнительные сведения о поддерживаемых и неподдерживаемых конфигурациях см. в статье [Топологии Azure AD Connect](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-topologies).

## <a name="architecture-diagrams"></a>Схемы архитектуры

На следующей схеме представлены компоненты архитектуры высокого уровня, необходимые для каждого метода аутентификации, который вы можете использовать с решением для гибридной идентификации Azure AD. Она содержит обзор для сравнения различий между решениями.

На следующей схеме показано простое решение синхронизации хэша паролей:

![PHS](media/azure-ad/azure-ad-authn-image2.png)

На следующей схеме показаны требования к агенту сквозной аутентификации:

![PTA](media/azure-ad/azure-ad-authn-image3.png)

На следующей схеме показаны компоненты, необходимые для федерации в периметре и внутренней сети организации:

![ADFS](media/azure-ad/azure-ad-authn-image4.png)

## <a name="recommendations-and-considerations-from-azure-ad"></a>Рекомендации от Azure AD

Ваша система идентификации гарантирует доступ пользователей к облачным приложениям и бизнес-приложениям, которые вы переносите в облако. Аутентификация управляет доступом к приложениям, обеспечивая работу авторизованных пользователей и исключение остальных для защиты конфиденциальных данных организации. Поэтому рассмотрите следующие рекомендации по выбору правильного метода аутентификации для организации. 

Используйте или активируйте синхронизацию хэша паролей независимо от того, какой метод аутентификации вы выбираете, по следующим причинам:

1. **Высокая доступность и аварийное восстановление:** сквозная аутентификация и федерация зависят от локальной инфраструктуры. Для сквозной аутентификации это включает в себя аппаратное обеспечение сервера и сети. Она также зависит от контроллеров домена для реагирования на запросы аутентификации из агентов сквозной аутентификации. Для федерации локальный охват еще больше, так как нужны серверы в сети периметра для отправки запросов аутентификации на прокси-сервер и внутренние серверы федерации. Чтобы избежать единых точек отказа, организация должна развернуть избыточные серверы, чтобы гарантировать постоянное обслуживание запросов аутентификации, если какой-либо компонент выходит из строя. Многие компоненты нуждаются в техническом обслуживании, чтобы оставаться работоспособными, а простои более вероятны, когда техническое обслуживание не спланировано и выполняется неправильно. Простоев можно избежать, используя синхронизацию хэша паролей, так как облачная служба аутентификации Azure AD Майкрософт масштабируется глобально и всегда доступна.

2. **Решение для локальных сбоев:** последствия локальных сбоев из-за кибератаки или аварии могут быть существенными, начиная от ущерба репутации бренда до неспособности организации справиться с атакой. В прошлом году многие организации стали жертвами вредоносных атак, включая целевые программы-шантажисты, что привело к отключению локальных серверов. Чтобы помочь клиентам справиться с такими видами атак, корпорация Майкрософт обратила внимание на две категории организаций:

   a. Организации, которые ранее включили функцию синхронизации хэша паролей, через несколько часов вернулись в интерактивный режим, изменив метод аутентификации на использование синхронизации хэша паролей. Используя доступ к электронной почте через Office 365, они смогли работать над решением проблемы и получением доступа к другим облачным рабочим нагрузкам.

   Б. Организации, которые ранее не включили функцию синхронизации хэша паролей, вынуждены были использовать ненадежные почтовые системы внешних объектов-получателей для обмена данными и решения проблем. В этих случаях потребовалось несколько недель или больше, чтобы вернуться в привычный режим работы.

3. **Защита идентификации:** одним из лучших способов защиты пользователей в облаке является "Защита идентификации Azure Active Directory". Корпорация Майкрософт постоянно ищет в Интернете списки пользователей и паролей, которые злоумышленники продают и обнародуют на теневых веб-сайтах. Azure AD может использовать эту информацию, чтобы проверить, были ли скомпрометированы какие-либо имена пользователей и пароли в организации. Поэтому очень важно включить синхронизацию хэша паролей, независимо от используемого метода аутентификации, будь то федеративная или сквозная аутентификация. Утерянные учетные данные представлены в виде отчета и могут использоваться для блокировки, или чтобы заставить пользователя изменить пароль при попытке войти в систему с утерянным паролем.

Наконец, по мнению компании [Gartner](https://info.microsoft.com/landingIAMGartnerreportregistration.html) у корпорации Майкрософт самый полный набор функций управления идентификацией и доступом. Корпорация Майкрософт отбивает семь триллионов кибератак в день, обеспечивая вход для авторизованных пользователей в тысячи приложений SaaS, таких как Office 365, практически с любого устройства. 

## <a name="conclusion"></a>Заключение

В этой статье описываются различные варианты аутентификации, которые организации могут настроить и развернуть для поддержки доступа в облачные приложения. Для удовлетворения различных бизнес-требований, технических требований и требований безопасности организации могут выбрать между синхронизацией хэша паролей, сквозной и федеративной аутентификацией. С помощью каждого метода аутентификации организация может выбрать, будут ли бизнес-требования удовлетворены путем развертывания решения и возможностью выполнить вход в систему. Вам также необходимо оценить, нужны ли вашей организации расширенные сценарии и возможности непрерывности бизнес-процессов каждого метода аутентификации. Наконец, вы должны оценить рекомендации по каждому методу аутентификации, чтобы определить, не мешает ли какая-то из них реализации метода.

## <a name="next-steps"></a>Дополнительная информация

В современном мире угрозы есть постоянно и повсюду. Реализация правильного метода аутентификации поможет снизить риски для безопасности и защитить удостоверения. 

[Начните работу](https://docs.microsoft.com/en-us/azure/active-directory/get-started-azure-ad) с Azure AD и разверните правильное решение аутентификации для своей организации.

Если вы планируете перейти с федеративной аутентификации на облачную, узнайте больше об [изменении метода входа](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-user-signin#changing-the-user-sign-in-method). Чтобы спланировать и реализовать перемещение, можно использовать [эти планы проектов](https://github.com/Identity-Deployment-Guides/Identity-Deployment-Guides/tree/master/Authentication).
