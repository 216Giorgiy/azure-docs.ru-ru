<properties
   pageTitle="Концепции каталога данных Azure для разработчиков | Microsoft Azure"
   description="Введение в основные понятия концептуальной модели каталога данных Azure, предоставляемой через каталог REST API."
   services="data-catalog"
   documentationCenter=""
   authors="dvana"
   manager="mblythe"
   editor=""
   tags=""/>
<tags 
   ms.service="data-catalog"
   ms.devlang="NA"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-catalog"
   ms.date="03/10/2016"
   ms.author="derrickv"/>

# Концепции каталога данных Azure для разработчиков

**Каталог данных Azure** — это полностью управляемая облачная служба, предоставляющая возможности обнаружения источников данных и совместной работы над метаданными источников данных. Разработчики могут взаимодействовать с этой службой через интерфейс API REST. Для успешной интеграции с **каталогом данных Azure** разработчикам важно понимать концепции, реализованные в каталоге.

## Основные понятия

В основе концептуальной модели **каталога данных Azure** лежат четыре основных понятия: **каталог**, **пользователи**, **ресурсы** и **аннотации**.

![концепция][1]

*Рисунок 1. Упрощенная концептуальная модель каталога данных Azure*

### Каталог

Объект **каталога** является контейнером верхнего уровня для всех метаданных, которые будут храниться в организации. В каждой учетной записи Azure имеется только один **каталог**. Каталоги привязаны к подписке Azure, но для каждой учетной записи Azure можно создать только один **каталог**, хотя у одной учетной записи может быть несколько подписок.

Каталог содержит **пользователей** и **ресурсы**.

### Пользователи

Пользователи являются субъектами безопасности, имеющими разрешения на выполнение определенных действий в каталоге (поиск, добавление, изменение, удаление элементов и т. д).

Существует несколько различных ролей, которые может иметь пользователь. Дополнительные сведения о ролях приведены в разделе "Роли и авторизация".

Можно добавлять отдельных пользователей и группы безопасности.

Для управления доступом и идентификации пользователей каталог данных Azure использует Azure Active Directory. Каждый пользователь каталога должен быть членом Active Directory для учетной записи.

### Активы

**Каталог** содержит ресурсы данных. **Ресурс** — это единица детализации, управляемая каталогом.

Детализация ресурса может быть разной в зависимости от источника данных. Для базы данных Oracle или SQL Server в качестве ресурса могут выступать таблица или представление. В службах SQL Server Analysis Services ресурсами могут быть меры, измерения или ключевые показатели эффективности. В службах SQL Server Reporting Services ресурсом может быть отчет.

**Ресурс** — это элемент, который добавляется в каталог или удаляется из него. Ресурс является единицей данных, получаемых в результате **поиска**.

**Ресурс** включает не только данные об имени, расположении и типе ресурса, но и заметки с описанием ресурса.

### Аннотации

Аннотации — это элементы, представляющие метаданные ресурсов.

Заметки представлены описаниями, тегами, схемами, документацией и т. д. Полный список типов заметок и ресурсов приведен в разделе «Объектная модель ресурса».

## Совместная работа над аннотациями и мнения пользователей (множественность мнений)

Важным аспектом каталога данных Azure является то, как он поддерживает совместную работу над метаданными в системе. В отличие от подхода wiki, где есть только одно мнение и оно принадлежит последнему написавшему, в модели каталога данных Azure возможно одновременное сосуществование нескольких мнений.

Этот подход отражает реальный мир корпоративных данных, в которых пользователи могут иметь различный взгляд на один и тот же ресурс:

-	Администратор базы данных может предоставить сведения о соглашениях об уровне обслуживания или о доступном окне обработки для массовых операций ETL
-	Менеджер данных может предоставить сведения о бизнес-процессах, к которым применяется ресурс, или бизнес-категориях ресурса
-	Финансовый аналитик может предоставить сведения об использовании данных при подготовке отчетов конца периода

В этом примере каждый пользователь — администратор базы данных, менеджер данных и аналитик — может добавить свое описание к одной и той же таблице, зарегистрированной в каталоге. Все описания сохраняются в системе и отображаются на портале каталога данных Azure.

Этот шаблон применяется к большинству элементов объектной модели. По этой причине в полезных данных JSON там, где можно было ожидать одноэлементный объект, часто встречаются массивы свойств.

Например в корневом ресурсе находится массив объектов описаний. Свойство массива называется "описанием". Объект описания имеет три свойства: описание, теги и friendlyName (понятное имя). Каждый пользователь, который набирает одно или несколько из этих свойств, получает объект описания, созданный для введенных пользователем значений.

Затем можно выбрать способ отображения сочетания. Существует три различных шаблона отображения.

-	Самый простой — "Показать все". В этом шаблоне отображаются все объекты в виде какого-либо списка. Это те действия, которые выполняются порталом каталога данных Azure для описания.
-	Другой шаблон — "Слияние". В этом шаблоне все значения от различных пользователей объединяются, а дубликаты удаляются. Примерами этого шаблона в портале каталога данных Azure являются свойства тегов и экспертов.
-	Третий шаблон — "Побеждает последний". В этом шаблоне отображается только последнее значение. Пример этого шаблона — friendlyName.

## Объектная модель ресурса

Как описано в разделе «Ключевые концепции», объектная модель **каталога данных Azure** включает элементы, которые могут быть ресурсами или заметками. Элементы имеют свойства, которые могут быть обязательными или необязательными. Некоторые свойства применяются ко всем элементам. Некоторые свойства применяются ко всем ресурсам. Некоторые свойства применяются только к ресурсам определенного типа.

### Общие свойства

Эти свойства применяются ко всем корневым типам ресурсов и ко всем типам аннотаций.

> [AZURE.NOTE] Свойства, имена которых начинаются с двух символов подчеркивания, имеют системный тип.

|**Имя свойства**|**Тип данных**|**Комментарии**
|---|---|---
|modifiedTime|DateTime|Время последнего изменения корневого ресурса. Задается клиентом. (Сервер не сохраняет это значение.)
|__id|Строка|Идентификатор элемента (только для чтения). Этот идентификатор ресурса гарантированно является уникальным в каталоге.
|__type|Строка|Тип ресурса (только для чтения).
|__\_\_creatorId|Строка|Строка, используемая создателем ресурса для уникальной идентификации ресурса.

### Общие свойства корневого ресурса

Эти свойства применяются ко всем типам корневых ресурсов.

|**Имя свойства**|**Тип данных**|**Комментарии**
|---|---|---
|name|Строка|Имя, полученное на основе данных о расположении источника данных
|dsl|Data Source Location|Однозначно определяет источник данных и является одним из идентификаторов ресурса. (См. раздел о двойной идентификации.) Структура dsl зависит от типа источника.
|dataSource|DataSourceInfo|Дополнительные сведения о типе ресурса.
|lastRegisteredBy|SecurityPrincipal|Описание пользователя, который последним зарегистрировал этот ресурс. Содержит уникальный идентификатор пользователя (upn) и отображаемое имя пользователя (lastName и firstName).
|lastRegisteredTime|dateTime|Время последней регистрации ресурса в каталоге.
|containerId|Строка|Идентификатор ресурса-контейнера для источника данных. Это свойство не поддерживается для типа контейнера.

### Типы корневых ресурсов

Типы корневых ресурсов — это типы, представляющие различные типы ресурсов данных, которые могут быть зарегистрированы в каталоге.

|**Тип ресурса**|**Дополнительные свойства**|**Тип данных**|**Комментарии**
|---|---|---|---
|Таблица|||Таблица представляет любые табличные данные. Сюда относятся: таблица SQL, представление SQL, таблица табличного режима служб Analysis Services, многомерное измерение Analysis Services, таблица Oracle и т. д.
|Measure|||Этот тип представляет измерение Analysis Services.
||Measure|Столбец|Метаданные, описывающие измерение
||isCalculated|Логический|Указывает, вычисляется измерение или нет.
||measureGroup|Строка|Физический контейнер для измерения
||goalExpression|Строка|Числовое выражение MDX или вычисление, которое возвращает целевое значение ключевого показателя эффективности.
||valueExpression|Строка|Числовое выражение MDX, которое возвращает фактическое значение ключевого показателя эффективности.
||statusExpression|Строка|Выражение MDX, которое отражает состояние ключевого показателя эффективности в заданный момент времени.
||trendExpression|Строка|Выражение MDX, которое оценивает значение ключевого индикатора производительности во времени. В качестве тренда может использоваться любой временной критерий, который удобно использовать в заданном бизнес-контексте.
||measureGroup|Строка|физический контейнер для измерения
|Отчет|||Этот тип представляет отчет для служб отчетов SQL Server
||CreatedBy|Строка| |
||CreatedDate|Строка| |
|Контейнер|||Этот тип представляет контейнер других ресурсов, таких как база данных SQL, контейнер больших двоичных объектов Azure или модель служб Analysis Services.

### Типы аннотаций

Типы аннотаций представляют типы метаданных, которые могут быть назначены другим типам в каталоге.

|**Тип аннотации**|**Дополнительные свойства**|**Тип данных**|**Комментарии**
|---|---|---|---
|Описание|||Каждый пользователь системы может добавлять собственные описания и теги. Изменить объект описания может только пользователь, создавший его. (Администраторы и владельцы ресурса могут удалить объект описания, но не изменить его.) Система хранит эти описания отдельно. Таким образом формируется массив описаний для каждого ресурса (по одному для каждого пользователя, который добавил информацию о ресурсе, и, возможно, еще одно описание, которое содержит сведения, полученные из источника данных).
||friendlyName|string|Понятное имя, которое можно использовать вместо имени, полученного от источника данных. Это имя удобно использовать для отображения и поиска.
||tags|string|Массив тегов для ресурса
||description|string|Краткое описание ресурса (2-3 строки)
|Схема|||Схема описывает структуру данных. Она содержит список имен (столбец, атрибут, поле и т. д.) и типов атрибутов, а также другие метаданные. Вся эта информация извлекается из источника данных. У одного ресурса обычно есть одна схема.
||columns|столбец|Массив объектов столбцов. Они описывают столбец с информацией, полученной из источника данных.
|SchemaDescription|||Содержит описание и набор тегов для каждого атрибута, определенного в схеме. Каждый пользователь системы может добавлять собственные описания и теги. Изменить объект описания может только пользователь, создавший его. (Администраторы и владельцы ресурсов могут только удалить объект SchemaDescription, но не изменить его.) Система хранит эти описания отдельно. Таким образом формируется массив объектов SchemaDescription для каждого ресурса (по одному для каждого пользователя, который добавил информацию об атрибутах, и, возможно, еще один объект, который содержит сведения, полученные из источника данных). Атрибуты схемы слабо привязаны к схеме, поэтому они могут потерять свою актуальность, т. е. SchemaDescription может описывать столбцы, которых больше не существует в схеме, или не содержать нового столбца, который недавно был добавлен. За синхронизацию атрибутов отвечает тот, кто производит запись. Источник данных также может иметь описание. Оно может быть представлено в виде дополнительного объекта schemaDescription, создаваемого при запуске средства.
||columnDescriptions|ColumnDescription|Массив объектов ColumnDescription, описывающих столбцы схемы.
|Эксперт|||Содержит список пользователей, которые считаются экспертами в наборе данных. Мнения экспертов (т. е. их описания) будут перемещаться в верхнюю часть списков описаний в пользовательском интерфейсе. Каждый пользователь может задавать собственные списки экспертов. Изменить объект эксперта может только пользователь, создавший его. (Администраторы и владельцы ресурса могут удалить объект Experts, но не изменить его.)
||experts|string|Массив адресов электронной почты.
|Предварительный просмотр|||Предварительный просмотр содержит моментальный снимок 20 верхних строк данных ресурса. Предварительный просмотр имеет смысл только для некоторых типов ресурсов (например для таблицы, но не для измерения).
||предварительный просмотр|object|Массив объектов, представляющих столбцы. Каждый объект имеет сопоставление свойства на столбец со значением для этого столбца и строки.
|AccessInstruction|||Содержит сведения о том, как запрашивать доступ к источнику данных. Это сведения, которые отображаются в поле «Запрос на доступ» на портале каталога.
||mimeType|string|Тип mime содержимого.
||Содержимое|string|Инструкции для получения доступа к этому ресурсу-контейнеру данных. Это может быть URL-адрес, адрес электронной почты или набор инструкций.
|TableDataProfile|||
||numberOfRows|int|Количество строк в наборе данных
||size|длинное целое число|Размер набора данных в байтах.
||schemaModifiedTime|строка|Время последнего изменения схемы.
||dataModifiedTime|строка|Время последнего изменения набора данных (добавление, изменение или удаление данных)
|ColumnsDataProfile|||
||columns|ColumnDataProfile|Количество строк в наборе данных
|Документация|||Данный ресурс может иметь только одну связанную с ним документацию.
||mimeType|string|Тип mime содержимого.
||Содержимое|строка|Содержимое документации


### Общие типы

Общие типы можно использовать в качестве типов свойств, но не элементов.

|**Общий тип**|**Свойства**|**Тип данных**|**Комментарии**
|---|---|---|---
|DataSourceInfo||||
||sourceType|string|Описывает тип источника данных (SQL Server, база данных Oracle и т. д.).
||objectType|string|Описывает тип объекта в источнике данных, т. е. "таблица", "представление для SQL Server".
||formatType|string|Описывает структуру данных. Текущие значения структурированы или не структурированы.
|SecurityPrincipal||||
||upn|string|Уникальный адрес электронной почты пользователя.
||firstName|string|Имя пользователя (для отображения).
||lastName|string|Фамилия пользователя (для отображения).
|столбец||||
||name|string|Имя столбца или атрибута.
||type|string|тип данных столбца или атрибута. Допустимые для использования типы зависят от типа источника данных ресурса. Поддерживается только подмножество типов.
||maxLength|int|Максимальная длина столбца или атрибута. Определяется по информации из источника данных. Применимо только к некоторым типам источников данных.
||Precision|byte|Точность для столбца или атрибута. Определяется по информации из источника данных. Применимо только к некоторым типам источников данных.
||isNullable|Логический|Указывает, разрешены ли значения null для этого столбца. Определяется по информации из источника данных. Применимо только к некоторым типам источников данных.
||expression|string|Если значение представляет собой вычисляемый столбец, то это поле содержит выражение для этого значения. Определяется по информации из источника данных. Применимо только к некоторым типам источников данных.
||defaultValue|object|Значение по умолчанию, которое подставляется, если значение не указано в инструкции insert для объекта. Определяется по информации из источника данных. Применимо только к некоторым типам источников данных.
|ColumnDescription||||
||tags|string|Массив тегов, описывающих столбец.
||description|string|Описание столбца.
||columnName|string|Имя столбца, на который ссылается эта информация.
|ColumnDataProfile||||
||columnName|строка|Имя столбца
||type|строка|Тип столбца
||min|строка|Минимальное значение в наборе данных
||max|строка|Максимальное значение в наборе данных
||avg|double|Среднее значение в наборе данных
||stdev|double|Стандартное отклонение для набора данных
||nullCount|int|Число значений null в наборе данных
||distinctCount|int|Число различающихся значений в наборе данных

## Роли и авторизация

Каталог данных Azure поддерживает авторизацию для выполнения операций над ресурсами и аннотациями.

## Основные понятия

Каталог данных Azure использует два механизма авторизации:

- Авторизация на основе ролей
- Авторизация на основе разрешений

### Роли

Существует три роли: **администратор**, **владелец** и **участник**. Каждая роль имеет собственную область действия и права, которые приведены в следующей таблице.

|**Роль**|**Область**|**Права**
|---|---|---
|Администратор|Каталог (т. е. все ресурсы и аннотации в составе каталога)|Read Delete ViewRoles ChangeOwnership ChangeVisibility ViewPermissions
|Владелец|Каждый ресурс (т. е. каждый корневой элемент)|Read Delete ViewRoles ChangeOwnership ChangeVisibility ViewPermissions
|Участник|Каждый отдельный ресурс и аннотация|Read Update Delete ViewRoles Примечание: при лишении участника права Read (Чтение) он также лишается всех остальных прав

> [AZURE.NOTE] Права **Read**, **Update**, **Delete** и **ViewRoles** применяются ко всем элементам (ресурсам и заметкам), а права **TakeOwnership**, **ChangeOwnership**, **ChangeVisibility**, **ViewPermissions** — только к корневому ресурсу.
>
>Право **Delete** применяется к самому элементу, а также ко всем вложенным элементам и элементам, расположенным ниже по иерархии. Например, при удалении ресурса также удаляются все аннотации для этого ресурса.

### Разрешения

Разрешение представляет собой список записей управления доступом. Каждая запись управления доступом назначает субъекту безопасности набор прав. Разрешения могут задаваться только для ресурсов (корневых элементов) и применяются к ресурсам и всем вложенным элементам.

В предварительной версии **каталога данных Azure** из всего списка разрешений поддерживается только право **Read**. Оно может использоваться для ограничения видимости ресурса.

По умолчанию любой пользователь, прошедший проверку подлинности, получает право доступа **Read**, распространяющееся на все элементы каталога. Это актуально за исключением случаев, когда видимость элементов каталога ограничена набором субъектов, заданным в разрешениях.

## Интерфейс REST API

Для управления ролями и разрешениями можно использовать запросы на просмотр элементов **PUT** и **POST**. В дополнение к полезным данным элемента можно указать еще два системных свойства: **\_\_roles** и **\_\_permissions**.

> [AZURE.NOTE]
>
> **\_\_permissions** применимо только к корневому элементу.
>
> Роль **владельца** применима только к корневому элементу.
>
> Когда в каталоге создается элемент, связанная с таким элементом роль **участника** по умолчанию назначается текущему пользователю, прошедшему проверку подлинности. Обновлять элемент могут все пользователи. Для этого первой его публикации роли **участника** в свойстве **\_\_ roles** должен быть назначен специальный субъект безопасности <Everyone> (см. пример ниже). Роль **участника** изменить нельзя. Она назначается на все время существования элемента (т. е. даже **администратор** и **владелец** не имеют право изменять роль **участника**). Единственное значение, которое можно явно присвоить роли **участника** — это <Everyone>. Это значит, что **участником** может быть только пользователь, создавший элемент, или <Everyone>.

### Примеры
**Назначение роли участника <Everyone> при публикации элемента.**

Специальный субъект безопасности <Everyone> имеет следующий код объекта: 00000000-0000-0000-0000-000000000201.

**POST** https://api.azuredatacatalog.com/catalogs/default/views/tables/?api-version=2015-07.1.0-Preview

Запросы к **каталогу данных Azure** могут возвращать HTTP-ответ 302, чтобы указать перенаправление на другую конечную точку. В ответ на ответ 302 вызывающая сторона должна повторно отправить запрос на URL-адрес, указанный в заголовке ответа о расположении.


> [AZURE.NOTE] Некоторые реализации клиентов HTTP могут автоматически повторно отправлять запросы в ответ на ответ 302 с сервера, но обычно извлекают **заголовки авторизации** из запроса. Так как заголовок авторизации является обязательным для выполнения запросов к каталогу данных Azure, необходимо убедиться, что он указывается и при повторной отправке запроса к расположению для перенаправления, указанному каталогом данных Azure. Ниже приведен пример кода, демонстрирующий это с помощью объекта .NET HttpWebRequest.


**Текст**

	{
	    "__roles": [
	        {
	            "role": "Contributor",
	            "members": [
	                {
	                    "objectId": "00000000-0000-0000-0000-000000000201"
	                }
	            ]
	        }
	    ],
	    … other table properties
	}

**Назначение владельцев и ограничение видимости для существующего корневого элемента**

**PUT** https://api.azuredatacatalog.com/catalogs/default/views/tables/042297b0...1be45ecd462a?api-version=2015-07.1.0-Preview

	{
	    "__roles": [
	        {
	            "role": "Owner",
	            "members": [
	                {
	                    "objectId": "c4159539-846a-45af-bdfb-58efd3772b43",
	                    "upn": "user1@contoso.com"
	                },
	                {
	                    "objectId": "fdabd95b-7c56-47d6-a6ba-a7c5f264533f",
	                    "upn": "user2@contoso.com"
	                }
	            ]
	        }
	    ],
	    "__permissions": [
	        {
	            "principal": {
	                "objectId": "27b9a0eb-bb71-4297-9f1f-c462dab7192a",
	                "upn": "user3@contoso.com"
	            },
	            "rights": [
	                {
	                    "right": "Read"
	                }
	            ]
	        },
	        {
	            "principal": {
	                "objectId": "4c8bc8ce-225c-4fcf-b09a-047030baab31",
	                "upn": "user4@contoso.com"
	            },
	            "rights": [
	                {
	                    "right": "Read"
	                }
	            ]
	        }
	    ]
	}

> [AZURE.NOTE] В теле запроса PUT не обязательно указывать полезные данные: запрос PUT можно использовать только для обновления ролей и/или разрешений.

<!--Image references-->
[1]: ./media/data-catalog-developer-concepts/concept2.png

<!---HONumber=AcomDC_0316_2016-->

