---
title: Устранение неполадок RBAC для ресурсов Azure | Документация Майкрософт
description: Устранение неполадок с управлением доступом на основе ролей (RBAC) для ресурсов Azure.
services: azure-portal
documentationcenter: na
author: rolyon
manager: mtillman
ms.assetid: df42cca2-02d6-4f3c-9d56-260e1eb7dc44
ms.service: role-based-access-control
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 01/18/2019
ms.author: rolyon
ms.reviewer: bagovind
ms.custom: seohack1
ms.openlocfilehash: 7b27c811214def7f5646f886b955d035a50c0725
ms.sourcegitcommit: fcb674cc4e43ac5e4583e0098d06af7b398bd9a9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2019
ms.locfileid: "56342479"
---
# <a name="troubleshoot-rbac-for-azure-resources"></a>Устранение неполадок RBAC в Azure

В этой статье содержатся ответы на часто задаваемые вопросы об управлении доступом на основе ролей (RBAC) для ресурсов Azure. Вы узнаете, какие ситуации возможны при использовании ролей на портале Azure, а также сможете устранить неполадки, связанные с доступом.

## <a name="problems-with-rbac-role-assignments"></a>Проблемы с назначениями ролей в RBAC

- Если вы не можете добавить назначение роли, потому что параметр **Добавить назначение ролей** отключен или произошла ошибка разрешений, убедитесь, что вы используете роль с разрешением `Microsoft.Authorization/roleAssignments/*` для области, в которой вы пытаетесь назначить роль. Если у вас нет этого разрешения, обратитесь к администратору подписки.
- Если ошибка разрешений возникнет при попытке создать ресурс, убедитесь, что вы используете роль с разрешением на создание ресурсов в выбранной области. Например, вам может потребоваться стать участником. Если у вас нет разрешения, обратитесь к администратору подписки.
- Если ошибка разрешений возникнет при попытке создать или обновить запрос в службу поддержки, убедитесь, что вы используете роль с разрешением `Microsoft.Support/*`, например роль [Участник запроса в службу поддержки](built-in-roles.md#support-request-contributor).
- Если при попытке назначить роль отобразится сообщение о том, что допустимое количество назначений ролей превышено, попробуйте уменьшить число назначений ролей, назначив роли группам. Azure поддерживает до **2000** назначений ролей на подписку.

## <a name="problems-with-custom-roles"></a>Проблемы с пользовательскими ролями

- Если вам не удается обновить существующую пользовательскую роль, проверьте, есть ли у вас разрешение `Microsoft.Authorization/roleDefinition/write`.
- Если вам не удается обновить существующую пользовательскую роль, проверьте, не были ли удалены назначенные области в клиенте. Свойство `AssignableScopes` пользовательской роли определяет, [кто может создавать, удалять, изменять или просматривать пользовательскую роль](custom-roles.md#who-can-create-delete-update-or-view-a-custom-role).
- Если при попытке создания новой роли отобразится сообщение о том, что превышено ограничение на определения ролей, удалите все пользовательские роли, которые не используются. Вы можете также попытаться объединить или повторно использовать все существующие пользовательские роли. Azure поддерживает до **2000** пользовательских ролей в клиенте.
- Если вам не удается удалить пользовательскую роль, проверьте, нет ли одного или нескольких назначений ролей, которые до сих пор используют эту роль.

## <a name="recover-rbac-when-subscriptions-are-moved-across-tenants"></a>Восстановление RBAC при перемещении подписок между клиентами

- Инструкции по передаче подписки другому арендатору см. в статье [Передача прав владения подпиской Azure другой учетной записи](../billing/billing-subscription-transfer.md).
- Когда вы переносите подписку в другой клиент, все назначения ролей удаляются из исходного клиента без возможности восстановления и не переносятся в целевой клиент. Необходимо повторно создать назначения ролей в целевом клиенте.
- Если вы являетесь глобальным администратором и вы потеряли доступ к подписке, используйте переключатель **Управление доступом для ресурсов Azure**, чтобы временно [повысить права](elevate-access-global-admin.md) для получения доступа к подписке.

## <a name="rbac-changes-are-not-being-detected"></a>Не удается обнаружить изменения RBAC

Azure Resource Manager иногда кэширует конфигурации и данные для повышения производительности. При создании или удалении назначения ролей вступление изменений в силу может занять до 30 минут. Если вы используете портал Azure, Azure PowerShell или Azure CLI, можно принудительно обновить изменения назначения ролей, выйдя из учетной записи и повторно войдя в нее. Если вы вносите изменения в назначения ролей с помощью вызовов REST API, можно принудительно обновить изменения, обновив маркер доступа.

## <a name="web-app-features-that-require-write-access"></a>Компоненты веб-приложений, требующие доступа для записи

Если предоставить пользователю доступ только для чтения к одному веб-приложению, некоторые компоненты могут неожиданно отключиться. Перечисленные ниже возможности управления требуют доступа к веб-приложению с правом **записи** (роль участника или владельца), поэтому они недоступны при наличии прав только на чтение.

* Команды (такие как запуск, остановка и т. д.).
* Изменение параметров, таких как общие параметры конфигурации, параметры масштабирования, резервного копирования и мониторинга.
* Доступ к учетным данным для публикации и другим секретным сведениям, например к параметрам приложений и строкам подключения.
* Журналы потоковой передачи.
* Конфигурация журналов диагностики.
* Консоль (командная строка).
* Активные и недавние развертывания (для локального непрерывного развертывания Git).
* Приблизительные затраты.
* Веб-тесты
* Виртуальная сеть (видна читателю только в том случае, если ранее была настроена пользователем с доступом на запись).

Если у вас нет доступа ни к одной из этих плиток, попросите администратора предоставить вам доступ к веб-приложению с правами участника.

## <a name="web-app-resources-that-require-write-access"></a>Ресурсы веб-приложений, требующие доступа для записи

Работа с веб-приложениями осложняется наличием нескольких взаимосвязанных ресурсов. Вот типичная группа ресурсов, связанная с несколькими веб-сайтами:

![Группа ресурсов веб-приложений](./media/troubleshooting/website-resource-model.png)

В результате, если вы предоставите кому-либо доступ только к веб-приложению, многие функции в колонке веб-сайта на портале Azure будут отключены.

Для этих элементов требуется доступ на **запись** к **плану службы приложений**, который соответствует вашему веб-сайту:  

* просмотр ценовой категории веб-приложения (например, "Бесплатный" или "Стандартный");  
* параметры масштабирования (число экземпляров, размер виртуальной машины, настройки автоматического масштабирования);  
* квоты (квоты хранилища, пропускной способности, ресурсов ЦП).  

Элементы, требующие доступа на **запись** ко всей **группе ресурсов**, которая содержит веб-сайт:  

* SSL-сертификаты и привязки (SSL-сертификаты могут совместно использоваться сайтами, относящимися к одной группе ресурсов и находящимися в одном географическом расположении);  
* правила оповещений.  
* параметры автоматического масштабирования;  
* компоненты Application Insights;  
* Веб-тесты  

## <a name="virtual-machine-features-that-require-write-access"></a>Компоненты виртуальных машин, требующие доступа для записи

Как и в случае с веб-приложениями, для некоторых функций в колонке виртуальной машины нужен доступ к виртуальной машине или другим ресурсам в группе ресурсов с правами на запись.

Виртуальные машины связаны с доменными именами, виртуальными сетями, учетными записями хранения и правилами оповещений.

Элементы, требующие доступа к **виртуальной** машине с правом **записи**:

* Конечные точки  
* IP-адреса;  
* диски;  
* расширения.  

Элементы, требующие доступа на **запись** как к **виртуальной машине**, так и к **группе ресурсов**, в которой она находится (а также к доменному имени):  

* Группа доступности  
* набор балансировки нагрузки;  
* правила оповещений.  

Если у вас нет доступа ни к одному из этих элементов, попросите администратора предоставить вам права участника для группы ресурсов.

## <a name="azure-functions-and-write-access"></a>Функции Azure и доступ для записи

Для некоторых компонентов решения [Функции Azure](../azure-functions/functions-overview.md) требуется доступ на запись. Например, если пользователю назначена роль читателя, он не сможет просматривать функции в пределах приложения-функции. На портале отобразится текст **(Нет доступа)**.

![Сообщение об отсутствии доступа в приложении-функции](./media/troubleshooting/functionapps-noaccess.png)

Пользователь с ролью читателя может щелкнуть вкладку **Функции платформы** и выбрать **Все параметры**, чтобы просмотреть некоторые параметры, связанные с приложением-функцией (так же, как для веб-приложения), но не может изменить эти параметры.

## <a name="next-steps"></a>Дополнительная информация
* [Управление доступом к ресурсам Azure с помощью RBAC и портала Azure](role-assignments-portal.md)
* [Просмотр журналов действий для изменений RBAC в ресурсах Azure](change-history-report.md)

