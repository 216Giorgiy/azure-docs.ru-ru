<properties 
	pageTitle="Хранение кода проекта в системе управления версиями: мобильные службы Azure" 
	description="Узнайте, как сохранить файлы серверных сценариев и модулей в локальном репозитории Git на компьютере." 
	services="mobile-services" 
	documentationCenter="" 
	authors="ggailey777" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="mobile-services" 
	ms.workload="mobile" 
	ms.tgt_pltfrm="mobile-multiple" 
	ms.devlang="multiple" 
	ms.topic="article" 
	ms.date="11/21/2014" 
	ms.author="glenga"/>

<div class="dev-center-tutorial-subselector">
	<a href="/ru-ru/documentation/articles/mobile-services-dotnet-backend-store-code-source-control/" title=".NET backend">Серверная часть .NET</a> | <a href="/ru-ru/documentation/articles/mobile-services-store-scripts-source-control/"  title="JavaScript backend" class="current">Серверная часть JavaScript</a>
</div>

# Хранение кода проекта в системе управления версиями

В этом разделе показано, как использовать систему управления версиями, предоставляемую мобильными службами Azure, для хранения серверных сценариев. Сценарии и другие фоновые файлы кода JavaScript могут назначаться из локального репозитория вашей рабочей мобильной службе. В нем также показано, как определить общий код, который может потребоваться нескольким сценариям, и как использовать файл package.json для добавления модулей Node.js в мобильную службу. 

В этом учебнике рассмотрено выполнение следующих действий:

1. [Включение системы управления версиями в мобильной службе].
2. [Установка Git и создание локального репозитория].
3. [Развертывание обновленных файлов скриптов в вашей мобильной службе].
4. [Использование общего кода и модулей Node.js в серверных скриптах].

Для работы с этим учебником вам понадобится мобильная служба, созданная во время изучения учебника [Приступая к работе с мобильными службами] или [Добавление мобильных служб к существующему приложению].

##<a name="enable-source-control"></a>Включение системы управления версиями в мобильной службе

[AZURE.INCLUDE [mobile-services-enable-source-control](../includes/mobile-services-enable-source-control.md)]

##<a name="clone-repo"></a>Установка Git и создание локального репозитория

1. Установите Git на локальном компьютере. 

	Действия, необходимые для установки Git, отличаются в разных операционных системах. Сведения о дистрибутивах для разных операционных систем и руководство по установке см. в разделе [Установка Git].

	> [AZURE.NOTE]
	> В некоторых операционных системах доступны обе версии Git - для командной строки и с графическим интерфейсом. В инструкциях, приведенных в данной статье, используется версия для командной строки.

2. Откройте окно командной строки, например **GitBash** (Windows) или **Bash** (оболочка Unix). На компьютерах с OS X доступ к командной строке можно получить через приложение **Terminal**.

3. В командной строке перейдите в каталог, где будут храниться сценарии. Например, `cd SourceControl`.

4. Используйте следующую команду для создания локальной копии нового репозитория Git, заменив <your_git_URL> на URL-адрес репозитория Git для своей мобильной службы:

		git clone <your_git_URL>

5. При отображении запроса введите имя пользователя и пароль, заданные при включении системы управления версиями в вашей мобильной службе. После успешной проверки подлинности должна отобразиться последовательность ответов:

		remote: Counting objects: 8, done.
		remote: Compressing objects: 100% (4/4), done.
		remote: Total 8 (delta 1), reused 0 (delta 0)
		Unpacking objects: 100% (8/8), done.

6. Перейдите в каталог, из которого была выполнена команда `git clone`, и обратите внимание на следующую структуру каталогов:

	![4][4]

	В этом случае новый каталог создается с именем мобильной службы, которая является локальным репозиторием для службы данных. 

7. Откройте вложенную папку .\service\table и обратите внимание на то, что она содержит файл TodoItem.json, который является представлением JSON разрешений операции в таблице TodoItem. 

	Если в этой таблице были определены серверные скрипты, будет присутствовать один или несколько файлов с именем <code>TodoItem._&lt;операция&gt;_.js</code>, содержащих скрипты для данной операции таблицы. Планировщик и скрипты настраиваемого интерфейса API сохраняются в отдельных папках с соответствующими именами. Дополнительные сведения см. в разделе [Управление версиями].

После создания локального репозитория можно внести изменения в серверные скрипты и доставлять изменения обратно в мобильную службу.

##<a name="deploy-scripts"></a>Развертывание обновленных файлов скриптов в вашей мобильной службе

1. Перейдите во вложенную папку .\service\table и, если файл todoitem.insert.js не существует, создайте его.

2. Откройте в текстовом редакторе новый файл todoitem.insert.js, вставьте следующий код и сохраните изменения:

		function insert(item, user, request) {
		    request.execute();
		    console.log(JSON.stringify(item, null, 4));
		}
	
	Этот код просто записывает вставленный элемент в журнал. Если этот файл уже содержит код, просто добавьте в файл допустимый код JavaScript, например вызов `console.log()`, и сохраните изменения. 

3. В командной строке Git введите следующую команду, чтобы запустить отслеживание нового файла сценария:

		$ git add .
	

4. Введите следующую команду, чтобы сохранить изменения:

		$ git commit -m "updated the insert script"

5. Введите следующую команду, чтобы передать изменения в удаленный репозиторий:

		$ git push origin master
	
	Вы увидите ряд команд, который указывает, что фиксация развертывается в мобильной службе.

6. На портале управления откройте вкладку **Данные**, затем щелкните таблицу **TodoItem**.

	![][5]

3. Выберите элемент **Скрипт**, а затем - операцию **Вставить**.

	![][6]

	Обратите внимание на то, что отображаемый скрипт операции вставки совпадает с кодом JavaScript, отправленным в репозиторий.

##<a name="use-npm"></a>Использование общего кода и модулей Node.js в серверных скриптах

Мобильные службы предоставляют доступ к полному набору основных модулей Node.js, которые можно использовать в коде с помощью функции **require**. Мобильная служба может также использовать модули Node.js, которые не являются частью основного пакета Node.js, кроме того, вы даже можете определить свой общий код как модули Node.js. Дополнительные сведения о создании модулей см. раздел [Модули][Документация по Node.js API: модули] в справочной документации по Node.js API.

Советуем добавлять модули Node.js в мобильную службу, добавляя ссылки в ее файл package.json. После этого нужно будет добавить модуль Node.js [node-uuid] в свою мобильную службу, обновив файл package.json. Когда в Azure будет передано push-уведомление об обновлении, мобильная служба будет перезапущена, после чего будет установлен модуль. Этот модуль используется для создания нового значения GUID для свойства **uuid** вставленных элементов. 

2. Перейдите к папке `.\service` в локальном репозитории Git и откройте файл package.json в текстовом редакторе.

3. Найдите  

		npm install node-uuid

	Диспетчер пакетов NPM создает каталог `node_modules` в текущем расположении и устанавливает модуль [node-uuid] в подкаталоге `\node-uuid`. 

	> [AZURE.NOTE] Если `node_modules` уже существует в иерархии каталогов, диспетчер пакетов NPM создает там подкаталог `\node-uuid`, а не создает новый каталог `node_modules` в репозитории. В этом случае удалите существующий каталог `node_modules`.

4. Теперь перейдите к вложенной папке .\service\table, откройте файл todoitem.insert.js и внесите следующие изменения:

		function insert(item, user, request) {
		    var uuid = require('node-uuid');
		    item.uuid = uuid.v1();
		    request.execute();
		    console.log(JSON.stringify(item, null, 4));
		}

	Этот код добавляет в таблицу столбец uuid, заполняя его уникальными идентификаторами GUID.

5. Как и в предыдущем разделе, введите следующую команду в командной строке Git: 

		$ git add .
		$ git commit -m "added node-uuid module"
		$ git push origin master
		
	Это добавляет новый файл, фиксирует изменения, а также отправляет новый модуль node-uuid и изменения скрипта todoitem.insert.js в вашу мобильную службу.

## <a name="next-steps"> </a>Дальнейшие действия

Теперь, когда вы завершили этот учебник, вы знаете, как сохранять скрипты в системе управления версиями. Рекомендуем получить дополнительные сведения о работе с серверными скриптами и настраиваемыми интерфейсами API: 

+ [Работа с серверными скриптами в мобильных службах]
	<br/>Показывает, как работать с серверными скриптами, планировщиком заданий и настраиваемыми интерфейсами API.

+ [Вызов из клиента настраиваемого интерфейса API] 
	<br/> В этой статье показано, как создать настраиваемый интерфейс API, который можно вызывать из клиента.

<!-- Anchors. -->
[Включение системы управления версиями в мобильной службе]: #enable-source-control
[Установка Git и создание локального репозитория]: #clone-repo
[Развертывание обновленных файлов скриптов в вашей мобильной службе]: #deploy-scripts
[Использование общего кода и модулей Node.js в серверных скриптах]: #use-npm

<!-- Images. -->
[4]: ./media/mobile-services-store-scripts-source-control/mobile-source-local-repo.png
[5]: ./media/mobile-services-store-scripts-source-control/mobile-portal-data-tables.png
[6]: ./media/mobile-services-store-scripts-source-control/mobile-insert-script-source-control.png

<!-- URLs. -->
[Веб-сайт Git]: http://git-scm.com
[Система управления версиями]: http://msdn.microsoft.com/library/windowsazure/c25aaede-c1f0-4004-8b78-113708761643
[Установка Git]: http://git-scm.com/book/en/Getting-Started-Installing-Git
[Приступая к работе с мобильными службами]: /ru-ru/documentation/articles/mobile-services-ios-get-started/
[Добавление мобильных служб к существующему приложению]: /ru-ru/documentation/articles/mobile-services-ios-get-started-data/
[Работа с серверными скриптами в мобильных службах]: /ru-ru/documentation/articles/mobile-services-how-to-use-server-scripts/
[Портал управления Azure]: https://manage.windowsazure.com/
[Вызов из клиента настраиваемого интерфейса API]: /ru-ru/documentation/articles/mobile-services-ios-call-custom-api/
[Документация по Node.js API: модули]: http://nodejs.org/api/modules.html
[node-uuid]: https://npmjs.org/package/node-uuid


<!--HONumber=42-->
