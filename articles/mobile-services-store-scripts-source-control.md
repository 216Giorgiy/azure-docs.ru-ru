<properties linkid="develop-mobile-tutorials-store-scripts-in-source-control" urlDisplayName="Store server scripts in source control" pageTitle="Store server scripts in source control - Azure Mobile Services" metaKeywords="" description="Learn how to store your server script files and modules in a local Git repo on your computer." metaCanonical="" services="" documentationCenter="Mobile" title="Store server scripts in source control" authors="glenga" solutions="" manager="" editor="" />

<tags ms.service="mobile-services" ms.workload="mobile" ms.tgt_pltfrm="mobile-multiple" ms.devlang="multiple" ms.topic="article" ms.date="01/01/1900" ms.author="glenga"></tags>

# Хранение серверных скриптов системе управления версиями

В этом разделе показано, как выполнить первую настройку системы управления версиями в мобильных службах Azure для хранения серверных скриптов в репозитории Git. Скрипты и другие файлы кода JavaScript могут назначаться из локального репозитория вашей рабочей мобильной службе. В нем также показано, как определить общий код, который может требоваться нескольким скриптам, и как загрузить модули Node.js.

В этом учебнике рассмотрено выполнение следующих действий:

1.  [Включение системы управления версиями в вашей мобильной службе][Включение системы управления версиями в вашей мобильной службе].
2.  [Установка Git и создание локального репозитория][Установка Git и создание локального репозитория].
3.  [Развертывание обновленных файлов скриптов в вашей мобильной службе][Развертывание обновленных файлов скриптов в вашей мобильной службе].
4.  [Использование общего кода и модулей Node.js в серверных скриптах][Использование общего кода и модулей Node.js в серверных скриптах].

Для прохождения данного учебника вы должны были уже создать мобильную службу в учебнике [Приступая к работе с мобильными службами][Приступая к работе с мобильными службами] или [Приступая к работе с данными][Приступая к работе с данными].

## <a name="enable-source-control"></a><span class="short-header">Включение системы управления версиями</span>Включение системы управления версиями в мобильной службе

1.  Выполните вход на [портал управления Azure][портал управления Azure], щелкните **Мобильные службы**, а затем щелкните свою мобильную службу.

    ![][]

2.  Откройте вкладку **Панель мониторинга**, а затем в области **Сводка** щелкните пункт **Настроить систему управления версиями** и нажмите кнопку **Да** для подтверждения.

    ![][1]

    > [WACOM.NOTE]
    > Система управления версиями является компонентом предварительной версии. Рекомендуется регулярно создавать резервную копию файлов скриптов, даже если они хранятся в мобильных службах.

3.  Укажите **Имя пользователя**, **Новый пароль**, подтвердите пароль, а затем нажмите кнопку «Проверить».

    ![][2]

    В вашей мобильной службе создается репозиторий Git. Запишите указанные учетные данные; они понадобятся для доступа к этому репозиторию.

4.  Откройте вкладку «Настройка» и обратите внимание на новые поля в разделе **Система управления версиями**.

    ![][3]

    Отображается URL-адрес репозитория Git. Этот URL-адрес понадобится для клонирования репозитория на локальный компьютер.

После включения управления версиями в вашей мобильной службе пора воспользоваться Git для клонирования репозитория на локальный компьютер.

## <a name="clone-repo"></a><span class="short-header">Клонирование репозитория</span>Установка Git и создание локального репозитория

1.  Установите Git на локальном компьютере.

    Действия, необходимые для установки Git, отличаются в разных операционных системах. Сведения о дистрибутивах для разных операционных систем и руководство по установке см. в разделе [Установка Git][Установка Git].

    > [WACOM.NOTE]
    > В некоторых операционных системах доступны обе версии Git — для командной строки и с графическим пользовательским интерфейсом. В инструкциях, приведенных в данной статье, используется версия для командной строки.

2.  Откройте окно командной строки, например **GitBash** (Windows) или **Bash** (оболочка Unix). На компьютерах с OS X доступ к командной строке можно получить через приложение **Terminal**.

3.  В командной строке перейдите в каталог, где будут храниться сценарии. Например, `cd SourceControl`.

4.  Используйте следующую команду для создания локальной копии нового репозитория Git, заменив `<your_git_URL>` на URL-адрес репозитория Git для своей мобильной службы:

        git clone <your_git_URL>

5.  При отображении запроса введите имя пользователя и пароль, заданные при включении системы управления версиями в вашей мобильной службе. После успешной проверки подлинности должна отобразиться последовательность ответов:

        remote: Counting objects: 8, done.
        remote: Compressing objects: 100% (4/4), done.
        remote: Total 8 (delta 1), reused 0 (delta 0)
        Unpacking objects: 100% (8/8), done.

6.  Перейдите в каталог, из которого была выполнена команда `git clone`, и обратите внимание на следующую структуру каталогов:

    ![4][4]

    В этом случае новый каталог создается с именем мобильной службы, которая является локальным репозиторием для службы данных.

7.  Откройте вложенную папку .\\service\\table и обратите внимание на то, что она содержит файл TodoItem.json, который является представлением JSON разрешений операции в таблице TodoItem.

    Если для этой таблицы указаны серверные сценарии, также будет отображаться один или несколько файлов с именем `TodoItem.<operation>.js` и сценариями для заданной операции с таблицей. Планировщик и скрипты настраиваемого интерфейса API сохраняются в отдельных папках с соответствующими именами. Дополнительные сведения см. в разделе [Управление версиями][Управление версиями].

После создания локального репозитория можно внести изменения в серверные скрипты и доставлять изменения обратно в мобильную службу.

## <a name="deploy-scripts"></a><span class="short-header">Развертывание сценариев</span>Развертывание обновленных файлов сценариев в вашей мобильной службе

1.  Перейдите во вложенную папку .\\service\\table и, если файл todoitem.insert.js не существует, создайте его.

2.  Откройте в текстовом редакторе новый файл todoitem.insert.js, вставьте следующий код и сохраните изменения:

        function insert(item, user, request) {
            request.execute();
            console.log(JSON.stringify(item, null, 4));
        }

    Этот код просто записывает вставленный элемент в журнал. Если этот файл уже содержит код, просто добавьте в файл допустимый код JavaScript, например `console.log()`, и сохраните изменения.

3.  В командной строке Git введите следующую команду, чтобы запустить отслеживание нового файла сценария:

        $ git add .

4.  Введите следующую команду, чтобы сохранить изменения:

        $ git commit -m "updated the insert script"

5.  Введите следующую команду, чтобы передать изменения в удаленный репозиторий:

        $ git push origin master

    Вы увидите ряд команд, который указывает, что фиксация развертывается в мобильной службе.

6.  На портале управления откройте вкладку **Данные**, затем щелкните таблицу **TodoItem**.

    ![][5]

7.  Щелкните **Сценарий** и выберите операцию **Вставить**.

    ![][6]

    Обратите внимание на то, что отображаемый скрипт операции вставки совпадает с кодом JavaScript, отправленным в репозиторий.

## <a name="use-npm"></a><span class="short-header">Общий код и модули</span>Использование общего кода и модулей Node.js в серверных сценариях

Мобильные службы предоставляют доступ к полному набору основных модулей Node.js, которые можно использовать в коде с помощью функции **require**. Мобильная служба может также использовать модули Node.js, которые не являются частью основного пакета Node.js, кроме того, вы даже можете определить свой общий код как модули Node.js. Дополнительные сведения о создании модулей см. в разделе [Модули][Модули] в справочной документации по Node.js API.

Далее необходимо добавить модуль Node.js [node-uuid][node-uuid] в мобильную службу с помощью диспетчера пакетов Node.js (NPM) и системы управления версиями. Этот модуль используется для создания нового значения GUID для свойства **uuid** вставленных элементов.

1.  Если это еще не сделано, установите модуль Node.js на локальном компьютере с помощью процедуры, описанной на [веб-сайте Node.js][веб-сайте Node.js].

2.  Перейдите к папке `.\service` локального репозитория Git, а затем в командной строке введите следующую команду:

        npm install node-uuid

    Диспетчер пакетов NPM создает каталог `node_modules` в текущем расположении и устанавливает модуль [node-uuid][node-uuid] в подкаталоге `\node-uuid`.

    <div class="dev-callout">
<strong>Примечание.</strong>
<p>Если <code data-inline="1">node_modules</code> уже существует в иерархии каталогов, диспетчер пакетов NPM создает там подкаталог <code data-inline="1">\node-uuid</code>, а не создает новый каталог <code data-inline="1">node_modules</code> в репозитории. В этом случае удалите существующий каталог <code data-inline="1">node_modules</code>.</p>
</div>

3.  Теперь перейдите к вложенной папке .\\service\\table, откройте файл todoitem.insert.js и внесите следующие изменения:

        function insert(item, user, request) {
            var uuid = require('node-uuid');
            item.uuid = uuid.v1();
            request.execute();
            console.log(JSON.stringify(item, null, 4));
        }

    Этот код добавляет в таблицу столбец uuid, заполняя его уникальными идентификаторами GUID.

4.  Как и в предыдущем разделе, введите следующую команду в командной строке Git:

        $ git add .
        $ git commit -m "added node-uuid module"
        $ git push origin master

    Это добавляет новый файл, фиксирует изменения, а также отправляет новый модуль node-uuid и изменения скрипта todoitem.insert.js в вашу мобильную службу.

## <a name="next-steps"> </a>Дальнейшие действия

Теперь, когда вы завершили этот учебник, вы знаете, как сохранять скрипты в системе управления версиями. Рекомендуем получить дополнительные сведения о работе с серверными скриптами и настраиваемыми интерфейсами API:

-   [Работа с серверными сценариями в мобильных службах][Работа с серверными сценариями в мобильных службах]
    <br/>Показывает, как работать с серверными сценариями, планировщиком заданий и настраиваемыми API.

-   [Определение настраиваемого интерфейса API с поддержкой pull-уведомлений][Определение настраиваемого интерфейса API с поддержкой pull-уведомлений]
     <br/>Показывает, как использовать настраиваемые API для поддержки периодических уведомлений, обновляющих живые плитки в приложении Магазина Windows.

<!-- Anchors.  Images.  URLs. -->

  [Включение системы управления версиями в вашей мобильной службе]: #enable-source-control
  [Установка Git и создание локального репозитория]: #clone-repo
  [Развертывание обновленных файлов скриптов в вашей мобильной службе]: #deploy-scripts
  [Использование общего кода и модулей Node.js в серверных скриптах]: #use-npm
  [Приступая к работе с мобильными службами]: /ru-ru/develop/mobile/tutorials/get-started
  [Приступая к работе с данными]: /ru-ru/develop/mobile/tutorials/get-started-with-data-dotnet
  [портал управления Azure]: https://manage.windowsazure.com/
  []: ./media/mobile-services-store-scripts-source-control/mobile-services-selection.png
  [1]: ./media/mobile-services-store-scripts-source-control/mobile-setup-source-control.png
  [2]: ./media/mobile-services-store-scripts-source-control/mobile-source-control-credentials.png
  [3]: ./media/mobile-services-store-scripts-source-control/mobile-source-control-configure.png
  [Установка Git]: http://git-scm.com/book/en/Getting-Started-Installing-Git
  [4]: ./media/mobile-services-store-scripts-source-control/mobile-source-local-repo.png
  [Управление версиями]: http://msdn.microsoft.com/ru-ru/library/windowsazure/c25aaede-c1f0-4004-8b78-113708761643
  [5]: ./media/mobile-services-store-scripts-source-control/mobile-portal-data-tables.png
  [6]: ./media/mobile-services-store-scripts-source-control/mobile-insert-script-source-control.png
  [Модули]: http://nodejs.org/api/modules.html
  [node-uuid]: https://npmjs.org/package/node-uuid
  [веб-сайте Node.js]: http://nodejs.org/
  [Работа с серверными сценариями в мобильных службах]: /ru-ru/develop/mobile/how-to-guides/work-with-server-scripts
  [Определение настраиваемого интерфейса API с поддержкой pull-уведомлений]: /ru-ru/develop/mobile/tutorials/create-pull-notifications-dotnet
