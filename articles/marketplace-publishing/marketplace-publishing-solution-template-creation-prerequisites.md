<properties
   pageTitle="Технические компоненты, необходимые для создания шаблона решения для Marketplace | Microsoft Azure"
   description="Общие сведения о требованиях к созданию шаблона решения для развертывания и продажи в Azure Marketplace"
   services="marketplace-publishing"
   documentationCenter=""
   authors="HannibalSII"
   manager=""
   editor=""/>

<tags
   ms.service="marketplace-publishing"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="10/09/2015"
   ms.author="hascipio; v-divte" />

# Технические компоненты, необходимые для создания шаблона решения для Azure Marketplace
Прежде чем начать работу, внимательно прочтите описание и разберитесь, где и зачем выполняется каждый шаг. Постарайтесь подготовить максимально подробные сведения о своей компании и другие данные, загрузить необходимые средства и/или создать технические компоненты до того, как начнете создавать предложение. Все эти компоненты описаны в данной статье.

## Определение топологии и оценка платформы
На данном этапе вы, возможно, уже знакомы с артефактом вычислений Azure и думаете о том, что именно нужно создать: образы виртуальных машин, расширения, шаблоны ARM?

Прежде чем пытаться сопоставлять приложение с артефактами Azure, полезно разобраться в различных топологиях, применимых к вашему решению. Эти топологии вы, вероятно, также порекомендуете клиенту, который планирует локальное развертывание вашего приложения. Большинство предприятий обычно проходят следующие четыре этапа с некоторыми вариациями: оценка, подтверждение концепции, подготовка к производству и производство. Обычно вы сотрудничаете с предприятием на протяжении всех этих этапов, оценивая требования и рекомендуя соответствующую структуру и масштаб для его сценариев. Хотя все клиенты разные, предполагается, что существуют общие топологии и размеры, которые можно рекомендовать с учетом размера развертывания клиента. Поэтому еще перед началом разработки любого решения следует продумать различные структуры, которые будут уместны для вашего приложения и будут соответствовать большинству требований вашего клиента без выполнения масштабной настройки. Мы понимаем, что всегда есть клиенты, которым необходимо конкретное решение, однако сейчас мы рассматриваем общий случай.

Для каждого типа развертывания (оценка, подтверждение концепции, подготовка к производству и производство) продумайте точную структуру и топологию, которые необходимы для вашего приложения. Какие уровни необходимы? Какие ресурсы требуются для каждого уровня и какого размера они должны быть? Какие структурные элементы необходимы для создания этих ресурсов? В зависимости от клиента и его потребностей рабочее развертывание или даже среда разработки и тестирования могут значительно отличаться. Определите, как будет выглядеть малая, средняя, большая и очень большая топология для рабочей нагрузки, и продумайте требования к доступности, масштабируемости и производительности, необходимые для успешной реализации топологии.

Изучив различные схемы топологии и соответствующие размеры (возможно, большинство этих действий уже выполнены в процессе локальных развертываний у клиентов), необходимо вспомнить о том, что может предложить Azure.

Оцените требования к топологии по отношению к возможностям, которые могут предложить диспетчер ресурсов Azure и вычисления диспетчера ресурсов Azure. Хотя большинство клиентов начинают с небольших развертываний, **мы настоятельно рекомендуем оценить требования большой топологии к производительности, масштабу и возможностям с помощью вычислений в диспетчере ресурсов Azure, даже если изначально вы не планируете внедрение большой топологии.** Главным образом это делается для того, чтобы по мере внедрения малого развертывания обеспечить клиентам достаточно пространства для успешного расширения до более масштабного развертывания. О любых ограничениях масштаба, производительности или возможностей сообщайте своим партнерам Майкрософт. Это обеспечит постоянное усовершенствование в областях, которые нужны вам, нашим партнерам Marketplace и, в итоге, вашим клиентам.

> [AZURE.TIP]**Рекомендация.** Оцените и создайте шаблон, соответствующий наибольшему размеру планируемого развертывания приложения, чтобы предусмотреть для конечных клиентов возможность роста.

## Структурные элементы вычислений Azure
Сначала выясним, какие вычислительные артефакты доступны вам и как можно рассматривать приложение с точки зрения этих артефактов.

### 1\. Использование существующих виртуальных машин
Структурными элементами всех виртуальных машин являются образы виртуальных машин. Образ виртуальной машины — это полный профиль хранилища виртуальной машины, содержащий один виртуальный жесткий диск с операционной системой и не содержащий совсем или содержащий несколько дисков данных. Можно создать образ виртуальной машины для упаковки приложения с операционной системой, а также с любыми необходимыми дополнительными данными. Например, сейчас в Azure Marketplace существует множество образов виртуальных машин для SQL Server, в которые упакована операционная система Windows с приложением SQL Server. Хотя в этом документе не рассматривается создание и внедрение образов виртуальных машин в Azure Marketplace, важно понимать, что такое образ виртуальной машины, поскольку он, скорее всего, будет структурным элементом вашего программного решения. Соответствующие инструкции см. в разделе [Создание образа виртуальной машины для Marketplace](marketplace-publishing-vm-image-creation.md).

### 2\. Расширение виртуальной машины
В некоторых случаях вам не нужен образ, поскольку вам как поставщику приложения не нужно владеть и управлять базовой операционной системой. В Azure Marketplace в настоящее время существует множество компаний, на регулярной основе публикующих операционные системы Windows, Linux и Unix. Можно найти образы для Windows Server, Ubuntu, CoreOS, Oracle Linux, образы на основе CentOS и т. д. Вместо публикации собственного образа виртуальной машины с упакованной операционной системой и приложением можно попробовать написать обработчик расширений виртуальной машины или использовать уже существующий. Расширение виртуальной машины — это программный механизм для упрощения настройки виртуальной машины и управления ею, использующий гостевой агент (защищенный простой процесс) на виртуальной машине Azure. Например, расширение пользовательского сценария, как и предполагает его название, внедряет пользовательский сценарий и выполняет его на виртуальной машине. Это позволяет выполнить любые конфигурации, которые позволил бы выполнить универсальный сценарий.

При использовании обычного образа все его компоненты устанавливаются в самом начале, а необходимые конфигурации выполняются до или, может быть, даже после запуска виртуальной машины (с помощью задачи запуска). Такой образ может иметь высокую степень персонализации, и его повторное использование — не всегда простая задача. В некоторых случаях это имеет смысл. В других случаях может помочь модель расширения, особенно, если речь идет о простых приложениях или более сложных конфигурациях, которые необходимо реализовать после подготовки виртуальной машины. Иногда клиенты разворачивают комбинацию расширений и образов виртуальных машин, чтобы использовать оба предварительно установленных решения, а также иметь возможность выполнить сложную настройку после запуска.

Как известно, образы и расширения очень полезны для настройки одной виртуальной машины. Однако одной виртуальной машины недостаточно для обеспечения клиентам высокой доступности в облаке и масштабирования с учетом потребностей растущего трафика. Поэтому для любой рабочей нагрузки мы настоятельно рекомендуем планировать решение высокой доступности с несколькими виртуальными машинами, используя группы доступности и балансировку нагрузки.

>[AZURE.TIP]**Рекомендация.** Все рабочие нагрузки в Marketplace необходимо развертывать с использованием нескольких виртуальных машин, передающих трафик в группу доступности (с тремя доменами сбоя), и подсистемы балансировки нагрузки.

Для поддержки множества топологий развертывания, которые может поддерживать и рекомендовать ваше приложение, Azure Marketplace предлагает диспетчер ресурсов Azure (ARM) и шаблоны ARM. Диспетчер ресурсов Azure разворачивает коллекцию ресурсов и управляет их жизненным циклом с помощью декларативного языка шаблонов, основанного на модели. Этот шаблон является просто параметризованным JSON-файлом, который выражает набор ресурсов и их связи, используемые для развертывания. Каждый ресурс помещается в группу ресурсов, представляющую собой контейнер для ресурсов. Диспетчер ресурсов также предлагает конечным пользователям ряд очень полезных дополнительных возможностей, в том числе централизованный аудит операций, маркировку ресурсов через счет клиента, управление доступом на основе ресурсов для детализированной защиты, поддержку трех доменов сбоя вычислений для максимальной доступности. Все эти операции диспетчера являются идемпотентными.

> [AZURE.IMPORTANT]**Обязательно.** Учитывая преимущества для конечных пользователей, все содержимое Marketplace должно разворачиваться с помощью шаблонов диспетчера ресурсов Azure.

Благодаря диспетчеру ресурсов Azure и шаблонам ARM можно выполнять более сложные развертывания ресурсов Azure, например виртуальные машины, учетные записи хранения и виртуальные сети, созданные на основе такого содержимого Marketplace, как образы виртуальных машин и расширения виртуальных машин.

## Разработка структурных элементов
Разобравшись с топологиями приложения и выяснив, какую из них вы будете разрабатывать и внедрять в Marketplace на первом этапе, переходите к определению и разработке структурных элементов виртуальной машины. Как указано выше, вам необходимо решить, следует ли упаковывать содержимое виртуальной машины как собственный опубликованный образ виртуальной машины или необходимо использовать уже существующий образ виртуальной машины из Azure Marketplace, настроив его с помощью опубликованного обработчика расширений или с помощью собственного обработчика. Одного правильного решения не существует. Здесь все зависит от необходимой степени контроля над базовой операционной системой, а также от требований к способу установки и настройки приложения и управления им. Много информации об образах и расширениях можно найти на сайте MSDN и в блогах Azure. Список потенциально полезных статей можно найти ниже в разделе **Дополнительные материалы**.

Обратите внимание, что любой используемый образ или обработчик расширений необходимо сначала опубликовать в Marketplace.

## Разработка шаблонов ARM
Если вы не знакомы с диспетчером ресурсов Azure и шаблонами ARM, возможно, имеет смысл ознакомиться с документацией о диспетчере ресурсов Azure и вычислениях в нем. В приведенных ниже инструкциях и примерах предполагается наличие базовых знаний о языке шаблонов ARM и о выполнении вычислений в диспетчере ресурсов Azure. Этот раздел в основном посвящен рекомендациям и требованиям, которые помогут вам при разработке правильных шаблонов для Azure Marketplace. Они учитывают требования, позволяющие создать унифицированные, простые и уместные условия работы клиентов, использующих как портал Ibiza, так и программные средства.

Ваше решение, скорее всего, будет выражено набором шаблонов. Эти шаблоны представляют собой логические части топологии. Существует множество причин, по которым выражение топологии разбивается на несколько файлов, от простоты разработки и управляемости до повторного использования определенных наборов, а также модульного тестирования и развертывания решений на основе шаблонов. Основываясь на опыте сотрудничества с большим количеством партнеров, команда Azure предложила один из способов разбивки, который заключается в разделении топологии на шаблоны для общих ресурсов (например, виртуальные сети, учетные записи хранения и т. д.), которые называются «шаблоны общих ресурсов», на ноль или несколько шаблонов для дополнительных ресурсов, которые называются «шаблоны дополнительных ресурсов, и на один или несколько шаблонов для ресурсов, свойственных топологии, которые называются «шаблоны для ресурсов известной конфигурации».

Полное решение с шаблонами в Marketplace будет состоять из следующих элементов.

1. **Один основной шаблон (mainTemplate.json)** — это точка входа для всего развертывания, выраженная в JSON-файле шаблона диспетчера ресурсов Azure. Это первый файл, который оценивается для шаблонного решения. Он же используется для связывания всех остальных шаблонов. Этот файл также должен содержать все необходимые входные данные (параметры) от конечного пользователя.
2. **Ноль или несколько связанных шаблонов** — остальные шаблоны, связанные с основным шаблоном для выражения полной топологии решения.
3. **Ноль или несколько файлов сценариев** — любые необходимые файлы сценариев, ожидаемые в качестве входных данных для расширений, которые используются для настройки виртуальной машины.
4. **Один файл определения для создания пользовательского интерфейса (uiDefinition.json createUiDefinition.json)** — это файл, сопоставляющий параметры в шаблоне ARM с элементами в работе пользователей. Этот файл позволяет партнерам управлять пользовательским интерфейсом, отображаемым для их конечных пользователей на портале Ibiza. Все входные данные, которые должен предоставить конечный пользователь, будут выражены в этом файле. Каждая запись позволяет управлять всеми аспектами пользовательского интерфейса, связанными с каждой порцией входных данных, например пользовательским интерфейсом мини-приложения, параметрами по умолчанию, правилами проверки, сообщениями об ошибках и т. д. Перед началом разработки каждого из этих файлов для выражения полной топологии обратите внимание на следующие критерии. Они помогут создать наиболее подходящий шаблон для вашего предложения в Marketplace.

## Дополнительные требования и рекомендации

### Стандартизованный минимальный набор входных данных пользователя
Параметры позволяют выражать значения, которые должен предоставить пользователь во время развертывания в шаблоне. Входные данные пользователя могут быть разными для разных приложений и даже для разных уровней топологии. Список параметров должен обеспечивать надлежащий баланс между меньшим количеством обязательных вопросов и наличием у пользователя правильных способов управления развертыванием. Хотя к полному списку входных данных пользователя нет конкретных требований, мы хотим убедиться, что все шаблонные решения в Marketplace имеют набор общих входных данных, которыми хотят управлять многие клиенты. Убедитесь, что вы указали параметры для следующих значений.

1. **Расположение** — регион Azure, в котором развертываются ресурсы.
2.	**Имя виртуальной сети** — имя, которое используется для создания этого ресурса, в развертываниях, создающих виртуальную сеть. Для развертываний, использующих существующую виртуальную сеть, имя виртуальной сети, в которой выполняется развертывание.
3.	**Учетная запись хранения** — имя учетной записи хранения, которую необходимо создать, в развертываниях, создающих учетную запись хранилища. Для развертываний, использующих существующую виртуальную сеть, имя учетной записи хранения, которую необходимо использовать.
4.	**DNS-имя** — доменное имя виртуальной машины (или подсистемы балансировки нагрузки), к которой может подключиться конечный пользователь.
5.	**Имя пользователя** — имя пользователя виртуальных машин и приложений. У конечного пользователя можно запросить несколько имен пользователей, но обязательно нужно запросить по крайней мере одно.
6.	**Пароль** — пароль для виртуальных машин и приложений. У конечного пользователя можно запросить несколько паролей для виртуальных машин или приложений, но обязательно нужно запросить по крайней мере один.
7.	**Открытый ключ SSH (только для виртуальных машин Linux)** — ключ SSH для виртуальных машин. У конечного пользователя можно запросить несколько ключей для виртуальных машин, но обязательно нужно запросить по крайней мере один.

## Дальнейшие действия
Теперь, когда вы ознакомились с необходимыми компонентами и выполнили необходимые задачи, можно переходить к созданию предложения шаблона решения, как описано в [Руководстве по созданию шаблона решения](marketplace-publishing-solution-template-creation.md).

## См. также
- [Приступая к работе: как опубликовать предложение в Azure Marketplace](marketplace-publishing-getting-started.md)
- [Рекомендации по созданию шаблона решений](marketplace-publishing-solution-template-best-practices.md)

[link-acct]: marketplace-publishing-accounts-creation-registration.md

<!---HONumber=Oct15_HO3-->