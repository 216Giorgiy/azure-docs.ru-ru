<properties 
	pageTitle="Создание моментального снимка большого двоичного объекта" 
	description="Практическое руководство по созданию моментальных снимков больших двоичных объектов хранилища Azure" 
	services="storage" 
	documentationCenter="" 
	authors="tamram" 
	manager="adinah" 
	editor=""/>

<tags 
	ms.service="storage" 
	ms.workload="storage" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="02/20/2015" 
	ms.author="tamram"/>

#Создание моментального снимка большого двоичного объекта

Можно создать моментальный снимок большого двоичного объекта. Моментальный снимок - это версия BLOB-объекта только для чтения, сделанная в определенный момент времени. После создания моментального снимка его можно читать, копировать или удалять, но нельзя изменять. Моментальные снимки обеспечивают способ резервного копирования BLOB-объекта в том виде, в котором он находится в данный момент времени.

Снимок большого двоичного объекта имеет то же имя, что и базовый большой двоичный объект,  моментальный снимок которого создается, но к концу имени добавляется значение DateTime, указывающее на время, в которое был сделан снимок. Например, если универсальный код ресурса (URI) страничного большого двоичного объекта http://storagesample.core.blob.windows.net/mydrives/myvhd, то универсальный код ресурса (URI) моментального снимка будет примерно таким: http://storagesample.core.blob.windows.net/mydrives/myvhd?snapshot=2011-03-09T01:42:34.9360000Z. Это значение может быть использовано для обращения к моментальному снимку в последующих операциях. Моментальные снимки большого двоичного объекта используют один и тот же универсальный код ресурса (URI) и различаются только по значению DateTime. В коде клиентской библиотеки свойство большого двоичного объекта Snapshot возвращает значение DateTime, которое уникальным образом определяет моментальный снимок по отношению к своему базовому объекту. Используйте это значение, чтобы выполнять последующие операции с моментальным снимком.

Большой двоичный объект может иметь любое количество моментальных снимков. Моментальные снимки хранятся, пока не будут явно удалены. Моментальный снимок не может пережить свой исходный большой двоичный объект. Чтобы отследить текущие моментальные снимки, можно перечислить моментальные снимки, связанные с большим двоичным объектом.

##Наследование свойств

При создании моментального снимка большого двоичного объекта системные свойства и их значения копируются в снимок. Ниже перечислены копируемые системные свойства для клиентской библиотеки хранилища .NET:

- ContentType 

- ContentEncoding 

- ContentLanguage

- Length

- CacheControl

- ContentMd5 


Свойство аренды, связанное с базовым большим двоичным объектом, в моментальный снимок не копируется. Моментальные снимки нельзя арендовать.

##Копирование моментальных снимков 

Операции копирования больших двоичных объектов и моментальных снимков подчиняются следующим правилам:

- Можно скопировать моментальный снимок и заменить им исходный большой двоичный объект. Повысив уровень моментального снимка до базового большого двоичного объекта, можно восстановить более раннюю версию большого двоичного объекта. При этом моментальный снимок не исчезает, но его источник перезаписывается копией, которая допускает и чтение, и запись.

- Можно скопировать моментальный снимок в целевой большой двоичный объект с другим именем. Полученный целевой большой двоичный объект не станет моментальным снимком, а будет большим двоичным объектом, доступным для записи.

- Если копируется исходный большой двоичный объект, его моментальные снимки не копируются. Если целевой большой двоичный объект перезаписывается копией, это не влияет на связанные с ним моментальные снимки.  

- При создании моментального снимка блочного BLOB-объекта в снимок также копируется его список зафиксированных блоков. Незафиксированные блоки не копируются.

##Указание условия доступа 

Можно указать условие доступа, чтобы моментальный снимок создавался только в том случае, если данное условие выполняется. Чтобы это сделать, воспользуйтесь свойством AccessCondition. При невыполнении этого условия моментальный снимок не будет создан, а служба BLOB-объектов вернет код состояния HTTPStatusCode.PreconditionFailed.

##Удаление моментальных снимков 

Большой двоичный объект с моментальными снимками нельзя удалить, пока не удалены все его снимки. Можно удалить моментальные снимки по отдельности или воспользоваться функцией службы хранилища и удалить все снимки одновременно с исходным большим двоичным объектом. Если вы попытаетесь удалить большой двоичный объект, у которого все еще есть моментальные снимки, будет выдана ошибка.

##Моментальные снимки и хранилище Premium
Использование моментальных снимков с помощью хранилища Premium подчиняется следующим правилам:

- Учетная запись хранения Premium поддерживает до 100 моментальных снимков на каждый страничный BLOB-объект. При превышении этого количества операцией создания моментального снимка большого двоичного объекта возвращается ошибка с кодом 409 (SnapshotCountExceeded).

- При использовании учетной записи хранения Premium каждые десять минут можно создать один моментальный снимок страничного BLOB-объекта. При попытке более частого создания моментальных снимков возвращается ошибка с кодом 409 (SnaphotOperationRateExceeded).

- При использовании учетной записи хранения Premium чтение моментальных снимков страничного BLOB-объекта с помощью операции Get Blob не поддерживается. При попытке вызова этой операции возвращается ошибка с кодом 400 (недопустимая операция). Однако для моментальных снимков поддерживаются операции Get Blob Properties и Get Blob Metadata.

- Для чтения моментального снимка вы можете воспользоваться операцией Copy Blob, чтобы скопировать его в другой страничный BLOB-объект в пределах учетной записи. При этом в целевом большом двоичном объекте, выбранном для копирования, не должно быть других моментальных снимков. В противном случае будет возвращена ошибка с кодом 409 (SnapshotsPresent).

##Формирование абсолютного универсального кода ресурса (URI) для моментального снимка 

В этом примере кода составляется абсолютный универсальный код ресурса (URI) моментального снимка от базового большого двоичного объекта.

C#

	var snapshot = blob.CreateSnapshot();
	var uri = Microsoft.WindowsAzure.StorageClient.Protocol.BlobRequest.Get
    (snapshot.Uri, 
    0, 
    snapshot.SnapshotTime.Value, 
    null).Address.AbsoluteUri;

<!--HONumber=47-->
