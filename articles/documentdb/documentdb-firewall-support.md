---
title: "Поддержка брандмауэра DocumentDB | Документация Майкрософт"
description: "Узнайте, как настроить поддержку брандмауэра в учетных записях базы данных Azure DocumentDB с помощью политик контроля доступа на основе IP-адресов."
keywords: "Контроль доступа на основе IP-адресов, поддержка брандмауэра"
services: documentdb
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: documentdb
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/17/2016
ms.author: ankshah; kraman
translationtype: Human Translation
ms.sourcegitcommit: 2ea002938d69ad34aff421fa0eb753e449724a8f
ms.openlocfilehash: eb3c5c2adbaedc4bfb1e68f26b88079aeabe50f5


---
# <a name="documentdb-firewall-support"></a>Поддержка брандмауэра DocumentDB
Для защиты данных, хранящихся в учетных записях базы данных Azure DocumentDB, в DocumentDB реализована поддержка [модели авторизации](https://msdn.microsoft.com/library/azure/dn783368.aspx) на основе секретов. Проверка целостности данных в этой модели осуществляется с помощью надежного кода проверки подлинности сообщений, использующего хэш-функции (HMAC). Теперь, помимо модели авторизации на основе секрета, для поддержки входящего трафика брандмауэра база данных DocumentDB использует политики контроля доступа на основе IP-адресов. Эта модель очень похожа на правила брандмауэра в традиционной системе базы данных и предоставляет дополнительный уровень безопасности для учетных записей базы данных DocumentDB. Кроме того, эта модель позволяет настроить доступ к учетной записи базы данных DocumentDB только из утвержденных компьютеров и (или) облачных служб. Для доступа к ресурсам DocumentDB из этих утвержденных компьютеров и служб пользователь (вызывающая сторона) по-прежнему должен предоставить допустимый маркер проверки подлинности.

## <a name="ip-access-control-overview"></a>Общие сведения о контроле доступа на основе IP-адресов
По умолчанию доступ к учетной записи базы данных DocumentDB можно получить через Интернет при условии, что запрос сопровождается допустимым маркером авторизации. Чтобы настроить политики контроля доступа на основе IP-адресов, пользователь должен предоставить набор IP-адресов или их диапазонов в нотации CIDR, которые добавляются в список разрешенных клиентских IP-адресов для указанной учетной записи базы данных. После применения этой конфигурации сервер блокирует все запросы, полученные от компьютеров, IP-адреса которых не входят в список разрешенных.  На следующей схеме показан поток обработки подключения для контроля доступа на основе IP-адресов.

![Схема подключения для контроля доступа на основе IP-адресов](./media/documentdb-firewall-support/documentdb-firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a>Подключения из облачных служб
В Azure облачные службы — это стандартный способ размещения логики службы среднего уровня с помощью DocumentDB. Чтобы разрешить доступ к учетной записи базы данных DocumentDB из облачной службы, общедоступный IP-адрес этой службы необходимо добавить в список разрешенных IP-адресов, связанных с учетной записью базы данных DocumentDB. Для этого следует [обратиться в службу поддержки Azure](#configure-ip-policy).  Это позволит обеспечить доступ к учетной записи базы данных DocumentDB для всех экземпляров ролей облачных служб. IP-адреса для ваших облачных служб можно получить на портале Azure, как показано на следующем снимке экрана. 

![Снимок экрана с общедоступным IP-адресом для облачной службы на портале Azure](./media/documentdb-firewall-support/documentdb-public-ip-addresses.png)

При расширении своей облачной службы за счет добавления дополнительных экземпляров ролей эти новые экземпляры автоматически получают доступ к учетной записи базы данных DocumentDB, так как они входят в ту же самую облачную службу.

## <a name="connections-from-virtual-machines"></a>Подключения из виртуальных машин
[Виртуальные машины](https://azure.microsoft.com/services/virtual-machines/) или [масштабируемые наборы виртуальных машин](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) также можно использовать для размещения служб среднего уровня с помощью DocumentDB.  Чтобы настроить доступ к учетной записи базы данных DocumentDB из виртуальных машин, IP-адрес виртуальной машины и (или) масштабируемого набора виртуальных машин необходимо добавить в список разрешенных IP-адресов для этой учетной записи. Для этого следует [обратиться в службу поддержки Azure](#configure-ip-policy). IP-адреса для виртуальных машин можно получить на портале Azure, как показано на следующем снимке экрана.

![Снимок экрана с общедоступным IP-адресом для виртуальной машины на портале Azure](./media/documentdb-firewall-support/documentdb-public-ip-addresses-dns.png)

При добавлении в группу дополнительных экземпляров виртуальных машин они автоматически получают доступ к вашей учетной записи базы данных DocumentDB.

## <a name="connections-from-the-internet"></a>Подключения через Интернет
При подключении к учетной записи базы данных DocumentDB с компьютера через Интернет IP-адрес или диапазон IP-адресов клиента необходимо добавить в список разрешенных IP-адресов для этой учетной записи. 

## <a name="a-idconfigure-ip-policya-configuring-the-ip-access-control-policy"></a><a id="configure-ip-policy"></a> Настройка политики контроля доступа на основе IP-адресов
Используйте портал Azure, чтобы отправить запрос в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) на включение политики контроля доступа на основе IP-адресов в своей учетной записи базы данных.

1. В колонке [Справка и поддержка](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) выберите **Новый запрос в службу поддержки**.
2. В колонке **Новый запрос в службу поддержки** щелкните **Основные**.
3. В колонке **Основные** задайте следующие параметры.
   * **Тип проблемы** — квота.
   * **Подписка** — подписка, связанная с учетной записью, для которой необходимо добавить политику контроля доступа на основе IP-адресов.
   * **Тип квоты** — DocumentDB.
   * **План поддержки** — Quota support - Included (Поддержка квоты включена).
4. В колонке **Проблема** выполните следующие действия.
   * **Серьезность** — выберите "В — Минимальное влияние".
   * **Сведения** — скопируйте в поле следующий текст и добавьте свои имена пользователя или IP-адреса: "Я хочу включить поддержку брандмауэра для своей учетной записи базы данных DocumentDB. Учетная запись базы данных: *добавьте имена учетных записей*. Разрешенные IP-адреса или диапазон IP-адресов: *добавьте IP-адрес или диапазон IP-адресов в нотации CIDR, например 13.91.6.132, 13.91.6.1/24*".
   * Нажмите кнопку **Далее**. 
5. В колонке **Контактные данные** введите свои контактные данные и щелкните **Создать**. 

После получения запроса контроль доступа на основе IP-адресов будет включен в течение 24 часов. Как только запрос будет выполнен, пользователь получит уведомление.

![Снимок экрана: колонка "Справка и поддержка"](./media/documentdb-firewall-support/documentdb-firewall-support-request-access.png)

![Снимок экрана: колонка "Проблема"](./media/documentdb-firewall-support/documentdb-firewall-support-request-access-ticket.png)

## <a name="troubleshooting-the-ip-access-control-policy"></a>Устранение неполадок с политикой контроля доступа на основе IP-адресов
### <a name="portal-operations"></a>Операции на портале
После включения политики контроля доступа на основе IP-адресов для учетной записи базы данных DocumentDB все подключения к этой учетной записи с компьютеров, диапазоны IP-адресов которых не входят в список разрешенных, блокируются. При использовании этой модели просмотр операций с плоскостью данных на портале также блокируется, чтобы обеспечить целостность контроля доступа. 

### <a name="sdk-rest-api"></a>Пакет SDK и REST API
По соображениям безопасности при доступе с помощью пакета SDK и REST API с компьютеров, IP-адреса которых не входят в список разрешенных, вернется ответ с кодом 404 (объект не найден) без каких-либо дополнительных сведений. Проверьте список разрешенных IP-адресов и убедитесь, что политика имеет допустимую конфигурацию для учетной записи базы данных DocumentDB.

## <a name="next-steps"></a>Дальнейшие действия
Советы по улучшению производительности, связанные с сетью, см. в статье [Советы по улучшению производительности DocumentDB](documentdb-performance-tips.md).




<!--HONumber=Nov16_HO3-->


