---
redirect_url: https://azure.microsoft.com/services/documentdb/
ROBOTS: NOINDEX, NOFOLLOW
ms.translationtype: Human Translation
ms.sourcegitcommit: 71fea4a41b2e3a60f2f610609a14372e678b7ec4
ms.openlocfilehash: c1547d9910ce2bbfda79718ba74cdd8e7ca468f5
ms.contentlocale: ru-ru
ms.lasthandoff: 05/10/2017



---
# <a name="automatic-indexing-in-azure-cosmos-db"></a>Автоматическое индексирование в Azure Cosmos DB
Эта статья является выдержкой из документа [Schema-Agnostic Indexing with Azure Cosmos DB](http://www.vldb.org/pvldb/vol8/p1668-shukla.pdf) (Схемонезависимое индексирование в Azure Cosmos DB), который был представлен на [41-й внутренней конференции по очень большим базам данных](http://www.vldb.org/2015/), которая проходила с 31 августа по 4 сентября 2015 года. Статья содержит вводную информацию о работе индексирования в Azure Cosmos DB. 

После прочтения этой статьи вы сможете ответить на следующие вопросы:

* Как Azure Cosmos DB выводит схему из документа JSON?
* Как Azure Cosmos DB формирует индекс разнородных документов?
* Как Azure Cosmos DB выполняет автоматическое индексирование в масштабе?

## <a id="HowDocumentDBIndexingWorks"></a> Как работает индексирование в DocumentDB
[Microsoft Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) — это действительно бессхемная база данных, специально созданная для JSON. Она не ожидает и не требуют каких-либо схем или определений дополнительного индекса для индексации данных в масштабе. Это позволяет быстро определять модели данных приложения и выполнять на них итерации с помощью Azure Cosmos DB. По мере добавления документов в коллекцию Azure Cosmos DB автоматически индексирует все свойства документов, чтобы они стали вам доступны для выполнения запросов. Автоматическое индексирование позволяет хранить документы, принадлежащие совершенно произвольным схемам, не беспокоясь о схемах или дополнительных индексах.

Во избежание несогласованности между базой данных и моделями программирования приложений Azure Cosmos DB использует простоту JSON и отсутствие спецификации схемы. Не делается никаких предположений о документах. Документы в пределах коллекции Azure Cosmos DB могут отличаться как схемой, так и значениями конкретного экземпляра. В отличие от других баз данных документов, ядро СУБД Azure Cosmos DB работает непосредственно на уровне грамматики JSON, не привязываясь к понятию схемы документа и размывая границу между значениями структуры и экземпляра документов. Это, в свою очередь, позволяет ему автоматически индексировать документы без схемы или дополнительных индексов.

Индексирование в Azure Cosmos DB основано на том факте, что грамматика JSON позволяет представлять документы **в виде деревьев**. Чтобы представить документ JSON в виде дерева, требуется создать фиктивный корневой узел, который будет являться родителем остальные реальных узлов в подчиненном документе. Каждая метка, включая и индексы массива в документе JSON, становится узлом дерева. На рисунке ниже показан пример документа JSON и его соответствующее представление в виде дерева.

> [!NOTE]
> JSON является самоописывающим, т. е. каждый документ содержит схему (метаданные) и данные. Например, `{"locationId": 5, "city": "Moscow"}` показывает, что имеется два свойства, `locationId` и `city`, и что они имеют числовое и строковое значения. Azure Cosmos DB может вывести схему документов и индексировать их при вставке или замене. При этом вам никогда не понадобится определять схемы или дополнительные индексы.
> 
> 

**Документы JSON в виде деревьев:**

![Документы в виде деревьев](media/documentdb-indexing/DocumentsAsTrees.png)

Например, в приведенном выше примере:

* Например, свойство JSON `{"headquarters": "Belgium"}` в вышеприведенном примере соответствует path/headquarters/Belgium.
* Массив JSON `{"exports": [{"city": “Moscow"}`, `{"city": Athens"}]}` соответствует путям `/exports/[]/city/Moscow` и `/exports/[]/city/Athens`.

При использовании автоматического индексирования: 1. Каждый путь в дереве документов индексируется (если только разработчик явно не настроил политику индексирования, чтобы исключить определенные шаблоны путей). 2. Каждое изменение документа в коллекции Azure Cosmos DB приводит к обновлению структуры индекса (т. е. приводит к добавлению или удалению узлов). Одно из основных требований автоматического индексирования документов — обеспечить, чтобы стоимость индексирования и запроса документа с большим уровнем вложенности структуры (например, 10 уровней) была такой же, как для неструктурированного документа JSON, состоящего из пар "ключ — значение" всего на один уровень глубже. Таким образом представление нормализованного пути — это основа, на которой строятся подсистемы автоматического индексирования и выполнения запросов.

Важное следствие единообразного рассмотрения значений схемы и экземпляра с точки зрения путей: если следовать логике, то отображаемый индекс двух документов, обеспечивающий сопоставление путей и идентификаторов документов, содержащих эти пути, можно представить в виде дерева, как и отдельные документы. Azure Cosmos DB использует этот факт для создания дерева индексов, которое составляется путем объединения всех деревьев, представляющих отдельные документы в коллекции. По мере добавления новых документов или изменения документов в коллекции дерево индексов в коллекциях Azure Cosmos DB со временем увеличивается.

**Индекс базы данных Azure Cosmos DB в виде дерева:**

![Индекс в виде дерева](media/documentdb-indexing/IndexAsTree.png)

Несмотря на отсутствие схем, языки запросов SQL и JavaScript в Azure Cosmos DB предоставляют реляционные проекции и фильтры, иерархическую навигацию между документами, пространственными операциями и вызов определяемых пользователем функций, написанных полностью на языке JavaScript. Среда выполнения запросов Azure Cosmos DB поддерживает эти запросы, так как может работать непосредственно с древовидным представлением индекса данных.

Политика индексирования по умолчанию автоматически индексирует все свойства всех документов и обеспечивает согласованность запросов (то есть индекс синхронно обновляется при записи в документ). Как Azure Cosmos DB обеспечивает согласованность обновлений в дереве индексов в масштабе? Azure Cosmos DB использует методы обслуживания индексов со структурированием журналов, оптимизацией записи и без блокировки. Это значит, что Azure Cosmos DB поддерживает устойчивый объем быстрых операций записи, при этом обслуживая согласованные запросы. 

Индексирование этой службы предназначено для повышения эффективности хранения и обработки мультитенантности. Для повышения эффективности затрат дополнительные затраты дискового пространства при индексировании являются ограниченными и предсказуемыми. Обновления индекса также выполняются в рамках бюджета системных ресурсов, выделяемых на каждую коллекцию Azure Cosmos DB.

## <a name="NextSteps"></a> Дальнейшие действия
* Скачайте документ [Schema-Agnostic Indexing with Azure Cosmos DB](http://www.vldb.org/pvldb/vol8/p1668-shukla.pdf) (Схемонезависимое индексирование в Azure DocumentDB), который был представлен на 41-й внутренней конференции по очень большим базам данных, проходившей с 31 августа по 4 сентября 2015 года.
* [Формирование запросов с помощью DocumentDB SQL](documentdb-sql-query.md)
* Дополнительные сведения о настройке индекса Azure Cosmos DB см. [здесь](documentdb-indexing-policies.md).


