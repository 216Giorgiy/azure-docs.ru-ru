---
title: "Оперативные архивация и восстановление с помощью DocumentDB | Документация Майкрософт"
description: "Узнайте, как автоматически архивировать и восстанавливать базы данных NoSQL с помощью Azure DocumentDB."
keywords: "архивация и восстановление, оперативная архивация"
services: documentdb
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: documentdb
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 01/04/2017
ms.author: raprasa
translationtype: Human Translation
ms.sourcegitcommit: 219dcbfdca145bedb570eb9ef747ee00cc0342eb
ms.openlocfilehash: 23f6049bc0df133966911b2352b044cdbc777b36


---
# <a name="automatic-online-backup-and-restore-with-documentdb"></a>Автоматическая оперативная архивация и восстановление с помощью DocumentDB
Azure DocumentDB автоматически выполняет архивацию всех ваших данных с регулярными интервалами. Автоматическая архивация не влияет на производительность или доступность операций баз данных NoSQL. Для обеспечения устойчивости в случае региональной аварии все архивные копии хранятся отдельно в другой службе хранилища, а также глобально реплицируются. Автоматическая архивация предназначена для решения аварийного восстановления или сценариев, при которых коллекция DocumentDB случайно удаляется и затем требуется восстановление данных.  

В начале этой статьи приводится краткий обзор понятий избыточности и доступности данных в DocumentDB, а затем рассматривается архивация. 

## <a name="high-availability-with-documentdb---a-recap"></a>Высокая доступность в DocumentDB — обзор
Система DocumentDB создана по принципу [глобального распределения](documentdb-distribute-data-globally.md). Она позволяет масштабировать пропускную способность между несколькими регионами Azure, выполнять отработку отказа на основе политик, а также предоставляет прозрачные интерфейсы API с размещением в нескольких регионах. Так как система управления базами данных предлагает [соглашения об уровне обслуживания с показателем доступности 99,99 %](https://azure.microsoft.com/support/legal/sla/documentdb/v1_0/), все операции записи в DocumentDB надежно фиксируются на локальных дисках с соблюдением кворума реплик в локальном центре обработки данных, прежде чем подтверждаются клиенту. Обратите внимание, что высокая доступность DocumentDB основана на использовании локальных хранилищ и не зависит от технологий внешнего хранения. Кроме того, если ваша учетная запись базы данных связана с более чем одним регионом Azure, то ваши операции записи также реплицируются между другими регионами. Для масштабирования пропускной способности и доступа к данным с небольшой задержкой можно указать любое количество регионов чтения, связанных с учетной записью базы данных. В каждом регионе чтения (реплицированные) данные надежно хранятся в наборе реплик.  

Как показано на следующей схеме, одна коллекция DocumentDB является [горизонтально секционированной](documentdb-partition-data.md). "Секция" на этой схеме обозначается кружком, а высокая доступность каждой секции обеспечивается набором реплик. Это локальное распределение в одном регионе Azure (обозначается осью X). Затем каждая секция (с соответствующим набором реплик) глобально распределяется по нескольким регионам, связанным с учетной записью базы данных (например, на данном рисунке указаны три региона — восточная часть США, западная часть США и центральная Индия). Набор секций — это глобально распределенная сущность, состоящая из нескольких копий данных в каждом регионе (обозначается осью Y). Вы можете назначить приоритет регионам, связанным с вашей учетной записью базы данных, и в случае аварии DocumentDB прозрачно выполнит отработку отказа в следующий регион. Также можно вручную смоделировать отработку отказа, чтобы протестировать комплексную доступность приложения.  

На следующем рисунке показана высокая степень избыточности, обеспечиваемая DocumentDB.

![Высокая степень избыточности, обеспечиваемая DocumentDB](./media/documentdb-online-backup-and-restore/azure-documentdb-nosql-database-redundancy.png)

![Высокая степень избыточности, обеспечиваемая DocumentDB](./media/documentdb-online-backup-and-restore/azure-documentdb-nosql-database-global-distribution.png)

## <a name="full-automatic-online-backups"></a>Полная, автоматическая и оперативная архивация
Ой, я удалил свою коллекцию или базу данных! При использовании DocumentDB не только ваши данные, но и архивные копии ваших данных остаются высоко избыточными и устойчивыми к региональным авариям. В настоящее время такая автоматическая архивация выполняется примерно каждые четыре часа. 

Архивация не влияет на производительность или доступность операций баз данных. DocumentDB выполняет архивацию в фоновом режиме, не используя подготовленные ЕЗ, не снижая производительность и не влияя на доступность базы данных NoSQL. 

В отличие от данных, сохраненных внутри DocumentDB, автоматические архивные копии хранятся в службе хранилища BLOB-объектов Azure. Для обеспечения эффективной передачи данных с небольшой задержкой моментальный снимок архивной копии передается в экземпляр хранилища BLOB-объектов Azure в том же регионе, который является текущим регионом записи вашей учетной записи базы данных DocumentDB. Для обеспечения устойчивости к региональным авариям каждый моментальный снимок данных архивной копии в хранилище BLOB-объектов Azure повторно реплицируется в другой регион с помощью геоизбыточного хранилища (GRS). На следующей схеме показано, как вся коллекция DocumentDB (в данном примере — все три основные секции в западной части США) архивируется в удаленную учетную запись хранилища BLOB-объектов в западной части США, а затем реплицируется через GRS в восточную часть США. 

На следующем рисунке показана периодически выполняемая полная архивация всех сущностей DocumentDB в геоизбыточное хранилище Azure.

![Периодически выполняемая полная архивация всех сущностей DocumentDB в геоизбыточное хранилище Azure](./media/documentdb-online-backup-and-restore/azure-documentdb-nosql-database-automatic-backup.png)

## <a name="retention-period-for-a-given-snapshot"></a>Срок хранения моментального снимка
Как описано выше, периодически мы делаем моментальные снимки ваших данных. В соответствии с нормативными правилами последний снимок хранится до 90 дней, а затем удаляется. Если удаляется коллекция или учетная запись, то DocumentDB хранит последнюю архивную копию в течение 90 дней.

## <a name="restore-database-from-the-online-backup"></a>Восстановление базы данных из оперативного архива
Если вы случайно удалите данные, то можете [отправить запрос](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) или [позвонить в службу поддержки Azure](https://azure.microsoft.com/support/options/), чтобы восстановить данные из последней созданной автоматически резервной копии. Чтобы восстановить определенный моментальный снимок архива системе DocumentDB требуется, чтобы данные были нам доступны хотя бы в течение цикла архивации для данного снимка.

## <a name="next-steps"></a>Дальнейшие действия
Чтобы реплицировать базу данных NoSQL в нескольких центрах обработки данных, ознакомьтесь со статьей [Глобальное распространение данных с помощью DocumentDB](documentdb-distribute-data-globally.md). 

Для обращения в службу поддержки Azure [отправьте запрос с портала Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).




<!--HONumber=Nov16_HO3-->


