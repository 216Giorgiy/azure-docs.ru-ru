---
title: "Глобальное распределение данных с помощью DocumentDB | Документация Майкрософт"
description: "Узнайте о георепликации в масштабах планеты, отработке отказа и восстановлении данных с помощью глобальных баз данных из Azure DocumentDB — полностью управляемой службы базы данных NoSQL."
services: documentdb
documentationcenter: 
author: arramac
manager: jhubbard
editor: 
ms.assetid: ba5ad0cc-aa1f-4f40-aee9-3364af070725
ms.service: documentdb
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 02/20/2017
ms.author: arramac
translationtype: Human Translation
ms.sourcegitcommit: 72d9c639a6747b0600c5ce3a1276f3c1d2da64b2
ms.openlocfilehash: 8c3ced706c26e09d709d7cfb4d81534c362e1628
ms.lasthandoff: 02/22/2017


---
# <a name="documentdb---a-globally-distributed-database-service-on-azure"></a>DocumentDB — глобально распределенная служба базы данных в Azure
Среда Azure вездесуща: она используется более чем в 30 географических регионах по всему миру и постоянно растет. Благодаря повсеместному присутствию одной из отличительных возможностей, предлагаемых Azure разработчикам, является возможность легко выполнять сборку, развертывание и управление глобально распределенными приложениями. DocumentDB — это мультитенантная, распределенная СУБД корпорации Майкрософт, позволяющая разработчикам создавать приложения общемирового масштаба. DocumentDB позволяет эластично масштабировать пропускную способность и хранилище в любых географических регионах. Данная служба обеспечивает гарантированную низкую задержку на уровне 99 перцентиля (P99), высокий уровень доступности 99,99 %, прогнозируемую пропускную способность и [несколько четко определенных моделей согласованности](documentdb-consistency-levels.md) — и все это регулируется исчерпывающими соглашениями об уровне обслуживания. Благодаря своему [бессхемному и оптимизированному для записи ядру СУБД](http://www.vldb.org/pvldb/vol8/p1668-shukla.pdf), служба DocumentDB по умолчанию способна автоматически индексировать все принимаемые данные и обслуживать [SQL](documentdb-sql-query.md)-запросы, запросы [MongoDB](documentdb-protocol-mongodb.md) и [запросы LINQ JavaScript](documentdb-programming.md#javascript-language-integrated-query-api) независимо от масштаба. Являясь облачной службой, система DocumentDB с самого начала была разработана для обеспечения мультитенантности и глобального распространения.

**Отдельная коллекция DocumentDB, секционированная и распределенная по трем регионам Azure**

![Коллекция DocumentDB, секционированная и распределенная по трем регионам](./media/documentdb-distribute-data-globally/documentdb-global-apps.png)

Как мы узнали при разработке DocumentDB, не стоит добавлять возможности глобального распространения опосредованно. Их невозможно "прикрутить" к "односайтовой" СУБД. Возможности, предлагаемые глобально распределенной базой данных, выходят за пределы возможностей традиционного географического аварийного восстановления (Geo-DR), предлагаемых "односайтовыми" базами данных. Односайтовые базы данных, предлагающие возможности Geo-DR, являются строгим подмножеством глобально распределенных баз данных. 

Благодаря готовому к использованию глобальному распространению, предлагаемому DocumentDB, разработчикам не придется создавать собственные шаблоны репликации, либо применяя шаблон Lambda (например, [репликацию AWS DynamoDB](https://github.com/awslabs/dynamodb-cross-region-library/blob/master/README.md)) к журналу базы данных, либо выполняя "двойную запись" в нескольких регионах. Мы не рекомендуем эти подходы, так как они не позволяют гарантировать правильность применяемых методов и обеспечить полноценные соглашения об уровне обслуживания. 

В этой статье содержится обзор возможностей глобального распространения DocumentDB. Мы также опишем уникальный подход DocumentDB к предоставлению исчерпывающих соглашений об уровне обслуживания. 

## <a id="EnableGlobalDistribution"></a>Включение готового к использованию глобального распространения
DocumentDB предоставляет следующие возможности, позволяющие легко создавать приложения общемирового масштаба. Эти возможности доступны через [интерфейсы REST API](https://docs.microsoft.com/rest/api/documentdbresourceprovider/) поставщика ресурсов DocumentDB, а также на портале Azure.

### <a id="RegionalPresence"></a>Повсеместное географическое присутствие 
Azure постоянно расширяет свое географическое присутствие, добавляя новые регионы в сеть. Служба DocumentDB доступна во всех новых регионах Azure по умолчанию. Это позволяет связать географический регион со своей учетной записью базы данных DocumentDB, как только Azure откроет новый регион для осуществления операций.

**Служба DocumentDB доступна во всех регионах Azure по умолчанию**

![Служба DocumentDB доступна во всех регионах Azure](./media/documentdb-distribute-data-globally/azure-regions.png)

### <a id="UnlimitedRegionsPerAccount"></a>Связывание неограниченного количества регионов с учетной записью базы данных DocumentDB
DocumentDB позволяет связать любое количество регионов Azure с учетной записью базы данных DocumentDB. Кроме ограничений, связанных с определением геозон (например, Китай, Германия), ничто не ограничивает количество регионов, которые можно связать с учетной записью базы данных DocumentDB. На следующем рисунке показана учетная запись базы данных, охватывающая 21 регион Azure.  

**Учетная запись базы данных DocumentDB клиента, охватывающая 21 регион Azure**

![Учетная запись базы данных DocumentDB, охватывающая 21 регион Azure](./media/documentdb-distribute-data-globally/documentdb-spanning-regions.png)

### <a id="PolicyBasedGeoFencing"></a>Определение геозон на основе политик
В DocumentDB реализованы возможности определения геозон на основе политик. Определение геозон является важной составляющей для соблюдения ограничений, связанных с управлением данных и соответствием требованиям, и оно может не допустить связывание определенного региона с вашей учетной записью. К примерам определения геозон относятся (но не ограничиваются ими) охват глобальным распространением регионов в независимом облаке (например, в Китае и Германии) или в пределах границ государственного налогообложения (например, в Австралии). Политики управляются с помощью метаданных подписки Azure.

### <a id="DynamicallyAddRegions"></a>Динамическое добавление и удаление регионов
DocumentDB позволяет в любой момент добавить (связать) или удалить (отменить связь) регионы в учетной записи базы данных (см. [предыдущий рисунок](#UnlimitedRegionsPerAccount)). Благодаря параллельной репликации данных между секциями, DocumentDB гарантирует, что когда новый регион добавится в сеть, служба DocumentDB станет доступна в течение 30 минут в любом месте земного шара, предоставив до 100 ТБ. 

### <a id="FailoverPriorities"></a>Приоритеты отработки отказа
Чтобы обеспечить точную последовательность региональной отработки отказа при сбое нескольких регионов, DocumentDB позволяет присвоить приоритет различным регионам, связанным с учетной записью базы данных (см. следующий рисунок). DocumentDB гарантирует, что последовательность автоматической отработки отказа происходит в порядке указанных приоритетов.

**Клиент DocumentDB можно настроить порядок приоритета отработки отказа (правая область) для регионов, связанных с учетной записью базы данных**

![Настройка приоритетов отработки отказа с помощью Azure DocumentDB](./media/documentdb-distribute-data-globally/documentdb-failover-priorities.png)

### <a id="OfflineRegions"></a>Динамическое отключение региона от сети
DocumentDB позволяет отключить от сети учетную запись базы данных в определенном регионе, а затем вновь подключить ее. Регионы, помеченные как отключенные от сети, не принимают активного участия в репликации и не задействуются в последовательности отработки отказа. Это дает возможность зафиксировать последний достоверно исправный образ базы данных в одном из регионов чтения, прежде чем установить потенциально опасные обновления в приложении.

### <a id="ConsistencyLevels"></a>Несколько четко определенных моделей согласованности для глобально реплицируемых баз данных
DocumentDB предоставляет [нескольких четко определенных уровней согласованности](documentdb-consistency-levels.md), регулируемых соглашениями об уровне обслуживания. Можно выбрать определенную модель согласованности (из списка доступных вариантов) в зависимости от рабочей нагрузки и сценариев. 

### <a id="TunableConsistency"></a>Настраиваемая согласованность для глобально реплицируемых баз данных
DocumentDB позволяет программно переопределить и понизить выбранный по умолчанию уровень согласованности для каждого запроса во время выполнения. 

### <a id="DynamicallyConfigurableReadWriteRegions"></a>Динамически настраиваемые регионы чтения и записи
DocumentDB позволяет настраивать регионы, связанные с базой данных, как регионы для чтения, записи или чтения и записи. 

### <a id="ElasticallyScaleThroughput"></a>Эластичное масштабирование пропускной способности в регионах Azure
Можно эластично масштабировать коллекцию DocumentDB, программно подготавливая пропускную способность. Пропускная способность охватывает все регионы, в которых распространяется коллекция.

### <a id="GeoLocalReadsAndWrites"></a>Локальные операции чтения и записи
Ключевым преимуществом глобально распределенной базы данных является высокоскоростной доступ к данным в любой точке мира. DocumentDB предлагает гарантии низкой задержки на уровне&99; перцентиля (P99) для выполнения различных операций базы данных. Это гарантирует, что все операции чтения направляются в ближайший регион чтения. Для обслуживания запроса на чтение используется кворум, являющийся локальным для региона, в котором выполняется чтение. Это относится и к записи. Запись подтверждается только после того, что большинство реплик надежно зафиксируют запись локально, но без проверки на удаленных репликах для подтверждения операций записи. Иначе говоря, протокол репликации DocumentDB работает с учетом предположения о том, что кворумы чтения и записи всегда являются локальными для регионов чтения и записи, в которых выдается запрос.

### <a id="ManualFailover"></a>Запуск региональной отработки отказа вручную
DocumentDB позволяет активировать отработку отказа учетной записи базы данных, чтобы проверить *комплексные* характеристики доступности всего приложения (за пределами базы данных). Так как гарантируется безопасность и жизнеспособность средств обнаружения сбоев и выбора лидера, DocumentDB гарантирует *полную защиту от потери данных* при инициируемой клиентом ручной отработке отказа.

### <a id="AutomaticFailover"></a>Автоматическая отработка отказа
DocumentDB поддерживает автоматическую отработку отказа в случае сбоя одного или нескольких регионов. Во время региональной отработки отказа DocumentDB поддерживает параметры задержки при чтении, гарантированной бесперебойной работы, согласованности и пропускной способности, определенные соглашениями об уровне обслуживания. DocumentDB задает максимальную продолжительность операции автоматической отработки отказа. Это окно потенциальной потери данных во время регионального сбоя.

### <a id="GranularFailover"></a>Выбор степени детализации отработки отказа
В настоящее время возможности автоматической и ручной отработки отказа предоставляются на уровне учетной записи базы данных. Обратите внимание, что внутренние процессы DocumentDB разработаны для обеспечения *автоматической* отработки отказа с большей степенью детализации: до базы данных, коллекции или даже секции (коллекции, содержащей диапазон ключей). 

### <a id="MultiHomingAPIs"></a>Интерфейсы API множественной адресации
DocumentDB позволяет взаимодействовать с базой данных, используя логические (независящие от региона) или физические конечные точки (зависящие от региона). Применение логических конечных точек гарантирует, что приложение сможет явным образом использовать множественную адресацию в случае отработки отказа. Физические же конечные точки предоставляют приложению детальный контроль для перенаправления операций чтения и записи в определенные регионы.

### <a id="TransparentSchemaMigration"></a>Прозрачный и согласованный перенос схемы и индекса базы данных 
DocumentDB является полностью [бессхемной](http://www.vldb.org/pvldb/vol8/p1668-shukla.pdf) службой. Уникальное устройство ядра СУБД DocumentDB позволяет автоматически и синхронно индексировать все принимаемые данные, не требуя от вас схемы или вторичных индексов. Это дает возможность быстро выполнять итерацию глобально распределенного приложения, не беспокоясь о переносе схемы и индекса базы данных или координировании многоэтапных развертываний изменений схемы в приложении. DocumentDB гарантирует, что любые изменения политик индексации, внесенные вами явным образом, не приведут к снижению производительности или доступности.  

### <a id="ComprehensiveSLAs"></a>Исчерпывающие соглашения об уровне обслуживания (не только высокий уровень доступности)
Являясь глобально распределенной службой базы данных, DocumentDB предлагает четко определенные соглашения об уровне обслуживания, регулирующие характеристики базы данных (**потери данных**, **доступность**, **задержка на уровне&99; перцентиля (P99)**, **пропускная способность** и **согласованность**) в целом, независимо от количества связанных с ней регионов.  

## <a id="LatencyGuarantees"></a>Гарантии относительно задержки
Ключевым преимуществом такой глобально распределенной службы базы данных, как DocumentDB, является высокоскоростной доступ к данным в любой точке мира. DocumentDB предлагает гарантированную низкую задержку на уровне&99; перцентиля (P99) для различных операций базы данных. Протокол репликации, который использует DocumentDB, гарантирует, что операции базы данных (в идеальном случае и операции чтения, и операции записи) всегда выполняются в локальном для клиента регионе. Соглашение об уровне обслуживания DocumentDB, регулирующее задержку, включает в себя&99; перцентиль (P99) для операций чтения, индексированных операций записи (синхронно) и запросов для различных размеров запроса и ответа. Гарантии задержки для операций записи включают в себя надежную фиксацию кворумом большинства в локальном центре обработки данных.

### <a id="LatencyAndConsistency"></a>Взаимосвязь задержки и согласованности 
Чтобы глобально распределенная служба могла обеспечить строгую согласованность в глобально распределенной конфигурации, она должна синхронно реплицировать операции записи или синхронно выполнять операции чтения между регионами. Из-за высокой скорости и надежности глобальной сети строгая согласованность приведет к высоким задержкам и низкому уровню доступности операций базы данных. Таким образом, чтобы обеспечить гарантированные низкие задержки на уровне 99 перцентиля (P99) и 99,99 % доступности, служба должна использовать асинхронную репликацию. Из этого также следует, что служба должна обеспечивать [четко определенные уровни нестрогой согласованности](documentdb-consistency-levels.md), которые будут менее надежны, чем уровень строгой согласованности (чтобы предоставить гарантии низкой задержки и доступности), и, в идеальном случае, более надежны, чем согласованность в конечном счете (чтобы предоставить интуитивную модель программирования).

DocumentDB гарантирует, что операции чтения не требуется обращаться к репликам в нескольких регионах, чтобы обеспечить определенный гарантированный уровень согласованности. Точно так же гарантируется, что операция записи не блокируются, если данные реплицируются во всех регионах (т. е. операции записи асинхронно реплицируются в регионах). Для учетных записей базы данных в нескольких регионах доступно несколько уровней нестрогой согласованности. 

### <a id="LatencyAndAvailability"></a>Взаимосвязь задержки и доступности 
Задержка и доступность — это две стороны одной медали. Мы говорим о задержке операции в устойчивом состоянии и ее доступности в случае сбоев. С точки зрения приложения медленное выполнение операций базы данных не отличается от недоступности базы данных. 

Чтобы отличать большую задержку и недоступность, DocumentDB использует абсолютную верхнюю границу задержки для различных операций базы данных. Если операция базы данных выполняется дольше, чем позволяет это значение, то DocumentDB возвращает ошибку времени ожидания. Соглашение об уровне обслуживания DocumentDB, регулирующее доступность, гарантирует, что время ожидания считается в соответствии с этим соглашением. 

### <a id="LatencyAndThroughput"></a>Взаимосвязь задержки и пропускной способности
DocumentDB не принуждает выбирать между задержкой и пропускной способностью. Учитываются соглашения об уровне обслуживания и для задержки (99 перцентиль (P99)), и для пропускной способности, которую вы подготовили. 

## <a id="ConsistencyGuarantees"></a>Гарантии согласованности
Хотя [модель строгой согласованности](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf) является "золотым" стандартом программируемости, за нее приходится дорого расплачиваться высокой задержкой (в устойчивом состоянии) и потерей доступности (в случае сбоев). 

DocumentDB предлагает четко определенную модель программирования, позволяющую обеспечить согласованность реплицируемых данных. Чтобы вы могли создавать приложения с множественной адресацией, модели согласованности, предоставляемые DocumentDB, не зависят от региона, из которого обслуживаются операций чтения и записи. 

Соглашение об уровне обслуживания DocumentDB, регулирующее согласованность, гарантирует, что 100 % запросов на чтение будут соответствовать гарантированному значению для запрошенного вами уровня согласованности. Это может быть используемый по умолчанию уровень согласованности для учетной записи базы данных либо переопределенное значение согласованности в запросе. Запрос на чтение считается соответствующим соглашению об уровне обслуживания, регулирующему согласованность, если удовлетворяются гарантии согласованности, связанные с уровнем согласованности. В следующей таблице указаны гарантии согласованности, соответствующие определенным уровням согласованности, предлагаемым DocumentDB.

**Гарантии согласованности, связанные с заданным уровнем согласованности в DocumentDB**

<table>
    <tr>
        <td><strong>Уровень согласованности</strong></td>
        <td><strong>Характеристики согласованности</strong></td>
        <td><strong>Соглашение об уровне обслуживания</strong></td>
    </tr>
    <tr>
        <td rowspan="3">Сеанс</td>
        <td>Чтение собственной записи</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td>Монотонное чтение</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td>Согласованность префиксов</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td rowspan="3">Ограниченная с запаздыванием</td>
        <td>Монотонное чтение (в пределах региона)</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td>Согласованность префиксов</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td>Предел запаздывания &lt; K, T</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td>Уровень согласованности Eventual (в конечном счете)</td>
        <td>Согласованность префиксов</td>
        <td>100 %</td>
    </tr>
    <tr>
        <td>Уровень согласованности Strong (сильная)</td>
        <td>Линеаризуемость</td>
        <td>100 %</td>
    </tr>
</table>

### <a id="ConsistencyAndAvailability"></a>Взаимосвязь согласованности и доступности
Следствие [теоремы CAP](https://people.eecs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf) [о невыполнимости](http://www.glassbeam.com/sites/all/themes/glassbeam/images/blog/10.1.1.67.6951.pdf) подтверждает, что в случае сбоев система действительно не может оставаться доступной и обеспечивать линеаризуемую согласованность. Служба базы данных должна реализовать или модель CP, или модель AP: система CP отказывается от доступности в пользу линеаризуемой согласованности, а система AP — от [линеаризуемой согласованности](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf) в пользу доступности. Служба DocumentDB не нарушает требуемый уровень согласованности, что формально относит ее к системам CP. Однако на практике согласованность не ограничена принципом "все или ничего". Существует несколько четко определенных моделей согласованности, как и диапазон от линеаризуемой согласованности до согласованности в конечном счете. В DocumentDB мы попытались определить несколько практичных моделей нестрогой согласованности, которые обеспечивают интуитивную модель программирования. DocumentDB обеспечивает компромисс между согласованностью и доступностью, предлагая соглашение об уровне обслуживания, гарантирующее 99,99 % доступность, вместе с [несколькими нестрогими, но четко определенными уровнями согласованности](documentdb-consistency-levels.md). 

### <a id="ConsistencyAndAvailability"></a>Взаимосвязь согласованности и задержки
Более исчерпывающий вариант теоремы CAP был предложен профессором Дэниэлом Абади (Daniel Abadi). Она называется [PACELC](http://cs-www.cs.yale.edu/homes/dna/papers/abadi-pacelc.pdf), и в ней учитываются компромиссы между задержкой и согласованностью в устойчивом состоянии. В этой теореме утверждается, что в устойчивом состоянии СУБД должна выбрать между согласованностью и задержкой. Предлагая несколько моделей нестрогой согласованности (с асинхронными репликацией и локальными операциями чтения, а также кворумом записи), DocumentDB гарантирует, что все операции чтения и записи будут локальными для регионов чтения и записи соответственно.  Это позволяет DocumentDB предложить гарантии низкой задержки в регионе для этих уровней согласованности.  

### <a id="ConsistencyAndThroughput"></a>Взаимосвязь согласованности и пропускной способности
Так как реализация конкретной модели согласованности зависит от выбора [типа кворума](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf), пропускная способность также зависит от выбора модели согласованности. Например, в DocumentDB пропускная способность для строго согласованных операций чтения примерно в два раза меньше, чем для операций чтения, согласованных в конечном счете. 
 
**Взаимосвязь между нагрузкой операций чтения и определенным уровнем согласованности в DocumentDB**

![Взаимосвязь между согласованностью и пропускной способностью](./media/documentdb-distribute-data-globally/consistency-and-throughput.png)

## <a id="ThroughputGuarantees"></a>Гарантии пропускной способности 
DocumentDB позволяет эластично масштабировать пропускную способность (а также ресурсы хранилища) в разных регионах в зависимости от потребностей. 

**Отдельная коллекция DocumentDB, секционированная (на три сегмента) и распределенная по трем регионам Azure**

![Распределенные и секционированные коллекции Azure DocumentDB](./media/documentdb-distribute-data-globally/documentdb-throughput.png)

Коллекция DocumentDB распределяется в двух плоскостях — в пределах региона и между регионами. Этот процесс описывается далее. 

* В пределах отдельного региона коллекция развертывается с точки зрения секций ресурсов. Каждая секция ресурсов управляет набором ключей и является строго согласованной и высокодоступной благодаря репликации конечного автомата в наборе реплик. DocumentDB — это полностью управляемая ресурсами система, в которой секции ресурсов отвечают за предоставление своей доли пропускной способности в пределах бюджета выделенных ей системных ресурсов. Масштабирование коллекции DocumentDB является полностью прозрачным. DocumentDB управляет секциями ресурсов, при необходимости разделяя или объединяя их. 
* Затем каждая секция ресурсов распространяется в несколько регионов. Секции ресурсов, обладающие одинаковым набором ключей в разных регионах, образуют набор секций (см. [предыдущий рисунок](#ThroughputGuarantees)).  Секции ресурсов в наборе секций координируются с помощью репликации конечного автомата в нескольких регионах. В зависимости от того, какой уровень согласованности задан, секции ресурсов в наборе секций настраиваются динамически с помощью различных топологий (например, "звезда", подключение шлейфом, "дерево" и т. д.). 

Благодаря чрезвычайно гибкому управлению секциями, балансировке нагрузки и строгому управлению ресурсами DocumentDB позволяет эластично масштабировать пропускную способность в нескольких регионах Azure для коллекции DocumentDB. Изменение пропускной способности для коллекции в DocumentDB — это операция времени выполнения. Как и для других операций базы данных, DocumentDB гарантирует абсолютную верхнюю границу задержки для запроса на изменение пропускной способности. Например, на следующем рисунке показана коллекция клиента с эластично подготавливаемой по требованию пропускной способностью (меняющейся от 1 до 10 млн запросов в секунду в двух регионах).
 
**Коллекция клиента с эластично подготавливаемой пропускной способностью (от&1; до&10; млн запросов в секунду)**

![Эластичная подготовка пропускной способности в Azure DocumentDB](./media/documentdb-distribute-data-globally/documentdb-elastic-throughput.png)

### <a id="ThroughputAndConsistency"></a>Взаимосвязь пропускной способности и согласованности 
То же, что и [взаимосвязь согласованности и пропускной способности](#ConsistencyAndThroughput).

### <a id="ThroughputAndAvailability"></a>Взаимосвязь пропускной способности и доступности
Служба DocumentDB продолжает обеспечивать свою доступность при изменении пропускной способности. DocumentDB явным образом управляет секциями (например, выполняет операции разделения, объединения и клонирования) и гарантирует, что эти операции не снижают производительность или уровень доступности, пока приложение эластично увеличивает или уменьшает пропускную способность. 

## <a id="AvailabilityGuarantees"></a>Гарантии доступности
DocumentDB предлагает соглашение об уровне обслуживания, гарантирующее 99,99 % доступности, для каждой операции в плоскостях данных и управления. Как уже упоминалось, гарантии доступности DocumentDB включают в себя абсолютную верхнюю границу задержки для каждой операции в плоскостях данных и управления. Гарантии доступности постоянны и не меняются при изменении числа регионов или географического расстояния между ними. Гарантии доступности применяются как к ручной, так и к автоматической отработке отказа. DocumentDB предлагает прозрачные интерфейсы API множественной адресации, благодаря которым ваше приложение сможет работать с логическими конечными точками и явным образом перенаправлять запросы в новый регион в случае отработки отказа. Иначе говоря, приложение не потребуется развертывать повторно при региональной отработке отказа, чтобы соблюсти соглашения об уровне обслуживания, регулирующие доступность.

### <a id="AvailabilityAndConsistency"></a>Взаимосвязь доступности с согласованностью, задержкой и пропускной способностью
Взаимосвязь доступности с согласованностью, задержкой и пропускной способностью описывается в разделах [Взаимосвязь согласованности и доступности](#ConsistencyAndAvailability), [Взаимосвязь задержки и доступности](#LatencyAndAvailability) и [Взаимосвязь пропускной способности и доступности](#ThroughputAndAvailability). 

## <a id="GuaranteesAgainstDataLoss"></a>Гарантии и поведение системы при "потере данных"
В DocumentDB высокая доступной каждой секции (в коллекции) обеспечивается несколькими репликами, которые распределены по крайней мере между 10–20 доменами сбоя. Все операции записи синхронно и надежно фиксируются кворумом большинства реплик, прежде чем подтверждаются клиенту. Асинхронная репликация координируется между секциями, распределенными по нескольким регионам. DocumentDB гарантирует отсутствие потерь данных при запуске отработки отказа клиентом вручную. Во время автоматической отработки отказа согласно применяемому соглашению об уровне обслуживания DocumentDB гарантирует верхнюю границу настроенного интервала ограниченного устаревания для окна потери данных.

## <a id="CustomerFacingSLAMetrics"></a>Метрики соглашения об уровне обслуживания для клиентов
DocumentDB явным образом предоставляет метрики пропускной способности, задержек, согласованности и доступности. Эти метрики можно использовать программно или через портал Azure (см. следующий рисунок). Можно также настроить оповещения для различных пороговых значений с помощью Azure Application Insights.
 
**Метрики пропускной способности, задержек, согласованности и доступности явным образом доступны для каждого клиента**

![Видимые клиентам метрики Azure DocumentDB](./media/documentdb-distribute-data-globally/documentdb-customer-slas.png)

## <a id="Next Steps"></a>Дальнейшие действия
* Чтобы реализовать глобальную репликацию для учетной записи DocumentDB с помощью портала Azure, ознакомьтесь со статьей [Выполнение репликации глобальной базы данных DocumentDB с помощью портала Azure](documentdb-portal-global-replication.md).
* Чтобы знать, как можно реализовать архитектуры с несколькими базами данных master с помощью DocumentDB, ознакомьтесь с разделом [Архитектуры с несколькими базами данных master с использованием Azure DocumentDB](documentdb-multi-region-writers.md).
* Чтобы узнать больше о том, как автоматическая и ручная отработки отказа работают в DocumentDB, ознакомьтесь с разделом [Отработка отказа между регионами в Azure DocumentDB](documentdb-regional-failovers.md).

## <a id="References"></a>Справочные материалы
1. Eric Brewer. [Towards Robust Distributed Systems](https://people.eecs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf)
2. Eric Brewer. [CAP Twelve Years Later – How the rules have changed](http://informatik.unibas.ch/fileadmin/Lectures/HS2012/CS341/workshops/reportsAndSlides/PresentationKevinUrban.pdf)
3. Gilbert, Lynch. - [Brewer&#39;s Conjecture and Feasibility of Consistent, Available, Partition Tolerant Web Services](http://www.glassbeam.com/sites/all/themes/glassbeam/images/blog/10.1.1.67.6951.pdf)
4. Дэниэл Абади. [Consistency Tradeoffs in Modern Distributed Database Systems Design](http://cs-www.cs.yale.edu/homes/dna/papers/abadi-pacelc.pdf)
5. Martin Kleppmann. [Please stop calling databases CP or AP](https://martin.kleppmann.com/2015/05/11/please-stop-calling-databases-cp-or-ap.html)
6. Peter Bailis et al. [Probabilistic Bounded Staleness (PBS) for Practical Partial Quorums](http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf)
7. Naor and Wool. [Load, Capacity and Availability in Quorum Systems](http://www.cs.utexas.edu/~lorenzo/corsi/cs395t/04S/notes/naor98load.pdf)
8. Herlihy and Wing. [Lineralizability: A correctness condition for concurrent objects](http://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf)
9. Соглашение об уровне обслуживания Azure DocumentDB (последнее обновление — декабрь 2016 г.).
