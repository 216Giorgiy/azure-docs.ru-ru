<properties
	pageTitle="Учебник по Power BI для соединителя DocumentDB | Microsoft Azure"
	description="Используйте этот учебник по Power BI для импорта JSON, создания информативных отчетов и визуализация данных с помощью соединителя DocumentDB и Power BI."
	keywords="учебник по Power BI, визуализация данных, соединитель Power BI"
	services="documentdb"
	authors="h0n"
	manager="jhubbard"
	editor="mimig"
	documentationCenter=""/>

<tags
	ms.service="documentdb"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="09/22/2016"
	ms.author="hawong"/>

# Учебник по Power BI для DocumentDB: визуализация данных с помощью соединителя Power BI

[PowerBI.com](https://powerbi.microsoft.com/) — это веб-служба, с помощью которой можно создавать и совместно использовать панели мониторинга и отчеты с важными данными. Power BI Desktop — это специальное средство создания отчетов, позволяющее получать данные из различных источников, объединять и преобразовывать их, создавая подробные отчеты и визуализации, и публиковать их в Power BI. Последняя версия Power BI Desktop теперь позволяет подключаться к вашей учетной записи DocumentDB через соединитель DocumentDB для Power BI.

В этом учебнике по Power BI мы рассматриваем действия для подключения к учетной записи DocumentDB в Power BI Desktop, переходим к коллекции для извлечения данных с помощью навигатора, преобразуем данные JSON в табличный формат с помощью редактора запросов Power BI Desktop, а также создаем и публикуем отчет в PowerBI.com.

После изучения этого учебника по Power BI вы сможете ответить на следующие вопросы.

-	Как создавать отчеты с данными из DocumentDB с помощью Power BI Desktop?
-	Как подключиться к учетной записи DocumentDB в Power BI Desktop?
-	Как получить данные из коллекции в Power BI Desktop?
-	Как преобразовывать вложенные данные JSON в Power BI Desktop?
-	Как публиковать и совместно использовать отчеты в PowerBI.com?

## Предварительные требования

Перед выполнением инструкций в этом учебнике по Power BI убедитесь в наличии следующего:

- [Последняя версия Power BI Desktop](https://powerbi.microsoft.com/desktop).
- Доступ к нашей демонстрационной учетной записи или к данным в вашей учетной записи Azure DocumentDB.
	- В демонстрационной учетной записи используются данные о вулкане, показанные в этом руководстве. Использование этой демонстрационной учетной записи не регулируется соглашениями об уровне обслуживания. Она предназначена только для демонстрационных целей. Мы оставляем за собой право вносить изменения в эту демонстрационную учетную запись, включая, кроме прочего, закрытие учетной записи, изменение ключа, ограничение доступа, изменение и удаление данных в любое время без уведомления или указания причины.
		- URL-адрес: https://analytics.documents.azure.com
		- Ключ только для чтения: MSr6kt7Gn0YRQbjd6RbTnTt7VHc5ohaAFu7osF0HdyQmfR+YhwCH2D2jcczVIR1LNK3nMPNBD31losN7lQ/fkw==
	- Информацию о создании учетной записи см. в статье [Как создать учетную запись DocumentDB в базе данных NoSQL с помощью портала Azure](https://azure.microsoft.com/documentation/articles/documentdb-create-account/). Для получения примера данных о вулкане, схожих с теми, которые используются в этом учебнике (но не содержат блоки GeoJSON), посетите [сайт NOAA](https://www.ngdc.noaa.gov/nndc/struts/form?t=102557&s=5&d=5), а затем импортируйте данные с помощью [инструмента переноса данных DocumentDB](https://azure.microsoft.com/documentation/articles/documentdb-import-data/).


Для совместного использования отчетов в службе PowerBI.com необходимо настроить учетную запись в PowerBI.com. Дополнительные сведения о бесплатной версии Power BI и Power BI Pro см. на веб-сайте [https://powerbi.microsoft.com/pricing](https://powerbi.microsoft.com/pricing).

## Начало работы
Для работы с этим руководством представим, что вы геолог, изучающий вулканы по всему миру. Данные о вулканах хранятся в учетной записи DocumentDB, а документы JSON выглядят, как показано ниже.

	{
    	"Volcano Name": "Rainier",
   		"Country": "United States",
  		"Region": "US-Washington",
  		"Location": {
    		"type": "Point",
    		"coordinates": [
      		-121.758,
      		46.87
    		]
  		},
  		"Elevation": 4392,
  		"Type": "Stratovolcano",
  		"Status": "Dendrochronology",
  		"Last Known Eruption": "Last known eruption from 1800-1899, inclusive"
	}

Вам нужно получить данные о вулканах из учетной записи DocumentDB и представить их в виде интерактивного отчета Power BI, подобного приведенному ниже.

![После завершения этого учебника Power BI с соединителем Power BI вы сможете визуализировать данные в отчете о вулканах Power BI Desktop](./media/documentdb-powerbi-visualize/power_bi_connector_pbireportfinal.png)

Готовы попробовать? Давайте приступим.


1. Запустите на своей рабочей станции Power BI Desktop.
2. После запуска Power BI Desktop появится экран *приветствия*.

	![Экран приветствия в Power BI Desktop — соединитель Power BI](./media/documentdb-powerbi-visualize/power_bi_connector_welcome.png)

3. Можно **Получить данные**, просмотреть **Последние источники** или **Открыть другие отчеты** непосредственно с экрана *приветствия*. Щелкните значок X в правом верхнем углу, чтобы закрыть этот экран. Откроется представление **Отчет** средства Power BI Desktop.

	![Представление отчета в Power BI Desktop — соединитель Power BI](./media/documentdb-powerbi-visualize/power_bi_connector_pbireportview.png)

4. Откройте ленту **Главная** и нажмите кнопку **Получение данных**. Откроется окно **Получение данных**.

5. Выберите элемент **Azure**, затем — **Microsoft Azure DocumentDB (Beta)** и нажмите кнопку **Подключение**. Откроется окно **Подключение Microsoft Azure DocumentDB**.

	![Получение данных в Power BI Desktop — соединитель Power BI](./media/documentdb-powerbi-visualize/power_bi_connector_pbigetdata.png)

6. Укажите URL-адрес конечной точки учетной записи DocumentDB, из которой необходимо получить данные, как показано ниже, и нажмите кнопку **ОK**. Этот URL-адрес можно найти в поле универсального кода ресурса (URI) в колонке **[Ключи](documentdb-manage-account.md#keys)** на портале Azure. Можно также использовать демонстрационную учетную запись, для которой URL-адрес — `https://analytics.documents.azure.com`.

	Не указывайте имя базы данных, имя коллекции и инструкцию SQL, т. к. эти поля являются необязательными. Вместо этого мы будем использовать навигатор для выбора базы данных и коллекции для определения источника данных.

    ![Учебник по Power BI для соединителя Power BI DocumentDB — окно подключения рабочего стола](./media/documentdb-powerbi-visualize/power_bi_connector_pbiconnectwindow.png)

7. При подключении к этой конечной точке в первый раз отобразится запрос ключа учетной записи. Этот ключ можно найти в поле **Первичный ключ** в колонке **[Ключи только для чтения](documentdb-manage-account.md#keys)** на портале Azure. Можно также использовать демонстрационную учетную запись, для которой ключ — `RcEBrRI2xVnlWheejXncHId6QRcKdCGQSW6uSUEgroYBWVnujW3YWvgiG2ePZ0P0TppsrMgscoxsO7cf6mOpcA==`. Введите ключ учетной записи и нажмите кнопку **Подключение**.

	При создании отчетов мы рекомендуем использовать ключ только для чтения. Это позволит предотвратить потенциальные угрозы безопасности для главного ключа. Ключ только для чтения можно найти в колонке [Ключи](documentdb-manage-account.md#keys) на портале Azure. Можно также использовать сведения демонстрационной учетной записи, приведенные выше.

    ![Учебник по Power BI для соединителя Power BI DocumentDB — ключ учетной записи](./media/documentdb-powerbi-visualize/power_bi_connector_pbidocumentdbkey.png)

8. После подключения учетной записи откроется окно **Навигатор**. В **Навигаторе** отобразится список баз данных в учетной записи.
9. Выберите и разверните узел базы данных, которая будет источником данных для отчета. Если вы используете демонстрационную учетную запись, то выберите **volcanodb**.

10. Теперь выберите коллекцию, из которой необходимо извлечь данные. Если вы используете демонстрационную учетную запись, то выберите **volcano1**.

	В области «Предварительный просмотр» отображается список элементов **Запись**. Документ представлен как тип **Запись** в Power BI. Точно так же вложенный блок JSON в документе является **Записью**.

    ![Учебник по Power BI для соединителя Power BI DocumentDB — окно навигатора](./media/documentdb-powerbi-visualize/power_bi_connector_pbinavigator.png)

11. Нажмите кнопку **Изменить**, чтобы запустить редактор запросов для преобразования данных.

## Преобразование документов JSON в плоскую структуру и их трансформация
1. В центральной области редактора запросов Power BI отображается столбец **Документ**. ![Редактор запросов Power BI Desktop](./media/documentdb-powerbi-visualize/power_bi_connector_pbiqueryeditor.png)

2. В правой части заголовка столбца **Документ** щелкните кнопку развертывания. Отобразится контекстное меню со списком полей. Выберите поля, необходимые для вашего отчета, например «Имя вулкана», «Страна», «Регион», «Расположение», «Высота», «Тип», «Состояние» и «Последнее известное извержение», и нажмите кнопку **ОK**.

	![Учебник по Power BI для соединителя Power BI DocumentDB — раскрыть документы](./media/documentdb-powerbi-visualize/power_bi_connector_pbiqueryeditorexpander.png)

3. В центральной области отобразится предварительный просмотр результата для выбранных полей.

	![Учебник по Power BI для соединителя Power BI DocumentDB — сделать результаты более плоскими](./media/documentdb-powerbi-visualize/power_bi_connector_pbiresultflatten.png)

4. В нашем примере свойство «Расположение» является блоком GeoJSON в документе. Как видно, значение свойства «Расположение» представлено типом **Запись** в Power BI Desktop.
5. В правой части заголовка столбца «Расположение» нажмите кнопку развертывания. Отобразится контекстное меню с типом и координатами полей. Выберем поле «Координаты» и нажмем кнопку **ОK**.

    ![Учебник по Power BI для соединителя Power BI DocumentDB — запись о расположении](./media/documentdb-powerbi-visualize/power_bi_connector_pbilocationrecord.png)

6. Теперь в центральной области отображается столбец с координатами типа **Список**. Как показано в начале этого руководства, данные GeoJSON в руководстве принадлежат типу «Точка» со значениями широты и долготы, записанными в массив координат.

	Элемент coordinates[0] представляет долготу, а элемент coordinates[1] — широту. ![Учебник по Power BI для соединителя Power BI DocumentDB — список координат](./media/documentdb-powerbi-visualize/power_bi_connector_pbiresultflattenlist.png)

7. Чтобы преобразовать массив координат в плоскую структуру, мы создадим **настраиваемый столбец**, который называется LatLong. Выберите ленту **Добавить столбец** и выберите команду **Добавить настраиваемый столбец**. Откроется окно **Добавление настраиваемого столбца**.

8. Укажите имя нового столбца, например LatLong.

9. Затем укажите настраиваемую формулу для нового столбца. В нашем примере мы соединим значения широты и долготы, разделяя их запятыми, как показано ниже, используя следующую формулу: `Text.From([Document.Location.coordinates]{1})&","&Text.From([Document.Location.coordinates]{0})`. Нажмите кнопку **ОК**.

    Дополнительные сведения о выражениях анализа данных (DAX), включая функции DAX, см. в статье [Основные сведения о DAX в Power BI Desktop](https://support.powerbi.com/knowledgebase/articles/554619-dax-basics-in-power-bi-desktop).

    ![Учебник по Power BI для соединителя Power BI DocumentDB — добавление пользовательского столбца](./media/documentdb-powerbi-visualize/power_bi_connector_pbicustomlatlong.png)

10. Теперь в центральной области отобразится новый столбец LatLong, содержащий значения широты и долготы, разделенные запятой.

	![Учебник по Power BI для соединителя Power BI DocumentDB — пользовательский столбец LatLong](./media/documentdb-powerbi-visualize/power_bi_connector_pbicolumnlatlong.png)

    Если в новом столбце появляется сообщение об ошибке, убедитесь, что примененные шаги в разделе "Параметры запроса" соответствуют указанным на следующем рисунке:

    ![Примененные шаги должны быть такими: источник, навигация, развернут документ, развернуто расположение документа, добавлен настраиваемый элемент](./media/documentdb-powerbi-visualize/azure-documentdb-power-bi-applied-steps.png)

    Если ваши шаги отличаются, удалите лишние шаги и снова попробуйте добавить настраиваемый столбец.

11. Теперь мы завершили преобразование данных в табличный формат. Для преобразования данных в DocumentDB можно использовать все функции, доступные в редакторе запросов. Если вы используете пример, измените тип данных для столбца "Высота" на **Целое число**, изменив **Тип данных** в ленте **Главная**.

    ![Учебник по Power BI для соединителя Power BI DocumentDB — изменение типа столбца](./media/documentdb-powerbi-visualize/power_bi_connector_pbichangetype.png)

12. Чтобы сохранить модель данных, нажмите кнопку **Закрыть и применить**.

    ![Учебник по Power BI для соединителя Power BI DocumentDB — закрыть и применить](./media/documentdb-powerbi-visualize/power_bi_connector_pbicloseapply.png)

## Создание отчетов
Для создания отчетов, в которых наглядно представлены данные, используется представление отчета в Power BI Desktop. Отчеты можно создавать путем перетаскивания полей на поле **Отчет**.

![Представление отчета в Power BI Desktop — соединитель Power BI](./media/documentdb-powerbi-visualize/power_bi_connector_pbireportview2.png)

В представлении «Отчет» найдите следующие элементы.

 1. Область **Поля** — здесь отображается список моделей данных с полями, которые можно использовать для отчетов.

 2. Область **Визуализации**. Отчет может содержать одну или несколько визуализаций. В области **Визуализации** можно выбрать нужные типы визуальных элементов.

 3. Поле **Отчет** — здесь создаются визуальные элементы для отчета.

 4. Страница **Отчеты**. В Power BI Desktop можно добавить несколько страниц отчета.

Ниже приведены основные этапы создания простого интерактивного отчета с представлением карты.

1. В этом примере мы создадим представление карты, показывающей расположение каждого вулкана. В области **Визуализации** выберите тип визуального элемента "Карта", который выделен на снимке экрана выше. В области **Отчет** отобразится тип визуального элемента «Карта». В области **Визуализация** также должен отобразиться набор свойств, связанных с этим типом визуального элемента.

2. Теперь из области **Поля** перетащите поле LatLong в свойство **Расположение** в области **Визуализации**.
3. Затем перетащите поле «Имя вулкана» в свойство **Условные обозначения**.

4. Затем перетащите поле "Высота" в свойство **Размер**.

5. Теперь на карте должны отображаться кружки, указывающие расположение каждого вулкана (размер пузырька соответствует высоте вулкана).

6. Базовый отчет готов. Его можно настроить, добавив дополнительные визуальные элементы. В нашем случае мы добавили срез «Тип вулкана», чтобы сделать отчет интерактивным.

    ![Снимок экрана окончательного отчета Power BI Desktop после завершения работы с учебником Power BI для DocumentDB](./media/documentdb-powerbi-visualize/power_bi_connector_pbireportfinal.png)

## Публикация и совместное использование отчета
Для совместного использования отчета необходимо иметь учетную запись в службе PowerBI.com.

1. В средстве Power BI Desktop откройте ленту **Главная**.
2. Щелкните **Опубликовать**. Отобразится запрос имени пользователя и пароля для вашей учетной записи PowerBI.com.
3. После аутентификации учетных данных отчет публикуется в указанном вами расположении.
4. Для просмотра и совместного использования отчета на сайте PowerBI.com щелкните **Открыть PowerBITutorial.pbix в Power BI**.

    ![Публикация в Power BI успешно завершена! Открыть учебник в Power BI](./media/documentdb-powerbi-visualize/power_bi_connector_open_in_powerbi.png)

## Создание панели мониторинга на PowerBI.com

Теперь, когда у вас уже есть отчет, используйте его совместно с другими пользователями на сайте PowerBI.com.

При публикации отчета из Power BI Desktop на сайт PowerBI.com он создает **Отчет** и **Набор данных** в клиенте PowerBI.com. Например, после публикации на сайте PowerBI.com отчета **PowerBITutorial** его имя отобразится в разделах **Отчеты** и **Наборы данных** на PowerBI.com.

   ![Снимок экрана нового отчета и набора данных на PowerBI.com](./media/documentdb-powerbi-visualize/documentdb-powerbi-reports-datasets.png)

Чтобы создать панель мониторинга для совместного использования, нажмите в своем отчете на PowerBI.com кнопку **Закрепление живой плитки**.

   ![Снимок экрана нового отчета и набора данных на PowerBI.com](./media/documentdb-powerbi-visualize/azure-documentdb-power-bi-pin-live-tile.png)

Для создания новой панели мониторинга следуйте инструкциям в разделе [Закрепление плиток из отчета](https://powerbi.microsoft.com/documentation/powerbi-service-pin-a-tile-to-a-dashboard-from-a-report/#pin-a-tile-from-a-report).

Можно также внести в отчет ситуативные изменения, прежде чем создавать панель мониторинга. Однако для внесения изменений и повторной публикации отчета на PowerBI.com рекомендуется использовать Power BI Desktop.

## Обновление данных на сайте PowerBI.com

Существует два способа обновления данных — ситуативно и по расписанию.

Чтобы внести ситуативные обновления, просто нажмите кнопку с многоточием (...) напротив **набора данных**, например PowerBITutorial. Отобразится список доступных действий, включая **Обновить**. Чтобы обновить данные, выберите **Обновить**.

![Снимок экрана действия "Обновить" на PowerBI.com](./media/documentdb-powerbi-visualize/azure-documentdb-power-bi-refresh-now.png)

Для обновления по расписанию выполните следующие действия.

1. В списке действий выберите **Запланировать обновление**. ![Снимок экрана действия "Запланировать обновление" на PowerBI.com](./media/documentdb-powerbi-visualize/azure-documentdb-power-bi-schedule-refresh.png)

2. На странице **Параметры** разверните узел **Учетные данные источников данных**.

3. Щелкните **Изменить учетные данные**.

    Появится всплывающее окно настройки.

4. Введите ключ для подключения к учетной записи DocumentDB для этого набора данных, а затем нажмите кнопку **Вход**.

5. Разверните узел **Расписание обновлений** и настройте расписание для обновлений набора данных.
  
6. По завершении настройки расписания обновлений нажмите кнопку **Применить**.

## Дальнейшие действия
- Дополнительные сведения о Power BI см. в статье [Приступая к работе с Power BI](https://powerbi.microsoft.com/documentation/powerbi-service-get-started/).
- Дополнительные сведения о DocumentDB см. на целевой странице [Документация DocumentDB](https://azure.microsoft.com/documentation/services/documentdb/).

<!---HONumber=AcomDC_0928_2016-->