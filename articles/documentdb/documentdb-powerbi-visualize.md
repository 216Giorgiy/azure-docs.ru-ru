<properties 
	pageTitle="Руководство по визуализации данных DocumentDB и Power BI| Microsoft Azure" 
	description="Узнайте, как использовать Power BI Desktop для создания подробных отчетов с данными JSON из DocumentDB, полностью управляемой базы данных документов NoSQL." 
	services="documentdb" 
	authors="h0n" 
	manager="jhubbard" 
	editor="mimig" 
	documentationCenter=""/>

<tags 
	ms.service="documentdb" 
	ms.workload="data-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="10/22/2015" 
	ms.author="hawong"/>

# Визуализация данных DocumentDB с помощью Power BI
[PowerBI.com](https://powerbi.microsoft.com/) — это веб-служба, с помощью которой можно создавать и совместно использовать панели мониторинга и отчеты с важными данными. Power BI Desktop — это специальное средство создания отчетов, позволяющее получать данные из различных источников, объединять и преобразовывать их, создавая подробные отчеты и визуализации, и публиковать их в Power BI. Последняя версия Power BI Desktop теперь позволяет подключаться к вашей учетной записи DocumentDB через соединитель DocumentDB для Power BI.

В этом руководстве мы рассмотрим действия для подключения к учетной записи DocumentDB в Power BI Desktop, перейдем к коллекции для извлечения данных с помощью навигатора, преобразуем данные JSON в табличный формат с помощью редактора запросов Power BI Desktop, а также создадим и опубликуем отчет в PowerBI.com.

Ознакомившись с данной статьей, вы сможете ответить на следующие вопросы.

-	Как создавать отчеты с данными из DocumentDB с помощью Power BI Desktop? 
-	Как подключиться к учетной записи DocumentDB в Power BI Desktop?
-	Как получить данные из коллекции в Power BI Desktop?
-	Как преобразовывать вложенные данные JSON в Power BI Desktop?
-	Как публиковать и совместно использовать отчеты в PowerBI.com? 

## Предварительные требования

Перед выполнением инструкций, приведенных в этой статье, следует проверить наличие следующих компонентов.

- [Последняя версия Power BI Desktop](https://powerbi.microsoft.com/desktop).
- Доступ к нашей демонстрационной учетной записи или к данным в вашей учетной записи Azure DocumentDB. 
	- В демонстрационной учетной записи используются данные о вулкане, показанные в этом руководстве. Использование этой демонстрационной учетной записи не регулируется соглашениями об уровне обслуживания. Она предназначена только для демонстрационных целей. Мы оставляем за собой право вносить изменения в эту демонстрационную учетную запись, включая, кроме прочего, закрытие учетной записи, изменение ключа, ограничение доступа, изменение и удаление данных в любое время без уведомления или указания причины. 
		- URL-адрес: https://analytics.documents.azure.com
		- Ключ только для чтения: MSr6kt7Gn0YRQbjd6RbTnTt7VHc5ohaAFu7osF0HdyQmfR+YhwCH2D2jcczVIR1LNK3nMPNBD31losN7lQ/fkw==
	- Для создания учетной записи см. статью [Создание учетной записи базы данных DocumentDB на портале предварительной версии Azure](https://azure.microsoft.com/documentation/articles/documentdb-create-account/). Для получения образца данных о вулкане, схожих с теми, которые используются в этом руководстве (но не содержат блоки GeoJSON), см. [сайт центра NOAA](https://www.ngdc.noaa.gov/nndc/struts/form?t=102557&s=5&d=5), а затем импортируйте данные с помощью [средства переноса данных DocumentDB](https://azure.microsoft.com/documentation/articles/documentdb-import-data/).


Для совместного использования отчетов в службе PowerBI.com необходимо настроить учетную запись в PowerBI.com. Дополнительные сведения о бесплатной версии Power BI и Power BI Pro см. на веб-сайте [https://powerbi.microsoft.com/pricing](https://powerbi.microsoft.com/pricing).

## Начало работы
Для работы с этим руководством представим, что вы геолог, изучающий вулканы по всему миру. Данные о вулканах хранятся в учетной записи DocumentDB, а документы JSON выглядят, как показано ниже.

	{
    	"Volcano Name": "Rainier",
   		"Country": "United States",
  		"Region": "US-Washington",
  		"Location": {
    		"type": "Point",
    		"coordinates": [
      		-121.758,
      		46.87
    		]
  		},
  		"Elevation": 4392,
  		"Type": "Stratovolcano",
  		"Status": "Dendrochronology",
  		"Last Known Eruption": "Last known eruption from 1800-1899, inclusive"
	}	

Вам нужно получить данные о вулканах из учетной записи DocumentDB и создать интерактивный отчет Power BI, подобный приведенному ниже.

![Отчет о вулканах в Power BI Desktop](./media/documentdb-powerbi-visualize/pbireportfinal.png)

Готовы попробовать? Давайте приступим.

## Подключение к учетной записи DocumentDB

1. Запустите на своей рабочей станции Power BI Desktop.
2. После запуска Power BI Desktop появится экран *приветствия*.

	![Экран приветствия в Power BI Desktop](./media/documentdb-powerbi-visualize/welcomescreen.png)

3. Можно **Получить данные**, просмотреть **Последние источники** или **Открыть другие отчеты** непосредственно с экрана *приветствия*. Щелкните значок X в правом верхнем углу, чтобы закрыть этот экран. Откроется представление **Отчет** средства Power BI Desktop.

	![Представление отчета в Power BI Desktop](./media/documentdb-powerbi-visualize/pbireportview.png)

4. Откройте ленту **Главная** и нажмите кнопку **Получение данных**. Откроется окно **Получение данных**.

5. Выберите элемент **Azure**, затем — **Microsoft Azure DocumentDB (Beta)** и нажмите кнопку **Подключение**. Откроется окно **Подключение Microsoft Azure DocumentDB**.

	![Получение данных в Power BI Desktop](./media/documentdb-powerbi-visualize/pbigetdata.png)

6. Укажите URL-адрес конечной точки учетной записи DocumentDB, из которой необходимо получить данные, как показано ниже, и нажмите кнопку **ОK**. URL-адрес можно найти в поле URI в колонке **Ключи** на портале предварительной версии Azure. Можно также использовать сведения демонстрационной учетной записи, приведенные выше. Дополнительные сведения см. в статье [Ключи](documentdb-manage-account.md#keys).


	*Примечание. В этом руководстве мы не будем указывать имя базы данных, имя коллекции и инструкцию SQL, т. к. эти поля являются необязательными. Вместо этого мы будем использовать навигатор для выбора базы данных и коллекции для определения источника данных.*

    ![Окно подключения Power BI Desktop](./media/documentdb-powerbi-visualize/pbiconnectwindow.png)

7. При подключении к этой конечной точке в первый раз отобразится запрос ключа учетной записи. Введите ключ учетной записи и нажмите кнопку **Подключение**.
	
	*Примечание. При создании отчетов мы рекомендуем использовать ключ только для чтения. Это позволит предотвратить потенциальные угрозы безопасности для главного ключа. Ключ только для чтения можно найти в колонке «Ключи только для чтения» на портале предварительной версии Azure. Можно также использовать сведения демонстрационной учетной записи, приведенные выше.*

    ![Ключ учетной записи Power BI Desktop](./media/documentdb-powerbi-visualize/pbidocumentdbkey.png)

8. После подключения учетной записи откроется окно **Навигатор**. В **Навигаторе** отобразится список баз данных в учетной записи.
9. Выберите и разверните узел базы данных, которая будет источником данных для отчета. Отобразится список коллекций в базе данных.  

10. Теперь выберите коллекцию, из которой необходимо извлечь данные, например volcano1.

	*Примечание. В области «Предварительный просмотр» отображается список элементов **Запись**. Документ представлен как тип **Запись** в Power BI. Точно так же вложенный блок JSON в документе является **Записью**.*

    ![Навигатор Power BI Desktop](./media/documentdb-powerbi-visualize/pbinavigator.png)

11. Нажмите кнопку **Изменить**, чтобы запустить редактор запросов для преобразования данных.

## Преобразование документов JSON в плоскую структуру и их трансформация
1. В центральной области редактора запросов Power BI отображается столбец **Документ**. ![Редактор запросов Power BI Desktop](./media/documentdb-powerbi-visualize/pbiqueryeditor.png)

2. В правой части заголовка столбца **Документ** щелкните кнопку развертывания. Отобразится контекстное меню со списком полей. Выберите поля, необходимые для вашего отчета, например «Имя вулкана», «Страна», «Регион», «Расположение», «Высота», «Тип», «Состояние» и «Последнее известное извержение», и нажмите кнопку **ОK**.
    
	![Развертывание документов в Power BI Desktop](./media/documentdb-powerbi-visualize/pbiqueryeditorexpander.png)

3. В центральной области отобразится предварительный просмотр результата для выбранных полей.

	![Преобразование результата в плоскую структуру в Power BI Desktop](./media/documentdb-powerbi-visualize/pbiresultflatten.png)

4. В нашем примере свойство «Расположение» является блоком GeoJSON в документе. Как видно, значение свойства «Расположение» представлено типом **Запись** в Power BI Desktop.
5. В правой части заголовка столбца «Расположение» нажмите кнопку развертывания. Отобразится контекстное меню с типом и координатами полей. Выберем поле «Координаты» и нажмем кнопку **ОK**.

    ![Запись о расположении в Power BI Desktop](./media/documentdb-powerbi-visualize/pbilocationrecord.png)

6. Теперь в центральной области отображается столбец с координатами типа **Список**. Как показано в начале этого руководства, данные GeoJSON в руководстве принадлежат типу «Точка» со значениями широты и долготы, записанными в массив координат.

	*Примечание. Элемент «координаты[0]» представляет долготу, а элемент «координаты[1]» — широту.* ![Список координат Power BI Desktop](./media/documentdb-powerbi-visualize/pbiresultflattenlist.png)

7. Чтобы преобразовать массив координат в плоскую структуру, мы создадим **настраиваемый столбец**, который называется LatLong. Выберите ленту **Добавить столбец** и выберите команду **Добавить настраиваемый столбец**. Откроется окно **Добавление настраиваемого столбца**.

8. Укажите имя нового столбца, например LatLong.

9. Затем укажите настраиваемую формулу для нового столбца. В нашем примере мы соединим значения широты и долготы, разделяя их запятыми, как показано ниже, используя следующую формулу: Text.From([coordinates]{1})&","&Text.From([coordinates]{0}). Нажмите кнопку **ОК**.
	
    *Примечание. Дополнительные сведения о выражениях анализа данных (DAX), включая функции DAX, см. в статье [DAX Basic в Power BI Desktop](https://support.powerbi.com/knowledgebase/articles/554619-dax-basics-in-power-bi-desktop).*

    ![Пользовательский столбец в Power BI Desktop](./media/documentdb-powerbi-visualize/pbicustomlatlong.png)

10. Теперь в центральной области отобразится новый столбец LatLong, содержащий значения широты и долготы, разделенные запятой.

	![Пользовательский столбец LatLong в Power BI Desktop](./media/documentdb-powerbi-visualize/pbicolumnlatlong.png)

11. Теперь мы завершили преобразование данных в табличный формат. Для преобразования данных в DocumentDB можно использовать все функции, доступные в редакторе запросов. Например, можно изменить тип данных для столбца «Высота» на **Десятичное число**, изменив **Тип данных** в ленте **Главная**.

    ![Изменение типа в Power BI Desktop](./media/documentdb-powerbi-visualize/pbichangetype.png)

12. Чтобы сохранить модель данных, нажмите кнопку **Закрыть и применить**.
    
    ![Закрыть и применить в Power BI Desktop](./media/documentdb-powerbi-visualize/pbicloseapply.png)

## Создание отчетов
Для создания отчетов используется представление «Отчет» в средстве Power BI Desktop. Отчеты можно создавать путем перетаскивания полей на поле **Отчет**.

![Представление отчета в Power BI Desktop](./media/documentdb-powerbi-visualize/pbireportview2.png)
 
В представлении «Отчет» найдите следующие элементы.

 1. Область **Поля** — здесь отображается список моделей данных с полями, которые можно использовать для отчетов.

 2. Область **Визуализации**. Отчет может содержать одну или несколько визуализаций. В области **Визуализации** можно выбрать нужные типы визуальных элементов.

 3. Поле **Отчет** — здесь создаются визуальные элементы для отчета.

 4. Страница **Отчеты**. В Power BI Desktop можно добавить несколько страниц отчета.

Ниже приведены основные этапы создания простого интерактивного отчета с представлением карты.

1. В этом примере мы создадим представление карты, показывающей расположение каждого вулкана. В области **Визуализации** выберите тип визуального элемента «Карта», который выделен на снимке экрана выше. В области **Отчет** отобразится тип визуального элемента «Карта». В области **Визуализация** также должен отобразиться набор свойств, связанных с этим типом визуального элемента.

2. Теперь из области **Поля** перетащите поле LatLong в свойство **Расположение** в области **Визуализации**.
3. Затем перетащите поле «Имя вулкана» в свойство **Условные обозначения**.  

4. Затем перетащите поле «Высота» в свойство **Значения**.

5. Теперь на карте должны отображаться кружки, указывающие расположение каждого вулкана (размер пузырька соответствует высоте вулкана).

6. Базовый отчет готов. Его можно настроить, добавив дополнительные визуальные элементы. В нашем случае мы добавили срез «Тип вулкана», чтобы сделать отчет интерактивным.

    ![Окончательный отчет в Power BI Desktop](./media/documentdb-powerbi-visualize/pbireportfinal.png)

## Публикация и совместное использование отчета
Для совместного использования отчета необходимо иметь учетную запись в службе PowerBI.com.

1. В средстве Power BI Desktop откройте ленту **Главная**.
2. Щелкните **Опубликовать**. Отобразится запрос имени пользователя и пароля для вашей учетной записи PowerBI.com.
3. После проверки подлинности учетных данных отчет будет опубликован в вашей учетной записи PowerBI.com.
4. После этого им можно поделиться в PowerBI.com.

## Дальнейшие действия
- Дополнительные сведения о Power BI см. [здесь](https://support.powerbi.com/knowledgebase).
- Для получения дополнительных сведений о DocumentDB щелкните [здесь](https://azure.microsoft.com/documentation/services/documentdb/).

<!---HONumber=Oct15_HO4-->