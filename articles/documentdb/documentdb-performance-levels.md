---
title: "Уровни производительности в DocumentDB | Документация Майкрософт"
description: "Узнайте, каким образом с помощью уровней производительности в DocumentDB можно резервировать пропускную способность для каждой коллекции."
services: documentdb
author: mimig1
manager: jhubbard
editor: monicar
documentationcenter: 
ms.assetid: 7dc21c71-47e2-4e06-aa21-e84af52866f4
ms.service: documentdb
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 11/11/2016
ms.author: mimig
translationtype: Human Translation
ms.sourcegitcommit: c2bdd3adc9f22005dbaca971472bdc65fead1a76
ms.openlocfilehash: a6e415f6b8f2203209c1cfe3de37193fe18ce2b4


---
# <a name="performance-levels-and-pricing-tiers-in-documentdb"></a>Уровни производительности и ценовые категории в DocumentDB
В этой статье приведены общие сведения об уровнях производительности в [Microsoft Azure DocumentDB](https://azure.microsoft.com/services/documentdb/).

Ознакомившись с данной статьей, вы сможете ответить на следующие вопросы.  

* Что такое уровень производительности?
* Каким образом выполняется резервирование пропускной способности для учетной записи базы данных?
* Как работать с уровнями производительности?
* Как осуществляется выставление счетов по уровням производительности?

## <a name="introduction-to-performance-levels"></a>Введение в уровни производительности
Каждая коллекция DocumentDB, созданная в стандартной учетной записи DocumentDB, подготавливается к работе со связанным уровнем производительности. Каждая коллекция в базе данных может иметь разный уровень производительности, что позволяет выделять больший объем пропускной способности часто используемым коллекциям и меньший — редко используемым. 

DocumentDB поддерживает как уровни производительности по **определяемым пользователем** показателям, так и уровни производительности по **заранее определенным** показателям (как показано в приведенной ниже таблице).  Производительность по определенным пользователем показателям позволяет зарезервировать пропускную способность в размере 100 единиц запросов в секунду и иметь неограниченный объем хранилища, в то время как три уровня производительности по заранее определенным показателям имеют заданную пропускную способность и квоту хранилища в размере 10 ГБ. В приведенной ниже таблице производительность **по определенным пользователем показателям** сравнивается с производительностью **по заранее определенным показателям**.

|Тип производительности|Сведения|Пропускная способность|Хранилище|Версия|Интерфейсы API|
|----------------|-------|----------|-------|-------|----|
|Производительность по определенным пользователем показателям|Пользователь задает пропускную способность в 100 ЕЗ/с|Без ограничений. <br><br>400–250 000 единиц запроса в секунду по умолчанию (выше — по запросу)|Без ограничений. <br><br>250 ГБ по умолчанию (выше по — запросу)|V2|API 2015-12-16 и более поздней версии|
|Производительность по заранее определенным показателям|10 ГБ зарезервированного хранилища.<br><br>S1 = 250 ЕЗ/с<br>S2 = 1000 ЕЗ/с<br>S3 = 2500 ЕЗ/с|2500 RU/с|10 ГБ|V1|Любой|

Пропускная способность резервируется отдельно для каждой коллекции и может использоваться исключительно этой коллекцией. Пропускная способность измеряется в [единицах запросов в секунду (ЕЗ/с)](documentdb-request-units.md). Этот показатель определяет объем ресурсов, необходимый для выполнения различных операций базы данных DocumentDB.

> [!NOTE]
> Уровень производительности коллекции можно изменить с помощью [пакетов SDK](documentdb-sdk-dotnet.md) или [портала Azure](https://portal.azure.com/). Изменение уровня производительности должно занимать не более трех минут.
> 
> 

## <a name="setting-performance-levels-for-collections"></a>Установка уровней производительности для коллекций
После создания коллекции для нее резервируется полное выделение единиц RU в зависимости от назначенного уровня производительности.

Обратите внимание, что как для уровней производительности по определенным пользователем показателям, так и для уровней производительности по заранее определенным показателям DocumentDB работает на основе резервирования пропускной способности. При создании коллекции приложение имеет зарезервированные ресурсы, и для него выставляется счет на зарезервированную пропускную способность и объем хранилища базы данных независимо от фактических показателей использования. При использовании уровней производительности по определенным пользователем показателям хранилище измеряется на основе потребления, но при использовании уровней производительности по заранее определенным показателям резервируется 10 ГБ хранилища во время создания коллекции.  

После создания коллекций можно изменить уровень производительности и (или) пропускную способность с помощью [пакетов SDK](documentdb-sdk-dotnet.md) или [портала Azure](https://portal.azure.com/).

> [!IMPORTANT]
> Счета для стандартных коллекций DocumentDB выставляются по почасовому тарифу. Для каждой создаваемой коллекции будет выставляться счет минимум за час использования.
> 
> 

Если в течение часа происходило изменение уровня производительности коллекции, будет выставлен счет по самому высокому уровню производительности, задаваемому в течение часа. Например, если вы повышаете уровень производительности для коллекции в 8:53, вы будете оплачивать новый уровень с 8:00. Аналогично, если вы снижаете уровень производительности в 8:53, новый тариф начнет действовать с 9:00.

Единицы запросов зарезервированы для каждой коллекции на основе заданного уровня производительности. Использование единиц запросов вычисляется с учетом значений в секунду. К приложениям, которые превышают подготовленный показатель единиц запросов(или уровень производительности) в коллекции, будет применяться функция регулирования до тех пор, пока значение не станет меньше уровня, зарезервированного для этой коллекции. Если приложению требуется более высокий уровень пропускной способности, можно увеличить уровень производительности для каждой коллекции.

> [!NOTE]
> Если приложение превышает уровни производительности для одной или нескольких коллекций, будет выполнено регулирование запросов для каждой коллекции. Это значит, что некоторые запросы приложения могут выполняться успешно, а к другим может быть применено регулирование. Рекомендуется добавить небольшое количество повторных попыток на случай регулирования, чтобы обрабатывать пиковые нагрузки трафика запросов.
> 
> 

## <a name="working-with-performance-levels"></a>Работа с уровнями производительности
Коллекции DocumentDB позволяют группировать данные на основе шаблонов запросов и с учетом требований производительности приложения. Благодаря автоматическому индексированию и поддержке запросов в DocumentDB совместное размещение разнородных документов в рамках одной коллекции является достаточно распространенной ситуацией. Принимая решение о необходимости использования отдельных коллекций для данных, необходимо обратить внимание на следующие моменты.

* Запросы — коллекция является областью для выполнения запроса. Если необходимо выполнить запрос в наборе документов, можно обратиться к самым эффективным шаблонам чтения, которые связаны с совместным размещением документов в одной коллекции.
* Транзакции — все транзакции относятся к одной коллекции. Если у вас есть документы, которые должны обновляться в рамках одной хранимой процедуры или триггера, они должны храниться в одной коллекции. Точнее говоря, ключ секции в коллекции является границей транзакции. Дополнительные сведения см. в статье [Секционирование и масштабирование в Azure DocumentDB](documentdb-partition-data.md).
* Изоляция производительности — коллекция имеет связанный уровень производительности. Это гарантирует прогнозируемую производительность каждой коллекции в виде зарезервированных единиц RU. В зависимости от частоты доступа можно распределить данные по различным коллекциям, имеющим разные уровни производительности.

> [!IMPORTANT]
> Важно понимать, что счета будут выставляться по полным стандартным тарифам на основе количества коллекций, созданных вашим приложением.
> 
> 

Если приложению не требуются большое хранилище или пропускная способность, рекомендуется использовать небольшое количество коллекций. Убедитесь также, что вы хорошо понимаете шаблоны приложения для создания новой коллекции. Можно зарезервировать создание коллекции как действие управления, обрабатываемое вне приложения. Аналогично, изменение уровня производительности для коллекции приведет к изменению почасового тарифа, по которому выставляются счета для коллекции. Если приложение регулирует уровни производительности динамически, необходимо вести наблюдение за производительностью коллекции.

## <a name="a-idchanging-performance-levels-using-the-azure-portalachange-from-s1-s2-s3-to-user-defined-performance"></a><a id="changing-performance-levels-using-the-azure-portal"></a>Переход с уровней производительности S1, S2 и S3 на уровень производительности, определенный пользователем
Выполните следующие действия, чтобы на портале Azure изменить стандартные уровни пропускной способности на пользовательские. Благодаря пользовательским уровням пропускной способности ее можно адаптировать в соответствии с вашими потребностями. Если вы используете учетную запись S1, вы можете быстро увеличить пропускную способность с 250 единиц запросов в секунду до 400 единиц запросов в секунду. Обратите внимание, что в случае перевода коллекции с уровня S1, S2 или S3 на стандартный (определяемый пользователем) уровень вы не сможете вернуться на уровень S1, S2 или S3. Однако, у вас будет возможность в любое время изменить пропускную способность стандартной коллекции.

Дополнительные сведения об изменениях в ценах, связанных с пользовательской и стандартной пропускной способностью, см. в записи блога [DocumentDB: Everything you need to know about using the new pricing options](https://azure.microsoft.com/blog/documentdb-use-the-new-pricing-options-on-your-existing-collections/) (DocumentDB: необходимая информация для использования новых вариантов ценообразования).

> [!ВИДЕО https://channel9.msdn.com/Blogs/AzureDocumentDB/ChangeDocumentDBCollectionPerformance/player]
> 
> 

1. На [**портале Azure**](https://portal.azure.com) щелкните **NoSQL (DocumentDB)**, затем выберите учетную запись DocumentDB для изменения. 
 
    Если на навигационной панели нет пункта **NoSQL (DocumentDB)**, то щелкните значок >, прокрутите до пункта **Базы данных**, выберите **NoSQL (DocumentDB)**, а затем выберите учетную запись DocumentDB.  

2. В меню ресурсов в разделе **Коллекции** щелкните **Масштаб**, в раскрывающемся списке выберите коллекцию для изменения и щелкните **Ценовая категория**. Учетные записи со стандартной пропускной способностью имеют ценовую категорию S1, S2 или S3.  В колонке **Выбор ценовой категории** щелкните **Стандартная**, чтобы изменить определяемую пользователем пропускную способность, а затем нажмите кнопку **Выбрать**, чтобы сохранить изменения.

    ![Снимок экрана колонки "Параметры", на котором показано, где можно изменить значение пропускной способности](./media/documentdb-performance-levels/documentdb-change-performance-set-thoughput.png)

3. В колонке **Масштаб** значение **Ценовая категория** меняется на **Стандартная** и появляется поле **Пропускная способность (единицы запросов в секунду)** со значением 400 (единиц запросов в секунду) по умолчанию. Задайте пропускную способность от 400 до 10 000 [единиц запросов](documentdb-request-units.md)в секунду. **Estimated Monthly Bill** (Предварительный месячный счет) в нижней части страницы автоматически обновляется, показывая оценку ежемесячных расходов. Нажмите кнопку **Сохранить**, чтобы сохранить изменения.

    Если в ходе работы выяснится, что требуется более высокая пропускная способность (больше 10 000 единиц запроса в секунду) или больший объем хранилища (больше 10 ГБ), то вы можете создать секционированную коллекцию. Сведения о создании секционированной коллекции см. в статье [Создание коллекции DocumentDB на портале Azure](documentdb-create-collection.md).

> [!NOTE]
> Изменение уровней производительности коллекции может занять до 2 минут.
> 
> 

## <a name="changing-performance-levels-using-the-net-sdk"></a>Изменение уровней производительности с помощью пакета .NET SDK
Другой вариант изменения уровней производительности вашей коллекции — с помощью наших пакетов SDK. В этом разделе описывается только процесс изменения уровня производительности коллекции с помощью нашего [пакета SDK для .NET](https://msdn.microsoft.com/library/azure/dn948556.aspx), но он аналогичен и для других [пакетов SDK](https://msdn.microsoft.com/library/azure/dn781482.aspx). Если вы не знакомы с пакетом .NET SDK, ознакомьтесь с [учебником по началу работы](documentdb-get-started.md).

Ниже приведен фрагмент кода для изменения предлагаемой пропускной способности до 50 000 единиц запроса в секунду.

    //Fetch the resource to be updated
    Offer offer = client.CreateOfferQuery()
                      .Where(r => r.ResourceLink == collection.SelfLink)    
                      .AsEnumerable()
                      .SingleOrDefault();

    // Set the throughput to 5000 request units per second
    offer = new OfferV2(offer, 5000);

    //Now persist these changes to the database by replacing the original resource
    await client.ReplaceOfferAsync(offer);

    // Set the throughput to S2
    offer = new Offer(offer);
    offer.OfferType = "S2";

    //Now persist these changes to the database by replacing the original resource
    await client.ReplaceOfferAsync(offer);



> [!NOTE]
> Коллекции, подготовленные с уровнем ниже 10 000 единиц запроса в секунду, можно переносить между предложениями с определяемой пользователем пропускной способностью и предварительно определенной пропускной способностью (S1, S2, S3) в любое время. Коллекции, подготовленные с уровнем выше 10 000 единиц запроса в секунду, невозможно преобразовать в предварительно определенные уровни пропускной способности.
> 
> 

Посетите [MSDN](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.aspx) , чтобы просмотреть дополнительные примеры и узнать больше о методах нашего предложения:

* [**ReadOfferAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.readofferasync.aspx)
* [**ReadOffersFeedAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.readoffersfeedasync.aspx)
* [**ReplaceOfferAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.replaceofferasync.aspx)
* [**CreateOfferQuery**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.linq.documentqueryable.createofferquery.aspx)

## <a name="a-idchange-throughputachanging-the-throughput-of-a-collection"></a><a id="change-throughput"></a>Изменение пропускной способности коллекции
Если вы уже используете производительность по определенным пользователем показателям, то можете изменить пропускную способность коллекции, выполнив следующие действия. Для перехода с уровня производительности S1, S2 или S3 (по заранее определенным показателям) на тип производительности по определяемым пользователем показателям см. раздел [Переход с уровней производительности S1, S2 и S3 на уровень производительности, определенный пользователем](#changing-performance-levels-using-the-azure-portal).

1. На [**портале Azure**](https://portal.azure.com) щелкните **NoSQL (DocumentDB)**, затем выберите учетную запись DocumentDB для изменения.    
2. В меню ресурсов в разделе **Коллекции** щелкните **Масштаб** и в раскрывающемся списке выберите коллекцию для изменения.
3. В поле **Пропускная способность (единицы запросов в секунду)** введите новое значение пропускной способности. 
   
    **Estimated Monthly Bill** (Предварительный месячный счет) в нижней части страницы автоматически обновляется, показывая оценку ежемесячных расходов. Нажмите кнопку **Сохранить**, чтобы сохранить изменения.

    Если вы не знаете точно, на сколько увеличивать пропускную способности, то см. раздел [Оценка требований к пропускной способности](documentdb-request-units.md#estimating-throughput-needs) и страницу [калькулятора единиц запросов](https://www.documentdb.com/capacityplanner).

## <a name="troubleshooting"></a>Устранение неполадок

Если возможность перехода между уровнями производительности S1, S2 и S3 не отображается в колонке **Выбор ценовой категории**, то щелкните **Просмотреть все**. Отобразятся уровни "Стандартный", S1, S2 и S3. Если вы используете ценовую категорию "Стандартная", то вы не можете переходить на уровни S1, S2 и S3.

![Снимок экрана колонки "Выбор ценовой категории" с выделенным параметром "Просмотреть все"](./media/documentdb-performance-levels/azure-documentdb-database-view-all-performance-levels.png)

После перевода коллекции с уровня S1, S2 или S3 на уровень "Стандартный" вы уже не сможете вернуться обратно на уровень S1, S2 или S3.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о ценах и управление данными с помощью Azure DocumentDB см. в следующих статьях.

* [Цены на DocumentDB](https://azure.microsoft.com/pricing/details/documentdb/)
* [Управление емкостью DocumentDB](documentdb-manage.md)
* [Моделирование данных в DocumentDB](documentdb-modeling-data.md)
* [Секционирование данных в DocumentDB](documentdb-partition-data.md)
* [Единиц запросов](http://go.microsoft.com/fwlink/?LinkId=735027)

Дополнительные сведения о DocumentDB можно найти в [документации](https://azure.microsoft.com/documentation/services/documentdb/)по Azure DocumentDB.

Инструкции по тестированию масштабирования и производительности с помощью Azure DocumentDB см. в [этой статье](documentdb-performance-testing.md).

[1]: ./media/documentdb-performance-levels/documentdb-change-collection-performance7-9.png
[2]: ./media/documentdb-performance-levels/documentdb-change-collection-performance10-11.png



<!--HONumber=Nov16_HO3-->


