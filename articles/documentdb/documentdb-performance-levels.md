<properties 
	pageTitle="Уровни производительности в DocumentDB | Microsoft Azure" 
	description="Узнайте, каким образом с помощью уровней производительности в DocumentDB можно резервировать пропускную способность для каждой коллекции." 
	services="documentdb" 
	authors="johnfmacintyre" 
	manager="jhubbard" 
	editor="monicar" 
	documentationCenter=""/>

<tags 
	ms.service="documentdb" 
	ms.workload="data-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/29/2016" 
	ms.author="johnmac"/>

#Уровни производительности в DocumentDB

В этой статье приведены общие сведения об уровнях производительности в [Microsoft Azure DocumentDB](https://azure.microsoft.com/services/documentdb/).

Ознакомившись с данной статьей, вы сможете ответить на следующие вопросы.

-	Что такое уровень производительности?
-	Каким образом выполняется резервирование пропускной способности для учетной записи базы данных?
-	Как работать с уровнями производительности?
-	Как осуществляется выставление счетов по уровням производительности?

##Введение в уровни производительности

Каждая коллекция DocumentDB созданная под стандартной учетной записью, подготавливается к работе со связанным уровнем производительности. Уровни производительности определяются как S1, S2 или S3, начиная с самого низкого и до самого высокого показателя производительности. Уровень производительности коллекции определяет объем ресурсов для обработки запросов, зарезервированный для вашего приложения. Каждая коллекция в базе данных может иметь разный уровень производительности, что позволяет выделять больший объем пропускной способности часто используемым коллекциям и меньший — редко используемым. Минимальный уровень производительности для любой коллекции — S1.

Каждый уровень производительности имеет ограничение связанного показателя единицы запроса(RU). Это значение пропускной способности, которое будет зарезервировано для коллекции на основе ее уровня производительности и доступно для использования исключительно этой коллекцией. Коллекции можно создать на [портале Microsoft Azure](https://portal.azure.com) или с помощью любого [пакета SDK службы DocumentDB](https://msdn.microsoft.com/library/azure/dn781482.aspx). API-интерфейсы DocumentDB позволяют задавать уровень производительности коллекции.

Уровень производительности коллекции|Зарезервированные пропускной способности
---|---
S1|250 RU/с
S2|1000 RU/с
S3|2500 RU/с

DocumentDB предлагает широкий набор операций в базе данных, включая запросы, запросы с определяемыми пользователем функциями, хранимыми процедурами и триггерами. Затраты на обработку, связанные с каждой из этих операций, зависят от типа процессора, операций ввода-вывода и объема памяти для выполнения операции. Вместо того чтобы думать об управлении аппаратными ресурсами, можно переключить внимание на единицу запроса (RU) как единую меру для ресурсов, необходимых для выполнения различных операций с базами данных и обслуживания запросов приложения.

> [AZURE.NOTE] Уровни производительности измеряются в единицах запроса. Каждый уровень производительности имеет связанный показатель максимального числа единиц запроса в секунду. Уровень производительности коллекции можно изменить с помощью API-интерфейсов или [портала Microsoft Azure](https://portal.azure.com/). Изменение уровня производительности должно занимать не более трех минут.

##Установка уровней производительности для коллекций
После создания коллекции для нее резервируется полное выделение единиц RU в зависимости от назначенного уровня производительности. Например, если коллекции назначен уровень S3, она может обрабатывать 2500 RU в секунду. Каждая коллекция резервирует выделенную ей пропускную способность и 10 ГБ хранилища базы данных. Цена коллекции зависит от выбранного уровня производительности (S1, S2, S3). Обратите внимание, что DocumentDB работает на основе резервирования емкости. При создании коллекции приложение имеет зарезервированные ресурсы и для него выставляется счет на зарезервированную пропускную способность и объем хранилища базы данных независимо от фактических показателей использования.

После создания коллекций можно изменить уровень производительности с помощью пакетов SDK DocumentDB или на классическом портале Azure.

> [AZURE.IMPORTANT] Счета для стандартных коллекций DocumentDB выставляются по почасовому тарифу. Для каждой создаваемой коллекции будет выставляться счет минимум за час использования.

Если в течение часа происходило изменение уровня производительности коллекции, будет выставлен счет по самому высокому уровню производительности, задаваемому в течение часа. Например, если вы повышаете уровень производительности для коллекции в 8:53, вы будете оплачивать новый уровень с 8:00. Аналогично, если вы снижаете уровень производительности в 8:53, новый тариф начнет действовать с 9:00.

Единицы запросов зарезервированы для каждой коллекции на основе заданного уровня производительности. Использование единиц запросов вычисляется с учетом значений в секунду. К приложениям, которые превышают подготовленный показатель единиц запросов(или уровень производительности) в коллекции, будет применяться функция регулирования до тех пор, пока значение не станет меньше уровня, зарезервированного для этой коллекции. Если приложению требуется более высокий уровень пропускной способности, можно увеличить уровень производительности для каждой коллекции.

> [AZURE.NOTE] Если приложение превышает уровни производительности для одной или нескольких коллекций, будет выполнено регулирование запросов для каждой коллекции. Это значит, что некоторые запросы приложения могут выполняться успешно, а к другим может быть применено регулирование.

##Работа с уровнями производительности
Коллекции DocumentDB позволяют секционировать данные на основе шаблонов запросов и с учетом требований производительности приложения. Дополнительные сведения о секционировании данных с помощью DocumentDB можно найти в [документации по секционированию данных](documentdb-partition-data.md). Благодаря автоматическому индексированию и поддержке запросов в DocumentDB совместное размещение разнородных документов в рамках одной коллекции является достаточно распространенной ситуацией. Принимая решение о необходимости использования отдельных коллекций для данных, необходимо обратить внимание на следующие моменты.

- Запросы — коллекция является областью для выполнения запроса. Если необходимо выполнить запрос в наборе документов, можно обратиться к самым эффективным шаблонам чтения, которые связаны с совместным размещением документов в одной коллекции.
- Транзакции — коллекция является областью транзакций для хранимых процедур и триггеров. Все транзакции относятся к одной коллекции. 
- Производительность — коллекция имеет связанный уровень производительности. Это гарантирует прогнозируемую производительность каждой коллекции в виде зарезервированных единиц RU. В зависимости от частоты доступа можно распределить данные по различным коллекциям, имеющим разные уровни производительности.

> [AZURE.IMPORTANT] Важно понимать, что счета будут выставляться по полным стандартным тарифам на основе количества коллекций, созданных вашим приложением.

Если приложению не требуются большое хранилище или пропускная способность, рекомендуется использовать небольшое количество коллекций. Убедитесь также, что вы хорошо понимаете шаблоны приложения для создания новой коллекции. Можно зарезервировать создание коллекции как действие управления, обрабатываемое вне приложения. Аналогично, изменение уровня производительности для коллекции приведет к изменению почасового тарифа, по которому выставляются счета для коллекции. Если приложение регулирует уровни производительности динамически, необходимо вести наблюдение за производительностью коллекции.

##Изменение уровней производительности с помощью портала Azure

Портал Azure — один из доступных вариантов для управления уровнями производительности коллекции. Для изменения уровня производительности коллекции из этого портала выполните указанные ниже действия.

1. Перейдите на [**портал Microsoft Azure**](https://portal.azure.com) в своем браузере.
2. Щелкните на панели быстрого перехода в левой части окна кнопку **Просмотреть**.
3. В концентраторе **Просмотреть** щелкните пункт **Учетные записи DocumentDB** под меткой **Фильтровать элементы**.
4. В колонке **Учетные записи DocumentDB** выберите учетную запись DocumentDB, которая содержит нужную коллекцию.
5. В колонке **Учетная запись DocumentDB** прокрутите вниз до группы связанных элементов **Базы данных** и выберите базу данных, содержащую нужную коллекцию. 
6. В недавно открытой колонке **Базы данных** прокрутите вниз до группы связанных элементов **Коллекции** и выберите нужную коллекцию.
7. И, наконец, в вашей колонке **Коллекции** найдите и щелкните плитку **Ценовая категория** в группе связанных элементов **Использование**.
8. В колонке **Выберите ценовую категорию** выберите желаемый уровень производительности, а затем нажмите кнопку **Выбрать** в нижней части колонки. 

>[AZURE.NOTE] Изменение уровней производительности коллекции может занять до 2 минут.

![Изменение ценовой категории][1]

##Изменение уровней производительности с помощью пакета .NET SDK

Другой вариант изменения уровней производительности вашей коллекции — с помощью наших пакетов SDK. В этом разделе описывается только процесс изменения уровня производительности коллекции с помощью нашего [пакета .NET SDK](https://msdn.microsoft.com/library/azure/dn948556.aspx), но он аналогичен и для других [пакетов SDK](https://msdn.microsoft.com/library/azure/dn781482.aspx). Если вы не знакомы с пакетом .NET SDK, ознакомьтесь с [учебником по началу работы](documentdb-get-started.md).

Ниже приведен фрагмент кода для изменения типа предложения:

	//Fetch the resource to be updated
	Offer offer = client.CreateOfferQuery()
	                          .Where(r => r.ResourceLink == "collection selfLink")    
	                          .AsEnumerable()
	                          .SingleOrDefault();
	                          
	//Change the user mode to All
	offer.OfferType = "S3";
	                    
	//Now persist these changes to the database by replacing the original resource
	Offer updated = await client.ReplaceOfferAsync(offer);

Посетите [MSDN](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.aspx), чтобы просмотреть дополнительные примеры и узнать больше о методах нашего предложения:

- [**ReadOfferAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.readofferasync.aspx);
- [**ReadOffersFeedAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.readoffersfeedasync.aspx);
- [**ReplaceOfferAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.replaceofferasync.aspx);
- [**CreateOfferQuery**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.linq.documentqueryable.createofferquery.aspx). 

##Дальнейшие действия

Дополнительные сведения о ценах и управление данными с помощью Azure DocumentDB см. в следующих статьях.
 
- [Цены на DocumentDB](https://azure.microsoft.com/pricing/details/documentdb/)
- [Управление емкостью DocumentDB](documentdb-manage.md) 
- [Моделирование данных в DocumentDB](documentdb-modeling-data.md)
- [Секционирование данных в DocumentDB](documentdb-partition-data.md)

Дополнительные сведения о DocumentDB можно найти в [документации](https://azure.microsoft.com/documentation/services/documentdb/) по Azure DocumentDB.

[1]: ./media/documentdb-performance-levels/img1.png

<!---HONumber=AcomDC_0204_2016-->