---
title: Уровни производительности в DocumentDB | Microsoft Docs
description: Узнайте, каким образом с помощью уровней производительности в DocumentDB можно резервировать пропускную способность для каждой коллекции.
services: documentdb
author: mimig1
manager: jhubbard
editor: monicar
documentationcenter: ''

ms.service: documentdb
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/26/2016
ms.author: mimig

---
# Уровни производительности в DocumentDB
В этой статье приведены общие сведения об уровнях производительности в [Microsoft Azure DocumentDB](https://azure.microsoft.com/services/documentdb/).

Ознакомившись с данной статьей, вы сможете ответить на следующие вопросы.

* Что такое уровень производительности?
* Каким образом выполняется резервирование пропускной способности для учетной записи базы данных?
* Как работать с уровнями производительности?
* Как осуществляется выставление счетов по уровням производительности?

## Введение в уровни производительности
Каждая коллекция DocumentDB созданная под стандартной учетной записью, подготавливается к работе со связанным уровнем производительности. Каждая коллекция в базе данных может иметь разный уровень производительности, что позволяет выделять больший объем пропускной способности часто используемым коллекциям и меньший — редко используемым. DocumentDB поддерживает как уровни производительности по определенным пользователем показателям, так и уровни производительности по заранее определенным показателям.

Каждый уровень производительности имеет соответствующий предел скорости, измеряемый в [единицах запросов](documentdb-request-units.md). Это значение пропускной способности, которое будет зарезервировано для коллекции на основе ее уровня производительности и доступно для использования исключительно этой коллекцией.

<table border="0" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td valign="top"><p></p></td>
            <td valign="top"><p>Сведения</p></td>
            <td valign="top"><p>Ограничения пропускной способности</p></td>
            <td valign="top"><p>Ограничения хранилища</p></td>
            <td valign="top"><p>Версия</p></td>
             <td valign="top"><p>Интерфейсы API</p></td>            
        </tr>
        <tr>
            <td valign="top"><p>Производительность по определенным пользователем показателям</p></td>
            <td valign="top"><p>Хранилище ограничивается на основе использования в ГБ.</p><p>Пропускная способность в единицах 100 RU в секунду.</p></td>
            <td valign="top"><p>Без ограничений. 400–250 000 единиц запроса в секунду по умолчанию (выше — по запросу)</p></td>
            <td valign="top"><p>Без ограничений. 250 ГБ по умолчанию (выше по — запросу) </p></td>
            <td valign="top"><p>V2</p></td>
             <td valign="top"><p>API 2015-12-16 и более поздней версии</p></td>  
        </tr>
        <tr>
            <td valign="top"><p>Производительность по заранее определенным показателям</p></td>
            <td valign="top"><p>10 ГБ зарезервированного хранилища.</p><p>S1 = 250 RU/с, S2 = 1000 RU/с, S3 = 2500 RU/с</p></td>
            <td valign="top"><p>2500 RU/с</p></td>
            <td valign="top"><p>10&#160;ГБ</p></td>
            <td valign="top"><p>V1</p></td>
             <td valign="top"><p>Любой</p></td>  
        </tr>        
    </tbody>
</table>                


DocumentDB предлагает широкий набор операций в базе данных, включая запросы, запросы с определяемыми пользователем функциями, хранимыми процедурами и триггерами. Затраты на обработку, связанные с каждой из этих операций, зависят от типа процессора, операций ввода-вывода и объема памяти для выполнения операции. Вместо того чтобы думать об управлении аппаратными ресурсами, можно переключить внимание на единицу запроса (RU) как единую меру для ресурсов, необходимых для выполнения различных операций с базами данных и обслуживания запросов приложения.

Коллекции можно создать на [портале Microsoft Azure](https://portal.azure.com) с помощью [REST API](https://msdn.microsoft.com/library/azure/mt489078.aspx) или любого [пакета SDK службы DocumentDB](https://msdn.microsoft.com/library/azure/dn781482.aspx). API-интерфейсы DocumentDB позволяют задавать уровень производительности коллекции.

> [!NOTE]
> Уровень производительности коллекции можно настраивать с помощью API-интерфейсов или на [портале Microsoft Azure](https://portal.azure.com/). Изменение уровня производительности должно занимать не более трех минут.
> 
> 

## Установка уровней производительности для коллекций
После создания коллекции для нее резервируется полное выделение единиц RU в зависимости от назначенного уровня производительности.

Обратите внимание, что как для уровней производительности по определенным пользователем показателям, так и для уровней производительности по заранее определенным показателям DocumentDB работает на основе резервирования пропускной способности. При создании коллекции приложение имеет зарезервированные ресурсы, и для него выставляется счет на зарезервированную пропускную способность и объем хранилища базы данных независимо от фактических показателей использования. При использовании уровней производительности по определенным пользователем показателям хранилище измеряется на основе потребления, но при использовании уровней производительности по заранее определенным показателям резервируется 10 ГБ хранилища во время создания коллекции.

После создания коллекций можно изменить уровень производительности с помощью пакетов SDK DocumentDB или на классическом портале Azure.

> [!IMPORTANT]
> Счета для стандартных коллекций DocumentDB выставляются по почасовому тарифу. Для каждой создаваемой коллекции будет выставляться счет минимум за час использования.
> 
> 

Если в течение часа происходило изменение уровня производительности коллекции, будет выставлен счет по самому высокому уровню производительности, задаваемому в течение часа. Например, если вы повышаете уровень производительности для коллекции в 8:53, вы будете оплачивать новый уровень с 8:00. Аналогично, если вы снижаете уровень производительности в 8:53, новый тариф начнет действовать с 9:00.

Единицы запросов зарезервированы для каждой коллекции на основе заданного уровня производительности. Использование единиц запросов вычисляется с учетом значений в секунду. К приложениям, которые превышают подготовленный показатель единиц запросов(или уровень производительности) в коллекции, будет применяться функция регулирования до тех пор, пока значение не станет меньше уровня, зарезервированного для этой коллекции. Если приложению требуется более высокий уровень пропускной способности, можно увеличить уровень производительности для каждой коллекции.

> [!NOTE]
> Если приложение превышает уровни производительности для одной или нескольких коллекций, будет выполнено регулирование запросов для каждой коллекции. Это значит, что некоторые запросы приложения могут выполняться успешно, а к другим может быть применено регулирование. Рекомендуется добавить небольшое количество повторных попыток на случай регулирования, чтобы обрабатывать пиковые нагрузки трафика запросов.
> 
> 

## Работа с уровнями производительности
Коллекции DocumentDB позволяют группировать данные на основе шаблонов запросов и с учетом требований производительности приложения. Благодаря автоматическому индексированию и поддержке запросов в DocumentDB совместное размещение разнородных документов в рамках одной коллекции является достаточно распространенной ситуацией. Принимая решение о необходимости использования отдельных коллекций для данных, необходимо обратить внимание на следующие моменты.

* Запросы — коллекция является областью для выполнения запроса. Если необходимо выполнить запрос в наборе документов, можно обратиться к самым эффективным шаблонам чтения, которые связаны с совместным размещением документов в одной коллекции.
* Транзакции — все транзакции относятся к одной коллекции. Если у вас есть документы, которые должны обновляться в рамках одной хранимой процедуры или триггера, они должны храниться в одной коллекции. Точнее говоря, ключ секции в коллекции является границей транзакции. Дополнительные сведения см. в статье [Секционирование в DocumentDB](documentdb-partition-data.md).
* Изоляция производительности — коллекция имеет связанный уровень производительности. Это гарантирует прогнозируемую производительность каждой коллекции в виде зарезервированных единиц RU. В зависимости от частоты доступа можно распределить данные по различным коллекциям, имеющим разные уровни производительности.

> [!IMPORTANT]
> Важно понимать, что счета будут выставляться по полным стандартным тарифам на основе количества коллекций, созданных вашим приложением.
> 
> 

Если приложению не требуются большое хранилище или пропускная способность, рекомендуется использовать небольшое количество коллекций. Убедитесь также, что вы хорошо понимаете шаблоны приложения для создания новой коллекции. Можно зарезервировать создание коллекции как действие управления, обрабатываемое вне приложения. Аналогично, изменение уровня производительности для коллекции приведет к изменению почасового тарифа, по которому выставляются счета для коллекции. Если приложение регулирует уровни производительности динамически, необходимо вести наблюдение за производительностью коллекции.

## <a id="changing-performance-levels-using-the-azure-portal"></a>Переход с уровней производительности S1, S2 и S3 на уровень производительности, определенный пользователем
Выполните следующие действия, чтобы на портале Azure изменить стандартные уровни пропускной способности на пользовательские. Благодаря пользовательским уровням пропускной способности ее можно адаптировать в соответствии с вашими потребностями. Если вы используете учетную запись S1, вы можете быстро увеличить пропускную способность с 250 единиц запросов в секунду до 400 единиц запросов в секунду.

Дополнительные сведения об изменениях в ценах, связанных с пользовательской и стандартной пропускной способностью, см. в записи блога [DocumentDB: Everything you need to know about using the new pricing options](https://azure.microsoft.com/blog/documentdb-use-the-new-pricing-options-on-your-existing-collections/) (DocumentDB: необходимая информация для использования новых вариантов ценообразования).

> [!VIDEO https://channel9.msdn.com/Blogs/AzureDocumentDB/ChangeDocumentDBCollectionPerformance/player]
> 
> 

1. В браузере откройте [**портал Azure**](https://portal.azure.com).
2. Последовательно щелкните элементы **Обзор** -> **Учетные записи DocumentDB**, затем выберите учетную запись DocumentDB для изменения.
3. В группе связанных элементов **Базы данных** выберите базу данных, которую нужно изменить, а затем выберите необходимую коллекцию в колонке **База данных**. Учетные записи со стандартной пропускной способностью имеют ценовую категорию S1, S2 или S3.
   
      ![Снимок экрана колонки "База данных" и коллекции S1](./media/documentdb-performance-levels/documentdb-change-performance-S1.png)
4. В колонке **Коллекции** выберите **Дополнительно**, а затем щелкните **Параметры** на верхней панели.
5. В колонке **Параметры** щелкните **Ценовая категория**, чтобы отобразить оценку ежемесячных затрат для каждого плана в колонке **Выбор ценовой категории**. Для изменения пользовательской пропускной способности щелкните **Стандартная** и нажмите кнопку **Выбрать**, чтобы сохранить изменения.
   
      ![Снимок экрана с колонками "База данных" и "Выбор ценовой категории"](./media/documentdb-performance-levels/documentdb-change-performance.png)
6. В колонке **Параметры** значение **Ценовая категория** изменилось на **Стандартная** и появилось поле **Пропускная способность (единицы запросов в секунду)** со значением 400 (единиц запросов в секунду) по умолчанию. Задайте пропускную способность от 400 до 10 000 [единиц запросов](documentdb-request-units.md) в секунду. **Сводка по ценам** в нижней части страницы автоматически обновляется, показывая оценку ежемесячных расходов. Нажмите кнопку **ОК**, чтобы сохранить изменения.
   
    ![Снимок экрана колонки "Параметры", на котором показано, где можно изменить значение пропускной способности](./media/documentdb-performance-levels/documentdb-change-performance-set-thoughput.png)
7. В колонке **База данных** можно проверить новое значение пропускной способности для коллекции.
   
    ![Снимок экрана колонки "База данных" с измененной коллекцией](./media/documentdb-performance-levels/documentdb-change-performance-confirmation.png)

Если в ходе работы выяснится, что требуется более высокая пропускная способность (больше 10 000 единиц запроса в секунду) или больший объем хранилища (больше 10 ГБ), то вы можете создать секционированную коллекцию. Сведения о создании секционированной коллекции см. в разделе [Создание коллекции](documentdb-create-collection.md).

> [!NOTE]
> Изменение уровней производительности коллекции может занять до 2 минут.
> 
> 

## Изменение уровней производительности с помощью пакета .NET SDK
Другой вариант изменения уровней производительности вашей коллекции — с помощью наших пакетов SDK. В этом разделе описывается только процесс изменения уровня производительности коллекции с помощью нашего [пакета .NET SDK](https://msdn.microsoft.com/library/azure/dn948556.aspx), но он аналогичен и для других [пакетов SDK](https://msdn.microsoft.com/library/azure/dn781482.aspx). Если вы не знакомы с пакетом .NET SDK, ознакомьтесь с [учебником по началу работы](documentdb-get-started.md).

Ниже приведен фрагмент кода для изменения предлагаемой пропускной способности до 50 000 единиц запроса в секунду.

    //Fetch the resource to be updated
    Offer offer = client.CreateOfferQuery()
                      .Where(r => r.ResourceLink == collection.SelfLink)    
                      .AsEnumerable()
                      .SingleOrDefault();

    // Set the throughput to 5000 request units per second
    offer = new OfferV2(offer, 5000);

    //Now persist these changes to the database by replacing the original resource
    await client.ReplaceOfferAsync(offer);

    // Set the throughput to S2
    offer = new Offer(offer);
    offer.OfferType = "S2";

    //Now persist these changes to the database by replacing the original resource
    await client.ReplaceOfferAsync(offer);



> [!NOTE]
> Коллекции, подготовленные с уровнем ниже 10 000 единиц запроса в секунду, можно переносить между предложениями с определяемой пользователем пропускной способностью и предварительно определенной пропускной способностью (S1, S2, S3) в любое время. Коллекции, подготовленные с уровнем выше 10 000 единиц запроса в секунду, невозможно преобразовать в предварительно определенные уровни пропускной способности.
> 
> 

Посетите [MSDN](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.aspx), чтобы просмотреть дополнительные примеры и узнать больше о методах нашего предложения:

* [**ReadOfferAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.readofferasync.aspx);
* [**ReadOffersFeedAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.readoffersfeedasync.aspx);
* [**ReplaceOfferAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.replaceofferasync.aspx);
* [**CreateOfferQuery**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.linq.documentqueryable.createofferquery.aspx).

## <a id="change-throughput"></a>Изменение пропускной способности коллекции
Если вы уже используете производительность по определенным пользователем показателям, то можете изменить пропускную способность коллекции, выполнив следующие действия. Для изменения уровня производительности S1, S2 или S3 (по заранее определенным показателям) на производительность по определенным пользователем показателям см. раздел [Переход с уровней производительности S1, S2 и S3 на уровень производительности, определенный пользователем](#changing-performance-levels-using-the-azure-portal).

1. В браузере откройте [**портал Azure**](https://portal.azure.com).
2. Последовательно щелкните элементы **Обзор** -> **Учетные записи DocumentDB**, затем выберите учетную запись DocumentDB для изменения.
3. В колонке **Учетная запись DocumentDB** в группе связанных элементов **Базы данных** выберите базу данных, которую нужно изменить, а затем выберите необходимую коллекцию в колонке **База данных**.
4. В колонке **Коллекции** щелкните **Параметры** на верхней панели.
5. В колонке **Параметры** увеличьте значение в поле **Пропускная способность (единицы запросов в секунду)**, а затем нажмите кнопку **ОК**, чтобы сохранить изменение. **Сводка по ценам** в нижней части колонки обновляется, показывая новую оценку ежемесячных расходов для данной коллекции в одном регионе.
   
    ![Снимок экрана колонки "Параметры", на котором выделены поля "Пропускная способность" и "Сводка по ценам"](./media/documentdb-performance-levels/documentdb-change-performance-set-thoughput.png)

Если вы не знаете точно, на сколько увеличивать пропускную способности, см. раздел [Оценка требований к пропускной способности](documentdb-request-units.md#estimating-throughput-needs) и страницу [калькулятора единиц запросов](https://www.documentdb.com/capacityplanner).

## Дальнейшие действия
Дополнительные сведения о ценах и управление данными с помощью Azure DocumentDB см. в следующих статьях.

* [Цены на DocumentDB](https://azure.microsoft.com/pricing/details/documentdb/)
* [Управление емкостью DocumentDB](documentdb-manage.md)
* [Моделирование данных в DocumentDB](documentdb-modeling-data.md)
* [Секционирование данных в DocumentDB](documentdb-partition-data.md)
* [Единиц запросов](http://go.microsoft.com/fwlink/?LinkId=735027)

Дополнительные сведения о DocumentDB можно найти в [документации](https://azure.microsoft.com/documentation/services/documentdb/) по Azure DocumentDB.

Инструкции по тестированию масштабирования и производительности с помощью Azure DocumentDB см. в [этой статье](documentdb-performance-testing.md).

[1]: ./media/documentdb-performance-levels/documentdb-change-collection-performance7-9.png
[2]: ./media/documentdb-performance-levels/documentdb-change-collection-performance10-11.png

<!---HONumber=AcomDC_0831_2016-->