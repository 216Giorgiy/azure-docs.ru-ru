---
redirect_url: https://azure.microsoft.com/services/documentdb/
ROBOTS: NOINDEX, NOFOLLOW
translationtype: Human Translation
ms.sourcegitcommit: d59ebef3cda36ba048b844f0cd2326fff66b4aa5
ms.openlocfilehash: 27880401ccfca4c2c504eecc1aeb128d40c501a3


---
# <a name="storage-and-predictable-performance-provisioning-in-documentdb"></a>Подготовка хранилища и прогнозируемой производительности в DocumentDB
Azure DocumentDB — это полностью управляемая масштабируемая служба базы данных NoSQL для документов JSON. Благодаря DocumentDB вам не нужно арендовать виртуальные машины, развертывать программное обеспечение или отслеживать работу баз данных. Система DocumentDB обслуживается и непрерывно контролируется инженерами корпорации Майкрософт, что позволяет добиться доступности, производительности и защиты данных мирового уровня.  

Вы можете приступить к работе с DocumentDB, [создав учетную запись базы данных](documentdb-create-account.md), а затем — [коллекцию и базу данных DocumentDB](documentdb-create-collection.md) на [портале Azure](https://portal.azure.com/). Базы данных DocumentDB предлагаются в виде единиц хранения на основе твердотельных накопителей с определенной пропускной способностью. Эти единицы хранения предоставляются при создании коллекций баз данных. Для каждой коллекции резервируется определенная пропускная способность, которую в любое время можно уменьшать или увеличивать в соответствии с требованиями вашего приложения.

Если в приложении превышены уровни производительности для одной или нескольких коллекций, количество запросов будет ограничено. Это значит, что некоторые запросы приложения могут выполняться успешно, а к другим может быть применено регулирование.

В этой статье содержится обзор ресурсов и показателей, доступных для управления пропускной способностью и планирования хранилища данных.

## <a name="database-account"></a>Учетная запись базы данных
Как подписчик Azure вы можете подготовить для управления ресурсами баз данных одну или несколько учетных записей базы данных DocumentDB. Каждая подписка связана с одной подпиской Azure.

Учетные записи DocumentDB можно создавать с помощью [портала Azure](documentdb-create-account.md), [шаблона ARM или Azure CLI](documentdb-automation-resource-manager-cli.md).

## <a name="databases"></a>Базы данных
Каждая база данных DocumentDB может содержать практически неограниченное хранилище документов, разбитое на коллекции. Коллекции обеспечивают изоляцию производительности — каждую коллекцию можно подготовить с объемом пропускной способности, который не используется совместно с другими коллекциями в той же базе данных или учетной записи. База данных DocumentDB является эластичной, позволяя использовать SSD-хранилище документов размером от нескольких гигабайт до нескольких терабайт и подготовленную пропускную способность. В отличие от традиционных реляционных СУБД, база данных в DocumentDB не ограничена одним узлом и может охватывать несколько компьютеров или кластеров.  

Благодаря DocumentDB по мере роста вашего приложения вы можете создать больше коллекций или баз данных, либо и то, и другое. Базы данных можно создавать на [портале Azure](documentdb-create-database.md) или с помощью любого [пакета SDK для DocumentDB](documentdb-dotnet-samples.md).   

## <a name="database-collections"></a>Коллекции базы данных
Каждая база данных DocumentDB может содержать одну или несколько коллекций. Коллекции выступают в качестве высокодоступных разделов для хранения и обработки данных. В каждой коллекции могут храниться документы с разнородными схемами. Автоматическое индексирование DocumentDB и возможность выполнять запросы позволяют с легкостью фильтровать и извлекать документы. Коллекция обеспечивает область для хранения документов и выполнения запросов. Коллекция также является доменом транзакций для всех входящих в ее состав документов. Коллекции определяют выделяемую пропускную способность на основе значения, заданного на портале Azure или с помощью пакетов SDK.

DocumentDB автоматически секционирует коллекции на один или несколько физических серверов. При создании коллекции можно указать подготовленную пропускную способность в единицах запросов в секунду и свойство ключа раздела. Служба DocumentDB учитывает это значение при распределении документов между разделами и перенаправлении запросов. Значение ключа раздела тоже выступает в качестве границы транзакции для хранимых процедур и триггеров. Каждой коллекции назначается зарезервированный объем пропускной способности, который не используется совместно с другими коллекциями в данной учетной записи. Таким образом, для приложения можно масштабировать как объем хранилища, так и пропускную способность.

Коллекции можно создавать на [портале Azure](documentdb-create-collection.md) или с помощью любого [пакета SDK для DocumentDB](documentdb-sdk-dotnet.md).   

## <a name="request-units-and-database-operations"></a>Единицы запросов и операции базы данных
Создавая коллекцию, вы резервируете пропускную способность в [единицах запросов](documentdb-request-units.md) в секунду. Вы можете забыть о необходимости управления аппаратными ресурсами, вместо этого рассматривая **единицу запросов** как универсальную меру оценки ресурсов, требуемых для выполнения различных операций с базами данных и обслуживания запросов приложения. Чтение документа размером 1 КБ потребляет 1 единицу запроса вне зависимости от числа элементов в коллекции или количества параллельных запросов, выполняемых одновременно. Все запросы к DocumentDB, включая сложные операции, такие как SQL-запросы, потребляют прогнозируемое количество единиц запросов, которое можно определить при разработке. Если известен размер документов и частота выполнения каждой операции (операций чтения, записи и запросов) для обеспечения работоспособности приложения, можно подготовить точный объем пропускной способности и масштабировать базу данных вверх и вниз при изменении потребностей в производительности.

Для каждой коллекции можно резервировать пропускную способность блоками по 100 единиц запросов в секунду (число запросов может варьироваться от сотен до миллионов в секунду). Для адаптации к меняющимся потребностям обработки и получения доступа к шаблонам вашего приложения подготовленную пропускную способность можно настраивать на протяжении жизненного цикла коллекции. Дополнительные сведения см. в статье [Уровни производительности в DocumentDB](documentdb-performance-levels.md).

> [!IMPORTANT]
> За коллекции взимается плата. Стоимость определяется по подготовленной пропускной способности коллекции, измеряемой в единицах запросов в секунду, и общему использованному месту в гигабайтах.
>
>

Сколько единиц запросов использует определенная операция, например выполнение вставки, удаления, запроса или хранимой процедуры? Единица запроса — это нормализованная мера стоимости обработки запросов. Чтение документа размером 1 КБ предусматривает использование 1 единицы запроса; при этом для выполнения запросов на вставку, замену или удаление этого же документа службе нужно больше вычислительных ресурсов и, соответственно, больше единиц запросов. Каждый ответ от службы включает настраиваемый заголовок (`x-ms-request-charge`), который информирует о числе единиц запросов, затраченных на этот запрос. Этот заголовок также доступен и в [пакетах SDK](documentdb-sdk-dotnet.md). В пакете SDK для .NET [RequestCharge](https://msdn.microsoft.com/library/azure/dn933057.aspx#P:Microsoft.Azure.Documents.Client.ResourceResponse`1.RequestCharge) является свойством объекта [ResourceResponse](https://msdn.microsoft.com/library/azure/dn799209.aspx). Если вы хотите оценить потребность в производительности до вызова запроса, вам поможет [планировщик ресурсов](documentdb-request-units.md#estimating-throughput-needs) .

> [!NOTE]
> Базовое соотношение — 1 единица запроса для документа размером 1 КБ — соответствует простой команде GET [с согласованностью на уровне сеансов](documentdb-consistency-levels.md).
>
>

На расход единиц запросов на выполнение операций в учетной записи базы данных DocumentDB влияет несколько факторов. К ним относятся:

* Размер документа. По мере увеличения размера документа увеличивается и число единиц запросов, расходуемых на чтение или запись данных.
* Число свойств. Если все свойства индексируются, число единиц запросов, расходуемых на запись документа, увеличивается вместе с увеличением количества свойств.
* Согласованность данных. При использовании уровней согласованности данных Strong или Bounded Staleness на чтение документов расходуются дополнительные единицы запросов.
* Индексированные свойства. Свойства, которые индексируются по умолчанию, определяются политикой индексирования для каждой коллекции. Вы можете сократить потребление единиц запросов, ограничив количество индексируемых свойств.
* Индексирование документов. По умолчанию каждый документ индексируется автоматически. Исключение некоторых документов из этого процесса позволяет сэкономить единицы запросов.

Дополнительные сведения см. в статье [Единицы запросов в DocumentDB](documentdb-request-units.md).

Например, ниже приведена таблица, показывающая количество единиц запросов для подготовки с тремя разными размерами документа (1 КБ, 4 КБ и 64 КБ) и двумя разными уровнями производительности (500 операций чтения в секунду + 100 операций записи в секунду и 500 операций чтения в секунду + 500 операций записи в секунду). Согласованность данных была настроена в сеансе, а политике индексации было присвоено значение "Нет".

<table border="0" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td valign="top"><p><strong>Размер документа</strong></p></td>
            <td valign="top"><p><strong>Операций чтения в секунду</strong></p></td>
            <td valign="top"><p><strong>Операций записи в секунду</strong></p></td>
            <td valign="top"><p><strong>Единиц запросов</strong></p></td>
        </tr>
        <tr>
            <td valign="top"><p>1 КБ</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>100</p></td>
            <td valign="top"><p>(500 * 1) + (100 * 5) = 1000 единиц запросов в секунду</p></td>
        </tr>
        <tr>
            <td valign="top"><p>1 КБ</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>(500 * 5) + (100 * 5) = 3000 единиц запросов в секунду</p></td>
        </tr>
        <tr>
            <td valign="top"><p>4 КБ</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>100</p></td>
            <td valign="top"><p>(500 * 1,3) + (100 * 7) = 1350 единиц запросов в секунду</p></td>
        </tr>
        <tr>
            <td valign="top"><p>4 КБ</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>(500 * 1,3) + (500 * 7) = 4150 единиц запросов в секунду</p></td>
        </tr>
        <tr>
            <td valign="top"><p>64 КБ</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>100</p></td>
            <td valign="top"><p>(500 * 10) + (100 * 48) = 9800 единиц запросов в секунду</p></td>
        </tr>
        <tr>
            <td valign="top"><p>64 КБ</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>500</p></td>
            <td valign="top"><p>(500 * 10) + (500 * 48) = 29 000 единиц запросов в секунду</p></td>
        </tr>
    </tbody>
</table>

Запросы, хранимые процедуры и триггеры расходуют единицы запросов с учетом сложности выполняемых операций. При разработке приложения проверяйте заголовок со стоимостью в единицах запросов, чтобы лучше понять, как эти ресурсы используются каждой из операций.  

## <a name="choice-of-consistency-level-and-throughput"></a>Выбор уровня согласованности и пропускной способности
Выбор уровня согласованности по умолчанию влияет на производительность и задержки. Вы можете установить уровень согласованности по умолчанию как программно, так и через портал Azure. Вы также можете переопределить уровень согласованности для каждого запроса. По умолчанию используется согласованность на уровне **сеанса**, то есть гарантируются монотонное чтение и запись, а также чтение записанных данных. Согласованность уровня Session отлично подходит для приложений, ориентированных на пользователей, и предлагает оптимальный компромисс между согласованностью и производительностью.    

Инструкции по изменению уровня согласованности на портале Azure см. в разделе [Управление учетной записью DocumentDB](documentdb-manage-account.md#consistency). Дополнительные сведения об уровнях согласованности см. в разделе [Использование уровней согласованности](documentdb-consistency-levels.md).

## <a name="provisioned-document-storage-and-index-overhead"></a>Подготавливаемое хранилище документов и затраты на индексирование
DocumentDB поддерживает создание коллекций с одним разделом и секционированных коллекций. Каждый раздел в DocumentDB поддерживает SSD-хранилище размером до 10 ГБ. В эти 10 ГБ включено как место для хранения собственно документов, так и место для хранения индекса. По умолчанию коллекция DocumentDB настроена на автоматическое индексирование всех документов без явного указания вторичных индексов или схем. В зависимости от приложения, использующего DocumentDB, обычные затраты на индекс составляют от 2 до 20 %. Технология индексирования, используемая DocumentDB, гарантирует, что независимо от значений свойств, показатель накладных расходов не превышает 80% от размера документов с параметрами по умолчанию.

По умолчанию все документы индексируются DocumentDB автоматически. Но если нужно уменьшить расходы на индексирование, вы можете отменить индексацию некоторых документов. Это можно сделать при вставке или замене документа, как описано в статье [Политики индексации DocumentDB](documentdb-indexing-policies.md). Вы можете настроить коллекцию DocumentDB чтобы исключить все документы в коллекции от индексации. Вы также можете настроить выборочную индексацию коллекции DocumentDB, например индексацию только определенных свойств или путей в документах JSON (используются подстановочные знаки). См. раздел с описанием [настройки политики индексации для коллекции](documentdb-indexing-policies.md#CustomizingIndexingPolicy). Исключение свойств или документов их индексирования также улучшает пропускную способность записи, это значит, вы будете потреблять меньшее количество единиц запросов.   

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о работе DocumentDB можно найти в статье [Секционирование и масштабирование в Azure DocumentDB](documentdb-partition-data.md).

Мониторинг уровней производительности на портале Azure описан в статье [Мониторинг запросов, использования и хранилища DocumentDB](documentdb-monitor-accounts.md). Дополнительные сведения о выборе уровней производительности коллекций см. в статье [Уровни производительности в DocumentDB](documentdb-performance-levels.md).



<!--HONumber=Jan17_HO3-->


