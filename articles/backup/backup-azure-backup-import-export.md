.<properties
   pageTitle="Служба архивации Azure: автономное резервное копирование и начальное заполнение с помощью службы импорта и экспорта Azure | Microsoft Azure"
   description="Узнайте, как служба архивации Azure позволяет отправлять данные с помощью службы импорта и экспорта Azure без использования сети. В этой статье описывается автономное заполнение начальных резервных копий данных с помощью службы импорт и экспорт Azure."
   services="backup"
   documentationCenter=""
   authors="saurabhsensharma"
   manager="shivamg"
   editor=""/>
<tags
   ms.service="backup"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="storage-backup-recovery"
   ms.date="08/16/2016"
   ms.author="jimpark;saurabhsensharma;nkolli;trinadhk"/>

# Автономное резервное копирование в службе архивации Azure
В службу архивации Azure встроено несколько эффективных методов, которые позволяют экономить затраты на сеть и хранилище во время передачи начальных полных резервных копий данных в Azure. Обычно при этом выполняется передача больших объемов данных. Следовательно, для первой архивации требуется более высокая пропускная способность по сравнению с последующими операциями архивации, в ходе которых передаются только изменения или добавочные резервные копии. Служба архивации Azure не только сжимает начальные резервные копии, но и предоставляет механизм передачи сжатых копий данных в Azure с помощью дисков за счет процесса автономного заполнения.

Этот предоставленный службой архивации Azure процесс тесно интегрирован со [службой импорта и экспорта Azure](../storage/storage-import-export-service.md), что позволяет быстро передавать данные в Azure, используя диски. Процесс автономного заполнения можно использовать для отправки начальных резервных копий на одном или нескольких жестких дисках в центр обработки данных Azure, когда размер начальных резервных копий, которые нужно передать по сети с большой задержкой и низкой пропускной способностью, составляет несколько терабайт. В этой статье описаны действия, необходимые для выполнения этого процесса.

## Обзор

Благодаря процессу автономного заполнения, предоставленному службой архивации Azure, и службе импорта и экспорта Azure автономная передача данных в хранилище Azure с помощью дисков не вызывает проблем. Вместо передачи начальной полной копии по сети, резервные копии данных записываются в *промежуточное расположение*. После записи первоначальной копии в *промежуточное расположение* с помощью *средства импорта и экспорта Azure* эти данные записываются на один или несколько дисков SATA. Количество используемых дисков зависит от размера начальной резервной копии. Со временем эти диски отправляются в ближайший центр обработки данных Azure.

В [обновлении службы архивации Azure от августа 2016 г. (и более позднего)](http://go.microsoft.com/fwlink/?LinkID=229525&clcid=0x409) представлено *средство подготовки дисков Azure*, которое называется **AzureOfflineBackupDiskPrep**. Это средство предоставляет следующие возможности:

   - Помогает в подготовке дисков для импорта в Azure с помощью средства импорта и экспорта Azure.
   - Автоматически создает задание импорта для службы импорта и экспорта Azure на [классическом портале Azure](https://manage.windowsazure.com). В предыдущих версиях службы архивации Azure этот процесс выполнялся вручную.

После передачи резервной копии данных в Azure служба архивации Azure копирует эти данные в хранилище службы архивации, после чего планируется добавочное резервное копирование.

  > [AZURE.NOTE] Средство подготовки дисков Azure доступно в обновлении службы архивации Azure от августа 2016 г. (или более позднем). Чтобы использовать его, убедитесь, что нужное обновление установлено, и выполните с его помощью все необходимые действия рабочего процесса. Если используется предыдущая версия службы архивации Azure, для подготовки диска SATA можно использовать *средство импорта и экспорта Azure*, как описано в следующих разделах этой статьи.

## Предварительные требования

1. Обязательно [ознакомьтесь с процессом экспорта и импорта Azure](../storage/storage-import-export-service.md).
2. Перед началом этого процесса создайте хранилище службы архивации Azure, скачайте учетные данные хранилища, установите агент службы архивации Azure на сервер Windows Server, клиент Windows или сервер SCDPM и зарегистрируйте компьютер в хранилище службы архивации Azure.
3. Загрузите [файл с параметрами публикации Azure](https://manage.windowsazure.com/publishsettings) на компьютер, на котором планируете создать резервную копию данных.
4. Подготовьте *промежуточное расположение*, в роли которого может выступать сетевая папка или дополнительный диск компьютера. Промежуточное расположение — это "промежуточное хранилище", которое используется временно. Убедитесь, что в промежуточном расположении есть достаточно места для хранения начальной копии. Например, если нужно создать резервную копию файлового сервера размером 500 ГБ, убедитесь, что в промежуточном расположении доступно не менее 500 ГБ свободного места (хотя из-за сжатия фактически использованный объем будет меньшим).
5. Один или несколько 3,5-дюймовых внутренних жестких дисков SATA II или III. Для использования со службой импорта и экспорта Azure поддерживаются только внутренние 3,5-дюймовые жесткие диски SATA II или III. Жесткие диски емкостью более 10 ТБ не поддерживаются. Такие жесткие диски можно подключить напрямую с помощью совместимого разъема SATA или через внешний USB-адаптер SATA II/III. Список поддерживаемых жестких дисков и USB-адаптеров SATA см. в [документации по службе импорта и экспорта Azure](../storage/storage-import-export-service.md).
6. На компьютере, к которому подключено устройство записи дисков SATA, активируйте BitLocker.
7. Загрузите [средство импорта и экспорта Azure](http://go.microsoft.com/fwlink/?LinkID=301900&clcid=0x409) на компьютер, к которому подключено устройство записи дисков SATA. Если используется обновление службы архивации от августа 2016 г. (или более позднее), это действие выполнять не обязательно.

## Рабочий процесс
Сведения в этом разделе предназначены для выполнения **автономного резервного копирования** с целью отправки данных в центр обработки данных Azure и передачи в хранилище Azure. Ответы на вопросы о службе импорта или о любом аспекте этого процесса см. в документации по обзору службы импорта, перечисленной [выше](../storage/storage-import-export-service.md).

### Запуск автономного резервного копирования

1. В процессе планирования резервного копирования отобразится следующая страница (на сервере Windows Server, в клиенте Windows или SCDPM).

    ![Экран импорта](./media/backup-azure-backup-import-export/offlineBackupscreenInputs.png)
    
    Соответствующая страница на сервере SCDPM выглядит следующим образом. <br/> ![Экран импорта DPM](./media/backup-azure-backup-import-export/dpmoffline.png)

    Ниже приведено описание входных данных.

    - **Промежуточное расположение** — временное хранилище, куда записывается начальная резервная копия. Это расположение может быть в сетевой папке или на локальном компьютере. Если *целевой компьютер* и *исходный компьютер* разные, то рекомендуется указывать полный сетевой путь к промежуточному расположению.
    - **Имя задания импорта Azure** — уникальное имя, по которому служба импорта Azure и служба архивации Azure отслеживают процесс передачи данных в Azure с помощью дисков.
    - **Параметры публикации Azure** — XML-файл со сведениями о профиле подписки. В нем также содержатся защищенные учетные данные, связанные с вашей подпиской. Файл можно скачать [здесь](https://manage.windowsazure.com/publishsettings). Укажите локальный путь к файлу параметров публикации.
    - **Идентификатор подписки Azure** — идентификатор той подписки Azure, в которой вы планируете запустить задание импорта Azure. Если у вас несколько подписок Azure, используйте идентификатор, который необходимо связать с заданием импорта.
    - **Учетная запись хранения Azure** — предоставленная в подписке Azure классическая учетная запись хранения, которая будет связана с заданием импорта Azure.
    - **Контейнер службы хранилища Azure** — имя хранилища BLOB-объектов в учетной записи хранения Azure, куда импортируются данные этого задания.
    
    > [AZURE.NOTE] Если сервер для резервных копий зарегистрирован в хранилище служб восстановления на [новом портале Azure](https://ms.portal.azure.com), а не в подписке поставщика облачных служб (CSP), по-прежнему можно создать на новом портале Azure классическую учетную запись хранения и использовать ее для выполнения автономного резервного копирования.
    
    Сохраните эти сведения отдельно, так как они повторно понадобятся в ходе выполнения следующих действий. Если подготовка дисков осуществляется с помощью *средства подготовки дисков Azure*, требуется только *промежуточное расположение*.
    

2. Завершите процесс и в консоли управления службы архивации Azure выберите **Выполнить моментальную архивацию**. Начнется создание автономной резервной копии. На этом этапе начальная резервная копия записывается в промежуточное расположение.

    .![Команда «Выполнить моментальную архивацию»](./media/backup-azure-backup-import-export/backupnow.png)
    
    Чтобы запустить соответствующий процесс на сервере SCDPM, щелкните правой кнопкой мыши **Группа защиты** и выберите параметр **Создать точку восстановления**. После этого выберите параметр **Защита в сети**.

    .![Резервное копирование DPM](./media/backup-azure-backup-import-export/dpmbackupnow.png)

    После завершения операции промежуточное расположение можно использовать для подготовки дисков.

    ![Выходные данные](./media/backup-azure-backup-import-export/opbackupnow.png)

###Подготовка диска SATA и создание задания импорта Azure с помощью *средства подготовки дисков Azure*
*Средство подготовки дисков Azure* доступно в каталоге установки агента служб восстановления Microsoft Azure (обновление от августа 2016 г. и более позднее) по следующему пути:

   *\\Microsoft* *Azure* *Recovery* *Services* *Agent\\Utils*.

1. Перейдите по этому пути и скопируйте каталог **AzureOfflineBackupDiskPrep** на *целевой компьютер*, к которому присоединены подготавливаемые диски. Убедитесь, что *целевой компьютер соответствует следующим требованиям*.

      - *Промежуточное расположение*, используемое для рабочего процесса автономного заполнения, доступно на *целевом компьютере* по тому же сетевому пути, который был задан во время **запуска автономного резервного копирования**.
      
      - На компьютере активировано средство BitLocker.
      
      - Компьютер имеет доступ к порталу Azure.
      
      При необходимости *целевым компьютером* может быть *исходный компьютер*.

2. На целевом компьютере, где находится каталог средства подготовки дисков Azure, откройте командную строку с повышенными привилегиями и выполните следующую команду:

      *.\\AzureOfflineBackupDiskPrep.exe* s:<*путь\_к\_промежуточному\_расположению*> [p:<*путь\_к\_файлу\_параметров\_публикации*>].

| Параметр | Описание
|-------------|-------------|
|s:<*путь\_к\_промежуточному\_расположению*> | Обязательный параметр. Используется для предоставления пути к промежуточному расположению, заданному в процессе запуска автономного резервного копирования |
|p:<*путь\_к\_файлу\_параметров\_публикации*> | Необязательный параметр. Используется для предоставления пути к файлу параметров публикации, заданному в процессе запуска автономного резервного копирования |

   > [AZURE.NOTE] Если *целевой компьютер* и *исходный компьютер* разные, то нужно обязательно указать путь к файлу параметров публикации.

При выполнении команды средство запрашивает выбор задания импорта Azure, связанного с подготавливаемыми дисками. Если с предоставленным промежуточным расположением связано только одно задание импорта, отобразится следующее окно.

   ![Входные данные средства подготовки дисков Azure](./media/backup-azure-backup-import-export/azureDiskPreparationToolDriveInput.png) <br/>
3. Введите **букву** подключенного диска (без двоеточия), который нужно подготовить для передачи в Azure. Затем при появлении запроса подтвердите форматирование диска.

После этого средство начнет подготовку диска с резервными копиями данных. Когда в средстве отобразится соответствующий запрос, может потребоваться подключить дополнительные диски. Это связано с тем, что на выбранном диске недостаточно памяти для хранения резервных копий данных. <br/>

После завершения процесса диски, подготовленные с помощью средства, можно использовать для передачи в Azure, а на классическом портале Azure будет создано задание импорта с именем, заданным во время **запуска автономного резервного копирования**. Кроме того, в средстве отображается адрес центра обработки данных Azure, в который необходимо передать диски, а также ссылка на задание импорта на классическом портале Azure.

   ![Завершение подготовки дисков Azure](./media/backup-azure-backup-import-export/azureDiskPreparationToolSuccess.png)<br/>
4. Перешлите диски на адрес, указанный в средстве, и сохраните номер отслеживания для использования в будущем.<br/>
5. После перехода по ссылке, приведенной в средстве, откроется **учетная запись хранения Azure**, указанная в процессе автономного резервного копирования. Здесь на вкладке **Импорт или экспорт** учетной записи хранения можно просмотреть созданное задание импорта.

   ![Созданное задание импорта](./media/backup-azure-backup-import-export/ImportJobCreated.png)<br/>
6. В нижней части страницы щелкните **Данные об отправке**, чтобы обновить **контактные сведения**, как показано ниже. Корпорация Майкрософт использует эти сведения, чтобы вернуть диски после завершения задания импорта.

   ![Контактные сведения](./media/backup-azure-backup-import-export/contactInfoAddition.PNG)<br/>
7. На следующей странице введите **сведения об отправке**, как показано ниже. Укажите сведения о поставщике почтовых услуг, который использовался для отправки дисков в центр обработки данных Azure, и номер отслеживания.
   
   ![Данные об отправке](./media/backup-azure-backup-import-export/shippingInfoAddition.PNG)<br/>

### Завершение процесса
После завершения задания импорта начальные резервные копии данных появятся в вашей учетной записи хранения. Агент служб восстановления Microsoft Azure скопирует из нее данные в хранилище архивации или хранилище служб восстановления (в зависимости от того, что используется). При следующем запланированном резервном копировании агент службы архивации Azure выполняет добавочное резервное копирование поверх начальной резервной копии.


> [AZURE.NOTE] Следующие разделы предназначены для пользователей, у которых нет доступа к *средству подготовки дисков Azure* (то есть они используют более раннюю версию службы архивации Azure).

### Подготовка диска SATA

1. Загрузите [средство импорта и экспорта Microsoft Azure](http://go.microsoft.com/fwlink/?linkid=301900&clcid=0x409) на *целевой компьютер*. Убедитесь, компьютер, на котором вы планируете выполнить следующий набор команд, имеет доступ к промежуточному расположению (см. предыдущий шаг). При необходимости целевым компьютером может быть исходный компьютер.

2. Распакуйте файл *WAImportExport.zip*. Запустите средство *WAImportExport*, которое отформатирует диск SATA, запишет резервные копии данных на этот диск и зашифрует его. Перед выполнением следующей команды убедитесь, что на компьютере активировано средство BitLocker. <br/>

    *.\\WAImportExport.exe PrepImport /j:<*файл\_журнала*>.jrn /id: <*идентификатор\_сеанса*> /sk:<*ключ\_учетной\_записи\_хранения*> /BlobType:**страничный\_BLOB-объект** /t:<*буква\_целевого\_диска*> /format /encrypt /srcdir:<*промежуточное\_хранилище*> /dstdir: <*целевой\_виртуальный\_каталог\_больших\_двоичных\_объектов*>/*
    
    > [AZURE.NOTE] После установки обновления службы архивации от августа 2016 г. (или более позднего) убедитесь, что используется то же *промежуточное расположение*, что и на странице **Выполнить моментальную архивацию**, а также в наличии файлов *большого двоичного объекта аудиоиндексации* и *базового большого двоичного объекта*.

| Параметр | Description (Описание)
|-------------|-------------|
| /j:<*файл\_журнала*>| Путь к файлу журнала. У каждого диска должен быть только один файл журнала. Файл журнала не может находиться на целевом диске. Файла журнала имеет расширение JRN и создается в процессе выполнения этой команды.|
|/id:<*идентфикатор\_сеанса*> | Идентификатор сеанса определяет *сеанс копирования* и используется для обеспечения точного восстановления прерванного сеанса копирования. Файлы, копируемые во время сеанса копирования, хранятся в каталоге с именем, соответствующем идентификатору сеанса на целевом диске.|
| /sk:<*ключ\_учетной\_записи\_хранения*> | Ключ учетной записи хранения, в которую будут импортированы данные. Он должен совпадать с ключом, введенным при создании политики резервного копирования или группы защиты.|
| /BlobType | Укажите параметр **PageBlob**. Этот рабочий процесс завершится успешно, только если указан параметр PageBlob. Этот параметр не является параметром по умолчанию, поэтому его нужно указывать вручную. |
|/t:<*буква\_целевого\_диска*> | Буква целевого жесткого диска для текущего сеанса копирования без двоеточия в конце.|
|/format | Укажите этот параметр, если диск нужно отформатировать. В противном случае не используйте его. Прежде чем средство отформатирует диск, оно выдаст в консоли запрос на подтверждение. Чтобы запрос не выдавался, укажите параметр /silentmode.|
|/encrypt | Укажите этот параметр, если диск еще не зашифрован с помощью BitLocker и должен быть зашифрован сейчас. Если диск уже зашифрован средством BitLocker, не используйте этот параметр. Вместо него укажите параметр /bk и введите существующий ключ BitLocker. Если вы задаете параметр /format, вы также должны указать параметр /encrypt. |
|/srcdir:<*исходный\_каталог*> | Исходный каталог, содержащий файлы для копирования на целевой диск. Убедитесь, что указанное здесь имя каталога представляет собой полный путь (а не относительный).|
|/dstdir:<*целевой\_виртуальный\_каталог\_BLOB-объектов*> | Путь к целевому виртуальному каталогу в учетной записи хранилища Microsoft Azure. Указывая целевые виртуальные каталоги и BLOB-объекты, используйте правильные имена контейнеров. Обратите внимание, что имена каталогов пишутся строчными буквами. Имя контейнера должно совпадать с именем, введенным при создании политики резервного копирования или группы защиты.|

  > [AZURE.NOTE] В папке WAImportExport создается файл журнала, в который записывается вся информация о процессе. Этот файл понадобится при создании задания импорта на портале Azure.

  .![Вывод PowerShell](./media/backup-azure-backup-import-export/psoutput.png)

### Создание задания импорта на портале Azure
1. Перейдите в учетную запись хранения на [классическом портале Azure](https://manage.windowsazure.com/), щелкните вкладку **Импорт или экспорт**, а затем в области задач выберите **Создать задание импорта**.

    .![Microsoft Azure](./media/backup-azure-backup-import-export/azureportal.png)

2. На шаге 1 мастера укажите, что вы подготовили диск и уже имеется доступный файл журнала На шаге 2 мастера укажите контактные данные пользователя, ответственного за это задание импорта.
3. На шаге 3 передайте файлы журналов дисков, полученные на предыдущем этапе (см. предыдущий раздел).
4. На шаге 4 введите описательное имя для задания импорта, введенное при создании политики резервного копирования или группы защиты. Обратите внимание,что вводимое имя может содержать только строчные буквы, цифры, дефисы и подчеркивания, кроме того, оно должно начинаться с буквы и не содержать пробелов. Выбранное имя будет использоваться для отслеживания заданий, пока они выполняются, а также после их завершения.
5. Далее выберите регион своего центра обработки данных из списка. Регион центра обработки данных будет означать центр обработки данных, куда следует направить пакет.

    .![КОНТРОЛЛЕР ДОМЕНА](./media/backup-azure-backup-import-export/dc.png)

6. На шаге 5 выберите транспортного агента из списка и введите его номер учетной записи. Майкрософт будет использовать эту учетную запись для отправки дисков вам обратно после завершения задания импорта.

7. Отправьте диск и введите номер отслеживания, чтобы иметь возможность следить за состоянием доставки. Когда диск будет доставлен в ЦОД, его скопируют в учетную запись хранения, после чего состояние процесса изменится.

    ![Состояние завершения](./media/backup-azure-backup-import-export/complete.png)

### Завершение процесса
Когда начальные резервные копии данных появятся в вашей учетной записи хранения, агент служб восстановления Microsoft Azure скопирует из нее данные в хранилище архивации или хранилище служб восстановления (в зависимости от того, что используется). При следующем запланированном резервном копировании агент службы архивации Azure выполняет добавочное резервное копирование поверх начальной резервной копии.

## Дальнейшие действия
- Дополнительные сведения о процессе импорта и экспорта Azure см. [здесь](../storage/storage-import-export-service.md).
- Дополнительные сведения об автономном резервном копировании см. в [часто задаваемых вопросах о службе архивации Azure](backup-azure-backup-faq.md) в разделе «Автономное резервное копирование».

<!---HONumber=AcomDC_0824_2016-->