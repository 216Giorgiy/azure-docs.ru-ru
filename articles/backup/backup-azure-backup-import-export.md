<properties
   pageTitle="Служба архивации Azure: автономное резервное копирование и начальное заполнение с помощью службы импорта и экспорта Azure | Microsoft Azure"
   description="Узнайте, как служба архивации Azure позволяет отправлять данные с помощью службы импорта и экспорта Azure без использования сети. В этой статье описывается автономное заполнение начальных резервных копий данных с помощью службы импорт и экспорт Azure."
   services="backup"
   documentationCenter=""
   authors="nkolli1"
   manager="shivamg"
   editor=""/>
<tags
   ms.service="backup"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="storage-backup-recovery"
   ms.date="06/14/2016"
   ms.author="jimpark;nkolli;trinadhk;saurse"/>

# Автономное резервное копирование в службе архивации Azure
В службу архивации Azure встроено много эффективных методов, которые позволяют экономить затраты на сеть и хранилище. Эта служба не только сжимает данные. Изначально выполняется резервное копирование всего содержимого, а затем лишь измененных или увеличенных данных. Таким образом, при резервном копировании тома файла размером 10 ТБ в ходе начальной репликации служба архивации Azure отправит все 10 ТБ данных, а в ходе разностной репликации будут отправлены только измененные данные. Поэтому максимальная пропускная способность глобальной сети требуется в ходе начальной репликации. Чтобы уменьшить зависимость глобальной сети во время начальной репликации, служба архивации Azure поддерживает автономное резервное копирование с помощью службы импорта и экспорта Azure.

Служба архивации Azure тесно интегрирована со службой импорта и экспорта Azure, что позволяет быстро передавать начальные резервные копии данных. Службу импорта и экспорта Azure можно использовать для отправки начальных резервных копий на одном или нескольких жестких дисках в центр обработки данных Azure, когда размер начальных резервных копий, которые нужно передать по сети с большой задержкой и низкой пропускной способностью, составляет несколько терабайт. В этой статье описаны действия, необходимые для выполнения этого процесса.

## Обзор

Благодаря службе архивации Azure и службе импорта и экспорта Azure передача данных в автономное хранилище Azure с помощью дисков не вызывает проблем. Вместо передачи начальной полной копии по сети, резервные копии данных записываются в *промежуточное расположение*. Промежуточное расположение может представлять собой сетевую папку или систему хранения данных с прямым подключением. После создания начальной копии с помощью *средства импорта и экспорта Azure* эти данные записываются на диск SATA, который отправляется в центр обработки данных Azure. В зависимости от размера начальной резервной копии для завершения этой операции может потребоваться один или несколько дисков SATA. В средстве импорта и экспорта Azure все эти нюансы учтены. После записи резервных копий данных на диск их можно отправить в ближайший центр обработки данных для передачи в Azure. Затем служба архивации Azure копирует эти данные в хранилище службы архивации, после чего планируется добавочное резервное копирование.

## Предварительные требования

1. Обязательно [ознакомьтесь с процессом экспорта и импорта Azure](../storage/storage-import-export-service.md).
2. Перед началом этого процесса создайте хранилище службы архивации Azure, загрузите учетные данные хранилища, установите агент службы архивации Azure на сервер Windows Server, клиент Windows или сервер SCDPM и зарегистрируйте компьютер в хранилище службы архивации Azure.
3. Загрузите [файл с параметрами публикации Azure](https://manage.windowsazure.com/publishsettings) на компьютер, на котором планируете создать резервную копию данных.
4. Подготовьте *промежуточное расположение*, в роли которого может выступать сетевая папка или дополнительный диск компьютера. Убедитесь, что в промежуточном расположении есть достаточно места для хранения начальной копии. Например, если нужно создать резервную копию файлового сервера размером 500 ГБ, убедитесь, что промежуточное расположение имеет не менее 500 ГБ свободного места (хотя фактически использованный объем будет меньшим). Промежуточное расположение — это «переходное» хранилище, которое используется временно.
5. Внешнее устройство записи дисков SATA и внешний 3,5-дюймовый диск SATA. для использования в рамках службы импорта и экспорта поддерживаются только 3,5-дюймовые жесткие диски SATA II/III. Жесткие диски емкостью более 8 ТБ не поддерживаются. Диск SATA II/III можно подключить как внешний диск к большинству компьютеров, используя для этого адаптер SATA II/III — USB. Список поддерживаемых дисков см. в документации по службе импорта и экспорта Azure.
6. На компьютере, к которому подключено устройство записи дисков SATA, активируйте BitLocker.
7. Загрузите [средство импорта и экспорта Azure](http://go.microsoft.com/fwlink/?LinkID=301900&clcid=0x409) на компьютер, к которому подключено устройство записи дисков SATA.

## Рабочий процесс
Сведения в этом разделе предназначены для выполнения **автономного резервного копирования** с целью отправки данных в центр обработки данных Azure и передачи в хранилище Azure. Ответы на вопросы о службе импорта или о любом аспекте этого процесса см. в документации по обзору службы импорта, перечисленной [выше](../storage/storage-import-export-service.md).

### Запуск автономного резервного копирования

1. В процессе планирования резервного копирования отобразится следующий экран (на сервере Windows Server, клиенте Windows или SCDPM).

    ![Экран импорта](./media/backup-azure-backup-import-export/importscreen.png)

    Соответствующий экран на сервере SCDPM выглядит так: <br/> ![Экран импорта DPM](./media/backup-azure-backup-import-export/dpmoffline.png)

    где:

    - **Промежуточное расположение** — временное хранилище, куда записывается начальная резервная копия. Это расположение может быть в сетевой папке или на локальном компьютере.
    - **Имя задания импорта Azure**. Во время этого процесса вам необходимо будет создать *Задание импорта* на портале Azure (см. дальше в этом документе). Укажите имя, которое будете использовать на портале Azure.
    - **Параметры публикации Azure**. Это XML-файл, который содержит сведения о профиле подписки. Он также содержит защищенные учетные данные, связанные с вашей подпиской. Файл можно скачать [здесь](https://manage.windowsazure.com/publishsettings). Укажите локальный путь к файлу параметров публикации.
    - **Идентификатор подписки Azure**. Укажите идентификатор подписки Azure, в которой планируете запустить задание импорта Azure. Если у вас несколько подписок Azure, используйте идентификатор, связанный с заданием импорта.
    - **Учетная запись хранилища Azure** Введите имя учетной записи хранилища Azure, которая будет связана с этим заданием импорта.
    - **Контейнер хранилища Azure**. Введите имя хранилища BLOB-объектов, куда будут импортированы данные этого задания.

Сохраните эти сведения отдельно, так как они повторно понадобятся в ходе выполнения следующих действий.


2. Завершите процесс и в оснастке MMC службы архивации Azure выберите действие **Выполнить моментальную архивацию**. Начнется создание автономной резервной копии. На этом этапе начальная резервная копия записывается в промежуточное расположение.

    ![Команда «Выполнить моментальную архивацию»](./media/backup-azure-backup-import-export/backupnow.png)

    Чтобы запустить соответствующий процесс на сервере SCDPM, щелкните элемент **Группа защиты** и выберите параметр **Создать точку восстановления**. После этого выберите вариант **Защита в сети**.

    ![Резервное копирование DPM](./media/backup-azure-backup-import-export/dpmbackupnow.png)

    После завершения операции в промежуточном расположении создаются файлы *.AIBBlob* и *.BaseBlob*.

    ![Вывод](./media/backup-azure-backup-import-export/opbackupnow.png)

### Подготовка диска SATA

1. Загрузите [средство импорта и экспорта Microsoft Azure](http://go.microsoft.com/fwlink/?linkid=301900&clcid=0x409) на *целевой компьютер*. Убедитесь, компьютер, на котором вы планируете выполнить следующий набор команд, имеет доступ к промежуточному расположению (см. предыдущий шаг). При необходимости целевым компьютером может быть исходный компьютер.

2. Распакуйте файл *WAImportExport.zip*. Запустите средство *WAImportExport*, которое отформатирует диск SATA, запишет резервные копии данных на диск SATA и зашифрует его. Перед выполнением следующей команды убедитесь, что на компьютере активировано средство BitLocker. <br/>

    *.\\WAImportExport.exe PrepImport /j:<*файл\_журнала*>.jrn /id: <*идентификатор\_сеанса*> /sk:<*ключ\_учетной\_записи\_хранения*> /BlobType:**PageBlob** /t:<*буква\_целевого\_диска*> /format /encrypt /srcdir:<*расположение\_промежуточного\_хранилища*> /dstdir: <*целевой\_виртуальный\_каталог\_BLOB-объектов*>/*


| Параметр | Описание
|-------------|-------------|
| /j:<*файл\_журнала*>| Путь к файлу журнала. У каждого диска должен быть только один файл журнала. Обратите внимание, что файл журнала не может находиться на целевом диске. Файла журнала имеет расширение JRN и создается в процессе выполнения этой команды.|
|/id:<*идентфикатор\_сеанса*> | Идентификатор сеанса определяет *сеанс копирования* и используется для обеспечения точного восстановления прерванного сеанса копирования. Файлы, копируемые во время сеанса копирования, хранятся в каталоге с именем, соответствующем идентификатору сеанса на целевом диске.|
| /sk:<*ключ\_учетной\_записи\_хранения*> | Ключ учетной записи хранения, в которую будут импортированы данные. Он должен совпадать с ключом, введенным при создании политики резервного копирования или группы защиты.|
| /BlobType | Укажите параметр **PageBlob**. Этот рабочий процесс завершится успешно, только если указан параметр PageBlob. Этот параметр не является параметром по умолчанию, поэтому его нужно указывать вручную. |
|/t:<*буква\_целевого\_диска*> | Буква целевого жесткого диска для текущего сеанса копирования без двоеточия в конце.|
|/format | Укажите этот параметр, если диск нужно отформатировать. В противном случае не используйте его. Прежде чем средство отформатирует диск, оно выдаст в консоли запрос на подтверждение. Чтобы запрос не выдавался, укажите параметр /silentmode.|
|/encrypt | Укажите этот параметр, если диск еще не зашифрован с помощью BitLocker и должен быть зашифрован сейчас. Если диск уже зашифрован средством BitLocker, не используйте этот параметр. Вместо него укажите параметр /bk и введите существующий ключ BitLocker. Если вы задаете параметр /format, вы также должны указать параметр /encrypt. |
|/srcdir:<*исходный\_каталог*> | Исходный каталог, содержащий файлы для копирования на целевой диск. Убедитесь, что указанное здесь имя каталога представляет собой полный путь (а не относительный).|
|/dstdir:<*целевой\_виртуальный\_каталог\_BLOB-объектов*> | Путь к целевому виртуальному каталогу в учетной записи хранилища Microsoft Azure. Указывая целевые виртуальные каталоги и BLOB-объекты, используйте правильные имена контейнеров. Обратите внимание, что имена каталогов пишутся строчными буквами. Имя контейнера должно совпадать с именем, введенным при создании политики резервного копирования или группы защиты.|

  > [AZURE.NOTE] В папке WAImportExport создается файл журнала, в который записывается вся информация о процессе. Этот файл понадобится при создании задания импорта на портале Azure.

  ![Вывод PowerShell](./media/backup-azure-backup-import-export/psoutput.png)

### Создание задания импорта на портале Azure
1. Перейдите в учетную запись хранения на [портале управления](https://manage.windowsazure.com/), щелкните вкладку **Импорт и экспорт**, а затем в области задач выберите элемент **Создать задачу импорта**.

    ![Портал](./media/backup-azure-backup-import-export/azureportal.png)

2. На шаге 1 мастера укажите, что вы подготовили диск и уже имеется доступный файл журнала На шаге 2 мастера укажите контактные данные пользователя, ответственного за это задание импорта.
3. На шаге 3 передайте файлы журналов дисков, полученные на предыдущем этапе (см. предыдущий раздел).
4. На шаге 4 введите описательное имя для задания импорта, введенное при создании политики резервного копирования или группы защиты. Обратите внимание,что вводимое имя может содержать только строчные буквы, цифры, дефисы и подчеркивания, кроме того, оно должно начинаться с буквы и не содержать пробелов. Выбранное имя будет использоваться для отслеживания выполняемых заданий, а также после их завершения.
5. Далее выберите регион своего центра обработки данных из списка. Регион центра обработки данных будет означать центр обработки данных, куда следует направить пакет.

    ![КОНТРОЛЛЕР ДОМЕНА](./media/backup-azure-backup-import-export/dc.png)

6. На шаге 5 выберите транспортного агента из списка и введите его номер учетной записи. Майкрософт будет использовать эту учетную запись для отправки дисков вам обратно после завершения задания импорта.

7. Отправьте диск и введите номер отслеживания, чтобы иметь возможность следить за состоянием доставки. Когда диск будет доставлен в ЦОД, его скопируют в учетную запись хранения, после чего состояние процесса изменится.

    ![Состояние завершения](./media/backup-azure-backup-import-export/complete.png)

### Завершение процесса
Когда начальные резервные копии данных появятся в вашей учетной записи хранения, агент службы архивации Azure скопирует из нее данные в мультитенантную учетную запись хранения службы архивации. При следующем запланированном резервном копировании агент службы архивации Azure выполняет добавочное резервное копирование поверх начальной резервной копии.

## Дальнейшие действия
- Если у вас возникли вопросы о процессе импорта и экспорта Azure, см. эту [статью](../storage/storage-import-export-service.md).
- Дополнительные сведения об автономном резервном копировании см. в [часто задаваемых вопросах о службе архивации Azure](backup-azure-backup-faq.md) в разделе «Автономное резервное копирование».

<!---HONumber=AcomDC_0615_2016-->