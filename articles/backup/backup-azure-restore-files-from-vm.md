---
title: "Служба архивации Azure: восстановление файлов и папок из резервной копии виртуальной машины Azure | Документация Майкрософт"
description: "Восстановление файлов из точки восстановления виртуальной машины Azure"
services: backup
documentationcenter: dev-center-name
author: pvrk
manager: shivamg
keywords: "восстановление на уровне элементов; восстановление файлов из резервной копии виртуальной машины Azure; восстановление файлов виртуальной машины Azure"
ms.assetid: f1c067a2-4826-4da4-b97a-c5fd6c189a77
ms.service: backup
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 2/6/2017
ms.author: pullabhk;markgal
translationtype: Human Translation
ms.sourcegitcommit: 5c31fcac727a1206cb416cbe7340392a2816729a
ms.openlocfilehash: 93b689c132ec7e391a9107e4e3eb73a48e3ba09d


---
# <a name="recover-files-from-azure-virtual-machine-backup-preview"></a>Восстановление файлов из резервной копии виртуальной машины Azure (предварительная версия)

Служба архивации Azure предоставляет возможность восстанавливать [виртуальные машины Azure и диски](./backup-azure-arm-restore-vms.md) из резервных копий виртуальных машин Azure. В этой статье объясняется, как восстановить из резервной копии виртуальной машины Azure отдельные элементы, такие как файлы и папки.

> [!Note]
> Эта функция доступна для всех виртуальных машин Azure, развернутых по модели с помощью Resource Manager и защищенных в хранилище служб восстановления.
> Функция восстановления файлов из резервной копии виртуальной машины Windows Azure сейчас находится на стадии предварительной версии. В ближайшее время будет добавлено восстановление файлов из виртуальной машины Azure для Linux.
Восстановление файлов из зашифрованной резервной копии виртуальной машины сейчас не поддерживается.
>

## <a name="mount-the-volume-and-copy-files"></a>Подключение тома и копирование файлов

1. Войдите на [портал Azure](http://portal.Azure.com). Найдите нужное хранилище служб восстановления, а в нем — нужный архивируемый элемент.

2. В колонке "Архивируемый элемент" щелкните **Восстановление файлов (предварительная версия)**.

    ![Открытие архивируемого элемента в хранилище служб восстановления](./media/backup-azure-restore-files-from-vm/open-vault-item.png)

    Откроется колонка **Восстановление файлов**.

    ![Колонка восстановления файлов](./media/backup-azure-restore-files-from-vm/file-recovery-blade.png)

3. В раскрывающемся меню **Выберите точку восстановления** найдите и выберите точку восстановления, которая содержит требуемые файлы. По умолчанию здесь выбрана последняя из созданных точек восстановления.

4. Щелкните **Download Executable** (Скачать исполняемый файл), чтобы скачать программное обеспечение для копирования файлов из точки восстановления.

  Этот исполняемый файл представляет собой скрипт, который создает подключение между локальным компьютером и указанной точкой восстановления.

5. Запустите исполняемый файл на том компьютере, куда вы хотите восстановить файлы. Скрипт необходимо запускать от имени администратора. Если скрипт выполняется на компьютере с ограниченным доступом, убедитесь в наличии доступа к следующим ресурсам:

    - сайт go.microsoft.com;
    - конечные точки Azure, которые использовались для резервного копирования этой виртуальной машины Azure;
    - исходящий порт 3260.

    ![Колонка восстановления файлов](./media/backup-azure-restore-files-from-vm/executable-output.png)

    Скрипт можно запустить на любом компьютере, операционная система на котором совпадает или совместима с операционной системой того компьютера, для которого была создана эта точка восстановления. Условия совместимости можно проверить в [таблице совместимых ОС](backup-azure-restore-files-from-vm.md#compatible-os). Исполняемый скрипт не удастся запустить на защищенной виртуальной машине Azure, которая использует дисковые пространства Windows. В таком случае следует запустить этот исполняемый скрипт на любом другом компьютере, который использует дисковые пространства Windows. Рекомендуем использовать для запуска исполняемого скрипта компьютер, операционная система которого совместима с исходной.

    ![Колонка восстановления файлов](./media/backup-azure-restore-files-from-vm/volumes-attached.png)

### <a name="compatible-os"></a>Совместимые операционные системы

Следующая таблица содержит информацию о совместимости операционных систем сервера и компьютера. Файлы не удастся восстановить на компьютере с несовместимой операционной системой.

|ОС сервера | Совместимые ОС клиента  |
| --------------- | ---- |
| Windows Server 2012 R2 | Windows 8.1 |
| Windows Server 2012    | Windows 8  |
| Windows Server 2008 R2 | Windows 7   |


### <a name="drive-letter-assignments"></a>Назначение букв дисков

При выполнении скрипта операционная система подключает новые тома и назначает им буквы дисков. Для просмотра этих дисков вы можете использовать проводник Windows или проводник. Этим томам могут быть назначены не те буквы дисков, которые использовались на исходной виртуальной машине. Имена томов сохраняются. Например, если на исходной виртуальной машине том назывался "Диск данных (E:\)", на локальном компьютере он будет подключен как "Диск данных ('любая доступная буква диска':\)". Просмотрите все тома, которые упоминаются в выходных данных скрипта, пока не найдете нужные файлы или папки.  


## <a name="closing-the-connection"></a>Закрытие подключения

Когда вы найдете все нужные файлы и скопируете их в локальное хранилище, удалите или отключите дополнительные диски. Чтобы отключить диски, щелкните **Unmount Disks** (Отключить диски) в колонке **Восстановление файлов** на портале Azure.

![Отключение дисков](./media/backup-azure-restore-files-from-vm/unmount-disks3.png)

Когда диски будут отключены, появится сообщение об успешном завершении операции. На обновление состояния подключения может потребоваться несколько минут, после чего диски можно удалить.

## <a name="windows-storage-spaces"></a>Дисковое пространство Windows

Дисковые пространства Windows — это технология службы хранилища Windows, которая позволяет виртуализировать хранилище. С помощью дисковых пространств Windows можно группировать стандартные диски в пулы носителей и создавать на их основе виртуальные диски (дисковые пространства), использующие доступное пространство в этих пулах носителей.

Исполняемый скрипт не удастся запустить на виртуальной машине Azure, для защиты которой использовались дисковые пространства Windows. В таком случае следует запустить этот исполняемый скрипт на любом другом компьютере, который использует дисковые пространства Windows. Рекомендуем использовать для запуска исполняемого скрипта компьютер, операционная система которого совместима с исходной.

## <a name="troubleshooting"></a>Устранение неполадок

Если при восстановлении файлов из виртуальных машин у вас возникнут проблемы, проверьте сведения, приведенные в следующей таблице.

| Сообщение об ошибке или ситуация | Возможные причины | Рекомендуемое действие |
| ------------------------ | -------------- | ------------------ |
| Исполняемый файл возвращает ошибку *Exception connecting to the target* (исключение при подключении к целевому объекту) |Скрипт не может получить доступ к точке восстановления    | Проверьте, соответствует ли компьютер всем перечисленным выше требованиям.|  
|    Исполняемый файл возвращает ошибку *The target has already been logged in via an ISCSI session* (Вход на целевое устройство уже выполнен через сеанс iSCSI). |    Этот скрипт уже запущен на этом компьютере и диски уже подключены |    Тома точки восстановления уже подключены. Их НЕЛЬЗЯ подключить с теми же буквами дисков, что и на исходной виртуальной машине. Просмотрите все доступные тома в проводнике, чтобы найти нужный файл. |
| Исполняемый файл возвращает ошибку *This script is invalid because the disks have been dismounted via portal/exceeded the 12-hr limit. Please download a new script from the portal.* (Этот скрипт недействителен, так как диски отключены через портал или превышено ограничение в 12 часов. Скачайте с портала новый скрипт). |    Диски отключены через портал или превышено 12-часовое ограничение |    Эта копия исполняемого файла больше недействительна, и использовать ее нельзя. Если вам еще нужен доступ к файлам этой точки восстановления на определенный момент времени, зайдите на портал и скачайте новый EXE-файл.|
| На компьютере, где выполняется EXE-файл, новые тома не отключаются кнопкой отключения |    Инициатор iSCSI на компьютере не отвечает на запросы или не обновляет подключение к целевому объекту, сохраняя состояние кэша |    Подождите несколько минут после нажатия кнопки отключения. Если новые тома по-прежнему не отключаются, откройте в проводнике каждый из них. Инициатор принудительно обновит соединение, и диски будут отключены с сообщением об ошибке "Диск недоступен".|
| Скрипт выполняется успешно, но в его выходных данных нет сообщения "New volumes attached" (Новые тома подключены). |    Это временная проблема    | Тома, скорее всего, уже подключены. Попробуйте открыть их через проводник. Если вы несколько раз запускали скрипт на одном и том же компьютере, попробуйте перезагрузить компьютер. Список будет отображаться при последующих запусках EXE-файла. |



<!--HONumber=Feb17_HO1-->


