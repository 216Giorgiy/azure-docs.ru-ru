---
title: "Восстановление виртуальных машин из резервной копии | Документация Майкрософт"
description: "Сведения о восстановлении виртуальной машины Azure из точки восстановления"
services: backup
documentationcenter: 
author: trinadhk
manager: shreeshd
editor: 
keywords: "восстановление резервной копии; восстановление; точка восстановления;"
ms.assetid: fed877b3-b496-49fb-99e4-653be7c23e3a
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/31/2016
ms.author: trinadhk; jimpark;
translationtype: Human Translation
ms.sourcegitcommit: 7de8d98f24ea01012b8fa3a326e1d4ad3f04099a
ms.openlocfilehash: 186929c1193f63ecda6fd4851bb66c8430ab99ab
ms.lasthandoff: 02/17/2017


---
# <a name="restore-virtual-machines-in-azure"></a>Восстановление виртуальных машин в Azure
> [!div class="op_single_selector"]
> * [Восстановление виртуальных машин на портале Azure](backup-azure-arm-restore-vms.md)
> * [Восстановление виртуальных машин на классическом портале](backup-azure-restore-vms.md)
> 
> 

Инструкция по восстановлению виртуальной машины в новую ВМ из резервных копий, хранящихся в службе архивации Azure.

## <a name="restore-workflow"></a>Восстановление рабочего процесса
### <a name="step-1-choose-an-item-to-restore"></a>Шаг 1. Выбор элемента для восстановления
1. Перейдите на вкладку **Защищенные элементы** и выберите виртуальную машину, которую нужно восстановить.
   
    ![Защищенные элементы](./media/backup-azure-restore-vms/protected-items.png)
   
    В столбце **Точка восстановления** на странице **Защищенные элементы** отображено количество точек восстановления для виртуальной машины. В столбце **Последняя точка восстановления** указано время последней резервной копии, из которой можно восстановить виртуальную машину.
2. Щелкните **Восстановить**, чтобы открыть мастер **восстановления элементов**.
   
    ![Восстановление элемента](./media/backup-azure-restore-vms/restore-item.png)

### <a name="step-2-pick-a-recovery-point"></a>Шаг 2. Выбор точки восстановления
1. На экране **выбора точки восстановления** можно выполнить восстановление из последней или из предыдущей точки восстановления. По умолчанию при открытии мастера выбран параметр *Последняя точка восстановления*.
   
    ![выбора точки восстановления](./media/backup-azure-restore-vms/select-recovery-point.png)
2. Чтобы выбрать более раннюю точку, в раскрывающемся списке щелкните пункт **Выберите дату**, а затем выберите дату, щелкнув **значок календаря**. В календаре все даты с точками восстановления обозначены светло-серым цветом и доступны для выбора пользователем.
   
    ![Выбор даты](./media/backup-azure-restore-vms/select-date.png)
   
    После выбора даты в календаре доступные на эту дату точки восстановления отобразятся в таблице ниже. В столбце **Время** указано время, когда был сделан моментальный снимок. В столбце **Тип** отображается [согласованность](https://azure.microsoft.com/documentation/articles/backup-azure-vms/#consistency-of-recovery-points) точки восстановления. В заголовке таблицы в скобках показано количество точек восстановления, доступных в этот день.
   
    ![Точки восстановления](./media/backup-azure-restore-vms/recovery-points.png)
3. Выберите точку восстановления из таблицы **Точки восстановления** и щелкните стрелку "Далее", чтобы перейти к следующему экрану.

### <a name="step-3-specify-a-destination-location"></a>Шаг 3. Выбор целевого расположения
1. На экране **Выбор экземпляра восстановления** укажите данные о месте восстановления виртуальной машины.
   
   * Укажите имя виртуальной машины. В этой облачной службе имя виртуальной машины должно быть уникальным. Перезапись имеющейся виртуальной машины не поддерживается. 
   * Выберите облачную службу для виртуальной машины. Это действие обязательно для создания виртуальной машины. Можно использовать существующую облачную службу или создать новую.
     
        Выбранное имя облачной службы должно быть глобально уникальным. Обычно имя облачной службы связывается с общедоступным URL-адресом, например: [облачная_служба].cloudapp.net. Azure не позволит создать облачную службу, если выбранное имя уже используется. Если вы решите создать облачную службу, ей будет назначено то же имя, что и виртуальной машине. В этом случае выбранное имя виртуальной машины должно быть также уникальным, иначе его нельзя будет использовать в качестве имени связанной облачной службы.
     
        В сведениях о восстанавливаемых экземплярах указаны только облачные службы и виртуальные сети, не связанные с территориальными группами. [Подробнее](../virtual-network/virtual-networks-migrate-to-regional-vnet.md)
2. Выберите учетную запись хранения для виртуальной машины. Это действие обязательно для создания виртуальной машины. Можно выбрать существующую учетную запись хранения в том же регионе, что и хранилище службы архивации Azure. Учетные записи хранения с избыточностью в пределах зоны, а также типа Premium не поддерживаются.
   
    Если нет учетных записей хранения с поддерживаемой конфигурацией, создайте такую учетную запись хранения до начала операции восстановления.
   
    ![Выбор виртуальной сети](./media/backup-azure-restore-vms/restore-sa.png)
3. Выберите виртуальную сеть. Виртуальную сеть (VNET) для виртуальной машины необходимо выбрать при создании ВМ. В пользовательском интерфейсе восстановления отображаются все виртуальные сети в этой подписке, которые можно использовать. Не обязательно выбирать виртуальную сеть для восстановленной виртуальной машины — можно будет подключиться к восстановленной ВМ через Интернет, даже если виртуальная сеть не используется.
   
    Если выбранная облачная служба связана с виртуальной сетью, виртуальную сеть изменить нельзя.
   
    ![Выбор виртуальной сети](./media/backup-azure-restore-vms/restore-cs-vnet.png)
4. Выберите подсеть. Если виртуальная сеть имеет подсети, по умолчанию будет выбрана первая подсеть. Выберите подсеть по своему усмотрению из раскрывающегося списка. Чтобы просмотреть сведения о подсети, перейдите к расширению "Сети" на [домашней странице портала](https://manage.windowsazure.com/), щелкните **Виртуальные сети**, выберите виртуальную сеть, а затем — "Настроить", чтобы увидеть сведения о подсети.
   
    ![Выбор подсети](./media/backup-azure-restore-vms/select-subnet.png)
5. В мастере щелкните значок **Отправить** , чтобы отправить сведения и создать задание восстановления.

## <a name="track-the-restore-operation"></a>Отслеживание операции восстановления
После ввода и отправки всех сведений в мастере восстановления служба архивации Azure попытается создать задание для отслеживания операции восстановления.

![Создание задания восстановления](./media/backup-azure-restore-vms/create-restore-job.png)

Если задание создано успешно, отобразится соответствующее всплывающее уведомление. Чтобы просмотреть дополнительные сведения, нажмите кнопку **Просмотреть задание**, в результате чего откроется вкладка **Задания**.

![Задание восстановления создано](./media/backup-azure-restore-vms/restore-job-created.png)

После завершения операции восстановления она будет помечена как завершенная на вкладке **Задания** .

![Задание восстановления завешено](./media/backup-azure-restore-vms/restore-job-complete.png)

После восстановления виртуальной машины может потребоваться повторно установить расширения, существовавшие на исходной виртуальной машине, и [изменить конечные точки](../virtual-machines/virtual-machines-windows-classic-setup-endpoints.md) для виртуальной машины на портале Azure.

## <a name="post-restore-steps"></a>Действия после восстановления
Если вы используете дистрибутив Linux на основе cloud-init (например, Ubuntu), в целях безопасности пароль будет заблокирован после восстановления. Для [сброса пароль](../virtual-machines/virtual-machines-linux-classic-reset-access.md)на восстановленной виртуальной машине рекомендуется использовать расширение VMAccess. Также мы рекомендуем использовать ключи SSH с такими дистрибутивами, чтобы предотвратить сброс пароля после восстановления. 

## <a name="backup-for-restored-vms"></a>Архивация для восстановленных виртуальных машин
Если виртуальная машина восстановлена в одной и той же облачной службе и с тем же именем, что и созданная резервная копия виртуальной машины, архивация будет продолжена после восстановления виртуальной машины. Если виртуальная машина восстановлена в другой облачной службе или для восстановленной виртуальной машины задано другое имя, она будет рассматриваться как новая виртуальная машина, и поэтому для нее потребуется настроить архивацию.

## <a name="restoring-a-vm-during-azure-datacenter-disaster"></a>Восстановление виртуальной машины в случае отказа центра обработки данных Azure
Служба архивации Azure позволяет восстанавливать резервные копии виртуальных машин в сопряженном центре обработки данных в случае отказа основного центра обработки данных, в котором запущены эти виртуальные машины, если при этом хранилище архивации настроено как геоизбыточное. В таких случаях необходимо выбрать учетную запись хранения, которая присутствует в сопряженном центре данных. Остальная часть процесса восстановления остается неизменной. В службе архивации Azure для создания восстановленной виртуальной машины используется служба вычислений, расположенная в сопряженном геообъекте. Дополнительные сведения см. в статье [Техническое руководство по обеспечению устойчивости в Azure. Восстановление после прерывания работы служб во всем регионе](../resiliency/resiliency-technical-guidance-recovery-loss-azure-region.md)

## <a name="restoring-domain-controller-vms"></a>Восстановление виртуальных машин контроллера домена
Резервное копирование виртуальных машин контроллера домена поддерживается Azure Backup. Однако при восстановлении необходимо соблюдать определенную осторожность. Процесс восстановления виртуальных машин контроллера домена в конфигурации с одним контроллером домена значительно отличается от процесса восстановления виртуальных машин контроллера домена в конфигурации с несколькими контроллерами домена.

### <a name="single-dc"></a>Один контроллер домена
В этом случае виртуальная машина может быть восстановлена (как и любая другая виртуальная машина) на портале Azure или с помощью PowerShell.

### <a name="multiple-dcs"></a>Несколько контроллеров домена
В среде с несколькими контроллерами домена у контроллеров домена есть собственные способы синхронизации данных. При восстановлении к одной из предыдущих точек резервного копирования *без соответствующих мер предосторожности*процесс восстановления USN может негативно повлиять на среду с несколькими контроллерами домена. Правильный способ восстановления такой виртуальной машины — ее загрузка в режиме DSRM.

Это вызывает сложности, поскольку режим DSRM не представлен в Azure. Поэтому для восстановления таких виртуальных машин нельзя использовать портал Azure. Единственным поддерживающим восстановление таких виртуальных машин является механизм дискового восстановления с помощью PowerShell.

> [!WARNING]
> Не используйте портал Azure для восстановления виртуальных машин контроллера домена в среде с несколькими контроллерами домена! Поддерживается только восстановление с помощью PowerShell
> 
> 

Узнайте больше о [проблеме отката USN](https://technet.microsoft.com/library/dd363553) и подходах к ее решению.

## <a name="restoring-vms-with-special-network-configurations"></a>Восстановление виртуальных машин с помощью специальных конфигураций сети
Azure Backup поддерживает создание резервных копий для следующих специальных конфигураций сети.

* Виртуальные машины с балансировщиком нагрузки (внутренним или внешним).
* Виртуальные машины с несколькими зарезервированными IP-адресами
* Виртуальные машины с несколькими сетевыми картами

При восстановлении этих конфигураций необходимо учитывать описанные ниже рекомендации.

> [!TIP]
> Для воссоздания специальной конфигурации сети виртуальной машины после восстановления используйте процедуру восстановления с помощью PowerShell.
> 
> 

### <a name="restoring-from-the-ui"></a>Восстановление из пользовательского интерфейса:
При восстановлении из пользовательского интерфейса **всегда выбирайте новую облачную службу**. Обратите внимание на то, что в процессе восстановления портал принимает только обязательные параметры, поэтому виртуальные сети, восстановленные с помощью пользовательского интерфейса, теряют специальную конфигурацию сети, которая у них имелась. Другими словами, восстановленные виртуальные машины представляют собой обычные виртуальные машины без конфигурации подсистемы балансировки нагрузки, нескольких сетевых адаптеров или зарезервированных IP-адресов.

### <a name="restoring-from-powershell"></a>Восстановление из PowerShell:
PowerShell может только восстанавливать диски виртуальной машины из резервной копии, но не создавать виртуальные машины. Это позволяет восстанавливать виртуальные машины, которым требуются описанные выше специальные конфигурации сети.

Чтобы полностью восстановить виртуальную машину после восстановления дисков, выполните описанные ниже действия.

1. Восстановите диски из резервного хранилища с помощью [инструмента PowerShell службы архивации Azure](backup-azure-vms-classic-automation.md#restore-an-azure-vm).
2. Создайте конфигурацию виртуальной машины, необходимой для балансировщика нагрузки, нескольких сетевых адаптеров или зарезервированных IP-адресов с помощью командлетов PowerShell и используйте ее для создания виртуальной машины с желаемой конфигурацией.
   
   * Создайте виртуальную машину в облачной службе с [внутренним балансировщиком нагрузки ](https://azure.microsoft.com/documentation/articles/load-balancer-internal-getstarted/)
   * Создайте виртуальную машину для подключения к [подсистеме балансировки нагрузки для Интернета](https://azure.microsoft.com/en-us/documentation/articles/load-balancer-internet-getstarted/).
   * Создайте виртуальную машину с [несколькими сетевыми адаптерами](https://azure.microsoft.com/documentation/articles/virtual-networks-multiple-nics/)
   * Создайте виртуальную машину с [несколькими зарезервированными IP-адресами](https://azure.microsoft.com/documentation/articles/virtual-networks-reserved-public-ip/)

## <a name="next-steps"></a>Дальнейшие действия
* [Устранение ошибок](backup-azure-vms-troubleshoot.md#restore)
* [Управление виртуальными машинами](backup-azure-manage-vms.md)


