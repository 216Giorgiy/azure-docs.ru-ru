<properties
	pageTitle="Резервное копирование виртуальных машин Azure — устранение неполадок | Microsoft Azure"
	description="В этой статье вы найдете сведения об устранении неполадок во время резервного копирования и восстановления виртуальных машин Azure."
	services="backup"
	documentationCenter=""
	authors="trinadhk"
	manager="shreeshd"
	editor=""/>

<tags ms.service="backup" ms.workload="storage-backup-recovery" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="10/07/2015" ms.author="trinadhk";"aashishr"/>


# Устранение неполадок при архивации виртуальных машин Azure
Для устранения ошибок, обнаруженных в ходе применения службы архивации Azure, можно использовать информацию из следующей таблицы.

## Обнаружение

| Операция резервного копирования | Сведения об ошибке | Возможное решение |
| -------- | -------- | -------|
| Обнаружение | Не удалось обнаружить новые элементы — в службе резервного копирования Microsoft Azure произошла внутренняя ошибка. Подождите несколько минут и повторите попытку. | Повторите процесс обнаружения через 15 минут.
| Обнаружение | Не удалось обнаружить новые элементы — уже выполняется другая операция обнаружения. Дождитесь завершения текущей операции обнаружения. | None |

## Зарегистрировать
| Операция резервного копирования | Сведения об ошибке | Возможное решение |
| -------- | -------- | -------|
| регистрация; | Количество дисков с данными, подключенных к виртуальной машине, превышает поддерживаемый лимит. Отключите некоторые диски с данными и повторите операцию. Служба архивации Azure поддерживает до 16 дисков с данными, подключенных к виртуальной машине Azure для резервного копирования. | None |
| Зарегистрировать | Произошла внутренняя ошибка службы архивации Microsoft Azure. Подождите несколько минут и снова запустите операцию. Если проблема будет повторяться, обратитесь в службу поддержки Майкрософт. | Эта ошибка может происходить, если применяется одна из следующих неподдерживаемых конфигураций: <ol><li>Локально избыточное хранилище Premium. <li>Несколько сетевых карт. <li>Балансировщик нагрузки (внутренний и с выходом в Интернет). </ol> |
| Зарегистрировать | Не удалось выполнить регистрацию из-за истечения времени ожидания для операции установки агента | Проверьте, поддерживается ли версия ОС виртуальной машины. |
| Зарегистрировать | Не удалось выполнить команду. С этим элементом выполняется другая операция, дождитесь ее завершения. Дождитесь завершения предыдущей операции. | None |
| Зарегистрировать | Виртуальные машины с виртуальными жесткими дисками, хранящимися в хранилище класса Premium, не поддерживаются при резервном копировании. | None |
| Зарегистрировать | На виртуальной машине отсутствует агент виртуальной машины. Установите необходимые компоненты, агент виртуальной машины и перезапустите операцию. | [Дополнительные сведения](#vm-agent) об установке агента виртуальной машины и проверке установки агента виртуальной машины. |

## Архивация

| Операция резервного копирования | Сведения об ошибке | Возможное решение |
| -------- | -------- | -------|
| Архивация | Время ожидания копирования виртуальных жестких дисков из архивного хранилища истекло. Повторите операцию через несколько минут. Если проблема будет повторяться, обратитесь в службу поддержки Майкрософт. | Это происходит, если имеется слишком много данных для копирования. Убедитесь, что у вас меньше 16 дисков данных. |
| Архивация | Не удалось связаться с агентом виртуальной машины, чтобы проверить состояние моментального снимка. Истекло время ожидания подзадачи моментального снимка виртуальной машины. Инструкции по решению этой проблемы см. в руководстве по устранению неполадок. | Данная ошибка возникает, если существует проблема с агентом виртуальной машины, или каким-то образом заблокирован сетевой доступ к инфраструктуре Azure. <ul><li>Сведения об [отладке агента виртуальной машины](#vm-agent). <li>Сведения об [отладке сети](#networking). </ul><br>Если агент виртуальной машины не вызывает проблем, перезапустите виртуальную машину. Иногда проблемы возникают из-за неправильного состояния виртуальной машины. Его можно сбросить, перезапустив виртуальную машину. |
| Архивация | Произошла внутренняя ошибка архивации. Повторите операцию через несколько минут. Если проблема будет повторяться, обратитесь в службу поддержки Майкрософт | Эта ошибка может возникнуть по двум причинам: <ol><li> Имеется слишком много данных для копирования. <li>Исходная виртуальная машина удалена, поэтому, резервное копирование не может быть выполнено. Чтобы сохранить данные резервных копий для удаленной виртуальной машины, но прекратить появление ошибок при резервном копировании, снимите защиту с виртуальной машины и выберите вариант, при котором данные сохраняются. В результате резервное копирование будет остановлено, и перестанут появляться сообщения об ошибках. |
| Архивация | Не удалось установить расширение служб восстановления Azure для выбранного элемента. Необходимым условием для расширения служб восстановления Azure является наличие агента виртуальной машины. Установите агент виртуальной машины Azure и перезапустите операцию регистрации. | <ol> <li>Убедитесь, что агент виртуальной машины установлен правильно. <li>Убедитесь, что флаг в конфигурации виртуальной машины имеет правильное значение.</ol> [Дополнительные сведения](#validating-vm-agent-installation) об установке агента виртуальной машины и проверке установки агента виртуальной машины. |
| Архивация | Не удалось выполнить команду. С этим элементом выполняется другая операция. Дождитесь завершения предыдущей операции и повторите попытку. | Выполняется текущее задание резервного копирования или восстановления для виртуальной машины. В это время запуск нового задания невозможен. |
| Архивация | Во время установки расширения произошла ошибка «Отсутствует связь COM+ с координатором распределенных транзакций». | Обычно это означает, что служба COM+ не запущена. Чтобы устранить эту проблему, обратитесь в службу поддержки Майкрософт. |
| Архивация | Во время операции создания снимка возникла ошибка операции VSS «Этот диск заблокирован программой шифрования диска BitLocker. Вернитесь к панели управления, чтобы разблокировать диск». | Отключите BitLocker для всех дисков на виртуальной машине и проверьте, устранена ли проблема с VSS. |
| Архивация | Виртуальные машины с виртуальными жесткими дисками, хранящимися в хранилище класса Premium, не поддерживаются при резервном копировании. | None |
| Архивация | Резервное копирование виртуальной машины с конфигурацией балансировщика нагрузки не поддерживается. | Нет <br><br>Относится к внутренним балансировщикам нагрузки и балансировщикам нагрузки с выходом в Интернет.|
| Резервное копирование | Резервное копирование виртуальной машины с несколькими сетевыми картами не поддерживается. | None |
| Архивация | Виртуальная машина Azure не найдена. | Это происходит, когда основная виртуальная машина удаляется, но политика резервного копирования продолжает поиск виртуальной машины, чтобы выполнить резервное копирование. Чтобы исправить эту ошибку, сделайте следующее. <ol><li>Повторно создайте виртуальную машину с тем же именем и тем же именем группы ресурсов [имя облачной службы]. <br>(ИЛИ) <li> Отключите защиту этой виртуальной машины, чтобы задания резервного копирования не создавались. </ol> |
| Архивация | На виртуальной машине отсутствует агент виртуальной машины. Установите необходимые компоненты, агент виртуальной машины и перезапустите операцию. | [Дополнительные сведения](#vm-agent) об установке агента виртуальной машины и проверке установки агента виртуальной машины. |

## Задания
| Операция | Сведения об ошибке | Возможное решение |
| -------- | -------- | -------|
| Отмена задания | Для этого типа задания отмена не поддерживается. Дождитесь завершения задания. | None |
| Отмена задания | Состояние задания не позволяет его отменить. Дождитесь завершения задания. <br>ИЛИ<br> Состояние выбранного задания не позволяет его отменить. Дождитесь завершения задания.| Скорее всего, задание почти выполнено. Дождитесь завершения задания. |
| Отмена задания | Нельзя отменить задание, так как оно не выполняется. Задания можно отменять только в процессе выполнения. Попытайтесь отменить выполняющееся задание. | Это происходит из-за переходного состояния. Подождите минуту и повторите отмену. |
| Отмена задания | Не удалось отменить задание. Дождитесь завершения задания. | None |


## Восстановление
| Операция | Сведения об ошибке | Возможное решение |
| -------- | -------- | -------|
| Восстановление | Сбой восстановления из-за внутренней ошибки облака | <ol><li>В облачной службе, в которую вы пытаетесь выполнить восстановление, настроены параметры DNS. Проверьте параметр <br>$deployment = Get-AzureDeployment -ServiceName "ServiceName" -Slot "Production" Get-AzureDns -DnsSettings $deployment.DnsSettings<br>Если настроен адрес, это означает, что настроены параметры DNS.<br> <li>В облачной службе, в которую вы пытаетесь выполнить восстановление, настроен параметр ReservedIP, а существующие в ней виртуальные машины находятся в остановленном состоянии.<br>Проверьте, есть ли в облачной службе зарезервированный IP-адрес, используя следующие командлеты PowerShell:<br>$deployment = Get-AzureDeployment -ServiceName "servicename" -Slot "Production" $dep.ReservedIPName</ol> |
| Восстановление | Выбранное DNS-имя уже занято. Укажите другое DNS-имя и повторите попытку. | Указанное здесь DNS-имя ссылается на имя облачной службы (обычно с расширением CLOUDAPP.NET). Это имя должно быть уникальным. Если возникает эта ошибка, во время восстановления необходимо выбрать другое имя виртуальной машины. <br><br> Обратите внимание, что эту ошибку видят только пользователи портала Azure. Восстановление с помощью PowerShell будет выполнено успешно, так как восстанавливаются только диски, а виртуальная машина не создается. Ошибка возникнет, если вы явно создадите виртуальную машину после восстановления дисков. |
| Восстановление | Указана неправильная конфигурация виртуальной сети. Укажите другую конфигурацию виртуальной сети и повторите попытку. | None |
| Восстановление | Указанная облачная служба использует зарезервированный IP-адрес, который не совпадает с конфигурацией восстанавливаемой виртуальной машины. Укажите другую облачную службу, которая не использует зарезервированный IP-адрес, или выберите другую точку восстановления. | None |
| Восстановление | Облачная служба достигла ограничения на количество входных конечных точек. Повторите операцию, указав другую облачную службу или используя существующую конечную точку. | None |
| Восстановление | Хранилище службы архивации и целевая учетная запись хранения находятся в двух разных регионах. Убедитесь, что учетная запись хранения, указанная в операции восстановления, находится в том же регионе Azure, что и хранилище службы архивации. | None |
| Восстановление | Учетная запись хранения, указанная для операции восстановления, не поддерживается. Поддерживаются только базовые или стандартные учетные записи хранения с локально избыточными или геоизбыточными параметрами репликации. Выберите поддерживаемую учетную запись хранения. | None |
| Восстановление | Тип учетной записи хранения, указанной для операции восстановления, не подключен к сети. Убедитесь, что учетная запись хранения, указанная в операции восстановления, подключена к сети. | Это может произойти из-за временных ошибок в службе хранилища Azure или из-за сбоя. Выберите другую учетную запись хранения. |
| Восстановление | Достигнута квота группы ресурсов. Удалите некоторые группы ресурсов с портала предварительной версии или обратитесь в службу поддержки Azure, чтобы увеличить квоту. | None |
| Восстановление | Выбранная подсеть не существует. Выберите существующую подсеть. | None |


## Политика
| Операция | Сведения об ошибке | Возможное решение |
| -------- | -------- | -------|
| Создание политики | Не удалось создать политику. Сократите количество вариантов хранения, чтобы продолжить настройку политики. | None |


## Агент виртуальной машины

### Настройка агента виртуальной машины
Как правило, агент виртуальной машины уже имеется на виртуальных машинах, которые созданы с помощью коллекции Azure. Однако на виртуальных машинах, которые переносятся из локальных центров обработки данных, агента виртуальной машины не будет. Для таких виртуальных машин агент ВМ необходимо установить явным образом. Подробности об [установке агента ВМ на существующей виртуальной машине](http://blogs.msdn.com/b/mast/archive/2014/04/08/install-the-vm-agent-on-an-existing-azure-vm.aspx).

Для виртуальных машин Windows:

- Скачайте и установите [MSI-файл агента](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409). Чтобы выполнить установку, необходимо иметь права администратора.
- [Обновите свойство виртуальной машины](http://blogs.msdn.com/b/mast/archive/2014/04/08/install-the-vm-agent-on-an-existing-azure-vm.aspx), чтобы указать, что агент установлен.

Для виртуальных машин Linux:

- Установите последнюю версию [агента Linux](https://github.com/Azure/WALinuxAgent) с сайта GitHub.
- [Обновите свойство виртуальной машины](http://blogs.msdn.com/b/mast/archive/2014/04/08/install-the-vm-agent-on-an-existing-azure-vm.aspx), чтобы указать, что агент установлен.


### Обновление агента виртуальной машины
Для виртуальных машин Windows:

- Обновление агента виртуальной машины — это простая процедура, схожая с переустановкой [двоичных файлов агента виртуальной машины](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409). Тем не менее, необходимо убедиться, что во время обновления агента виртуальной машины никакие операции резервного копирования не выполняются.

Для виртуальных машин Linux:

- Следуйте указаниям по [обновлению агента виртуальных машин Linux](../virtual-machines-linux-update-agent.md).


### Проверка установки агента виртуальной машины
Для проверки версии агента ВМ на виртуальных машинах Windows выполните следующие действия:

1. Войдите в систему виртуальной машины Azure и перейдите в папку *C:\\WindowsAzure\\Packages*. В ней должен находиться файл WaAppAgent.exe.
2. Щелкните этот файл правой кнопкой мыши, выберите пункт **Свойства** и перейдите на вкладку **Подробно**. В поле "Версия продукта" должно отображаться значение 2.6.1198.718 или выше.

## Сеть
Как и в случае со всеми другими расширениями, для нормальной работы расширению резервного копирования требуется доступ к общедоступному Интернету. Отсутствие доступа к общедоступному Интернету может приводить к различным проблемам:

- Операция установки расширения может завершаться с ошибкой.
- Операции резервного копирования (например, создание моментального снимка диска) могут завершаться с ошибкой.
- Операция отображения состояния процесса резервного копирования может завершаться с ошибкой.

Потребность в разрешении общедоступных IP-адресов более подробно разъяснена [здесь](http://blogs.msdn.com/b/mast/archive/2014/06/18/azure-vm-provisioning-stuck-on-quot-installing-extensions-on-virtual-machine-quot.aspx). Вам будет нужно проверить конфигурации DNS для виртуальной сети и убедиться, что URL-адреса Azure можно разрешить.

После правильного разрешения имен также требуется предоставить доступ к IP-адресам Azure. Чтобы разблокировать доступ к инфраструктуре Azure, выполните следующие действия.

1. Получите список [IP-адресов центра обработки данных Azure ](https://msdn.microsoft.com/library/azure/dn175718.aspx) для добавления в разрешенный список.
2. Разблокируйте IP-адреса с помощью командлета [New-NetRoute](https://technet.microsoft.com/library/hh826148.aspx). Запустите этот командлет на ВМ Azure в окне PowerShell с повышенными привилегиями (запустите от имени администратора).

<!---HONumber=Oct15_HO3-->