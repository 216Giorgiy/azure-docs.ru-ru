---
title: Мониторинг сетевых подключений с помощью службы "Наблюдатель за сетями Azure" на портале Azure | Документация Майкрософт
description: Сведения о том, как отслеживать сетевое подключение с помощью службы "Наблюдатель за сетями Azure" с использованием портала Azure.
services: network-watcher
documentationcenter: na
author: jimdial
manager: jeconnoc
editor: ''
ms.service: network-watcher
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/16/2018
ms.author: jdial
ms.openlocfilehash: 0d550d3bda119cfcb9ecc6f852006d5e325fdfa3
ms.sourcegitcommit: 20d103fb8658b29b48115782fe01f76239b240aa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2018
---
# <a name="monitor-network-connections-with-azure-network-watcher-using-the-azure-portal"></a>Мониторинг сетевых подключений с помощью службы "Наблюдатель за сетями Azure" с использованием портала Azure

В этой статье вы узнаете, как использовать монитор подключения для мониторинга сетевого подключения между виртуальной машиной Azure и IP-адресом. Монитор подключения позволяет выполнять мониторинг между исходным и конечным IP-адресом и портом. Он поддерживает такие сценарии, как мониторинг подключения через порт 1433 между виртуальной машиной в виртуальной сети и виртуальной машиной с запущенным сервером SQL Server в одной и той же или другой виртуальной сети. Монитор подключения регистрирует значение задержки подключения в виде метрики Azure Monitor, записываемой каждые 60 секунд. Также он предоставляет топологию по прыжкам и выявляет возможные проблемы с конфигурацией, влияющие на подключение.

## <a name="prerequisites"></a>предварительным требованиям

Для выполнения действий в этой статье требуются следующие компоненты.

* Экземпляр службы "Наблюдатель за сетями" в регионе, в котором нужно отслеживать подключение. Если у вас его еще нет, создайте экземпляр, следуя инструкциям в статье [Создание экземпляра Наблюдателя за сетями Azure](network-watcher-create.md).
* Виртуальная машина, используемая для отслеживания. Дополнительные сведения о создании виртуальной машины Windows или Linux см. в [этой](../virtual-machines/windows/quick-create-portal.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json) или [этой](../virtual-machines/linux/quick-create-portal.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json) статье соответственно.
* Расширение `AzureNetworkWatcherExtension`, установленное на виртуальной машине, с которой вы хотите отслеживать подключение. Сведения об установке расширения виртуальной машины Windows см. в статье [Расширение виртуальной машины агента Наблюдателя за сетями для Windows](../virtual-machines/windows/extensions-nwa.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json), а для виртуальной машины Linux — [Расширение виртуальной машины агента Наблюдателя за сетями для Linux](../virtual-machines/linux/extensions-nwa.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json).

## <a name="sign-in-to-azure"></a>Вход в Azure 

Войдите на [портале Azure](http://portal.azure.com).

## <a name="create-a-connection-monitor"></a>Создание монитора подключения

Следующие действия позволят включить мониторинг подключения к целевой виртуальной машине через порты 80 и 1433.

1. В левой области портала выберите **Все службы**.
2. Начните вводить *наблюдатель за сетями* в поле **Фильтр**. Когда в результатах поиска появится **Наблюдатель за сетями**, выберите его.
3. В разделе **Мониторинг** выберите **Connection monitor** (Монитор подключений).
4. Щелкните **+ Добавить**.
5. Укажите информацию о подключении, которое требуется отслеживать, а затем выберите **Добавить**. В примере, показанном на следующем рисунке, отслеживается подключение между виртуальными машинами *MultiTierApp0* и *Database0* через порт 80:

    ![Добавление монитора подключения](./media/connection-monitor/add-connection-monitor.png)

    Мониторинг начинается. Проверки выполняются каждые 60 секунд.
6. Выполните шаг 5 еще раз, указав те же исходные и конечные виртуальные машины и следующие значения.
    
    |Параметр  |Значение          |
    |---------|---------      |
    |ИМЯ     | AppToDB(1433) |
    |Порт     | 1433          |

## <a name="view-connection-monitoring"></a>Просмотр мониторинга подключения

1. Выполните шаги 1–3 в разделе [Создание монитора подключения](#create-a-connection-monitor) для просмотра мониторинга подключения.
2. На следующем рисунке показаны сведения о подключении *AppToDB(80)*. **Состояние** — доступно. **Представление графа** показывает **среднее время кругового пути** и **долю проб с ошибками в процентах**. Граф предоставляет сведения по прыжкам и информирует об отсутствии проблем, которые могут влиять на доступность места назначения.

    ![Представление графа](./media/connection-monitor/view-graph.png)

3. Просмотр подключения *AppToDB(1433)*, показанного на следующем рисунке, позволяет увидеть, что для тех же исходной и целевой виртуальных машин состояние является недоступным через порт 1433. **Представление сетки** в этом сценарии предоставляет сведения по переходам и указывает на проблему, влияющую на доступность. В этом случае правило NSG блокирует весь трафик на порту 1433 при втором переходе.

    ![Представление сетки](./media/connection-monitor/view-grid.png)

## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения об автоматизации записи пакетов с помощью оповещений на виртуальной машине см. в статье [Использование записи пакетов для упреждающего мониторинга сети с помощью оповещений и функций Azure](network-watcher-alert-triggered-packet-capture.md).
- Определите, разрешен ли определенный входящий или исходящий трафик на вашей виртуальной машине, используя функцию [проверки IP-потока](network-watcher-check-ip-flow-verify-portal.md).