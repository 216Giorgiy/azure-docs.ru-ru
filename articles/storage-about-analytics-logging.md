<properties 
	pageTitle="Информация о ведении журнала аналитики хранилища" 
	description="Информация об использовании журнала аналитики хранилища и запросов, прошедших и не прошедших аутентификацию, а также о том, как хранятся журналы. " 
	services="storage" 
	documentationCenter="" 
	authors="tamram" 
	manager="adinah" 
	editor="cgronlun"/>

<tags 
	ms.service="storage" 
	ms.workload="storage" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="02/20/2015" 
	ms.author="tamram"/>

# Информация о ведении журнала аналитики хранилища

## Обзор
В аналитике хранилища регистрируется подробная информация об успешных и неудачных запросах к службе хранилища. Эта информация может использоваться для мониторинга отдельных запросов и диагностики неполадок в службе хранилища. Запросы вносятся в журнал наилучшим возможным образом.

Для использования аналитики хранилища ее необходимо включить отдельно для каждой из отслеживаемых служб. Ее можно включить на [портале управления Azure](https://manage.windowsazure.com/). Дополнительную информацию см. в разделе [Как отслеживать учетные записи хранения на портале управления Azure](../how-to-monitor-a-storage-account). Аналитику хранилища также можно включить программно через REST API или клиентскую библиотеку. Чтобы включить аналитику хранилища для каждой службы, используйте операции Get Blob Service Properties, Get Queue Service Properties и Get Table Service Properties.

Записи журнала создаются только при условии активности службы хранилища. Например, если обнаруживается активность учетной записи хранения в службе BLOB-объектов, но не в службе таблиц или очередей, то создаются журналы, которые относятся только к службе BLOB-объектов.

##Ведение журналов запросов, прошедших аутентификацию
Регистрируются запросы, прошедшие аутентификацию, следующих типов:

- успешные запросы;

- неудачные запросы, в том числе из-за ошибок, связанных с временем ожидания, регулированием, сетью, авторизацией и др.;

- запросы, в которых используется подписанный URL-адрес (SAS), в том числе неудачные и успешные запросы;

- запросы к данным аналитики.

Запросы, выполненные в самой аналитике хранилища, такие как запросы на создание или удаление журнала, не регистрируются. Полный список регистрируемых данных приведен в разделах [Операции с протоколированием и сообщения о состоянии аналитик хранилища](https://msdn.microsoft.com/library/hh343260.aspx) и [Формат журналов аналитик хранилища](https://msdn.microsoft.com/library/hh343259.aspx).

##Ведение журналов анонимных запросов
Регистрируются анонимные запросы следующих типов:

- успешные запросы;

- ошибки сервера;

- ошибки времени ожидания для клиента и сервера;

- неудачные запросы GET с кодом ошибки 304 (не изменено).

Остальные неудачные анонимные запросы не регистрируются. Полный список регистрируемых данных приведен в разделах [Операции с протоколированием и сообщения о состоянии аналитик хранилища](https://msdn.microsoft.com/library/hh343260.aspx) и [Формат журналов аналитик хранилища](](https://msdn.microsoft.com/library/hh343259.aspx)).

##Хранение журналов
Все журналы хранятся в блочных больших двоичных объектах в контейнере $logs, который автоматически создается при включении аналитики хранилища для учетной записи хранения. Контейнер $logs находится в пространстве имен больших двоичных объектов учетной записи хранения, например:  `http://<accountname>.blob.core.windows.net/$logs`. После включения аналитики хранилища этот контейнер нельзя удалить, но вы можете удалить его содержимое.

>[Azure.NOTE] Контейнер $logs не отображается при выполнении операции листинга контейнеров, например с использованием метода [ListContainers](https://msdn.microsoft.com/library/ee758348.aspx). Доступ к нему можно получить только непосредственно. Например, можно использовать метод [ListBlobs](https://msdn.microsoft.com/library/ee772878.aspx) для получения доступа к большим двоичным объектам в контейнере $logs.
По мере регистрации запросов в аналитике хранилища промежуточные результаты передаются в качестве блоков. Периодически эти блоки фиксируются в аналитике хранилища и к ним предоставляется доступ как к большим двоичным объектам.

В журналах, созданных в один и тот же час, могут присутствовать повторяющиеся записи. Вы можете определить, является ли запись двойной, проверив **код запроса** и номер **операции**.

##Соглашения об именовании журналов
Каждый журнал записывается в следующем формате:

    <service-name>/YYYY/MM/DD/hhmm/<counter>.log 

В следующей таблице описан каждый атрибут имени журнала:

| Атрибут      	| Описание                                                                                                                                                                                	|
|----------------	|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|
| <имя_службы> 	| имя службы хранилища. Например: blob, table или queue.                                                                                                                        	|
| ГГГГ           	| Четырехзначное обозначение года создания журнала. Например: 2011                                                                                                                                         	|
| ММ             	| Двухзначное обозначение месяца создания журнала. Например: 07                                                                                                                                           	|
| ДД             	| Двухзначное обозначение месяца создания журнала. Например: 07                                                                                                                                           	|
| чч             	| Двухзначное обозначение часа, которое указывает час начала ведения журнала, в 24-часовом формате времени UTC. Например: 18                                                                                   	|
| мм             	| Двухзначное обозначение минуты, которое указывает минуту начала ведения журнала. >[AZURE.NOTE]Это значение не поддерживается в текущей версии аналитики хранилища, а его значение всегда равно 00. 	|
| <счетчик>      	| Шестизначный счетчик с отсчетом от нуля, который показывает количество больших двоичных объектов журнала, созданных для службы хранилища в течение часа. Отсчет этого счетчика начинается с 000000. Например: 000001   	|

Ниже приведен пример полного имени журнала, в котором представлены все упомянутые атрибуты имени.

    blob/2011/07/31/1800/000001.log

Ниже приведен пример URI, который можно использовать для получения доступа к указанному журналу.

    https://<accountname>.blob.core.windows.net/$logs/blob/2011/07/31/1800/000001.log 

При регистрации запроса хранилища имя результирующего журнала сопоставляется с часом завершения запрошенной операции. Например, если запрос GetBlob был завершен в 18:30 31.07.2011 г., то журнал будет записан со следующим префиксом: "blob/2011/07/31/1800/".

##Метаданные журнала
Все большие двоичные объекты журнала хранятся с метаданными, с помощью которых можно определить, какие данные журнала содержит большой двоичный объект. В следующей таблице описан каждый атрибут метаданных.

| Атрибут  	| Описание                                                                                                                                                                                                                                               	|
|------------	|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|
| LogType    	| Описывает, содержит ли журнал информацию, относящуюся к операциям чтения, записи или удаления. Это значение может содержать данные одного типа или сочетание всех трех типов данных, разделенных запятыми.   Пример 1. write. Пример 2. read,write. Пример 3. read,write,delete. 	|
| StartTime  	| Время первой записи в журнале в формате ГГГГ-ММ-ДДTчч:мм:ссZ. Например: 2011-07-31T18:21:46Z                                                                                                                                          	|
| EndTime    	| Время последней записи в журнале в формате ГГГГ-ММ-ДДTчч:мм:ссZ. Например: 2011-07-31T18:22:09Z                                                                                                                                            	|
| LogVersion 	| Версия формата журнала. В настоящее время поддерживается только одно значение: 1.0                                                                                                                                                                                 	|

В следующем списке показан полный образец метаданных с использованием приведенных выше примеров:

- LogType=write 

- StartTime=2011-07-31T18:21:46Z 

- EndTime=2011-07-31T18:22:09Z 

- LogVersion=1.0 

##Доступ к данным журнала

Доступ ко всем данным в контейнере $logs можно получить с помощью API службы BLOB-объектов, включая API-интерфейсы .NET, предоставленные в управляемой библиотеке Azure. Администратор учетной записи хранения может читать и удалять журналы, но не может создавать или обновлять их. Метаданные журнала и его имя можно использовать при запросе журнала. Журналы в определенный час могут отображаться не по порядку, но метаданные всегда указывают промежуток времени, охватываемый записями журнала. Таким образом, при поиске конкретного журнала можно использовать сочетание имен журналов и метаданных.

##Дальнейшие действия

[Формат журналов аналитик хранилища](https://msdn.microsoft.com/library/hh343259.aspx)

[Операции с протоколированием и сообщения о состоянии аналитик хранилища](https://msdn.microsoft.com/library/hh343260.aspx) 

[Информация о метриках аналитики хранилища](https://msdn.microsoft.com/library/hh343258.aspx)
<!--HONumber=47-->
