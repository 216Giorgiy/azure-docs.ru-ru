<properties
   pageTitle="Определение зависимостей в шаблонах диспетчера ресурсов Azure"
   description="В этой статье описан способ определения зависимостей между ресурсами во время развертывания."
   services="azure-resource-manager"
   documentationCenter="na"
   authors="tfitzmac"
   manager="timlt"
   editor=""/>

<tags
   ms.service="azure-resource-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="12/07/2015"
   ms.author="tomfitz"/>

# Определение зависимостей в шаблонах диспетчера ресурсов Azure

Для ресурса может существовать несколько вышестоящих и дочерних зависимостей, имеющих критическое значение для успешной работы топологии. Зависимости от других ресурсов можно определить с помощью свойств ресурса **dependsOn** и **resources**. Зависимость также можно задать с помощью функции **reference**.

    {
        "name": "<name-of-the-resource>",
        "type": "<resource-provider-namespace/resource-type-name>",
        "apiVersion": "<supported-api-version-of-resource>",
        "location": "<location-of-resource>",
        "tags": { <name-value-pairs-for-resource-tagging> },
        "dependsOn": [ <array-of-related-resource-names> ],
        "properties": { <settings-for-the-resource> },
        "resources": { <dependent-resources> }
    }

 Существуют также ссылки на ресурсы, которые могут определять связи между ресурсами и позволяют определять эти связи между группами ресурсов.

## Свойство dependsOn

Для конкретной виртуальной машины зависимость может выражаться в необходимости наличия подготовленного к работе ресурса базы данных. В другом случае зависимость может выражаться в необходимости установки в кластере нескольких узлов перед развертыванием виртуальной машины с помощью средства управления кластером.

В шаблоне такую зависимость ресурса можно определить в свойстве dependsOn. В качестве значения свойства может выступать разделенный запятыми список имен ресурсов. Вычисляются зависимости между ресурсами, и ресурсы развертываются в порядке зависимости. Если ресурсы не зависят друг от друга, выполняется попытка их параллельного развертывания.

Если вы склонны использовать свойство dependsOn для сопоставления зависимостей между ресурсами, вам важно понимать, зачем вы это делаете. Дело в том, что такое решение может иметь последствия для производительности развертывания. Например, если вы делаете это для того, чтобы задокументировать связи между ресурсами, использование свойства dependsOn будет неправильным решением. Жизненный цикл свойства dependsOn ограничен только этапом развертывания. После развертывания это свойство становится недоступным, поэтому вы не сможете получить данные о зависимостях ресурсов. Используя dependsOn, вы рискуете ограничить возможности развертывания, так как существует вероятность того, что обработчик не сможет полноценно работать в режиме параллелизма (тогда как это нужно для максимальной эффективности). Чтобы задокументировать связи между ресурсами и сохранить возможность извлечения этой информации в будущем, используйте [ссылки на ресурсы](resource-group-link-resources.md).

Этот элемент не требуется, если для получения представления ресурса используется функция reference. Это связано с тем, что объект ссылки подразумевает зависимость от ресурса. Если у вас есть выбор между использованием функции reference и свойства dependsOn, мы советуем использовать функцию reference и неявные ссылки. Основная причина этого выбора — производительность. Ссылки определяют неявные зависимости, которые являются обязательными, так как в шаблоне есть на них ссылки. Сами ссылки являются относительными, благодаря чему вам не нужно дополнительно оптимизировать производительность развертывания и решать проблемы параллелизма.

Если необходимо определить зависимость между ресурсом и ресурсами, которые создаются с помощью цикла копирования, можно указать в значении элемента dependsOn имя цикла. Пример см. в статье [Создание нескольких экземпляров ресурсов в диспетчере ресурсов Azure](resource-group-create-multiple.md).

## ресурсов

Свойство resources позволяет указать дочерние ресурсы, связанные с определяемым ресурсом. Дочерние ресурсы можно определять максимум на 5 нижестоящих уровнях. Важно отметить, что неявная зависимость между дочерним и родительским ресурсами не создается. Если вам нужно, чтобы дочерний ресурс был развернут после родительского ресурса, эту зависимость необходимо явно указать в свойстве dependsOn.

Каждый родительский ресурс принимает в качестве дочерних ресурсов только определенные типы ресурсов. Принимаемые типы ресурсов указаны в [схеме шаблона](https://github.com/Azure/azure-resource-manager-schemas) родительского ресурса. Имя типа дочернего ресурса содержит имя типа родительского ресурса, например: **Microsoft.Web/sites/config** и **Microsoft.Web/sites/extensions** являются дочерними ресурсами по отношению к **Microsoft.Web/sites**.

## Функция reference

Функция reference позволяет выражению получать его значение из других пар «имя JSON — значение» или ресурсов среды выполнения. Выражения со ссылками неявно объявляют, что один ресурс зависит от другого. Свойство, представленное в **propertyPath** ниже, указывать необязательно. Если оно не указано, ссылка указывает на ресурс.

    reference('resourceName').propertyPath

Зависимости можно указать как с помощью этой функции, так и с помощью свойства dependsOn, но использовать оба варианта для одного зависимого ресурса не нужно. Мы советуем использовать неявные ссылки. Таким образом ненужный элемент dependsOn не сможет помешать обработчику развертывания параллельно выполнять разные аспекты развертывания.

Дополнительные сведения см. в разделе о [функции reference](../resource-group-template-functions/#reference).

## Дальнейшие действия

- Сведения о создании шаблонов диспетчера ресурсов Azure см. в статье [Создание шаблонов](resource-group-authoring-templates.md). 
- Список доступных в шаблоне функций см. в статье [Функции шаблонов](resource-group-template-functions.md).

<!---HONumber=AcomDC_0316_2016-->