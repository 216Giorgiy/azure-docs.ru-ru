<properties title="Начало работы со службой поиска Azure" pageTitle="Начало работы со службой поиска Azure" description="Начало работы со службой поиска Azure" metaKeywords="" services="Azure Search" solutions="" documentationCenter="" authors="Heidist" manager="mblythe" videoId="" scriptId="" />

<tags ms.service="azure-search" ms.devlang="" ms.workload="search" ms.topic="article" ms.tgt_pltfrm="" ms.date="09/23/2014" ms.author="heidist" />

# Начало работы со службой поиска Azure

[WACOM.INCLUDE [В этой статье используется портал предварительной версии Azure](../includes/preview-portal-note.md)]

Поиск Microsoft Azure (общедоступная предварительная версия) является новой службой, позволяющей встраивать поисковые функции в настраиваемые приложения. Он предоставляет поисковую систему и хранилище данных, к которым можно обращаться и которыми можно управлять посредством API REST. С более подробной информацией о возможностях использования службы поиска Azure можно ознакомиться в разделе [Поисковые сценарии и возможности Azure][Поисковые сценарии и возможности Azure].

Как администратор, вы можете бесплатно добавить службу Поиска в существующую подписку при выборе общей службы либо по сниженной цене при выборе службы для выделенных ресурсов. Данная статья состоит из следующих разделов:

<!--Table of contents -->

-   [Приступая к работе с бесплатной службой][Приступая к работе с бесплатной службой]
-   [Обновление Поиска до стандартного уровня][Обновление Поиска до стандартного уровня]
-   [Операции тестирования службы][Операции тестирования службы]
-   [Обзор панели мониторинга службы поиска][Обзор панели мониторинга службы поиска]
-   [Попробуйте сейчас][Попробуйте сейчас]

## Приступая к работе с бесплатной службой

Подписчики автоматически получают бесплатный доступ к общей мультитенатной службе Поиска, которую можно использовать в целях обучения, экспериментального тестирования или для разработки небольших проектов поиска. Для того чтобы подписаться на бесплатную версию, выполните нижеуказанные действия.

1.  Войдите на [портал предварительной версии Azure][портал предварительной версии Azure] с помощью существующей учетной записи подписки. Обратите внимание, что по ссылке производится переход на портал предварительной версии. Использование предварительной версии портала является обязательным.

2.  В нижней части страницы щелкните **Создать**.

    ![][0]

3.  Нажмите **Все** в верхней части страницы.

    ![][1]

4.  В коллекции нажмите **Данные, хранилища, кэш + резервное копирование**.

    ![][2]

5.  Нажмите **Показать все**, чтобы развернуть список всех служб, связанных с обработкой данных.

    ![][3]

6.  В списке служб обработки данных нажмите **Поиск**.

    ![][4]

7.  В нижней части страницы щелкните **СОЗДАТЬ**.

8.  Введите имя службы строчными буквами для использования в URL службы, не используйте дефисы, пробелы, максимальная длина не должна превышать 15 символов.

    ![][5]

9.  Нажмите на стрелку в **Уровень ценообразования**, чтобы выбрать вариант ценообразования. Выберите **БЕСПЛАТНО**, затем нажмите **ВЫБРАТЬ** в нижней части страницы. Бесплатная версия предоставляет достаточный объем для прохождения учебного курса и написания экспериментального кода, однако она не предназначена для промышленной эксплуатации.

    ![][6]

10. Нажмите на стрелку в **Группа ресурса** и выберите существующую группу, либо создайте новую. Группы ресурсов — это контейнеры для служб и ресурсов, используемых для одной и той же цели. Например, если вы создаете пользовательские приложения поиска на основе Поиска Azure, веб-сайтов Azure, хранилища BLOB-объектов Azure, то можно создать группу ресурсов, которая будет объединять все эти службы вместе на страницах портала управления.

11. Нажмите на стрелку в **Подписка**, если у вас имеется несколько подписок и вы хотите использовать другую подписку для этой службы.

12. Нажмите на стрелку в **Расположение**, чтобы выбрать регион центра обработки данных. Для данной предварительной версии регион можно выбрать из Запада США, Востока США, Северной Европы и Юго-Восточной Азии. Позднее будут включены прочие регионы. Выберите один регион для создаваемой службы. Распределение ресурсов между несколькими центрами обработки данных может быть недоступно для конфигурации для общедоступный предварительный версии.

13. Нажмите кнопку **Создать**, чтобы подготовить службу. Обратите внимание, что кнопка **CREATE** становится доступна только после заполнения всех необходимых полей.

Через несколько минут служба будет создана. Можете вернуться к настройкам конфигурации, чтобы получить ссылки URL или ключи API. Для подключения к службе Поиска необходимо иметь как URL, так и ключ API, чтобы проверить подлинность при вызове. Эти значения можно получить следующим образом:

1.  Перейдите **Просмотр** | **Все** | **Данные, хранилища, кэш + резервное копирование** | **Показать все** | **Службы поиска**, выберите службу поиска чтобы открыть панель мониторинга.

    ![][7]

2.  На панели мониторинга вы увидите заголовки для **СВОЙСТВ** **КЛЮЧЕЙ**, а также информацию об использовании, которая показывает использование ресурсов.

    ![][8]

**СВОЙСТВА**, указан URL службы.

**КЛЮЧИ** указаны ключи API для проверки подлинности.

**ИСПОЛЬЗОВАНИЕ** указано количество документов, доступные ресурсы и лимиты хранилища.

Перейдите к разделу [Операции тестирования службы][Операции тестирования службы], чтобы получить инструкции по подключению к службе с использованием этих значений.

## Обновление Поиска до стандартного уровня

Стандартный Поиск предоставляет выделенные ресурсы в центре обработки данных Azure, которые могут использоваться только вами. Рабочие нагрузки поиска требуют реплики как хранилищ, так и служб. После подписки на стандартный Поиск вы можете оптимизировать конфигурацию службы, чтобы получить максимальную отдачу в зависимости от того, какой ресурс является наиболее важным для вашего сценария.

Наличие выделенных ресурсов даст вам большую возможность масштабирования и лучшую производительность, но не дополнительные функции. Функции общего и стандартного поиска совпадают.

Чтобы пользоваться стандартным поиском, создайте новую службу Поиска, выбрав уровень ценообразования «Стандартный». Обратите внимание, что это обновление не является замещением для бесплатной версии. Для того чтобы перейти к стандартной версии с ее возможностью масштабирования, необходимо создать новую службу. Вам потребуется повторно загрузить индексы и документы, которые используются приложением поиска.

Настройка выделенных ресурсов может занять некоторое время (15 минут и более).

**Шаг 1. Создание новой службы со стандартным уровнем ценообразования**

1.  Войдите на [портал предварительной версии Azure][портал предварительной версии Azure] с помощью существующей учетной записи подписки.

2.  В нижней части страницы щелкните **Создать**.

3.  Нажмите **Все** в верхней части страницы.

4.  В коллекции нажмите **Данные, хранилища, кэш + резервное копирование**.

5.  Нажмите **Показать все**, чтобы развернуть список всех служб, связанных с обработкой данных.

6.  В списке служб обработки данных нажмите **Поиск**.

7.  В нижней части страницы щелкните **СОЗДАТЬ**.

8.  Введите имя службы строчными буквами для использования в URL службы, не используйте дефисы, пробелы, максимальная длина не должна превышать 15 символов.

9.  Нажмите на стрелку в **Уровень ценообразования**, чтобы выбрать вариант ценообразования. Выберите **СТАНДАРТНЫЙ**, затем нажмите **ВЫБРАТЬ** в нижней части страницы.

![][9]

**Шаг 2. Настройка единиц поиска на основе требований к масштабируемости**

Стандартный поиск создается с одной репликой и одним разделом, но легко может быть отмасштабирован на более высоких уровнях ресурсов.

1.  После создания службы вернитесь в панель мониторинга службы и выберите заголовок **Масштабирование**.

2.  Воспользуйтесь ползунками для добавления реплик, разделов или того и другого.

Счета за дополнительные реплики и разделы выставляются в единицах поиска. Итоговое количество единиц поиска, которое требуется для поддержки определенной конфигурации ресурсов, отображается на странице по мере добавления ресурсов. Для получения информации по стоимости единицы можно воспользоваться разделом [Сведения о ценах][Сведения о ценах].

![][10]

## Операции тестирования службы

Подтверждение того, что ваша служба находится в рабочем состоянии и доступна из клиентского приложения, является заключительным этапом в настройке Поиска. В данной процедуре для формирования HTTP-запросов и просмотра ответов используется отладчик Fiddler, его можно [бесплатно загрузить с Telerik][бесплатно загрузить с Telerik]. Используя Fiddler, можно тестировать API непосредственно, без необходимости написания кода.

Ниже приведена процедура, она работает как для общего, так и для стандартного поиска. Выполнив приведенные ниже шаги, вы создадите индекс, загрузите документы, выполните запрос к индексу, а затем запросите у системы служебную информацию.

### Создание индекса

1.  Запустите Fiddler. В меню File выключите **Capture Traffic (Захватывать трафик)**, чтобы не показывать постороннюю активность HTTP, не связанную с текущей задачей. На вкладке Composer сформулируйте запрос, который выглядит как:

    ![][11]

2.  Выберите **PUT**.

3.  Введите URL, который задает URL службы (его можно найти на странице «Свойства»), атрибуты запроса и версию API. Не забывайте:

-   Используйте префикс HTTPS.
-   Атрибут запроса: "/indexes/hotels". В этом случае Поиск создает индекс с именем hotels.
-   Версия API вводится строчными буквами, в виде "?api-version=2014-07-31-preview". Версии API имеют важное значение, так как обновления Поиска Azure разворачиваются на регулярной основе. В редких случаях обновление службы может привести к нарушению функционирования API. При использовании версий API вы можете продолжать использовать выбранную версию и обновить ее, когда будет удобно.

    Полный URL должен выглядеть подобно этому примеру:

         https://my-app.search.windows.net/indexes/hotels?api-version=2014-07-31-Preview

1.  Укажите заголовок запроса, заменив адрес узла и ключ API значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

2.  В теле запроса скопируйте их в поля, формирующие определение индекса.

         {
        "name": "hotels",  
        "fields": [
          {"name": "hotelId", "type": "Edm.String", "key":true, "searchable": false},
          {"name": "baseRate", "type": "Edm.Double"},
          {"name": "description", "type": "Edm.String", "filterable": false, "sortable": false, "facetable": false, "suggestions": true},
          {"name": "hotelName", "type": "Edm.String", "suggestions": true},
          {"name": "category", "type": "Edm.String"},
          {"name": "tags", "type": "Collection(Edm.String)"},
          {"name": "parkingIncluded", "type": "Edm.Boolean"},
          {"name": "smokingAllowed", "type": "Edm.Boolean"},
          {"name": "lastRenovationDate", "type": "Edm.DateTimeOffset"},
          {"name": "rating", "type": "Edm.Int32"},
          {"name": "location", "type": "Edm.GeographyPoint"}
         ] 
        }

3.  Нажмите **Execute (Выполнить)**.

Через несколько секунд появится ответ HTTP 204, что говорит об успешном создании индекса.

Если вы получите код HTTP 504, проверьте, что в URL указан протокол HTTPS. Если возникают сообщения об ответных кодах 400 или 404 протокола HTTP, следует удостовериться в отсутствии ошибок при копировании. Код HTTP 403, как правило, означает, что возникла ошибка с ключом API (либо он недействительный, либо имеется ошибка синтаксиса при указании ключа).

### Загрузка документов

На вкладке Composer запрос на добавление документов будет выглядеть примерно так: Тело запроса содержит данные поиска для четырех отелей.

![][12]

1.  Выберите **POST**.

2.  Введите URL, начинающийся с HTTPS, далее URL вашей службы, далее "/indexes/\<'indexname'\>/docs/index?api-version=2014-07-31-preview". Полный URL должен выглядеть подобно этому примеру:

        https://my-app.search.windows.net/indexes/hotels/docs/index?api-version=2014-07-31-Preview

3.  Заголовок запроса должен остаться таким же, как прежде. Не забывайте, что вы заменили адрес узла и ключ API (строчные буквы) значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

4.  Тело запроса содержит четыре документа, которые нужно добавить в индекс отелей.

        {
        "value": [
        {
            "@search.action": "upload",
            "hotelId": "1",
            "baseRate": 199.0,
            "description": "Best hotel in town",
            "hotelName": "Fancy Stay",
            "category": "Luxury",
            "tags": ["pool", "view", "wifi", "concierge"],
            "parkingIncluded": false,
            "smokingAllowed": false,
            "lastRenovationDate": "2010-06-27T00:00:00Z",
            "rating": 5,
            "location": { "type": "Point", "coordinates": [-122.131577, 47.678581] }
          },
          {
            "@search.action": "upload",
            "hotelId": "2",
            "baseRate": 79.99,
            "description": "Cheapest hotel in town",
            "hotelName": "Roach Motel",
            "category": "Budget",
            "tags": ["motel", "budget"],
            "parkingIncluded": true,
            "smokingAllowed": true,
            "lastRenovationDate": "1982-04-28T00:00:00Z",
            "rating": 1,
            "location": { "type": "Point", "coordinates": [-122.131577, 49.678581] }
          },
          {
            "@search.action": "upload",
            "hotelId": "3",
            "baseRate": 279.99,
            "description": "Surprisingly expensive",
            "hotelName": "Dew Drop Inn",
            "category": "Bed and Breakfast",
            "tags": ["charming", "quaint"],
            "parkingIncluded": true,
            "smokingAllowed": false,
            "lastRenovationDate": null,
            "rating": 4,
            "location": { "type": "Point", "coordinates": [-122.33207, 47.60621] }
          },
          {
            "@search.action": "upload",
            "hotelId": "4",
            "baseRate": 220.00,
            "description": "This could be the one",
            "hotelName": "A Hotel for Everyone",
            "category": "Basic hotel",
            "tags": ["pool", "wifi"],
            "parkingIncluded": true,
            "smokingAllowed": false,
            "lastRenovationDate": null,
            "rating": 4,
            "location": { "type": "Point", "coordinates": [-122.12151, 47.67399] }
          }
         ]
        }

5.  Нажмите **Execute (Выполнить)**.

Через несколько секунд в списке сеансов появится ответ HTTP 200. Это означает, что документы были успешно созданы. Код 207 говорит об ошибке загрузки хотя бы одного из документов. Код 404 говорит о синтаксической ошибке в заголовке или в теле запроса.

### Запрос индекса

После загрузки индекса и документов можно формировать запросы к ним. На вкладке Composer команда GET, которая запрашивает вашу службу, будет выглядеть примерно так:

![][13]

1.  Выберите **GET**.

2.  Введите URL, начинающийся с HTTPS, далее URL вашей службы, далее "/indexes/\<'indexname'\>/docs?", далее параметры запроса. В качестве примера используйте этот URL, заменив имя узла на имя, соответствующее вашей службе.

        https://my-app.search.windows.net/indexes/hotels/docs?search=motel&facet=category&facet=rating,values:1|2|3|4|5&api-version=2014-07-31-Preview

    Запрос ищет термин «мотель» и возвращает плоский список категорий для рейтинга.

3.  Заголовок запроса должен остаться таким же, как прежде. Не забывайте, что вы заменили адрес узла и ключ API (строчные буквы) значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

Код ответа должен быть 200 и сам ответ должен выглядеть похожим на приведенный на рисунке.

![][14]

Ниже приведен пример запроса из [Работа с поисковым индексом (API Поиска Azure)][Работа с поисковым индексом (API Поиска Azure)] на MSDN. Многие примеры запросов в данном разделе включают пробелы, что является недопустимым в Fiddler. Замените все пробелы символом + перед вставкой в строку запроса и его выполнением в Fiddler:

**До замены пробелов:**

        GET /indexes/hotels/docs?search=*&$orderby=lastRenovationDate desc&api-version=2014-07-31-Preview

**После замены пробелов символом +:**

        GET /indexes/hotels/docs?search=*&$orderby=lastRenovationDate+desc&api-version=2014-07-31-Preview

### Запрос к системе

Также можно формировать запросы к системе для получения количества документов и занятого объема хранилища. На вкладке Composer ваш запрос будет выглядеть примерно так, как показано ниже. Ответ вернет количество документов и объем занятого пространства.

![][15]

1.  Выберите **GET**.

2.  Введите URL, включающий URL вашей службы, далее "/indexes/hotels/stats?api-version=2014-07-31-Preview":

        https://my-app.search.windows.net/indexes/hotels/stats?api-version=2014-07-31-Preview 

3.  Укажите заголовок запроса, заменив адрес узла и ключ API значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

4.  Не заполняйте тело запроса.

5.  Нажмите **Execute (Выполнить)**. Через несколько секунд в списке сеансов появится ответ HTTP 200. Выберите запись, которая сопровождается вашей командой.

6.  Щелкните вкладку Inspectors | Headers, затем выберите JSON format. Вы увидите количество документов и занятый ими размер (в килобайтах).

    ![][16]

## Обзор панели мониторинга службы поиска

Если вы хотите освежить в памяти сведения о том, где найти страницы конфигурации, выполните следующие действия, чтобы найти панель мониторинга службы.

1.  Войдите на [портал предварительной версии Azure][портал предварительной версии Azure] с помощью существующей учетной записи подписки.
2.  Щелкните **Обзор** | **Все**.

    ![][17]

3.  Выберите **Поиск служб** из списка. Вы увидите список всех служб Поиска, созданных в подписке.

4.  Щелкните по службе, чтобы открыть панель мониторинга. Обратите внимание на команды **Запустить**, **Остановить** и **Удалить** в верхней части страницы. Панель мониторинга службы включает плитки для просмотра свойств, ключей и быстрого начала работы, где размещены ссылки на информацию и инструкции. Пролистайте вниз, чтобы посмотреть использование служб.

5.  Щелкните **СВОЙСТВА**. Справа откроется страница «Свойства». URL службы отображается в верхней части страницы. Чтобы получить ключи API для проверки подлинности при подключении к службе, нажмите **КЛЮЧИ**.

    ![][8]

<!--Next steps and links -->

## Попробуйте сейчас

Вы готовы к следующему шагу? Следующие ссылки содержат дополнительный материал, который расскажет вам о том, как создавать и управлять приложениями поиска, использующих Поиск Azure.

-   [Создание первого решения для поиска Azure][Создание первого решения для поиска Azure]

-   [Пример по созданию геопространственного поиска Azure][Пример по созданию геопространственного поиска Azure]

-   [Управление решением Поиска в Microsoft Azure][Управление решением Поиска в Microsoft Azure]

-   [Технические сведения о Поиске Azure][Технические сведения о Поиске Azure]

-   [API REST Поиска Azure][API REST Поиска Azure]

-   [Видео на канале 9. Введение в Поиск Azure][Видео на канале 9. Введение в Поиск Azure]

-   [Видео на канале 9. Поиск Azure и геопространственные данные][Видео на канале 9. Поиск Azure и геопространственные данные]

-   [Видеоролик № 152 об облачном покрытии. Создание индекса в Поиске Azure][Видеоролик № 152 об облачном покрытии. Создание индекса в Поиске Azure]

<!--Anchors-->\r\n<!--Image references-->\r\n<!--Link references-->

  [Поисковые сценарии и возможности Azure]: http://azure.microsoft.com/blog/2014/08/28/azure-search-scenarios-and-capabilities/
  [Приступая к работе с бесплатной службой]: #sub-1
  [Обновление Поиска до стандартного уровня]: #sub-2
  [Операции тестирования службы]: #sub-3
  [Обзор панели мониторинга службы поиска]: #sub-4
  [Попробуйте сейчас]: #next-steps
  [портал предварительной версии Azure]: https://portal.azure.com
  [0]: ./media/search-get-started/AzureSearch_Configure1_1_New.PNG
  [1]: ./media/search-get-started/AzureSearch_Configure1_2_Everything.PNG
  [2]: ./media/search-get-started/Azuresearch_Configure1_3_Gallery.PNG
  [3]: ./media/search-get-started/AzureSearch_Configure1_4_GallerySeeAll.PNG
  [4]: ./media/search-get-started/AzureSearch_Configure1_5_DataServicesList.PNG
  [5]: ./media/search-get-started/AzureSearch_Configure1_6_URL.PNG
  [6]: ./media/search-get-started/AzureSearch_Configure1_7_Free.PNG
  [7]: ./media/search-get-started/AzureSearch_Configure1_8_SearchServiceList.PNG
  [8]: ./media/search-get-started/AzureSearch_Configure1_18_Explore.PNG
  [9]: ./media/search-get-started/AzureSearch_Configure1_9_Standard.PNG
  [Сведения о ценах]: http://go.microsoft.com/fwlink/p/?LinkID=509792
  [10]: ./media/search-get-started/AzureSearch_Configure1_10_ScaleUp.PNG
  [бесплатно загрузить с Telerik]: http://www.telerik.com/fiddler
  [11]: ./media/search-get-started/AzureSearch_Configure1_11_PUTIndex.PNG
  [12]: ./media/search-get-started/AzureSearch_Configure1_12_POSTDocs.PNG
  [13]: ./media/search-get-started/AzureSearch_Configure1_13_GETQuery.PNG
  [14]: ./media/search-get-started/AzureSearch_Configure1_14_GETQueryResponse.PNG
  [Работа с поисковым индексом (API Поиска Azure)]: http://msdn.microsoft.com/ru-ru/library/dn798927.aspx
  [15]: ./media/search-get-started/AzureSearch_Configure1_15_Stats.PNG
  [16]: ./media/search-get-started/AzureSearch_Configure1_16_StatsResponse.PNG
  [17]: ./media/search-get-started/AzureSearch_Configure1_17_BrowseEverything.PNG
  [Создание первого решения для поиска Azure]: ../search-create-first-solution/
  [Пример по созданию геопространственного поиска Azure]: ../search-create-geospatial/
  [Управление решением Поиска в Microsoft Azure]: ../search-manage/
  [Технические сведения о Поиске Azure]: http://msdn.microsoft.com/ru-ru/library/dn798933.aspx
  [API REST Поиска Azure]: http://msdn.microsoft.com/ru-ru/library/dn798935.aspx
  [Видео на канале 9. Введение в Поиск Azure]: http://channel9.msdn.com/Shows/Data-Exposed/Introduction-To-Azure-Search
  [Видео на канале 9. Поиск Azure и геопространственные данные]: http://channel9.msdn.com/Shows/Data-Exposed/Azure-Search-and-Geospatial-Data
  [Видеоролик № 152 об облачном покрытии. Создание индекса в Поиске Azure]: http://channel9.msdn.com/Shows/Cloud+Cover/Cloud-Cover-152-Azure-Search-with-Liam-Cavanagh
