<properties 
	pageTitle="Начало работы со службой поиска Azure" 
	description="Начало работы со службой поиска Azure" 
	services="search" 
	documentationCenter="" 
	authors="HeidiSteen" 
	manager="mblythe" 
	editor=""/>

<tags 
	ms.service="search" 
	ms.devlang="rest-api" 
	ms.workload="search" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.date="01/16/2015" 
	ms.author="heidist"/>
# Начало работы со службой поиска Azure

[WACOM.INCLUDE [В этой статье используется портал Azure Preview](../includes/preview-portal-note.md)]

Поиск Microsoft Azure (общедоступная предварительная версия) является новой службой, позволяющей встраивать поисковые функции в настраиваемые приложения. Он предоставляет поисковую систему и хранилище данных, к которым можно обращаться и которыми можно управлять посредством API REST. Чтобы узнать больше о преимуществах Поиска Azure, см. статью [Сценарии и возможности Поиска Azure](http://azure.microsoft.com/blog/2014/08/28/azure-search-scenarios-and-capabilities/).  

Как администратор, вы можете бесплатно добавить службу Поиска в существующую подписку при выборе общей службы либо по сниженной цене при выборе службы для выделенных ресурсов. Данная статья состоит из следующих разделов:

<!--Table of contents -->

+ [Начало работы с бесплатной службой](#sub-1)
+ [Обновление до стандартного поиска](#sub-2)
+ [Операции тестирования службы](#sub-3)
+ [Обзор панели мониторинга службы поиска](#sub-4)
+ [Попробовать](#next-steps)

<h2 id="sub-1">Начало работы с бесплатной службой</h2>

Подписчики автоматически получают бесплатный доступ к общей мультитенантной службе поиска, которую можно использовать в целях обучения, экспериментального тестирования или для разработки небольших проектов поиска. Для того чтобы подписаться на бесплатную версию, выполните нижеуказанные действия.

1. Войдите на [портал Azure Preview](https://portal.azure.com) с помощью существующей подписки. Обратите внимание, что по ссылке производится переход на портал предварительной версии. Использование предварительной версии портала является обязательным. 

2. В нижней части страницы щелкните **Создать**.
 
  	![][6]

3. Щелкните **Все** вверху страницы. 

  	![][7]

4. В коллекции выберите **Data, storage, cache, + backup** (Данные, хранилище, кэш + резервное копирование).
 
  	![][8]

5. Щелкните **Больше**, чтобы развернуть список всех служб, связанных с данными. 

  	![][9]

6. В списке служб данных выберите **Search** (Поиск).
 
  	![][10]

7. В нижней части страницы поиска нажмите кнопку **Создать**.

8. Введите имя службы строчными буквами для использования в URL службы, не используйте дефисы, пробелы, максимальная длина не должна превышать 15 символов.
 
  	![][11]

9. Щелкните стрелку в поле **Pricing Tier** (Ценовая категория), чтобы выбрать вариант ценообразования. Выберите **FREE** (Бесплатно), а затем нажмите кнопку **SELECT** (Выбрать) в нижней части страницы. Бесплатная версия предоставляет достаточный объем для прохождения учебного курса и написания экспериментального кода, однако она не предназначена для промышленной эксплуатации. 

  	![][12]

10. Щелкните стрелку в поле **Resource Group** (Группа ресурсов), чтобы выбрать существующую группу или создать новую. Группы ресурсов - это контейнеры для служб и ресурсов, используемых с общей целью. Например, если вы создаете пользовательские приложения поиска на основе Поиска Azure, веб-сайтов Azure, хранилища BLOB-объектов Azure, то можно создать группу ресурсов, которая будет объединять все эти службы вместе на страницах портала управления.

11. Щелкните стрелку в поле **Subscription** (Подписка), если у вас несколько подписок и необходимо использовать другую для этой службы поиска.

12. Щелкните стрелку в поле **Location** (Расположение), чтобы выбрать расположение центра обработки данных. Для данной предварительной версии регион можно выбрать из Запада США, Востока США, Северной Европы и Юго-Восточной Азии. Позднее будут включены прочие регионы. Выберите один регион для создаваемой службы. Распределение ресурсов между несколькими центрами обработки данных может быть недоступно для конфигурации для общедоступный предварительный версии.

13. Нажмите кнопку **Создать**, чтобы подготовить службу к работе. Обратите внимание: кнопка **Создать** активируется только после указания всех обязательных значений. 

Через несколько минут служба будет создана. Можете вернуться к настройкам конфигурации, чтобы получить ссылки URL или ключи API. Для подключения к службе Поиска необходимо иметь как URL, так и ключ API, чтобы проверить подлинность при вызове. Эти значения можно получить следующим образом:

14. Перейдите к разделу **Просмотр** | **Все** | **Data, storage, cache, + backup** (Данные, хранилище, кэш + резервное копирование) | **See All** (Просмотреть все) | **Search Services** (Службы поиска), щелкните свою поисковую службу, чтобы открыть панель мониторинга службы. 

  	![][13]

15.	На панели мониторинга службы отображаются плитки **PROPERTIES** (Свойства) и **KEYS** (Ключи), а также краткие сведения об использовании ресурса. 

  	![][23]

   Плитка **PROPERTIES** (Свойства) содержит URL-адрес службы. 

   Плитка **KEYS** (Ключи) содержит api-ключи, используемые для аутентификации.
 
   На плитке **USAGE** (Использование) отображается количество документов, доступные ресурсы и размер хранилища.

Ознакомьтесь с разделом [Операции тестирования службы],(#sub-3) чтобы узнать, как подключиться к службе с помощью этих значений.


<h2 id="sub-2">Обновление Поиска до стандартного уровня</h2>

Стандартный Поиск предоставляет выделенные ресурсы в центре обработки данных Azure, которые могут использоваться только вами. Рабочие нагрузки поиска требуют реплики как хранилищ, так и служб. После подписки на стандартный Поиск вы можете оптимизировать конфигурацию службы, чтобы получить максимальную отдачу в зависимости от того, какой ресурс является наиболее важным для вашего сценария.

Наличие выделенных ресурсов даст вам большую возможность масштабирования и лучшую производительность, но не дополнительные функции. Функции общего и стандартного поиска совпадают.

Чтобы пользоваться стандартным поиском, создайте новую службу Поиска, выбрав уровень ценообразования "Стандартный". Обратите внимание, что это обновление не является замещением для бесплатной версии. Для того чтобы перейти к стандартной версии с ее возможностью масштабирования, необходимо создать новую службу. Вам потребуется повторно загрузить индексы и документы, которые используются приложением поиска.

Настройка выделенных ресурсов может занять некоторое время (15 минут и более). 

**Шаг 1. Создание новой службы стандартной ценовой категории**

1. Войдите на [портал Azure Preview](https://portal.azure.com) с помощью существующей подписки. 

2. В нижней части страницы щелкните **Создать**.

3. Щелкните **Все** вверху страницы.

4. В коллекции выберите **Data, storage, cache, + backup** (Данные, хранилище, кэш + резервное копирование).

5. Щелкните **Больше**, чтобы развернуть список всех служб, связанных с данными.

6. В списке служб данных щелкните **Search**.

7. В нижней части страницы поиска нажмите кнопку **Создать**.

8. Введите имя службы строчными буквами для использования в URL службы, не используйте дефисы, пробелы, максимальная длина не должна превышать 15 символов.

9. Щелкните стрелку в поле **Pricing Tier** (Ценовая категория), чтобы выбрать вариант ценообразования. Выберите пункт **STANDARD** (Стандартная), а затем нажмите кнопку **SELECT** (Выбрать) в нижней части страницы.

 ![][14]

**Шаг 2. Настройка единиц поиска на основе требований к масштабируемости**

Стандартный поиск создается с одной репликой и одним разделом, но легко может быть отмасштабирован на более высоких уровнях ресурсов.

1.	Как только служба будет создана, вернитесь на панель мониторинга и щелкните плитку **Scale** (Масштаб).

2.	Воспользуйтесь ползунками для добавления реплик, разделов или того и другого. 

Счета за дополнительные реплики и разделы выставляются в единицах поиска. Итоговое количество единиц поиска, которое требуется для поддержки определенной конфигурации ресурсов, отображается на странице по мере добавления ресурсов. Можно просмотреть [Pricing Details](http://go.microsoft.com/fwlink/p/?LinkID=509792) (Сведения о ценообразовании), чтобы узнать о стоимости продуктов.

 ![][15]

  
<h2 id="sub-3">Операции тестирования службы</h2>

Подтверждение того, что ваша служба находится в рабочем состоянии и доступна из клиентского приложения, является заключительным этапом в настройке Поиска. В этой процедуре для формирования HTTP-запросов и просмотра ответов используется отладчик Fiddler, который можно [бесплатно скачать на сайте Telerik](http://www.telerik.com/fiddler). Используя Fiddler, можно тестировать API непосредственно, без необходимости написания кода. 

Ниже приведена процедура, она работает как для общего, так и для стандартного поиска. Выполнив приведенные ниже шаги, вы создадите индекс, загрузите документы, выполните запрос к индексу, а затем запросите у системы служебную информацию.

<h3>Создание индекса</h3>

1. Запустите Fiddler. В меню File (Файл) отключите параметр **Capture Traffic** (Захватывать трафик), чтобы не отображать постороннюю активность HTTP, не связанную с текущей задачей. На вкладке Composer сформулируйте запрос, который выглядит как: 

  	![][16]

2. Выберите **PUT**.

3. Введите URL, который задает URL службы (его можно найти на странице "Свойства"), атрибуты запроса и версию API. Не забывайте:
   + Используйте префикс HTTPS.
   + Атрибут запроса: "/indexes/hotels". В этом случае Поиск создает индекс с именем hotels.
   + Версия API вводится строчными буквами, в виде "?api-version=2014-07-31-preview". Версии API имеют важное значение, так как обновления Поиска Azure разворачиваются на регулярной основе. В редких случаях обновление службы может привести к нарушению функционирования API. При использовании версий API вы можете продолжать использовать выбранную версию и обновить ее, когда будет удобно.

    Полный URL должен выглядеть подобно этому примеру:

         https://my-app.search.windows.net/indexes/hotels?api-version=2014-07-31-Preview

4.	Укажите заголовок запроса, заменив адрес узла и ключ API значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

5.	В теле запроса скопируйте их в поля, формирующие определение индекса.

         {
        "name": "hotels",  
        "fields": [
          {"name": "hotelId", "type": "Edm.String", "key":true, "searchable": false},
          {"name": "baseRate", "type": "Edm.Double"},
          {"name": "description", "type": "Edm.String", "filterable": false, "sortable": false, "facetable": false, "suggestions": true},
          {"name": "hotelName", "type": "Edm.String", "suggestions": true},
          {"name": "category", "type": "Edm.String"},
          {"name": "tags", "type": "Collection(Edm.String)"},
          {"name": "parkingIncluded", "type": "Edm.Boolean"},
          {"name": "smokingAllowed", "type": "Edm.Boolean"},
          {"name": "lastRenovationDate", "type": "Edm.DateTimeOffset"},
          {"name": "rating", "type": "Edm.Int32"},
          {"name": "location", "type": "Edm.GeographyPoint"}
         ] 
        }

6.	Щелкните **Execute** (Выполнить).

Через несколько секунд появится ответ HTTP 201, что говорит об успешном создании индекса. 

Если вы получите код HTTP 504, проверьте, что в URL указан протокол HTTPS. Если возникают сообщения об ответных кодах 400 или 404 протокола HTTP, следует удостовериться в отсутствии ошибок при копировании. Код HTTP 403, как правило, означает, что возникла ошибка с ключом API (либо он недействительный, либо имеется ошибка синтаксиса при указании ключа).

<h3>Загрузка документов</h3>

На вкладке Composer запрос на добавление документов будет выглядеть примерно так: Тело запроса содержит данные поиска для четырех отелей.

   ![][17]

1. Выберите **POST**.

2.	Введите URL, начинающийся с HTTPS, далее URL вашей службы, далее "/indexes/<'indexname'>/docs/index?api-version=2014-07-31-preview". Полный URL должен выглядеть подобно этому примеру:

        https://my-app.search.windows.net/indexes/hotels/docs/index?api-version=2014-07-31-Preview

3.	Заголовок запроса должен остаться таким же, как прежде. Не забывайте, что вы заменили адрес узла и ключ API (строчные буквы) значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

4.	Тело запроса содержит четыре документа, которые нужно добавить в индекс отелей.

        {
        "value": [
        {
        	"@search.action": "upload",
        	"hotelId": "1",
        	"baseRate": 199.0,
        	"description": "Best hotel in town",
        	"hotelName": "Fancy Stay",
        	"category": "Luxury",
        	"tags": ["pool", "view", "wifi", "concierge"],
        	"parkingIncluded": false,
        	"smokingAllowed": false,
        	"lastRenovationDate": "2010-06-27T00:00:00Z",
        	"rating": 5,
        	"location": { "type": "Point", "coordinates": [-122.131577, 47.678581] }
          },
          {
        	"@search.action": "upload",
        	"hotelId": "2",
        	"baseRate": 79.99,
        	"description": "Cheapest hotel in town",
        	"hotelName": "Roach Motel",
        	"category": "Budget",
        	"tags": ["motel", "budget"],
        	"parkingIncluded": true,
        	"smokingAllowed": true,
        	"lastRenovationDate": "1982-04-28T00:00:00Z",
        	"rating": 1,
        	"location": { "type": "Point", "coordinates": [-122.131577, 49.678581] }
          },
          {
        	"@search.action": "upload",
        	"hotelId": "3",
        	"baseRate": 279.99,
        	"description": "Surprisingly expensive",
        	"hotelName": "Dew Drop Inn",
        	"category": "Bed and Breakfast",
        	"tags": ["charming", "quaint"],
        	"parkingIncluded": true,
        	"smokingAllowed": false,
        	"lastRenovationDate": null,
        	"rating": 4,
        	"location": { "type": "Point", "coordinates": [-122.33207, 47.60621] }
          },
          {
        	"@search.action": "upload",
        	"hotelId": "4",
        	"baseRate": 220.00,
        	"description": "This could be the one",
        	"hotelName": "A Hotel for Everyone",
        	"category": "Basic hotel",
        	"tags": ["pool", "wifi"],
        	"parkingIncluded": true,
        	"smokingAllowed": false,
        	"lastRenovationDate": null,
        	"rating": 4,
        	"location": { "type": "Point", "coordinates": [-122.12151, 47.67399] }
          }
         ]
        }

8.	Щелкните **Execute** (Выполнить).

Через несколько секунд в списке сеансов появится ответ HTTP 200. Это означает, что документы были успешно созданы. Код 207 говорит об ошибке загрузки хотя бы одного из документов. Код 404 говорит о синтаксической ошибке в заголовке или в теле запроса.

<h3>Запрос индекса</h3>

После загрузки индекса и документов можно формировать запросы к ним.  На вкладке Composer команда GET, которая запрашивает вашу службу, будет выглядеть примерно так:

   ![][18]

1.	Выберите **GET**.

2.	Введите URL, начинающийся с HTTPS, далее URL вашей службы, далее "/indexes/<'indexname'>/docs?", далее параметры запроса. В качестве примера используйте этот URL, заменив имя узла на имя, соответствующее вашей службе.

        https://my-app.search.windows.net/indexes/hotels/docs?search=motel&facet=category&facet=rating,values:1|2|3|4|5&api-version=2014-07-31-Preview

    Запрос ищет термин "мотель" и возвращает плоский список категорий для рейтинга.

3.	Заголовок запроса должен остаться таким же, как прежде. Не забывайте, что вы заменили адрес узла и ключ API (строчные буквы) значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

Код ответа должен быть 200 и сам ответ должен выглядеть похожим на приведенный на рисунке.
 
   ![][19]

Ниже приведен пример запроса из статьи [Работа с индексом поиска (API Поиска Azure)](http://msdn.microsoft.com/library/dn798927.aspx) библиотеки MSDN. Многие примеры запросов в данном разделе включают пробелы, что является недопустимым в Fiddler. Замените все пробелы символом + перед вставкой в строку запроса и его выполнением в Fiddler: 

**До замены пробелов:**

        GET /indexes/hotels/docs?search=*&$orderby=lastRenovationDate desc&api-version=2014-07-31-Preview

**После замены пробелов знаком +:**

        GET /indexes/hotels/docs?search=*&$orderby=lastRenovationDate+desc&api-version=2014-07-31-Preview

<h3>Запрос к системе</h3>

Также можно формировать запросы к системе для получения количества документов и занятого объема хранилища. На вкладке Composer ваш запрос будет выглядеть примерно так, как показано ниже. Ответ вернет количество документов и объем занятого пространства.

   ![][20]

1.	Выберите **GET**.

2.	Введите URL, включающий URL вашей службы, далее "/indexes/hotels/stats?api-version=2014-07-31-Preview":

        https://my-app.search.windows.net/indexes/hotels/stats?api-version=2014-07-31-Preview 

3.	Укажите заголовок запроса, заменив адрес узла и ключ API значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

4.	Не заполняйте тело запроса.

5.	Щелкните **Execute** (Выполнить). Через несколько секунд в списке сеансов появится ответ HTTP 200. Выберите запись, которая сопровождается вашей командой.

6.	Щелкните вкладку Inspectors | Headers, затем выберите JSON format. Вы увидите количество документов и занятый ими размер (в килобайтах).

 	![][21]

<h2 id="sub-4">Обзор панели мониторинга службы поиска</h2>

Если вы хотите освежить в памяти сведения о том, где найти страницы конфигурации, выполните следующие действия, чтобы найти панель мониторинга службы.

1.	Войдите на [портал Azure Preview](https://portal.azure.com) с помощью существующей подписки. 
2.	Щелкните **Просмотр ** | **Все**.

 	![][22]

3.	Выберите в списке пункт **Search services** (Службы поиска). Вы увидите список всех служб Поиска, созданных в подписке.

4.	Щелкните по службе, чтобы открыть панель мониторинга. Обратите внимание: команды **Start** (Начать), **Stop** (Остановить) и **Delete** (Удалить) доступны вверху страницы. Панель мониторинга службы включает плитки для просмотра свойств, ключей и быстрого начала работы, где размещены ссылки на информацию и инструкции. Пролистайте вниз, чтобы посмотреть использование служб.

5.	Щелкните **PROPERTIES** (Свойства). Справа откроется страница "Свойства". URL службы отображается в верхней части страницы. Чтобы получить api-ключи, используемые для аутентификации в службе, щелкните **KEYS** (Ключи).

 	![][23]

<!--Next steps and links -->
<h2 id="next-steps">Попробуйте сейчас</h2>

Вы готовы к следующему шагу? Следующие ссылки содержат дополнительный материал, который расскажет вам о том, как создавать и управлять приложениями поиска, использующих Поиск Azure.

- [Создание первого решения поиска на базе Azure](../search-create-first-solution/) 

- [Пример создания геопространственного поиска Azure](../search-create-geospatial/)

- [Управление решением поиска в Microsoft Azure](../search-manage/) 

- [Технические сведения о Поиске Azure](http://msdn.microsoft.com/library/dn798933.aspx)

- [API REST Поиска Azure](http://msdn.microsoft.com/library/dn798935.aspx)

- [Видеоканал № 9: Введение в Поиск Azure](http://channel9.msdn.com/Shows/Data-Exposed/Introduction-To-Azure-Search)

- [Видеоканал № 9: Поиск Azure и геопространственные данные](http://channel9.msdn.com/Shows/Data-Exposed/Azure-Search-and-Geospatial-Data)

- [Видеоролик № 152 об облачном покрытии: создание индекса в Поиске Azure](http://channel9.msdn.com/Shows/Cloud+Cover/Cloud-Cover-152-Azure-Search-with-Liam-Cavanagh)

<!--Anchors-->
[Начало работы с бесплатной службой]: #sub-1
[Обновление до стандартного поиска]: #sub-2
[Операции тестирования службы]: #sub-3
[Обзор панели мониторинга службы поиска]: #sub-4
[Попробовать]: #next-steps

<!--Image references-->
[6]: ./media/search-get-started/AzureSearch_Configure1_1_New.PNG
[7]: ./media/search-get-started/AzureSearch_Configure1_2_Everything.PNG
[8]: ./media/search-get-started/Azuresearch_Configure1_3a_Gallery.PNG
[9]: ./media/search-get-started/AzureSearch_Configure1_4_GallerySeeAll.PNG
[10]: ./media/search-get-started/AzureSearch_Configure1_5_SearchTile.PNG
[11]: ./media/search-get-started/AzureSearch_Configure1_6_URL.PNG
[12]: ./media/search-get-started/AzureSearch_Configure1_7a_Free.PNG
[13]: ./media/search-get-started/AzureSearch_Configure1_17_HomeDashboard.PNG
[14]: ./media/search-get-started/AzureSearch_Configure1_9_Standard.PNG
[15]: ./media/search-get-started/AzureSearch_Configure1_10_ScaleUp.PNG
[16]: ./media/search-get-started/AzureSearch_Configure1_11_PUTIndex.PNG
[17]: ./media/search-get-started/AzureSearch_Configure1_12_POSTDocs.PNG
[18]: ./media/search-get-started/AzureSearch_Configure1_13_GETQuery.PNG
[19]: ./media/search-get-started/AzureSearch_Configure1_14_GETQueryResponse.PNG
[20]: ./media/search-get-started/AzureSearch_Configure1_15_Stats.PNG
[21]: ./media/search-get-started/AzureSearch_Configure1_16_StatsResponse.PNG
[22]: ./media/search-get-started/AzureSearch_Configure1_17_BrowseEverything.PNG
[23]: ./media/search-get-started/AzureSearch_Configure1_18_Explore.PNG


<!--Link references-->
[Управление решением поиска в Microsoft Azure]: ../search-manage/
[Рабочий процесс разработки Поиска Azure]: ../search-workflow/
[Создание первого решения поиска на базе Azure]: ../search-create-first-solution/
[Создание приложения для геопространственного поиска с помощью Поиска Azure]: ../search-create-geospatial/

<!--HONumber=35.2-->
