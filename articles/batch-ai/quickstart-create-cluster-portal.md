---
title: Краткое руководство по Azure. Создание кластера Batch AI с помощью портала | Документация Майкрософт
description: Краткое руководство. Создание кластера Batch AI для обучения моделей машинного обучения и искусственного интеллекта на портале Azure
services: batch-ai
documentationcenter: na
author: dlepow
manager: jeconnoc
editor: ''
ms.assetid: ''
ms.custom: ''
ms.service: batch-ai
ms.workload: ''
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: quickstart
ms.date: 08/15/2018
ms.author: danlep
ROBOTS: NOINDEX
ms.openlocfilehash: 78c743448a7f7439875d3598d6ba5d4eb6dc12fc
ms.sourcegitcommit: c37122644eab1cc739d735077cf971edb6d428fe
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2018
ms.locfileid: "53408942"
---
# <a name="quickstart-create-a-cluster-for-batch-ai-training-jobs-using-the-azure-portal"></a>Краткое руководство. Создание кластера Batch AI для заданий обучения с помощью портала Azure

[!INCLUDE [batch-ai-retiring](../../includes/batch-ai-retiring.md)]

В этом кратком руководстве показано, как с помощью портала Azure создать кластер Batch AI, которые можно использовать для обучения моделей искусственного интеллекта и машинного обучения. Batch AI — это управляемая служба, которая позволяет специалистам по обработке и анализу данных и исследователям искусственного интеллекта обучать модели искусственного интеллекта и машинного обучения в большом масштабе на кластерах виртуальных машин Azure.

Изначально кластер содержит один узел с GPU и подключенный файловый сервер. Выполнив инструкции из этого краткого руководства, вы получите масштабируемый кластер для обучения моделей глубокого обучения. Задания обучения в этот кластер можно отправлять через Batch AI, средства [машинного обучения Azure](../machine-learning/service/overview-what-is-azure-ml.md) или расширение [Visual Studio Tools for AI](https://github.com/Microsoft/vs-tools-for-ai).

[!INCLUDE [quickstarts-free-trial-note.md](../../includes/quickstarts-free-trial-note.md)]

## <a name="create-ssh-key-pair"></a>Создание пары ключей SSH

Для работы с этим кратким руководством вам понадобится пара ключей SSH. Если у вас уже есть пара ключей SSH, этот шаг можно пропустить.

Чтобы создать пару ключей SSH, выполните приведенную ниже команду в оболочке Bash и следуйте инструкциям на экране. Например, можно использовать [Azure Cloud Shell](../cloud-shell/overview.md), а в ОС Windows — [подсистему Windows для Linux](/windows/wsl/install-win10). Выходные данные команды включают имя файла открытого ключа. Скопируйте содержимое файла открытого ключа (`cat ~/.ssh/id_rsa.pub`) в буфер обмена или в другое расположение, к которому вы сможете обратиться позднее.

```bash
ssh-keygen -t rsa -b 2048
```

Дополнительные сведения о создании пар ключей SSH см. в статье [Краткая инструкция: создание и использование пары из открытого и закрытого ключей SSH для виртуальных машин Linux в Azure](../virtual-machines/linux/mac-create-ssh-keys.md).

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу https://portal.azure.com.

## <a name="create-a-batch-ai-workspace"></a>Создание рабочей области Batch AI

Для начала создайте рабочую область Batch AI для упорядочения ресурсов. Рабочая область может содержать один или несколько кластеров или других ресурсов Batch AI.

1. Выберите **Все службы** и настройте фильтр по строке **Batch AI**.

2. Выберите **Добавить рабочую область**.

3. Введите значения для параметров **Имя рабочей области** и **Группа ресурсов**. При желании измените для рабочей области параметры **Подписка** и **Расположение**. Нажмите кнопку **Создать рабочую область**.

  ![Создание рабочей области Batch AI](./media/quickstart-create-cluster-portal/create-workspace.png)

Когда появится сообщение **Развертывание прошло успешно**, перейдите к созданному ресурсу и выберите рабочую область.

## <a name="create-a-file-server"></a>Создание файлового сервера

Файловый сервер Batch AI — это система NFS с одним узлом, которую можно автоматически подключить на узлах кластера. Это один из нескольких способов предоставления хранилища для входных и выходных данных заданий обучения.

1. В рабочей области выберите **Файловый сервер** > **Add batch ai file server** (Добавить файловый сервер Batch AI).

2. Введите значения для параметров **Имя файлового сервера** и **Размер виртуальной машины**. В рамках этого краткого руководства мы предлагаем выбрать для файлового сервера размер виртуальной машины *"Стандартный" D1_v2*. Выберите другой размер, если для заданий обучения вы намерены хранить большие объемы входных или выходных данных.

3. Введите **имя пользователя администратора** и скопируйте содержимое файла открытого ключа SSH в поле **Ключ SSH**. Подтвердите значения по умолчанию для остальных параметров и выберите **Create File server** (Создать файловый сервер).

  ![Создание файлового сервера Batch AI](./media/quickstart-create-cluster-portal/create-file-server.png)

Развертывание файлового сервера занимает несколько минут.

После создания сервера щелкните **Свойства** и запишите **параметры подключения**. Вы можете подключиться по протоколу SSH к общедоступному IP-адрес сервера, чтобы отправлять и скачивать данные для обучения и выходные файлы, расположенные в указанном каталоге (*/data*).

![Свойства файлового сервера](./media/quickstart-create-cluster-portal/file-server-properties.png)

## <a name="create-a-cluster"></a>Создание кластера

С помощью следующих действий можно создать кластер с одним узлом GPU. Этот узел кластера работает под управлением стандартного образа Ubuntu Server, предназначенного для размещения контейнерных приложений. Он хорошо подходит для большинства рабочих нагрузок обучения. Узел кластера подключает файловый сервер к точке подключения. 

1. В рабочей области Batch AI выберите **Кластер** > **Add batch ai cluster** (Добавить кластер Batch AI).

2. Введите **имя кластера** и указанные ниже параметры. Виртуальная машина рекомендуемого размера содержит один GPU типа NVIDIA Tesla K80.
  
   |Параметр  |Значение  |
   |---------|---------|
   |**Размер виртуальной машины**     |"Стандартный" NC6|
   |**Целевое количество узлов.**     |1|

3. Введите **имя пользователя администратора** и скопируйте содержимое файла открытого ключа SSH в поле **Ключ SSH**. Примите значения по умолчанию для остальных значений на этой странице и щелкните **Далее: настройка узла**.

   ![Ввод основных сведений о кластере](./media/quickstart-create-cluster-portal/create-cluster.png)

4. В разделе **Подключение томов** выберите **Файловый сервер** > **Добавить**. Выберите созданный ранее файловый сервер. Введите **относительный путь подключения**, по которому подключается файловый сервер на каждом узле кластера. Выберите **Сохранить и продолжить**.

   ![Добавление ссылки на файловый сервер](./media/quickstart-create-cluster-portal/file-server-reference.png)

Сохраните параметры узла и выберите **Создать кластер**.

Службе Batch AI потребуется несколько минут, чтобы выделить узел. В течение этого времени параметр **Allocation state** (Состояние распределения) для кластера будет иметь значение **Resizing** (Изменение размера). Через несколько минут состояние кластера примет значение **Steady** (Стабильное), и узел запустится.

![Запуск кластера](./media/quickstart-create-cluster-portal/cluster-resizing.png)

Выберите имя кластера, чтобы проверить состояние узла. Если узел имеет состояние **Idle** (Неактивен), он готов к выполнению заданий обучения.

### <a name="list-cluster-nodes"></a>Список узлов кластера

Если вам нужно подключиться к узлам кластера (в данном случае к одному узлу) для установки приложений или выполнения обслуживания, получите параметры подключения на портале. После создания кластера щелкните **Узлы** и запишите параметры **подключения** для SSH (IP-адрес и номер порта).

![Узлы кластера](./media/quickstart-create-cluster-portal/cluster-nodes.png)

Используйте эту информацию для создания SSH-подключения к узлу. Например, подставьте правильные значения IP-адреса и номера порта в следующую команду:

```bash
ssh myusername@137.135.82.15 -p 50000
``` 

### <a name="resize-the-cluster"></a>Изменение размера кластера

При использовании кластера для обучения модели вам могут потребоваться дополнительные вычислительные ресурсы. Чтобы увеличить размер кластера до 2 узлов для задания распределенного обучения, выберите **Масштабирование** и установите значение 2 в поле **Целевое количество узлов**. Сохраните конфигурацию.

![Изменение масштаба кластера](./media/quickstart-create-cluster-portal/scale-cluster.png)

Изменение размера кластера может занять несколько минут.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы хотите продолжить изучение примеров и руководств по Batch AI, сохраните созданные в этом руководстве рабочую область Batch AI, файловый сервер и кластер.

Плата за кластер Batch AI и файловый сервер взимается постоянно при работе виртуальной машины, даже если ей не назначены задания. Если вы хотите сохранить конфигурацию кластера, пока нет новых заданий для выполнения в нем, уменьшите размер кластера до 0 узлов. Позже вы сможете увеличить масштаб до одного или нескольких узлов, чтобы выполнить следующее задание. 

Когда эти ресурсы будут не нужны, удалите рабочую область Batch AI с кластером и файловым сервером. Для этого выберите рабочую Batch AI и щелкните **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

Из этого краткого руководства вы узнали, как создать кластер Batch AI и подключенный к нему файловый сервер с помощью портала Azure. Дополнительные сведения об использовании кластера Batch AI для обучения модели вы найдете в кратком руководстве по обучению модели глубокого обучения.

> [!div class="nextstepaction"]
> [Обучение модели глубокого обучения](./quickstart-tensorflow-training-cli.md)
