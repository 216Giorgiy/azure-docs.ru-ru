---
title: Развертывание кластера Kubernetes в Azure Stack | Документация Майкрософт
description: Сведения о том, как развернуть кластер Kubernetes в Azure Stack.
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/29/2018
ms.author: mabrigg
ms.reviewer: waltero
ms.openlocfilehash: 43c0b7c87f9ee1cd33da3d617747c11dc120e51a
ms.sourcegitcommit: 3017211a7d51efd6cd87e8210ee13d57585c7e3b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/06/2018
ms.locfileid: "34823628"
---
# <a name="deploy-a-kubernetes-cluster-to-azure-stack"></a>Развертывание кластера Kubernetes в Azure Stack

*Область применения: интегрированные системы Azure Stack и Пакет средств разработки Azure Stack*

> [!Note]  
> Kubernetes для Службы контейнеров Azure (ACS) в Azure Stack доступен в закрытой предварительной версии. Вашему оператору Azure Stack потребуется запросить доступ к элементу Kubernetes в Marketplace, необходимому для выполнения инструкций в этой статье.

В статье рассматривается развертывание и подготовка ресурсов для автономного кластера Kubernetes с помощью шаблона Azure Resource Manager в виде единой координируемой операции. Вам потребуется собрать все необходимые сведения об установке Azure Stack, создать шаблон и выполнить развертывание в облаке.

## <a name="kubernetes-and-containers"></a>Kubernetes и контейнеры

Вы можете установить Kubernetes с помощью шаблонов Azure Resource Manager, созданных модулем службы контейнеров Azure в Azure Stack. [Kubernetes](https://kubernetes.io) — это система с открытым кодом для автоматизации развертывания, масштабирования и управления приложениями в контейнерах. [Контейнер](https://www.docker.com/what-container) содержится в образе наподобие виртуальной машины. В отличие от виртуальной машины, в образ контейнера помещены ресурсы, необходимые только для запуска приложения, например код, среда выполнения для этого кода, определенные библиотеки и параметры.

Kubernetes можно использовать для следующих целей:

- Разработка обновляемых приложений с высокой масштабируемостью, которые можно развернуть в считаные секунды. 
- Упрощение структуры приложения и повышение его надежности с помощью различных приложений Helm. [Helm](https://github.com/kubernetes/helm) — это средство упаковки с открытым исходным кодом, которое помогает установить приложения Kubernetes и управлять их жизненным циклом.
- Простой мониторинг и диагностика работоспособности приложений с помощью функций масштабирования и обновления.

## <a name="prerequisites"></a>предварительным требованиям 

Прежде чем начать работу, убедитесь в наличии необходимых разрешений и в готовности Azure Stack.

1. Проверьте, можете ли вы создавать приложения в клиенте Azure Active Directory (Azure AD). Эти разрешения потребуются для развертывания Kubernetes.

    Инструкции по проверке разрешений см. в разделе [Check Azure Active Directory permissions](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-create-service-principal-portal#check-azure-active-directory-permissions) (Проверка разрешений Azure Active Directory).

2. Создайте пару открытого и закрытого ключей SSH для входа на виртуальную машину Linux в Azure Stack. Открытый ключ потребуется при создании кластера.

    Инструкции по создания ключа см. в разделе [SSH Key Generation](https://github.com/msazurestackworkloads/acs-engine/blob/master/docs/ssh.md#ssh-key-generation) (Создание ключа SSH).

3. Убедитесь в наличии действующей подписки на портале клиента Azure Stack, а также достаточного количества общедоступных IP-адресов для добавления новых приложений.

    Кластер не может быть развернут в подписке **администратора** Azure Stack. Необходимо использовать подписку пользователя**. 

## <a name="create-a-service-principal-in-azure-ad"></a>Создание субъекта-службы в Azure AD

1. Войдите на глобальный [портал Azure](http://portal.azure.com).
2. Убедитесь, что при входе используется клиент Azure AD, связанный с экземпляром Azure Stack.
3. Создадим приложение Azure AD.

    a. Последовательно выберите элементы **Azure Active Directory** > **+ Регистрация приложений** > **Регистрация нового приложения**.

    Б. Введите **имя** приложения.

    c. Выберите **Веб-приложение или API**.

    d. Введите `http://localhost` в поле **URL-адрес для входа**.

    c. Нажмите кнопку **Создать**.

4. Запишите значение **идентификатора приложения**. Идентификатор потребуется при создании кластера. Этот идентификатор называется **идентификатором клиента для субъекта-службы**.

5. Последовательно выберите **Параметры** > **Ключи**.

    a. Введите **описание**.

    Б. Выберите для параметра **Срок действия** значение **Срок действия неограничен**.

    c. Щелкните **Сохранить**. Запишите строку ключа. Строка ключа потребуется при создании кластера. Этот ключ называется **секретом клиента субъекта-службы**.



## <a name="give-the-service-principal-access"></a>Предоставление доступа субъекту-службе

Предоставьте субъекту-службе доступ к вашей подписке, чтобы субъект мог создать ресурсы.

1.  Войдите на [портал администрирования](https://adminportal.local.azurestack.external).

2. Выберите **Больше служб** > **Пользовательские подписки** > **+ Добавить**.

3. Выберите созданную подписку.

4. Последовательно выберите **Управление доступом (IAM)** > **+ Добавить**.

5. Выберите роль **Владелец**.

6. Выберите имя приложения, созданное для субъекта-службы. Возможно, потребуется ввести имя в поле поиска.

7. Выберите команду **Сохранить**.

## <a name="deploy-a-kubernetes-cluster"></a>Развертывание кластера Kubernetes

1. Откройте [портал Azure Stack](https://portal.local.azurestack.external).

2. Выберите **+Создать** > **Среда выполнения приложений** > **Kubernetes Cluster (Кластер Kubernetes)**. Нажмите кнопку **Создать**.

    ![Развертывание шаблона решений](media/azure-stack-solution-template-kubernetes-deploy/01_kub_market_item.png)

3. В колонке "Создание кластера Kubernetes" выберите раздел **Основные сведения**.

    ![Развертывание шаблона решений](media/azure-stack-solution-template-kubernetes-deploy/02_kub_config_basic.png)

2. Введите **имя пользователя администратора виртуальной машины Linux**. Это имя пользователя для виртуальных машин Linux, которые являются частью кластера Kubernetes и динамического административного представления.

3. Введите **открытый ключ SSH**, используемый для авторизации на всех компьютерах Linux, созданных как часть кластера Kubernetes и динамического административного представления.

4. Введите **префикс DNS главного профиля**, уникальный для региона. Это уникальное для региона имя, например `k8s-12345`. Рекомендуем выбрать то же имя, что и для группы ресурсов.

    > [!Note]  
    > Для каждого кластера используйте новый уникальный префикс DNS главного профиля.

5. Введите **количество профилей пула агентов**. Счетчик содержит число агентов в кластере. Можно указать значение от 1 до 4.

6. Введите **идентификатор клиента субъекта-службы**. Он используется поставщиком облачных служб Azure для Kubernetes.

7. Введите **секрет клиента субъекта-службы**, созданный при создании приложения субъекта-службы.

8. Введите **версию поставщика облачных служб Azure для Kubernetes**. Это версия поставщика Azure для Kubernetes. Azure Stack выпускает специальную сборку Kubernetes для каждой версии Azure Stack.

9. Выберите идентификатор **подписки**.

10. Введите имя новой группы ресурсов или выберите существующую. Имя ресурса должно содержать буквенно-цифровые символы. Оно вводится в нижнем регистре.

11. Выберите **расположение** группы ресурсов. Это регион, выбранный для установки Azure Stack.

### <a name="specify-the-azure-stack-settings"></a>Указание параметров Azure Stack

1. Выберите **параметры метки Azure Stack**.

    ![Развертывание шаблона решений](media/azure-stack-solution-template-kubernetes-deploy/03_kub_config_settings.png)

2. Введите **конечную точку ARM клиента**. Это конечная точка Azure Resource Manager, к которой устанавливается подключение, чтобы создать группу ресурсов кластера Kubernetes. Конечную точку потребуется получить у оператора Azure Stack для интегрированной системы. В качестве Пакета средств разработки Azure Stack (ASDK) можно использовать `https://management.local.azurestack.external`.

3. Введите **идентификатор клиента**. Если вам нужна помощь в поиске этого значения, см. раздел [Get tenant ID](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-create-service-principal-portal#get-tenant-id) (Получение идентификатора клиента). 

## <a name="connect-to-your-cluster"></a>Подключение к кластеру

Теперь все готово для подключения к кластеру. Главный кластер можно найти в группе кластерных ресурсов. Он называется `k8s-master-<sequence-of-numbers>`. Подключитесь к главному кластеру, используя клиент SSH. Управлять кластером можно с помощью **kubectl**, клиента командной строки Kubernetes. Инструкции см. на сайте [Kubernetes.io](https://kubernetes.io/docs/reference/kubectl/overview).

Можно также использовать диспетчер пакетов **Helm** для установки и развертывания приложений в кластер. Инструкции по установке и использованию Helm с кластером см. на сайте [helm.sh](https://helm.sh/).

## <a name="next-steps"></a>Дополнительная информация

[Добавление кластера Kubernetes в Marketplace (для оператора Azure Stack)](..\azure-stack-solution-template-kubernetes-cluster-add.md)

[Kubernetes в Azure](https://docs.microsoft.com/azure/container-service/kubernetes/container-service-kubernetes-walkthrough)
