---
title: Развертывание кластера Kubernetes в Azure Stack | Документация Майкрософт
description: Сведения о том, как развернуть кластер Kubernetes в Azure Stack.
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2018
ms.author: mabrigg
ms.reviewer: waltero
ms.openlocfilehash: 7cf865f0ce75d8308d6d42306e8e05852f763cae
ms.sourcegitcommit: 909469bf17211be40ea24a981c3e0331ea182996
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/10/2018
ms.locfileid: "34010155"
---
# <a name="deploy-a-kubernetes-cluster-to-azure-stack"></a>Развертывание кластера Kubernetes в Azure Stack

*Область применения: интегрированные системы Azure Stack и Пакет средств разработки Azure Stack*

> [!Note]  
> Kubernetes для Службы контейнеров Azure (ACS) в Azure Stack доступен в закрытой предварительной версии. Вашему оператору Azure Stack потребуется запросить доступ к элементу Kubernetes в Marketplace, необходимому для выполнения инструкций в этой статье.

В статье рассматривается развертывание и подготовка ресурсов для автономного кластера Kubernetes с помощью шаблона Azure Resource Manager в виде единой координируемой операции. Вам потребуется собрать все необходимые сведения об установке Azure Stack, создать шаблон и выполнить развертывание в облаке.

## <a name="kubernetes-and-containers"></a>Kubernetes и контейнеры

Kubernetes для Службы контейнеров Azure (ACS) можно установить в Azure Stack. [Kubernetes](https://kubernetes.io) — это система с открытым кодом для автоматизации развертывания, масштабирования и управления приложениями в контейнерах. [Контейнер](https://www.docker.com/what-container) содержится в образе наподобие виртуальной машины. Но в отличие от виртуальной машины, в образ контейнера помещены ресурсы, необходимые только для запуска приложения, например код, среда выполнения для этого кода, определенные библиотеки и параметры.

Kubernetes можно использовать для следующих целей:

- Разработка обновляемых приложений с высокой масштабируемостью, которые можно развернуть в считаные секунды. 
- Упрощение структуры приложения и повышение его надежности с помощью различных приложений Helm. [Helm](https://github.com/kubernetes/helm) — это средство упаковки с открытым исходным кодом, которое помогает установить приложения Kubernetes и управлять их жизненным циклом.
- Простой мониторинг и диагностика работоспособности приложений с помощью функций масштабирования и обновления.

## <a name="prerequisites"></a>предварительным требованиям 

Прежде чем начать работу, убедитесь в наличии необходимых разрешений и в готовности Azure Stack.

1. Проверьте, можете ли вы создавать приложения в клиенте Azure Active Directory (Azure AD). Эти разрешения потребуются для развертывания Kubernetes.

    Инструкции по проверке разрешений см. в разделе [Check Azure Active Directory permissions](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-create-service-principal-portal#check-azure-active-directory-permissions) (Проверка разрешений Azure Active Directory).

2. Создайте пару открытого и закрытого ключей SSH для входа на виртуальную машину Linux в Azure Stack. Открытый ключ потребуется при создании кластера.

    Инструкции по создания ключа см. в разделе [SSH Key Generation](https://github.com/msazurestackworkloads/acs-engine/blob/master/docs/ssh.md#ssh-key-generation) (Создание ключа SSH).

3. Убедитесь в наличии действующей подписки на портале клиента Azure Stack, а также достаточного количества общедоступных IP-адресов для добавления новых приложений.

## <a name="create-a-service-principal-in-azure-ad"></a>Создание субъекта-службы в Azure AD

1. Войдите на глобальный [портал Azure](http://www.poartal.azure.com).
2. Убедитесь, что при входе используется клиент Azure AD, связанный с Azure Stack.
3. Создадим приложение Azure AD.

    a. Последовательно выберите элементы **Azure Active Directory** > **+ Регистрация приложений** > **Регистрация нового приложения**.

    Б. Введите **имя** приложения.

    c. Выберите **Веб-приложение или API**.

    d. Введите `http://localhost` в поле **URL-адрес для входа**.

    c. Нажмите кнопку **Создать**.

4. Запишите значение **идентификатора приложения**. Идентификатор потребуется при создании кластера. Этот идентификатор называется **идентификатором клиента для субъекта-службы**.

5. Последовательно выберите **Параметры** > **Ключи**.

    a. Введите **описание**.

    Б. Выберите для параметра **Срок действия** значение **Срок действия неограничен**.

    c. Щелкните **Сохранить**. Запишите строку ключа. Строка ключа потребуется при создании кластера. Этот ключ называется **секретом клиента субъекта-службы**.



## <a name="give-the-service-principal-access"></a>Предоставление доступа субъекту-службе

Предоставьте субъекту-службе доступ к вашей подписке, чтобы субъект мог создать ресурсы.

1.  Войдите на [портал администрирования](https://adminportal.local.azurestack.external).

2. Выберите **Больше служб** > **Пользовательские подписки** > **+ Добавить**.

3. Выберите созданную подписку.

4. Последовательно выберите **Управление доступом (IAM)** > **+ Добавить**.

5. Выберите роль **Владелец**.

6. Выберите имя приложения, созданное для субъекта-службы. Возможно, потребуется ввести имя в поле поиска.

7. Выберите команду **Сохранить**.

## <a name="deploy-a-kubernetes-cluster"></a>Развертывание кластера Kubernetes

1. Откройте [портал Azure Stack](https://portal.local.azurestack.external).

2. Выберите **+Создать** > **Среда выполнения приложений** > **Kubernetes Cluster (Кластер Kubernetes)**.

    ![Развертывание шаблона решений](../media/azure-stack-solution-template-kubernetes-cluster-add/azure-stack-kubernetes-cluster-solution-template.png)

3. Выберите **Параметры** в разделе "Развертывание шаблона решений".

    ![Развертывание шаблона решений](../media/azure-stack-solution-template-kubernetes-cluster-add/azure-stack-kubernetes-cluster-solution-template-parameters.png)

2. Введите **имя пользователя с правами администратора Linux**. Это имя пользователя для виртуальных машин Linux, которые являются частью кластера Kubernetes и динамического административного представления.

3. Введите **открытый ключ SSH**, используемый для авторизации на всех компьютерах Linux, созданных как часть кластера Kubernetes и динамического административного представления.

4. Введите **конечную точку клиента**. Это конечная точка Azure Resource Manager, к которой устанавливается подключение, чтобы создать группу ресурсов кластера Kubernetes. Конечную точку потребуется получить у оператора Azure Stack для интегрированной системы. В качестве Пакета средств разработки Azure Stack (ASDK) можно использовать `https://management.local.azurestack.external`.

5. Введите **идентификатор клиента**. Если вам нужна помощь в поиске этого значения, см. раздел [Get tenant ID](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-create-service-principal-portal#get-tenant-id) (Получение идентификатора клиента). 

6. Введите **префикс DNS главного профиля**, уникальный для региона. Это уникальное для региона имя, например `k8s-12345`. Рекомендуем выбрать то же имя, что и для группы ресурсов.

    > [!Note]  
    > Для каждого кластера используйте новый уникальный префикс DNS главного профиля.

7. Введите количество агентов в кластере. Это значение называется **количеством профилей пула агентов**. Можно указать значение от 1 до 32.

8. Введите **идентификатор приложения субъекта-службы**. Он используется поставщиком облачных служб Azure для Kubernetes.

9. Введите **секрет клиента субъекта-службы**, созданный при создании приложения субъекта-службы.

10. Введите **версию поставщика облачных служб Azure для Kubernetes**. Это версия поставщика Azure для Kubernetes. Azure Stack выпускает специальную сборку Kubernetes для каждой версии Azure Stack.

12. Нажмите кнопку **ОК**.

### <a name="specify-the-solution-values"></a>Указание значений решения

1. Выберите элемент **Подписка**.

2. Введите имя новой группы ресурсов или выберите существующую. Имя ресурса должно содержать буквенно-цифровые символы. Оно вводится в нижнем регистре.

3. Введите расположение группы ресурсов, например **local**.

4. Нажмите кнопку **Создать**.

## <a name="connect-to-your-cluster"></a>Подключение к кластеру

Теперь все готово для подключения к кластеру. Вам потребуется **kubectl** — клиент командной строки Kubernetes. Инструкции по подключению к кластеру и управлению им можно найти в документации по Службе контейнеров Azure.   

Инструкции см. в разделе [Connect to the cluster](https://docs.microsoft.com/azure/container-service/kubernetes/container-service-kubernetes-walkthrough#connect-to-the-cluster) (Подключение к кластеру).

## <a name="next-steps"></a>Дополнительная информация

[Добавление кластера Kubernetes в Marketplace (для оператора Azure Stack)](..\azure-stack-solution-template-kubernetes-cluster-add.md)

[Kubernetes в Azure](https://docs.microsoft.com/azure/container-service/kubernetes/container-service-kubernetes-walkthrough)