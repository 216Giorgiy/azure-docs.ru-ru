---
title: Развертывание приложения в Azure и Azure Stack | Документация Майкрософт
description: Узнайте, как развертывать приложения в Azure и Azure Stack с помощью гибридного конвейера CI/CD.
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: tutorial
ms.date: 05/15/2018
ms.author: mabrigg
ms.reviewer: Anjay.Ajodha
ms.openlocfilehash: 483122f5d2e39c8595d0f28a6b937772c4ea2e50
ms.sourcegitcommit: 96089449d17548263691d40e4f1e8f9557561197
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/17/2018
ms.locfileid: "34258354"
---
# <a name="tutorial-deploy-apps-to-azure-and-azure-stack"></a>Руководство по развертыванию приложений в Azure и Azure Stack

*Область применения: интегрированные системы Azure Stack и Пакет средств разработки Azure Stack*

Гибридный конвейер непрерывной интеграции и непрерывной поставки (CI/CD) позволяет создавать, тестировать и развертывать приложение в различные облака.  В рамках этого руководства вы создадите пример среды и выполните в ней следующие действия:
 
> [!div class="checklist"]
> * Запустить новую сборку на основе зафиксированного кода из репозитория Visual Studio Team Services (VSTS).
> * Автоматически развернуть созданный код в глобальный Azure для пользовательского приемочного тестирования.
> * Как только ваш код прошел тестирование, автоматически развернуть его в Azure Stack.

### <a name="about-the-hybrid-delivery-build-pipe"></a>Сведения о конвейере сборки гибридной доставки

Непрерывность, безопасность и надежность развертывания приложений являются ключевыми для организации и критически важными для команды разработчиков. С помощью конвейера непрерывной интеграции и непрерывной поставки вы можете консолидировать свои конвейеры в локальной среде и общедоступном облаке. Расположение можно изменить без переключения приложения.

Этот подход также позволяет поддерживать согласованный набор средств разработки. При наличии согласованных средств в общедоступном облаке Azure и локальной среде Azure Stack вам будет гораздо проще реализовать методы разработки непрерывной интеграции и непрерывной поставки. Приложения и службы, развертываемые в Azure или Azure Stack, взаимозаменяемы, и тот же код можно выполнять в любой среде, пользуясь функциями локальной среды и возможностями общедоступного облака.

См. также:
 - [Что такое непрерывная интеграция](https://www.visualstudio.com/learn/what-is-continuous-integration/)
 - [Что такое непрерывная поставка](https://www.visualstudio.com/learn/what-is-continuous-delivery/)


## <a name="prerequisites"></a>предварительным требованиям

Вам потребуется несколько компонентов, чтобы создать гибридный конвейер непрерывной интеграции и непрерывной поставки. Подготовка может занять некоторое время.
 
 - Партнер-поставщик OEM или оборудования может развернуть Azure Stack для рабочей среды, а все пользователи могут развернуть пакет средств разработки Azure Stack (ASDK). 
 - Оператор Azure Stack также должен развернуть службу приложений, создать планы и предложения, создать подписку клиента и добавить образ Windows Server 2016.

Если у вас уже есть некоторые из этих компонентов, перед началом убедитесь, что они отвечают требованиям.

В этой статье также предполагается, что у вас есть определенный набор знаний об Azure и Azure Stack. Если вы хотите узнать больше, прежде чем продолжить, ознакомьтесь с такими статьями:


В этом руководстве также предполагается, что у вас есть определенный набор знаний об Azure и Azure Stack. 

Если вы хотите узнать больше, прежде чем продолжить, ознакомьтесь с такими статьями:
 - [Введение в Azure](https://azure.microsoft.com/overview/what-is-azure/).
 - [Основные понятия Azure Stack](https://docs.microsoft.com/azure/azure-stack/azure-stack-key-features).

### <a name="azure"></a>Таблицы Azure

 - Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

 - Создайте [веб-приложение](https://docs.microsoft.com/azure/app-service/app-service-web-overview) в Azure. Запишите новый URL-адрес веб-приложения, так как он будет использоваться позднее.

Azure Stack
 - Используйте систему с Azure Stack или разверните пакет средств разработки Azure Stack по ссылке ниже:
    - Подробные сведения о развертывании ASDK см. в статье [Руководство. Развертывание ASDK с помощью установщика](https://docs.microsoft.com/azure/azure-stack/asdk/asdk-deploy).
    - Многие шаги после развертывания ASDK можно автоматизировать с помощью следующего скрипта PowerShell: [ConfigASDK.ps1](https://github.com/mattmcspirit/azurestack/blob/master/deployment/ConfigASDK.ps1 ).

    > [!Note]  
    > Установка ASDK занимает семь часов, поэтому планируйте ее соответствующим образом.

 - Разверните службы PaaS [службы приложений](https://docs.microsoft.com/azure/azure-stack/azure-stack-app-service-deploy) в Azure Stack. 
 - Создайте [план и предложения](https://docs.microsoft.com/azure/azure-stack/azure-stack-plan-offer-quota-overview) в рамках среды Azure Stack. 
 - Создайте [подписку клиента](https://docs.microsoft.com/azure/azure-stack/azure-stack-subscribe-plan-provision-vm) в рамках среды Azure Stack. 
 - Создайте веб-приложение в рамках подписки клиента. Запишите новый URL-адрес веб-приложения для дальнейшего использования.
 - Разверните виртуальную машину VSTS в рамках подписки клиента.
 - Требуется виртуальная машина Windows Server 2016 с .NET 3.5. Эта виртуальная машина будет создана в Azure Stack в качестве частного агента сборки. 

### <a name="developer-tools"></a>Инструменты для разработчиков

 - Создайте [рабочую область VSTS](https://www.visualstudio.com/docs/setup-admin/team-services/sign-up-for-visual-studio-team-services). Во время процесса регистрации создается проект с именем **MyFirstProject**.
 - [Установите Visual Studio 2017](https://docs.microsoft.com/visualstudio/install/install-visual-studio) и [войдите в VSTS](https://www.visualstudio.com/docs/setup-admin/team-services/connect-to-visual-studio-team-services).
 - Подключитесь к проекту и [локально клонируйте](https://www.visualstudio.com/docs/git/gitquickstart) его.
 
 > [!Note]  
 > Вам необходим Azure Stack с подходящими образами, объединенными для запуска (Windows Server и SQL), и развернутой службой приложений.
 
## <a name="prepare-the-private-build-and-release-agent-for-visual-studio-team-services-integration"></a>Подготовка частной сборки и агента выпуска для интеграции Visual Studio Team Services

### <a name="prerequisites"></a>предварительным требованиям

Visual Studio Team Services (VSTS) выполняет проверку подлинности в Azure Resource Manager с помощью субъекта-службы. Чтобы VSTS могла подготавливать ресурсы в подписке Azure Stack, требуется состояние участника.

Ниже приведены основные действия, которые необходимо настроить, чтобы включить такую проверку подлинности:

1. Необходимо создать субъект-службу или использовать уже существующую.
2. Для субъекта-службы необходимо создать ключи проверки подлинности.
3. Подписку Azure Stack необходимо проверить в механизме управления доступом на основе ролей, чтобы разрешить имени субъекта-службы быть частью роли "Участник".
4. В VSTS нужно создать новое определение службы с использованием конечных точек Azure Stack, а также информации об имени субъекта-службы.

### <a name="service-principal-creation"></a>Создание субъекта-службы

Ознакомьтесь с инструкциями по [созданию субъекта-службы](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications), чтобы создать субъект-службу, и выберите "Веб-приложение или API" для типа приложения.

### <a name="access-key-creation"></a>Создание ключа доступа

Субъекту-службе требуется ключ для проверки подлинности. Создайте ключ, выполнив действия в этом разделе.


1. В Azure Active Directory в разделе **Регистрация приложений** выберите нужное приложение.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_01.png)

2.  Запишите значение **идентификатора приложения**. Это значение будет использовано при настройке конечной точки службы в VSTS.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_02.png)

3. Чтобы создать ключ проверки подлинности, щелкните **Параметры**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_03.png)

4. Чтобы создать ключ проверки подлинности, щелкните **Ключи**.
 
    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_04.png)

5. Введите описание и срок действия ключа. Затем нажмите кнопку **Сохранить**.
 
    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_05.png)

    После этого отобразится значение ключа. Это значение нельзя будет получить позже, поэтому скопируйте его сразу. **Это значение** необходимо предоставить вместе с идентификатором приложения для входа от имени приложения. Сохраните значение ключа, чтобы приложение могло получить к нему доступ.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_06.png)

### <a name="get-tenant-id"></a>Получение идентификатора клиента

Как часть конфигурации конечной точки службы, VSTS требует **идентификатор клиента**, который соответствует каталогу AAD, в который была развернута метка Azure Stack. Следуйте указаниям в этом разделе, чтобы получить идентификатор клиента.

1. Выберите **Azure Active Directory**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_07.png)

2. Чтобы получить идентификатор клиента, щелкните **Свойства** для клиента Azure AD.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_08.png)
 
3. Скопируйте **идентификатор каталога**. Это и есть ваш идентификатор клиента.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_09.png)

### <a name="grant-the-service-principal-rights-to-deploy-resources-in-the-azure-stack-subscription"></a>Предоставление прав субъекта-службы, чтобы развернуть ресурсы в подписке Azure Stack 

Чтобы обеспечить доступ к ресурсам в подписке, необходимо назначить приложению роль. Укажите, какая роль предоставит приложению необходимые разрешения. Дополнительные сведения о доступных ролях см. в статье [RBAC: встроенные роли](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles).

Вы можете задать область действия на уровне подписки, группы ресурсов или ресурса. Разрешения наследуют более низкие уровни области действия. Например, добавление приложения в роль читателя для группы ресурсов означает, что оно может считывать группу ресурсов и все содержащиеся в ней ресурсы.

1. Перейдите на уровень области действия, которому вы хотите назначить приложение. Например, чтобы назначить роль в области действия подписки выберите **Подписки**. Или же вы можете выбрать группу ресурсов либо отдельный ресурс.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_10.png)

2. Выберите **подписку** (группу ресурсов или ресурс), которым будет назначено приложение.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_11.png)

3. Выберите **Управление доступом (IAM)**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_12.png)

4. Выберите **Добавить**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_13.png)

5. Выберите роль, которая будет назначена приложению. На следующем изображении представлена роль **Владелец**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_14.png)

6. По умолчанию приложения Azure Active Directory не отображаются среди доступных вариантов. Чтобы найти приложение, **укажите его имя** в поле поиска. Выберите его.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_16.png)

7. Выберите **Сохранить**, чтобы завершить назначение роли. Вы увидите свое приложение в списке пользователей, назначенных выбранной роли для выбранной области действия.

### <a name="role-based-access-control"></a>Управление доступом на основе ролей

Контроль доступа на основе ролей (RBAC) Azure обеспечивает точное управление доступом для Azure. С помощью RBAC можно предоставлять пользователям доступ, необходимый только для выполнения поставленных перед ними задач. Дополнительные сведения об управлении доступом на основе ролей см. в статье [Использование управления доступом на основе ролей для контроля доступа к ресурсам в подписке Azure](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal?toc=%252fazure%252factive-directory%252ftoc.json).

### <a name="vsts-agent-pools"></a>Пулы агентов VSTS

Вместо управления каждым агентом по отдельности, упорядочивайте агенты в пулы. Пул агентов определяет общую границу для всех агентов в этом пуле. В VSTS пулы агентов ограничиваются только учетной записью VSTS, поэтому вы можете совместно использовать пулы агентов в командных проектах. Дополнительные сведения и руководство по созданию пулов агентов VSTS см. в статье [Agent pools and queues](https://docs.microsoft.com/vsts/build-release/concepts/agents/pools-queues?view=vsts) (Очереди и пулы агентов).

### <a name="add-a-personal-access-token-pat-for-azure-stack"></a>Добавление личного маркера доступа для Azure Stack

1. Войдите в учетную запись VSTS и выберите имя профиля учетной записи.
2. Выберите **Управление безопасностью**, чтобы получить доступ к странице создания маркера.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_17.png)

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_18.png)

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_18a.png)

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_18b.png)

3. Скопируйте маркер.
    
    > [!Note]  
    > Получите сведения о маркере. Они не будут отображаться, когда вы перейдете с этой страницы. 
    
    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_19.png)
    

### <a name="install-the-vsts-build-agent-on-the-azure-stack-hosted-build-server"></a>Установка агента сборки VSTS на сервере сборки, размещенном в Azure Stack

1.  Подключитесь к серверу сборки, развернутом на узле Azure Stack.

2.  Скачайте, а затем разверните агент сборки в качестве службы, используя личный маркер доступа, и запустите его от имени учетной записи администратора виртуальной машины.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\010_downloadagent.png)

3. Перейдите в извлеченную папку агента сборки. Запустите файл **run.cmd** из командной строки с повышенными привилегиями. 

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_20.png)

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\000_21.png)

4.  После выполнения файла run.cmd папка с извлеченным содержимым должна выглядеть следующим образом:

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\009_token_file.png)

    Теперь можно увидеть агент в папке VSTS.

## <a name="endpoint-creation-permissions"></a>Разрешения на создание конечной точки

Пользователи могут создавать конечные точки, поэтому сборки VSTO могут развертывать приложения службы приложений в стек. VSTS подключается к агенту сборки, который затем подключается к Azure Stack. 

![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\012_securityendpoints.png)

1. В меню **параметров** выберите **Безопасность**.
2. В списке **Группы VSTS** слева выберите **Создатели конечных точек**. 

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\013_endpoint_creators.png)

3. На вкладке **Участники** выберите **+Добавить**. 

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\014_members_tab.png)

4. Введите имя пользователя и выберите этого пользователя из списка.
5. Нажмите кнопку **Сохранить изменения**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\015_save_endpoint.png)

6. В списке **Группы VSTS** слева выберите **Администраторы конечной точки**.
7. На вкладке **Участники** выберите **+Добавить**.
8. Введите имя пользователя и выберите этого пользователя из списка.
9. Нажмите кнопку **Сохранить изменения**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\016_save_changes.png)

    Агент сборки в Azure Stack получает инструкции от VSTS, который затем передает сведения о конечной точке для взаимодействия с Azure Stack. 
    
    Подключение между VSTS и Azure Stack установлено.

## <a name="develop-your-application"></a>Разработка приложения

Настройте гибридный конвейер непрерывной интеграции и непрерывной поставки, чтобы развернуть веб-приложение в Azure и Azure Stack, а также автоматически отправлять изменения в оба облака.

> [!Note]  
> Вам необходим Azure Stack с подходящими образами, объединенными для запуска (Windows Server и SQL), и развернутой службой приложений. Просмотрите раздел "Предварительные требования" в документации о службе приложений, чтобы узнать требования к оператору Azure Stack.

### <a name="add-code-to-vsts-project"></a>Добавление кода в проект VSTS

1. Войдите в Visual Studio, используя учетную запись, которая обладает правами на создание проекта в Azure Stack.

    Гибридные процессы непрерывной интеграции и непрерывной поставки применимы и к коду приложения, и к коду инфраструктуры. Используйте такие [шаблоны Azure Resource Manager](https://azure.microsoft.com/resources/templates/), как развертывание кода приложения из VSTS в обоих облаках.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\017_connect_to_project.png)

2. **Клонируйте репозиторий** путем создания и открытия веб-приложения по умолчанию.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\018_link_arm.png)

### <a name="create-self-contained-web-app-deployment-for-app-services-in-both-clouds"></a>Создание автономного развертывания веб-приложения для служб приложений в обоих облаках

1. Измените файл **WebApplication.csproj**. Выберите **Runtimeidentifier** и добавьте `win10-x64.`. Дополнительные сведения см. в документации [по автономному развертыванию](https://docs.microsoft.com/dotnet/core/deploying/#self-contained-deployments-scd).

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\019_runtimeidentifer.png)

2. Добавьте код в VSTS с помощью Team Explorer.

3. Убедитесь, что код приложения был добавлен в Visual Studio Team Services. 

### <a name="create-the-build-definition"></a>Создание определения сборки

1. Войдите в VSTS, чтобы подтвердить возможность создания определений сборки.

2. Добавьте код **-r win10-x64**. Это необходимо, чтобы активировать автономное развертывание с .Net Core. 

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\020_publish_additions.png)

3. Запустите сборку. Процесс [сборки автономного развертывания](https://docs.microsoft.com/dotnet/core/deploying/#self-contained-deployments-scd) будет публиковать артефакты, которые могут выполняться в Azure и Azure Stack.

### <a name="using-an-azure-hosted-agent"></a>Использование агента, размещенного в Azure

Использование размещенного агента в VSTS удобно для создания и развертывания веб-приложений. Обновление и обслуживание, включая постоянную, непрерывную разработку, тестирование и развертывание, автоматически выполняются Microsoft Azure.

### <a name="manage-and-configure-the-continuous-deployment-cd-process"></a>Настройка процесса непрерывного развертывания и управление им

Visual Studio Team Services и Team Foundation Server предоставляют конвейер с широкими возможностями настройки и управления для выпусков в различные среды, такие как среда развертывания, промежуточная среда, среда для контроля качества и рабочая среда, включая получение утверждений на определенных стадиях.

### <a name="create-release-definition"></a>Создание определения выпуска

![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\021a_releasedef.png)

1. Выберите **\[ + ]**, чтобы добавить новый выпуск на **вкладку выпусков** на странице сборки и выпуска VSO.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\102.png)

2. Примените шаблон **развертывания службы приложений Azure**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\103.png)

3. В раскрывающемся меню добавления артефакта **выберите соответствующую команду** для приложения сборки облака Azure.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\104.png)

4. На вкладке "Конвейер" выберите ссылку **Фаза**, **Задача** среды и задайте значения облачной среды Azure.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\105.png)

5. Задайте **имя среды** и выберите **подписку** Azure для конечной точки облака Azure.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\106.png)

6. В разделе имени среды задайте требуемое **имя службы приложений Azure**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\107.png)

7. Введите **Размещенная среда VS2017** в очереди агента для среды, размещенной в облаке Azure.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\108.png)

8. В меню развертывания службы приложений Azure выберите допустимый для среды **пакет или папку**. Нажмите кнопку **ОК**, чтобы выбрать **расположение папки**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\109.png)

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\110.png)

9. Сохраните все изменения и вернитесь к **конвейеру выпуска**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\111.png)

10. Добавьте **новый артефакт**, выбрав сборку для приложения Azure Stack.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\112.png)

11. Добавьте еще одну среду, применив **развертывание службы приложений Azure**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\113.png)

12. Назовите новую среду **Azure Stack**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\114.png)

13. Найдите среду Azure Stack на вкладке **Задача**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\115.png)

14. Выберите **подписку** для конечной точки Azure Stack.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\116.png)

15. Задайте имя веб-приложения Azure Stack в качестве **имени службы приложений**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\117.png)

16. Выберите **агент Azure Stack**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\118.png)

17. В разделе развертывания службы приложений Azure выберите допустимый для среды **пакет или папку**. Нажмите кнопку "ОК", чтобы выбрать **расположение папки**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\119.png)

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\120.png)

18. В разделе "Переменные" добавьте переменную **VSTS_ARM_REST_IGNORE_SSL_ERRORS**, задайте ей значение **true** и область **Azure Stack**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\121.png)

19. Выберите значок триггера **непрерывного** развертывания в обеих артефактах и включите триггер непрерывного развертывания.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\122.png)

20. Выберите значок условий **перед развертыванием** в среде Azure Stack и задайте триггеру значение **После выпуска**.

21. Сохраните все изменения.

> [!Note]  
> Некоторые параметры для задач могли быть автоматически определены как [переменные среды](https://docs.microsoft.com/vsts/build-release/concepts/definitions/release/variables?view=vsts#custom-variables) при создании определения выпуска на основе шаблона. Эти параметры невозможно изменить в параметрах задачи. Чтобы изменить их, необходимо выбрать родительский элемент среды.

## <a name="create-a-release"></a>Создание выпуска

После выполнения изменений в определении выпуска пришло время начать развертывание. Чтобы сделать это, создайте выпуск из определения выпуска. Выпуск может создаваться автоматически, например, если триггер непрерывного развертывания задан в определении выпуска. Это означает, что изменение исходного кода запустит новую сборку и, таким образом, новый выпуск. Однако в этом разделе вы создадите новый выпуск вручную.

1. Откройте раскрывающийся список **Выпуск** и выберите **Создать выпуск**.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\200.png)
 
2. Введите описание выпуска, проверьте, выбраны ли правильные артефакты, а затем щелкните **Создать**. Через несколько секунд появится баннер, который покажет, что новый выпуск был создан. Выберите ссылку (имя выпуска).

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\201.png)
 
3. Откроется страница со сводными данными о выпуске. В разделе **Среды** вы увидите, как состояние развертывания среды контроля качества изменится с "Выполняется" на "Успешно", а затем появится баннер, показывающий, что выпуск ожидает утверждения. Если развертывание в среду находится в состоянии ожидания или завершилось с ошибкой, отобразится синий значок информации (i). Наведите на него курсор, чтобы увидеть всплывающий элемент со сведениями о причине.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\202.png)

Другие представления, такие как список выпусков, также отображают значок, который указывает, что ожидается утверждение. Если навести на значок, появится всплывающий элемент, содержащий имя среды и дополнительные сведения. Благодаря этому администратор может легко увидеть, какие выпуски ожидают утверждения, а также общий ход выполнения всех выпусков.

### <a name="monitor-and-track-deployments"></a>Мониторинг и отслеживание развертываний

В этом разделе показано, как можно выполнять мониторинг и отслеживать развертывания (в этом примере — на два веб-сайта служб приложений Azure) из выпуска, созданного в предыдущем разделе.

1. На странице сводных данных о выпуске выберите ссылку **Журналы**. Во время развертывания на этой странице отображается динамический журнал агента, а на панели слева — значение состояния каждой операции в процессе развертывания для каждой среды.

    Выберите значок в столбце **Действие** для утверждения до развертывания (или после), чтобы просмотреть сведения о том, кто одобрил (или отклонил) развертывание, и сообщение от пользователя.

2. После завершения развертывания в области справа отображается весь файл журнала. Выберите любой из **шагов обработки** в левой области, чтобы отобразить содержимое журнала файла только для данного шага. Это упрощает трассировку и отладку отдельных частей общего развертывания. Кроме того, вы можете скачать отдельные файлы журнала или ZIP-файл всех файлов журнала, используя значки и ссылки на странице.

    ![Альтернативный текст](media\azure-stack-solution-hybrid-pipeline\203.png)
 
3. Откройте вкладку **Сводка**, чтобы увидеть общие сведения о выпуске. На ней отображаются сведения о сборке и средах, в которые она была развернута, вместе с состоянием развертывания и другой информацией о выпуске.

4. Выберите каждую из **ссылок среды**, чтобы получить дополнительные сведения об имеющихся развертываниях и развертываниях в состоянии ожидания для определенной среды. Эти страницы можно использовать, чтобы убедиться, что та же сборка была развернута в обеих средах.

5. Откройте **развернутое рабочее приложение** в своем браузере. Например, для веб-сайта службы приложений Azure URL-адрес будет таким: `http://[your-app-name].azurewebsites.net`.

## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения о шаблонах для облака Azure см. в статье [Конструктивные шаблоны облачных решений](https://docs.microsoft.com/azure/architecture/patterns).
