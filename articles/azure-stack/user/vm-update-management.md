---
title: Обновление и администрирование виртуальной машины с помощью Azure Stack | Документация Майкрософт
description: Узнайте, как использовать решения "Управление обновлениями", "Отслеживание изменений" и инвентаризации в службе автоматизации Azure для управления виртуальными машинами Windows и Linux, развернутыми в Azure Stack.
services: azure-stack
documentationcenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/15/2018
ms.author: jeffgilb
ms.reviewer: rtiberiu
ms.lastreviewed: 10/15/2018
ms.openlocfilehash: 69a0bde58a365ff124bc41b6039c606cb38f71fe
ms.sourcegitcommit: 415742227ba5c3b089f7909aa16e0d8d5418f7fd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2019
ms.locfileid: "55768551"
---
# <a name="azure-stack-vm-update-and-management"></a>Обновление и администрирование виртуальной машины Azure Stack
Для управления виртуальными машинами Windows и Linux, развернутыми с помощью Azure Stack, можно использовать следующие функции решения службы автоматизации Azure.

- **[Управление обновлениями](https://docs.microsoft.com/azure/automation/automation-update-management)**. Благодаря решению "Управление обновлениями" можно быстро оценить состояние доступных обновлений на всех компьютерах агентов и управлять установкой необходимых обновлений для виртуальных машин Windows и Linux.

- **[Отслеживание изменений](https://docs.microsoft.com/azure/automation/automation-change-tracking)**. Данные об изменениях установленного ПО, служб, файлов и реестров Windows и управляющих программ Linux на наблюдаемых серверах отправляются в службу Log Analytics в облаке для обработки. К полученным данным применяется логика и облачная служба записывает данные. С помощью сведений на панели мониторинга «Отслеживание изменений» можно без труда обнаружить изменения, внесенные в инфраструктуру серверов.

- **[Инвентаризация](https://docs.microsoft.com/azure/automation/automation-vm-inventory)**. Отслеживание данных для виртуальной машины Azure Stack предоставляет пользовательский интерфейс на основе веб-браузера для установки и настройки сбора данных инвентаризации. 

> [!IMPORTANT]
> Эти решения идентичны тем, которые используются для управления виртуальными машинами Azure. Управление виртуальными машинами Azure и Azure Stack осуществляется одинаково с помощью одного и того же интерфейса и инструментов. При использовании решений "Управление обновлениями", "Отслеживание изменений" и инвентаризации в Azure Stack на виртуальные машины Azure Stack цена такая же, как и на виртуальные машины Azure.

## <a name="prerequisites"></a>Предварительные требования
Прежде чем использовать эти возможности обновления виртуальных машин Azure Stack и управления ими, необходимо выполнить несколько предварительных условий. К ним относятся действия, которые необходимо выполнить на портале Azure, а также на портале администрирования Azure Stack.

### <a name="in-the-azure-portal"></a>На портале Azure
Чтобы использовать такие возможности автоматизации, как инвентаризация, "Отслеживание изменений" и "Управление обновлениями" для виртуальных машин Azure Stack, необходимо сначала включить эти решения в Azure.

> [!TIP]
> Если эти возможности уже включены для виртуальных машин Azure, можно использовать учетные данные существующей рабочей области LogAnalytics. Если уже существует идентификатор рабочей области и первичный ключ LogAnalytics, которые необходимо использовать, сразу перейдите к [следующему разделу](./vm-update-management.md#in-the-azure-stack-administration-portal). В противном случае оставайтесь в этом разделе, чтобы создать новую рабочую область LogAnalytics и учетную запись службы автоматизации.

Первый шаг в обеспечении этих решений — [создание рабочей области LogAnalytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-quick-create-workspace) в подписке Azure. Рабочая область Log Analytics — это уникальная среда Log Analytics со своим собственным репозиторием данных, источниками данных и решениями. После создания рабочей области запишите идентификатор рабочей области и ключ. Чтобы просмотреть эти сведения, перейдите к колонке "Рабочая область", щелкните **Дополнительные параметры** и просмотрите значения **Идентификатор рабочей области** и **Первичный ключ**. 

Затем нужно [создать учетную запись службы автоматизации](https://docs.microsoft.com/azure/automation/automation-create-standalone-account). Учетная запись автоматизации — это контейнер для ресурсов в службе автоматизации Azure. Он позволяет разделять среды и дополнительно упорядочивать рабочие процессы автоматизации и ресурсы. После создания учетной записи службы автоматизации необходимо включить возможности инвентаризации, отслеживания изменений и управления обновлениями. Для включения каждого из компонентов выполните следующие шаги.

1. На портале Azure перейдите к учетной записи службы автоматизации, которую нужно использовать.

2. Выберите решение, которое нужно включить (**Инвентаризация**, **Отслеживание изменений** или **Управление обновлениями**).

3. Используйте раскрывающийся список **Выберите рабочую область...**, чтобы выбрать для использования рабочую область Log Analytics.

4. Проверьте на правильность остальные сведения, а затем щелкните **Включить**, чтобы включить решение.

5. Повторите шаги 2–4, чтобы включить все три решения. 

   [![](media/vm-update-management/1-sm.PNG "Возможности включения учетной записи службы автоматизации")](media/vm-update-management/1-lg.PNG#lightbox)

### <a name="in-the-azure-stack-administration-portal"></a>На портале администрирования Azure Stack
После включения решений службы автоматизации на портале Azure необходимо войти на портал администрирования Azure Stack как администратор облака и скачать элементы Marketplace расширения **Управление конфигурацией и обновлениями Azure** и **Управление конфигурацией и обновлениями Azure в Linux** для Azure Stack. 

   ![Элемент Marketplace расширения Azure Update and Configuration Management (Управление конфигурацией и обновлениями Azure)](media/vm-update-management/2.PNG) 

## <a name="enable-update-management-for-azure-stack-virtual-machines"></a>Включение Управления обновлениями для виртуальных машин Azure Stack
Чтобы включить управление обновлениями для виртуальных машин в Azure Stack, выполните следующие действия.

1. Войдите на пользовательский портал Azure Stack.

2. На пользовательском портале Azure Stack перейдите в колонку "Расширения" виртуальных машин, для которых необходимо включить эти решения, щелкните **+ Добавить**, выберите расширение **Azure Update and Configuration Management** (Управление конфигурацией и обновлениями Azure) и щелкните **Создать**.

   [![](media/vm-update-management/3-sm.PNG "Колонка расширения виртуальной машины")](media/vm-update-management/3-lg.PNG#lightbox)

3. Укажите созданный ранее идентификатор рабочей области и первичный ключ для связи агента с рабочей областью LogAnalytics и щелкните **ОК**, чтобы развернуть расширение.

   [![](media/vm-update-management/4-sm.PNG "Указание идентификатора рабочей области и ключа")](media/vm-update-management/4-lg.PNG#lightbox) 

4. Как описано в статье [Решение для управления обновлениями в Azure](https://docs.microsoft.com/azure/automation/automation-update-management), необходимо включить решение "Управление обновлениями" для каждой виртуальной машины, которой нужно управлять. Чтобы включить решение для всех виртуальных машин, которые отправляют отчеты в рабочую область, выберите **Управление обновлениями**, щелкните **Управление компьютерами**, а затем выберите параметр **Включить для всех доступных и будущих компьютеров**.

   [![](media/vm-update-management/5-sm.PNG "Указание идентификатора рабочей области и ключа")](media/vm-update-management/5-lg.PNG#lightbox) 

   > [!TIP]
   > Повторите этот шаг, чтобы включить каждое решение для виртуальных машин Azure Stack, отправляющих отчетные данные в эту рабочую область. 
  
После включения расширения "Управление конфигурацией и обновлениями Azure" проверка для каждой управляемой виртуальной машины выполняется дважды в день. Каждые 15 минут вызывается API, чтобы запросить время последнего обновления и определить, изменилось ли состояние. Если состояние изменилось, запускается проверка на соответствие.

После проверки виртуальные машины будут отображаться в учетной записи службы автоматизации Azure в решении "Управление обновлениями". 

   [![](media/vm-update-management/6-sm.PNG "Указание идентификатора рабочей области и ключа")](media/vm-update-management/6-lg.PNG#lightbox) 

> [!IMPORTANT]
> Отображение обновленных данных с управляемых компьютеров на панели мониторинга может занять от 30 минут до 6 часов.

Теперь виртуальные машины Azure Stack можно включить в запланированные развертывания обновлений вместе с виртуальными машинами Azure.

## <a name="enable-update-management-using-a-resource-manager-template"></a>Включение Управления обновлениями с помощью шаблона Resource Manager
При наличии большого количества виртуальных машин Azure Stack можно использовать [этот шаблон Azure Resource Manager](https://github.com/Azure/AzureStack-QuickStart-Templates/tree/master/MicrosoftMonitoringAgent-ext-win), чтобы упростить развертывание решения на виртуальных машинах. Шаблон развертывает расширение Microsoft Monitoring Agent на имеющейся виртуальной машине Azure Stack и добавляет его в имеющуюся рабочую область LogAnalytics Azure.
 
## <a name="next-steps"></a>Дополнительная информация
[Оптимизация производительности SQL Server](azure-stack-sql-server-vm-considerations.md)
