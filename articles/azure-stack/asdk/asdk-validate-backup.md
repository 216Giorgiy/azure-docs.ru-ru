---
title: Проверка резервной копии Azure Stack с помощью ASDK | Документация Майкрософт
description: Способы проверки резервной копии интегрированных систем Azure Stack с помощью ASDK.
services: azure-stack
author: jeffgilb
manager: femila
cloud: azure-stack
ms.service: azure-stack
ms.topic: article
ms.date: 02/06/2018
ms.author: jeffgilb
ms.reviewer: hectorl
ms.lastreviewed: 09/05/2018
ms.openlocfilehash: 02ecb3cdec9ddb07bf48dfe77d1ed5fbf07975e0
ms.sourcegitcommit: d1c5b4d9a5ccfa2c9a9f4ae5f078ef8c1c04a3b4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2019
ms.locfileid: "55965330"
---
# <a name="use-the-asdk-to-validate-an-azure-stack-backup"></a>Проверка резервной копии Azure Stack с помощью ASDK
После развертывания Azure Stack и подготовки ресурсов пользователей, таких как предложения, планы, квоты и подписки, следует [включить резервное копирование инфраструктуры Azure Stack](../azure-stack-backup-enable-backup-console.md). Регулярное резервное копирование инфраструктуры и его планирование гарантирует сохранность данных управления инфраструктурой в случае критического сбоя в работе оборудования или службы.

> [!TIP]
> Перед началом этой процедуры мы рекомендуем [выполнить резервное копирование по запросу](../azure-stack-backup-back-up-azure-stack.md), чтобы сделать актуальную копию данных инфраструктуры. После успешного резервного копирования запишите идентификатор резервной копии. Этот идентификатор потребуется во время восстановления облака. 

Резервные копии инфраструктуры Azure Stack содержат важные данные о вашем облаке, которые можно восстановить в ходе повторного развертывания Azure Stack. С помощью ASDK можно проверить эти резервные копии без вмешательства в функционирование рабочего облака. 

ASDK поддерживает указанные ниже сценарии проверки резервных копий.

|Сценарий|Назначение|
|-----|-----|
|Проверка резервных копий инфраструктуры из интегрированного решения.|Быстрая проверка корректности данных в резервной копии.|
|Комплексное изучение рабочего процесса восстановления.|Проверка полного цикла резервного копирования и восстановления с помощью ASDK.|
|     |     |

ASDK **не** поддерживает указанные ниже сценарии проверки резервных копий.

|Сценарий|Назначение|
|-----|-----|
|Создания резервной копии данных и их восстановление в новой сборке ASDK.|Восстановление резервной копии данных старой версии в новой версии ASDK.|
|     |     |


## <a name="cloud-recovery-deployment"></a>Развертывание восстановленного облака
Резервные копии инфраструктуры можно проверить в развернутых интегрированных системах, выполнив развертывание восстановленного облака ASDK. При этом типе развертывания из резервной копии восстанавливаются определенные служебные данные после установки ASDK на главном компьютере.



### <a name="prereqs"></a>Предварительные требования для восстановления облака
Чтобы развернуть восстановленное облако ASDK, понадобятся указанные ниже сведения.

|Предварительные требования|ОПИСАНИЕ|
|-----|-----|
|Путь к общей папке с резервной копией.|Путь в формате UNC к общей папке с последней резервной копией Azure Stack, которая будет использоваться для восстановления данных инфраструктуры Azure Stack. Эта локальная общая папка создается в процессе развертывания восстанавливаемого облака.|
|Ключ шифрования резервной копии.|Ключ шифрования, который использовался при планировании запуска резервного копирования на портале администрирования Azure Stack.|
|Идентификатор восстанавливаемой резервной копии.|Идентификатор резервной копии в буквенно-цифровом формате "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx", принадлежащий резервной копии, с помощью которой будет восстанавливаться облако.|
|IP-адрес сервера времени.|Допустимый IP-адрес сервера времени, например 132.163.97.2, необходим для развертывания Azure Stack.|
|Пароль внешнего сертификата.|Пароль внешнего сертификата, используемого Azure Stack. Резервная копия ЦС содержит внешние сертификаты, которые необходимо восстановить с помощью этого пароля.|
|     |     | 

## <a name="prepare-the-host-computer"></a>Подготовка компьютера для размещения 
Как и при обычном развертывании ASDK, необходимо подготовить среду ASDK для установки. После подготовки данные главного компьютера, на котором будет размещен пакет средств разработки, загружаются с виртуального жесткого диска CloudBuilder.vhdx, чтобы начать развертывание ASDK.

На главном компьютере ASDK скачайте новый файл cloudbuilder.vhdx, соответствующий версии Azure Stack, для которой выполнялось резервное копирование, и следуйте инструкциям по [подготовке главного компьютера ASDK](asdk-prepare-host.md).

После перезагрузки главного компьютера с cloudbuilder.vhdx необходимо создать общую папку и поместить в нее резервную копию. Общая папка должна быть доступна для учетной записи, из которой выполняется установка. В показанном ниже примере команд PowerShell это учетная запись Administrator. 

```powershell
$shares = New-Item -Path "c:\" -Name "Shares" -ItemType "directory"
$azsbackupshare = New-Item -Path $shares.FullName -Name "AzSBackups" -ItemType "directory"
New-SmbShare -Path $azsbackupshare.FullName -FullAccess ($env:computername + "\Administrator")  -Name "AzSBackups"
```

Затем скопируйте последнюю резервную копию Azure Stack в созданную общую папку. Структура папок внутри общей папки должна быть такой: `\\<ComputerName>\AzSBackups\MASBackup\<BackupID>\`.

## <a name="deploy-the-asdk-in-cloud-recovery-mode"></a>Развертывание ASDK в режиме восстановления облака
Облако восстанавливается с помощью скрипта **InstallAzureStackPOC.ps1**. 

> [!IMPORTANT]
> Установка ASDK поддерживает только один сетевой адаптер (NIC) для работы в сети. При наличии нескольких сетевых интерфейсов перед выполнением сценария развертывания включите только один из них, а все остальные отключите.

### <a name="use-the-installer-to-deploy-the-asdk-in-recovery-mode"></a>Использование установщика для развертывания пакета ASDK в режиме восстановления
В этом разделе представлены шаги, позволяющие развернуть ASDK с помощью графического пользовательского интерфейса (GUI), полученного путем скачивания и выполнения скрипт PowerShell **asdk-installer.ps1**.

> [!NOTE]
> Пользовательский интерфейс установщика для Пакета средств разработки Azure Stack — это скрипт с открытым кодом на основе WCF и PowerShell.

1. Когда главный компьютер успешно загрузится в образ CloudBuilder.vhdx, войдите с учетными данными администратора, которые вы указали [при подготовке главного компьютера пакета средств разработки](asdk-prepare-host.md) для установки ASDK. Эти учетные данные должны совпадать с учетными данными локального администратора узла Пакета средств разработки.
2. Откройте консоль с повышенными привилегиями и выполните сценарий PowerShell **&lt;буква_диска>\AzureStack_Installer\asdk-installer.ps1**. Теперь сценарий может находиться не только на диске C:\ в образе CloudBuilder.vhdx. Щелкните **Восстановить**.

    ![Сценарий установщика пакета ASDK](media/asdk-validate-backup/1.PNG) 

3. Введите данные каталога Azure AD (необязательно) и пароль локального администратора для главного компьютера ASDK на странице поставщика удостоверений и учетных данных. Щелкните **Далее**.

    ![Страница идентификации и учетных данных](media/asdk-validate-backup/2.PNG) 

4. Выберите сетевой адаптер для использования с главного компьютера ASDK и щелкните **Далее**. Во время установки пакета ASDK все остальные сетевые интерфейсы будут отключены. 

    ![Интерфейс сетевого адаптера](media/asdk-validate-backup/3.PNG) 

5. На странице "Конфигурация сети" укажите действительные IP-адреса сервера времени и DNS-сервера пересылки. Щелкните **Далее**.

    ![Страница "Конфигурация сети"](media/asdk-validate-backup/4.PNG) 

6. После проверки свойств карты сетевого интерфейса нажмите **Далее**. 

    ![Проверка параметров сетевой карты](media/asdk-validate-backup/5.PNG) 

7. Укажите необходимые данные, описанные ранее в разделе[ Предварительные требования для восстановления облака](#prereqs) на странице "Настройки архивации", а также имя пользователя и пароль, которые будут использоваться для доступа к общему ресурсу. Щелкните **Далее**. 

   ![Страница "Настройка архивации"](media/asdk-validate-backup/6.PNG) 

8. Просмотрите сценарий развертывания, который будет использоваться для развертывания пакета ASDK на странице "Сводка". Щелкните **Развернуть**, чтобы начать развертывание. 

    ![Страница "Сводка"](media/asdk-validate-backup/7.PNG) 


### <a name="use-powershell-to-deploy-the-asdk-in-recovery-mode"></a>Использование PowerShell для развертывания пакета ASDK в режиме восстановления
Измените приведенные ниже команды PowerShell для своей среды и выполните их, чтобы развернуть ASDK в режиме восстановления облака.

```powershell
cd C:\CloudDeployment\Setup     
$adminPass = Get-Credential Administrator
$key = ConvertTo-SecureString "<Your backup encryption key>" -AsPlainText -Force ` 
$certPass = Read-Host -AsSecureString  

.\InstallAzureStackPOC.ps1 -AdminPassword $adminpass.Password -BackupStorePath ("\\" + $env:COMPUTERNAME + "\AzSBackups") `
-BackupEncryptionKeyBase64 $key -BackupStoreCredential $adminPass -BackupId "<Backup ID to restore>" `
-TimeServer "<Valid time server IP>" -ExternalCertPassword $certPass
```

## <a name="restore-infrastructure-data-from-backup"></a>Восстановление данных инфраструктуры из резервной копии
После успешного развертывания восстановленного облака необходимо завершить восстановление с помощью командлета **Restore-AzureStack**. 

После входа в систему в качестве оператора Azure Stack [установите PowerShell для Azure Stack](asdk-post-deploy.md#install-azure-stack-powershell) и выполните приведенную ниже команду, задав для параметра `Name` значение, соответствующее идентификатору резервной копии.

```powershell
Restore-AzsBackup -Name "<BackupID>"
```
Подождите 60 минут после вызова этого командлета, а затем запустите проверку данных резервного копирования в восстановленном облаке ASDK.

## <a name="next-steps"></a>Дополнительная информация
[Регистрация Azure Stack](asdk-register.md)

