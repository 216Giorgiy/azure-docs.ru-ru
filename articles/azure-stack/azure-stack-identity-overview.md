---
title: "Общие сведения об удостоверениях Azure Stack | Документация Майкрософт"
description: "Сведения о системах идентификации, которые можно использовать с помощью Azure Stack."
services: azure-stack
documentationcenter: 
author: brenduns
manager: femila
editor: 
ms.assetid: 
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 2/22/2018
ms.author: brenduns
ms.reviewer: 
ms.openlocfilehash: 609ea3300806f3cfed4a3285a096f59be491c684
ms.sourcegitcommit: fbba5027fa76674b64294f47baef85b669de04b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/24/2018
---
# <a name="overview-of-identity-for-azure-stack"></a>Общие сведения об удостоверениях Azure Stack

Для работы Azure Stack требуется Azure AD или службы федерации Active Directory (AD FS) на базе Active Directory (AD) в качестве поставщика удостоверений. Указанные ниже основные понятия и сведения об авторизации могут помочь вам выбрать поставщика удостоверений. Решение о выборе поставщика принимается один раз во время развертывания Azure Stack.  

Выбор между Azure AD и AD FS может ограничиваться режимом, в котором вы развернули Azure Stack: 
- Если вы выполнили развертывание в режиме с подключением, можно использовать Azure AD или AD FS. 
- Если вы выполнили развертывание в отключенном режиме без подключения к Интернету, поддерживается только AD FS.

В зависимости от среды Azure Stack дополнительные сведения об использовании этих вариантов смотрите в следующих статьях:
- Если вы используете комплект развертывания Azure Stack, ознакомьтесь с разделом [Вопросы относительно удостоверений](azure-stack-datacenter-integration.md#identity-considerations).
- Если вы используете интегрированные системы Azure Stack, ознакомьтесь со статьей [Модели подключения интегрированных систем Azure Stack](azure-stack-deployment-decisions.md).

 
## <a name="common-concepts-for-identity"></a>Основные понятия об удостоверении
В следующих разделах рассматриваются основные понятия, связанные с поставщиками удостоверений, и сведения об их использовании в Azure Stack.
![Терминология для поставщиков удостоверений](media/azure-stack-identity-overview/terminology.png)


### <a name="directories-tenants-and-organizations"></a>Организации и клиенты каталогов
Каталог — это контейнер, который содержит информацию о *пользователях*, *приложениях*, *группах* и *субъектах-служб*.
 
Клиент каталога — это *организация*, как корпорация Майкрософт или ваша компания. 
- Azure AD поддерживает нескольких клиентов и может поддерживать несколько организаций (каждую в собственном каталоге). Если вы используете Azure AD и имеете несколько клиентов, можно предоставить приложениям и пользователям из одного клиента доступ к другим клиентам того же каталога.
- AD FS поддерживает только один клиент, и, следовательно, одну организацию. 

### <a name="users-and-groups"></a>Пользователи и группы
Учетные записи пользователей (удостоверения) — это стандартные учетные записи, выполняющие проверку подлинности отдельных пользователей с помощью идентификатора и пароля пользователя. Группы могут содержать пользователей или другие группы. 

Способ создания пользователей и групп и управление ими зависит от используемого вами решения для идентификации. 

В Azure Stack учетные записи пользователей имеют следующие свойства: 
- Создаются в формате *username@domain*. Хотя AD FS сопоставляет учетные записи пользователей с Active Directory, она не поддерживает использование формата _&lt;домен>\<псевдоним>_. 
- Настраиваются для использования многофакторной проверки подлинности. 
- Ограничены каталогом, в котором они были впервые зарегистрированы. Это каталог организации.
- Их можно импортировать из локальных каталогов. Дополнительные сведения см. в документации Azure [Интеграция локальных каталогов с Azure Active Directory](/azure/active-directory/connect/active-directory-aadconnect).  

Чтобы войти на портал клиента организации, перейдите по адресу https://portal.local.azurestack.external. 

### <a name="guest-users"></a>Гостевые пользователи
Гостевые пользователи — это учетные записи пользователей из других клиентов каталога, которым предоставили доступ к ресурсам в вашем каталоге. Для поддержки гостевых пользователей используйте Azure AD и включите поддержку мультитенантного режима. Если поддержка включена, вы можете предоставить гостевому пользователю доступ к ресурсам в вашем клиенте каталога. Это позволяет активировать совместную работу за пределами организации. 

Чтобы пригласить гостевых пользователей, операторы и пользователи облака могут использовать [службу совместной работы Azure AD B2B](/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b). Приглашенные пользователи получают доступ к документам, ресурсам и приложениям из вашего каталога, сохраняя при этом контроль над собственными ресурсами и данными. 

В качестве гостевого пользователя вы можете войти в другой клиент каталога организации. Для этого необходимо добавить имя каталога организации в URL-адрес портала.  Например, если вы принадлежите к contoso.com, но хотите войти в каталог Fabrikam, используйте этот URL-адрес для входа: https://portal.local.azurestack.external/fabrikam.onmicrosoft.com.

### <a name="applications"></a>ПРИЛОЖЕНИЯ
Вы можете зарегистрировать приложения в Azure AD или AD FS, а затем предложить их пользователям в организации. 

Приложения включают:
- **Веб-приложение.** В качестве примера можно привести портал Azure и Azure Resource Manager.  Они поддерживают вызовы веб-API. 
- **Собственный клиент.** В качестве примера можно привести Azure PowerShell, Visual Studio и интерфейс командной строки Azure.

Приложения могут поддерживать два типа клиентской модели: 
- **Приложения с одним клиентом** поддерживают пользователей и службы только из того же каталога, в котором зарегистрировано приложение. 

  > [!NOTE]    
  > Так как AD FS поддерживает только один каталог, приложения, созданные в топологии AD FS являются по своей природе приложениями с одним клиентом.
- **Мультитенантные** приложения пользователи и службы могут использовать из каталога, в котором зарегистрировано приложение, и из дополнительных каталогов клиента.  С помощью мультитенантных приложений пользователи из другого каталога клиента (другого клиента Azure AD) могут войти в ваше приложение.     

  Дополнительные сведения о мультитенантности см. в статье [Поддержка мультитенантности в Azure Stack](azure-stack-enable-multitenancy.md).  

  Дополнительные сведения о разработке мультитенантного приложения см. в статье [Как реализовать вход любого пользователя Azure Active Directory (AD) с помощью шаблона мультитенантного приложения](/azure/active-directory/develop/active-directory-devhowto-multi-tenant-overview).

При регистрации приложения создаются два объекта:
- **Объект приложения** — это глобальное представление приложения во всех клиентах. С программным приложением устанавливается отношение "один к одному", которое существует только в каталоге, в котором было впервые зарегистрировано приложение.

 
   
- **Объект субъекта-службы** — это объект учетных данных, созданный для приложения в каталоге, в котором впервые зарегистрировано приложение. Субъект-служба также создается в каталоге каждого дополнительного клиента, в которых используется это приложение. С программным приложением может устанавливаться отношение "один ко многим".   

Дополнительные сведения об объектах приложения и субъектах-службы см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory (Azure AD)](/azure/active-directory/develop/active-directory-application-objects). 

### <a name="service-principals"></a>Субъекты-службы 
Субъект-служба — это набор *учетных данных* для приложения или службы, которые предоставляют доступ к ресурсам в Azure Stack. Использование субъекта-службы разделяет разрешения приложения от разрешений пользователя, использующего приложение.

Субъект-служба создается в каждом клиенте, в котором используется приложение. Она создает удостоверения для входа и доступа к ресурсам (например, пользователям), защищенных этим клиентом.   

- Приложение с одним клиентом имеет только один субъект-службу в каталоге, в котором оно впервые создано.  Субъект-служба создается и дает согласие на использование во время регистрации приложения. 
- Для мультитенантного веб-приложения или API также будет создан субъект-служба в каждом клиенте, пользователь которого даст согласие на его использование.  

В качестве учетных данных для субъектов-служб могут использоваться ключ (созданный на портале Azure) или сертификат.  Использование сертификата хорошо подходит для автоматизации, так как сертификаты считаются более безопасными, чем ключи. 


> [!NOTE]    
> При использовании AD FS с Azure Stack только администраторы могут создавать субъекты-службы. При использовании AD FS для субъектов-служб требуются сертификаты. В таком случае субъекты-службы создаются с помощью привилегированной конечной точки. Дополнительные сведения см. в статье [Предоставление приложениям доступа к Azure Stack](azure-stack-create-service-principals.md).

Дополнительные сведения о субъектах-службах для Azure Stack см. в статье [Предоставление приложениям доступа к Azure Stack](azure-stack-create-service-principals.md).


### <a name="services"></a>Службы
Службы в Azure Stack, взаимодействующие с поставщиками удостоверений, регистрируются как приложения с поставщиком удостоверений. Как и в случае с приложениями, регистрация позволяет службе выполнить проверку подлинности с помощью системы идентификации. 

Все службы Azure используют протоколы [OpenID Connect](/azure/active-directory/develop/active-directory-protocols-openid-connect-code) и [JSON Web Tokens](/azure/active-directory/develop/active-directory-token-and-claims) для идентификации. Благодаря согласованному использованию протоколов службами Azure AD и AD FS вы можете использовать [библиотеку проверки подлинности Azure Active Directory](/azure/active-directory/develop/active-directory-authentication-libraries) ADAL, чтобы выполнить проверку подлинности в локальной среде или в Azure (с подключением к Интернету). ADAL также позволяет использовать такие средства, как Azure PowerShell и интерфейс командной строки для управления ресурсами в локальной среде и в нескольких облаках. 


### <a name="identities-and-your-identity-system"></a>Удостоверения и система идентификации 
К удостоверениям для Azure Stack относятся учетные записи пользователей, группы и субъекты-службы. При установке Azure Stack несколько встроенных приложений и служб автоматически регистрируются с помощью поставщика удостоверений в клиенте каталога. Некоторые регистрируемые службы используются для администрирования. Другие службы доступны для пользователей. При стандартной регистрации основные службы получают удостоверения, которые могут взаимодействовать друг с другом и с удостоверениями, добавленными позже.
Если вы настроили Azure AD с поддержкой мультитенантности, некоторые приложения распространяются в новые каталоги.  

## <a name="authentication-and-authorization"></a>Аутентификация и авторизация
 

### <a name="authentication-by-applications-and-users"></a>Проверка подлинности, выполняемая приложениями и пользователями
  
![Удостоверения между слоями Azure Stack](media/azure-stack-identity-overview/identity-layers.png)

Для приложений и пользователей архитектура Azure Stack описывается четырьмя слоями. При взаимодействии между каждым из этих слоев могут использоваться разные типы проверки подлинности.


|Слой    |Проверка подлинности между слоями  |
|---------|---------|
|Средства и клиенты, такие как портал администрирования     | Чтобы получить доступ к ресурсам в Azure Stack или изменить их, средства и клиенты используют [JSON Web Tokens](/azure/active-directory/develop/active-directory-token-and-claims) (JWT) для вызова Azure Resource Manager.  <br><br> Azure Resource Manager проверяет JWT и просматривает *утверждения* в выданном маркере, чтобы оценить уровень авторизации пользователя или субъекта-службы в Azure Stack.        |
|Платформа Azure Resource Manager и ее основные службы     |Azure Resource Manager взаимодействует с поставщиками ресурсов для передачи данных от пользователей. <br><br> Для передачи данных используются *прямые императивные* вызовы или *декларативные* вызовы через [шаблоны Azure Resource Manager](/azure/azure-stack/user/azure-stack-arm-templates.md).|
|Поставщики ресурсов     |Вызовы, передаваемые поставщикам удостоверений, защищены проверкой подлинности на основе сертификатов. <br><br>Azure Resource Manager и поставщик удостоверений затем взаимодействуют с помощью API. Каждый вызов, полученный из Azure Resource Manager, поставщик удостоверений проверяет с помощью сертификата.|
|Инфраструктура и бизнес-логика     |Поставщики удостоверений взаимодействуют с бизнес-логикой и инфраструктурой с помощью режима проверки подлинности на свой выбор. Стандартные поставщики удостоверений, которые поставляются с Azure Stack, используют проверку подлинности Windows для защиты этой связи.|

![Сведения, необходимые для проверки подлинности](media/azure-stack-identity-overview/authentication.png)


### <a name="authenticate-to-azure-resource-manager"></a>Проверка подлинности в Azure Resource Manager
Чтобы выполнить проверку подлинности с помощью поставщика удостоверений и получить JWT, необходимо иметь следующие сведения: 
1.  **URL-адрес для системы идентификации (центр).** URL-адрес, по которому можно связаться с поставщиком удостоверений. Например, *&lt;https://login.windows.net>*. 
2.  **URI идентификатора приложения для Azure Resource Manager.** Уникальный идентификатор для Azure Resource Manager, зарегистрированный с помощью поставщика удостоверений. Он уникальный для каждой установки Azure Stack.
3.  **Учетные данные.** Это учетные данные, которые вы используете для выполнения проверки подлинности с помощью поставщика удостоверений.  
4.  **URL-адрес для Azure Resource Manager.** URL-адрес — это расположение службы Azure Resource Manager. Например, *&lt;https://management.azure.com>* или *&lt;https://management.local.azurestack.external>*.

Когда субъект (клиент, приложение или пользователь) выполняет запрос на проверку подлинности для доступа к ресурсу, запрос должен содержать следующие данные:
- Учетные данные субъекта.
- URI идентификатора приложения ресурса, доступ к которому требуется получить.  

Учетные данные проверяются поставщиком удостоверений. Поставщик удостоверений также проверяет, чтобы URI идентификатора приложения использовался для зарегистрированного приложения и чтобы субъект имел правильные разрешения для получения маркера для ресурса. Если запрос допустимый, предоставляется JSON Web Token. 

Затем маркер передается в заголовке запроса к Azure Resource Manager. Azure Resource Manager в любом порядке выполняет следующие проверки:
- Проверяет утверждение *издателя*, чтобы убедиться, что маркер взят из правильного поставщика удостоверений. 
- Проверяет утверждение *аудитории*, чтобы убедиться, что маркер был выдан для Azure Resource Manager. 
- Проверяет, что JWT подписан с помощью сертификата, настроенного через OpenID и известного для Azure Resource Manager. 
- Просматривает утверждения *времени выдачи* и *срока*, чтобы убедиться, что маркер активный и может быть принят. 

После выполнения всех проверок Azure Resource Manager использует утверждения *объектов* и *групп*, чтобы создать список ресурсов, к которым может получить доступ субъект. 

![Схема протокола обмена маркерами](media/azure-stack-identity-overview/token-exchange.png)


### <a name="use-role-based-access-control"></a>Использование контроля доступа на основе ролей  
Управление доступом на основе ролей (RBAC) в Azure Stack согласуется с реализацией в Microsoft Azure.  Вы можете управлять доступом к ресурсам путем назначения соответствующей роли RBAC пользователям, группам и приложениям. Дополнительные сведения об использовании RBAC с помощью Azure Stack см. в следующих статьях:
- [Начало работы с управлением доступом на основе ролей на портале Azure](/azure/active-directory/role-based-access-control-what-is).
- [Использование управления доступом на основе ролей для контроля доступа к ресурсам в подписке Azure](/azure/active-directory/role-based-access-control-configure).
- [Создание пользовательских ролей для управления доступом на основе ролей в Azure](/azure/active-directory/role-based-access-control-custom-roles).
- [Управление доступом на основе ролей](azure-stack-manage-permissions.md) в Azure Stack.


### <a name="authenticate-with-azure-powershell"></a>Проверка подлинности с помощью Azure PowerShell  
Сведения об использовании Azure PowerShell для выполнения проверки подлинности с помощью Azure Stack см. в статье [Настройка пользовательской среды PowerShell в Azure Stack](azure-stack-powershell-configure-user.md).

### <a name="authenticate-with-azure-cli"></a>Проверка подлинности с помощью Azure CLI
Сведения об использовании Azure PowerShell для выполнения проверки подлинности с помощью Azure Stack см. в статье об [установке и настройке CLI для использования с помощью Azure Stack](/azure/azure-stack/user/azure-stack-connect-cli.md).

## <a name="next-steps"></a>Дополнительная информация
- [Архитектура удостоверения Azure Stack](azure-stack-identity-architecture.md)   
- [Интеграция центра обработки данных Azure Stack: идентификация](azure-stack-integrate-identity.md)




