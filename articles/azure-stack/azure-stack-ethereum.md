---
title: Шаблон решения блокчейна Ethereum Azure Stack
description: Использование шаблонов настраиваемых решений для развертывания и настройки сети блокчейна консорциума Ethereum в Azure Stack
services: azure-stack
keywords: ''
author: PatAltimore
ms.author: patricka
ms.date: 07/03/2018
ms.topic: article
ms.service: azure-stack
ms.reviewer: coborn
manager: femila
ms.openlocfilehash: 0e03b524834f528ddb7555a344fbebe720b4d9ff
ms.sourcegitcommit: 86cb3855e1368e5a74f21fdd71684c78a1f907ac
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2018
ms.locfileid: "37446981"
---
# <a name="azure-stack-ethereum-blockchain-solution-templates"></a>Шаблоны решений блокчейна Ethereum в Azure Stack

Шаблон решения Ethereum должен помочь проще и быстрее развертывать и настраивать сеть блокчейна со множеством членов консорциума Ethereum с минимальными понятиями об Azure и Ethereum.

Небольшой объем входных пользовательских данных и развертывание одним щелчком на клиентском портале Azure Stack позволяют каждому члену подготовить сетевое расположение. Сетевое расположение каждого члена состоит из набора узлов с балансировкой нагрузки транзакций, с помощью которого приложение или пользователь могут взаимодействовать для отправки транзакций, набора узлов майнинга для записи транзакций и сетевого виртуального модуля (NVA). На следующем этапе добавляется подключение NVA для создания полностью настроенной сети блокчейна со множеством членов.

## <a name="prerequisites"></a>предварительным требованиям

Загрузите следующие элементы из Marketplace [Azure Stack](azure-stack-download-azure-marketplace-item.md).

* Ubuntu Server 16.04 LTS версии 16.04.201802220
* Windows Server 2016 
* Настраиваемый скрипт для Linux 2.0 
* Расширение пользовательских сценариев 

Дополнительные сведения о сценариях блокчейна в Azure см. в статье[Шаблон решения консорциума Proof-of-Work для Ethereum](../blockchain-workbench/ethereum-deployment-guide.md).

Нужна также подписка Azure, которая может поддерживать развертывание нескольких виртуальных машин. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?ref=microsoft.com&utm_source=microsoft.com&utm_medium=docs&utm_campaign=visualstudio), прежде чем начинать работу.

## <a name="deployment-architecture"></a>Архитектура развертывания

Этот шаблон решения можно развернуть для одного или множества членов сети консорциума Ethereum. Виртуальная сеть подключена к топологии цепочки с помощью виртуальных сетевых модулей и ресурсов подключения. 

## <a name="deployment-use-cases"></a>Варианты использования развертывания

Шаблон консорциума Ethereum может быть развернут для ведущего, а члены могут присоединяться разными способами. Ниже приведены проверенные способы подключения.
- Во многоузловой системе Azure Stack с помощью Azure AD или AD FS выполняется развертывание ведущего и члена с использованием одной и той же подписки или с разными подписками.
- В одноузловой системе Azure Stack (с Azure AD) развертывание ведущего и члена выполняется с использованием одной подписки.

### <a name="standalone-and-consortium-leader-deployment"></a>Автономное развертывание и развертывание ведущего консорциума

Расположение первого члена в сети настраивается в шаблоне ведущего консорциума. 

1. Загрузите [шаблон ведущего из GitHub](https://raw.githubusercontent.com/Azure/AzureStack-QuickStart-Templates/master/ethereum-consortium-blockchain/marketplace/ConsortiumLeader/mainTemplate.json)
2. Чтобы выполнить развертывание из настраиваемого шаблона, на портале администрирования Azure Stack выберите **Создать > Шаблон развертывания**.
3. Чтобы изменить новый настраиваемый шаблон, выберите **Изменить шаблон**.
4. На панели редактирования справа скопируйте и вставьте шаблон ведущего JSON, который был загружен ранее.
    
    ![Изменение шаблона ведущего](media/azure-stack-ethereum/edit-leader-template.png)

5. Щелкните **Сохранить**.
6. Выберите **Изменить параметры** и завершите настройку параметров шаблона для развертывания.
    
    ![Изменение параметров шаблона ведущего](media/azure-stack-ethereum/edit-leader-parameters.png)

    Имя параметра | ОПИСАНИЕ | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    NAMEPREFIX | Строка используется в качестве основы для именования развернутых ресурсов. | Длина от 1 до 6 буквенно-цифровых символов | eth
    AUTHTYPE | Метод аутентификации на виртуальной машине. | Пароль или открытый ключ SSH | Пароль
    ADMINUSERNAME | Имя администратора для каждой развернутой виртуальной машины | 1–64 знаков | gethadmin
    ADMINPASSWORD (Authentication type = Password)| Пароль учетной записи администратора для каждой развернутой виртуальной машины. Пароль должен содержать символы по меньшей мере трех видов из следующих: 1 строчная буква, 1 прописная буква, 1 цифра и 1 специальный символ. <br />Хотя все виртуальные машины изначально имеют одинаковый пароль, вы можете изменить пароль после инициализации.|12–72 знаков|
    ADMINSSHKEY (Authentication type = sshPublicKey) | Ключ защищенной оболочки, используемый для удаленного входа. | |
    GENESISBLOCK | Строка формата JSON, представляющая пользовательский первичный блок.  Указание значения для этого параметра не является обязательным. | |
    ETHEREUMACCOUNTPSSWD | Пароль администратора, используемый для защиты учетной записи Ethereum. | |
    ETHEREUMACCOUNTPASSPHRASE | Парольная фраза, используемая для создания закрытого ключа, связана с учетной записью Ethereum. | |
    ETHEREUMNETWORKID | Идентификатор сети консорциума. | Используйте любое значение от 5 до 999 999 999 | 72
    CONSORTIUMMEMBERID | Идентификатор, который связан с каждым членом консорциума в сети.   | Он должен обладать уникальным значением. | 0
    NUMMININGNODES | Количество узлов майнинга. | От 2 до 15. | 2
    MNNODEVMSIZE | Размер виртуальной машины узлов майнинга. | | Standard_A1
    MNSTORAGEACCOUNTTYPE | Производительность хранилища узлов майнинга. | | Standard_LRS
    NUMTXNODES | Количество транзакционных узлов. | От 1 до 5. | 1
    TXNODEVMSIZE | Размер виртуальной машины транзакционных узлов. | | Standard_A1
    TXSTORAGEACCOUNTTYPE | Производительность хранилища транзакционных узлов. | | Standard_LRS
    BASEURL | Базовый URL-адрес, который необходим для получения зависимых шаблонов. | Используйте значение по умолчанию, если настраивать шаблоны развертывания нет необходимости. | 

7. Нажмите кнопку **ОК**.
8. На панели **Настраиваемое развертывание** укажите **Подписку**, **Группу ресурсов** и **Расположение группы ресурсов**.
    
    ![Параметры развертывания ведущего](media/azure-stack-ethereum/leader-deployment-parameters.png)

    Имя параметра | ОПИСАНИЕ | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    Подписка | Подписка, для которой необходимо развернуть сеть консорциума | | Подписка потребления
    Группа ресурсов | Группа ресурсов, куда будет развертываться сеть консорциума. | | EthereumResources
    Расположение | Регион Azure для группы ресурсов. | | local

8. Нажмите кнопку **Создать**.

Для развертывания может потребоваться 20 минут и более.

После завершения развертывания можно просмотреть сводку по развертыванию для **Майкрософт. Шаблон** находится в разделе развертывания группы ресурсов. В сводной информации содержаться выходные значения, которые можно использовать для объединения членов консорциума.

Чтобы проверить развертывание ведущего, необходимо перейти на сайт администрирования ведущего. Адрес сайта администрирования можно найти в выходном разделе развертывания **Microsoft.Template**.  

![Сводка по развертыванию ведущего](media/azure-stack-ethereum/ethereum-node-status.png)

### <a name="joining-consortium-member-deployment"></a>Развертывание присоединения членов консорциума

1. Загрузите [шаблон членов консорциума из GitHub](https://raw.githubusercontent.com/Azure/AzureStack-QuickStart-Templates/master/ethereum-consortium-blockchain/marketplace/JoiningMember/mainTemplate.json)
2. Чтобы выполнить развертывание из настраиваемого шаблона, на портале администрирования Azure Stack выберите **Создать > Шаблон развертывания**.
3. Чтобы изменить новый настраиваемый шаблон, выберите **Изменить шаблон**.
4. На панели редактирования, справа, скопируйте и вставьте шаблон ведущего JSON, который был загружен ранее.
5. Щелкните **Сохранить**.
6. Выберите **Изменить параметры** и завершите настройку параметров шаблона для развертывания.

    Имя параметра | ОПИСАНИЕ | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    NAMEPREFIX | Строка используется в качестве основы для именования развернутых ресурсов. | Длина от 1 до 6 буквенно-цифровых символов | eth
    AUTHTYPE | Метод аутентификации на виртуальной машине. | Пароль или открытый ключ SSH | Пароль
    ADMINUSERNAME | Имя администратора для каждой развернутой виртуальной машины | 1–64 знаков | gethadmin
    ADMINPASSWORD (Authentication type = Password)| Пароль учетной записи администратора для каждой развернутой виртуальной машины. Пароль должен содержать символы по меньшей мере трех видов из следующих: 1 строчная буква, 1 прописная буква, 1 цифра и 1 специальный символ. <br />Хотя все виртуальные машины изначально имеют одинаковый пароль, вы можете изменить пароль после инициализации.|12–72 знаков|
    ADMINSSHKEY (Authentication type = sshPublicKey) | Ключ защищенной оболочки, используемый для удаленного входа. | |
    CONSORTIUMMEMBERID | Идентификатор, который связан с каждым членом консорциума в сети.   | Он должен обладать уникальным значением. | 0
    NUMMININGNODES | Количество узлов майнинга. | От 2 до 15. | 2
    MNNODEVMSIZE | Размер виртуальной машины узлов майнинга. | | Standard_A1
    MNSTORAGEACCOUNTTYPE | Производительность хранилища узлов майнинга. | | Standard_LRS
    NUMTXNODES | Количество транзакционных узлов. | От 1 до 5. | 1
    TXNODEVMSIZE | Размер виртуальной машины транзакционных узлов. | | Standard_A1
    TXSTORAGEACCOUNTTYPE | Производительность хранилища транзакционных узлов. | | Standard_LRS
    CONSORTIUMDATA | URL-адрес, указывающий на данные конфигурации соответствующего консорциума, предоставляемые развертыванием другого члена. Это значение можно найти в выходных данных развертывания ведущего. | |
    REMOTEMEMBERVNETADDRESSSPACE | IP-адрес NVA ведущего. Это значение можно найти в выходных данных развертывания ведущего. | | 
    REMOTEMEMBERNVAPUBLICIP | IP-адрес NVA ведущего. Это значение можно найти в выходных данных развертывания ведущего. | | 
    CONNECTIONSHAREDKEY | Предварительно заданный секретный ключ между членами сети консорциума, которые устанавливают соединение. | |
    BASEURL | Базовый URL-адрес шаблона. | Используйте значение по умолчанию, если настраивать шаблоны развертывания нет необходимости. | 

7. Нажмите кнопку **ОК**.
8. На панели **Настраиваемое развертывание** укажите **Подписку**, **Группу ресурсов** и **Расположение группы ресурсов**.

    Имя параметра | ОПИСАНИЕ | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    Подписка | Подписка, для которой необходимо развернуть сеть консорциума | | Подписка потребления
    Группа ресурсов | Группа ресурсов, куда будет развертываться сеть консорциума. | | MemberResources
    Расположение | Регион Azure для группы ресурсов. | | local

8. Нажмите кнопку **Создать**.

Для развертывания может потребоваться 20 минут и более.

После завершения развертывания просмотрите сводную информацию о развертывании **Microsoft.Template** в разделе развертывания группы ресурсов. В сводной информации содержатся выходные значения, которые можно использовать для подключения членов консорциума.

Чтобы проверить развертывание члена, необходимо перейти на сайты администрирования членов. Адрес сайта администрирования можно найти в выходном разделе развертывания Microsoft.Template.

![Сводная информация по развертыванию члена](media/azure-stack-ethereum/ethereum-node-status-2.png)

Член узла находится в состоянии **Не запущен** (как указано на рисунке). Это происходит из за того, что подключение между ведущим и членами установить не удалось. Подключение между ведущим и членами является двусторонним. При развертывании членов подключение между членом и ведущим создается автоматически. Чтобы создать подключение между ведущим и членом, необходимо выполнить следующее действия.

### <a name="connect-member-and-leader"></a>Подключение члена и ведущего

При помощи этого шаблона создается подключение между ведущим и удаленным членом. 

1. Загрузите [шаблон подключения ведущего и членов из GitHub](https://raw.githubusercontent.com/Azure/AzureStack-QuickStart-Templates/master/ethereum-consortium-blockchain/marketplace/Connection/mainTemplate.json)
2. Чтобы выполнить развертывание из настраиваемого шаблона, на портале администрирования Azure Stack выберите **Создать > Шаблон развертывания**.
3. Чтобы изменить новый настраиваемый шаблон, выберите **Изменить шаблон**.
4. На панели редактирования, справа, скопируйте и вставьте шаблон ведущего JSON, который был загружен ранее.
    
    ![Изменение шаблона подключения](media/azure-stack-ethereum/edit-connect-template.png)

5. Щелкните **Сохранить**.
6. Выберите **Изменить параметры** и завершите настройку параметров шаблона для развертывания.
    
    ![Изменение параметров шаблона подключения](media/azure-stack-ethereum/edit-connect-parameters.png)

    Имя параметра | ОПИСАНИЕ | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    MEMBERNAMEPREFIX | Префикс в имени ведущего. Это значение можно найти в выходных данных развертывания ведущего.  | Длина от 1 до 6 буквенно-цифровых символов | |
    MEMBERROUTETABLENAME | Имя таблицы маршрута ведущего. Это значение можно найти в выходных данных развертывания ведущего. |  | 
    REMOTEMEMBERVNETADDRESSSPACE | Адресное пространство члена. Это значение можно найти в выводе развертывания члена. | |
    CONNECTIONSHAREDKEY | Предварительно заданный секретный ключ между членами сети консорциума, которые устанавливают соединение.  | |
    REMOTEMEMBERNVAPUBLICIP | IP-адрес NVA члена. Это значение можно найти в выводе развертывания члена. | |
    MEMBERNVAPRIVATEIP | Частный IP-адрес NVA ведущего. Это значение можно найти в выходных данных развертывания ведущего. | |
    LOCATION | Расположение среды Azure Stack. | | local
    BASEURL | Базовый URL-адрес шаблона. | Используйте значение по умолчанию, если настраивать шаблоны развертывания нет необходимости. | 

7. Нажмите кнопку **ОК**.
8. На панели **Настраиваемое развертывание** укажите **Подписку**, **Группу ресурсов** и **Расположение группы ресурсов**.
    
    ![Параметры развертывания подключения](media/azure-stack-ethereum/connect-deployment-parameters.png)

    Имя параметра | ОПИСАНИЕ | Допустимые значения | Образец значения
    ---------------|-------------|----------------|-------------
    Подписка | Подписка ведущего. | | Подписка потребления
    Группа ресурсов | Группа ресурсов ведущего. | | EthereumResources
    Расположение | Регион Azure для группы ресурсов. | | local

8. Нажмите кнопку **Создать**.

После завершения развертывания необходимо подождать несколько минут, прежде чем ведущий и члены смогут установить подключение. Чтобы проверить развертывание, обновите сайт администрирования члена. Состояние узла члена должно измениться на "Выполняется". 

![Проверка развертывания](media/azure-stack-ethereum/ethererum-node-status-3.png)

## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения об Ethereum и Azure см. в статье [Блокчейн-технология и приложения | Microsoft Azure](https://azure.microsoft.com/solutions/blockchain/).
- Дополнительные сведения о сценариях блокчейна в Azure см. в статье[Шаблон решения консорциума Proof-of-Work для Ethereum](../blockchain-workbench/ethereum-deployment-guide.md).