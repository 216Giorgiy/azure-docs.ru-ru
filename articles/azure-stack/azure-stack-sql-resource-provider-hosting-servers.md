---
title: Серверы размещения SQL в Azure Stack | Документация Майкрософт
description: Добавление экземпляров SQL для подготовки через поставщик ресурсов адаптера SQL.
services: azure-stack
documentationCenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/18/2018
ms.author: jeffgilb
ms.openlocfilehash: 183d9479ae18e557b00d0867cad79600145da7bd
ms.sourcegitcommit: 301855e018cfa1984198e045872539f04ce0e707
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2018
ms.locfileid: "36265234"
---
# <a name="add-hosting-servers-for-the-sql-resource-provider"></a>Добавление серверов размещения для поставщика ресурсов SQL

Вы можете разместить экземпляр SQL на виртуальной машине [Azure Stack](azure-stack-poc.md) или на виртуальной машине за пределами среды Azure Stack при условии, что поставщик ресурсов SQL может подключаться к этому экземпляру.

## <a name="overview"></a>Обзор

Ниже приведены общие требования к серверам размещения SQL.

* Экземпляр SQL должен быть предназначен для использования с рабочими нагрузками пользователя и поставщика ресурсов. Вы не можете использовать экземпляр SQL, который применяется любой другой службой. Это ограничение также применяется к службам приложений.
* Виртуальная машина поставщика ресурсов SQL не присоединена к домену и может подключаться только путем проверки подлинности SQL.
* Необходимо настроить для поставщика ресурсов учетную запись с соответствующими привилегиями.
* Поставщик ресурсов и пользователи, такие как веб-приложения, используют пользовательскую сеть, поэтому требуется подключение к экземпляру SQL в этой сети. Это требование обычно означает, что IP-адрес для экземпляров SQL должен быть в общедоступной сети.
* Управление экземплярами SQL и их узлами зависит от вас. Например, поставщик ресурсов не применяет обновления, не обрабатывает резервные копии или не изменяет учетные данные.
* Вы можете использовать номера SKU, поддерживающие различные классы возможностей SQL (например, производительность и высокий уровень доступности с использованием решения AlwaysOn).

### <a name="sql-server-virtual-machine-images"></a>Образы виртуальных машин SQL Server

Образы виртуальных машины SQL IaaS доступны через функцию управления Marketplace. Эти образы совпадают с доступными в Azure виртуальными машинами SQL.

Перед развертыванием виртуальной машины, используя элемент marketplace, всегда скачивайте последнюю версию **расширения SQL IaaS**.  Расширение IaaS и соответствующие усовершенствования портала предоставляют дополнительные функции, такие как автоматическая установка исправлений и резервное копирование.

Есть и другие варианты развертывания виртуальных машин SQL, в том числе с помощью шаблонов из [коллекции быстрого запуска Azure Stack](https://github.com/Azure/AzureStack-QuickStart-Templates).

> [!NOTE]
> Любые серверы размещения, установленные на многоузловом Azure Stack, должны быть созданы из подписки пользователя. Их нельзя создать из подписки поставщика по умолчанию. Их необходимо создать с пользовательского портала или из сеанса PowerShell с помощью соответствующего имени входа. Все серверы размещения — это подлежащие оплате виртуальные машины, которые должны иметь соответствующие лицензии SQL. Администратор служб _может_ быть владельцем такой подписки.

### <a name="required-privileges"></a>Необходимые разрешения

Вы можете создать пользователя с правами администратора, предоставив ему наименьшие права доступа (как системному администратору SQL). Пользователю необходимы разрешения только для выполнения следующих операций:

- База данных. Создание, изменение, с вложением (только для решения Always On), перенос, резервное копирование.
- Группа доступности: изменение, присоединение, добавление или удаление базы данных.
- Имя входа: создание, выбор, изменение, перенос, отмена.
- Выберите операции: \[master\].\[sys\].\[availability_group_listeners\] (группы доступности AlwaysOn) sys.availability_replicas (группы доступности AlwaysOn), sys.databases, \[master\].\[sys\].\[dm_os_sys_memory\], SERVERPROPERTY, \[master\].\[ sys\].\[ availability_groups\] (группы доступности AlwaysOn), sys.master_files.

## <a name="provide-capacity-by-connecting-to-a-standalone-hosting-sql-server"></a>Указание емкости путем подключения к автономному серверу размещения SQL

Можно использовать автономные (без высокой доступности) серверы SQL любого выпуска SQL Server 2014 или SQL Server 2016. Убедитесь, что у вас есть учетные данные для учетной записи с правами системного администратора.

Чтобы добавить автономный сервер размещения, который уже настроен, сделайте следующее:

1. Войдите на портал оператора Azure Stack в качестве администратора служб.

2. Выберите **Browse** (Обзор) &gt; **Ресурсы администрирования** &gt; **SQL Hosting Servers** (Серверы размещения SQL).

   ![Серверы размещения SQL](./media/azure-stack-sql-rp-deploy/sqlhostingservers.png)

   В разделе **SQL Hosting Servers** (Серверы размещения SQL) можно подключить поставщик ресурсов SQL к экземплярам SQL Server, которые выступают в качестве серверной части поставщика ресурсов.

   ![Панель мониторинга адаптера SQL](./media/azure-stack-sql-rp-deploy/sqladapterdashboard.png)

3. Заполните форму информацией о подключении вашего экземпляра SQL Server.

   ![Добавление сервера размещения SQL](./media/azure-stack-sql-rp-deploy/sqlrp-newhostingserver.png)

    Вы можете дополнительно включить имя экземпляра, а также предоставить номер порта, если экземпляр не назначен порту 1433 по умолчанию.

   > [!NOTE]
   > Пока экземпляр SQL может быть доступен Azure Resource Manager пользователя и администратора, он может находиться под контролем поставщика ресурсов. Экземпляр SQL __должен__ быть выделен исключительно для поставщика ресурсов.

4. При добавлении серверов их необходимо определять в новые или имеющиеся номера SKU для дифференциации предложений служб. Например, у вас может быть экземпляр SQL "Корпоративный", предоставляющий следующее:
  
   - емкость базы данных;
   - автоматическое резервное копирование;
   - резервирование высокопроизводительных серверов для отдельных подразделений

   У всех серверов размещения под одним номером SKU должны быть одинаковые возможности. **Имя** должно отражать свойства номера SKU, чтобы пользователи могли развертывать базы данных на соответствующий номер SKU.

   > [!IMPORTANT]
   > При создании номера SKU для поставщиков ресурсов SQL и MySQL в именах **семейства** и **уровня** не поддерживаются специальные знаки, включая пробелы и точки.

   Например: 

   ![Создание номера SKU](./media/azure-stack-sql-rp-deploy/sqlrp-newsku.png)

   >[!NOTE]
   > Отображение номеров SKU на портале может занять до часа. Пользователи не смогут создать базу данных, пока не будет полностью создан SKU.

## <a name="provide-high-availability-using-sql-always-on-availability-groups"></a>Предоставление высокого уровня доступности с помощью группы доступности SQL Always On

Настройка экземпляров SQL Always On требует дополнительных шагов и наличия по крайней мере трех виртуальных машин (или физических компьютеров). В этой статье предполагается, что вы хорошо понимаете принцип работы групп доступности AlwaysOn. Дополнительные сведения можно найти в разделе 

* [Введение в группы доступности AlwaysOn SQL Server на виртуальных машинах Azure](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-availability-group-overview)
* [Группы доступности AlwaysOn (SQL Server)](https://docs.microsoft.com/en-us/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server?view=sql-server-2017)

> [!NOTE]
> Поставщик ресурсов адаптера SQL поддерживает _только_ экземпляры SQL 2016 Enterprise с пакетом обновления 1 (SP1) или более поздней версии для AlwaysOn. Эта конфигурация адаптера требует наличия новых функций SQL, таких как автоматическое заполнение.

В дополнение к предыдущему списку требований необходимо включить [автоматическое заполнение](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/automatically-initialize-always-on-availability-group) для каждой группы доступности каждого экземпляра SQL Server.

Чтобы включить автоматическое заполнение на всех экземплярах, измените и выполните следующую команду SQL для каждого экземпляра:

  ```
  ALTER AVAILABILITY GROUP [<availability_group_name>]
      MODIFY REPLICA ON 'InstanceName'
      WITH (SEEDING_MODE = AUTOMATIC)
  GO
  ```

На вторичных экземплярах измените, а затем запустите следующую команду SQL для каждого экземпляра:

  ```
  ALTER AVAILABILITY GROUP [<availability_group_name>] GRANT CREATE ANY DATABASE
  GO
  ```

### <a name="to-add-sql-always-on-hosting-servers"></a>Добавление серверов размещения для SQL Always On

1. Войдите на портал администрирования Azure Stack в качестве администратора служб.

2. Выберите **Browse** (Обзор) &gt; **Ресурсы администрирования** &gt; **SQL Hosting Servers** (Серверы размещения SQL) &gt;**+Add** (+Добавить).

   В разделе **SQL Hosting Servers** (Серверы размещения SQL) можно подключить поставщик ресурсов SQL Server к фактическим экземплярам SQL Server, которые выступают в качестве серверной части поставщика ресурсов.

3. Заполните форму информацией о подключении своего экземпляра SQL Server. Убедитесь, что используется адрес полного доменного имени прослушивателя Always On (и дополнительный номер порта). Предоставьте информацию для учетной записи, настроенной с правами системного администратора.

4. Установите флажок Always On Availability Group (Группа доступности Always On), чтобы включить поддержку для экземпляров групп доступности SQL Always On.

   ![Включение решения Always On](./media/azure-stack-sql-rp-deploy/AlwaysOn.PNG)

5. Добавьте экземпляр SQL Always On в SKU.

   > [!IMPORTANT]
   > Нельзя смешивать отдельные серверы с экземплярами Always On в одном номере SKU. Попытка смешивания типов после добавления первого сервера размещения приведет к ошибке.

## <a name="make-the-sql-databases-available-to-users"></a>Предоставление пользователям баз данных SQL

Создайте планы и предложения для предоставления пользователям баз данных SQL. Добавьте службу **Microsoft.SqlAdapter** в план и добавьте имеющуюся квоту по умолчанию или создайте квоту.

![Создание планов и предложений для включения в них баз данных](./media/azure-stack-sql-rp-deploy/sqlrp-newplan.png)

## <a name="next-steps"></a>Дополнительная информация

[Создание баз данных SQL](azure-stack-sql-resource-provider-databases.md)
