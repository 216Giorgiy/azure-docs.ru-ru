---
title: Серверы размещения SQL в Azure Stack | Документация Майкрософт
description: Добавление экземпляров SQL для подготовки через поставщик ресурсов адаптера SQL.
services: azure-stack
documentationCenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/01/2018
ms.author: jeffgilb
ms.openlocfilehash: a89e5bf48c24abf72f18ee98f2dcb0eda6db35cd
ms.sourcegitcommit: c47ef7899572bf6441627f76eb4c4ac15e487aec
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
ms.locfileid: "33202598"
---
# <a name="add-hosting-servers-for-the-sql-resource-provider"></a>Добавление серверов размещения для поставщика ресурсов SQL
Экземпляры SQL Server можно использовать на виртуальных машинах в среде [Azure Stack](azure-stack-poc.md) или в экземпляре за пределами среды Azure Stack, если предоставленный поставщик ресурсов может к ней подключиться. Ниже перечислены общие требования:

* Экземпляр SQL должен быть предназначен для использования с рабочими нагрузками пользователя и поставщика ресурсов. Нельзя использовать экземпляр SQL, который используется любой другой службой, включая службы приложений.
* Виртуальная машина поставщика ресурсов SQL не присоединена к домену и может подключаться только с помощью аутентификации SQL.
* Необходимо настроить для поставщика ресурсов учетную запись с соответствующими привилегиями.
* Поставщик ресурсов и пользователи, такие как веб-приложения, используют пользовательскую сеть, поэтому требуется подключение к экземпляру SQL в этой сети. Это требование обычно означает, что IP-адрес для экземпляров SQL должен быть в общедоступной сети.
* Управление экземплярами SQL и их узлами выполняет пользователь, поставщик ресурсов не выполняет установку исправлений, резервное копирование, смену учетных данных и т. д.
* Номера SKU могут использоваться для создания различных классов возможностей SQL, таких как повышенная производительность, группы доступности Always On и т. д.

Некоторые образы виртуальных машины SQL IaaS доступны через функцию управления Marketplace. Перед развертыванием виртуальной машины, используя элемент marketplace, всегда скачивайте последнюю версию **расширения SQL IaaS**. Образы SQL совпадают с виртуальными машинами SQL, которые доступны в Azure. Для виртуальных машин SQL, созданных на основе этих образов, расширение IaaS и соответствующие усовершенствования портала предоставляют функции, такие как автоматическая установка исправлений и резервное копирование.

Есть и другие варианты развертывания виртуальных машин SQL, в том числе с помощью шаблонов из [коллекции быстрого запуска Azure Stack](https://github.com/Azure/AzureStack-QuickStart-Templates).

> [!NOTE]
> Любые серверы размещения, установленные на многоузловом Azure Stack, должны быть созданы из подписки пользователя. Их нельзя создать из подписки поставщика по умолчанию. Их необходимо создать с пользовательского портала или из сеанса PowerShell с помощью соответствующего имени входа. Все серверы размещения — это оплачиваемые виртуальные машины, которые должны иметь соответствующие лицензии SQL. Администратор служб _может_ быть владельцем такой подписки.


### <a name="required-privileges"></a>Необходимые разрешения

Можно создать нового пользователя с частичными разрешениями системного администратора. Ниже приведены определенные операции, которые должны быть доступны этому пользователю:

- База данных: создание, изменение, с вложением (только Always On), перенос, резервное копирование.
- Группа доступности: изменение, присоединение, добавление или удаление базы данных.
- Имя входа: создание, выбор, изменение, перенос, отмена.
- Выберите операции: \[master\].\[sys\].\[availability_group_listeners\] (группы доступности AlwaysOn) sys.availability_replicas (группы доступности AlwaysOn), sys.databases, \[master\].\[sys\].\[dm_os_sys_memory\], SERVERPROPERTY, \[master\].\[ sys\].\[ availability_groups\] (группы доступности AlwaysOn), sys.master_files.



## <a name="provide-capacity-by-connecting-to-a-standalone-hosting-sql-server"></a>Указание емкости путем подключения к автономному серверу размещения SQL
Можно использовать автономные (без высокой доступности) серверы SQL любого выпуска SQL Server 2014 или SQL Server 2016. Убедитесь, что у вас есть учетные данные для учетной записи с правами системного администратора.

Чтобы добавить автономный сервер размещения, который уже был подготовлен, выполните следующие действия:

1. Войдите на портал администратора Azure Stack в качестве администратора служб.

2. Щелкните **Обзор** &gt; **ADMINISTRATIVE RESOURCES** (Административные ресурсы) &gt; **SQL Hosting Servers** (Серверы размещения SQL).

  ![](./media/azure-stack-sql-rp-deploy/sqlhostingservers.png)

  В колонке **SQL Hosting Servers** (Серверы размещения SQL) можно подключить поставщик ресурсов SQL Server к фактическим экземплярам SQL Server, которые выступают в качестве серверной части поставщика ресурсов.

  ![Серверы размещения](./media/azure-stack-sql-rp-deploy/sqladapterdashboard.png)

3. Заполните форму информацией о подключении вашего экземпляра SQL Server.

  ![Новый сервер размещения](./media/azure-stack-sql-rp-deploy/sqlrp-newhostingserver.png)

    Можно дополнительно включить имя экземпляра, а также предоставить номер порта, если экземпляр не назначен порту 1433 по умолчанию.

  > [!NOTE]
  > Пока экземпляр SQL может быть доступен Azure Resource Manager пользователя и администратора, он может находиться под контролем поставщика ресурсов. Экземпляр SQL __должен__ быть выделен исключительно для поставщика ресурсов.

4. При добавлении серверов их необходимо определять в новые или имеющиеся номера SKU для дифференциации предложений служб. Например, у вас может быть экземпляр SQL "Корпоративный", предоставляющий:
  - емкость базы данных;
  - автоматическое резервное копирование;
  - резервирование высокопроизводительных серверов для отдельных подразделений
  - и другие возможности.

  Название SKU должно отражать свойства, чтобы пользователи могли размещать свои базы данных соответствующим образом. У всех серверов размещения под одним номером SKU должны быть одинаковые возможности.

> [!IMPORTANT]
> При создании номера SKU для поставщиков ресурсов SQL и MySQL в именах **семейства** и **уровня** не поддерживаются специальные знаки, включая пробелы и точки.

Пример:

![Номера SKU](./media/azure-stack-sql-rp-deploy/sqlrp-newsku.png)

>[!NOTE]
> Отображение номеров SKU на портале может занять до часа. Пользователи не смогут создать базу данных, пока не будет полностью создан SKU.

## <a name="provide-capacity-using-sql-always-on-availability-groups"></a>Предоставление емкости с помощью группы доступности SQL Always On
Настройка экземпляров SQL Always On требует дополнительных шагов и включает в себя по крайней мере три виртуальные машины (или физических компьютера).

> [!NOTE]
> Поставщик ресурсов адаптера SQL поддерживает _только_ SQL 2016 Enterprise с пакетом обновления 1 или более поздние версии экземпляров для Always On, так как он требует новые функции SQL, в частности автоматическое заполнение. Помимо общих вышеуказанных требований, применяется следующее.

* Необходимо указать файловый сервер в дополнение к компьютерам SQL Always On. Существует [шаблон быстрого запуска Azure Stack](https://github.com/Azure/AzureStack-QuickStart-Templates/tree/master/sql-2016-ha), с помощью которого можно создать эту среду. Он также может служить руководством по созданию собственного экземпляра.

* Необходимо настроить серверы SQL. В частности, необходимо включить [автоматическое заполнение](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/automatically-initialize-always-on-availability-group) в каждой группе доступности для каждого экземпляра SQL Server.

```
ALTER AVAILABILITY GROUP [<availability_group_name>]
    MODIFY REPLICA ON 'InstanceName'
    WITH (SEEDING_MODE = AUTOMATIC)
GO
```

В дополнительных экземплярах
```
ALTER AVAILABILITY GROUP [<availability_group_name>] GRANT CREATE ANY DATABASE
GO

```



Чтобы добавить серверы размещения для SQL Always On, выполните следующие действия:

1. Войдите на портал администратора Azure Stack в качестве администратора службы.

2. Щелкните **Обзор** &gt; **ADMINISTRATIVE RESOURCES** (Административные ресурсы) &gt; **SQL Hosting Servers** (Серверы размещения SQL) &gt; **+Добавить**.

    В колонке **SQL Hosting Servers** (Серверы размещения SQL) можно подключить поставщик ресурсов SQL Server к фактическим экземплярам SQL Server, которые выступают в качестве серверной части поставщика ресурсов.


3. Заполните форму информацией о подключении экземпляра SQL Server. Обязательно используйте полное имя домена или IPv4-адрес прослушивателя Always On (и дополнительно номер порта). Предоставьте информацию для учетной записи, настроенной с правами системного администратора.

4. Установите этот флажок, чтобы включить поддержку для экземпляров групп доступности SQL Always On.

    ![Серверы размещения](./media/azure-stack-sql-rp-deploy/AlwaysOn.PNG)

5. Добавьте экземпляр SQL Always On в SKU. Нельзя смешивать автономные серверы с экземплярами Always On в одном SKU. Вы узнаете об этом при добавлении первого сервера размещения. Попытка смешивания типов впоследствии приведет к ошибке.


## <a name="making-sql-databases-available-to-users"></a>Предоставление пользователям баз данных SQL

Создайте планы и предложения для предоставления пользователям баз данных SQL. Добавьте службу Microsoft.SqlAdapter в план и добавьте существующую квоту или создайте новую. При создании квоты можно указать емкость, разрешенную пользователю.

![Создание планов и предложений для включения в них баз данных](./media/azure-stack-sql-rp-deploy/sqlrp-newplan.png)


## <a name="next-steps"></a>Дополнительная информация

[Создание баз данных SQL](azure-stack-sql-resource-provider-databases.md)
