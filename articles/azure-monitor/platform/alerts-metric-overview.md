---
title: Узнайте о работе оповещений о метриках в Azure Monitor.
description: Ознакомьтесь с обзором действий, применимых к оповещениям о метриках, а также узнайте о том, как они работают в Azure Monitor.
author: snehithm
ms.author: snmuvva
ms.date: 9/18/2018
ms.topic: conceptual
ms.service: azure-monitor
ms.component: alerts
ms.openlocfilehash: cf315718377210e13a6634c0eaf8caab158bcc4d
ms.sourcegitcommit: edacc2024b78d9c7450aaf7c50095807acf25fb6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/13/2018
ms.locfileid: "53342227"
---
# <a name="understand-how-metric-alerts-work-in-azure-monitor"></a>Сведения о работе оповещений о метриках в Azure Monitor

Оповещения о метриках в Azure Monitor работают для основных многомерных метрик. Это могут быть метрики платформы, [пользовательские метрики](../../azure-monitor/platform/metrics-custom-overview.md), [популярные журналы из Log Analytics, преобразованные в метрики](../../azure-monitor/platform/alerts-metric-logs.md), стандартные метрики Application Insights. Для оповещений о метриках регулярно выполняется анализ, чтобы проверить соответствие условий одного временного ряда метрик или более. Если зафиксированы правильные значения, отправляется соответствующее уведомление. Функция оповещений о метриках работает с отслеживанием состояния, то есть уведомления отправляются только при изменении состояния.

## <a name="how-do-metric-alerts-work"></a>Как работают оповещения о метриках

Вы можете определить правило генерации оповещений метрики, указав целевой ресурс, который нужно отслеживать, имя метрики и условие (оператор и порог), а также группу действий, которую нужно активировать при срабатывании правила генерации оповещений.
Предположим, что вы создали простое правило генерации оповещений метрики следующим образом:

- Целевой ресурс (ресурс Azure, который требуется отслеживать): myVM.
- Метрика: Percentage CPU
- Агрегат времени (Статистический показатель, который выполняется в необработанных значениях метрик. Поддерживаемые агрегаты времени: Min, Max, Avg, Total) — Средняя
- Период (окно, с помощью которого проверяются значения метрик):      за последние 5 минут
- Частота (частота, с которой оповещение о метрике проверяет, соблюдены ли условия): 1 мин
- Оператор:     Больше чем
- Пороговое значение:      70

С момента создания правила генерации оповещений мониторинг выполняется каждую минуту, просматриваются значения метрики за последние 5 минут и проверяется, превышает ли среднее значение этих значений 70. Если условие выполняется, то есть средняя загрузка ЦП за последние 5 минут превышает 70, правило генерации оповещений запускает активированное уведомление. Если вы настроили действие электронной почты или веб-перехватчика в группе действий, связанной с правилом генерации оповещений, вы получите активированное уведомление для настроенных параметров.

Этот конкретный пример выполнения правила генерации оповещений можно также просмотреть на портале Azure или в колонке всех оповещений.

Скажем, если показатели использования в ресурсе myVM продолжает превышать порог при последующих проверках, правило генерации оповещений не сработает повторно, пока не будет устранено условие.

Если позже показатели использования в ресурсе myVM вернутся к нормальному состоянию, значение будет ниже указанного порога. Правило генерации оповещений отслеживает это условие еще два раза, чтобы отправить уведомление об устранении. Правило генерации оповещений отправляет сообщение об устранении или деактивации, когда условие оповещения не выполняется в течение трех последовательных периодов для сокращения отправки нежелательных оповещений в случае нестабильности условий.

По мере того как уведомление об устранении отправляется через веб-перехватчик или электронную почту, на портале Azure также обновляется состояние экземпляра оповещения ("Монитор состояния") на "Разрешено".

## <a name="monitoring-at-scale-using-metric-alerts-in-azure-monitor"></a>Мониторинг в масштабе с помощью оповещений о метриках в Azure Monitor

### <a name="using-dimensions"></a>Использование измерений

Оповещения о метриках в Azure Monitor также поддерживают отслеживание комбинаций значений нескольких измерений с одним правилом. Поясним на примере, почему вы можете использовать комбинации нескольких измерений.

Предположим, что у вас есть план службы приложений для веб-сайта. Вы хотите отследить использование ЦП на нескольких экземплярах, на которых запущен веб-сайт или приложение. Это можно сделать следующим образом, используя правило генерации оповещений о метрике.

- Целевой ресурс: myAppServicePlan
- Метрика: Percentage CPU
- Измерения
  - Экземпляр = InstanceName1, InstanceName2
- Агрегат времени: Средняя
- Период: за последние 5 минут
- Частота: 1 мин
- Оператор: GreaterThan
- Пороговое значение: 70

Как и раньше, это правило отслеживает, превышает ли среднее потребление ЦП за последние 5 минут 70 %. Тем не менее с помощью того же правила вы можете отслеживать два экземпляра, на которых запущен сайт. Каждый экземпляр будет отслеживаться индивидуально, и вы будете получать уведомления отдельно.

Скажем, у вас есть веб-приложение, которое очень часто используется, и вам нужно добавить больше экземпляров. Правило выше по-прежнему отслеживает только два экземпляра. Тем не менее можно создать правило следующим образом.

- Целевой ресурс: myAppServicePlan
- Метрика: Percentage CPU
- Измерения
  - Экземпляр = *
- Агрегат времени: Средняя
- Период: за последние 5 минут
- Частота: 1 мин
- Оператор: GreaterThan
- Пороговое значение: 70

Это правило будет автоматически отслеживать все значения для экземпляра, например вы можете отслеживать экземпляры по мере их появления без необходимости снова изменять правило генерации оповещений о метрике.

### <a name="monitoring-multiple-resources-using-metric-alerts"></a>Мониторинг нескольких ресурсов с помощью оповещений о метриках

Как видно из предыдущего раздела, можно настроить одно правило генерации оповещений о метрике, отслеживающее каждую отдельную комбинацию измерений (например, временные ряды метрик). Но ранее мониторинг можно было выполнять только для одного ресурса в определенный момент времени. Azure Monitor также поддерживает мониторинг нескольких ресурсов с одним правилом генерации оповещений о метриках. Эта функция сейчас реализована в предварительной версии и поддерживается только на виртуальных машинах. Кроме того, для одного оповещения о метрике ресурсы отслеживаются в одном регионе Azure.

Можно указать три следующие области мониторинга для одного оповещения:

- список виртуальных машин в одном регионе Azure в рамках подписки;
- все виртуальные машины (в одном регионе Azure) в одной или нескольких группах одной подписки;
- все виртуальные машины (в одном регионе Azure) в одной подписке.

Создание правил генерации оповещений о метрике, которые отслеживают несколько ресурсов, через портал Azure в настоящее время не поддерживается. Эти правила можно создать, используя [шаблоны Azure Resource Manager](../../azure-monitor/platform/alerts-metric-create-templates.md#resource-manager-template-for-metric-alert-that-monitors-multiple-resources). Для каждой виртуальны машины вы получите отдельное уведомление. 

## <a name="typical-latency"></a>Обычная задержка

Для оповещений о метриках, как правило можно получить уведомление в течение 5 минут, если задать частоту правила генерации оповещений в 1 минуту. В случае серьезных нагрузок для систем отправки уведомлений может наблюдаться более длительная задержка.

## <a name="supported-resource-types-for-metric-alerts"></a>Поддерживаемые типы ресурсов оповещений о метриках

Полный список поддерживаемых типов ресурсов можно найти в этой [статье](../../monitoring-and-diagnostics/monitoring-near-real-time-metric-alerts.md#metrics-and-dimensions-supported).

Если в настоящее время вы используете классические оповещения метрики и необходимо узнать, поддерживают ли они все типы используемых ресурсов, следующая таблица показывает эти ресурсы и актуальность их поддержки на сегодняшний день.

|Тип ресурса, который поддерживается стандартными оповещениями метрики | Поддерживаются оповещениями метрики |
|-------------------------------------------------|----------------------------|
| Microsoft.ApiManagement/service | Yes |
| Microsoft.Batch/batchAccounts| Yes|
|Microsoft.Cache/redis| Yes
|Microsoft.classicСompute/virtualMachines | Нет  |
|Microsoft.ClassicCompute/domainNames/slots/roles | Нет |
|Microsoft.CognitiveServices/accounts | Нет  |
|Microsoft.Compute/virtualMachines | Yes|
|Microsoft.Compute/virtualMachineScaleSets;| Yes|
|Microsoft.ClassicStorage/storageAccounts| Нет  |
|Microsoft.DataFactory/datafactories | Yes|
|Microsoft.DBforMySQL/servers| Yes|
|Microsoft.DBforPostgreSQL/servers| Yes|
|Microsoft.Devices/IotHubs | Нет |
|Microsoft.DocumentDB/databaseAccounts| Нет |
|Microsoft.EventHub/namespaces | Yes|
|Microsoft.Logic/workflows | Yes|
|Microsoft.Network/loadBalancers |Yes|
|Microsoft.Network/publicIPAddresses| Yes|
|Microsoft.Network/applicationGateways| Yes|
|Microsoft.Network/expressRouteCircuits| Yes|
|Microsoft.Network/trafficManagerProfiles | Yes|
|Microsoft.Search/searchServices | Нет |
|Microsoft.ServiceBus/namespaces| Нет |
|Microsoft.Storage/storageAccounts | Yes|
|Microsoft.StreamAnalytics/streamingjobs| Yes|
|Microsoft.TimeSeriesInsights/environments | Yes|
|Microsoft. Web/serverfarms | Yes |
|Microsoft. Web/sites (за исключением функций) | Yes|
|Microsoft. Web/hostingEnvironments/multiRolePools | Нет |
|Microsoft. Web/hostingEnvironments/workerPools| Нет 
|Microsoft.SQL/Servers | Нет |

## <a name="next-steps"></a>Дополнительная информация

- [Сведения о создании, просмотре и администрировании оповещений о метриках в Azure](alerts-metric.md)
- [Сведения о развертывании оповещений о метриках с помощью шаблонов Azure Resource Manager](../../azure-monitor/platform/alerts-metric-create-templates.md)
- [Дополнительные сведения о группах действий](action-groups.md)
