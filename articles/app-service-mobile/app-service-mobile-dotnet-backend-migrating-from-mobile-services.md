<properties
	pageTitle="Миграция из мобильных служб в мобильное приложение службы приложений"
	description="Простая миграция приложения мобильных служб в мобильное приложение службы приложений"
	services="app-service\mobile"
	documentationCenter=""
	authors="mattchenderson"
	manager="dwrede"
	editor=""/>

<tags
	ms.service="app-service-mobile"
	ms.workload="mobile"
	ms.tgt_pltfrm="mobile"
	ms.devlang="na"
	ms.topic="article"
	ms.date="11/25/2015"
	ms.author="mahender"/>

# Перенос существующей мобильной службы Azure в службу приложений

В этом разделе показано, как выполнить миграцию существующего приложения из мобильных служб Azure в новое мобильное приложение службы приложений. Все существующие мобильные службы можно легко перенести в серверную часть нового мобильного приложения. Во время миграции существующая мобильная служба будет продолжать работать.

При переносе в службу приложений мобильная служба получает доступ ко всем возможностям службы приложений. Тарификация при этом будет осуществляться в соответствии с [ценами службы приложений], а не мобильных служб.

Также следует заметить, что все запланированные задания будут переведены с управляемого Майкрософт тарифного плана планировщика Azure на тарифный план планировщика Azure в рамках вашей собственной подписки и под ваш контроль. Аналогично преимуществам миграции в службу приложений, этот переход позволяет использовать все возможности планировщика Azure.

### <a name="why-host"></a>Каковы преимущества размещения в службе приложений?

Служба приложения позволяет использовать расширенные возможности среды размещения при работе с приложением. Кроме того, приложению предоставляется доступ к промежуточным слотам, пользовательским доменам, поддержке диспетчера трафика и многим другим функциям. Несмотря на то, что после миграции в службу приложений вы можете обновить мобильную службу до серверной части мобильного приложения, у некоторых клиентов может возникнуть необходимость воспользоваться преимуществами этих функций немедленно, т. е. без предварительного обновления пакета SDK.

Дополнительные сведения о преимуществах службы приложений см. в статье [Сравнение мобильных служб и службы приложений].

## Миграция или обновление

[AZURE.INCLUDE [app-service-mobile-migrate-vs-upgrade](../../includes/app-service-mobile-migrate-vs-upgrade.md)]

- Для проектов серверов на основе Node.js новый [пакет SDK Node.js для мобильных приложений](https://github.com/Azure/azure-mobile-apps-node) обеспечивает ряд новых возможностей. Например, теперь можно осуществлять локальную разработку и отладку, использовать любую версию Node.js выше 0.10 и выполнять настройку с любой версией ПО промежуточного слоя Express.js.

- Для проектов серверов на основе .NET новые [пакеты NuGet пакета SDK для мобильных приложений](https://www.nuget.org/packages/Microsoft.Azure.Mobile.Server/) обеспечивают дополнительную гибкость для зависимостей NuGet, поддерживают новые возможности проверки подлинности службы приложений и совместимы с любыми проектами ASP.NET, включая MVC. Дополнительные сведения об обновлении см. в разделе [Обновление существующей мобильной службы .NET до службы приложений](app-service-mobile-net-upgrading-from-mobile-services.md).


## <a name="understand"></a>Общие сведения о мобильных приложениях службы приложений

Мобильные приложения в службе приложений — это новый способ построения мобильных приложений с помощью Azure. Дополнительные сведения о мобильных приложениях см. в разделе [Что такое мобильные приложения].

При миграции на мобильные приложения можно сохранить все существующие функциональные возможности приложений, включая бизнес-логику. Более того, в приложении доступны новые функции. В модели мобильных приложений ваш код фактически выполняется в веб-приложении в службе приложений (новая версия веб-сайтов Azure). Вы получите полный контроль над веб-приложением и его работой. Кроме того, теперь можно использовать функции веб-приложений, которые были ранее недоступны в мобильных службах, например диспетчер трафика и слоты развертывания.

Основное ограничение при обновлении — отсутствие интеграции запланированных заданий мобильных служб. Кроме того, вам нужно настроить планировщик Azure для вызова пользовательских API или включить функции веб-заданий.

## Миграция мобильной службы с помощью мастера миграции на службу приложений

Самым простым и рекомендуемым способом миграции мобильной службы в службу приложений является использование мастера миграции в службе приложений, которая доступна на классическом портале Azure. Откройте [классический портал Azure], перейдите к мобильным службам и выберите мобильную службу для переноса. В нижней части экрана появится кнопка **Перенести в службу приложений**, после нажатия которой вы сможете выполнить процесс миграции мобильной службы.

### <a name="what-gets-migrated"></a>Что можно перенести?

Мастер миграции изменяет управление фермами серверов, на которых размещены мобильные службы, — теперь вместо мобильных служб управление осуществляет служба приложений. Кроме того, мастер перемещает все тарифные планы планировщика, находившиеся под управлением мобильных служб из управляемой подписки Майкрософт, в вашу подписку. При переносе ферм серверов в элементе управления службы приложений также осуществляется перемещение всех мобильных служб, которые были связаны с этой фермой серверов.

Мобильные службы упорядочивают мобильные службы в фермы серверов на основе области и SKU (бесплатный, базовый, стандартный). Все бесплатные службы в области находятся в одной ферме серверов и переносятся вместе. Несколько базовых служб в области размещаются в одной ферме, но при наличии большого числа базовых служб для них будут действовать отдельные тарифные планы. Каждая стандартная служба находится в своей собственной ферме серверов. Чтобы перенести одну службу или предотвратить перенос службы вместе с другими сайтами, можно обновить службу до базовой, после чего к ней будет применен ее собственный независимый план.

Кроме того, если вы использовали запланированные задания, потребуется добавить тарифные планы планировщика Azure в подписку. Для каждой подписки существует ограниченное максимальное количество бесплатных запланированных заданий, поэтому просмотр заданий может быть связан с дополнительными расходами.

###  Использование мастера миграции

1. Перейдите на [классический портал Azure] и щелкните "Мобильные службы". 

2. Выберите мобильную службу для переноса, а затем в нижней панели меню щелкните "Перенести в службу приложений". Откроется всплывающий список мобильных служб, которые будут перенесены. Сведения об отображаемых службах и причинах их вывода см. в [предыдущем разделе](#what-gets-migrated).

3. Введите имя мобильной службы для подтверждения миграции, а затем установите флажок, чтобы продолжить. Если в процессе миграции будут задействованы несколько мобильных служб, необходимо ввести имя исходной службы, которая была выбрана.

4. После запуска процедуры миграции можно просматривать текущее состояние из списка мобильных служб на [классическом портале Azure]. Для всех переносимых на данный момент служб отображается состояние "Миграция". После завершения миграции службы будут отображаться на [портале Azure] в разделе "Мобильные приложения". Во время миграции и после нее ваши мобильные службы будут продолжать работать, а URL-адрес не изменится.

## Ручная миграция для внутреннего сервера .NET мобильных служб

>[AZURE.NOTE]Обратите внимание, что рекомендуемым способом миграции мобильной службы является использование мастера миграции в службе приложений, описанное в предыдущем разделе. Миграцию вручную следует применять только в ситуациях, когда невозможно использовать мастер.

В этом разделе показано размещение проекта мобильных служб .NET в службе приложений Azure. Для работы с приложениями, размещенными в службе приложений, можно использовать все учебники .NET для *мобильных служб* среды выполнения. Вам только нужно будет заменить домен azure-mobile.net во всех соответствующих URL-адресах доменом экземпляра службы приложений.

Вы можете разместить проект мобильных служб и в [среде службы приложений]. По-прежнему актуально все содержимое этого раздела, но сайт будет иметь вид `contoso.contosoase.p.azurewebsites.net`, а не `contoso.azurewebsites.net`.

>[AZURE.NOTE]При выполнении миграции вручную вы *не можете* сохранить существующий URL-адрес **service.azure mobile.net**. При наличии мобильных клиентов, подключающихся к этому URL-адресу, следует использовать автоматическую миграцию или не отключать мобильную службу до завершения обновления URL-адреса для всех мобильных клиентов.


### <a name="app-settings"></a>Параметры приложения
Для работы мобильных служб требуется, чтобы в среде были доступны различные параметры приложения, которые описаны в этом разделе.

Чтобы задать параметры приложения в серверной части мобильного приложения, сначала войдите на[портал Azure]. Перейдите в приложение службы приложений, которое будет использоваться в качестве серверной части мобильного приложения, щелкните **Параметры** > **Параметры приложения**, затем прокрутите вниз до **Параметры приложения**, где можно задать следующие пары "ключ-значение".

+ Для параметра **MS\_MobileServiceName** нужно указать имя приложения. Например, если в качестве URL-адреса серверной части задано `contoso.azurewebsites.net`, то *contoso* является правильным значением.

+ Для параметра **MS\_MobileServiceDomainSuffix** нужно указать имя веб-приложения. Например, если в качестве URL-адреса серверной части задано `contoso.azurewebsites.net`, то *azurewebsites.net* является правильным значением.

+ Для параметра **MS\_ApplicationKey** можно указать любое значение, но оно должно совпадать со значением, которое используется в пакете SDK для клиента. Рекомендуется использовать идентификатор GUID.

+ Для параметра **MS\_MasterKey** можно указать любое значение, но оно должно совпадать со значением, которое используется в API или клиенте администратора. Рекомендуется использовать идентификатор GUID.

При перемещении мобильной службы главный ключ и ключ приложения можно получить на вкладке **Настройка** в разделе "Мобильные службы" [классического портала Azure]. В нижней части щелкните **Управление ключами** и скопируйте ключи.


### <a name="client-sdk"></a>Практическое руководство. Изменение параметров пакета SDK клиента

В проекте клиентского приложения измените параметры конструктора клиентского объекта мобильных служб для принятия нового URL-адреса приложения (например, `https://contoso.azurewebsites.net`) и ключа приложения, настроенного ранее. Используйте версию пакета SDK клиента для **мобильных служб**, которая **не** должна обновляться. Для клиентов iOS и Android используйте версии 2.x, а для Windows и Xamarin — версию 1.3.2. С клиентами JavaScript должна использоваться версия 1.2.7.

### <a name="data"></a>Практическое руководство. Включение функций для работы с данными

Для работы с классами платформы Entity Framework по умолчанию в мобильных службах требуются два дополнительных параметра приложения.

Строки подключения хранятся в разделе **Строки подключения** колонки "Параметры приложения" сразу под разделом **Параметры приложения**. Строка подключения для базы данных должна быть указана в разделе **MS\_TableConnectionString**. При миграции существующей мобильной службы в службу приложений перейдите в раздел **Строки подключения** на вкладке **Настройка** мобильной службы на [классическом портале Azure](https://manage.windowsazure.com/). Щелкните **Показать строки подключения** и скопируйте значение.

По умолчанию используется схема **MS\_MobileServiceName**, но она может быть переопределена с помощью параметра **MS\_TableSchema**. Вернитесь в раздел **Параметры приложения** и укажите **MS\_TableSchema** в качестве имени используемой схемы. При перемещении существующего приложения мобильных служб используется схема, созданная с помощью Entity Framework. Речь идет об имени мобильной службы, а не экземпляре службы приложения с размещаемым кодом.

### <a name="push"></a>Практическое руководство. Включение функций push-уведомлений

Чтобы включить функцию отправки push-уведомлений, вам нужно предоставить веб-приложению информацию о концентраторе уведомлений.

В разделе **Строки подключения** укажите для параметра **MS\_NotificationHubConnectionString** строку подключения DefaultFullSharedAccessSignature для концентратора уведомлений. Для перемещения существующей мобильной службы перейдите в раздел **Строки подключения** на вкладке **Настройка** мобильной службы на [классическом портале Azure](https://manage.windowsazure.com/). Щелкните **Показать строки подключения** и скопируйте значение.

Присвойте параметру **MS\_NotificationHubName** приложения имя концентратора уведомлений. При перемещении существующей мобильной службы это значение можно получить на вкладке **Push-уведомления** на [классическом портале Azure](https://manage.windowsazure.com/). Другие поля на этой вкладке уже связаны с центром уведомлений, и их значения не нужно копировать.

### <a name="auth"></a>Практическое руководство. Включение функций проверки подлинности

Для работы функций идентификации также необходимо настроить параметры приложения для отдельных поставщиков. При перемещении из существующей мобильной службы каждому полю на вкладке **Удостоверение** на классическом портале соответствует определенный параметр приложения.

Учетная запись Майкрософт

* **MS\_MicrosoftClientID**

* **MS\_MicrosoftClientSecret**

* **MS\_MicrosoftPackageSID**

Facebook

* **MS\_FacebookAppID**

* **MS\_FacebookAppSecret**

Twitter

* **MS\_TwitterConsumerKey**

* **MS\_TwitterConsumerSecret**

Google

* **MS\_GoogleClientID**

* **MS\_GoogleClientSecret**

AAD

* **MS\_AadClientID**

* **MS\_AadTenants**. Примечание. Параметр **MS\_AadTenants** сохраняется как разделенный запятыми список доменов клиента (поля **Разрешенные клиенты** на классическом портале Azure).

### <a name="publish"></a>Практическое руководство. Публикация проекта мобильной службы

1. На [портале Azure] перейдите к приложению, в командной строке щелкните **Получить профиль публикации** и сохраните загруженный профиль на локальном компьютере.
2. В Visual Studio щелкните правой кнопкой мыши серверный проект мобильных служб и выберите команду **Опубликовать**. 
3. На вкладке "Профиль" выберите **Импорт** и найдите загруженный профиль.
3. Нажмите кнопку **Опубликовать**, чтобы развернуть код в службе приложений.

Журналы обрабатываются с использованием стандартных функций ведения журнала службы приложений. Дополнительные сведения о ведении журнала см. в разделе [Включение ведения журнала диагностики в службе приложений Azure].



<!-- URLs. -->

[портал Azure]: https://portal.azure.com/
[портале Azure]: https://portal.azure.com/
[классический портал Azure]: https://manage.windowsazure.com/
[классического портала Azure]: https://manage.windowsazure.com/
[классическом портале Azure]: https://manage.windowsazure.com/
[Что такое мобильные приложения]: app-service-mobile-value-prop.md
[I already use web sites and mobile services – how does App Service help me?]: /ru-RU/documentation/articles/app-service-mobile-value-prop-migration-from-mobile-services
[Mobile App Server SDK]: http://www.nuget.org/packages/microsoft.azure.mobile.server
[Create a Mobile App]: app-service-mobile-xamarin-ios-get-started.md
[Add push notifications to your mobile app]: app-service-mobile-xamarin-ios-get-started-push.md
[Add authentication to your mobile app]: app-service-mobile-xamarin-ios-get-started-users.md
[Azure Scheduler]: /ru-RU/documentation/services/scheduler/
[Web Job]: ../app-service-web/websites-webjobs-resources.md
[Send cross-platform push notifications]: app-service-mobile-xamarin-ios-push-notifications-to-user.md
[How to use the .NET server SDK]: app-service-mobile-dotnet-backend-how-to-use-server-sdk.md


[Включение ведения журнала диагностики в службе приложений Azure]: web-sites-enable-diagnostic-log.md
[ценами службы приложений]: https://azure.microsoft.com/ru-RU/pricing/details/app-service/
[среде службы приложений]: app-service-app-service-environment-intro.md
[Сравнение мобильных служб и службы приложений]: app-service-mobile-value-prop-migration-from-mobile-services-preview.md
[migrate a mobile service to a mobile app on App Service]: app-service-mobile-dotnet-backend-migrating-from-mobile-services.md

<!---HONumber=AcomDC_1203_2015-->