<properties urlDisplayName="Enable SSL" pageTitle="Настройка SSL для облачной службы &mdash; Azure" metaKeywords="Azure SSL, Azure HTTPS, Azure SSL, Azure HTTPS, .NET Azure SSL, .NET Azure HTTPS, C# Azure SSL, C# Azure HTTPS, VB Azure SSL, VB Azure HTTPS" description="Узнайте, как определить конечную точку HTTPS для веб-роли и как передать SSL-сертификат, чтобы обеспечить безопасность приложения." metaCanonical="" services="cloud-services" documentationCenter=".NET" title="Настройка SSL для приложения в Azure" authors="timlt" solutions="" manager="timlt" editor="mollybos" />

<tags ms.service="cloud-services" ms.workload="tbd" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="timlt" />

# Настройка SSL для приложения в Azure

[WACOM.INCLUDE [websites-cloud-services-css-guided-walkthrough](../includes/websites-cloud-services-css-guided-walkthrough.md)]

SSL-шифрование – это наиболее распространенный метод обеспечения безопасности данных, отправленных через Интернет. В этой теме, посвященной общим задачам, обсуждается, как определить конечную точку HTTPS для веб-роли и как передать SSL-сертификат, чтобы обеспечить безопасность приложения.

<div class="dev-callout">Примечание.
<p>Процедуры в этом задании применяются для облачных служб Azure. Для веб-сайтов см. раздел <a href="../web-sites-configure-ssl-certificate/">Настройка SSL-сертификата для веб-сайта Azure</a>.</p>
</div>

Эта задача включает следующие шаги:

-   [Шаг 1: Получение сертификата SSL][Шаг 1: Получение сертификата SSL]
-   [Шаг 2: изменение файлов определения службы и конфигурации][Шаг 2: изменение файлов определения службы и конфигурации]
-   [Шаг 3: передача пакета развертывания и сертификата][Шаг 3: передача пакета развертывания и сертификата]
-   [Шаг 4: подключение к экземпляру роли с использованием HTTPS][Шаг 4: подключение к экземпляру роли с использованием HTTPS]

В этой задаче будет использоваться производственное развертывание; сведения об использовании промежуточного развертывания приведены в конце данной темы.

## <a name="step1"> </a><span class="short-header">Получение SSL-сертификата</span>Шаг 1: получение SSL-сертификата

Чтобы настроить SSL для приложения, сначала необходимо получить SSL-сертификат, подписанный центром сертификации, то есть доверенным сторонним поставщиком, который выдает сертификаты для этой цели. Если у вас еще нет сертификата, нужно получить его в компании, продающей SSL-сертификаты.

Сертификат должен отвечать следующим требованиям для SSL-сертификатов в Azure.

-   Сертификат должен содержать закрытый ключ.
-   Сертификат должен быть создан для обмена ключами, которые можно экспортировать в файл обмена личной информацией (PFX-файл).
-   Имя субъекта сертификата должно совпадать с именем домена, которое используется для обращения к облачной службе. Не удается получить SSL-сертификат от центра сертификации (ЦС) в домене cloudapp.net. Необходимо получить имя пользовательского домена для использования при получении доступа к службе. При запросе сертификат в ЦС имя субъекта сертификата должно совпадать с именем пользовательского домена, которое используется для доступа к вашему приложению. Например, если вы используете домен **contoso.com**, необходимо запросить сертификат из центра сертификации для \***.contoso.com** или **www.contoso.com**.
-   Сертификат должен использовать как минимум 2048-разрядное шифрование.

В целях тестирования можно создать и использовать самозаверяющий сертификат. Самозаверяющий сертификат не прошел аутентификацию через ЦС, и можно использовать домен cloudapp.net в качестве URL-адреса веб-сайта. Например, в нижеприведенной задаче используется самозаверяющий сертификат, в котором находится общее имя (CN) в сертификате **sslexample.cloudapp.net**. Дополнительные сведения о способе создания самозаверяющего сертификата с использованием диспетчера IIS см. в разделе [Создание сертификата для роли][Создание сертификата для роли].

Далее необходимо включить сведения о сертификате в файлы определения службы и конфигурации службы.

## <a name="step2"> </a><span class="short-header">Изменение файлов svc и config</span>Шаг 2: изменение файлов определения службы и конфигурации

Ваше приложение должно быть настроено для использования сертификата и также необходимо добавить конечную точку HTTPS. Для этого следует обновить файлы определения службы и конфигурации службы.

1.  В среде разработки откройте файл определения службы
    (CSDEF), добавьте раздел **Certificates** внутри раздела **WebRole**
     и включите следующие сведения о
    сертификате:

        <WebRole name="CertificateTesting" vmsize="Small">
        ...
            <Certificates>
                <Certificate name="SampleCertificate" 
                             storeLocation="LocalMachine" 
                             storeName="CA" />
            </Certificates>
        ...
        </WebRole>

    В разделе **Certificates** определяется имя сертификата, его расположение и имя хранилища, в котором он находится. Мы выбрали для хранения сертификата хранилище центра сертификации (CA), но вы можете выбрать другие варианты. Дополнительную информацию см. в разделе [Сопоставление сертификата со службой][Сопоставление сертификата со службой].

2.  В файле определения службы добавьте элемент **InputEndpoint** в
    раздел **Endpoints**, чтобы включить HTTPS:

        <WebRole name="CertificateTesting" vmsize="Small">
        ...
            <Endpoints>
                <InputEndpoint name="HttpsIn" protocol="https" port="443" 
                    certificate="SampleCertificate" />
            </Endpoints>
        ...
        </WebRole>

3.  Откройте файл определения службы и добавьте элемент **Binding** в раздел
     **Sites**. Это действие добавляет привязку HTTPS
    для сопоставления конечной точки с вашим сайтом:

        <WebRole name="CertificateTesting" vmsize="Small">
        ...
            <Sites>
                <Site name="Web">
                    <Bindings>
                        <Binding name="HttpsIn" endpointName="HttpsIn" />
                    </Bindings>
                </Site>
            </Sites>
        ...
        </WebRole>

    Итак, все необходимые изменения внесены в файл определения службы, но еще нужно добавить сведения о сертификате в сам файл конфигурации службы.

4.  В файле конфигурации службы (CSCFG), ServiceConfiguration.Cloud.cscfg, добавьте раздел **Certificates**
    в раздел **Role**, заменяя приведенный ниже пример значения отпечатка сертификата
    на значение отпечатка вашего сертификата:

        <Role name="Deployment">
        ...
            <Certificates>
                <Certificate name="SampleCertificate" 
                    thumbprint="9427befa18ec6865a9ebdc79d4c38de50e6316ff" 
                    thumbprintAlgorithm="sha1" />
            </Certificates>
        ...
        </Role>

(В приведенном выше примере для алгоритма отпечатка используется обозначение **sha1**.) Укажите соответствующее значение для алгоритма отпечатка своего сертификата.)

Теперь, когда файлы определения службы и конфигурации службы
обновлены, создайте пакет развертывания для передачи в Azure. Если
используется **cspack**, убедитесь, что вы не используете флаг
**/generateConfigurationFile**, поскольку это приведет к перезаписи
информации о сертификате, которую вы только что добавили.

## <a name="step3"> </a><span class="short-header">Загрузка в Azure</span> Шаг 3: передача пакета развертывания и сертификата

Ваш пакет развертывания был обновлен для использования сертификата
и была добавлена конечная точка HTTPS. Теперь можно передать пакет и сертификат
в Azure через портал управления.

1.  Выполните вход на [портал управления Azure][портал управления Azure].
2.  Щелкните **Создать**, выберите **Облачная служба**, а затем щелкните **Настраиваемое создание**.
3.  В диалоговом окне **Создать облачную службу** введите значения для URL-адреса, укажите регион или территориальную группу и подписку. Убедитесь, что флажок **Развернуть пакет облачной службы сейчас** установлен, и нажмите кнопку **Далее**.
4.  В диалоговом окне **Публикация облачной службы** введите требуемые сведения о своей облачной службе, выберите значение **Рабочая среда** для среды и убедитесь, что флажок **Добавить сертификаты** установлен. (Если какая-либо из ролей содержит отдельный экземпляр, убедитесь, что установлен флажок **Развернуть, даже если одна или несколько ролей содержат отдельный экземпляр**.)

    ![Публикация облачной службы][Публикация облачной службы]

5.  Нажмите кнопку **Далее**.
6.  В диалоговом окне **Добавление сертификата** введите расположение файла SSL-сертификата (
    PFX-файла) и пароль для сертификата и щелкните команду
    **Присоединить сертификат**.

    ![Добавление сертификата][Добавление сертификата]

7.  Убедитесь, что ваш сертификат перечислен в списке в разделе **Присоединенные сертификаты**.

    ![Присоединенные сертификаты][Присоединенные сертификаты]

8.  Нажмите кнопку **Завершить**, чтобы создать облачную службу. Когда развертывание получит статус **Готово** можно выполнять следующие шаги.

## <a name="step4"> </a><span class="short-header">Подключение с помощью HTTPS </span>Шаг 4: подключение к экземпляру роли с использованием HTTPS

Теперь, когда развертывание подготовлено и запущено в Azure, вы можете
подключиться к нему, используя HTTPS.

1.  Выберите свое развертывание на портале управления и щелкните ссылку в разделе **URL-адрес сайта**.

    ![Определение URL-адреса сайта][Определение URL-адреса сайта]

2.  В своем браузере измените ссылку таким образом, чтобы использовать **https** вместо **http**, и перейдите на страницу.

    **Примечание.** Если используется самозаверяющий сертификат,
    то при переходе к конечной точке HTTPS, связанной с самозаверяющим сертификатом, в браузере появится сообщение
    об ошибке сертификата. Эту проблему можно
    устранить, воспользовавшись сертификатом, подписанным доверенным центром сертификации. Пока это не будет сделано, данную ошибку можно игнорировать. (Другой способ — добавить самозаверяющий сертификат в используемое хранилище сертификатов доверенного центра сертификации.)

    ![Пример веб-сайта SSL][Пример веб-сайта SSL]

Если вы хотите использовать SSL для промежуточного развертывания вместо производственного, вам нужно сначала определить URL-адрес, используемый для промежуточного развертывания. Разверните свою облачную службу в промежуточной среде, не включая сертификат или сведения о сертификате. Выполнив развертывание, вы можете определить URL-адрес на основе GUID, который приведен в поле **URL-адрес сайта** на портале управления. Создайте сертификат с обычным именем (CN), равным URL-адресу на основе GUID (например, **32818777-6e77-4ced-a8fc-57609d404462.cloudapp.net**), воспользуйтесь порталом управления для добавления сертификата в промежуточную облачную службу, добавьте сведения о сертификате в файлы CSDEF и CSCFG, повторно создайте пакет приложения и обновите промежуточное развертывание для использования нового пакета и файла CSCFG.

## <a name="additional_resources"> </a><span class="short-header">Дополнительные ресурсы</span>Дополнительные ресурсы

-   [Связь сертификата со службой][Сопоставление сертификата со службой]

-   [Настройка SSL-сертификата на конечной точке HTTPS][Настройка SSL-сертификата на конечной точке HTTPS]

  [Шаг 1: Получение сертификата SSL]: #step1
  [Шаг 2: изменение файлов определения службы и конфигурации]: #step2
  [Шаг 3: передача пакета развертывания и сертификата]: #step3
  [Шаг 4: подключение к экземпляру роли с использованием HTTPS]: #step4
  [Создание сертификата для роли]: http://msdn.microsoft.com/ru-ru/library/windowsazure/gg432987.aspx
  [Сопоставление сертификата со службой]: http://msdn.microsoft.com/ru-ru/library/windowsazure/gg465718.aspx
  [портал управления Azure]: http://manage.windowsazure.com
  [Публикация облачной службы]: ./media/cloud-services-dotnet-configure-ssl-certificate/CreateCloudService.png
  [Добавление сертификата]: ./media/cloud-services-dotnet-configure-ssl-certificate/AddCertificate.png
  [Присоединенные сертификаты]: ./media/cloud-services-dotnet-configure-ssl-certificate/AddCertificateComplete.png
  [Определение URL-адреса сайта]: ./media/cloud-services-dotnet-configure-ssl-certificate/CopyURL.png
  [Пример веб-сайта SSL]: ./media/cloud-services-dotnet-configure-ssl-certificate/SSLCloudService.png
  [Настройка SSL-сертификата на конечной точке HTTPS]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ff795779.aspx
