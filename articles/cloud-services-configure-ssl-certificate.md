<properties 
	pageTitle="Настройка SSL для облачной службы - Azure" 
	description="Узнайте, как определить конечную точку HTTPS для веб-роли и как передать SSL-сертификат, чтобы обеспечить безопасность приложения." 
	services="cloud-services" 
	documentationCenter=".net" 
	authors="Thraka" 
	manager="timlt" 
	editor="mollybos"/>

<tags 
	ms.service="cloud-services" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="11/14/2014" 
	ms.author="adegeo"/>




# Настройка SSL для приложения в Azure

[AZURE.INCLUDE [websites-cloud-services-css-guided-walkthrough](../includes/websites-cloud-services-css-guided-walkthrough.md)]

SSL-шифрование - это наиболее распространенный метод обеспечения безопасности данных, отправленных через Интернет. В этой теме, посвященной общим задачам, обсуждается, как определить конечную точку HTTPS для веб-роли и как передать SSL-сертификат, чтобы обеспечить безопасность приложения.

> [AZURE.NOTE] Процедуры в этом задании применяются для облачных служб Azure; для веб-сайтов, в разделе [Настройка сертификата SSL для веб-сайта Azure](../articles/web-sites-configure-ssl-certificate/).

Эта задача включает следующие шаги:

-   [Шаг 1. Получение сертификата SSL.][]
-   [Шаг 2. Изменение файлов определения службы и конфигурации.][]
-   [Шаг 3. Передача пакета развертывания и сертификата.][]
-   [Шаг 4. Подключение к экземпляру роли с использованием HTTPS.][]

В этой задаче будет использоваться производственное развертывание; сведения об использовании промежуточного развертывания приведены в конце данной темы.

<h2><a name="step1"> </a>Шаг 1. получение SSL-сертификата</h2>

Чтобы настроить SSL для приложения, сначала необходимо получить SSL-сертификат, подписанный центром сертификации, то есть доверенным сторонним поставщиком, который выдает сертификаты для этой цели. Если у вас еще нет сертификата, нужно получить его в компании, продающей SSL-сертификаты.

Сертификат должен отвечать следующим требованиям для SSL-сертификатов в Azure:

-   Сертификат должен содержать закрытый ключ.
-   Сертификат должен быть создан для обмена ключами, которые можно экспортировать в файл обмена личной информацией (PFX-файл).
-   Имя субъекта сертификата должно совпадать с именем домена, которое используется для обращения к облачной службе. Не удается получить SSL-сертификат от центра сертификации (ЦС) в домене cloudapp.net. Необходимо получить имя пользовательского домена для использования при получении доступа к службе. При запросе сертификат в ЦС имя субъекта сертификата должно совпадать с именем пользовательского домена, которое используется для доступа к вашему приложению. Например, если пользовательское имя домена **contoso.com** необходимо запросить сертификат из центра сертификации для ***. contoso.com** или **www.contoso.com**.
-   Сертификат должен использовать как минимум 2048-разрядное шифрование.

В целях тестирования можно создать и использовать самозаверяющий сертификат. Самозаверяющий сертификат не прошел аутентификацию через ЦС, и можно использовать домен cloudapp.net в качестве URL-адреса веб-сайта. Например, в нижеприведенной задаче используется самозаверяющий сертификат, в котором находится общее имя (CN) в сертификате **sslexample.cloudapp.net**. Дополнительные сведения о способе создания самозаверяющего сертификата с использованием диспетчера IIS см. в разделе [Создание сертификата для роли][].

Далее необходимо включить сведения о сертификате в файлы определения службы и конфигурации службы.

<h2><a name="step2"> </a>Шаг 2. изменение файлов определения службы и конфигурации</h2>

Ваше приложение должно быть настроено для использования сертификата и также необходимо добавить конечную точку HTTPS. Для этого следует обновить файлы определения службы и конфигурации службы.

1.  В среде разработки откройте файл определения службы
    (CSDEF), добавьте **сертификаты** внутри раздела **WebRole**
    статьи и включите следующие сведения о
    сертификате:

        <WebRole name="CertificateTesting" vmsize="Small">
        ...
            <Certificates>
                <Certificate name="SampleCertificate" 
							 storeLocation="LocalMachine" 
                    		 storeName="CA" />
            </Certificates>
        ...
        </WebRole>

    **Сертификаты** раздел определяет имя сертификата, его расположение и имя хранилища, где он находится. Мы выбрали для хранения сертификата хранилище центра сертификации (CA), но вы можете выбрать другие варианты. В разделе [связь сертификата со службой][] для получения дополнительных сведений.

2.  В файле определения службы добавьте **InputEndpoint** элемент
    в **конечные точки** раздел, чтобы включить HTTPS:

        <WebRole name="CertificateTesting" vmsize="Small">
        ...
            <Endpoints>
                <InputEndpoint name="HttpsIn" protocol="https" port="443" 
                    certificate="SampleCertificate" />
            </Endpoints>
        ...
        </WebRole>

3.  В файле определения службы добавьте **привязки** элемент внутри
    **узлы** раздела. Это действие добавляет привязку HTTPS для сопоставления
    конечной точки с вашим сайтом:

        <WebRole name="CertificateTesting" vmsize="Small">
        ...
            <Sites>
                <Site name="Web">
                    <Bindings>
                        <Binding name="HttpsIn" endpointName="HttpsIn" />
                    </Bindings>
                </Site>
            </Sites>
        ...
        </WebRole>

    Были внесены все необходимые изменения в файл определения службы,
    но данные сертификата по-прежнему необходимо добавить в
    файл конфигурации службы.

4.  Добавьте в файл конфигурации службы (CSCFG), ServiceConfiguration.Cloud.cscfg, **сертификатов**
    внутри раздела **роли** раздел, заменив отпечаток образца
    значение, показанное ниже, с вашего сертификата:

        <Role name="Deployment">
        ...
            <Certificates>
                <Certificate name="SampleCertificate" 
                    thumbprint="9427befa18ec6865a9ebdc79d4c38de50e6316ff" 
                    thumbprintAlgorithm="sha1" />
            </Certificates>
        ...
        </Role>

(Приведенном выше примере используется **sha1** для алгоритма отпечатка. Укажите соответствующее значение для алгоритма отпечатка своего сертификата.)

Теперь, когда определение службы и файлы конфигурации службы
была обновлена, пакет развертывания для передачи в Azure. Если
Вы используете **cspack**, убедитесь, что вы не используете
**/generateConfigurationFile** флаг, как, будут перезаписаны.
сведения о сертификате, который вы добавили.

<h2><a name="step3"> </a>Шаг 3. Передача пакета развертывания и сертификата</h2>

Пакет развертывания был обновлен для использования сертификата и
Была добавлена конечная точка HTTPS. Теперь можно передать пакет и
сертификат в Azure с помощью портала управления.

1. Войдите в [портал управления Azure](http://manage.windowsazure.com). 
2. Щелкните **Создать**, выберите **Облачная служба**, а затем щелкните **Настраиваемое создание**.
3. В диалоговом окне **Создать облачную службу** введите значения для URL-адреса, укажите регион или территориальную группу и подписку. Убедитесь, что флажок **Развернуть пакет облачной службы сейчас** установлен, и нажмите кнопку **Далее**.
3. В диалоговом окне **Публикация облачной службы** введите требуемые сведения о своей облачной службе, выберите значение **Рабочая среда** для среды и убедитесь, что флажок **Добавить сертификаты** установлен. (Если какая-либо из ролей содержит отдельный экземпляр, убедитесь, что установлен флажок **Развернуть, даже если одна или несколько ролей содержат отдельный экземпляр**.) 

    ![Publish your cloud service][0]

4.  Нажмите кнопку **Далее**.
5.  В **Добавление сертификата** диалогового окна, укажите расположение для SSL
    сертификат PFX-файл, пароль для сертификата и нажмите кнопку
    **присоединить сертификат**.

    ![Add certificate][1]

6.  Убедитесь, что ваш сертификат перечислен в списке в разделе **Присоединенные сертификаты**.

    ![Attached certificates][4]

7.  Нажмите кнопку **Завершить**, чтобы создать облачную службу. Когда развертывание получит статус **Готово** можно выполнять следующие шаги.

<h2><a name="step4"> </a>Шаг 4. Подключение к экземпляру роли с использованием HTTPS</h2>

Теперь, когда развертывание передано и запущено в Azure, вы можете
подключиться к нему, используя HTTPS.

1.  Выберите свое развертывание на портале управления и щелкните ссылку в разделе **URL-адрес сайта**.

    ![Determine site URL][2]

2.  В веб-браузере измените ссылку, чтобы использовать **https** вместо **http**и перейдите на страницу.

    **Примечание:** при использовании самозаверяющего сертификата, когда вы
    Перейдите к конечной точке HTTPS, связанной с собственной подписью
    сертификат, вы увидите сообщение об ошибке сертификата в браузере. С помощью
    сертификат, подписанный доверенным центром сертификации решить эту проблему; в то же время можно пропустить эту ошибку. (Другой способ - добавить самозаверяющий сертификат в хранилище сертификатов пользователя сертификат доверенного центра.)

    ![SSL example web site][3]

Если вы хотите использовать SSL для промежуточного развертывания вместо производственного, вам нужно сначала определить URL-адрес, используемый для промежуточного развертывания. Разверните свою облачную службу в промежуточной среде, не включая сертификат или сведения о сертификате. Выполнив развертывание, вы можете определить URL-адрес на основе GUID, который приведен в поле **URL-адрес сайта** на портале управления. Создайте сертификат с общее имя (CN), равным URL-адрес на основе GUID (например, **32818777-6e77-4ced-a8fc-57609d404462.cloudapp.net**), с помощью портала управления для добавления сертификата в промежуточную облачную службу, добавить сведения о сертификате в файлы CSDEF и CSCFG, преобразуйте приложения и обновите промежуточное развертывание для использования нового пакета и файл CSCFG.

<h2><a name="additional_resources"> </a>Дополнительные ресурсы</h2>

* [Как связать сертификат со службой][]

* [Как настроить SSL-сертификат на конечной точке HTTPS][]

  [Шаг 1. Получение сертификата SSL.]: #step1
  [Шаг 2. Изменение файлов определения службы и конфигурации.]: #step2
  [Шаг 3. Передача пакета развертывания и сертификата.]: #step3
  [Шаг 4. Подключение к экземпляру роли с использованием HTTPS.]: #step4
  [Создание сертификата для роли]: http://msdn.microsoft.com/library/windowsazure/gg432987.aspx
  [Как связать сертификат со службой]: http://msdn.microsoft.com/library/windowsazure/gg465718.aspx
  [связь сертификата со службой]: http://msdn.microsoft.com/library/windowsazure/gg465718.aspx
  [Портал управления Azure]: http://manage.windowsazure.com
  [0]: ./media/cloud-services-dotnet-configure-ssl-certificate/CreateCloudService.png
  [1]: ./media/cloud-services-dotnet-configure-ssl-certificate/AddCertificate.png
  [2]: ./media/cloud-services-dotnet-configure-ssl-certificate/CopyURL.png
  [3]: ./media/cloud-services-dotnet-configure-ssl-certificate/SSLCloudService.png
  [4]: ./media/cloud-services-dotnet-configure-ssl-certificate/AddCertificateComplete.png  
  [Как настроить SSL-сертификат на конечной точке HTTPS]: http://msdn.microsoft.com/library/windowsazure/ff795779.aspx

<!--HONumber=45--> 
