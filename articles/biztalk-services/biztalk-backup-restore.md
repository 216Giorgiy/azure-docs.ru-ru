---
title: "Создание и восстановление резервной копии в службах BizTalk | Документация Майкрософт"
description: "Службы BizTalk включают в себя архивацию и восстановление. Сведения о создании и восстановлении резервной копии и о том, как определить, что будет заархивировано. MABS, WABS"
services: biztalk-services
documentationcenter: 
author: MandiOhlinger
manager: anneta
editor: 
ms.assetid: 59f91173-4683-48df-abd5-41262bfce6df
ms.service: biztalk-services
ms.workload: integration
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 11/07/2016
ms.author: mandia
ms.translationtype: Human Translation
ms.sourcegitcommit: 5edc47e03ca9319ba2e3285600703d759963e1f3
ms.openlocfilehash: c55d1ab124441c42101b4ad60924a9ea28231408
ms.contentlocale: ru-ru
ms.lasthandoff: 05/31/2017


---
# <a name="biztalk-services-backup-and-restore"></a>Службы BizTalk: резервное копирование и восстановление

> [!INCLUDE [BizTalk Services is being retired, and replaced with Azure Logic Apps](../../includes/biztalk-services-retirement.md)]

Службы Azure BizTalk предоставляют функции резервного копирования и восстановления. В этом разделе описывается архивация и восстановление служб BizTalk с помощью классического портала Azure.

Выполнять резервное копирование служб BizTalk также можно с помощью [REST API служб BizTalk](http://go.microsoft.com/fwlink/p/?LinkID=325584). 

> [!NOTE]
> Вне зависимости от выпуска создавать резервные копии гибридных подключений невозможно. Гибридные подключения необходимо создать повторно.


## <a name="before-you-begin"></a>Перед началом работы
* Резервное копирование и восстановление доступны не во всех выпусках. Ознакомьтесь со статьей [Службы BizTalk: диаграмма выпусков](biztalk-editions-feature-chart.md).
* С помощью классического портала Azure можно осуществлять архивацию по расписанию или по запросу. 
* Содержимое резервной копии может быть восстановлено как в исходную, так и в новую службу BizTalk. Перед восстановлением службы BizTalk под тем же именем необходимо удалить существующую службу BizTalk, и это имя должно быть доступно. После удаления службы BizTalk может понадобиться больше времени, чем хотелось бы, для освобождения этого имени. Если вы не можете ждать освобождения этого имени, выполните восстановление в новую службу BizTalk.
* Службы BizTalk можно восстанавливать только в выпуски того же или более высокого уровня. Восстановление служб BizTalk в выпуски более низкого уровня, из которых выполнялось резервное копирование, не поддерживается.
  
    Например, резервную копию, созданную с помощью выпуска Basic, можно восстановить в выпуске Premium, но не наоборот.
* Чтобы обеспечить непрерывность, применяются контрольные номера EDI. Если сообщения обрабатываются после последнего резервного копирования, восстановление такого содержимого может привести к созданию повторяющихся контрольных номеров.
* Если в пакете имеются активные сообщения, запустите обработку пакета **перед** резервным копированием. При создании резервной копии (запланированной или по требованию) сообщения в пакетах не сохраняются. 
  
    **Если на момент начала резервного копирования в пакете присутствуют активные сообщения, они не копируются и будут утрачены.**
* Необязательно. Остановите все операции управления на портале BizTalk.

## <a name="create-a-backup"></a>Создание резервной копии
Резервное копирование может выполняться в любое время — вы полностью управляете этим процессом. В этом разделе приведены инструкции по созданию резервных копий с помощью классического портала Azure, включая следующие темы.

[Резервное копирование по запросу](#backupnow)

[Планирование резервного копирования](#backupschedule)

#### <a name="backupnow"></a>Резервное копирование по запросу
1. На классическом портале Azure выберите **Службы BizTalk**, а затем соответствующую службу BizTalk для архивации.
2. На вкладке **Панель мониторинга** в нижней части страницы выберите **Создать архив**.
3. Задайте имя резервной копии. Например, введите *моя_служба_BizTalk*РК*Дата*.
4. Выберите учетную запись хранения BLOB-объектов и щелкните по значку галочки, чтобы начать резервное копирование.

По завершении резервного копирования в учетной записи хранения создается контейнер с указанным именем резервной копии. В этом контейнере содержится резервная копия конфигурации службы BizTalk.

#### <a name="backupschedule"></a>Планирование резервного копирования
1. На классическом портале Azure выберите **Службы BizTalk**, имя службы BizTalk, с помощью которой необходимо запланировать архивацию, а затем перейдите на вкладку **Настройка**.
2. Для параметра **Состояние службы архивации** установите значение **Автоматически**. 
3. Выберите **учетную запись хранения**, в которой будет сохранена резервная копия, задайте параметр **Частота** для резервного копирования и время хранения резервных копий (**Хранение (дни)**):
   
    ![][AutomaticBU]
   
    **Примечания**     
   
   * Указанный в поле **Хранение (дни)**период хранения должен превышать заданную частоту резервного копирования.
   * Выберите параметр **Всегда сохранять по крайней мере одну резервную копию**, чтобы копия хранилась даже по истечении заданного периода хранения.
4. Щелкните **Сохранить**.

При выполнении запланированного задания на резервное копирование в указанной учетной записи хранения создается контейнер, в котором хранятся данные резервной копии. Имя контейнера формируется следующим образом: *Служба BizTalk имя-дата-время*. 

Если на панели мониторинга службы BizTalk отображается состояние **Не удалось** , потребуется следующее.

![Состояние последней запланированной архивации][BackupStatus] 

После перехода по ссылке отображаются журналы операций службы управления для устранения неполадки. Ознакомьтесь со статьей [Службы BizTalk: устранение неполадок с помощью журналов операций](http://go.microsoft.com/fwlink/p/?LinkId=391211).

## <a name="restore"></a>Восстановление
Резервные копии можно восстанавливать с помощью классического портала Azure или [REST API восстановления служб BizTalk](http://go.microsoft.com/fwlink/p/?LinkID=325582). В этом разделе приведены инструкции по восстановлению с помощью классического портала.

#### <a name="before-restoring-a-backup"></a>Подготовка к восстановлению из резервной копии
* При восстановлении службы BizTalk можно указать новые хранилища отслеживания, архивации и мониторинга.
* Восстанавливаются те же данные среды выполнения EDI. В резервной копии среды выполнения EDI хранятся контрольные номера. Последовательность восстановленных контрольных номеров соответствует моменту резервного копирования. Если сообщения обрабатываются после последнего резервного копирования, восстановление такого содержимого может привести к созданию повторяющихся контрольных номеров.

#### <a name="restore-a-backup"></a>Восстановление из резервной копии
1. На классическом портале Azure выберите **Создать** > **Службы приложений** > **Службы BizTalk** > **Восстановление**:
   
    ![Восстановление из резервной копии][Restore]
2. В поле **URL-адрес резервной копии**выберите значок папки и разверните учетную запись хранения Azure, в которой сохранена резервная копия конфигурации службы BizTalk. Разверните контейнер и на панели справа выберите TXT-файл для соответствующей резервной копии. 
   <br/><br/>
   Щелкните **Open**(Открыть).
3. На странице **Восстановить службу BizTalk** введите имя в поле **Имя службы BizTalk** и проверьте **URL-адрес домена**, **выпуск** и **регион** восстановленной службы BizTalk. **Создайте новый экземпляр базы данных SQL** для базы данных отслеживания.
   
    ![][RestoreBizTalkService]
   
    Выберите стрелку "Далее".
4. Проверьте имя базы данных SQL, укажите физический сервер для создания базы данных SQL и введите имя пользователя/пароль к этому серверу.

    Если необходимо настроить выпуск, размер и другие свойства Базы данных SQL, выберите **Настройка дополнительных параметров базы данных**. 

    Выберите стрелку "Далее".

1. Создайте новую или укажите существующую учетную запись хранения для службы BizTalk.
2. Установите флажок, чтобы запустить восстановление.

В случае успешного восстановления новая служба BizTalk будет представлена на странице «Службы BizTalk» классического портала Azure с состоянием «Приостановлено».

### <a name="postrestore"></a>Действия после восстановления из резервной копии
Восстановленные службы BizTalk всегда имеют статус **Приостановлено** . В этом состоянии можно вносить любые изменения в конфигурацию до того, как новая среда будет переведена в рабочий режим, включая следующие изменения.

* Если для создания приложений службы BizTalk вы использовали пакет SDK служб Azure BizTalk, то для работы в восстановленной среде вам может потребоваться обновить учетные данные службы контроля доступа (ACS) в этих приложениях.
* Возможно, вам потребуется восстановить службу BizTalk, чтобы реплицировать существующую рабочую среду службы BizTalk. В таком случае, если у вас настроены соглашения для исходного портала служб BizTalk, использующего в качестве источников папку FTP, вам может потребоваться обновить соглашения в восстановленной среде для работы с другой исходной папкой FTP. Если нет, возможны ситуации, когда два соглашения будут одновременно пытаться извлечь одно и то же сообщение.
* Если вы выполнили восстановление для создания нескольких сред BizTalk, убедитесь, что вы задаете ссылки на нужную среду в приложениях Visual Studio, командлетах PowerShell, API REST и API объектной модели управления торговыми партнерами.
* Также рекомендуется настроить автоматическое резервное копирование в восстановленной среде службы BizTalk.

Для запуска службы BizTalk на классическом портале Azure выберите восстановленную службу BizTalk, затем нажмите **Продолжить** на панели задач. 

## <a name="what-gets-backed-up"></a>Что входит в резервную копию
В резервную копию включаются следующие элементы.

<table border="1"> 
<tr bgcolor="FAF9F9">
<th> </th>
<TH>Элементы, включаемые в резервную копию</TH> 
</tr> 
<tr>
<td colspan="2">
 <strong>Портал служб BizTalk Azure</strong></td>
</tr> 
<tr>
<td>Конфигурация и среда выполнения</td> 
<td>
<ul>
<li>Сведения о партнере и данные профиля</li>
<li>Партнерские соглашения</li>
<li>Развернутые пользовательские сборки</li>
<li>Развернутые мосты</li>
<li>Сертификаты</li>
<li>Развернутые преобразования</li>
<li>Конвейеры</li>
<li>Шаблоны, созданные и сохраненные на портале служб BizTalk</li>
<li>Сопоставления X12 ST01 и GS01</li>
<li>Контрольные номера (EDI)</li>
<li>Значения MIC сообщения AS2</li>
</ul>
</td>
</tr> 

<tr>
<td colspan="2">
 <strong>Служба BizTalk Azure</strong></td>
</tr> 
<tr>
<td>Сертификат SSL</td> 
<td>
<ul>
<li>Данные сертификата SSL</li>
<li>Пароль сертификата SSL</li>
</ul>
</td>
</tr> 
<tr>
<td>Параметры службы BizTalk</td> 
<td>
<ul>
<li>Число модулей масштабирования</li>
<li>Выпуск</li>
<li>Версия продукта</li>
<li>Регион и центр обработки данных</li>
<li>Ключ и пространство имен службы контроля доступа (ACS)</li>
<li>Строка подключения к базе данных отслеживания</li>
<li>Строка подключения учетной записи хранения для архивации</li>
<li>Строка подключения учетной записи хранения для мониторинга</li>
</ul>
</td>
</tr> 
<tr>
<td colspan="2">
 <strong>Дополнительные элементы</strong></td>
</tr> 
<tr>
<td>База данных отслеживания</td> 
<td>При создании службы BizTalk вводятся сведения о базе данных отслеживания, включая ее имя и сервер базы данных SQL Azure. Автоматическое резервное копирование базы данных отслеживания не выполняется.
<br/><br/>
<strong>Важно!</strong><br/>
Восстановление удаленной базы данных отслеживания возможно только в том случае, если создана ее резервная копия. В противном случае восстановить эти данные не получится. В такой ситуации вам потребуется создать новую базу данных отслеживания с тем же именем. Рекомендуется использовать георепликацию.</td>
</tr> 
</table>

## <a name="next"></a>Далее
Чтобы создать службы BizTalk Azure на классическом портале Azure, перейдите по ссылке [Службы BizTalk: подготовка с использованием классического портала Azure](http://go.microsoft.com/fwlink/p/?LinkID=302280). Чтобы приступить к созданию приложений, перейдите по ссылке [Службы BizTalk Azure](http://go.microsoft.com/fwlink/p/?LinkID=235197).

## <a name="see-also"></a>См. также
* [Резервное копирование службы BizTalk](http://go.microsoft.com/fwlink/p/?LinkID=325584)
* [Восстановление службы BizTalk из резервной копии](http://go.microsoft.com/fwlink/p/?LinkID=325582)
* [Службы BizTalk. Диаграмма выпусков Developer, Basic, Standard и Premium](http://go.microsoft.com/fwlink/p/?LinkID=302279)
* [Службы BizTalk: подготовка с использованием классического портала Azure](http://go.microsoft.com/fwlink/p/?LinkID=302280)
* [Службы BizTalk. Диаграмма состояния подготовки](http://go.microsoft.com/fwlink/p/?LinkID=329870)
* [Службы BizTalk: вкладки «Панель мониторинга», «Монитор» и «Масштаб»](http://go.microsoft.com/fwlink/p/?LinkID=302281)
* [Службы BizTalk: регулирование](http://go.microsoft.com/fwlink/p/?LinkID=302282)
* [Службы BizTalk: имя и ключ издателя](http://go.microsoft.com/fwlink/p/?LinkID=303941)
* [Как приступить к работе с пакетом SDK для служб BizTalk Azure](http://go.microsoft.com/fwlink/p/?LinkID=302335)

[BackupStatus]: ./media/biztalk-backup-restore/status-last-backup.png
[Restore]: ./media/biztalk-backup-restore/restore-ui.png
[AutomaticBU]: ./media/biztalk-backup-restore/AutomaticBU.png
[RestoreBizTalkService]: ./media/biztalk-backup-restore/RestoreBizTalkServiceWindow.png


