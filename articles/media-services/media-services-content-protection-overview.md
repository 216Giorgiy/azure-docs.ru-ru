<properties 
	pageTitle="Общие сведения о защите содержимого" 
	description="В этой статье представлен обзор защиты содержимого с помощью служб мультимедиа." 
	services="media-services" 
	documentationCenter="" 
	authors="Juliako" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="media-services" 
	ms.workload="media" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="04/04/2015" 
	ms.author="juliako"/>

#Общие сведения о защите содержимого

Службы мультимедиа Microsoft Azure позволяют доставлять содержимое, динамически зашифрованное с помощью AES (с использованием 128-битных ключей шифрования) и PlayReady DRM. Они также обеспечивают службы доставки ключей и лицензий PlayReady авторизованным клиентам. 

![content-protection][content-protection]

Чтобы использовать динамическое шифрование, сначала необходимо получить по крайней мере одну зарезервированную единицу потоковой передачи для конечной точки потоковой передачи, из которой требуется передавать зашифрованное содержимое.

##Основные понятия

###Динамическое шифрование

Службы мультимедиа Microsoft Azure позволяют доставлять содержимое, динамически зашифрованное с помощью AES (с использованием 128-битных ключей шифрования) и PlayReady DRM. 

В настоящее время поддерживается шифрование для следующих форматов потоковой передачи: HLS, MPEG DASH и Smooth Streaming. Шифрование формата потоковой передачи HDS и последовательных скачиваний не поддерживается.

Если требуется, чтобы службы мультимедиа зашифровали ресурс, необходимо связать с этим ресурсом ключ шифрования (CommonEncryption или EnvelopeEncryption), а также настроить политики проверки подлинности для ключа.

Необходимо также настроить политику доставки ресурса. Если вы хотите передавать в потоке зашифрованный ресурс хранилища, убедитесь в том был указан способ доставки путем настройки политики доставки ресурсов.  

Когда поток запрашивается проигрыватель, службы мультимедиа используют указанный ключ для динамического шифрования содержимого с помощью шифрования AES или PlayReady. Чтобы расшифровать поток, проигрыватель запросит ключ у службы доставки ключей. Чтобы определить, есть ли у пользователя право на получение ключа, служба оценивает политики авторизации, заданные для ключа.

###Службы доставки лицензий PlayReady DRM и сброшенных ключей AES

Службы мультимедиа предоставляют службы доставки лицензий PlayReady DRM и сброшенных ключей AES клиентам, которые прошли проверку подлинности. Для настройки политики авторизации и проверки подлинности для лицензий и ключей можно использовать портал управления Azure, API-интерфейс REST или пакет SDK служб мультимедиа для .NET.

Обратите внимание, при использовании портала можно настроить одну политику AES (которая будет применяться ко всему содержимому, зашифрованному AES) и одну политику PlayReady (которая будет применяться ко всему содержимому, зашифрованному PlayReady). Если требуется больший контроль над конфигурацией, используйте пакет SDK служб мультимедиа для .NET.

###Шаблон лицензии PlayReady

Службы мультимедиа предоставляют службу доставки лицензий Microsoft PlayReady. При попытке проигрывателя конечного пользователя (например, Silverlight) воспроизвести контент, защищенный с помощью PlayReady, в службу доставки лицензий отправляется запрос на получение лицензии. Если служба лицензий утверждает запрос, она выдает лицензию, которая отправляется клиенту и может быть использована для расшифровки и воспроизведения указанного контента.

Лицензии содержат права и ограничения, которые среда выполнения PlayReady DRM принудительно применяет, когда пользователь пытается воспроизвести защищенный контент. Службы мультимедиа также предоставляют API, которые позволяют настроить лицензии PlayReady. Дополнительные сведения см. в разделе [Обзор шаблона лицензий PlayReady для служб мультимедиа](https://msdn.microsoft.com/library/azure/dn783459.aspx).

###Ограничение по маркеру

Политики авторизации ключа содержимого могут иметь одно или несколько ограничений проверки подлинности: открытый, ограничение по токену или ограничение по IP-адресу. При ограничении по маркеру к политике должен прилагаться маркер, выданный службой маркеров безопасности (STS). Службы мультимедиа поддерживают маркеры в формате простого веб-маркера (SWT) и в формате веб-маркера JSON (JWT). Службы мультимедиа не предоставляют службы маркеров безопасности. Для выдачи маркеров можно создать пользовательскую службу STS или использовать службу Microsoft Azure ACS. Чтобы создать маркер, подписанный указанным ключом, и получить утверждения, указанные в конфигурации ограничения по маркерам, должна быть настроена служба маркеров безопасности. Служба доставки ключей служб мультимедиа возвращает клиенту запрошенный ключ (или лицензию), если маркер является допустимым и утверждения маркера соответствуют утверждениям, настроенным для ключа (или лицензии).
При настройке политики ограничения по маркеру необходимо задать такие параметры, как основной ключ проверки, издатель и аудитория. Основной ключ проверки содержит ключ, которым подписан маркер, а издатель - это служба маркеров безопасности, которая выдает маркер. Аудитория (иногда называется областью) описывает назначение маркера или ресурс, доступ к которому обеспечивает маркер. Служба доставки ключей служб мультимедиа проверяет, соответствуют ли эти значения в маркере значениям в шаблоне.

##Распространенные сценарии

###Защита содержимого в хранилище, доставка динамически шифруемых потоков мультимедиа  

1. Получение мезонинного файла в высоком качестве в ресурсе. Применение параметра шифрования хранилища к ресурсу.
2. Настройка конечных точек потоковой передачи.
1. Кодирование в набор MP4-файлов с адаптивной скоростью. Применение параметра шифрования хранилища к выходному ресурсу.
1. Создание ключа содержимого шифрования для ресурса, который требуется шифровать динамически во время воспроизведения.
2. Настройка политики авторизации ключей содержимого.
1. Настройте политику доставки ресурсов (используется при динамической упаковке и динамическом шифровании).
1. Публикация ресурса путем создания указателя OnDemand.
1. Потоковая передача содержимого.

###Использование службы доставки ключа и лицензии служб мультимедиа с собственными службами шифрования и потоковой передачи

Дополнительные сведения см. в разделе [Интеграция службы лицензий PlayReady Azure с собственным механизмом шифрования или сервером потоковой передачи](http://mingfeiy.com/integrate-azure-playready-license-service-encryptorstreaming-server).

##Распространенные задачи шифрования содержимого

>[AZURE.NOTE]Если содержимое зашифровано в хранилище, необходимо настроить политику доставки ресурсов.

###Настройка конечных точек потоковой передачи

Общие сведения о конечных точках потоковой передачи и сведения об управлении ими см. в разделе [Управление конечными точками потоковой передачи в учетной записи служб мультимедиа](media-services-manage-origins.md).

###Создание ключа содержимого

Создайте ключ содержимого, с помощью которого следует зашифровать ресурс, используя **.NET** или **API REST**.

[AZURE.INCLUDE [media-services-selector-create-contentkey](../../includes/media-services-selector-create-contentkey.md)]

###Настройка политики авторизации ключей содержимого 

Настройка защиты содержимого и политики авторизации ключа с помощью **.NET** или **API REST**.

[AZURE.INCLUDE [media-services-selector-content-key-auth-policy](../../includes/media-services-selector-content-key-auth-policy.md)]

###Настройка политики доставки ресурсов

Настройте политики доставки ресурсов с помощью **.NET** или **REST API**.

[AZURE.INCLUDE [media-services-selector-asset-delivery-policy](../../includes/media-services-selector-asset-delivery-policy.md)]


##Связанные ссылки

[Представляем PlayReady как службу и динамическое шифрование AES с помощью служб мультимедиа Azure](http://mingfeiy.com/playready)

[Разъяснение цен на доставку лицензий PlayReady служб мультимедиа Azure](http://mingfeiy.com/playready-pricing-explained-in-azure-media-services)

[Отладка для зашифрованного с использованием AES потока в службах мультимедиа Azure](http://mingfeiy.com/debug-aes-encrypted-stream-azure-media-services)

[Аутентификация по маркерам JWT](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/)

[Интеграция приложения на основе OWIN MVC служб мультимедиа Azure с Azure Active Directory и ограничение доставки ключа содержимого на основе утверждений JWT](http://www.gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).

[Использования Azure ACS для выдачи маркеров](http://mingfeiy.com/acs-with-key-services).

[content-protection]: ./media/media-services-content-protection-overview/media-services-content-protection.png


<!--HONumber=52--> 