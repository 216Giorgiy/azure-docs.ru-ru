<properties 
	pageTitle="Общие сведения о защите содержимого" 
	description="В этой статье представлен обзор защиты содержимого с помощью служб мультимедиа." 
	services="media-services" 
	documentationCenter="" 
	authors="Juliako" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="media-services" 
	ms.workload="media" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="08/11/2015"
	ms.author="juliako"/>

#Общие сведения о защите содержимого


Службы мультимедиа Microsoft Azure позволяют защитить данные мультимедиа, покидающие ваш компьютер, на этапах их хранения, обработки и доставки. Службы мультимедиа позволяют доставлять содержимое, зашифрованное динамически с помощью AES (с использованием 128-битных ключей шифрования) и PlayReady DRM. Они также обеспечивают службы доставки ключей и лицензий PlayReady авторизованным клиентам.

![content-protection][content-protection]

Чтобы использовать динамическое шифрование, необходимо сначала получить как минимум одну зарезервированную единицу потоковой передачи на конечной точке потоковой передачи, с которой необходимо выполнять потоковую передачу содержимого.

##Основные понятия

###Параметры шифрования ресурсов

В зависимости от типа содержимого, которое вы хотите выкладывать, хранить и доставлять, службы мультимедиа предлагают различные параметры шифрования.

**None** — шифрование не используется. Это значение по умолчанию. Обратите внимание, что при использовании этого параметра содержимое не защищено при передаче или в хранилище.

Используйте этот параметр при добавлении содержимого, если MP4-файл планируется доставлять с помощью поэтапного скачивания.

**StorageEncrypted** — используйте этот параметр для локального шифрования незашифрованного содержимого с помощью AES 256 и его добавления в хранилище Azure, где оно хранится в зашифрованном виде. Ресурсы, защищенные с помощью шифрования хранилища, автоматически расшифровываются и помещаются в зашифрованную файловую систему до кодирования, а затем при необходимости повторно кодируются перед добавлением в виде нового выходного актива. Основная причина использования шифрования хранилища — для защиты входных файлов мультимедиа высокого качества с помощью стойкого шифрования при хранении на диске.

Для доставки ресурса из зашифрованного хранилища необходимо настроить политику доставки ресурсов, чтобы службы мультимедиа могли определить, как вы хотите доставлять содержимое. Перед выполнением потоковой передачи ресурса сервер потоковой передачи удаляет шифрование хранилища и осуществляет потоковую передачу содержимого с помощью указанной политики доставки (например, AES, PlayReady или без шифрования).

**CommonEncryptionProtected**— используйте этот параметр, если вы хотите зашифровать содержимое с помощью стандартного шифрования или PlayReady DRM либо выложить уже зашифрованное содержимое (например, Smooth Streaming с защитой PlayReady DRM).

**EnvelopeEncryptionProtected** — используйте этот параметр, если требуется защитить потоковую передачу HTTP (HLS), зашифрованную с помощью AES, или же добавить уже защищенную передачу. Обратите внимание на то, что если HLS уже зашифрована с помощью AES, ее можно выложить только в том случае, если для шифрования использовался Transform Manager.



###Динамическое шифрование

Службы мультимедиа Microsoft Azure позволяют доставлять содержимое, динамически зашифрованное с помощью AES (с использованием 128-битных ключей шифрования) и PlayReady DRM.

В настоящее время поддерживается шифрование для следующих форматов потоковой передачи: HLS, MPEG DASH и Smooth Streaming. Шифрование формата потоковой передачи HDS и последовательных скачиваний не поддерживается.

Если требуется, чтобы службы мультимедиа зашифровали ресурс, необходимо связать ключ шифрования (CommonEncryption или EnvelopeEncryption) с ресурсом, а также настроить политики авторизации для ключа.

Потребуется также настроить политику доставки ресурсов. Если вы хотите выполнять потоковую передачу ресурса из зашифрованного хранилища, задайте способ его доставки, настроив политику доставки ресурсов.

Когда поток запрашивается проигрыватель, службы мультимедиа используют указанный ключ для динамического шифрования содержимого с помощью шифрования AES или PlayReady. Чтобы расшифровать поток, проигрыватель запросит ключ у службы доставки ключей. Чтобы определить, есть ли у пользователя право на получение ключа, служба оценивает политики авторизации, заданные для ключа.

>[AZURE.NOTE]Для использования динамического шифрования вам потребуется получить по крайней мере одну единицу потоковой передачи по запросу для конечной точки потоковой передачи, из которой планируется передавать зашифрованное содержимое. Дополнительные сведения см. в статье [Масштабирование служб мультимедиа](media-services-manage-origins.md#scale_streaming_endpoints).

###Службы доставки лицензий PlayReady DRM и незащищенных ключей AES

Службы мультимедиа также обеспечивают доставку лицензий PlayReady и незащищенных ключей AES авторизованным клиентам. Чтобы настроить политики авторизации и проверки подлинности для лицензий и ключей, можно использовать портал управления Azure, API REST или пакет SDK служб мультимедиа для .NET.

Обратите внимание на то, что при использовании портала можно настроить одну политику AES (которая будет применяться ко всему содержимому, зашифрованному с помощью AES) и одну политику PlayReady (которая будут применяться ко всему содержимому, зашифрованному с помощью PlayReady). Используйте пакет SDK служб мультимедиа для .NET, если вам требуется больший контроль над конфигурациями.

###Шаблон лицензий PlayReady

Службы мультимедиа обеспечивают доставку лицензий PlayReady. Когда проигрыватель конечного пользователя (например, Silverlight) пытается воспроизвести содержимое, защищенное с помощью PlayReady, в службу доставки лицензий отправляется запрос на получение лицензии. Если служба лицензий утверждает запрос, она выдает лицензию, которая отправляется клиенту и может использоваться для расшифровки и воспроизведения указанного содержимого.

Лицензии определяют права и ограничения, которые должны применяться в среде выполнения PlayReady DRM при попытке пользователя воспроизвести защищенное содержимое. Службы мультимедиа предоставляют интерфейсы API, которые позволяют настраивать лицензии PlayReady. Дополнительные сведения см. в статье [Обзор шаблона лицензий PlayReady для служб мультимедиа](https://msdn.microsoft.com/library/azure/dn783459.aspx).

###Ограничение по маркеру

Для политики авторизации ключа содержимого можно задать одно или несколько из ограничений авторизации: открытая авторизация, с ограничением по маркеру или с ограничением по IP-адресу. При ограничении по маркеру к политике должен прилагаться маркер, выданный службой маркеров безопасности (STS). Службы мультимедиа поддерживают маркеры в формате простого веб-маркера (SWT) и формате веб-маркера JSON (JWT). Службы мультимедиа не предоставляют службы маркеров безопасности. Для выдачи маркеров можно создать пользовательскую службу STS или использовать службу Microsoft Azure ACS. Чтобы создать маркер, подписанный указанным ключом, и получить утверждения, указанные в конфигурации ограничения по маркерам, должна быть настроена служба маркеров безопасности. Служба доставки ключей служб мультимедиа возвращает клиенту запрошенный ключ (или лицензию), если маркер является допустимым, а его утверждения соответствуют утверждениям, настроенным для ключа (или лицензии). При настройке политики ограничения по маркеру необходимо задать такие параметры, как основной ключ проверки, издатель и аудитория. Основной ключ проверки содержит ключ, которым подписан маркер, а издатель — это служба маркеров безопасности, которая выдает маркер. Аудитория (иногда называется областью) описывает назначение маркера или ресурс, доступ к которому обеспечивает маркер. Служба доставки ключей служб мультимедиа проверяет, соответствуют ли эти значения в маркере значениям в шаблоне.

##Распространенные сценарии

###Защита содержимого в хранилище, доставка потокового мультимедиа с динамическим шифрованием, использование службы доставки ключей/лицензий AMS  

1. Получение мезонинного файла в высоком качестве в ресурсе. Примените шифрование хранилища к ресурсу.
2. Настройка конечных точек потоковой передачи данных.
1. Закодируйте содержимое в набор MP4-файлов с адаптивной скоростью. Примените шифрование хранилища к выходному ресурсу.
1. Создайте ключ шифрования содержимого для ресурса, который вы хотите динамически шифровать во время воспроизведения.
2. Настройте политику авторизации ключа содержимого.
1. Настройте политику доставки ресурсов (она используется средствами динамической упаковки и шифрования).
1. Опубликуйте ресурс, создав указатель OnDemand.
1. Потоковая передача содержимого.

###Использование службы доставки ключа и лицензии служб мультимедиа с собственными службами шифрования и потоковой передачи

Дополнительные сведения см. в разделе [Интеграция службы лицензий PlayReady Azure с собственным механизмом шифрования или сервером потоковой передачи](http://mingfeiy.com/integrate-azure-playready-license-service-encryptorstreaming-server).

###Интеграция с партнерами

[Использование castLabs для доставки лицензий DRM для служб мультимедиа Azure](media-services-castlabs-integration.md)


##Распространенные задачи шифрования содержимого

>[AZURE.NOTE]Если содержимое зашифровано в хранилище, необходимо настроить политику доставки ресурсов.

###Настройка конечных точек потоковой передачи

Общие сведения о конечных точках потоковой передачи и управлении ими см. в статье [Управление конечными точками потоковой передачи в учетной записи служб мультимедиа](media-services-manage-origins.md).

###Создание ключа содержимого

Создайте ключ содержимого для шифрования ресурса с помощью **.NET** или **API REST**.

[AZURE.INCLUDE [media-services-selector-create-contentkey](../../includes/media-services-selector-create-contentkey.md)]

###Настройка политики авторизации ключей содержимого 

Настройте политику защиты содержимого и авторизации ключей с помощью **.NET** или **API REST**.

[AZURE.INCLUDE [media-services-selector-content-key-auth-policy](../../includes/media-services-selector-content-key-auth-policy.md)]

###Настройка политики доставки ресурсов

Настройте политику доставки ресурсов с помощью **.NET** или **API REST**.

[AZURE.INCLUDE [media-services-selector-asset-delivery-policy](../../includes/media-services-selector-asset-delivery-policy.md)]


##Связанные ссылки

[Представляем новые возможности служб мультимедиа Azure: функцию динамического шифрования AES и PlayReady как службу](http://mingfeiy.com/playready)

[Разъяснение ценовой политики для доставки лицензий PlayReady служб мультимедиа Azure](http://mingfeiy.com/playready-pricing-explained-in-azure-media-services)

[Способы отладки потока, зашифрованного с использованием AES, в службах мультимедиа Azure](http://mingfeiy.com/debug-aes-encrypted-stream-azure-media-services)

[Аутентификация по токенам JWT](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/)

[Интегрируйте приложение на основе OWIN MVC служб мультимедиа Azure с Azure Active Directory и ограничьте доставку ключей содержимого на основе утверждений JWT](http://www.gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).

[Используйте Azure ACS для выдачи токенов](http://mingfeiy.com/acs-with-key-services).

[content-protection]: ./media/media-services-content-protection-overview/media-services-content-protection.png
 

<!---HONumber=August15_HO7-->