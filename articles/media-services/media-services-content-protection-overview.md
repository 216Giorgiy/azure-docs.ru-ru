---
title: "Защита содержимого с помощью служб мультимедиа Azure | Документация Майкрософт"
description: "В этой статье представлен обзор защиты содержимого с помощью служб мультимедиа."
services: media-services
documentationcenter: 
author: Juliako
manager: erikre
editor: 
ms.assetid: 81bc00e1-dcda-4d69-b9ab-8768b793422b
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/23/2017
ms.author: juliako
translationtype: Human Translation
ms.sourcegitcommit: 555e0b6340d09517bfd87efe209f0304f3266788
ms.openlocfilehash: bf2bd9bca8817f64790ac62d2981a51aa36566a3
ms.lasthandoff: 01/27/2017


---
# <a name="protecting-content-overview"></a>Общие сведения о защите содержимого
Службы мультимедиа Microsoft Azure позволяют защитить данные мультимедиа, покидающие ваш компьютер, на этапах их хранения, обработки и доставки. Службы мультимедиа позволяют доставлять в режиме реального времени и по требованию содержимое, зашифрованное динамически с помощью AES (с использованием 128-битных ключей шифрования) или основных систем DRM: Microsoft PlayReady, Google Widevine и Apple FairPlay. Они также обеспечивают службу доставки ключей AES и лицензий DRM (PlayReady, Widevine и FairPlay) авторизованным клиентам. 

На следующем рисунке показаны рабочие процессы защиты содержимого, поддерживаемые AMS. 

![Защита с помощью PlayReady](./media/media-services-content-protection-overview/media-services-content-protection-with-multi-drm.png)

>[!NOTE]
>При создании учетной записи AMS в нее добавляется конечная точка потоковой передачи **по умолчанию** в состоянии **Остановлена**. Чтобы начать потоковую передачу содержимого и воспользоваться динамической упаковкой и динамическим шифрованием, конечная точка потоковой передачи, из которой необходимо выполнять потоковую передачу содержимого, должна находиться в состоянии **Выполняется**. 

В этом разделе объясняются [основные понятия и термины](media-services-content-protection-overview.md) , необходимые для понимания процесса защиты содержимого с помощью AMS. Здесь также содержатся [ссылки](media-services-content-protection-overview.md#common-scenarios) на разделы, в которых показано, как выполнить задачи защиты содержимого. 

## <a name="dynamic-encryption"></a>Динамическое шифрование
Службы мультимедиа Microsoft Azure позволяют доставлять содержимое, динамически зашифрованное с помощью незащищенного ключа AES или шифрования DRM: Microsoft PlayReady, Google Widevine и Apple FairPlay.

В настоящее время поддерживается шифрование для следующих форматов потоковой передачи: HLS, MPEG DASH и Smooth Streaming. Невозможно шифровать последовательно скачиваемые данные.

Если требуется, чтобы службы мультимедиа зашифровали ресурс, необходимо связать ключ шифрования (CommonEncryption или EnvelopeEncryption) с ресурсом, а также настроить политики авторизации для ключа.

Потребуется также настроить политику доставки ресурсов. Если вы хотите выполнять потоковую передачу ресурса из зашифрованного хранилища, задайте способ его доставки, настроив политику доставки ресурсов.

Когда поток запрашивается проигрывателем, службы мультимедиа используют указанный ключ для динамического шифрования содержимого с помощью незащищенного ключа AES или DRM. Чтобы расшифровать поток, проигрыватель запросит ключ у службы доставки ключей. Чтобы определить, есть ли у пользователя право на получение ключа, служба оценивает политики авторизации, заданные для ключа.


## <a name="storage-encryption"></a>Шифрование хранилища
Шифрование хранилища используется для локального шифрования незащищенного содержимого с помощью AES 256 и его добавления в службу хранилища Azure, где оно хранится в зашифрованном виде. Ресурсы, защищенные с помощью шифрования хранилища, автоматически расшифровываются и помещаются в зашифрованную файловую систему до кодирования, а затем при необходимости повторно кодируются перед добавлением в виде нового выходного актива. Основная причина использования шифрования хранилища — для защиты входных файлов мультимедиа высокого качества с помощью стойкого шифрования при хранении на диске.

Для доставки ресурса из зашифрованного хранилища необходимо настроить политику доставки ресурсов, чтобы службы мультимедиа могли определить, как вы хотите доставлять содержимое. Перед выполнением потоковой передачи ресурса-контейнера сервер потоковой передачи удаляет шифрование хранилища и осуществляет потоковую передачу содержимого с помощью указанной политики доставки (например, AES, общее шифрование или без шифрования).

## <a name="common-encryption-cenc"></a>Общее шифрование (CENC)
Общее шифрование используется при шифровании содержимого с помощью PlayReady и (или) Widewine.

## <a name="using-cbcs-aapl-encryption"></a>Использование шифрования cbcs-aapl
Cbcs-aapl используется при шифровании содержимого с помощью FairPlay.

## <a name="envelope-encryption"></a>Шифрование конверта
Используйте этот параметр, если требуется защитить содержимое с помощью незащищенного ключа AES-128. Если необходим более высокий уровень защиты, то выберите одну из систем DRM, перечисленных в этом разделе. 

## <a name="licenses-and-keys-delivery-service"></a>Служба доставки лицензий и ключей
Службы мультимедиа предоставляют службу доставки лицензий DRM (PlayReady, Widevine и FairPlay) и незащищенных ключей AES авторизованным клиентам. Чтобы настроить политики авторизации и аутентификации для лицензий и ключей, можно использовать [портал Azure](media-services-portal-protect-content.md), REST API или пакет SDK служб мультимедиа для .NET.

## <a name="token-restriction"></a>Ограничение по маркеру
Для политики авторизации ключа содержимого можно задать одно или несколько из ограничений авторизации: открытая авторизация или с ограничением по маркеру. При ограничении по маркеру к политике должен прилагаться маркер, выданный службой маркеров безопасности (STS). Службы мультимедиа поддерживают маркеры в формате простого веб-маркера (SWT) и формате веб-маркера JSON (JWT). Службы мультимедиа не предоставляют службы маркеров безопасности. Для выдачи маркеров можно создать пользовательскую службу STS или использовать службу Microsoft Azure ACS. Чтобы создать маркер, подписанный указанным ключом, и получить утверждения, указанные в конфигурации ограничения по маркерам, должна быть настроена служба маркеров безопасности. Служба доставки ключей служб мультимедиа возвращает клиенту запрошенный ключ (или лицензию), если маркер является допустимым, а его утверждения соответствуют утверждениям, настроенным для ключа (или лицензии).

При настройке политики ограничения по маркеру необходимо задать такие параметры, как основной ключ проверки, издатель и аудитория. Основной ключ проверки содержит ключ, которым подписан маркер, а издатель — это служба маркеров безопасности, которая выдает маркер. Аудитория (иногда называется областью) описывает назначение маркера или ресурс, доступ к которому обеспечивает маркер. Служба доставки ключей служб мультимедиа проверяет, соответствуют ли эти значения в маркере значениям в шаблоне.

## <a name="streaming-urls"></a>URL-адреса потоковой передачи
Если ресурс-контейнер был зашифрован с помощью нескольких систем DRM, то в URL-адресе для потоковой передачи следует использовать тег шифрования: (format='m3u8-aapl', encryption='xxx').

Действительны следующие условия.

* Можно указать только один тип шифрования или ни одного.
* Если к ресурсу-контейнеру был применен только один тип шифрования, то в URL-адресе тип шифрования можно не указывать.
* Тип шифрования вводится без учета регистра.
* Можно указать следующие типы шифрования:  
  * **cenc**: общее шифрование (Playready или Widevine);
  * **cbcs-aapl**: Fairplay;
  * **cbc**: шифрование конверта AES.

## <a name="common-scenarios"></a>Распространенные сценарии
В следующих разделах показано, как защитить содержимое в хранилище, доставить потоковое мультимедиа с динамическим шифрованием и использовать службы доставки ключей/лицензий AMS:

* [Использование динамического шифрования AES-128 и службы доставки ключей](media-services-protect-with-aes128.md) 
* [Использование общего динамического шифрования PlayReady и (или) Widevine DRM ](media-services-protect-with-drm.md)
* [Использование служб мультимедиа Azure для потоковой передачи содержимого HLS, защищенного с помощью Apple FairPlay](media-services-protect-hls-with-fairplay.md)

### <a name="additional-scenarios"></a>Дополнительные сценарии
* [How to integrate Azure PlayReady License service with your own encryptor/streaming server](http://mingfeiy.com/integrate-azure-playready-license-service-encryptorstreaming-server)(Как интегрировать службу лицензий PlayReady Azure с собственным механизмом шифрования или сервером потоковой передачи)
* [Использование castLabs для доставки лицензий DRM для служб мультимедиа Azure](media-services-castlabs-integration.md)

>[!NOTE]
>Сценарий, в котором используется внешний сервер (технология) DRM и поток из AMS, в настоящее время не поддерживается.


## <a name="media-services-learning-paths"></a>Схемы обучения работе со службами мультимедиа
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a>Отзывы
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

## <a name="related-links"></a>Связанные ссылки
[Представляем новые возможности служб мультимедиа Azure: функцию динамического шифрования AES и PlayReady как службу](http://mingfeiy.com/playready)

[Разъяснение ценовой политики для доставки лицензий PlayReady служб мультимедиа Azure](http://mingfeiy.com/playready-pricing-explained-in-azure-media-services)

[Способы отладки потока, зашифрованного с использованием AES, в службах мультимедиа Azure](http://mingfeiy.com/debug-aes-encrypted-stream-azure-media-services)

[Аутентификация по токенам JWT](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/)

[Интегрируйте приложение на основе OWIN MVC служб мультимедиа Azure с Azure Active Directory и ограничьте доставку ключей содержимого на основе утверждений JWT](http://www.gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).

[Используйте Azure ACS для выдачи токенов](http://mingfeiy.com/acs-with-key-services).

[content-protection]: ./media/media-services-content-protection-overview/media-services-content-protection.png

