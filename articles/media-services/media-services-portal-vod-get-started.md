<properties
	pageTitle=" Приступая к работе с доставкой содержимого по запросу с помощью портала Azure | Microsoft Azure"
	description="В этом руководстве описано, как реализовать простую службу доставки видео по запросу (VOD) с помощью приложения служб мультимедиа Azure (AMS) и портала Azure."
	services="media-services"
	documentationCenter=""
	authors="Juliako"
	manager="erikre"
	editor=""/>

<tags
	ms.service="media-services"
	ms.workload="media"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="get-started-article"
	ms.date="08/30/2016"
	ms.author="juliako"/>


# Приступая к работе с доставкой содержимого по запросу с помощью портала Azure

[AZURE.INCLUDE [media-services-selector-get-started](../../includes/media-services-selector-get-started.md)]

В этом руководстве описано, как реализовать простую службу доставки видео по запросу (VOD) с помощью приложения служб мультимедиа Azure (AMS) и портала Azure.

> [AZURE.NOTE] Для работы с этим учебником требуется учетная запись Azure. Дополнительные сведения см. в разделе [Бесплатная пробная версия Azure](https://azure.microsoft.com/pricing/free-trial/).

Учебник включает в себя следующие разделы:

1.  Создание учетной записи служб мультимедиа Azure;
2.  Настройка конечной точки потоковой передачи;
1.  Загрузка видеофайла.
1.  Кодирование исходного файла в набор MP4-файлов с адаптивным битрейтом.
1.  Публикация ресурса и получение URL-адресов потоковой передачи и поэтапного скачивания.
1.  Воспроизведение содержимого.


## Создание учетной записи служб мультимедиа Azure

В этом разделе показано, как создать учетную запись AMS.

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Щелкните **+Создать** > **Мультимедиа+CDN** > **Службы мультимедиа**.

	![Создание служб мультимедиа](./media/media-services-portal-vod-get-started/media-services-new1.png)

3. В окне **создания учетной записи служб мультимедиа** введите необходимые значения.

	![Создание служб мультимедиа](./media/media-services-portal-vod-get-started/media-services-new3.png)
	
	1. Укажите **имя учетной записи** AMS. Имя учетной записи служб мультимедиа может состоять из букв или цифр в нижнем регистре без пробелов и должно иметь длину от 3 до 24 символов.
	2. В поле "Подписка" выберите одну из доступных подписок Azure.
	
	2. Выберите новую или существующую **группу ресурсов**. Группа ресурсов — это коллекция ресурсов с одинаковым жизненным циклом, разрешениями и политиками. Дополнительные сведения см. [здесь](resource-group-overview.md#resource-groups).
	3. Укажите **расположение** (географический регион), в котором будут храниться записи мультимедиа и метаданных для вашей учетной записи служб мультимедиа. Этот регион будет использоваться для обработки и потоковой передачи мультимедиа. В раскрывающемся списке отображаются только доступные регионы служб мультимедиа.
	
	3. Выберите **учетную запись хранения**, чтобы определить хранилище BLOB-объектов для мультимедийного содержимого из учетной записи служб мультимедиа. Можно выбрать существующую учетную запись хранения в географическом регионе, где находится учетная запись служб мультимедиа, или создать учетную запись хранения. Новая учетная запись хранения будет создана в том же регионе. В отношении учетных записей хранения действуют те же правила, что и для учетных записей служб носителей.

		Дополнительные сведения о хранилище см. [здесь](storage-introduction.md).

	4. Установите флажок **Закрепить на панели мониторинга**, чтобы отслеживать развертывание учетной записи.
	
7. Нажмите кнопку **Создать** в нижней части формы.

	Когда учетная запись будет создана, состояние изменится на **Выполняется**.

	![Параметры служб мультимедиа](./media/media-services-portal-vod-get-started/media-services-settings.png)

	Управлять учетной записью AMS (например, передавать видео, кодировать ресурсы, отслеживать выполнение задания) можно в окне **Параметры**.

## Управление ключами

Для программного доступа к учетной записи служб мультимедиа требуется имя учетной записи и сведения о первичном ключе.

1. На портале Azure выберите свою учетную запись.

	Справа появится окно **Параметры**.

2. В окне **Параметры** выберите **Ключи**.

	В окне **Управление ключами** отображается имя учетной записи, а также первичные и вторичные ключи.
3. Нажмите кнопку копирования, чтобы скопировать значения.
	
	![Ключи служб мультимедиа](./media/media-services-portal-vod-get-started/media-services-keys.png)

## Настройка конечных точек потоковой передачи данных

При работе со службами мультимедиа Azure один из самых частых сценариев — потоковая передача видео с переменной скоростью для клиентов. Службы мультимедиа поддерживают следующие технологии потоковой передачи с адаптивной скоростью: потоковая трансляция HTTP (HLS), Smooth Streaming, MPEG DASH и HDS (только для владельцев лицензий Adobe PrimeTime/Access).

Службы мультимедиа обеспечивают динамическую упаковку, которая позволяет своевременно доставлять закодированное содержимое MP4-файлов с переменной скоростью в форматах потоковой передачи, которые поддерживаются службами мультимедиа (MPEG DASH, HLS, Smooth Streaming, HDS), без необходимости хранения предварительно упакованных версий каждого из этих форматов потоковой передачи.

Чтобы воспользоваться преимуществом динамической упаковки, необходимо выполнить следующие действия:

- закодировать мезонинный (исходный) файл в набор MP4-файлов с переменной скоростью (шаги кодирования показаны далее в этом руководстве);
- создать по крайней мере одну единицу потоковой передачи для *конечной точки потоковой передачи*, из которой вы планируете доставлять содержимое. (шаги по изменению числа единиц потоковой передачи приведены далее).

Благодаря динамической упаковке вы оплачиваете хранение файлов только в одном формате, так как службы мультимедиа автоматически подготавливают и передают содержимое в нужном формате, исходя из полученных от клиента запросов.

Чтобы создать зарезервированные единицы потоковой передачи и изменить их число, сделайте следующее:


1. В окне **Параметры** щелкните элемент **Потоковые конечные точки**.

2. Щелкните конечную точку потоковой передачи по умолчанию.

	Появится окно **сведений о конечной точке потоковой передачи по умолчанию**.

3. Чтобы указать число единиц потоковой передачи, передвиньте ползунок **Единицы потоковой передачи**.

	![Единицы потоковой передачи](./media/media-services-portal-vod-get-started/media-services-streaming-units.png)

4. Нажмите кнопку **Сохранить**, чтобы сохранить изменения.

	>[AZURE.NOTE]Выделение новых единиц потоковой передачи может занять до 20 минут.

## Отправка файлов

Для потоковой передачи видео с помощью служб мультимедиа Azure необходимо передать и закодировать исходные видео с использованием нескольких скоростей, а затем опубликовать результат. В этом разделе описан первый шаг.

1. В окне **Параметры** щелкните **Ресурсы-контейнеры**.

	![Отправка файлов](./media/media-services-portal-vod-get-started/media-services-upload.png)

3. Нажмите кнопку **Отправить**.

	Появится окно **загрузки видеоресурса**.

	>[AZURE.NOTE] Размер файлов неограничен.
	
4. Найдите нужное видео на компьютере, выберите его и нажмите кнопку "ОК".

	Начнется передача. За ходом загрузки можно наблюдать под именем файла.

По завершении загрузки в окне **Ресурсы-контейнеры** появится новый элемент.

## Кодирование ресурсов

При работе со службами мультимедиа Azure один из самых частых сценариев — доставка потоковой передачи с адаптивным битрейтом клиентам. Службы мультимедиа поддерживают следующие технологии потоковой передачи с адаптивной скоростью: потоковая трансляция HTTP (HLS), Smooth Streaming, MPEG DASH и HDS (только для владельцев лицензий Adobe PrimeTime/Access). Чтобы подготовить видео к потоковой передаче с переменной скоростью, необходимо закодировать исходное видео в файлы с поддержкой разных скоростей. Для кодирования этого видео следует использовать **Media Encoder Standard**.

Службы мультимедиа также обеспечивают динамическую упаковку, которая позволяет доставлять MP4-файлы с поддержкой нескольких скоростей в форматах потоковой передачи (MPEG DASH, HLS, Smooth Streaming, HDS) без необходимости повторной упаковки в эти форматы потоковой передачи. Благодаря динамической упаковке вы оплачиваете хранение файлов только в одном формате, так как службы мультимедиа автоматически подготавливают и передают содержимое в нужном формате на основе полученных от клиента запросов.

Чтобы воспользоваться преимуществом динамической упаковки, необходимо выполнить следующие действия:

- закодировать исходный файл в набор MP4-файлов с поддержкой нескольких скоростей (шаги кодирования показаны далее в этом руководстве);
- получить по крайней мере одну единицу потоковой передачи для конечной точки потоковой передачи, из которой вы планируете доставлять содержимое. Дополнительные сведения см. в разделе [Настройка конечных точек потоковой передачи данных](media-services-portal-vod-get-started.md#configure-streaming-endpoints).

### Кодирование с помощью портала

В этом разделе описаны шаги, которые можно предпринять для кодирования содержимого с помощью стандартного кодировщика служб мультимедиа.

1.  В окне **Параметры** выберите пункт **Ресурсы-контейнеры**.
2.  В окне **Ресурсы-контейнеры** выберите ресурс, который требуется закодировать.
3.  Нажмите кнопку **Кодировать**.
4.  В окне **кодирования ресурса** выберите Media Encoder Standard с предустановкой. Например, если известно, что исходное видео имеет разрешение 1920 x 1080 пикселей, можно использовать предустановку "H264 Multiple Bitrate 1080p". Дополнительные сведения о предустановках см. [здесь](https://msdn.microsoft.com/library/azure/mt269960.aspx). Важно выбрать предустановку в соответствии с параметрами исходного видео. Если у вас есть видео с низким разрешением (640 x 360), не следует использовать предустановку по умолчанию ("H264 Multiple Bitrate 1080p").
	
	Для упрощения управления предусмотрена возможность изменения имени выходного ресурса и задания.
		
	![Кодирование ресурсов](./media/media-services-portal-vod-get-started/media-services-encode1.png)
5. Нажмите кнопку **Создать**.

### Мониторинг хода выполнения задания кодирования

Чтобы отслеживать выполнение задания кодирования, в верхней части страницы щелкните элемент **Параметры**, а затем выберите пункт **Задания**.

![Задания](./media/media-services-portal-vod-get-started/media-services-jobs.png)

## Публикация контента

Чтобы предоставить пользователю URL-ссылку, которую можно использовать для потоковой передачи или скачивания содержимого, сначала необходимо "опубликовать" ресурс, создав указатель. Указатели предоставляют доступ к файлам, содержащимся в активе. Службы мультимедиа поддерживают два типа указателей:

- Указатели потоковой передачи (OnDemandOrigin), используемые для потоковой передачи с переменной скоростью (например, для потоковой передачи в форматах MPEG DASH, HLS или Smooth Streaming). Чтобы создать указатель потоковой передачи, ресурс должен содержать ISM-файл.
- Последовательные указатели (SAS), используемые для доставки видео путем последовательного скачивания.


URL-адрес потоковой передачи имеет следующий формат, и его можно использовать для воспроизведения ресурсов Smooth Streaming:

	{streaming endpoint name-media services account name}.streaming.mediaservices.windows.net/{locator ID}/{filename}.ism/Manifest

Чтобы создать URL-адрес потоковой передачи HLS, добавьте (format=m3u8-aapl) к URL-адресу.

	{streaming endpoint name-media services account name}.streaming.mediaservices.windows.net/{locator ID}/{filename}.ism/Manifest(format=m3u8-aapl)

Чтобы создать URL-адрес для потоковой передачи в формате MPEG DASH, добавьте к исходному адресу строку (format=mpd-time-csf).

	{streaming endpoint name-media services account name}.streaming.mediaservices.windows.net/{locator ID}/{filename}.ism/Manifest(format=mpd-time-csf)


URL-адрес SAS имеет следующий формат.

	{blob container name}/{asset name}/{file name}/{SAS signature}

>[AZURE.NOTE] Для указателей, созданных до марта 2015 года, срок действия составляет два года.

Чтобы обновить срок действия указателя, используйте [REST API](http://msdn.microsoft.com/library/azure/hh974308.aspx#update_a_locator) или [API .NET](http://go.microsoft.com/fwlink/?LinkID=533259). При обновлении срока действия указателя SAS URL-адрес изменяется.

### Публикация ресурса с помощью портала

Для публикации ресурса с помощью портала выполните следующие действия.

1. Последовательно выберите **Параметры** > **Ресурсы-контейнеры**.
1. Выберите ресурс, который требуется опубликовать.
1. Нажмите кнопку **Опубликовать**.
1. Выберите тип указателя.
2. Нажмите кнопку **Добавить**.

	![Опубликовать](./media/media-services-portal-vod-get-started/media-services-publish1.png)

URL-адрес будет добавлен в список **опубликованных URL-адресов**.

## Воспроизведение контента на портале

Портал Azure предлагает проигрыватель содержимого, с помощью которого можно проверить видео.

Выберите нужное видео и нажмите кнопку **Воспроизвести**.

![Опубликовать](./media/media-services-portal-vod-get-started/media-services-play.png)

Важные особенности

- Убедитесь, что видео опубликовано.
- Этот **проигрыватель мультимедиа** воспроизводит содержимое из конечной точки потоковой передачи по умолчанию. Если требуется воспроизвести из конечной точки потоковой передачи не по умолчанию, щелкните, чтобы скопировать URL-адрес, и используйте другой проигрыватель. Например, [Проигрыватель служб мультимедиа Azure](http://amsplayer.azurewebsites.net/azuremediaplayer.html).

##Дальнейшие действия

Просмотрите схемы обучения работе со службами мультимедиа.

[AZURE.INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

##Отзывы

[AZURE.INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

<!---HONumber=AcomDC_0831_2016-->