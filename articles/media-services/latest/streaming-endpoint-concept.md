---
title: Конечные точки потоковой передачи в Службах мультимедиа Azure | Документация Майкрософт
description: В этой статье приведены общие сведения о конечных точках потоковой передачи и их использовании в Службах мультимедиа Azure.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: article
ms.date: 02/25/2019
ms.author: juliako
ms.openlocfilehash: eb7f368100269c4e47076bb6b78bafc23e7a6089
ms.sourcegitcommit: 5839af386c5a2ad46aaaeb90a13065ef94e61e74
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2019
ms.locfileid: "57845609"
---
# <a name="streaming-endpoints"></a>Конечные точки потоковой передачи

В Службах мультимедиа Microsoft Azure (AMS) сущность [Конечные точки потоковой передачи](https://docs.microsoft.com/rest/api/media/streamingendpoints) — это служба потоковой передачи, которая может доставлять содержимое непосредственно в клиентское приложение проигрывателя или сеть доставки содержимого (CDN) для дальнейшего распространения. Исходящим потоком службы **конечной точки потоковой передачи** может быть динамический поток или ресурс-контейнер видео по запросу в учетной записи Служб мультимедиа. Когда вы создаете учетную запись Служб мультимедиа, конечная точка потоковой передачи **по умолчанию** создается в остановленном состоянии. Удалить **стандартную** конечную точку потоковой передачи нельзя. В рамках учетной записи можно создавать дополнительные конечные точки потоковой передачи. 

> [!NOTE]
> Чтобы начать потоковую передачу видео, вам потребуется запустить **конечную точку потоковой передачи**, из которой предполагается транслировать видео. 

## <a name="naming-convention"></a>Соглашение об именовании

Для конечной точки по умолчанию: `{AccountName}-{DatacenterAbbreviation}.streaming.media.azure.net`

Для всех дополнительных конечных точек: `{EndpointName}-{AccountName}-{DatacenterAbbreviation}.streaming.media.azure.net`

## <a name="types"></a>Типы  

Существует два **конечной точки потоковой передачи** типов: Стандартные и **Премиум**. Тип определяется по количеству единиц масштабирования (`scaleUnits`), выделенных для конечной точки потоковой передачи. 

В таблице ниже описаны типы.  

|type|Единицы масштабирования|ОПИСАНИЕ|
|--------|--------|--------|  
|**Конечная точка потоковой передачи типа "Стандартный"** (рекомендуется)|0|Тип **Стандартный** является рекомендуемым вариантом практически для всех сценариев потоковой передачи и размеров аудитории. Тип **Стандартный** автоматически масштабирует пропускную способность для исходящих данных. <br/>Для клиентов с очень высокими требованиями к требованиям службы мультимедиа предоставляют **уровня "премиум"** потоковой передачи конечные точки, которые можно использовать для увеличения масштаба емкости для крупнейших Интернет аудитории. Если предполагается большой аудитории и одновременных зрителей, свяжитесь с нами в amsstreaming\@microsoft.com рекомендации по необходимости переместить **уровня "премиум"** типа. |
|**Конечная точка потоковой передачи типа "Премиум"**|>0|Конечные точки уровня **Премиум** подходят для выполнения более сложных задач благодаря выделенной пропускной способности и возможности масштабирования. Выполните переход на тип **Премиум**, изменив `scaleUnits`. `scaleUnits` предоставляют определенную выходную пропускную способность, которую можно приобрести с шагом приращения 200 Мбит/с. При использовании типа **Премиум** каждая включенная единица обеспечивает приложению дополнительную пропускную способность. |

## <a name="working-with-cdn"></a>Работа с CDN

В большинстве случаев необходимо включить CDN. Тем не менее, если вы ожидаете максимального уровня параллелизма меньше 500 зрителей, рекомендуется отключить сеть CDN, так как она лучше масштабируется при высоком параллелизме.

> [!NOTE]
> Конечная точка и URL-адрес потоковой передачи `hostname` остаются без изменений независимо от того, включена ли сеть CDN.

### <a name="detailed-explanation-of-how-caching-works"></a>Подробное описание выполнения кэширования

При добавлении CDN нет определенного значения пропускной способности, так как необходимый объем пропускной способности для конечной точки потоковой передачи с включенной CDN различается. Многое зависит от типа содержимого, его популярности, скоростей передачи и протоколов. CDN выполняет только запрашиваемое кэширование. Это означает, что популярное содержимое будет предоставляться непосредственно из сети CDN (до тех пор, пока кэшируется фрагмент видео). При просмотре в режиме реального времени содержимое с большой вероятностью кэшируется, так как обычно у вас есть много людей, наблюдающих за одними данными. С содержимым по запросу может быть немного сложнее, так как популярность некоторого содержимого может отличаться. Если у вас есть миллионы непопулярных видеофайлов (только 1 или 2 зрителя в неделю) и тысячи людей, просматривающих разные видео, CDN становится менее эффективной. С этим промахом в кэше увеличивается нагрузка на конечную точку потоковой передачи.
 
Необходимо также учитывать, как работает адаптивная потоковая передача. Все отдельные фрагменты видео кэшируются как его сущности. Например, если определенное видео просматривается впервые и пользователь пропускает его, увидев всего несколько секунд, в CDN кэшируются только фрагменты видео, связанные с пользователем. При использовании адаптивной потоковой передачи можно применять от 5 до 7 разных скоростей передачи видео. Если пользователи используют разные скорости передачи, каждый из них кэшируются в сети CDN отдельно. Даже если два пользователя используют одинаковую скорость передачи, они могут применять разные протоколы. Все протоколы (HLS, MPEG-DASH, Smooth Streaming) кэшируются отдельно. Таким образом, каждая скорость и протокол кэшируются отдельно и кэшируются только запрашиваемые фрагменты видео.
 
## <a name="properties"></a>properties 

В этом разделе приведены подробные сведения о некоторых свойств потоковой передачи конечной точки. Примеры создания новой конечной точки потоковой передачи и описания всех свойств см. в [этой статье](https://docs.microsoft.com/rest/api/media/streamingendpoints/create). 

- `accessControl` -Используется для настройки следующих параметров безопасности для этой конечной точки потоковой передачи: ключи проверки подлинности заголовка подписи Akamai и IP-адреса, которые могут подключаться к этой конечной точке.<br />Это свойство можно задать при `cdnEnabled` имеет значение false.
- `cdnEnabled` — Указывает, является ли интеграции Azure CDN для этой конечной точки потоковой передачи включена (отключено по умолчанию). Если задать для `cdnEnabled` значение true, следующие конфигурации интеграции отключаются: `customHostNames` и `accessControl`.
  
    Не все центры обработки данных поддерживают интеграцию Azure CDN. Чтобы проверить, имеет ли центр обработки данных доступны интеграции Azure CDN, сделайте следующее:
 
  - Желательно установить `cdnEnabled` значение true.
  - Проверьте возвращенный результат для `HTTP Error Code 412` (PreconditionFailed) с сообщением «Потоковой передачи свойство CdnEnabled конечной точки не может быть присвоено значение true, как CDN возможность недоступна в текущей области.» 

    Если вы получаете эту ошибку, данная интеграция не поддерживается в этом центре обработки данных. Попробуйте использовать другой центр обработки данных.
- `cdnProfile` — Если `cdnEnabled` имеет значение true, можно также передать `cdnProfile` значения. `cdnProfile` — имя профиля CDN, в котором будет создана конечная точка CDN. Вы можете предоставить имеющийся cdnProfile или создать его. Если значение равно NULL, а `cdnEnabled` — true, используется значение по умолчанию (AzureMediaStreamingPlatformCdnProfile). Если параметр `cdnProfile` уже предоставлен, с его использованием создается конечная точка. Если профиль не существует, создать новую конфигурацию автоматически получает.
- `cdnProvider` -Если сеть CDN включена, вы также можете передать `cdnProvider` значения. `cdnProvider` определяет, какой поставщик будет использоваться. В настоящее время поддерживаются три значения: StandardVerizon, PremiumVerizon и StandardAkamai. Если значение не указано и `cdnEnabled` имеет значение true, используется «StandardVerizon» (то есть значение по умолчанию).
- `crossSiteAccessPolicies` -Используется для задания политик межсайтового доступа для различных клиентов. Дополнительные сведения см. в статьях [Спецификация файла междоменной политики](https://www.adobe.com/devnet/articles/crossdomain_policy_file_spec.html) и [Настройка доступности службы на границах домена](https://msdn.microsoft.com/library/cc197955\(v=vs.95\).aspx).
- `customHostNames` -Используется для настройки конечной точки потоковой передачи для приема трафика, направленного к пользовательским именем узла.  Это свойство является допустимым для "стандартный" и конечными точками потоковой передачи уровня "премиум" и может устанавливаться при `cdnEnabled`: false.
    
    Необходимо подтвердить принадлежность имени домена с помощью служб мультимедиа. Службы мультимедиа проверяет принадлежность доменного имени, требуя `CName` запись содержит идентификатор учетной записи служб мультимедиа в качестве компонента для добавления к используемому домену. Например, чтобы использовать sports.contoso.com в качестве пользовательского имени узла для конечной точки потоковой передачи, запись для `<accountId>.contoso.com` необходимо настроить для указания одного из имен узлов проверки Служб мультимедиа. Имя узла проверки состоит из verifydns.\<зона_DNS_Служб_мультимедиа>. 

    Ниже приведены ожидаемые зоны DNS для использования при проверке записи для разных регионах Azure.
  
  - Северная Америка, Европа, Сингапур, Гонконг, Япония:
      
    - `media.azure.net`
    - `verifydns.media.azure.net`
      
  - Китай:
        
    - `mediaservices.chinacloudapi.cn`
    - `verifydns.mediaservices.chinacloudapi.cn`
        
    Например `CName` запись, которая сопоставляет «945a4c4e-28ea-45 cd-8ccb-a519f6b700ad.contoso.com» для «verifydns.media.azure.net» подтверждает, что идентификатор служб мультимедиа 945a4c4e-28ea-45cd-8ccb-a519f6b700ad владеет домен contoso.com, таким образом Включение любое имя в составе contoso.com для использования в качестве настраиваемого имени узла для конечной точки потоковой передачи под этой учетной записью. Чтобы найти значение идентификатора службы мультимедиа, перейдите на [портал Azure](https://portal.azure.com/) и выберите свою учетную запись службы мультимедиа. **Идентификатор учетной записи** в правом верхнем углу страницы.
        
    При попытке задать пользовательское имя узла без надлежащей проверки записи `CName` ответ DNS не будет получен, после чего в течение некоторого времени будет выполняться кэширование. После получения соответствующей записи повторная проверка кэшированного ответа может занять некоторое время. В зависимости от поставщика DNS пользовательского домена повторная проверка записи может занять от нескольких минут до часа.
        
    В дополнение к `CName` , сопоставляющий `<accountId>.<parent domain>` для `verifydns.<mediaservices-dns-zone>`, необходимо создать другое `CName` , сопоставляет имя пользовательского узла (например, `sports.contoso.com`) с именем узла Media Services потоковой передачи конечной точки (например, `amstest-usea.streaming.media.azure.net`).
 
    > [!NOTE]
    > Потоковая передача конечными точками, расположенными в одном центре обработки данных, не могут совместно использовать одно имя пользовательского узла.

    В настоящее время службы мультимедиа не поддерживают SSL с пользовательскими доменами. 
    
- `maxCacheAge` -Переопределения кэша HTTP по умолчанию максимальный возраст управления заголовок со значением, конечная точка потоковой передачи на медиафрагментах и манифестах по запросу. Это значение задается в секундах.
- `resourceState` -

    - Остановлена - начальное состояние конечной точки потоковой передачи после создания
    - Запуск - переходит в рабочее состояние
    - Выполнение - способен выполнять потоковую передачу содержимого на клиентах
    - Масштабирование — масштаб единицы увеличиваются или уменьшаются
    - Остановка - переходит в состояние остановки
    - Удаление - удаляется
    
- `scaleUnits ` -Предоставляют выделенную выходную пропускную способность, которую можно приобрести с шагом 200 Мбит/с. Если вам нужно выполнить переход к типу **Премиум**, настройте параметр `scaleUnits`.

## <a name="next-steps"></a>Дальнейшие действия

[В этом репозитории](https://github.com/Azure-Samples/media-services-v3-dotnet-quickstarts/blob/master/AMSV3Quickstarts/EncodeAndStreamFiles/Program.cs) предоставлен пример запуска стандартной конечной точки потоковой передачи с помощью .NET.

