---
title: Конечные точки потоковой передачи в Службах мультимедиа Azure | Документация Майкрософт
description: В этой статье приведены общие сведения о конечных точках потоковой передачи и их использовании в Службах мультимедиа Azure.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: ''
ms.topic: article
ms.date: 01/16/2019
ms.author: juliako
ms.openlocfilehash: 18c5e48b5f7dbf664b607b8b83473a914256590b
ms.sourcegitcommit: eecd816953c55df1671ffcf716cf975ba1b12e6b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2019
ms.locfileid: "55104578"
---
# <a name="streaming-endpoints"></a>Конечные точки потоковой передачи

В Службах мультимедиа Microsoft Azure (AMS) сущность [Конечные точки потоковой передачи](https://docs.microsoft.com/rest/api/media/streamingendpoints) — это служба потоковой передачи, которая может доставлять содержимое непосредственно в клиентское приложение проигрывателя или сеть доставки содержимого (CDN) для дальнейшего распространения. Исходящим потоком службы **конечной точки потоковой передачи** может быть динамический поток или ресурс-контейнер видео по запросу в учетной записи Служб мультимедиа. Когда вы создаете учетную запись Служб мультимедиа, конечная точка потоковой передачи **по умолчанию** создается в остановленном состоянии. Удалить **стандартную** конечную точку потоковой передачи нельзя. В рамках учетной записи можно создавать дополнительные конечные точки потоковой передачи. 

> [!NOTE]
> Чтобы начать потоковую передачу видео, вам потребуется запустить **конечную точку потоковой передачи**, из которой предполагается транслировать видео. 

## <a name="naming-convention"></a>Соглашение об именовании

Для конечной точки по умолчанию: `{AccountName}-{DatacenterAbbreviation}.streaming.media.azure.net`

Для всех дополнительных конечных точек: `{EndpointName}-{AccountName}-{DatacenterAbbreviation}.streaming.media.azure.net`

## <a name="types"></a>Типы  

Существует два типа **конечных точек потоковой передачи**: **Стандартные** и **Премиум**. Тип определяется по количеству единиц масштабирования (`scaleUnits`), выделенных для конечной точки потоковой передачи. 

В таблице ниже описаны типы.  

|type|Единицы масштабирования|ОПИСАНИЕ|
|--------|--------|--------|  
|**Конечная точка потоковой передачи типа "Стандартный"** (рекомендуется)|0|Тип **Стандартный** является рекомендуемым вариантом практически для всех сценариев потоковой передачи и размеров аудитории. Тип **Стандартный** автоматически масштабирует пропускную способность для исходящих данных. <br/>Для клиентов с очень высокими требованиями платформа Служб мультимедиа предлагает конечные точки потоковой передачи уровня **Премиум**, которые можно использовать для увеличения масштаба емкости для крупнейших интернет-аудиторий. Если предполагается наличие большой аудитории и одновременных зрителей, свяжитесь с нами по адресу amsstreaming@microsoft.com, чтобы получить рекомендации по переходу на тип **Премиум**. |
|**Конечная точка потоковой передачи типа "Премиум"**|>0|Конечные точки уровня **Премиум** подходят для выполнения более сложных задач благодаря выделенной пропускной способности и возможности масштабирования. Выполните переход на тип **Премиум**, изменив `scaleUnits`. `scaleUnits` предоставляют определенную выходную пропускную способность, которую можно приобрести с шагом приращения 200 Мбит/с. При использовании типа **Премиум** каждая включенная единица обеспечивает приложению дополнительную пропускную способность. |

## <a name="working-with-cdn"></a>Работа с CDN

В большинстве случаев необходимо включить CDN. Тем не менее, если вы ожидаете максимального уровня параллелизма меньше 500 зрителей, рекомендуется отключить сеть CDN, так как она лучше масштабируется при высоком параллелизме.

> [!NOTE]
> Конечная точка и URL-адрес потоковой передачи `hostname` остаются без изменений независимо от того, включена ли сеть CDN.

### <a name="detailed-explanation-of-how-caching-works"></a>Подробное описание выполнения кэширования

При добавлении CDN нет определенного значения пропускной способности, так как необходимый объем пропускной способности для конечной точки потоковой передачи с включенной CDN различается. Многое зависит от типа содержимого, его популярности, скоростей передачи и протоколов. CDN выполняет только запрашиваемое кэширование. Это означает, что популярное содержимое будет предоставляться непосредственно из сети CDN (до тех пор, пока кэшируется фрагмент видео). При просмотре в режиме реального времени содержимое с большой вероятностью кэшируется, так как обычно у вас есть много людей, наблюдающих за одними данными. С содержимым по запросу может быть немного сложнее, так как популярность некоторого содержимого может отличаться. Если у вас есть миллионы непопулярных видеофайлов (только 1 или 2 зрителя в неделю) и тысячи людей, просматривающих разные видео, CDN становится менее эффективной. С этим промахом в кэше увеличивается нагрузка на конечную точку потоковой передачи.
 
Необходимо также учитывать, как работает адаптивная потоковая передача. Все отдельные фрагменты видео кэшируются как его сущности. Например, если определенное видео просматривается впервые и пользователь пропускает его, увидев всего несколько секунд, в CDN кэшируются только фрагменты видео, связанные с пользователем. При использовании адаптивной потоковой передачи можно применять от 5 до 7 разных скоростей передачи видео. Если пользователи используют разные скорости передачи, каждый из них кэшируются в сети CDN отдельно. Даже если два пользователя используют одинаковую скорость передачи, они могут применять разные протоколы. Все протоколы (HLS, MPEG-DASH, Smooth Streaming) кэшируются отдельно. Таким образом, каждая скорость и протокол кэшируются отдельно и кэшируются только запрашиваемые фрагменты видео.
 
## <a name="properties"></a>properties 

В этом разделе приведены подробные сведения о некоторых свойствах StreamingEndpoint. Примеры создания новой конечной точки потоковой передачи и описания всех свойств см. в [этой статье](https://docs.microsoft.com/rest/api/media/streamingendpoints/create). 

|Свойство|ОПИСАНИЕ|  
|--------------|----------|
|`accessControl`|Используется для настройки следующих параметров безопасности для этой конечной точки потоковой передачи: ключи проверки подлинности заголовка подписи Akamai и IP-адреса, которые могут подключаться к этой конечной точке.<br />Это свойство можно задать, если `cdnEnabled` имеет значение false.|  
|`cdnEnabled`|Указывает, включена ли интеграция Azure CDN для этой конечной точки потоковой передачи (отключено по умолчанию).<br /><br /> Если задать для `cdnEnabled` значение true, следующие конфигурации интеграции отключаются: `customHostNames` и `accessControl`.<br /><br />Не все центры обработки данных поддерживают интеграцию Azure CDN. Чтобы проверить, доступна ли интеграция Azure CDN для вашего центра обработки данных, сделайте следующее:<br /><br /> — Попробуйте установить для параметра `cdnEnabled` значение true.<br /><br /> — Проверьте, нет ли в возвращенном результате `HTTP Error Code 412` (PreconditionFailed) с сообщением Streaming endpoint CdnEnabled property cannot be set to true as CDN capability is not available in the current region (Для свойства CdnEnabled конечной точки потоковой передачи невозможно установить значение true, так как возможность CDN недоступна в текущем регионе).<br /><br /> Если вы получаете эту ошибку, данная интеграция не поддерживается в этом центре обработки данных. Попробуйте использовать другой центр обработки данных.|  
|`cdnProfile`|Если `cdnEnabled` имеет значение true, можно также передать значения `cdnProfile`. `cdnProfile` — имя профиля CDN, в котором будет создана конечная точка CDN. Вы можете предоставить имеющийся cdnProfile или создать его. Если значение равно NULL, а `cdnEnabled` — true, используется значение по умолчанию (AzureMediaStreamingPlatformCdnProfile). Если параметр `cdnProfile` уже предоставлен, с его использованием создается конечная точка. Если профиль отсутствует, он создается автоматически.|
|`cdnProvider`|Если сеть CDN включена, вы также можете передать значения `cdnProvider`. `cdnProvider` определяет, какой поставщик будет использоваться. В настоящее время поддерживаются три значения: StandardVerizon, PremiumVerizon и StandardAkamai. Если значение не указано и `cdnEnabled` имеет значение true, используется StandardVerizon (то есть значение по умолчанию).|
|`crossSiteAccessPolicies`|Используется для указания политик межсайтового доступа для различных клиентов. Дополнительные сведения см. в статьях [Спецификация файла междоменной политики](http://www.adobe.com/devnet/articles/crossdomain_policy_file_spec.html) и [Настройка доступности службы на границах домена](https://msdn.microsoft.com/library/cc197955\(v=vs.95\).aspx).|  
|`customHostNames`|Используется для настройки конечной точки потоковой передачи для приема трафика, направленного на пользовательское имя узла. Это упростит настройку управления трафиком с помощью глобального диспетчера трафика (GTM) и позволит использовать фирменные доменные имена в качестве имени конечной точки потоковой передачи.<br /><br /> Владелец доменного имени должен быть подтвержден Службами мультимедиа Azure. Службы мультимедиа Azure проверяют принадлежность доменного имени, требуя, чтобы запись `CName`, содержащая идентификатор учетной записи Служб мультимедиа Azure, была добавлена в качестве компонента к используемому домену. Например, чтобы использовать sports.contoso.com в качестве пользовательского имени узла для конечной точки потоковой передачи, запись для `<accountId>.contoso.com` необходимо настроить для указания одного из имен узлов проверки Служб мультимедиа. Имя узла проверки состоит из verifydns.\<зона_DNS_Служб_мультимедиа>. Следующая таблица содержит ожидаемые зоны DNS, которые должны использоваться в проверочной записи для разных регионов Azure.<br /><br /> Северная Америка, Европа, Сингапур, Гонконг, Япония:<br /><br /> — mediaservices.windows.net;<br /><br /> — verifydns.mediaservices.windows.net.<br /><br /> Китай:<br /><br /> — mediaservices.chinacloudapi.cn;<br /><br /> — verifydns.mediaservices.chinacloudapi.cn.<br /><br /> Например, запись `CName`, в которой 945a4c4e-28ea-45cd-8ccb-a519f6b700ad.contoso.com соответствует verifydns.mediaservices.windows.net, подтверждает, что идентификатор Служб мультимедиа Azure 945a4c4e-28ea-45cd-8ccb-a519f6b700ad владеет доменом contoso.com, следовательно, любое имя в contoso.com можно использовать в качестве пользовательского имени узла для конечной точки потоковой передачи в этой учетной записи.<br /><br /> Чтобы найти значение идентификатора службы мультимедиа, перейдите на [портал Azure](https://portal.azure.com/) и выберите свою учетную запись службы мультимедиа. Идентификатор службы мультимедиа отображается справа от страницы панели мониторинга.<br /><br /> **Предупреждение**. При попытке задать пользовательское имя узла без надлежащей проверки записи `CName` ответ DNS не будет получен, после чего в течение некоторого времени будет выполняться кэширование. После получения соответствующей записи повторная проверка кэшированного ответа может занять некоторое время. В зависимости от поставщика DNS пользовательского домена повторная проверка записи может занять от нескольких минут до часа.<br /><br /> Кроме параметра `CName`, который сопоставляет `<accountId>.<parent domain>` с `verifydns.<mediaservices-dns-zone>`, необходимо создать другую запись `CName`, которая сопоставляет пользовательское имя узла (например, `sports.contoso.com`) с именем узла StreamingEndpont Служб мультимедиа (например, `amstest.streaming.mediaservices.windows.net`).<br /><br /> **Примечание**. Конечные точки потоковой передачи, расположенные в одном центре обработки данных, не могут совместно применять одно пользовательское имя узла.<br /> Это свойство допустимо для типов конечных точек потоковой передачи "Стандартный" и "Премиум" и может устанавливаться, если cdnEnabled имеет значение false.<br/><br/> Сейчас AMS не поддерживает SSL для личных доменов.  |  
|`maxCacheAge`|Переопределяет значение по умолчанию заголовка максимального срока действия кэша HTTP, установленное конечной точкой потоковой передачи в медиафрагментах и манифестах по запросу. Это значение задается в секундах.|
|`resourceState`|Возможные значения для свойства:<br /><br /> — Stopped. Начальное состояние конечной точки потоковой передачи после ее создания.<br /><br /> — Starting. Конечная точка потоковой передачи переходит в рабочее состояние.<br /><br /> — Running. Конечная точка потоковой передачи может выполнять потоковую передачу содержимого клиентам.<br /><br /> — Scaling. Единицы масштабирования увеличиваются или уменьшаются.<br /><br /> — Stopping. Конечная точка потоковой передачи останавливается.<br/><br/> — Deleting. Выполняется удаление конечной точки потоковой передачи.|
|`scaleUnits `|Единицы масштабирования предоставляют определенную выходную пропускную способность, которую можно приобрести с шагом приращения 200 Мбит/с. Если вам нужно выполнить переход к типу **Премиум**, настройте параметр `scaleUnits`. |

## <a name="next-steps"></a>Дополнительная информация

[В этом репозитории](https://github.com/Azure-Samples/media-services-v3-dotnet-quickstarts/blob/master/AMSV3Quickstarts/EncodeAndStreamFiles/Program.cs) предоставлен пример запуска стандартной конечной точки потоковой передачи с помощью .NET.

