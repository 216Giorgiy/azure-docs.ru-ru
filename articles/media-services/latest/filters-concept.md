---
title: Определение фильтров в Службах мультимедиа Microsoft Azure
description: В этом разделе описывается создание фильтров, с помощью которых клиент может передавать определенные секции потока. Для достижения такой выборочной потоковой передачи службы мультимедиа создают динамические манифесты.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 02/12/2019
ms.author: juliako
ms.openlocfilehash: 09de372ffdb48c00fde9a43c07f8f8b574462d1f
ms.sourcegitcommit: fcb674cc4e43ac5e4583e0098d06af7b398bd9a9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2019
ms.locfileid: "56372962"
---
# <a name="define-account-filters-and-asset-filters"></a>Определение фильтров учетных записей и ресурсов  

При распространении содержимого пользователям (потоковой трансляции событий или видео по запросу) клиенту может потребоваться больше возможностей, чем определено в файле манифеста ресурса-контейнера по умолчанию. Службы мультимедиа Azure позволяют определять фильтры учетной записи и фильтры ресурсов для содержимого. 

Фильтры — это серверные правила, с помощью которых пользователи могут выполнять различные действия, в том числе перечисленные ниже. 

- Воспроизведение только части видео (вместо воспроизведения видео целиком). Например: 
  - Сокращение манифеста для отображения субклипа текущего события ("фильтрация субклипов") или
  - Обрезка начала видео ("обрезка видео").
- Доставка только указанных представлений и/или языковых дорожек, поддерживаемых устройством, на котором воспроизводится содержимое ("фильтрация представлений"). 
- Настройка окна представления (DVR) для предоставления ограниченной длительности окна DVR в проигрывателе ("настройка окна представления").

Службы мультимедиа предоставляют [динамические манифесты](filters-dynamic-manifest-overview.md) на основе предварительно определенных фильтров. После определения фильтров клиенты могут использовать их в URL-адресах потоковой передачи. Фильтры можно применять к протоколам потоковой передачи с переменной скоростью: Apple HTTP Live Streaming (HLS), MPEG-DASH и Smooth Streaming.

В представленной ниже таблице приводятся некоторые примеры URL-адресов с фильтрами.

|Протокол|Пример|
|---|---|
|HLS V4|`http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=m3u8-aapl,filter=myAccountFilter)`|
|HLS V3|`http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=m3u8-aapl-v3,filter=myAccountFilter)`|
|MPEG DASH|`http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=mpd-time-csf,filter=myAssetFilter)`|
|Smooth Streaming|`http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(filter=myAssetFilter)`|

## <a name="define-filters"></a>Определение фильтров

Существуют два типа фильтров активов. 

* [Фильтры учетных записей](https://docs.microsoft.com/rest/api/media/accountfilters) (глобальные) — применимы к любому ресурсу в учетной записи Служб мультимедиа Azure и действуют в течение всего времени ее существования.
* [Фильтры ресурсов](https://docs.microsoft.com/rest/api/media/assetfilters) (локальные) — применимы только к тому ресурсу, с которым фильтр был связан при создании, и действуют в течение времени существования ресурса. 

[Фильтры учетных записей](https://docs.microsoft.com/rest/api/media/accountfilters) и [ресурсов](https://docs.microsoft.com/rest/api/media/assetfilters) содержат одинаковые свойства для определения и описания фильтра. Во всех случаях, кроме создания **фильтра ресурса**, необходимо указать имя ресурса, с которым требуется связать фильтр.

В зависимости от сценария, вы выбираете наиболее подходящий тип фильтра (фильтр ресурса или учетной записи). Фильтры учетных записей подходят для профилей устройств (фильтрация представлений), в то время как фильтры ресурсов можно использовать для обрезки определенного ресурса.

Для описания фильтров можно использовать указанные ниже свойства. 

|ИМЯ|ОПИСАНИЕ|
|---|---|
|firstQuality|Первая качественная скорость фильтра.|
|presentationTimeRange|Диапазон времени презентации. Это свойство используется для фильтрации начальной и конечной точек манифеста, длины окна презентации и начального положения прямой трансляции. <br/>Дополнительные сведения см. в разделе [PresentationTimeRange](#PresentationTimeRange).|
|tracks|Условия выбора дорожек. Дополнительные сведения см. в разделе [tracks](#tracks).|

### <a name="presentationtimerange"></a>PresentationTimeRange

Это свойство используется с **фильтрами ресурсов**. Не рекомендуем задавать это свойство для **фильтров учетных записей**.

|ИМЯ|ОПИСАНИЕ|
|---|---|
|**endTimestamp**|Абсолютная граница времени окончания. Применяется для видео по запросу (VoD). Во время презентаций в прямом эфире это свойство игнорируется. Оно применяется по окончании презентации, когда поток преобразуется в VoD.<br/><br/>Значение представляет абсолютную конечную точку потока. Оно округляется до начала ближайшей из следующих групп изображений.<br/><br/>Используйте свойства StartTimestamp и EndTimestamp, чтобы обрезать список воспроизведения (манифест). Например, если задать значения StartTimestamp = 40000000 и EndTimestamp = 100000000, создается список воспроизведения, содержащий контент между StartTimestamp и EndTimestamp. Если фрагмент выходит за границы, он будет включен в манифест целиком.<br/><br/>Кроме того, ознакомьтесь с приведенным ниже определением **forceEndTimestamp**.|
|**forceEndTimestamp**|Применяется к фильтрам прямых трансляций.<br/><br/>**forceEndTimestamp** — это логическое значение, указывающее, было ли задано допустимое значение для свойства **endTimestamp**. <br/><br/>Если выбрано значение **true**, следует задать значение **endTimestamp**. Если оно не задано, возвращается ошибка запроса.<br/><br/>Например, если вам нужно определить фильтр, который начинается на 5-минутной отметке входного видео и продолжается до окончания потока, то следует задать для свойства **forceEndTimestamp** значение false и не указывать параметр **endTimestamp**.|
|**liveBackoffDuration**|Применяется только к прямым трансляциям. Это свойство используется для определения позиции при воспроизведении прямой трансляции. С помощью этого свойства можно задержать позицию воспроизведения прямой трансляции и создать на стороне сервера буфер для проигрывателей. Значение LiveBackoffDuration указывается относительно положения прямой трансляции. Максимальная продолжительность задержки потоковой трансляции составляет 300 секунд.|
|**presentationWindowDuration**|Применяется к прямым трансляциям. Свойство **presentationWindowDuration** используется для применения скользящего окна к списку воспроизведения. Например, задайте значение presentationWindowDuration = 1200000000, чтобы применить двухминутное скользящее окно. В список воспроизведения будут включены данные мультимедиа за две минуты до крайней позиции прямой трансляции. Если фрагмент выходит за границы, он будет включен в список воспроизведения целиком. Минимальная продолжительность окна презентации составляет 60 секунд.|
|**startTimestamp**|Применяется к VoD и прямым трансляциям. Значение представляет абсолютную начальную точку потока. Оно округляется до начала ближайшей из следующих групп изображений.<br/><br/>Используйте свойства **startTimestamp** и **endTimestamp**, чтобы обрезать список воспроизведения (манифест). Например, если задать значения startTimestamp = 40000000 и endTimestamp = 100000000, создается список воспроизведения, содержащий контент между StartTimestamp и EndTimestamp. Если фрагмент выходит за границы, он будет включен в манифест целиком.|
|**timescale**|Применяется к VoD и прямым трансляциям. Шкала времени, используемая для указанных выше меток времени и продолжительностей. По умолчанию задана шкала времени 10000000. Можно использовать альтернативную шкалу. Значение по умолчанию составляет 10000000 HNS (сотен наносекунд).|

### <a name="tracks"></a>Дорожки

Вы указываете список условий для фильтрации свойств дорожек (FilterTrackPropertyConditions) с учетом того, какие дорожки вашего потока (прямой трансляции или видео по запросу) следует включить в динамически создаваемый манифест. Фильтры объединяются с помощью логических операций **AND** и **OR**.

Условия фильтрации свойств дорожек описывают типы дорожек, значения (приведенные в таблице ниже) и операции (Equal, NotEqual). 

|ИМЯ|ОПИСАНИЕ|
|---|---|
|**Bitrate**|Фильтрация по скорости дорожки.<br/><br/>Рекомендуемое значение — диапазон скоростей (в битах в секунду). Пример: "0-2427000".<br/><br/>Примечание: можно использовать конкретное значение скорости, например 250000 (бит в секунду), но такой подход не рекомендуется, так как точная скорость может меняться от ресурса к ресурсу.|
|**FourCC**|Фильтрация по значению FourCC дорожки.<br/><br/>Это значение является первым элементом формата кодеков согласно стандарту [RFC 6381](https://tools.ietf.org/html/rfc6381). Сейчас поддерживаются перечисленные ниже кодеки. <br/>Для видео: "avc1", "hev1", "hvc1"<br/>Для звука: "mp4a", "ec-3"<br/><br/>Чтобы определить значения FourCC для дорожек в ресурсе, [получите и просмотрите файл манифеста](#get-and-examine-manifest-files).|
|**Язык**|Фильтрация по языку дорожки.<br/><br/>Это значение представляет собой тег языка, который требуется включить, как указано в стандарте RFC 5646. Например, en.|
|**Имя**|Фильтрация по имени дорожки.|
|**Тип**|Фильтрация по типу дорожки.<br/><br/>Допускаются следующие значения: "video", "audio" и "text".|

## <a name="example"></a>Пример

```json
{
  "properties": {
    "presentationTimeRange": {
      "startTimestamp": 0,
      "endTimestamp": 170000000,
      "presentationWindowDuration": 9223372036854776000,
      "liveBackoffDuration": 0,
      "timescale": 10000000,
      "forceEndTimestamp": false
    },
    "firstQuality": {
      "bitrate": 128000
    },
    "tracks": [
      {
        "trackSelections": [
          {
            "property": "Type",
            "operation": "Equal",
            "value": "Audio"
          },
          {
            "property": "Language",
            "operation": "NotEqual",
            "value": "en"
          },
          {
            "property": "FourCC",
            "operation": "NotEqual",
            "value": "EC-3"
          }
        ]
      },
      {
        "trackSelections": [
          {
            "property": "Type",
            "operation": "Equal",
            "value": "Video"
          },
          {
            "property": "Bitrate",
            "operation": "Equal",
            "value": "3000000-5000000"
          }
        ]
      }
    ]
  }
}
```

## <a name="next-steps"></a>Дополнительная информация

В указанных ниже статьях показано, как создавать фильтры программным способом.  

- [Create filters with REST APIs](filters-dynamic-manifest-rest-howto.md) (Создание фильтров с помощью интерфейсов REST API)
- [Создание фильтров с помощью .NET](filters-dynamic-manifest-dotnet-howto.md)
- [Create filters with CLI](filters-dynamic-manifest-cli-howto.md) (Создание фильтров с помощью .NET)

