---
title: Общие сведения о потоковой трансляции с использованием служб мультимедиа Azure | Документация Майкрософт
description: В этой статье содержатся общие сведения о потоковой трансляции с использованием Служб мультимедиа Azure версии 3.
services: media-services
documentationcenter: ''
author: Juliako
manager: cfowler
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 06/06/2018
ms.author: juliako
ms.openlocfilehash: e9ecf1ba3022ca057fa09bad2413aa19d902ae23
ms.sourcegitcommit: f606248b31182cc559b21e79778c9397127e54df
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/12/2018
ms.locfileid: "38972185"
---
# <a name="live-streaming-with-azure-media-services-v3"></a>Потоковая трансляция в Службах мультимедиа Azure версии 3

При трансляции мероприятий путем динамической потоковой передачи с помощью служб мультимедиа Azure обычно используется следующее:

* Камера, которая используется для трансляции события.
* Динамический видеокодировщик, который преобразует сигналы с камеры (или другого устройства, например ноутбука) в потоки и отправляет их в службу потоковой трансляции в Службах мультимедиа. Эти сигналы могут включать стандарт рекламы SCTE-35 и подсказки Ad. 
* Служба потоковой трансляции в Службах мультимедиа позволяет принимать, просматривать, записывать, шифровать и транслировать содержимое непосредственно клиентам или в сеть доставки содержимого для дальнейшего распространения.

В этой статье приведено подробное описание и схемы основных компонентов, участвующих в потоковой трансляции в Службах мультимедиа.

## <a name="overview-of-main-components"></a>Общие сведения об основных компонентах

В Службах мультимедиа за обработку содержимого потоковой трансляции отвечают компоненты [LiveEvent](https://docs.microsoft.com/rest/api/media/liveevents). Компонент LiveEvent предоставляет входную конечную точку (URL-адрес входа), которую вы можете передать в локальный динамический кодировщик. LiveEvent получает от кодировщика входные потоки трансляции (в формате RTMP или Smooth Streaming) и предоставляет их для потоковой передачи через одну или несколько конечных точек [StreamingEndpoint](https://docs.microsoft.com/rest/api/media/streamingendpoints). Компонент [LiveOutput](https://docs.microsoft.com/rest/api/media/liveoutputs) позволяет управлять публикацией, записью и параметрами окна DVR для потока в режиме реального времени. Также LiveEvent предоставляет конечную точку предварительного просмотра (URL-адрес предварительного просмотра), которая позволяет просмотреть и проверить поток перед его обработкой и доставкой. 

Службы мультимедиа поддерживают **динамическую упаковку**, которая дает возможность просматривать и транслировать содержимое в форматах потоковой передачи (MPEG DASH, HLS, Smooth Streaming) без необходимости вручную упаковывать контент в эти форматы потоковой передачи. Для воспроизведения можно использовать любое средство, совместимое с HLS, DASH или Smooth. Для проверки потока можно использовать [Проигрыватель мультимедиа Azure](http://amp.azure.net/libs/amp/latest/docs/index.html).

Службы мультимедиа обеспечивают доставку содержимого, зашифрованного динамически (**динамическое шифрование**) по стандарту Advanced Encryption Standard (AES-128) или в любой из трех основных систем управления цифровыми правами (DRM): Microsoft PlayReady, Google Widevine и Apple FairPlay. Они также обеспечивают службу доставки ключей AES и лицензий DRM (PlayReady, Widevine и FairPlay) авторизованным клиентам.

При желании можно также применить **динамическую фильтрацию**, которая позволяет настраивать количество дорожек, форматы и скорость для передачи на проигрыватели. Службы мультимедиа также поддерживают вставку рекламы.


## <a name="liveevent-types"></a>Типы LiveEvent

Есть два типа [LiveEvent](https://docs.microsoft.com/rest/api/media/liveevents): кодирование в реальном времени или сквозной режим. 

### <a name="live-encoding-with-media-services"></a>Кодирование в реальном времени с помощью Служб мультимедиа

![Кодирование в реальном времени](./media/live-streaming/live-encoding.png)

Локальный динамический кодировщик передает односкоростной поток в компонент LiveEvent, который может осуществлять кодирование в реальном времени с помощью Служб мультимедиа в один из следующих протоколов: RTMP или Smooth Streaming (фрагментированный формат MP4). Затем LiveEvent кодирует входящий односкоростной поток в реальном времени в многоскоростной (адаптивный) видеопоток. При получении запроса службы мультимедиа предоставляют потоки клиентам.

Создавая LiveEvent такого типа, укажите значение **Basic** (LiveEventEncodingType.Basic).

### <a name="pass-through"></a>Сквозной режим

![Сквозной режим](./media/live-streaming/pass-through.png)

Сквозной режим оптимизирован для длительно выполняющихся потоков прямой трансляции или круглосуточного линейного кодирования в реальном времени с помощью локального динамического кодировщика. Локальный кодировщик передает содержимое в многоскоростном формате **RTMP** или **Smooth Streaming** (фрагментированный формат MP4) в компонент LiveEvent, для которого настроена доставка **в сквозном режиме**. **Сквозная** доставка означает, что полученные потоки проходят через **LiveEvent** без дополнительной обработки. 

LiveEvent в сквозном режиме может поддерживать разрешение до 4K и сквозной режим HEVC при использовании протокола приема Smooth Streaming. 

Создавая LiveEvent такого типа, укажите значение **None** (LiveEventEncodingType.None).

> [!NOTE]
> Метод сквозной доставки — наиболее экономичный способ осуществления потоковой передачи в режиме реального времени, если передается ряд событий за длительный период времени и у вас уже есть локальные кодировщики. См. сведения о [ценах](https://azure.microsoft.com/pricing/details/media-services/).
> 

## <a name="liveevent-types-comparison"></a>Сравнение типов LiveEvent 

В приведенной ниже таблице сравниваются возможности двух типов LiveEvent.

| Функция | LiveEvent в сквозном режиме | Базовый компонент LiveEvent |
| --- | --- | --- |
| Кодировка односкоростного источника данных в несколько потоков с различными скоростями передачи в облаке |Нет  |Yes |
| Максимальное разрешение, количество слоев |4Kp30  |720p, 6 слоев, 30 и более кадров в секунду |
| Протоколы входных данных |RTMP, Smooth Streaming |RTMP, Smooth Streaming |
| Цена |Откройте [страницу цен](https://azure.microsoft.com/pricing/details/media-services/) и выберите вкладку Live Video |Откройте [страницу цен](https://azure.microsoft.com/pricing/details/media-services/) |
| Максимальное время выполнения |24x7 |24x7 |
| Поддержка вставки баннеров |Нет  |Yes |
| Поддержка сигнализации о рекламе через API-интерфейс|Нет  |Yes |
| Поддержка сигнализации о рекламе через внутриполосный протокол SCTE35|Yes |Yes |
| Сквозная передача субтитров стандарта CEA 608/708 |Yes |Yes |
| Возможность восстановления после кратких остановок в канале входного потока данных |Yes |Нет (LiveEvent начнет вставку через 6 или более секунд отсутствия входных данных)|
| Поддержка неоднородных GPO |Yes |Нет — входные данные должны представлять собой двухсекундные GOP с фиксированной скоростью передачи |
| Поддержка входных данных с переменной частотой кадров |Yes |Нет — входные данные должны иметь фиксированную частоту кадров.<br/>Небольшие колебания допустимы, например, в сценах с высокой скоростью движения. При этом кодировщик не поддерживает сжатие до 10 кадров в секунду. |
| Автоотключение LiveEvent при потере входного веб-канала |Нет  |Через 12 часов при отсутствии выполняющихся компонентов LiveOutput |

## <a name="liveevent-states"></a>Состояния LiveEvent 

Текущее состояние LiveEvent. Ниже перечислены возможные значения.

|Состояние|ОПИСАНИЕ|
|---|---|
|**Stopped**| Это начальное состояние компонента LiveEvent после его создания (если не настроен автозапуск). В этом состоянии начисление оплаты не происходит. В этом состоянии можно изменять свойства LiveEvent, но потоковая передача невозможна.|
|**Запуск**| Компонент LiveEvent запускается. В этом состоянии начисление оплаты не происходит. В этом состоянии обновление и потоковая передача запрещены. Если возникает ошибка, LiveEvent возвращается в состояние "Остановлено".|
|**Выполнение**| LiveEvent может обрабатывать динамические потоки. Теперь оплата начисляется. Необходимо остановить работу компонента LiveEvent, чтобы избежать дальнейшего начисления оплаты.|
|**Остановка**| Компонент LiveEvent останавливается. В этом переходном состоянии оплата не начисляется. В этом состоянии обновление и потоковая передача запрещены.|
|**Удаление**| Компонент LiveEvent удаляется. В этом переходном состоянии оплата не начисляется. В этом состоянии обновление и потоковая передача запрещены.|

## <a name="liveoutput"></a>Компонент LiveOutput

Компонент [LiveOutput](https://docs.microsoft.com/rest/api/media/liveoutputs) позволяет управлять публикацией, записью и параметрами окна DVR для потока в режиме реального времени. Отношения между LiveEvent и LiveOutput аналогичны традиционному телевидению, в котором по каналу (LiveEvent) передается непрерывный поток содержимого, а программа (LiveOutput) назначается на определенное время выполнения в этом канале.
Можно указать количество часов для хранения записанного содержимого для LiveOutput, установив свойство **ArchiveWindowLength**. Параметр **ArchiveWindowLength** определяет интервал времени в формате ISO 8601 для периода архивации (DVR, средство цифровой записи видео). Это значение может быть задано в диапазоне от 5 минут до 25 часов. 

Также **ArchiveWindowLength** указывает максимальное время, на которое клиенты могут смещаться назад от текущего момента трансляции. Компоненты LiveOutput могут выполняться в течение определенного времени, вне этого периода содержимое не обрабатывается. Значение этого свойства определяет, как долго могут увеличиваться манифесты клиентов.

Каждый компонент LiveOutput связывается с компонентом [Asset](https://docs.microsoft.com/rest/api/media/assets) и сохраняет данные в контейнер в хранилище Azure, подключенный к учетной записи Служб мультимедиа. Чтобы опубликовать LiveOutput, создайте компонент [StreamingLocator](https://docs.microsoft.com/rest/api/media/streaminglocators) для соответствующего ресурса. С помощью этого указателя можно сформировать URL-адрес потоковой передачи данных, который предоставляется клиентам.

LiveEvent поддерживает одновременную потоковую трансляцию для трех компонентов LiveOutput, то есть вы можете создавать несколько архивов для одного входящего потока. Благодаря этому можно публиковать и архивировать разные части транслируемого мероприятия. Например, у вас есть обязательства круглосуточно транслировать содержимое по линейному веб-каналу в реальном времени, но в течение дня вы намерены создавать "записи" отдельных программ, чтобы клиенты могли по запросу просмотреть пропущенное содержимое.  Для этого сценария вам нужно сначала создать основной компонент LiveOutput с коротким периодом архивации (1 час или меньше) для клиентов, подключающихся к просмотру основного потока. Для этого компонента LiveOutput вы создадите StreamingLocator и опубликуете его в приложении и (или) на веб-сайте, обозначив как веб-канал "прямой трансляции".  Запустив работу этого веб-канала, вы можете программными средствами создавать дополнительный, параллельный компонент LiveOutput в начале каждой программы (или на 5 минут раньше, чтобы оставить запас на небольшие сдвиги, который вы удалите позднее). Этот второй компонент LiveOutput будет останавливаться через 5 минут после завершения программы (или события), и на его основе вы будете создавать новый компонент StreamingLocator для публикации отдельной программы в качестве ресурса для просмотра по запросу, включив его в каталог приложения.  Этот процесс можно повторять любое количество раз для других программ или особо важных моментов, которые вы хотите немедленно предоставить в доступ по запросу. При этом основной веб-канал из первого компонента LiveOutput продолжает транслировать содержимое по линейному веб-каналу.  Кроме того, вы можете применить динамический фильтр для обрезки запаса в начале и конце архива в LiveOutput. Такая схема позволяет создать "защитный" буфер между программами и более точно находить начало и конец содержимого. Заархивированное содержимое можно передать в компонент [Transform](https://docs.microsoft.com/rest/api/media/transforms), чтобы выполнить кодирование или покадровую обрезку в несколько других форматов вывода для синдикации с другими службами.

## <a name="streamingendpoint"></a>StreamingEndpoint

Когда вы настроите передачу потока через LiveEvent, можно запустить событие потоковой передачи, создав компоненты Asset, LiveOutput и StreamingLocator. Так вы сможете запустить архивацию потока и сделать его доступным для зрителей через конечную точку [StreamingEndpoint](https://docs.microsoft.com/rest/api/media/streamingendpoints).

При создании учетной записи служб мультимедиа в нее добавляется конечная точка потоковой передачи по умолчанию в состоянии "Остановлена". Чтобы начать потоковую передачу содержимого и воспользоваться функциями динамической упаковки и динамического шифрования, конечная точка потоковой передачи, из которой необходимо выполнять потоковую передачу содержимого, должна находиться в состоянии "Выполняется".

## <a name="billing"></a>Выставление счетов

Начисление платы за использование компонента LiveEvent начинается, как только он переходит в состояние "Выполняется". Чтобы остановить начисление платы за использование компонента LiveEvent, его нужно остановить.

> [!NOTE]
> Если для [LiveEvent](https://docs.microsoft.com/rest/api/media/liveevents) настроен тип **LiveEventEncodingType** со значением Basic, Службы мультимедиа автоматически отключают все компоненты LiveEvent, находящиеся в состоянии "Выполняется", через 12 часов после потери входного веб-канала при отсутствии запущенных компонентов LiveOutput. Но при этом вам будет начислена оплата за все время, пока компонент LiveEvent находился в состоянии "Выполняется".
>

В таблице ниже показано, как состояния LiveEvent соотносятся с режимом выставления счетов.

| Состояние LiveEvent | Это начисление оплаты? |
| --- | --- |
| Запуск |Нет (переходное состояние) |
| Выполнение |ДА |
| Остановка |Нет (переходное состояние) |
| Остановлено |Нет  |

## <a name="next-steps"></a>Дополнительная информация

[Руководство по потоковой трансляции](stream-live-tutorial-with-api.md)
