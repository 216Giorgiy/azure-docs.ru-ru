<properties title="Miscellaneous Considerations for Oracle Virtual Machine Images" pageTitle="Различные рекомендации по образам виртуальных машин Oracle" description="Дополнительная информация о рекомендациях касательно подготовки развертывания виртуальной машины Oracle в Microsoft Azure." services="virtual-machines" authors="bbenz" documentationCenter=""/>
<tags ms.service="virtual-machines" ms.devlang="na" ms.topic="article" ms.tgt_pltfrm="na" ms.workload="infrastructure-services" ms.date="06/22/2015" ms.author="bbenz" />
#Различные рекомендации по образам виртуальных машин Oracle
В этой статье рассматриваются рекомендации для виртуальных машин Oracle в Azure на основе образов программного обеспечения Oracle, предоставляемых корпорацией Майкрософт, на базе ОС Windows Server.

-  Образы виртуальных машин для базы данных Oracle
-  Образы виртуальных машин Oracle WebLogic Server
-  Образы виртуальных машин JDK для Oracle

##Образы виртуальных машин для базы данных Oracle
### Кластеризация (средство анализа стабильности системы) не поддерживается

Сейчас Azure не поддерживает кластеризацию базы данных Oracle. Возможно использовать только отдельные экземпляры базы данных Oracle. Это обусловлено тем, что сейчас Azure не поддерживает общий доступ к виртуальным дискам в режиме чтения и записи для нескольких экземпляров виртуальной машины. Кроме того, также не поддерживается многоадресная рассылка по UDP.

### Статический внутренний IP-адрес отсутствует

Azure назначает внутренний IP-адрес каждой виртуальной машине. IP-адрес виртуальной машины является динамическим и может измениться после перезапуска, если виртуальная машина не является частью виртуальной сети. Это может вызвать проблемы, так как для базы данных Oracle требуется статический IP-адрес. Чтобы избежать этого, рассмотрите возможность добавления виртуальной машины в виртуальную сеть Azure. Дополнительную информацию см. в статье [Виртуальная сеть](http://azure.microsoft.com/documentation/services/virtual-network/) и [Создание виртуальной сети в Azure](create-virtual-network.md).

### Варианты конфигурации подключенного диска

Файлы данных можно разместить на диске операционной системы (ОС) виртуальной машины или на подключенных дисках, также известных как диски данных. Подключенные диски отличаются от дисков ОС более высокой производительностью и возможностью изменения размера. Диск операционной системы предпочтительнее использовать только для баз данных размером менее 10 ГБ.

Подключенные диски используют службу хранилища больших двоичных объектов Azure. Теоретически каждый диск способен выполнять максимум около 500 операций ввода-вывода в секунду (IOPS). Производительность подключенных дисков может изначально быть неоптимальной, а производительность операций ввода-вывода может значительно повыситься после периода приработки — приблизительно 60–90 минут непрерывной работы. Если впоследствии диск будет неактивным, производительность операций ввода-вывода может быть снижена до другого периода приработки (непрерывной работы). Иными словами, чем более активно используется диск, тем скорее он достигнет оптимальной производительности операций ввода-вывода в секунду.

Несмотря на то, что самый простой подход — подключить один диск к виртуальной машине и поместить на него файлы базы данных, такой подход также является наиболее ограничивающим с точки зрения производительности. Вместо этого эффективность производительности операций ввода-вывода в секунду зачастую можно повысить, использовав несколько подключенных дисков, распределив между ними данные базы данных, а затем применив Oracle Automatic Storage Management (ASM). Дополнительную информацию см. в разделе [Обзор Oracle Automatic Storage](http://www.oracle.com/technetwork/database/index-100339.html). Несмотря на то, что можно чередовать несколько дисков на уровне ОС, мы не советуем применять такой подход, так как не известно, повышается ли от этого производительность операций ввода-вывода в секунду.

Рассмотрим два различных подхода к подключению нескольких дисков в зависимости от того, какие операции в базе данных самые приоритетные — операции чтения или записи.

- **Если использовать только Oracle ASM**, это может привести к повышению производительности операций записи и к понижению производительности операций ввода-вывода в секунду для операций чтения по сравнению с подходом, при котором используются пулы носителей Windows Server 2012. На следующем рисунке показана схема логического размещения при использовании такого подхода. ![](media/virtual-machines-miscellaneous-considerations-oracle-virtual-machine-images/image2.png)

- **Если использовать Oracle ASM и пулы носителей Windows Server 2012**, это может привести к повышению производительности операций ввода-вывода для операций чтения, если база данных в основном выполняет операции чтения или если производительность операций чтения для вас приоритетнее производительности операций записи. Для этого требуется использовать образ на базе ОС Windows Server 2012. Дополнительную информацию о пулах носителей см. в разделе [Развертывание дисковых пространств на автономном сервере](http://technet.microsoft.com/library/jj822938.aspx). При таком размещении два одинаковых подмножества подключенных дисков сначала вместе «чередуются» как физические диски в двух томах пулов носителей, а затем тома добавляются в группу дисков ASM. На следующем рисунке показана схема логического размещения при использовании такого подхода.

	![](media/virtual-machines-miscellaneous-considerations-oracle-virtual-machine-images/image3.png)

>[AZURE.IMPORTANT]Оцените разницу в производительности операций записи и чтения для каждого отдельного случая. Фактические результаты при использовании этих подходов могут отличаться.

### Рекомендации по высокой доступности и аварийному восстановлению

При использовании базы данных Oracle в виртуальных машинах Azure вы несете ответственность за внедрение решения, которое обеспечивает высокую доступность и аварийное восстановление и позволит избежать простоев. Вы также отвечаете за резервное копирование данных и приложений.

Высокий уровень доступности и аварийное восстановление в Oracle Database Enterprise Edition (без средства анализа стабильности системы) в Azure можно реализовать с помощью [Data Guard, Active Data Guard](http://www.oracle.com/technetwork/articles/oem/dataguardoverview-083155.html) или [Oracle Golden Gate](http://www.oracle.com/technetwork/middleware/goldengate), разместив две базы данных в двух отдельных виртуальных машинах. Обе виртуальные машины должны находиться в одной [облачной службе](cloud-services-connect-virtual-machine.md) и [виртуальной сети](http://azure.microsoft.com/documentation/services/virtual-network/), чтобы они могли обращаться друг к другу через частный постоянный IP-адрес. Кроме того, мы советуем размещать виртуальные машины в одной [группе доступности](manage-availability-virtual-machines.md), так как это позволяет Azure помещать их в отдельные домены сбоя и домены обновления. Обратите внимание, что в одной и той же группе доступности можно разместить только виртуальные машины из одной и той же облачной службы. Каждая виртуальная машина должна иметь по крайней мере 2 ГБ памяти и 5 ГБ дискового пространства.

При использовании Oracle Data Guard можно обеспечить высокую доступность, если разместить базу данных-источник в одной виртуальной машине, базу данных-получатель (резервную) — в другой виртуальной машине и односторонний набор реплик между ними. В результате можно получить доступ на чтение к копии базы данных. При использовании Oracle GoldenGate можно настроить двунаправленную репликацию между двумя базами данных. Дополнительную информацию о настройке высокой доступности для баз данных с помощью этих инструментов см. в документации по [Active Data Guard](http://www.oracle.com/technetwork/database/features/availability/data-guard-documentation-152848.html) и [GoldenGate](http://docs.oracle.com/goldengate/1212/gg-winux/index.html) на веб-сайте Oracle. Если вам требуется получить доступ на чтение и запись к копии базы данных, см. документ [Oracle Active Data Guard](http://www.oracle.com/uk/products/database/options/active-data-guard/overview/index.html).

##Образы виртуальных машин Oracle WebLogic Server

-  **Кластеризация поддерживается только в выпуске Enterprise Edition.** При использовании образов WebLogic Server с лицензией корпорации Майкрософт (в частности, с Windows Server в качестве операционной системы) вы имеете право использовать кластеризацию WebLogic, только если используете выпуск Enterprise Edition сервера WebLogic Server. Не используйте кластеризацию с выпуском WebLogic Server Standard Edition.

-  **Время ожидания подключения.** Если ваше приложение использует подключение к общедоступным конечным точками другой облачной службы Azure (например, службы уровня базы данных), Azure может закрыть эти открытые подключения спустя 4 минуты бездействия. Это может повлиять на компоненты и приложения, использующие пулы подключений, так как подключения, которые не используются в течение более длительного периода, могут становится недействительными. Если это влияет на ваше приложение, рассмотрите возможность включения логики проверки активности в пулах подключений.

	Обратите внимание, что если конечная точка является *внутренней* по отношению к развертыванию облачной службы Azure (например, виртуальная машина автономной базы данных, которая находится в *той же* облачной службе, что и виртуальные машины WebLogic), подключение является прямым и не зависит от подсистемы балансировки нагрузки Azure. Таким образом, к этому подключению не применяется время ожидания подключения.

-  **Не поддерживается многоадресная рассылка по UDP.** Azure поддерживает одноадресную рассылку по UDP, но не поддерживает ни многоадресную рассылку, ни широковещательную рассылку. WebLogic Server может использовать возможности одноадресной рассылки по UDP в Azure. Чтобы получить лучшие результаты при использовании одноадресной рассылки по UDP, мы советуем не изменять размер кластера WebLogic или размещать в кластере не более 10 управляемых серверов.

-  **WebLogic Server ожидает использования одинаковых общих и частных портов для доступа к каналу T3 (например, при использовании Enterprise JavaBeans).** Рассмотрим многоуровневый сценарий, при котором приложение уровня служб (EJB) выполняется в кластере WebLogic Server, состоящем из двух или более управляемых серверов, в облачной службе с именем **SLWLS**. Клиентский уровень расположен в другой облачной службе, которая выполняет простую программу Java, которая пытается вызвать EJB на уровне служб. Так как необходимо сбалансировать нагрузку для уровня служб, нужно создать общедоступную конечную точку с балансировкой нагрузки для виртуальных машин в кластере WebLogic Server. Если частный порт, заданный для этой конечной точки, отличается от общего порта (например, 7006:7008), произойдет ошибка, подобная следующей:

		[java] javax.naming.CommunicationException [Root exception is java.net.ConnectException: t3://example.cloudapp.net:7006:

		Bootstrap to: example.cloudapp.net/138.91.142.178:7006' over: 't3' got an error or timed out]

	Это вызвано тем, что при любой установке удаленного доступа к каналу T3 WebLogic Server ожидает использования одинаковых портов балансировки нагрузки и портов управляемых серверов WebLogic. В приведенном выше примере клиент обращается к порту 7006 (порт балансировки нагрузки), а управляемый сервер прослушивает порт 7008 (частный порт). Обратите внимание, что это ограничение применяется только к доступу к каналу T3, а не к HTTP.

	Чтобы избежать этой проблемы, используйте одно из следующих решений:

	-  Используйте частные и общие порты с одинаковыми номерами для конечных точек с балансировкой нагрузки, выделенных для получения доступа к каналу T3.

	-  Добавьте следующий параметр виртуальной машины Java при запуске WebLogic Server:

			-Dweblogic.rjvm.enableprotocolswitch=true

Дополнительную информацию см. в статье KB **860340.1** по адресу <http://support.oracle.com>.

-  **Ограничения для динамической кластеризации и балансировки нагрузки.** Предположим, что нужно использовать динамический кластер в WebLogic Server и предоставить его через единственную общую конечную точку с балансировкой нагрузки в Azure. Для этого нужно использовать порт с определенным номером для каждого из управляемых серверов (не назначаемых динамически из диапазона) и не запускать большее количество управляемых серверов, чем количество созданных виртуальных машин, которые отслеживает администратор (то есть не более одного управляемого сервера на одну виртуальную машину). Если в вашей конфигурации запускается больше серверов WebLogic, чем количество виртуальных машин (то есть, если несколько экземпляров WebLogic Server будут совместно использовать одну и ту же виртуальную машину), будет невозможно привязать к заданному номеру порта более одного из этих экземпляров серверов WebLogic Server. Остальные экземпляры на этой виртуальной машине привязать не удастся. 

	С другой стороны, если настроить сервер администратора таким образом, чтобы уникальные номера портов назначались управляемым серверам автоматически, балансировка нагрузки будет невозможна, так как Azure не поддерживает сопоставление одного общего порта с несколькими частными портами, как потребовалось бы для этой конфигурации.

-  **Несколько экземпляров WebLogic на одной виртуальной машине.** В зависимости от требований вашего развертывания следует рассмотреть возможность запуска нескольких экземпляров WebLogic Server на одной и той же виртуальной машине при условии, что ее размер достаточно большой. Например, на виртуальной машине среднего размера с 2 ядрами можно запустить два экземпляра WebLogic Server. Обратите внимание, что мы по-прежнему советуем не вносить в архитектуру единые точки отказа, так как это может произойти при использовании только одной виртуальной машины, на которой выполняются несколько экземпляров WebLogic Server. Лучше использовать по крайней мере две виртуальные машины, на каждой из которых может выполняться по несколько экземпляров WebLogic Server. Каждый из этих экземпляров WebLogic Server может быть частью одного кластера. Тем не менее обратите внимание, что сейчас невозможно использовать Azure для балансировки нагрузки конечных точек, предоставляемых такими развертываниями WebLogic Server в пределах одной и той же виртуальной машины, так как подсистема балансировки нагрузки Azure требует, чтобы серверы с балансировкой нагрузки были распределены между уникальными виртуальными машинами.

##Образы виртуальных машин JDK для Oracle

-  **Последние обновления JDK 6 и 7.** Хотя мы советуем использовать последнюю общедоступную поддерживаемую версию Java (сейчас это Java 8), в Azure также доступны образы JDK 6 и 7. Они предназначены для устаревших приложений, которые еще невозможно обновить до версии JDK 8. Так как обновления для предыдущих версий JDK могут быть сейчас не доступны, благодаря сотрудничеству корпорации Майкрософт и компании Oracle образы JDK 6 и 7, предоставляемые Azure, должны содержать более новое закрытое обновление, которое компания Oracle, как правило, предлагает только выбранной группе своих клиентов. Новые версии образов JDK, а также обновленные версии JDK 6 и 7 будут доступны со временем.

	Обратите внимание, что комплект JDK, доступный в этих образах JDK 6 и 7, а также виртуальные машины и образы, полученные из них, можно использовать только в Azure.

-  **64-разрядный JDK.** Образы виртуальных машин Oracle WebLogic Server и Oracle JDK, предоставляемые Azure, содержат 64-разрядную версию Windows Server и JDK.

##Дополнительные ресурсы
[Образы виртуальных машин Oracle для Azure](virtual-machines-oracle-list-oracle-virtual-machine-images.md)

<!---HONumber=August15_HO6-->