<properties
	pageTitle="Вертикальное масштабирование виртуальной машины Azure c помощью службы автоматизации Azure | Microsoft Azure"
	description="Сведения о вертикальном масштабировании виртуальной машины в ответ на оповещения c помощью службы автоматизации Azure"
	services="virtual-machines"
	documentationCenter=""
	authors="singhkay"
	manager="drewm"
	editor=""
	tags="azure-resource-manager"/>

<tags
	ms.service="virtual-machines"
	ms.workload="infrastructure-services"
	ms.tgt_pltfrm="vm-multiple"
	ms.devlang="na"
	ms.topic="article"
	ms.date="03/29/2016"
	ms.author="singhkay"/>

# Вертикальное масштабирование виртуальной машины Azure c помощью службы автоматизации Azure

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-rm-include.md)]Классическая модель развертывания

Вертикальное масштабирование — это процесс увеличения или уменьшения объема ресурсов виртуальной машины в зависимости от рабочей нагрузки. В Azure это можно сделать, изменив размер виртуальной машины. Вертикальное масштабирование можно использовать в следующих сценариях:

- если виртуальная машина используется редко, вы можете уменьшить ее размер, чтобы сократить ежемесячные затраты;
- если виртуальная машина испытывает пиковые нагрузки, ее размер можно увеличить, чтобы расширить емкость.

Ниже представлены шаги для реализации вертикального масштабирования.

1. Настройка службы автоматизации Azure для доступа к виртуальным машинам.
2. Импорт модулей Runbook службы автоматизации Azure для вертикального масштабирования в подписку.
3. Добавление веб-перехватчика в модуль Runbook.
4. Добавление правила оповещения для виртуальной машины.

> [AZURE.NOTE] Размеры, до которых можно масштабировать виртуальную машину, могут быть ограничены из-за размера первой виртуальной машины ввиду поддерживаемых размеров кластера, в котором развернута текущая виртуальная машина. В этой статье мы учли эту особенность и в опубликованных модулях Runbook службы автоматизации использовали для масштабирования только приведенные ниже примеры размеров виртуальных машин. Это означает, что нельзя внезапно увеличить виртуальную машину размером Standard\_D1v2 до размера Standard\_G5 или уменьшить до Basic\_A0.

>| Пары размеров виртуальных машин, для которых можно применять вертикальное масштабирование | |
|---|---|
| Basic\_A0 | Basic\_A4 |
| Standard\_A0 | Standard\_A4 |
| Standard\_A5 | Standard\_A7 |
| Standard\_A8 | Standard\_A9 |
| Standard\_A10 | Standard\_A11 |
| Standard\_D1 | Standard\_D4 |
| Standard\_D11 | Standard\_D14 |
| Standard\_DS1 | Standard\_DS4 |
| Standard\_DS11 | Standard\_DS14 |
| Standard\_D1v2 | Standard\_D5v2 |
| Standard\_D11v2 | Standard\_D14v2 |
| Standard\_G1 | Standard\_G5 |
| Standard\_GS1 | Standard\_GS5 |

## Настройка службы автоматизации Azure для доступа к виртуальным машинам

В этом разделе мы выполним следующие задачи:

* создадим пользователя в Active Directory;
* создадим действие AutomationPSCredential с использованием данных для входа пользователя;
* настроим параметры доступа пользователя к ресурсам в подписке.

Прежде чем начать выполнение модулей Runbook службы автоматизации Azure, необходимо предоставить ей доступ к подписке. Для этого следует создать другого пользователя в Active Directory. Затем необходимо создать действие AutomationPSCredential, которое позволяет пользователю пройти проверку подлинности в Azure, и выполнить команды PowerShell для изменения размера виртуальной машины.

Пошаговое руководство по созданию пользователя и действия AutomationPSCredential см. в статье

* [Настройка службы автоматизации Azure](../automation/automation-configuring.md)

После создания пользователя необходимо сделать его соадминистратором классических ресурсов и назначить ему роль "Владелец" для ресурсов Azure Resource Manager.

Чтобы пользователь имел доступ к классическим ресурсам, его необходимо добавить в качестве соадминистратора на классическом портале Azure.

![Соадминистратор старого портала](./media/virtual-machines-vertical-scaling-automation/old-portal-automation-user.png)

Необходимо использовать портал Azure, чтобы предоставить пользователю доступ к виртуальным машинам Azure Resource Manager.

![Администратор нового портала](./media/virtual-machines-vertical-scaling-automation/new-portal-automation-user.png)

## Импорт модулей Runbook службы автоматизации Azure для вертикального масштабирования в подписку

Модули Runbook, необходимые для вертикального масштабирования виртуальной машины, уже опубликованы в коллекции Runbook службы автоматизации Azure. Вам потребуется импортировать их в подписку. Дополнительные сведения об импорте модулей Runbook см. в статье:

* [Runbook и коллекции модулей для службы автоматизации Azure](../automation/automation-runbook-gallery.md)

На приведенном ниже рисунке показаны модули Runbook, которые необходимо импортировать.

![Импорт модулей Runbook](./media/virtual-machines-vertical-scaling-automation/scale-runbooks.png)

## Добавление веб-перехватчика в модуль Runbook

После импорта модулей Runbook в них необходимо добавить веб-перехватчик. Этого может потребовать система оповещений виртуальной машины. Дополнительные сведения о создании веб-перехватчика для вашего модуля Runbook см. в статье:

* [Объекты Webhook в службе автоматизации Azure](../automation/automation-webhooks.md)

Прежде чем закрывать диалоговое окно, убедитесь, что вы скопировали веб-перехватчик. Он понадобится в следующем разделе.

## Добавление правила оповещения для виртуальной машины

1. Перейдите в раздел параметров виртуальной машины.
2. Щелкните "Правила оповещения".
3. Щелкните "Добавить оповещение".
4. Выберите метрику, на основе значения которой будут срабатывать оповещения.
5. Выберите условие, при выполнении которого будет срабатывать оповещение.
6. Установите пороговое значение для условия, упомянутого выше.
7. Выберите период для проверки условий и порогового значения, упомянутых выше.
8. Вставьте скопированный веб-перехватчик, описанный в предыдущем разделе.

![Добавить правило оповещения для виртуальной машины 1](./media/virtual-machines-vertical-scaling-automation/add-alert-webhook-1.png)

![Добавить правило оповещения для виртуальной машины 2](./media/virtual-machines-vertical-scaling-automation/add-alert-webhook-2.png)

<!----HONumber=AcomDC_0406_2016-->