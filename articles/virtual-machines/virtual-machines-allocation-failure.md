<properties
	pageTitle="Устранение ошибок выделения ресурсов для виртуальной машины | Microsoft Azure"
	description="Устранение ошибок выделения ресурсов при создании, перезагрузке или изменении размера виртуальной машины в Azure"
	services="virtual-machines, azure-resource-manager"
	documentationCenter=""
	authors="jiangchen79"
	manager="felixwu"
	editor=""
	tags="top-support-issue"/>

<tags
	ms.service="virtual-machines"
	ms.workload="na"
	ms.tgt_pltfrm="ibiza"
	ms.devlang="na"
	ms.topic="article"
	ms.date="10/29/2015"
	ms.author="kenazk"/>



# Устранение ошибок выделения ресурсов при создании, перезагрузке или изменении размера виртуальной машины в Azure

При создании виртуальной машины и изменении ее размера, а также при перезагрузке остановленных (освобожденных) виртуальных машин Microsoft Azure выделяет вычислительные ресурсы для вашей подписки. Иногда во время выполнения этих операций могут возникать ошибки, даже если еще не достигнуты ограничения подписки Azure. В этой статье объясняются причины возникновения некоторых распространенных ошибок выделения, а также представлены возможные способы их устранения. Эта информация также может быть полезна при планировании развертывания служб.

Если в любой момент при изучении этой статьи вам потребуется дополнительная помощь, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](http://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт службы поддержки Azure](http://azure.microsoft.com/support/options/) и нажмите **Поддержка**.

Инструкции по устранению распространенных проблем выделения ресурсов см. в одноименном разделе. Шаги по устранению ошибок на основе соответствующих сообщений см. в разделе "Устранение неполадок в самых распространенных сценариях возникновения ошибок". Прежде чем начать, ознакомьтесь со следующей справочной информацией, чтобы понять, как работает распределение и почему возникают связанные с ним ошибки.

## Справочная информация
### Принцип выделения ресурсов
Серверы в центрах обработки данных Azure разделены на кластеры. Как правило, попытка выполнить запрос на выделение ресурсов происходит в нескольких кластерах. Однако возможен вариант, когда при наличии определенных ограничений в запросах на выделение на платформе Azure произойдет принудительная попытка выполнения запроса только в одном кластере. В этой статье мы будем называть этот процесс прикреплением к кластеру. На схеме 1 ниже показано, как обычно происходит выделение при попытке выполнения в нескольких кластерах. На схеме 2 показано выделение ресурсов, прикрепленное к кластеру 2, так как в нем размещена существующая облачная служба CS\_1 или группа доступности. ![Схема выделения ресурсов](./media/virtual-machines-allocation-failure/Allocation1.png)

### Причины возникновения ошибок выделения ресурсов
Если запрос на выделение прикреплен к одному кластеру, возрастает вероятность того, что не удастся найти свободные ресурсы, так как пул доступных ресурсов имеет меньший размер. Кроме того, если запрос на выделение прикреплен к одному кластеру, а тип запрошенного ресурса не поддерживается, запрос завершится ошибкой, даже если в кластере есть свободные ресурсы. На схеме 3 ниже показан случай, когда ошибка выделения прикрепленных ресурсов произошла из-за отсутствия свободных ресурсов в единственном подходящем кластере. На схеме 4 показан случай, когда ошибка выделения прикрепленных ресурсов произошла потому, что единственный подходящий кластер не поддерживает запрошенный размер виртуальной машины, несмотря на наличие свободных ресурсов в кластере. ![Ошибка выделения прикрепленных ресурсов](./media/virtual-machines-allocation-failure/Allocation2.png)

## Устранение распространенных ошибок выделения ресурсов в классической модели развертывания

Выполнение этих шагов позволяет устранить многие ошибки выделения ресурсов в виртуальных машинах.

- Измените размер виртуальной машины.<br> Последовательно выберите "Просмотреть все" > "Виртуальные машины (классические)" > имя своей виртуальной машины > "Настройки" > **Размер**. Подробные инструкции см. в статье [Перезапуск виртуальной машины](https://msdn.microsoft.com/library/dn168976.aspx).

- Удалите из облачной службы все виртуальные машины и создайте их заново.<br> Последовательно выберите «Просмотреть все» > «Виртуальные машины (классические)» > имя своей виртуальной машины > «Удалить», а затем — «Создать» > «Среда выполнения приложений» > [образ виртуальной машины].

## Устранение распространенных ошибок выделения ресурсов в модели развертывания диспетчера ресурсов

Выполнение этих шагов позволяет устранить многие ошибки выделения ресурсов в виртуальных машинах.

- Остановите или освободите все виртуальные машины в пределах одной группы доступности, а затем перезагрузите каждую из них.<br> Чтобы остановить виртуальную машину, последовательно выберите «Группы ресурсов» > «Ресурсы» > имя своей группы доступности > «Виртуальные машины» > имя своей виртуальной машины > «Остановить».

	После остановки всех виртуальных машин выберите первую из них и щелкните «Запустить».

## Устранение определенных ошибок выделения ресурсов в классической модели развертывания
В этом разделе описаны распространенные сценарии выделения ресурсов, которые приводят к прикреплению запросов на выделение. Каждый сценарий мы более подробно рассмотрим ниже.

- Изменение размера виртуальной машины либо добавление дополнительных виртуальных машин или экземпляров ролей в существующую облачную службу
- Перезагрузка остановленных (освобожденных) виртуальных машин, частичное освобождение
- Перезагрузка остановленных (освобожденных) виртуальных машин, полное освобождение
- Промежуточное и рабочее развертывание (только для платформы как услуги)
- Группа сходства, взаимодействие с виртуальными машинами или службами
- Виртуальная сеть на основе группы сходства

При возникновении ошибки выделения ресурсов проверьте, не соответствует ли ваша ситуация одному из этих сценариев. Используйте ошибку выделения, возвращенную платформой Azure, чтобы определить соответствующий сценарий. Если выполненный запрос прикреплен, попробуйте удалить некоторые ограничения этого прикрепления, чтобы распространить запрос на большее количество кластеров и тем самым повысить вероятность успешного выделения.

Как правило, если в сообщении об ошибке не сказано о том, что запрошенный размер виртуальной машины не поддерживается, можно повторить попытку позже, так как в кластере может быть освобождено достаточно ресурсов, чтобы выполнить запрос. Если проблема заключается в том, что запрошенный размер виртуальной машины не поддерживается, попробуйте установить для нее другой размер. В противном случае единственное решение — удалить ограничение, которое влечет прикрепление.

Два самых распространенных сценария возникновения ошибок связаны с группой сходства. Ранее группа сходства использовалась для обеспечения сильного взаимодействия с экземплярами виртуальных машин или служб либо для создания виртуальной сети. С появлением региональной виртуальной сети группа сходства больше не используется для создания виртуальной сети. Ввиду сокращения задержки в сети инфраструктуры Azure изменились рекомендации по использованию группы сходства для взаимодействия с виртуальными машинами или службами.

На схеме 5 показана таксономия сценариев выделения (прикрепленных) ресурсов. ![Таксономия выделения прикрепленных ресурсов](./media/virtual-machines-allocation-failure/Allocation3.png)

> [AZURE.NOTE]Ошибки, перечисленные в каждом сценарии выделения, приведены в короткой форме. Дополнительную информацию о строках ошибок см. в разделе [Приложение](#appendix).

### Сценарий выделения — изменение размера виртуальной машины либо добавление дополнительных виртуальных машин или экземпляров ролей в существующую облачную службу
**Ошибка**

Upgrade\_VMSizeNotSupported* или GeneralError*

**Причина прикрепления к кластеру**

Попытка выполнить запрос на изменение размера виртуальной машины или ее добавление, а также добавление экземпляра роли в существующую облачную службу должна осуществляться в исходном кластере, в котором размещена существующая облачная служба. Если создать новую облачную службу, платформа Azure сможет найти другой кластер, в котором есть свободные ресурсы или который поддерживает запрошенный размер виртуальных машин.

**Возможное решение**

При возникновении ошибки Upgrade\_VMSizeNotSupported* попробуйте изменить размер виртуальной машины. Если использовать другой размер виртуальной машины нецелесообразно, но допускается использование другого виртуального IP-адреса, создайте облачную службу, где будет размещена новая виртуальная машина, и добавьте новую облачную службу в региональную виртуальную сеть, в которой запущены виртуальные машины. Если существующая облачная служба не использует региональную виртуальную сеть, по-прежнему можно создать виртуальную сеть для новой облачной службы и подключить [существующую виртуальную сеть к новой виртуальной сети](https://azure.microsoft.com/ru-RU/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/). См. дополнительную информацию о [региональной виртуальной сети](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).

Если возникла ошибка GeneralError*, скорее всего, кластер поддерживает этот тип ресурса (например, виртуальные машины определенного размера), но сейчас в нем нет свободных ресурсов. Сходным образом, попробуйте добавить необходимый вычислительный ресурс, создав облачную службу (обратите внимание, что новая облачная служба должна использовать другой виртуальный IP-адрес) и используя региональную виртуальную сеть для подключения к облачным службам.

### Сценарий выделения — перезагрузка остановленных (освобожденных) виртуальных машин, частичное освобождение

**Ошибка**

GeneralError*

**Причина прикрепления к кластеру**

**Частичное** освобождение означает, что в облачной службе остановлена (освобождена) одна или несколько виртуальных машин, но **не все**. При остановке (освобождении) виртуальной машины происходит освобождение связанных с ней ресурсов. Таким образом, перезагрузка остановленной (освобожденной) виртуальной машины предусматривает выполнение нового запроса. Перезагрузка виртуальной машины, принадлежащей к частично освобожденной облачной службе, аналогична добавлению виртуальных машин в существующую облачную службу. Поэтому попытка выполнения запроса на выделение ресурсов должна осуществляться в исходном кластере, в котором размещена существующая облачная служба. Если создать новую облачную службу, платформа Azure сможет найти другой кластер, в котором есть свободные ресурсы или который поддерживает запрошенный размер виртуальной машины.

**Возможное решение**

Если допускается использование различных виртуальных IP-адресов, удалите остановленные (освобожденные) виртуальные машины (но сохраните связанные диски) и добавьте виртуальные машины обратно, используя другую облачную службу. Используйте региональную виртуальную сеть для подключения к облачным службам: 1. Если существующая облачная служба использует региональную виртуальную сеть, просто добавьте новую облачную службу в ту же виртуальную сеть. 2. Если существующая облачная служба не использует региональную виртуальную сеть, создайте виртуальную сеть для новой облачной службы и подключите [существующую виртуальную сеть к новой виртуальной сети](https://azure.microsoft.com/ru-RU/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/). См. дополнительную информацию о [региональной виртуальной сети](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).

### Сценарий выделения — перезагрузка остановленных (освобожденных) виртуальных машин, полное освобождение
**Ошибка**

GeneralError*

**Причина прикрепления к кластеру**

**Полное** освобождение означает, что в облачной службе остановлены (освобождены) **все** виртуальные машины. Сейчас попытки выполнения запросов на выделение ресурсов для перезагрузки этих виртуальных машин должны осуществляться в исходном кластере, в котором размещена облачная служба. Если создать новую облачную службу, платформа Azure сможет найти другой кластер, в котором есть свободные ресурсы или который поддерживает запрошенный размер виртуальных машин.

**Возможное решение**

Если допускается использование другого виртуального IP-адреса, удалите исходные остановленные (освобожденные) виртуальные машины (но сохраните связанные диски) и соответствующие облачные службы (связанные вычислительные ресурсы уже освобождены при остановке (освобождении) виртуальных машин)). Создайте облачную службу для повторного добавления виртуальных машин.

### Сценарий выделения — промежуточное и рабочее развертывание (только для платформы как услуги)
**Ошибка**

New\_General* или New\_VMSizeNotSupported*

**Причина прикрепления к кластеру**

Промежуточное и рабочее развертывания облачной службы размещаются в одном кластере. При добавлении второго развертывания соответствующий запрос на выделение будет выполнен в том же кластере, в котором размещено первое.

**Возможное решение**

Если это допускается, удалите первое развертывание и исходную облачную службу и разверните облачную службу повторно. Выполнив это действие, можно разместить первое развертывание в кластере, в котором достаточно свободных ресурсов для обоих развертываний, или в кластере, который поддерживает запрошенный размер виртуальной машины.

### Сценарий выделения — группа сходства, взаимодействие с виртуальными машинами или службами
**Ошибка**

New\_General* или New\_VMSizeNotSupported*

**Причина прикрепления к кластеру**

Все вычислительные ресурсы, назначенные группе сходства, привязываются к одному кластеру. Попытки выполнения запросов на новые вычислительные ресурсы в этой группе сходства должны осуществляться в том же кластере, в котором размещены существующие ресурсы. Это не зависит от облачной службы, в которой будут созданы новые ресурсы (будь-то новая или существующая).

**Возможное решение**

При отсутствии необходимости не используйте группу сходства. Также можно попробовать сгруппировать вычислительные ресурсы в нескольких таких группах.

### Сценарий выделения — виртуальная сеть на основе группы сходства
**Ошибка**

New\_General* или New\_VMSizeNotSupported*

**Причина прикрепления к кластеру**

Прежде чем объявить региональную виртуальную сеть, необходимо связать виртуальную сеть с группой сходства. После чего к вычислительным ресурсам, помещенным в группу сходства, будут применены ограничения, описанные в разделе «Сценарий выделения — группа сходства, взаимодействие с виртуальными машинами или службами» выше. Иными словами, вычислительные ресурсы будут привязаны к одному кластеру.

**Возможное решение**

Если группа сходства не нужна, создайте региональную виртуальную сеть для новых ресурсов, которые вы собираетесь добавить, а затем [подключите существующую виртуальную сеть к новой виртуальной сети](https://azure.microsoft.com/ru-RU/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/). См. дополнительную информацию о [региональной виртуальной сети](http://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).

Кроме того, можно [перенести виртуальную сеть на основе группы сходства в региональную виртуальную сеть](http://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/), а затем добавить необходимые ресурсы.

## Устранение неполадок в самых распространенных сценариях возникновения ошибок в модели развертывания диспетчера ресурсов Azure
В этом разделе описаны распространенные сценарии выделения ресурсов, которые приводят к прикреплению запросов на выделение. Каждый сценарий мы более подробно рассмотрим ниже.

- Изменение размера виртуальной машины либо добавление дополнительных виртуальных машин или экземпляров ролей в существующую облачную службу
- Перезагрузка остановленных (освобожденных) виртуальных машин, **частичное** освобождение
- Перезагрузка остановленных (освобожденных) виртуальных машин, **полное** освобождение

При возникновении ошибки выделения ресурсов проверьте, не соответствует ли ваша ситуация одному из этих сценариев. Используйте ошибку выделения, возвращенную платформой Azure, чтобы определить соответствующий сценарий. Если выполненный запрос прикреплен к существующему кластеру, попробуйте удалить некоторые ограничения этого прикрепления, чтобы распространить запрос на большее количество кластеров и тем самым повысить вероятность успешного выделения.

Как правило, если в сообщении об ошибке не сказано о том, что запрошенный размер виртуальной машины не поддерживается, можно повторить попытку позже, так как в кластере может быть освобождено достаточно ресурсов, чтобы выполнить запрос. Если проблема заключается в том, что запрошенный размер виртуальной машины не поддерживается, см. способы решения ниже.

### Сценарий выделения — изменение размера виртуальной машины или добавление дополнительных виртуальных машин в существующую группу доступности
**Ошибка**

Upgrade\_VMSizeNotSupported* или GeneralError*

**Причина прикрепления к кластеру**

Попытка выполнить запрос на изменение размера виртуальной машины или ее добавление в существующую группу доступности должна осуществляться в исходном кластере, в котором размещена существующая группа доступности. Если создать новую группу доступности, платформа Azure сможет найти другой кластер, в котором есть свободные ресурсы или который поддерживает запрошенный размер виртуальной машины.

**Возможное решение**

При возникновении ошибки Upgrade\_VMSizeNotSupported* попробуйте изменить размер виртуальной машины. Если использовать другой размер для виртуальной машины нецелесообразно, остановите все виртуальные машины, входящие в эту группу доступности. Это позволит изменить размер виртуальной машины, чтобы выделить ее для кластера, который поддерживает виртуальные машины необходимого размера.

Если возникла ошибка GeneralError*, это означает, что кластер, скорее всего, поддерживает этот тип ресурса (например, виртуальные машины определенного размера), но сейчас в нем нет свободных ресурсов. Если виртуальная машина может быть частью другой группы доступности, создайте новую виртуальную машину в другой группе доступности (в том же регионе). Затем новую виртуальную машину можно добавить в ту же виртуальную сеть.

### Сценарий выделения — перезагрузка остановленных (освобожденных) виртуальных машин, частичное освобождение
**Ошибка**

GeneralError*

**Причина прикрепления к кластеру**

**Частичное** освобождение означает, что в группе доступности остановлена (освобождена) одна или несколько виртуальных машин, но **не все**. При остановке (освобождении) виртуальной машины происходит освобождение связанных с ней ресурсов. Таким образом, перезагрузка остановленной (освобожденной) виртуальной машины предусматривает выполнение нового запроса. Перезагрузка виртуальной машины, принадлежащей к частично освобожденной группе доступности, аналогична добавлению виртуальных машин в существующую группу доступности. Поэтому попытка выполнения запроса на выделение ресурсов должна осуществляться в исходном кластере, в котором размещена существующая группа доступности.

**Возможное решение**

Прежде чем перезагрузить первую машину, попробуйте остановить работу всех виртуальных машин в группе доступности. Это обеспечит выполнение новой попытки выделения и возможность выбора нового кластера с доступной емкостью.

### Сценарий выделения — перезагрузка остановленных (освобожденных) виртуальных машин, полное освобождение
**Ошибка**

GeneralError*

**Причина прикрепления к кластеру**

**Полное** освобождение означает, что в группе доступности остановлены (освобождены) **все** виртуальные машины. Запрос на выделение ресурсов для перезагрузки этих виртуальных машин будет ориентирован на все кластеры, которые поддерживают машины нужного размера.

**Возможное решение**

Попробуйте выбрать другой размер виртуальной машины для выделения или повторите попытку позже.

## Приложение
### Значение строк ошибок
**New\_VMSizeNotSupported***

Нельзя выделить память, требуемую для этого развертывания, в соответствии с указанным размером виртуальной машины (или сочетанием размеров нескольких виртуальных машин) из-за ограничений в запросе на развертывание. Если возможно, попробуйте уменьшить ограничения в отношении привязок к виртуальной сети, выполнить развертывание в размещенной службе, в которой больше нет развертываний, и в другой группе сходства или без использования группы сходства либо выполнить развертывание в другом регионе.

**New\_General***

Произошла ошибка выделения. Не удалось установить соответствие ограничениям в запросе. Запрошенное новое развертывание службы привязано к группе сходства, предназначено для выполнения в виртуальной сети или в этой размещенной службе уже существует развертывание. Любое из этих условий ограничивает новое развертывание использованием определенных ресурсов Azure. Повторите попытку позже или попробуйте уменьшить размер виртуальной машины или количество экземпляров ролей. Кроме того, по возможности удалите вышеупомянутые ограничения или попробуйте выполнить развертывание в другом регионе.

**Upgrade\_VMSizeNotSupported***

Не удалось обновить развертывание. Возможно, запрошенный размер виртуальной машины XXX недоступен в ресурсах, которые поддерживают существующее развертывание. Повторите попытку позже, попробуйте использовать другой размер виртуальной машины или меньше экземпляров ролей либо создать развертывание в пустой размещенной службе с новой группой сходства или без использования привязки к группе сходства.

**GeneralError***

Сервер обнаружил внутреннюю ошибку. Запрос следует выполнить повторно или не удалось выполнить выделение ресурсов для службы.

## Дополнительные ресурсы
### Обращение в службу поддержки клиентов Azure

Если эта статья не помогла решить проблему с Azure, см. форумы Azure на сайтах [MSDN и Stack Overflow](http://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение с проблемой в службу поддержки Azure. Перейдите на [веб-сайт службы поддержки Azure](http://azure.microsoft.com/support/options/) и щелкните "Получить поддержку". Дополнительные сведения об использовании службы поддержки Azure см. в статье [Часто задаваемые вопросы о поддержке Microsoft Azure](http://azure.microsoft.com/support/faq/).

<!---HONumber=Nov15_HO3-->