<properties
 pageTitle="Отправка заданий в кластер на основе пакета HPC в Azure | Microsoft Azure"
 description="Узнайте, как настроить локальный компьютер для отправки заданий в кластер на основе пакета HPC в Azure."
 services="virtual-machines"
 documentationCenter=""
 authors="dlepow"
 manager="timlt"
 editor=""
 tags="azure-resource-manager,azure-service-management"/>
<tags
ms.service="virtual-machines"
 ms.devlang="na"
 ms.topic="article"
 ms.tgt_pltfrm="vm-multiple"
 ms.workload="big-compute"
 ms.date="09/28/2015"
 ms.author="danlep"/>

# Отправка заданий HPC c локального компьютера в кластер на основе пакета HPC в Azure

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-include.md)]В этой статье описывается процесс управления ресурсом, созданным в рамках модели развертывания на основе диспетчера ресурсов, а также классической модели.

Вы узнаете, как настроить локальный клиентский компьютер под управлением Windows для запуска средств отправки заданий HPC, взаимодействующих с кластером на основе пакета HPC в Azure по протоколу HTTPS. В статье представлен простой и гибкий способ отправки заданий в облачный HPC-кластер, при котором для запуска средств отправки заданий пользователям кластера не требуется напрямую подключаться к виртуальной машине головного узла.

![Отправка задания в кластер в Azure][jobsubmit]

## Предварительные требования

* **Головной узел на основе пакета HPC развернут на виртуальной машине Azure**. Вы можете либо развернуть головной узел и кластер с помощью автоматизированных средств, таких как [шаблоны быстрого запуска Azure](https://azure.microsoft.com/ru-RU/documentation/templates/) или [скрипт Azure PowerShell](virtual-machines-hpcpack-cluster-powershell-script.md), либо развернуть кластер в Azure вручную, так же как и локальный кластер. Для выполнения инструкций в этой статье вам потребуется DNS-имя головного узла, а также учетные данные администратора кластера.

    При развертывании головного узла вручную убедитесь, что на виртуальной машине настроена конечная точка HTTPS. Если она не настроена, настройте ее. См. статью [Настройка конечных точек виртуальной машины](virtual-machines-set-up-endpoints.md).

* **Установочный носитель пакета HPC**. Бесплатный установочный пакет для последней версии пакета HPC (HPC 2012 R2) доступен в [Центре загрузки Майкрософт](http://go.microsoft.com/fwlink/?LinkId=328024). Установите ту же версию пакета HPC, что установлена на виртуальной машине головного узла.

* **Клиентский компьютер**. Вам потребуется клиентский компьютер под управлением Windows или Windows Server, который поддерживает запуск клиентских служебных программ для пакета HPC (см. [требования к системе](https://technet.microsoft.com/library/dn535781.aspx)). Если вы не планируете выполнять задачи помимо отправки задачи через веб-портал или REST API для пакета HPC, то можете использовать любой клиентский компьютер.


## Шаг 1. Установка и настройка веб-компонентов на головном узле

Чтобы отправлять задания в кластер через интерфейс REST по протоколу HTTPS, установите и настройте веб-компоненты пакета HPC на головном узле HPC, если они еще не настроены. Сначала установите веб-компоненты, запустив файл установки HpcWebComponents.msi. Затем настройте компоненты, запустив скрипт HPC PowerShell **Set-HPCWebComponents.ps1**.

Подробные инструкции см. в разделе [Установка веб-компонентов пакета Microsoft HPC](http://technet.microsoft.com/library/hh314627.aspx).

>[AZURE.TIP]При создании кластера с помощью автоматизированных средств, например [скрипта развертывания пакета HPC по модели IaaS](virtual-machines-hpcpack-cluster-powershell-script.md), можно установить и настроить веб-компоненты в рамках развертывания.

**Установка веб-компонентов**

1. Подключитесь к виртуальной машине головного узла, используя учетные данные администратора кластера.

2. Запустите файл HpcWebComponents.msi из папки установки пакета HPC на головном узле.

3. Установите веб-компоненты, следуя инструкциям мастера.

**Настройка веб-компонентов**

1. Запустите HPC PowerShell от имени администратора на головном узле.

2. Чтобы изменить каталог на папку со скриптом настройки, выполните следующую команду:

    ```
    cd $env:CCP_HOME\bin
    ```
3. Чтобы настроить интерфейс REST и запустить веб-службу HPC, выполните следующую команду:

    ```
    .\Set-HPCWebComponents.ps1 –Service REST –enable
    ```

4. При появлении соответствующего запроса выберите сертификат, который соответствует открытому DNS-имени головного узла (CN=&lt;*HeadNodeDnsName*&gt;.cloudapp.net).

    >[AZURE.NOTE]Впоследствии нужно будет выбирать этот сертификат для отправки заданий на головной узел с локального компьютера. Не выбирайте и не настраивайте сертификат, который соответствует имени компьютера головного узла в домене Active Directory (например, CN=*MyHPCHeadNode.HpcAzure.local*).

5. Чтобы настроить веб-портал для отправки заданий, введите следующую команду:

    ```
    .\Set-HPCWebComponents.ps1 –Service Portal -enable
    ```
6. После завершения выполнения скрипта остановите и перезапустите службу планировщика заданий HPC, используя следующую команду:

    ```
    net stop hpcscheduler
net start hpcscheduler
    ```

## Шаг 2. Установка клиентских служебных программ для пакета HPC на локальном компьютере

Загрузите совместимую версию файлов установки пакета HPC из [Центра загрузки Майкрософт](http://go.microsoft.com/fwlink/?LinkId=328024) на клиентский компьютер и выберите вариант установки «Клиентские служебные программы для пакета HPC».

Чтобы использовать клиентские средства для пакета HPC для отправки заданий на виртуальную машину головного узла, нужно также экспортировать сертификат с головного узла и установить его на клиентском компьютере. Вам потребуется сертификат в формате CER.

**Экспорт сертификата с головного узла**

1. На головном узле добавьте оснастку «Сертификаты» на консоль управления для учетной записи локального компьютера. Инструкции по добавлению оснастки см. в статье [Добавление оснастки «Сертификаты» в консоль MMC](https://technet.microsoft.com/library/cc754431.aspx).

2. В дереве консоли разверните узел **Сертификаты — локальный компьютер**, затем разверните узел **Личное** и щелкните **Сертификаты**.

3. Найдите сертификат, настроенный для веб-компонентов пакета HPC на [шаге 1 «Установка и настройка веб-компонентов на головном узле»](#step-1:-install-and-configure-the-web-components-on-the-head-node) (например, с именем &lt;*HeadNodeDnsName*&gt;.cloudapp.net).

4. Щелкните сертификат правой кнопкой мыши, выберите пункт **Все задачи**, а затем нажмите кнопку **Экспорт**.

5. В мастере экспорта сертификатов нажмите кнопку **Далее** и убедитесь, что выбран параметр **Нет, не экспортировать закрытый ключ**.

6. Выполните оставшиеся шаги мастера, чтобы экспортировать сертификат X.509 в кодировке DER (файл с расширением CER).


**Импорт сертификата на клиентский компьютер**


1. Скопируйте экспортированный с головного узла сертификат в папку на клиентском компьютере.

2. На клиентском компьютере запустите файл certmgr.msc.

3. В диспетчере сертификатов разверните узел **Сертификаты — текущий пользователь**, разверните узел **Доверенные корневые центры сертификации**, щелкните правой кнопкой мыши пункт **Сертификаты**, выберите **Все задачи** и нажмите кнопку **Импорт**.

4. В мастере импорта сертификатов нажмите кнопку **Далее** и следуйте инструкциям для импорта сертификата, экспортированного с головного узла.



>[AZURE.SECURITY]Вы можете увидеть предупреждение о безопасности, так как центр сертификации на головном узле не распознается клиентским компьютером. Для целей тестирования можно проигнорировать это предупреждение и завершить импорт сертификата.

## Шаг 3. Запуск тестовых заданий в кластере

Чтобы проверить конфигурацию, попробуйте запускать задания для кластера Azure с локального компьютера, на котором выполняются клиентские служебные программы для пакета HPC. Вы можете использовать для отправки заданий в кластер инструменты пользовательского интерфейса или команды командной строки для пакета HPC. Также для отправки заданий можно использовать веб-портал.


**Выполнение команд отправки заданий на клиентском компьютере**


1. Откройте командную строку на клиентском компьютере.

2. Введите тестовую команду. Например, чтобы вывести список всех заданий для кластера, введите следующее:

    ```
    job list /scheduler:https://<HeadNodeDnsName>.cloudapp.net /all
    ```
    >[AZURE.TIP]В качестве URL-адреса планировщика используйте полное DNS-имя головного узла, а не его IP-адрес. Если указать IP-адрес, появится сообщение об ошибке «Сертификат сервера должен либо иметь допустимую цепочку доверия, либо находиться в доверенном корневом хранилище».

3. При появлении соответствующего запроса укажите имя пользователя (в формате &lt;имя\_домена&gt;&lt;имя\_пользователя&gt;) и пароль администратора HPC-кластера или другого настроенного пользователя кластера. Вы можете сохранить учетные данные локально для выполнения других операций с заданиями.

    Появится список заданий.


**Использование диспетчера заданий HPC на клиентском компьютере**

1. Если вы не сохранили доменные учетные данные пользователя кластера на клиентском компьютере при отправке задания, можете добавить их в диспетчере учетных данных.

    а. В панели управления на клиентском компьютере запустите диспетчер учетных данных.

    b. Щелкните **Учетные данные Windows**, а затем нажмите кнопку **Добавить общие учетные данные**.

    c. Укажите веб-адрес https://&lt;*HeadNodeDnsName*&gt;.cloudapp.net/HpcScheduler, имя пользователя (в формате &lt;DomainName&gt;&lt;UserName&gt;) и пароль администратора кластера HPC или другого настроенного пользователя кластера.

2. Запустите диспетчер заданий HPC на клиентском компьютере.

3. В диалоговом окне **Выбор головного узла** введите URL-адрес головного узла в Azure в формате https://&lt;*HeadNodeDnsName*&gt;.cloudapp.net.

    Откроется диспетчер заданий HPC, в котором будут перечислены задания на головном узле.

**Использование веб-портала заданий на головном узле**

1. Запустите веб-браузер на клиентском компьютере и введите следующий адрес: ```
    https://HeadNodeDnsName.cloudapp.net/HpcPortal
    ```
2. В появившемся диалоговом окне введите учетные данные администратора кластера HPC. (Вы также можете добавить пользователей кластера в разных ролях. Дополнительную информацию см. в разделе [Управление пользователями кластера](https://technet.microsoft.com/library/ff919335.aspx).)

    Откроется портал со списком заданий.

3. Чтобы отправить тестовое задание, которое возвращает строку «Hello World» из кластера, щелкните **Создать задание** в панели навигации слева.

4. На странице **Новое задание** в разделе **Со страниц отправки** щелкните **HelloWorld**. Откроется страница отправки задания.

5. Нажмите кнопку **Отправить**. При появлении запроса введите доменные учетные данные администратора кластера HPC. Задание будет отправлено, а идентификатор задания появится на странице **Мои задания**.

6. Чтобы просмотреть результаты отправленного задания, щелкните идентификатор задания и нажмите кнопку **Просмотреть задачи**, чтобы просмотреть результаты выполнения команды (в разделе **Выходные данные**).

## Дальнейшие действия

* Вы также можете отправлять задания в кластер Azure с помощью [интерфейса REST API для пакета HPC](http://social.technet.microsoft.com/wiki/contents/articles/7737.creating-and-submitting-jobs-by-using-the-rest-api-in-microsoft-hpc-pack-windows-hpc-server.aspx).

* Если вы хотите отправлять задания в кластер с клиента Linux, изучите пример на языке Python, описанный в статье [Пакет HPC Pack SDK](https://www.microsoft.com/download/details.aspx?id=47756).


<!--Image references-->
[jobsubmit]: ./media/virtual-machines-hpcpack-cluster-submit-jobs/jobsubmit.png

<!---HONumber=Oct15_HO1-->