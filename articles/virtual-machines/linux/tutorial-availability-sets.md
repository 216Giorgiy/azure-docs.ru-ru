---
title: "Руководство по группам доступности для виртуальных машин Linux в Azure | Документы Майкрософт"
description: "Вы можете узнать о группах доступности для виртуальных машин Linux в Azure."
documentationcenter: 
services: virtual-machines-linux
author: cynthn
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: cynthn
ms.custom: mvc
ms.translationtype: Human Translation
ms.sourcegitcommit: 7948c99b7b60d77a927743c7869d74147634ddbf
ms.openlocfilehash: 927eb9f4f40759c0a79daa6dd3e91e5ab0853520
ms.contentlocale: ru-ru
ms.lasthandoff: 06/20/2017

---

# <a name="how-to-use-availability-sets"></a>Использование групп доступности


В этом руководстве вы узнаете, как повысить доступность и надежность решений виртуальных машин в Azure с помощью групп доступности. При развертывании виртуальных машин в Azure группа доступности распределяет их между несколькими изолированными аппаратными кластерами. Таким образом, в случае сбоя оборудования или программного обеспечения в Azure будет затронуто только подмножество виртуальных машин, а общее решение останется доступным для использования (с точки зрения использующих его клиентов).

Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * "Создать группу доступности"
> * Создание виртуальной машины в группе доступности
> * Проверка доступных размеров виртуальных машин


[!INCLUDE [cloud-shell-try-it.md](../../../includes/cloud-shell-try-it.md)]

Если вы решили установить и использовать интерфейс командной строки локально, то для работы с этим руководством вам понадобится Azure CLI 2.0.4 или более поздней версии. Чтобы узнать версию, выполните команду `az --version`. Если вам необходимо выполнить установку или обновление, см. статью [Установка Azure CLI 2.0]( /cli/azure/install-azure-cli). 

## <a name="availability-set-overview"></a>Обзор групп доступности

Группа доступности — это логическая группа функций, которые можно использовать в Azure, чтобы гарантировать изоляцию ресурсов виртуальной машины во время развертывания в центре обработки данных Azure. Azure гарантирует, что виртуальные машины, размещенные в группе доступности, выполняются на нескольких физических серверах, в вычислительных стойках, в пределах единиц хранения и сетевых коммутаторов. Таким образом, в случае сбоя оборудования или программного обеспечения в Azure будет затронуто только подмножество виртуальных машин, а приложение продолжит работать и останется доступным для клиентов. Группы доступности — это важный элемент при создании надежных облачных решений.

Рассмотрим стандартное решение на основе виртуальной машины, в котором может находиться 4 внешних веб-сервера и использоваться 2 внутренние виртуальные машины, содержащие базу данных. С помощью Azure вы можете определить 2 группы доступности перед развертыванием виртуальных машин: группу доступности для веб-уровня и группу доступности для уровня базы данных. Затем при создании виртуальной машины можно указать группу доступности в качестве параметра для команды az vm create. Azure автоматически изолирует виртуальные машины, созданные в группе доступности, в нескольких ресурсах физического оборудования. Это означает, что если возникла проблема с физическим оборудованием, на котором запущены виртуальные машины сервера базы данных или веб-сервера, то другие экземпляры этих виртуальных машин будут по-прежнему нормально работать, так как они используют другое оборудование.

Если требуется развернуть надежные решения на основе виртуальной машины в Azure, следует всегда использовать группы доступности.


## <a name="create-an-availability-set"></a>"Создать группу доступности"

Вы можете создать группу доступности с помощью команды [az vm availability-set create](/cli/azure/availability-set#create). В этом примере мы задали число доменов обновления и сбоя равным *2* для группы доступности *myAvailabilitySet* в группе ресурсов *myResourceGroupAvailability*.

Создайте группу ресурсов.

```azurecli-interactive 
az group create --name myResourceGroupAvailability --location eastus
```


```azurecli-interactive 
az vm availability-set create \
    --resource-group myResourceGroupAvailability \
    --name myAvailabilitySet \
    --platform-fault-domain-count 2 \
    --platform-update-domain-count 2
```

Группы доступности позволяют изолировать ресурсы в доменах сбоя и обновления. **Домен сбоя** представляет собой изолированную коллекцию ресурсов сервера, службы хранилища и сетевых ресурсов. В приведенном выше примере указано, что группу доступности необходимо распределить по крайней мере между двумя доменами сбоя во время развертывания виртуальных машин. Кроме того, группу доступности необходимо распределить между двумя **доменами обновления**.  Два домена обновления гарантируют, что когда Azure выполняет обновление программного обеспечения, ресурсы виртуальной машины изолированы. Так все базовое программное обеспечение виртуальной машины не будет обновляться одновременно.

## <a name="create-vms-inside-an-availability-set"></a>Создание виртуальных машин в группе доступности

Чтобы виртуальные машины правильно распределялись по оборудованию, их нужно создать внутри группы доступности. Существующую виртуальную машину невозможно добавить в группу доступности после создания. 

При создании виртуальной машины с помощью команды [az vm create](/cli/azure/vm#create) вы указываете группу доступности, задав ее имя с помощью параметра `--availability-set`.

```azurecli-interactive 
for i in `seq 1 2`; do
   az vm create \
     --resource-group myResourceGroupAvailability \
     --name myVM$i \
     --availability-set myAvailabilitySet \
     --size Standard_DS1_v2  \
     --image Canonical:UbuntuServer:14.04.4-LTS:latest \
     --admin-username azureuser \
     --generate-ssh-keys \
     --no-wait
done 
```

Теперь в созданной группе доступности у нас есть две виртуальные машины. Так как они находятся в одной группе доступности, Azure гарантирует распределение виртуальных машин и всех их ресурсов (включая диски данных) в изолированном физическом оборудовании, за счет чего обеспечивается более высокий уровень доступности общего решения виртуальной машины.

При добавлении виртуальных машин может обнаружиться, что определенный размер виртуальной машины больше нельзя использовать в группе доступности. Эта проблема может произойти, если емкости, необходимой при добавлении виртуальной машины в соответствии с правилами изоляции группы доступности, недостаточно. Вы можете узнать, какие размеры виртуальной машины можно использовать в имеющейся группе доступности с помощью параметра `--availability-set list-sizes`.

## <a name="check-for-available-vm-sizes"></a>Знакомство с доступными размерами виртуальной машины 

Позднее вы можете добавить в группу доступности другие виртуальные машины, но следует понимать, какие размеры виртуальных машин доступны на оборудовании. Выполните команду [az vm availability-set list-sizes](/cli/azure/availability-set#list-sizes) для получения списка всех доступных размеров в аппаратном кластере для группы доступности.

```azurecli-interactive 
az vm availability-set list-sizes \
     --resource-group myResourceGroupAvailability \
     --name myAvailabilitySet \
     --output table  
```

## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали, как выполнять такие задачи:

> [!div class="checklist"]
> * "Создать группу доступности"
> * Создание виртуальной машины в группе доступности
> * Проверка доступных размеров виртуальных машин

Перейдите к следующему руководству, чтобы узнать о масштабируемых наборах виртуальных машин.

> [!div class="nextstepaction"]
> [Создание масштабируемого набора виртуальных машин](tutorial-create-vmss.md)


