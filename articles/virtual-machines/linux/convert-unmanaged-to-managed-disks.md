---
title: "Преобразование виртуальной машины Linux в Azure с неуправляемыми дисками для использования управляемых дисков | Документация Майкрософт"
description: "Как преобразовать виртуальную машину с неуправляемыми дисками для использования Управляемых дисков Azure с помощью Azure CLI 2.0."
services: virtual-machines-linux
documentationcenter: 
author: iainfoulds
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 02/09/2017
ms.author: iainfou
translationtype: Human Translation
ms.sourcegitcommit: eeb56316b337c90cc83455be11917674eba898a3
ms.openlocfilehash: 8429ee543d8cf838765ff9e8624390746474ee0d
ms.lasthandoff: 04/03/2017

---

# <a name="how-to-convert-a-linux-vm-from-unmanaged-disks-to-azure-managed-disks"></a>Как преобразовать виртуальную машину Linux с неуправляемыми дисками для использования Управляемых дисков Azure

Если у вас есть виртуальные машины Linux в Azure, которые используют неуправляемые диски в учетных записях хранения, и вы хотите, чтобы они могли использовать преимущества управляемых дисков, то вы можете преобразовать эти виртуальные машины. При этом преобразуются диск операционной системы и все подключенные диски данных. Процесс преобразования требует перезагрузки виртуальной машины, поэтому запланируйте миграцию виртуальных машин на предварительно установленный период обслуживания. Процесс миграции необратим. Обязательно отработайте процесс миграции на тестовой виртуальной машине, прежде чем переходить к миграции в рабочей среде.

> [!IMPORTANT]
> Во время преобразования виртуальная машина освобождается. При запуске после преобразования она получает новый IP-адрес. Если вам важно, чтоб IP-адрес сохранился, следует использовать зарезервированный IP-адрес.

Невозможно преобразовать неуправляемый диск в управляемый, если неуправляемый диск размещен в учетной записи хранения, которая зашифрована или когда-либо шифровалась с помощью [шифрования службы хранилища Azure (SSE)](../../storage/storage-service-encryption.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). Ниже приведены инструкции по преобразованию неуправляемых дисков, которые находятся или находились в зашифрованной учетной записи хранения.

- Выполните команду [az storage blob copy start](/cli/azure/storage/blob/copy#start), чтобы скопировать виртуальный жесткий диск в учетную запись хранения, для которой никогда не использовалось шифрование службы хранилища Azure.
- Создайте виртуальную машину, которая использует управляемые диски, и в процессе создания укажите этот VHD-файл с помощью команды [az vm create](/cli/azure/vm#create).
- Можно также с помощью команды [az vm disk attach](/cli/azure/vm/disk#attach) подключить этот VHD-файл к работающей виртуальной машине, использующей управляемые диски.

## <a name="convert-vm-to-azure-managed-disks"></a>Преобразование виртуальной машины для использования Управляемых дисков Azure
В этом разделе описывается, как преобразовать имеющиеся виртуальные машины Azure с неуправляемыми дисками, чтобы они могли использовать управляемые диски. Этот процесс позволяет перейти с неуправляемых дисков уровня "Премиум" (SSD) на управляемые диски уровня "Премиум", или с неуправляемых дисков уровня "Стандартный" (жесткие диски) на управляемые диски уровня "Стандартный".

> [!IMPORTANT]
> После выполнения следующей процедуры создается один блочный BLOB-объект, размещенный в контейнере по умолчанию vhds. Имя файла — <имя_ВМ>.xxxxxxx.status. Не удаляйте этот оставшийся объект состояния. В дальнейшем эта проблема будет устранена.

1. Освободите виртуальную машину командой [az vm deallocate](/cli/azure/vm#deallocate). В следующем примере освобождается виртуальная машина `myVM`, входящая в группу ресурсов `myResourceGroup`.

    ```azurecli
    az vm deallocate --resource-group myResourceGroup --name myVM
    ```

2. Преобразуйте виртуальную машину для использования управляемых дисков, выполнив команду [az vm convert](/cli/azure/vm#convert). Приведенный ниже процесс преобразовывает виртуальную машину `myVM`, включая ее диск ОС и все диски данных.

    ```azurecli
    az vm convert --resource-group myResourceGroup --name myVM
    ```

3. После преобразования запустите виртуальную машину командой [az vm start](/cli/azure/vm#start). В следующем примере запускается виртуальная машина `myVM` в группе ресурсов `myResourceGroup`.

    ```azurecli
    az vm start --resource-group myResourceGroup --name myVM
    ```

## <a name="convert-vm-in-an-availability-set-to-managed-disks"></a>Преобразование виртуальной машины в группе доступности для использования управляемых дисков

Если виртуальные машины, которые вы хотите преобразовать для использования управляемых дисков, входят в группу доступности, то необходимо сначала преобразовать эту группу доступности в управляемую группу доступности.

Перед преобразованием группы доступности нужно освободить все виртуальные машины в этой группе. Запланируйте преобразование всех виртуальных машин для использования управляемых дисков после того, как содержащая их группа доступности будет преобразована в управляемую группу доступности. После этого можно будет запустить все виртуальные машины и продолжить работу в обычном режиме.

1. Выведите список всех виртуальных машин в группе доступности, выполнив команду [az vm availability-set list](/cli/azure/vm/availability-set#list). В следующем примере выводится список виртуальных машин в группе доступности `myAvailabilitySet` в группе ресурсов `myResourceGroup`.

    ```azurecli
    az vm availability-set show --resource-group myResourceGroup \
        --name myAvailabilitySet --query [virtualMachines[*].id] --output table
    ```

2. Освободите все виртуальные машины командой [az vm deallocate](/cli/azure/vm#deallocate). В следующем примере освобождается виртуальная машина `myVM`, входящая в группу ресурсов `myResourceGroup`.

    ```azurecli
    az vm deallocate --resource-group myResourceGroup --name myVM
    ```

3. Преобразуйте группу доступности с помощью команды [az vm availability-set convert](/cli/azure/vm/availability-set#convert). В следующем примере преобразовывается группа доступности `myAvailabilitySet` в группе ресурсов `myResourceGroup`.

    ```azurecli
    az vm availability-set convert --resource-group myResourceGroup \
        --name myAvailabilitySet
    ```

4. Преобразуйте все виртуальные машины для использования управляемых дисков с помощью команды [az vm convert](/cli/azure/vm#convert). Приведенный ниже процесс преобразовывает виртуальную машину `myVM`, включая ее диск ОС и все диски данных.

    ```azurecli
    az vm convert --resource-group myResourceGroup --name myVM
    ```

5. После преобразования запустите все виртуальные машины с помощью команды [az vm start](/cli/azure/vm#start). В следующем примере запускается виртуальная машина `myVM` в группе ресурсов `myResourceGroup`.

    ```azurecli
    az vm start --resource-group myResourceGroup --name myVM
    ```

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о возможностях хранения данных доступны в [обзоре Управляемых дисков Azure](../../storage/storage-managed-disks-overview.md).

