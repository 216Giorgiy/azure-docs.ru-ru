---
title: Последовательная консоль виртуальной машины Azure | Документация Майкрософт
description: Двунаправленная последовательная консоль виртуальных машин Azure.
services: virtual-machines-linux
documentationcenter: ''
author: harijay
manager: jeconnoc
editor: ''
tags: azure-resource-manager
ms.service: virtual-machines-linux
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 03/05/2018
ms.author: harijay
ms.openlocfilehash: 00a776131321500386b507f45ea84817b08147f7
ms.sourcegitcommit: ab3b2482704758ed13cccafcf24345e833ceaff3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/06/2018
ms.locfileid: "37867867"
---
# <a name="virtual-machine-serial-console-preview"></a>Последовательная консоль виртуальной машины (предварительная версия) 


Последовательная консоль виртуальных машин в Azure предоставляет доступ к текстовой консоли для виртуальных машин Linux и Windows. Это последовательное подключение к виртуальной машине происходит через последовательный порт COM1 и открывает доступ к виртуальной машине вне зависимости от состояния, в котором находится сеть или операционная система виртуальной машины. Получить доступ к последовательной консоли для виртуальной машины сейчас можно только на портале Azure. Он предоставляется только тем пользователям, у которых есть права участника виртуальной машины или выше на доступ к виртуальной машине. 

> [!Note] 
> Предварительные версии предоставляются при условии, что вы соглашаетесь с условиями использования. Дополнительные сведения см. в статье [Дополнительные условия использования Предварительных выпусков Microsoft Azure.] (https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Сейчас эта служба находится на этапе **общедоступной предварительной версии** и доступ к последовательной консоли для виртуальных машин предоставляется в глобальных регионах Azure. На этом этапе в последовательной консоли недоступно облако Azure для государственных организаций, Azure для Германии или Azure для Китая.


## <a name="prerequisites"></a>предварительным требованиям 

* Требуется использовать модель развертывания управления ресурсами. Классические развертывания не поддерживаются. 
* На виртуальной машине ДОЛЖНА быть включена [диагностика загрузки](boot-diagnostics.md). 
* Учетной записи, использующей последовательную консоль, должна быть присвоена [роль участника](../../role-based-access-control/built-in-roles.md) для виртуальной машины и учетная запись хранения [диагностики загрузки](boot-diagnostics.md). 
* Сведения о параметрах, относящихся к дистрибутиву Linux, см. в разделе [Доступ к последовательной консоли для Linux](#accessing-serial-console-for-linux).


## <a name="open-the-serial-console"></a>Открытие последовательной консоли
Получить доступ к последовательной консоли для виртуальной машины можно только на [портале Azure](https://portal.azure.com). Ниже приведены шаги для получения доступа к последовательной консоли для виртуальных машин на портале. 

  1. Откройте портал Azure.
  2. В меню слева выберите виртуальные машины.
  3. Щелкните виртуальную машину в списке. Откроется страница обзора для виртуальной машины.
  4. Прокрутите вниз до раздела Support + Troubleshooting (Поддержка + Устранение неполадок) и щелкните параметр последовательной консоли (предварительная версия). Откроется новая область с последовательной консолью, и запустится подключение.

![](../media/virtual-machines-serial-console/virtual-machine-linux-serial-console-connect.gif)


> [!NOTE] 
> Для последовательной консоли требуется локальный пользователь с настроенным паролем. Сейчас на виртуальных машинах, настроенных только с помощью открытого ключа SSH, доступа к последовательной консоли нет. Чтобы создать локального пользователя с паролем, следуйте указаниям, приведенным в статье [Управление пользователями с правами администратора, SSH и проверка или восстановление дисков на виртуальных машинах Linux с помощью расширения VMAccess и Azure CLI 2.0](https://docs.microsoft.com/azure/virtual-machines/linux/using-vmaccess-extension), и создайте локального пользователя с паролем.

### <a name="disable-feature"></a>Функция отключения
Функции последовательной консоли можно отключить для конкретных виртуальных машин, отключив параметр диагностики загрузки этой виртуальной машины.

## <a name="serial-console-security"></a>Безопасность последовательной консоли 

### <a name="access-security"></a>Безопасность доступа 
Доступ к последовательной консоли ограничен кругом пользователей, обладающих на виртуальной машине правами [Участник](../../role-based-access-control/built-in-roles.md#virtual-machine-contributor) или более широкими полномочиями доступа к ней. Если клиентам AAD нужна многофакторная идентификация, тогда она потребуется и для доступа к последовательной консоли, так как доступ осуществляется через [портал Azure](https://portal.azure.com).

### <a name="channel-security"></a>Безопасность канала
Все данные, исходящие и поступающие, при пересылке по сети зашифрованы.

### <a name="audit-logs"></a>Журналы аудита
Все сведения о доступе к последовательной консоли записываются в журналы [диагностики загрузки](https://docs.microsoft.com/azure/virtual-machines/linux/boot-diagnostics) на виртуальной машине. Права доступа к этим журналам и на работу с ними принадлежат администратору виртуальной машины Azure.  

>[!CAUTION] 
Так как пароли доступа для консоли не записываются в журнал, если команды, выполняемые в консоли, содержат или выводят пароли, секреты, имена пользователей и любые другие формы персональных данных, они должны записываться в журналы диагностики загрузки виртуальной машины вместе с остальными элементами с видимым текстом. Это является частью реализации функциональности последовательной консоли. Эти журналы являются циклическими, и только пользователи с разрешениями на чтение для учетной записи хранения диагностики имеют к ним доступ. Но мы рекомендуем следовать рекомендации использования консоли SSH для всего, что может содержать секретные или персональные данные. 

### <a name="concurrent-usage"></a>Одновременное использование
Когда один пользователь подключен к последовательной консоли, а другой пользователь успешно запрашивает доступ к этой же виртуальной машине, первый пользователь будет отключен, а второй пользователь будет подключаться таким способом, как будто первый пользователь вышел из физической консоли, а новый пользователь остался.

>[!CAUTION] 
Это означает, что отключенный пользователь не выходит из системы! Возможность принудительного выхода из системы после отключения (с помощью SIGHUP или похожего механизма) по-прежнему планируется. Для Windows включено автоматическое истечение времени ожидания в SAC, а для Linux можно настроить параметр времени ожидания терминала. Для этого просто добавьте `export TMOUT=600` в .bash_profile или .profile для пользователя, с помощью которого выполняется вход в консоль, чтобы время ожидания сеанса истекло через 10 минут.

### <a name="disable-feature"></a>Функция отключения
Функции последовательной консоли можно отключить для конкретных виртуальных машин, отключив параметр диагностики загрузки этой виртуальной машины.

## <a name="common-scenarios-for-accessing-serial-console"></a>Общие сценарии для доступа к последовательной консоли 
Сценарий          | Действия в последовательной консоли                |  Применимость ОС 
:------------------|:-----------------------------------------|:------------------
Недопустимый FSTAB-файл | Введите ключ, чтобы продолжить и исправить FSTAB-файл в текстовом редакторе. Ознакомьтесь со статьей [Azure Linux VM cannot start because of FSTAB errors](https://support.microsoft.com/help/3206699/azure-linux-vm-cannot-start-because-of-fstab-errors) (Виртуальная машина Linux Azure не запускается из-за ошибок FSTAB) | Linux 
Неверные правила брандмауэра | Откройте последовательную консоль и исправьте iptables или правила брандмауэра Windows | Linux/Windows 
Проверка файловой системы на случай повреждения | Откройте последовательную консоль и восстановите файловую систему | Linux/Windows 
Проблемы конфигурации SSH/RDP | Откройте последовательную консоль и измените параметры | Linux/Windows 
Сеть блокирует работу системы| Получите доступ к последовательной консоли через портал, чтобы управлять системой | Linux/Windows 
Взаимодействие с загрузчиком | Получите доступ к GRUB/BCD через последовательную консоль | Linux/Windows 

## <a name="accessing-serial-console-for-linux"></a>Доступ к последовательной консоли для Linux
Для правильной работы последовательной консоли гостевая операционная система должна быть настроена для чтения и записи сообщений консоли в последовательный порт. В большинстве [рекомендуемых дистрибутивов Linux Azure](https://docs.microsoft.com/azure/virtual-machines/linux/endorsed-distros) последовательная консоль настроена по умолчанию. Чтобы получить доступ к консоли, достаточно просто щелкнуть на портале в разделе последовательной консоли. 

### <a name="access-for-red-hat"></a>Доступ для Red Hat 
В образах Red Hat, доступных в Azure, доступ к консоли включен по умолчанию. В однопользовательском режиме в RedHat требуется, чтобы был включен привилегированный пользователь, который отключен по умолчанию. Если требуется включить однопользовательский режим, используйте следующие инструкции:

1. Войдите в систему RedHat через SSH.
2. Включите пароль для привилегированного пользователя. 
 * `passwd root` (установите надежный пароль привилегированного пользователя).
3. Убедитесь, что привилегированный пользователь может войти только через ttyS0.
 * `edit /etc/ssh/sshd_config` и убедитесь, что для параметра PermitRootLog задано значение "Нет".
 * `edit /etc/securetty file`, чтобы разрешить вход только через ttyS0. 

Теперь, когда система переходит в однопользовательский режим, вы можете войти в систему, используя пароль привилегированного пользователя.

В качестве альтернативы для RHEL 7.4+ или 6.9+ можно включить однопользовательский режим в запросах GRUB. Ознакомьтесь с инструкциями [здесь](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/5/html/installation_guide/s1-rescuemode-booting-single).

### <a name="access-for-ubuntu"></a>Доступ для Ubuntu 
В образах Ubuntu, доступных в Azure, доступ к консоли включен по умолчанию. При переходе системы в однопользовательский режим доступ к консоли может осуществляться без дополнительных учетных данных. 

### <a name="access-for-coreos"></a>Доступ для CoreOS
В образах CoreOS, доступных в Azure, доступ к консоли включен по умолчанию. Если необходимо, систему можно перевести в однопользовательский режим путем изменения параметров GRUB, а добавление `coreos.autologin=ttyS0` позволит пользователю CoreOS войти в последовательную консоль. 

### <a name="access-for-suse"></a>Доступ для SUSE
В образах SLES, доступных в Azure, доступ к консоли включен по умолчанию. При использовании более старых версий SLES в Azure следуйте указаниям в [статье базы знаний](https://www.novell.com/support/kb/doc.php?id=3456486), чтобы включить последовательную консоль. Более новые образы SLES 12 SP3+ также предоставляют доступ через последовательную консоль в случае, если система переходит в аварийный режим.

### <a name="access-for-centos"></a>Доступ для CentOS
В образах CentOS, доступных в Azure, доступ к консоли включен по умолчанию. Чтобы перейти в однопользовательский режим, следуйте инструкциям, приведенным для образов RedHat выше. 

### <a name="access-for-oracle-linux"></a>Доступ для Oracle Linux
В образах Oracle Linux, доступных в Azure, доступ к консоли включен по умолчанию. Чтобы перейти в однопользовательский режим, следуйте инструкциям, приведенным для образов RedHat выше.

### <a name="access-for-custom-linux-image"></a>Доступ для настраиваемого образа Linux
Чтобы включить последовательную консоль для настраиваемого образа виртуальной машины Linux, включите доступ к консоли в /etc/inittab для запуска терминала на ttyS0. Ниже приведен пример добавления в файл inittab 

`S0:12345:respawn:/sbin/agetty -L 115200 console vt102` 

## <a name="errors"></a>Errors
Большинство ошибок носят временный характер и устраняются после повторной попытки подключения. В таблице ниже приведен список ошибок и способы устранения неисправностей. 

Ошибка                            |   Устранение 
:---------------------------------|:--------------------------------------------|
Не удалось получить параметры диагностики загрузки для "<VMNAME>". Чтобы использовать последовательную консоль, включите диагностику загрузки для этой виртуальной машины. | Включите [диагностику загрузки](boot-diagnostics.md) для виртуальной машины. 
Виртуальная машина находится в состоянии "Остановлено (освобождено)". Запустите виртуальную машину и повторите попытку подключения к последовательной консоли. | Для доступа к последовательной консоли виртуальная машина должна быть в состоянии "Запущено".
У вас нет нужных разрешений для использования последовательной консоли этой виртуальной машины. Убедитесь в наличии по крайней мере разрешений роли участника виртуальной машины.| Для доступа к последовательной консоли требуются определенные разрешения. Подробные сведения см. в разделе [требований доступа](#prerequisites).
Не удалось определить группу ресурсов для учетной записи хранения диагностики загрузки "<STORAGEACCOUNTNAME>". Убедитесь, что для этой виртуальной машины включена диагностика загрузки и у вас есть доступ к этой учетной записи хранения. | Для доступа к последовательной консоли требуются определенные разрешения. Подробные сведения см. в разделе [требований доступа](#prerequisites).

## <a name="known-issues"></a>Известные проблемы 
Так как доступ к последовательной консоли по-прежнему находится на этапе предварительной версии, мы работаем над некоторыми известными проблемами. Ниже приведен список этих возможных решений. 

Проблема                           |   Устранение 
:---------------------------------|:--------------------------------------------|
Невозможно получить доступ к последовательной консоли экземпляра масштабируемого набора виртуальных машин |  На этапе предварительной версии доступ к последовательной консоли для экземпляров масштабируемого набора виртуальных машин не поддерживается.
Нажатие клавиши ВВОД после заголовка соединения не отображает запрос на вход | [Нажатие клавиши ВВОД не приводит ни к каким результатам](https://github.com/Microsoft/azserialconsole/blob/master/Known_Issues/Hitting_enter_does_nothing.md)


## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы 
**В. Как отправить отзыв?**

О. Чтобы отправить отзыв как ошибку, перейдите на страницу https://aka.ms/serialconsolefeedback. Кроме того, (менее предпочтительно) отправьте отзыв по адресу azserialhelp@microsoft.com или в категории виртуальной машины на сайте http://feedback.azure.com.

**В. Появляется сообщение об ошибке Existing console has conflicting OS type "Windows" with the requested OS type of Linux (В имеющейся консоли есть тип ОС Windows, конфликтующий с запрошенным типом ОС Linux).**

О. Это известная проблема. Чтобы ее исправить, просто откройте [Azure Cloud Shell](https://docs.microsoft.com/azure/cloud-shell/overview) в режиме bash и повторите попытку.

**В. Я не могу получить доступ к последовательной консоли. Где можно отправить запрос в службу поддержки?**

О. Эта функция предварительной версии рассматривается в условиях предварительной версии Azure. Соответствующая поддержка эффективнее всего предоставляется через вышеупомянутые каналы. 

## <a name="next-steps"></a>Дополнительная информация
* Версия последовательной консоли также доступна для виртуальных машин [Windows](../windows/serial-console.md)
* Узнайте больше о [диагностике загрузки](boot-diagnostics.md).