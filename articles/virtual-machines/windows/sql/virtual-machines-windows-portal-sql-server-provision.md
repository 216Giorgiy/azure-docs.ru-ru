---
title: "Подготовка виртуальной машины SQL Server | Документация Майкрософт"
description: "Создание виртуальной машины SQL Server и подключение к ней с помощью портала Azure. В этом руководстве используется модель Resource Manager."
services: virtual-machines-windows
documentationcenter: na
author: rothja
manager: jhubbard
tags: azure-resource-manager
ms.assetid: 1aff691f-a40a-4de2-b6a0-def1384e086e
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: hero-article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: infrastructure-services
ms.date: 08/14/2017
ms.author: jroth
ms.translationtype: HT
ms.sourcegitcommit: b309108b4edaf5d1b198393aa44f55fc6aca231e
ms.openlocfilehash: c923f9aae4c7a1b8bd4f5760d0ec4f33923b9321
ms.contentlocale: ru-ru
ms.lasthandoff: 08/15/2017

---
# <a name="provision-a-sql-server-virtual-machine-in-the-azure-portal"></a>Подготовка виртуальной машины SQL Server на портале Azure
> [!div class="op_single_selector"]
> * [Портал](virtual-machines-windows-portal-sql-server-provision.md)
> * [PowerShell](virtual-machines-windows-ps-sql-create.md)
> 
> 

В этом комплексном руководстве показано, как подготовить виртуальную машину SQL Server на портале Azure.

Коллекция виртуальных машин (VM) в Azure включает в себя несколько образов, содержащих Microsoft SQL Server. Всего за несколько действий вы можете выбрать один из образов виртуальной машины SQL из коллекции и подготовить ее в среде Azure.

Изучив данный учебник, вы научитесь:

* [выбирать образ виртуальной машины из коллекции;](#select-a-sql-vm-image-from-the-gallery)
* [настраивать и создавать виртуальные машины;](#configure-the-vm)
* [открывать виртуальные машины с помощью удаленного рабочего стола;](#open-the-vm-with-remote-desktop)
* [удаленно подключаться к SQL Server;](#connect-to-sql-server-remotely)

## <a name="select-a-sql-vm-image-from-the-gallery"></a>выбирать образ виртуальной машины из коллекции;

1. Войдите на [портал Azure](https://portal.azure.com) , используя свою учетную запись.

   > [!NOTE]
   > Если у вас нет учетной записи Azure, используйте [бесплатную пробную версию Azure](https://azure.microsoft.com/pricing/free-trial/).

2. На портале Azure нажмите кнопку **Создать**. На портале откроется окно **Создать** .

3. В окне **Создать** щелкните **Вычисления** и выберите **See all** (Показать все).

   ![Окно "Новое вычисление"](./media/virtual-machines-windows-portal-sql-server-provision/azure-new-compute-blade.png)

4. В поле поиска введите **SQL Server** и нажмите клавишу ВВОД.

5. Щелкните значок **Фильтр** и выберите **Майкрософт** в качестве издателя. Щелкните **Готово** в окне фильтра, чтобы отфильтровать результаты и отобразить только образы SQL Server, опубликованные корпорацией Майкрософт.

   ![Окно "Виртуальные машины Azure"](./media/virtual-machines-windows-portal-sql-server-provision/azure-compute-blade2.png)

5. Просмотрите доступные образы SQL Server. Каждый образ определяет версию SQL Server и операционную систему.

6. Выберите образ с именем **Free License: SQL Server 2016 SP1 Developer on Windows Server 2016**.

   > [!TIP]
   > В этом руководстве используется выпуск Developer, так как это полнофункциональный выпуск SQL Server, предоставляемый бесплатно для тестирования в процессе разработки. Вы оплачиваете только стоимость выполнения виртуальной машины. Но вы можете выбрать для использования в этом руководстве любой образ.

   > [!TIP]
   > В поминутную тарификацию использования виртуальных машин SQL, создаваемых из образов, включена стоимость лицензий на SQL Server (за исключением выпусков Developer и Express). Выпуск SQL Server Developer предоставляется бесплатно для разработки и тестирования (не для рабочей среды), а выпуск SQL Express предоставляется бесплатно для упрощенных рабочих нагрузок (требующих менее 1 ГБ памяти и 10 ГБ хранилища). Есть еще один вариант — использовать собственную лицензию (BYOL) и платить только за виртуальную машину. Имена таких образов содержат префикс {BYOL}. 
   >
   > Дополнительные сведения об этих параметрах см. в [руководстве по выбору ценовой категории для виртуальных машин Azure SQL Server](virtual-machines-windows-sql-server-pricing-guidance.md).

7. В разделе **Выбор модели развертывания** выберите **Resource Manager**. Для новых виртуальных машин рекомендуется использовать модель развертывания Resource Manager. 

8. Щелкните **Создать**.

    ![Создание виртуальной машины SQL с помощью Resource Manager](./media/virtual-machines-windows-portal-sql-server-provision/azure-compute-sql-deployment-model.png)

## <a name="configure-the-vm"></a>Настройка виртуальной машины
Есть пять окон для настройки виртуальной машины SQL Server.

| Шаг | Описание |
| --- | --- |
| **Основы** |[Настройка основных параметров](#1-configure-basic-settings) |
| **Размер** |[Выбор размера виртуальной машины](#2-choose-virtual-machine-size) |
| **Параметры** |[Настройка дополнительных возможностей](#3-configure-optional-features) |
| **Параметры SQL Server** |[Настройка параметров SQL Server](#4-configure-sql-server-settings) |
| **Сводка** |[Просмотр сводки.](#5-review-the-summary) |

## <a name="1-configure-basic-settings"></a>1. Настройка основных параметров.

В окне **Основные сведения** укажите следующую информацию:

* Введите уникальное **имя**виртуальной машины.

* Для оптимальной производительности выберите **SSD** в качестве типа диска виртуальной машины.

* Укажите **имя пользователя** для учетной записи локального администратора виртуальной машины. Эта учетная запись также добавляется к фиксированной серверной роли **sysadmin** SQL Server.

* Введите надежный **пароль**.

* Если у вас несколько подписок, проверьте, правильно ли выбрана подписка для новой виртуальной машины.

* В поле **Группа ресурсов** введите имя новой группы ресурсов. Кроме того, можно использовать существующую группу ресурсов, щелкнув параметр **Использовать существующую**. Группа ресурсов — это коллекция связанных ресурсов в Azure (виртуальные машины, учетные записи хранения, виртуальные сети и т. д.).

  > [!NOTE]
  > Рекомендуется использовать новую группу ресурсов для тестирования или изучения процесса развертывания SQL Server в Azure. После завершения теста удалите группу ресурсов, чтобы автоматически удалить виртуальную машину и все ресурсы, связанные с этой группой ресурсов. Дополнительные сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../../../azure-resource-manager/resource-group-overview.md).

* Выберите **расположение** региона Azure, где будет размещаться это развертывание.

* Нажмите кнопку **ОК**, чтобы сохранить настройки.

    ![Окно "Общие сведения об SQL"](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-basic.png)

## <a name="2-choose-virtual-machine-size"></a>2) Выбор размера виртуальной машины.

Чтобы изменить **размер** виртуальной машины, выберите нужное значение в окне **Выбор размера**. В окне изначально отображаются рекомендуемые размеры виртуальных машин в зависимости от выбранного образа.

> [!IMPORTANT]
> В расчетную ежемесячную стоимость, указанную в окне **Выбор размера**, не включена стоимость лицензирования SQL Server. Это только стоимость виртуальной машины. Для выпусков SQL Server Express и Developer указана итоговая расчетная стоимость. Получить сведения о других выпусках можно на странице [цен на виртуальные машины Windows](https://azure.microsoft.com/pricing/details/virtual-machines/windows/), где вы можете выбрать целевой выпуск SQL Server. См. также [руководство по выбору ценовой категории для виртуальных машин Azure SQL Server](virtual-machines-windows-sql-server-pricing-guidance.md).

![Варианты размеров виртуальной машины SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-vm-choose-a-size.png)

Для рабочих нагрузок изучите рекомендации по размерам машин SQL Server и их настройке в статье [Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-performance.md). Если в списке нет нужного вам размера машины, нажмите кнопку **Просмотреть все**.

> [!NOTE]
> Дополнительную информацию о размерах виртуальных машин см. в статье [Размеры виртуальных машин](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).

Укажите размер машины и нажмите кнопку **Выбрать**.

## <a name="3-configure-optional-features"></a>3. Настройка дополнительных возможностей

В окне **Параметры** настройте для виртуальной машины параметры службы хранилища Azure, сети и мониторинга.

* В разделе **Хранилище** выберите **Да** возле параметра "Использование **управляемых дисков**".

   > [!NOTE]
   > Корпорация Майкрософт рекомендует использовать управляемые диски для SQL Server. Управляемые диски управляют хранилищем в фоновом режиме. Кроме того, когда виртуальные машины с управляемыми дисками находятся в одной группе доступности, Azure распределяет ресурсы хранения, чтобы обеспечить соответствующую избыточность. Дополнительные сведения см. в [обзоре управляемых дисков Azure](../../../storage/storage-managed-disks-overview.md). Подробные сведения об управляемых дисках в группе доступности см. в статье [Управление доступностью виртуальных машин Windows в Azure](../manage-availability.md).

* В разделе **Сеть**вы можете принять автоматически заполненные значения. Можно также щелкнуть каждый компонент, чтобы вручную настроить **виртуальную сеть**, **подсеть**, **общедоступный IP-адрес** и **группу безопасности сети**. В рамках этого руководства можно использовать значения по умолчанию.

* Azure по умолчанию включает **мониторинг** в учетной записи хранения, которая будет использоваться для виртуальной машины. Эти параметры можно изменить.

* Выполняя инструкции из этого руководства, в разделе **Группа доступности** можно оставить значение по умолчанию (**Нет**). Если вы планируете настроить группы доступности AlwaysOn SQL, настройте доступность, чтобы не создавать виртуальную машину повторно.  Дополнительные сведения см. в статье [Управление доступностью виртуальных машин](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).

Завершив настройку параметров, нажмите кнопку **OК**.

## <a name="4-configure-sql-server-settings"></a>4. Настройка параметров SQL Server
В окне **Настройки SQL Server** укажите нужные параметры и настройте оптимизацию для SQL Server. Для SQL Server можно настроить следующие параметры:

| Настройка |
| --- |
| [Соединение](#connectivity) |
| [Аутентификация](#authentication) |
| [Конфигурация хранилища](#storage-configuration) |
| [Автоматическое исправление](#automated-patching) |
| [Автоматическая архивация](#automated-backup) |
| [Интеграция с хранилищем ключей Azure](#azure-key-vault-integration) |
| [Службы R](#r-services) |

### <a name="connectivity"></a>Соединение

В разделе **Подключение SQL**укажите необходимый тип доступа к экземпляру SQL Server на этой виртуальной машине. В рамках этого руководства выберите пункт **Общедоступное (в Интернете)** для подключения к SQL Server с компьютеров или из служб в Интернете. Если этот параметр выбран, Azure автоматически настраивает брандмауэр и группу безопасности сети, чтобы разрешить трафик через порт 1433.

![Варианты подключений SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-connectivity-alt.png)

> [!TIP]
> По умолчанию сервер SQL Server ожидает передачи данных через стандартный порт **1433**. Для повышения безопасности измените порт в предыдущем диалоговом окне, чтобы ожидать передачи данных через нестандартный порт, например 1401. После этого необходимо выполнить подключение, используя этот порт, с любого клиентского средства, например SSMS.

Чтобы подключиться к SQL Server через Интернет, также необходимо включить проверку подлинности SQL Server, как описано в следующем разделе.

Если вы не хотите включать подключения к ядру СУБД через Интернет, выберите один из следующих вариантов:

* **Локальное (только в виртуальной машине)** — для подключения к SQL Server только в пределах самой виртуальной машины.
* **Частное (в виртуальной сети)** — для подключения к SQL Server с машин или из служб в той же виртуальной сети.

Как правило, чтобы повысить уровень безопасности, необходимо выбрать наиболее подходящий тип подключения для выполнения вашего сценария. Но все параметры можно защитить с помощью правил группы безопасности сети и проверки подлинности Windows или SQL. Вы можете изменить группу безопасности сети после создания виртуальной машины. Дополнительные сведения см. в статье [Вопросы безопасности SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-security.md).

> [!NOTE]
> Образ виртуальной машины выпуска SQL Server Express не включает протокол TCP/IP автоматически, даже если выбрано общедоступное и частное подключение. Для выпуска Express необходимо [включить протокол TCP/IP вручную](#configure-sql-server-to-listen-on-the-tcp-protocol) в диспетчере конфигурации SQL Server после создания виртуальной машины.

### <a name="authentication"></a>Аутентификация

Если требуется проверка подлинности SQL Server, выберите для параметра **Включить** under **Включить**.

![проверка подлинности SQL Server](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-authentication.png)

> [!NOTE]
> Если вы планируете предоставить доступ к SQL Server через Интернет (т. е. включаете параметр общедоступного подключения), включите проверку подлинности SQL здесь. Для общего доступа к SQL Server необходимо использовать проверку подлинности SQL.
> 
> 

Если вы включаете проверку подлинности SQL Server, укажите **имя для входа** и **пароль**. Это имя пользователя настраивается в качестве имени для входа во время проверки подлинности SQL Server и имени участника фиксированной серверной роли **sysadmin**. Дополнительные сведения о режимах проверки подлинности см. в статье [Выбор режима проверки подлинности](https://docs.microsoft.com/sql/relational-databases/security/choose-an-authentication-mode).

Если проверка подлинности SQL Server не включена, подключиться к экземпляру SQL Server можно с помощью локальной учетной записи администратора на виртуальной машине.

### <a name="storage-configuration"></a>Конфигурация хранилища

Щелкните **Конфигурация хранилища** , чтобы указать требования к хранилищу.

![Конфигурация хранилища SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-storage.png)

> [!NOTE]
> Если вы вручную настроили виртуальную машину для использования стандартного хранилища, этот параметр недоступен. Автоматическая оптимизация доступна только для хранилища класса Premium.

> [!TIP]
> Число делений и верхний предел каждого ползунка зависит от выбранного размера виртуальной машины. Чем крупнее и мощнее виртуальная машина, тем больше возможностей увеличения масштаба.

Вы можете указать такие требования, как количество операций ввода-вывода в секунду (IOPs), пропускная способность в МБ/с и общий размер хранилища. Настройте эти значения на скользящих шкалах. Вы можете изменить эти параметры хранилища в зависимости от рабочей нагрузки. На основании этих требований портал автоматически вычисляет количество дисков для установки и настройки.

В разделе **Storage optimized for**(Оптимизация хранилища) выберите один из следующих вариантов.

* **Общая** — это значение по умолчанию, которое поддерживает большинство рабочих нагрузок.
* **Транзакционная** обработка оптимизирует хранилище для рабочих нагрузок OLTP в традиционных базах данных.
* **Хранилище данных** оптимизирует хранилище для рабочих нагрузок аналитики и отчетов.

### <a name="automated-patching"></a>Автоматическое исправление

**Automated patching** включен по умолчанию. Автоматическая установка исправлений позволяет Azure автоматически исправлять SQL Server и операционную систему. Укажите день недели, время и длительность периода обслуживания. Azure устанавливает исправления в период обслуживания. Расписание периода обслуживания использует для определения времени региональные параметры VM. Если вы не хотите, чтобы платформа Azure автоматически устанавливала исправления для SQL Server и операционной системы, выберите вариант **Отключить**.  

![Автоматическая установка исправлений SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-patching.png)

Дополнительные сведения см. в статье [Автоматическая установка исправлений SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-sql-automated-patching.md).

### <a name="automated-backup"></a>Автоматическая архивация

Включите автоматическую архивацию для всех баз данных в разделе **Автоматическая архивация**. По умолчанию автоматическая архивация отключена.

Во время включения автоматического резервного копирования SQL можно настроить следующие параметры:

* срок хранения (в днях) для резервных копий;
* учетная запись хранения, используемая для резервных копий;
* параметр шифрования и пароль для резервных копий.
* архивация системных баз данных;
* настройка расписания архивации баз данных.

Для шифрования резервной копии щелкните **Включить**. Затем введите **пароль**. Azure создает сертификат для шифрования резервных копий и использует указанный пароль для защиты этого сертификата.

![Автоматическая архивация SQL](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-autobackup2.png)

 Дополнительную информацию см. в статье [Автоматическая архивация SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-sql-automated-backup.md).

### <a name="azure-key-vault-integration"></a>Интеграция с хранилищем ключей Azure

Чтобы хранить в Azure секреты безопасности для шифрования, щелкните **Интеграция хранилища ключей Azure** и выберите значение **Включить**.

![Интеграция SQL с хранилищем ключей Azure](./media/virtual-machines-windows-portal-sql-server-provision/azure-sql-arm-akv.png)

В следующей таблице перечислены параметры, необходимые для настройки интеграции с хранилищем ключей Azure.

| ПАРАМЕТР | Описание | ПРИМЕР |
| --- | --- | --- |
| **URL-адрес хранилища ключей** |Расположение хранилища ключей. |https://contosokeyvault.vault.azure.net/ |
| **Имя субъекта** |Имя субъекта-службы Azure Active Directory. Этот имя также называется идентификатором клиента. |fde2b411-33d5-4e11-af04eb07b669ccf2 |
| **Секрет субъекта** |Секрет субъекта-службы Azure Active Directory. Этот секрет также называется секретом клиента. |9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM= |
| **Имя учетных данных** |**Учетное имя**: интеграция AKV создает учетные данные в рамках SQL Server, позволяя виртуальной машине иметь доступ к хранилищу ключей. Выберите имя для этих учетных данных. |mycred1 |

Дополнительные сведения см. в статье [Настройка интеграции хранилища ключей Azure для SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-ps-sql-keyvault.md).

### <a name="r-services"></a>Службы R

Имеется возможность можно включить [службы R SQL Server](https://msdn.microsoft.com/library/mt604845.aspx). Это позволяет использовать в SQL Server 2016 расширенные средства аналитики. Щелкните **Включить** в окне **SQL Server Settings**.

> [!NOTE]
> Для SQL Server 2016 Developer Edition этот параметр отключен порталом по ошибке. Для выпуска Developer Edition необходимо включить службы R вручную после создания виртуальной машины.

![Включение служб R SQL Server](./media/virtual-machines-windows-portal-sql-server-provision/azure-vm-sql-server-r-services.png)

Настроив параметры SQL Server, нажмите кнопку **ОК**.

## <a name="5-review-the-summary"></a>5. Просмотр сводки.

В окне **Сводка** просмотрите сводные данные и щелкните **Купить**, чтобы создать SQL Server, группу ресурсов и ресурсы, указанные для этой виртуальной машины.

Развертывание можно отслеживать на портале Azure. Если нажать кнопку **Уведомления** в верхней части окна, будут показаны основные сведения о состоянии развертывания.

> [!NOTE]
> Чтобы предоставить вам сведения о времени, необходимом для выполнения развертывания, в нашем сценарии виртуальная машина SQL была развернута в восточной части США с параметрами по умолчанию. На выполнение тестового развертывания понадобилось 26 минут. Время развертывания зависит от региона и выбранных параметров.

## <a name="open-the-vm-with-remote-desktop"></a>открывать виртуальные машины с помощью удаленного рабочего стола;

Выполните следующие действия, чтобы подключиться к виртуальной машине SQL Server через удаленный рабочий стол.

> [!INCLUDE [Connect to SQL Server VM with remote desktop](../../../../includes/virtual-machines-sql-server-remote-desktop-connect.md)]

После подключения к виртуальной машине SQL Server вы можете запустить SQL Server Management Studio и подключиться с проверкой подлинности Windows, используя свои учетные данные локального администратора. Если включена проверка подлинности SQL Server, можно также подключиться с проверкой подлинности SQL, используя имя пользователя и пароль SQL, настроенные во время подготовки.

Доступ к машине позволяет напрямую изменять настройки компьютера и SQL Server в зависимости от ваших требований. Например, можно настроить параметры брандмауэра или изменить параметры конфигурации SQL Server.

## <a name="enable-tcpip-for-developer-and-express-editions"></a>Включение TCP/IP для выпусков Developer и Express

При подготовке новой виртуальной машины SQL Server Azure не включает автоматически протокол TCP/IP для выпусков SQL Server Developer и Express. В шагах ниже описывается, как вручную включить TCP/IP для удаленного подключения по IP-адресу.

В следующих шагах используется **диспетчер конфигурации SQL Server** для включения протоколов TCP/IP для выпусков SQL Server Developer и Express.

> [!INCLUDE [Connect to SQL Server VM with remote desktop](../../../../includes/virtual-machines-sql-server-connection-tcp-protocol.md)]

## <a name="connect-to-sql-server-remotely"></a>удаленно подключаться к SQL Server;

В рамках этого руководства для виртуальной машины используется **открытый** доступ и **проверка подлинности SQL Server**. Эти параметры позволяют автоматически настроить виртуальную машину для получения доступа к экземпляру SQL Server из любого клиента через Интернет (при условии, что будет использоваться правильное имя пользователя SQL).

> [!NOTE]
> Если вы не выбрали открытый доступ во время подготовки, можно изменить параметры подключения к SQL на портале после подготовки. Дополнительные сведения см. в разделе [об изменении параметров подключения SQL](virtual-machines-windows-sql-connect.md#change).

В следующих разделах описано, как подключиться к экземпляру SQL Server на виртуальной машине с другого компьютера через Интернет.

> [!INCLUDE [Connect to SQL Server in a VM Resource Manager](../../../../includes/virtual-machines-sql-server-connection-steps-resource-manager.md)]

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об использовании SQL Server в Azure см. в статье [Приступая к работе с SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-overview.md) и [Часто задаваемые вопросы об SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-faq.md).
