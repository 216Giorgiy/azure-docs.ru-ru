<properties
	pageTitle="Использование Microsoft Azure CLI для Mac, Linux и Windows со службой управления ресурсами Azure | Microsoft Azure"
	description="Использование Microsoft Azure CLI для Mac, Linux и Windows со службой управления ресурсами Azure."
	editor="tysonn"
	manager="timlt"
	documentationCenter=""
	authors="dlepow"
	services="virtual-machines"/>

<tags ms.service="virtual-machines" ms.workload="infrastructure-services"" ms.tgt_pltfrm="command-line-interface" ms.devlang="na" ms.topic="article" ms.date="06/09/2015" ms.author="danlep"/>

# Использование Azure CLI для Mac, Linux и Windows со службой управления ресурсами Azure

> [AZURE.SELECTOR]
- [Azure PowerShell](../powershell-azure-resource-manager.md)
- [Azure CLI](xplat-cli-azure-resource-manager.md)


В этом разделе описывается создание и удаление ресурсов и виртуальных машин Azure с использованием интерфейса командной строки Azure (далее — Azure CLI) для Mac, Linux и Windows и режима **arm**. Речь также пойдет об управлении этими ресурсами и виртуальными машинами.

>[AZURE.NOTE]Чтобы создавать ресурсы Azure и управлять ими с помощью командной строки, вам нужно создать учетную запись Azure ([бесплатная пробная версия здесь](http://azure.microsoft.com/pricing/free-trial/)). Вам также нужно [установить Azure CLI](../xplat-cli-install.md) и [войти в систему для использования ресурсов Azure, связанных с вашей учетной записью](../xplat-cli-connect.md). Если все это уже сделано, у вас все готово для работы.

## Ресурсы Azure

Диспетчер ресурсов позволяет управлять группой _ресурсов_ (управляемые пользователем сущности, такие как виртуальная машина, сервер базы данных, база данных или веб-сайт) как одной логической единицей. Такая логическая единица называется _группой ресурсов_. Вы можете императивно создавать эти ресурсы, удалять их и управлять ими через командную строку точно так же, как в режиме **asm**.

С помощью режима **arm** вы можете управлять ресурсами Azure также _декларативно_. Это делается путем описания структуры и отношений развертываемой группы ресурсов в *шаблонах* JSON. В шаблоне описаны параметры, значения которых указываются в аргументах выполняемой команды либо хранятся в отдельном JSON-файле (**azuredeploy-parameters.json**). Это позволяет легко создавать новые ресурсы с помощью одного и того же шаблона, просто предоставляя различные параметры. Например, в шаблоне для создания веб-сайта, помимо прочих общих параметров, будут указаны параметры для имени сайта и региона, в котором он будет размещен.

Когда шаблон используется для изменения или создания группы, создается _развертывание_, которое затем применяется к этой группе. Дополнительные сведения о диспетчере ресурсов см. в статье [Общие сведения о диспетчере ресурсов Azure](../resource-group-overview.md).

## Аутентификация

Чтобы работать с диспетчером ресурсов через Azure CLI, вам нужно войти в Microsoft Azure с помощью рабочей или учебной учетной записи. Проверка подлинности с использованием сертификата, установленного с помощью PUBLISHSETTINGS-файла, не поддерживается.

Дополнительные сведения о проверке подлинности с помощью рабочей или учебной учетной записи см. в статье [Подключение к подписке Azure через Azure CLI](../xplat-cli-connect.md).

> [AZURE.NOTE]Так как рабочей или учебной учетной записью управляет служба Azure Active Directory, для управления доступом и использованием ресурсов Azure также можно использовать механизм управления доступом к Azure на основе ролей (RBAC). Дополнительные сведения см. в статье [Управление доступом к ресурсам и аудит доступа](../resource-group-rbac.md).

## Активация режима **arm**

Режим диспетчера ресурсов не активирован по умолчанию. Чтобы активировать команды диспетчера ресурсов Azure CLI, необходимо выполнить такую команду:

	azure config mode arm

>[AZURE.NOTE]Режим диспетчера ресурсов Azure и режим управления службами Azure являются взаимоисключающими. То есть ресурсами, созданными в одном из режимов, нельзя управлять из другого режима.

## Поиск расположений

Для большинства команд в режиме **arm** нужно указывать допустимое расположение, в котором они будут создавать или искать ресурсы. Все доступные расположения можно найти с помощью такой команды:

	azure location list

Она возвращает список расположений, относящихся к определенному региону, например «Запад США», «Восток США» и т. д.

## Создание группы ресурсов

Группа ресурсов — это сетевые ресурсы, ресурсы хранилищ и другие ресурсы, объединенные в логическую группу. Почти для всех команд в режиме **arm** нужно указывать группу ресурсов. Например, чтобы создать группу ресурсов с именем _testrg_, нужно выполнить такую команду:

	azure group create -n "testrg" -l "West US"

После выполнения этой команды вы можете начинать добавлять ресурсы в эту группу и использовать ее для настройки новой виртуальной машины.

## Создание виртуальных машин

Существует два способа создания виртуальных машин в режиме **arm**:

1. с помощью отдельных команд Azure CLI;
2. с помощью шаблонов групп ресурсов.

В любом из этих случаев вам сначала необходимо создать хотя бы одну группу ресурсов.

### Создание виртуальной машины с помощью отдельных команд Azure CLI

Это основной способ настройки и создания виртуальной машины под свои нужды. В режиме **arm** используется команда **vm create**, но сначала вам нужно настроить некоторые обязательные ресурсы, в частности подключение к сети.

>[AZURE.NOTE]При использовании командной строки во время первого создания ресурсов для вашей подписки может появиться запрос на регистрацию определенных поставщиков ресурсов. Если такой запрос появится, просто зарегистрируйте указанного поставщика (это несложно) и запустите команду еще раз. Например,
>
> `azure provider register Microsoft.Storage`
>
> Список поставщиков, зарегистрированных для вашей подписки, можно получить с помощью такой команды:
>
> `azure provider list`


#### Создание общедоступного IP-ресурса

Вам нужно создать общедоступный IP-адрес, который будет использоваться для подключения к новой виртуальной машине по протоколу SSH. В противном случае работа с виртуальной машиной будет невозможна. Создать общедоступный IP-адрес просто. Команда принимает в качестве аргументов имя группы ресурсов, имя общедоступного IP-ресурса и расположение (строго в этом порядке). Например,

	azure network public-ip create "testrg" "testip" "westus"

#### Создание ресурса сетевой карты

Прежде чем создавать сетевой адаптер (также называется сетевой картой), нужно создать подсеть и виртуальную сеть. Создайте виртуальную сеть в определенном расположении и группе ресурсов с помощью команды **network vnet create**.

	azure network vnet create "testrg" "testvnet" "westus"

Затем создайте в этой виртуальной сети подсеть. Используйте для этого команду **network vnet subnet create**. Например:

	azure network vnet subnet create "testrg" "testvnet" "testsubnet"

Затем, используя эти ресурсы и команду **network nic create**, создайте сетевую карту.

	azure network nic create "testrg" "testnic" "westus" -k "testsubnet" -m "testvnet" -p "testip"

>[AZURE.NOTE]Хотя это и необязательно, но имя общедоступного IP-ресурса очень важно передать в качестве параметра команды **network nic create**. Это привяжет сетевую карту к IP-адресу, который позже будет использоваться для подключения к виртуальной машине с этим сетевым адаптером по протоколу SSH.

Дополнительные сведения о командах **network** см. в справке по командой строке или в статье [Использование Azure CLI с диспетчером ресурсов Azure](azure-cli-arm-commands.md).

#### Поиск образа операционной системы

Сейчас найти операционную систему можно только по сведениям об издателе образа. Чтобы получить список издателей образов ОС в нужном расположении, выполните такую команду:

	azure vm image list-publishers "westus"

Затем выберите из списка определенного издателя и получите список его образов.

	azure vm image list "westus" "CoreOS"

После этого выберите образ ОС. Список образов выглядит так:

	info:    Executing command **vm image list**
	warn:    The parameters --offer and --sku if specified will be ignored
	+ Getting virtual machine image offers (Publisher: "Canonical" Location: "westus")
	data:    Publisher  Offer        Sku          Version          Location  Urn

	data:    ---------  -----------  -----------  ---------------  --------- ----------------------------------------
	data:    CoreOS     CoreOS       Alpha        475.1.0          westus    CoreOS:CoreOS:Alpha:475.1.0
	data:    CoreOS     CoreOS       Alpha        490.0.0          westus    CoreOS:CoreOS:Alpha:490.0.0

Запишите URN образа, который требуется загрузить на виртуальную машину.

#### Создание виртуальной машины

Теперь вы готовы создать виртуальную машину. Для этого используется команда **vm create**, в которой передаются необходимые сведения. На этом этапе необязательно передавать общедоступный IP-адрес, так как сетевой адаптер уже имеет эти данные. Ниже приведен пример команды, где _testvm_ — это имя виртуальной машины, создаваемой в группе ресурсов _testrg_.

	azure-cli@0.8.0:/# azure vm create "testrg" "testvm" "westus" "Linux" -Q "CoreOS:CoreOS:Alpha:660.0.0" -u "azureuser" -p "Pass1234!" -N "testnic"
	info:    Executing command vm create
	+ Looking up the VM "testvm"
	info:    Using the VM Size "Standard_A1"
	info:    The [OS, Data] Disk or image configuration requires storage account
	+ Retrieving storage accounts
	info:    Could not find any storage accounts in the region "westus", trying to create new one
	+ Creating storage account "cli02f696bbfda6d83414300" in "westus"
	+ Looking up the storage account cli02f696bbfda6d83414300
	+ Looking up the NIC "testnic"
	+ Creating VM "testvm"
	info:    vm create command OK

Чтобы запустить эту виртуальную машину, выполните такую команду:

	azure vm start "testrg" "testvm"

Затем подключитесь к виртуальной машине по протоколу SSH с помощью команды **ssh username@ipaddress**. Чтобы быстро найти IP-адрес вашего общедоступного IP-ресурса, выполните такую команду:

	azure network public-ip show "testrg" "testip"

Для управления этой виртуальной машиной используются команды **vm**. Дополнительные сведения см. в статье [Использование Azure CLI с диспетчером ресурсов Azure](azure-cli-arm-commands.md).

### Команда **vm quick-create**

Новая команда **vm quick-create** позволяет пропустить большинство этапов императивного метода создания виртуальной машины. Это удобно, когда вам нужно создать простую виртуальную машину или же когда конфигурация сети не имеет значения. Это интерактивная команда, поэтому для ее выполнения вам нужно узнать только URN образа ОС.

	azure-cli@0.8.0:/# azure vm quick-create
	info:  Executing command vm quick-create
	Resource group name: CLIRG
	Virtual machine name: myqvm
	Location name: westus
	Operating system Type [Windows, Linux]: Linux
	ImageURN (format: "publisherName:offer:skus:version"): CoreOS:CoreOS:Alpha:660.0.0
	User name: azureuser
	Password: ********
	Confirm password: ********

Azure CLI создаст виртуальную машину с размером по умолчанию. Также будут созданы учетная запись хранения, сетевой адаптер, виртуальная сеть, подсеть и общедоступный IP-адрес. Когда виртуальная машина загрузится, вы сможете подключиться к ней по протоколу SSH, используя общедоступный IP-адрес.

### Создание виртуальной машины с помощью шаблонов групп ресурсов

#### Поиск и настройка шаблона группы ресурсов

1. Выбрав этот вариант создания виртуальной машины, вы можете создать собственный шаблон, воспользоваться шаблоном из коллекции шаблонов или использовать один из шаблонов на [github](https://github.com/azurermtemplates/azurermtemplates). Давайте воспользуемся шаблоном **CoreOS.CoreOSStable.0.2.40-preview** из коллекции шаблонов. Чтобы получить список доступных шаблонов в коллекции, введите следующую команду. Существуют тысячи шаблонов, поэтому рекомендуем разбить результаты по страницам или использовать команду **grep** или **findstr** (в ОС Windows). Кроме этих команд, вы также можете найти интересующий вас шаблон с помощью любой другой команды поиска по строке. Вы также можете воспользоваться параметром **--json** и загрузить весь список в формате JSON, что существенно упростит поиск.

		azure group template list

	Ответ будет содержать издателя, а также имя шаблона и появится приблизительно в следующем виде (хотя будет гораздо больше данных).

		data:    Publisher               Name
		data:    ----------------------------------------------------------------------------
		data:    CoreOS                  CoreOS.CoreOSStable.0.2.40-preview
		data:    CoreOS                  CoreOS.CoreOSAlpha.0.2.39-preview
		data:    SUSE                    SUSE.SUSELinuxEnterpriseServer12.2.0.36-preview
		data:    SUSE                    SUSE.SUSELinuxEnterpriseServer11SP3PremiumImage0.2.54-preview

2. Чтобы просмотреть подробные сведения о шаблоне, используйте такую команду:

		azure group template show CoreOS.CoreOSStable.0.2.40-preview

	Возвращается описательная информация о шаблоне. Используемый нами шаблон создаст виртуальную машину под управлением Linux.

3. После выбора шаблона его можно загрузить с помощью следующей команды.

		azure group template download CoreOS.CoreOSStable.0.2.40-preview

	Загрузка шаблона позволяет настраивать его в соответствии с актуальными требованиями. Например, можно добавить в шаблон другой ресурс.

	>[AZURE.NOTE]Прежде чем использовать измененный шаблон для создания или изменения существующей группы ресурсов, проверьте его с помощью команды `azure group template validate`.

4. Чтобы настроить шаблон группы ресурсов для использования, откройте файл шаблона в текстовом редакторе. Обратите внимание на расположенный вверху раздел **параметров** JSON. Она содержит список параметров, которые необходимы шаблону для создания описанных в нем ресурсов. Некоторые параметры могут иметь значения по умолчанию, тогда как для других может быть предусмотрен только тип или диапазон допустимых значений.

	При использовании шаблона можно задать параметры в составе параметров командной строки либо указать файл со значениями параметров. **Значения** также можно указать прямо в шаблоне в разделе **параметров**. Впрочем, при таком подходе шаблон будет жестко завязан на конкретное развертывание и повторное использование шаблона будет затруднено. В любом случае параметры должны быть в формате JSON и необходимо предоставить свои собственные значения для этих клавиш, которые не имеют значений по умолчанию.

	Например, чтобы создать файл с параметрами (**params.json**) для шаблона **CoreOS.CoreOSStable.0.2.40-preview**, используйте указанные ниже данные. Замените значения из примера на собственные. Значением параметра **Location** должен быть ближайший к вам регион Azure, например **North Europe** (северная Европа) или **South Central US** (центральный регион США). В этом примере используется значение **West US** (запад США).

		{
		  "newStorageAccountName": {
			"value": "testStorage"
		  },
		  "newDomainName": {
			"value": "testDomain"
		  },
		  "newVirtualNetworkName": {
			"value": "testVNet"
		  },
		  "vnetAddressSpace": {
			"value": "10.0.0.0/11"
		  },
		  "hostName": {
			"value": "testHost"
		  },
		  "userName": {
			"value": "azureUser"
		  },
		  "password": {
			"value": "Pass1234!"
		  },
		  "location": {
			"value": "West US"
		  },
		  "hardwareSize": {
			"value": "Medium"
		  }
	    }

5. После сохранения файла **params.json** используйте следующую команду, чтобы создать новую группу ресурсов на основе шаблона. Параметр `-e` указывает файл **params.json**, созданный на предыдущем этапе. Вместо **testRG** укажите имя нужной вам группы, а вместо **testDeploy** — имя вашего развертывания. Расположение должно быть тем же, что указано в вашем файле **params.json** с параметрами шаблона.

		azure group create "testRG" "West US" -f CoreOS.CoreOSStable.0.2.40-preview.json -d "testDeploy" -e params.json

	Эта команда возвращает значение ОК после отправки развертывания, но до его применения к ресурсам в группе. Чтобы проверить состояние развертывания, используйте следующую команду.

		azure group deployment show "testRG" "testDeploy"

	**ProvisioningState** показывает состояние развертывания.

	Если развертывание пройдет успешно, вы увидите примерно такую информацию:

		azure-cli@0.8.0:/# azure group deployment show testRG testDeploy
		info:    Executing command group deployment show
		+ Getting deployments
		data:    DeploymentName     : testDeploy
		data:    ResourceGroupName  : testRG
		data:    ProvisioningState  : Running
		data:    Timestamp          : 2015-04-27T07:49:18.5237635Z
		data:    Mode               : Incremental
		data:    Name                   Type          Value
		data:    ---------------------  ------------  ----------------
		data:    newStorageAccountName  String        testStorage
		data:    newDomainName          String        testDomain
		data:    newVirtualNetworkName  String        testVNet
		data:    vnetAddressSpace       String        10.0.0.0/11
		data:    hostName               String        testHost
		data:    userName               String        azureUser
		data:    password               SecureString  undefined
		data:    location               String        West US
		data:    hardwareSize           String        Medium
		info:    group deployment show command OK

	>[AZURE.NOTE]Если выясняется, что ваша конфигурация неправильная, и требуется остановить длительное развертывание, используйте следующую команду.
	>
	> `azure group deployment stop "testRG" "testDeploy"`
	>
	> Если не указать имя развертывания, оно будет создано автоматически на основе имени файла шаблона. Оно будет возвращено в составе выходных данных команды `azure group create`.

6. Для просмотра группы используйте следующую команду.

		azure group show "testRG"

	Эта команда возвращает сведения о ресурсах в группе. Если у вас есть несколько групп, с помощью команды `azure group list` можно получить список их имен, а затем с помощью команды `azure group show` просмотреть сведения о конкретной группе.

7. Вы также можете использовать новейшие шаблоны с ресурса github. Другими словами, их не обязательно скачивать из библиотеки шаблонов. Откройте веб-сайт [Github.com](http://www.github.com) и создайте поисковый запрос AzureRmTemplates. Выберите репозиторий AzureRmTemplates и найдите интересующие вас шаблоны, например _101-simple-vm-from-image_. Щелкнув шаблон, вы увидите, что он содержит файл **azuredeploy.json** (помимо прочих файлов). Этот шаблон и нужно указывать в командном параметре **--template-url**. Откройте его в режиме _raw_ и скопируйте URL-адрес, который отображается в адресной строке браузера. С помощью этого URL-адреса можно создать развертывание, не загружая шаблон из библиотеки шаблонов. Для этого нужно выполнить такую команду:

		azure group deployment create "testDeploy" -g "testResourceGroup" --template-uri https://raw/githubusercontent.com/azurermtemplates/azurermtemplates/master/101-simple-vm-from-image/azuredeploy.json

	> [AZURE.NOTE]Очень важно открыть шаблон JSON в режиме _raw_. URL-адрес в адресной строке браузера отличается от адреса, который отображается в обычном режиме. Чтобы открыть файл в режиме _raw_, при просмотре файла на сайте github нажмите кнопку _Raw_ в правом верхнем углу экрана.

#### Работа с ресурсами

Хотя шаблоны позволяют объявлять изменения в конфигурации для всей группы, иногда требуется работать исключительно с определенным ресурсом. Для этого воспользуйтесь командами `azure resource`.

> [AZURE.NOTE]Для любой команды `azure resource`, кроме команды `list`, необходимо указывать версию API ресурса, с которым вы работаете. Версия указывается в параметре `-o`. Если вы не уверены, какая именно версия API используется, обратитесь к файлу шаблона и найдите поле **apiVersion** для этого ресурса.

1. Чтобы получить список всех ресурсов в группе, используйте следующую команду.

		azure resource list "testRG"

2. Чтобы просмотреть отдельный ресурс в группе, используйте следующую команду.

		azure resource show "testRG" "testHost" Microsoft.ClassicCompute/virtualMachines -o "2014-06-01"

	Обратите внимание на параметр **Microsoft.ClassicCompute/virtualMachines**. Он указывает тип ресурса, для которого вы запрашиваете информацию. Если посмотреть на загруженный ранее файл шаблона, можно заметить, что это же значение используется для определения типа ресурса виртуальной машины, описанного в шаблоне.

	Эта команда возвращает сведения, связанные с виртуальной машиной.

3. При просмотре сведений о ресурсе часто бывает полезно использовать параметр `--json`. Это делает выходные данные более удобочитаемыми, так как некоторые значения являются вложенными структурами или коллекциями. Ниже показано возвращение результатов команды show в виде документа JSON.

		azure resource show "testRG" "testHost" Microsoft.ClassicCompute/virtualMachines -o "2014-06-01" --json

	>[AZURE.NOTE]Чтобы сохранить данные JSON в файл, используйте символ &gt;: выходные данные будут записаны в файл. Например:
	>
	> `azure resource show "testRG" "testHost" Microsoft.ClassicCompute/virtualMachines -o "2014-06-01" --json > myfile.json`

4. Чтобы удалить существующий ресурс, используйте следующую команду.

		azure resource delete "testRG" "testHost" Microsoft.ClassicCompute/virtualMachines -o "2014-06-01"

## Ведение журналов

Чтобы просмотреть записанные в журнал сведения о выполненных операциях с группой, используйте команду `azure group log show`. По умолчанию при этом выводится последняя операция, выполненная с группой. Чтобы просмотреть все операции, используйте дополнительный параметр `--all`. Для последнего развертывания используйте параметр `--last-deployment`. Для конкретного развертывания используйте параметр `--deployment` и укажите имя развертывания. Следующий пример возвращает журнал всех операций, выполненных с группой MyGroup.

	azure group log show mygroup --all

## Дальнейшие действия

* Дополнительные сведения об использовании интерфейса командной строки Azure (Azure CLI) см. в статье [Установка и настройка Azure CLI][clisetup].
* Сведения о работе с диспетчером ресурсов с помощью Azure PowerShell см. в статье [Использование Azure PowerShell с диспетчером ресурсов Azure](../powershell-azure-resource-manager.md).
* Сведения о работе с диспетчером ресурсов на портале Azure см. в статье [Использование групп ресурсов для управления ресурсами Azure][psrm].

[signuporg]: http://www.windowsazure.com/documentation/articles/sign-up-organization/
[adtenant]: http://technet.microsoft.com/library/jj573650#createAzureTenant
[portal]: https://manage.windowsazure.com/
[clisetup]: ../xplat-cli.md
[psrm]: http://go.microsoft.com/fwlink/?LinkId=394760
 

<!---HONumber=62-->