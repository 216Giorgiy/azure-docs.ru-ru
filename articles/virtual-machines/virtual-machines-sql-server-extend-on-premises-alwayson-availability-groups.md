<properties 
   pageTitle="Расширение локальных групп доступности AlwaysOn в Azure"
   description="В этом учебнике показано, как с помощью мастера добавления реплики в SQL Server Management Studio (SSMS) добавить реплику группы доступности AlwaysOn в Azure."
   services="virtual-machines"
   documentationCenter="na"
   authors="rothja"
   manager="jeffreyg"
   editor="monicar" />
<tags 
   ms.service="virtual-machines"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="vm-windows-sql-server"
   ms.workload="infrastructure-services"
   ms.date="08/17/2015"
   ms.author="jroth" />

# Расширение локальных групп доступности AlwaysOn в Azure

Группы доступности AlwaysOn обеспечивают высокий уровень доступности групп базы данных путем добавления вторичных реплик. Эти реплики позволяют отрабатывать отказы баз данных. Кроме того, их можно использовать для разгрузки рабочих нагрузок чтения или задач резервного копирования.

Вы можете расширить локальные группы доступности в Microsoft Azure. Для этого подготовьте одну или несколько виртуальных машин Azure с помощью SQL Server, а затем добавьте их в локальные группы доступности в качестве реплик.

В этом учебнике предполагается, что у вас есть следующие компоненты.

- Активная подписка Azure. Вы можете [воспользоваться бесплатной пробной версией](http://azure.microsoft.com/pricing/free-trial).

- Существующая локальная группа доступности AlwaysOn. Дополнительные сведения о группах доступности см. в статье [Группы доступности AlwaysOn](https://msdn.microsoft.com/library/hh510230.aspx).

- Подключение между локальной сетью и виртуальной сетью Azure. Дополнительные сведения о создании этой виртуальной сети см. в статье [Создание виртуальной сети с VPN-подключением типа "сеть-сеть" с помощью портала управления](../vpn-gateway/vpn-gateway-site-to-site-create.md).

## Мастер добавления реплики Azure

В этом разделе показано, как с помощью **мастера добавления реплики Azure** расширить решение группы доступности AlwaysOn и включить реплики Azure.

1. В SQL Server Management Studio разверните раздел **Высокий уровень доступности AlwaysOn** > **Группы доступности** > **[Имя группы доступности]**.

1. Щелкните правой кнопкой мыши **Реплики доступности** и выберите пункт **Добавить реплику**.

1. По умолчанию отобразится **мастер добавления реплики в группу доступности**. Нажмите кнопку **Далее**. Если вы установили флажок **Больше не показывать эту страницу** в нижней части страницы во время предыдущего запуска этого мастера, этот экран не отобразится.

	![SQL](./media/virtual-machines-sql-server-extend-on-premises-alwayson-availability-groups/IC742861.png)

1. Вам потребуется подключиться ко всем существующим вторичным репликам. Вы можете щелкнуть **Подключить...** рядом с каждой репликой или выбрать пункт **Подключить все…** в нижней части экрана. После проверки подлинности нажмите кнопку **Далее**, чтобы перейти на следующий экран.

1. В верхней части страницы **Указание реплик** есть несколько вкладок: **Реплики**, **Конечные точки**, **Параметры резервного копирования** и **Прослушиватель**. На вкладке **Реплики** щелкните **Добавить реплику Azure…**, чтобы запустить мастер добавления реплики Azure.

	![SQL](./media/virtual-machines-sql-server-extend-on-premises-alwayson-availability-groups/IC742863.png)

1. Выберите существующий сертификат управления Azure в локальном хранилище сертификатов Windows, если он уже установлен. Выберите или введите идентификатор подписки Azure, если вы ранее использовали его. Вы можете нажать кнопку "Загрузить", чтобы скачать и установить сертификат управления Azure, а также скачать список подписок, используя учетную запись Azure.

	![SQL](./media/virtual-machines-sql-server-extend-on-premises-alwayson-availability-groups/IC742864.png)

1. Каждое поле на странице будет заполнено значениями, которые будут использоваться для создания виртуальной машины Azure, на которой будет размещена реплика.

	|Настройка|Описание|
|---|---|
|**Образ —**|Выберите нужное сочетание операционной системы и SQL Server.|
|**Размер виртуальной машины**|Выберите размер виртуальной машины в соответствии с вашими бизнес-потребностями.|
|**Имя виртуальной машины**|Укажите уникальное имя для новой виртуальной машины. Имя должно содержать от 3 до 15 символов, может включать только буквы, цифры и дефисы, а также должно начинаться с буквы и заканчиваться буквой или цифрой.|
|**Имя пользователя виртуальной машины**|Укажите имя пользователя учетной записи администратора на виртуальной машине.|
|**Пароль администратора виртуальной машины**|Укажите пароль для новой учетной записи.|
|**Подтверждение пароля**|Подтвердите пароль для новой учетной записи.|
|**Виртуальная сеть**|Укажите виртуальную сеть Azure, которую будет использовать новая виртуальная машина. Дополнительные сведения о виртуальных сетях см. в статье [Обзор виртуальных сетей](..\virtual-network\virtual-networks-overview.md).|
|**Подсеть виртуальной сети**|Укажите подсеть виртуальной сети, которую будет использовать новая виртуальная машина.|
|**Домен**|Подтвердите правильность предварительно заполненного значения для домена.|
|**Имя пользователя домена**|Укажите учетную запись, входящую в группу локальных администраторов на локальных узлах кластера.|
|**Пароль**|Укажите пароль для имени пользователя домена.|

1. Нажмите кнопку **ОК**, чтобы проверить параметры развертывания.

1. После этого отобразятся условия соглашения. Прочтите соглашение и нажмите кнопку **ОК**, если вы согласны с этими условиями.

1. Снова отобразится страница **Указание реплик**. Проверьте параметры новой реплики Azure на вкладках **Реплики**, **Конечные точки** и **Параметры резервного копирования**. Измените параметры в соответствии со своими бизнес-требованиями. Дополнительные сведения о параметрах на этих вкладках см. в статье [Страница "Выбор реплик" (мастер создания группы доступности/мастер добавления реплики)](https://msdn.microsoft.com/library/hh213088.aspx). Обратите внимание, что на вкладке "Прослушиватель" невозможно создать прослушиватели для групп доступности, содержащих реплики Azure. Кроме того, если прослушиватель создан еще до запуска мастера, вы получите сообщение о том, что служба Azure не поддерживает прослушиватель. Чтобы узнать, как создавать прослушиватели, перейдите к разделу **Создание прослушивателя группы доступности**.

	![SQL](./media/virtual-machines-sql-server-extend-on-premises-alwayson-availability-groups/IC742865.png)

1. Нажмите кнопку **Далее**.

1. Выберите необходимый метод синхронизации данных на странице **Выбор начальной синхронизации данных** и нажмите кнопку **Далее**. В большинстве случаев следует выбирать параметр **Полная синхронизация данных**. Дополнительные сведения о методах синхронизации данных см. в статье [Страница "Выбор начальной синхронизации данных" (мастера группы доступности AlwaysOn)](https://msdn.microsoft.com/library/hh231021.aspx).

1. Просмотрите результаты на странице **Проверка**. Исправьте нерешенные ошибки и при необходимости перезапустите проверку. Нажмите кнопку **Далее**.

	![SQL](./media/virtual-machines-sql-server-extend-on-premises-alwayson-availability-groups/IC742866.png)

1. Просмотрите параметры на странице **Сводка**, а затем нажмите кнопку **Готово**.

1. Начнется процесс подготовки. После успешного завершения работы мастера нажмите кнопку **Закрыть**, чтобы выйти из мастера.

>[AZURE.NOTE]Мастер добавления реплики Azure создает файл журнала в папке <Users><имя\_пользователя>\\AppData\\Local\\SQL Server\\AddReplicaWizard. С помощью этого файла журнала можно устранить ошибки при развертывании реплик Azure. Если мастеру не удается выполнить любое действие, выполняется откат всех предыдущих операций, в том числе удаление подготовленной виртуальной машины.

## Создание прослушивателя группы доступности

После создания группы доступности необходимо создать прослушиватель для подключения клиентов к репликам. Прослушиватели направляют входящие подключения на первичную или доступную только для чтения вторичную реплику. Дополнительные сведения о прослушивателях см. в [статье, в которой рассматривается настройка прослушивателя внутренней подсистемы балансировки нагрузки для групп доступности AlwaysOn в Azure](virtual-machines-sql-server-configure-ilb-alwayson-availability-group-listener.md).

## Дальнейшие действия

Вы можете не только использовать **мастер добавления реплики Azure** для расширения группы доступности AlwaysOn в Azure, но также полностью переместить некоторых рабочие нагрузки SQL Server в Azure. Начальные указания приведены в статье [Подготовка виртуальной машины SQL Server в Azure](virtual-machines-provision-sql-server.md).

Другие темы, связанные с запуском SQL Server на виртуальных машинах Azure, см. в статье [SQL Server на виртуальных машинах Azure](virtual-machines-sql-server-infrastructure-services.md).

<!---HONumber=August15_HO8-->