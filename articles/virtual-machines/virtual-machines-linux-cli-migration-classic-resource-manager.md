<properties
	pageTitle="Перенос ресурсов IaaS из классического развертывания в развертывание с помощью Azure Resource Manager с использованием Azure CLI | Microsoft Azure"
	description="В этой статье последовательно описывается поддерживаемый платформой перенос ресурсов из классической модели в модель Azure Resource Manager с помощью Azure CLI."
	services="virtual-machines-linux"
	documentationCenter=""
	authors="mahthi"
	manager="drewm"
	editor=""
	tags="azure-resource-manager"/>

<tags
	ms.service="virtual-machines-windows"
	ms.workload="infrastructure-services"
	ms.tgt_pltfrm="vm-linux"
	ms.devlang="na"
	ms.topic="article"
	ms.date="05/04/2016"
	ms.author="mahthi"/>

# Перенос ресурсов IaaS из классического развертывания в развертывание с помощью Azure Resource Manager с использованием Azure CLI

Ниже последовательно описано, как использовать команды интерфейса командной строки Azure (CLI) для переноса ресурсов IaaS из классической модели развертывания в модель развертывания с помощью Azure Resource Manager. Для выполнения инструкций требуется войти в [Azure CLI](../xplat-cli-install.md) (`azure login`).

## Шаг 1. Подготовка к переносу

Ниже приведено несколько рекомендаций для оценки переноса ресурсов IaaS из классической модели в модель Resource Manager.

- Прочитайте [список неподдерживаемых конфигураций и компонентов](virtual-machines-windows-migration-classic-resource-manager.md). Если у вас есть виртуальные машины, которые используют неподдерживаемые конфигурации или компоненты, мы рекомендуем отложить перенос до того момента, пока не будет заявлено об их поддержке. Также вы можете удалить такую функцию или вынести ее за пределы конфигурации, чтобы выполнить перенос.
-	Если у вас есть текущие автоматизированные сценарии, которые развертывают инфраструктуру и приложения, попробуйте создать аналогичную программу установки для миграции с помощью этих сценариев. Вы можете также настроить примеры среды с помощью портала Azure.
- Так как служба работает в режиме общедоступной предварительной версии, убедитесь, что тестовая среда для переноса изолирована от рабочей среды. Не используйте в тестовой и рабочей средах одни и те же учетные записи хранения, виртуальные сети или другие ресурсы.

## Шаг 2. Настройка подписки и регистрация для использования общедоступной предварительной версии службы миграции

Для сценариев миграции следует настроить среду для классической модели и модели Resource Manager. [Установите интерфейс командной строки Azure](../xplat-cli-install.md) и [выберите подписку](../xplat-cli-connect.md).

Выберите подписку Azure с помощью следующей команды.

	azure account set "azure-subscription-name"

Зарегистрируйтесь для использования общедоступной предварительной версии с помощью следующей команды. Обратите внимание, что в некоторых случаях время ожидания этой команды истекает. Однако регистрация будет успешной.

	azure provider register Microsoft.ClassicInfrastructureMigrate

Подождите пять минут для завершения регистрации. Состояние утверждения регистрации можно проверить, выполнив следующую команду. Убедитесь, что RegistrationState имеет значение `Registered`, прежде чем продолжить.

	azure provider show Microsoft.ClassicInfrastructureMigrate

Теперь переключите интерфейс командной строки в режим `asm`.

	azure config mode asm

## Шаг 3. Выполнение команд для переноса ресурсов IaaS

>[AZURE.NOTE] Все операции, описанные здесь, являются идемпотентными. Если вы столкнетесь с какой-либо проблемой, не связанной с неподдерживаемой функцией или ошибкой конфигурации, мы рекомендуем повторить подготовку, прервать или зафиксировать текущую операцию. Платформа повторит попытку.

### Перенос виртуальных машин в облачную службу (не в виртуальную сеть)

Получите список облачных служб, выполнив следующую команду, а затем выберите облачную службу для переноса. Обратите внимание: если виртуальные машины в облачной службе размещены в виртуальной сети или им назначены веб-роли или рабочие роли, вы получите сообщение об ошибке.

	azure service list

Выполните следующую команду, чтобы получить имя развертывания для облачной службы из подробных выходных данных. В большинстве случаев имя развертывания совпадает с именем облачной службы.

	azure service show servicename -vv

Подготовьте к переносу виртуальные машины в облачной службе. Возможно два варианта.

Если вы хотите перенести виртуальные машины в виртуальную сеть, созданную платформой, используйте следующую команду.

	azure service deployment prepare-migration servicename deploymentname new "" "" ""

Если вы хотите перенести их в существующую виртуальную сеть в модели развертывания с помощью Resource Manager, используйте следующую команду.

	azure service deployment prepare-migration serviceName deploymentName existing destinationVNETResourceGroupName subnetName vnetName

Когда операция подготовки успешно завершится, вы сможете просмотреть подробные выходные данные о состоянии переноса виртуальных машин, чтобы убедиться, что все они находятся в состоянии `Prepared`.

	azure vm show vmName -vv

Проверьте конфигурацию для подготовленных ресурсов с помощью интерфейса командной строки или портала Azure. Если вы не готовы к миграции и хотите вернуть предыдущее состояние, используйте следующую команду.

	azure service deployment abort-migration serviceName deploymentName

Если подготовленная конфигурация вас устраивает, можете продолжать процесс. Выполните следующую команду, чтобы зафиксировать ресурсы.

	azure service deployment commit-migration serviceName deploymentName

### Перенос виртуальных машин в виртуальную сеть

Выберите виртуальную сеть, в которую будете переносить ресурсы. Обратите внимание: если в виртуальной сети есть виртуальные машины, веб-роли или рабочие роли с неподдерживаемыми конфигурациями, вы получите сообщение об ошибке проверки.

Выполните следующую команду, чтобы получить все виртуальные сети в подписке.

	azure network vnet list

Подготовьте выбранную виртуальную сеть к переносу, используя следующую команду.

	azure network vnet prepare-migration virtualnetworkname

Проверьте конфигурацию для подготовленных виртуальных машин с помощью интерфейса командной строки или портала Azure. Если вы не готовы к миграции и хотите вернуть предыдущее состояние, используйте следующую команду.

	azure network vnet abort-migration virtualnetworkname

Если подготовленная конфигурация вас устраивает, можете продолжать процесс. Выполните следующую команду, чтобы зафиксировать ресурсы.

	azure network vnet commit-migration virtualnetworkname

## Дальнейшие действия

- [Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Resource Manager](virtual-machines-windows-migration-classic-resource-manager.md)
- [Техническое руководство по поддерживаемому платформой переносу из классической модели в модель Resource Manager](virtual-machines-windows-migration-classic-resource-manager-deep-dive.md)

<!---HONumber=AcomDC_0601_2016-->