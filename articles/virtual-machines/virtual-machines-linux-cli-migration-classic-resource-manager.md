<properties
	pageTitle="Перенос ресурсов IaaS из классической модели в модель Azure Resource Manager с помощью интерфейса командной строки Azure"
	description="В этой статье рассматривается поддерживаемый платформой перенос ресурсов из классической модели в модель Azure Resource Manager"
	services="virtual-machines-linux"
	documentationCenter=""
	authors="mahthi"
	manager="drewm"
	editor=""
	tags="azure-resource-manager"/>

<tags
	ms.service="virtual-machines-windows"
	ms.workload="infrastructure-services"
	ms.tgt_pltfrm="vm-linux"
	ms.devlang="na"
	ms.topic="article"
	ms.date="05/04/2016"
	ms.author="mahthi"/>

# Перенос ресурсов IaaS из классической модели в модель Azure Resource Manager с помощью интерфейса командной строки Azure

В этой статье показано, как использовать команды интерфейса командной строки Azure для переноса ресурсов IaaS из классической модели в модель Resource Manager. Для выполнения инструкций требуется войти в [интерфейс командной строки Azure](../xplat-cli-install.md) (`azure login`).

## Шаг 1. Подготовка к переносу

Ниже приведено несколько рекомендаций для этапа оценки переноса ресурсов IaaS из классической модели в модель Resource Manager.

- Список неподдерживаемых конфигураций и функций см. [здесь](virtual-machines-windows-migration-classic-resource-manager.md). Если у вас есть виртуальные машины, которые используют неподдерживаемые конфигурации или функции, мы рекомендуем отложить перенос до того момента, пока не будет заявлено об их поддержке. Также вы можете удалить такую функцию или вынести ее за пределы конфигурации, чтобы выполнить перенос.
-	Если у вас уже есть автоматизированные скрипты для развертывания инфраструктуры и приложений, попробуйте создать с их помощью тестовую среду с аналогичной конфигурацией для проверки процесса переноса. Также вы можете использовать среду, созданную с помощью образцов на портале Azure.
- Так как служба работает в режиме общедоступной предварительной версии, тестовая среда для переноса должна быть изолирована от рабочей среды. Не используйте в тестовой и рабочей средах одни и те же учетные записи хранения, виртуальные сети или другие общие ресурсы.

## Шаг 2. Настройка подписки и регистрация в общедоступной предварительной версии переноса

Для сценариев миграции следует настроить среду для классической модели и модели Resource Manager. [Установите интерфейс командной строки Azure](../xplat-cli-install.md) и [выберите подписку](../xplat-cli-connect.md).

Выберите подписку Azure с помощью следующей команды.

	azure account set "azure-subscription-name"

Зарегистрируйтесь для использования общедоступной предварительной версии с помощью следующей команды. Обратите внимание: хотя в некоторых случаях при выполнении этой команды будет превышено время ожидания, регистрация завершится успешно. Выполните следующий шаг, чтобы проверить состояние регистрации.

	azure provider register Microsoft.ClassicInfrastructureMigrate

Подождите пять минут для завершения регистрации. Состояние регистрации можно проверить, выполнив следующую команду. Прежде чем продолжить, убедитесь, что параметр RegistrationState получил значение Registered.

	azure provider show Microsoft.ClassicInfrastructureMigrate

Теперь переключите интерфейс командной строки в режим asm.

	azure config mode asm

## Шаг 3. Команды для переноса ресурсов IaaS

>[AZURE.NOTE] Обратите внимание, что все описанные ниже действия являются идемпотентными. Если вы столкнетесь с любой проблемой, кроме сообщений о неподдерживаемых функциях или ошибках конфигурации, мы рекомендуем повторить подготовку, отменить или зафиксировать текущую операцию. Платформа автоматически повторит попытку.

### Перенос виртуальных машин в облачную службу (не в виртуальную сеть)

Получите список облачных служб, выполнив следующую команду, а затем выберите облачную службу для переноса. Обратите внимание: если виртуальные машины в облачной службе входят в виртуальную сеть или для них назначены веб-роли или рабочие роли, вы получите сообщение об ошибке.

	azure service list

Выполните следующую команду, чтобы получить имя развертывания для облачной службы из подробных выходных данных. В большинстве случаев имя развертывания совпадает с именем облачной службы.

	azure service show servicename -vv

Подготовьте к переносу виртуальные машины в облачной службе. Здесь у вас есть два варианта.

Если вы хотите перенести виртуальные машины в виртуальную сеть, автоматически созданную платформой, используйте следующую команду.

	azure service deployment prepare-migration servicename deploymentname new "" "" ""

Если перенос будет осуществляться в существующую виртуальную сеть с помощью модели развертывания Resource Manager, используйте следующую команду.

	azure service deployment prepare-migration serviceName deploymentName existing destinationVNETResourceGroupName subnetName vnetName

Когда операция подготовки успешно завершится, вы можете просмотреть подробные данные о состоянии миграции виртуальной машины, чтобы проверить, что все виртуальные машины находятся в состоянии Prepared.

	azure vm show vmName -vv

Проверьте конфигурацию подготовленных ресурсов с помощью интерфейса командной строки или портала Azure. Если вы не готовы к переносу и хотите вернуться к прежнему состоянию, используйте следующую команду.

	azure service deployment abort-migration serviceName deploymentName

Если подготовленная конфигурация вас устраивает, можете продолжать процесс. Выполните следующую команду, чтобы зафиксировать ресурсы.

	azure service deployment commit-migration serviceName deploymentName

### Перенос виртуальных машин в виртуальную сеть

Выберите виртуальную сеть, в которую будете переносить ресурсы. Обратите внимание: если в виртуальной сети есть виртуальные машины, веб-роли или рабочие роли с неподдерживаемой конфигурацией, вы получите сообщение об ошибке проверки.

Выполните следующую команду для получения всех виртуальных сетей в подписке.

	azure network vnet list

Подготовьте выбранную виртуальную сеть для переноса, используя следующую команду.

	azure network vnet prepare-migration virtualnetworkname

Проверьте конфигурацию подготовленных виртуальных машин с помощью интерфейса командной строки или портала Azure. Если вы не готовы к переносу и хотите вернуться к прежнему состоянию, используйте следующую команду.

	azure network vnet abort-migration virtualnetworkname

Если подготовленная конфигурация вас устраивает, можете продолжать процесс. Выполните следующую команду, чтобы зафиксировать ресурсы.

	azure network vnet commit-migration virtualnetworkname

## Ссылки

- [Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager](virtual-machines-windows-migration-classic-resource-manager.md)
- [Техническое руководство по поддерживаемому платформой переносу из классической модели в модель Azure Resource Manager](virtual-machines-windows-migration-classic-resource-manager-deep-dive.md)

<!---HONumber=AcomDC_0511_2016-->