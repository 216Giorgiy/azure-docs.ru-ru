<properties 
	pageTitle="Хранение данных SQL Server и рабочих нагрузок операций на виртуальных машинах Azure"
	description="Описывает предварительно настроенные и оптимизированные образы виртуальных машин SQL Server в Azure для хранилища данных и рабочих нагрузок OLTP."
	services="virtual-machines"
	documentationCenter="na"
	authors="rothja"
	manager="jeffreyg"
	editor="monicar" />
<tags 
	ms.service="virtual-machines"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="vm-windows-sql-server"
	ms.workload="infrastructure-services"
	ms.date="08/19/2015"
	ms.author="jroth" />

# Хранение данных SQL Server и рабочих нагрузок операций на виртуальных машинах Azure

Чтобы использовать SQL Server для хранения данных или транзакционных рабочих нагрузок на виртуальной машине Azure, рекомендуется применять один из предварительно настроенных образов виртуальных машин из коллекции виртуальных машин Azure. Эти образы оптимизированы согласно рекомендациям статьи [Рекомендации по оптимизации производительности SQL Server на виртуальных машинах Azure](https://msdn.microsoft.com/library/azure/dn133149.aspx).

В этом разделе описывается, как запустить эти рабочие нагрузки на виртуальных машинах Azure (известных также как инфраструктура как услуга или IaaS). В Azure вы также можете запускать хранилище данных и транзакционные рабочие нагрузки в виде службы. Дополнительные сведения см. в статьях [Документация по хранилищу данных SQL Azure](http://azure.microsoft.com/documentation/services/sql-data-warehouse/) и [База данных SQL Azure ](http://azure.microsoft.com/documentation/services/sql-database/).

## Какие предварительно настроенные образы виртуальных машин доступны?

В коллекции виртуальных машин Azure доступны следующие предварительно настроенные образы виртуальных машин:

- [SQL Server 2014 Enterprise, оптимизированный для транзакционных рабочих нагрузок на Windows Server 2012 R2](http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2014fortransactionalworkloadswindowsserver2012r2/)

- [SQL Server 2014 Enterprise, оптимизированный для хранилища данных на Windows Server 2012 R2](http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2014datawarehousingwindowsserver2012r2/)

- [SQL Server 2012 Enterprise с пакетом обновления 2 (SP2), оптимизированный для транзакционных рабочих нагрузок на Windows Server 2012 R2](http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2012sp2fortransactionalworkloadswindowsserver2012r2)

- [SQL Server 2012 Enterprise с пакетом обновления 2 (SP2), оптимизированный для рабочих нагрузок хранилища данных на Windows Server 2012 R2](http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2012sp2datawarehousingworkloadswindowsserver2012r2)

- [SQL Server 2012 Enterprise с пакетом обновления 2 (SP2), оптимизированный для транзакционных рабочих нагрузок на Windows Server 2012](http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2012sp2fortransactionalworkloadswindowsserver2012/)

- [SQL Server 2012 Enterprise с пакетом обновления 2 (SP2), оптимизированный для хранилища данных на Windows Server 2012](http://azure.microsoft.com/marketplace/partners/microsoft/sqlserver2012sp2datawarehousingworkloadswindowsserver2012/)

В настоящее время корпорация Майкрософт поддерживает эти образы на экземплярах виртуальных машин, которые позволяют подключать до 16 дисков данных для предоставления максимальной производительности (или суммарной пропускной способности). Эти экземпляры имеют уровень Standard размера A4, A7, A8, A9, D4, D13, D14, F3, G4 и G5 и уровень Basic размера A4. Ознакомьтесь со статьей [Размер виртуальных машин в Azure](virtual-machines-size-specs.md), чтобы узнать о размерах и параметрах подробнее.

>[AZURE.NOTE]Предыдущие образы транзакций и хранилища данных из коллекции доступны до сентября 2014 года. Однако для использования этих образов необходимо подключить диски данных. Рекомендуется пользоваться более новыми образами, так как они готовы к работе сразу после подготовки.

## Подготовка виртуальной машины SQL из коллекции, использующей образы транзакций и хранилища данных

1. Выполните вход на [портал управления Azure](http://manage.windowsazure.com/).

1. На портале Azure в левой области щелкните **ВИРТУАЛЬНАЯ МАШИНА**.

1. В нижнем левом углу щелкните **СОЗДАТЬ**, а затем — **СРЕДА ВЫПОЛНЕНИЯ ПРИЛОЖЕНИЯ**, **ВИРТУАЛЬНАЯ МАШИНА** и **ИЗ КОЛЛЕКЦИИ**.

1. На странице выбора образа виртуальной машины выберите один из SQL Server для образов транзакции или хранилища данных.

	![Коллекция виртуальных машин Azure](./media/virtual-machines-sql-server-dw-and-oltp-workloads/IC814362.png)

1. На странице **Конфигурация виртуальной машины** в параметре **РАЗМЕР** выберите один из поддерживаемых размеров.

	![Конфигурация коллекции виртуальных машин Azure](./media/virtual-machines-sql-server-dw-and-oltp-workloads/IC814363.png)

	>[AZURE.NOTE]В настоящее время поддерживаются только уровень Standard размера A4, A7, A8, A9, D4, D13, D14, G3, G4 и G5 и уровень Basic размера A4. Подготовка неподдерживаемого размера виртуальной машины невозможна.

1. Дождитесь завершения подготовки. Во время ожидания на странице виртуальной машины будет отображаться состояние подготовки (как показано на рисунке ниже). После завершения подготовки состояние будет отмечено флажком **Выполняется**.

	![Состояние коллекции виртуальных машин Azure](./media/virtual-machines-sql-server-dw-and-oltp-workloads/IC814364.png)

## Использование PowerShell для создания образов транзакции или хранилища данных

Для создания виртуальной машины вы также можете использовать командлет PowerShell **New-AzureQuickVM**. В качестве параметров необходимо передать имя облачной службы, имя виртуальной машины, имя образа, имя администратора, его пароль и аналогичные сведения. Для простого получения списка доступных образов виртуальных машин воспользуйтесь командлетом **Get-AzureVMImage**.

Например, следующая команда PowerShell возвращает самый последний образ, соответствующий метке **SQL Server 2012 Enterprise с пакетом обновления 2 (SP2), оптимизированный для рабочих нагрузок хранилища данных на Windows Server 2012 R2** из списка их предыдущего раздела.

	(Get-AzureVMImage | where {$_.Label -like "SQL Server 2012 SP2 Enterprise Optimized for DataWarehousing Workloads on Windows Server 2012 R2"} | sort PublishedDate -Descending)[0].ImageName

Дополнительные сведения о создании образов с помощью PowerShell см. в статье [Использование Azure PowerShell для создания и предварительной настройки виртуальных машин под управлением Windows](virtual-machines-ps-create-preconfigure-windows-vms.md).

## Конкретные конфигурации, включенные в образы транзакций и хранилища данных

Оптимизация образов основывается на [Рекомендациях по оптимизации производительности SQL Server на виртуальных машинах Azure](https://msdn.microsoft.com/library/azure/dn133149.aspx). В частности, конфигурация для этих образов включает следующие оптимизации.

>[AZURE.NOTE]Если вы предоставляете собственную лицензию и создаете виртуальную машину хранилища данных или транзакций с нуля, вы можете выполнить оптимизацию на основе раздела по производительности и примера оптимизации в предварительно настроенных образах коллекции, представленного ниже.

### Конфигурации дисков


|---|---|
|Количество присоединенных дисков данных|15|
|Дисковое пространство|Два пула носителей:<br/>-- 1 пул данных с 12 дисками данных; фиксированный размер = 12 ТБ; столбцов = 12<br/>-- 1 пул журналов с 3 дисками данных; фиксированный размер = 3 ТБ; столбцов = 3<br/><br/>Один диск данных остается в распоряжении пользователя, который определяет, куда его присоединить и для чего использовать.<br/><br/>**Хранилище данных**: размер полосы = 256 КБ<br/>**Транзакционный**: размер полосы = 64 КБ|
|Размеры дисков, кэширование, размер выделения|1 ТБ каждый, HostCache = None, размер единицы размещения NTFS = 64 КБ|

### Конфигурации SQL Server

|---|---|
|Параметры запуска|-T1117 для помощи в сохранении аналогичного размера файлов данных в случае, если базе данных требуется автоувеличение<br/><br/>-T1118 для помощи в масштабировании tempdb (дополнительные сведения см. в статье [Использование флагов трассировки 1118 (-T1118) в SQL Server (2005 и 2008)](http://blogs.msdn.com/b/psssql/archive/2008/12/17/sql-server-2005-and-2008-trace-flag-1118-t1118-usage.aspx?WT.mc_id=Blog_SQL_Announce_Announce).)|
|Модель восстановления|**Хранилище данных**: с помощью инструкции ALTER DATABASE укажите для модели базы данных значение SIMPLE<br/>**Транзакционная**: без изменений|
|Настройка расположения по умолчанию|Переместите журнал ошибок SQL Server и каталоги файлов трассировки на диски данных|
|Расположение по умолчанию для баз данных|Системные базы данных перемещаются на диски данных.<br/><br/>Новые пользовательские базы данных размещаются на дисках данных.|
|Мгновенная инициализация файлов|Включено|
|Блокировка страниц в памяти|Включено (дополнительные сведения см. в статье [Включение параметра "Блокировка страниц в памяти" (Windows)](https://msdn.microsoft.com/library/ms190730.aspx).|

## Часто задаваемые вопросы

- Есть ли разница между оптимизированными и не оптимизированными образами?

	Нет. Оптимизированные образы оплачиваются по той же цене (подробнее можно узнать [здесь](http://azure.microsoft.com/pricing/details/virtual-machines/)) без дополнительной наценки. Обратите внимание, что более высокая стоимость связана с большим размером экземпляра виртуальной машины.

- Следует ли рассматривать какие-либо другие возможности оптимизации производительности?

	Да, рассмотрите возможность применения соответствующих исправления для SQL Server:

	- [Исправление. Низкая производительность ввода-вывода при выполнении операции выборки во временную таблицу в SQL Server 2012](https://support.microsoft.com/kb/2958012).

	- [Исправление. Появление сообщения о том, что "Счетчики производительности SQL Server отключены", при перемещении ресурсов SQL Server в SQL Server 2014](http://support.microsoft.com/kb/2973444).

- Как найти дополнительную информацию о дисковом пространстве?

	Для получения сведений о дисковом пространстве обратитесь к статье [Дисковое пространство. Вопросы и ответы](http://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx).

- В чем различие между новым и предыдущим образами хранилища данных?

	Предыдущий образ хранилища данных требует от пользователей выполнения дополнительных действий, например присоединения дисков данных после создания виртуальной машины, тогда как новый образ хранилища данных готов к использованию с момента создания, то есть он становится доступен быстрее, а вероятность возникновения ошибок уменьшается.

- Мне нужна предыдущая версия образа хранилища данных. Можно ли получить к ней доступ?

	Предыдущие образы виртуальных машин по-прежнему доступны, просто не напрямую из коллекции. Вместо этого вы можете воспользоваться командлетами Powershell. Например, можно использовать командлет **Get-AzureVMImage**, чтобы получить список всех образов, а после определения расположения предыдущего образа хранилища данных с помощью описания и даты публикации воспользоваться командлетом **New-AzureVM**, чтобы подготовить этот образ.

## Дальнейшие действия

После установки виртуальной машины с помощью SQL Server вам, скорее всего, потребуется следующее:

- [Перенос данных](virtual-machines-migrate-onpremises-database.md)
- [Настройка подключения](virtual-machines-sql-server-connectivity.md)

Другие темы, связанные с запуском SQL Server на виртуальных машинах Azure, см. в статье [SQL Server на виртуальных машинах Azure](virtual-machines-sql-server-infrastructure-services.md).

<!---HONumber=August15_HO8-->