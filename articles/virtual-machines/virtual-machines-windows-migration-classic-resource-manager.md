<properties
	pageTitle="Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager | Microsoft Azure"
	description="В этой статье последовательно описывается поддерживаемый платформой перенос ресурсов из классической модели в модель Azure Resource Manager."
	services="virtual-machines-windows"
	documentationCenter=""
	authors="mahthi"
	manager="drewm"
	editor=""
	tags="azure-resource-manager"/>

<tags
	ms.service="virtual-machines-windows"
	ms.workload="infrastructure-services"
	ms.tgt_pltfrm="vm-windows"
	ms.devlang="na"
	ms.topic="article"
	ms.date="05/04/2016"
	ms.author="mahthi"/>

# Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager

Почти год назад мы объявили о поддержке виртуальных машин в рамках модели Azure Resource Manager. Вы можете ознакомиться со сведениями об улучшениях и дополнительных возможностях, которые поддерживает решение, в других статьях. Кроме того, мы предоставили рекомендации о том, как лучше всего подключить ресурсы из двух моделей развертывания и обеспечить их сосуществование в подписке с помощью шлюзов с подключением типа "сеть — сеть" в виртуальной сети. В этой статье описывается, как обеспечить перенос ресурсов IaaS из классической модели в модель Resource Manager.

## Цель миграции

Благодаря выпуску новой модели вы получаете возможность развертывать и отслеживать связанные службы в группе ресурсов, а также управлять ими. Resource Manager позволяет развертывать сложные приложения с помощью шаблонов, настраивать виртуальные машины с помощью расширений виртуальных машин и внедрять управление доступом и добавление тегов. С его помощью также можно выполнить масштабируемое параллельное развертывание виртуальных машин в группы доступности. Кроме того, новая модель предоставляет возможности независимого управления жизненным циклом для вычислительных и сетевых ресурсов, а также ресурсов хранилища. И наконец, благодаря принудительному использованию виртуальных машин в виртуальной сети появилась возможность включать защиту по умолчанию.

Почти все функции для выполнения вычислений, работы с сетью и хранилищем из классической модели развертывания поддерживаются в модели Azure Resource Manager. В связи с этими новыми возможностями и растущей базой развертываний в Azure Resource Manager мы хотим, чтобы у клиентов была возможность перенести существующие развертывания из классической модели развертывания.

>[AZURE.NOTE] На этапе общедоступной предварительной версии рекомендуется переносить в подписку Azure только рабочие нагрузки, не относящиеся к рабочей среде.

## Изменение возможностей автоматизации и набора инструментов после миграции

При переносе ресурсов из классической модели в модель Resource Manager потребуется обновить существующую среду автоматизации или набор инструментов, чтобы обеспечить их работу после миграции.

## Значение переноса ресурсов IaaS из классической модели в модель Resource Manager

Прежде чем углубляться в подробности, мы хотели бы кратко объяснить разницу между операциями с ресурсами IaaS в плоскости данных и плоскости управления. Очень важно понять эту разницу, потому что это виляет на то, как мы планируем реализовать поддержку миграции.

- *Плоскость управления* описывает вызовы, поступающие в плоскость управления или API для изменения ресурсов. Например, такие операции, как создание виртуальной машины, перезапуск виртуальной машины и добавление в виртуальную сеть новой подсети, оперируют работающими ресурсами. Они не оказывают непосредственного влияния на подключение к экземплярам.
- *Плоскость данных* (приложение) описывает среду выполнения приложения, включая взаимодействие с экземплярами, которое не осуществляется через API Azure. Доступ к веб-сайту или извлечение данных из работающего экземпляра SQL Server или сервера MongoDB будут считаться операциями в плоскости данных или взаимодействием с приложением. Копирование большого двоичного объекта из учетной записи хранения и доступ к общедоступному IP-адресу для подключения к виртуальной машине по протоколу RDP или SSH также являются операциями в плоскости данных. Эти операции обеспечивают рабочее состояние приложения для вычислительных и сетевых ресурсов, а также ресурсов хранения.

>[AZURE.NOTE] В некоторых сценариях миграции требуется остановить виртуальные машины, отменить их распределение, а затем перезапустить. Это приведет к кратковременному простою плоскости данных.

## Поддерживаемые области применения миграции

На этапе общедоступной предварительной версии предлагаются две области применения миграции, главным образом предназначенные для вычислительных и сетевых ресурсов. Чтобы обеспечить бесперебойную миграцию, мы добавили поддержку дисков для виртуальных машин Resource Manager в классических учетных записях хранения.

### Перенос виртуальных машин (не в виртуальной сети)

В модели развертывания с помощью Resource Manager защита приложений применяется принудительно по умолчанию. В данной модели все виртуальные машины должны находиться в виртуальной сети. Следовательно, в ходе миграции будет выполняться перезагрузка (`Stop`, `Deallocate` и `Start`) виртуальных машин. Существует два варианта для виртуальных сетей.
- Вы можете отправить к платформе запрос на создание новой виртуальной сети и перенести виртуальную машину в нее.
- Вы можете перенести виртуальную машину в существующую виртуальную сеть в Resource Manager.

>[AZURE.NOTE] При такой области применения во время миграции, возможно, какое-то время будет запрещено выполнять операции в плоскости управления и плоскости данных.

### Перенос виртуальных машин (в виртуальной сети)

При такой области применения для большинства конфигураций виртуальных машин между классической моделью и моделью Resource Manager переносятся только метаданные. Базовые виртуальные машины работают на одном оборудовании, в одной сети и в одном хранилище. Поэтому, если мы говорим о переносе метаданных из классической модели в модель Resource Manager, возможно, какое-то время в ходе миграции будет запрещено выполнять операции в плоскости управления. Однако выполнение операций в плоскости данных прерываться не будет. То есть приложения, запущенные в виртуальных машинах (классическая модель), не будут простаивать во время миграции.

Ниже приведены конфигурации, которые в настоящее время не поддерживаются. В случае добавления поддержки для них в будущем возможен простой некоторых виртуальных машин в этой конфигурации (остановка, отмена распределения и перезапуск).

-	В отдельной облачной службе есть несколько групп доступности.
-	В отдельной облачной службе есть одна или несколько групп доступности, а также виртуальные машины, которые не входят в группу доступности.

>[AZURE.NOTE] При такой области применения миграции в течение определенного периода, возможно, будет запрещено выполнять операции в плоскости управления. В некоторых конфигурациях, как описано выше, будет возникать простой в плоскости данных.

### Учетные записи хранения и миграция

Миграция учетных записей хранения не поддерживается для этой общедоступной предварительной версии.

Чтобы обеспечить бесперебойную миграцию, мы добавили возможность развертывания виртуальных машин Resource Manager в классической учетной записи хранения. Благодаря этой возможности вычислительные и сетевые ресурсы можно и нужно переносить независимо от учетных записей хранения.

## Неподдерживаемые компоненты и конфигурации

В настоящее время не поддерживаются некоторые компоненты и конфигурации. В следующих разделах приведены рекомендации по ним.

### Неподдерживаемые функции

Перечисленные ниже компоненты не поддерживаются для общедоступной предварительной версии. Дополнительно вы можете удалить эти параметры, перенести виртуальные машины, а затем повторно включить параметры в модели развертывания с помощью Resource Manager.

Поставщик ресурсов | Функция
---------- | ------------
Среда выполнения приложений | Диагностика загрузки.
Среда выполнения приложений | Несвязанные диски виртуальных машин.
Среда выполнения приложений | Образы виртуальных машин.
Сеть | Несвязанные зарезервированные IP-адреса (без привязки к виртуальной машине). Поддерживаются зарезервированные IP-адреса, привязанные к виртуальным машинам.
Сеть | Несвязанные группы безопасности сети (без привязки к виртуальной сети или сетевому интерфейсу). Поддерживаются группы безопасности сети, на которые ссылаются виртуальные сети.
Сеть | Списки управления доступом для конечной точки.
Сеть | Шлюзы виртуальной сети ("сеть — сеть", Azure ExpressRoute, "точка — сеть").
Хранилище | Учетные записи хранения.

### Неподдерживаемые конфигурации

Перечисленные ниже конфигурации не поддерживаются для общедоступной предварительной версии.

служба | Конфигурация | Рекомендации
---------- | ------------ | ------------
Диспетчер ресурсов | Управление доступом на основе ролей (RBAC) для классических ресурсов | Так как после миграции универсальные коды ресурсов (URI) меняются, рекомендуется спланировать обновления политики RBAC, которые должны быть применены после миграции.
Среда выполнения приложений | Несколько подсетей, связанных с одной виртуальной машиной | Следует обновить конфигурацию подсетей, чтобы в ссылках были указаны только подсети.
Среда выполнения приложений | Виртуальные машины, размещенные в виртуальной сети, но без явно назначенной подсети | При необходимости можно удалить виртуальную машину.
Среда выполнения приложений | Виртуальные машины с оповещениями и политиками автомасштабирования | В этом случае миграция выполнится, а эти параметры будут сброшены. Поэтому перед миграцией настоятельно рекомендуется оценить среду. Как вариант, можно настроить параметры оповещений после завершения миграции.
Среда выполнения приложений | Расширения виртуальных машин XML (отладчик Visual Studio, веб-развертывания и удаленная отладка) | Это не поддерживается. Чтобы продолжить миграцию, рекомендуется удалить эти расширения из виртуальной машины.
Среда выполнения приложений | Облачные службы, содержащие веб-роли и рабочие роли | В настоящее время это не поддерживается.
Сеть | Виртуальные сети, содержащие виртуальные машины, а также веб-роли и рабочие роли | В настоящее время это не поддерживается.
Сеть | Подсети, в именах которых есть пробелы | В настоящее время это не поддерживается.
Служба приложений Azure | Виртуальные сети, содержащие среды службы приложений | В настоящее время это не поддерживается.
Azure HDInsight | Виртуальные сети, содержащие службы HDInsight | В настоящее время это не поддерживается.
Microsoft Dynamics Lifecycle Services | Виртуальные сети, содержащие виртуальные машины под управлением служб Dynamics Lifecycle Services | В настоящее время это не поддерживается.

## Процесс миграции

Прежде чем начать миграцию, настоятельно рекомендуется следующее.

- Убедитесь, что ресурсы, которые вы хотите перенести, не используют какие-либо неподдерживаемые компоненты или конфигурации. В большинстве случаев платформа обнаруживает такие проблемы и выдает ошибку.
- В ходе подготовки виртуальные машины, которые не находятся в виртуальной сети, будут остановлены, а их распределение отменено. Если вы не хотите потерять общедоступный IP-адрес, зарезервируйте его, прежде чем начать подготовку. Виртуальные машины, которые расположены в виртуальной сети, не будут остановлены, а их распределение не будет отменено.
- На данном этапе не следует пытаться перенести рабочие ресурсы.
- Планируйте провести миграцию в нерабочее время, чтобы справиться с любыми непредвиденными сбоями, которые могут возникнуть.
- Скачайте текущую конфигурацию виртуальных машин с помощью PowerShell, команд интерфейса командной строки или интерфейсов REST API, чтобы упростить проверку после завершения подготовки.
- Обновите сценарии автоматизации и ввода в эксплуатацию для работы с моделью развертывания с помощью Resource Manager, прежде чем начать миграцию. При необходимости можно выполнять операции GET, пока ресурсы находятся в состоянии подготовки.
- Оцените политики RBAC, настроенные для классических ресурсов IaaS, и составьте план на период после завершения миграции.

Ниже представлен рабочий процесс миграции. Объявляя о выпуске общедоступной предварительной версии, мы сообщаем, что добавили поддержку активации миграции с помощью интерфейсов REST API, PowerShell и Azure CLI.

![Снимок экрана с этапами миграции](./media/virtual-machines-windows-migration-classic-resource-manager/migration-workflow.png)

>[AZURE.NOTE] Все операции, описанные в следующих разделах, являются идемпотентными. Если вы столкнетесь с какой-либо проблемой, не связанной с неподдерживаемой функцией или ошибкой конфигурации, мы рекомендуем повторить подготовку, прервать или зафиксировать текущую операцию. Платформа повторит попытку.

### Подготовка.

Операция подготовки — это первый этап в процессе миграции. На этом этапе моделируется преобразование классических ресурсов IaaS в ресурсы Resource Manager, после чего на экране рядом отображаются ресурсы до и после преобразования для наглядности.

Вы выберете виртуальную сеть или размещенную службу (если она не является виртуальной сетью), которую нужно подготовить к миграции.

Сначала платформа будет анализировать данные для переносимых ресурсов в фоновом режиме и сообщать об успешном завершении или сбое в зависимости от того, можно ли перенести ресурсы.

* Если ресурсы невозможно перенести, платформа укажет соответствующие причины.
* Если ресурс можно перенести, платформа сначала заблокирует для него операции в плоскости управления. Например, вы не сможете добавить диск данных в виртуальную машину, которая переносится.

Затем платформа начнет перенос метаданных переносимых ресурсов из классической модели в модель Resource Manager.

После завершения подготовки можно будет визуализировать ресурсы в классической модели и модели Resource Manager. Для каждой облачной службы в классической модели развертывания мы создадим имя группы ресурсов по шаблону `cloud-service-name>-migrated`.

### Проверка (вручную или с помощью сценария)

На этапе проверки можно дополнительно использовать конфигурацию, скачанную ранее, чтобы проверить, выполнена ли миграция правильно. Можно также войти на портал и выборочно просмотреть свойства и ресурсы, чтобы проверить, выполнена ли миграция метаданных должным образом.

В случае переноса виртуальной сети большинство конфигураций виртуальных машин не будут перезапущены. Однако можно проверить, работают ли приложения в виртуальных машинах.

Можно проверить мониторинг и автоматизацию, а также рабочие сценарии, чтобы убедиться, что виртуальные машины работают надлежащим образом и обновленные сценарии работают правильно. Обратите внимание, что если ресурсы находятся в состоянии подготовки, то для них доступны только операции GET.

Длительность миграции не фиксирована. В этом состоянии время не ограничено. Однако имейте в виду, что плоскость управления для этих ресурсов будет заблокирована, пока не будет выполнено прерывание или фиксация.

Если возникнут какие-либо неполадки, всегда можно прервать миграцию и вернуться к классической модели развертывания. После этого операции с ресурсами в плоскости управления будут разблокированы, чтобы вы могли возобновить обычную работу этих виртуальных машин в классической модели развертывания.

### Прерывание

Прерывание — необязательный шаг, который позволяет отменить изменения классической модели развертывания и прервать миграцию. Обратите внимание на то, что эту операцию нельзя выполнить после активации операции фиксации.

### Фиксация

После завершения проверки миграцию можно зафиксировать. Ресурсы больше не будут отображаться в классической модели и будут доступны только в модели развертывания с помощью Resource Manager. Это также означает, что перенесенными ресурсами можно управлять только на новом портале.

При сбое этой операции рекомендуется выполнить ее повторно несколько раз. Если проблема не устраняется, отправьте запрос в службу поддержки или создайте запись с тегом ClassicIaaSMigration на нашем [форуме о виртуальных машинах](https://social.msdn.microsoft.com/Forums/azure/ru-RU/home?forum=WAVirtualMachinesforWindows).

## Часто задаваемые вопросы

**Влияет ли этот план миграции на существующие службы или приложения, которые выполняются на виртуальных машинах Azure?**

Нет. Виртуальные машины (классические) — это службы, которые полностью поддерживаются в общедоступной версии. Можно продолжать использовать эти ресурсы, чтобы расширить занимаемый объем в Microsoft Azure.

**Что произойдет с моей виртуальной машиной, если я не планирую перенос в ближайшем будущем?**

Мы не прекратим предоставлять поддержку существующих интерфейсов API и ресурсов классической модели. Мы хотим максимально упростить миграцию с помощью расширенных функций, доступных в модели развертывания с помощью Resource Manager. Настоятельно рекомендуется рассмотреть [некоторые улучшения](virtual-machines-windows-compare-deployment-models.md), добавленные в Resource Manager как часть IaaS.

**Как изменятся существующие средства с этим планом миграции?**

Одним из важнейших изменений, которое следует учесть в плане миграции, является обновление набора инструментов до модели развертывания Resource Manager.

**Сколько времени продлится простой плоскости управления?**

Это зависит от числа переносимых ресурсов. В случае развертываний небольшого размера (с несколькими десятками виртуальных машин) вся миграция должна занимать не больше часа. В случае крупномасштабных развертываний (с сотнями виртуальных машин) миграция может длиться несколько часов. Так как служба находится на этапе общедоступной предварительной версии, настоятельно рекомендуется выполнить миграцию в подписке для разработки или тестирования, чтобы оценить ее воздействие.

**Можно ли выполнить откат после фиксации переносимых ресурсов в Resource Manager?**

Миграцию можно прервать, пока ресурсы находятся в состоянии подготовки. Откат после миграции ресурсов с фиксацией не поддерживается.

**Можно ли откатить миграцию при сбое фиксации?**

Прервать миграцию при сбое фиксации нельзя. Все операции миграции, включая фиксацию, являются идемпотентными. Поэтому рекомендуется повторить операцию спустя некоторое время. Если ошибка все равно возникает, отправьте запрос в службу поддержки или создайте запись с тегом ClassicIaaSMigration на нашем [форуме о виртуальных машинах](https://social.msdn.microsoft.com/Forums/azure/ru-RU/home?forum=WAVirtualMachinesforWindows).

**Нужно ли приобретать еще один канал ExpressRoute, если нужно использовать ресурсы IaaS в модели Resource Manager?**

Нет. Мы недавно сделали возможным [сосуществование канала ExpressRoute в классической модели и модели Resource Manager](../expressroute/expressroute-howto-coexist-resource-manager.md). Поэтому при наличии существующего канала ExpressRoute не нужно приобретать еще один.

**Что произойдет, если для классических ресурсов IaaS настроено управление доступом на основе ролей?**

Во время миграции ресурсы преобразуются из классической модели в модель Resource Manager. Поэтому рекомендуется спланировать обновления политики RBAC, которые следует применить после миграции.

**Что если я использую Azure Site Recovery или службу архивации Azure в настоящее время?**

Недавно мы добавили поддержку Azure Site Recovery и службы архивации Azure в Resource Manager. Кроме того, мы активно работаем над поддержкой переноса виртуальных машин в Resource Manager. В настоящее время, если вы используете эти службы, рекомендуется не выполнять миграцию.

**Можно ли проверить подписку или ресурсы, чтобы узнать, подходят ли они для миграции?**

В данный момент при подготовке выполняется неявная проверка ресурсов, которые подготавливаются к миграции. На первом этапе подготовки к поддерживаемой платформой миграции проверяется, можно ли перенести ресурсы. В случае сбоя проверки ресурсы не будут использоваться.

**Что произойдет, если при подготовке ресурсов IaaS к миграции произойдет ошибка, связанная с квотой?**

Рекомендуется прервать миграцию и отправить в службу поддержки запрос на увеличение квот в регионе, в который переносятся виртуальные машины. После утверждения запроса на увеличение квоты начните этапы миграции заново.

**Как сообщить о проблеме?**

Публикуйте проблемы и вопросы, относящиеся к миграции, на нашем [форуме о виртуальных машинах](https://social.msdn.microsoft.com/Forums/azure/ru-RU/home?forum=WAVirtualMachinesforWindows), указав ключевое слово ClassicIaaSMigration. Рекомендуется публиковать на этом форуме все свои вопросы. Если у вас есть контракт на техническую поддержку, то вы всегда можете зарегистрировать запрос в службу поддержки.

**Что делать, если мне не нравятся имена, которые платформа выбрала для ресурсов во время миграции?**

Имена всех ресурсов, которые указаны явным образом в классической модели развертывания, при миграции будут сохранены. В некоторых случаях будут создаваться дополнительные ресурсы. Например, для каждой виртуальной машины будет создан сетевой интерфейс. В данный момент возможность управления именами этих новых ресурсов, созданных во время миграции, не поддерживается. Проголосуйте за эту функцию на [форуме отзывов об Azure](http://feedback.azure.com).


## Дальнейшие действия
Теперь, когда вы получили представление о миграции классических ресурсов IaaS в Resource Manager, можно приступить к переносу ресурсов.

- [Техническое руководство по поддерживаемому платформой переносу из классической модели в модель Azure Resource Manager](virtual-machines-windows-migration-classic-resource-manager-deep-dive.md)
- [Перенос ресурсов IaaS из классической модели в модель Azure Resource Manager с помощью Azure PowerShell](virtual-machines-windows-ps-migration-classic-resource-manager.md)
- [Перенос ресурсов IaaS из классической модели в модель Azure Resource Manager с помощью интерфейса командной строки Azure](virtual-machines-linux-cli-migration-classic-resource-manager.md)
- [Клонирование классической виртуальной машины в Azure Resource Manager с помощью сценариев PowerShell](virtual-machines-windows-migration-scripts.md)

<!---HONumber=AcomDC_0601_2016-->