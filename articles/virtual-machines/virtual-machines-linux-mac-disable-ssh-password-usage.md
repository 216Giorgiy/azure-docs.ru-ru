---
title: Отключение паролей SSH в виртуальной машине Linux в настройках SSHD | Microsoft Docs
description: Защита виртуальной машины Linux в Azure посредством отключения входа с использованием пароля для SSH.
services: virtual-machines-linux
documentationcenter: ''
author: vlivech
manager: timlt
editor: ''
tags: ''

ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 08/26/2016
ms.author: v-livech

---
# Отключение паролей SSH в виртуальной машине Linux в настройках SSHD
В этой статье рассматривается отключение защиты входа в систему в виртуальной машине Linux. Если открыть SSH-порт номер 22, программы-роботы сразу же будут пытаться войти в систему путем подбора паролей. В этой статье мы отключим вход в систему с паролем по протоколу SSH. За счет полного отключения возможности использовать пароли мы защитим виртуальную машину Linux от атак методом подбора. Дополнительное преимущество состоит в том, что в настройках SSHD Linux вход в систему будет разрешен только с использованием открытых и закрытых ключей SSH, что является наиболее безопасным способом входа в ОС Linux. Число возможных комбинаций при поиске закрытого ключа методом подбора настолько велико, что программы-роботы даже не пытаются использовать этот метод для взлома SSH-ключей.

## Цели
* Настройте SSHD, чтобы запретить:
  * Вход с использованием пароля
  * Вход привилегированного пользователя
  * Проверку подлинности через запрос и ответ
* Настройте SSHD, чтобы разрешить:
  * Вход только с использованием SSH-ключей
* Перезапустите SSHD, не выходя из системы
* Протестируйте новую конфигурацию SSHD

## Введение
[Определение SSH](https://en.wikipedia.org/wiki/Secure_Shell)

SSHD — это SSH-сервер, работающий на виртуальной машине Linux. SSH — это клиент, который запускается из оболочки на рабочей станции MacBook или Linux. SSH — это также протокол, используемый для защиты и шифрования обмена данными между рабочей станцией и виртуальной машиной Linux.

Для этой статьи очень важно держать открытым один сеанс работы с виртуальной машиной Linux в течение прохождения всего пошагового руководства. По этой причине мы откроем два терминала и установим подключение SSH к виртуальной машине Linux из каждого из них. Первый терминал будет использоваться для изменений файла конфигурации SSHD и перезапуска службы SSHD. Второй терминал будет использоваться для тестирования этих изменений после перезапуска службы. Поскольку мы отключаем SSH-пароли и полагаемся исключительно на SSH-ключи, если ваши SSH-ключи неверны и вы закроете подключение к виртуальной машине, эта виртуальная машины окажется безвозвратно заблокированной. Никто не сможет войти в нее, поэтому ее придется удалить и создать заново.

## Предварительные требования
* [Создайте SSH-ключи в Linux и Mac для виртуальных машин Linux в Azure](virtual-machines-linux-mac-create-ssh-keys.md)
* Учетная запись Azure
  * [Бесплатная пробная версия подписки](https://azure.microsoft.com/pricing/free-trial/)
  * [Портал Azure](http://portal.azure.com)
* Виртуальная машина Linux в Azure
* Открытый и закрытый SSH-ключ в `~/.ssh/`
* Открытый SSH-ключ в `~/.ssh/authorized_keys` на виртуальной машине Linux
* Права sudo в виртуальной машине
* Открытый порт 22

## Быстрые команды
*Опытные администраторы Linux, которым требуется только версия TLDR, начинают здесь. Всем остальным, кому нужно подробное описание и пошаговое руководство, следует пропустить этот раздел.*

```
username@macbook$ sudo vim /etc/ssh/sshd_config

# Change PasswordAuthentication to this:
PasswordAuthentication no

# Change PubkeyAuthentication to this:
PubkeyAuthentication yes

# Change PermitRootLogin to this:
PermitRootLogin no

# Change ChallengeResponseAuthentication to this:
ChallengeResponseAuthentication no

# On the Debian Family
username@macbook$ sudo service ssh restart

# On the RedHat Family
username@macbook$ sudo service sshd restart
```

## Подробные пошаговые инструкции
Выполните вход в виртуальную машину Linux с терминала 1 (T1). Выполните вход в виртуальную машину Linux с терминала 2 (T2).

На T2 мы собираемся изменить файл конфигурации SSHD.

```
username@macbook$ sudo vim /etc/ssh/sshd_config
```

Здесь мы изменим только те параметры, которые отключат пароли и включат вход в систему с использованием SSH-ключей. В этом файле множество параметров, которые необходимо изучить и изменить, чтобы организовать безопасность Linux и SSH на необходимом вам уровне.

#### Отключение входа с использованием пароля
```
username@macbook$ sudo vim /etc/ssh/sshd_config

# Change PasswordAuthentication to this:
PasswordAuthentication no
```

#### Включение проверки подлинности с использованием открытого ключа
```
username@macbook$ sudo vim /etc/ssh/sshd_config

# Change PubkeyAuthentication to this:
PubkeyAuthentication yes
```

#### Отключение корневого входа
```
username@macbook$ sudo vim /etc/ssh/sshd_config

# Change PermitRootLogin to this:
PermitRootLogin no
```

#### Отключение проверки подлинности через запрос и ответ
```
# Change ChallengeResponseAuthentication to this:
ChallengeResponseAuthentication no
```

### Перезапуск SSHD
С терминала T1 убедитесь, что вы все еще находитесь в системе. Это важно, чтобы не потерять доступ к виртуальной машине, если SSH-ключи окажутся неправильными, поскольку пароли будут отключены. Если какие-либо параметры виртуальной машины Linux окажутся неправильными, можно будет воспользоваться терминалом T1, чтобы исправить sshd\_config, поскольку у вас сохраняется вход в систему и SSH будет поддерживать соединение во время перезапуска службы SSHD.

С терминала T2 выполните:

##### В семействе Debian
```
username@macbook$ sudo service ssh restart
```

##### В семействе RedHat
```
username@macbook$ sudo service sshd restart
```

Теперь пароли на виртуальной машине отключены, что защищает ее от попыток входа методом подбора пароля. Благодаря тому, что разрешены только SSH-ключи, вы сможете выполнять вход быстрее и гораздо безопаснее.

<!---HONumber=AcomDC_0831_2016-->