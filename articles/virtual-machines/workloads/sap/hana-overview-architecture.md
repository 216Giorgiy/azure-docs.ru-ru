---
title: "Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры) | Документация Майкрософт"
description: "Основные сведения об архитектуре и развертывании SAP HANA в Azure (крупные экземпляры)."
services: virtual-machines-linux
documentationcenter: 
author: RicksterCDN
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 12/01/2016
ms.author: rclaus
ms.custom: H1Hack27Feb2017
ms.translationtype: Human Translation
ms.sourcegitcommit: 54b5b8d0040dc30651a98b3f0d02f5374bf2f873
ms.openlocfilehash: 18501fc0fdb3174b3ec74e3dde3422b27898bf10
ms.contentlocale: ru-ru
ms.lasthandoff: 04/28/2017


---
# <a name="sap-hana-large-instances-overview-and-architecture-on-azure"></a>Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры) 
Это руководство по архитектуре и развертыванию, состоящее из 5 частей. Здесь описывается развертывание SAP в новом решении "SAP HANA в Azure (крупные экземпляры)". Это неполное руководство. Здесь не представлены подробные сведения об установке решений SAP. Вместо этого здесь содержится ценная информация о первоначальном развертывании и управлении текущими операциями. Это руководство не заменяет документацию SAP по установке SAP HANA (и многочисленные примечания для поддержки по SAP, посвященные этой теме). Здесь также представлены подробные сведения об установке SAP HANA в Azure (крупные экземпляры).


В этом руководстве рассматриваются следующие темы:

- [Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)](hana-overview-architecture.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
- [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
- [Как установить и настроить SAP HANA в Azure (крупные экземпляры)](hana-installation.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
- [Высокий уровень доступности и аварийное восстановление SAP HANA в Azure (крупные экземпляры)](hana-overview-high-availability-disaster-recovery.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
- [Как устранять неполадки и отслеживать работу SAP HANA (крупные экземпляры) в Azure](troubleshooting-monitoring.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

## <a name="definitions"></a>Определения

В этом руководстве широко используются некоторые общие определения. Ознакомьтесь со следующими терминами и их описанием.

- **IaaS:** инфраструктура как услуга.
- **PaaS:** платформа как услуга.
- **SaaS:** программное обеспечение как услуга.
- **Компонент SAP:** отдельное приложение SAP, например ECC, BW, Solution Manager или EP. Компоненты SAP могут основываться на традиционной технологии ABAP или Java или быть приложениями не на основе NetWeaver, например бизнес-объектами.
- **Среда SAP:** один или несколько компонентов SAP, логически сгруппированных для выполнения бизнес-функции (разработка, оценка качества, обучение, аварийное восстановление или эксплуатация).
- **Ландшафт SAP:** термин обозначает все ресурсы SAP, доступные в ИТ-ландшафте. Ландшафт SAP включает все рабочие и нерабочие среды.
- **Система SAP**: сочетание уровня СУБД и уровня приложений системы разработки SAP ERP, тестовой системы SAP BW, рабочей системы SAP CRM и т. д. В развертываниях Azure не поддерживается разделение этих двух уровней между локальной средой и Azure. Таким образом, система SAP должна быть развернута полностью в локальной среде или полностью в Azure. Но при этом вы можете развернуть различные системы ландшафта SAP как в Azure, так и локально. Например, системы разработки и тестирования SAP CRM можно развернуть в Azure, а рабочую систему SAP CRM — в локальной среде. SAP HANA в Azure (крупные экземпляры) поддерживает выполнение уровня приложений систем SAP на виртуальных машинах Azure и экземпляра HANA в единице в стеке крупных экземпляров.
- **Стек крупных экземпляров:** сертифицированный для программы SAP HANA TDI аппаратный стек, предназначенный для запуска экземпляров SAP HANA в Azure.
- **SAP HANA в Azure (крупные экземпляры):** официальное название предложения в Azure, предусматривающее запуск экземпляров SAP HANA на оборудовании, сертифицированном для программы SAP HANA TDI, которые развертываются в стеках крупных экземпляров в разных регионах Azure. Связанный термин **крупные экземпляры HANA** — сокращенное название SAP HANA в Azure (крупные экземпляры), которое широко используется в этом техническом руководстве по развертыванию.
- **Распределенное развертывание:** описывает сценарии, при которых в подписке Azure развернуты виртуальные машины с подключениями типа "сеть — сеть" или ExpressRoute между локальными центрами обработки данных и Azure. В документации Azure развертывания такого рода также называются распределенными развертываниями. Такое подключение используется для расширения в Azure локальных доменов, локальной службы Active Directory, OpenLDAP и локальной службы DNS. Локальная среда распространяется на ресурсы Azure, входящие в подписку. При таком расширении виртуальные машины могут быть частью локального домена. Пользователи локального домена имеют доступ к серверам и могут запускать службы на этих виртуальных машинах (например, службы СУБД). Возможно взаимодействие и разрешение имен между виртуальными машинами, развернутыми в локальной сети и в Azure. Это типичный сценарий, при котором развертывается большинство ресурсов SAP. Дополнительные сведения см. в статьях [Планирование и проектирование VPN-шлюза](../../../vpn-gateway/vpn-gateway-plan-design.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) и [Создание виртуальной сети с подключением типа "сеть — сеть" с помощью портала Azure](../../../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

Существует множество дополнительных ресурсов, посвященных развертыванию рабочих нагрузок SAP в общедоступном облаке Microsoft Azure. Всем, кто планирует развернуть SAP HANA в Azure, настоятельно рекомендуется ознакомиться с особенностями сред Azure IaaS и подготовиться к развертыванию рабочих нагрузок SAP в такой среде. Прежде чем продолжить работу с руководством, ознакомьтесь со следующими ресурсами, содержащими дополнительные сведения по теме:


- [Использование решений SAP на виртуальных машинах Microsoft Azure](get-started.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

## <a name="certification"></a>Сертификация

Помимо сертификации NetWeaver, требуется специальная сертификация для SAP HANA, обеспечивающая поддержку развертывания этого решения на определенных инфраструктурах, например Azure IaaS.

Основное примечание SAP для NetWeaver, также касающееся сертификации SAP HANA, — [SAP Note #1928533 – SAP Applications on Azure: Supported Products and Azure VM types](https://launchpad.support.sap.com/#/notes/1928533) (Примечание SAP № 1928533. Приложения SAP в Azure: поддерживаемые продукты и типы виртуальных машин Azure).

Также следует ознакомиться с примечанием [SAP Note #2316233 - SAP HANA on Microsoft Azure (Large Instances)](https://launchpad.support.sap.com/#/notes/2316233/E) (Примечание SAP № 2316233. SAP HANA в Microsoft Azure (крупные экземпляры)). Здесь рассматривается решение, описанное в этом руководстве. Кроме того, вы можете запускать решение SAP HANA на виртуальных машинах Azure серии GS5. Сведения по этому сценарию опубликованы на [веб-сайте SAP](http://global.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/iaas.html).

Решение "SAP HANA в Azure (крупные экземпляры)", рассматриваемое в примечании SAP № 2316233, позволяет клиентам Майкрософт и SAP развертывать в Azure такие крупные рабочие нагрузки SAP HANA, как SAP Business Suite, SAP Business Warehouse (BW), S/4 HANA, BW/4HANA и другие. При этом используется специальный аппаратный стек SAP HANA, сертифицированный для программы SAP HANA TDI ([SAP HANA Tailored Datacenter Integration — TDI](https://scn.sap.com/docs/DOC-63140)). Используя сертифицированное решение SAP TDI, вы точно знаете, что все приложения на основе SAP HANA (в том числе SAP Business Suite в SAP HANA, SAP Business Warehouse (BW) в SAP HANA, S4/HANA и BW4/HANA) будут работать.

В отличие от решения SAP HANA, выполняемого на виртуальных машинах Azure, это решение предоставляет гораздо больший объем памяти. Если вы хотите использовать это решение, вам нужно знать некоторые ключевые аспекты:

- Уровень приложений SAP и приложения других поставщиков выполняются на виртуальных машинах Azure, размещенных в обычных аппаратных стеках Azure.
- Среды с клиентской локальной инфраструктурой, центрами обработки данных и приложениями подключены к облачной платформе Microsoft Azure через Azure ExpressRoute (рекомендуется) или виртуальную частную сеть (VPN). Active Directory (AD) и DNS также распространяются в Azure.
- Экземпляр базы данных SAP HANA для рабочей нагрузки HANA выполняется в SAP HANA в Azure (крупные экземпляры). Стек крупных экземпляров подключается к сети Azure, так что программное обеспечение, запущенное на виртуальных машинах Azure, может взаимодействовать с экземпляром HANA в крупных экземплярах HANA.
- Оборудование SAP HANA в Azure (крупные экземпляры) — специальное оборудование, предоставленное в виде инфраструктуры как услуги (IaaS), где предварительно установлена ОС SUSE Linux Enterprise Server или Red Hat Enterprise Linux. Как и в случае с виртуальными машинами Azure, вы самостоятельно устанавливаете дополнительные обновления и обслуживаете операционную систему.
- Вы также отвечаете за установку HANA или дополнительных компонентов, необходимых для запуска SAP HANA на единицах крупных экземпляров HANA, а также за все текущие операции и управление решением SAP HANA в Azure.
- Помимо описанных выше решений вы можете установить другие компоненты в подписке Azure, которая подключена к SAP HANA в Azure (крупные экземпляры).  Например, компоненты, обеспечивающие взаимодействие с базой данных SAP HANA, опосредованно или напрямую (серверы перехода, серверы RDP, SAP HANA Studio, SAP Data Services для сценариев бизнес-аналитики SAP или решения для мониторинга сети).
- Как и в Azure, крупные экземпляры HANA предлагают дополнительные возможности для создания решения для высокой доступности и аварийного восстановления.

## <a name="architecture"></a>Архитектура

Решение "SAP HANA в Azure (крупные экземпляры)" включает в себя уровень приложений SAP, размещенный на виртуальных машинах Azure, и уровень базы данных, расположенный в сертифицированном оборудовании SAP TDI, размещенном в стеке крупных экземпляров в том же регионе Azure, где находится Azure IaaS.

> [!NOTE]
> Уровень приложений SAP необходимо развернуть в том же регионе Azure, что и уровень СУБД SAP. Это подробно описано в разделе о рабочей нагрузке SAP в Azure.

Общая архитектура SAP HANA в Azure (крупные экземпляры) предоставляет конфигурацию сертифицированного оборудования SAP TDI (невиртуализированный физический высокопроизводительный сервер для базы данных SAP HANA), а также возможность Azure гибко масштабировать ресурсы для уровня приложений SAP в соответствии с вашими требованиями.

![Основные сведения об архитектуре решения "SAP HANA в Azure (крупные экземпляры)"](./media/hana-overview-architecture/image1-architecture.png)

Представленная выше архитектура состоит из трех частей:

- **Правая часть:** показана локальная инфраструктура, где выполняются различные приложения в центрах обработки данных (при этом пользователи имеют доступ к бизнес-приложениям, например SAP). В идеале эта локальная инфраструктура затем подключается к Azure через Azure [ExpressRoute](https://azure.microsoft.com/services/expressroute/).

- **Центр:** показана инфраструктура Azure IaaS и (в этом случае) использование виртуальных машин Azure для размещения приложений SAP или других приложений, использующих SAP HANA в качестве системы СУБД. Небольшие экземпляры HANA, использующие память виртуальных машин Azure, развертываются на виртуальных машинах Azure со своим уровнем приложений. См. дополнительные сведения о [виртуальных машинах](https://azure.microsoft.com/services/virtual-machines/).
<br />Сети Azure используются для объединения систем SAP вместе с другими приложениями в виртуальные сети Azure. Эти виртуальные сети подключаются к локальным системам, а также к SAP HANA в Azure (крупные экземпляры).
<br />Сведения для приложений и баз данных SAP NetWeaver, которые могут выполняться в Microsoft Azure, см. в примечании [SAP Support Note #1928533 – SAP Applications on Azure: Supported Products and Azure VM types](https://launchpad.support.sap.com/#/notes/1928533) (Примечание SAP № 1928533. Приложения SAP в Azure: поддерживаемые продукты и типы виртуальных машин Azure). См. документацию по развертыванию решений SAP в Azure:

  -  [Использование SAP на виртуальных машинах Windows](../../virtual-machines-windows-sap-get-started.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
  -  [Использование решений SAP на виртуальных машинах Microsoft Azure](get-started.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

- **Левая часть:** показано сертифицированное оборудование SAP HANA TDI в стеке крупных экземпляров Azure. Единицы крупных экземпляров HANA подключены к виртуальным сетям Azure вашей подписки с помощью того же метода, что и локальная среда к Azure.

Стек крупных экземпляров Azure включает в себя следующие компоненты:

- **Вычисления:** серверы на базе процессоров Intel Xeon E7-8890v3, которые предоставляют необходимую вычислительную мощность и сертифицированы для SAP HANA.
- **Сети:** единая структура высокоскоростных сетей, которая соединяет компоненты вычислений, хранения и локальной сети.
- **Хранилище:** инфраструктура хранилища, к которому осуществляется доступ через единую структуру сети. Выделяемый объем хранилища зависит от развертываемой конфигурации SAP HANA в Azure (крупные экземпляры). Дополнительный объем хранилища можно получить за дополнительную ежемесячную плату.

В рамках мультитенантной инфраструктуры стека крупных экземпляров клиенты развертываются как изолированные клиенты. Один клиент соответствует одной подписке Azure. Это означает, что вы не можете получить доступ к одному экземпляру SAP HANA в Azure (крупные экземпляры), запущенному в стеке крупных экземпляров Azure, из двух разных подписок Azure.

Как и в случае с виртуальными машинами Azure, решение "SAP HANA в Azure (крупные экземпляры)" доступно в нескольких регионах Azure. Вы можете использовать несколько регионов, чтобы обеспечить возможность аварийного восстановления. Разные стеки крупных экземпляров в различных регионах Azure подключены друг к другу.

Точно так же, как можно выбирать между различными типами виртуальных машин Azure, можно выбирать среди разных номеров SKU для крупных экземпляров HANA, предназначенных для различных типов рабочих нагрузок SAP HANA. SAP выделяет для разных рабочих нагрузок память с учетом количества сокетов в зависимости от поколений процессоров Intel. Таким образом, доступно четыре разных типа SKU.

Начиная с декабря 2016 года SAP HANA на виртуальных машинах Azure (крупные экземпляры) предлагается в шести вариантах конфигурации для регионов "Западная часть США" и "Восточная часть США".

| Решение SAP | ЦП | ОЗУ | Хранилище |
| --- | --- | --- | --- |
| Оптимизировано для OLAP: SAP BW, BW/4HANA<br /> или SAP HANA для общих рабочих нагрузок OLAP | SAP HANA на виртуальных машинах Azure S72<br /> — 2 процессора Intel® Xeon® E7-8890 v3 |  768 ГБ |  3 TБ |
| --- | SAP HANA на виртуальных машинах Azure S144<br /> — 4 процессора Intel® Xeon® E7-8890 v3 |  1,5 ТБ |  6 TБ |
| --- | SAP HANA на виртуальных машинах Azure S192<br /> — 4 процессора Intel® Xeon® E7-8890 v4 |  2 TБ |  8 ТБ |
| Оптимизировано для OLTP: SAP Business Suite<br /> в SAP HANA или S/4HANA (OLTP)<br /> для общих рабочих нагрузок OLTP | SAP HANA на виртуальных машинах Azure S72m<br /> — 2 процессора Intel® Xeon® E7-8890 v3 |  1,5 ТБ |  6 TБ |
|---| SAP HANA на виртуальных машинах Azure S144m<br /> — 4 процессора Intel® Xeon® E7-8890 v3 |  3 ТБ |  12 ТБ |
|---| SAP HANA на виртуальных машинах Azure S192m<br /> — 4 процессора Intel® Xeon® E7-8890 v4 |  4 TБ |  16 ТБ |

Упомянутые выше конфигурации описаны в примечании [SAP Support Note #2316233 – SAP HANA on Microsoft Azure (Large Instances)](https://launchpad.support.sap.com/#/notes/2316233/E) (Примечание SAP № 2316233. SAP HANA в Microsoft Azure (крупные экземпляры)).

Выбираемые конфигурации зависят от рабочей нагрузки, ресурсов ЦП и необходимого объема памяти. Для рабочих нагрузок OLTP можно использовать номера SKU, оптимизированные для рабочих нагрузок OLAP. Аналогичным образом для рабочих нагрузок OLAP HANA можно использовать номера SKU для OLTP. Тем не менее может потребоваться ограничить объем памяти, используемый решением HANA, в зависимости от объема, выделяемого для поколения процессоров Intel E7, как указано [на веб-сайте SAP](http://global12.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/appliances.html) для типа устройства _BW с возможностью масштабирования в HANA_.

Следует отметить, что полная инфраструктура стека крупных экземпляров не выделяется исключительно для одного клиента. Это относится к SAP HANA в Azure (крупные экземпляры), а также к стойкам ресурсов вычислений и хранения, соединенным через сетевую структуру, развернутую в Azure. Инфраструктура крупных экземпляров HANA, такая как Azure, развертывает &quot;клиентов&quot; другого пользователя, которые изолированы друг от друга посредством сетевой изоляции. Таким образом, эти развертывания крупных экземпляров HANA не влияют на работу друг друга и невидимы друг для друга. Развернутый клиент в стеке крупных экземпляров назначается одной подписке Azure. При наличии второй подписки Azure, которой также требуются крупные экземпляры HANA, она будет развернута в отдельный клиент в стеке крупных экземпляров с настроенной сетевой изоляцией, которая предотвращает прямую связь между этими экземплярами.

Тем не менее существуют значительные различия между запуском SAP HANA в крупных экземплярах HANA и на виртуальных машинах, развернутых в Azure.

- Для SAP HANA в Azure (крупные экземпляры) не предусмотрен уровень виртуализации. Вы получаете производительность базового физического оборудования.
- В отличие от Azure сервер решения "SAP HANA в Azure (крупные экземпляры)" выделяется для конкретного клиента. Перезагрузка или завершение работы сервера не влечет за собой развертывание операционной системы и SAP HANA на другом сервере. (Единственное исключение — когда на сервере могут возникнуть проблемы и необходимо выполнить повторное развертывание в другой колонке.)
- В отличие от Azure, где типы процессоров узла выбираются на основе лучшего соотношения цены и производительности, для SAP HANA в Azure (крупные экземпляры) выбираются самые высокопроизводительные процессоры из линейки Intel E7v3.

Оборудование SAP HANA в Azure (крупные экземпляры) могут использовать несколько клиентов, и каждый из них будет изолирован друг от друга, так как они выполняют развертывание в собственных виртуальных локальных сетях. Для подключения крупных экземпляров HANA к виртуальной сети Azure клиенты единиц крупных экземпляров HANA изолированным образом подключаются к виртуальным сетям Azure подписки Azure клиентов с помощью установленных сетевых компонентов. 

## <a name="operations-model-and-responsibilities"></a>Модель операций и обязанности

Службы, предоставляемые SAP HANA в Azure (крупные экземпляры), соответствуют службам Azure IaaS. Экземпляр решения "Крупные экземпляры HANA" поставляется с установленной операционной системой, оптимизированной для SAP HANA. Как и в случае с виртуальными машинами Azure IaaS, вы отвечаете за большинство задач по повышению безопасности операционной системы, установку дополнительного программного обеспечения, решения HANA, работу с ОС и HANA, а также их обновление. Корпорация Майкрософт не будет требовать установку обновлений для операционной системы и HANA.

![Обязанности, связанные с SAP HANA в Azure (крупные экземпляры)](./media/hana-overview-architecture/image2-responsibilities.png)

Как видно на рисунке выше, решение "SAP HANA в Azure (крупные экземпляры)" — это мультитенантная инфраструктура как услуга. Как результат, разделение обязанностей по большей части наблюдается на границе инфраструктуры и ОС. Корпорация Майкрософт отвечает за все аспекты обслуживания, которые расположены после уровня операционной системы, а вы отвечаете за те, которые расположены над ним, включая саму операционную систему. Таким образом, вы можете продолжать применять самые последние локальные методы для обеспечения соответствия требованиям, безопасности, управления приложениями, базового управления и управления операционной системой. Обслуживание таких систем ничем не отличается от систем, находящихся в вашей сети.

Тем не менее эта служба оптимизирована для SAP HANA, поэтому есть некоторые аспекты, требующие сотрудничества с корпорацией Майкрософт. Ее сотрудники помогут вам эффективнее использовать возможности базовой инфраструктуры.

Ниже приведены дополнительные сведения по каждому уровню и ваши обязанности.

**Сети.** Все внутренние сети для стека крупных экземпляров с SAP HANA, его доступ к хранилищу, подключение между экземплярами (для масштабирования и других функций), подключение к ландшафту и подключение к Azure, если уровень приложений SAP размещен на виртуальных машинах Azure. Этот уровень также включает в себя подключение через глобальную сеть между центрами обработки данных Azure для репликации в целях аварийного восстановления. Все сети распределяются по клиентам, и к ним применяются требования к качеству обслуживания.

**Хранилище:** виртуализированное секционированное хранилище для всех томов, необходимых серверам SAP HANA, а также для моментальных снимков.

**Серверы:** выделенные физические серверы для выполнения баз данных SAP HANA, назначенных клиентам. Они виртуализированы на уровне оборудования.

**Программно-определяемый центр обработки данных:** программное обеспечение для управления центром обработки данных как программно-определяемой сущностью. С его помощью корпорация Майкрософт может объединять ресурсы в пул для масштабирования, повышения уровня доступности и производительности.

**ОС:** операционная система (SUSE Linux или Red Hat Linux), под управлением которой работают серверы. Вам предоставляются образы операционной системы, переданные отдельными поставщиками Linux корпорации Майкрософт с целью выполнения на них SAP HANA. Вам нужно получить подписку у поставщика конкретного образа, оптимизированного для SAP HANA. Вы также обязаны зарегистрировать образ у поставщика ОС. С момента передачи вам образа корпорацией Майкрософт вы также самостоятельно отвечаете за любые дополнительные исправления операционной системы Linux. Это относится и к установке дополнительных пакетов, которые могут потребоваться для успешной установки SAP HANA (изучите документацию по установке HANA компании SAP и примечания по SAP), не включенных поставщиком Linux в конкретный используемый образ ОС, оптимизированный для SAP HANA. К области ответственности клиента относятся также любые исправления ОС, применяемые для исправления ошибок или оптимизации ОС и ее драйверов для конкретного аппаратного оборудования. Клиент также отвечает за любые исправления для повышения безопасности или изменения функциональности операционной системы. Клиент несет ответственность за мониторинг и планирование производительности по следующим аспектам:

- потребление ресурсов ЦП;
- потребление памяти;
- тома диска для обеспечения свободного пространства, поддержки операций ввода-вывода и регулирования задержки;
- сетевой трафик между крупным экземпляром HANA и уровнем приложений SAP.

Базовая инфраструктура крупных экземпляров HANA предоставляет функции резервного копирования и восстановления тома ОС. Вы также отвечаете за использование этих функций.

**ПО промежуточного слоя:** в первую очередь сюда относится экземпляр SAP HANA. Вы отвечаете за администрирование, выполнение операций и мониторинг. Вы также можете использовать моментальные снимки хранилища для резервного копирования и восстановления, а также аварийного восстановления. Эти возможности обеспечиваются с помощью инфраструктуры. Тем не менее вы также отвечаете за создание решения для обеспечения высокого уровня доступности и аварийного восстановления с этими возможностями, использование их и отслеживание успешного выполнения моментальных снимков хранилища.

**Данные:** управление вашими данными и другими данными, например файлами резервных копий, расположенными на томах или в файловых ресурсах, осуществляется с помощью SAP HANA. Вы отвечаете за мониторинг свободного места на диске и управление содержимым томов, а также отслеживание успешного выполнения резервного копирования томов и моментальных снимков хранилища. Однако за успешное выполнение репликации данных на сайты аварийного восстановления отвечает корпорация Майкрософт.

**Приложения:** экземпляры приложений SAP или уровень этих приложений (в случае с приложениями других поставщиков). Вы отвечаете за развертывание, администрирование, эксплуатацию и мониторинг этих приложений в контексте планирования потребления ресурсов ЦП, объема памяти, емкости службы хранилища Azure и использования пропускной способности сети в виртуальных сетях Azure и из виртуальных сетей Azure в SAP HANA в Azure (крупные экземпляры).

**Глобальные сети:** подключения между локальной средой и развертываниями в Azure, устанавливаемые для рабочих нагрузок. Если рабочие нагрузки критически важны, используйте Azure ExpressRoute. Это подключение не является частью SAP HANA в Azure (крупные экземпляры), поэтому вы несете ответственность за установку этого подключения.

**Архивирование:** вы можете архивировать копии данных в учетные записи хранения, используя собственные методы. Это сопровождается затратами и необходимостью управления, обеспечения соответствия и обслуживания. Вы несете ответственность за создание архивных копий и резервных копий в Azure, а также сохранение их надлежащим способом.

См. статью [Соглашение об уровне обслуживания для SAP HANA в больших экземплярах Azure](https://azure.microsoft.com/support/legal/sla/sap-hana-large/v1_0/).

## <a name="sizing"></a>Определение размера

В целом определение размера для крупных экземпляров HANA ничем не отличается от определения размера для HANA. Для существующих и развернутых систем необходимо перенести данные из других реляционных СУБД в HANA, так как SAP предоставляет ряд отчетов, которые выполняются в имеющихся системах SAP. Они проверяют данные и определяют требования к памяти таблиц при перемещении базы данных в HANA. Прочтите следующие примечания SAP, чтобы получить дополнительные сведения о выполнении этих отчетов и информацию о последних исправлениях и версиях этих отчетов:

- [SAP Note #1793345 — Sizing for SAP Suite on HANA (Примечание SAP № 1793345. Определение размера для SAP Suite в HANA)](https://launchpad.support.sap.com/#/notes/1793345);
- [SAP Note #1872170 — Suite on HANA and S/4 HANA sizing report (Примечание SAP № 1872170. Отчет для определения размера Suite в HANA и S/4 HANA)](https://launchpad.support.sap.com/#/notes/1872170);
- [SAP Note #2121330 — FAQ: SAP BW on HANA Sizing Report (Примечание SAP № 2121330. Часто задаваемые вопросы: отчет для определения размера SAP BW в HANA)](https://launchpad.support.sap.com/#/notes/2121330);
- [SAP Note #1736976 — Sizing Report for BW on HANA (Примечание SAP № 1736976. Отчет для определения размера BW в HANA)](https://launchpad.support.sap.com/#/notes/1736976);
- [SAP Note #2296290 — New Sizing Report for BW on HANA (Примечание SAP № 2296290. Новый отчет для определения размера BW в HANA)](https://launchpad.support.sap.com/#/notes/2296290).

Для новых развертываний доступно средство для определения требований к памяти для реализации программного обеспечения SAP на базе HANA — SAP Quick Sizer.

Требования к памяти для HANA повышаются по мере роста объема данных, поэтому вам нужно следить за потреблением памяти, чтобы спрогнозировать будущие требования. В зависимости от требований к памяти вы можете определить подходящий SKU для крупных экземпляров HANA.

## <a name="requirements"></a>Требования

Ниже приведены требования для запуска SAP HANA в Azure (крупные экземпляры).

**Microsoft Azure**

- Подписка Azure, которую можно связать с SAP HANA в Azure (крупные экземпляры).
- Контракт на поддержку Microsoft Premier. Сведения о работе с решением SAP в Azure см. в примечании [SAP Support Note #2015553 – SAP on Microsoft Azure: Support Prerequisites](https://launchpad.support.sap.com/#/notes/2015553) (Примечание SAP № 2015553. SAP в Microsoft Azure: требования для поддержки).
- Знание необходимых SKU для крупных экземпляров HANA после определения размера с помощью SAP.

**Сетевое подключение**

- Azure ExpressRoute между локальной средой и Azure. Для подключения локального центра обработки данных к Azure у поставщика услуг Интернета необходимо запросить подключение со скоростью не менее 1 Гбит/с.

**Операционная система**

- Лицензии на SUSE Linux Enterprise Server 12 для приложений SAP.

> [!NOTE] 
> Операционная система, поставляемая корпорацией Майкрософт, не зарегистрирована в SUSE и не подключена к экземпляру SMT.

- Средство для управления подписками SUSE Linux (SMT), развернутое в Azure или на виртуальной машине Azure. При его наличии SUSE сможет выполнять регистрацию и надлежащее обновление SAP HANA в Azure (крупные экземпляры) (так как в центре обработки данных крупных экземпляров HANA отсутствует доступ в Интернет). 
- Лицензии на Red Hat Enterprise Linux 6.7 или 7.2 для SAP HANA.

> [!NOTE]
> Операционная система, поставляемая корпорацией Майкрософт, не зарегистрирована в Red Hat и не подключена к экземпляру диспетчера подписок компании Red Hat.

- Red Hat Subscription Manager, развернутый в Azure или на виртуальной машине Azure. При его наличии Red Hat сможет выполнять регистрацию и надлежащее обновление SAP HANA в Azure (крупные экземпляры) (так как в клиенте, развернутом в стеке крупных экземпляров Azure, отсутствует прямой доступ в Интернет).
- SAP требуется наличие договора на поддержку с поставщиком Linux. Это требование не отменяется в решении больших экземпляров HANA или если вы используете Linux в Azure. В отличие от некоторых образов Linux в Azure из коллекции плата за обслуживание не включена в предложение решения крупных экземпляров HANA. Именно клиент выполняет требования SAP в отношении договора на поддержку с распространителем Linux.   
   - Ознакомьтесь с требованиями договора на поддержку SUSE Linux в документах [SAP Note #1984787 — SUSE LINUX Enterprise Server 12: Installation notes (Примечание SAP № 1984787 — SUSE LINUX Enterprise Server 12: примечания к установке)](https://launchpad.support.sap.com/#/notes/1984787) и [SAP Note #1056161 — SUSE Priority Support for SAP applications (Примечание SAP № 1056161 — приоритетная поддержка SUSE для приложений SAP)](https://launchpad.support.sap.com/#/notes/1056161).
   - Для Red Hat Linux необходимо иметь правильный уровень подписки, который включает в себя поддержку и обслуживание (обновления операционных систем крупных экземпляров HANA). Специалисты Red Hat советуют получить подписку RHEL for SAP Business Applications для поддержи и обслуживания. Дополнительные сведения см. в документах [SAP Note #2002167 — Red Hat Enterprise Linux 7.x: Installation and Upgrade (Примечание SAP № 2002167 — Red Hat Enterprise Linux 7.x: установка и обновление)](https://launchpad.support.sap.com/#/notes/2002167) и [SAP Note #1496410 — Red Hat Enterprise Linux 6.x: Installation and Upgrade (Примечание SAP № 1496410 — Red Hat Enterprise Linux 6.x: установка и обновление)](https://launchpad.support.sap.com/#/notes/1496410).

**База данных:**

- Лицензии и компоненты установки программного обеспечения для SAP HANA (выпуск Platform или Enterprise).

**Приложения**

- Лицензии и компоненты установки программного обеспечения для любых приложений SAP, которые подключаются к SAP HANA, и связанные договора на поддержку SAP.
- Лицензии и компоненты установки программного обеспечения для всех приложений других поставщиков (не SAP), используемых по отношению к среде SAP HANA в Azure (крупные экземпляры), и связанные договора на поддержку.

**Требования**

- Опыт работы со средой Azure IaaS и ее компонентами и общие знания о них.
- Общие знания о развертывании рабочей нагрузки SAP в Azure.
- Сертифицированные сотрудники для установки SAP HANA.
- Навыки проектирования в среде SAP, чтобы создать решение для обеспечения высокого уровня доступности и аварийного восстановления в SAP HANA.


## <a name="storage"></a>Хранилище

Структура хранения для SAP HANA в Azure (крупные экземпляры) настраивается через управление службами SAP HANA в Azure с применением рекомендованных методик, как описано в техническом документе с описанием [требований к хранилищу для SAP HANA](http://go.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html).

Обычно объем памяти крупных экземпляров в 4 раза больше объема памяти тома хранилища. Такой объем предназначен для хранения резервных копий журналов HANA. Дополнительные сведения см. в статье [Как установить и настроить SAP HANA в Azure (крупные экземпляры)](hana-installation.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

Клиент может использовать моментальные снимки для архивации, восстановления и аварийного восстановления. Дополнительные сведения см. в [Высокий уровень доступности и аварийное восстановление SAP HANA в Azure (крупные экземпляры)](hana-overview-high-availability-disaster-recovery.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

### <a name="encryption-of-data-at-rest"></a>Шифрование неактивных данных
Хранилище, используемое для крупных экземпляров HANA, обеспечивает прозрачное шифрование данных, так как оно хранится на дисках. Во время развертывания единицы крупных экземпляров HANA вы можете включить шифрование такого типа. После развертывания вы также можете переключиться на зашифрованные тома. Переход от незашифрованных к зашифрованным томам прозрачен и не вызывает простоя. 


## <a name="networking"></a>Сеть

Архитектура сети Azure является ключевым компонентом для успешного развертывания приложений SAP. Как правило, развернутое решение "SAP HANA в Azure (крупные экземпляры)" отличается большим ландшафтом SAP, который включает в себя несколько разных решений SAP с различными размерами баз данных, а также показателями потребления ресурсов ЦП и памяти. Скорее всего, только одна или две из этих систем SAP основаны на SAP HANA, поэтому ландшафт SAP, возможно, будет гибридным, и в нем будут использоваться следующие системы.

- Системы SAP, развернутые локально. Из-за размеров эти системы в настоящее время не могут размещаться в Azure. Классический пример — рабочая система SAP ERP в Microsoft SQL Server (как база данных) с числом процессоров &gt;100 и 1 ТБ памяти.
- Системы SAP на основе SAP HANA, развернутые локально (например, система SAP ERP, которой требуется 6 ТБ памяти (или больше) для своей базы данных SAP HANA).
- Системы SAP, развернутые на виртуальных машинах Azure. Это могут быть экземпляры разработки, тестирования, песочницы или рабочие экземпляры для всех приложений на основе SAP NetWeaver, которые можно развернуть в Azure (на виртуальных машинах) с учетом требований к ресурсам и памяти. Они также могут быть созданы на основе баз данных, например SQL Server (см. примечание [SAP Note #1928533 – SAP Applications on Azure: Supported Products and Azure VM types](https://launchpad.support.sap.com/#/notes/1928533/E) (Примечание SAP № 1928533. Приложения SAP в Azure: поддерживаемые продукты и типы виртуальных машин Azure)) или SAP HANA (см. [список сертифицированных платформ IaaS для SAP HANA](http://global.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/iaas.html)).
- Серверы приложений SAP, развернутые в Azure (на виртуальных машинах), которые используют SAP HANA в Azure (крупные экземпляры) в стеках крупных экземпляров Azure.

Хотя гибридный ландшафт SAP (с четырьмя или более разными сценариями развертывания) — обычное явление, в Azure может работать весь ландшафт SAP, и по мере увеличения производительности виртуальных машин Microsoft Azure число решений SAP, развертываемых на этих виртуальных машинах, будет расти.

Сети Azure в контексте систем SAP, развернутых в Azure, не сложные. Это связано со следующими аспектами.

- Виртуальные сети Azure должны быть подключены к каналу Azure ExpressRoute, который подключается к локальной сети.
- Канал ExpressRoute обычно должен иметь пропускную способность 1 Гбит/с или выше. Это позволяет обеспечить достаточную пропускную способность для передачи данных между локальными системами и системами, запущенными на виртуальных машинах Azure (а также подключение к системам Azure из локальной среды конечных пользователей).
- Для взаимодействия друг с другом все системы SAP в Azure должны быть настроены в виртуальных сетях Azure.
- Службы Active Directory и DNS, размещенные локально, можно использовать в Azure через локальный ExpressRoute.


> [!NOTE] 
> Одну подписку Azure можно привязать только к одному клиенту в стеке крупных экземпляров в определенном регионе Azure и наоборот.

Развертывание SAP HANA в Azure (крупные экземпляры) в двух разных регионах Azure приведет к тому, что другой клиент будет развернут в стеке крупных экземпляров. Тем не менее оба клиента могут выполняться в одной подписке Azure, если эти экземпляры являются частью одного ландшафта SAP. 

> [!IMPORTANT] 
> Для SAP HANA в Azure (крупные экземпляры) поддерживается только модель развертывания Azure Resource Manager.

### <a name="internet-connectivity-of-hana-large-instances"></a>Подключение крупных экземпляров HANA к Интернету
Крупные экземпляры HANA не подключены к Интернету напрямую. Это ограничивает ваши возможности, например зарегистрировать образ ОС напрямую с использованием поставщика ОС. Следовательно, вам может потребоваться поработать с локальным сервером SLES SMT или диспетчером подписки RHEL.

### <a name="data-encryption-between-azure-vms-and-hana-large-instances"></a>Шифрование данных между виртуальными машинами Azure и крупными экземплярами HANA
Данные, передаваемые между виртуальными машинами Azure и крупными экземплярами HANA, не шифруются. Однако исключительно для обмена между СУБД HANA и приложениями на основе JDBC/ODBC вы можете включить шифрование трафика. Подробнее об этом см. в [этой документации по SAP](http://help-legacy.sap.com/saphelp_hanaplatform/helpdata/en/db/d3d887bb571014bf05ca887f897b99/content.htm?frameset=/en/dd/a2ae94bb571014a48fc3b22f8e919e/frameset.htm&current_toc=/en/de/ec02ebbb57101483bdf3194c301d2e/plain.htm&node_id=20&show_children=false).  

### <a name="additional-azure-vnet-information"></a>Дополнительные сведения о виртуальной сети Azure

Чтобы подключить виртуальную сеть Azure к ExpressRoute, необходимо создать шлюз Azure (см. статью [Сведения о шлюзах виртуальных сетей ExpressRoute](../../../expressroute/expressroute-about-virtual-network-gateways.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)). Шлюз Azure можно использовать для подключения ExpressRoute к инфраструктуре за пределами Azure (или к стеку крупных экземпляров Azure) или для подключения между виртуальными сетями Azure (см. статью [Настройка подключения между виртуальными сетями в развертывании Resource Manager с помощью PowerShell](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)). Шлюз Azure можно подключить максимум к четырем разным соединениям ExpressRoute при условии, что они поступают из различных конечных маршрутизаторов Microsoft Enterprise Edges (MSEE).  Дополнительные сведения см. в статье [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 

> [!NOTE] 
> В обоих случаях шлюз Azure обеспечивает разную пропускную способность (см. статью [Основные сведения о VPN-шлюзах Azure](../../../vpn-gateway/vpn-gateway-about-vpngateways.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)). Максимальная пропускная способность, которой можно достичь с использованием шлюза виртуальной сети, — 10 Гбит/с при подключении ExpressRoute. Следует помнить, что при копировании файлов между виртуальной машиной Azure, расположенной в виртуальной сети Azure, и локальной системой (в рамках одного потока копирования) невозможно достичь полной пропускной способности шлюза с разными номерами SKU. Чтобы получить максимальную пропускную способность шлюза виртуальной сети, нужно использовать несколько потоков или копировать разные файлы с помощью параллельных потоков одного файла.

В приведенных выше статьях следует обратить внимание на сведения о доступности шлюза с номером SKU UltraPerformance в разных регионах Azure.

### <a name="networking-for-sap-hana-on-azure"></a>Сеть для SAP HANA в Azure

Для подключения к SAP HANA в Azure (крупные экземпляры) виртуальная сеть Azure должна быть подключена к клиенту в локальной сети через свой шлюз с помощью ExpressRoute. Кроме того, она должна быть подключена через второй канал ExpressRoute к крупным экземплярам HANA, расположенным в стеке крупных экземпляров Azure. Шлюз виртуальной сети будет иметь по крайней мере два подключения ExpressRoute, которые будут обеспечивать максимальную пропускную способность шлюза виртуальной сети.

> [!IMPORTANT] 
> Учитывая общий сетевой трафик между уровнями базы данных и приложений SAP, для подключения виртуальных сетей к SAP HANA в Azure (крупные экземпляры) поддерживается только шлюз с номером SKU HighPerformance или UltraPerformance.

![Виртуальная сеть Azure подключена к SAP HANA в Azure (крупные экземпляры) и к локальной сети](./media/hana-overview-architecture/image3-on-premises-infrastructure.png)

### <a name="single-sap-system"></a>Одна система SAP

Локальная инфраструктура, показанная выше, подключена к Azure через канал ExpressRoute, который подключен к конечному маршрутизатору Microsoft Enterprise (см. статью [Технический обзор ExpressRoute](../../../expressroute/expressroute-introduction.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)). После установки этот маршрут подключается к магистральной сети Microsoft Azure, и все регионы Azure становятся доступными.

> [!NOTE] 
> Для работы с ландшафтом SAP в Azure выполните подключение к маршрутизатору MSEE, который расположен ближе других к региону Azure в пределах ландшафта SAP. Стеки крупных экземпляров Azure подключаются с помощью специальных устройств MSEE для минимизации сетевой задержки между виртуальными машинами Azure в Azure IaaS и стеками крупных экземпляров.

Шлюз виртуальной сети для виртуальных машин Azure, где размещены экземпляры приложений SAP, подключен к этому каналу ExpressRoute, а та же виртуальная сеть подключена к отдельному маршрутизатору MSEE, предназначенному для подключения к стекам крупных экземпляров.

Это простой пример одной системы SAP, где уровень приложений SAP размещен в Azure, а база данных SAP HANA выполняется в SAP HANA в Azure (крупные экземпляры). Предполагается, что пропускная способность шлюза виртуальной сети 2 Гбит/с или 10 Гбит/с не подразумевает узкое место производительности.

### <a name="multiple-sap-systems-or-large-sap-systems"></a>Несколько обычных или крупных систем SAP

Если несколько обычных или крупных систем SAP подключены к SAP HANA в Azure (крупные экземпляры), целесообразно предположить, что пропускная способность шлюза виртуальной сети с номером SKU HighPerformance может стать узким местом. В этом случае следует выбрать номер UltraPerformance SKU, если он доступен. Тем не менее если доступен только HighPerformance SKU (до 2 Гбит/с) или есть вероятность, что UltraPerformance SKU (до 10 Гбит/с) будет недостаточно, понадобится разбить уровни приложений на несколько виртуальных сетей Azure. Мы также рекомендуем создать специальные виртуальные сети, которые подключаются к крупным экземплярам HANA в таких случаях:

- Выполнение архивации непосредственно из экземпляров HANA в крупных экземплярах HANA на виртуальную машину в Azure, где размещаются общие ресурсы NFS.
- Копирование больших резервных копий и других файлов из крупных экземпляров HANA на диск, управляемый в Azure.

При использовании отдельных виртуальных сетей, в которых размещаются виртуальные машины, управляющие хранилищем, передача крупных файлов или большого объема данных из крупных экземпляров HANA в Azure на шлюзе виртуальной сети, обслуживающем виртуальные машины, на которых выполняется уровень приложений SAP, никак не повлияет на работу. 

Для более масштабируемой сетевой архитектуры:

- Используйте несколько виртуальных сетей Azure для одного большего уровня приложений SAP.
- Вместо объединения систем SAP из разных подсетей в одну виртуальную сеть разверните отдельную виртуальную сеть Azure для каждой развернутой системы SAP.

 Более масштабируемая сетевая архитектура для SAP HANA в Azure (крупные экземпляры):

![Развертывание уровня приложений SAP в нескольких виртуальных сетях Azure](./media/hana-overview-architecture/image4-networking-architecture.png)

Если развернуть уровень приложений SAP или его компоненты в нескольких виртуальных сетях Azure, как показано выше, это неизбежно вызовет дополнительные задержки, возникающие во время обмена данными между приложениями, размещенными в разных виртуальных сетях Azure. По умолчанию сетевой трафик между виртуальными машинами Azure, расположенными в разных виртуальных сетях, будет проходить через маршрутизаторы MSEE. Начиная с сентября 2016 года существует возможность избежать этого и оптимизировать среду. Чтобы повысить эффективность и сократить задержки в взаимодействии между двумя виртуальными сетями, следует сделать их одноранговыми виртуальными сетями в одном регионе Azure. Это возможно, даже если они относятся к разным подпискам. Пиринг виртуальных сетей Azure позволяет виртуальным машинам в двух разных виртуальных сетях Azure напрямую взаимодействовать друг с другом через магистральную сеть Azure. В этом случае задержка будет такая же, как если бы эти виртуальные машины находились в одной виртуальной сети. Если же взаимодействие выполняется между диапазонами IP-адресов, соединенными через шлюз виртуальной сети Azure, весь трафик направляется через этот конкретный шлюз виртуальной сети. Информацию о пиринге виртуальных сетей Azure можно получить в статье [Пиринговая связь между виртуальными сетями](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview).


### <a name="routing-in-azure"></a>Маршрутизация в Azure

Существует две важные рекомендации относительно сетевой маршрутизации для SAP HANA в Azure (крупные экземпляры).

1. К SAP HANA в Azure (крупные экземпляры) могут получать доступ только виртуальные машины Azure через выделенное подключение ExpressRoute. К этому решению нельзя получить доступ напрямую из локальной среды. Таким образом, клиенты администрирования и любые приложения, требующие прямого доступа, например запущенный локально SAP Solution Manager, не могут подключиться к базе данных SAP HANA.

2. Единицам SAP HANA в Azure (крупные экземпляры) назначается IP-адрес из диапазона IP-адресов пула серверов, указанного клиентом. Дополнительные сведения см. в статье [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).  Доступ к этому IP-адресу можно получить с помощью подписки Azure и канала ExpressRoute, по которому виртуальные сети Azure подключаются к HANA в Azure (крупные экземпляры). IP-адрес, назначенный из этого диапазона IP-адресов пула серверов, напрямую присваивается аппаратной единице и больше не используется NAT, как это имело место в первых развертываниях этого решения. 

> [!NOTE] 
> Если в сценарии с _хранилищем данных_, где приложениям и (или) конечным пользователям требуется подключение к базе данных SAP HANA (напрямую), необходимо подключение к SAP HANA в Azure (крупные экземпляры), нужно использовать другой сетевой компонент: обратный прокси-сервер для маршрутизации входящих и исходящих данных. Например, F5 BIG-IP, NGINX с диспетчером трафика, развернутый в Azure как решение для маршрутизации трафика и реализации виртуального брандмауэра.

### <a name="leveraging-in-multiple-regions"></a>Использование в нескольких регионах

У вас могут быть другие причины для развертывания SAP HANA в Azure (крупные экземпляры) в нескольких регионах Azure помимо аварийного восстановления. Возможно, вам необходимо получить доступ к крупным экземплярам HANA из каждой виртуальной машины, развернутой в разных виртуальных сетях в регионах. Так как IP-адреса, назначенные разным единицам крупных экземпляров HANA, не распространяются за пределы виртуальных сетей Azure (которые напрямую подключены к экземплярам через шлюз), в представленную выше структуру виртуальной сети внесено некоторое изменение: шлюз виртуальной сети Azure может обрабатывать четыре различных канала ExpressRoute из разных маршрутизаторов MSEE, и каждая виртуальная сеть, подключенная к одному из стеков крупных экземпляров, может быть подключена к стеку крупных экземпляров в другом регионе Azure.

![Виртуальные сети Azure, подключенные к стекам крупных экземпляров Azure в разных регионах Azure](./media/hana-overview-architecture/image8-multiple-regions.png)

На рисунке выше показано, как разные виртуальные сети Azure в обоих регионах подключены к двум разным каналам ExpressRoute, используемым для подключения к SAP HANA в Azure (крупные экземпляры) в обоих регионах Azure. Новые подключения представлены прямоугольными красными линиями. При такой схеме подключений из виртуальных сетей Azure виртуальные машины, работающие в одной из этих виртуальных сетей, могут получать доступ к каждому из разных единиц крупных экземпляров HANA, развернутых в двух регионах (при условии использования одной подписки). Как видно на рисунке выше, предполагается, что имеется два подключения ExpressRoute между локальной системой и двумя регионами Azure. Это рекомендуется в целях аварийного восстановления.

> [!IMPORTANT] 
> Если используется несколько каналов ExpressRoute, чтобы обеспечить правильную маршрутизацию трафика, следует использовать атрибут AS PATH и настройки локального предпочтения BGP.



