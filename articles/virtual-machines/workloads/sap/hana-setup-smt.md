---
title: Как настроить сервер SMT для SAP HANA в Azure (крупные экземпляры) | Документы Майкрософт
description: Как настроить сервер SMT для SAP HANA в Azure (крупные экземпляры).
services: virtual-machines-linux
documentationcenter: ''
author: hermanndms
manager: jeconnoc
editor: ''
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 09/10/2018
ms.author: rclaus
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f387c1afe88f2bba476309b2e2e01942d2b7ae5b
ms.sourcegitcommit: 776b450b73db66469cb63130c6cf9696f9152b6a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/18/2018
ms.locfileid: "45982631"
---
# <a name="setting-up-smt-server-for-suse-linux"></a>Настройка сервера SMT для SUSE Linux
Крупные экземпляры SAP HANA не подключены к Интернету напрямую. Поэтому процессы регистрации такой единицы у поставщика ОС, а также скачивания и применения исправлений вызывают определенные сложности. При использовании SUSE Linux одним из решений может быть настройка сервера SMT на виртуальной машине Azure. Виртуальная машина Azure должна быть размещена в виртуальной сети Azure, подключенной к крупному экземпляру HANA. При наличии такого сервера SMT единица крупного экземпляра HANA может регистрировать и скачивать исправления. 

SUSE предлагает более объемное руководство по [средству управления подписками для SLES 12 SP2](https://www.suse.com/documentation/sles-12/pdfdoc/book_smt/book_smt.pdf). 

В качестве предварительного условия для установки сервера SMT, выполняющего задачу для крупного экземпляра HANA, вам потребуется:

- виртуальная сеть Azure, подключенная к каналу ER крупного экземпляра HANA;
- учетная запись SUSE, связанная с организацией. А организации требуется действительная подписка SUSE.

## <a name="installation-of-smt-server-on-azure-vm"></a>Установка сервера SMT на виртуальной машине Azure

На этом этапе вы установите сервер SMT на виртуальной машине Azure. Сначала необходимо войти в [Центр клиентов SUSE](https://scc.suse.com/).

После входа перейдите в раздел "Организация"--> "Учетные данные организации". В этом разделе вы должны найти учетные данные, необходимые для настройки сервера SMT.

Третий шаг — это установка виртуальной машины SUSE Linux в виртуальной сети Azure. Чтобы развернуть виртуальную машину, требуется образ SLES 12 SP2 из коллекции Azure (выберите образ BYOS SUSE). В процессе развертывания не определяйте DNS-имя и не используйте статические IP-адреса, как показано на этом снимке экрана

![развертывание виртуальной машины для сервера SMT](./media/hana-installation/image3_vm_deployment.png)

Развернутая виртуальная машина имела меньший размер и получила внутренний IP-адрес 10.34.1.4 в виртуальной сети Azure. Виртуальной машине было задано имя smtserver. После установки было проверено подключение к единицам крупных экземпляров HANA. В зависимости от того, как вы организовали разрешение имен, может потребоваться настроить разрешение единиц крупных экземпляров HANA в etc/hosts виртуальной машины Azure. Добавьте в виртуальную машину дополнительный диск, на котором будут храниться исправления. Самого загрузочного диска может оказаться недостаточно. В демонстрируемом случае диск подключен к /srv/www/htdocs, как показано на следующем снимке экрана. 100 ГБ дискового пространства должно быть достаточно.

![развертывание виртуальной машины для сервера SMT](./media/hana-installation/image4_additional_disk_on_smtserver.PNG)

Войдите на единицу крупного экземпляра HANA, выделите/etc/hosts и проверьте, доступна ли виртуальная машина Azure, на которой должен быть запущен сервер SMT по сети.

После успешной проверки необходимо войти в виртуальную машину Azure, где должен быть запущен сервер SMT. Если для входа в виртуальную машину вы используете PuTTY, необходимо выполнить следующую последовательность команд в окне bash:

```
cd ~
echo "export NCURSES_NO_UTF8_ACS=1" >> .bashrc
```

После выполнения этих команд перезапустите bash, чтобы активировать параметры. Затем запустите YAST.

Подключите вашу виртуальную машину (smtserver) к сайту SUSE.

```
smtserver:~ # SUSEConnect -r <registration code> -e s<email address> --url https://scc.suse.com
Registered SLES_SAP 12.2 x86_64
To server: https://scc.suse.com
Using E-Mail: email address
Successfully registered system.
```

После того, как виртуальная машина подключится к сайту SUSE, установите пакеты smt. Используйте следующую команду PuTTY, чтобы установить необходимые пакеты.

```
smtserver:~ # zypper in smt
Refreshing service 'SUSE_Linux_Enterprise_Server_for_SAP_Applications_12_SP2_x86_64'.
Loading repository data...
Reading installed packages...
Resolving package dependencies...
```


Можно также использовать средство YAST для установки пакетов smt. В YAST перейдите в раздел обслуживания программного обеспечения и выполните поиск smt. Выберите пункт smt, который автоматически изменится на yast2-smt, как показано ниже.

![SMT в yast](./media/hana-installation/image5_smt_in_yast.PNG)


Примите выбор для установки на smtserver. После установки перейдите к конфигурации сервера SMT и введите учетные данные организации, полученные ранее в Центре клиентов SUSE. В качестве URL-адреса сервера SMT введите имя узла виртуальной машины Azure. В данной демонстрации это был https://smtserver, как показано на следующих рисунках.

![Конфигурация сервера SMT](./media/hana-installation/image6_configuration_of_smtserver1.png)

На следующем шаге необходимо проверить, работает ли подключение к Центру клиентов SUSE. Как показано на следующих снимках, в демонстрации оно работало.

![Тестирование подключения к Центру клиентов SUSE](./media/hana-installation/image7_test_connect.png)

После запуска программы установки SMT необходимо указать пароль базы данных. Так как это новая установка, необходимо определить этот пароль, как показано на следующих снимках.

![Определение пароля для базы данных](./media/hana-installation/image8_define_db_passwd.PNG)

Далее следует создание сертификата. Заполните поля в диалоговом окне, как показано далее, и действие шага будет продолжено.

![Создание сертификата для сервера SMT](./media/hana-installation/image9_certificate_creation.PNG)

Выполнение шага "Запуск проверки синхронизации" в конце конфигурации может занять несколько минут. После установки и настройки сервера SMT вы должны увидеть каталог repo в разделе точки подключения /srv/www/htdocs/, а также несколько вложенных каталогов. 

Перезапустите сервер SMT и его связанные службы, выполнив эти команды.

```
rcsmt restart
systemctl restart smt.service
systemctl restart apache2
```

## <a name="download-of-packages-onto-smt-server"></a>Загрузка пакетов на сервер SMT

После перезапуска всех служб выберите нужные пакеты в окне управления SMT с помощью Yast. Выбор пакета зависит от образа ОС сервера крупного экземпляра HANA, а не от выпуска SLES или версии виртуальной машины, где запущен сервер SMT. Ниже показан пример экрана выбора.

![Выбор пакетов](./media/hana-installation/image10_select_packages.PNG)

После выбора пакетов необходимо запустить исходную копию выбранных пакетов на настроенном сервере SMT. Эта копия запускается в оболочке с помощью команды smt-mirror, как показано ниже.


![Загрузка пакетов на сервер SMT](./media/hana-installation/image11_download_packages.PNG)

Как показано выше, пакеты следует скопировать в каталоги, созданные в разделе точки подключения /srv/www/htdocs. Этот процесс может занять несколько минут. В зависимости от количества выбранных пакетов он может длиться один час или более.
При завершении этого процесса необходимо перейти к установке клиента SMT. 

## <a name="set-up-the-smt-client-on-hana-large-instance-units"></a>Установка клиента SMT на единицах крупных экземпляров HANA

В нашем случае клиенты представляют собой единицы крупных экземпляров HANA. Программа установки сервера SMT скопировала скрипт clientSetup4SMT.sh в виртуальную машину Azure. Скопируйте этот скрипт в единицу крупного экземпляра HANA, которую нужно подключить к серверу SMT. Запустите скрипт с параметром -h и присвойте ему в качестве параметра имя сервера SMT. В этом примере используется smtserver.

![Настройка клиента SMT](./media/hana-installation/image12_configure_client.PNG)

Возможны ситуации, когда загрузка сертификата с сервера с помощью клиента выполняется успешно, но регистрация завершается ошибкой, как показано ниже.

![Ошибка регистрации клиента](./media/hana-installation/image13_registration_failed.PNG)

В случае сбоя регистрации см. [документ по поддержке SUSE](https://www.suse.com/de-de/support/kb/doc/?id=7006024) и выполните описанные в нем действия.

> [!IMPORTANT] 
> В качестве имени сервера необходимо указать имя виртуальной машины (в нашем случае — smtserver) без указания полного доменного имени. Работает просто имя виртуальной машины. 

После выполнения этих шагов необходимо выполнить следующую команду на единице крупного экземпляра HANA:

```
SUSEConnect –cleanup
```

> [!Note] 
> В наших тестах нам всегда приходилось ждать несколько минут после выполнения этого шага. Немедленное выполнение clientSetup4SMT.sh после корректирующих мер, описанных в статье SUSE, завершалось выводом сообщения о том, что сертификат еще не действителен. После 5–10-минутного ожидания выполнение clientSetup4SMT.sh завершалось успешной конфигурацией клиента.

Если возникли проблемы, которые следует исправить с учетом шагов в статье SUSE, необходимо еще раз перезапустить clientSetup4SMT.sh на единице крупного экземпляра HANA. Теперь процесс должен завершиться успешно, как показано ниже.

![Регистрация клиента успешно выполнена](./media/hana-installation/image14_finish_client_config.PNG)

На этом шаге вы настроили клиент SMT единицы крупного экземпляра HANA для подключения к серверу SMT, установленному на виртуальной машине Azure. Теперь можно выполнять zypper up или zypper in для установки исправлений ОС на крупные экземпляры HANA или установки дополнительных пакетов. Предполагается, что можно получить только те исправления, которые были загружены на сервер SMT ранее.

**Дальнейшие действия**
- См. статью об [установке HANA на HLI](hana-example-installation.md).











