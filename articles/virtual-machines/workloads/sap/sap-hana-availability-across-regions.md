---
title: Доступность SAP HANA в разных регионах Azure | Документация Майкрософт
description: Обзор рекомендаций по обеспечению доступности при запуске SAP HANA на виртуальных машинах Azure в разных регионах Azure.
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: patfilot
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 02/26/2018
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: edbd1885dd529e4ccd38f2012d56865a2147f64d
ms.sourcegitcommit: 6fcd9e220b9cd4cb2d4365de0299bf48fbb18c17
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2018
ms.locfileid: "30842277"
---
# <a name="sap-hana-availability-across-azure-regions"></a>Доступность SAP HANA в разных регионах Azure

В этой статье описаны сценарии, связанные с доступностью SAP HANA в разных регионах Azure. Из-за расстояния между регионами Azure при настройке доступности SAP HANA в нескольких регионах следует учитывать соответствующие рекомендации.

## <a name="why-deploy-across-multiple-azure-regions"></a>Причины выполнения развертывания в нескольких регионах Azure

Регионы Azure часто разделены большим расстоянием. В зависимости от геополитического региона, расстояние между регионами Azure может составлять сотни или даже несколько тысяч километров, как, например, в США. В связи с расстоянием при передаче трафика между ресурсами, развернутыми в двух разных регионах Azure, может происходить существенная задержка кругового пути. Настолько значительная, что предотвращает синхронный обмен данными между двумя экземплярами SAP HANA при обычных рабочих нагрузках SAP. 

С другой стороны, организации часто устанавливают условия к расстоянию между расположением основного и дополнительного центра обработки данных. Такие условия помогают поддерживать доступность на случай возникновения стихийного бедствия, охватывающего более широкую территорию. Например, ураганы, обрушившиеся на Карибские острова и Флориду в сентябре и октябре 2017 г. У вашей организации могут быть по крайней мере минимальные требования к расстоянию. Из-за этого для большинства клиентов Azure необходимо планировать развертывание так, чтобы обеспечить доступность между [регионами Azure](https://azure.microsoft.com/regions/). Так как расстояние между двумя регионами Azure слишком большое для использования режима синхронной репликации HANA, в соответствии с требованиями к целевым времени (RTO) и точке восстановления (RPO) вам может потребоваться развернуть конфигурации доступности в пределах одного региона, а затем выполнить дополнительные развертывания в другом регионе.

Другим аспектом, который следует учитывать в этом случае, является отработка отказа и перенаправление клиентов. Предполагается, что отработка отказа между экземплярами SAP HANA в двух разных регионах Azure всегда осуществляется вручную. Так как используется асинхронный режим репликации системы SAP HANA, есть вероятность, что данные, зафиксированные в основном экземпляре HANA, еще не зафиксированы на дополнительном экземпляре HANA. Таким образом, для конфигураций, где репликация выполняется асинхронно, автоматический переход на другой ресурс невозможен. Даже при отработке отказа с управлением вручную, как при тестировании, вам необходимо принять меры, чтобы убедиться, что все зафиксированные данные в основном экземпляре перенесены на дополнительный экземпляр, и только после этого вручную выполнять перемещение в другой регион Azure.
 
Виртуальная сеть Azure использует другой диапазон IP-адресов. IP-адреса развернуты в другом регионе Azure. Поэтому нужно внести изменения в конфигурацию клиента SAP HANA или, что будет лучшим способом, настроить замену разрешения имен. Таким образом, клиенты перенаправляются на IP-адрес сервера в дополнительном регионе. Дополнительные сведения см. в статье SAP о [восстановлении клиентского соединения после перенаправления](https://help.sap.com/doc/6b94445c94ae495c83a19646e7c3fd56/2.0.02/en-US/c93a723ceedc45da9a66ff47672513d3.html).   

## <a name="simple-availability-between-two-azure-regions"></a>Простая доступность между двумя регионами Azure

Вы можете не устанавливать конфигурацию доступности в одном регионе, однако вам все еще требуется обработка рабочей нагрузки в случае аварии. Обычно это случается в непроизводственных системах. Хотя система может находиться в нерабочем состоянии полдня или даже весь день, нельзя допускать, чтобы это длилось больше 48 часов. Чтобы установка была менее затратной, запустите другую менее важную систему на виртуальной машине. Другая система работает в качестве назначения. Кроме того, вы можете создать виртуальную машину меньшего размера в дополнительном регионе и отказаться от предварительной загрузки данных. Так как отработка отказа выполняется вручную и влечет за собой еще много действий по обработке отказа всего стека приложений, дополнительное время, требуемое на отключение виртуальной машины, изменение ее размера и повторный запуск, приемлемо.

> [!NOTE]
> Даже без предварительной загрузки данных в целевом объекте репликации системы HANA потребуется по крайней мере 64 ГБ памяти. В дополнение к этому необходим достаточный объем памяти для хранения данных хранилища строк в памяти целевого экземпляра.

![Схема двух виртуальных машин в двух регионах](./media/sap-hana-availability-two-region/two_vm_HSR_async_2regions_nopreload.PNG)

> [!NOTE]
> В этой конфигурации вы не можете задать значение 0 для целевой точки восстановления (RPO), так как режим системы репликации HANA является асинхронным. Если все же необходимо это сделать, выберите другую конфигурацию.

Вы можете внести небольшое изменение в конфигурацию — настроить предварительную загрузку данных. Однако, учитывая то, что отработка отказа проводится вручную, а прикладные уровни также нужно переместить в другой регион, это может быть нецелесообразно. 

## <a name="combine-availability-within-one-region-and-across-regions"></a>Объединение доступности в пределах одного или нескольких регионов 

Объединение доступности в нескольких регионах может быть обусловлено следующими факторами:

- В регионе Azure в качестве целевой точки восстановления должно быть задано значение 0.
- Недопустимо, чтобы глобальным операциям организации мешало стихийное бедствие, охватывающее большой регион. Как в случае с ураганами, которые обрушивались на Карибские острова за последние несколько лет.
- Нормативы, требующие такого расстояния между основным и дополнительным регионами, которое выходит за рамки возможного зон доступности Azure.

В таких случаях вы можете настроить для SAP [конфигурацию многоуровневой репликации системы SAP HANA](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.02/en-US/ca6f4c62c45b4c85a109c7faf62881fc.html). Архитектура выглядит следующим образом:

![Схема трех виртуальных машин в двух регионах](./media/sap-hana-availability-two-region/three_vm_HSR_async_2regions_ha_and_dr.PNG)

Эта конфигурация обеспечивает значение RPO 0 с низким целевым временем восстановления (RTO) в пределах основного региона. Она также предоставляет сниженный показатель RPO, если выполняется перемещение в другой регион. Время RTO второго региона зависит от того, выполняется ли предварительная загрузка данных. Многие клиенты используют виртуальную машину в дополнительном регионе, чтобы запустить тестовую систему. В таком варианте использования данные не могут быть предварительно загружены.

> [!NOTE]
> Так как при переходе с уровня 1 на уровень 2 (синхронная репликация в основном регионе) во время репликации системы HANA используется режим работы **logreplay** (воспроизведение журнала), репликация между уровнем 2 и 3 (репликация в дополнительный регион) не может выполняться в режиме **delta_datashipping** (передача разностных данных). Подробные сведения о режимах работы при репликации системы SAP HANA и некоторые ограничения см. в [этой статье](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.02/en-US/627bd11e86c84ec2b9fcdf585d24011c.html). 

## <a name="next-steps"></a>Дополнительная информация

Пошаговое руководство по настройке этих конфигураций в Azure см. в следующих статьях:

- [Высокий уровень доступности SAP HANA на виртуальных машинах Azure](sap-hana-high-availability.md)
- [Your SAP on Azure – Part 4 – High Availability for SAP HANA using System Replication](https://blogs.sap.com/2018/01/08/your-sap-on-azure-part-4-high-availability-for-sap-hana-using-system-replication/) (SAP в Azure (часть 4). Настройка высокого уровня доступности SAP HANA путем использования репликации системы)

 



 
  
