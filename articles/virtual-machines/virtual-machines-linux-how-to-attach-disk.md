<properties
	pageTitle="Подключение диска к виртуальной машине Linux | Microsoft Azure"
	description="Узнайте, как подключить диск данных к виртуальной машине Linux в Azure и инициализировать его, чтобы подготовить к использованию."
	services="virtual-machines"
	documentationCenter=""
	authors="dsk-2015"
	manager="timlt"
	editor="tysonn"
	tags="azure-service-management"/>

<tags
	ms.service="virtual-machines"
	ms.workload="infrastructure-services"
	ms.tgt_pltfrm="vm-linux"
	ms.devlang="na"
	ms.topic="article"
	ms.date="08/11/2015"
	ms.author="dkshir"/>

# Подключение диска данных к виртуальной машине Linux

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-include.md)]В этой статье описывается подключение диска с использованием классической модели развертывания.

Можно присоединять пустые диски и диски с данными. В обоих случаях это фактически файлы .vhd, которые размещаются в вашей учетной записи хранения Azure. Также в обоих случаях после присоединения диска необходимо его инициализировать, чтобы подготовить к использованию. В этой статье говорится о виртуальных машинах, созданных с использованием классической модели развертывания.

> [AZURE.NOTE]Рекомендуется использовать один или несколько отдельных дисков для хранения данных виртуальной машины. При создании виртуальной машины Azure у нее есть диск для операционной системы и временный диск. **Не используйте для хранения данных временный диск.** Как и предполагает его имя, он предназначен только для временного хранения. Этот диск не обеспечивает избыточности или резервного копирования, поскольку он не размещается в хранилище Azure. Временный диск обычно управляется агентом Linux для Azure и автоматически подключается к **/mnt/resource** (или **/mnt** в образах Ubuntu). Однако в некоторых случаях диск данных может получить от ядра Linux обозначение вида `/dev/sdc`, и тогда вам потребуется самостоятельно разделить, отформатировать и подключить этот ресурс. Подробную информацию см. в статье [Руководство пользователя агента Linux для Azure][Agent].

[AZURE.INCLUDE [howto-attach-disk-windows-linux](../../includes/howto-attach-disk-linux.md)]

## Практическое руководство. Инициализация нового диска данных в Linux

1. Подключитесь к виртуальной машине. Инструкции см. в статье [Как войти в виртуальную машину под управлением Linux][Logon].



2. Далее вам необходимо найти идентификатор устройства для инициализации диска данных. Это можно осуществить двумя способами.

	а) в окне SSH введите следующую команду, а затем введите пароль для учетной записи, которую вы создали для управления виртуальной машиной:

			$sudo grep SCSI /var/log/messages

	Для установки последних дистрибутивов Ubuntu вам может потребоваться использовать `sudo grep SCSI /var/log/syslog`, так как вход в `/var/log/messages` может быть отключен по умолчанию.

	Идентификатор последнего добавленного диска данных можно найти в отображаемых сообщениях.

	![Получение сообщений диска](./media/virtual-machines-linux-how-to-attach-disk/DiskMessages.png)

	ИЛИ

	б) Используйте команду `lsscsi`, чтобы узнать идентификатор устройства. Вы можете установить `lsscsi` с помощью `yum install lsscsi` (в дистрибутивах на основе Red Hat) или `apt-get install lsscsi` (в дистрибутивах на основе Debian). Нужный вам диск вы можете найти по его _LUN_ (**логическому номеру устройства**). Например, для подключенных вами дисков _LUN_ можно легко получить, выполнив команду `azure vm disk list <virtual-machine>`.

			~$ azure vm disk list ubuntuVMasm
			info:    Executing command vm disk list
			+ Fetching disk images
			+ Getting virtual machines
			+ Getting VM disks
			data:    Lun  Size(GB)  Blob-Name                         OS
			data:    ---  --------  --------------------------------  -----
			data:         30        ubuntuVMasm-2645b8030676c8f8.vhd  Linux
			data:    1    10        test.VHD
			data:    2    30        ubuntuVMasm-76f7ee1ef0f6dddc.vhd
			info:    vm disk list command OK

	Сравните эти данные с выводом команды `lsscsi` для той же виртуальной машины.

			adminuser@ubuntuVMasm:~$ lsscsi
			[1:0:0:0]    cd/dvd  Msft     Virtual CD/ROM   1.0   /dev/sr0
			[2:0:0:0]    disk    Msft     Virtual Disk     1.0   /dev/sda
			[3:0:1:0]    disk    Msft     Virtual Disk     1.0   /dev/sdb
			[5:0:0:0]    disk    Msft     Virtual Disk     1.0   /dev/sdc
			[5:0:0:1]    disk    Msft     Virtual Disk     1.0   /dev/sdd
			[5:0:0:2]    disk    Msft     Virtual Disk     1.0   /dev/sde

	Последний номер в кортеже в каждой строке и есть логический номер устройства (_LUN_). См. `man lsscsi` для получения подробной информации.

3. В окне SSH введите следующую команду для создания нового устройства, а затем введите пароль учетной записи:

		$sudo fdisk /dev/sdc

	>[AZURE.NOTE]В этом примере в некоторых дистрибутивах, возможно, потребуется использовать `sudo -i`, если /sbin или /usr/sbin находятся не в `$PATH`.


4. При появлении запроса введите **n** для создания нового раздела.


	![Создание нового устройства](./media/virtual-machines-linux-how-to-attach-disk/DiskPartition.png)

5. При появлении запроса введите **p**, чтобы сделать раздел основным. Введите **1**, чтобы сделать его первым разделом, а затем нажмите клавишу ВВОД, чтобы принять значение по умолчанию для цилиндров.


	![Создание раздела](./media/virtual-machines-linux-how-to-attach-disk/DiskCylinder.png)



6. Введите **p**, чтобы просмотреть сведения о диске, на котором создаются разделы.


	![Просмотр сведений о диске](./media/virtual-machines-linux-how-to-attach-disk/DiskInfo.png)



7. Введите **w**, чтобы записать параметры данного диска.


	![Запись изменений на диске](./media/virtual-machines-linux-how-to-attach-disk/DiskWrite.png)

8. Создайте файловую систему на новом разделе. Например, введите следующую команду, а затем введите пароль данной учетной записи:

		# sudo mkfs -t ext4 /dev/sdc1

	![Создание файловой системы](./media/virtual-machines-linux-how-to-attach-disk/DiskFileSystem.png)

	>[AZURE.NOTE]Обратите внимание, что системы SUSE Linux Enterprise 11 поддерживают доступ только для чтения в файловых системах ext4. Для этих систем рекомендуется форматировать новую файловую систему как ext3, а не ext4.


9. Создайте каталог для подключения новой файловой системы. Например, введите следующую команду, а затем введите пароль данной учетной записи:

		# sudo mkdir /datadrive


10. Введите следующую команду, чтобы установить диск:

		# sudo mount /dev/sdc1 /datadrive

	Диск данных теперь готов для использования как **/datadrive**.


11. Добавьте новый диск в /etc/fstab:

	Чтобы обеспечить автоматическую переустановку диска после перезагрузки, его необходимо добавить в файл /etc/fstab. Кроме того, для ссылки на диск настоятельно рекомендуется использовать идентификатор UUID (глобально уникальный идентификатор) в /etc/fstab, а не просто имя устройства (т. е. /dev/sdc1). Чтобы найти идентификатор UUID нового диска, можно использовать программу **blkid**:

		# sudo -i blkid

	Вывод будет выглядеть примерно следующим образом:

		/dev/sda1: UUID="11111111-1b1b-1c1c-1d1d-1e1e1e1e1e1e" TYPE="ext4"
		/dev/sdb1: UUID="22222222-2b2b-2c2c-2d2d-2e2e2e2e2e2e" TYPE="ext4"
		/dev/sdc1: UUID="33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e" TYPE="ext4"


	>[AZURE.NOTE]Некорректное изменение файла **/etc/fstab** может привести к невозможности загрузить систему. Если не уверены, обратитесь к документации дистрибутива за сведениями о том, как правильно изменить этот файл. Также рекомендуется перед внесением изменений создать резервную копию файла /etc/fstab.

	Затем откройте файл **/etc/fstab** в текстовом редакторе. Обратите внимание, что /etc/fstab является системным файлом, поэтому для его редактирования необходимо воспользоваться `sudo`, например:

		# sudo vi /etc/fstab

	В этом примере мы используем значение UUID для нового устройства **/dev/sdc1**, созданного в предыдущих шагах, и точку подключения **/datadrive**. Добавьте следующую строку в конец файла **/etc/fstab**:

		UUID=33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /datadrive   ext4   defaults   1   2

	Или в системах на основе SUSE Linux может потребоваться использовать другой формат:

		/dev/disk/by-uuid/33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /   ext3   defaults   1   2

	Теперь можно проверить, правильно ли подключена файловая система, просто отключив и повторно подключив файловую систему, т. е. используя типовую точку подключения `/datadrive`, созданную на предыдущих этапах:

		# sudo umount /datadrive
		# sudo mount /datadrive

	Если команда `mount` приводит к ошибке, проверьте правильность синтаксиса в файле /etc/fstab. При создании дополнительных дисков данных и разделов нужно будет также ввести их в файл /etc/fstab отдельно.


>[AZURE.NOTE]Последующее удаление диска данных без редактирования fstab может привести к тому, что виртуальная машина не загрузится. Если это происходит часто, то большинство дистрибутивов предоставляют варианты `nofail` и/или `nobootwait` fstab, которые позволяют системе загружаться, даже если диск не подключится во время загрузки. Дополнительные сведения об этих параметрах можно найти в документации по вашему дистрибутиву.

## Дополнительные ресурсы
[Вход в виртуальную машину под управлением ОС Linux][Logon]

[Отсоединение диска от виртуальной машины Linux](virtual-machines-linux-how-to-detach-disk.md)

[Управление службами Azure с помощью интерфейса командной строки Azure](virtual-machines-command-line-tools.md)

<!--Link references-->
[Agent]: virtual-machines-linux-agent-user-guide.md
[Logon]: virtual-machines-linux-how-to-log-on.md

<!---HONumber=Sept15_HO4-->