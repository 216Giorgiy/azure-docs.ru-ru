<properties
	pageTitle="Устранение неполадок подключения к удаленному рабочему столу на виртуальной машине Azure | Microsoft Azure"
	description="Устраните неполадки подключения к удаленному рабочему столу на виртуальной машине под управлением Windows. Узнайте порядок действий в зависимости от полученного сообщения об ошибке и ознакомьтесь с подробной диагностикой неполадок, связанных с сетью."
	keywords="Ошибка удаленного рабочего стола, ошибка подключения к удаленному рабочему столу, не удается подключиться к виртуальной машине, диагностика удаленного рабочего стола"
	services="virtual-machines"
	documentationCenter=""
	authors="dsk-2015"
	manager="timlt"
	editor=""
	tags="top-support-issue,azure-service-management,azure-resource-manager"/>

<tags
	ms.service="virtual-machines"
	ms.workload="infrastructure-services"
	ms.tgt_pltfrm="vm-windows"
	ms.devlang="na"
	ms.topic="article"
	ms.date="10/27/2015"
	ms.author="dkshir"/>

# Устранение неполадок с подключением к удаленному рабочему столу на виртуальной машине Azure под управлением Windows

Сбои удаленного рабочего стола (RDP) при попытке подключения к виртуальной машине Azure под управлением Windows могут возникать по разным причинам. Проблемы могут быть связаны с программным обеспечением RDP на виртуальной машине, главным компьютером или сетевым подключением либо возникнуть при подключении на стороне клиента. Эта статья поможет определить и устранить причины сбоя.

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-both-include.md)]

Статья относится только к виртуальным машинам Azure под управлением Windows. Для виртуальных машин Azure под управлением Linux см. раздел [Устранение неполадок с подключением Secure Shell (SSH) к виртуальной машине Azure под управлением Linux](virtual-machines-troubleshoot-ssh-connections.md).

Если в любой момент при изучении этой статьи вам потребуется дополнительная помощь, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](http://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт службы поддержки Azure](http://azure.microsoft.com/support/options/) и нажмите **Поддержка**.

В первом разделе, «Основные шаги», перечислен порядок действий для устранения распространенных проблем подключения; второй раздел содержит порядок действий при получении того или иного сообщения об ошибке; а последний включает подробные сведения по устранению неполадок, связанных с каждым сетевым компонентом.

## Устранение распространенных ошибок удаленного рабочего стола в классической модели развертывания

Описанные основные шаги помогут устранить большинство распространенных ошибок подключения к удаленному рабочему столу в виртуальных машинах, созданных с помощью классической модели развертывания. После выполнения каждого шага попробуйте подключиться к виртуальной машине еще раз.

- Для решения проблемы запуска, связанной с сервером RDP, сбросьте службу удаленного рабочего стола на [портале Azure](https://portal.azure.com).<br> Последовательно выберите «Просмотреть все» > «Виртуальные машины (классика)» > имя вашей виртуальной машины Windows > **Сброс удаленного доступа**.

    ![Снимок экрана, на котором показан сброс конфигурации RDP](./media/virtual-machines-troubleshoot-remote-desktop-connections/Portal-RDP-Reset-Windows.png)

- Перезапустите виртуальную машину для решения других проблем с запуском.<br> Последовательно выберите «Просмотреть все» > «Виртуальные машины (классика)» > имя вашей виртуальной машины Windows > **Перезапустить**.

- Для решения любой проблемы хостинга измените размер виртуальной машины.<br> Последовательно выберите «Просмотреть все» > «Виртуальные машины (классика)» > имя вашей виртуальной машины Windows > «Параметр» > **Размер**. Подробные инструкции см. в статье [Перезапуск виртуальной машины](https://msdn.microsoft.com/library/dn168976.aspx).

- Проверьте журнал консоли виртуальной машины или снимок экрана, чтобы устранить проблемы с загрузкой. Последовательно выберите «Просмотреть все» > «Виртуальные машины (классика)» > имя вашей виртуальной машины Windows > **Диагностика загрузки**.

- Проверьте работоспособность ресурсов виртуальной машины, чтобы выявить любые проблемы, связанные с платформой. Последовательно выберите "Просмотреть все" > "Виртуальные машины (классика)" > имя вашей виртуальной машины Windows > **Проверить работоспособность**

## Устранение распространенных ошибок удаленного рабочего стола в модели развертывания диспетчера ресурсов

Описанные основные шаги помогут устранить большинство распространенных ошибок подключения к удаленному рабочему столу в виртуальных машинах, созданных с помощью модели развертывания диспетчера ресурсов. После выполнения каждого шага попробуйте подключиться к виртуальной машине еще раз.

- Выполните сброс удаленного доступа с помощью Powershell<br> a. [Установите Azure PowerShell и подключитесь к подписке Azure](../powershell-install-configure.md) с помощью метода Azure AD (если вы еще этого не сделали).

	b. Переключитесь в режим диспетчера ресурсов.

	```
	Switch-AzureMode -Name AzureResourceManager
	```
	c. Выполните команду Set-AzureVMAccessExtension, чтобы сбросить подключение к удаленному рабочему столу, как показано в следующем примере.

	```
	Set-AzureVMExtension -ResourceGroupName "myRG" -VMName "myVM" -Name "myVMAccessExtension" -ExtensionType "VMAccessAgent" -Publisher "Microsoft.Compute" -typeHandlerVersion "2.0" -Location Westus
	```

- Перезапустите виртуальную машину для устранения других проблем с запуском.<br> Последовательно выберите «Просмотреть все» > «Виртуальные машины» > имя вашей виртуальной машины Windows > **Перезапустить**.

- Для устранения каких-либо проблем с размещением измените размер виртуальной машины.<br> Последовательно выберите «Просмотреть все» > «Виртуальные машины» > имя вашей виртуальной машины Windows > «Параметр» > **Размер**.

- Проверьте журнал консоли виртуальной машины или снимок экрана, чтобы устранить проблемы с загрузкой. Последовательно выберите «Просмотреть все» > «Виртуальные машины» > имя вашей виртуальной машины Windows > **Диагностика загрузки**.


## Устранение характерных ошибок подключения удаленного рабочего стола

Ниже перечислены наиболее распространенные ошибки, которые могут возникнуть при попытке подключения виртуальной машины Azure к удаленному рабочему столу.

1. [Ошибка подключения к удаленному рабочему столу: удаленный сеанс отключен, поскольку отсутствуют доступные серверы лицензирования удаленных рабочих столов, которые могли бы провести лицензирование.](#rdplicense)

2. [Ошибка подключения к удаленному рабочему столу: клиенту удаленного рабочего стола не удается найти компьютер "имя компьютера".](#rdpname)

3. [Ошибка подключения к удаленному рабочему столу: "Произошла ошибка проверки подлинности. Не удается связаться с локальным администратором безопасности»](#rdpauth).

4. [Ошибка безопасности Windows: учетные данные не работают](#wincred).

5. [Ошибка подключения к удаленному рабочему столу: не удалось подключить компьютер к удаленному компьютеру.](#rdpconnect)

<a id="rdplicense"></a>
### Ошибка подключения к удаленному рабочему столу: удаленный сеанс отключен, поскольку отсутствуют доступные серверы лицензирования удаленных рабочих столов, которые могли бы провести лицензирование.

Причина: истек 120-дневный льготный период лицензирования для роли сервера удаленных рабочих столов, и вам необходимо установить лицензии.

В качестве решения вы можете сохранить локальную копию RDP-файла с портала Azure, а затем установить подключение, выполнив следующую команду в командной строке Windows PowerShell:

		mstsc <File name>.RDP /admin

В результате лицензирование будет отключено для данного подключения.

Если вы не планируете устанавливать более двух одновременных подключений к удаленному рабочему столу виртуальной машины, вы можете удалить роль сервера удаленных рабочих столов с помощью диспетчера серверов.

Также ознакомьтесь с записью в блоге [Сбой виртуальной машины Azure с сообщением об отсутствии доступных серверов лицензирования удаленных рабочих столов](http://blogs.msdn.com/b/wats/archive/2014/01/21/rdp-to-azure-vm-fails-with-quot-no-remote-desktop-license-servers-available-quot.aspx).

<a id="rdpname"></a>
### Ошибка подключения к удаленному рабочему столу: клиенту удаленного рабочего стола не удается найти компьютер «имя компьютера».

Причина: клиенту удаленного рабочего стола не удалось разрешить имя компьютера в параметрах RDP-файла.

Возможные решения

- Если вы работаете в интрасети организации, убедитесь в том, что у вашего компьютера есть доступ к прокси-серверу и возможность передавать на него данные по протоколу HTTPS.
- Если вы работаете с локальным RDP-файлом, попробуйте воспользоваться файлом, созданным с помощью портала управления Azure. так вы гарантируете правильность имени облачной службы и номера порта конечной точки виртуальной машины. Вот пример RDP-файла, созданного порталом Azure:

		full address:s:tailspin-azdatatier.cloudapp.net:55919
		prompt for credentials:i:1

Адресная часть в этом RDP-файле представляет собой полное доменное имя облачной службы, в которой находится виртуальная машина (в этом примере — tailspin-azdatatier.cloudapp.net), и внешнего TCP-порта конечной точки для обмена данными с удаленным рабочим столом (55919).

<a id="rdpauth"></a>
### Ошибка подключения к удаленному рабочему столу: «Произошла ошибка проверки подлинности. Не удается связаться с локальным администратором безопасности».

Причина: целевой виртуальной машине не удается найти администратора безопасности, указанного в части имени пользователя ваших учетных данных.

Если имя пользователя имеет вид *SecurityAuthority*\*имя\_пользователя* (например, CORP\\User1), часть *SecurityAuthority* — это имя компьютера виртуальной машины (для локальной системы безопасности) или имя домена Active Directory.

Возможные решения

- Если учетная запись является локальной для виртуальной машины, проверьте правильность написания имени виртуальной машины.
- Если учетная запись относится к домену Active Directory, проверьте правильность написания имени домена.
- Если она является учетной записью домена Active Directory и имя домена указано правильно, убедитесь, что контроллер домена доступен для этого домена. Это может быть распространенной проблемой в виртуальной сети Azure с контроллерами домена, в которой не запущен компьютер контроллера домена. В качестве решения вместо учетной записи домена используйте учетную запись локального администратора.

<a id="wincred"></a>
### Ошибка безопасности Windows: учетные данные не работают.

Причина: целевой виртуальной машине не удается найти проверить имя и пароль учетной записи.

Компьютер Windows принимает данные локальных учетных записей и учетных записей домена.

- В случае локальных учетных записей используйте синтаксис *имя\_компьютера*\*имя\_пользователя* (например, SQL1\\Admin4798).
- В случае учетных записей домена используйте синтаксис *имя\_домена*\*имя\_пользователя* (например, CONTOSO\\johndoe).

Если вы повысили уровень виртуальной машины до контроллера домена в новом лесу Active Directory, локальная учетная запись администратора, под которой вы выполнили вход в систему, преобразуется в эквивалентную учетную запись с тем же паролем в новом лесу и домене. Затем учетная запись локального администратора удаляется. Например, если вы вошли с локальной учетной записью администратора DC1\\DCAdmin и повысили уровень виртуальной машины до контроллера домена corp.contoso.com в новом лесу, локальная учетная запись DC1\\DCAdmin удаляется, а вместо нее создается новая учетная запись домена CORP\\DCAdmin с тем же паролем.

Убедитесь, что имя учетной записи — это имя, которое виртуальная машина может проверить и принять как действительную учетную запись, а пароль указан правильно.

Указания по смене пароля учетной записи локального администратора см. в статье [Сброс пароля или службы удаленных рабочих столов для виртуальных машин Windows](virtual-machines-windows-reset-password.md).

<a id="rdpconnect"></a>
### Ошибка подключения к удаленному рабочему столу: не удалось подключить компьютер к удаленному компьютеру.

Причина: у учетной записи, которую вы используете для подключения, нет прав для входа на удаленный рабочий стол.

На каждом компьютере Windows есть локальная группа пользователей удаленного рабочего стола. Она содержит учетные записи и группы, обладающие правом удаленного входа. Аналогичные права доступа есть и у участников локальной группы администраторов, хотя соответствующие учетные записи и не входят в локальную группу пользователей удаленного рабочего стола. На компьютерах, подключенных к домену, локальная группа администраторов также содержит учетные записи администраторов этого домена.

Убедитесь в том, что у учетной записи, которую вы используете для подключения, есть права для входа на удаленный рабочий стол. В качестве решения вы можете воспользоваться учетной записью администратора домена или локального администратора, чтобы создать подключение к удаленному рабочему столу и добавить требуемую учетную запись в локальную группу пользователей удаленного рабочего стола в оснастке "Управление компьютером" (**Служебные программы > Локальные пользователи и группы > Группы > Пользователи удаленного рабочего стола**).

## Подробная диагностика ошибок удаленного рабочего стола

Если ни одна из указанных ошибок не возникла, но подключиться к виртуальной машине с помощью удаленного рабочего стола не удается, поищите другие причины в [этой статье](virtual-machines-rdp-detailed-troubleshoot.md).


## Дополнительные ресурсы

[Пакет диагностики Azure IaaS (Windows)](https://home.diagnostics.support.microsoft.com/SelfHelp?knowledgebaseArticleFilter=2976864)

[Сброс пароля или службы удаленных рабочих столов для виртуальных машин Windows](virtual-machines-windows-reset-password.md)

[Установка и настройка Azure PowerShell](../install-configure-powershell.md)

[Устранение неполадок с подключением Secure Shell (SSH) к виртуальной машине Azure под управлением Linux](virtual-machines-troubleshoot-ssh-connections.md)

[Устранение неполадок доступа к приложению, выполняющемуся в виртуальной машине Azure](virtual-machines-troubleshoot-access-application.md)

<!---HONumber=Nov15_HO4-->