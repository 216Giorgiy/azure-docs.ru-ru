<properties pageTitle="Создание кластера Oracle WebLogic Server 12c в Azure" description="Пошагово создайте пример с кластера Oracle WebLogic Server 12c в Microsoft Azure." services="virtual-machines" authors="bbenz" documentationCenter=""/>
<tags ms.service="virtual-machines" ms.devlang="na" ms.topic="article" ms.tgt_pltfrm="na" ms.workload="infrastructure-services" ms.date="06/22/2015" ms.author="bbenz" />
#Создание кластера Oracle WebLogic Server 12c в Azure
В следующем примере показано, как создать кластер Oracle WebLogic Server в Azure на основе образа Oracle WebLogic Server 12c от корпорации Майкрософт под управлением Windows Server 2012.

Каждый экземпляр в кластере WebLogic Server должен использовать одну версию Oracle WebLogic Server. В этом примере применяется версия WebLogic Server 12c Enterprise Edition.

##Создание виртуальных машин для использования в кластере
Вы создадите виртуальную машину, которая будет использоваться в качестве сервера администрирования кластера, а также дополнительные виртуальные машины для использования в качестве части кластера.

### Создание виртуальной машины для сервера администрирования

Создайте виртуальную машину, используя образ **Oracle WebLogic Server 12c Enterprise Edition в Windows Server 2012**, доступный в Azure. Указания по созданию этой виртуальной машины можно найти в разделе [Создание виртуальной машины Oracle WebLogic Server 12c в Azure](#creating-an-oracle-weblogic-server-12c-virtual-machine-in-azure-new-article). Для целей этого учебника назовите виртуальную машину **MYVM1-ADMIN**. Запишите DNS-имя облачной службы, которую вы создаете — оно будет использоваться при создании дополнительных виртуальных машин, добавляемых в кластер. (DNS-имя может быть любым, но уникальным в Azure.)

### Создание управляемых виртуальных машин для использования в кластере

Создайте дополнительные виртуальные машины, которыми будет управлять сервер администрирования, используя образ Oracle WebLogic Server 12c, доступный в Azure. Для целей данного учебника назовите дополнительные виртуальные машины **MYVM2-MANAGED** и **MYVM3-MANAGED**. Указания по их созданию представлены в разделе [Создание виртуальной машины Oracle WebLogic Server 12c в Azure](#creating-an-oracle-weblogic-server-12c-virtual-machine-in-azure-new-article), *но необходимо* внести следующее изменение:

-  При создании виртуальных машин не создавайте новую виртуальную сеть. В частности, в диалоговом окне **Дополнительная настройка > Виртуальная сеть** вместо используемого по умолчанию параметра **Создать новую виртуальную сеть** выберите виртуальную сеть, созданную для виртуальной машины сервера администрирования. Например, если во время создания сервера администрирования вы создали виртуальную сеть с именем **EXAMPLE**, выберите **EXAMPLE** при создании управляемых виртуальных машин кластера.

##Создание домена

1. Войдите на [портал Azure](https://ms.portal.azure.com/).

2. Щелкните **Виртуальные машины**.

3. Щелкните имя виртуальной машины, созданной для сервера администрирования кластера (например, **MYVM1-ADMIN**).

4. Щелкните **Подключить**.

5. Отвечайте на запросы, появляющиеся при подключении к виртуальной машине. При получении запроса на ввод имени и пароля администратора используйте значения, которые были указаны при создании виртуальной машины.

6. На **странице 1** диалогового окна **мастера настройки ПО промежуточного уровня Fusion** щелкните **Create a new domain** (Создать домен) и нажмите кнопку **Next** (Далее). (Если диалоговое окно **мастера настройки ПО промежуточного уровня Fusion** еще не открыто, нажмите кнопку **Пуск** Windows, введите **Configuration Wizard** и щелкните значок **Configuration Wizard** (Мастер настройки).)

	![](media/virtual-machines-creating-oracle-webLogic-server-12c-cluster/image19.png)

7. На **странице 2** диалогового окна **мастера настройки ПО промежуточного уровня Fusion** выберите шаблон **Basic WebLogic Server Domain** (Базовый домен WebLogic Server) и нажмите кнопку **Next** (Далее).

	![](media/virtual-machines-creating-oracle-webLogic-server-12c-cluster/image20.png)

8. На **странице 3** диалогового окна **мастера настройки ПО промежуточного уровня Fusion**:

	1. [Необязательно.] Измените имя пользователя **weblogic** по своему выбору.
	
	2. Укажите и подтвердите пароль для администратора WebLogic Server.
	
	3. Нажмите кнопку **Далее**.

	![](media/virtual-machines-creating-oracle-webLogic-server-12c-cluster/image21.png)

9. На **странице 4** диалогового окна **мастера настройки ПО промежуточного уровня Fusion** выберите режим домена **Production** (Производственный), выберите доступный JDK (при необходимости найдите нужный JDK) и нажмите кнопку **Next** (Далее).

	![](media/virtual-machines-creating-oracle-webLogic-server-12c-cluster/image22.png)

10.  На **странице 5** диалогового окна **мастера настройки ПО промежуточного уровня Fusion** не выбирайте какие-либо параметры, а просто нажмите кнопку **Next** (Далее).

	![](media/virtual-machines-creating-oracle-webLogic-server-12c-cluster/image23.png)

11.  На **странице 6** диалогового окна **мастера настройки ПО промежуточного уровня Fusion** нажмите кнопку **Create** (Создать).

	![](media/virtual-machines-creating-oracle-webLogic-server-12c-cluster/image24.png)

12.  На **странице 7** диалогового окна **мастера настройки ПО промежуточного уровня Fusion** после создания домена нажмите кнопку **Next** (Далее).

	![](media/virtual-machines-creating-oracle-webLogic-server-12c-cluster/image25.png)

13.  На **странице 8** диалогового окна **мастера настройки ПО промежуточного уровня Fusion** установите флажок «Start Admin Server» (Запустить сервер администрирования) и нажмите кнопку **Finish** (Готово).

	![](media/virtual-machines-creating-oracle-webLogic-server-12c-cluster/image26.png)

14.  Запустится командная строка **startWebLogic.cmd**. При появлении запроса укажите имя пользователя и пароль WebLogic.

##Настройка кластера

1. Не выходя из виртуальной машины администрирования, запустите **консоль администрирования WebLogic Server**, <http://localhost:7001/console>. При появлении запроса укажите имя пользователя и пароль WebLogic Server.

2. В **консоли администрирования WebLogic Server** щелкните **Lock & Edit** (Заблокировать и изменить).

3. В области **Domain Structure** (Структура домена) разверните раздел **Environment** (Среда) и щелкните **Clusters** (Кластеры).

4. В диалоговом окне **Summary of Clusters** (Сводка кластеров) нажмите кнопку **New** (Создать) и выберите **Cluster** (Кластер).

5. В диалоговом окне **Clusters Property** (Свойство кластеров):

	1. Введите имя кластера.

	2. Выберите элемент **Unicast** (Одноадресный) для параметра **Messaging Mode** (Режим обмена сообщениями).

		![](media/virtual-machines-creating-oracle-webLogic-server-12c-cluster/image001.png)

	
	3. Нажмите кнопку **ОК**.

6. В области **Domain Structure** (Структура домена) разверните раздел **Environment** (Среда) и щелкните **Servers** (Серверы).

7. Добавьте первый управляемый сервер в кластер.

	1. Нажмите кнопку **Создать**.

	2. В диалоговом окне **Create a New Server** (Создание сервера):

		1. В поле **Server Name** (Имя сервера) введите имя первого управляемого сервера. Например, \*\*MYVM2-MANAGED\*\*.

		2. В поле **Server Listen Address** (Адрес прослушивания сервера) повторно введите имя.

		3. В поле **Listen Port** (Порт прослушивания) введите **7008**.

		4. Установите флажок **Yes, make this server a member of an existing cluster** (Да, сделать этот сервер членом существующего кластера).

		5. В раскрывающемся списке **Select a cluster** (Выберите кластер) выберите созданный ранее кластер.

			34d27e82-bb2e-4f9c-aaad-ca3e28c0f5fc

		6. Нажмите кнопку **Далее**.

		7. Нажмите кнопку **Готово**

8. Добавьте второй управляемый сервер в кластер, выполнив указанные выше действия. В полях **Server Name** (Имя сервера) и **Server Listen Address** (Адрес прослушивания сервера) введите имя второго управляемого компьютера. В поле **Listen Port** (Порт прослушивания) укажите **7008**.

9. В консоли администрирования WebLogic Server щелкните **Activate Changes** (Активировать изменения).

10. На виртуальной машине администратора создайте переменную среды **SERVER\_HOME** со значением **C:\\Oracle\\Middleware\\Oracle\_Home\\wlserver**. Создать переменную среды можно, выполнив следующие действия:

	1. Нажмите кнопку **Пуск** Windows, введите **панель управления**, щелкните значок **Панель управления**, затем последовательно щелкните **Система и безопасность**, **Система** и **Дополнительные параметры системы**.

	2. Щелкните вкладку **Дополнительно**, а затем нажмите кнопку **Переменные среды**.

	3. В разделе **Системные переменные** нажмите кнопку **Создать**, чтобы создать переменную.

	4. В диалоговом окне **Новая системная переменная** введите **SERVER\_HOME** в качестве имени переменной и введите значение **C:\\Oracle\\Middleware\\Oracle\_Home\\wlserver**.

	5. Нажмите кнопку **ОК**, чтобы сохранить новую переменную среды и закрыть диалоговое окно **Новая системная переменная**.

	6. Закройте другие диалоговые окна, открытые из панели управления.

11. Откройте новое окно командной строки (чтобы переменная среды **SERVER\_HOME** вступила в действие).

	>[AZURE.NOTE]Для выполнения некоторых из оставшихся шагов требуется использовать командную строку после входа на виртуальные машины. Чтобы легко определить компьютер, на котором вы вошли в систему, после открытия окна командной строки выполните команду **title %COMPUTERNAME%**.
	>
	>(**%COMPUTERNAME%** — это определенная системой переменная среды, которой автоматически присваивается имя компьютера. Выполнение команды **title** **%COMPUTERNAME%** приведет к отображению имени компьютера в заголовке окна командной строки.)

12. Выполните следующую команду:

		%SERVER\_HOME%\\common\\bin\\pack.cmd -managed=true -domain=C:\\Oracle\\Middleware\\Oracle\_Home\\user\_projects\\domains\\base\_domain -template=c:\\mytestdomain.jar -template\_name="mytestdomain" 

	Эта команда создает JAR-файл с именем **c:\\mytestdomain.jar**. Позднее вы скопируете этот JAR-файл на управляемые виртуальные машины в кластере.

13. Разрешите в брандмауэре входящие подключения через порт 7001:

	1. Не выходя из виртуальной машины, нажмите кнопку **Пуск** Windows, введите **брандмауэр Windows в режиме повышенной безопасности**, затем щелкните значок **Брандмауэр Windows в режиме повышенной безопасности**. Откроется консоль управления **Брандмауэр Windows в режиме повышенной безопасности**.

	2. В консоли управления брандмауэра в левой области щелкните **Правила для входящих подключений** (если вы не видите пункт **Правила для входящих подключений**, разверните верхний узел в левой области) и щелкните **Создать правило** в области справа.

	3. В разделе **Тип правила** выберите **Для порта** и нажмите кнопку **Далее**.

	4. В разделе **Протокол и порты** выберите **Протокол TCP**, выберите **Определенные локальные порты**, введите номер порта **7001** и нажмите кнопку **Далее**.

	5. Выберите **Разрешить подключение** и нажмите **Далее**.

	6. Примите значения по умолчанию для профилей, к который применяется правило, и нажмите кнопку **Далее**.

	7. Укажите имя правила и необязательное описание, затем нажмите кнопку **Готово**.

14. Для каждой управляемой виртуальной машины:

	1. Войдите на виртуальную машину.

	2. Создайте переменную среды **SERVER\_HOME** со значением **C:\\Oracle\\Middleware\\Oracle\_Home\\wlserver**.

	3. Скопируйте файл c:\\mytestdomain.jar из виртуальной машины администрирования в файл c:\\mytestdomain.jar на управляемой виртуальной машине.

	4. Откройте командную строку (и не забудьте выполнить команду **title %COMPUTERNAME%**, чтобы понять, к какому компьютеру вы получаете доступ).

	5. Выполните следующую команду:

			%SERVER\_HOME%\\common\\bin\\unpack.cmd -domain=C:\\Oracle\\Middleware\\Oracle\_Home\\user\_projects\\domains\\base\_domain -template=c:\\mytestdomain.jar

	6. Смените текущий каталог командной строки на **C:\\Oracle\\Middleware\\Oracle\_Home\\user\_projects\\domains\\base\_domain\\bin**.

	7. Выполните команду "start <<\*имя\_компьютера\*>>.cmd", где <<\*имя\_компьютера\*>> — это имя управляемого компьютера. Например, **startMYVM2-MANAGED**.

	8. При появлении запроса укажите имя пользователя и пароль WebLogic Server.

	9. Разрешите в брандмауэре входящие подключения через порт 7008. (Выполните действия, используемые для открытия порта 7001 на сервере администрирования, но для управляемых серверов используйте порт 7008.)

15. На виртуальной машине администрирования откройте **консоль администрирования WebLogic Server**, <http://localhost:7001/console>, и посмотрите, какие серверы запущены.

	![](media/virtual-machines-creating-oracle-webLogic-server-12c-cluster/image003.png)

16. Создайте набор конечных точек с балансировкой нагрузки для управляемых виртуальных машин:

	1. На [портале Azure](https://ms.portal.azure.com/) в разделе **Виртуальные машины** выберите первую управляемую виртуальную машину (например, **MYVM2-MANAGED)**. 
	2. Щелкните **Параметры**, щелкните **Конечные точки** и нажмите кнопку **Добавить**.

	3. Введите имя конечной точки, выберите протокол **TCP**, укажите общий порт **80** и частный порт **7008**. Значения остальных параметров оставьте без изменений.

	4. Установите флажок **Создать набор балансировки нагрузки** и нажмите кнопку **Завершить**.

	5. Укажите имя набора балансировки нагрузки, примите значения по умолчанию для остальных параметров и нажмите кнопку **Завершить.

17. Создание конечной точки для виртуальной машины:

	1. Войдите на [портал Azure](https://ms.portal.azure.com/).

	2. Щелкните **Обзор**.

	3. Щелкните **Виртуальные машины**.

	4. Выберите виртуальную машину.

	5. Щелкните **Параметры**.

	6. Щелкните **Наборы балансировки нагрузки**.

	7. Щелкните **Соединить**.

	8. Задайте тип набора балансировки нагрузки **Внутренний**.

	9. Укажите имя конечной точки.

		1. Укажите протокол **TCP**.

		2. Укажите номер **80** для общего порта.

		3. Используйте порт зонда **7008**.

	10. Значения остальных параметров оставьте без изменений.

	11. Нажмите кнопку **ОК**.

	12. Перед переходом к следующему шагу дождитесь, пока эта виртуальная машина присоединится к набору балансировки нагрузки.

18. На [портале Azure](https://ms.portal.azure.com/) в разделе **Виртуальные машины** выберите вторую управляемую виртуальную машину (например, **MYVM3-MANAGED**). Выполните действия, описанные выше, для присоединения к набору балансировки нагрузки, созданного для первой управляемой виртуальной машины.

##Развертывание приложения в кластере

На этом этапе вы можете развернуть приложение, выполнив следующие действия. Предположим, что вы развертываете приложение Oracle shoppingcart, которое можно скачать по адресу <http://www.oracle.com/webfolder/technetwork/tutorials/obe/fmw/wls/12c/12-ManageSessions--4478/files/shoppingcart.war>.

1. Войдите на виртуальную машину, которая служит сервером администрирования кластера WebLogic Server (например, **MYVM1-ADMIN**). 

2. Локально скопируйте файл shoppingcart.war. Например, создайте папку с именем **c:\\mywar** и сохраните WAR-файл, полученный по адресу <http://www.oracle.com/webfolder/technetwork/tutorials/obe/fmw/wls/12c/12-ManageSessions--4478/files/shoppingcart.war>, в **c:\\mywar**.

3. Откройте **консоль администрирования WebLogic Server**, <http://localhost:7001/console>. При появлении запроса укажите имя пользователя и пароль WebLogic.

4. В **консоли администрирования WebLogic Server** последовательно щелкните **Lock & Edit** (Заблокировать и изменить), **Deployments** (Развертывания) и нажмите кнопку **Install** (Установить).

5. В поле **Path** (Путь) введите **c:\\myway\\shoppingcart.war**.

	![](media/virtual-machines-creating-oracle-webLogic-server-12c-cluster/image004.png)

	Нажмите кнопку **Далее**.

6. Выберите **Install this deployment as an application** (Установить это развертывание как приложение) и нажмите кнопку **Next** (Далее).

7. Нажмите кнопку **Готово**

8. В поле **Available Targets** (Доступные целевые объекты) выберите созданный ранее кластер, убедитесь, что флажок **All servers in the cluster** (Все серверы в кластере) установлен, и нажмите кнопку **Next** (Далее).

9. В разделе **Source Accessibility** (Доступность источника) установите флажок **Copy this application onto every target for me** (Скопировать приложение в каждый целевой объект) и нажмите кнопку **Finish** (Готово).

10.  В **консоли администрирования WebLogic Server** нажмите кнопку **Save** (Сохранить) и щелкните **Activate Changes** (Активировать изменения).

11.  Щелкните **Deployments** (Развертывания), выберите **shoppingcart**, щелкните **Start** (Запуск), затем щелкните **Service All Requests** (Обслуживать все запросы). При появлении запроса на подтверждение щелкните **Yes** (Да).

12.  Чтобы увидеть выполнение приложения shoppingcart в Интернете, откройте в браузере URL-адрес вида `http://<<unique_domain_name>>/shoppingcart`. (Значение `<<unique_domain_name>>` можно определить на [портале Azure](https://ms.portal.azure.com/), щелкнув «Виртуальные машины» и выбрав виртуальную машину, которая используется для запуска Oracle WebLogic Server.)

## Дальнейшие действия

Чтобы проверить работу кластера, вы можете изменить проект shoppingcart.war для отображения имени компьютера, который обслуживает сеанс браузера, запустить сеанс браузера, остановить виртуальную машину, которая обслуживала сеанс браузера, и обновить сеанс браузера, чтобы убедиться, что другая виртуальная машина продолжает обслуживать сеанс.

Например:

1. Добавьте в начало файла **DWRHeader1.jspf** следующий код:

		<table>
		
		<tr><td><CENTER><b><h3><% out.println("Your request is served from " + System.getenv("computername") ); %></h3></b></CENTER></td></tr>
		
		</table>             

2. Добавьте в файл **weblogic.xml** следующий код после строки комментария `Insert session descriptor element here`.

		<session-descriptor>
			<persistent-store-type>replicated_if_clustered</persistent-store-type>
		</session-descriptor>


3. Повторно скомпилируйте и разверните обновленный проект shoppingcart.war.

4. Откройте сеанс браузера и запустите приложение shoppingcart. Добавьте несколько элементов в корзину покупок и обратите внимание на то, какая машина обслуживает сеанс браузера.

5. На портале Azure в разделе **Виртуальные машины** выберите виртуальную машину, которая обслуживала сеанс браузера, и нажмите кнопку **Завершение работы**. Подождите, пока состояние виртуальной машины не изменится на **Остановлена (освобождена)** перед продолжением.

6. Обновите сеанс браузера, в котором выполняется приложение shoppingcart, и убедитесь, что другая виртуальная машина обслуживает сеанс браузера.

7. Щелкните ссылку на корзину покупок, чтобы убедиться, что добавленные ранее элементы все еще находятся в корзине.

## Дополнительные ресурсы

Теперь, настроив кластер, в котором выполняется Oracle WebLogic Server, вы можете ознакомиться следующими разделами, чтобы получить дополнительную информацию.

- [Образы виртуальных машин Oracle. Различные рекомендации](virtual-machines-miscellaneous-considerations-oracle-virtual-machine-images.md)

- [Документация по продукту Oracle WebLogic Server](http://www.oracle.com/technetwork/middleware/weblogic/documentation/index.html)

- [Oracle WebLogic Server 12c с использованием Linux в Microsoft Azure](http://www.oracle.com/technetwork/middleware/weblogic/learnmore/oracle-weblogic-on-azure-wp-2020930.pdf)

<!---HONumber=July15_HO5-->