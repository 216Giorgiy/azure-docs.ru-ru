---
title: "Запись образа виртуальной машины Linux | Документация Майкрософт"
description: "Узнайте, как записать образ виртуальной машины Azure под управлением Linux, созданной с помощью классической модели развертывания."
services: virtual-machines-linux
documentationcenter: 
author: iainfoulds
manager: timlt
editor: tysonn
tags: azure-service-management
ms.assetid: 17d7ffee-a58e-4290-9de1-64c3cf1ddc05
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 08/31/2016
ms.author: iainfou
translationtype: Human Translation
ms.sourcegitcommit: 63cf1a5476a205da2f804fb2f408f4d35860835f
ms.openlocfilehash: 7453b7b5938a15564110cae31fa878ee3616620a


---
# <a name="how-to-capture-a-classic-linux-virtual-machine-as-an-image"></a>Запись классической виртуальной машины Linux в виде образа
[!INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-classic-include.md)]

Узнайте, как [выполнить эти действия с помощью модели Resource Manager](virtual-machines-linux-capture-image.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

В этой статье показано, как записать виртуальную машину Azure под управлением Linux, чтобы использовать ее в качестве образа при создании других виртуальных машин. Данный образ виртуальной машины включает в себя диск операционной системы и прочие диски данных, присоединенные к виртуальной машине. Он не включает в себя сетевую конфигурацию, поэтому ее необходимо настроить при создании других виртуальных машин из образа.

Azure хранит образ в папке **Images** (Образы) вместе со всеми передаваемыми пользователем образами. Дополнительную информацию об образах см. в статье [Об образах виртуальных машин Linux][Об образах виртуальных машин Linux].

## <a name="before-you-begin"></a>Перед началом работы
В шагах этой статьи предполагается, что вы уже создали виртуальную машину Azure с использованием классической модели развертывания и настроили операционную систему, а также присоединили диски данных. Если необходимо создать виртуальную машину, то прочтите статью [Создание виртуальной машины Linux][Создание виртуальной машины Linux].

## <a name="capture-the-virtual-machine"></a>Запись виртуальной машины
1. [Подключитесь к виртуальной машине](virtual-machines-linux-mac-create-ssh-keys.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) с помощью выбранного клиента SSH.
2. В окне SSH введите следующую команду. Выходные данные `waagent` могут незначительно отличаться в зависимости от версии этой служебной программы.
   
    `sudo waagent -deprovision+user`
   
    Эта команда пытается очистить систему и сделать ее пригодной для повторной подготовки. В ходе операции выполняются такие задачи:
   
   * удаляются ключи узла SSH (если в файле конфигурации для Provisioning.RegenerateSshHostKeyPair указано значение «y»);
   * очищается конфигурация имени сервера в /etc/resolv.conf;
   * удаляется пароль пользователя `root` из /etc/shadow (если в файле конфигурации для Provisioning.DeleteRootPassword указано значение "y");
   * удаляются кэшированные аренды DHCP-клиентов.
   * возвращается имя узла localhost.localdomain;
   * удаляется последняя подготовленная учетная запись пользователя (полученная из /var/lib/waagent) и **связанные с ней данные**.
     
     > [!NOTE]
     > Процедура отзыва приводит к удалению файлов и данных, так как образ подготавливается к использованию. Эту команду следует выполнять только на виртуальных машинах, которые требуется записать как шаблон нового образа. Отзыв не гарантирует, что из образа будет удалена вся конфиденциальная информация и что он будет готов к повторному распространению третьим сторонам.
     > 
     > 
3. Чтобы продолжить, введите **y** . Чтобы предотвратить появление запроса на подтверждение, добавьте параметр `-force` .
4. Введите **Exit** , чтобы закрыть SSH-клиент.
   
   > [!NOTE]
   > Далее предполагается, что вы уже [установили интерфейс командной строки Azure CLI](../xplat-cli-install.md) (Azure CLI) на клиентском компьютере. Все следующие действия можно также выполнить на [классическом портале Azure][Классический портал Azure].
   > 
   > 
5. На клиентском компьютере откройте интерфейс командной строки Azure и войдите в подписку Azure. Дополнительные сведения см. в статье [Войдите в Azure из командной строки Azure](../xplat-cli-connect.md).
6. Убедитесь, что вы находитесь в режиме управления службами:
   
    `azure config mode asm`
7. Завершите работу виртуальной машины, которая была отозвана на предыдущих шагах, с помощью следующей команды.
   
    `azure vm shutdown <your-virtual-machine-name>`
   
   > [!NOTE]
   > Вы можете получить список всех виртуальных машин, созданных в подписке, с помощью команды `azure vm list`.
   > 
   > 
8. Когда виртуальная машина остановлена, запишите образ с помощью команды:
   
    `azure vm capture -t <your-virtual-machine-name> <new-image-name>`
   
    Введите имя образа вместо *new-image-name*. Эта команда создает обобщенный образ операционной системы. Подкоманда `-t` удаляет исходную виртуальную машину.
9. Новый образ станет доступным в списке образов, которые можно использовать для настройки новых виртуальных машин. Его можно просмотреть с помощью следующей команды:
   
   `azure vm image list`
   
   На [классическом портале Azure][Классический портал Azure] он отображается в списке **ОБРАЗЫ**.
   
   ![Успешная запись образа](./media/virtual-machines-linux-classic-capture-image/VMCapturedImageAvailable.png)

## <a name="next-steps"></a>Дальнейшие действия
Образ готов к использованию для создания виртуальных машин. Вы можете использовать команду Azure CLI `azure vm create` и указать имя образа, который создали. Дополнительные сведения об этой команде см. в статье [Команды Azure CLI в режиме управления службами Azure (ASM)](../virtual-machines-command-line-tools.md). Кроме того, с помощью [классического портала Azure][Классический портал Azure] можно создать настраиваемую виртуальную машину, выбрав метод **Из коллекции** и указав образ, который вы создали. Подробнее см. в разделе [Создание настраиваемой виртуальной машины Linux][Создание настраиваемой виртуальной машины Linux].

**См. также:** [Руководство пользователя агента Linux для Azure](virtual-machines-linux-agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

[Классический портал Azure]: http://manage.windowsazure.com
[Об образах виртуальных машин Linux]: virtual-machines-linux-classic-about-images.md
[Создание настраиваемой виртуальной машины Linux]: virtual-machines-linux-classic-create-custom.md
[Подключение диска с данными к виртуальной машине]: virtual-machines-windows-classic-attach-disk.md
[Создание виртуальной машины Linux]: virtual-machines-linux-classic-create-custom.md



<!--HONumber=Nov16_HO3-->


