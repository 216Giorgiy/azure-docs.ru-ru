<properties 
	pageTitle="Подключение к виртуальной машине SQL Server (классическое развертывание) | Microsoft Azure"
	description="В этом разделе используются ресурсы, созданные на основе классической модели развертывания, и описывается подключение к серверу SQL Server на виртуальной машине в Azure. Сценарии различаются в зависимости от конфигурации сети и расположения клиента."
	services="virtual-machines"
	documentationCenter="na"
	authors="rothja"
	manager="jeffreyg"
	editor="monicar"    
	tags="azure-service-management"/>
<tags 
	ms.service="virtual-machines"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="vm-windows-sql-server"
	ms.workload="infrastructure-services"
	ms.date="12/18/2015"
	ms.author="jroth" />

# Подключение к виртуальной машине SQL Server в Azure (классическое развертывание)

> [AZURE.SELECTOR]
- [Resource Manager](virtual-machines-sql-server-connectivity-resource-manager.md)
- [Classic](virtual-machines-sql-server-connectivity.md)

## Обзор

Процедура настройки подключения к системе SQL Server, выполняющейся на виртуальной машине Azure, не сильно отличается от действий, которые нужно выполнить с локальным экземпляром SQL Server. Вам снова потребуется настроить брандмауэр, проверку подлинности и вход в базу данных.

Однако виртуальные машины Azure отличаются некоторые характерными особенностями подключения к SQL Server. В этой статье сначала рассматриваются некоторые [общие сценарии подключения](#connection-scenarios), а затем предоставляются [подробные инструкции по настройке подключения к SQL Server на виртуальной машине Azure](#steps-for-configuring-sql-server-connectivity-in-an-azure-vm).

Эта статья посвящена подключению. Полное пошаговое руководство по подготовке и подключению см. в статье [Подготовка виртуальной машины SQL Server в Azure](virtual-machines-provision-sql-server.md).

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-classic-include.md)]Модель диспетчера ресурсов.

## Сценарии подключения

Способ подключения клиента к системе SQL Server, выполняемой на виртуальной машине, зависит от расположения клиента, а также конфигурации компьютера и сети. Ниже приведены соответствующие сценарии.

- [Подключение к SQL Server в пределах одной облачной службы](#connect-to-sql-server-in-the-same-cloud-service)
- [Подключение к SQL Server через Интернет](#connect-to-sql-server-over-the-internet)
- [Подключение к SQL Server в пределах одной виртуальной сети](#connect-to-sql-server-in-the-same-virtual-network)

### Подключение к SQL Server в пределах одной облачной службы

В одной облачной службе можно создать несколько виртуальных машин. Этот сценарий использования виртуальных машин описан в статье [Как подключить виртуальные машины с помощью виртуальной сети или облачной службы](cloud-services-connect-virtual-machine.md).

Сначала необходимо выполнить [приведенные в этой статье действия по настройке подключения](#steps-for-configuring-sql-server-connectivity-in-an-azure-vm). Обратите внимание, что при установке подключения между компьютерами в одной облачной службе общедоступную конечную точку настраивать не нужно.

В строке подключения клиента можно использовать **имя узла** виртуальной машины. Имя узла — это имя, которое вы присвоили виртуальной машине во время создания. Например, если вы присвоили виртуальной машине SQL имя **mysqlvm** с DNS-именем облачной службы **mycloudservice.cloudapp.net**, клиентская виртуальная машина в этой же облачной службе может использовать для соединения следующую строку подключения.

	"Server=mysqlvm;Integrated Security=false;User ID=<login_name>;Password=<your_password>"

### Подключение к SQL Server через Интернет

Если вы хотите подключиться к ядру СУБД SQL Server из Интернета, необходимо создать конечную точку виртуальной машины для входящих подключений TCP. На данном этапе настройки Azure направляет входящий трафик TCP-порта на TCP-порт, доступный для виртуальной машины.

Сначала необходимо выполнить [приведенные в этой статье действия по настройке подключения](#steps-for-configuring-sql-server-connectivity-in-an-azure-vm). Любой клиент с доступом в Интернет затем сможет подключиться к экземпляру SQL Server, указав DNS-имя облачной службы (например, **mycloudservice.cloudapp.net**) и конечную точку виртуальной машины (такую как **57500**).

	"Server=mycloudservice.cloudapp.net,57500;Integrated Security=false;User ID=<login_name>;Password=<your_password>"

Хотя таким образом можно обеспечить подключение клиентов через Интернет, это не значит, что любой пользователь сможет подключиться к вашей системе SQL Server. Внешние клиенты должны иметь правильные имя пользователя и пароль. Чтобы повысить уровень безопасности, не используйте известный порт 1433 для общедоступной конечной точки виртуальной машины. Если возможно, рассмотрите вариант добавления списка ACL в конечной точке, чтобы сделать трафик доступным только для определенных клиентов. Инструкции по использованию списков ACL в конечных точках см. в разделе [Управление ACL для конечной точки](virtual-machines-set-up-endpoints.md#manage-the-acl-on-an-endpoint)

>[AZURE.NOTE] Важно отметить, что при использовании этого метода для соединения с SQL Server все возвращаемые данные считаются трафиком, исходящим из центра обработки данных. Может взиматься обычная [плата за передачу исходящих данных](https://azure.microsoft.com/pricing/details/data-transfers/). Это справедливо, даже если вы передаете данные с другого компьютера или облачной службы в одном центре обработки данных Azure, так как трафик по-прежнему проходит через общедоступный балансировщик нагрузки в Azure.

### Подключение к SQL Server в пределах одной виртуальной сети

[Виртуальная сеть](..\virtual-network\virtual-networks-overview.md) поддерживает дополнительные сценарии. Вы можете подключить виртуальные машины в одной виртуальной сети, даже если они расположены в разных облачных службах. Если используется [VPN типа «сеть-сеть»](../vpn-gateway/vpn-gateway-site-to-site-create.md), можно создать гибридную архитектуру, обеспечивающую подключение виртуальных машин к локальным сетям и компьютерам.

Виртуальные сети также позволяют присоединить ваши виртуальные машины Azure к домену. Это единственный способ использовать проверку подлинности Windows в SQL Server. Другие сценарии подключения требуют проверки подлинности SQL с использованием имен пользователей и паролей.

Сначала необходимо выполнить [приведенные в этой статье действия по настройке подключения](#steps-for-configuring-sql-server-connectivity-in-an-azure-vm). Если вы собираетесь настроить доменную среду и проверку подлинности Windows, не нужно выполнять описанные в этой статье действия по настройке проверки подлинности SQL и входа в систему. Кроме того, в этом сценарии не требуется общедоступная конечная точка.

Предположим, вы настроили DNS. В таком случае вы можете подключиться к экземпляру SQL Server, указав имя узла виртуальной машины SQL Server в строке подключения. В следующем примере предполагается, что также настроена проверка подлинности Windows, а пользователю предоставили доступ к экземпляру SQL Server.

	"Server=mysqlvm;Integrated Security=true" 

Обратите внимание, что в этом сценарии также можно указать IP-адрес виртуальной машины.

## Действия по настройке подключения к SQL Server на виртуальной машине Azure

Ниже показано, как подключиться к экземпляру SQL Server через Интернет с помощью SQL Server Management Studio (SSMS). Однако, чтобы сделать виртуальную машину SQL Server доступной для приложений, выполняющихся как локально, так и в среде Azure, необходимо выполнить те же действия.

Чтобы подключиться к экземпляру SQL Server из другой виртуальной машины или через Интернет, необходимо выполнить задачи, описанные в следующих разделах:

- [Создание конечной точки TCP для виртуальной машины](#create-a-tcp-endpoint-for-the-virtual-machine)
- [Открытие портов TCP в брандмауэре Windows](#open-tcp-ports-in-the-windows-firewall-for-the-default-instance-of-the-database-engine)
- [Настройка SQL Server для прослушивания через протокол TCP](#configure-sql-server-to-listen-on-the-tcp-protocol)
- [Настройка SQL Server для аутентификации в смешанном режиме](#configure-sql-server-for-mixed-mode-authentication)
- [Создание имен входа для аутентификации SQL Server](#create-sql-server-authentication-logins)
- [Определение DNS-имени виртуальной машины](#determine-the-dns-name-of-the-virtual-machine)
- [Подключение к ядру СУБД с другого компьютера](#connect-to-the-database-engine-from-another-computer)

Процедура подключения показана на следующей схеме:

![Подключение к виртуальной машине SQL Server](../../includes/media/virtual-machines-sql-server-connection-steps/SQLServerinVMConnectionMap.png)

[AZURE.INCLUDE [Подключение к SQL Server на виртуальной машине (классическое развертывание с конечной точкой TCP)](../../includes/virtual-machines-sql-server-connection-steps-classic-tcp-endpoint.md)]

[AZURE.INCLUDE [Подключение к SQL Server на виртуальной машине](../../includes/virtual-machines-sql-server-connection-steps.md)]

[AZURE.INCLUDE [Подключение к SQL Server на виртуальной машине (классическое развертывание)](../../includes/virtual-machines-sql-server-connection-steps-classic.md)]

## Дальнейшие действия

Инструкции по подготовке и действия по подключению приведены в статье [Подготовка виртуальной машины SQL Server в Azure](virtual-machines-provision-sql-server.md).

Если вы также планируете использовать группы доступности AlwaysOn для обеспечения высокого уровня доступности и аварийного восстановления, следует реализовать прослушиватель. Клиенты баз данных подключаются к прослушивателю, а не непосредственно к одному из экземпляров SQL Server. Прослушиватель направляет клиентов к первичной реплике в группе доступности. Дополнительные сведения см. в статье [Настройка прослушивателя внутренней подсистемы балансировки нагрузки для группы доступности AlwaysOn в Azure](virtual-machines-sql-server-configure-ilb-alwayson-availability-group-listener.md).

Важно просмотреть все рекомендации по обеспечению безопасности для системы SQL Server, выполняемой на виртуальной машине Azure. Дополнительные сведения см. в статье [Вопросы безопасности SQL Server на виртуальных машинах Azure](virtual-machines-sql-server-security-considerations.md).

Другие темы, связанные с запуском SQL Server на виртуальных машинах Azure, рассматриваются в статье [SQL Server на виртуальных машинах Azure](virtual-machines-sql-server-infrastructure-services.md).

<!---HONumber=AcomDC_0128_2016-->