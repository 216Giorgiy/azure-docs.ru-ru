<properties
 pageTitle="Создание головного узла пакета HPC в виртуальной машине Azure | Microsoft Azure"
 description="Узнайте, как использовать портал Azure и модель развертывания диспетчера ресурсов для создания головного узла пакета Microsoft HPC на виртуальной машине Azure."
 services="virtual-machines-windows"
 documentationCenter=""
 authors="dlepow"
 manager="timlt"
 editor=""
 tags="azure-resource-manager,hpc-pack"/>
<tags
ms.service="virtual-machines-windows"
 ms.devlang="na"
 ms.topic="article"
 ms.tgt_pltfrm="vm-windows"
 ms.workload="big-compute"
 ms.date="02/04/2016"
 ms.author="danlep"/>

# Создание головного узла кластера пакета HPC на виртуальной машине Azure с помощью образа Marketplace

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-rm-include.md)]Классическая модель развертывания.


В этой статье показано, как использовать [образ виртуальной машины пакета Microsoft HPC](https://azure.microsoft.com/marketplace/partners/microsoft/hpcpack2012r2onwindowsserver2012r2/) из Azure Marketplace для создания головного узла кластера HPC Windows с помощью портала Azure. Этот образ виртуальной машины пакета HPC основан на ОС Windows Server 2012 R2 Datacenter с предустановленным пакетом HPC 2012 R2 с обновлением 3. Используйте этот головной узел для экспериментального развертывания пакета HPC в Azure. Затем можно добавить к кластеру вычислительные ресурсы для запуска рабочих нагрузок HPC.


![Головной узел пакета HPC][headnode]

>[AZURE.TIP]Для развертывания полного пакета кластера HPC в Azure мы рекомендуем использовать автоматизированный метод, такой как [сценарий развертывания IaaS пакета HPC](virtual-machines-windows-classic-hpcpack-cluster-powershell-script.md), или шаблон Resource Manager, например шаблон [пакета кластера HPC для рабочих нагрузок Windows](https://azure.microsoft.com/marketplace/partners/microsofthpc/newclusterwindowscn/). В разделе [параметров кластера пакета HPC в Azure](virtual-machines-windows-hpcpack-cluster-options.md) можно найти дополнительные шаблоны.


## Рекомендации относительно планирования

* **Домен Active Directory** — перед запуском служб HPC головной узел пакета HPC должен быть присоединен к домену Active Directory в Azure на виртуальной машине. Как показано в этой статье, для экспериментального развертывания перед запуском служб HPC можно повысить уровень виртуальной машины, создаваемой для головного узла, до контроллера домена. Другой вариант — развертывание отдельного контроллера домена и леса в Azure, к которому можно присоединить виртуальную машину.

* **Виртуальная сеть Azure** — как показано в этой статье, при развертывании головного узла пакета HPC с помощью модели развертывания диспетчера ресурсов на портале Azure вы указываете или создаете виртуальную сеть Azure. Эта виртуальная сеть понадобится позже для добавления виртуальных машин вычислительного узла кластера в кластер HPC или для присоединения головного узла к существующему домену Active Directory.

    
## Шаги по созданию головного узла

Это высокоуровневые действия для создания виртуальной машины Azure для головного узла пакета HPC с помощью модели развертывания диспетчера ресурсов на портале Azure.


1. Если вы хотите создать новый лес Active Directory в Azure с отдельными виртуальными машинами контроллера домена, одним из вариантов является использование [шаблона диспетчера ресурсов](https://azure.microsoft.com/documentation/templates/active-directory-new-domain-ha-2-dc/). Для простого экспериментального развертывания это можно опустить и настроить саму виртуальную машину головного узла в качестве контроллера домена, как описано на следующем шаге.
    
2. В [портале Azure](https://portal.azure.com) выберите образ пакета HPC 2012 R2 в Azure Marketplace. Чтобы сделать это, нажмите кнопку **Создать** и выполните поиск **пакета HPC** в Marketplace. Выберите **Пакет HPC 2012 R2 в Windows Server 2012 R2**.

3. На странице **Пакет HPC 2012 R2 в Windows Server 2012 R2** выберите модель развертывания **диспетчера ресурсов**, а затем нажмите кнопку **Создать**.

    ![Образ пакета HPC][marketplace]

4. Используйте портал для указания настроек и создания виртуальной машины. Подробное описание шагов см. в учебнике [Создание виртуальной машины Windows на портале Azure](virtual-machines-windows-hero-tutorial.md). Для первого развертывания большинство параметров можно оставить без изменения.

    **Рекомендации по виртуальной сети**

   * При создании новой виртуальной сети в разделе **Настройки** укажите диапазон адресов частной сети, например 10.0.0.0/16, и диапазон адресов подсети, например 10.0.0.0/24.
    
4. После создания и запуска виртуальной машины [подключитесь к ней](virtual-machines-windows-connect-logon.md). 

5. Присоедините ее к существующему доменному лесу или создайте новый доменный лес на самой виртуальной машине.

    **Рекомендации по домену Active Directory**

    * При создании виртуальной машины в виртуальной сети Azure с существующим доменным лесом используйте стандартный диспетчер серверов или средства Windows PowerShell для присоединения виртуальной машины к доменному лесу. Выполните перезапуск.

    * Если вы создавали виртуальную машину в виртуальной сети без существующего доменного леса, повысьте ее уровень до контроллера домена. Для этого используйте стандартный диспетчер серверов или средства Windows PowerShell для установки и настройки роли доменных служб Active Directory. Подробные инструкции см. в разделе [Установка нового леса Active Directory Windows Server 2012](https://technet.microsoft.com/library/jj574166.aspx).

5. Когда виртуальная машина выполняется и присоединена к лесу Active Directory, запустите на головном узле службы пакета HPC. Для этого:

    а. Подключитесь к виртуальной машине, используя учетную запись домена, которая является членом локальной группы администраторов. Например, можно использовать учетную запись администратора, настроенную при создании виртуальной машины головного узла.

    b. Для использования конфигурации головного узла по умолчанию запустите Windows PowerShell от имени администратора и введите следующую команду:

    ```
    & $env:CCP_HOME\bin\HPCHNPrepare.ps1 –DBServerInstance ".\ComputeCluster"
    ```

    Запуск служб пакета HPC может занять несколько минут.

    Для вывода сведений о дополнительных параметрах конфигурации головного узла введите `get-help HPCHNPrepare.ps1`.


## Дальнейшие действия

* Теперь вы можете работать с головным узлом кластера пакета HPC. Например, запустите диспетчер кластеров HPC и завершите [список дел развертывания](https://technet.microsoft.com/library/jj884141.aspx).
* Добавьте [узлы разбивки Azure](virtual-machines-windows-classic-hpcpack-cluster-node-burst.md) в облачную службу для увеличения вычислительной емкости кластера по запросу. 

* Попробуйте запустить тестовую рабочую нагрузку в кластере. См. пример в [руководстве по началу работы](https://technet.microsoft.com/library/jj884144) с пакетом HPC.

<!--Image references-->
[headnode]: ./media/virtual-machines-windows-hpcpack-cluster-headnode/headnode.png
[marketplace]: ./media/virtual-machines-windows-hpcpack-cluster-headnode/marketplace.png

<!---HONumber=AcomDC_0323_2016-->