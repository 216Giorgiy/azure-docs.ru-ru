<properties
 pageTitle="Создание головного узла пакета HPC в виртуальной машине Azure | Microsoft Azure"
 description="Узнайте, как использовать портал Azure и модель развертывания диспетчера ресурсов для создания головного узла пакета Microsoft HPC на виртуальной машине Azure."
 services="virtual-machines-windows"
 documentationCenter=""
 authors="dlepow"
 manager="timlt"
 editor=""
 tags="azure-resource-manager,hpc-pack"/>
<tags
ms.service="virtual-machines-windows"
 ms.devlang="na"
 ms.topic="article"
 ms.tgt_pltfrm="vm-windows"
 ms.workload="big-compute"
 ms.date="05/19/2016"
 ms.author="danlep"/>

# Создание головного узла кластера пакета HPC на виртуальной машине Azure с помощью образа Marketplace


Для создания головного узла кластера HPC Windows с помощью портала Azure используйте [образ виртуальной машины пакета Microsoft HPC](https://azure.microsoft.com/marketplace/partners/microsoft/hpcpack2012r2onwindowsserver2012r2/) из Azure Marketplace. Этот образ виртуальной машины пакета HPC основан на ОС Windows Server 2012 R2 Datacenter с предустановленным пакетом HPC 2012 R2 с обновлением 3. Используйте этот головной узел для экспериментального развертывания пакета HPC в Azure. Затем можно добавить к кластеру вычислительные узлы для запуска рабочих нагрузок HPC.



>[AZURE.TIP]Для развертывания полного пакета кластера HPC в среде Azure, включающей головной узел и вычислительные узлы, мы рекомендуем использовать автоматизированный метод, такой как [сценарий развертывания IaaS пакета HPC](virtual-machines-windows-classic-hpcpack-cluster-powershell-script.md), или шаблон Resource Manager, например шаблон [пакета кластера HPC для рабочих нагрузок Windows](https://azure.microsoft.com/marketplace/partners/microsofthpc/newclusterwindowscn/). В разделе [параметров кластера пакета HPC в Azure](virtual-machines-windows-hpcpack-cluster-options.md) можно найти дополнительные шаблоны.


## Рекомендации относительно планирования

Как показано на следующей схеме, головной узел должен быть развернут в домене Active Directory в виртуальной сети Azure.

![Головной узел пакета HPC][headnode]

* **Домен Active Directory** — перед запуском служб HPC головной узел пакета HPC должен быть присоединен к домену Active Directory в Azure на виртуальной машине. Как показано в этой статье, для экспериментального развертывания перед запуском служб HPC можно повысить уровень виртуальной машины, создаваемой для головного узла, до контроллера домена. Другой вариант — развертывание отдельного контроллера домена и леса в Azure, к которому можно присоединить виртуальную машину головного узла.

* **Виртуальная сеть Azure** — как показано в этой статье, при развертывании головного узла пакета HPC, используя модель развертывания с помощью Resource Manager на портале Azure, вы указываете или создаете виртуальную сеть Azure. Эта виртуальная сеть понадобится позже для добавления виртуальных машин вычислительного узла кластера в кластер HPC или для присоединения головного узла к существующему домену Active Directory.

    
## Шаги по созданию головного узла

Это высокоуровневые действия для создания виртуальной машины Azure для головного узла пакета HPC с помощью модели развертывания диспетчера ресурсов на портале Azure.


1. Если вы хотите создать новый лес Active Directory в Azure с отдельными виртуальными машинами контроллера домена, одним из вариантов является использование [шаблона Resource Manager](https://azure.microsoft.com/documentation/templates/active-directory-new-domain-ha-2-dc/). Если пакет HPC развертывается исключительно в экспериментальных целях, это действие можно не выполнять. Вместо этого нужно настроить виртуальную машину головного узла как контроллер домена, как описано ниже в этой статье.
    
2. Для создания головного узла пакета HPC на [портале Azure](https://portal.azure.com) выберите образ пакета HPC 2012 R2 в Azure Marketplace. Чтобы сделать это, нажмите кнопку **Создать** и выполните поиск **пакета HPC** в Marketplace. Выберите образ **Пакет HPC 2012 R2 в Windows Server 2012 R2**.

3. На странице **Пакет HPC 2012 R2 в Windows Server 2012 R2** выберите модель развертывания **диспетчера ресурсов**, а затем нажмите кнопку **Создать**.

    ![Образ пакета HPC][marketplace]

4. Используйте портал для указания настроек и создания виртуальной машины. Если вы новичок в Azure, см. подробные инструкции в учебнике [Создание виртуальной машины Windows на портале Azure](virtual-machines-windows-hero-tutorial.md). Для экспериментального развертывания большинство параметров можно оставить без изменения.

    **Аспекты виртуальных сетей**

   * Если вы хотите присоединить головной узел к существующему домену Active Directory в Azure, при создании виртуальной машины головного узла укажите виртуальную сеть для этого домена.
   
   * Если вы хотите создать виртуальную сеть, в разделе **Настройки** укажите диапазон адресов частной сети, например 10.0.0.0/16, и диапазон адресов подсети, например 10.0.0.0/24.
    
4. После создания и запуска виртуальной машины [подключитесь к ней](virtual-machines-windows-connect-logon.md) через удаленный рабочий стол. 

5. Присоедините ее к существующему доменному лесу или создайте новый доменный лес на самой виртуальной машине.

    * При создании виртуальной машины в виртуальной сети Azure с существующим доменным лесом используйте стандартный диспетчер серверов или средства Windows PowerShell для присоединения виртуальной машины к доменному лесу. Выполните перезапуск.

    * Если вы создавали виртуальную машину в новой виртуальной сети без существующего доменного леса, повысьте ее уровень до контроллера домена. Для этого используйте стандартный диспетчер серверов или средства Windows PowerShell для установки и настройки роли доменных служб Active Directory. Подробные инструкции см. в разделе [Установка нового леса Active Directory Windows Server 2012](https://technet.microsoft.com/library/jj574166.aspx).

5. Когда виртуальная машина выполняется и присоединена к лесу Active Directory, запустите на головном узле службы пакета HPC. Для этого:

    а. Подключитесь к виртуальной машине, используя учетную запись домена, которая является членом локальной группы администраторов. Например, можно использовать учетную запись администратора, настроенную при создании виртуальной машины головного узла.

    b. Для использования конфигурации головного узла по умолчанию запустите Windows PowerShell от имени администратора и введите следующую команду:

    ```
    & $env:CCP_HOME\bin\HPCHNPrepare.ps1 –DBServerInstance ".\ComputeCluster"
    ```

    Запуск служб пакета HPC может занять несколько минут.

    Для вывода сведений о дополнительных параметрах конфигурации головного узла введите `get-help HPCHNPrepare.ps1`.


## Дальнейшие действия

* Теперь вы можете работать с головным узлом кластера пакета HPC. Например, запустите диспетчер кластеров HPC и завершите [список дел развертывания](https://technet.microsoft.com/library/jj884141.aspx).
* Добавьте [узлы разбивки Azure](virtual-machines-windows-classic-hpcpack-cluster-node-burst.md) в облачную службу для увеличения вычислительной емкости кластера по запросу. 

* Попробуйте запустить тестовую рабочую нагрузку в кластере. См. пример в [руководстве по началу работы](https://technet.microsoft.com/library/jj884144) с пакетом HPC.

<!--Image references-->
[headnode]: ./media/virtual-machines-windows-hpcpack-cluster-headnode/headnode.png
[marketplace]: ./media/virtual-machines-windows-hpcpack-cluster-headnode/marketplace.png

<!---HONumber=AcomDC_0525_2016-->