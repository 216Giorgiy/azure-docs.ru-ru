<properties
   pageTitle="Тестирование SAP NetWeaver на виртуальных машинах SUSE Linux Microsoft Azure | Microsoft Azure"
   description="Тестирование SAP NetWeaver на виртуальных машинах SUSE Linux Microsoft Azure"
   services="virtual-machines,virtual-network,storage"
   documentationCenter="saponazure"
   authors="hermanndms"
   manager="juergent"
   editor=""
   tags="azure-resource-manager"
   keywords=""/>
<tags
   ms.service="virtual-machines"
   ms.devlang="NA"
   ms.topic="campaign-page"
   ms.tgt_pltfrm="vm-linux"
   ms.workload="na"
   ms.date="11/26/2015"
   ms.author="hermannd"/>

# Тестирование SAP NetWeaver на виртуальных машинах SUSE Linux Microsoft Azure


Ниже приведен список элементов, которые следует учитывать при тестировании SAP NetWeaver на виртуальных машинах SUSE Linux Microsoft Azure. На данный момент официальное заявление SAP о поддержке комбинации SAP-Linux-Azure отсутствует. Тем не менее клиенты могут осуществлять определенное тестирование, проводить демонстрации и создавать прототипы, если они не нуждаются в официальной поддержке SAP.

Следующий список поможет избежать некоторых подводных камней и упростить работу:



## Образы SUSE в Microsoft Azure для тестирования SAP 

Для тестирования SAP в Azure следует использовать только SLES 11SP4 и SLES 12. В коллекции образов Azure можно найти специальный образ SUSE: "SLES 11 SP3 для SAP CAL", но он не предназначен для общего использования. Он зарезервирован для решения SAP Cloud Appliance Library — SAP "CAL" ( <https://cal.sap.com/> ). Не было никакого смысла скрывать этот образ от общественности. Поэтому просто не пользуйтесь им.

Все новые тесты в Azure должны выполняться с помощью Диспетчера ресурсов Azure. Для поиска образов и версий SUSE SLES с помощью Azure Powershell или интерфейса командной строки используйте следующие команды. Выходные данные затем можно использовать, например, для определения образа ОС в шаблоне JSON для развертывания новой виртуальной машины SUSE Linux:

* поиск существующих издателей, включающих SUSE:

   ```
   PS  : Get-AzureVMImagePublisher -Location "West Europe"  | where-object { $_.publishername -like "*US*"  }
   CLI : azure vm image list-publishers westeurope | grep "US"
   ```

* поиск существующих предложений от SUSE:
      
   ```
   PS  : Get-AzureVMImageOffer -Location "West Europe" -Publisher "SUSE"
   CLI : azure vm image list-offers westeurope SUSE
   ```
      
* поиск предложений SUSE SLES:
      
   ```
   PS  : Get-AzureVMImageSku -Location "West Europe" -Publisher "SUSE" -Offer "SLES"
   CLI : azure vm image list-skus westeurope SUSE SLES
   ```
      
* поиск определенной версии SLES SKU:
      
   ```
   PS  : Get-AzureVMImage -Location "West Europe" -Publisher "SUSE" -Offer "SLES" -skus "12"
   CLI : azure vm image list westeurope SUSE SLES 12
   ```
     
## Установка WALinuxAgent в виртуальной машине SUSE 
 
Этот агент является частью образов SLES в коллекции Azure. Ниже приведены адреса, где можно найти сведения об установке его вручную (например при отправке виртуального жесткого диска с ОС SLES из локальной среды):

<http://software.opensuse.org/package/WALinuxAgent>

<https://azure.microsoft.com/documentation/articles/virtual-machines-linux-endorsed-distributions/>

<https://www.suse.com/communities/blog/suse-linux-enterprise-server-configuration-for-windows-azure/>

## Подключение дисков данных Azure к виртуальной машине Linux Azure

НИКОГДА не подключайте диски данных Azure к виртуальной машине Linux Azure через идентификатор устройства. Используйте вместо него UUID. Будьте внимательны, например, при использовании графических средств для подключения дисков данных Azure. Дважды проверьте записи в /etc/fstab. Проблема с идентификатором устройства заключается в том, что он может измениться, после чего виртуальная машина Azure может зависнуть в процессе загрузки. Для устранения этой проблемы можно добавить в /etc/fstab параметр nofail. Однако при использовании параметра nofail следует соблюдать осторожность, так как приложения могут использовать прежнюю точку подключения и записать ее в корень файловой системы, если во время загрузки не был подключен внешний диск данных Azure.

## Отправка виртуальной машины SUSE из локальной среды в Azure

Соответствующие шаги описаны в следующем блоге: <https://azure.microsoft.com/documentation/articles/virtual-machines-linux-create-upload-vhd-suse/>

Если требуется отправить виртуальную машину без отзыва в конце, например для сохранения существующей установки SAP, а также имени узла, следует проверить следующие элементы:

* Убедитесь, что диск ОС подключен через UUID, а НЕ через идентификатор устройства. Для диска ОС НЕДОСТАТОЧНО изменить UUID только в /etc/fstab. Также не забудьте адаптировать загрузчик, например с помощью YaST или посредством изменения /boot/grub/menu.lst
* Если вы использовали формат VHDX для диска операционной системы SUSE и преобразовали его в виртуальный жесткий диск для передачи в Azure, весьма вероятно, что сетевое устройство изменилось с eth0 на eth1. Чтобы избежать дальнейших проблем при загрузке в Azure, следует вернуть значение eth0, как описано здесь: <https://dartron.wordpress.com/2013/09/27/fixing-eth1-in-cloned-sles-11-vmware/>

Помимо выполнения описанных в этой статье действий рекомендуется также удалить

   /lib/udev/rules.d/75-persistent-net-generator.rules.

Установка waagent должна выполняться без каких-либо проблем, если только не используется несколько сетевых карт.

## Ключ оборудования и лицензия SAP

Для официальной сертификации SAP-Windows-Azure был представлен новый механизм для вычисления ключа оборудования SAP, который используется для лицензии SAP. Ядро SAP было адаптировано для использования данного ключа. В текущем ядре SAP для Linux такое изменение кода ОТСУТСТВУЕТ. Поэтому в определенных ситуациях (например, при изменении размера виртуальной машины Azure) ключ оборудования SAP изменяется, что делает лицензию SAP недействительной.

## Общая папка NFS в распределенных установках SAP

В случае распределенной установки, когда требуется, например, установить сервер базы данных и сервер приложений SAP в отдельных виртуальных машинах, вы можете обеспечить общий доступ к каталогу /sapmnt через NFS. Если после создания общей папки NFS в процессе установки возникают неполадки, убедитесь, что для этой общей папки установлен "no\_root\_squash". Такое решение использовалось во внутреннем тестовом случае.


## Логические тома

Функция LVM не полностью проверена в Azure. Если требуется большой логический том на нескольких дисках данных Azure (например, для базы данных SAP), следует использовать mdadm. Ниже приведен блог, где хорошо описан процесс настройки RAID Linux в Azure с помощью mdadm.

<https://azure.microsoft.com/documentation/articles/virtual-machines-linux-configure-raid/>


## Репозиторий SUSE Azure

В случае проблем с доступом к стандартному репозиторию SUSE Azure можно воспользоваться простой командой для сброса этого состояния. Это может произойти при создании частного образа ОС в одном регионе Azure с последующим копированием образа в другой регион, где требуется развернуть новые виртуальные машины на основе этого частного образа ОС. Просто выполните следующую команду в виртуальной машине:

   ```
   service guestregister restart
   ```

## Gnome Desktop

Если вам хочется использовать Gnome Desktop для установки полноценной демонстрационной системы SAP внутри одной виртуальной машины, включая графический интерфейс SAP, браузер, консоль управления SAP и т. п., здесь приведена небольшая подсказка по его установке в образах SLES Azure:

   SLES 11

   ```
   zypper in -t pattern gnome
   ```
      
   SLES 12
   
   ```
   zypper in -t pattern gnome-basic
   ```

## Поддержка SAP-Oracle на платформе Linux в облаке
 
Эта общая тема, которая касается не только Azure. Однако важно разобраться в ней. Существует ограничение поддержки, накладываемое Oracle на Linux в виртуализованных средах. Это означает, что SAP не поддерживает Oracle на SUSE или RedHat в общедоступном облаке, таком как Azure. Клиенты должны обратиться непосредственно в Oracle для обсуждения этого вопроса.

<!---HONumber=AcomDC_1203_2015-->