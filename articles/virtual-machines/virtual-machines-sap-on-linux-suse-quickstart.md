<properties
   pageTitle="Тестирование SAP NetWeaver на виртуальных машинах SUSE Linux Microsoft Azure | Microsoft Azure"
   description="Тестирование SAP NetWeaver на виртуальных машинах SUSE Linux Microsoft Azure"
   services="virtual-machines,virtual-network,storage"
   documentationCenter="saponazure"
   authors="hermanndms"
   manager="juergent"
   editor=""
   tags="azure-resource-manager"
   keywords=""/>
<tags
   ms.service="virtual-machines"
   ms.devlang="NA"
   ms.topic="campaign-page"
   ms.tgt_pltfrm="vm-linux"
   ms.workload="na"
   ms.date="02/12/2016"
   ms.author="hermannd"/>

# Тестирование SAP NetWeaver на виртуальных машинах SUSE Linux Microsoft Azure


Ниже приведен список элементов, которые следует учитывать при тестировании SAP NetWeaver на виртуальных машинах SUSE Linux Microsoft Azure. На данный момент официальное заявление SAP о поддержке комбинации SAP-Linux-Azure отсутствует. Тем не менее клиенты могут осуществлять определенное тестирование, проводить демонстрации и создавать прототипы, если они не нуждаются в официальной поддержке SAP.

Следующие сведения помогут избежать некоторых подводных камней.



## Образы SUSE в Microsoft Azure для тестирования SAP

Для тестирования SAP в Azure следует использовать только SUSE Linux Enterprise Server (SLES) 11 SP4 и SLES 12. В Azure Marketplace можно найти специальный образ SUSE ("SLES 11 SP3 для SAP CAL"), но он не предназначен для общего использования. Он зарезервирован для решения [SAP Cloud Appliance Library](https://cal.sap.com/). Не было никакого смысла скрывать этот образ от общественности. Поэтому просто не пользуйтесь им.

Все новые тесты в Azure должны выполняться с помощью Диспетчера ресурсов Azure. Для поиска образов и версий SUSE SLES с помощью Azure Powershell или интерфейса командной строки используйте следующие команды. Впоследствии выходные данные можно будет использовать, например, для определения образа ОС в шаблоне JSON для развертывания новой виртуальной машины SUSE Linux. Для Azure Powershell версии 1.0.1 и выше действительны следующие команды PowerShell.

* Поиск существующих издателей, включая SUSE:

   ```
   PS  : Get-AzureRmVMImagePublisher -Location "West Europe"  | where-object { $_.publishername -like "*US*"  }
   CLI : azure vm image list-publishers westeurope | grep "US"
   ```

* Поиск существующих предложений от SUSE:

   ```
   PS  : Get-AzureRmVMImageOffer -Location "West Europe" -Publisher "SUSE"
   CLI : azure vm image list-offers westeurope SUSE
   ```

* Поиск предложений SLES от SUSE:

   ```
   PS  : Get-AzureRmVMImageSku -Location "West Europe" -Publisher "SUSE" -Offer "SLES"
   CLI : azure vm image list-skus westeurope SUSE SLES
   ```

* Поиск определенной версии SKU для SLES:

   ```
   PS  : Get-AzureRmVMImage -Location "West Europe" -Publisher "SUSE" -Offer "SLES" -skus "12"
   CLI : azure vm image list westeurope SUSE SLES 12
   ```

## Установка WALinuxAgent в виртуальной машине SUSE

Агент WALinuxAgent является частью образов SLES в Azure Marketplace. Ниже приведены адреса, где можно найти сведения об установке его вручную (например при отправке виртуального жесткого диска с ОС SLES из локальной среды):

- [OpenSUSE](http://software.opensuse.org/package/WALinuxAgent)

- [Таблицы Azure](virtual-machines-linux-endorsed-distributions.md)

- [SUSE](https://www.suse.com/communities/blog/suse-linux-enterprise-server-configuration-for-windows-azure/)

## Подключение дисков данных Azure к виртуальной машине Linux Azure

Никогда не подключайте диски данных Azure к виртуальной машине Linux Azure через идентификатор устройства. Используйте вместо него UUID. Будьте внимательны, например, при использовании графических средств для подключения дисков данных Azure. Дважды проверьте записи в /etc/fstab.

Проблема с идентификатором устройства заключается в том, что он может измениться, после чего виртуальная машина Azure может зависнуть в процессе загрузки. Для устранения этой проблемы можно добавить в /etc/fstab параметр nofail. Однако при использовании параметра nofail следует соблюдать осторожность, так как приложения могут использовать прежнюю точку подключения и записать ее в корень файловой системы, если во время загрузки не был подключен внешний диск данных Azure.

Единственное исключение относительно подключения через UUID касается присоединения диска операционной системы для устранения неполадок, как описано в следующем разделе.

## Устранение неполадок с виртуальной машиной SUSE, которая стала недоступной

Бывают ситуации, когда виртуальная машина SUSE в Azure зависает в процессе загрузки (например, при ошибке, связанной с подключением дисков). Это можно проверить, например, используя функцию диагностики загрузки на портале для виртуальных машин v2 (см. [этот блог](https://azure.microsoft.com/blog/boot-diagnostics-for-virtual-machines-v2/)).

Одним из вариантом решения проблемы является присоединение диска операционной системы поврежденной виртуальной машины к другой виртуальной машине SUSE в Azure с последующим внесением соответствующих изменений. Внесение изменений может включать редактирование пути /etc/fstab или удаление сетевых правил udev, как описано в следующем разделе.

Но здесь есть один важный момент. Развертывание нескольких виртуальных машин SUSE из одного образа из коллекции Azure (например, SLES 11 с пакетом обновлений (SP4)) сопровождается тем, что диск ОС всегда подключается с использованием одного идентификатора UUID. Следовательно, при подключении диска ОС из другой виртуальной машины (с помощью UUID), которая развернута из того же образа из коллекции Azure, у вас будет два одинаковых UUID. Это вызывает проблемы, а также приводит к тому, что виртуальная машина при устранении неполадок будет загружаться не с исходного диска ОС, а с присоединенного и поврежденного.

Этого можно избежать двумя способами:

* используйте другой образ из коллекции Azure для устранения неполадок с виртуальной машиной (например SLES 12 вместо SLES 11 с пакетом обновлений 4 (SP4));
* не присоединяйте поврежденный диск ОС из другой виртуальной машины через UUID, используйте вместо этого другие возможности.

## Отправка виртуальной машины SUSE из локальной среды в Azure

[В этой статье](virtual-machines-linux-create-upload-vhd-suse.md) описывается процедура загрузки виртуальной машины SUSE с локального компьютера в Azure.

Если требуется отправить виртуальную машину без отзыва в конце, например для сохранения существующей установки SAP, а также имени узла, следует проверить следующие элементы:

* Убедитесь, что диск ОС подключен через UUID, а не через идентификатор устройства. Для диска ОС недостаточно изменить UUID только в /etc/fstab. Также не забудьте адаптировать загрузчик, например с помощью YaST или посредством изменения /boot/grub/menu.lst
* Если вы использовали формат VHDX для диска операционной системы SUSE и преобразовали его в виртуальный жесткий диск для передачи в Azure, весьма вероятно, что сетевое устройство изменилось с eth0 на eth1. Чтобы избежать дальнейших проблем при загрузке в Azure, следует вернуть значение eth0, как описано в [этой статье](https://dartron.wordpress.com/2013/09/27/fixing-eth1-in-cloned-sles-11-vmware/).

Помимо выполнения описанных в этой статье действий рекомендуется также удалить:

   /lib/udev/rules.d/75-persistent-net-generator.rules.

Установка агента Linux для Azure должна выполняться без каких-либо проблем, если только не используется несколько сетевых карт.

## Развертывание виртуальной машины SUSE в Azure

Новые виртуальные машины SUSE следует создавать с помощью JSON-файлов шаблонов в новой модели диспетчера ресурсов Azure. После создания JSON-файла шаблона виртуальную машину можно развернуть с помощью следующей команды в качестве альтернативы для PowerShell:

   ``` azure group deployment create "<deployment name>" -g "<resource group name>" --template-file "<../../filename.json>"

   ``` Дополнительные сведения о JSON-файлах шаблонов см. в [этой статье](resource-group-authoring-templates.md) и на [этой веб-странице](https://azure.microsoft.com/documentation/templates/).

Дополнительные сведения об интерфейсе командной строки и диспетчере ресурсов Azure см. в [этой статье](xplat-cli-azure-resource-manager.md).

## Ключ оборудования и лицензия SAP

Для официальной сертификации SAP-Windows-Azure был представлен новый механизм для вычисления ключа оборудования SAP, который используется для лицензии SAP. Ядро SAP было адаптировано для использования данного ключа. В текущем ядре SAP для Linux такое изменение кода отсутствует. Поэтому в определенных ситуациях (например, при изменении размера виртуальной машины Azure) ключ оборудования SAP изменяется, что делает лицензию SAP недействительной.

## Пакет SUSE sapconf

В SUSE есть пакет под названием sapconf, который содержит набор параметров SAP. Дополнительные сведения об этом пакете, включая его функции, а также способ его установки и использования, см. в [этой записи блога SUSE](https://www.suse.com/communities/blog/using-sapconf-to-prepare-suse-linux-enterprise-server-to-run-sap-systems/) и [этой записи блога SAP](http://scn.sap.com/community/linux/blog/2014/03/31/what-is-sapconf-or-how-to-prepare-a-suse-linux-enterprise-server-for-running-sap-systems).

## Общая папка NFS в распределенных установках SAP

В случае распределенной установки, когда требуется, например, установить сервер базы данных и сервер приложений SAP в отдельных виртуальных машинах, вы можете обеспечить общий доступ к каталогу /sapmnt через сетевую файловую систему (NFS). Если после создания общей папки NFS в процессе установки возникают неполадки, убедитесь, что для этой общей папки установлен "no\_root\_squash". Такое решение использовалось во внутреннем тестовом случае.


## Логические тома

Диспетчер логических томов (LVM) не полностью проверен в Azure. Если требуется большой логический том на нескольких дисках данных Azure (например, для базы данных SAP), следует использовать mdadm. В [этой статье](virtual-machines-linux-configure-raid.md) описан процесс настройки RAID Linux в Azure с помощью mdadm.


## Репозиторий SUSE Azure

В случае проблемы с доступом к стандартному репозиторию SUSE Azure можно воспользоваться простой командой для сброса этого состояния. Это может произойти при создании частного образа ОС в одном регионе Azure с последующим копированием образа в другой регион, где требуется развернуть новые виртуальные машины на основе этого частного образа ОС. Просто выполните следующую команду в виртуальной машине:

   ```
   service guestregister restart
   ```

## Gnome Desktop

Если вы хотите использовать Gnome Desktop для установки полноценной демонстрационной системы SAP внутри одной виртуальной машины, включая графический интерфейс SAP, браузер, консоль управления SAP и т. п., здесь приведена небольшая подсказка по его установке в образах SLES Azure:

   SLES 11

   ```
   zypper in -t pattern gnome
   ```

   SLES 12

   ```
   zypper in -t pattern gnome-basic
   ```

## Поддержка SAP-Oracle на платформе Linux в облаке

Существует ограничение поддержки, накладываемое Oracle на Linux в виртуализованных средах. Это — общая тема, которая не относится только к Azure. Однако разобраться в ней важно. SAP не поддерживает Oracle на SUSE или RedHat в общедоступном облаке, таком как Azure. Клиенты должны обратиться непосредственно в Oracle для обсуждения этого вопроса.

<!---HONumber=AcomDC_0218_2016-->