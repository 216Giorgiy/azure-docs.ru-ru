<properties
	pageTitle="Автоматическая установка исправлений для виртуальных машин SQL Server (классическая модель) | Microsoft Azure"
	description="Описывается функция автоматической установки исправлений для виртуальных машин SQL Server в Azure, использующих классический режим развертывания."
	services="virtual-machines-windows"
	documentationCenter="na"
	authors="rothja"
	manager="jhubbard"
	editor=""
	tags="azure-service-management" />
<tags
	ms.service="virtual-machines-windows"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="vm-windows-sql-server"
	ms.workload="infrastructure-services"
	ms.date="05/18/2016"
	ms.author="jroth" />

# Автоматическая установка исправлений SQL Server на виртуальных машинах Azure (классическая модель)

> [AZURE.SELECTOR]
- [Диспетчер ресурсов](virtual-machines-windows-sql-automated-patching.md)
- [Классический](virtual-machines-windows-classic-sql-automated-patching.md)

При автоматической установке исправлений на виртуальных машинах Azure с SQL Server задается период обслуживания. Установка автоматических обновлений возможна только в этот период обслуживания. Для SQL Server это гарантирует, что системные обновления и связанные с ними перезапуски системы будут происходить в наиболее удобное для базы данных время. Автоматическая установка исправлений зависит от [Расширения агента IaaS для SQL Server](virtual-machines-windows-classic-sql-server-agent-extension.md).

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-classic-include.md)]
Модель диспетчера ресурсов. Версию этой статьи для диспетчера ресурсов см. в разделе [Автоматическое исправление SQL Server на виртуальных машинах Azure (диспетчер ресурсов)](virtual-machines-windows-sql-automated-patching.md).

## Предварительные требования

Для использования автоматической установки исправлений необходимо выполнить следующие предварительные требования.

**Операционная система**

- Windows Server 2012
- Windows Server 2012 R2

**Версия SQL Server**

- SQL Server 2012
- SQL Server 2014
- SQL Server 2016

**Azure PowerShell**

- [Установите последние команды Azure PowerShell](../powershell-install-configure.md), если планируете настраивать автоматические исправления с помощью PowerShell.

>[AZURE.NOTE] Автоматическая установка исправлений зависит от расширения агента IaaS для SQL Server. В текущей коллекции образов виртуальных машин SQL это расширение присутствует по умолчанию. Дополнительные сведения см. в статье [Расширение агента IaaS для SQL Server](virtual-machines-windows-classic-sql-server-agent-extension.md).

## Параметры

В приведенной ниже таблице описаны параметры для настройки автоматической установки исправлений. Фактическая процедура настройки может варьироваться в зависимости от того, используете вы портал Azure или команды Azure Windows PowerShell.

|Настройка|Возможные значения|Описание|
|---|---|---|
|**Автоматическое исправление**|Включено/отключено (отключено)|Включает или отключает автоматическую установку исправлений для виртуальной машины Azure.|
|**Расписание обслуживания**|Каждый день, понедельник, вторник, среда, четверг, пятница, суббота, воскресенье|Расписание для скачивания и установки обновлений Windows, SQL Server и обновлений Майкрософт для виртуальной машины.|
|**Время начала обслуживания**|0–24|Локальное время начала обновления виртуальной машины.|
|**Длительность периода обслуживания**|30–180|Допустимое количество минут для скачивания и установки обновлений.|
|**Категория исправления**|Важно!|Категория обновлений, которые будут скачаны и установлены.|

## Настройка на портале

При создании новой виртуальной машины SQL Server с классической моделью развертывания можно настроить автоматическую установку исправлений с помощью [портала Azure](http://go.microsoft.com/fwlink/?LinkID=525040&clcid=0x409).

На снимке экрана портала Azure ниже данные параметры отображаются в разделе **ДОПОЛНИТЕЛЬНАЯ НАСТРОЙКА** | **АВТОМАТИЧЕСКАЯ УСТАНОВКА ИСПРАВЛЕНИЙ SQL**.

![Автоматическая установка исправлений SQL на портале Azure](./media/virtual-machines-windows-classic-sql-automated-patching/IC778484.jpg)

Для уже существующих виртуальных машин SQL Server 2012 или 2014 выберите параметры **автоматической установки исправлений** в разделе **Конфигурация** свойств виртуальной машины. В окне **Автоматическая установка исправлений** можно включить эту функцию, установить расписание обслуживания и время его начала, а также выбрать длительность периода обслуживания. Это показано на следующем снимке экрана.

![Настройка автоматической установки исправлений на портале Azure](./media/virtual-machines-windows-classic-sql-automated-patching/IC792132.jpg)

>[AZURE.NOTE] Когда автоматическая установка исправлений активируется впервые, Azure настраивает агент SQL Server IaaS в фоновом режиме. В течение этого времени портал Azure может не отображать информацию о том, что выполняется настройка автоматической установки исправлений. Установка и настройка агента занимают несколько минут. После этого новые параметры отобразятся на портале Azure.

## Настройка с помощью PowerShell

Для настройки автоматической установки исправлений можно также использовать PowerShell.

В следующем примере для настройки автоматической установки исправлений на существующей виртуальной машине SQL Server используется PowerShell. Команда **New-AzureVMSqlServerAutoPatchingConfig** настраивает новый период обслуживания для автоматической установки обновлений.

    $aps = New-AzureVMSqlServerAutoPatchingConfig -Enable -DayOfWeek "Thursday" -MaintenanceWindowStartingHour 11 -MaintenanceWindowDuration 120  -PatchCategory "Important"

    Get-AzureVM -ServiceName <vmservicename> -Name <vmname> | Set-AzureVMSqlServerExtension -AutoPatchingSettings $aps | Update-AzureVM

В представленной ниже таблице показано фактическое воздействие на конечную виртуальную машину Azure на основе данного примера.

|Параметр|Результат|
|---|---|
|**DayOfWeek**|Исправления устанавливаются каждый четверг.|
|**MaintenanceWindowStartingHour**|Установка обновлений начинается в 11:00.|
|**MaintenanceWindowsDuration**|Обновления должны быть установлены в течение 120 минут. С учетом времени начала установка обновлений должна завершаться к 13:00.|
|**PatchCategory**|Единственное возможное значение для этого параметра — Important (Важно).|

Установка и настройка агента SQL Server IaaS занимают несколько минут.

Чтобы отключить автоматическую установку обновлений, выполните тот же скрипт без параметра -Enable в команде New-AzureVMSqlServerAutoPatchingConfig. Как и установка, отключение автоматической установки исправлений занимает несколько минут.

## Дальнейшие действия

Сведения о других доступных задачах автоматизации см. в разделе [Расширение агента IaaS для SQL Server](virtual-machines-windows-classic-sql-server-agent-extension.md).

Подробные сведения о запуске SQL Server на виртуальных машинах Azure см. в разделе [Общие сведения об SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-overview.md).

<!---HONumber=AcomDC_0525_2016-->