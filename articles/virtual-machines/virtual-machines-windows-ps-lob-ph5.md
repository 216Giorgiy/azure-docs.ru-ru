<properties 
	pageTitle="Бизнес-приложение, этап 5 | Microsoft Azure" 
	description="На пятом этапе развертывания бизнес-приложения в Azure создайте группу доступности и добавьте в нее базы данных приложения." 
	documentationCenter=""
	services="virtual-machines-windows" 
	authors="JoeDavies-MSFT" 
	manager="timlt" 
	editor=""
	tags="azure-resource-manager"/>

<tags 
	ms.service="virtual-machines-windows" 
	ms.workload="infrastructure-services" 
	ms.tgt_pltfrm="Windows" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="05/04/2016" 
	ms.author="josephd"/>

# Пятый этап развертывания бизнес-приложений: создание группы доступности и добавление баз данных приложений

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-rm-include.md)]Классическая модель развертывания.

На последнем этапе развертывания высокодоступных бизнес-приложений в службах инфраструктуры Azure вы создадите новую группу доступности AlwaysOn для SQL Server и добавите базы данных приложения.

Все этапы перечислены в статье [Развертывание высокодоступных бизнес-приложений в Azure](virtual-machines-windows-lob-overview.md).

## Создание группы доступности и добавление баз данных

Для каждой базы данных бизнес-приложения сделайте следующее:

1.	Создайте полную резервную копию и резервную копию журнала транзакций базы данных на основной виртуальной машине SQL Server.
2.	Восстановите полную резервную копию и копию журнала на резервной виртуальной машине SQL Server.

Выполнив резервное копирование и восстановление баз данных, вы можете добавить их в группу доступности. Сервер SQL Server позволяет использовать в составе группы только те базы данных, для которых была создана (хотя бы один раз) и восстановлена на другой машине резервная копия.

### Предоставление доступа к папкам резервных копий

Для выполнения операций резервного копирования и восстановления файлы резервных копий (BAK-файлы) должны быть доступны с дополнительного сервера базы данных. Выполните перечисленные ниже действия.

1.	Войдите на сервер-источник базы данных с помощью учетной записи **[домен]\\sqladmin**. 
2.	Перейдите на диск F:\\. 
3.	Щелкните правой кнопкой мыши папку **Backup**, выберите команду **Общий доступ** и щелкните **Отдельные люди**.
4.	В диалоговом окне **Общий доступ к файлам** введите **[домен]\\sqlservice** и нажмите кнопку **Добавить**.
5.	Щелкните столбец **Уровень разрешений** для учетной записи **sqlservice** и выберите **Чтение и запись**. 
6.	Нажмите кнопку **Общий доступ**, а затем — **Готово**.

Выполните перечисленные выше действия на сервере-получателе базы данных. На шаге 5 предоставьте учетной записи sqlservice разрешение на **чтение** папки F:\\Backup.

### Резервное копирование и восстановление базы данных

Описанные ниже действия необходимо повторить для каждой базы данных, которую требуется добавить в группу доступности.

Чтобы создать резервную копию базы данных, выполните перечисленные ниже действия.

1.	На начальном экране сервера-источника базы данных введите **SQL Studio** и выберите **SQL Server Management Studio**.
2.	Щелкните **Подключить**.
3.	В левой области разверните узел **Базы данных**.
4.	Щелкните правой кнопкой мыши базу данных для резервного копирования, наведите указатель на элемент **Задачи** и выберите **Создать резервную копию**.
5.	В разделе **Назначение** нажмите кнопку **Удалить**, чтобы удалить путь к файлу резервной копии по умолчанию.
6.	Щелкните **Добавить**. В поле **Имя файла** введите **\\[имя\_компьютера]\\backup[база\_данных].bak**, где **имя\_компьютера** — имя основного **сервера** SQL Server, а **база\_данных** — имя базы данных. Нажмите кнопку **ОК**, а затем щелкните **ОК** еще раз в окне с сообщением об успешном создании резервной копии.
7.	На левой панели щелкните правой кнопкой мыши **[имя\_базы\_данных]**, наведите указатель на элемент **Задачи** и выберите **Создать резервную копию**.
8.	В поле **Тип резервной копии** выберите вариант **Журнал транзакций** и дважды нажмите кнопку **ОК**.
9.	Не закрывайте этот сеанс подключения к удаленному рабочему столу.

Чтобы восстановить резервную копию базы данных, выполните перечисленные ниже действия.

1.	Войдите на дополнительный сервер базы данных с учетной записью [имя\_домена]\\sp\_farm\_db.
2.	На начальном экране введите **SQL Studio** и выберите **SQL Server Management Studio**.
3.	Щелкните **Подключить**.
4.	В левой области щелкните правой кнопкой мыши **Базы данных** и выберите команду **Восстановить базу данных**.
5.	В разделе **Источник** выберите **Устройство** и нажмите кнопку с многоточием (…).
6.	В разделе **Выберите устройства резервного копирования** нажмите кнопку **Добавить**.
7.	В поле **Расположение архивного файла** введите **\\[имя\_компьютера]\\backup**, нажмите клавишу **ВВОД**, введите **[имя\_базы\_данных].bak** и дважды нажмите кнопку **ОК**. В разделе **Восстанавливаемые резервные наборы данных** должны появиться полная резервная копия и резервная копия журнала.
8.	В разделе **Выбор страницы** щелкните **Параметры**. В разделе **Параметры восстановления** в поле **Состояние восстановления** выберите вариант **NORECOVERY** и нажмите кнопку **ОК**. 
9.	При появлении запроса нажмите кнопку **ОК**.

### Создание группы доступности

Подготовив к работе хотя бы одну базу данных (посредством резервного копирования и восстановления), можно создавать группу доступности.

1.	Вернитесь к сеансу подключения к удаленному рабочему столу основного сервера базы данных.
2.	В **SQL Server Management Studio** в левой области щелкните правой кнопкой мыши элемент **Высокий уровень доступности AlwaysOn** и выберите пункт **Мастер создания групп доступности**.
3.	На **вводной странице** нажмите кнопку **Далее**. 
4.	На странице **Указание имени группы доступности** введите название своей группы доступности (например, AG1) в поле **Имя группы доступности** и нажмите кнопку **Далее**.
5.	На странице **Выбор баз данных** выберите базы данных приложения, для которых вы создали резервные копии, и нажмите кнопку **Далее**. Эти базы отвечают требованиям для создания группы доступности, так как вы создали для них как минимум одну полную резервную копию на соответствующей первичной реплике.
6.	На странице **Указание реплик** нажмите кнопку **Добавить реплику**.
7.	В поле **Соединение с сервером** введите имя дополнительного сервера базы данных и нажмите кнопку **Подключить**. 
8.	На странице **Указание реплик** в списке **Реплики доступности** будет указан дополнительный сервер базы данных. Для обоих экземпляров сервера задайте указанные ниже значения параметров. 

Исходная роль | Параметр | Значение 
--- | --- | ---
Главный | Автоматический переход на другой ресурс (до 2) | Выбрано
Второстепенный | Автоматический переход на другой ресурс (до 2) | Выбрано
Главный | Синхронная фиксация (до 3) | Выбрано
Второстепенный | Синхронная фиксация (до 3) | Выбрано
Главный | Вторичная реплика для чтения | Да
Второстепенный | Вторичная реплика для чтения | Да
		
9.	Нажмите кнопку **Далее**.
10.	На странице **Выбор начальной синхронизации данных** щелкните **Только соединение** и нажмите кнопку **Далее**. Синхронизация данных выполняется вручную путем создания полной резервной копии и резервной копии журнала на сервере-источнике и их восстановления на сервере-получателе. Вместо этого можно выбрать вариант **Полная**, чтобы мастер создания групп доступности автоматически выполнил синхронизацию данных. Обратите внимание на то, что синхронизацию не рекомендуется проводить для крупных баз, которые иногда используются на предприятиях.
11.	На странице **Проверка** нажмите кнопку **Далее**. Появится предупреждение об отсутствии параметров прослушивателя группы доступности, так как он еще не настроен. 
12.	На странице **Сводка** нажмите кнопку **Готово**. Завершив работу с мастером, проверьте содержимое страницы **Результаты**, чтобы убедиться в том, что группа доступности успешно создана. Если все в порядке, нажмите кнопку **Закрыть**, чтобы выйти из мастера. 
13.	На начальном экране введите **Отказоустойчивость** и щелкните **Диспетчер отказоустойчивости кластеров**. В левой области откройте имя своего кластера и щелкните **Роли**. В списке должна появиться новая роль, имя которой совпадает с именем группы доступности.

Группа доступности SQL Server AlwaysOn для баз данных приложений настроена.

![](./media/virtual-machines-windows-ps-lob-ph5/workload-lobapp-phase4.png)

Теперь вы можете начать развертывание этого нового приложения для пользователей интрасети.

## Настройка прослушивателя для группы доступности AlwaysOn

Для группы доступности AlwaysOn можно задать конфигурацию прослушивателя. Соответствующие инструкции см. в статье [Учебник. Конфигурация прослушивателя для групп доступности AlwaysOn](https://msdn.microsoft.com/library/dn425027.aspx). Это пошаговые инструкции по созданию одного прослушивателя (рекомендуется) и использованию статического IP-адреса экземпляра подсистемы внутренней балансировки нагрузки.

Настроив прослушиватель, вам потребуется указать его на всех виртуальных машинах с веб-серверами вместо имени первого сервера SQL Server в кластере. Вместо использования нового DNS-имени и записи, которая указывает на виртуальный IP-адрес экземпляра подсистемы внутренней балансировки нагрузки, настройте виртуальные машины с веб-серверами на использование псевдонима SQL. Дополнительные сведения и инструкции см. в статье [Псевдоним SQL для SharePoint](http://blogs.msdn.com/b/priyo/archive/2013/09/13/sql-alias-for-sharepoint.aspx).

## Дальнейшие действия

- Ознакомьтесь с этими [рекомендациями](virtual-machines-linux-infrastructure-service-guidelines.md), если развертываете рабочую нагрузку ИТ-среды в Azure.

<!---HONumber=AcomDC_0511_2016-->