---
title: Использование службы хранилища Azure для резервного копирования и восстановления SQL Server | Microsoft Docs
description: Узнайте, как выполнить архивацию SQL Server в службу хранилища Azure. Описаны преимущества архивации баз данных SQL в службу хранилища Azure.
services: virtual-machines-windows
documentationcenter: ''
author: MikeRayMSFT
manager: jhubbard
tags: azure-service-management

ms.service: virtual-machines-windows
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: infrastructure-services
ms.date: 07/22/2016
ms.author: mikeray

---
# Использование службы хранилища Azure для архивации и восстановления SQL Server
## Обзор
Начиная с SQL Server 2012 с пакетом обновления 1 (SP1) и накопительным обновлением 2 (CU2), резервные копии SQL Server можно записывать непосредственно в службу хранилища BLOB-объектов Azure. Эта функция позволяет использовать службу BLOB-объектов Azure для резервного копирования и восстановления локальной Базы данных SQL Server или Базы данных SQL Server на виртуальной машине Azure. Резервное копирование в облако обеспечивает следующие преимущества: доступность, неограниченное хранилище вне организации с поддержкой георепликации и простота миграции данных в облако и обратно. Для выполнения операторов BACKUP и RESTORE можно использовать Transact-SQL или SMO.

SQL Server 2016 содержит новые возможности: можно использовать [архивацию моментальных снимков файлов](http://msdn.microsoft.com/library/mt169363.aspx), чтобы практически мгновенно выполнять архивацию и невероятно быстро осуществлять восстановление.

В этом разделе объясняется, почему может потребоваться использовать службу хранилища Azure для резервных копий SQL, и описываются задействованные компоненты. Ресурсы, приведенные в конце статьи, позволят ознакомиться с пошаговыми руководствами и дополнительными сведениями, которые помогут приступить к использовании этой службы для ваших резервных копий SQL Server.

## Преимущества использования службы BLOB-объектов Azure для резервных копий SQL Server
Есть несколько задач, которые нужно решить при архивации SQL Server. К ним относятся управление хранилищами, риск отказа хранилища, доступ к внешнему хранилищу и настройка устройств. Многие из этих задач можно решить, используя службу хранилища BLOB-объектов Azure для резервных копий SQL Server. Учтите следующие преимущества.

* **Удобство использования**. Хранение резервных копий в больших двоичных объектах Azure может быть удобным, гибким и доступным вариантом внешнего хранения. Создание внешнего хранилища для резервных копий SQL Server может быть не сложнее изменения существующих сценариев и заданий для использования синтаксиса **BACKUP TO URL**. Внешнее хранилище обычно должно находиться достаточно далеко от расположения производственной базы данных, чтобы предотвратить возможное одновременное влияние одной аварии на расположение внешней и производственной баз данных. Выбор [георепликации больших двоичных объектов Azure](../storage/storage-redundancy.md) обеспечивает дополнительный уровень защиты в случае аварии, которая может повлиять на весь регион.
* **Архив резервных копий**. Служба хранилища BLOB-объектов Azure предлагает лучшую альтернативу частому использованию ленточных накопителей для архивирования резервных копий. Использование ленточного накопителя может потребовать физического переноса на внешние средства и принятия мер для защиты носителей. Хранение резервных копий в хранилище BLOB-объектов Azure предоставляет возможность мгновенного и долговременного архивирования с высокой доступностью.
* **Управляемое оборудование**. При использовании служб Azure отсутствуют накладные расходы на управление оборудованием. Службы Azure управляют оборудованием, обеспечивая при этом георепликацию для избыточности и защиту от сбоев оборудования.
* **Неограниченное хранилище**. Включая прямую архивацию в большие двоичные объекты Azure, вы получаете доступ к практически неограниченным ресурсам хранения. Кроме того, архивация на диск виртуальной машины Azure имеет ограничения в зависимости от размера виртуальной машины. Число дисков, которые можно подключить к виртуальной машине Azure для хранения резервных копий, ограничено. Оно равно 16 для очень крупного экземпляра и меньше этого значения для экземпляров меньшего размера.
* **Доступность резервных копий**. Резервные копии, сохраненные в больших двоичных объектах Azure, теперь доступны везде и всегда. К ним легко получить доступ для восстановления данных на локальный SQL Server или другой SQL Server, выполняемый на виртуальной машине Azure. Подключать или отключать базу данных или скачивать и подключать виртуальный жесткий диск при этом не требуется.
* **Цена**. Платите только за используемую службу. Может быть экономичным вариантом внешнего архива и архива резервных копий. Дополнительные сведения см. в разделе [Калькулятор стоимости Azure](http://go.microsoft.com/fwlink/?LinkId=277060 "Калькулятор стоимости") и [Цены Azure](http://go.microsoft.com/fwlink/?LinkId=277059 "Цены").
* **Моментальные снимки хранилищ**. Если файлы базы данных хранятся в большом двоичном объекте Azure и используется SQL Server 2016, можно использовать [архивацию файлов моментальных снимков](http://msdn.microsoft.com/library/mt169363.aspx), чтобы выполнять архивацию и восстановление практически мгновенно.

Дополнительные сведения см. в статье [Резервное копирование и восстановление SQL Server с помощью службы хранилища BLOB-объектов Azure](http://go.microsoft.com/fwlink/?LinkId=271617)

В следующих двух разделах описана служба хранилища BLOB-объектов Azure, а также необходимые компоненты SQL Server. Чтобы успешно использовать службу хранилища BLOB-объектов Azure для архивации и восстановления, важно понимать, какие используются компоненты и как они взаимодействуют.

## Компоненты службы хранилища BLOB-объектов Azure
При архивации в службу хранилища BLOB-объектов Azure используются следующие компоненты Azure.

| Компонент | Описание |
| --- | --- |
| **Учетная запись хранения** |учетная запись хранения является отправной точкой для всех служб хранилища. Для доступа к службе хранилища BLOB-объектов Azure необходимо сначала создать учетную запись хранения Azure. Дополнительные сведения о службе хранилища больших двоичных объектов Azure см. в разделе [Использование службы хранилища больших двоичных объектов](https://azure.microsoft.com/develop/net/how-to-guides/blob-storage/) |
| **Контейнер** |Контейнер позволяет сгруппировать набор больших двоичных объектов и может содержать неограниченное количество больших двоичных объектов. Для записи резервной копии SQL Server в службу BLOB-объектов Azure необходимо создать, по крайней мере, корневой контейнер. |
| **Большой двоичный объект** |файл любого типа и размера. Для адресации BLOB-объектов используется следующий формат URL-адресов: **[учетная\_запись\_https://[storage].blob.core.windows.net/[контейнер]/[большой\_двоичный\_объект]**. Дополнительные сведения о страничных BLOB-объектах см. в разделе [Основные сведения о блочных, добавочных и страничных BLOB-объектах](http://msdn.microsoft.com/library/azure/ee691964.aspx). |

## Компоненты SQL Server
При архивации в службу хранилища BLOB-объектов Azure используются следующие компоненты SQL Server.

| Компонент | Описание |
| --- | --- |
| **URL-адрес** |URL-адрес определяет универсальный идентификатор ресурса (URI) для уникального файла резервной копии. URL-адрес используется, чтобы предоставить местоположение и имя файла резервной копии SQL Server. URL-адрес должен указывать на фактический большой двоичный объект, а не только контейнер. Если большого двоичного объекта не существует, он будет создан. Если указан существующий большой двоичный объект, при отсутствии параметра > WITH FORMAT происходит сбой инструкции BACKUP. Ниже приведен пример URL-адреса, который можно указать в команде BACKUP: **http[s]://[учетная\_запись\_хранения].blob.core.windows.net/[контейнер]/[ИМЯ\_ФАЙЛА.bak]**. Использование HTTPS рекомендуется, но не является обязательным. |
| **Учетные данные** |сведения, необходимые для подключения к службе хранилища BLOB-объектов Azure и проверки подлинности, хранятся в виде учетных данных. Чтобы разрешить SQL Server записывать резервные копии как BLOB-объекты Azure или выполнять восстановление из BLOB-объектов, необходимо создать учетные данные SQL Server. Дополнительные сведения см. в статье [Учетные данные SQL Server](https://msdn.microsoft.com/library/ms189522.aspx). |

> [!NOTE]
> Если нужно скопировать и отправить файл резервной копии в службу хранилища BLOB-объектов Azure и планируется использовать этот файл для операций восстановления, необходимо использовать BLOB-объект страничного типа в качестве варианта хранилища. Восстановление (RESTORE) из BLOB-объекта блочного типа завершится ошибкой.
> 
> 

## Дальнейшие действия
1. Если у вас ее еще нет, создайте учетную запись Azure. При оценке затрат на Azure рассмотрите [бесплатную пробную версию](https://azure.microsoft.com/free/).
2. Затем следуйте одному из следующих учебников, в которых описывается создание учетной записи и выполнение восстановления.
   
   * **SQL Server 2014**: [Учебник. Резервное копирование и восстановление SQL Server 2014 с помощью службы хранилищ BLOB-объектов Microsoft Azure](https://msdn.microsoft.com/library/jj720558\(v=sql.120\).aspx).
   * **SQL Server 2016**: [Учебник. Файлы данных SQL Server в службе хранилища Microsoft Azure](https://msdn.microsoft.com/library/dn466438.aspx).
3. Просмотрите дополнительную документацию, начиная со статьи [Архивация и восстановление SQL Server с помощью службы хранилища BLOB-объектов Microsoft Azure](https://msdn.microsoft.com/library/jj919148.aspx).

При наличии проблем ознакомьтесь с разделом [Резервное копирование SQL Server на URL-адрес — рекомендации и устранение неполадок](https://msdn.microsoft.com/library/jj919149.aspx).

С другими вариантами архивации и восстановления SQL Server ознакомьтесь в статье [Архивация и восстановление для SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-backup-recovery.md).

<!---HONumber=AcomDC_0907_2016-->