<properties
	pageTitle="Ошибка, сбой или отклонение SSH-подключения к виртуальной машине Linux | Microsoft Azure"
	description="Диагностика и исправление ошибок SSH, например «ошибка SSH-подключения» или «в SSH-подключении отказано», для виртуальной машины под управлением Linux."
	keywords="отклонение SSH-подключения, ошибка SSH, Azure SSH, ошибка SSH-подключения"
	services="virtual-machines-linux"
	documentationCenter=""
	authors="iainfoulds"
	manager="timlt"
	editor=""
	tags="top-support-issue,azure-service-management,azure-resource-manager"/>

<tags
	ms.service="virtual-machines-linux"
	ms.workload="infrastructure-services"
	ms.tgt_pltfrm="vm-linux"
	ms.devlang="na"
	ms.topic="article"
	ms.date="07/06/2016"
	ms.author="iainfou"/>

# Устранение неполадок с SSH-подключением к виртуальной машине Azure Linux: сбой, ошибка или отклонение

При попытке подключения к виртуальной машине Azure под управлением Linux ошибка, сбой или отклонение подключения Secure Shell (SSH) может возникнуть по нескольким причинам. В этой статье вы узнаете, как их выявить и устранить.

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-both-include.md)]

Если в любой момент при изучении этой статьи вам потребуется дополнительная помощь, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](http://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт поддержки Azure](http://azure.microsoft.com/support/options/) и щелкните **Получить поддержку**. Дополнительные сведения об использовании службы поддержки Azure см. в статье [Часто задаваемые вопросы о поддержке Microsoft Azure](http://azure.microsoft.com/support/faq/).

## Виртуальные машины, созданные с использованием модели развертывания с помощью Resource Manager

Можно сбросить учетные данные или выполнить сброс SSHD, используя непосредственно команды Azure CLI или [расширение Azure VMAccessForLinux](https://github.com/Azure/azure-linux-extensions/tree/master/VMAccess). После выполнения каждого шага устранения неполадок попробуйте подключиться к виртуальной машине еще раз.

### Предварительные требования Azure CLI

[Установите интерфейс командной строки (CLI) Azure и подключитесь к подписке Azure](../xplat-cli-install.md) (если вы еще этого не сделали). Войдите, используя команду `azure login`, и перейдите в режим Resource Manager (`azure config mode arm`).

Убедитесь, что у вас установлен [агент Linux для Microsoft Azure](virtual-machines-linux-agent-user-guide.md) версии 2.0.5 или более поздней.

### Сброс SSHD
Может быть неправильно настроена сама конфигурация SSHD, или в службе произошла ошибка. Чтобы убедиться, что конфигурация SSH действительна, можно выполнить сброс SSHD.

#### Инфраструктура CLI Azure
```bash
azure vm reset-access -g <resource group> -n <vm name> -r
```

#### Расширение для доступа к виртуальной машине
Расширения для доступа считываются в JSON-файле, который определяет, какое действие следует выполнить, например сброс SSH, сброс ключа SSH, добавление нового пользователя и т. д. Во-первых, создайте файл PrivateConf.json со следующим содержимым:

```bash
{  
	"reset_ssh":"True"
}
```

Затем вручную запустите расширение `VMAccessForLinux`, чтобы сбросить SSHD-подключение.

```bash
azure vm extension set <resource group> <vm name> VMAccessForLinux Microsoft.OSTCExtensions "1.2" --private-config-path PrivateConf.json
```

### Сброс учетных данных SSH пользователя
Если SSHD работает корректно, можно сбросить пароль для отдельного пользователя.

#### Инфраструктура CLI Azure
```bash
azure vm reset-access -g <resource group> <vm name> -u <username> -p <new password>
```

При использовании аутентификацию с помощью ключа SSH можно сбросить ключ SSH для отдельного пользователя:

```bash
azure vm reset-access -g <resource group> -n <vm name> -u <username> -M <~/.ssh/azure_id_rsa.pub>
```

#### Расширение для доступа к виртуальной машине
Создайте файл PrivateConf.json со следующим содержимым:

```bash
{
	"username":"Username", "password":"NewPassword"
}
```

Или, чтобы сбросить ключ SSH для отдельного пользователя, создайте файл с именем PrivateConf.json со следующим содержимым:

```bash
{
	"username":"Username", "ssh_key":"ContentsOfNewSSHKey"
}
```

После выполнения одного из вышеописанных шагов следует вручную запустить расширение `VMAccessForLinux`, чтобы сбросить учетные данные пользователя SSH:

```
azure vm extension set <resource group> <vmname> VMAccessForLinux Microsoft.OSTCExtensions "1.2" --private-config-path PrivateConf.json
```

### Повторное развертывание виртуальной машины
Виртуальную машину можно повторно развернуть на другом узле в Azure, что поможет устранить любые базовые сетевые проблемы. Чтобы повторно развернуть виртуальную машину, используя портал Azure, последовательно выберите **Обзор** > **Виртуальные машины** > *имя вашей виртуальной машины Linux* > **Повторить развертывание**. Сведения о том, как это сделать, см. в статье [Повторное развертывание виртуальной машины на новом узле Azure](virtual-machines-windows-redeploy-to-new-node.md). В настоящее время невозможно развернуть виртуальную машину с помощью интерфейса командной строки Azure.

> [AZURE.NOTE] Обратите внимание, что после завершения этой операции временные данные на диске будут потеряны, а динамические IP-адреса, связанные с виртуальной машиной, будут обновлены.


## Виртуальные машины, созданные с использованием классической модели развертывания

Для устранения наиболее распространенных сбоев SSH-подключения для виртуальных машин, созданных с помощью классической модели развертывания, попробуйте выполнить указанные ниже действия. После выполнения каждого шага попробуйте подключиться к виртуальной машине еще раз.

- Выполните сброс удаленного доступа на [портале Azure](https://portal.azure.com). На портале Azure последовательно выберите **Обзор** > **Виртуальные машины (классика)** > *имя вашей виртуальной машины Linux* > **Reset Remote...** (Сброс удаленного доступа…).

- Перезапустите виртуальную машину. На [портале Azure](https://portal.azure.com) последовательно выберите **Обзор** > **Виртуальные машины (классика)** > *имя вашей виртуальной машины Linux* > **Перезагрузить**.

	-ИЛИ-

	На [классическом портале Azure](https://manage.windowsazure.com) откройте **Виртуальные машины** > **Экземпляры** и выберите **Перезагрузить**.

- Повторно разверните виртуальную машину на новом узле Azure. Сведения о том, как это сделать, см. в статье [Повторное развертывание виртуальной машины на новом узле Azure](virtual-machines-windows-redeploy-to-new-node.md).

	Обратите внимание, что после завершения этой операции временные данные на диске будут потеряны, а динамические IP-адреса, связанные с виртуальной машиной, будут обновлены.

- Следуйте указаниям в статье о [сбросе пароля или ключа SSH в виртуальных машинах Linux](virtual-machines-linux-classic-reset-access.md), чтобы сделать следующее:
	- сбросить пароль или ключ SSH;
	- создать новую учетную запись пользователя _sudo_;
	- сбросить конфигурацию SSH.

- Проверьте работоспособность ресурсов виртуальной машины, чтобы выявить любые проблемы, связанные с платформой.<br> Последовательно выберите **Обзор** > **Виртуальные машины (классика)** > *ваша виртуальная машина Linux* > **Параметры** > **Проверить работоспособность**.


## Дополнительные ресурсы

- Если вам по-прежнему не удается выполнить SSH-подключение к виртуальной машине, можно выполнить [дополнительные действия по устранению неполадок](virtual-machines-linux-detailed-troubleshoot-ssh-connection.md), которые позволят просмотреть дополнительные сетевые конфигурации и шаги по устранению проблемы.

- Дополнительные сведения об устранении неполадок с доступом к приложению см. в разделе [Устранение неполадок доступа к приложению, выполняющемуся в виртуальной машине Azure](virtual-machines-linux-troubleshoot-app-connection.md).

- Дополнительные сведения об устранении неполадок на виртуальных машинах, созданных с помощью классической модели развертывания, см. в статье о [сбросе пароля или ключа SSH в виртуальных машинах Linux](virtual-machines-linux-classic-reset-access.md).

<!---HONumber=AcomDC_0803_2016-->