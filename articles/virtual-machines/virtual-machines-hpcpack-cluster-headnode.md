<properties
 pageTitle="Создание головного узла пакета HPC в виртуальной машине Azure | Microsoft Azure"
 description="Узнайте, как использовать портал Azure и классическую модель развертывания для создания головного узла пакета Microsoft HPC на виртуальной машине Azure."
 services="virtual-machines"
 documentationCenter=""
 authors="dlepow"
 manager="timlt"
 editor=""
 tags="azure-service-management"/>
<tags
ms.service="virtual-machines"
 ms.devlang="na"
 ms.topic="article"
 ms.tgt_pltfrm="vm-multiple"
 ms.workload="big-compute"
 ms.date="09/28/2015"
 ms.author="danlep"/>

# Создание головного узла кластера пакета HPC на виртуальной машине Azure с помощью образа Marketplace

[AZURE.INCLUDE [learn-about-deployment-models](../../includes/learn-about-deployment-models-include.md)]В этой статье описывается создание ресурсов с помощью классической модели развертывания.

В статье показано, как использовать [образ виртуальной машины пакета Microsoft HPC](https://azure.microsoft.com/marketplace/partners/microsoft/hpcpack2012r2onwindowsserver2012r2/) из Azure Marketplace для создания головного узла кластера HPC Windows в Azure в классической модели развертывания (управление службами). Головной узел требуется присоединить к домену Active Directory в виртуальной сети Azure. Этот головной узел можно использовать для экспериментального развертывания пакета HPC в Azure и добавления вычислительных ресурсов в кластер для выполнения рабочих нагрузок HPC.


![Головной узел пакета HPC][headnode]

>[AZURE.NOTE]В настоящее время образ виртуальной машины пакета HPC основан на ОС Windows Server 2012 R2 Datacenter с предустановленным пакетом HPC 2012 R2 с обновлением 2. Кроме того, предварительно установлен Microsoft SQL Server 2014 Express.


Для рабочего развертывания кластера пакета HPC в Azure мы рекомендуем применять метод автоматического развертывания, такой как [сценарий развертывания IaaS пакета HPC](virtual-machines-hpcpack-cluster-powershell-script.md) или [шаблон быстрой настройки](https://azure.microsoft.com/documentation/templates/) Диспетчера ресурсов Azure.

## Рекомендации относительно планирования

* **Домен Active Directory** — перед запуском служб HPC головной узел пакета HPC должен быть присоединен к домену Active Directory в Azure. Одним из вариантов является развертывание отдельного контроллера домена и леса, развернутого в Azure, к которому можно присоединить виртуальную машину. Для экспериментального развертывания перед запуском служб HPC можно повысить уровень виртуальной машины, создаваемой для головного узла, до контроллера домена.

* **Виртуальная сеть Azure** — если вы планируете добавить в кластер HPC виртуальные машины вычислительных узлов кластера или создаете для кластера отдельный контроллер домена, необходимо развернуть головной узел в виртуальной сети (VNet) Azure. Добавлять к кластеру «расширительные» узлы Azure можно даже без виртуальной сети.

## Шаги по созданию головного узла

Ниже перечислены общие инструкции по созданию виртуальной машины Azure для головного узла пакета HPC. В классической модели развертывания (управление службами) Azure для выполнения этих действий можно использовать разнообразные средства Azure.


1. Если вы планируете создать виртуальную сеть для виртуальной машины головного узла, см. раздел [Создание (классической) виртуальной сети с помощью портала предварительной версии Azure](../virtual-networks/virtual-networks-create-vnet-classic-pportal.md).

    **Рекомендации**

    * Вы можете принять конфигурацию по умолчанию для адресного пространства и подсетей виртуальной сети.

    * Если вы планируете использовать размер экземпляра для ресурсоемких вычислений (A8–A11) для головного узла пакета HPC или позднее хотите добавить в кластер вычислительные ресурсы, выберите регион, в котором такие экземпляры доступны. При использовании экземпляров A8 или A9 для рабочих нагрузок MPI также убедитесь, что адресное пространство виртуальной сети не перекрывается с адресным пространством, зарезервированным RDMA в Azure (172.16.0.0/12). Дополнительные сведения см. в разделе [Сведения о ресурсоемких вычислительных экземплярах A8, A9, A10 и A11](virtual-machines-a8-a9-a10-a11-specs.md).

2. Если необходимо создать новый лес Active Directory в отдельной виртуальной машине, см. раздел [Установка нового леса Active Directory в виртуальной сети Azure](../active-directory/active-directory-new-forest-virtual-machine.md).

    **Рекомендации**

    * Для нескольких развертываний тестов можно создать один контроллер домена в Azure. Чтобы обеспечить высокую доступность домена Active Directory, можно развернуть дополнительный резервный контроллер домена.

    * Для простого экспериментального развертывания можно пропустить этот шаг и позже повысить уровень головного узла виртуальной машины до контроллера домена.

3. На портале управления Azure или портале предварительной версии Azure создайте классическую виртуальную машину, выбрав образ пакета HPC 2012 R2 в Azure Marketplace. (Шаги для портала управления см. [здесь](virtual-machines-windows-tutorial-classic-portal.md).)

    **Рекомендации**

    * Выберите размер виртуальной машины не ниже A4.

    * Если вы хотите развернуть головной узел в виртуальной сети, обязательно укажите эту виртуальную сеть в конфигурации виртуальной машины.

    * Рекомендуется создать для виртуальной машины новую облачную службу.

4. После создания и запуска виртуальной машины присоедините ее к существующему доменному лесу или создайте новый доменный лес на виртуальной машине.

    **Рекомендации**

    * Если вы создали виртуальную машину в виртуальной сети Azure с существующим доменным лесом, подключитесь к этой виртуальной машине. Затем используйте стандартные средства диспетчера серверов или Windows PowerShell, чтобы присоединить ее к доменному лесу. Выполните перезапуск.

    * Если виртуальная машина не создавалась в виртуальной сети Azure или была создана в виртуальной сети без существующего доменного леса, повысьте ее уровень до контроллера домена. Для этого подключитесь к виртуальной машине и затем используйте стандартные средства диспетчера серверов или Windows PowerShell. Подробные инструкции см. в разделе [Установка нового леса Active Directory Windows Server 2012](https://technet.microsoft.com/library/jj574166.aspx).

5. Когда виртуальная машина выполняется и присоединена к лесу Active Directory, запустите на головном узле службы пакета HPC. Для этого:

    а. Подключитесь к виртуальной машине, используя учетную запись домена, которая является членом локальной группы администраторов. Например, можно использовать учетную запись администратора, настроенную при создании виртуальной машины головного узла.

    b. Для использования конфигурации головного узла по умолчанию запустите Windows PowerShell от имени администратора и введите следующую команду:

    ```
    & $env:CCP_HOME\bin\HPCHNPrepare.ps1 –DBServerInstance ".\ComputeCluster"
    ```

    Запуск служб пакета HPC может занять несколько минут.

    Для вывода сведений о дополнительных параметрах конфигурации головного узла введите `get-help HPCHNPrepare.ps1`.


## Дальнейшие действия

* Теперь вы можете работать с головным узлом кластера HPC Windows. Например, вы можете запустить диспетчер кластеров HPC или приступить к работе с командлетами PowerShell HPC.

* [Добавьте виртуальные машины вычислительных узлов](virtual-machines-hpcpack-cluster-node-manage.md) в кластер или добавьте [расширительные узлы Azure](virtual-machines-hpcpack-cluster-node-burst.md) в облачную службу.

* Попробуйте запустить тестовую рабочую нагрузку в кластере. См. пример в [руководстве по началу работы](https://technet.microsoft.com/library/jj884144) с пакетом HPC.

<!--Image references-->
[headnode]: ./media/virtual-machines-hpcpack-cluster-headnode/headnode.png

<!---HONumber=Oct15_HO1-->