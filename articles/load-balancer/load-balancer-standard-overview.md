---
title: "Обзор Azure Load Balancer уровня \"Стандартный\" | Документация Майкрософт"
description: "Обзор возможностей Azure Load Balancer уровня \"Стандартный\""
services: load-balancer
documentationcenter: na
author: KumudD
manager: timlt
editor: 
ms.assetid: 
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/04/2018
ms.author: kumud
ms.openlocfilehash: cf7be370ab0d79be9068534f0c43b88f454bc024
ms.sourcegitcommit: 059dae3d8a0e716adc95ad2296843a45745a415d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/09/2018
---
# <a name="azure-load-balancer-standard-overview-preview"></a>Обзор Azure Load Balancer уровня "Стандартный" (предварительная версия)

Номер SKU уровня "Стандартный" Azure Load Balancer и номер SKU уровня "Стандартный" общедоступного IP-адреса позволяют создавать надежные архитектуры с высоким уровнем масштабируемости. Приложения, использующие Load Balancer уровня "Стандартный", могут использовать новые возможности. Низкая задержка, высокая пропускная способность и масштабирование доступны для миллионов потоков для всех приложений TCP и UDP.

>[!NOTE]
> Номер SKU Load Balancer уровня "Стандартный" сейчас находится в предварительной версии. В период действия предварительной версии эта функция может не отличаться таким же уровнем доступности и надежности, как функции, предоставляемые в общедоступной версии. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). [Общедоступный номер SKU Load Balancer уровня "Базовый"](load-balancer-overview.md) можно использовать для производственных служб. Для использования [предварительной версии зон доступности](https://aka.ms/availabilityzones) в этой предварительной версии требуется [отдельная регистрация](https://aka.ms/availabilityzones) в дополнение к регистрации для [предварительной версии](#preview-sign-up) Load Balancer уровня "Стандартный".

## <a name="why-use-load-balancer-standard"></a>Преимущества Load Balancer уровня "Стандартный"

Вы можете использовать Azure Load Balancer уровня "Стандартный" для широкого спектра виртуальных центров обработки данных. Load Balancer уровня "Стандартный" можно использовать в небольших развертываниях, а также в больших и сложных многозонных архитектурах, чтобы воспользоваться следующими возможностями:

- [Масштабирование корпоративного класса](#enterprisescale) можно достигнуть с помощью Load Balancer уровня "Стандартный". Он может использоваться с любым экземпляром виртуальной машины в виртуальной сети (до 1000 экземпляров виртуальных машин).

- [Новая аналитика диагностики](#diagnosticinsights) позволяет понять этот важный компонент виртуального центра обработки данных, а также управлять им и устранять связанные с ним неполадки. Используйте Azure Monitor (предварительная версия), чтобы отображать, фильтровать и группировать новые многомерные метрики непрерывных измерений состояния пути данных. Отслеживайте данные от внешнего интерфейса до виртуальной машины для проверки работоспособности конечных точек, попыток TCP-подключений и исходящих подключений.

- [Группы безопасности сети](#nsg) теперь необходимы для любого экземпляра виртуальной машины, связанного с номерами SKU Load Balancer уровня "Стандартный" или номерами SKU общедоступного стандартного IP-адреса. Группы безопасности сети обеспечивают повышенную безопасность вашего сценария.

- [Порты высокой доступности обеспечивают высокую надежность](#highreliability) и масштабирование виртуальных сетевых устройств и других сценариев приложений. Порты высокой доступности распределяют трафик на всех портах в интерфейсе внутреннего Azure Load Balancer в пуле экземпляров виртуальной машины.

- [Исходящие подключения](#outboundconnections) теперь используют новую модель распределения портов для преобразования адресов исходной сети (SNAT), которая обеспечивает большую отказоустойчивость и масштабирование.

- [Load Balancer уровня "Стандартный" с зонами доступности](#availabilityzones) может использоваться для создания архитектуры, избыточной в пределах зоны, и зональной архитектуры. Обе эти архитектуры могут использовать распределение нагрузки между зонами. Можно добиться избыточности в пределах зоны без зависимости от записей DNS. Один IP-адрес по умолчанию является избыточным в пределах зоны  и может связываться с любой виртуальной машиной в виртуальной сети региона во всех зонах доступности.


Load Balancer уровня "Стандартный" можно использовать в общедоступной или внутренней конфигурации, которая поддерживает следующие основные сценарии:

- распределение нагрузки входящего трафика между работоспособными экземплярами серверной части;
- перенаправление входящего трафика на один экземпляр серверной части;
- перевод исходящего трафика от частного IP-адреса в рамках виртуальной сети на общедоступный IP-адрес.

### <a name = "enterprisescale"></a>Масштабирование корпоративного класса

 Load Balancer уровня "Стандартный" можно использовать для проектирования высокопроизводительного виртуального центра обработки данных и поддержки любого приложения TCP или UDP. Вы можете использовать автономные экземпляры виртуальных машин или до 1000 экземпляров масштабируемых наборов виртуальных машин в серверном пуле. Вам все так же доступны низкая задержка пересылки, высокая пропускная способность и масштабирование до миллионов потоков в полностью управляемой службе Azure.
 
Load Balancer уровня "Стандартный" может перенаправлять трафик в любой экземпляр виртуальной машины в виртуальной сети в регионе. Внутренний пул может вмещать до 1000 экземпляров с любой комбинацией следующих сценариев виртуальных машин:

- автономные виртуальные машины без групп доступности;
- автономные виртуальные машины с группами доступности;
- масштабируемые наборы виртуальных машин (до 1000 экземпляров);
- множество масштабируемых наборов виртуальных машин;
- смешение виртуальных машин и масштабируемых наборов виртуальных машин.

Группы доступности теперь не обязательны. Тем не менее их можно использовать для получения других преимуществ, которые они предоставляют.

### <a name = "diagnosticinsights"></a>Аналитика диагностики

Load Balancer уровня "Стандартный" предоставляет новые многомерные возможности диагностики общедоступных и внутренних конфигураций Load Balancer. Эти новые метрики предоставляются посредством Azure Monitor (предварительная версия) и используют все соответствующие возможности, включая возможность интеграции с нисходящими объектами-получателями.

| Метрика | ОПИСАНИЕ |
| --- | --- |
| Доступность виртуального IP-адреса | Load Balancer уровня "Стандартный" непрерывно использует путь к данным из региона ко внешнему интерфейсу Load Balancer, а затем в стек SDN, поддерживающий виртуальную машину. Пока остаются работоспособные экземпляры, измерение выполняется по тому же пути, что и трафик приложения с балансировкой нагрузки. Проверяется также путь к данным, который могут использовать ваши клиенты. Измерение является невидимым для приложения и не влияет на работоспособность других операций.|
| Доступность выделенного IP-адреса (DIP) | Load Balancer уровня "Стандартный" использует распределенную службу проверки работоспособности, которая контролирует состояние конечной точки приложения в соответствии с параметрами конфигурации. Эта метрика обеспечивает агрегированное или отфильтрованное представление для каждой отдельной конечной точки экземпляра в пуле Load Balancer.  Вы можете видеть, как Load Balancer просматривает работоспособность вашего приложения, как указано в конфигурации зонда работоспособности.
| Пакеты SYN | Load Balancer уровня "Стандартный" не прерывает TCP-подключения и не взаимодействует с потоками пакетов TCP и UDP. Потоки и их подтверждения всегда происходят между источником и экземпляром виртуальной машины. Чтобы оптимизировать устранение неполадок для всех сценариев протокола TCP, вы можете использовать счетчики пакетов SYN. С их помощью можно определить число попыток подключения TCP. Эта метрика указывает количество принятых пакетов TCP SYN.|
| Подключения SNAT | Load Balancer уровня "Стандартный" передает число замаскированных исходящих потоков к интерфейсной части общедоступного IP-адреса. SNAT-порты являются ограниченным ресурсом. Эта метрика может дать представление о том, насколько сильно ваше приложение зависит от SNAT для исходящих потоков.  Выводятся данные счетчиков для успешного и неудачного выполнения исходящих потоков SNAT. Эти данные помогают устранять неполадки и определять работоспособность исходящих потоков.|
| Счетчики байтов | Load Balancer уровня "Стандартный" передает количество данных, обработанных каждым внешним интерфейсом.|
| Счетчики пакетов | Load Balancer уровня "Стандартный" передает количество пакетов, обработанных каждым внешним интерфейсом.|

### <a name = "highreliability"></a>Высокая надежность

Настройте правила балансировки нагрузки, чтобы масштабировать приложение и сделать его более надежным. Можно настроить правила для отдельных портов или использовать порты HA для распределения всего трафика независимо от номера порта TCP или UDP.  

Можно использовать новую функцию "Порты высокой доступности" для разблокирования различных сценариев, включая высокую доступность и масштабирование внутренних сетевых виртуальных устройств. Эта функция также полезна для других сценариев, где нецелесообразно или нежелательно указывать отдельные порты. Порты высокой доступности обеспечивают избыточность и масштабирование, позволяя использовать необходимое количество экземпляров. Конфигурация больше не ограничивается активными и пассивными сценариями. Конфигурации зонда работоспособности защищают вашу службу, перенаправляя трафик только на рабочие экземпляры.

Поставщики виртуальных сетевых модулей могут предложить полностью поддерживаемые производителем отказоустойчивые сценарии для своих клиентов. Единая точка отказа удаляется, что позволяет масштабировать до нескольких активных экземпляров. Можно масштабировать до двух или более экземпляров, если ваше устройство допускает такие конфигурации. Дополнительные рекомендации для этих сценариев можно получить у поставщика виртуальных сетевых модулей.

### <a name = "availabilityzones"></a>Зоны доступности

[!INCLUDE [availability-zones-preview-statement](../../includes/availability-zones-preview-statement.md)]

Используя зоны доступности в поддерживаемых регионах, можно повысить отказоустойчивость вашего приложения. Зоны доступности в настоящее время находятся в режиме предварительной версии в определенных регионах и требуют дополнительной настройки.

### <a name="automatic-zone-redundancy"></a>Автоматическая избыточность в пределах зоны

Можно выбрать, должен ли Load Balancer предоставлять внешний интерфейс с избыточностью в пределах зоны или зональный внешний интерфейс для каждого из ваших приложений. С помощью Load Balancer уровня "Стандартный" можно легко создать избыточность в пределах зоны. Один интерфейсный IP-адрес по умолчанию является избыточным в пределах зоны. Внешний интерфейс с избыточностью в пределах зоны обслуживается всеми зонами доступности в регионе одновременно. При этом создается резервный путь к данным с избыточностью в пределах зоны для входящих и исходящих подключений. Для избыточности в пределах зоны в Azure не требуется несколько IP-адресов и записей DNS. 

Такая избыточность доступна для общедоступных и внутренних интерфейсов. Ваш общедоступный IP-адрес, а также частный интерфейсный IP-адрес внутреннего Load Balancer могут быть избыточными в пределах зоны.

Используйте следующий скрипт для создания общедоступного IP-адреса, избыточного в пределах зоны, для внутреннего Load Balancer. Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
```

Используйте следующий скрипт для создания IP-адреса внешнего интерфейса внутреннего Load Balancer, избыточного в пределах зоны. Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zone_redundant_frontend",
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

Если общедоступный IP-адрес внешнего интерфейса является избыточным в пределах зоны, любые исходящие подключения, установленные экземплярами виртуальных машин, автоматически становятся избыточными в пределах зоны. Внешний интерфейс защищен от сбоев зоны. Назначение портов SNAT также сохраняется при сбое зоны.

#### <a name="cross-zone-load-balancing"></a>Распределение нагрузки между зонами

Распределение нагрузки между зонами доступно в пределах региона для серверного пула, что обеспечивает максимальную гибкость экземпляров виртуальной машины. Внешний интерфейс может передавать потоки любой виртуальной машине в виртуальной сети независимо от зоны доступности экземпляра виртуальной машины.

Можно также указать определенную зону для серверных и интерфейсных экземпляров, чтобы сопоставить ваш путь к данным и ресурсы с определенной зоной.

Виртуальные сети и подсети никогда не ограничены зоной. Все, что нужно сделать, — это задать серверный пул с нужными экземплярами виртуальной машины.

#### <a name="zonal-deployments"></a>Зональные развертывания

При необходимости также можно сопоставить внешний интерфейс балансировщика нагрузки с определенной зоной, указав внешний интерфейс зоны. Внешний интерфейс зоны обслуживается только единственной назначенной зоной доступности. При сочетании с экземплярами виртуальной машины зоны можно сопоставить ресурсы с определенными зонами.

Общедоступный IP-адрес, созданный в определенной зоне, всегда существует только в этой зоне. Невозможно изменить зону общедоступного IP-адреса. Для общедоступного IP-адреса, который может быть прикреплен к ресурсам в нескольких зонах, создайте избыточный в пределах зоны общедоступный IP-адрес.

Создайте зональный общедоступный IP-адрес в зоне доступности 1, используя приведенный ниже скрипт. Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "zones": [ "1" ],
            "sku":
            {
                "name": "Standard"
            },
```

Создайте внешний интерфейс внутреннего Load Balancer в зоне доступности 1, используя приведенный ниже скрипт.

Если вы используете существующие шаблоны Resource Manager в конфигурации, добавьте раздел **sku** в эти шаблоны. Кроме того, задайте свойство **zones** в IP-конфигурации внешнего интерфейса дочернего ресурса.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "zonal_frontend_in_az1",
                        "zones": [ "1" ],
                        "properties": {
                            "subnet": {
                                "Id": "[variables('subnetRef')]"
                            },
                            "privateIPAddress": "10.0.0.6",
                            "privateIPAllocationMethod": "Static"
                        }
                    },
                ],
```

Добавьте распределение нагрузки между зонами для серверного пула, разместив экземпляры виртуальной машины в виртуальную сеть внутри пула.

Ресурс Load Balancer уровня "Стандартный" всегда является региональным и избыточным в пределах зоны, когда поддерживаются зоны доступности. Общедоступный IP-адрес или внешний интерфейс внутреннего Load Balancer, который не был назначен зоне, может быть развернут в любом регионе. Поддержка зон доступности не влияет на возможность развертывания. Если в регионе снова появятся зоны доступности, уже развернутые общедоступные IP-адреса или внешние интерфейсы внутреннего Load Balancer автоматически становятся избыточными в пределах зоны. Избыточный в пределах зоны путь к данным не подразумевает полное отсутствие потери пакетов.

### <a name = "nsg"></a>Группы безопасности сети

Теперь требуется полное подключение Load Balancer уровня "Стандартный" и общедоступного стандартного IP-адреса к виртуальной сети, что требует использования групп безопасности сети. Группа безопасности сети позволяет использовать список разрешенных потоков трафика. С помощью групп безопасности сети можно получить полный контроль над трафиком в развертывании. Больше не нужно ожидать завершения других потоков трафика.

Свяжите группу безопасности сети с подсетями или сетевыми адаптерами экземпляров виртуальной машины в серверном пуле. Эту конфигурацию можно применять с Load Balancer уровня "Стандартный" и общедоступным стандартным IP-адресом при использовании в качестве общедоступного IP-адреса уровня экземпляра. Для группы безопасности сети необходимо явно указать в списке разрешений трафик, который вы хотите разрешить.

Дополнительные сведения о группах безопасности сети и способах их применения в вашем сценарии см. в статье [Фильтрация сетевого трафика с помощью групп безопасности сети](../virtual-network/virtual-networks-nsg.md).

### <a name ="outboundconnections"></a>Исходящие подключения

Load Balancer уровня "Стандартный" обеспечивает исходящие подключения для виртуальных машин внутри виртуальной сети, когда он использует SNAT с маскированием портов. Алгоритм SNAT с маскированием портов обеспечивает повышенную надежность и масштабируемость.

Когда общедоступный ресурс Load Balancer связан с экземплярами виртуальной машины, источник каждого исходящего подключения перезаписывается. Источник перезаписывается из частного IP-адреса виртуальной сети в общедоступный IP-адрес внешнего интерфейса Load Balancer.

При использовании с внешним интерфейсом, избыточным в пределах зоны, исходящие соединения также являются избыточными в пределах зоны, а распределения портов SNAT выдерживают сбои зоны.

Новый алгоритм Load Balancer уровня "Стандартный" выделяет порты SNAT для сетевого интерфейса каждой виртуальной машины. При добавлении сетевого интерфейса в пул порты SNAT предварительно выделяются исходя из размера пула. В следующей таблице показаны выделенные порты для шести размеров внутреннего пула:

| Размер пула (экземпляры виртуальных машин) | Предварительно выделенное число портов SNAT |
| --- | --- |
| 1–50 | 1024 |
| 51–100 | 512 |
| 101–200 | 256 |
| 201–400 | 128 |
| 401–800 | 64 |
| 801–1000 | 32 |

Порты SNAT не относятся напрямую к числу исходящих подключений. Порт SNAT могут использоваться повторно для нескольких уникальных назначений. Дополнительные сведения см. в статье [Общие сведения об исходящих подключениях в Azure](load-balancer-outbound-connections.md).

Если серверный пул будет увеличен и перейдет на уровень большего размера, половина ваших выделенных портов будет освобождена. Время ожидания подключений, связанных с освобожденным портом, истечет, и их нужно будет установить повторно. Новые попытки подключения будут немедленно выполнены. Если размер серверного пула уменьшается с размера одного уровня до следующего размера, количество доступных портов SNAT растет. В этом случае существующие подключения не затрагиваются.

Load Balancer уровня "Стандартный" также имеет дополнительный вариант конфигурации, который можно использовать для каждого правила. Можно управлять внешним интерфейсом, используемым для подключений SNAT с маскированием портов, когда доступны несколько внешних интерфейсов.

Если только Load Balancer уровня "Стандартный" обслуживает экземпляры виртуальных машин, исходящие подключения SNAT недоступны. Можно явно восстановить эту возможность, назначив экземпляры виртуальной машины общедоступному Load Balancer. Можно также напрямую назначить общедоступные IP-адреса в качестве общедоступных IP-адресов уровня экземпляра каждому экземпляру виртуальной машины. Этот вариант конфигурации может потребоваться для некоторых сценариев операционных систем и приложений. 

### <a name="port-forwarding"></a>Перенаправление портов

Load Balancer уровня "Стандартный" и "Базовый" предоставляют возможность настраивать входящие правила NAT для сопоставления интерфейсного порта с отдельным серверным экземпляром. Настроив эти правила, можно предоставить конечные точки протокола удаленного рабочего стола и конечные точки SSH или выполнить другие сценарии приложений.

Load Balancer уровня "Стандартный" обеспечивает возможность переадресации портов через входящие правила NAT. При использовании с внешними интерфейсами, избыточными в пределах зоны, входящие правила NAT становятся избыточными в пределах зоны и выдержат сбой зоны.

### <a name="multiple-front-ends"></a>Несколько внешних интерфейсов

Настройте несколько внешних интерфейсов для гибкости структуры, когда приложениям требуется несколько отдельных IP-адресов (например, веб-сайты TLS или конечные точки группы доступности SQL AlwaysOn). 

Load Balancer уровня "Стандартный" предоставляет несколько внешних интерфейсов там, где необходимо предоставить конечную точку приложения с уникальным IP-адресом.

Дополнительные сведения о настройке нескольких IP-адресов внешних интерфейсов см. в статье [Несколько виртуальных IP-адресов для Azure Load Balancer](load-balancer-multivip-overview.md).

## <a name = "sku"></a>О номерах SKU

Номера SKU доступны при использовании модели развертывания с помощью Azure Resource Manager. Эта предварительная версия предоставляет два номера SKU для Load Balancer и ресурсов общедоступного IP-адреса: уровня "Базовый" и "Стандартный". Номера SKU отличаются способностями, характеристиками производительности, ограничениями и некоторыми внутренними реакциями на событие. Виртуальные машины можно использовать с любым номером SKU. Для ресурсов Load Balancer и ресурсов общедоступного IP-адреса номера SKU остаются необязательными атрибутами. Когда номера SKU не указаны в определении сценария, по умолчанию конфигурация использует номер SKU уровня "Базовый".

>[!IMPORTANT]
>Номер SKU ресурса неизменяемый. Вы не можете изменить номер SKU существующего ресурса.  

### <a name="load-balancer"></a>Подсистема балансировки нагрузки

[Существующий ресурс Load Balancer](load-balancer-overview.md) переходит на номер SKU уровня "Базовый" и остается в общедоступной версии без изменений.

Номер SKU уровня "Стандартный" Load Balancer является новым предложением и в настоящее время находится в предварительной версии. В версии API от 1 августа 2017 г. для Microsoft.Network/loadBalancers к определению ресурса добавлено свойство **sku**.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/loadBalancers",
            "name": "load_balancer_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
```
При использовании в регионе, который предлагает зоны доступности, Load Balancer уровня "Стандартный" автоматически становится отказоустойчивым в зоне. Если Load Balancer объявлен зональным, он не становится отказоустойчивым в зоне автоматически.

### <a name="public-ip"></a>Общедоступный IP-адрес

[Существующий общедоступный IP-ресурс](../virtual-network/virtual-network-ip-addresses-overview-arm.md) переходит на номер SKU уровня "Базовый" и остается в общедоступной версии со всеми его возможностями, характеристиками производительности и ограничениями.

Номер SKU уровня "Стандартный" общедоступного IP-адреса является новым и в настоящее время находится в предварительной версии. В версии API от 1 августа 2017 г. для Microsoft.Network/publicIPAddresses к определению ресурса добавлено свойство **sku**.

```json
            "apiVersion": "2017-08-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "public_ip_standard",
            "location": "region",
            "sku":
            {
                "name": "Standard"
            },
```

В отличие от общедоступного IP-адреса уровня "Базовый", который предлагает несколько методов распределения, общедоступный IP-адрес уровня "Стандартный" всегда предусматривает статическое распределение.

При использовании в регионе, который предлагает зоны доступности, общедоступный IP-адрес уровня "Стандартный" автоматически становится отказоустойчивым в зоне. Если общедоступный IP-адрес объявлен зональным, он не становится отказоустойчивым в зоне автоматически. Невозможно изменить зоны зональных общедоступных IP-адресов.

## <a name="migration-between-skus"></a>Переход между номерами SKU

Номера SKU неизменяемы. Если вы хотите перейти с одного номера SKU ресурса на другой, выполните следующие действия.

### <a name="migrate-from-basic-to-standard-sku"></a>Переход с номера SKU "Базовый" на "Стандартный"

1. Создайте ресурс уровня "Стандартный" (Load Balancer и общедоступные IP-адреса по мере необходимости). Заново создайте свои правила и определения зонда.

2. Удалите ресурсы номера SKU уровня "Базовый" (общедоступные IP-адреса и Load Balancer) для всех экземпляров виртуальной машины. Не забудьте также удалить все экземпляры виртуальной машины группы доступности.

3. Подключите все экземпляры виртуальной машины к новому ресурсу с номером SKU уровня "Стандартный".

### <a name="migrate-from-standard-to-basic-sku"></a>Переход с номера SKU "Стандартный" на "Базовый"

1. Создайте ресурс уровня "Базовый" (Load Balancer и общедоступные IP-адреса по мере необходимости). Заново создайте свои правила и определения зонда. 

2. Удалите ресурсы номера SKU уровня "Стандартный" (общедоступные IP-адреса и Load Balancer) для всех экземпляров виртуальной машины. Не забудьте также удалить все экземпляры виртуальной машины группы доступности.

3. Подключите все экземпляры виртуальной машины к новому ресурсу с номером SKU уровня "Базовый".

>[!IMPORTANT]
>
>Существуют ограничения на использование номеров SKU "Стандартный" и "Базовый".
>
>Порты высокой доступности и диагностика номера SKU уровня "Стандартный" доступны только в номерах SKU уровня "Стандартный". Нельзя перейти с уровня "Стандартный" на уровень "Базовый" и сохранить эту функциональность.
>
>Необходимо использовать соответствующие номера SKU для Load Balancer и общедоступных IP-ресурсов. Невозможно объединить ресурсы номера SKU уровня "Базовый" и "Стандартный". Невозможно подключить виртуальную машину, виртуальные машины в группе доступности или масштабируемый набор виртуальных машин к обоим SKU одновременно.
>

## <a name="region-availability"></a>Регионы доступности

Load Balancer уровня "Стандартный" сейчас доступен во всех регионах общедоступного облака.

>[!IMPORTANT]
> На короткий промежуток времени для доступа к регионам за пределами регионов первого запуска (восточная часть США 2, центральная часть США, Северная Европа, западно-центральная часть США, Западная Европа, Юго-Восточная Азия) требуется регистрация дополнительных функций подписки (AllowLBPreviewWave2 и AllowLBPreviewWave3).  [Выполните следующие действия](#additionalpreviewregions). Выполните все действия, даже если вы уже зарегистрировались для AllowLBPreview.
> Это требование будет удалено в ближайшие недели.

## <a name="sku-service-limits-and-abilities"></a>Сравнение ограничений и возможностей служб номеров SKU

[Ограничения служб для работы в сети](https://docs.microsoft.com/azure/azure-subscription-service-limits#networking-limits) Azure применяются к каждому региону для каждой подписки. 

В следующей таблице представлено сравнение ограничений и возможностей номеров SKU уровней "Стандартный" и "Базовый" для Load Balancer:

| Подсистема балансировки нагрузки | базовая; | Стандартная |
| --- | --- | --- |
| Размер серверного пула | До 100 | До 1000 |
| Граница серверного пула | Группа доступности | Виртуальная сеть, регион |
| Структура серверного пула | Виртуальные машины в наборе доступности или масштабируемом наборе виртуальных машин в наборе доступности | Любой экземпляр виртуальной машины в виртуальной сети |
| Порты HA | Не поддерживается | Доступна |
| Диагностика | Ограниченные, только общедоступные | Доступна |
| Доступность виртуального IP-адреса  | Не поддерживается | Доступна |
| Быстрые операции мобильности с IP-адресом | Не поддерживается | Доступна |
|Сценарии зон доступности | Только зональные | Зональные, избыточные в пределах зоны, распределение нагрузки между зонами |
| Алгоритм исходящих SNAT-подключений | По запросу | Выделенный |
| Выбор интерфейса исходящих SNAT-подключений | Недоступно для настройки, несколько вариантов | Дополнительная настройка для уменьшения вариантов |
| Группа безопасности сети | Необязательно для сетевого адаптера и подсети | Обязательно |

В следующей таблице представлено сравнение ограничений и возможностей номеров SKU уровней "Стандартный" и "Базовый" для общедоступного IP-адреса:

| Общедоступный IP-адрес | базовая; | Стандартная |
| --- | --- | --- |
| Сценарии зон доступности | Только зональные | Избыточные в пределах зоны (по умолчанию), зональные (необязательно) | 
| Быстрые операции мобильности с IP-адресом | Не поддерживается | Доступна |
| Доступность виртуального IP-адреса | Не поддерживается | Доступна |
| Counters | Не поддерживается | Доступна |
| Группа безопасности сети | Необязательно для сетевого адаптера | Обязательно |


## <a name="preview-sign-up"></a>Регистрация в предварительной версии

Чтобы зарегистрироваться в предварительной версии Load Balancer с номером SKU уровня "Стандартный" и версии общедоступного IP-адреса с номером SKU уровня "Стандартный", зарегистрируйте свою подписку.  Регистрация дает возможность получить доступ, используя PowerShell или Azure CLI 2.0. Чтобы зарегистрироваться, выполните приведенные ниже действия.

>[!NOTE]
>Регистрация компонента Load Balancer уровня "Стандартный" вступит в силу повсеместно где-то в течение часа. Если вы хотите использовать Load Balancer уровня "Стандартный" с функциями [Зоны доступности](https://aka.ms/availabilityzones), для предварительных версий AZ требуется [отдельная регистрация](https://aka.ms/availabilityzones).

<a name="additionalpreviewregions"></a>
>[!IMPORTANT]
> На короткий промежуток времени для доступа к регионам за пределами регионов первого запуска (восточная часть США 2, центральная часть США, Северная Европа, западно-центральная часть США, Западная Европа, Юго-Восточная Азия) требуется регистрация дополнительных функций подписки (AllowLBPreviewWave2 и AllowLBPreviewWave3).  Приведенные ниже действия были изменены для включения дополнительных функций подписки. Выполните все действия, даже если вы уже зарегистрировались для AllowLBPreview. Это требование будет удалено в ближайшие недели.


### <a name="sign-up-by-using-azure-cli-20"></a>Регистрация с помощью Azure CLI 2.0

1. Зарегистрируйтесь для использования функции в поставщике:

    ```cli
    az feature register --name AllowLBPreview --namespace Microsoft.Network
    az feature register --name AllowLBPreviewWave2 --namespace Microsoft.Network
    az feature register --name AllowLBPreviewWave3 --namespace Microsoft.Network
    ```
    
2. Выполнение операции может занять до 10 минут. Состояние операции можно проверить, выполнив следующую команду:

    ```cli
    az feature list --query "[?name=='Microsoft.Network/AllowLBPreview']" --output json
    az feature list --query "[?name=='Microsoft.Network/AllowLBPreviewWave2']" --output json
    az feature list --query "[?name=='Microsoft.Network/AllowLBPreviewWave3']" --output json
    ```
    
    Для каждой из приведенных выше дополнительных функций подписки после завершения регистрации функции перейдите к следующему шагу. Пример:
   
    ```json
    {
       "id": "/subscriptions/foo/providers/Microsoft.Features/providers/Microsoft.Network/features/AllowLBPreview",
       "name": "Microsoft.Network/AllowLBPreview",
       "properties": {
          "state": "Registered"
       },
       "type": "Microsoft.Features/providers/features"
    }
    ```
    
4. Завершите процесс регистрации в предварительной версии, выполнив повторную регистрацию подписки в поставщике ресурсов.

    ```cli
    az provider register --namespace Microsoft.Network
    ```
    

### <a name="sign-up-by-using-powershell"></a>Регистрация с помощью PowerShell

1. Зарегистрируйтесь для использования функции в поставщике:

    ```powershell
    Register-AzureRmProviderFeature -FeatureName AllowLBPreview -ProviderNamespace Microsoft.Network
    Register-AzureRmProviderFeature -FeatureName AllowLBPreviewWave2 -ProviderNamespace Microsoft.Network
    Register-AzureRmProviderFeature -FeatureName AllowLBPreviewWave3 -ProviderNamespace Microsoft.Network
    ```
    
2. Выполнение операции может занять до 10 минут. Состояние операции можно проверить, выполнив следующую команду:

    ```powershell
    Get-AzureRmProviderFeature -FeatureName AllowLBPreview -ProviderNamespace Microsoft.Network
    Get-AzureRmProviderFeature -FeatureName AllowLBPreviewWave2 -ProviderNamespace Microsoft.Network
    Get-AzureRmProviderFeature -FeatureName AllowLBPreviewWave3 -ProviderNamespace Microsoft.Network
    ```

  Для каждой из приведенных выше дополнительных функций подписки после завершения регистрации функции перейдите к следующему шагу. Пример:

    ```
    FeatureName      ProviderName        RegistrationState
    -----------      ------------        -----------------
    AllowLBPreview   Microsoft.Network   Registered
    ```
    
3. Завершите процесс регистрации в предварительной версии, выполнив повторную регистрацию подписки в поставщике ресурсов.

    ```powershell
    Register-AzureRmResourceProvider -ProviderNamespace Microsoft.Network
    ```
 
## <a name="pricing"></a>Цены

Выставление счетов за использование Load Balancer уровня "Стандартный" выполняется на основе настроенных правил и обработанных данных. Во время использования предварительной версии плата не взимается. Для получения дополнительной информации просмотрите страницы расценок на [Load Balancer](https://aka.ms/lbpreviewpricing) и [общедоступный IP-адрес](https://aka.ms/lbpreviewpippricing).

Клиенты продолжат пользоваться преимуществами Load Balancer с номером SKU уровня "Стандартный" без оплаты.

## <a name="limitations"></a>Ограничения

Следующие ограничения применяются во время использования предварительной версии и могут быть изменены.

- Сейчас серверные экземпляры Load Balancer невозможно размещать в пиринговых виртуальных сетях. Все серверные экземпляры должны быть в одном регионе.
- Номера SKU неизменяемы. Вы не можете изменить номер SKU существующего ресурса.
- Номера SKU уровня "Базовый" или "Стандартный" можно использовать с автономной виртуальной машиной, экземплярами виртуальной машины в группе доступности или масштабируемым набором виртуальных машин. Сочетания виртуальных машин нельзя использовать одновременно с обоими уровнями номеров SKU. Конфигурации, которые содержат сочетание номеров SKU, не поддерживаются.
- Использование внутреннего Load Balancer уровня "Стандартный" с экземпляром виртуальной машины (или любой частью набора доступности) отключает [исходящие подключения SNAT по умолчанию](load-balancer-outbound-connections.md). Вы можете восстановить эту возможность для автономных виртуальных машин, экземпляров виртуальных машин в группах доступности либо масштабируемых наборов виртуальных машин. Можно также восстановить возможность выполнять исходящие подключения. Чтобы восстановить эти возможности, одновременно назначьте общедоступный Load Balancer уровня "Стандартный" или общедоступный IP-адрес уровня "Стандартный" в качестве общедоступного IP-адреса уровня экземпляра тому же экземпляру виртуальной машины. После завершения назначения подключения SNAT для маскирования портов будут снова предоставляться для общедоступного IP-адреса.
- Например, экземпляры виртуальных машин могут быть сгруппированы в группы доступности для максимального масштабирования серверного пула. В один серверный пул можно поместить до 150 групп доступности и автономных виртуальных машин.
- IPv6 не поддерживается.
- В рамках зон доступности внешний интерфейс не может изменяться с зонального на избыточный в пределах зоны или наоборот. Если внешний интерфейс создан как избыточный в пределах зоны, он остается таким. Если он создан как зональный, он также не изменяется.
- В контексте зон доступности зональный общедоступный IP-адрес не может перемещаться из одной зоны в другую.
- [Оповещения Azure Monitor](../monitoring-and-diagnostics/monitoring-overview-alerts.md) сейчас не поддерживаются.
- На портале еще не поддерживаются развернутые регионы, в которых действует предварительная версия.  Используйте клиентские средства, такие как шаблоны, Azure CLI 2.0 или PowerShell в качестве обходного пути.


## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения об [Azure Load Balancer уровня "Базовый"](load-balancer-overview.md).
- Дополнительные сведения о [зонах доступности](../availability-zones/az-overview.md)
- Узнайте больше о [группах безопасности сети](../virtual-network/virtual-networks-nsg.md).
- Дополнительные сведения о некоторых других ключевых [сетевых возможностях](../networking/networking-overview.md) Azure.
- Узнайте [о метриках](../monitoring-and-diagnostics/monitoring-supported-metrics.md#microsoftnetworkloadbalancers) в [Azure Monitor](../monitoring-and-diagnostics/monitoring-overview.md).
