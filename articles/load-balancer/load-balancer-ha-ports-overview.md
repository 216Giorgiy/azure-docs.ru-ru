---
title: "Общие сведения о портах с высоким уровнем доступности в Azure | Документация Майкрософт"
description: "Сведения о балансировке нагрузки в портах с высоким уровнем доступности внутренней подсистемы балансировки нагрузки."
services: load-balancer
documentationcenter: na
author: rdhillon
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/26/2017
ms.author: kumud
ms.openlocfilehash: 3e54cb45cf002a183a5b0bd9b3082a235cd825f8
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="high-availability-ports-overview-preview"></a>Общие сведения о портах с высоким уровнем доступности (предварительная версия)

При использовании номеров SKU уровня "Стандартный" в Azure Load Balancer доступны порты с высоким уровнем доступности — возможность распределять трафик со всех портов и для всех поддерживаемых протоколов. При настройке внутренней подсистемы балансировки нагрузки пользователи могут задать правила портов с высоким уровнем доступности. При этом они могут **заблокировать** интерфейсные и внутренние порты и разрешить **все** протоколы, за счет чего весь трафик будет проходить через внутреннюю подсистему балансировки нагрузки.

>[!NOTE]
> Компонент "Порты с высоким уровнем доступности" доступен в Load Balancer уровня "Стандартный" в режиме предварительной версии. В период действия предварительной версии эта функция может не отличаться таким же уровнем доступности и надежности, как функции, предоставляемые в общедоступной версии. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Чтобы использовать порты с высоким уровнем доступности с ресурсами службы Load Balancer уровня "Стандартный", необходимо зарегистрироваться для получения предварительной версии этой службы. Выполните также инструкции по регистрации в дополнение к регистрации для использования [предварительной версии](https://aka.ms/lbpreview#preview-sign-up) Load Balancer уровня "Стандартный".

Алгоритм балансировки нагрузки по-прежнему остается таким же. Назначение определяется на основе пяти показателей: исходный IP-адрес, исходный порт, конечный IP-адрес, конечный порт, протокол. Однако эта конфигурация обеспечивает обработку всего трафика на основе одного правила балансировки нагрузки, а также уменьшает сложность конфигурации и устраняет все ограничения, наложенные максимальным количеством правил балансировки нагрузки, которые может добавить пользователь.

Один из важнейших сценариев, поддерживаемых портами с высоким уровнем доступности, заключается в развертывании с высоким уровнем доступности сетевых виртуальных модулей в виртуальных сетях Azure. Кроме того, эти порты поддерживают сценарий балансировка нагрузки в диапазоне портов. 

## <a name="why-use-high-ha-ports"></a>Причины использования портов с высоким уровнем доступности

Клиенты Azure полагаются на сетевые виртуальные модули при защите рабочих нагрузок от нескольких типов угроз. Кроме того, сетевые виртуальные модули должны быть надежными и иметь высокий уровень доступности.  

Порты с высоким уровнем доступности уменьшают сложность сценариев реализации сетевых виртуальных модулей с высоким уровнем доступности, так как они устраняют необходимость в использовании более сложных решений, например zookeeper, а также повышают надежность за счет более быстрой отработки отказа и параметров горизонтального масштабирования. Теперь, чтобы реализовать высокий уровень доступности сетевых виртуальных модулей, их можно добавить в серверный пул внутренней подсистемы балансировки нагрузки Azure, а затем настроить правила балансировки нагрузки в портах с высоким уровнем доступности.

На рисунке ниже представлена схема развертывания виртуальной сети со звездообразным подключением. В этом примере трафик из периферийных зон перед выходом из доверенного пространства принудительно туннелируется в центральную виртуальную сеть через сетевой виртуальный модуль. Сетевые виртуальные модули расположены за пределами внутренней подсистемы балансировки нагрузки с портами с высоким уровнем доступности. Поэтому они могут должным образом обрабатывать и перенаправлять весь трафик. 

![Пример портов с высоким уровнем доступности](./media/load-balancer-ha-ports-overview/nvaha.png)

Рис. 1. Виртуальная сеть со звездообразным подключением и сетевыми виртуальными модулями в режиме высокой доступности


## <a name="region-availability"></a>Регионы доступности

Сейчас компонент "Порты с высоким уровнем доступности" доступен в следующих регионах:
- Восток США 2
- Центральный регион США
- Северная Европа
- Западно-центральная часть США
- Западная Европа
- Юго-Восточная Азия 

## <a name="preview-sign-up"></a>Регистрация в предварительной версии

Чтобы зарегистрироваться в предварительной версии компонента "Порты с высоким уровнем доступности" в Load Balancer с номером SKU уровня "Стандартный", зарегистрируйте свою подписку, чтобы получить доступ, используя PowerShell или Azure CLI 2.0.

- Регистрация с помощью PowerShell

    ```powershell
    Register-AzureRmProviderFeature -FeatureName AllowILBAllPortsRule -ProviderNamespace Microsoft.Network
    ```

- Регистрация с помощью Azure CLI 2.0

    ```cli
    az feature register --name AllowILBAllPortsRule --namespace Microsoft.Network 
    ```  


>[!NOTE]
>Чтобы использовать эту функцию, помимо регистрации для использования компонента "Порты с высоким уровнем доступности" необходимо также зарегистрироваться для получения [предварительной версии](https://aka.ms/lbpreview#preview-sign-up) Load Balancer уровня "Стандартный". На регистрацию для получения предварительных версий компонента "Порты с высоким уровнем доступности" и Load Balancer уровня "Стандартный" может уйти до часа.

## <a name="limitations"></a>Ограничения

Ниже приведены поддерживаемые конфигурации или исключения портов с высоким уровнем доступности.

- Отдельная интерфейсная IP-конфигурация может иметь одно правило подсистемы балансировки нагрузки с прямым ответом от сервера и портами с высоким уровнем доступности (все порты) или одно правило подсистемы балансировки нагрузки без прямого ответа от сервера и с портами с высоким уровнем доступности (все порты). Оба правила применить невозможно.
- Отдельная IP-конфигурация сетевого интерфейса может только иметь одно правило подсистемы балансировки нагрузки без прямого ответа от сервера и с портами с высоким уровнем доступности. Другие правила недоступны в этой конфигурации.
- Отдельная IP-конфигурация сетевого интерфейса может только иметь несколько правил подсистемы балансировки нагрузки с прямым ответом от сервера и портами с высоким уровнем доступности. В этот случае все соответствующие интерфейсные IP-конфигурации уникальные.
- Несколько правил подсистемы балансировки нагрузки, указывающие на тот же серверный пул, могут существовать параллельно, если во всех правилах балансировки нагрузки используются порты с высоким уровнем доступности (только с прямым ответом от сервера) или порты без высокого уровня доступности (с прямым ответом от сервера или без него). Если в двух таких правилах используются разные типы портов, они не могут существовать параллельно.
- Порты с высоким уровнем доступности недоступны в клиентах с поддержкой IPv6.


## <a name="next-steps"></a>Дальнейшие действия

[Настройка портов с высоким уровнем доступности во внутренней подсистеме балансировки нагрузки](load-balancer-configure-ha-ports.md)

