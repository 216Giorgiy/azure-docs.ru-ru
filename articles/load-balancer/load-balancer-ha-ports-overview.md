---
title: "Общие сведения о портах с высоким уровнем доступности в Azure | Документация Майкрософт"
description: "Сведения о балансировке нагрузки в портах с высоким уровнем доступности внутренней подсистемы балансировки нагрузки."
services: load-balancer
documentationcenter: na
author: rdhillon
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/26/2017
ms.author: kumud
ms.openlocfilehash: 62d78e067e50183f25af84e547db2e11c0014f5d
ms.sourcegitcommit: 2d1153d625a7318d7b12a6493f5a2122a16052e0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/20/2017
---
# <a name="high-availability-ports-overview-preview"></a>Общие сведения о портах с высоким уровнем доступности (предварительная версия)

Azure Load Balancer уровня "Стандартный" вводит новую возможность одновременного распределения нагрузки потоков TCP и UDP на всех портах при использовании внутреннего балансировщика нагрузки. 

>[!NOTE]
> Компонент "Порты с высоким уровнем доступности" доступен в Load Balancer уровня "Стандартный" в режиме предварительной версии. В период действия предварительной версии эта функция может не отличаться таким же уровнем доступности и надежности, как функции, предоставляемые в общедоступной версии. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). Чтобы использовать порты с высоким уровнем доступности с ресурсами службы Load Balancer уровня "Стандартный", необходимо зарегистрироваться для получения предварительной версии этой службы. Выполните инструкции по регистрации в дополнение к регистрации для использования [предварительной версии](https://aka.ms/lbpreview#preview-sign-up) Load Balancer уровня "Стандартный".

Правило балансировки нагрузки портов высокой доступности является разновидностью правила балансировки нагрузки, настроенной на внутреннем Load Balancer уровня "Стандартный".  Сценарии упрощены за счет предоставления одного правила балансировки нагрузки для всех потоков TCP и UDP, поступающих на всех портах во внутреннем интерфейсе Load Balancer уровня "Стандартный". Решение о балансировке нагрузки выполняется для каждого потока на основе пяти кортежей: исходного IP-адреса, исходного порта, целевого IP-адреса, порта назначения и протокола.

Порты высокой доступности делают возможными такие критические сценарии, как обеспечение высокой доступности и масштабируемости виртуальных сетевых модулей (NVA) внутри виртуальных сетей, а также другие сценарии, в которых распределение нагрузки требуется для большого количества портов. 

Чтобы настроить порты высокой доступности, нужно задать для внешнего и внутреннего портов значение **0**, а для протокола— **Все**.  Внутренний ресурс балансировки нагрузки теперь распределяет все потоки TCP и UDP, независимо от номера порта.

## <a name="why-use-ha-ports"></a>Причины использования портов высокой доступности

### <a name="network-virtual-appliances"></a>Виртуальные сетевые модули

Виртуальные сетевые модули можно использовать для защиты рабочей нагрузки Azure от различных угроз безопасности. Виртуальные сетевые модули, используемые в таких сценариях, должны быть надежными, высокодоступными и масштабируемыми по запросу.

Для этого просто добавьте экземпляры виртуальных сетевых модулей в серверный пул внутреннего Azure Load Balancer и настройте правило балансировки нагрузки на портах высокой доступности.

Порты высокой доступности обеспечивают ряд преимуществ для сценариев с виртуальными сетевыми устройствами высокой доступности:
- быстрое выполнение отработки отказа в работоспособные экземпляры с выполнением проверок работоспособности для каждого экземпляра;
- более высокая производительность с масштабированием до N активных экземпляров;
- сценарии "N активных" и "активный — пассивный";
- устранение необходимости в сложных решениях, например использованием узлов Zookeeper для мониторинга модулей.

На рисунке ниже представлена схема развертывания виртуальной сети со звездообразным подключением. В этом примере трафик из периферийных зон перед выходом из доверенного пространства принудительно туннелируется в центральную виртуальную сеть через виртуальный сетевой модуль. Виртуальные сетевые модули находятся за внутренним Load Balancer уровня "Стандартный" с конфигурацией портов высокой доступности.  Весь трафик может быть обработан и перенаправлен соответствующим образом. 

![Пример портов с высоким уровнем доступности](./media/load-balancer-ha-ports-overview/nvaha.png)

Рис. 1. Виртуальная сеть со звездообразным подключением и сетевыми виртуальными модулями в режиме высокой доступности

При использовании виртуальных сетевых модулей узнайте у соответствующего поставщика, как лучше всего использовать порты высокой доступности и какие сценарии поддерживаются.

### <a name="load-balancing-large-numbers-of-ports"></a>Балансировка нагрузки для большого количества портов

Можно также использовать порты высокой доступности для сценариев приложений, требующих распределение нагрузки между большим количеством портов. Эти сценарии можно упростить, используя внутренний [Load Balancer уровня "Стандартный"](https://aka.ms/lbpreview) с портами высокой доступности, где одно правило балансировки нагрузки заменяет несколько отдельных правил (по одному для каждого порта).

## <a name="region-availability"></a>Регионы доступности

Порты высокой доступности доступны в [тех же регионах, что и Load Balancer уровня "Стандартный"](https://aka.ms/lbpreview#region-availability).  

## <a name="preview-sign-up"></a>Регистрация в предварительной версии

Чтобы зарегистрироваться в предварительной версии компонента "Порты с высоким уровнем доступности" в Load Balancer уровня "Стандартный", зарегистрируйте свою подписку, чтобы получить доступ, используя Azure CLI 2.0 или PowerShell.  Для этого выполните приведенные ниже три шага.

>[!NOTE]
>Чтобы использовать эту функцию, помимо регистрации для использования компонента "Порты с высоким уровнем доступности" необходимо также зарегистрироваться для получения [предварительной версии](https://aka.ms/lbpreview#preview-sign-up) Load Balancer уровня "Стандартный". На регистрацию для получения предварительных версий компонента "Порты с высоким уровнем доступности" и Load Balancer уровня "Стандартный" может уйти до часа.

### <a name="sign-up-using-azure-cli-20"></a>Регистрация с помощью Azure CLI 2.0

1. Зарегистрируйтесь для использования функции в поставщике.
    ```cli
    az feature register --name AllowILBAllPortsRule --namespace Microsoft.Network
    ```
    
2. Выполнение этой операции может занять до 10 минут.  Состояние операции можно проверить, выполнив следующую команду:

    ```cli
    az feature show --name AllowILBAllPortsRule --namespace Microsoft.Network
    ```
    
    После завершения регистрации функции (возвращается значение "Registered", как показано ниже) перейдите к шагу 3.
   
    ```json
    {
       "id": "/subscriptions/foo/providers/Microsoft.Features/providers/Microsoft.Network/features/AllowLBPreview",
       "name": "Microsoft.Network/AllowILBAllPortsRule",
       "properties": {
          "state": "Registered"
       },
       "type": "Microsoft.Features/providers/features"
    }
    ```
    
3. Завершите процесс регистрации в предварительной версии, выполнив повторную регистрацию подписки в поставщике ресурсов.

    ```cli
    az provider register --namespace Microsoft.Network
    ```
    
### <a name="sign-up-using-powershell"></a>Регистрация с помощью PowerShell

1. Зарегистрируйтесь для использования функции в поставщике.
    ```powershell
    Register-AzureRmProviderFeature -FeatureName AllowILBAllPortsRule -ProviderNamespace Microsoft.Network
    ```
    
2. Выполнение этой операции может занять до 10 минут.  Состояние операции можно проверить, выполнив следующую команду:

    ```powershell
    Get-AzureRmProviderFeature -FeatureName AllowILBAllPortsRule -ProviderNamespace Microsoft.Network
    ```
    После завершения регистрации функции (возвращается значение "Registered", как показано ниже) перейдите к шагу 3.
   
    ```
    FeatureName          ProviderName      RegistrationState
    -----------          ------------      -----------------
    AllowILBAllPortsRule Microsoft.Network Registered
    ```
    
3. Завершите процесс регистрации в предварительной версии, выполнив повторную регистрацию подписки в поставщике ресурсов.

    ```powershell
    Register-AzureRmResourceProvider -ProviderNamespace Microsoft.Network
    ```


## <a name="limitations"></a>Ограничения

Ниже приведены поддерживаемые конфигурации или исключения портов с высоким уровнем доступности.

- Отдельная интерфейсная IP-конфигурация может иметь одно правило подсистемы балансировки нагрузки с прямым ответом от сервера и портами с высоким уровнем доступности или одно правило подсистемы балансировки нагрузки без прямого ответа от сервера и с портами с высоким уровнем доступности. Оба правила применить невозможно.
- Отдельная IP-конфигурация сетевого интерфейса может иметь только одно правило подсистемы балансировки нагрузки без прямого ответа от сервера и с портами с высоким уровнем доступности. Другие правила недоступны в этой конфигурации.
- Отдельная IP-конфигурация сетевого интерфейса может иметь только несколько правил подсистемы балансировки нагрузки с прямым ответом от сервера и портами с высоким уровнем доступности. В этот случае все соответствующие интерфейсные IP-конфигурации уникальные.
- Несколько правил подсистемы балансировки нагрузки, указывающие на тот же серверный пул, могут существовать параллельно, если во всех правилах балансировки нагрузки используются порты с высоким уровнем доступности (только с прямым ответом от сервера) или порты без высокого уровня доступности (с прямым ответом от сервера или без него). Если два таких правилах балансировки нагрузки используют разные типы портов, они не могут существовать параллельно.
- Порты высокой доступности недоступны для IPv6.


## <a name="next-steps"></a>Дальнейшие действия

- [Настройка высокодоступных портов для внутреннего балансировщика нагрузки](load-balancer-configure-ha-ports.md)
- [Обзор Azure Load Balancer уровня "Стандартный" (предварительная версия)](https://aka.ms/lbpreview)

