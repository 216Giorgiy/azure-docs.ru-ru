---
title: Общие сведения о портах с высоким уровнем доступности в Azure | Документация Майкрософт
description: Сведения о распределении нагрузки на портах с высоким уровнем доступности во внутренней подсистеме балансировки нагрузки.
services: load-balancer
documentationcenter: na
author: KumudD
manager: jeconnoc
editor: ''
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/21/2017
ms.author: kumud
ms.openlocfilehash: f6e9dd09558a3485629d5b70dd8b68b292427b18
ms.sourcegitcommit: 5b2ac9e6d8539c11ab0891b686b8afa12441a8f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
# <a name="high-availability-ports-overview"></a>Общие сведения о портах с высоким уровнем доступности

Azure Load Balancer уровня "Стандартный" помогает распределять нагрузку потоков TCP и UDP одновременно на всех портах при использовании внутренней подсистемы балансировки нагрузки. 

Правило балансировки портов с высоким уровнем доступности можно выбрать в качестве правила балансировки нагрузки для внутренней подсистемы Load Balancer уровня "Стандартный". Чтобы упростить использование Load Balancer, укажите единое правило распределения нагрузки для всех потоков TCP и UDP, поступающих на все порты внутренней подсистемы Load Balancer уровня "Стандартный". Решение о распределении нагрузки принимается отдельно для каждого потока. Оно принимается с учетом пяти кортежей: исходного IP-адреса, исходного порта, целевого IP-адреса, целевого порта и протокола.

Порты с высоким уровнем доступности помогают в критически важных сценариях. Например, они обеспечивают высокий уровень доступности и масштабирование для виртуальных сетевых модулей в виртуальных сетях. Они также позволяют распределять нагрузку между большим количеством портов. 

Чтобы настроить компонент портов с высоким уровнем доступности, выберите для серверного и интерфейсного портов значение **0**, а для протокола укажите значение **Все**. После этого внутренний ресурс Load Balancer будет распределять все потоки TCP и UDP независимо от номера порта.

## <a name="why-use-ha-ports"></a>Зачем использовать порты с высоким уровнем доступности

### <a name="nva"></a>Виртуальные сетевые модули

Виртуальные сетевые модули можно использовать для защиты рабочей нагрузки Azure от различных угроз безопасности. Виртуальные сетевые модули, используемые в таких сценариях, должны быть надежными, высокодоступными и масштабируемыми по требованию.

Для этого добавьте экземпляры виртуальных сетевых модулей в серверный пул внутренней службы Azure Load Balancer и настройте правило распределения нагрузки на портах с высоким уровнем доступности.

Порты с высоким уровнем доступности обеспечивают ряд преимуществ для сценариев с виртуальными сетевыми модулями высокой доступности:
- быстрое выполнение отработки отказа в работоспособные экземпляры с выполнением проверок работоспособности для каждого экземпляра;
- более высокая производительность с масштабированием до *N* активных экземпляров;
- сценарии "*N* активных" и "активный — пассивный";
- устранение необходимости в сложных решениях, например в использовании узлов Apache ZooKeeper для мониторинга модулей.

На следующей схеме представлено развертывание виртуальной сети со звездообразным подключением. "Лучи" принудительно туннелируют свой трафик в центральную виртуальную сеть и через виртуальный сетевой модуль перед выходом из доверенного пространства. Виртуальные сетевые модули находятся за внутренней подсистемой Load Balancer уровня "Стандартный" в конфигурации с портами высокого уровня доступности. Весь трафик может обрабатываться и перенаправляться соответствующим образом.

![Схема виртуальной сети со звездообразным подключением и сетевыми виртуальными модулями в режиме высокой доступности](./media/load-balancer-ha-ports-overview/nvaha.png)

>[!NOTE]
> Если вы используете виртуальные сетевые модули, узнайте у соответствующего поставщика, как лучше всего использовать порты высокого уровня доступности и какие сценарии поддерживаются.

### <a name="load-balancing-large-numbers-of-ports"></a>Балансировка нагрузки для большого количества портов

Можно также использовать порты с высоким уровнем доступности для приложений, требующих распределения нагрузки между большим количеством портов. Эти сценарии можно упростить, применив [Load Balancer уровня "Стандартный"](load-balancer-standard-overview.md) с портами высокого уровня доступности. Единое правило распределения нагрузки заменяет несколько отдельных правил для каждого порта балансировки нагрузки.

## <a name="region-availability"></a>Регионы доступности

Функция портов высокого уровня доступности предлагается во всех глобальных регионах Azure.

## <a name="supported-configurations"></a>Поддерживаемые конфигурации

### <a name="one-single-non-floating-ip-non-direct-server-return-ha-ports-configuration-on-the-internal-standard-load-balancer"></a>Конфигурация с портами высокого уровня доступности на базе единого неплавающего IP-адреса (без прямого ответа от сервера) для внутренней подсистемы Load Balancer уровня "Стандартный"

Это самая простая конфигурация для портов высокого уровня доступности. Следующая конфигурация позволяет настроить балансировку нагрузки с портами высокого уровня доступности на одном внешнем IP-адресе.
- При настройке Load Balancer уровня "Стандартный" установите флажок **Порты высокой доступности** в конфигурации правила балансировки нагрузки. 
- При этом для параметра **Плавающий IP-адрес** нужно выбрать значение **Отключено**.

Эта конфигурация не позволяет использовать другие правила балансировки нагрузки на этом же ресурсе Load Balancer, а также другие конфигурации внутреннего ресурса Load Balancer для того же набора экземпляров серверной части.

Но вы можете настроить общедоступный ресурс Load Balancer уровня "Стандартный" для экземпляров серверной части в дополнение к правилу портов высокого уровня доступности.

### <a name="one-single-floating-ip-direct-server-return-ha-ports-configuration-on-the-internal-standard-load-balancer"></a>Конфигурация с портами высокого уровня доступности на базе единого плавающего IP-адреса (с прямым ответом от сервера) для внутренней подсистемы Load Balancer уровня "Стандартный"

Вы можете точно так же настроить для подсистемы балансировки нагрузки правило балансировки нагрузки с **портами высокой доступности** для единой интерфейсной части и **включенным** параметром **Плавающий IP-адрес**. 

Такая конфигурация позволяет использовать дополнительные правила балансировки нагрузки с плавающим IP-адресом и (или) общедоступные ресурсы Load Balancer. Но на основе этой конфигурации нельзя использовать балансировку нагрузки с портами высокого уровня доступности без плавающего IP-адреса.

### <a name="multiple-ha-ports-configurations-on-the-internal-standard-load-balancer"></a>Несколько конфигураций с портами высокого уровня доступности во внутренней подсистеме Load Balancer уровня "Стандартный"

Если для вашего сценария нужны несколько интерфейсов с портами высокого уровня доступности, взаимодействующих с одним пулом серверной части, вы можете использовать такую конфигурацию: 
- для одного внутреннего ресурса Load Balancer уровня "Стандартный" настроить несколько частных внешних IP-адресов;
- настроить несколько правил балансировки нагрузки, для каждого из которых выбран один уникальный внешний IP-адрес;
- для всех правил балансировки нагрузки выбрать вариант **Порты высокой доступности**, а для параметра **Плавающий IP-адрес** выбрать значение **Включено**.

### <a name="internal-load-balancer-with-ha-ports--public-load-balancer-on-the-same-backend-instances"></a>Внутренняя подсистема Load Balancer с портами высокого уровня доступности и общедоступным ресурсом Load Balancer для тех же экземпляров серверной части

Вы можете настроить **один** общедоступный ресурс Load Balancer уровня "Стандартный" для ресурсов серверной части, а также один внутренний ресурс Load Balancer уровня "Стандартный" с портами высокого уровня доступности.

>[!NOTE]
>Эту возможность сейчас можно использовать только через шаблоны Azure Resource Manager, но не на портале Azure.

## <a name="limitations"></a>Ограничения

- Конфигурацию с портами высокого уровня доступности можно использовать только для внутренней подсистемы Load Balancer, но не для общедоступного ресурса Load Balancer.

- Не поддерживается сочетание правила балансировки нагрузки с портами высокого уровня доступности и правила балансировки нагрузки без портов высокого уровня доступности.

- Порты с высоким уровнем доступности недоступны для IPv6.

- Симметрия потока для сценариев виртуальных сетевых модулей поддерживается только одним сетевым интерфейсом. См. описание и схему [виртуальных сетевых модулей](#nva). Но если в вашем сценарии допускается преобразование сетевых адресов назначения, вы можете применить его для правильной передачи ответного трафика от подсистемы Load Balancer к виртуальному сетевому модулю.


## <a name="next-steps"></a>Дополнительная информация

- [Настройка высокодоступных портов для внутренней подсистемы балансировки нагрузки](load-balancer-configure-ha-ports.md)
- [Обзор Azure Load Balancer уровня "Стандартный" (предварительная версия)](load-balancer-standard-overview.md)
