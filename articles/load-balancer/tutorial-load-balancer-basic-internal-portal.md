---
title: Руководство по созданию общедоступного экземпляра Load Balancer уровня "Базовый" с помощью портала Azure | Документация Майкрософт
description: В этом руководстве показано, как создать внутренний экземпляр Load Balancer уровня "Базовый" с помощью портала Azure.
services: load-balancer
documentationcenter: na
author: KumudD
manager: jeconnoc
editor: ''
tags: azure-resource-manager
Customer intent: As an IT administrator, I want to create a load balancer that load balances incoming internet traffic to virtual machines within a specific zone in a region.
ms.assetid: aa9d26ca-3d8a-4a99-83b7-c410dd20b9d0
ms.service: load-balancer
ms.devlang: na
ms.topic: tutorial
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/30/2018
ms.author: kumud
ms.custom: mvc
ms.openlocfilehash: a16e9ad5b72d87614f5d3630e24e6aa36def8c51
ms.sourcegitcommit: ca05dd10784c0651da12c4d58fb9ad40fdcd9b10
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2018
---
# <a name="tutorial-load-balance-internal-traffic-with-basic-load-balancer-to-vms-using-the-azure-portal"></a>Руководство по балансировке нагрузки внутреннего трафика на виртуальных машинах с помощью Load Balancer уровня "Базовый" на портале Azure

Балансировка нагрузки обеспечивает более высокий уровень доступности и масштабирования за счет распределения входящих запросов между несколькими виртуальными машинами. На портале Azure вы можете распределять нагрузку между виртуальными машинами с помощью Load Balancer уровня "Базовый". В этом руководстве показано, как создать сетевые ресурсы, внутренние серверы и внутренний экземпляр Load Balancer уровня "Базовый".

При необходимости инструкции из этого руководства можно выполнить с помощью [Azure CLI](load-balancer-get-started-ilb-arm-cli.md) или [Azure PowerShell](load-balancer-get-started-ilb-arm-ps.md).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу. 

## <a name="sign-in-to-the-azure-portal"></a>Выполните вход на портал Azure.

Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).

## <a name="create-a-virtual-network"></a>Создать виртуальную сеть
1. В верхней левой части экрана щелкните **Создать** > **Сети** > **Виртуальная сеть**, а затем введите следующие значения для виртуальной сети:
    - *myVNet* — для имени виртуальной сети;
    - *myResourceGroupZLB* — для имени существующей группы ресурсов;
    - *myBackendSubnet* — для имени подсети.
2. Щелкните **Создать**, чтобы создать виртуальную сеть.

## <a name="create-a-basic-load-balancer"></a>Создание подсистемы балансировки нагрузки уровня "Базовый"
Создание внутреннего экземпляра Load Balancer с помощью портала.

1. В верхней левой части экрана выберите **Создать ресурс** > **Сети** > **Балансировщик нагрузки**.
2. На странице **Create a load balancer** (Создание подсистемы балансировки нагрузки) введите следующие значения для подсистемы балансировки нагрузки.
    - *myLoadBalancer* — для имени подсистемы балансировки нагрузки.
    - **Внутренний** — для типа подсистемы балансировки нагрузки.
    - **Базовый** — для версии номера SKU.
    - **10.1.0.7** — для статического частного IP-адреса.
    - *myVNet* — для виртуальной сети, которую нужно выбрать из списка существующих сетей.
    - *mySubnet* — для подсети, которую нужно выбрать из списка существующих подсетей.
    - *myResourceGroupILB* — для имени создаваемой группы ресурсов.
3. Щелкните **Создать**, чтобы создать подсистему балансировки нагрузки.
   
    ![Создание балансировщика нагрузки](./media/tutorial-load-balancer-basic-internal-portal/1-load-balancer.png)


## <a name="create-backend-servers"></a>Создание внутренних серверов

В рамках этого разделе вы создадите две виртуальную машины для серверного пула в Load Balancer уровня "Базовый". Затем вы установите на этих виртуальных машинах IIS, чтобы проверить подсистему балансировки нагрузки.

### <a name="create-virtual-machines"></a>Создание виртуальных машин

1. В верхней части экрана слева щелкните **Создать ресурс** > **Вычисления** > **Windows Server 2016 Datacenter**, а затем введите следующие значения для виртуальной машины:
    - *myVM1* — для имени виртуальной машины;        
    - *azureuser* — для имени пользователя учетной записи администратора;   
    - *myResourceGroupZLB* — для параметра **Группа ресурсов**. Установите флажок **Использовать существующую** и выберите элемент *myResourceGroupZLB*.
2. Последовательно выберите **ОК**.
3. Выберите значение **DS1_V2** в качестве размера виртуальной машины и нажмите кнопку **Выбрать**.
4. Введите следующие значения для параметров виртуальной машины.
    - *myAvailabilitySet* — для имени создаваемой группы доступности.
    -  В качестве виртуальной сети выберите *myVNet*.
    - В качестве подсети выберите *myBackendSubnet*.
    - *myNetworkSecurityGroup* — для имени новой группы безопасности сети (брандмауэра), которую необходимо создать.
5. Щелкните **Отключено**, чтобы отключить диагностику загрузки.
6. Нажмите кнопку **ОК**, просмотрите параметры на странице сводки и нажмите кнопку **Создать**.
7. Создайте вторую виртуальную машину с именем *VM2*, группой доступности *myAvailabilityset*, виртуальной сетью *myVnet*, подсетью *myBackendSubnet* и группой безопасности сети *myNetworkSecurityGroup*, выполнив шаги 1–6. 

### <a name="install-iis-and-customize-the-default-web-page"></a>Установка IIS и настройка веб-страницы по умолчанию

1. В меню слева щелкните **Все ресурсы** и выберите в списке ресурсов виртуальную машину **myVM1**, расположенную в группе ресурсов *myResourceGroupILB*.
2. На странице **обзора** щелкните **Подключить**, чтобы подключиться по протоколу RDP к виртуальной машине.
3. Войдите на виртуальную машину.
4. На рабочем столе сервера перейдите к **Средства администрирования Windows**>**Диспетчер сервера**.
5. Запустите на VM1 Windows PowerShell и выполните в нем приведенные ниже команды, чтобы установить сервер IIS и изменить стандартный HTM-файл.
    ```powershell-interactive
    # Install IIS
      Install-WindowsFeature -name Web-Server -IncludeManagementTools
    
    # Remove default htm file
     remove-item  C:\inetpub\wwwroot\iisstart.htm
    
    #Add custom htm file
     Add-Content -Path "C:\inetpub\wwwroot\iisstart.htm" -Value $("Hello World from " + $env:computername)
    ```
5. Закройте RDP-подключение к *myVM1*.
6. Повторите для *myVM2* шаги с 1 по 5, чтобы установить IIS и настроить веб-страницу по умолчанию.

## <a name="create-nsg-rules"></a>Создание правил NSG

В этом разделе вы создаете правила группы безопасности сети (NSG), чтобы разрешить входящие подключения по протоколу HTTP и протоколу удаленного рабочего стола (RDP).

1. В меню слева щелкните **Все ресурсы**, а затем в списке ресурсов выберите группу безопасности сети **myNetworkSecurityGroup**, расположенную в группе ресурсов **myResourceGroupLB**.
2. В разделе **Параметры** щелкните **Правила безопасности для входящего трафика**, а затем — **Добавить**.
3. Введите (выберите) следующие значения для правила безопасности для входящего трафика с именем *myHTTPRule*, чтобы разрешить входящие подключения HTTP через порт 80:
    - *Service Tag* — для **источника**;
    - *Internet* — для **тега службы источника**;
    - *80* — для **диапазонов портов назначения**;
    - *TCP* — для **протокола**;
    - *Разрешить* — для **действия**;
    - *100* — для значения **приоритета**;
    - *myHTTPRule* — для имени;
    - *Разрешить HTTP* — для описания.
4. Последовательно выберите **ОК**.
 
5. Еще раз выполните шаги 2–4, чтобы создать другое правило с именем *myRDPRule*, разрешающее входящее подключение по RDP через порт 3389. Введите (выберите) следующие значения:
    - *Service Tag* — для **источника**;
    - *Internet* — для **тега службы источника**;
    - *3389* — для **диапазонов портов назначения**;
    - *TCP* — для **протокола**;
    - *Разрешить* — для **действия**;
    - *200* — для значения **приоритета**;
    - *myRDPRule* — для имени;
    - *Разрешить RDP* — для описания.

## <a name="create-basic-load-balancer-resources"></a>Создание ресурсов подсистемы балансировки нагрузки уровня "Базовый"

В этом разделе вы настраиваете параметры подсистемы балансировки нагрузки для внутреннего пула адресов и зонда работоспособности, а также указываете правила подсистемы балансировки нагрузки и NAT.


### <a name="create-a-backend-address-pool"></a>Создание внутреннего пула адресов

Для распределения трафика между виртуальными машинами внутренний пул адресов содержит IP-адреса виртуальных сетевых карт, подключенных к балансировщику нагрузки. Создайте внутренний пул адресов *myBackendPool*, куда будут входить виртуальные машины *VM1* и *VM2*.

1. Щелкните **Все ресурсы** в меню слева, а затем из списка ресурсов выберите **myLoadBalancer**.
2. В разделе **Параметры** выберите **Серверные пулы** и нажмите кнопку **Добавить**.
3. На странице **Add a backend pool** (Добавление серверного пула) сделайте следующее:
    - В поле имени внутреннего пула введите *myBackEndPool.
    - Для поля **Сопоставлено с** в раскрывающемся меню щелкните **Группа доступности**.
    - В поле **Группа доступности** выберите **myAvailabilitySet**.
    - Щелкните **Add a target network IP configuration** (Добавить целевую IP-конфигурацию сети), чтобы добавить созданные для серверного пула виртуальные машины (*myVM1*  &  *myVM2*).
    - Последовательно выберите **ОК**.

        ![Добавление в серверный пул адресов ](./media/tutorial-load-balancer-basic-internal-portal/3-load-balancer-backend-02.png)

3. Убедитесь, что в настройках серверного пула подсистемы балансировки нагрузки отображаются обе виртуальные машины (**VM1** и **VM2**).

### <a name="create-a-health-probe"></a>Создание пробы работоспособности

Чтобы подсистема балансировки нагрузки уровня "Базовый" могла следить за состоянием приложения, необходимо настроить зонд работоспособности. Проба работоспособности динамически добавляет или удаляет виртуальные машины из балансировщика нагрузки на основе их ответа на проверки работоспособности. Создайте зонд работоспособности *myHealthProbe*, чтобы отслеживать работоспособность виртуальных машин.

1. Щелкните **Все ресурсы** в меню слева, а затем из списка ресурсов выберите **myLoadBalancer**.
2. В разделе **Параметры** щелкните **Зонды работоспособности** и нажмите кнопку **Добавить**.
3. Для создания зонда работоспособности используйте следующие значения:
    - *myHealthProbe* — для имени зонда работоспособности;
    - **HTTP** — для типа протокола;
    - *80* — для номера порта;
    - *15* — для **интервала** между попытками выполнения зонда (в секундах);
    - *2* — для числа **порога состояния неработоспособности** или последовательных сбоев зонда, которые должны произойти, прежде чем виртуальная машина будет считаться неработоспособной.
4. Последовательно выберите **ОК**.

   ![Добавление пробы](./media/tutorial-load-balancer-basic-internal-portal/4-load-balancer-probes.png)

### <a name="create-a-load-balancer-rule"></a>Создание правила подсистемы балансировки нагрузки

Правило подсистемы балансировки нагрузки позволяет определить распределение трафика между виртуальными машинами. Вы определяете интерфейсную конфигурацию IP-адресов для входящего трафика и внутренний пул IP-адресов для приема трафика, а также требуемый порт источника и назначения. Создайте правило балансировки нагрузки *myLoadBalancerRuleWeb* для прослушивания порта 80 в интерфейсном сервере *LoadBalancerFrontEnd* и отправки сетевого трафика со сбалансированной нагрузкой во внутренний пул адресов *myBackEndPool*, также используя порт 80. 

1. Щелкните **Все ресурсы** в меню слева, а затем из списка ресурсов выберите **myLoadBalancer**.
2. В разделе **Параметры** выберите **Правила балансировки нагрузки**, а затем щелкните **Добавить**.
3. Для настройки правила балансировки нагрузки используйте следующие значения:
    - *myHTTPRule* — для имени правила балансировки нагрузки;
    - **TCP** — для типа протокола;
    - *80* — для номера порта;
    - *80* — для внутреннего порта;
    - *myBackendPool* — для имени серверного пула;
    - *myHealthProbe* — для имени зонда работоспособности.
4. Последовательно выберите **ОК**.
    
    ![Добавление правила балансировки нагрузки](./media/tutorial-load-balancer-basic-internal-portal/5-load-balancing-rules.png)

## <a name="create-a-virtual-machine-to-test-the-load-balancer"></a>Создание виртуальной машины для тестирования подсистемы балансировки нагрузки
Чтобы проверить работу внутренней подсистемы балансировки нагрузки, создайте виртуальную машину в той же виртуальной сети, где расположены виртуальные машины серверной части.
1. В верхней части экрана слева щелкните **Создать ресурс** > **Вычисления** > **Windows Server 2016 Datacenter**, а затем введите следующие значения для виртуальной машины:
    - *myVMTest* — для имени виртуальной машины;        
    - *myResourceGroupZLB* — для параметра **Группа ресурсов**. Установите флажок **Использовать существующую** и выберите элемент *myResourceGroupZLB*.
2. Последовательно выберите **ОК**.
3. Выберите значение **DS1_V2** в качестве размера виртуальной машины и нажмите кнопку **Выбрать**.
4. Введите следующие значения для параметров виртуальной машины.
    -  В качестве виртуальной сети выберите *myVNet*.
    - В качестве подсети выберите *myBackendSubnet*.
5. Щелкните **Отключено**, чтобы отключить диагностику загрузки.
6. Нажмите кнопку **ОК**, просмотрите параметры на странице сводки и нажмите кнопку **Создать**.

## <a name="test-the-load-balancer"></a>Тестирование подсистемы балансировки нагрузки
1. На портале Azure найдите общедоступный IP-адрес Load Balancer, который указан на экране **обзора**. Для этого выполните следующие действия: a. Щелкните **Все ресурсы** в меню слева, а затем из списка ресурсов выберите **myLoadBalancer**.
    Б. На странице **обзора** скопируйте частный IP-адрес (в нашем примере это 10.1.0.7).

2. Создайте удаленное подключение к *myVMTest*, выполнив следующие действия: a. В меню слева щелкните **Все ресурсы** и выберите в списке ресурсов виртуальную машину **myVMTest**, расположенную в группе ресурсов *myResourceGroupILB*.
2. На странице **обзора** щелкните **Подключиться**, чтобы открыть сеанс удаленной связи с виртуальной машиной.
3. Войдите на виртуальную машину *myVMTest*.
3. Вставьте частный IP-адрес в адресную строку браузера на *myVMTest*. В браузере отобразится страница по умолчанию веб-сервера IIS.

      ![Веб-сервер IIS](./media/tutorial-load-balancer-basic-internal-portal/9-load-balancer-test.png)

Чтобы посмотреть, как подсистема балансировки нагрузки распределяет трафик между обеими виртуальными машинами, на которых выполняется приложение, принудительно обновите веб-браузер.

## <a name="clean-up-resources"></a>Очистка ресурсов

Ставшие ненужными группу ресурсов, подсистему балансировки нагрузки и все связанные ресурсы можно удалить. Для этого выберите группу ресурсов, содержащую подсистему балансировки нагрузки, и щелкните **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

С помощью этого руководства вы создали группу ресурсов, сетевые ресурсы и внутренние серверы. Затем вы применили эти ресурсы для создания внутренней подсистемы балансировки нагрузки, которая распределяет внутренний трафик между виртуальными машинами. Теперь вы можете ознакомиться со сведениями о [балансировке нагрузки для виртуальных машин в разных зонах доступности](tutorial-load-balancer-standard-public-zone-redundant-portal.md).
