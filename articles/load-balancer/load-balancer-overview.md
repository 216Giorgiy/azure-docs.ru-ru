---
title: Обзор Azure Load Balancer | Документация Майкрософт
description: Обзор функций балансировщика нагрузки Azure, его архитектуры и реализации. Узнайте, как работает балансировщик нагрузки, и применяйте его в облаке.
services: load-balancer
documentationcenter: na
author: KumudD
manager: jeconnoc
editor: ''
ms.assetid: ''
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/21/2018
ms.author: kumud
ms.openlocfilehash: f4410932f00f8505ae5a894caa002e1223196d95
ms.sourcegitcommit: 34e0b4a7427f9d2a74164a18c3063c8be967b194
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2018
---
# <a name="azure-load-balancer-overview"></a>Обзор балансировщика нагрузки Azure

Azure Load Balancer позволяет масштабировать приложения и обеспечивать высокий уровень доступности служб. Load Balancer поддерживает как входящие, так и исходящие сценарии, обеспечивает низкую задержку и высокую пропускную способность, а также увеличивает масштаб до миллионов потоков для всех приложений, которые используют протоколы TCP и UDP.   

Load Balancer будет распределять новые входящие потоки, поступающие на внешний интерфейс подсистемы балансировки нагрузки, в экземпляры серверных пулов в соответствии с правилами и проверками работоспособности.  

Кроме того, общедоступный Load Balancer может также предоставить исходящие подключения для виртуальных машин в рамках виртуальной сети путем преобразования их частных IP-адресов в общедоступные IP-адреса.

Доступно два типа SKU Azure Load Balancer уровня: "Базовый" и "Стандартный".  В них есть различия по масштабу, возможностям и цене.  Любой сценарий, который можно выполнить в рамках Load Balancer уровня "Базовый", также можно создать с помощью Load Balancer уровня "Стандартный", хотя подход может несколько отличаться.  По мере получения дополнительных сведений о Load Balancer, необходимо ознакомиться с основами и различиями в SKU.

## <a name="why-use-load-balancer"></a>Преимущества Load Balancer 

Вот какие функции можно использовать в службе Azure Load Balancer:

* балансировка нагрузки входящего интернет-трафика виртуальных машин. Такая конфигурация называется [общедоступным Load Balancer](#publicloadbalancer).
* Балансировка нагрузки трафика между виртуальными машинами в виртуальной сети. Кроме того, можно подключиться к внешнему интерфейсу Load Balancer из локальной сети в гибридном сценарии. В обоих сценариях используется конфигурация, известная как [внутренний Load Balancer](#internalloadbalancer).
* Перенаправление трафика с помощью порта на определенный порт в определенной виртуальной машине с использованием правил преобразования сетевых адресов для входящих подключений.
* Обеспечение [исходящего подключения](load-balancer-outbound-connections.md) для виртуальных машин в виртуальной сети путем использования общедоступного Load Balancer.


>[!NOTE]
> Azure предоставляет набор полностью управляемых решений балансировки нагрузки для сценариев.  Если вам необходима обработка подключений TLS (разгрузка SSL) или обработка прикладного уровня HTTP- или HTTPS-запросов, ознакомьтесь со статьей [Обзор шлюза приложений](../application-gateway/application-gateway-introduction.md).  Если вам нужна глобальная балансировка нагрузки DNS, ознакомьтесь со статьей о [диспетчере трафика](../traffic-manager/traffic-manager-overview.md).  В комплексных сценариях может быть целесообразно объединить эти решения.

## <a name="what-is-load-balancer"></a>Что такое балансировщик нагрузки?

Ресурс Load Balancer может существовать как общедоступный или внутренний Load Balancer. Функции ресурса Load Balancer выражаются в виде внешнего интерфейса, правила, проверки работоспособности и определения внутреннего пула.  Виртуальные машины можно поместить в серверный пул, указав серверный пул виртуальной машины.

Ресурсы Load Balancer представляют собой объекты, в которых можно выразить, как служба Azure должна запрограммировать свою мультитенантную инфраструктуру, чтобы получить сценарий, который необходимо создать.  Между ресурсами Load Balancer и фактической инфраструктурой нет прямой связи. При создании Load Balancer экземпляр не создается, а емкость всегда доступна. 

## <a name="fundamental-load-balancer-features"></a>Основные функции Load Balancer

Load Balancer предоставляет следующие основные возможности для приложений TCP и UDP:

* **Балансировка нагрузки**

    Azure Load Balancer позволяет создать правило балансировки нагрузки, чтобы распределять входящий трафик интерфейса между экземплярами внутреннего пула.  Он использует алгоритм на основе хэша для распределения входящих потоков и соответствующим образом перезапишет заголовки потоков экземпляров внутреннего пула. Сервер может получать новые потоки, когда в результате проверки работоспособности получается работоспособная серверная конечная точка.
    
    По умолчанию для сопоставления трафика с доступными серверами используется хэш с 5 кортежами (исходный IP-адрес, порт источника, IP-адрес назначения, порт назначения и тип протокола).  Вы можете создать сходство с определенным исходным IP-адресом путем включения 2- или 3-кортежного хэша для данного правила.  Все пакеты из одного потока пакетов поступают на один и тот же экземпляр за интерфейсом с балансировкой нагрузки.  Когда клиент инициирует новый поток из того же исходного IP-адреса, исходный порт изменяется. В результате использование 5 кортежей может привести к тому, что трафик перейдет к другой конечной точке сервера.

    Дополнительные сведения см. в статье [Настройка режима распределения для Azure Load Balancer](load-balancer-distribution-mode.md). На представленной ниже схеме показано распределение на основе хэша.

    ![Распространение на основе хэша](./media/load-balancer-overview/load-balancer-distribution.png)

    *Рис. Распределение на основе хэша*

* **Перенаправление портов**

    Azure Load Balancer позволяет создать правило преобразования сетевых адресов для входящих подключений для перенаправления трафика из определенного порта определенного IP-адреса интерфейса на определенный порт определенного серверного экземпляра в виртуальной сети. Кроме того, это также достигается за счет того же распространения на основе хэша, что и при балансировке нагрузки.  Распространенными сценариями этой возможности являются сеансы протокола удаленного рабочего стола или Secure Shell для отдельных экземпляров виртуальной машины в виртуальной сети.  Несколько внутренних конечных точек можно сопоставить с различными портами в том же интерфейсном IP-адресе. Их можно использовать для удаленного администрирования виртуальных машин через Интернет без необходимости дополнительных переходов.

* **Независимые и прозрачные приложения**

    Load Balancer напрямую не взаимодействует с TCP, UDP или со слоем приложения, поэтому можно реализовать поддержку любого сценария приложения на основе UDP.  Например, хотя Load Balancer не завершает сам TLS, вы можете создавать и масштабировать приложения TLS с помощью Load Balancer и завершать подключение TLS на самой виртуальной машине. Подсистема балансировки нагрузки не завершает поток и подтверждения протоколов всегда выполняются напрямую между клиентом и выбранным хэшем экземпляром серверных пулов. Например, подтверждение TCP всегда выполняется между клиентом и выбранной серверной виртуальной машиной.  Ответ на запрос к интерфейсной части — это ответ серверной виртуальной машины.  Производительность исходящей сети Load Balancer ограничена только SKU выбранной виртуальной машины, а потоки будут активны очень долго, если время ожидания простоя никогда не будет достигнуто.

* **Автоматическая перенастройка**

    Балансировщик нагрузки Azure мгновенно перенастраивает сам себя при горизонтальном и вертикальном масштабировании экземпляров. Добавление или удаление виртуальных машин из серверного пула перенастраивает подсистему балансировки нагрузки без дополнительных операций в ресурсе Load Balancer.

* **Проверки работоспособности**

    Azure Load Balancer использует заданные проверки работоспособности, чтобы определить работоспособность экземпляров в серверном пуле. Если проверка не отвечает, балансировщик нагрузки Azure прекращает отправлять новое подключение неработоспособным экземплярам. Имеющиеся подключения не затрагиваются и будут работать, пока приложение не завершит работу потока, не истечет время ожидания перед переходом в режим простоя или работа виртуальной машины не завершится.

    Существует три типа проверки:

    - **Пользовательская проверка HTTP.** Ее можно использовать для создания собственной настраиваемой логики для определения работоспособности экземпляра серверного пула. Балансировщик нагрузки будет регулярно проверять конечную точку (по умолчанию, каждые 15 секунд). Экземпляр считается работоспособным, если он возвращает ответ с кодом HTTP 200 за определенное время ожидания (по умолчанию 31 секунда). Все состояния, отличающиеся от HTTP 200, приведут к сбою проверки работоспособности.  Это также удобно для реализации собственной логики удаления экземпляров из ротации подсистемы балансировки нагрузки. Например, можно настроить экземпляр для возвращения состояния, отличного от 200, если загрузка ЦП экземпляра превышает 90 %.   Эта проверка переопределяет проверку гостевого агента по умолчанию.

    - **Пользовательская проверка TCP.** Проверка зависит от успешности установки сеанса TCP к определенному порту зонда.  Пока существует определенный слушатель на виртуальной машине, проверка работоспособности будет выполняться успешно. Если в соединении отказано, проверка работоспособности завершится с ошибкой. Эта проверка переопределяет проверку гостевого агента по умолчанию.

    - **Проверка гостевого агента (только на виртуальных машинах PaaS).** Подсистема балансировки нагрузки также может использовать гостевой агент внутри виртуальной машины. Затем она ожидает передачу данных и передает ответ HTTP с кодом 200 (ОК) только в том случае, если экземпляр находится в состоянии готовности. Если агент не отправляет ответ "HTTP 200 (OK)", то балансировщик нагрузки отмечает экземпляр как неработоспособный и перестает отправлять ему трафик. Подсистема балансировки нагрузки продолжает попытку связаться с экземпляром. Если гостевой агент дает ответ HTTP 200, балансировщик нагрузки снова направит трафик к этому экземпляру.  Проверка работоспособности гостевого агента является последним средством и не должна использоваться, когда возможна конфигурация пользовательских проверок HTTP или TCP. 
    
* **Исходящие подключения (исходящее преобразование сетевых адресов (SNAT))**

    Все исходящие потоки из частных IP-адресов в виртуальной сети к общедоступным IP-адресам в Интернете можно преобразовать во внешние IP-адреса Load Balancer. Если общедоступный интерфейс привязан к серверной виртуальной машине с помощью правила балансировки нагрузки, Azure настраивает автоматическое преобразование исходящих подключений в общедоступный интерфейсный IP-адрес. Это также называется исходящим преобразованием сетевых адресов (SNAT). SNAT предоставляет такие важные преимущества:

    + Упрощение обновления и аварийного восстановления служб, так как интерфейс можно динамически сопоставить с другим экземпляром службы.
    + Это упрощает управление списком управления доступом (ACL). С точки зрения интерфейсных IP-адресов списки управления доступом не меняются при масштабировании или повторном развертывании служб.

    Дополнительные подробные сведения об этой возможности см. в статье [об исходящих подключениях](load-balancer-outbound-connections.md).

Load Balancer уровня "Стандартный" имеет дополнительные возможности, связанные со SKU, которые не относятся к этим принципам.  Ознакомьтесь со сведениями, приведенными в остальной части этой статьи.

## <a name="skus"></a>Сравнение SKU Load Balancer

Azure Load Balancer поддерживает два SKU: категории "Базовый" и "Стандартный".  В них есть различия по масштабу сценария, возможностям и цене.  Любой сценарий, который можно выполнить в рамках Load Balancer уровня "Базовый", также можно создать с помощью Load Balancer уровня "Стандартный".  На самом деле API обоих SKU аналогичны и вызываются через спецификацию SKU.  API для поддержки SKU Load Balancer и общедоступного IP-адреса доступны, начиная с API 2017-08-01.  Оба SKU имеют один общий API и структуру.

Однако, в зависимости от того, какой SKU выбран, полный сценарий конфигурации может несколько отличаться. Документация Load Balancer вызывается, когда статья применима только к определенному SKU. Ознакомьтесь со следующей таблицей, чтобы сравнить сведения и понять различия.  Ознакомьтесь со статьей [Обзор Azure Load Balancer уровня "Стандартный" (предварительная версия)](load-balancer-standard-overview.md).

>[!NOTE]
> В новых конструкциях следует рассматривать возможность использования Load Balancer уровня "Стандартный". 

Изолированные виртуальные машины, наборы доступности и масштабируемые наборы виртуальных машин можно подключить только к одному SKU, но никогда к обоим. При использовании общедоступных IP-адресов номера SKU Load Balancer и IP-адреса должны совпадать. SKU Load Balancer и общедоступных IP-адресов неизменяемы.

_Рекомендуется явно указать SKU, даже если это необязательно._  В настоящее время требуемые изменения сведены к минимуму. Если SKU не указан, это интерпретируется как намерение использовать SKU "Базовый" в версии API 2017-08-01.

>[!IMPORTANT]
>Load Balancer уровня "Стандартный" — новый продукт в серии Load Balancer, который во многом подобен супермножеству Load Balancer уровня "Базовый".  Между двумя продуктами есть значительные намеренные различия.  Любой комплексный сценарий, который можно выполнить в рамках Load Balancer уровня "Базовый", можно создать с помощью Load Balancer уровня "Стандартный".  Если вы уже используете Load Balancer уровня "Базовый", следует ознакомиться с Load Balancer уровня "Стандартный", чтобы понять критические изменения в поведении между этими уровнями и их влиянием. Внимательно просмотрите этот раздел.

| | [SKU "Стандартный"](load-balancer-standard-overview.md) | SKU "Базовый" |
| --- | --- | --- |
| Размер серверного пула | До 1000 экземпляров | До 100 экземпляров |
| Конечные точки серверного пула | Любые виртуальные машины в одной виртуальной сети, включая смешение виртуальных машин, групп доступности и масштабируемых наборов виртуальных машин. | Виртуальные машины в одной группе доступности или масштабируемом наборе виртуальных машин |
| Зоны доступности | Избыточные в пределах зоны и зональные внешние интерфейсы для входящего и исходящего трафика, сопоставления потоков исходящего трафика выдерживают сбой зоны, межзональная балансировка нагрузки. | / |
| Диагностика | Azure Monitor, многомерные метрики, включающие счетчики пакетов и байтов, состояние проверки работоспособности, попытки подключения (TCP SYN), работоспособность исходящего подключения (успешные и завершившиеся со сбоем потоки SNAT), активные измерения в плоскости данных. | Azure Log Analytics только для общедоступного Load Balancer, оповещение о нехватке SNAT, счетчик работоспособности серверного пула. |
| Порты HA | Внутренний Load Balancer | / |
| Обеспечение безопасности по умолчанию | По умолчанию закрыто для общедоступных IP-адресов и конечных точек Load Balancer, а группа безопасности сети используется, чтобы явно указать в списке разрешений источники для прохождения трафика. | Открыто по умолчанию, группа безопасности сети необязательна. |
| Исходящие подключения | Несколько внешних интерфейсов с условиями для каждого правила. Чтобы виртуальная машина могла использовать исходящие подключения, _необходимо_ явно создать сценарий для исходящих подключений.  К [конечным точкам службы виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md) можно получить доступ без исходящего подключения, и они не считаются обработанными данными.  Любые общедоступные IP-адреса, включая службы Azure PaaS, недоступные в качестве конечных точек службы виртуальной сети, должны быть доступны посредством исходящего подключения и учитываются как обработанные данные. Когда только внутренний Load Balancer обслуживает виртуальную машину, исходящие подключения через SNAT по умолчанию недоступны. Программирование исходящих SNAT-подключений осуществляется для конкретного транспортного протокола из правила балансировки нагрузки входящего трафика. | Один внешний интерфейс, который выбирается случайно при наличии нескольких внешних интерфейсов.  Когда только внутренний Load Balancer обслуживает виртуальную машину, используется SNAT по умолчанию. |
| Несколько внешних интерфейсов | Исходящий и входящий | Только входящий |
| Операции управления | Большинство операций длятся менее 30 секунд | Обычно 60–90 и более секунд |
| Соглашение об уровне обслуживания | 99,99 % для пути данных с двумя работоспособными виртуальными машинами | Неявно в Соглашении об уровне обслуживания виртуальной машины | 
| Цены | Плата основывается на числе правил, обработанных входящих или исходящих данных, связанных с ресурсом.  | Бесплатно |

Ознакомьтесь с разделом об [ограничениях службы для Load Balancer](https://aka.ms/lblimits).  Для Load Balancer уровня "Стандартный" также просмотрите более подробный [обзор](load-balancer-standard-overview.md), [цены](https://aka.ms/lbpricing) и [Соглашение об уровне обслуживания](https://aka.ms/lbsla).

## <a name="concepts"></a>Основные понятия

### <a name = "publicloadbalancer"></a>Общедоступный Load Balancer

Общедоступный Load Balancer сопоставляет общедоступный IP-адрес и номер порта для входящего трафика с частным IP-адресом и номером порта виртуальной машины и наоборот для ответного трафика из виртуальной машины. Правила балансировки нагрузки позволяют распределить трафик определенных типов между несколькими виртуальными машинами или службами. Например, можно распределить нагрузку от трафика веб-запросов на несколько веб-серверов.

На следующем рисунке показана конечная точка с балансировкой нагрузки для веб-трафика, которая является общей для трех виртуальных машин на общедоступном и частном TCP-портах 80. Эти три виртуальные машины находятся в наборе балансировки нагрузки.

![пример общедоступной подсистемы балансировки нагрузки](./media/load-balancer-overview/IC727496.png)

*Рисунок. Балансировка нагрузки веб-трафика с помощью общедоступного Load Balancer*

Когда интернет-клиенты отправляют запросы к веб-страницам на общедоступный IP-адрес веб-приложения в TCP-порт 80, Azure Load Balancer распределяет эти запросы между тремя виртуальными машинами в наборе балансировки нагрузки. Дополнительные сведения об алгоритме балансировщика нагрузки см. на [странице обзора балансировщика нагрузки](load-balancer-overview.md#load-balancer-features).

По умолчанию Azure Load Balancer распределяет сетевой трафик между несколькими экземплярами виртуальных машин. Кроме того, можно настроить сходство сеансов. Дополнительные сведения см. в статье [Настройка режима распределения для Azure Load Balancer](load-balancer-distribution-mode.md).

### <a name = "internalloadbalancer"></a>Внутренний Load Balancer

Внутренний Load Balancer направляет трафик только к тем ресурсам, которые находятся внутри виртуальной сети или используют VPN для доступа к инфраструктуре Azure. В этом отношении внутренний Load Balancer отличается от общедоступного. Инфраструктура Azure ограничивает доступ к интерфейсным IP-адресам (с балансировкой нагрузки) виртуальной сети. Интерфейсные IP-адреса и виртуальные сети никогда не предоставляются напрямую конечной точке Интернета. Внутренние бизнес-приложения выполняются в Azure и доступны из Azure или из локальных ресурсов.

Внутренний Load Balancer реализует следующие типы балансировки нагрузки:

* В виртуальной сети: распределение нагрузки между виртуальными машинами в виртуальной сети и набором виртуальных машин, размещенных в той же виртуальной сети.
* Для распределенной виртуальной сети: балансировка нагрузки локальных компьютеров к набору виртуальных машин, размещенных в той же виртуальной сети. 
* Для многоуровневых приложений: балансировка нагрузки для многоуровневых приложений с доступом в Интернет, где серверные уровни не имеют доступа к Интернету. Серверные уровни требуют балансировки нагрузки трафика уровня с выходом в Интернет (см. рис. 2).
* Для бизнес-приложений: балансировка нагрузки для бизнес-приложений, размещенных в Azure без дополнительного оборудования или программного обеспечения подсистемы балансировки нагрузки. Сценарий включает в себя локальные серверы в наборе компьютеров, чей трафик балансируется.

![Пример внутренней подсистемы балансировки нагрузки](./media/load-balancer-overview/IC744147.png)

*Рисунок. Балансировка нагрузки многоуровневых приложений с помощью общедоступных и внутренних подсистем балансировки нагрузки*

## <a name="pricing"></a>Цены
За Load Balancer уровня "Стандартный" плата взимается, исходя из количества настроенных правил балансировки нагрузки и всех обработанных входящих и исходящих данных. Сведения о ценах на Load Balancer уровня "Стандартный" см. на [странице цен](https://azure.microsoft.com/pricing/details/load-balancer/).

Load Balancer уровня "Базовый" предоставляется бесплатно.

## <a name="sla"></a>Соглашение об уровне обслуживания

Дополнительные сведения о Соглашении об уровне обслуживания Load Balancer уровня "Стандартный" см. на [этой странице](https://aka.ms/lbsla). 

## <a name="next-steps"></a>Дополнительная информация

- Ознакомьтесь со статьей [Обзор Azure Load Balancer уровня "Стандартный" (предварительная версия)](load-balancer-standard-overview.md)
- Дополнительные сведения см. в статье [Azure Load Balancer уровня "Стандартный" и зоны доступности](load-balancer-standard-availability-zones.md)
- Узнайте, как использовать [Load Balancer для исходящих подключений](load-balancer-outbound-connections.md)
- Узнайте, как использовать [порты с высоким уровнем доступности Load Balancer](load-balancer-ha-ports-overview.md)
- Узнайте, как использовать [Load Balancer с несколькими внешними интерфейсами](load-balancer-multivip-overview.md)
- Узнайте о [конечных точка службы виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md)
- Узнайте, как создать [базовую общедоступную подсистему балансировки нагрузки](load-balancer-get-started-internet-portal.md)

