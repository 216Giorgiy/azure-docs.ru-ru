---
title: Мониторинг операций, событий и счетчиков для балансировщика нагрузки | Microsoft Docs
description: Узнайте, как включить ведение журналов событий оповещений и проверки работоспособности для балансировщика нагрузки Azure
services: load-balancer
documentationcenter: na
author: sdwheeler
manager: carmonm
editor: tysonn
tags: azure-resource-manager

ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/05/2016
ms.author: sewhee

---
# Служба анализа журналов для балансировщика нагрузки Azure (предварительная версия)
В Azure можно использовать различные виды журналов для управления балансировщиками нагрузки и устранения возникающих в них неполадок. К некоторым из этих журналов можно получить доступ через портал. Также можно извлечь все журналы из хранилища BLOB-объектов Azure и просматривать их с помощью различных средств, таких как Excel и PowerBI. В списке ниже приведены дополнительные сведения о различных типах журналов.

* **Журналы аудита.** В [журналах аудита Azure](../azure-portal/insights-debugging-with-events.md) (прежнее название — операционные журналы) можно просмотреть все операции, отправляемые в ваши подписки Azure, и состояние этих операций. По умолчанию журналы аудита включены, и их можно просмотреть на портале Azure.
* **Журналы событий оповещений:** этот журнал можно использовать для просмотра оповещений, создаваемых для балансировщика нагрузки. Данные о состоянии балансировщика нагрузки собираются каждые пять минут. В этом журнале делается запись, только если возникает событие оповещения балансировщика нагрузки.
* **Журналы проверки работоспособности:** этот журнал можно использовать для проверки состояния проверки работоспособности, проверки количества экземпляров, находящихся в оперативном режиме в серверной части балансировщика нагрузки и проверки процента виртуальных машин, получающих сетевой трафик из балансировщика нагрузки. В этом журнале делается запись при изменении события состояния проверки.

> [!WARNING]
> Журналы доступны только для ресурсов, развернутых в модели развертывания диспетчера ресурсов. Журналы нельзя использовать для ресурсов в классической модели развертывания. Чтобы получить более полное представление об этих двух моделях, см. статью [Общие сведения о развертывании диспетчера ресурсов и классическом развертывании](../resource-manager-deployment-model.md). <BR> Служба анализа журналов в настоящее время работает только для балансировщиков нагрузки, ориентированных на Интернет. Это ограничение является временным и может быть изменено в любое время. Обязательно вернитесь на эту страницу, чтобы проверить будущие изменения.
> 
> 

## Включение ведения журналов
Ведение журналов аудита автоматически включено постоянно для каждого ресурса диспетчера ресурсов. Чтобы начать сбор соответствующих данных, необходимо включить ведение журналов событий и проверки работоспособности. Чтобы включить ведение журнала, выполните следующие действия.

Войдите на [портал Azure](http://portal.azure.com). Если у вас еще нет балансировщика нагрузки, [создайте балансировщик нагрузки](load-balancer-get-started-internet-arm-ps.md) перед продолжением.

На портале щелкните **Обзор** >> **Балансировщики нагрузки**.

![портал — балансировщик нагрузки](./media/load-balancer-monitor-log/load-balancer-browse.png)

Выберите существующий балансировщик нагрузки, затем щелкните **Все параметры**.

![портал — балансировщик нагрузки — параметры](./media/load-balancer-monitor-log/load-balancer-settings.png) <BR>

В колонке **Параметры** щелкните **Диагностика**, а затем на панели **Диагностика** рядом с полем **Состояние** щелкните **Вкл.** в колонке **Параметры**, щелкните **Учетная запись хранения** и выберите существующую учетную запись хранения или создайте новую.

В раскрывающемся списке под элементом **Учетная запись хранения** выберите, что именно следует регистрировать — события оповещений, состояние проверки работоспособности или то и другое, — а затем нажмите кнопку **Сохранить**.

![Портал предварительной версии — журналы диагностики](./media/load-balancer-monitor-log/load-balancer-diagnostics.png)

> [AZURE.INFORMATION] Для журналов аудита отдельная учетная запись хранения не требуется. За использование хранилища для журналов событий и проверки работоспособности взимается плата.
> 
> 

## Журнал аудита
Этот журнал (прежнее название — «операционный журнал») создается в Azure по умолчанию. Журналы хранятся в течение 90 дней в хранилище журналов событий Azure. Дополнительные сведения об этих журналах см. в статье [Просмотр журналов событий и аудита](../azure-portal/insights-debugging-with-events.md).

## Журнал событий оповещений
Этот журнал создается только в том случае, если он включен для конкретного балансировщика нагрузки, как описано выше. Данные хранятся в учетной записи хранения, указанной при включении ведения журнала. Информация вводится в формате JSON, как показано ниже.

    {
    "time": "2016-01-26T10:37:46.6024215Z",
    "systemId": "32077926-b9c4-42fb-94c1-762e528b5b27",
    "category": "LoadBalancerAlertEvent",
    "resourceId": "/SUBSCRIPTIONS/XXXXXXXXXXXXXXXXX-XXXX-XXXX-XXXXXXXXX/RESOURCEGROUPS/RG7/PROVIDERS/MICROSOFT.NETWORK/LOADBALANCERS/WWEBLB",
    "operationName": "LoadBalancerProbeHealthStatus",
    "properties": {
        "eventName": "Resource Limits Hit",
        "eventDescription": "Ports exhausted",
        "eventProperties": {
            "public ip address": "40.117.227.32"
        }
    }


В выходных данных JSON отображается свойство *eventname*, описывающее причину создания оповещения балансировщиком нагрузки. В этом случае оповещение было создано из-за нехватки порта TCP, вызванной ограничениями преобразования исходных сетевых адресов (SNAT).

## Журнал проверки работоспособности
Этот журнал создается только в том случае, если он включен для конкретного балансировщика нагрузки, как описано выше. Данные хранятся в учетной записи хранения, указанной при включении ведения журнала. Создается контейнер с именем insights-logs-loadbalancerprobehealthstatus, и в журнал записываются следующие данные.

        {
        "records":

        {
               "time": "2016-01-26T10:37:46.6024215Z",
            "systemId": "32077926-b9c4-42fb-94c1-762e528b5b27",
            "category": "LoadBalancerProbeHealthStatus",
            "resourceId": "/SUBSCRIPTIONS/XXXXXXXXXXXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXX/RESOURCEGROUPS/RG7/PROVIDERS/MICROSOFT.NETWORK/LOADBALANCERS/WWEBLB",
            "operationName": "LoadBalancerProbeHealthStatus",
            "properties": {
                "publicIpAddress": "40.83.190.158",
                "port": "81",
                "totalDipCount": 2,
                "dipDownCount": 1,
                "healthPercentage": 50.000000
            }
        },
        {
            "time": "2016-01-26T10:37:46.6024215Z",
            "systemId": "32077926-b9c4-42fb-94c1-762e528b5b27",
            "category": "LoadBalancerProbeHealthStatus",
            "resourceId": "/SUBSCRIPTIONS/XXXXXXXXXXXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXX/RESOURCEGROUPS/RG7/PROVIDERS/MICROSOFT.NETWORK/LOADBALANCERS/WWEBLB",
            "operationName": "LoadBalancerProbeHealthStatus",
            "properties": {
                "publicIpAddress": "40.83.190.158",
                "port": "81",
                "totalDipCount": 2,
                "dipDownCount": 0,
                "healthPercentage": 100.000000
            }
        }

    ]
    }

В выходных данных JSON в поле свойств отображаются основные сведения о состоянии проверки работоспособности. Свойство *DipDownCount* показывает общее количество экземпляров в серверной части, которые не получают сетевой трафик из-за неудачных ответов проверки.

## Просмотр и анализ журнала аудита
Данные журнала аудита можно просматривать и анализировать с помощью любого из следующих методов.

* **Средства Azure.** Информацию из журналов аудита можно получать с помощью Azure PowerShell, интерфейса командной строки (CLI) Azure, интерфейса REST API Azure или портала предварительной версии Azure. Пошаговые инструкции для каждого метода подробно описаны в статье [Операции аудита с помощью диспетчера ресурсов](../resource-group-audit.md).
* **Power BI.** Если у вас еще нет учетной записи [Power BI](https://powerbi.microsoft.com/pricing), ее можно опробовать бесплатно. Используя [пакет содержимого журналов аудита Azure для Power BI](https://powerbi.microsoft.com/documentation/powerbi-content-pack-azure-audit-logs), можно анализировать данные с помощью предварительно настроенных панелей мониторинга, которые можно использовать как есть или дополнительно настроить.

## Просмотр и анализ журналов событий и проверки работоспособности
Вам потребуется подключиться к учетной записи хранения и извлечь записи журнала JSON для журналов событий и проверки работоспособности. После загрузки JSON-файлов их можно преобразовать в формат CSV и просматривать в Excel, PowerBI или другом средстве визуализации данных.

> [!TIP]
> Если вы знакомы с Visual Studio и основными понятиями изменения значений констант и переменных в C#, можно использовать [средства преобразования журнала](https://github.com/Azure-Samples/networking-dotnet-log-converter), доступные на сайте GitHub.
> 
> 

## Дополнительные ресурсы
* Запись блога [Визуализация журналов аудита Azure с помощью Power BI](http://blogs.msdn.com/b/powerbi/archive/2015/09/30/monitor-azure-audit-logs-with-power-bi.aspx).
* Запись блога [Просмотр и анализ журналов аудита Azure с помощью Power BI и других средств](https://azure.microsoft.com/blog/analyze-azure-audit-logs-in-powerbi-more/).

<!---HONumber=AcomDC_0824_2016-->