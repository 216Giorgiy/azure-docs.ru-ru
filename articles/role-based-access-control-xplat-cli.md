<properties 
	pageTitle="Управление доступом на основе ролей с помощью межплатформенного интерфейса командной строки Azure" 
	description="Управление доступом на основе ролей с помощью межплатформенного интерфейса командной строки" 
	services="" 
	documentationCenter="" 
	authors="guangyang" 
	manager="terrylan" 
	editor="mollybos"/>

<tags 
	ms.service="multiple" 
	ms.workload="multiple" 
	ms.tgt_pltfrm="command-line-interface" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="11/03/2014" 
	ms.author="guayan"/>

# Управление доступом на основе ролей с помощью кросс-платформенного интерфейса командной строки #

<div class="dev-center-tutorial-selector sublanding"><a href="/ru-ru/documentation/articles/powershell-rbac.md" title="Windows PowerShell" class="current">Кросс-платформенный интерфейс командной строки средства Windows PowerShell</a><a href="/ru-ru/documentation/articles/xplat-cli-rbac.md" title="Cross-Platform CLI"></a></div>

Функция управления доступом на основе ролей (RBAC) на портале предварительной версии Azure и в API диспетчера ресурсов Azure позволяет управлять доступом к подписке и ресурсам на детальном уровне. С ее помощью вы можете предоставлять доступ пользователям, группам и субъектам-службам Active Directory, назначая им роли с определенной областью.

Из этого учебника вы узнаете, как использовать кросс-платформенный интерфейс командной строки (xplat-cli) Azure для управления доступом на основе ролей. Он представляет собой пошаговое руководство по созданию и проверке назначений ролей.

**Предполагаемое время выполнения:** 15 минут

## Предварительные требования ##

Чтобы использовать интерфейс xplat-cli для управления RBAC, вам понадобится:

- Межплатформенный интерфейс командной строки Azure версии 0.8.8 или более поздней. Сведения об установке последней версии и связывании ее с подпиской Azure см. в разделе [Установка и настройка кросс-платформенного интерфейса командной строки Azure](http://azure.microsoft.com/documentation/articles/xplat-cli/).
- Чтобы узнать, как настраивать и использовать диспетчер ресурсов Azure в межплатформенном интерфейсе командной строки Azure, также прочитайте следующее руководство: [Использование межплатформенного интерфейса командной строки Microsoft Azure совместно с диспетчером ресурсов](http://azure.microsoft.com/documentation/articles/xplat-cli-azure-resource-manager/)

## В этом учебнике рассматриваются следующие темы: ##

* [Подключение к подпискам](#connect)
* [Проверка существующих назначений ролей](#check)
* [Создание назначения роли](#create)
* [Проверка разрешений](#verify)
* [Дальнейшие действия](#next)

## <a id="connect"></a>Подключение к подпискам ##

RBAC работает только с диспетчером ресурсов Azure, поэтому в первую очередь необходимо перейти в режим диспетчера ресурсов Azure. Введите:

    Режим настройки Azure arm

Дополнительные сведения см. в разделе [Использование кросс-платформенного интерфейса командной строки Azure совместно с диспетчером ресурсов.](http://azure.microsoft.com/documentation/articles/xplat-cli-azure-resource-manager/)

Чтобы подключиться к подпискам Azure, введите:

    azure login -u <username>

В командной строке введите пароль вашей учетной записи Azure (поддерживаются только идентификаторы, относящиеся к организациям). Интерфейс xplat-cli соберет сведения обо всех подписках с этой учетной записью. В качестве подписки по умолчанию будет выбрана первая из них. Обратите внимание: при использовании управления доступом на основе ролей вы получите только те подписки, в которых у вас есть какие-либо разрешения, т. е. для которых вы являетесь соадминистратором или вам назначена какая-либо роль. 

Если у вас несколько подписок и вы хотите переключиться на другую, введите:

    # Здесь вы увидите подписки учетной записи.
    Команда account list Azure
    # Используя имя подписки, выберите подписку, с которой требуется продолжить работу.
    комплект учетной записи Azure <имя подписки>

Дополнительные сведения см. в разделе [Установка и настройка кросс-платформенного интерфейса командной строки Azure](http://azure.microsoft.com/documentation/articles/xplat-cli/).

## <a id="check"></a>Проверка существующих назначений ролей ##

Теперь давайте проверим, какие назначения ролей уже есть в подписке. Введите:

    azure role assignment list

Эта команда возвращает все назначения ролей в подписке. Обратите внимание на два момента:

1. Вам потребуется доступ на чтение на уровне подписки.
2. Если в подписке много назначений ролей, получение сведений о них может занять некоторое время.

Можно также проверить существующие назначения ролей для конкретного определения роли с конкретной областью для отдельного пользователя. Введите:

    azure role assignment list -g group1 --upn <user email> -o Owner

Эта команда возвращает все назначения ролей для определенного пользователя в клиенте Active Directory Azure, которому назначена роль Owner для группы ресурсов group1. Назначение роли может иметь два разных источника:

1. Назначение роли "Владелец" пользователю для группы ресурсов.
2. Назначение роли "Владелец" пользователю для родительского объекта группы ресурсов (в этом случае - подписки). Если у вас есть какое-либо разрешение для родительского ресурса, вы получите аналогичное разрешение на доступ ко всем его дочерним ресурсам.

Все параметры этого командлета необязательны. Вы можете использовать их в различных сочетаниях для проверки назначений ролей с разными фильтрами.

## <a id="create"></a>Создание назначения роли ##

При создании назначения роли необходимо учесть перечисленные ниже моменты.

- Кому вы хотите назначить роль? Для просмотра пользователей, групп и субъектов-служб, имеющихся в вашей директории, можно использовать следующие командлеты Azure Active Directory.

    `azure ad user list
    azure ad user show
    azure ad group list
    azure ad group show
    azure ad group member list
    azure ad sp list
    azure ad sp show`

- Какую роль вы хотите назначить? Для просмотра поддерживаемых определений ролей можно использовать следующий командлет:

    `azure role list`

- Какую область вы хотите назначить? Доступны три уровня областей:

    - текущая подписка;
    - Группа ресурсов. Для получения списка групп ресурсов наберите "Список групп Azure"
    - Ресурс. Для получения списка ресурсов наберите "Список ресурсов Azure"

Затем используйте команду "Создать назначение роли Azure" для создания назначения ролей. Например: 

 - Создание назначения роли "Читатель" пользователю на уровне текущей подписки:

    `azure role assignment create --upn <user's email> -o Reader`

- Создание назначения роли на уровне группы ресурсов:

    `PS C:\> azure role assignment create --upn <user's email> -o Contributor -g group1`

- Создание назначения роли на уровне ресурса:

    `azure role assignment create --upn <user's email> -o Owner -g group1 -r Microsoft.Web/sites -u site1`

## <a id="verify"></a>Проверка разрешений ##

Если вашей учетной записи назначены какие-либо роли, вы можете просмотреть, какие именно разрешения предоставляют эти назначения, с помощью следующих командлетов:

    PS C:\> azure group list
    PS C:\> azure resource list

Эти два командлета возвращают только группы ресурсов или ресурсы, для которых у вас есть разрешение на чтение. Они также отображают имеющиеся у вас разрешения.

Затем при попытке выполнить другой командлет, например azure group create, вы получите сообщение об отказе в доступе, если у вас нет соответствующего разрешения.

## <a id="next"></a>Дальнейшие действия ##

Чтобы узнать больше об управлении доступом на основе ролей с помощью xplat-cli, воспользуйтесь следующими ресурсами:

- [Управление доступом на основе ролей в Microsoft Azure](http://azure.microsoft.com/documentation/articles/role-based-access-control-configure/)
- [Установка и настройка межплатформенного интерфейса командной строки Azure](http://azure.microsoft.com/documentation/articles/xplat-cli/)
- [Использование межплатформенного интерфейса командной строки Microsoft Azure совместно с диспетчером ресурсов](http://azure.microsoft.com/documentation/articles/xplat-cli-azure-resource-manager/)
- [Использование групп ресурсов для управления ресурсами Azure](http://azure.microsoft.com/documentation/articles/azure-preview-portal-using-resource-groups): Узнайте, как создать группы ресурсов на портале управления Azure и управлять ими.
- [Блог Azure](http://blogs.msdn.com/windowsazure): Сведения о новых возможностях в Azure.
- [Настройка управления доступом на основе ролей с помощью Windows PowerShell](http://azure.microsoft.com/documentation/articles/role-based-access-control-powershell/)
- [Устранение неполадок при управлении доступом на основе ролей](http://azure.microsoft.com/documentation/articles/role-based-access-control-troubleshooting/)

<!--HONumber=46--> 
