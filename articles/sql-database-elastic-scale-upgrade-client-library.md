<properties 
	title="Upgrade to the Latest Elastic Scale Client Library" 
	pageTitle="Обновление до последней версии клиентской библиотеки эластичного масштабирования" 
	description="Указания по обновлению с помощью PowerShell и C#" 
	metaKeywords="sharding,elastic scale, Azure SQL DB sharding" 
	services="sql-database" 
	documentationCenter="" 
	manager="jhubbard" 
	authors="stuarto", "sidneyh"/>

<tags 
	ms.service="sql-database" 
	ms.workload="sql-database" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="03/05/2015" 
	ms.author="stuarto" />

# Обновление до последней версии клиентской библиотеки эластичного масштабирования

Новые версии клиентской библиотеки эластичного масштабирования доступны на сайте [NuGet](https://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Client/) и через интерфейс диспетчера пакетов NuGet в Visual Studio. В обновленных версиях исправлены ошибки и добавлена поддержка новых возможностей эластичного масштабирования.

## Действия по обновлению

Для выполнения обновления нужно выполнить повторную сборку приложения с использованием новой библиотеки, а также изменить существующие метаданные диспетчера сопоставления сегментов, сохраненные в базах данных SQL Azure, чтобы обеспечить поддержку новых функций.

Выполните приведенные ниже действия, чтобы обновить приложения, базу данных диспетчера сопоставления сегментов и локальные метаданные диспетчера сопоставления сегментов для каждого из сегментов.  В результате выполнения этих действий в указанном порядке предыдущие версии клиентской библиотеки будут удалены из текущей среды, а объекты метаданных обновлены. Это гарантирует, что данные объекты предыдущей версии не будут повторно созданы после обновления.   

**1. Обновите свои приложения.** В Visual Studio скачайте последнюю версию клиентской библиотеки, создайте на нее ссылку во всех проектах эластичного масштабирования, а затем выполните повторную сборку и развертывание. 

 * В Visual Studio выберите **Инструменты** --> **Диспетчер пакетов NuGet** --> **Управление пакетами NuGet для решения**. 
 * На левой панели выберите пункт **Обновления** и нажмите кнопку **Обновить** возле отобразившегося в окне пакета **База данных SQL - библиотека клиента эластичного масштабирования**.
	![Upgrade Nuget Pacakges][1]
 
 * Выполните сборку и развертывание. 

**2. Обновите свои сценарии.** Если для управления сегментами используются сценарии **PowerShell**, [скачайте новую версию библиотеки](https://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Client/) и скопируйте ее в каталог, из которого выполняются сценарии. 

**3. Обновите свои службы разбиения и объединения.** Если для реорганизации сегментированных данных используется служба разбиения и объединения эластичного масштабирования, [скачайте и установите последнюю версию службы](https://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge/). Подробные указания по обновлению данной службы можно найти [здесь](http://azure.microsoft.com/documentation/articles/sql-database-elastic-scale-overview-split-and-merge/). 

**4. Обновите свои базы данных диспетчера сопоставления сегментов**. Обновите метаданные, обслуживающие функцию сопоставления сегментов в базе данных SQL Azure.  Это можно сделать двумя способами - с помощью PowerShell или C#. Ниже описаны оба этих способа.

***Способ 1: обновление метаданных с помощью PowerShell***

1. Скачайте последнюю версию служебной программы командной строки для NuGet [здесь](http://nuget.org/nuget.exe) и сохраните ее в папке. 

2. Откройте командную строку, перейдите к указанной папке и выполните следующую команду:
`nuget install Microsoft.Azure.SqlDatabase.ElasticScale.Client`

3. Перейдите к вложенной папке, в которой сохранена скачанная новая версия клиентской библиотеки DLL, например:
`cd .\Microsoft.Azure.SqlDatabase.ElasticScale.Client.0.8.0\lib\net45`

4. Скачайте сценарий обновления клиента эластичного масштабирования из [Центра сценариев](http://go.microsoft.com/?linkid=9876343) и сохраните его в папке, содержащей библиотеку DLL.

5. Находясь в этой папке, выполните в командной строке команду PowerShell .\upgrade.ps1 и следуйте указаниям на экране.
 
***Способ 2: обновление метаданных с помощью C#***

Создайте приложение Visual Studio, которое открывает диспетчер сопоставления сегментов, выполняет итерацию сегментов и обновляет метаданные с помощью методов [UpgradeLocalStore](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.shardmanagement.shardmapmanager.upgradelocalstore.aspx) и [UpgradeGlobalStore](https://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.shardmanagement.shardmapmanager.upgradeglobalstore.aspx), как в следующем примере: 

	ShardMapManager smm =
	   ShardMapManagerFactory.GetSqlShardMapManager
	   (connStr, ShardMapManagerLoadPolicy.Lazy); 
	smm.UpgradeGlobalStore(); 
	
	foreach (ShardLocation loc in
	 smm.GetDistinctShardLocations()) 
	{   
	   smm.UpgradeLocalStore(loc); 
	} 

Эти методы обновления метаданных могут многократно применяться без каких-либо последствий. Например, если клиент предыдущей версии после обновления случайно создаст какой-либо сегмент, вы сможете повторно обновить все сегменты, чтобы в инфраструктуре использовалась последняя версия метаданных. 

**Примечание.** Имеющиеся на сегодняшний день новые версии клиентской библиотеки поддерживают предыдущие версии метаданных диспетчера сопоставления сегментов, используемые в базе данных SQL Azure, и наоборот. Однако, чтобы воспользоваться преимуществами некоторых новых функций, реализованных в последней версии клиента, необходимо обновить метаданные. Обратите внимание, что обновление метаданных не повлияет на пользовательские данные или данные приложения, но затронет исключительно объекты, созданные и используемые диспетчером сопоставления сегментов. После обновления приложения будут работать как и раньше.

## Версии клиента эластичного масштабирования 

**Версия 0.8, март 2015 г.**

* Добавлена поддержка асинхронной маршрутизации в зависимости от данных с помощью новых методов ShardMap.OpenConnectionForKeyAsync. 
* В ShardMap добавлено общее свойство KeyType. 
* Добавлены некоторые улучшения, поддерживающие сценарии восстановления базы данных и аварийного восстановления сегментов. 

**Версия 0.7, октябрь 2014 г.** 

Исходная предварительная версия 


[AZURE.INCLUDE [elastic-scale-include](../includes/elastic-scale-include.md)]  


<!--Image references-->
[1]:./media/sql-database-elastic-scale-upgrade-client-library/nuget-upgrade.png

<!--HONumber=47-->
