<properties linkid="" urlDisplayName="" pageTitle="" metaKeywords="" description="Узнайте, как использовать пакет Microsoft HPC и Azure для настройки небольшого гибридного кластера для высокопроизводительных вычислений (HPC)" metaCanonical="" services="" documentationCenter="" title="Настройка гибридного кластера с пакетом Microsoft HPC" authors="danlep" solutions="" manager="dongill" editor="mattshel" />



#Настройка гибридного кластера с пакетом Microsoft HPC
В этом учебники показано, как использовать пакет Microsoft HPC 2012 R2 и Azure для настройки небольшого гибридного кластера для высокопроизводительных вычислений (HPC). Кластер будет состоять из локального головного узла (компьютер под управлением операционной системы Windows Server и пакета HPC) и нескольких вычислительных узлов, развертываемых по требованию в качестве экземпляров рабочих ролей в облачной службе Azure. Затем вы сможете выполнять вычислительные задания в гибридном кластере.
 
![Hybrid HPC cluster][Overview] 

В этом учебнике демонстрируется один из способов использования масштабируемых вычислительных ресурсов в Azure, доступных по требованию, для запуска ресурсоемких приложений, который также называют "ускорением в облако".

В этом учебнике предполагается, что у читателя нет опыта работы с вычислительными кластерами или пакетом HPC. Оно предназначено только для того, чтобы помочь вам быстро развернуть кластер для демонстрационных целей. Рекомендации и действия для развертывания гибридного кластера с пакетом HPC большего масштаба в производственной среде см. в [подробном руководстве](http://go.microsoft.com/fwlink/p/?LinkID=200493).

>[WACOM.NOTE] Azure предлагает [различные размеры](http://go.microsoft.com/fwlink/p/?LinkId=389844) для вычислительных ресурсов, подходящие для разных рабочих нагрузок. Например, экземпляры A8 и A9 обеспечивают высокую производительность и доступ к сети приложений с малой задержкой и высокой пропускной способностью, что необходимо для некоторых приложений HPC. Сведения см. в разделе [Экземпляры A8 и A9 с высоким объемом требуемых вычислений: быстрый запуск с пакетом HPC](http://go.microsoft.com/fwlink/p/?Linkid=328042). 

В этом учебнике рассматриваются следующие основные действия:

* [Предварительные требования](#BKMK_Prereq)
* [Установка пакета HPC на головном узле](#BKMK_DeployHN)
* [Подготовка подписки Azure](#BKMK_Prpare)
* [Настройка головного узла](#BKMK_ConfigHN)
* [Добавление узлов Azure в кластер](#BKMK_worker)
* [Запуск узлов Azure](#BKMK_start)
* [Выполнение команды в кластере](#BKMK_RunCommand)
* [Выполнение тестового задания](#BKMK_RunJob)
* [Остановка узлов Azure](#BKMK_stop)

<h2 id="BKMK_Prereq">Предварительные требования</h2>

>[WACOM.NOTE]Для работы с этим учебником требуется учетная запись Azure. Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в разделе <a href="http://www.windowsazure.com/ru-ru/pricing/free-trial/" target="_blank">Бесплатная пробная версия Azure</a>.

Кроме того, для работы с этим учебником потребуется следующее.

* Локальный компьютер под управлением Windows Server 2012 R2 или Windows Server 2012. Этот компьютер будет головным узлом кластера HPC. Если вы еще не установили Windows Server, вы можете загрузить и установить [ознакомительную версию](http://technet.microsoft.com/evalcenter/dn205286.aspx).

	* Компьютер должен быть присоединен к домену Active Directory.

	* Убедитесь, что не установлены дополнительные роли сервера или службы ролей.

	* Для поддержки пакета HPC необходимо установить операционную систему на одном из следующих языков: английский, японский или китайский (упрощенное письмо).

	* Убедитесь, что установлены важные и критические обновления.
	
* Установочные файлы пакета HPC 2012 R2, доступные бесплатно. [Загрузите](http://go.microsoft.com/fwlink/p/?linkid=389557) полный пакета установки и скопируйте файлы на компьютер головного узла или в сетевую папку. Выберите установочные файлы на языке установленной системы Windows Server.

* Учетная запись домена с разрешениями локального администратора на головном узле.

* Подключение по протоколу TCP через порт 443 из головного узла в Azure.

<h2 id="BKMK_DeployHN">Установка пакета HPC на головном узле</h2>

Сначала установите пакет Microsoft HPC на локальном компьютере, который будет головным узлом кластера.

1. Войдите на головной узел с помощью доменной учетной записи с правами локального администратора.

2. Откройте мастер установки пакета HPC, запустив файл Setup.exe пакета HPC.

3. На экране **установки пакета HPC 2012 R2** нажмите кнопку **Новая изолированная установка SQL Server или добавление новых компонентов к существующему экземпляру**.

	![Установка пакета HPC 2012][install_hpc1]

4. На **странице пользователя соглашение по программному обеспечению Майкрософт** нажмите кнопку **Далее**.

5. На странице **Выбор типа установки** нажмите кнопку **Создание кластера HPC с головным узлом** и нажмите кнопку **Далее**.

	![Выбор типа установки][install_hpc2]

6. Мастер выполняет несколько тестов до установки. Нажмите кнопку **Далее** на странице **Правила установки**, если все тесты пройдены. В противном случае ознакомьтесь с предоставленной информацией и внесите необходимые изменения в вашей среде. Затем повторите тесты или, при необходимости, запустите мастер установки еще раз. 

	![Правила установки][install_hpc3]

7. На странице **настройки базы данных HPC** убедитесь, что **головной узел** выбран для всех баз данных HPC, а затем нажмите кнопку **Далее**.

	![Конфигурация базы данных][install_hpc4]

8. Примите параметры по умолчанию на оставшихся страницах мастера. На странице **Установка обязательных компонентов** нажмите кнопку **Установить**.

	![Установка][install_hpc6]

9. После завершения установки снимите флажок **Запустить диспетчер кластеров HPC** и нажмите кнопку **Готово**. (Вы запустите диспетчер кластеров HPC далее для завершения настройки головного узла.)

	![Готово][install_hpc7]

<h2 id="BKMK_Prepare">Подготовка подписки Azure</h2>
Используйте [портал управления](https://manage.windowsazure.com) для выполнения следующих действий с подпиской Azure. Они необходимы для развертывания узлов Azure из локального головного узла. 

- Загрузка сертификата управления (необходим для безопасных соединений между головным узлом и службами Azure)
 
- Создание облачной службы Azure, в которой будут работать узлы Azure (экземпляры рабочей роли)

- Создание учетной записи хранения Azure
	
	>[WACOM.NOTE]Также запишите идентификатор подписки Azure, которая понадобится позже. Его можно найти в <a href="[https://account.windowsazure.com/Subscriptions">сведениях об учетной записи Azure</a>.

<h3>Загрузка сертификата управления по умолчанию</h3>
Пакет HPC устанавливает самозаверяющий сертификат на головном узле с именем "Сертификат управления Microsoft HPC Azure по умолчанию", который можно загрузить как сертификат управления Azure. Этот сертификат предназначен для тестирования и экспериментальных развертываний.

1. На компьютере головного узла войдите на [портал управления](https://manage.windowsazure.com).

2. Нажмите кнопку **Параметры** и щелкните **Сертификаты управления**.

3. На панели команд щелкните **Загрузить**.

	![Параметры сертификата][upload_cert1]

4. На головном узле перейдите к файлу C:\Program Files\Microsoft HPC Pack 2012\Bin\hpccert.cer. Затем нажмите кнопку **Проверить**.

	![Загрузка сертификата][install_hpc10]

В списке сертификатов управления вы увидите **сертификат управления Azure HPC по умолчанию**.

<h3>Создание облачной службы Azure</h3> 

>[WACOM.NOTE]Для повышения производительности рекомендуется создать облачную службу и учетную запись хранения в одном географическом регионе или территориальной группе (если она настроена).

1. На панели команд портала управления нажмите кнопку **Создать**.

2. Щелкните **Среда выполнения приложений**, выберите **Облачная служба**, а затем щелкните **Быстрое создание**.

3. Введите URL-адрес облачной службы и нажмите кнопку **Создать облачную службу**.

	![Создать службу][createservice1]

<h3>Создание учетной записи хранилища Azure</h3>

1. На панели команд портала управления нажмите кнопку **Создать**.

2. Последовательно щелкните **Службы данных**, **Хранилище** и **Быстрое создание**.

3. Введите URL-адрес учетной записи и нажмите кнопку **Создать учетную запись хранения**.

	![Создание хранилища][createstorage1]

<h2 id="BKMK_ConfigHN">Настройка головного узла</h2>

Чтобы развернуть узлы Azure с помощью диспетчера кластеров HPC и отправлять задания, необходимо выполните некоторые действия для настройки кластера. 

1. На головном узле запустите диспетчер кластеров HPC. Если откроется диалоговое окно **Выбор головного узла**, щелкните **Локальный компьютер**. Появится **список дел развертывания**.

2. В разделе **Необходимые задачи развертывания** щелкните **Настроить сеть**.

	![Настройка сети][config_hpc2]

3. В мастере настройки сети выберите параметр **Все узлы только в корпоративной сети** (топология 5).

	![Топология 5][config_hpc3] 

	>[WACOM.NOTE]Это простейшая конфигурация для демонстрационных целей, поскольку головному узлу для подключения к Active Directory и Интернету требуется только один сетевой адаптер. В этом учебнике не рассматриваются сценарии, в которых кластеру требуются дополнительные сети. 
	 
4. Нажмите кнопку **Далее**, чтобы принять значения по умолчанию на оставшихся страницах мастера. Затем на вкладке **Просмотр** щелкните **Настройка** для завершения настройки сети.

5. В **списке дел развертывания** щелкните **Ввести учетные данные установки**. 

6. В диалоговом окне **Учетные данные установки** введите учетные данные доменной учетной записи, которая использовалась для установки пакета HPC. Нажмите кнопку **ОК**.

	![Учетные данные установки][config_hpc6]

	>[WACOM.NOTE]Службы пакета HPC используют учетные данные установки только для развертывания локальных вычислительных узлов.
	
7. В **списке дел развертывания** щелкните **Настроить именование новых узлов**. 

8. В диалогового окна **Указать серию именования узлов** примите значение по умолчанию и нажмите кнопку **ОК**.

	![Именование узлов][config_hpc8]

	>[WACOM.NOTE]Серия именования формирует только имена для вычислительных узлов, присоединенных к домену. Узлы Azure именуются автоматически.
	  
9. В **списке дел развертывания** щелкните **Создать шаблон узла**. Этот шаблон будет использоваться для добавления узлов Azure в кластер.

10. В окне мастера создания узла шаблона выполните следующие действия.

	а. На странице **Выбор типа шаблона узла** щелкните **Шаблон узла Azure** и нажмите кнопку **Далее**.

	![Шаблон узла][config_hpc10]

	б. Нажмите кнопку **Далее**, чтобы принять имя шаблона по умолчанию.

	в. На странице **Укажите сведения о подписке** введите свой идентификатор подписки Azure (он доступен в <a href="[https://account.windowsazure.com/Subscriptions">сведениях об учетной записи Azure</a>). Затем в разделе **Сертификат управления** нажмите кнопку **Обзор** и выберите **Управление HPC Azure по умолчанию.** Нажмите кнопку **Далее**.

	![Шаблон узла][config_hpc12]

	г. На странице **Укажите сведения о службе** выберите облачную службу и учетную запись хранения, созданную на предыдущем шаге. Нажмите кнопку **Далее**.

	![Шаблон узла][config_hpc13]

	д. Нажмите кнопку **Далее**, чтобы принять значения по умолчанию на оставшихся страницах мастера. Затем на вкладке **Просмотр** нажмите кнопку **Создать**, чтобы создать шаблон узла.

	>[WACOM.NOTE]По умолчанию шаблон узла Azure содержит параметры для запуска (подготовки) и остановки узлов вручную. Вы также можете настроить расписание для автоматического запуска и остановки узлов Azure. 
	
<h2 id="#BKMK_worker">Добавление узлов Azure в кластер</h2>

Этот шаблон будет использоваться для добавления узлов Azure в кластер. При добавлении узлов в кластер сведения об их конфигурации сохраняется, что позволяет запускать (настраивать) их в любое время в качестве экземпляров ролей в облачной службе. Плата за узлы Azure взимается с вашей подписки только после запуска экземпляров ролей в облачной службе.

В этом учебнике вы добавите два мелких узла.

1. В диспетчере кластеров HPC в разделе **Управление узлами** в области **действий** нажмите кнопку **Добавить узел**. 

	![Добавление узла][add_node1]

2. В окне мастера добавления узла на странице **Выбор метода развертывания** нажмите кнопку **Добавить узлы Azure**, а затем нажмите кнопку **Далее**.

	![Добавление узла Azure][add_node1_1]

3. На странице **Укажите новые узлы** выберите созданный ранее шаблон узла Azure (который по умолчанию называется **шаблоном узла Azure по умолчанию**). Затем укажите узлы **2** **мелких** узла и нажмите кнопку **Далее**.

	![Указание узлов][add_node2]

	Сведения о доступных размерах виртуальных машин см. в разделе [Размеры виртуальных машин и облачных служб в Azure](http://msdn.microsoft.com/library/windowsazure/dn197896.aspx).

4. На **последней странице мастера добавления узла** нажмите кнопку **Готово**. 

	 Два узла Azure с именем **AzureCN-0001** и **AzureCN-0002** появятся в диспетчере кластеров HPC. Они находятся в состоянии **Не развернуто**.

	![Добавленные узлы][add_node3]

<h2 id="BKMK_Start">Запуск узлов Azure</h2>
При необходимости использовать ресурсы кластера в Azure используйте диспетчер кластеров HPC, чтобы запустить (подготовить) узлы Azure и перевести их в оперативный режим.

1.	В диспетчере кластеров HPC в разделе **Управление узлами** выберите один или оба узла, а затем в области **действий** нажмите кнопку **Пуск**. 

	![Запуск узлов][add_node4]

2. В диалоговом окне **Запуск узлов Azure** нажмите кнопку **Пуск**.

	![Запуск узлов][add_node5]
 
	Узлы перейдут в состояние **подготовки**. Для отслеживания хода подготовки можно просматривать журнал подготовки.

	![Подготовка узлов][add_node6]

3. Через несколько минут подготовка узлов Azure завершится, и они перейдут в **автономное** состояние. В этом состоянии экземпляры ролей выполняются, но еще не принимают задания кластера.

4. Чтобы убедиться, что экземпляры ролей выполняются, на [портале управления](https://manage.windowsazure.com) щелкните **Облачные службы**, затем выберите имя вашей облачной службы и щелкните **Экземпляры**. 

	![Выполняющиеся экземпляры][view_instances1]

	Вы увидите два запущенных экземпляра рабочей роли в службе. Пакет HPC также автоматически развертывает два экземпляра **HpcProxy** (среднего размера) для обработки взаимодействия между головным узлом и Azure.

5. Чтобы перевести узлы Azure в оперативный режим для выполнения заданий кластера, выберите узлы, щелкните правой кнопкой мыши и выберите команду **Перевести в оперативный режим**.

	![Автономные узлы][add_node7]
 
	Диспетчер кластеров HPC покажет, что узлы находятся в **оперативном** состоянии.

<h2 id="BKMK_RunCommand">Выполнение команды в кластере</h2>	
Команду **clusrun** пакета HPC можно использовать для выполнения команды или запуска приложения в одном или нескольких узлах кластера. В качестве простого примера выполните команду **clusrun**, чтобы получить конфигурацию IP-адресов узлов Azure.

1. На головном узле откройте командную строку.

2. Введите следующую команду:

	`clusrun /nodes:azurecn* ipconfig`

3. Вы должны увидеть результаты, аналогичные следующим.

	![Clusrun][clusrun1]

<h2 id="BKMK_RunJob">Выполнение тестового задания</h2>

Вы можете отправить тестовое задание, которое выполняется на гибридном кластере. Это пример простого задания "параметрического анализ" (тип классических параллельных вычислений), которое выполняется подзадачи, добавляющие целое число с помощью команды **set /a**. Все узлы в кластере участвуют в выполнения подзадач для целых чисел от 1 до 100. 

1. В диспетчере кластеров HPC в разделе **Управление заданиями** в области **действий** щелкните **Создать задание параметрического анализа**.

	![Новое задание][test_job1]

2. В диалоговом окне **Создание задания параметрического анализа** в **командной строке** введите `set /a *+*` (замените команду, которая отображается по умолчанию). Оставьте значения по умолчанию для остальных параметров и нажмите кнопку **Отправить**, чтобы отправить задание.

	![Параметрический анализ][param_sweep1]

3. После завершения задания дважды щелкните задание **Моя задача анализа**.

4. Нажмите кнопку **Просмотреть задачи** и щелкните подзадачу, чтобы просмотреть результаты выполнения подзадачи.

	![Результаты выполнения задачи][view_job361]

5. Для просмотра узла, который выполняет расчет для этой подзадачи, щелкните **Выделенные узлы**. (Кластер может показывать другое имя узла).

	![Результаты выполнения задачи][view_job362]

<h2 id="BKMK_stop">Остановка узлов Azure</h2>

После тестирования кластера вы можете использовать диспетчер кластеров HPC для остановки узлов Azure, чтобы избежать ненужных расходов для вашей учетной записи. При этом облачная служба будет остановлена, а экземпляры ролей Azure будут удалены. 

1. В диспетчере кластеров HPC в разделе **Управление узлами** выберите оба узла Azure. Затем в области **действий** нажмите кнопку **Остановить**. 

	![Остановка узлов][stop_node1]

2. В диалоговом окне **Остановка узлов Azure** нажмите кнопку **Остановить**.

	![Остановка узлов][stop_node2]

3. Узлы перейдут в состояние **Остановка**. Через несколько минут диспетчер кластеров HPC покажет, что узлы находятся в состоянии **Не развернуто**.

	![Неразвернутые узлы][stop_node4]

4. Чтобы убедиться, что экземпляры ролей больше выполняются в Azure, на [портале управления](https://manage.windowsazure.com) щелкните **Облачные службы**, затем выберите имя вашей облачной службы и щелкните **Экземпляры**. В производственной среде будут отсутствовать развернутые экземпляры.

	![Нет экземпляров][view_instances2]

	На этом учебник завершен.

<h2 id="">Связанные ресурсы</h2>

* [Пакет HPC 2012 R2 и HPC 2012](http://go.microsoft.com/fwlink/p/?LinkID=263697)
* [Ускорение в Azure с помощью пакета Microsoft HPC](http://go.microsoft.com/fwlink/p/?LinkID=200493)
* [Развертывание приложений на узлах Azure](http://go.microsoft.com/fwlink/p/?LinkId=325317)
* [Пакет Microsoft HPC на виртуальной машине Azure](http://go.microsoft.com/fwlink/p/?linkid=330375)


[Overview]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/hybrid_cluster_overview.png
[install_hpc1]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/install_hpc1.png
[install_hpc2]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/install_hpc2.png
[install_hpc3]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/install_hpc3.png
[install_hpc4]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/install_hpc4.png
[install_hpc6]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/install_hpc6.png
[install_hpc7]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/install_hpc7.png
[install_hpc10]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/install_hpc10.png
[upload_cert1]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/upload_cert1.png
[createstorage1]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/createstorage1.png
[createservice1]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/createservice1.png
[config_hpc2]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/config_hpc2.png
[config_hpc3]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/config_hpc3.png
[config_hpc6]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/config_hpc6.png
[config_hpc8]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/config_hpc8.png
[config_hpc10]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/config_hpc10.png
[config_hpc12]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/config_hpc12.png
[config_hpc13]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/config_hpc13.png
[add_node1]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/add_node1.png
[add_node1_1]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/add_node1_1.png
[add_node2]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/add_node2.png
[add_node3]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/add_node3.png
[add_node4]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/add_node4.png
[add_node5]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/add_node5.png
[add_node6]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/add_node6.png
[add_node7]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/add_node7.png
[view_instances1]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/view_instances1.png
[clusrun1]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/clusrun1.png
[test_job1]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/test_job1.png
[param_sweep1]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/param_sweep1.png
[view_job361]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/view_job361.png
[view_job362]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/view_job362.png
[stop_node1]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/stop_node1.png
[stop_node2]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/stop_node2.png
[stop_node4]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/stop_node4.png
[view_instances2]: ./media/set-up-hybrid-cluster-microsoft-hpc-pack-2012-sp1/view_instances2.png

