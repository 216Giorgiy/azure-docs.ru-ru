<properties
	pageTitle="Хранилище Premium: высокопроизводительное хранилище для рабочих нагрузок виртуальных машин Azure | Microsoft Azure"
	description="Хранилище Premium обеспечивает поддержку дисков с высокой производительностью и малой задержкой для интенсивных рабочих нагрузок ввода-вывода на виртуальных машинах Azure. Виртуальные машины Azure серии DS и GS поддерживают хранилище класса Premium."
	services="storage"
	documentationCenter=""
	authors="ms-prkhad"
	manager=""
	editor="tysonn"/>

<tags
	ms.service="storage"
	ms.workload="storage"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="11/04/2015"
	ms.author="tamram;selcint"/>


# Хранилище Premium: высокопроизводительное хранилище для рабочих нагрузок виртуальных машин Azure

## Обзор

Хранилище Azure Premium обеспечивает поддержку дисков с высокой производительностью и малой задержкой для виртуальных машин с интенсивной рабочей нагрузкой ввода-вывода. Диски виртуальной машины, использующие хранилище класса Premium, хранят данные на твердотельных накопителях. Диски виртуальной машины приложения можно перенести в хранилище Azure класса Premium, чтобы использовать их быстродействие и производительность.

Виртуальная машина Azure поддерживает подключение нескольких дисков хранилища класса Premium, позволяя приложениям занимать до 64 ТБ памяти на машину. С хранилищем Premium вы получите выполнение до 80 000 операций ввода-вывода в секунду на виртуальную машину и пропускную способность второго диска до 2000 МБ в секунду на виртуальную машину с очень низкой задержкой при операциях чтения.

>[AZURE.NOTE]Для оптимальной работы приложения рекомендуем переносить все диски виртуальных машин, требующие большого числа операций ввода-вывода в секунду, в хранилище Azure класса Premium. Если диск не требует большого числа операций ввода-вывода в секунду, выберите более доступное хранилище уровня Standard — в этом случае данные с диска виртуальной машины будут храниться не на твердотельных, а на жестких дисках.

Чтобы приступить к работе с хранилищем Azure Premium, зайдите на [страницу бесплатной ознакомительной регистрации](http://azure.microsoft.com/pricing/free-trial/). Сведения о переносе существующих виртуальных машин в хранилище класса Premium см. в статье [Перенос в хранилище Azure Premium](storage-migration-to-premium-storage.md).

## Важная информация о хранилище Premium

Ниже приведен список важных моментов, которые следует учитывать перед использованием хранилища Premium или во время его использования.

- Для использования хранилища Premium необходимо иметь учетную запись хранилища Premium. Чтобы узнать, как создать учетную запись хранилища Premium, см. раздел [Создание и использование учетной записи хранения Premium для дисков](#create-and-use-a-premium-storage-account-for-a-virtual-machine-data-disk).

- Хранилище Premium в настоящее время предоставляется на [портале предварительной версии Microsoft Azure](https://portal.azure.com/), и доступ к нему осуществляется с помощью следующих библиотек SDK: [API-интерфейс REST служб хранилища](http://msdn.microsoft.com//library/azure/dd179355.aspx) версии 2014-02-14 или более поздней; [API-интерфейс REST управления службами](http://msdn.microsoft.com/library/azure/ee460799.aspx) версии 2014-10-01 или более поздней; [Azure PowerShell](../install-configure-powershell.md) версии 0.8.10 или более поздней.

- Список регионов, которые в настоящее время поддерживают хранилище класса Premium, см. в статье [Службы Azure по регионам](http://azure.microsoft.com/regions/#services).

- Хранилище Premium поддерживает только страничные BLOB-объекты Azure, которые используются для хранения постоянных дисков для виртуальных машин Azure. Сведения о страничных BLOB-объектах Azure см. в статье [Основные сведения о блочных и страничных BLOB-объектах](http://msdn.microsoft.com/library/azure/ee691964.aspx). Хранилище Premium не поддерживает блочные BLOB-объекты Azure,файлы Azure, таблицы Azure и очереди Azure.

- Учетная запись хранилища Premium — локально избыточная (LRS), то есть в ней сохраняется три копии данных в пределах одной области. Вопросы, касающиеся георепликации при использовании хранилища Premium, рассматриваются в разделе [Моментальные снимки и копирование BLOB-объектов при использовании хранилища Premium](#snapshots-and-copy-blob-whru-RUing-premium-storage) этой статьи.

- Если вы хотите использовать учетную запись хранилища Premium для дисков виртуальной машины, необходимо использовать виртуальные машины серии DS или GS. С виртуальными машинами серии DS или GS можно использовать диски хранилища Standard и Premium. Однако диски хранилища Premium невозможно использовать с виртуальными машинами других серий. Сведения о доступных типах и размерах дисков виртуальных машин Azure см. в статье [Размеры виртуальных машин и облачных служб для Azure.](http://msdn.microsoft.com/library/azure/dn197896.aspx).

- Диски хранилища Premium для виртуальной машины настраиваются так же, как и диски хранилища Standard. Необходимо выбрать вариант хранилища Premium, который оптимально соответствует вашим дискам и виртуальной машине Azure. Размер виртуальной машины должен отвечать рабочей нагрузке в соответствии с характеристиками предложенных хранилищ Premium. Дополнительные сведения см. в разделе [Целевые показатели по масштабируемости и производительности при использовании хранилища Premium](#scalability-and-performance-targets-whru-RUing-premium-storage).

- Учетную запись хранилища Premium невозможно сопоставить с именем личного домена.

- В настоящее время аналитика хранилища Premium не поддерживается. Для анализа показателей производительности виртуальных машин, которые используют диски в учетных записях хранилища Premium, рекомендуем применять встроенные средства операционной системы, такие как [Системный монитор Windows](https://technet.microsoft.com/library/cc749249.aspx) для машин на базе Windows и [IOSTAT](http://linux.die.net/man/1/iostat) для машин на базе Linux. Можно также включить диагностику виртуальных машин Azure на портале предварительной версии Azure. Подробные сведения см. в разделе [Мониторинг виртуальной машины Microsoft Azure с помощью расширения диагностики Azure](http://azure.microsoft.com/blog/2014/09/02/windows-azure-virtual-machine-monitoring-with-wad-extension/).

## Использование хранилища Premium для дисков
Хранилище Premium можно использовать для дисков одним из двух способов.

- Вы можете сначала создать новую учетную запись хранилища Premium, а затем использовать ее при создании виртуальной машины.
- Создайте виртуальную машину серии DS или GS. При создании виртуальной машины можно выбрать ранее созданную учетную запись хранилища Premium, создать новую учетную запись или воспользоваться функцией автоматического создания учетной записи Premium по умолчанию на портале Azure.

Служба Azure использует учетную запись хранилища как контейнер для операционной системы (ОС) и дисков данных. Другими словами, если вы создадите виртуальную машину Azure серии DS или GS и выберете учетную запись хранилища Azure Premium, ваша операционная система и диски данных будут храниться в этой учетной записи хранилища.

Сведения о переносе существующих виртуальных машин в хранилище класса Premium см. в статье [Перенос в хранилище Azure Premium](storage-migration-to-premium-storage.md).

Чтобы воспользоваться преимуществами хранилища Premium, сначала создайте учетную запись хранилища типа *Premium\_LRS*. Для этого можно использовать [портал предварительной версии Microsoft Azure](https://portal.azure.com/), [оболочку Azure PowerShell](../install-configure-powershell.md) или [API REST управления службами](http://msdn.microsoft.com/library/azure/ee460799.aspx). Пошаговые инструкции см. в разделе [Создание и использование учетной записи хранилища Premium для дисков](#create-and-use-a-premium-storage-account-for-a-virtual-machine-data-disk).

### Важные примечания.

- Сведения об ограничениях емкости и пропускной способности для учетных записей хранилища Premium см. в разделе [Целевые показатели по масштабируемости и производительности при использовании хранилища Premium](#scalability-and-performance-targets-whru-RUing-premium-storage). Если потребности вашего приложения превышают целевые показатели по масштабируемости для отдельной учетной записи хранилища, при создании приложения настройте его на использование нескольких учетных записей хранилища и распределите данные между этими учетными записями. Например, если необходимо присоединить диски объемом 51 терабайт (ТБ) на нескольких виртуальных машинах, распределите их между двумя учетными записями хранилища, так как максимальный размер, поддерживаемый одной учетной записью хранилища Premium, составляет 35 ТБ. В одной учетной записи хранилища Premium не должно быть подготовленных к работе дисков объемом более 35 ТБ.
- По умолчанию для политики кэширования дисков задано значение «только чтение» для всех дисков с данными Premium и «чтение и запись» для дисков операционной системы Premium, подключенных к виртуальной машине. Этот параметр конфигурации рекомендуется использовать, чтобы достичь оптимальной производительности при операциях ввода-вывода для приложения. Отключите кэширование дисков данных, которые отличаются высокой интенсивностью записи или используются только для записи (например, файлов журналов SQL Server), чтобы улучшить производительность приложения.
- Убедитесь, что виртуальная машина имеет достаточную пропускную способность для поддержки трафика диска. Например, для виртуальной машины STANDARD\_DS1 выделенный канал для обмена данными с дисками хранилища Premium составляет 32 МБ в секунду. Это означает, что скорость передачи данных для диска P10 хранилища Premium, подключенного к такой виртуальной машине, составляет не более 32 МБ в секунду и не может достигать 100 МБ в секунду, которые способен обеспечить диск P10. Аналогичным образом для виртуальной машины STANDARD\_DS13 максимальная пропускная способность по всем дискам составляет 256 МБ в секунду. В настоящее время максимальный размер виртуальных машин серии DS — это STANDARD\_DS14, который обеспечивает пропускную способность до 512 МБ в секунду по всем дискам. Самой большой виртуальной машиной серии GS является STANDARD\_GS5 — она способна выдать до 2000 МБ в секунду на всех дисках.

	Обратите внимание на то, что эти ограничения действуют только в отношении трафика диска без учета данных, извлекаемых из кэша, и сетевого трафика. Для сетевого трафика виртуальных машин предназначен отдельный канал, который отличается от выделенного канала для дисков хранилища Premium.
	
	Актуальные сведения о максимальных значениях количества операций ввода-вывода в секунду и пропускной способности для виртуальных машин серии DS и GS см. в разделе [Размеры виртуальных машин и облачных служб для Azure](http://msdn.microsoft.com/library/azure/dn197896.aspx). Сведения о дисках, используемых в хранилищах класса Premium, количества операций ввода-вывода в секунду и ограничениях пропускной способности см. в таблице раздела [Целевые показатели по масштабируемости и производительности при использовании хранилища Premium](#scalability-and-performance-targets-whru-RUing-premium-storage) данной статьи.

> [AZURE.NOTE]Выделенная для диска пропускная способность и скорость ввода-вывода не ограничивают извлечение данных из кэша. Это означает, что при использовании на виртуальной машине серии DS или GS диска данных, кэш которого настроен только для чтения, указанные ограничения для дисков хранилища Premium не распространяются на операции чтения данных из кэша. Это позволяет добиться очень высокой пропускной способности при работе с диском, если основная рабочая нагрузка связана с чтением. Обратите внимание на то, что для операций с кэшем действуют отдельные ограничения на скорость ввода-вывода и пропускную способность на уровне виртуальной машины в зависимости от ее размера. Для машин серии DS они составляют приблизительно 4000 операций ввода-вывода в секунду и 33 МБ в секунду на ядро для кэша и для операций с локальным SSD-накопителем.

- На одной виртуальной машине серии DS или GS можно одновременно использовать диски хранилищ Premium и Standard.
- С помощью хранилища Premium можно подготовить виртуальную машину серии DS и подключить несколько дисков с постоянными данными к виртуальной машине. Если необходимо увеличить емкость и производительность тома, вы можете создать на дисках чередующийся том. Если вы создаете чередующийся том на дисках данных хранилища Premium с помощью [дисковых пространств](http://technet.microsoft.com/library/hh831739.aspx), необходимо настроить по одному столбцу для каждого используемого диска. В противном случае общая производительность чередующегося тома может быть ниже ожидаемой из-за неравномерного распределения трафика между дисками. По умолчанию пользовательский интерфейс диспетчера серверов позволяет настроить столбцы для 8 дисков. Однако при наличии более 8 дисков необходимо использовать PowerShell для создания тома, а также вручную указать число столбцов. В противном случае пользовательский интерфейс диспетчера сервера продолжит настраивать по 8 столбцов, даже если у вас больше дисков. Например, если у вас есть 32 диска в одном чередующемся наборе, необходимо указать 32 столбца. Чтобы указать количество столбцов, используемых виртуальным диском, можно воспользоваться параметром *NumberOfColumns* командлета PowerShell [New-VirtualDisk](http://technet.microsoft.com/library/hh848643.aspx). Дополнительные сведения см. в статьях [Развертывание дисковых пространств на автономном сервере](http://technet.microsoft.com/library/jj822938.aspx) и [Часто задаваемые вопросы о дисковых пространствах](http://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx).
- Старайтесь не добавлять виртуальные машины серии DS в существующие облачные службы, в которых используются машины других серий. Возможное решение ‑ миграция существующих виртуальных жестких дисков в новую облачную службу, в которой работают только виртуальные машины серии DS. Чтобы сохранить тот же виртуальный IP-адрес для новой облачной службы с машинами серии DS, можно воспользоваться средством [Зарезервированный общедоступный IP-адрес](virtual-networks-configure-vnet-to-vnet-connection.md). Виртуальные машины серии GS можно добавлять в существующую облачную службу, которая поддерживает только виртуальные машины серии G.
- Виртуальные машины Azure серии DS можно настроить для использования дисков с операционной системой (ОС) как в учетной записи хранилища Standard, так и в учетной записи хранилища Premium. Если диск c ОС применяется только для загрузки, рекомендуем использовать такой диск с хранилищем Standard. Это позволяет уменьшить траты и получить после загрузки производительность, аналогичную производительности хранилища Premium. Если кроме загрузки диск с ОС выполняет еще какие-либо операции, используйте хранилище Premium, чтобы повысить их производительность. Например, если ваше приложение выполняет чтение и запись данных на диске с ОС, хранилище Premium обеспечит более высокую производительность вашей виртуальной машины.
- С хранилищем Premium можно использовать [интерфейс командной строки Azure (Azure CLI)](../xplat-cli-install.md). Чтобы сменить политику кэширования на одном из дисков с помощью Azure CLI, выполните следующую команду:

	`$ azure vm disk attach -h ReadOnly <VM-Name> <Disk-Name>`

	Обратите внимание, что для политики кэширования можно выбрать варианты «только чтение», «ни то ни другое» или «чтение и запись». Чтобы ознакомиться с другими параметрами, вызовите справку, выполнив следующую команду:

	`azure vm disk attach --help`


## Целевые показатели по масштабируемости и производительности при использовании хранилища Premium

Во время подготовки диска для использования в учетной записи хранилища Premium количество поддерживаемых им операций ввода-вывода в секунду и его пропускная способность (полоса пропускания) зависят от размера диска. В настоящее время существует три типа дисков хранилища Premium: P10, P20 и P30. Каждый из них отличается определенными ограничениями относительно количества операций ввода-вывода в секунду и пропускной способности, которые указаны в следующей таблице.

<table border="1" cellspacing="0" cellpadding="5" style="border: 1px solid #000000;">
<tbody>
<tr>
	<td><strong>Тип диска хранилища Premium</strong></td>
	<td><strong>P10</strong></td>
	<td><strong>P20</strong></td>
	<td><strong>P30</strong></td>
</tr>
<tr>
	<td><strong>Размер диска</strong></td>
	<td>128&#160;ГБ</td>
	<td>512&#160;ГБ</td>
	<td>1024&#160;ГБ (1&#160;ТБ)</td>
</tr>
<tr>
	<td><strong>Количество операций ввода-вывода в секунду на диск</strong></td>
	<td>500</td>
	<td>2300</td>
	<td>5000</td>
</tr>
<tr>
	<td><strong>Пропускная способность на диск</strong></td>
	<td>100&#160;МБ в секунду&#160;*</td>
	<td>150&#160;МБ в секунду&#160;*</td>
	<td>200&#160;МБ в секунду&#160;*</td>
</tr>
</tbody>
</table>

> [AZURE.NOTE]Убедитесь, что виртуальная машина обладает достаточной пропускной способностью для обслуживания трафика диска (см. раздел [Использование хранилища Premium для дисков](#using-premium-storage-for-disks) выше в этой статье). В противном случае пропускная способность и скорость ввода-вывода при обмене данными с диском будет ограничена более низкими значениями для виртуальной машины вместо значений, указанных в предыдущей таблице.

Служба Azure сопоставляет размер диска (округленный) с ближайшим вариантом диска хранилища Premium, как указано в таблице. Например, диск размером 100 ГБ классифицируется как диск P10 и поддерживает до 500 операций ввода-вывода в секунду, а также пропускную способность до 100 МБ/с. Аналогичным образом диск размером 400 ГБ классифицируется как диск P20 и поддерживает до 2300 операций ввода-вывода в секунду, а также пропускную способность до 150 МБ/с.

Размер единицы операции ввода-вывода составляет 256 КБ. Если размер передаваемых данных меньше 256 КБ, они считаются одной единицей операции ввода-вывода. Данные большего размера подсчитываются путем сложения размеров нескольких единиц операций ввода-вывода по 256 КБ. Например, данные операции ввода-вывода размером 1100 КБ считаются пятью единицами операций ввода-вывода.

Предельная пропускная способность включает операции записи на диск, а также все операции чтения, которые не обслуживаются кэшем. Например, сумма операций некэшированного чтения и записи должна быть меньше или равна 100 МБ в секунду для диска P10. Аналогичным образом один диск P10 поддерживает операции некэшированного чтения и записи данных со скоростью 100 МБ в секунду, то есть, например, чтение со скоростью 60 МБ в секунду при записи со скоростью 40 МБ в секунду.

При создании дисков в службе Azure выберите наиболее подходящий вариант диска хранилища Premium. При этом учтите потребности вашего приложения с точки зрения емкости, производительности, масштабируемости и пиковых нагрузок.

> [AZURE.NOTE]Размер существующих дисков можно легко увеличить. Например, диск размером 30 ГБ можно расширить до 128 ГБ или 1 ТБ. Вы также можете преобразовать диск P20 в диск P30, если вам потребуется дополнительная пропускная способность и скорость ввода-вывода. Расширить диск можно с помощью командлета PowerShell “Update-AzureDisk” со свойством “-ResizedSizeInGB”. Для выполнения этой операции необходимо отключить диск от виртуальной машины либо остановить машину.

В следующей таблице описаны целевые показатели по масштабируемости для учетных записей хранилища Premium.

<table border="1" cellspacing="0" cellpadding="5" style="border: 1px solid #000000;">
<tbody>
<tr>
	<td><strong>Общая емкость учетной записи</strong></td>
	<td><strong>Общая пропускная способность для учетной записи локально избыточного хранилища</strong></td>
</tr>
<tr>
	<td>
	<ul>
       <li type=round>Емкость диска: 35 ТБ</li>
       <li type=round>Емкость моментальных снимков: 10 ТБ</li>
    </ul>
	</td>
	<td>До 50 гигабит в секунду для входящих и исходящих подключений</td>
</tr>
</tbody>
</table>

- Под входящими подключениями подразумеваются все данные (запросы), отправляемые в учетную запись хранилища.
- Под исходящими подключениями подразумеваются все данные (ответы), получаемые от учетной записи хранилища.

Дополнительные сведения см. в статье [Целевые показатели масштабируемости и производительности хранилища Azure](http://msdn.microsoft.com/library/azure/dn249410.aspx).

## Регулирование при использовании хранилища Premium
Регулирование может осуществляться, если количество операций ввода-вывода в секунду или пропускная способность приложения превышают ограничения, установленные для диска хранилища Premium, либо общий трафик по всем дискам виртуальной машины превышает установленное для нее ограничение пропускной способности. Чтобы избежать этого, рекомендуется ограничить число выполняемых операций ввода-вывода для подготовленного вами диска с учетом целевых показателей его масштабируемости и производительности, а также показателей пропускной способности дисков виртуальной машины.

Приложение может обеспечить минимальную задержку, если оно разработано для предотвращения регулирования. С другой стороны, если количество ожидающих операций ввода-вывода для диска слишком мало, приложение не может обеспечить максимальные уровни количества операций ввода-вывода в секунду и пропускной способности, доступные для диска.

В следующих примерах показано, как подсчитать уровни регулирования.

### Пример 1
Приложение выполнило 495 операций ввода-вывода данных размером 16 КБ (что равно 495 единицам операций ввода-вывода) в секунду на диске P10. При попытке ввода-вывода данных размером 2 МБ в течение этой же секунды общее количество операций ввода-вывода равно 495 + 8. Это обусловлено тем, что при операции ввода-вывода данных размером 2 МБ данные вычисляются по формуле 2048 КБ / 256 КБ = 8 единиц операций ввода-вывода, если размер единицы составляет 256 КБ. Так как сумма 495 + 8 превышает ограничение в 500 операций ввода-вывода в секунду для диска, будет выполнено регулирование.

### Примечание.
Все расчеты основаны на размере единицы операции ввода-вывода в 256 КБ.

### Пример 2
Приложение выполнило 400 операций ввода-вывода данных размером 256 КБ на диске P10. Общая использованная пропускная способность равна (400*256)/1024 = 100 МБ/с. Обратите внимание, что 100 МБ в секунду — это предельное значение пропускной способности для диска P10. Если приложение попытается выполнить больше операций ввода-вывода в течение этой же секунды, в результате превышения ограничения будет выполнено регулирование.

### Пример 3
У вас виртуальная машина DS4, к которой подключены два диска P30. Каждый диск P30 рассчитан на пропускную способность до 200 МБ в секунду. Однако общая пропускная способность виртуальной машины DS4 составляет 256 МБ в секунду. Таким образом, использовать на этой машине DS4 одновременно оба диска на максимальной скорости нельзя. В данном случае можно поддерживать интенсивность трафика для одного диска на уровне 200 МБ в секунду, а для второго — 56 МБ в секунду. Если суммарный объем трафика для обоих дисков превышает 256 МБ в секунду, активируется регулирование.

### Примечание.
Если трафик диска в основном включает операции ввода-вывода данных небольших размеров, весьма вероятно, что приложение достигнет ограничения операций ввода-вывода в секунду до ограничения пропускной способности. С другой стороны, если трафик диска в основном включает операции ввода-вывода данных больших размеров, весьма вероятно, что приложение достигнет ограничения пропускной способности вместо предельного количества операций ввода-вывода в секунду. Вы можете максимально увеличить количество операций ввода-вывода в секунду, выполняемых приложением, и его пропускную способность, выполняя операции ввода-вывода данных оптимальных размеров, а также ограничив число ожидающих операций ввода-вывода для диска.

## Моментальные снимки и копирование больших двоичных объектов при использовании хранилища Premium
Вы можете создать моментальный снимок для хранилища Premium таким же образом, как создаете моментальный снимок при использовании хранилища Standard. Так как хранилище Premium является локально избыточным, рекомендуется создавать моментальные снимки, а затем копировать их в учетную запись геоизбыточного хранилища Standard. Дополнительные сведения см. в статье [Варианты избыточности хранилища Azure](http://msdn.microsoft.com/library/azure/dn727290.aspx).

Если диск подключен к виртуальной машине, определенные операции API запрещены на страничном BLOB-объекте, используемом для создания резервной копии диска. Например, на подключенном диске невозможно выполнить операцию [Copy Blob](http://msdn.microsoft.com/library/azure/dd894037.aspx) (копирования большого двоичного объекта). С этой целью создайте вначале моментальный снимок этого большего двоичного объекта, используя метод REST API [Snapshot Blob](http://msdn.microsoft.com/library/azure/ee691971.aspx), а затем выполните операцию [Copy Blob](http://msdn.microsoft.com/library/azure/dd894037.aspx) с моментальным снимком, чтобы скопировать подключенный диск. Также можно отключить диск, а затем выполнить все необходимые операции с базовым BLOB-объектом.

### Важные примечания.

- Предельное количество моментальных снимков для BLOB-объекта — 100. Моментальный снимок можно делать максимум не чаще одного раза в 10 минут.
- Максимальная емкость для моментальных снимков на учетную запись хранилища класса Premium — 10 ТБ. Обратите внимание, что емкость моментального снимка означает суммарный объем данных только в снимках и не включает данные, расположенные в большом двоичном объекте базы.
- Чтобы поддерживать геоизбыточные копии ваших моментальных снимков, вы можете копировать снимки из учетной записи хранения класса Premium путем использования AzCopy или Copy Blob. Дополнительные сведения см. в статьях [Приступая к работе со служебной программой командной строки AzCopy](storage-use-azcopy.md) и [Копирование большого двоичного объекта](http://msdn.microsoft.com/library/azure/dd894037.aspx).
- Подробную информацию о выполнении операций REST со страничными BLOB-объектами в учетных записях хранилища Premium см. в статье [Использование операций службы BLOB-объектов с хранилищем Azure Premium](http://go.microsoft.com/fwlink/?LinkId=521969) в библиотеке MSDN.

## Использование виртуальных машин на базе Linux с хранилищем Premium
При настройке виртуальных машин Linux в хранилище Premium следуйте перечисленным ниже важным инструкциям:

- Для всех дисков хранилища Premium с параметром кэширования «только чтение» или «ни то ни другое» при подключении файловой системы необходимо отключить т. н. барьеры, чтобы добиться целевых показателей производительности. Барьеры в такой ситуации не нужны, так как записи на диски в хранилище Premium являются для этих параметров кэширования долговременными. После успешного выполнения запроса на запись данные записываются в постоянное хранилище. Отключить барьеры можно перечисленными ниже способами (выберите подходящий вариант для своей файловой системы).
	- Если вы используете систему **reiserFS**, отключите барьеры с помощью параметра подключения “barrier=none” (для включения барьеров используйте параметр “barrier=flush”).
	- Если вы используете систему **ext3/ext4**, отключите барьеры с помощью параметра подключения “barrier=0” (для их включения используйте параметр “barrier=1”).
	- Если вы используете систему **XFS**, отключите барьеры с помощью параметра подключения “nobarrier” (для их включения используйте параметр “barrier”).

- Для дисков хранилища Premium с параметром кэширования «чтение и запись» барьеры должны быть включены на весь срок выполнения операции записи.
- Чтобы сохранить метки томов после перезапуска виртуальной машины, необходимо обновить каталог /etc/fstab, указав ссылки UUID на диски. См. также статью [Подключение диска данных к виртуальной машине Linux](http://azure.microsoft.com/documentation/articles/virtual-machines-linux-how-to-attach-disk).

Ниже перечислены дистрибутивы Linux, проверенные на предмет работоспособности с хранилищем Premium. Рекомендуем вам обновить свои виртуальные машины до одной из перечисленных ниже версий (или более поздних), чтобы добиться от хранилища Premium максимально производительной и стабильной работы. Кроме того, для некоторых из этих версий необходима последняя версия LIS (служб интеграции Linux Integration Services 4.0 для Microsoft Azure). Используйте приведенные ниже ссылки для загрузки и установки соответствующих продуктов. По мере завершения проверки мы будем дополнять этот список новыми образами. Обратите внимание, что наши проверки этих образов продемонстрировали колебания показателей производительности, которые также зависят от особенностей рабочей нагрузки и параметров образов. Различные образы лучше подходят для разных типов рабочей нагрузки. <table border="1" cellspacing="0" cellpadding="5" style="border: 1px solid #000000;"> <tbody> <tr> <td><strong>Дистрибутив</strong></td> <td><strong>Версия</strong></td> <td><strong>Поддерживаемое ядро</strong></td> <td><strong>Поддерживаемый образ</strong></td> </tr> <tr> <td rowspan="4"><strong>Ubuntu</strong></td> <td>12.04</td> <td>3.2.0-75.110</td> <td>Ubuntu-12\_04\_5-LTS-amd64-server-20150119-ru-RU-30GB</td> </tr> <tr> <td>14.04</td> <td>3.13.0-44.73</td> <td>Ubuntu-14\_04\_1-LTS-amd64-server-20150123-ru-RU-30GB</td> </tr> <tr> <td>14.10</td> <td>3.16.0-29.39</td> <td>Ubuntu-14\_10-amd64-server-20150202-ru-RU-30GB</td> </tr> <tr> <td>15.04</td> <td>3.19.0-15</td> <td>Ubuntu-15\_04-amd64-server-20150422-ru-RU-30GB</td> </tr> <tr> <td><strong>SUSE</strong></td> <td>SLES 12</td> <td>3.12.36-38.1</td> <td>suse-sles-12-priority-v20150213<br>suse-sles-12-v20150213</td> </tr> <tr> <td><strong>CoreOS</strong></td> <td>584.0.0</td> <td>3.18.4</td> <td>CoreOS 584.0.0</td> </tr> <tr> <td rowspan="2"><strong>CentOS</strong></td> <td>6.5, 6.6, 6.7, 7.0</td> <td></td> <td> <a href="http://go.microsoft.com/fwlink/?LinkID=403033&clcid=0x409"> Требуется LIS 4.0. </a> </br> * См. примечание ниже. </td> </tr> <tr> <td>7.1</td> <td>3.10.0-229.1.2.el7</td> <td> <a href="http://go.microsoft.com/fwlink/?LinkID=403033&clcid=0x409"> Рекомендуется LIS 4.0. </a> <br/> * См. примечание ниже. </td> </tr>

<tr>
	<td rowspan="2"><strong>Oracle</strong></td>
	<td>6.4</td>
	<td></td>
	<td><a href="http://go.microsoft.com/fwlink/?LinkID=403033&clcid=0x409"> Требуется LIS 4.0 </a></td>
</tr>
<tr>
	<td>7.0</td>
	<td></td>
	<td>За подробными сведениями обратитесь в службу поддержки.</td>
</tr>
</tbody> </table>


### Драйверы LIS для Openlogic CentOS

Клиентам, использующим виртуальные машины CentOS OpenLogic, для установки драйверов последней версии следует выполнить следующую команду:

	sudo rpm -e hypervkvpd  ## (may return error if not installed, that's OK)
	sudo yum install microsoft-hyper-v

Для активации новых драйверов потребуется перезагрузка.



## Цены и выставление счетов при использовании хранилища Premium
При использовании хранилища Premium счета выставляются следующим образом.

- Выставление счетов для хранилища Premium диска зависит от размера подготовленного диска. Azure сопоставляет размер диска (округленный) ближайшему варианту диска хранилища Premium согласно таблице в разделе [Целевые показатели по масштабируемости и производительности при использовании хранилища Premium](#scalability-and-performance-targets-whru-RUing-premium-storage). Счета для любого подготовленного диска выставляются пропорционально с учетом часов по ежемесячной стоимости хранилища Premium. Например, если вы подготовили диск P10 и удалили его через 20 часов, взимается пропорциональная плата за использование диска P10 в течение 20 часов. Это происходит независимо от фактического объема данных, записанных на диск, количества операций ввода-вывода в секунду или использованной пропускной способности.
- Счета за моментальные снимки в хранилище Premium выставляются с учетом дополнительной емкости, потребляемой моментальными снимками. Сведения о моментальных снимках см. в статье [Создание моментального снимка большого двоичного объекта](http://msdn.microsoft.com/library/azure/hh488361.aspx).
- [Передача исходящих данных](http://azure.microsoft.com/pricing/details/data-transfers/) (данных, передаваемых из центров обработки данных Azure) учитывается при определении платы за используемую пропускную способность.

Подробные сведения о ценах на хранилище Premium и виртуальные машины серии DS или GS см. в следующей статье:

- [Цены на хранилища Azure](http://azure.microsoft.com/pricing/details/storage/)
- [Виртуальные машины: цены](http://azure.microsoft.com/pricing/details/virtual-machines/)

## Создание и использование учетной записи хранилища Premium для работы с дисками данных виртуальных машин

В этом разделе рассказывается, как создать учетную запись хранилища Premium с помощью портала предварительной версии Azure, оболочки Azure PowerShell и интерфейса командной строки Azure (Azure CLI). Кроме того, здесь демонстрируется пример использования учетных записей хранилища Premium: создание виртуальной машины и подключение диска данных к виртуальной машине при использовании хранилища Premium.

### Создание виртуальной машины Azure в хранилище Premium на портале предварительной версии Azure

В этом разделе рассказывается, как создать учетную запись хранилища Premium с помощью предварительной версии портала Azure.

1.	Выполните вход на [портал предварительной версии Azure](https://portal.azure.com/). Если у вас еще нет подписки, см. предложение [бесплатной пробной версии](http://azure.microsoft.com/pricing/free-trial/).


    > [AZURE.NOTE]Если вы вошли на портал управления Azure, щелкните имя своей учетной записи в правом верхнем углу. Затем нажмите кнопку **Переключиться на новый портал**.


2.	В меню концентратора выберите **Создать**.

3.	В разделе **Создать** щелкните **Все**. Выберите пункт **Хранилище, кэш и резервное копирование**. После этого щелкните **Хранилище** и нажмите кнопку **Создать**.

4.	На выноске учетной записи хранилища введите имя своей учетной записи хранилища. Щелкните **Уровень ценообразования**. В колонке **Рекомендуемые уровни ценообразования** щелкните **Обзор всех уровней ценообразования**. В колонке **Выберите уровень ценообразования** выберите вариант **Локально избыточное Premium**. Нажмите кнопку **Выбрать**. Обратите внимание, что в колонке **Учетная запись хранилища** параметр **Уровень ценообразования по умолчанию** имеет значение **Standard-GRS**. После нажатия кнопки **Выбрать** параметру **Уровень ценообразования** будет присвоено значение **Premium-LRS**.

	![Ценовая категория][Image1]


5.	В колонке **Учетная запись хранилища** оставьте значения по умолчанию для параметров **Группа ресурсов**, **Подписка**, **Расположение** и **Диагностика**. Щелкните **Создать**.

Полное пошаговое руководство в среде Azure см. в статье [Создание виртуальной машины под управлением Windows на портале предварительной версии Azure](../virtual-machines-windows-tutorial-azure-preview.md).

### Создание виртуальной машины Azure в хранилище Premium с помощью Azure PowerShell
В этом примере для PowerShell показано, как создать новую учетную запись хранилища Premium и добавить в новую виртуальную машину Azure диск данных, который использует эту учетную запись.

1. Настройте среду PowerShell, выполнив действия, описанные в статье [Установка и настройка Azure PowerShell](../install-configure-powershell.md).
2. Запустите консоль PowerShell, подключитесь к своей подписке и запустите следующий командлет PowerShell в окне консоли. Как видно из инструкции для PowerShell, при создании учетной записи хранилища Premium для параметра **Тип** необходимо задать значение **Premium\_LRS**.

		New-AzureStorageAccount -StorageAccountName "yourpremiumaccount" -Location "West US" -Type "Premium_LRS"

3. Затем создайте виртуальную машину серии DS и укажите, что вам требуется хранилище Premium. Для этого выполните следующие командлеты PowerShell в окне консоли: Виртуальная машина серии GS создается таким же образом. Укажите в командах соответствующий размер виртуальной машины. Например, для Standard\_GS2:

    	$storageAccount = "yourpremiumaccount"
    	$adminName = "youradmin"
    	$adminPassword = "yourpassword"
    	$vmName ="yourVM"
    	$location = "West US"
    	$imageName = "a699494373c04fc0bc8f2bb1389d6106__Windows-Server-2012-R2-201409.01-en.us-127GB.vhd"
    	$vmSize ="Standard_DS2"
    	$OSDiskPath = "https://" + $storageAccount + ".blob.core.windows.net/vhds/" + $vmName + "_OS_PIO.vhd"
    	$vm = New-AzureVMConfig -Name $vmName -ImageName $imageName -InstanceSize $vmSize -MediaLocation $OSDiskPath
    	Add-AzureProvisioningConfig -Windows -VM $vm -AdminUsername $adminName -Password $adminPassword
    	New-AzureVM -ServiceName $vmName -VMs $VM -Location $location

4. Если для виртуальной машины требуется больше места на диске, подключите новый диск данных к существующей виртуальной машине серии DS или GS после ее создания. Для этого выполните следующие командлеты PowerShell в окне консоли:

    	$storageAccount = "yourpremiumaccount"
    	$vmName ="yourVM"
    	$vm = Get-AzureVM -ServiceName $vmName -Name $vmName
    	$LunNo = 1
    	$path = "http://" + $storageAccount + ".blob.core.windows.net/vhds/" + "myDataDisk_" + $LunNo + "_PIO.vhd"
    	$label = "Disk " + $LunNo
    	Add-AzureDataDisk -CreateNew -MediaLocation $path -DiskSizeInGB 128 -DiskLabel $label -LUN $LunNo -HostCaching ReadOnly -VM $vm | Update-AzureVm

### Создание виртуальной машины Azure в хранилище Premium с помощью интерфейса командной строки Azure

[Интерфейс командной строки Azure](../xplat-cli-install.md) (Azure CLI) реализует набор кроссплатформенных команд с открытым исходным кодом для работы с платформой Azure. В примерах ниже показано, как с помощью Azure CLI (версии 0.8.14 или более поздней) можно создать учетную запись хранилища Premium и новую виртуальную машину, а также подключить новый диск данных из созданной учетной записи.

#### Создание учетной записи хранилища Premium

````
azure storage account create "premiumtestaccount" -l "west us" --type PLRS
````

#### Создание виртуальной машины серии DS

	azure vm create -z "Standard_DS2" -l "west us" -e 22 "premium-test-vm"
		"b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-14_10-amd64-server-20150202-ru-RU-30GB" -u "myusername" -p "passwd@123"

#### Просмотр сведений о виртуальной машине

	azure vm show premium-test-vm

#### Подключение нового диска данных

	azure vm disk attach-new premium-test-vm 20 https://premiumstorageaccount.blob.core.windows.net/vhd-store/data1.vhd

#### Просмотр сведений о новом диске данных

	azure vm disk show premium-test-vm-premium-test-vm-0-201502210429470316

## Дальнейшие действия

- [Использование операций службы BLOB-объектов с хранилищем Azure Premium](http://go.microsoft.com/fwlink/?LinkId=521969)
- [Перенос в хранилище Azure Premium](storage-migration-to-premium-storage.md)
- [Создание виртуальной машины под управлением Windows](../virtual-machines-windows-tutorial-azure-preview.md)
- [Размеры виртуальных машин и облачных служб для Azure](http://msdn.microsoft.com/library/azure/dn197896.aspx)
- [Документация по хранилищу](http://azure.microsoft.com/documentation/services/storage/)
- [Справочник MSDN](http://msdn.microsoft.com/library/azure/gg433040.aspx)

[Image1]: ./media/storage-premium-storage-preview-portal/Azure_pricing_tier.png
 

<!---HONumber=Nov15_HO3-->