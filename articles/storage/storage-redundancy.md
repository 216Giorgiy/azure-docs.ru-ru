---
title: "Репликация данных в службе хранилища Azure | Документация Майкрософт"
description: "Данные в учетной записи хранения Microsoft Azure реплицируются для обеспечения устойчивости и высокого уровня доступности. Варианты репликации включают локально избыточное хранилище (LRS), хранилище, избыточное в пределах зоны (ZRS), геоизбыточное хранилище (GRS) и геоизбыточное хранилище с доступом для чтения (RA-GRS)."
services: storage
documentationcenter: 
author: mmacy
manager: timlt
editor: tysonn
ms.assetid: 86bdb6d4-da59-4337-8375-2527b6bdf73f
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/15/2017
ms.author: marsma
ms.translationtype: Human Translation
ms.sourcegitcommit: 8be2bcb9179e9af0957fcee69680ac803fd3d918
ms.openlocfilehash: 0237d10ccd9424da0ec10bc2773b978ffc11a294
ms.contentlocale: ru-ru
ms.lasthandoff: 06/23/2017

---
# <a name="azure-storage-replication"></a>Репликация службы хранилища Azure

Данные в учетной записи хранения Microsoft Azure всегда реплицируются, обеспечивая устойчивость и высокий уровень доступности. При репликации данные копируются в пределах того же центра обработки данных или в другой центр обработки данных в зависимости от выбранного варианта репликации. Репликация обеспечивает защиту данных и бесперебойную работу приложений при временных сбоях оборудования. Реплицировав данные в другой центр обработки данных, вы обеспечиваете их защиту в случае масштабных сбоев в основном расположении.

Репликация гарантирует соответствие учетной записи хранения [соглашению об уровне обслуживания относительно хранения данных](https://azure.microsoft.com/support/legal/sla/storage/) даже при сбоях. Сведения о гарантиях службы хранилища Azure в вопросах устойчивости и доступности см. в соглашении об уровне обслуживания.

При создании учетной записи хранения можно выбрать один из следующих вариантов репликации:

* [Локально избыточное хранилище (LRS)](#locally-redundant-storage)
* [Хранилище, избыточное в пределах зоны (ZRS)](#zone-redundant-storage)
* [Геоизбыточное хранилище (GRS)](#geo-redundant-storage)
* [Геоизбыточное хранилище с доступом для чтения (RA-GRS)](#read-access-geo-redundant-storage)

Геоизбыточное хранилище с доступом для чтения (RA-GRS) предоставляется по умолчанию при создании учетной записи хранения.

В таблице ниже представлено краткое описание различий между LRS, ZRS, GRS и RA-GRS, а в следующих разделах каждый тип репликации представлен более подробно.

| Стратегия репликации | LRS | ZRS | GRS | RA-GRS |
|:--- |:--- |:--- |:--- |:--- |
| Данные реплицируются в нескольких центрах обработки данных. |Нет |Да |Да |Да |
| Данные можно считать как из основного, так и из дополнительного расположения. |Нет |Нет |Нет |Да |
| Количество обслуживаемых копий данных на отдельных узлах. |3 |3 |6 |6 |

В разделе [Цены на хранилища Azure](https://azure.microsoft.com/pricing/details/storage/) приведены сведения о различных вариантах обеспечения избыточности данных.

> [!NOTE]
> Хранилище класса Premium поддерживает только локально избыточное хранилище (LRS). Сведения о хранилище класса "Премиум" см. в статье [Хранилище класса "Премиум": высокопроизводительное хранилище для рабочих нагрузок виртуальных машин Azure](storage-premium-storage.md).
>

## <a name="locally-redundant-storage"></a>Локально избыточное хранилище
Локально избыточное хранилище (LRS) реплицирует данные трижды в рамках единицы масштабирования хранилища, которая размещается в центре обработки данных региона, в котором создана учетная запись хранения. Запрос на запись возвращается только после записи во все три реплики. Эти три реплики хранятся в отдельных доменах сбоя и доменах обновления в рамках одной единицы масштабирования хранилища.

Единица масштабирования хранилища — это набор стоек с узлами хранилища. Домен сбоя — это группа узлов, представляющая физическую единицу сбоя, которая может рассматриваться как узлы, принадлежащие одному физическом блоку. Домен обновления — это группа узлов, которые обновляются одновременно во время обновления службы (развертывания). Эти три реплики распределяются по доменам обновления и доменам сбоя в рамках одной единицы масштабирования хранилища, обеспечивая доступность данных, даже если сбой оборудования затрагивает одну стойку, а также при обновлении узлов во время развертывания.

LRS стоит меньше всего и обеспечивает самый низкий уровень надежности по сравнению с другими вариантами. В случае аварии на уровне центра обработки данных (пожар, наводнение и т. д.) все три реплики могут быть утеряны или повреждены без возможности восстановления. Чтобы уменьшить этот риск, мы советуем использовать для большинства приложений географически избыточное хранилище (GRS).

В определенных сценариях следует использовать локально избыточное хранилище:

* Оно обеспечивает самую высокую пропускную способность среди решений для репликации службы хранилища Azure.
* Если в вашем приложении хранятся данные, которые можно легко воссоздать, можно выбрать LRS.
* Некоторые приложения реплицируют данные только в одной стране из-за нормативных требований. Парный регион может находиться в другой стране. Дополнительные сведения см. на странице [Регионы Azure](https://azure.microsoft.com/regions/).

## <a name="zone-redundant-storage"></a>Хранилище, избыточное в пределах зоны
Хранилище, избыточное в пределах зоны (ZRS), асинхронно реплицирует данные в центрах обработки данных в пределах одного или двух регионов, а также хранит три реплики, как и LRS, обеспечивая более высокую устойчивость по сравнению с LRS. Данные, хранящиеся в ZRS, устойчивы, даже если основной центр обработки данных недоступен или не подлежит восстановлению.
Клиентам, планирующим использовать ZRS, нужно иметь в виду следующее:

* ZRS доступно только для больших двоичных объектов в учетных записях хранения общего назначения и поддерживается только в версии службы хранилища от 14.02.2014 и более поздних версиях.
* Так как асинхронная репликация подразумевает задержку, при локальной аварии изменения, еще не реплицированные в дополнительный регион, могут быть утеряны, если данные будет невозможно восстановить из основного региона.
* Реплика будет недоступна, пока корпорация Майкрософт не инициирует отработку отказа в дополнительном регионе.
* Позже учетные записи ZRS нельзя преобразовать в LRS или GRS. Аналогичным образом нельзя преобразовать существующую учетную запись LRS или GRS в учетную запись ZRS.
* Для учетных записей ZRS не доступны метрики и возможность ведения журнала.

## <a name="geo-redundant-storage"></a>Геоизбыточное хранилище
Геоизбыточное хранилище (GRS) реплицирует данные во вторичный регион, который находится в сотнях километров от первичного региона. Если в учетной записи хранения включена репликация GRS, данные будут устойчивы даже в случае отключения электричества во всем регионе или аварии, при которой первичный регион не может быть восстановлен.

Для учетной записи хранения с GRS обновление фиксируется сначала в первичном регионе, где оно реплицируется три раза. Затем обновление асинхронно реплицируется в дополнительном регионе (также три раза).

При использовании GRS основные и дополнительные регионы управляют репликами в отдельных доменах сбоя и доменах обновления в рамках единицы масштабирования хранилища, как описано для LRS.

Рекомендации:

* Так как асинхронная репликация подразумевает задержку, при региональной аварии изменения, еще не реплицированные в дополнительный регион, могут быть утеряны, если данные будет невозможно восстановить из основного региона.
* Реплика будет недоступна, пока корпорация Майкрософт не инициирует отработку отказа в дополнительном регионе. Если корпорация Майкрософт инициирует отработку отказа в дополнительный регион, то у вас будет доступ на чтение и запись к этим данным после того, как отработка отказа завершится. Дополнительные сведения см. в [руководстве по аварийному восстановлению](storage-disaster-recovery-guidance.md). 
* Если приложению требуется выполнить чтение из дополнительного региона, то пользователю необходимо включить RA-GRS.

При создании учетной записи хранения вы выбираете первичный регион для учетной записи. Вторичный регион определяется на основе первичного региона, его невозможно изменить. В таблице ниже показаны пары основных и дополнительных регионов.

| Первичная | Вторичная |
| --- | --- |
| Северо-центральный регион США |Южно-центральный регион США |
| Южно-центральный регион США |Северо-центральный регион США |
| Восток США |Запад США |
| Запад США |Восток США |
| Восточная часть США 2 |Центральный регион США |
| Центральный регион США |Восточная часть США 2 |
| Северная Европа |Западная Европа |
| Западная Европа |Северная Европа |
| Юго-Восточная Азия |Восточная Азия |
| Восточная Азия |Юго-Восточная Азия |
| Восточный Китай |Северный Китай |
| Северный Китай |Восточный Китай |
| Восточная часть Японии |Западная часть Японии |
| Западная часть Японии |Восточная часть Японии |
| Южная часть Бразилии |Южно-центральный регион США |
| Восточная часть Австралии |Юго-Восточная часть Австралии |
| Юго-Восточная часть Австралии |Восточная часть Австралии |
| Южная Индия |Центральная Индия |
| Центральная Индия |Южная Индия |
| Западная Индия |Южная Индия |
| Правительство штата Айова |Правительство штата Вирджиния |
| Правительство штата Вирджиния |Техас (для обслуживания государственных организаций США) |
| Техас (для обслуживания государственных организаций США) |Аризона (для обслуживания государственных организаций США) |
| Аризона (для обслуживания государственных организаций США) |Техас (для обслуживания государственных организаций США) |
| Центральная Канада |Восточная Канада |
| Восточная Канада |Центральная Канада |
| Западная часть Великобритании |Южная часть Великобритании |
| Южная часть Великобритании |Западная часть Великобритании |
| Центральная Германия |Северо-восточная Германия |
| Северо-восточная Германия |Центральная Германия |
| Западный регион США 2 |Западно-центральная часть США |
| Западно-центральная часть США |Западный регион США 2 |

Последние сведения о регионах, поддерживаемых Azure, см. на странице [Регионы Azure](https://azure.microsoft.com/regions/).

>[!NOTE]  
> Дополнительным регионом для региона Виргиния (для обслуживания государственных организаций США) является регион Техас (для обслуживания государственных организаций США). Ранее дополнительным регионом для региона Виргиния (для обслуживания государственных организаций США) был регион Айова (для обслуживания государственных организаций США). Учетные записи хранения, по-прежнему использующие регион Айова (для обслуживания государственных организаций США) как дополнительный регион, переводятся на использование региона Техас (для обслуживания государственных организаций США) в качестве дополнительного региона. 
> 
> 

## <a name="read-access-geo-redundant-storage"></a>Геоизбыточное хранилище с доступом для чтения
Геоизбыточное хранилище с доступом для чтения (RA-GRS) максимально увеличивает доступность для учетной записи хранения, обеспечивая доступ только для чтения к данным во вторичном местоположении в дополнение к репликации в двух регионах, предоставленной в GRS.

При включении доступа только для чтения для данных во вторичном регионе ваши данные будут доступны как в первичной конечной точке, так и во вторичной конечной точке учетной записи хранения. Вторичная конечная точка аналогична первичной конечной точке, но к имени учетной записи добавляется суффикс `–secondary` . Например, если первичная конечная точка для службы BLOB-объектов — `myaccount.blob.core.windows.net`, то вторичная конечная точка — `myaccount-secondary.blob.core.windows.net`. Ключи доступа для учетной записи хранения одинаковые как для первичной, так и для вторичной конечных точек.

Рекомендации:

* При использовании RA-GRS для приложения необходимо указать, с какой конечной точкой взаимодействовать.
* Так как асинхронная репликация подразумевает задержку, при региональной аварии изменения, еще не реплицированные в дополнительный регион, могут быть утеряны, если данные будет невозможно восстановить из основного региона.
* Если корпорация Майкрософт инициирует отработку отказа в дополнительный регион, то у вас будет доступ на чтение и запись к этим данным после того, как отработка отказа завершится. Дополнительные сведения см. в [руководстве по аварийному восстановлению](storage-disaster-recovery-guidance.md). 
* RA-GRS предназначено для обеспечения высокой доступности. Дополнительные сведения по масштабируемости см. в [контрольном списке обеспечения производительности](storage-performance-checklist.md).

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

<a id="howtochange"></a>
#### <a name="1-how-can-i-change-the-geo-replication-type-of-my-storage-account"></a>1. Как изменить тип георепликации для моей учетной записи хранения?

   Изменить тип георепликации учетной записи хранения на LRS, GRS или RA-GRS можно с помощью [портала Azure](https://portal.azure.com/), [Azure PowerShell](storage-powershell-guide-full.md) или программно, используя одну из множества наших клиентских библиотек службы хранилища. Имейте ввиду, что учетные записи ZRS невозможно преобразовать в LRS или GRS. Аналогичным образом нельзя преобразовать существующую учетную запись LRS или GRS в учетную запись ZRS.

<a id="changedowntime"></a>
#### <a name="2-will-there-be-any-down-time-if-i-change-the-replication-type-of-my-storage-account"></a>2) Будет ли какой-либо простой при изменении типа репликации для учетной записи хранения?

   Нет, не никакого простоя не будет.

<a id="changecost"></a>
#### <a name="3-will-there-be-any-additional-cost-if-i-change-the-replication-type-of-my-storage-account"></a>3. Будет ли взиматься дополнительная плата в случае изменения типа репликации для учетной записи хранения?

   Да. Если для своей учетной записи изменить тип репликации LRS на GRS (или RA-GRS), придется дополнительно оплатить исходящий трафик, необходимый для копирования существующих данных из основного расположения в дополнительное расположение. После копирования исходных данных дополнительная плата за исходящий трафик при георепликации данных из основного в дополнительное расположение не взимается. Сведения о стоимости пропускной способности можно найти на [странице цен на службу хранилища Azure](https://azure.microsoft.com/pricing/details/storage/blobs/). Если изменить тип репликации GRS на LRS, дополнительная плата не потребуется, но данные будут удалены из дополнительного расположения.

<a id="ragrsbenefits"></a>
#### <a name="4-how-can-ra-grs-help-me"></a>4. Чем мне поможет RA-GRS?
   
   Геоизбыточное хранилище (GRS) обеспечивает репликацию данных из основного в дополнительный регион, который находится в сотнях километров от основного региона. Таким образом данные будут устойчивы даже в случае отключения электричества во всем регионе или аварии, при которой первичный регион не может быть восстановлен. Хранилище RA-GRS обеспечивает эти же функции, а также возможность считывать данные из дополнительного расположения. Некоторые мысли о том, как использовать эту возможность, можно найти в разделе [Проектирование высокодоступных приложений с использованием RA-GRS](storage-designing-ha-apps-with-ragrs.md). 

<a id="lastsynctime"></a>
#### <a name="5-is-there-a-way-for-me-to-figure-out-how-long-it-takes-to-replicate-my-data-from-the-primary-to-the-secondary-region"></a>5. Существует ли способ узнать, сколько времени займет репликация данных из основного в дополнительный регион?
   
   Если вы используете хранилище RA-GRS, то можете проверить время последней синхронизации своей учетной записи хранения. Время последней синхронизации — это значение даты и времени по Гринвичу. Все данные, записанные в основное расположение до последней синхронизации, были успешно записаны в дополнительное расположение. Это значит, что они доступны для чтения в дополнительном расположении. Данные, записанные в основное расположение после последней синхронизации, могут быть как доступны, так и не доступны для чтения. Вы можете запросить это значение с помощью [портала Azure](https://portal.azure.com/), [Azure PowerShell](storage-powershell-guide-full.md) или программно, используя REST API или одну из клиентских библиотек службы хранилища. 

<a id="outage"></a>
#### <a name="6-how-can-i-switch-to-the-secondary-region-if-there-is-an-outage-in-the-primary-region"></a>6. Как можно переключиться на дополнительный регион в случае сбоя в основном регионе?
   
   Дополнительные сведения см. в статье [Что делать в случае простоя службы хранилища Azure](storage-disaster-recovery-guidance.md).

<a id="rpo-rto"></a>
#### <a name="7-what-is-the-rpo-and-rto-with-grs"></a>7. Что такое RPO и RTO для GRS?
   
   Целевая точка восстановления (RPO): в хранилищах GRS и RA-GRS служба хранилища асинхронно геореплицирует данные из основного расположения в дополнительное. Если произойдет серьезная региональная авария и потребуется выполнить отработку отказа, то последние изменения, которые не были геореплицированы, могут быть утеряны. Число минут, за которые возможна потеря данных, называется целевой точкой восстановления (то есть это точка во времени, до которой можно восстановить данные). Обычно RPO не превышает 15 минут, хотя на данный момент нет какого-либо соглашения об уровне обслуживания, регулирующего длительность георепликации.

   Цель времени восстановления (RTO): время, необходимое для выполнения отработки отказа и возобновления работы учетной записи хранения, когда требуется выполнить отработку отказа. Время, затрачиваемое на отработку отказа, обусловлено следующими факторами:
    * время, затрачиваемое нами на изучение ситуации и определение, можно ли восстановить данные в основном расположении или нужно выполнить отработку отказа;
    * отработка отказа учетной записи путем изменения основных DNS-записей для указания на дополнительное расположение.

   Мы очень ответственно относимся к сохранению ваших данных, поэтому, если имеется хоть какая-нибудь возможность восстановить данные, мы не торопимся выполнять отработку отказа и сосредотачиваемся на восстановлении данных в основном расположении. В будущем мы планируем предоставить API для активации отработки отказа на уровне учетной записи, что позволит вам самостоятельно управлять RTO, но пока это недоступно.
   
## <a name="next-steps"></a>Дальнейшие действия
* [Проектирование высокодоступных приложений с использованием RA-GRS](storage-designing-ha-apps-with-ragrs.md)
* [Цены на хранилища Azure](https://azure.microsoft.com/pricing/details/storage/)
* [Об учетных записях хранения Azure](storage-create-storage-account.md)
* [Целевые показатели масштабируемости и производительности службы хранилища Azure](storage-scalability-targets.md)
* [Windows Azure Storage Redundancy Options and Read Access Geo Redundant Storage](http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/11/introducing-read-access-geo-replicated-storage-ra-grs-for-windows-azure-storage.aspx) (Варианты избыточности и геоизбыточное хранилище с доступом для чтения службы хранилища Microsoft Azure)
* [Документ SOSP — служба хранилища Azure: высокодоступная облачная служба хранилища со строгой согласованностью](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)


