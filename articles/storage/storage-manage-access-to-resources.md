<properties 
	pageTitle="Управление анонимным доступом на чтение к контейнерам и большим двоичным объектам | Microsoft Azure" 
	description="Узнайте, как сделать контейнеры и большие двоичные объекты доступными для анонимного доступа и как осуществлять к ним программный доступ." 
	services="storage" 
	documentationCenter="" 
	authors="tamram" 
	manager="carmonm" 
	editor=""/>

<tags 
	ms.service="storage" 
	ms.workload="storage" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/05/2016" 
	ms.author="tamram"/>

# Управление анонимным доступом на чтение к контейнерам и большим двоичным объектам

## Обзор

По умолчанию только владелец учетной записи хранения может обращаться к ресурсам в пределах этой учетной записи. Только для хранения больших двоичных объектов можно задать разрешения контейнера так, чтобы предоставить анонимный доступ на чтение к контейнеру и хранящимся в нем большим двоичным объектам, чтобы иметь возможность предоставлять доступ к этим ресурсам, не предоставляя ключ учетной записи.

Анонимный доступ лучше всего подходит для сценариев, когда определенные большие двоичные объекты нужно сделать всегда доступными для анонимного доступа на чтение. Для осуществления детального контроля можно создать подписанный URL-адрес, который позволит делегировать ограниченный доступ на определенный временной интервал, используя разные разрешения. Дополнительные сведения о создании подписей общего доступа см. в разделе [Подписи общего доступа. Вводные сведения о модели SAS](storage-dotnet-shared-access-signature-part-1.md).

## Предоставление анонимным пользователям разрешений для контейнеров и больших двоичных объектов

По умолчанию контейнер и все большие двоичные объекты внутри него доступны только владельцу учетной записи хранения. Чтобы предоставить анонимным пользователями доступ на их чтение, следует разрешить общий доступ к контейнеру. Анонимные пользователи могут считывать данные большого двоичного объекта из общедоступного контейнера, при этом их запросы не будут проходить аутентификацию.

Доступны следующие возможности управления доступом к контейнеру.

- **Полный общий доступ на чтение:** контейнер и данные больших двоичных объектов можно считывать с помощью анонимного запроса. Клиенты могут перечислять BLOB-объекты внутри контейнера с помощью анонимного запроса, но не могут перечислять контейнеры в учетной записи хранения.

- **Общий доступ на чтение только для BLOB-объектов:** данные BLOB-объектов в этом контейнере можно считать с помощью анонимного запроса, но данные контейнера недоступны. Клиенты не могут перечислять BLOB-объекты внутри с помощью анонимного запроса.

- **Без общего доступа для чтения:** контейнер и данные больших двоичных объектов может считывать только владелец учетной записи.

Установить разрешения для контейнера можно следующими способами.

- [На портале Azure](portal.azure.com)
- Программно, используя клиентскую библиотеку хранилища или API REST.
- C помощью PowerShell. Сведения о задании разрешений контейнера из Azure PowerShell см. в разделе [Использование Azure PowerShell с хранилищем Azure](storage-powershell-guide-full#how-to-manage-azure-blobs).

### Установка разрешений контейнера через портал Azure

Чтобы задать разрешения контейнера с помощью [портала Azure](portal.azure.com), выполните следующие действия.

1. Перейдите к панели мониторинга для вашей учетной записи хранения.
2. Выберите имя контейнера из списка. Обратите внимание, что необходимо нажать кнопку справа от столбца «Имя», чтобы выбрать имя контейнера. Щелкнув имя, пользователь попадает в контейнер, где отображаются хранящиеся там большие двоичные объекты.
3. Выберите **Изменить** на панели инструментов.
4. В диалоговом окне **Изменить метаданные контейнера** выберите нужный уровень разрешений в поле **Доступ**, как показано на следующем снимке экрана.

	![Диалоговое окно «Изменение метаданных контейнера»](./media/storage-manage-access-to-resources/storage-manage-access-to-resources-1.png)

### Программная установка разрешений контейнера с использованием .NET

Чтобы задать разрешения для контейнера с помощью клиентской библиотеки .NET, сначала нужно получить существующие разрешения контейнера, вызвав метод **GetPermissions**. Затем задайте значение свойства **PublicAccess** для объекта **BlobContainerPermissions**, который возвращается методом **GetPermissions**. Наконец, вызовите метод **SetPermissions** с обновленными разрешениями.

В следующем примере задаются разрешения контейнера на полный общий доступ на чтение. Чтобы задать разрешения на общий доступ на чтение только к большим двоичным объектам, задайте для свойства **PublicAccess** значение **BlobContainerPublicAccessType.Blob**. Чтобы удалить все разрешения для анонимных пользователей, задайте для этого свойства значение **BlobContainerPublicAccessType.Off**.

    public static void SetPublicContainerPermissions(CloudBlobContainer container)
    {
        BlobContainerPermissions permissions = container.GetPermissions();
        permissions.PublicAccess = BlobContainerPublicAccessType.Container;
        container.SetPermissions(permissions);
    }

## Анонимный доступ к контейнерам и большим двоичным объектам

Клиент, который обращается к контейнерам и большим двоичным объектам анонимно, может использовать конструкторы, не требующие учетных данных. В следующих примерах показано несколько разных способов анонимной ссылки на ресурсы службы BLOB-объектов.

### Создание анонимного клиентского объекта

Можно создать новый клиентский объект службы для анонимного доступа, указав конечную точку службы DLOB-объектов для соответствующей учетной записи. Тем не менее необходимо также знать имя контейнера в этой учетной записи, которая доступна для анонимного доступа.

    public static void CreateAnonymousBlobClient()
    {
        // Create the client object using the Blob service endpoint.
        CloudBlobClient blobClient = new CloudBlobClient(new Uri(@"https://storagesample.blob.core.windows.net"));

        // Get a reference to a container that's available for anonymous access.
        CloudBlobContainer container = blobClient.GetContainerReference("sample-container");

        // Read the container's properties. Note this is only possible when the container supports full public read access.
        container.FetchAttributes();
        Console.WriteLine(container.Properties.LastModified);
        Console.WriteLine(container.Properties.ETag);
    }

### Анонимная ссылка на контейнер

При наличии URL-адреса контейнера, который доступен анонимно, можно воспользоваться им для прямой ссылки на контейнер.

    public static void ListBlobsAnonymously()
    {
        // Get a reference to a container that's available for anonymous access.
        CloudBlobContainer container = new CloudBlobContainer(new Uri(@"https://storagesample.blob.core.windows.net/sample-container"));

        // List blobs in the container.
        foreach (IListBlobItem blobItem in container.ListBlobs())
        {
            Console.WriteLine(blobItem.Uri);
        }
    }


### Анонимная ссылка на большой двоичный объект

Если имеется URL-адрес большого двоичного объекта, который доступен для анонимного доступа, можно создать прямую ссылку на этот большой двоичный объект, используя URL-адрес.

    public static void DownloadBlobAnonymously()
    {
        CloudBlockBlob blob = new CloudBlockBlob(new Uri(@"https://storagesample.blob.core.windows.net/sample-container/logfile.txt"));
        blob.DownloadToFile(@"C:\Temp\logfile.txt", System.IO.FileMode.Create);
    }

## Функции, доступные анонимным пользователям

В следующей таблице приведены операции, которые могут быть вызваны анонимными пользователями, если в списке управления доступом к контейнеру разрешен общий доступ.

| Операция REST | Разрешение на полный общий доступ для чтения | Разрешение на общий доступ для чтения только больших двоичных объектов |
|--------------------------------------------------------|-----------------------------------------|---------------------------------------------------|
| Перечисление контейнеров | Только владелец | Только владелец |
| Create Container (Создание контейнера) | Только владелец | Только владелец |
| Get Container Properties (Получение свойств контейнера) | Все | Только владелец |
| Get Container Metadata (Получение метаданных контейнера) | Все | Только владелец |
| Set Container Metadata (Определение метаданных контейнера) | Только владелец | Только владелец |
| Get Container ACL (Получение списка управления доступом для контейнера) | Только владелец | Только владелец |
| Set Container ACL (Задание списка управления доступом для контейнера) | Только владелец | Только владелец |
| Delete Container (Удаление контейнера) | Только владелец | Только владелец |
| List Blobs (Отображение списка BLOB-объектов) | Все | Только владелец |
| Put BLOB (Вставка BLOB-объекта) | Только владелец | Только владелец |
| Get BLOB (Получение BLOB-объекта) | Все | Все |
| Get BLOB Properties (Получение свойств BLOB-объекта) | Все | Все |
| Set BLOB Properties (Задание свойств службы BLOB-объекта) | Только владелец | Только владелец |
| Get BLOB Metadata (Получение метаданных BLOB-объекта) | Все | Все |
| Set BLOB Metadata (Задание метаданных BLOB-объекта) | Только владелец | Только владелец |
| Put Block (Вставка блокировки) | Только владелец | Только владелец |
| Получение списка блоков (только зафиксированные блоки) | Все | Все |
| Получение списка блоков (только незафиксированные блоки или все блоки) | Только владелец | Только владелец |
| Put Block List (Вставка списка блокировки) | Только владелец | Только владелец |
| Delete BLOB (Удаление BLOB-объекта) | Только владелец | Только владелец |
| Копирование BLOB-объекта | Только владелец | Только владелец |
| Создание моментального снимка большого двоичного объекта | Только владелец | Только владелец |
| Lease Blob (Аренда BLOB-объекта) | Только владелец | Только владелец |
| Put Page (Вставка страницы) | Только владелец | Только владелец |
| Get Page Ranges (Получение диапазона страницы) | Все | Все |
| Добавление больших двоичных объектов | Только владелец | Только владелец |


## См. также

- [Проверка подлинности для служб хранилища Azure](https://msdn.microsoft.com/library/azure/dd179428.aspx)
- [Подписи общего доступа: общие сведения о модели SAS](storage-dotnet-shared-access-signature-part-1.md)
- [Делегирование доступа с помощью подписанного URL-адреса](https://msdn.microsoft.com/library/azure/ee395415.aspx) 

<!---HONumber=AcomDC_0107_2016-->