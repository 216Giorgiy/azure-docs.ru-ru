---
title: "Часто задаваемые вопросы о службе \"Файлы Azure\" | Документы Майкрософт"
description: "Получите ответы на некоторые часто задаваемые вопросы о службе \"Файлы Azure\"."
services: storage
documentationcenter: 
author: RenaShahMSFT
manager: aungoo
editor: tysonn
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.date: 10/13/2017
ms.author: renash
ms.openlocfilehash: 91c46ea0897f83811cfa5c1a8b67677caff14569
ms.sourcegitcommit: 76a3cbac40337ce88f41f9c21a388e21bbd9c13f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2017
---
# <a name="frequently-asked-questions-about-azure-files"></a>Часто задаваемые вопросы о службе "Файлы Azure"
Служба [Файлы Azure](storage-files-introduction.md) предоставляет полностью управляемые общие файловые ресурсы в облаке, доступ к которым можно получить с помощью стандартного [отраслевого протокола SMB](https://msdn.microsoft.com/library/windows/desktop/aa365233.aspx) (он также называется Common Internet File System или CIFS). Общие ресурсы службы файлов Azure можно одновременно подключить к облачным или локальным развертываниям Windows, Linux и macOS. Кроме того, общие ресурсы службы "Файлы Azure" можно кэшировать на серверах Windows Server с помощью службы синхронизации файлов Azure (предварительная версия) для быстрого доступа из расположения, где используются данные.

В этой статье будут рассмотрены некоторые часто задаваемые вопросы о возможностях и функциях службы "Файлы Azure", включая вопросы о службе "Синхронизация файлов Azure". Если вы не видите ответ на свой вопрос, обратитесь к нам, используя следующие каналы (в порядке эскалации):

1. Раздел комментариев этой статьи.
2. [Форум службы хранилища Azure](https://social.msdn.microsoft.com/Forums/home?forum=windowsazuredata).
3. [UserVoice службы "Файлы Azure"](https://feedback.azure.com/forums/217298-storage/category/180670-files). 
4. Служба поддержки Майкрософт. Чтобы создать запрос в службу поддержки, перейдите на вкладку "Справка и поддержка" на портале Azure и выберите "Новый запрос на поддержку".

## <a name="general"></a>Общие сведения
* <a id="why-files-useful"></a>**Чем полезна служба "Файлы Azure"?**  
   Служба "Файлы Azure" позволяет создавать файловые ресурсы в облаке без необходимости управления дополнительными нагрузками физического сервера или устройства. Это означает, что вы можете сократить время на применение обновлений ОС и замену непригодных дисков. Всю эту монотонную работу мы сделаем за вас. Дополнительные сведения о сценариях, для работы с которыми будет полезна служба "Файлы Azure", см. в разделе [Зачем нужна служба файлов Azure](storage-files-introduction.md#why-azure-files-is-useful).

* <a id="file-access-options"></a>**Какие есть способы доступа к файлам в службе "Файлы Azure"?**  
    Вы можете подключить общую папку на локальном компьютере с помощью протокола SMB 3.0 или использовать такие средства, как [обозреватель хранилищ](http://storageexplorer.com/) для доступа к файлам в общей папке. Для доступа к файлам в общем файловом ресурсе Azure из приложения можно использовать клиентские библиотеки хранилища, REST API, Powershell или интерфейс командной строки (CLI).

* <a id="what-is-afs"></a>**Что такое служба "Синхронизация файлов Azure"?**  
    Служба "Синхронизация файлов Azure" позволяет централизованно хранить файловые ресурсы организации в службе файлов Azure, обеспечивая гибкость, производительность и совместимость локального файлового сервера. Это достигается путем преобразования серверов Windows Server в быстрый кэш общего файлового ресурса Azure. Для локального доступа к данным вы можете использовать любой протокол (в том числе SMB, NFS и FTPS), доступный в Windows Server. Кроме того, вы можете создать любое число кэшей в любом регионе.

* <a id="files-versus-blobs"></a>**Почему для хранения данных предпочтительнее использовать общий файловый ресурс Azure, а не хранилище BLOB-объектов Azure?**  
    Служба "Файлы Azure" и хранилище BLOB-объектов Azure позволяют хранить большой объем данных в облаке, но их предназначение несколько различно. Хранилище BLOB-объектов Azure можно использовать для облачных приложений с широкими возможностями масштабирования для хранения неструктурированных данных. Чтобы добиться максимальной производительности и масштабируемости, лучше не использовать хранилище BLOB-объектов Azure, так как в сравнении с реальной файловой системой оно представляет собой упрощенный вариант хранения. Кроме того, доступ к хранилищу BLOB-объектов Azure можно получить только с помощью клиентских библиотек на основе REST (или напрямую через протокол REST).

    С другой стороны, служба "Файлы Azure" стремится стать файловой системой, включающей все известные вам абстракции, связанные с файлами, с которыми вы знакомы в течение длительного времени использования локальных операционных систем. Как и хранилище BLOB-объектов Azure, служба "Файлы Azure" предлагает интерфейс REST и клиентские библиотеки на основе REST. Разница состоит в том, что служба "Файлы Azure" также предлагает доступ к файловым ресурсам Azure по SMB. Это означает, что можно напрямую подключить файловый ресурс Azure в Windows, Linux, macOS, локально или на виртуальных машинах в облаке без необходимости написания кода или подключения каких-либо специальных драйверов к файловой системе. Кроме того, файловые ресурсы Azure можно кэшировать на локальных файловых серверах с помощью службы "Синхронизация файлов Azure" для быстрого доступа из расположения, где используются данные. 
   
    Дополнительные сведения о различиях между службой "Файлы Azure" и хранилищем BLOB-объектов Azure см. в статье [Выбор между большими двоичными объектами Azure, службой файлов Azure и дисками Azure](../common/storage-decide-blobs-files-disks.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json). Дополнительные сведения о хранилище BLOB-объектов Azure см. в статье [Общие сведения о хранилище BLOB-объектов](../blobs/storage-blobs-introduction.md).

* <a id="files-versus-disks"></a>**Почему предпочтительнее использовать файловый ресурс Azure, а не диски Azure?**  
    Диск Azure — это просто диск. Изолированный диск сам по себе не очень удобен. Чтобы диск Azure стал полезен, необходимо подключиться к виртуальной машине, работающей в Azure. С дисками Azure можно работать во всех случаях, когда их использование на локальном сервере практично. Диск Azure можно использовать как системный диск ОС, область буфера ОС или выделенное хранилище приложения. Еще один интересный способ использования дисков Azure — это создание файлового сервера в облаке для использования в тех же расположениях, в которых используется файловый ресурс Azure. Развертывание файлового сервера на виртуальных машинах Azure — это удобный и эффективный способ получить файловое хранилище в Azure, когда вам требуются параметры развертывания, не поддерживаемые службой "Файлы Azure" по состоянию на текущий момент (например, поддержка протокола NFS или хранилища класса Premium). 

    С другой стороны, запуск файлового сервера с помощью дисков Azure, используемых в качестве серверного хранилища, обойдется гораздо дороже, чем использование файлового ресурса Azure. Причины следующие. Первая. Кроме оплаты использования дискового хранилища вам также необходимо будет оплатить стоимость работы одной или нескольких виртуальных машин Azure. Вторая. Вам также придется управлять виртуальными машинами, используемыми для запуска файлового сервера, например обновлять ОС и прочее. И третья. Если в конечном счете вам потребуется локальное кэширование данных, то для реализации такого кэширования вы сами должны будете настроить технологии репликации, (например, репликацию распределенной файловой системы), а также управлять ими.

    Один из интересных способов, который вы можете применить (используя диски Azure в качестве серверного хранилища), чтобы по максимуму использовать возможности службы "Файлы Azure" и файлового сервера, размещенного на виртуальных машинах Azure, — установить службу синхронизации файлов Azure на этом файловом сервере, размещенном на виртуальной машине в облаке. Если файловый ресурс Azure находится в том же регионе, что и файловый сервер, можно включить распределение по уровням облака и задать максимальный процент (99%) свободного пространства на диске. Это обеспечит минимальное дублирование данных, а вы сможете использовать любые необходимые вам приложения на файловых серверах, которым нужно поддерживать протокол NFS.

    Дополнительные сведения об одном из способов настройки высокопроизводительного и высокодоступного файлового сервера в Azure см. в записи блога о [развертывании гостевых кластеров виртуальной машины IaaS в Microsoft Azure](https://blogs.msdn.microsoft.com/clustering/2017/02/14/deploying-an-iaas-vm-guest-clusters-in-microsoft-azure/). Дополнительные сведения о различиях между службой "Файлы Azure" и дисками Azure см. в статье [Выбор между большими двоичными объектами Azure, службой файлов Azure и дисками Azure](../common/storage-decide-blobs-files-disks.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json). Дополнительные сведения о дисках Azure см. в статье [Обзор компонента "Управляемые диски" Azure](../../virtual-machines/windows/managed-disks-overview.md).

* <a id="get-started"></a>**Как начать работу со службой "Файлы Azure"?**  
    Это очень просто. Вам необходимо создать [файловый ресурс](storage-how-to-create-file-share.md) и подключить его к операционной системе по своему усмотрению: 

    - [Подключение в Windows](storage-how-to-use-files-windows.md)
    - [Подключение в Linux](storage-how-to-use-files-linux.md)
    - [Подключение в macOS](storage-how-to-use-files-mac.md)

    Более подробные сведения по развертыванию общего файлового ресурса Azure для замены рабочих файловых ресурсов в вашей организации см. в статье [Планирование развертывания службы файлов Azure](storage-files-planning.md).

* <a id="redundancy-options"></a>**Какие параметры избыточности хранилища поддерживаются в службе "Файлы Azure"?**  
    На сегодняшний день служба "Файлы Azure" поддерживает только локально избыточное хранилище (LRS) и геоизбыточное хранилище (GRS). В будущем мы планируем включить поддержку хранилища, избыточного в пределах зоны (ZRS), а также геоизбыточного хранилища с доступом для чтения (RA-GRS), но о конкретных сроках пока говорить рано.

* <a id="tier-options"></a>**Какие уровни хранилища поддерживаются службой "Файлы Azure" сейчас?**  
    Сейчас служба "Файлы Azure" поддерживает только стандартный уровень хранилища. Сейчас у нас нет информации о конкретных сроках реализации поддержки уровня хранилища "Премиум" и "холодного" хранилища. Обратите внимание, что вы не сможете создать общие файловые ресурсы Azure из учетных записей хранения только для больших двоичных объектов или учетных записей хранилища класса Premium.

* <a id="give-us-feedback"></a>**Очень хотелось бы, чтобы в службу "Файлы Azure" была включена функция *x*. Это возможно?**  
    Конечно. Рабочая группа службы "Файлы Azure" готова рассмотреть все предложения и отзывы в отношении своей работы. Проголосуйте за вариант, который вам понравился, на странице, посвященной [оптимизации службы хранилища Azure](https://feedback.azure.com/forums/217298-storage/category/180670-files). Мы заинтересованы в разработке новых полезных функций.

## <a name="azure-file-sync"></a>Служба синхронизации файлов Azure
* <a id="afs-region-availability"></a>**В каких регионах на сегодняшний день поддерживается предварительная версия службы синхронизации файлов Azure?**  
    На сегодняшний день служба синхронизации файлов Azure доступна в следующих регионах: Запад США, Западная Европа, восточная Австралия и Юго-Восточная Азия. Мы включим и другие регионы, так как планируем разработать общедоступную версию службы. Дополнительные сведения см. в разделе [Регионы доступности](storage-sync-files-planning.md#region-availability).

* <a id="cross-domain-sync"></a>**Могут ли в одной группе синхронизации находиться серверы, присоединенные к домену, и серверы, независимые от него?**  
    Да, группа синхронизации может содержать конечные точки сервера, которые могут принадлежать к разным группам Active Directory, и быть независимыми от домена. Хотя технически такая конфигурация работает, мы не рекомендуем ее использовать, так как списки ACL, определенные для файлов и папок на одном сервере, могут не учитываться другими серверами в группе синхронизации. Чтобы получить оптимальные результаты, мы рекомендуем выполнить синхронизацию между серверами в одном лесу Active Directory, серверами в разных лесах Active Directory с установленными отношениями доверия или между серверами, независимыми от домена, а не использовать все варианты сразу.

* <a id="afs-change-detection"></a>**Если файл был создан непосредственно в файловом ресурсе Azure через SMB или портал, то через какое время этот файл синхронизируется с серверами в группе синхронизации?** 
    [!INCLUDE [storage-sync-files-change-detection](../../../includes/storage-sync-files-change-detection.md)]

* <a id="afs-conflict-resolution"></a>**Что произойдет при изменении одного файла на двух серверах приблизительно в одно время?**  
    Служба синхронизации файлов Azure использует простую стратегию разрешения конфликта — будут выполнены все изменения. Сохранится то имя файла, который изменен последним. Файл с более ранними изменениями будет содержать имя исходного компьютера и номер конфликта, добавленный к этому имени на основе таксономии ниже: 
   
    `<FileNameWithoutExtension>-<MachineName>[-#].<ext>`  

    Например, первый конфликт файла `CompanyReport.docx` станет `CompanyReport-CentralServer.docx`, где `CentralServer` является расположением, в котором запись изменений произошла раньше. Соответственно второй конфликт будет таким: `CompanyReport-CentralServer-1.docx`.

* <a id="afs-storage-redundancy"></a>**Поддерживает ли служба синхронизации файлов Azure геоизбыточное хранилище (GRS)?**  
    Да. Эта служба поддерживает локально избыточное хранилище (LRS) и геоизбыточное хранилище (GRS). В случае отработки отказа в хранилище GRS между связанными регионами мы рекомендуем использовать новый регион только как резервную копию данных. Служба синхронизации файлов Azure не запустит автоматическую синхронизацию с новым основным регионом. 

* <a id="sizeondisk-versus-size"></a>**Почему свойство файла *Размер на диске* не соответствует свойству *Размер* после использования синхронизации файлов Azure?**  
    Проводник Windows предоставляет два свойства: **Размер** и **Размер на диске** для представления размера файла. Эти свойства немного отличаются. **Размер** означает полный размер файла, а **Размер на диске** — размер файлового потока, хранимого на диске в данный момент. Эти свойства могут отличаться в силу ряда причин, например сжатия, использования дедупликации данных или, как в нашем случае, распределения по уровням облака с помощью службы синхронизации файлов Azure. Если файл перемещается в файловый ресурс Azure, размер на диске использоваться не будет, так как файловый поток хранится в файловом ресурсе Azure, а не на диске. Файл также может быть перемещен частично (или частично отозван), что означает, что на диске размещается часть файла. Такое может случиться, когда файлы частично считываются приложениями, например мультимедийными проигрывателями или программами для сжатия. 

* <a id="is-my-file-tiered"></a>**Как определить, что файл был перемещен?**  
    Существует несколько способов определения перемещения файла в файловый ресурс Azure.
    
    1. **Проверьте атрибуты файла.** Для этого щелкните файл правой кнопкой мыши, перейдите в раздел **сведений** и прокрутите вниз до свойства **атрибутов**. Перемещенному файлу будут заданы следующие атрибуты:     
        
        | Буква атрибута | Атрибут | Определение |
        |:----------------:|-----------|------------|
        | A | Архив | Указывает, что с помощью программного обеспечения для архивации должно быть выполнено резервное копирование файла. Этот атрибут задается всегда, независимо от того, перемещен файл или полностью расположен на диске. |
        | P | Разреженный файл | Указывает, что этот файл является разреженным. Это специализированный тип файла, который NTFS предлагает для эффективного использования при отсутствии файлового потока на диске. Служба синхронизации файлов Azure использует разреженные файлы, так как файл либо полностью перемещается, что значит, что его файловый поток хранится только в облаке, либо частично отзывается, что значит, что часть этого файла уже на диске. Если файл полностью отозван на диск, служба синхронизации файлов Azure преобразует его из разреженного файла в обычный файл. |
        | L | Точка повторного анализа | Указывает, что файл содержит точку повторного анализа, которая представляет собой специальный указатель, используемый фильтром файловой системы. Служба синхронизации файлов Azure использует точки повторного анализа, чтобы фильтр (StorageSync.sys) файловой системы в этой службе мог определить место хранения файла в облаке. Это позволяет обеспечить быстрый доступ без непосредственной осведомленности пользователя о задействовании службы синхронизации файлов Azure или о том, как получить доступ к файлу в файловом ресурсе Azure. После полного отзыва файла служба синхронизации файлов Azure удаляет точку повторного анализа из файла. |
        | O | Автономно | Указывает, что некоторое (или все) содержимое файла не хранится на диске. После полного отзыва файла служба синхронизации файлов Azure удаляет этот атрибут. |

        ![Диалоговое окно свойств файла с выбранной вкладкой "Сведения"](media/storage-files-faq/azure-file-sync-file-attributes.png)
        
        Вы также можете просмотреть атрибуты для всех файлов в папке. Для этого необходимо добавить поле **Атрибуты** в окно таблицы проводника. Щелкните правой кнопкой мыши имеющийся столбец (например, "Размер"), выберите **Дополнительно**, а затем в раскрывающемся списке выберите **Атрибуты**.
        
    2. **Используйте `fsutil` для проверки точек повторного анализа в файле.** Как уже упоминалось выше, для перемещенного файла всегда будет задана точка повторного анализа или специальный указатель для фильтра (StorageSync.sys) файловой системы в службе синхронизации файлов Azure. Проверить наличие точки повторного анализа для файла можно с помощью команды `fsutil`, выполнив ее в командной строке с повышенными привилегиями или сеансе PowerShell:
    
        ```PowerShell
        fsutil reparsepoint query <your-file-name>
        ```

        Если файл содержит точку повторного анализа, вы увидите сообщение **Значение тега повторной обработки: 0x8000001e**. Это шестнадцатеричное значение является значением точки повторного анализа, установленным службой синхронизации файлов Azure. Выходные данные также будут содержать данные повторного анализа, представляющие путь к файлу в файловом ресурсе Azure.

        > [!Warning]  
        > С помощью команды `fsutil reparsepoint` в командной строке можно также удалить точку повторного анализа. Не выполняйте эту команду, пока вы не получите прямое указание от инженерной команды службы синхронизации файлов Azure, так как ее выполнение может привести к потере данных. 

* <a id="afs-recall-file"></a>**Файл, который мне понадобилось использовать, был перемещен. Как мне локально отозвать его на диск?**  
    Самый простой способ отозвать файл на диск — открыть его. Фильтр файловой системы (StorageSync.sys) в службе синхронизации файлов Azure быстро скачает этот файл из файлового ресурса Azure без необходимости дополнительных действий. При открытии типов файлов, которые можно считать частично, например файлы мультимедиа или ZIP-файлы, их полная загрузка невозможна.

    Вы также можете принудительно отозвать файл с помощью PowerShell. Этот вариант можно использовать, если вы хотите отозвать одновременно большое количество файлов (например, все файлы в папке). Откройте сеанс PowerShell на узле сервера, на котором установлена служба синхронизации файлов Azure, и выполните следующие команды PowerShell:
    
    ```PowerShell
    Import-Module "C:\Program Files\Azure\StorageSyncAgent\StorageSync.Management.ServerCmdlets.dll"
    Invoke-StorageSyncFileRecall -Path <file-or-directory-to-be-recalled>
    ```

* <a id="afs-force-tiering"></a>**Как можно принудительно переместить файл или каталог?**  
    Если функция распределения по уровням облака включена, файлы распределяются по уровням автоматически на основе последнего времени доступа и изменения, чтобы достичь процента свободного пространства тома, указанного для конечной точки облака. Тем не менее, иногда пользователю может понадобиться распределить файл по уровням вручную. Например, это может быть полезно, если вам нужно сохранить большие файлы, которые не планируется использовать повторно в течение долгого времени, и освободить пространство на томе для других файлов и папок. Вы можете принудительно распределить файлы по уровням с помощью следующих команд PowerShell:

    ```PowerShell
    Import-Module "C:\Program Files\Azure\StorageSyncAgent\StorageSync.Management.ServerCmdlets.dll"
    Invoke-StorageSyncCloudTiering -Path <file-or-directory-to-be-tiered>
    ```

* <a id="afs-files-excluded"></a>**Какие файлы или папки автоматически исключены в службе "Синхронизация файлов Azure"?**
    По умолчанию служба синхронизации файлов Azure исключает следующие файлы:
    
    - desktop.ini;
    - thumbs.db;
    - ehthumbs.db;
    - ~$\*.\*;
    - \*.laccdb;
    - \*.tmp;
    - 635D02A9D91C401B97884B82B3BCDAEA.\*

    По умолчанию также исключаются следующие папки:

    - \System Volume Information;
    - \$RECYCLE.BIN;
    - \SyncShareState.

* <a id="afs-os-support"></a>**Мне нужно использовать службу синхронизации файлов Azure с Windows Server 2008 R2, Linux или с устройством NAS. Поддерживает ли служба "Синхронизация файлов Azure" эти компоненты?**
    Сейчас служба синхронизации файлов Azure поддерживает только Windows Server 2016 и Windows Server 2012 R2. В данный момент мы ничего не планируем, но мы с радостью рассмотрим предложения по поводу поддержки дополнительных платформ, проанализировав потребности клиентов. Сообщите нам о платформах, для которых нужно реализовать поддержку, на портале [UserVoice службы "Файлы Azure"](https://feedback.azure.com/forums/217298-storage/category/180670-files).

## <a name="security-authentication-and-access-control"></a>Безопасность, проверка подлинности и управление доступом
* <a id="ad-support"></a>**Поддерживает ли служба "Файлы Azure" аутентификацию и управление доступом на основе Active Directory?**  
    В службе "Файлы Azure" предусмотрено два способа управления доступом:

    - SAS позволяет создавать маркеры с определенными разрешениями, действующими в течение указанного периода. Например, вы можете создать маркер с доступом только для чтения для одного конкретного файла, который истечет через 10 минут. Любой пользователь, обладающий этим маркером, пока он действует, получит доступ только для чтения к этому файлу на 10 минут. Сейчас ключи SAS поддерживаются только через REST API или клиентские библиотеки, поэтому необходимо подключить общий файловый ресурс Azure по протоколу SMB с ключами учетной записи хранения.

    - Служба синхронизации файлов Azure сохранит и реплицирует все списки управления доступом (AD или локальные) для всех конечных точек сервера, с которыми она синхронизируется. Так как Windows Server уже может аутентифицироваться с помощью Active Directory, служба синхронизации файлов Azure может предоставить замечательную временную меру до реализации полной поддержки аутентификации на основе AD и ACL.

    Сейчас служба "Файлы Azure" не поддерживает Active Directory непосредственно.

* <a id="encryption-at-rest"></a>**Как обеспечить шифрование неактивных данных общего файлового ресурса Azure?**  
    Сейчас во всех регионах режим шифрования включается по умолчанию. Чтобы включить шифрование в этих регионах, не нужно выполнять никаких действий. Сведения о других регионах см. в статье [Шифрование службы хранилища Azure для неактивных данных (предварительная версия)](../common/storage-service-encryption.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json).

* <a id="access-via-browser"></a>**Как предоставить доступ к определенному файлу через браузер?**  
    SAS позволяет создавать маркеры с определенными разрешениями, действующими в течение указанного периода. Например, вы можете создать маркер с доступом только для чтения к конкретному файлу на протяжении определенного промежутка времени. Любой пользователь, у которого есть этот URL-адрес, сможет обращаться к файлу прямо из браузера, пока URL-адрес действителен. Ключи SAS можно легко создать с помощью пользовательского интерфейса, например обозревателя хранилищ.

* <a id="file-level-permissions"></a>**Можно ли задать разрешение только для чтения или только для записи в отдельных папках внутри общей папки?**  
    Такой уровень контроля над разрешениями недоступен при подключении общей папки по протоколу SMB. Но вы можете создать такую схему с использованием подписанных URL-адресов (SAS) через интерфейс REST API или клиентские библиотеки.

* <a id="ip-restrictions"></a>**Можно ли внедрить ограничения IP-адресов для общего файлового ресурса Azure?**  
    Да, доступ к общему файловому ресурсу Azure можно ограничить на уровне учетной записи хранения. Дополнительные сведения см. в статье [Настройка брандмауэров службы хранилища Azure и виртуальных сетей (предварительная версия)](../common/storage-network-security.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json).

* <a id="data-compliance-policies"></a>**Какие политики соответствия данных поддерживаются для службы "Файлы Azure"?**  
   В основе службы "Файлы Azure" лежит та же архитектура хранилища, что и для других служб хранилища в составе службы хранилища Azure. К этой службе применяются те же политики соответствия данных. Дополнительные сведения о соответствии данных в хранилище Azure см. в [документе о защите данных в Microsoft Azure](http://go.microsoft.com/fwlink/?LinkID=398382&clcid=0x409) и [центре управления безопасностью Майкрософт](https://www.microsoft.com/TrustCenter/default.aspx).

## <a name="on-premises-access"></a>Локальный доступ
* <a id="expressroute-not-required"></a>**Нужно ли использовать Azure ExpressRoute для подключения к службе "Файлы Azure" или использования службы "Синхронизация файлов Azure" локально?**  
    Нет, ExpressRoute не требуется для доступа к общему файловому ресурсу Azure. Если файловый ресурс Azure подключается локально, нужен всего лишь открытый порт 445 (исходящий TCP-порт) для доступа к Интернету (это порт, к которому обращается SMB). При использовании службы синхронизации файлов Azure требуется всего лишь порт 443 (исходящий TCP-порт) для доступа к HTTPS (SMB не требуется). Тем не менее при необходимости ExpressRoute можно использовать в любом варианте доступа.

* <a id="mount-locally"></a>**Как подключить общий файловый ресурс Azure на локальном компьютере?**  
    Если разрешен исходящий TCP-трафик через порт 445 и клиент (например, Windows 10 или Windows Server 2016) поддерживает протокол SMB 3.0, то подключение к общему файловому ресурсу осуществляется по протоколу SMB. Если порт 445 заблокирован политикой организации или поставщиком услуг Интернета, для доступа к общему файловому ресурсу Azure можно использовать службу синхронизации файлов Azure.

## <a name="backup"></a>Резервное копирование
* <a id="backup-share"></a>**Как создать резервную копию общего файлового ресурса Azure?**  
    Вы можете использовать периодически [создаваемые моментальные снимки общих ресурсов (предварительная версия)](storage-how-to-use-files-snapshots.md) для защиты от случайного удаления. Вы можете воспользоваться AzCopy, RoboCopy или сторонним средством архивации, с помощью которого можно создать резервную копию подключенной общей папки. 

## <a name="share-snapshots"></a>Моментальные снимки общих ресурсов
### <a name="share-snapshots---general"></a>Общие сведения о моментальных снимках общих ресурсов
* <a id="what-are-snaphots"></a>**Что такое моментальный снимок общего файлового ресурса?**  
    Моментальные снимки общих файловых ресурсов Azure позволяют создавать версии общих файловых ресурсов только для чтения. Они также позволяют копировать более старую версию содержимого в тот же общий ресурс или в альтернативное расположение в Azure или в локальной среде для дальнейших изменений. Дополнительные сведения о моментальных снимках общего ресурса см. в статье [Обзор моментального снимка общих файловых ресурсов Azure (предварительная версия)](storage-snapshots-files.md).

* <a id="where-are-snapshots-stored"></a>**Где хранятся мои моментальные снимки общих ресурсов?**  
    Моментальные снимки общего ресурса и сам общий файловый ресурс хранятся в одной и той же учетной записи хранения.

* <a id="snapshot-perf-impact"></a>**Существуют ли ограничения производительности?**  
    Моментальные снимки общего ресурса не снижают производительность.

* <a id="snapshot-consistency"></a>**Согласованы ли моментальные снимки общих ресурсов в разных приложениях?**  
    Нет. Моментальные снимки общих ресурсов не согласованы между приложениями. Перед созданием моментального снимка общего ресурса пользователю понадобиться очистить операций записи из приложения и перенести их в общий ресурс.

* <a id="snapshot-limits"></a>**Есть ли ограничения на число моментальных снимков общего ресурса?**  
    Служба "Файлы Azure" может хранить до 200 моментальных снимков общего ресурса. Моментальные снимки общих ресурсов не учитываются в квоте общих ресурсов, так что общее пространство, занимаемое всеми моментальными снимками общих ресурсов, неограничено. Ограничения учетной записи хранения по-прежнему применяются. После 200 моментальных снимков общих ресурсов пользователю необходимо удалить их, чтобы создать моментальные снимки общего ресурса.

### <a name="create-share-snapshots"></a>Создание моментальных снимков общих ресурсов
* <a id="file-snaphsots"></a>**Можно ли создать моментальный снимок общего ресурса для отдельных файлов?**  
    Моментальные снимки общих ресурсов создаются на уровне общего файлового ресурса. Вы можете восстановить отдельные файлы из моментальных снимков общего файлового ресурса, но нельзя создать моментальные снимки общего ресурса на уровне файлов. Тем не менее если вы создали моментальный снимок общих ресурсов на уровне общего ресурса и требуется перечислить моментальные снимки общих ресурсов, в которых изменился конкретный файл, это можно сделать с помощью компонента «Предыдущие версии» на подключенном общем ресурсе Windows. Если вам нужна функция моментального снимка файла, сообщите нам об этом на форуме [UserVoice службы "Файлы Azure"](https://feedback.azure.com/forums/217298-storage/category/180670-files).

* <a id="encypted-snapshots"></a>**Можно ли создать моментальный снимок общего ресурса для зашифрованного общего файлового ресурса?**  
    Вы можете сделать моментальный снимок общего ресурса для общих файловых ресурсов Azure с включенным шифрованием неактивных данных. Вы можете восстановить файлы из моментального снимка общего ресурса в зашифрованном общем файловом ресурсе. Если общий ресурс зашифрован, его моментальный снимок также будет зашифрован.

* <a id="geo-redundant-snaphsots"></a>**Являются ли мои моментальные снимки общего ресурса геоизбыточными?**
    Моментальные снимки общего ресурса будут иметь тот же уровень, что и соответствующий общий файловый ресурс Azure. При выборе геоизбыточного хранилища (GRS) для своей учетной записи данные моментального снимка общего ресурса также будут храниться отдельно в парном регионе.

### <a name="manage-share-snapshots"></a>Управление моментальными снимками общих ресурсов
* <a id="browse-snapshots-linux"></a>**Можно просмотреть мои моментальные снимки общих ресурсов на компьютере Linux?**  
    Azure CLI 2.0 позволяет создавать, перечислять, просматривать и восстанавливать данные в Linux.

* <a id="copy-snapshots-to-other-storage-account"></a>**Можно ли скопировать моментальные снимки общего ресурса в другую учетную запись хранения?**  
    Вы можете скопировать файлы из моментальных снимков общего ресурса в другое расположение, но не сами моментальные снимки общего ресурса.

### <a name="restore-data-from-share-snapshots"></a>Восстановление данных из моментальных снимков общих ресурсов
* <a id="promote-share-snapshot"></a>**Можно ли повысить уровень моментального снимка общего ресурса до базового общего ресурса?**  
    Вы можете только скопировать данные из моментального снимка общего ресурса в нужное место назначения. Тем не менее невозможно повысить уровень моментального снимка общего ресурса до базового общего ресурса.

* <a id="restore-snapshotted-file-to-other-share"></a>**Можно ли восстановить данные из моментального снимка общего ресурса в другую учетную запись хранения?**  
    Да. Файлы из моментального снимка общего ресурса можно скопировать в исходное или в альтернативное расположение, включая ту же или другую учетную запись хранения в одном или в разных регионах. Кроме того, можно скопировать файлы в локальную среду или в любые другие облака.    
  
### <a name="cleanup-share-snapshot"></a>Очистка моментальных снимков общих ресурсов
* <a id="delete-share-keep-snapshots"></a>**Можно ли удалить общий ресурс, не удаляя его моментальные снимки?**
    Вам не удастся удалить общий ресурс, если в нем имеются активные моментальные снимки общего ресурса. Для удаления моментальных снимков общего ресурса вместе с самим ресурсом предусмотрен интерфейс API. То же можно сделать и на портале Azure.

* <a id="delete-share-with-snapshots"></a>**Что случится с моими моментальными снимками общего ресурса при удалении учетной записи хранения?**
    При удалении учетной записи хранения также удаляются и моментальные снимки общего ресурса.

## <a name="billing-and-pricing"></a>Выставление счетов и цены
* <a id="vm-file-share-network-traffic"></a>**Включается ли сетевой трафик между виртуальной машиной и общими файловыми ресурсами Azure в тарифицируемый трафик подписки?**  
    Если общая папка и виртуальная машина находятся в одном и том же регионе Azure, трафик между ними является бесплатным. Если они находятся в разных регионах, трафик между ними будет тарифицироваться как внешний трафик.

* <a id="share-snapshot-price"></a>**Сколько нужно платить за моментальные снимки общего ресурса?**
     При использовании предварительной версии плата за использование моментальных снимков общего ресурса не взимается. Однако по-прежнему применяется стандартная плата за транзакции и исходящий трафик. После выпуска общедоступной версии будет взиматься плата за ресурсы и транзакции моментальных снимков общих ресурсов.
     
     По своей природе моментальные снимки общих ресурсов являются добавочными. Базовый моментальный снимок общего ресурса — это сам общий ресурс. Последующие моментальные снимки общего ресурса — добавочные. Они хранят только различия от предыдущего моментального снимка общего ресурса. Тарифицируется только измененное содержимое. Если общий ресурс содержит 100 ГиБ данных, из которых с момента создания последнего моментального снимка общего ресурса изменилось всего лишь 5 ГиБ, моментальный снимок общего ресурса использует только 5 ГиБ дополнительно, и счет будет выставлен только за 105 ГиБ. Дополнительные сведения о стандартных расходах на транзакции и исходящие данные см. на [странице цен](https://azure.microsoft.com/pricing/details/storage/files/).

## <a name="scale-and-performance"></a>Масштаб и производительность
* <a id="files-scale-limits"></a>**Каковы ограничения на масштабирование службы "Файлы Azure"?**  
    Дополнительные сведения о целевых показателях масштабируемости и производительности службы "Файлы Azure" см. в разделе [Azure Files scalability and performance targets](storage-files-scale-targets.md) (Целевые показатели масштабируемости и производительности службы файлов Azure).

* <a id="need-larger-share"></a>**Мне нужен более крупный файловый ресурс, чем сейчас предлагается в службе "Файлы Azure". Можно ли увеличить размер файлового ресурса Azure?**  
    Нет, максимальный размер общего файлового ресурса Azure — 5 ТиБ. Сейчас это жесткое ограничение, которое мы не можем снять. Мы работаем над увеличением размера общего файлового ресурса до 100 TиБ, но о конкретных сроках пока говорить рано.

* <a id="open-handles-quota"></a>**Сколько клиентов могут одновременно получить доступ к одному файлу?**  
    Существует квота в 2000 открытых дескрипторов на один файл. По достижении этого показателя появится сообщение об ошибке (квота исчерпана).

* <a id="zip-slow-performance"></a>**При попытке распаковать файлы в службе "Файлы Azure" производительность упала. Что делать?**  
    Для передачи большого числа файлов в службу "Файлы Azure" мы рекомендуем использовать AzCopy (Windows; предварительная версия для Linux и Unix) или Azure Powershell, так как эти инструменты хорошо оптимизированы для передачи файлов по сети.

* <a id="slow-perf-windows-81-2012r2"></a>**Почему после подключения общего файлового ресурса Azure в Windows Server 2012 R2 или Windows 8.1 сократилась производительность?**  
    Имеется известная проблема при подключении файлового ресурса Azure в Windows Server 2012 R2 и Windows 8.1 с накопительным обновлением для Windows 8.1 и Windows Server 2012 R2 за апрель 2014 г. Для достижения оптимальной производительности убедитесь, что на всех экземплярах Windows Server 2012 R2 и Windows 8.1 есть это исправление (конечно, мы всегда рекомендуем устанавливать все обновления Windows через Центр обновления Windows). Дополнительные сведения см. в соответствующей статье базы знаний [Slow performance when you access Azure Files from Windows 8.1 or Server 2012 R2](https://support.microsoft.com/kb/3114025) (Снижение производительности при доступе к службе "Файлы Azure" из Windows 8.1 или Server 2012 R2).

## <a name="features-and-interoperability-with-other-services"></a>Функции и взаимодействие с другими службами
* <a id="cluster-witness"></a>**Можно ли использовать файловый ресурс Azure в качестве *файлового ресурса-свидетеля* для отказоустойчивого кластера Windows Server?**  
    Сейчас такая возможность не поддерживается для общего файлового ресурса Azure. Дополнительные сведения о способах настройки для больших двоичных объектов Azure см. в разделе [Deploy a Cloud Witness for a Failover Cluster](https://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness) (Развертывание облака-свидетеля для отказоустойчивого кластера)

* <a id="containers"></a>**Можно ли подключить файловый ресурс Azure на экземпляре контейнера Azure** ?  
    Да, файловые ресурсы Azure оптимальны для сохранения информации вне пределов времени существования экземпляра контейнера. Дополнительные сведения см. в статье [Подключение файлового ресурса Azure с помощью Экземпляров контейнеров Azure](../../container-instances/container-instances-mounting-azure-files-volume.md).

* <a id="rest-rename"></a>**Существует ли операция переименования в API REST?**  
    На данный момент нет.

* <a id="nested-shares"></a>**Можно ли использовать вложенные общие папки, то есть создавать общую папку в другой общей папке?**  
    Нет. Общая папка является виртуальным драйвером для подключения, поэтому вложенные общие папки не поддерживаются.

* <a id="ibm-mq"></a>**Использование службы "Файлы Azure" с IBM MQ**  
    Компания IBM выпустила руководство по настройке службы "Файлы Azure" в службе, которую используют пользователи IBM MQ. Дополнительные сведения см. в статье [How to setup IBM MQ Multi instance queue manager with Microsoft Azure File Service](https://github.com/ibm-messaging/mq-azure/wiki/How-to-setup-IBM-MQ-Multi-instance-queue-manager-with-Microsoft-Azure-File-Service) (Настройка службы файлов Microsoft Azure в многоэкземплярном диспетчере очередей IBM MQ).

## <a name="see-also"></a>См. также
* [Устранение неполадок службы файлов Azure в Windows](storage-troubleshoot-windows-file-connection-problems.md)
* [Устранение неполадок службы файлов Azure в Linux](storage-troubleshoot-linux-file-connection-problems.md)
* [Устранение неполадок службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-troubleshoot.md)