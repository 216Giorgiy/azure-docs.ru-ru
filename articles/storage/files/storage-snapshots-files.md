---
title: "Обзор моментального снимка общих файловых ресурсов Azure (предварительная версия) | Документация Майкрософт"
description: "Моментальный снимок общих файловых ресурсов Azure является версией только для чтения общих файлов Azure, сделанной в определенный момент времени. После создания моментального снимка общего ресурса его можно читать, копировать или удалять, но нельзя изменять. Моментальные снимки общих ресурсов обеспечивают способ резервного копирования общих ресурсов в том виде, в котором они находятся в данный момент времени."
services: storage
documentationcenter: .net
author: renash
manager: aungoo
editor: tysonn
ms.assetid: edabe3ee-688b-41e0-b34f-613ac9c3fdfd
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/04/2017
ms.author: renash
ms.openlocfilehash: 70b7fec318b527c6c67bd281892c10814712bbc6
ms.sourcegitcommit: 51ea178c8205726e8772f8c6f53637b0d43259c6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="azure-files-share-snapshot-preview-overview"></a>Обзор моментального снимка общих файловых ресурсов Azure (предварительная версия)
Служба "Файлы Azure" предоставляет возможность создать моментальные снимки общих ресурсов для файловых ресурсов. Моментальные снимки общих ресурсов (предварительная версия) записывают общее состояние на момент времени. В этой статье описаны возможности, предоставляемые моментальными снимками общих ресурсов и как можно их использовать в своих вариантах.


## <a name="when-to-use-share-snapshots"></a>Когда следует использовать моментальные снимки общих ресурсов

### <a name="protection-against-application-error-and-data-corruption"></a>Защита от ошибок приложения и повреждения данных
-------------------------------------------------------------------------

Приложения, использующие файловые ресурсы Azure выполняют различные операции, такие как запись, чтение, хранение, передача или обработка. Приложение может быть неправильно настроено или возникнет непреднамеренная ошибка, которая вызывает случайную перезапись или повреждение нескольких блоков. Для защиты от этих сценариев, можно сделать моментальный снимок файловых ресурсов перед развертыванием нового кода приложения. Если ошибка появляется при новом развертывании, можно вернуться к предыдущей версии данных этого файлового ресурса. 

### <a name="protection-against-accidental-deletions-or-unintended-changes"></a>Защита от случайного удаления или нежелательных изменений
----------------------------------------------------------------------------------------------

Представьте, что пользователь работает над текстовым файлом, находящимся в файловом ресурсе. После закрытия текстового файла теряется возможность откатить изменения. В таких случаях необходимо восстановить предыдущую версию файла. Моментальный снимок файловых ресурсов позволяет восстановить предыдущие версии файла, если он будет случайно переименован или удален.

### <a name="general-backup-purposes"></a>Общие цели архивации
---------------------------

После создания файловых ресурсов Azure можно периодически создавать моментальный снимок файловых ресурсов при резервном копировании данных. Создаваемый периодически моментальный снимок файловых ресурсов позволяет поддерживать предыдущие версии данных, которые могут использоваться в целях аудита или аварийного восстановления.

## <a name="share-snapshot-capabilities"></a>Возможности моментальных снимков файловых ресурсов

Моментальный снимок файловых ресурсов — это точка времени, предназначенная только для чтения данных. С помощью REST API можно создавать, удалять и управлять моментальными снимками. Такие же возможности также доступны в клиентской библиотеке, CLI и портале Azure. Интеграция PowerShell с моментальными снимками файловых ресурсов также ожидается в ближайшее время. Просматривать моментальные снимки файловых ресурсов можно с помощью REST API и SMB. Клиенты могут извлечь список версий каталога или файла, а также подключить определенную версию напрямую в качестве диска. После создания моментального снимка общего ресурса его можно читать, копировать или удалять, но нельзя изменять. Весь моментальный снимок файловых ресурсов нельзя скопировать на другую учетную запись хранения, это необходимо сделать с помощью azcopy или других механизмов копирования.

Возможность совместного доступа к снимкам предоставляется на уровне файловых ресурсов, а извлечение предоставляется на уровне отдельных файлов, чтобы позволить восстановление отдельных файлов. Полный файловый ресурс можно восстановить с помощью SMB, REST API, портала, клиентской библиотеки или используя инструментарий PowerShell или CLI.

Моментальный снимок файловых ресурсов идентичен основному файловому ресурсу за исключением того, что к универсальному коду файлового ресурса (URI) добавляется значение **DateTime**, чтобы указывать время, когда был сделан моментальный снимок файловых ресурсов. Например если универсальный код файлового ресурса (URI) — http://storagesample.core.file.windows.net/myshare, универсальный код файлового ресурса (URI) моментального снимка будет аналогичным.
```
http://storagesample.core.file.windows.net/myshare?snapshot=2011-03-09T01:42:34.9360000Z.
```

Моментальные снимки файлового ресурса хранятся до тех пор, пока не будут явно удалены. При удалении исходного файлового ресурса моментальные снимки файлового ресурса будут также удалены. Чтобы было удобнее контролировать моментальные снимки файлового ресурса, их можно пронумеровать. При создании моментального снимка файлового ресурса файлы, находящиеся в системных свойствах файлового ресурса, копируются в моментальный снимок файлового ресурса с такими же значениями. Метаданные исходных файлов и файловых ресурсов также копируются в моментальный снимок файлового ресурса, если при его создании не были указаны отдельные метаданные для снимка.

Вы не можете удалить файловый ресурс, в котором расположены моментальные снимки файлового ресурса, не удалив сначала все моментальные снимки.


## <a name="share-snapshot-space-usage"></a>Использование пространства для моментальных снимков файлового ресурса 

Моментальные снимки файлового ресурса являются по своей природе пошаговыми, что означает, что сохраняются данные, измененные с момента последнего моментального снимка. Это позволяет свести к минимуму время, необходимое для создания моментального снимка файлового ресурса, и экономить на затратах на хранение. Все операции записи в объект или свойство, или операции обновления метаданных считаются изменением содержимого и будут сохранены в моментальном снимке файлового ресурса. 

Чтобы сэкономить место, можно удалить моментальный снимок файлового ресурса периода, в течение которого количество изменений было наибольшим.

Несмотря на то, что папки моментальных снимков сохраняются пошагово, процесс удаления моментальных снимков файлового ресурса разработан таким образом, чтобы вам было необходимо удерживать только самые последние моментальные снимки файлового ресурса для восстановления файлового ресурса. При удалении моментального снимка файлового ресурса удаляются только данные, уникальные для этого моментального снимка файлового ресурса. Активные моментальные снимки содержат все сведения, необходимые для просмотра и восстановления данных (с момента получения моментального снимка файлового ресурса) в исходное или другое расположение. Восстановление может быть выполнено на уровне элементов.

Моментальные снимки не учитываются в ограничении файловых ресурсов на 5 ТБ. Ограничений по объему, занятому моментальными снимками файлового ресурса, нет. Ограничения учетной записи хранения по-прежнему применяются.

## <a name="limits"></a>Ограничения

Максимальное количество моментальных снимков файлового ресурса Azure доступных сейчас — 200. После 200 моментальных снимков файлового ресурса пользователю необходимо удалить их, чтобы создать новые моментальные снимки файлового ресурса. Ограничений на одновременные вызовы для создания моментального снимка файлового ресурса нет.
Ограничений на объем, который может использовать моментальный снимок определенного файлового ресурса, нет. 

## <a name="copy-data-back-to-a-share-from-share-snapshot"></a>Копирование данных из моментального снимка обратно в файловый ресурс

Операции копирования файлов и моментальных снимков подчиняются следующим правилам:

Можно скопировать отдельные файлы в моментальный снимок файлового ресурса с переходом к основному файловому ресурсу или в другое расположение. Восстановить весь файл или его более раннюю версию можно, скопировав файлы из моментального снимка файлового ресурса. Моментальный снимок файлового ресурса не повышается до исходного файлового ресурса. Моментальный снимок файлового ресурса остается неизменным после копирования, однако основной файловый ресурс перезаписывается копией данных, доступных в моментальном снимке. Все восстановленные файлы считаются измененным содержимым.

Файл в моментальном снимке файлового ресурса можно скопировать в назначение с другим именем. Полученный конечный файл является записываемым файлом, а не моментальным снимком файлового ресурса.

Если конечный файл восстанавливается из его копии, это не влияет на связанные с ним моментальные снимки.

## <a name="general-best-practices"></a>Общие рекомендации 

При запуске инфраструктуры на Azure автоматизируйте архивацию для восстановления данных, когда это возможно. Автоматические действия более надежны, чем ручные процессы и помогают улучшить защиту данных и возможности восстановления. Для автоматизации можно использовать REST API, пакет SDK для клиента или скрипты.

Тщательно продумайте частоту моментальных снимков и настройки периода удержания до развертывания планировщика моментальных снимков файлового ресурса, чтобы избежать ненужных плат за моментальные снимки файлового ресурса.

Моментальные снимки файлового ресурса обеспечивают защиту только на уровне файлов, однако не защищают от неосторожных удалений файлов в файловом ресурсе или учетных записях хранения. Вы можете заблокировать учетную запись хранения или группу ресурсов, чтобы защитить учетную запись хранения от случайных удалений.

## <a name="next-steps"></a>Дальнейшие действия
* [ (предварительная версия)](storage-how-to-use-files-snapshots.md)
* [Часто задаваемые вопросы о службе "Файлы Azure"](storage-files-faq.md)

