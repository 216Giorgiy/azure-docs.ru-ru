---
title: "Развертывание службы синхронизации файлов Azure (предварительная версия) | Документация Майкрософт"
description: "Сведения о развертывании службы синхронизации файлов Azure от начала до конца."
services: storage
documentationcenter: 
author: wmgries
manager: klaasl
editor: jgerend
ms.assetid: 297f3a14-6b3a-48b0-9da4-db5907827fb5
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/08/2017
ms.author: wgries
ms.openlocfilehash: b31b6ae413f72c626e2601ba860aad44ddaa29cd
ms.sourcegitcommit: 76a3cbac40337ce88f41f9c21a388e21bbd9c13f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2017
---
# <a name="how-to-deploy-azure-file-sync-preview"></a>Как развернуть службу синхронизации файлов Azure (предварительная версия)
Служба "Синхронизация файлов Azure" (предварительная версия) позволяет централизовано хранить файловые ресурсы организации в службе файлов Azure, обеспечивая гибкость, производительность и совместимость локального файлового сервера. Это достигается путем преобразования серверов Windows Server в быстрый кэш общего файлового ресурса Azure. Для локального доступа к данным вы можете использовать любой протокол (в том числе SMB, NFS и FTPS), доступный в Windows Server. Кроме того, вы можете создать любое число кэшей в любом регионе.

Настоятельно рекомендуем ознакомиться со статьей [Planning for an Azure Files deployment](storage-files-planning.md) (Планирование развертывания службы файлов Azure) и [Планирование развертывания службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-planning.md) перед выполнением шагов, описанных в этом руководстве.

## <a name="prerequisites"></a>Предварительные требования
* Учетная запись хранения и файловые ресурсы Azure в том регионе, в котором нужно развернуть службу синхронизации файлов Azure. Дополнительные сведения можно найти в разделе 
    - [Доступность по регионам](storage-sync-files-planning.md#region-availability). Здесь представлены сведения о регионах службы синхронизации файлов Azure.
    - [Об учетных записях хранения Azure](../common/storage-create-storage-account.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json). Здесь указаны пошаговые инструкции по созданию учетной записи хранения.
    - [Создание общей папки в хранилище файлов Azure](storage-how-to-create-file-share.md). Здесь содержатся пошаговые инструкции по созданию общего файлового ресурса.
* По крайней мере один поддерживаемый сервер или кластер Windows Server для синхронизации со службой синхронизации файлов Azure. Дополнительные сведения о поддерживаемых версиях Windows Server см. в разделе о [совместимости с Windows Server](storage-sync-files-planning.md#azure-file-sync-interoperability).

## <a name="deploy-the-storage-sync-service"></a>Развертывание службы синхронизации хранилища 
Служба синхронизации хранилища — это ресурс Azure верхнего уровня, представляющий службу синхронизации файлов Azure. Чтобы развернуть службу синхронизации хранилища, перейдите на [портал Azure](https://portal.azure.com/) и найдите службу синхронизации файлов Azure. Выбрав "Служба синхронизации файлов Azure (предварительная версия)" в результатах поисков, щелкните "Создать", чтобы открыть вкладку Deploy Storage Sync (Развертывание службы синхронизации хранилища).

Колонка результатов запросит ввод следующей информации:

- **Имя.** Уникальное имя (в подписке) для службы синхронизации хранилища.
- **Подписка.** Подписка, в которой будет создана служба синхронизации хранилища. В зависимости от стратегии конфигурации организации можно получить доступ к одной или нескольким подпискам. Подписка Azure — это базовый контейнер при выставлении счетов для каждой облачной службы (такой как "Файлы Azure").
- **Группа ресурсов.** Это логическая группа ресурсов Azure, таких как учетная запись хранения или служба синхронизации хранилища. Для службы синхронизации файлов Azure можно создать группу ресурсов или использовать имеющуюся (мы рекомендуем использовать группы ресурсов в качестве контейнеров, применяемых для логического выделения ресурсов для вашей организации, таких как группировка ресурсов отдела кадров или ресурсов для конкретного проекта).
- **Расположение.** Регион, в котором будет развернута служба синхронизации файлов Azure. В этом списке доступны только поддерживаемые регионы.

Заполнив форму Deploy Storage Sync (Развертывание службы синхронизации хранилища), щелкните "Создать", чтобы развернуть службу синхронизации хранилища.

## <a name="prepare-windows-servers-for-use-with-azure-file-sync"></a>Подготовка серверов Windows к работе со службой синхронизации файлов Azure
Для каждого сервера, с которым планируется использовать службу синхронизации файлов Azure, включая узлы сервера в отказоустойчивом кластере, сделайте следующее:

Для каждого сервера, включая узлы сервера в отказоустойчивом кластере, с которым планируется использовать службу синхронизации файлов Azure, сделайте следующее:

1. Отключите конфигурацию усиленной безопасности Internet Explorer. Это необходимо только при начальной регистрации на сервере. Конфигурацию можно включить повторно после регистрации сервера.
    1. Откройте диспетчер сервера.
    2. Щелкните **Локальный сервер**:  
        ![Элемент "Локальный сервер" в левой части пользовательского интерфейса диспетчера сервера](media/storage-sync-files-deployment-guide/prepare-server-disable-IEESC-1.PNG)
    3. Перейдите по ссылке **Конфигурация усиленной безопасности Internet Explorer** на вложенной панели "Свойства":  
        ![Ссылка "Конфигурация усиленной безопасности Internet Explorer" в пользовательском интерфейсе диспетчера сервера](media/storage-sync-files-deployment-guide/prepare-server-disable-IEESC-2.PNG)
    4. Установите переключатель **Выкл.** в разделе "Администраторы" и "Пользователи" во всплывающем окне конфигурации усиленной безопасности Internet Explorer.  
        ![Всплывающее окно "Конфигурация усиленной безопасности Internet Explorer" с установленным переключателем "Выкл."](media/storage-sync-files-deployment-guide/prepare-server-disable-IEESC-3.png)

2. У вас должна быть установлена среда PowerShell версии не менее 5.1.\* (Среда PowerShell 5.1 установлена по умолчанию на Windows Server 2016.) Вы можете проверить, установлена ли среда PowerShell 5.1.\*, просмотрев значение свойства PSVersion объекта $PSVersionTable:

    ```PowerShell
    $PSVersionTable.PSVersion
    ```

    - Если значение PSVersion меньше 5.1.\*, как это будет в случае с большинством установок Windows Server 2012 R2, версию можно легко обновить, скачав и установив [Windows Management Framework (WMF) 5.1](https://www.microsoft.com/download/details.aspx?id=54616). Соответствующий пакет скачивания и установки для Windows Server 2012 R2 — это **Win8.1AndW2K12R2-KB\*\*\*\*\*\*\*-x64.msu**.

3. [Установите и настройте Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-azurerm-ps). Мы рекомендуем всегда использовать последнюю версию модулей Azure PowerShell.

## <a name="install-the-azure-file-sync-agent"></a>Установка агента службы синхронизации файлов Azure
Агент службы синхронизации файлов Azure — это скачиваемый пакет, позволяющий синхронизировать Windows Server с общим файловым ресурсом Azure. Агент можно скачать в [Центре загрузки Майкрософт](https://go.microsoft.com/fwlink/?linkid=858257). После скачивания дважды щелкните пакет MSI, чтобы начать установку агента службы синхронизации файлов Azure.

> [!Important]  
> Если службу синхронизации файлов Azure нужно использовать с отказоустойчивым кластером, агент службы синхронизации файлов Azure нужно установить на каждом узле в кластере.

Пакет установки агента службы синхронизации файлов Azure установится относительно быстро с небольшим количеством дополнительных запросов. Таким образом, мы рекомендуем следующее:
- Оставить путь установки по умолчанию `C:\Program Files\Azure\StorageSyncAgent`), чтобы упростить устранение неполадок и обслуживание сервера.
- Включить Центр обновления Майкрософт, чтобы служба синхронизации файлов Azure поддерживалась в актуальном состоянии. Все обновления, включая обновления компонентов и исправления, для агента службы синхронизации файлов Azure будут выполняться из Центра обновления Майкрософт. Мы рекомендуем всегда устанавливать последнее обновление для службы синхронизации файлов Azure. Дополнительные сведения см. в разделе [Политика обновления агента службы синхронизации файлов Azure](storage-sync-files-planning.md#azure-file-sync-agent-update-policy).

По завершении установки агента службы синхронизации файлов Azure пользовательский интерфейс регистрации сервера автоматически запустится. Сведения о регистрации сервера в службе синхронизации файлов Azure см. в следующем разделе.

## <a name="register-windows-server-with-storage-sync-service"></a>Регистрация Windows Server в службе синхронизации хранилища
При регистрации Windows Server в службе синхронизации хранилища между сервером (или кластером) и службой синхронизации хранилища устанавливаются отношения доверия. Пользовательский интерфейс регистрации сервера автоматически запустится после установки агента синхронизации файлов Azure. Если этого не произойдет, его можно открыть вручную из этого расположения: `C:\Program Files\Azure\StorageSyncAgent\ServerRegistration.exe`. После открытия пользовательского интерфейса регистрации сервера щелкните **Вход**, чтобы приступить к работе.

После входа в систему вам будет предложено ввести следующие сведения:

![Снимок экрана пользовательского интерфейса регистрации сервера](media/storage-sync-files-deployment-guide/register-server-scubed-1.png)

- **Подписка Azure.** Подписка, содержащая службу синхронизации хранилища (дополнительные сведения см. в разделе [Развертывание службы синхронизации хранилища](#deploy-the-storage-sync-service) выше). 
- **Группа ресурсов.** Группа ресурсов, содержащая службу синхронизации хранилища.
- **Служба синхронизации хранилища.** Имя службы синхронизации хранилища, которую необходимо зарегистрировать.

Выбрав соответствующую информацию из раскрывающегося списка, щелкните **Зарегистрировать**, чтобы завершить регистрацию сервера. В рамках процесса регистрации будет запрошен дополнительный вход.

## <a name="create-a-sync-group"></a>Создание группы синхронизации
Группа синхронизации определяет топологию синхронизации для набора файлов. Конечные точки в группе синхронизации будут синхронизированы друг с другом. Группа синхронизации должна содержать по крайней мере одну облачную конечную точку, которая представляет общий файловый ресурс Azure, и одну серверную конечную точку, которая представляет собой путь в Windows Server. Чтобы создать группу синхронизации, перейдите к службе синхронизации хранилища на [портале Azure](https://portal.azure.com/) и щелкните **+ Sync group** (+ Группа синхронизации):

![Создание группы синхронизации на портале Azure](media/storage-sync-files-deployment-guide/create-sync-group-1.png)

В появившейся панели запрашивается следующая информация для создания группы синхронизации с облачной конечной точкой:

- **Имя группы синхронизации.** Имя группы синхронизации, которая будет создана. Это имя должно быть уникальным в службе синхронизации хранилища. Вы можете выбрать любое подходящее имя.
- **Подписка.** Подписка, в которой развернута служба синхронизации хранилища из шага [Развертывание службы синхронизации хранилища](#deploy-the-storage-sync-service) выше.
- **Учетная запись хранения.** Если щелкнуть "Выберите учетную запись хранения", откроется дополнительная область, позволяющая выбрать учетную запись хранения, содержащую общий файловый ресурс Azure, с которым нужно синхронизироваться.
- **Azure File share** (Файловый ресурс Azure). Имя файлового ресурса Azure, с которым нужно синхронизироваться.

Чтобы добавить конечную точку сервера, перейдите к созданной группе синхронизации и щелкните Add server endpoint (Добавить конечную точку сервера).

![Добавление новой конечной точки сервера в области группы синхронизации](media/storage-sync-files-deployment-guide/create-sync-group-2.png)

В появившейся области Add server endpoint (Добавить конечную точку сервера) для создания конечной точки сервера требуется ввести следующие сведения:

- **Зарегистрированный сервер.** Имя сервера или кластера, на котором нужно создать конечную точку сервера.
- **Путь.** Путь на Windows Server, синхронизируемый в рамках группы синхронизации.
- **Cloud Tiering** (Распределение по уровням облака). Параметр, позволяющий включать и отключать распределение по уровням облака, за счет которого редко используемые файлы можно распределять по уровням компонента "Файлы Azure".
- **Свободное место тома.** Количество свободного места, резервируемого на томе, где находится конечная точка сервера. Например, если объем свободного места тома с единственной конечной точкой сервера равен 50 %, примерно половина объема данных будет распределяться по уровням компонента "Файлы Azure". Обратите внимание, что независимо от того, включено ли распределение по уровням в облаке, общий файловый ресурс Azure всегда содержит полную копию данных в группе синхронизации.

Щелкните "Создать", чтобы добавить конечную точку сервера. Теперь ваши файлы будут синхронизироваться по всем общим файловым ресурсам Azure и Windows Server. 

> [!Important]  
> В группе синхронизации можно внести изменения в любое облако или конечную точку сервера и синхронизировать файлы в другие конечные точки. При внесении изменений непосредственно в конечную точку облака (общий файловый ресурс Azure), обратите внимание, что изменения сначала должны быть обнаружены заданием обнаружения изменений службы "Синхронизация файлов Azure", которое инициируется для конечной точки облака каждые 24 часа. Дополнительные сведения см. в разделе с [часто задаваемыми вопросами о службе "Файлы Azure"](storage-files-faq.md#afs-change-detection).

## <a name="next-steps"></a>Дальнейшие действия
- [Добавление и удаление конечной точки службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-server-endpoint.md)
- [Регистрация и отмена регистрации сервера в службе синхронизации файлов Azure (предварительная версия)](storage-sync-files-server-registration.md)