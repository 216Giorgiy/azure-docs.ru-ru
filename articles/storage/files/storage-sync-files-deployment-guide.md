---
title: "Развертывание службы синхронизации файлов Azure (предварительная версия) | Документация Майкрософт"
description: "Сведения о развертывании службы синхронизации файлов Azure от начала до конца."
services: storage
documentationcenter: 
author: wmgries
manager: klaasl
editor: jgerend
ms.assetid: 297f3a14-6b3a-48b0-9da4-db5907827fb5
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/08/2017
ms.author: wgries
ms.openlocfilehash: 7d6cb91f97020ad60bd2ea74b24df76511956f38
ms.sourcegitcommit: a5f16c1e2e0573204581c072cf7d237745ff98dc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2017
---
# <a name="deploy-azure-file-sync-preview"></a>Развертывание службы синхронизации файлов Azure (предварительная версия)
С помощью службы синхронизации файлов Azure (предварительная версия) вы можете централизованно хранить файловые ресурсы организации в службе файлов Azure, обеспечивая гибкость, производительность и совместимость локального файлового сервера. Это достигается путем преобразования Windows Server в быстрый кэш общего файлового ресурса Azure. Для локального доступа к данным вы можете использовать любой протокол, доступный в Windows Server, в том числе SMB, NFS и FTPS. Кроме того, вы можете создать любое количество кэшей в любом регионе.

Перед выполнением шагов, описанных в этом руководстве, настоятельно рекомендуем ознакомиться со статьями [Планирование развертывания службы файлов Azure](storage-files-planning.md) и [Планирование развертывания службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-planning.md).

## <a name="prerequisites"></a>Технические условия
* Учетная запись хранения и файловые ресурсы Azure в том регионе, в котором нужно развернуть службу синхронизации файлов Azure. Дополнительные сведения можно найти в разделе 
    - [Доступность по регионам](storage-sync-files-planning.md#region-availability). Здесь представлены сведения о регионах службы синхронизации файлов Azure.
    - Пошаговые инструкции по созданию учетной записи хранения см. в разделе о [создании учетной записи хранения](../common/storage-create-storage-account.md?toc=%2fazure%2fstorage%2ffiles%2ftoc.json).
    - [Создание общей папки в хранилище файлов Azure](storage-how-to-create-file-share.md). Здесь содержатся пошаговые инструкции по созданию общего файлового ресурса.
* По крайней мере один поддерживаемый экземпляр Windows Server или кластер Windows Server для синхронизации со службой синхронизации файлов Azure. Дополнительные сведения о поддерживаемых версиях Windows Server см. в разделе [Взаимодействие службы синхронизации файлов Azure](storage-sync-files-planning.md#azure-file-sync-interoperability).

## <a name="deploy-the-storage-sync-service"></a>Развертывание службы синхронизации хранилища 
Служба синхронизации хранилища — это ресурс Azure верхнего уровня для службы синхронизации файлов Azure. Чтобы развернуть службу синхронизации хранилища, перейдите к [портал Azure](https://portal.azure.com/), нажмите кнопку *New* и выполните поиск синхронизации файлов Azure. В результатах поиска выберите **Служба синхронизации файлов Azure (предварительная версия)**, а затем щелкните **Создать**, чтобы открыть вкладку **Развертывание службы синхронизации хранилища**.

В открывшейся области введите следующие сведения:

- **Имя.** Уникальное имя (в подписке) для службы синхронизации хранилища.
- **Подписка.** Подписка, в которой будет создана служба синхронизации хранилища. В зависимости от стратегии конфигурации организации можно получить доступ к одной или нескольким подпискам. Подписка Azure — это базовый контейнер при выставлении счетов для каждой облачной службы (такой как "Файлы Azure").
- **Группа ресурсов.** Это логическая группа ресурсов Azure, таких как учетная запись хранения или служба синхронизации хранилища. Для службы синхронизации файлов Azure можно создать группу ресурсов или использовать имеющуюся. (Мы рекомендуем использовать группы ресурсов в качестве контейнеров, чтобы логически выделить ресурсы для вашей организации, таких как группировка ресурсов отдела кадров или ресурсов для конкретного проекта.)
- **Расположение.** Регион, в котором будет развернута служба синхронизации файлов Azure. В этом списке доступны только поддерживаемые регионы.

По завершении выберите **Создать**, чтобы развернуть службу синхронизации хранилища.

## <a name="prepare-windows-server-to-use-with-azure-file-sync"></a>Подготовка сервера Windows к работе со службой синхронизации файлов Azure
Для каждого сервера, с которым планируется использовать службу синхронизации файлов Azure, включая узлы сервера в отказоустойчивом кластере, сделайте следующее:

1. Отключите **конфигурацию усиленной безопасности Internet Explorer**. Это необходимо только при начальной регистрации на сервере. Конфигурацию можно включить повторно после регистрации сервера.
    1. Откройте диспетчер сервера.
    2. Щелкните **Локальный сервер**:  
        ![Элемент "Локальный сервер" в левой части пользовательского интерфейса диспетчера сервера](media/storage-sync-files-deployment-guide/prepare-server-disable-IEESC-1.PNG)
    3. Перейдите по ссылке **Конфигурация усиленной безопасности Internet Explorer** на вложенной панели **Свойства**.  
        ![Панель "Конфигурация усиленной безопасности Internet Explorer" в пользовательском интерфейсе диспетчера сервера](media/storage-sync-files-deployment-guide/prepare-server-disable-IEESC-2.PNG)
    4. В диалоговом окне **Конфигурация усиленной безопасности Internet Explorer** установите переключатель **Выкл.** в разделе **Администраторы** и **Пользователи**.  
        ![Всплывающее окно "Конфигурация усиленной безопасности Internet Explorer" с установленным переключателем "Выкл."](media/storage-sync-files-deployment-guide/prepare-server-disable-IEESC-3.png)

2. У вас должна быть установлена среда PowerShell версии не менее 5.1.\* (Среда PowerShell 5.1 установлена по умолчанию на Windows Server 2016.) Вы можете проверить, установлена ли среда PowerShell 5.1.\*, просмотрев значение свойства **PSVersion** объекта **$PSVersionTable**:

    ```PowerShell
    $PSVersionTable.PSVersion
    ```

    Если значение PSVersion меньше 5.1.\*, как это будет в случае с большинством установок Windows Server 2012 R2, версию можно легко обновить, скачав и установив [Windows Management Framework (WMF) 5.1](https://www.microsoft.com/download/details.aspx?id=54616). Соответствующий пакет скачивания и установки для Windows Server 2012 R2 — это **Win8.1AndW2K12R2-KB\*\*\*\*\*\*\*-x64.msu**.

3. [Установите и настройте Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-azurerm-ps). Мы рекомендуем использовать последнюю версию модулей Azure PowerShell.

## <a name="install-the-azure-file-sync-agent"></a>Установка агента службы синхронизации файлов Azure
Агент службы синхронизации файлов Azure — это скачиваемый пакет, позволяющий синхронизировать Windows Server с общим файловым ресурсом Azure. Его можно скачать в [Центре загрузки Майкрософт](https://go.microsoft.com/fwlink/?linkid=858257). После скачивания дважды щелкните пакет MSI, чтобы начать установку агента службы синхронизации файлов Azure.

> [!Important]  
> Если службу синхронизации файлов Azure нужно использовать с отказоустойчивым кластером, агент службы синхронизации файлов Azure должен быть установлен на каждом узле в кластере.

Пакет установки агента службы синхронизации файлов Azure установится относительно быстро с небольшим количеством дополнительных запросов. Таким образом, мы рекомендуем сделать следующее:
- Оставить путь установки по умолчанию (C:\Program Files\Azure\StorageSyncAgent), чтобы упростить устранение неполадок и обслуживание сервера.
- Включить Центр обновления Майкрософт, чтобы служба синхронизации файлов Azure поддерживалась в актуальном состоянии. Все обновления для агента службы синхронизации файлов Azure, включая обновления компонентов и исправления, будут выполняться из Центра обновления Майкрософт. Мы рекомендуем установить последнее обновление для службы синхронизации файлов Azure. Дополнительные сведения см. в разделе [Политика обновления агента службы синхронизации файлов Azure](storage-sync-files-planning.md#azure-file-sync-agent-update-policy).

По завершении установки агента службы синхронизации файлов Azure пользовательский интерфейс регистрации сервера запустится автоматически. Сведения о регистрации сервера в службе синхронизации файлов Azure см. в следующем разделе.

## <a name="register-windows-server-with-storage-sync-service"></a>Регистрация Windows Server в службе синхронизации хранилища
При регистрации Windows Server в службе синхронизации хранилища между сервером (или кластером) и службой синхронизации хранилища устанавливаются отношения доверия. После установки агента службы синхронизации файлов Azure пользовательский интерфейс регистрации сервера запустится автоматически. Если он не запустился, его можно открыть вручную, перейдя в расположение файла: C:\Program Files\Azure\StorageSyncAgent\ServerRegistration.exe. После открытия пользовательского интерфейса регистрации сервера выберите **Вход**, чтобы приступить к работе.

После входа в систему вам будет предложено ввести следующие сведения:

![Снимок экрана пользовательского интерфейса регистрации сервера](media/storage-sync-files-deployment-guide/register-server-scubed-1.png)

- **Подписка Azure.** Подписка, содержащая службу синхронизации хранилища (дополнительные сведения см. в разделе [Развертывание службы синхронизации хранилища](#deploy-the-storage-sync-service)). 
- **Группа ресурсов.** Группа ресурсов, содержащая службу синхронизации хранилища.
- **Служба синхронизации хранилища.** Имя службы синхронизации хранилища, которую необходимо зарегистрировать.

Выбрав соответствующую информацию, выберите **Зарегистрировать**, чтобы завершить регистрацию сервера. В рамках процесса регистрации будет запрошен дополнительный вход.

## <a name="create-a-sync-group"></a>Создание группы синхронизации
Группа синхронизации определяет топологию синхронизации для набора файлов. Конечные точки в группе синхронизации синхронизируются. Группа синхронизации должна содержать не менее одной облачной конечной точки, которая представляет общий файловый ресурс Azure, и одну серверную конечную точку, которая представляет путь в Windows Server. Чтобы создать группу синхронизации, на [портале Azure](https://portal.azure.com/) перейдите к службе синхронизации хранилища и выберите **+Группа синхронизации**:

![Создание группы синхронизации на портале Azure](media/storage-sync-files-deployment-guide/create-sync-group-1.png)

В открывшейся области введите следующую информацию, чтобы создать группу синхронизации с облачной конечной точкой:

- **Имя группы синхронизации.** Имя создаваемой группы синхронизации. Это имя должно быть уникальным в службе синхронизации хранилища. Вы можете выбрать любое подходящее имя.
- **Подписка.** Подписка, в которой развернута служба синхронизации хранилища из шага [Развертывание службы синхронизации хранилища](#deploy-the-storage-sync-service).
- **Учетная запись хранения.** Если щелкнуть **Выберите учетную запись хранения**, отобразится другая область. В ней можно выбрать учетную запись хранения с файловым ресурсом Azure, с которым нужно синхронизироваться.
- **Общая папка Azure.** Имя синхронизируемого файлового ресурса Azure.

Чтобы добавить конечную точку сервера, перейдите к созданной группе синхронизации и выберите **Добавить конечную точку сервера**.

![Добавление новой конечной точки сервера в области группы синхронизации](media/storage-sync-files-deployment-guide/create-sync-group-2.png)

В открывшейся области **Добавление конечной точки сервера** введите следующие сведения, чтобы создать конечную точку сервера:

- **Зарегистрированный сервер.** Имя сервера или кластера для создания конечной точки сервера.
- **Путь.** Расположение в Windows Server, синхронизируемое в рамках группы синхронизации.
- **Уровни в облаке.** Параметр, позволяющий включать и отключать распределение по уровням облака. С помощью этого параметра редко используемые файлы можно распределить по уровням компонента "Файлы Azure".
- **Свободное место тома.** Объем свободного места, резервируемого на томе, где расположена конечная точка сервера. Например, если объем свободного места тома с единственной конечной точкой сервера равен 50 %, примерно половина объема данных будет распределена по уровням компонента "Файлы Azure". Независимо от того, включено ли распределение по уровням в облаке, общий файловый ресурс Azure всегда содержит полную копию данных в группе синхронизации.

Выберите **Создать**, чтобы добавить конечную точку сервера. Теперь ваши файлы будут синхронизироваться по всем общим файловым ресурсам Azure и Windows Server. 

> [!Important]  
> В группе синхронизации можно внести изменения в любую облачную конечную точку или конечную точку сервера в группе синхронизации и синхронизировать файлы в другие конечные точки. Если вы вносите изменения непосредственно в облачную конечную точку (общий файловый ресурс Azure), эти изменения сначала должны быть определены заданием обнаружения изменений службы "Синхронизация файлов Azure". Задание обнаружения изменений инициируется для облачной конечной точки каждые 24 часа. Дополнительные сведения см. в статье [Часто задаваемые вопросы о службе файлов Azure](storage-files-faq.md#afs-change-detection).

## <a name="migrate-a-dfs-replication-dfs-r-deployment-to-azure-file-sync"></a>Перенос развертывания репликации DFS (DFS-R) в службу синхронизации файлов Azure
Чтобы перенести развертывание DFS-R в службу "Синхронизация файлов Azure", сделайте следующее:

1. Создайте группу синхронизации для представления топологии DFS-R, которую требуется заменить.
2. Начните с сервера с полным набором данных в топологии DFS-R, которую следует перенести. Установите службу "Синхронизация файлов" Azure на этом сервере.
3. Зарегистрируйте этот сервер и создайте серверную конечную точку для переноса первого сервера. Не включайте распределение по уровням облака.
4. Выполните синхронизацию всех данных с файловым ресурсом Azure (облачной конечной точкой).
5. Установите и зарегистрируйте агент синхронизации файлов Azure на каждом из оставшихся серверов DFS-R.
6. Отключите DFS-R. 
7. Создайте серверную конечную точку на каждом из серверов DFS-R. Не включайте распределение по уровням облака.
8. Дождитесь завершения синхронизации и протестируйте топологию нужным образом.
9. Снимите DFS-R с учета.
10. Теперь можно включить распределение по уровням облака на любой серверной конечной точке.

Дополнительные сведения см. в статье [Azure File Sync interop with Distributed File System (DFS)](storage-sync-files-planning.md#distributed-file-system-dfs) (Взаимодействие службы "Синхронизация файлов Azure" с распределенной файловой системой (DFS)).

## <a name="next-steps"></a>Дальнейшие действия
- [Добавление и удаление конечных точек сервера службы синхронизации файлов Azure](storage-sync-files-server-endpoint.md)
- [Регистрация и отмена регистрации сервера в службе синхронизации файлов Azure (предварительная версия)](storage-sync-files-server-registration.md)
