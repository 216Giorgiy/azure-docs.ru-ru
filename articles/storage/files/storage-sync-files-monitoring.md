---
title: Мониторинг Синхронизации файлов Azure | Документация Майкрософт
description: Узнайте, как выполнять мониторинг Синхронизации файлов Azure.
services: storage
author: jeffpatt24
ms.service: storage
ms.topic: article
ms.date: 01/31/2019
ms.author: jeffpatt
ms.subservice: files
ms.openlocfilehash: 5a0d02768b0fbd23e33d13c5e5c3fe84a41cdc52
ms.sourcegitcommit: b3d74ce0a4acea922eadd96abfb7710ae79356e0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2019
ms.locfileid: "56243660"
---
# <a name="monitor-azure-file-sync"></a>Мониторинг Синхронизации файлов Azure

Используйте службу "Синхронизация файлов Azure", чтобы централизованно хранить файловые ресурсы организации в службе файлов Azure, обеспечивая гибкость, производительность и совместимость локального файлового сервера. Это достигается путем преобразования Windows Server в быстрый кэш общего файлового ресурса Azure. Для локального доступа к данным вы можете использовать любой протокол, доступный в Windows Server, в том числе SMB, NFS и FTPS. Кроме того, вы можете создать любое количество кэшей в любом регионе.

В этой статье описано, как отслеживать развертывание Синхронизации файлов Azure с помощью портала Azure и Windows Server.

Сейчас доступны следующие средства мониторинга:

## <a name="azure-portal"></a>Портал Azure

На портале Azure можно проверять состояние работоспособности зарегистрированного сервера и конечной точки сервера (работоспособность синхронизации), а также просматривать метрики.

### <a name="storage-sync-service"></a>Служба синхронизации хранилища

Чтобы проверить состояние работоспособности и метрик зарегистрированного сервера и конечной точки, перейдите в службу синхронизации хранилища на портале Azure. Состояние работоспособности зарегистрированного сервера отображается в колонке "Зарегистрированные серверы". Состояние работоспособности конечной точки сервера отображается в колонке "Группы синхронизации".

Состояние работоспособности зарегистрированного сервера
- Если состояние зарегистрированного сервера отображается как "Подключено", это значит, что сервер обменивается данными со службой.
- Если же отображается состояние "Отключено", проверьте, запущен ли мониторинг синхронизации хранилища (AzureStorageSyncMonitor.exe). Если сервер находится за брандмауэром или прокси-сервером, [настройте эти средства защиты](https://docs.microsoft.com/azure/storage/files/storage-sync-files-firewall-and-proxy).

Состояние работоспособности конечной точки сервера
- Состояние работоспособности конечной точки сервера на портале основано на событиях синхронизации, регистрируемых в журнале событий телеметрии на сервере (с идентификатором 9102 и 9302). Если сеанс синхронизации завершается неудачно из-за временной ошибки (например, если ошибка отменена), синхронизация может по-прежнему отображаться на портале как работоспособный процесс, пока выполняется текущий сеанс синхронизации (событие 9302 позволяет определить, используются ли файлы). См. дополнительные сведения о [работоспособности синхронизации](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#broken-sync) и [ходе выполнения синхронизации](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#how-do-i-monitor-the-progress-of-a-current-sync-session).
- Если на портале отображается ошибка синхронизации из-за остановки процесса, следуйте инструкциям по [устранению неполадок](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=portal1%2Cazure-portal#common-sync-errors).

Метрики
- На портале службы синхронизации хранилища доступны для просмотра следующие метрики.

  | Имя метрики | ОПИСАНИЕ | Колонки портала | 
  |-|-|-|
  | Синхронизировано байт | Размер переданных данных (отправка и скачивание) | Группа синхронизации, конечная точка сервера |
  | Отзыв уровней в облаке | Размер отозванных данных | Зарегистрированные серверы |
  | Несинхронизирующиеся файлы | Число файлов, которые не удалось синхронизировать | Конечная точка сервера |
  | Синхронизировано файлов | Число переданных файлов (отправка и скачивание) | Группа синхронизации, конечная точка сервера |
  | Сетевой статус сервера | Число пульсов, полученных от сервера | Зарегистрированные серверы |

- Дополнительные сведения см. в разделе [Azure Monitor](https://docs.microsoft.com/azure/storage/files/storage-sync-files-monitoring#azure-monitor). 

  > [!Note]  
  > Диапазон времени для диаграммы на портале службы синхронизации хранилища составляет 24 часа. Чтобы просмотреть различные периоды времени или измерения, используйте Azure Monitor.


### <a name="azure-monitor"></a>Azure Monitor

Используйте [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) для мониторинга синхронизации, распределения по уровням в облаке и подключения сервера. Метрики для Синхронизации файлов Azure включены по умолчанию и отправляются в Azure Monitor каждые 15 минут.

Чтобы просмотреть метрики Синхронизации файлов Azure в Azure Monitor, выберите тип ресурса служб синхронизации хранилища.

В Azure Monitor используются следующие метрики для Синхронизации файлов Azure:

| Имя метрики | ОПИСАНИЕ |
|-|-|
| Синхронизировано байт | Размер переданных данных (отправка и скачивание).<br><br>Единица измерения: Байты<br>Тип агрегирования: Sum<br>Применимые измерения. Имя конечной точки сервера, направление синхронизации, имя группы синхронизации |
| Отзыв уровней в облаке | Размер отозванных данных.<br><br>Единица измерения: Байты<br>Тип агрегирования: Sum<br>Применяемые измерения: Имя сервера |
| Несинхронизирующиеся файлы | Число файлов, которые не удалось синхронизировать.<br><br>Единица измерения: Count<br>Тип агрегирования: Sum<br>Применимые измерения. Имя конечной точки сервера, направление синхронизации, имя группы синхронизации |
| Синхронизировано файлов | Число переданных файлов (отправка и скачивание).<br><br>Единица измерения: Count<br>Тип агрегирования: Sum<br>Применимые измерения. Имя конечной точки сервера, направление синхронизации, имя группы синхронизации |
| Сетевой статус сервера | Число пульсов, полученных от сервера.<br><br>Единица измерения: Count<br>Тип агрегирования: Максимальная<br>Применяемые измерения: Имя сервера |
| Результат сеанса синхронизации | Результат сеанса синхронизации (1 — успешный сеанс синхронизации; 0 — сбой синхронизации).<br><br>Единица измерения: Count<br>Типы агрегирования: Максимальная<br>Применимые измерения. Имя конечной точки сервера, направление синхронизации, имя группы синхронизации |

## <a name="windows-server"></a>Windows Server

Windows Server позволяет просмотреть работоспособность распределения по уровням в облаке, зарегистрированного сервера и синхронизации.

### <a name="event-logs"></a>Журналы событий

Используйте журнал событий телеметрии на сервере, чтобы отслеживать работоспособность зарегистрированного сервера, синхронизации и распределения по уровням в облаке. Журнал событий телеметрии хранится в папке Applications and Services\Microsoft\FileSync\Agent в средстве "Просмотр событий".

Работоспособность синхронизации
- После завершения сеанса синхронизации регистрируется событие с идентификатором 9102. Это событие следует использовать для определения успешного завершения сеансов синхронизации (HResult = 0), а также поиска ошибок синхронизации по элементам. См. дополнительные сведения о [работоспособности синхронизации](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#broken-sync) и [ошибках по элементах](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#how-do-i-see-if-there-are-specific-files-or-folders-that-are-not-syncing).

  > [!Note]  
  > Иногда сеансы синхронизации не выполняются в целом или содержат другое значение PerItemErrorCount, отличное от нуля, но тем не менее наблюдается прогресс и некоторые файлы успешно синхронизируются. Это можно увидеть в полях Applied (AppliedFileCount, AppliedDirCount, AppliedTombstoneCount и AppliedSizeBytes), где содержатся сведения об успешности выполнения сеанса. Если несколько сеансов синхронизации подряд завершаются сбоем, а числа в полях Applied увеличиваются, нужно дождаться повторной попытки синхронизации, а не отправлять сразу же запрос в службу поддержки.

- Идентификатор события 9302 регистрируется каждые 5–10 минут при активном сеансе синхронизации. С помощью этого события можно проверить ход выполнения сеанса синхронизации (AppliedItemCount > 0). Если синхронизация не выполняется, сеанс в конечном итоге завершится ошибкой, для которой будет зарегистрирован идентификатор события 9102. См. дополнительные сведения о [ходе выполнения синхронизации](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=server%2Cazure-portal#how-do-i-monitor-the-progress-of-a-current-sync-session).

Состояние работоспособности зарегистрированного сервера
- Если сервер отправляет службе запросы, связанные с выполнением заданий, идентификатор события 9301 регистрируется каждые 30 секунд. Если GetNextJob возвращает состояние 0, сервер может обмениваться данными со службой. Если GetNextJob возвращает ошибку, для решения проблемы следуйте инструкциям по [устранению неполадок](https://docs.microsoft.com/azure/storage/files/storage-sync-files-troubleshoot?tabs=portal1%2Cazure-portal#common-sync-errors).

Работоспособность распределения по уровням в облаке
- Чтобы отслеживать на сервере действие распределения по уровням, используйте идентификаторы события 9003, 9016 и 9029 в журнале событий телеметрии (расположенном в папке Applications and Services\Microsoft\FileSync\Agent в средстве "Просмотр событий").

  - Идентификатор события 9003 обеспечивает распределение ошибок для конечной точки сервера. Например, общее число ошибок, код ошибки и т. д. Обратите внимание, что на каждый код ошибки регистрируется одно событие.
  - Идентификатор события 9016 предоставляет результаты копий для тома. Например, процент свободного пространства, количество скопированных файлов в сеансе, количество файлов, копии которых создать не удалось, и т. д.
  - Идентификатор события 9029 предоставляет сведения о сеансе копирования для конечной точки сервера. Например, количество попыток копирования файла в сеансе, количество файлов, распределенных по уровням в сеансе, количество уже распределенных по уровням файлов и т. д.
  
- Чтобы отслеживать на сервере действие отзыва, используйте идентификаторы события 9005, 9006, 9009 и 9059 в журнале событий телеметрии (расположенном в папке Applications and Services\Microsoft\FileSync\Agent в средстве "Просмотр событий").

  - Идентификатор события 9005 обеспечивает надежность отзыва для конечной точки сервера. Например, общее число уникальных файлов, к которым получен доступ, общее число уникальных файлов, доступ к которым завершился сбоем, и т. д.
  - Идентификатор события 9006 обеспечивает распределение ошибок отзыва для конечной точки сервера. Например, общее количество запросов, завершившихся сбоем, код ошибки и т. д. Обратите внимание, что на каждый код ошибки регистрируется одно событие.
  - Идентификатор события 9009 предоставляет сведения о сеансе отзыва для конечной точки сервера. Например, DurationSeconds, CountFilesRecallSucceeded, CountFilesRecallFailed и др.
  - Идентификатор события 9059 предоставляет сведения об отзыве приложения для конечной точки сервера. Например, ShareId, ApplicationName и TotalEgressNetworkBytes.

### <a name="performance-counters"></a>Счетчики производительности

Воспользуйтесь счетчиками производительности Синхронизации файлов Azure на сервере для отслеживания действия синхронизации.

Чтобы просмотреть счетчики производительности Синхронизации файлов Azure на сервере, запустите системный монитор (Perfmon.exe). Счетчики можно найти в объектах AFS Bytes Transferred (Число переданных байт AFS) и AFS Sync Operations (Операции синхронизации AFS).

В системном мониторе можно просмотреть следующие счетчики производительности Синхронизации файлов Azure:

| Объект \ Имя счетчика производительности | ОПИСАНИЕ |
|-|-|
| AFS Bytes Transferred \ Downloaded Bytes/sec (Число переданных байт AFS \ Число байт, скачиваемых в секунду) | Число байт, скачиваемых в секунду. |
| AFS Bytes Transferred \ Uploaded Bytes/sec (Количество переданных байт AFS \ Число байт, отправляемых в секунду) | Число байт, отправляемых в секунду. |
| AFS Bytes Transferred \ Total Bytes/sec (Число переданных байт AFS \ Общее число байт в секунду) | Общее число байт в секунду (отправка и скачивание). |
| AFS Sync Operations \ Downloaded Sync Files/sec (Операции синхронизации AFS \ Число файлов, скачиваемых в секунду) | Число файлов, скачиваемых в секунду. |
| AFS Sync Operations \ Uploaded Sync Files/sec (Операции синхронизации AFS \ Число файлов, отправляемых в секунду) | Число файлов, отправляемых в секунду. |
| AFS Sync Operations \ Total Sync File Operations/sec (Операции синхронизации AFS \ Общее число операций синхронизации файлов в секунду) | Общее число синхронизируемых файлов (отправка и скачивание). |

## <a name="next-steps"></a>Дополнительная информация
- [Планирование развертывания службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-planning.md)
- [Параметры брандмауэра и прокси-сервера Синхронизации файлов Azure](storage-sync-files-firewall-and-proxy.md)
- [Как развернуть службу синхронизации файлов Azure (предварительная версия)](storage-sync-files-deployment-guide.md)
- [Устранение неполадок службы "Синхронизация файлов Azure"](storage-sync-files-troubleshoot.md)
- [Часто задаваемые вопросы о службе "Файлы Azure"](storage-files-faq.md)
