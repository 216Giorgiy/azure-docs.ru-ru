---
title: Использование Data Box и других методов для автономного приема данных в компоненте "Синхронизация файлов Azure"
description: Процесс и рекомендации по включению поддержки совместимого с синхронизацией массового перемещения.
services: storage
author: fauhse
ms.service: storage
ms.topic: article
ms.date: 02/12/2019
ms.author: fauhse
ms.component: files
ms.openlocfilehash: a184e0563d1ad26671c38cabe07f42d97cbe2885
ms.sourcegitcommit: 301128ea7d883d432720c64238b0d28ebe9aed59
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/13/2019
ms.locfileid: "56212801"
---
# <a name="migrate-to-azure-file-sync"></a>Миграция в Синхронизацию файлов Azure
Существует несколько вариантов перемещения данных в компонент "Синхронизация файлов Azure".

### <a name="uploading-files-via-azure-file-sync"></a>Передача файлов с помощью компонента "Синхронизация файлов Azure"
Простейший вариант заключается в том, чтобы переместить файлы локально на сервер Windows Server 2012 R2 или более поздней версии и установить агент Синхронизации файлов Azure. После настройки синхронизации ваши файлы будут передаваться с сервера. Сейчас скорость передачи всех наших клиентов в среднем равна 1 ТБ за каждые 2 дня.
Изучите [график регулирования пропускной способности](storage-sync-files-server-registration.md#ensuring-azure-file-sync-is-a-good-neighbor-in-your-datacenter), чтобы убедиться, что ваш сервер полностью соответствует критериям центра обработки данных.

### <a name="offline-bulk-transfer"></a>Автономная массовая передача
Хотя передача, безусловно, является самым простым вариантом, она может не сработать, если доступная пропускная способность не позволит синхронизировать файлы с Azure за приемлемое время. Основная проблема тут заключается в изначальной синхронизации всего набора файлов. Впоследствии компонент "Синхронизация файлов Azure" будет перемещать только изменения по мере их появления в пространстве имен. При этом обычно используется гораздо меньшая пропускная способность.
Чтобы преодолеть проблему первоначальной передачи, можно использовать инструменты автономного массового перемещения, такие как [семейство Azure Data Box](https://azure.microsoft.com/services/storage/databox). Далее в этой статье рассматривается процесс, выполнив который вы получите преимущества автономного перемещения, совместимого с Синхронизацией файлов Azure. Здесь описываются рекомендации, которые помогут вам избежать конфликтов файлов и сохранить метки времени, а также списки управления доступом для файлов и папок после включения синхронизации.

### <a name="online-migration-tools"></a>Инструменты оперативного перемещения
Описанный ниже процесс работает не только для Data Box. Он работает для любых инструментов автономного перемещения (таких как Data Box) или онлайн-средств, таких как AzCopy, Robocopy или сторонних инструментов и служб. Поэтому, независимо от метода решения задачи первоначальной передачи, по-прежнему очень важно выполнить описанные ниже действия, чтобы использовать эти инструменты способом, совместимым с синхронизацией.


## <a name="offline-data-transfer-benefits"></a>Преимущества автономной передачи данных
Ниже приведены основные преимущества автономного перемещения с использованием Data Box.

- При перемещении файлов в Azure с помощью процессов автономной массовой передачи, таких как Data Box, не нужно передавать по сети все файлы с сервера. Для больших пространств имен это может означать значительную экономию пропускной способности сети и времени.
- При использовании Синхронизации файлов Azure ваш активный сервер передает только те файлы, которые были изменены с момента отправки данных в Azure, независимо от применяемого режима транспортировки (Data Box, служба импорта Azure и т. д.).
- Синхронизация файлов Azure также обеспечивает синхронизацию списков управления доступом для файлов и папок, даже если средство автономного массового перемещения не транспортирует их.
- При использовании Azure Data Box и Синхронизации файлов Azure время простоя равно нулю. Data Box как средство для передачи данных в Azure позволяет эффективно использовать пропускную способность сети при сохранении целостности файла, а также поддерживает пространство имен в обновленном состоянии, передавая только те файлы, которые изменились с момента отправки Data Box.

## <a name="plan-your-offline-data-transfer"></a>Планирование автономной передачи данных
Прежде чем начать, ознакомьтесь со следующими рекомендациями.

- Выполните массовое перемещение в одну или несколько общих папок Azure, прежде чем включить синхронизацию с помощью компонента "Синхронизация файлов Azure".
- Если вы планируете использовать Data Box для массового перемещения, просмотрите [предварительные требования к развертыванию для Data Box](../../databox/data-box-deploy-ordered.md#prerequisites).
- Для планирования окончательной топологии Синхронизации файлов Azure ознакомьтесь со статьей [Планирование развертывания службы синхронизации файлов Azure](storage-sync-files-planning.md)
- Выберите учетные записи хранения Azure, в которых будут храниться общие папки, с которыми нужно выполнить синхронизацию. Убедитесь, что массовое перемещение выполняется во временные общие папки промежуточного хранения в одной и той же учетной записи хранения. Массовое перемещение может быть включено только с использованием конечной общей папки и общей папки промежуточного хранения, которые находятся в одной учетной записи хранения.
- Массовое перемещение возможно только при создании новых связей синхронизации с расположением на сервере. Нельзя включить массовое перемещение с существующими связями синхронизации.

## <a name="offline-data-transfer-process"></a>Процесс автономной передачи данных
В этом разделе описан процесс настройки Синхронизации файлов Azure способом, совместимым с инструментами массового перемещения, такими как Azure Data Box.

![Визуализация шагов процесса, которые подробно объясняются в следующем абзаце](media/storage-sync-files-offline-data-transfer/data-box-integration-1-600.png)

| Шаг | Описание |
|---|---------------------------------------------------------------------------------------|
| ![Шаг 1](media/storage-sync-files-offline-data-transfer/bullet_1.png) | [Заказ Data Box](../../databox/data-box-deploy-ordered.md). [В семействе Data Box существует несколько предложений](https://azure.microsoft.com/services/storage/databox/data), которые соответствуют вашим потребностям. Получите устройство Data Box и следуйте [документации Data Box, чтобы скопировать данные](../../databox/data-box-deploy-copy-data.md#copy-data-to-data-box). Убедитесь, что данные копируются в Data Box по UNC-пути `\\<DeviceIPAddres>\<StorageAccountName_AzFile>\<ShareName>`, где `ShareName` — это имя общей папки для промежуточного хранения. Отправьте Data Box обратно в Azure. |
| ![Шаг 2](media/storage-sync-files-offline-data-transfer/bullet_2.png) | Подождите, пока ваши файлы не появятся в общих папках Azure, которые вы назначили в качестве временных общих папок для промежуточного хранения. **Не включайте синхронизацию для этих общих папок!** |
| ![Шаг 3](media/storage-sync-files-offline-data-transfer/bullet_3.png) | Создайте пустую общую папку для каждой общей папки, созданной для вас службой Data Box. Создать ее нужно в той же учетной записи хранения, где находится общая папка Data Box. [Создание общей папки в службе файлов Azure](storage-how-to-create-file-share.md). |
| ![Шаг 4](media/storage-sync-files-offline-data-transfer/bullet_4.png) | [Создайте группу синхронизации](storage-sync-files-deployment-guide.md#create-a-sync-group-and-a-cloud-endpoint) в службе синхронизации хранилища и укажите пустую общую папку в качестве облачной конечной точки. Повторите этот шаг для каждой общей папки Data Box. Ознакомьтесь с руководством по [развертыванию Синхронизации файлов Azure](storage-sync-files-deployment-guide.md) и выполните действия, необходимые для настройки этого компонента. |
| ![Шаг 5](media/storage-sync-files-offline-data-transfer/bullet_5.png) | [Добавьте каталог своего активного сервера в качестве конечной точки сервера](storage-sync-files-deployment-guide.md#create-a-server-endpoint). В процессе укажите, что вы уже переместили файлы в Azure, и укажите ссылки на общие папки промежуточного хранения. При необходимости вы можете включить распределение по уровням в облаке. При создании конечной точки сервера на активном сервере нужно сослаться на общую папку промежуточного хранения. Включите автономную передачу данных (рисунок ниже) в колонке новой конечной точки сервера и укажите общую папку промежуточного хранения, которая должна находиться в той же учетной записи хранения, что и облачная конечная точка. Список доступных общих папок фильтруется по учетной записи хранения и общим папкам, которые еще не синхронизируются. |

![Пользовательский интерфейс портала Azure с окном включения автономной передачи данных при создании конечной точки сервера](media/storage-sync-files-offline-data-transfer/data-box-integration-2-600.png)

## <a name="syncing-the-share"></a>Синхронизация общих папок
После создания конечной точки сервера начнется синхронизация. Функция синхронизации будет проверять каждый файл, имеющийся на сервере, и определять, существует ли он в общей папке промежуточного хранения, куда служба Data Box поместила файлы. Если такой файл существует, он будет копироваться из общей папки промежуточного хранения, а не передаваться с сервера. Если его не существует в общей папке промежуточного хранения или на локальном сервере доступна его более новая версия, синхронизация передаст файл с локального сервера.

> [!IMPORTANT]
> Режим массового перемещения можно включить только во время создания конечной точки сервера. В настоящее время нет способа интегрировать массово перемещенные данные с уже синхронизирующегося сервера в пространство имен после установки конечной точки сервера.

## <a name="acls-and-timestamps-on-files-and-folders"></a>Списки управления доступом и метки времени для файлов и папок
Синхронизация файлов Azure обеспечит синхронизацию списков управления доступом для файлов и папок с активным сервером, даже если использованный инструмент массового перемещения изначально не передавал списки управления доступом. Это означает, что общая папка промежуточного хранения может и не содержать списки управления доступом для файлов и папок. Если включить функцию автономного перемещения данных при создании конечной точки сервера, списки управления доступом будут синхронизированы для всех файлов на сервере. То же самое касается меток времени создания и изменения.

## <a name="shape-of-the-namespace"></a>Схема пространства имен
Схема пространства имен определяется тем, что находится на сервере, когда включена синхронизация. Если файлы будут удалены с локального сервера после выполнения команд -snapshot и -migration Data Box, то они не будут перенесены в динамическое пространство имен синхронизации. Они по-прежнему будут в общей папке промежуточного хранения, но никогда не скопируются. Это желаемое поведение, так как синхронизация сохраняет пространство имен в соответствии с активным сервером. Моментальный снимок Data Box — это лишь плацдарм для эффективного копирования файлов, а не шаблон для схемы активного пространства имен.

## <a name="finishing-bulk-migration-and-clean-up"></a>Завершение процесса массового перемещения и очистка
На приведенном ниже снимке экрана показана колонка свойств конечной точки сервера на портале Azure. В разделе "Offline Data Transfer" (Автономная передача данных) показано состояние процесса: "Выполняется" или "Завершено".

После того как сервер завершит первоначальную синхронизацию всего пространства имен, он прекратит использовать общую папку промежуточного хранения с массово перенесенными файлами Data Box. Обратите внимание, что в свойствах конечной точки сервера для автономной передачи данных состояние меняется на "Завершено". На данном этапе можно очистить общую папку промежуточного хранения для экономии затрат.

1. Щелкните Disable offline data transfer (Отключить автономную передачу данных) в свойствах конечной точки сервера, когда установлено состояние "Завершено".
2. Подумайте об удалении общей папки промежуточного хранения для экономии затрат. Общая папка промежуточного хранения вряд ли будет содержать списки управления доступом для файлов и папок, и поэтому ее использование ограниченно. Для создания резервной копии на определенный момент времени лучше создать реальный [моментальный снимок общей папки синхронизации Azure](storage-snapshots-files.md). Вы можете [включить Azure Backup, чтобы создавать моментальные снимки]( ../../backup/backup-azure-files.md) по расписанию.

![Пользовательский интерфейс портала Azure: окно свойств конечной точки сервера, где расположен параметр состояния и отключения автономной передачи данных.](media/storage-sync-files-offline-data-transfer/data-box-integration-3-444.png)

Этот режим следует отключать только, если синхронизация находится в состоянии "Завершено" или если вы действительно хотите прервать работу из-за неправильной настройки. Если отключить режим посреди процесса работоспособного развертывания, файлы начнут передаваться с сервера, даже если общая папка промежуточного хранения все еще доступна.

> [!IMPORTANT]
> После отключения автономной передачи данных ее невозможно включить снова, даже если общая папка промежуточного хранения для массового перемещения все еще доступна.

## <a name="next-steps"></a>Дополнительная информация
- [Планирование развертывания службы синхронизации файлов Azure (предварительная версия)](storage-sync-files-planning.md)
- [Как развернуть службу синхронизации файлов Azure (предварительная версия)](storage-sync-files-deployment-guide.md)
