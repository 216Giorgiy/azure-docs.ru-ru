---
title: "Репликация данных в службе хранилища Azure | Документация Майкрософт"
description: "Данные в учетной записи хранения Microsoft Azure реплицируются для обеспечения устойчивости и высокого уровня доступности. Варианты репликации включают локально избыточное хранилище (LRS), хранилище, избыточное в пределах зоны (ZRS), геоизбыточное хранилище (GRS) и геоизбыточное хранилище с доступом для чтения (RA-GRS)."
services: storage
author: tamram
manager: jeconnoc
ms.service: storage
ms.workload: storage
ms.topic: article
ms.date: 01/21/2018
ms.author: tamram
ms.openlocfilehash: 18d0e8bc6cc1559f9ae1a1a4457aa85d2a206597
ms.sourcegitcommit: ded74961ef7d1df2ef8ffbcd13eeea0f4aaa3219
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2018
---
# <a name="azure-storage-replication"></a>Репликация службы хранилища Azure

Данные в учетной записи хранения Microsoft Azure всегда реплицируются, обеспечивая устойчивость и высокий уровень доступности. При репликации ваши данные копируются, что обеспечивает их защиту от временных сбоев оборудования и сохраняет бесперебойную работу приложений. 

Вы можете реплицировать данные в пределах одного центра обработки данных, между центрами обработки данных в одном регионе или между регионами. Если данные реплицируются между несколькими центрами обработки данных или между регионами, они также защищены от глобальных сбоев в одном расположении.

Репликация гарантирует соответствие учетной записи хранения [соглашению об уровне обслуживания относительно хранения данных](https://azure.microsoft.com/support/legal/sla/storage/) даже при сбоях. Сведения о гарантиях службы хранилища Azure в вопросах устойчивости и доступности см. в соглашении об уровне обслуживания.

При создании учетной записи хранения можно выбрать один из следующих вариантов репликации:

* [Локально избыточное хранилище (LRS)](#locally-redundant-storage)
* [Хранилище, избыточное в пределах зоны (ZRS)](#zone-redundant-storage)
* [Геоизбыточное хранилище (GRS)](#geo-redundant-storage)
* [Геоизбыточное хранилище с доступом для чтения (RA-GRS)](#read-access-geo-redundant-storage)

Геоизбыточное хранилище с доступом для чтения (RA-GRS) предоставляется по умолчанию при создании учетной записи хранения.

В таблице ниже представлено краткое описание различий между LRS, ZRS, GRS и RA-GRS. Следующие разделы этой статьи описывают каждый тип репликации более подробно.

| Стратегия репликации | LRS | ZRS | GRS | RA-GRS |
|:--- |:--- |:--- |:--- |:--- |
| Данные реплицируются в нескольких центрах обработки данных. |Нет  |Yes |Yes |Yes |
| Данные можно считать как из основного, так и из дополнительного расположения. |Нет  |Нет  |Нет  |Yes |
| Предназначено для обеспечения надежности объектов на уровне ___ в течение определенного года. |не менее 99,999999999 % (11 девяток)|не менее 99,9999999999 % (12 девяток)|не менее 99,99999999999999 % (16 девяток)|не менее 99,99999999999999 % (16 девяток)|

В разделе [Цены на хранилища Azure](https://azure.microsoft.com/pricing/details/storage/) приведены сведения о различных вариантах обеспечения избыточности данных.

> [!NOTE]
> Хранилище класса Premium поддерживает только локально избыточное хранилище (LRS). Сведения о хранилище класса "Премиум" см. в статье [Хранилище класса "Премиум": высокопроизводительное хранилище для рабочих нагрузок виртуальных машин Azure](../../virtual-machines/windows/premium-storage.md).
>

## <a name="locally-redundant-storage"></a>Локально избыточное хранилище
[!INCLUDE [storage-common-redundancy-LRS](../../../includes/storage-common-redundancy-LRS.md)]

## <a name="zone-redundant-storage"></a>Хранилище, избыточное в пределах зоны
[!INCLUDE [storage-common-redundancy-ZRS](../../../includes/storage-common-redundancy-ZRS.md)]

### <a name="zrs-classic-accounts"></a>Классические учетные записи ZRS

Имеющееся предложение ZRS теперь называется классическим хранилищем ZRS. Классические учетные записи ZRS доступны только для блочных BLOB-объектов в учетных записях хранения общего назначения версии 1. 

В классическом хранилище ZRS данные асинхронно реплицируются в центрах обработки данных в пределах одного или двух регионов. Реплика будет недоступна, если корпорация Майкрософт не инициирует отработку отказа в дополнительном регионе. 

Классическую учетную запись ZRS невозможно преобразовать в учетную запись хранилища LRS, GRS или RA-GRS и наоборот. Кроме того, она не поддерживает использование метрик или ведение журналов.   

После того как хранилище ZRS станет общедоступным в регионе, вы больше не сможете создавать классическую учетную запись ZRS на портале в этом регионе. Однако ее можно создать другими способами.  
Автоматический процесс перемещения с классической учетной записи ZRS на обычную будет предоставлен в будущем.

Можно вручную перенести данные учетной записи ZRS в учетную запись LRS, классического ZRS, GRS или RAGRS, либо из нее. Ручную миграцию можно выполнить с помощью AzCopy, Обозревателя службы хранилища Azure, Azure PowerShell, Azure CLI или одной из клиентских библиотек службы хранилища Azure.

> [!NOTE]
> Поддержка классических учетных записей ZRS планируется до 31 марта 2021 г., после чего необходимо будет выполнить перенос. Перед прекращением поддержки корпорация Майкрософт отправит дополнительные сведения клиентам классического хранилища ZRS.

С ответами на другие вопросы можно ознакомиться в разделе [Часто задаваемые вопросы](#frequently-asked-questions). 

## <a name="geo-redundant-storage"></a>Геоизбыточное хранилище
[!INCLUDE [storage-common-redundancy-GRS](../../../includes/storage-common-redundancy-GRS.md)]

## <a name="read-access-geo-redundant-storage"></a>Геоизбыточное хранилище с доступом для чтения
Геоизбыточное хранилище с доступом для чтения (RA-GRS) максимально увеличивает доступность учетной записи хранения. Оно предоставляет доступ только для чтения к данным во вторичном местоположении в дополнение к георепликации между двумя регионами.

При включении доступа только для чтения для данных во вторичном регионе ваши данные будут доступны как в первичной конечной точке, так и во вторичной конечной точке учетной записи хранения. Вторичная конечная точка аналогична первичной конечной точке, но к имени учетной записи добавляется суффикс `–secondary` . Например, если первичная конечная точка для службы BLOB-объектов — `myaccount.blob.core.windows.net`, то вторичная конечная точка — `myaccount-secondary.blob.core.windows.net`. Ключи доступа для учетной записи хранения одинаковые как для первичной, так и для вторичной конечных точек.

Рекомендации при работе с RA-GRS:

* При использовании RA-GRS для приложения необходимо указать, с какой конечной точкой взаимодействовать.
* Так как асинхронная репликация подразумевает задержку, изменения, еще не реплицированные в дополнительный регион, могут быть потеряны, если данные будет невозможно восстановить из основного региона, например в случае региональной аварии.
* Если корпорация Майкрософт инициирует отработку отказа в дополнительный регион, то у вас будет доступ на чтение и запись к этим данным после того, как отработка отказа завершится. Дополнительные сведения см. в статье [Что делать в случае простоя службы хранилища Azure](../storage-disaster-recovery-guidance.md).
* RA-GRS предназначено для обеспечения высокой доступности. Дополнительные сведения по масштабируемости см. в статье [Производительность хранилища Microsoft Azure и контрольный список масштабируемости](../storage-performance-checklist.md).

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

<a id="howtochange"></a>
#### <a name="1-how-can-i-change-the-geo-replication-type-of-my-storage-account"></a>1. Как изменить тип георепликации для моей учетной записи хранения?

   Изменить тип георепликации учетной записи хранения можно с помощью [портала Azure](https://portal.azure.com/), [Azure PowerShell](storage-powershell-guide-full.md) или с помощью одной из клиентских библиотек службы хранилища Azure.

   > [!NOTE]
   > Учетные записи ZRS нельзя преобразовать в LRS или GRS. Аналогичным образом нельзя преобразовать существующую учетную запись LRS или GRS в учетную запись ZRS.
    
<a id="changedowntime"></a>
#### <a name="2-does-changing-the-replication-type-of-my-storage-account-result-in-down-time"></a>2. Будет ли какой-либо простой при изменении типа репликации для учетной записи хранения?

   Нет, при изменении типа репликации для учетной записи хранения простоя не будет.

<a id="changecost"></a>
#### <a name="3-are-there-additional-costs-to-changing-the-replication-type-of-my-storage-account"></a>3. Взимается ли дополнительная плата в случае изменения типа репликации для учетной записи хранения?

   Да. Если для своей учетной записи изменить тип репликации LRS на GRS (или RA-GRS), придется дополнительно оплатить исходящий трафик, необходимый для копирования существующих данных из основного расположения в дополнительное расположение. После копирования исходных данных дополнительная плата за исходящий трафик при георепликации из основного в дополнительное расположение не взимается. Сведения о стоимости пропускной способности см. на странице [цен на хранение блочных BLOB-объектов](https://azure.microsoft.com/pricing/details/storage/blobs/).

   Если изменить тип репликации GRS на LRS, дополнительная плата не потребуется, но данные удаляются из дополнительного расположения.

<a id="ragrsbenefits"></a>
#### <a name="4-how-can-ra-grs-help-me"></a>4. Чем мне поможет RA-GRS?

   Геоизбыточное хранилище (GRS) обеспечивает репликацию данных из основного в дополнительный регион, который находится в сотнях километров от основного региона. С GRS данные будут устойчивы даже в случае отключения электричества во всем регионе или аварии, при которой первичный регион не может быть восстановлен. Хранилище RA-GRS обеспечивает репликацию GRS, а также возможность считывать данные из дополнительного расположения. Рекомендации по обеспечению высокого уровня доступности см. в статье [Проектирование высокодоступных приложений с использованием RA-GRS](../storage-designing-ha-apps-with-ragrs.md).

<a id="lastsynctime"></a>
#### <a name="5-is-there-a-way-to-figure-out-how-long-it-takes-to-replicate-my-data-from-the-primary-to-the-secondary-region"></a>5. Есть ли способ узнать, сколько времени займет репликация данных из основного в дополнительный регион?

   Если вы используете хранилище RA-GRS, то можете проверить время последней синхронизации своей учетной записи хранения. Время последней синхронизации — это значение даты и времени по Гринвичу. Все данные, записанные в основное расположение до последней синхронизации, были успешно записаны в дополнительное расположение. Это значит, что они доступны для чтения в дополнительном расположении. Данные, записанные в основное расположение после последней синхронизации, могут быть как доступны, так и не доступны для чтения. Вы можете запросить это значение с помощью [портала Azure](https://portal.azure.com/), [Azure PowerShell](storage-powershell-guide-full.md) или с помощью одной из клиентских библиотек службы хранилища Azure.

<a id="outage"></a>
#### <a name="6-if-there-is-an-outage-in-the-primary-region-how-do-i-switch-to-the-secondary-region"></a>6. Как можно переключиться на дополнительный регион в случае сбоя в основном?

   Дополнительные сведения см. в разделе [Что делать в случае сбоя службы хранилища Azure](../storage-disaster-recovery-guidance.md).

<a id="rpo-rto"></a>
#### <a name="7-what-is-the-rpo-and-rto-with-grs"></a>7. Что такое RPO и RTO для GRS?

   **Целевая точка восстановления (RPO).** В хранилищах GRS и RA-GRS служба хранилища асинхронно геореплицирует данные из основного расположения в дополнительное. Если произойдет серьезная региональная авария в основном регионе, корпорация Майкрософт выполнит отработку отказа в дополнительный регион, а последние изменения, которые не были геореплицированы, могут быть утеряны. Число минут, за которые возможна потеря данных, называется целевой точкой восстановления (она указывает точку во времени, до которой можно восстановить данные). Обычно RPO в службе хранилища Azure не превышает 15 минут, хотя на данный момент нет какого-либо соглашения об уровне обслуживания, регулирующего длительность георепликации.

   **Цель времени восстановления (RTO).** RTO — это время, необходимое для выполнения отработки отказа и возобновления работы учетной записи хранения. Время, затрачиваемое на отработку отказа, обусловлено следующими действиями:

   * Время, затрачиваемое корпорацией Майкрософт, чтобы определить, можно ли восстановить данные в основном расположении или нужно ли выполнить отработку отказа.
   * Время на выполнение отработки отказа учетной записи путем изменения основных DNS-записей для указания на дополнительное расположение.

   Корпорация Майкрософт ответственно относится к сохранению ваших данных. Если есть хоть какая-нибудь возможность восстановить данные, корпорация Майкрософт не торопится выполнить отработку отказа и сосредотачивается на восстановлении данных. В будущих версиях этой службы вы сможете активировать отработку отказа на уровне учетной записи, чтобы иметь возможность самостоятельно управлять RTO.

#### <a name="8-what-azure-storage-objects-does-zrs-support"></a>8. Какие объекты службы хранилища Azure поддерживает ZRS? 
Блочные BLOB-объекты, страничные BLOB-объекты (кроме резервных дисков виртуальных машин), таблицы, файлы и очереди. 

#### <a name="9-does-zrs-also-include-geo-replication"></a>9. Поддерживает ли ZRS георепликацию? 
Сейчас ZRS не поддерживают георепликацию. Вместо этого вы можете воспользоваться учетной записью хранения GRS или RA-GRS, если в сценарии требуется выполнить межрегиональную репликацию для аварийного восстановления.   

#### <a name="10-what-happens-when-one-or-more-zrs-zones-go-down"></a>10. Что происходит в случае сбоя нескольких зон ZRS? 
Если первая зона выйдет из строя, ZRS продолжит записывать реплики данных в двух оставшихся зонах в регионе. Если вторая зона выйдет из строя, вы не будете иметь доступ для чтения и записи, пока хотя бы две зоны не будут снова доступны. 

## <a name="next-steps"></a>Дополнительная информация
* [Проектирование высокодоступных приложений с использованием RA-GRS](../storage-designing-ha-apps-with-ragrs.md)
* [Цены на хранилища Azure](https://azure.microsoft.com/pricing/details/storage/)
* [Об учетных записях хранения Azure](../storage-create-storage-account.md)
* [Целевые показатели масштабируемости и производительности службы хранилища Azure](storage-scalability-targets.md)
* [Windows Azure Storage Redundancy Options and Read Access Geo Redundant Storage](http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/11/introducing-read-access-geo-replicated-storage-ra-grs-for-windows-azure-storage.aspx) (Варианты избыточности и геоизбыточное хранилище с доступом для чтения службы хранилища Microsoft Azure)
* [Документ SOSP — служба хранилища Azure: высокодоступная облачная служба хранилища со строгой согласованностью](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)
