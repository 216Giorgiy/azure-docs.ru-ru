---
title: Что делать в случае простоя службы хранилища Azure | Документация Майкрософт
description: Что делать в случае простоя службы хранилища Azure
services: storage
author: tamram
ms.service: storage
ms.devlang: dotnet
ms.topic: article
ms.date: 12/12/2018
ms.author: tamram
ms.component: common
ms.openlocfilehash: 39a938d45c8f15c21b44bb5b04b1429fb4733b5a
ms.sourcegitcommit: e37fa6e4eb6dbf8d60178c877d135a63ac449076
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/13/2018
ms.locfileid: "53323274"
---
# <a name="what-to-do-if-an-azure-storage-outage-occurs"></a>Что делать в случае простоя службы хранилища Azure
Корпорация Майкрософт прилагает все усилия, чтобы наши службы были всегда доступны. Иногда по независящим от нас обстоятельствам происходят незапланированные простои служб в одном или нескольких регионах. Ниже приведено общее руководство для служб хранилища Azure, которое поможет вам справиться с такими редкими ситуациями.

## <a name="how-to-prepare"></a>Подготовка
Крайне важно, чтобы каждый клиент подготовил свой собственный план аварийного восстановления. Меры по восстановлению работоспособности приложений после простоя обычно охватывают как персонал, так и автоматизированные процедуры. Обратитесь к приведенной ниже документации Azure, чтобы составить свой план аварийного восстановления.

* [Контрольный список для обеспечения доступности](https://docs.microsoft.com/azure/architecture/checklist/availability)
* [Проектирование устойчивых приложений для Azure](https://docs.microsoft.com/azure/architecture/resiliency/)
* [Служба Azure Site Recovery](https://azure.microsoft.com/services/site-recovery/)
* [Репликация службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy)
* [Служба архивации Azure](https://azure.microsoft.com/services/backup/)

## <a name="how-to-detect"></a>Определение
Чтобы определить состояние службы Azure, рекомендуется подписаться на [панель мониторинга работоспособности службы Azure](https://azure.microsoft.com/status/).

## <a name="what-to-do-if-a-storage-outage-occurs"></a>Что делать в случае простоя службы хранилища
Если одна или несколько служб хранилища временно недоступны в одном или нескольких регионах, вы можете воспользоваться одним из двух вариантов. Если требуется немедленный доступ к данным, рассмотрите вариант 2.

### <a name="option-1-wait-for-recovery"></a>Вариант 1. Ожидание восстановления
В этом случае вам не нужно предпринимать какие-либо действия. Мы активно работаем для восстановления доступности службы Azure. Текущее состояние службы можно просмотреть на [панели мониторинга работоспособности службы Azure](https://azure.microsoft.com/status/).

### <a name="option-2-copy-data-from-secondary"></a>Вариант 2. Копирование данных из дополнительного региона
Если вы выбрали [Read-access geo-redundant storage (RA-GRS)](storage-redundancy-grs.md#read-access-geo-redundant-storage) (Доступ для чтения данных из гео-избыточного хранилища) (рекомендуется) для учетных записей хранения, то получите доступ только для чтения к своим данным из дополнительного региона. Вы можете использовать такие средства, как [AzCopy](storage-use-azcopy.md), [Azure PowerShell](storage-powershell-guide-full.md) и [библиотека перемещения данных Azure](https://azure.microsoft.com/blog/introducing-azure-storage-data-movement-library-preview-2/), чтобы скопировать данные из дополнительного региона в другую учетную запись хранения в незатронутом регионе и затем указать эту учетную запись для приложений как доступную для чтения и записи.

## <a name="what-to-expect-if-a-storage-failover-occurs"></a>Что произойдет в случае отработки отказа хранилища
Если вы выбрали [Геоизбыточное хранилище](storage-redundancy-grs.md) или [Доступ к геоизбыточному хранилищу для чтения](storage-redundancy-grs.md#read-access-geo-redundant-storage) (рекомендуется), служба хранилища Azure будет хранить данные устойчиво в двух регионах (основном и дополнительном). В обоих регионах служба хранилища Azure постоянно поддерживает несколько реплик ваших данных.

Когда в основном регионе происходит авария, мы сначала пытаемся восстановить службу в нем, чтобы обеспечить наилучшее сочетание RTO и RPO. Это зависит от характера аварии и ее последствий; в некоторых редких ситуациях мы не можем восстановить основной регион. В этом случае мы выполняем географическую отработку отказа. Межрегиональная репликация данных является асинхронным процессом, который может подразумевать некоторую задержку, поэтому изменения, которые еще не были реплицированы в дополнительный регион, могут быть потеряны.

Ряд замечаний о географической отработке отказа хранилища.

* Географическая отработка отказа хранилища будет инициироваться только команда специалистов по службе хранилища Azure, никаких действий со стороны клиента не требуется. Отработка отказа активируется, если рабочая группа службы хранилища Azure исчерпала все варианты восстановления данных в одном регионе, что обеспечивает наилучшее сочетание RTO и RPO.
* После отработки отказа существующие конечные точки службы хранилища для больших двоичных объектов, таблиц, очередей и файлов остаются прежними. При этом потребуется обновить предоставленную Майкрософт запись DNS для переключения с основного региона на дополнительный. Корпорация Майкрософт выполнит это обновление автоматически в рамках географической отработки отказа.
* До и во время географической отработки отказа у вас не будет доступа на запись к своей учетной записи хранения, однако вы сможете считывать данные из дополнительного региона, если ваша учетная запись хранения была настроена как RA-GRS.
* После окончания географической отработки отказа и распространения изменений DNS функции чтения и записи для вашей учетной записи хранения восстанавливаются, если имеется геоизбыточное хранилище (GRS) или геоизбыточное хранилище с доступом на чтение (RA-GRS). Конечная точка, которая ранее была дополнительной, становится основной. 
* Вы можете проверить состояние основного расположения и выполнить запрос времени последней географической отработки отказа для вашей учетной записи хранения. Дополнительные сведения см. в статье [Получение свойств учетных записей хранения](https://docs.microsoft.com/rest/api/storagerp/storageaccounts/getproperties).
* После отработки отказа ваша учетная запись хранения будет полностью работоспособной, однако будет находиться в состоянии пониженной функциональности из-за размещения в автономном регионе без возможности георепликации. Чтобы уменьшить этот риск, мы восстановим исходный основной области и выполним географическую отработку отказа для восстановления исходного состояния. Если исходный основной регион не подлежит восстановлению, мы назначим другой дополнительный регион.

## <a name="best-practices-for-protecting-your-data"></a>Советы и рекомендации по защите данных
Существуют некоторые рекомендуемые подходы для регулярной архивации данных в хранилище.

* Диски виртуальной машины — используйте [службу архивации Azure](https://azure.microsoft.com/services/backup/) для архивации дисков виртуальных машин Azure.
* Блочные BLOB-объекты — включите [обратимое удаление](../blobs/storage-blob-soft-delete.md), чтобы предотвратить удаление и перезапись на уровне объектов, или скопируйте BLOB-объекты в другую учетную запись хранения, относящуюся к другому региону, с помощью [AzCopy](storage-use-azcopy.md), [Azure PowerShell](storage-powershell-guide-full.md) или [библиотеки перемещения данных Azure](https://azure.microsoft.com/blog/introducing-azure-storage-data-movement-library-preview-2/).
* Таблицы — используйте [AzCopy](storage-use-azcopy.md) для экспорта данных таблиц в другую учетную запись хранения, относящуюся к другому региону.
* Файлы — используйте [AzCopy](storage-use-azcopy.md) или [Azure PowerShell](storage-powershell-guide-full.md) для копирования файлов в другую учетную запись хранения, относящуюся к другому региону.

Сведения о создании приложений, использующих все преимущества функции RA-GRS, доступны в разделе [Проектирование высокодоступных приложений с использованием хранилища RA-GRS](../storage-designing-ha-apps-with-ragrs.md).
