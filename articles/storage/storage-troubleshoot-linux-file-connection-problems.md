---
title: "Устранение неполадок хранилища файлов Azure в Linux | Документация Майкрософт"
description: "Устранение неполадок, возникающих в работе хранилища файлов Azure в Linux."
services: storage
documentationcenter: 
author: genlin
manager: willchen
editor: na
tags: storage
ms.service: storage
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: genli
ms.translationtype: HT
ms.sourcegitcommit: 54454e98a2c37736407bdac953fdfe74e9e24d37
ms.openlocfilehash: 62cd62ec3a2900f06acacc0852a48b5e3ff1c8cd
ms.contentlocale: ru-ru
ms.lasthandoff: 07/13/2017

---
# <a name="troubleshoot-azure-file-storage-problems-in-linux"></a>Устранение неполадок в работе хранилища файлов Azure в Linux

В этой статье приведен список распространенных проблем, возникающих в хранилище файлов Microsoft Azure при подключении с клиентов Linux. Кроме того, здесь представлены возможные причины этих проблем и способы их устранения.

<a id="permissiondenied"></a>
## <a name="permission-denied-disk-quota-exceeded-when-you-try-to-open-a-file"></a>Отображается сообщение "[permission denied] Disk quota exceeded" ([Отказано в разрешении]. Превышена дисковая квота) при попытке открыть файл

Работая в Linux, вы получаете сообщение об ошибке, которое имеет следующий вид.

**<filename> [permission denied] Disk quota exceeded**

### <a name="cause"></a>Причина:

Достигнуто максимально допустимое число открытых дескрипторов, разрешенных для файла.

### <a name="solution"></a>Решение

Сократите количество одновременно открытых дескрипторов, закрыв некоторые из них, и повторите операцию. Дополнительные сведения см. в статье [Производительность хранилища Microsoft Azure и контрольный список масштабируемости](storage-performance-checklist.md).

<a id="slowfilecopying"></a>
## <a name="slow-file-copying-to-and-from-azure-file-storage-in-linux"></a>Медленное копирование файлов в хранилище файлов Azure и из него в Linux

-   Если определенные требования к минимальному размеру операций ввода-вывода отсутствуют, для оптимальной производительности мы рекомендуем использовать 1 МБ.
-   Если окончательный размер файла, в который выполняются операции записи, известен, а у программного обеспечения нет проблем совместимости, и если еще не записанный заключительный фрагмент файла содержит нули, укажите размер файла заранее вместо того, чтобы расширять его для каждой операции записи.
-   Используйте правильный метод копирования:
    -   Используйте [AZCopy](storage-use-azcopy.md#file-copy) для передачи данных между двумя файловыми ресурсами.
    -   Используйте [Robocopy](https://blogs.msdn.microsoft.com/granth/2009/12/07/multi-threaded-robocopy-for-faster-copies/) для передачи данных между файловыми ресурсами и локальным компьютером.

<a id="error112"></a>
## <a name="mount-error112-host-is-down-because-of-a-reconnection-time-out"></a>Отображается сообщение "Mount error(112): Host is down" (Ошибка подключения (112). Узел не работает) из-за истечения времени ожидания повторного подключения

Ошибка подключения (112) возникает в клиенте Linux, если он бездействует в течение длительного времени. Когда клиент долгое время бездействует, он отключается и время ожидания его подключения истекает.  

### <a name="cause"></a>Причина:

Подключение может бездействовать по следующим причинам:

-   сбои сети, которые мешают повторно установить подключение TCP к серверу, если используется режим мягкого подключения (режим по умолчанию);
-   последние исправления повторного подключения, отсутствующие в ядрах предыдущих версий.

### <a name="solution"></a>Решение

Эта проблема повторного подключения в ядре Linux исправлена в рамках следующих изменений:

- [Исправление повторного подключения к неотложенному сеансу переподключения mb3 через продолжительное время после повторного подключения сокета](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/fs/cifs?id=4fcd1813e6404dd4420c7d12fb483f9320f0bf93)
-   [Вызов службы echo сразу же после повторного подключения сокета](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=b8c600120fc87d53642476f48c8055b38d6e14c7)
-   [CIFS: устранение возможного повреждения содержимого памяти во время повторного подключения](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=53e0e11efe9289535b060a51d4cf37c25e0d0f2b)
-   [CIFS: устранение возможной двойной блокировки мьютекса во время повторного подключения — для ядра v4.9 и более поздних версий](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=96a988ffeb90dba33a71c3826086fe67c897a183)

Тем не менее эти изменения могут быть перенесены еще не во все дистрибутивы Linux. Данное исправление и другие исправления повторного подключения внесены в следующие распространенные версии ядра Linux: 4.4.40, 4.8.16 и 4.9.1. Это исправление можно получить, выполнив обновление до одной из этих рекомендуемых версий ядра.

### <a name="workaround"></a>Возможное решение

Можно обойти эту проблему, указав жесткое подключение. Это вынудит клиент ждать, пока подключение не будет установлено или прервано явным образом. Это может использоваться для предотвращения ошибок из-за истечения времени ожидания сети. Тем не менее этот способ может породить неопределенное время ожидания. Будьте готовы останавливать подключения при необходимости.

Если не удается выполнить обновление до последних версий ядра, можно обойти эту проблему, поместив в файловый ресурс Azure какой-либо файл и перезаписывая его каждые 30 секунд (или чаще). Это должна быть операция записи, такая как перезапись даты создания или изменения файла. В противном случае можно получить кэшированные результаты, в итоге операция записи не активирует повторное подключение.

<a id="error115"></a>
## <a name="mount-error115-operation-now-in-progress-when-you-mount-azure-file-storage-by-using-smb-30"></a>Отображается ошибка "Mount error(115): Operation now in progress" (Ошибка подключения (115). Идет выполнение операции) при подключении хранилища файлов Azure с помощью SMB 3.0

### <a name="cause"></a>Причина:

Некоторые дистрибутивы Linux не поддерживают функции шифрования в SMB 3.0. Поэтому при попытке подключения хранилища файлов Azure с помощью SMB 3.0. пользователь может получить сообщение об ошибке "115".

### <a name="solution"></a>Решение

Функция шифрования протокола SMB 3.0 для Linux появилась в ядре версии 4.11. Эта функция позволяет подключать общую папку файлов Azure из локальной среды или другого региона Azure. На момент публикации этой статьи функция была добавлена в дистрибутивы Ubuntu 17.04 и Ubuntu 16.10. Если используемый SMB-клиент Linux не поддерживает шифрование, подключите хранилище файлов Azure с помощью SMB 2.1 с виртуальной машины Linux в Azure, расположенной в том же центре обработки данных, что и учетная запись хранения службы файлов.

<a id="slowperformance"></a>
## <a name="slow-performance-on-an-azure-file-share-mounted-on-a-linux-vm"></a>Низкая производительность файлового ресурса Azure, подключенного к виртуальной машине Linux

### <a name="cause"></a>Причина:

Одной из возможных причин снижения производительности может быть отключенное кэширование.

### <a name="solution"></a>Решение

Чтобы проверить, отключено ли кэширование, найдите запись **cache=**. 

Запись **cache=none** означает, что кэширование отключено.  Повторно подключите общедоступный ресурс, введя команду mount по умолчанию или явно добавив в нее параметр **cache=strict**, чтобы включить режим кэширования по умолчанию или "строгий" режим кэширования соответственно.

В некоторых сценариях параметр подключения **serverino** может привести к тому, что команда **ls** формирует статистику для каждой записи каталога. Это приводит к снижению производительности при выводе содержимого больших каталогов. Параметры подключения можно просмотреть в записи **/etc/fstab**.

`//azureuser.file.core.windows.net/cifs /cifs cifs vers=3.0,serverino,username=xxx,password=xxx,dir_mode=0777,file_mode=0777`

Можно также проверить, правильные ли параметры используются, выполнив команду **sudo mount | grep cifs** и проверив ее выходные данные. Пример выходных данных этой команды приведен ниже.

`//mabiccacifs.file.core.windows.net/cifs on /cifs type cifs (rw,relatime,vers=3.0,sec=ntlmssp,cache=strict,username=xxx,domain=X,uid=0,noforceuid,gid=0,noforcegid,addr=192.168.10.1,file_mode=0777, dir_mode=0777,persistenthandles,nounix,serverino,mapposix,rsize=1048576,wsize=1048576,actimeo=1)`

Если параметр **cache=strict** или **serverino** отсутствует, отключите и повторно подключите хранилище файлов Azure, выполнив команду mount из [документации](storage-how-to-use-files-linux.md). Затем еще раз проверьте наличие правильных параметров в записи **/etc/fstab**.

<a id="timestampslost"></a>
## <a name="time-stamps-were-lost-in-copying-files-from-windows-to-linux"></a>При копировании файлов из Windows в Linux были потеряны метки времени

На платформах, Linux и Unix команда **cp -p** завершается сбоем, если файл 1 и файл 2 принадлежат разным пользователям.

### <a name="cause"></a>Причина:

Флаг принудительного применения **f** в COPYFILE приводит к выполнению команды **cp -p -f** в Unix. Этой команде также не удается сохранить метку времени файла, который вам не принадлежит.

### <a name="workaround"></a>Возможное решение

Используйте пользователя учетной записи хранения для копирования файлов.

- `Useadd : [storage account name]`
- `Passwd [storage account name]`
- `Su [storage account name]`
- `Cp -p filename.txt /share`

## <a name="need-help-contact-support"></a>Требуется помощь? Обратитесь в службу поддержки.

Если вам все еще нужна помощь, [обратитесь в службу поддержки](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade), которая поможет быстро устранить проблему.

