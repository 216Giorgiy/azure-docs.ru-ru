<properties 
	pageTitle="Использование эмулятора хранения Azure для разработки и тестирования | Microsoft Azure" 
	description="Эмулятор хранения Azure предоставляет свободную локальную среду разработки для разработки и тестирования в хранилище Azure. Узнайте больше об эмуляторе хранения, включая способ проверки подлинности запросов, подключение к эмулятору из приложения и использование программы командной строки." 
	services="storage" 
	documentationCenter="" 
	authors="tamram" 
	manager="carmonm" 
	editor="tysonn"/>
<tags 
	ms.service="storage" 
	ms.workload="storage" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="03/28/2016" 
	ms.author="tamram"/>

# Использование эмулятора хранения Azure для разработки и тестирования

## Обзор

Эмулятор службы хранилища Microsoft Azure предоставляет собой локальную среду, эмулирующую службы BLOB-объектов, очередей и таблиц для целей разработки. Используя эмулятор хранения, можно локально протестировать приложение со службами хранилища без создания подписки Azure, избежав затрат. Если приложение в эмуляторе работает правильно, вы можете использовать учетную запись хранения Azure в облаке.

> [AZURE.NOTE] Эмулятор хранения входит в [пакет SDK для Microsoft Azure](https://azure.microsoft.com/downloads/). Его также можно установить с помощью [автономного установщика](https://go.microsoft.com/fwlink/?linkid=717179&clcid=0x409). Чтобы настроить эмулятор хранения, необходимо обладать правами администратора на компьютере.
>  
> Обратите внимание, что данные, созданные в одной версии эмулятора хранения, могут быть недоступны при использовании другой версии. Если нужно сохранить данные на длительный срок, рекомендуется хранить их в учетной записи хранения Azure, а не в эмуляторе хранения.

## Принцип работы эмулятора хранения
 
Для эмуляции служб хранилища Azure эмулятор хранения использует локальный экземпляр базы данных Microsoft SQL Server и локальную файловую систему. По умолчанию эмулятор хранения использует базу данных, расположенную в Microsoft® SQL Server 2012 Express LocalDB. Вы можете настроить эмулятор хранения для доступа к локальному экземпляру SQL Server вместо LocalDB. Дополнительные сведения см. ниже в разделе [Запуск и инициализация эмулятора хранения](#start-and-initialize-the-storage-emulator).

Вы можете установить SQL Server Management Studio Express для управления установкой LocalDB. Эмулятор хранения подключается к SQL Server или LocalDB с использованием аутентификации Windows.

Между эмулятором хранения и службой хранилища Azure есть несколько различий. Подробную информацию об этих различиях см. в статье [Различия между эмулятором хранения и службами хранилища Azure](#differences-between-the-storage-emulator-and-azure-storage).

## Проверка подлинности запросов на эмулятор хранения

Как и в службе хранилища Azure в облаке, подлинность каждого запроса, отправляемого на эмулятор хранения, должна быть подтверждена. В противном случае такой запрос будет считаться анонимным. Проверить подлинность запросов на эмулятор хранения можно с помощью проверки подлинности по общему ключу или с помощью подписанного URL-адреса \(SAS\).

### Проверка подлинности с использованием учетных данных общего ключа

[AZURE.INCLUDE [storage-emulator-connection-string-include](../../includes/storage-emulator-connection-string-include.md)]

Дополнительные сведения о строках подключения см. в разделе [Настройка строк подключения службы хранилища Azure](storage-configure-connection-string.md).

### Проверка подлинности с помощью подписанного URL-адреса 

Некоторые клиентские библиотеки хранилища Azure, такие как библиотека Xamarin, поддерживают только проверку подлинности с помощью маркера подписанного URL-адреса \(SAS\). Создайте маркер SAS, используя программу или приложение, поддерживающие проверку подлинности с помощью общего ключа. Проще всего создать маркер SAS можно через модуль Azure PowerShell:

1. Если у вас нет модуля Azure PowerShell, установите его. Рекомендуется использовать последнюю версию командлетов Azure PowerShell. Инструкции по установке см. в статье [Установка и настройка Azure PowerShell](../powershell-install-configure.md#Install).

2. Откройте Azure PowerShell и выполните следующие команды. Напоминаем, что вместо *ACCOUNT\_NAME* и *ACCOUNT\_KEY==* необходимо вписать свои учетные данные. Вместо *CONTAINER\_NAME* впишите выбранное имя.

		$context = New-AzureStorageContext -StorageAccountName "ACCOUNT_NAME" -StorageAccountKey "ACCOUNT_KEY=="
		
		New-AzureStorageContainer CONTAINER_NAME -Permission Off -Context $context
		
		$now = Get-Date 
		
		New-AzureStorageContainerSASToken -Name CONTAINER_NAME -Permission rwdl -ExpiryTime $now.AddDays(1.0) -Context $context -FullUri

Полученный URI для подписанного URL-адреса нового контейнера должен быть аналогичен следующему:

	https://storageaccount.blob.core.windows.net/sascontainer?sv=2012-02-12&se=2015-07-08T00%3A12%3A08Z&sr=c&sp=wl&sig=t%2BbzU9%2B7ry4okULN9S0wst%2F8MCUhTjrHyV9rDNLSe8g%3Dsss

Подписанный URL-адрес, созданный с помощью этого примера, действителен один день. Подписанный URL-адрес предоставляет полные права \(т.е. чтение, запись, удаление и создание списка\) для больших двоичных объектов в контейнере.

Дополнительные сведения о подписанном URL-адресе см. в разделе [Подписанный URL-адрес: общие сведения о модели SAS](storage-dotnet-shared-access-signature-part-1.md).


## Запуск и инициализация эмулятора хранения

Чтобы запустить эмулятор хранения Azure, нажмите кнопку «Пуск» или клавишу Windows. Начните вводить текст **Эмулятор хранения Azure** и выберите эмулятор в списке приложений.

При запуске эмулятора в области уведомлений панели задач Windows появится соответствующий значок.

Когда эмулятор хранения запустится, появится окно командной строки. Вы можете использовать окно командной строки для запуска и остановки эмулятора хранения, а также для очистки данных, получения текущего состояния и инициализации эмулятора. Дополнительную информацию см. в разделе [Справочник по программе командной строки эмулятора хранения](#storage-emulator-command-line-tool-reference).

Когда окно командной строки закрывается, эмулятор хранения продолжает работать. Чтобы снова вызвать окно командной строки, повторите приведенные выше действия, как если бы снова запускали эмулятор хранения.

При первом запуске эмулятора хранения инициализируется локальная среда хранения. В процессе инициализации создается база данных в LocalDB и резервируются порты HTTP для каждой локальной службы хранилища.

Эмулятор хранения по умолчанию сохраняется в каталог C:\\Program Files\(x86\)\\Microsoft SDKs\\Azure\\Storage Emulator.

### Инициализация эмулятора хранения для использования другой базы данных SQL

Вы можете использовать программу командной строки эмулятора хранения, чтобы инициализировать эмулятор хранения для указания экземпляра базы данных SQL, отличного от экземпляра LocalDB по умолчанию. Обратите внимание: чтобы инициализировать серверную базу данных для эмулятора хранения, необходимо запустить программу командной строки с правами администратора.

1. Нажмите кнопку **Пуск** или клавишу **Windows**. Чтобы открыть программу командной строки эмулятора хранения, начните вводить текст `Azure Storage Emulator` и выберите необходимый вариант из появившегося списка.
2. В окне командной строки введите следующую команду, где `<SQLServerInstance>` – имя экземпляра SQL Server. Чтобы использовать LocalDb, укажите `(localdb)\v11.0` в качестве экземпляра SQL Server.

		AzureStorageEmulator init /server <SQLServerInstance> 
    
	Можно использовать следующую команду, которая указывает эмулятору использовать экземпляр SQL Server по умолчанию:

    	AzureStorageEmulator init /server .\\ 

	Кроме этого, также вы можете использовать следующую команду, которая повторно инициализирует базу данных до экземпляра LocalDB по умолчанию:

    	AzureStorageEmulator init /forceCreate 

Дополнительную информацию об этих командах см. в разделе [Справочник по программе командной строки эмулятора хранения](#storage-emulator-command-line-tool-reference).

## Обращение к ресурсам в эмуляторе хранения

Конечные точки службы для эмулятора хранения отличаются от аналогичных точек учетной записи хранилища Azure. Различие заключается в том, что локальный компьютер не обеспечивает разрешение доменных имен, поэтому конечные точки эмулятора хранения требуют локальный адрес, а не имя домена.

При обращении к ресурсу в учетной записи хранения Azure используется следующая схема, в которой имя учетной записи представляет собой часть имени узла URI, а ресурс, к которому выполняется обращение, – часть пути URI:

    <http|https>://<account-name>.<service-name>.core.windows.net/<resource-path>

Например, допустимым адресом для большого двоичного объекта в учетной записи хранения Azure можно считать такой URI:

	https://myaccount.blob.core.windows.net/mycontainer/myblob.txt

В эмуляторе хранения имя учетной записи является частью пути URI, а не именем узла, так как локальный компьютер не обеспечивает разрешение доменных имен. Схема для выполнения ресурса, выполняемая в эмуляторе хранения, выглядит следующим образом:

    http://<local-machine-address>:<port>/<account-name>/<resource-path>

Например, следующий адрес можно использовать для получения доступа к большому двоичному объекту в эмуляторе службы хранилища:

    http://127.0.0.1:10000/myaccount/mycontainer/myblob.txt

Ниже перечислены конечные точки службы для эмулятора хранения:

	Blob Service: http://127.0.0.1:10000/<account-name>/<resource-path>
	Queue Service: http://127.0.0.1:10001/<account-name>/<resource-path>
	Table Service: http://127.0.0.1:10002/<account-name>/<resource-path>

### Обращение к вторичному расположению учетной записи с помощью RA-GRS

Начиная с версии 3.1, учетная запись эмулятора хранения поддерживает геоизбыточную репликацию с доступом только для чтения \(RA-GRS\). Чтобы использовать ресурсы хранилища в облаке или локальном эмуляторе, вы можете получить доступ к вторичному расположению, добавив -secondary к имени учетной записи. Например, следующий адрес можно использовать для получения доступа к большому двоичному объекту с помощью вторичного только для чтения в эмуляторе службы хранилища:

    http://127.0.0.1:10000/myaccount-secondary/mycontainer/myblob.txt 

> [AZURE.NOTE] Для программного доступа к вторичному расположению с помощью эмулятора хранения используйте клиентскую библиотеку хранилища для .NET 3.2 или более поздней версии. Дополнительные сведения см. в разделе [Клиентская библиотека хранилища Microsoft Azure для .NET](https://msdn.microsoft.com/library/azure/dn261237.aspx).

## Справочник по программе командной строки эмулятора хранения

При запуске эмулятора хранения версии 3.0 или более поздней версии вы увидите всплывающее окно командной строки. Используйте окно командной строки для запуска и остановки работы эмулятора, а также для запроса состояния и выполнения других операций.

> [AZURE.NOTE] Если у вас уже установлен эмулятор вычислений Microsoft Azure, то при запуске эмулятора хранения на панели задач появится соответствующий значок. Щелкните этот значок правой кнопкой мыши, чтобы вызвать меню, которое позволяет запустить и остановить работу эмулятора хранения графическим путем.

### Синтаксис командной строки

	AzureStorageEmulator [start] [stop] [status] [clear] [init] [help]

### Параметры

Чтобы просмотреть список параметров, в командной строке введите `/help`.

| Параметр | Описание | Команда | Аргументы |
|--------|----------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|
| **Начало** | Запускает эмулятор хранения. | `AzureStorageEmulator start [-inprocess]` | *-inprocess*: запускает эмулятор в текущем процессе вместо создания нового процесса. |
| **Остановить** | Останавливает эмулятор хранения. | `AzureStorageEmulator stop` | |
| **Состояние** | Печатает состояние эмулятора хранения. | `AzureStorageEmulator status` | |
| **Clear** | Очищает данные во всех службах, указанных в командной строке. | `AzureStorageEmulator clear [blob] [table] [queue] [all]                                                    `| *blob*: удаляет данные о больших двоичных объекта. <br/>*queue*: удаляет данные об очереди. <br/>*table*: удаляет данные о таблицах. <br/>*all*: удаляет все данные во всех службах. |
| **Init** | Выполняет одноразовую инициализацию для настройки эмулятора. | `AzureStorageEmulator.exe init [-server serverName] [-sqlinstance instanceName] [-forcecreate] [-inprocess]` | *-server имя\_сервера\\имя\_экземпляра*: указывает сервер, на котором размещается экземпляр SQL. <br/> *-sqlinstance имя\_экземпляра\*: указывает имя экземпляра SQL, используемого на сервере по умолчанию. <br/> *-forcecreate\*: принудительно создает базу данных SQL, даже если она уже существует. <br/> *-inprocess\*: выполняет инициализацию в текущем процессе вместо создания нового процесса. Чтобы выполнить инициализацию, запустите текущий процесс с разрешениями повышенного уровня. |
                                                                                                                  
## Различия между эмулятором хранения и службой хранилища Azure

Эмулятор хранения представляет собой эмулированную среду, выполняемую в локальном экземпляре SQL. Поэтому между эмулятором и учетной записью хранения Azure в облаке существуют функциональные различия:

- Эмулятор хранения поддерживает только одну предопределенную учетную запись и известный ключ аутентификации.

- Эмулятор хранения не является масштабируемой службой хранения и не будет поддерживать большое количество одновременных клиентов.

- Как описано в разделе [Обращение к ресурсам в эмуляторе хранения](#addressing-resources-in-the-storage-emulator), обращение к ресурсам в эмуляторе хранения и в учетной записи хранения Azure происходит по-разному. Основное отличие заключается в том, что разрешение имени домена доступно в облаке, но не на локальном компьютере.

- Начиная с версии 3.1, учетная запись эмулятора хранения поддерживает геоизбыточную репликацию с доступом только для чтения \(RA-GRS\). В эмуляторе у всех учетных записей включена служба RA-GRS, и между первичной и вторичной репликами запаздывание отсутствует. Операции получения статистики службы BLOB-объектов, получения статистики службы очередей и получения статистики службы таблиц поддерживаются во вторичном расположении учетной записи и всегда будут возвращать значение элемента ответа `LastSyncTime` в виде текущего времени в соответствии с основной базой данных SQL.

	Для программного доступа к вторичному расположению с помощью эмулятора хранения используйте клиентскую библиотеку хранилища для .NET 3.2 или более поздней версии. Дополнительные сведения см. в разделе [Клиентская библиотека хранилища Microsoft Azure для .NET](https://msdn.microsoft.com/library/azure/dn261237.aspx).

- Службы файлов и конечные точки службы протокола SMB не поддерживаются в настоящее время в эмуляторе хранения.

- Если для используемой версии эмулятора хранения в настоящее время не поддерживается используемая версия служб хранилища, он возвращает ошибку VersionNotSupportedByEmulator \(код состояния HTTP «400 — Неверный запрос»\).

### Отличия для хранилища больших двоичных объектов 

Хранилище больших двоичных объектов в эмуляторе отличается следующим образом:

- Эмулятор хранения поддерживает только большие двоичные объекты размером до 2 ГБ.

- Операция Put Blob, выполняемая для уже существующего в эмуляторе хранения большого двоичного объекта, может быть успешно выполнена и имеет активную аренду, даже если идентификатор аренды не был указан как часть запроса.

- Эмулятор не поддерживает операции с добавочными большими двоичными объектами. При попытке выполнить операцию с добавочным большим двоичным объектом возвращается ошибка FeatureNotSupportedByEmulator \(код состояния HTTP «400 — Неверный запрос»\).

### Отличия для хранилища таблиц 

Хранилище таблиц в эмуляторе отличается следующим образом:

- Свойства даты в службе таблиц в эмуляторе хранения поддерживают только диапазон, поддерживаемый SQL Server 2005 \(*т. е.* даты должны быть позднее 1 января 1753 г.\). Все даты до 1 января 1753 г. заменяются этим значением. Точность дат ограничивается точностью SQL Server 2005, т. е. 1/300 секунды.

- Эмулятор хранения поддерживает значения ключа раздела и строки свойств ключа, каждое из которых не превышает 512 байт. Кроме того, общий размер имени учетной записи, имени таблицы и имен свойств ключей совокупно не может превышать 900 байт.

- Общий размер строки в таблице эмулятора хранения не должен превышать 1 МБ.

- В эмуляторе хранения свойства типа данных `Edm.Guid` или `Edm.Binary` поддерживают только операторы сравнения `Equal (eq)` и `NotEqual (ne)` в строках фильтра запроса.

### Отличия для хранилища очередей

Хранилище очередей в эмуляторе не имеет отличий.

## Замечания к выпуску эмулятора хранения

### Версия 4.3

- Теперь эмулятор хранения поддерживает версии 2015-07-08 служб хранилища для конечных точек служб BLOB-объектов, очередей и таблиц.

### Версия 4.2

- Теперь эмулятор хранения поддерживает версию 2015-04-05 служб хранилища для конечных точек служб больших двоичных объектов, очередей и таблиц.

### Версия 4.1

- Эмулятор хранения этой версии поддерживает версию 2015-02-21 служб хранилища для конечных точек службы BLOB-объектов, очередей и таблиц, за исключением новых функций добавочных больших двоичных объектов. 

- Теперь, если вы используете службы хранилища версии, которая в настоящее время не поддерживается для используемой версии эмулятора, эмулятор хранения возвращает информативное сообщение об ошибке. Мы советуем использовать эмулятор последней версии. При возникновении ошибки VersionNotSupportedByEmulator \(код состояния HTTP «400 — Неверный запрос»\) скачайте последнюю версию эмулятора хранения.

- Исправлена ошибка состояния гонки, которая приводила к неправильным данным сущности таблицы при одновременных операциях слияния.

### Версия 4.0

- Исполняемый файл эмулятора хранения был переименован на *AzureStorageEmulator.exe*.

### Версия 3.2
- Теперь эмулятор хранения поддерживает версии 2014-02-14 служб хранилища для конечных точек служб больших двоичных объектов, очередей и таблиц. Обратите внимание, что конечные точки служб файлов в настоящее время в эмуляторе хранения не поддерживаются. Дополнительную информацию о версии 2014-02-14 см. в разделе [Управление версиями для служб хранилища Azure](https://msdn.microsoft.com/library/azure/dd894041.aspx).

### Версия 3.1
- Теперь геоизбыточное хранилище с доступом для чтения \(RA-GRS\) поддерживается и в эмуляторе хранения. Интерфейсы API получения статистики службы BLOB-объектов, получения статистики службы очередей и получения статистики службы таблиц поддерживаются во вторичном расположении учетной записи и всегда будут возвращать значение элемента ответа LastSyncTime в виде текущего времени в соответствии с основной базой данных SQL. Для программного доступа к вторичному расположению с помощью эмулятора хранения используйте клиентскую библиотеку хранилища для .NET 3.2 или более поздней версии. Подробнее см. в справочнике по клиентской библиотеке хранилища Microsoft Azure для .NET.

### Версия 3.0
- Эмулятор хранения Azure больше не поставляется в одном пакете с эмулятором вычислений.

- Графический пользовательский интерфейс эмулятора хранения считается устаревшим. Вместо него используется сценарный интерфейс командной строки. Дополнительную информацию об интерфейсе командной строки см. в разделе «Справочник по программе командной строки эмулятора хранения». Графический интерфейс будет доступен в версии 3.0, но только после установки эмулятора вычислений щелчком правой кнопкой мыши на значке области уведомлений и при последующем выборе значения «Показать пользовательский интерфейс эмулятора хранения».

- Версия 2013-08-15 служб хранилища Azure теперь поддерживается полностью. \(Ранее эта версия поддерживалась только в предварительной версии 2.2.1 эмулятора хранения\)

<!---HONumber=AcomDC_0413_2016-->