<properties 
	pageTitle="Подписанные URL-адреса: общие сведения о модели SAS | Microsoft Azure" 
	description="Узнайте больше о делегировании доступа к ресурсам службы хранилища Azure, включая большие двоичные объекты, очереди и таблицы, с помощью подписанных URL-адресов (SAS). С их помощью вы можете защитить ключ учетной записи хранения, одновременно предоставляя доступ к ресурсам в вашей учетной записи другим пользователям. Вы можете контролировать предоставляемые разрешения и период действия подписанного URL-адреса. Если вы также установите политику общего доступа, вы можете отозвать подписанный URL-адрес, если посчитаете, что безопасность вашей учетной записи под угрозой." 
	services="storage" 
	documentationCenter="" 
	authors="tamram" 
	manager="adinah" 
	editor=""/>

<tags 
	ms.service="storage" 
	ms.workload="storage" 
	ms.tgt_pltfrm="na" 
	ms.devlang="dotnet" 
	ms.topic="article" 
	ms.date="07/07/2015" 
	ms.author="tamram"/>



# Подписи общего доступа. Часть 1: общие сведения о модели SAS

## Обзор

Подписанный URL-адрес (SAS) — это эффективное средство для предоставления другим клиентам ограниченного доступа к большим двоичным объектам, таблицам и очередям в вашей учетной записи хранения без предоставления ключа вашей учетной записи. Первая часть этого учебника по подписям общего доступа содержит обзор модели SAS и рекомендации по использованию SAS. [Часть 2](storage-dotnet-shared-access-signature-part-2.md) этого учебника содержит пошаговое описание процесса создания подписей общего доступа с помощью службы BLOB-объектов.

## Что такое подпись общего доступа? ##

Подпись общего доступа обеспечивает делегированный доступ к ресурсам в вашей учетной записи хранения. Это означает, что клиенту можно предоставить ограниченное право на работу с вашими BLOB-объектами, очередями или таблицами на определенный период времени и с определенным набором разрешений, не сообщая ему ключи доступа к своей учетной записи. Подпись общего доступа — это URI, который в своих параметрах запроса содержит все сведения, необходимые доступа к ресурсу хранилища с прохождением проверки подлинности. Для доступа к ресурсам хранилища с помощью SAS клиенту достаточно передать SAS в соответствующий конструктор или метод.

## Когда следует использовать подпись общего доступа? ##

Подпись общего доступа можно использовать, когда доступ к ресурсам в вашей учетной записи хранения требуется предоставить клиенту, которому нельзя доверить ключ учетной записи. Ключи вашей учетной записи хранения включают в себя как первичный, так и вторичный ключ, и оба этих ключа предоставляют административный доступ к вашей учетной записи и всем ее ресурсам. Предоставление любого из ключей учетной записи делает ее уязвимой вредоносного или небрежного использования. Подписи общего доступа обеспечивают безопасную альтернативу, позволяющую другим клиентам считывать, записывать и удалять данные в вашей учетной записи хранения в соответствии с выданными вами разрешениями и без потребности в ключе учетной записи.

Распространенным сценарием использования подписей общего доступа является служба, где пользователи считывают и записывают собственные данные в вашей учетной записи хранения. В сценарии, где в учетной записи хранения хранятся пользовательские данные, существует два направления разработки:


1\. Клиенты отправляют и загружают данные с помощью службы интерфейсного прокси-сервера, выполняющей проверку подлинности. Эта служба интерфейсного прокси-сервера позволяет проверять бизнес-правила, однако для больших объемов данных или крупных транзакций создание службы, поддерживающей масштабирование в соответствии с потребностями, может оказаться дорогостоящей или сложной задачей.

![sas-storage-fe-proxy-service][sas-storage-fe-proxy-service]

2\. Облегченная служба проверяет подлинность клиента по мере необходимости и затем создает подпись общего доступа. Клиент, получив эту подпись общего доступа, может осуществлять прямой доступ к ресурсам учетной записи хранения с разрешениями, определенными в подписи, и в течение разрешенного подписью периода времени. Подпись общего доступа уменьшает потребность в маршрутизации всех данных через службу интерфейсного прокси-сервера.

![sas-storage-provider-service][sas-storage-provider-service]

Многие реальные службы могут совмещать эти два подхода в зависимости от ситуации: некоторые данные обрабатываются и проверяются через интерфейсный прокси-сервер, а другие данные сохраняются и/или считываются непосредственно с помощью подписи общего доступа.

## Принцип работы подписи общего доступа ##

Подпись общего доступа представляет собой URI, который указывает на ресурс хранилища и включает в себя специальный набор параметров запроса, которые указывают, как именно клиент может осуществлять доступ к ресурсу. Один из этих параметров — подпись — состоит из параметров подписи общего доступа SAS и подписывается с помощью ключа учетной записи. Эта подпись используется хранилищем Azure для проверки подлинности подписи общего доступа.

Подпись общего доступа имеет следующие определяющие ограничения, каждое из которых представлено в виде параметра URI:

- **Ресурс хранилища.** Ресурсы хранилища, для которых можно делегировать доступ, включают в себя контейнеры, BLOB-объекты, очереди, таблицы и диапазоны сущностей таблицы.
- **Время начала.** Это время, когда подпись общего доступа становится действительной. Время начала для подписи общего доступа не является обязательным; если этот параметр опущен, подпись общего доступа вступает в силу немедленно. 
- **Время окончания срока действия.** Это время, после которого подпись общего доступа перестает быть действительной. Рекомендуется указать время окончания срока действия для подписи общего доступа или связать ее с хранимой политикой доступа (дополнительные сведения см. ниже).
- **Разрешения.** Разрешения, заданные для подписи общего доступа, указывают операции, которые клиент может выполнять для ресурсов хранилища с помощью этой подписи общего доступа. 

Вот пример URI подписи общего доступа, который предоставляет разрешения на чтение и запись в BLOB-объект. В таблице описана каждая из частей URI, чтобы можно было понять ее роль в работе подписи общего доступа:

https://myaccount.blob.core.windows.net/sascontainer/sasblob.txt?sv=2012-02-12&st=2013-04-29T22%3A18%3A26Z&se=2013-04-30T02%3A23%3A26Z&sr=b&sp=rw&sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D

<table border="1" cellpadding="0" cellspacing="0">
    <tbody>
        <tr>
            <td valign="top" width="213">
                <p>
                    URI BLOB-объекта
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    https://myaccount.blob.core.windows.net/sascontainer/sasblob.txt
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Адрес BLOB-объекта. Обратите внимание, что настоятельно рекомендуется использовать HTTPS.
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Версия служб хранилища
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    sv=2012-02-12
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Для служб хранилища версии 2012-02-12 и более поздней этот параметр указывает используемую версию.
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Время начала
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    st=2013-04-29T22%3A18%3A26Z
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Указывается в формате ISO 8061. Чтобы подпись общего доступа вступала в силу сразу же, не указывайте время начала действия.
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Время окончания срока действия
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    se=2013-04-30T02%3A23%3A26Z
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Указывается в формате ISO 8061.
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Ресурс
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    sr=b
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Ресурс является BLOB-объектом.
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Разрешения
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    sp=rw
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Разрешения, предоставляемые подписью общего доступа, включают в себя чтение (r) и запись (w).
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Подпись
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Используется для проверки подлинности доступа к BLOB-объекту. Подпись представляет собой код HMAC, рассчитанный по алгоритму SHA256 с использованием ключа и преобразования строки в символы. Полученное значение преобразуется в кодировку Base64.
                </p>
            </td>
        </tr>
    </tbody>
</table>


## Управление подписями общего доступа с помощью хранимой политики доступа ##

Подпись общего доступа может принимать одну из двух форм:

- **Нерегламентированная SAS:** при создании нерегламентированной SAS время начала, время окончания срока действия и разрешения для SAS указываются в URI SAS (или подразумеваются в случае, когда опускается время начала). Этот тип подписи общего доступа можно создать для контейнера, BLOB-объекта, таблицы или очереди.
- **SAS с хранимой политикой доступа:** хранимая политика доступа определяется в контейнере ресурсов — контейнере больших двоичных объектов, таблице или очереди — и может использоваться для управления ограничениями одной или нескольких подписей общего доступа. При сопоставлении подписи общего доступа с хранимой политикой доступа эта подпись наследует ограничения (время начала, время окончания и разрешения), определенные для данной хранимой политики доступа.

Различие между этими двумя формами важно для одного ключевого сценария — отзыва. Подписанный URL-адрес — это URL-адрес, которым может воспользоваться любой получивший его человек, независимо от того, кто изначально запрашивал такую подпись. Если подпись общего доступа обнародуется, ее может использовать любой человек в мире. Распространяемая подпись общего доступа действительна до тех пор, пока не произойдет одно из четырех возможных событий:

1.	Наступает время истечения срока действия, указанное для данной подписи общего доступа.
2.	Наступает время истечения срока действия, указанное в хранимой политике доступа, на которую ссылается подпись общего доступа (если имеется ссылка на хранимую политику доступа, в которой задано время окончания срока действия). Это может произойти либо из-за истечения заданного времени, либо из-за изменения хранимой политики доступа и переноса времени окончания срока действия в прошлое, что является одним из способов отозвать подпись общего доступа.
3.	Удаляется хранимая политика доступа, на которую ссылается подпись, что является другим способом отозвать подпись общего доступа. Заметьте, что при повторном создании хранимой политики доступа с таким же именем все существующие маркеры подписи общего доступа снова станут действительными в соответствии с разрешениями, связанными с этой хранимой политикой доступа (предполагается, что время окончания срока действия для подписи общего доступа еще не истекло). Если планируется отозвать подпись общего доступа, следует использовать другое имя при повторном создании политики доступа, у которой время окончания срока действия относится к будущему.
4.	Повторно создается ключ учетной записи, который был использован для создания подписи общего доступа. Обратите внимание, что это приведет к неспособности всех компонентов приложения, которые используют этот ключ учетной записи, пройти проверку подлинности до тех пор, пока они не будут обновлены для использования другого действительного ключа учетной записи или вновь созданного ключа учетной записи.
 
## Рекомендации по использованию подписей общего доступа ##

При использовании подписей общего доступа в приложениях необходимо иметь в виду две потенциальные проблемы:

- В случае утечки подписи ей сможет пользоваться любой человек, что потенциально может нарушить безопасность вашей учетной записи хранения.
- Если срок действия подписи, предоставленной клиентскому приложению, истекает и приложение не может получить новую подпись из вашей службы, это может нарушить работу приложения.  

Следующие рекомендации по использованию подписи общего доступа помогут нейтрализовать эти риски:

1. **Всегда используйте HTTPS** для создания подписи общего доступа или ее распространения. Если подпись передается по протоколу HTTP и перехватывается, посредством атак « злоумышленник в середине» злоумышленник сможет считать подпись и затем использовать ее вместо предполагаемого пользователя, что может привести к раскрытию конфиденциальных данных или к повреждению данных злоумышленником.
2. **Ссылайтесь на хранимые политики доступа, где это возможно.** Хранимые политики доступа дают возможность отозвать разрешения без повторного создания ключей учетной записи хранения. Задайте для них очень большой (или бесконечный) срок действия и убедитесь, что он регулярно переносится на будущее время.
3. **Используйте небольшой срок для нерегламентированной SAS.** Даже если безопасность подписи будет тайно нарушена, эта подпись будет служить источником уязвимости лишь непродолжительное время. Это особенно важно в случаях, когда нельзя ссылаться на хранимую политику доступа. Такой подход также позволяет ограничить объем данных, который может быть записан в BLOB-объект, путем ограничения времени на отправку этих данных.
4. **Запрограммируйте автоматическое обновление подписи клиентами при необходимости.** Клиенты должны обновлять подпись задолго до ожидаемого окончания ее срока действия, чтобы оставить время для повторных попыток в случае недоступности службы подписей общего доступа. Если ваша подпись будет использоваться для небольшого числа кратковременных операций, которые должны быть завершены в течение заданного срока действия, такая мера может оказаться лишней, так как обновление подписи не предусматривается. Однако если имеется клиент, регулярно выполняющий запросы через подпись, то возможность истечения срока действия следует принять во внимание. Рекомендуется сбалансировать требование к кратковременности использования подписи (как указано выше) с требованием того, чтобы клиент запрашивал обновление достаточно рано во избежание проблем, связанных с истечением срока действия подписи до завершения обновления.
5. **Будьте осторожны с временем начала действия подписи.** Если задать для времени начала действия подписи значение **now**, из-за разницы во времени (между текущим временем на разных компьютерах) могут наблюдаться периодические сбои в течение первых нескольких минут. В общем случае устанавливайте время начала действия на 15 минут или более в прошлом времени или не задавайте вообще, что сделает подпись действительной во всех случаях. То же касается и времени истечения срока действия. Помните, что для каждого запроса может наблюдаться рассинхронизация по времени до 15 минут в любом направлении. Для клиентов, использующих версию REST, предшествующую версии 2012-02-12, максимальный срок действия подписи общего доступа, которая не ссылается на хранимую политику, составляет 1 час, а все политики, где указано большее время, вызовут сбой.
6.	**Четко указывайте ресурс, к которому осуществляется доступ.** В общем случае рекомендуется предоставить пользователю минимально необходимый набор прав. Если пользователю требуется только доступ для чтения к отдельной сущности, предоставьте доступ на чтение к этой сущности, а не доступ на чтение, запись и удаление для всех сущностей. Это также помогает избежать угрозы раскрытия подписи и сокращает возможности получившего ее злоумышленника.
7.	**Учитывайте, что ваша учетная запись тарифицируется за любое использование, включая то, что осуществляется посредством SAS.** Если вы предоставляете доступ на запись к BLOB-объекту, пользователь может отправить BLOB-объект размером 200 ГБ. Если вы также предоставляете доступ на чтение, пользователь может загрузить его 10 раз, в результате чего вам потребуется оплачивать исходящий трафик объемом 2 ТБ. Опять же, ограниченные разрешения помогают сузить спектр возможностей злоумышленников. Используйте краткосрочные подписи, чтобы снизить угрозу (но помните о влиянии рассинхронизации часов на время окончания действия).
8.	**Проверьте данные, записанные с помощью SAS.** Когда клиентское приложение записывает данные в вашу учетную запись хранения, помните, что эти данные могут стать источником проблем. Если приложение требует проверять достоверность или подлинность данных перед их использованием, такую проверку следует выполнять после записи данных и перед их использованием в приложении. Такой подход также обеспечивает защиту от поврежденных или вредоносных данных, записываемых в вашу учетную запись как пользователем, который получил подпись правомерно, так и пользователем, использующим подпись после ее утечки.
9. **Не следует всегда использовать SAS.** Иногда риски для вашей учетной записи хранения, связанные с конкретной операцией, перевешивают преимущества подписи общего доступа. Для таких операций создавайте службу среднего уровня, которая записывает данные в вашу учетную запись хранения после выполнения проверки, проверки подлинности и аудита на основании бизнес-правил. Кроме того, иногда проще организовать управление доступом другим образом. Например, если вы хотите сделать все BLOB-объекты в контейнере общедоступными для чтения, можно сделать этот контейнер открытым, не предоставляя всем клиентам подпись общего доступа.
10.	**Используйте аналитику хранилища для мониторинга приложения.** Вы можете использовать ведение журнала и метрики для выявления всплесков сбоев проверки подлинности, вызванных сбоем в службе поставщика подписей общего доступа или непреднамеренным удалением хранимой политики доступа. Дополнительные сведения см. в [блоге группы разработчиков хранилища Azure](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/08/03/windows-azure-storage-logging-using-logs-to-track-storage-requests.aspx).

## Заключение ##

Подписи общего доступа удобно применять в целях предоставления ограниченных разрешений для вашей учетной записи хранения тем клиентам, которые нельзя передавать ключ учетной записи. Таким образом, они являются важной частью модели обеспечения безопасности для любого приложения, использующего хранилище Azure. Если следовать указанным здесь рекомендациям, подписи общего доступа позволяют повысить гибкость доступа к ресурсам в вашей учетной записи хранения без ущерба для безопасности приложения.

## Дальнейшие действия ##

[Подписи общего доступа, часть 2: создание и использование подписи общего доступа с помощью службы BLOB-объектов](../storage-dotnet-shared-access-signature-part-2/)

[Управление доступом к ресурсам хранилища Azure](http://msdn.microsoft.com/library/azure/ee393343.aspx)

[Делегирование доступа с помощью подписи общего доступа (REST API)](http://msdn.microsoft.com/library/azure/ee395415.aspx)

[Введение в таблицы и очереди SAS](http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas.aspx)
[sas-storage-fe-proxy-service]: ./media/storage-dotnet-shared-access-signature-part-1/sas-storage-fe-proxy-service.png
[sas-storage-provider-service]: ./media/storage-dotnet-shared-access-signature-part-1/sas-storage-provider-service.png


 

<!----HONumber=July15_HO3-->