<properties 
	pageTitle="Использование AzCopy с хранилищем Microsoft Azure" 
	description="Вы узнаете, как использовать AzCopyс для передачи, загрузки и копирования BLOB-объектов и содержания файлов." 
	services="storage" 
	documentationCenter="" 
	authors="tamram" 
	manager="adinah" 
	editor="cgronlun"/>

<tags 
	ms.service="storage" 
	ms.workload="storage" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="09/03/2015" 
	ms.author="tamram"/>

# Приступая к работе со служебной программой командной строки AzCopy

## Обзор

AzCopy — это служебная программа командной строки, разработанная для быстрой отправки, загрузки и копирования данных из хранилища больших двоичных объектов, файлов и табличного хранилища Microsoft Azure. В настоящем руководстве приводится обзор использования AzCopy.

> [AZURE.NOTE]В этом руководстве предполагается, что установлена AzCopy 3.2.0 или более поздней версии. Уже выпущена общедоступная версия AzCopy 3.x.
> 
> В этом руководстве также описывается использование версии AzCopy 4.2.0, которая является предварительной версией AzCopy. Функции, предоставляемые только в предварительной версии, обозначены в этом руководстве как *для предварительной версии*.
> 
> Обратите внимание, что в будущих выпусках AzCopy 4.x параметры и функциональные возможности командной строки могут измениться.

## Скачивание и установка AzCopy

1. Загрузка [последней версии AzCopy](http://aka.ms/downloadazcopy)или [самой последней предварительной версии](http://aka.ms/downloadazcopypr).
2. Запустите установку. По умолчанию при установке AzCopy создается папка с именем `AzCopy` в `%ProgramFiles(x86)%\Microsoft SDKs\Azure` (на компьютере под управлением 64-разрядной версии Windows) или `%ProgramFiles%\Microsoft SDKs\Azure` (на компьютере под управлением 32-разрядной версии Windows). Однако путь установки можно изменить в мастере установки.
3. При необходимости можно добавить место установки AzCopy к системному пути.

## Информация о синтаксисе командной строки AzCopy

Далее откройте окно командной строки и перейдите к каталогу установки AzCopy на компьютере, где располагается исполняемый файл `AzCopy.exe`. В командах AzCopy используется следующий базовый синтаксис:

	AzCopy /Source:<source> /Dest:<destination> /Pattern:<filepattern> [Options]

> [AZURE.NOTE]В самом начале работы с AzCopy версии 3.0.0 вам необходимо задать каждый параметр в командной строке, включая имя самого параметра, так как этого требует синтаксис командной строки, *например*, `/ParameterName:ParameterValue`.

## Написание первой команды AzCopy

**Отправка файла из файловой системы в хранилище больших двоичных объектов:**
	
	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer /DestKey:key /Pattern:abc.txt

Обратите внимание, что при копировании одного файла следует указывать параметр /Pattern с именем файла. Дополнительные образцы вы найдете далее в этой статье.

## Общие сведения о параметрах

Параметры для AzCopy описаны в таблице ниже. Вы можете использовать одну из следующих команд для получения справки во время работы с AzCopy:

- Подробная справка по командной строке AzCopy: `AzCopy /?`
- Подробная справка по параметрам AzCopy: `AzCopy /?:SourceKey`
- Примеры командной строки: `AzCopy /?:Samples` 

<table>
  <tr>
    <th>Имя параметра</th>
    <th>Описание</th>
    <th>Применяется к хранилищу BLOB-объектов (да/нет)</th>
    <th>Применяется к хранилищу файлов (да/нет) (только для предварительной версии)</th>
    <th>Применяется к хранилищу таблиц (да/нет) (только для предварительной версии)</th>
  </tr>
  <tr>
    <td><b>/Source:&lt;source></b></td>
    <td>Параметр определяет исходные данные для копирования. Источником может быть каталог файловой системы, контейнер BLOB-объектов, виртуальный каталог BLOB-объектов, общая папка файлового хранилища, каталог файлового хранилища или таблица Azure.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/Dest:&lt;destination></b></td>
    <td>Параметр определяет целевую директорию копирования. Целевой директорией может быть каталог файловой системы, контейнер BLOB-объектов, виртуальный каталог BLOB-объектов, общая папка файлового хранилища, каталог файлового хранилища и таблица Azure.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/Pattern:&lt;file-pattern></b></td>
      <td>
          Параметр определяет шаблон файла, который указывает, какие именно файлы нужно копировать. Поведение дополнительного параметра "/Pattern" определяется местоположением исходных данных, а также наличием параметра «рекурсивный режим». Рекурсивный режим задается с помощью параметра "/S.".
          <br />
          Если определенный источник представляет собой каталог в файловой системе, то используются стандартные подстановочные знаки, и предоставленный шаблон файла сравнивается с файлами в каталоге. При задании параметра "/S." AzCopy также выполняет сравнение определенного шаблона со всеми файлами в любых подпапках каталога.
          <br />
          Если определенный источник представляет собой контейнер BLOB-объектов или виртуальный каталог, то подстановочные знаки не используются. Если задан параметр "/S.", то AzCopy интерпретирует заданный шаблон файла как префикс BLOB-объекта. Если параметр "/S." не задан, то AzCopy выполняет сопоставление шаблона файла с точными именами BLOB-объектов.
          <br />
          Если исходный файл для копирования находится в общей папке Azure, то вам необходимо либо уточнить имя файла (например abc.txt), либо задать в "/S" параметр рекурсивного копирования всего содержания общей папки. Попытка одновременно задать шаблон файла и параметр "/S" приведет к ошибке.
          <br />
          В AzCopy используется сопоставление с учетом регистра, в котором /Source представляет собой контейнер больших двоичных объектов или виртуальный каталог больших двоичных объектов, а также сопоставление без учета регистра во всех остальных случаях.
          <br/>
          Если не удается задать шаблон файла, то по умолчанию используется шаблон файла *.* для расположения файловой системы или пустой префикс для ресурсов хранилища файлов Azure. Задание нескольких шаблонов не поддерживается.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/DestKey:&lt;storage-key></b></td>
    <td>Задает ключ учетной записи хранения для ресурса в месте назначения.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td class="auto-style1"><b>/DestSAS:&lt;sas-token></b></td>
    <td class="auto-style1">Задает подпись общего доступа (SAS) с правами ЧТЕНИЯ и ЗАПИСИ для контейнера назначения (если применяется). Поместите SAS в двойные кавычки, так как подпись может содержать специальные символы командной строки.<br />
        Если ресурс места назначения&#160;представляет собой контейнер BLOB-объекта, общую папку или таблицу, можно либо указать эту опцию перед маркером SAS, либо указать SAS как часть пути контейнера BLOB-объекта места назначения, общей папки или URI таблицы, не указывая этой опции.<br />
        Если исходное место копирования и место назначения копирования являются BLOB-объектами, то BLOB-объект места назначения должен находиться в той же учетной записи хранилища, что и BLOB-объект исходного места копирования.</td>
    <td class="auto-style1">Да</td>
    <td class="auto-style1">Да<br /> (только для предварительной версии)</td>
    <td class="auto-style1">Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/SourceKey:&lt;storage-key></b></td>
    <td>Задает ключ учетной записи хранения для исходного ресурса.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/SourceSAS:&lt;sas-token></b></td>
    <td>Задает подпись общего доступа (SAS) с правами ЧТЕНИЯ и СОЗДАНИЯ СПИСКА для исходного ресурса (если применяется). Поместите SAS в двойные кавычки, так как подпись может содержать специальные символы командной строки.
        <br />
        Если исходный ресурс для копирования является BLOB-объектом и не предоставляется ни ключ, ни SAS, то контейнер будет считываться через анонимный доступ.
        <br />
        Если исходный ресурс для копирования является общей папкой или таблицей, необходимо указать ключ или SAS.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/S</b></td>
    <td>Задает рекурсивный режим для операций копирования. В рекурсивном режиме AzCopy копирует все BLOB-объекты или файлы, соответствующие определенному шаблону файла, в том числе файлы из подпапок.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/BlobType:&lt;block | page | append></b></td>
    <td>Определяет, является ли BLOB-объект места назначения блочным, страничным или расширенным. Этот параметр применяется только в случае передачи BLOB-объекта. В противном случае создается сообщение об ошибке. Если в качестве места назначения выступает BLOB-объект и этот параметр не задается, то по умолчанию AzCopy создает блочный BLOB-объект.</td>
    <td>Да</td>
    <td>Нет</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/CheckMD5</b></td>
    <td>Вычисляет хэш MD5 для загруженных данных и проверяет соответствие хэша MD5, сохраненного в BLOB-объекте, или свойства Content-MD5 файла вычисленному хэшу. Проверка MD5 выключена по умолчанию. Чтобы выполнить проверку MD5 при загрузке данных, необходимо задать этот параметр.
	<br />
    Обратите внимание, что хранилище Azure не гарантирует актуальность хэша MD5, сохраненного для BLOB-объекта или файла. Клиент несет ответственность за обновление MD5 при каждом изменении BLOB-объекта или файла.
	<br />
    AzCopy всегда задает свойство Content-MD5 для BLOB-объекта или файла Azure после отправки его в службу.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/Snapshot</b></td>
    <td>Указывает, передаются ли моментальные снимки. Это параметр действителен только, если в качестве источника используется BLOB-объект. 
        <br />
        Передаваемые моментальные снимки BLOB-объекта переименовываются в следующем формате: [имя BLOB-объекта] (время моментального снимка)[расширение]. 
        <br />
        По умолчанию моментальные снимки не копируются.</td>
    <td>Да</td>
    <td>Нет</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/V:[verbose log-file]</b></td>
    <td>Выводит сообщения с подробным состоянием в файл журнала. По умолчанию файл подробного журнала называется <code>AzCopyVerbose.log</code> в папке <code>%LocalAppData%\Microsoft\Azure\AzCopy</code>. При задании существующего местоположения файла для этого параметра журнал с подробными данными будет добавляться к этому файлу.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/Z:[journal-file-folder]</b></td>
    <td>Задает папку файла журнала для возобновления операции.<br />
        AzCopy всегда поддерживает возобновление, если операция была прервана.<br />
        Если этот параметр не указан или указан без пути к папке, AzCopy создаст файл журнала в папке по умолчанию, которой является папка <code>%LocalAppData%\Microsoft\Azure\AzCopy</code>.<br />
        При каждом вводе команды для AzCopy выполняется проверка на наличие файла журнала в папке по умолчанию или в папке, которая была задана с помощью данного параметра. Если в обоих местах файл журнала отсутствует, AzCopy воспринимает операцию как новую и создает новый файл журнала.
        <br />
		Если файл журнала не существует, AzCopy проверяет, соответствует ли введенная командная строка командной строке в файле журнала. Если две командные строки совпадают, AzCopy возобновляет незавершенную операцию. Если они не совпадают, вам будет предложено либо переписать файл журнала, чтобы начать новую операцию, либо отменить текущую операцию. 
        <br />
        После успешного завершения операции файл журнала удаляется.
		<br />
		Обратите внимание, что возобновление операции из файла журнала, созданного предыдущей версией AzCopy, не поддерживается.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/@:parameter-file</b></td>
    <td>Задает файл, который содержит параметры. AzCopy обрабатывает параметры в файле, как если бы они были заданы в командной строке.<br /> 
		В файле ответа можно либо задать несколько параметров в одной строке, либо задать каждый параметр в отдельной строке. Обратите внимание, что отдельный параметр не может занимать несколько строк. 
        <br />
		Файлы ответа могут включать строки комментариев, начинающиеся с символа <code>#</code>. 
        <br />
        Можно задать несколько файлов ответов. Однако, следует иметь в виду, что AzCopy не поддерживает вложенных фалов ответов.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/Y</b></td>
    <td>Скрывает все запросы на подтверждение AzCopy.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/L</b></td>
    <td>Задает только операцию перечисления, данные не копируются.
    <br />
    AzCopy будет интерпретировать этот параметр как моделирование запуска команды без этого параметра /L и подсчитает количество копируемых объектов. Одновременно можно указать параметр /V для вывода подробной информации о копируемых объектах.
    <br />
    Поведение этого параметра также определяется местоположением исходных данных и наличием параметра рекурсивного режима /S и параметра шаблона файла /Pattern.
    <br />
    При использовании этого параметра AzCopy необходимы права на ЧТЕНИЕ и СОЗДАНИЕ СПИСКА для местоположения исходных данных.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/MT</b></td>
    <td>Задает такое же время последнего изменения загруженного файла, как в исходном BLOB-объекте или файле.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/XN</b></td>
    <td>Исключает более новый исходный ресурс. Ресурс не будет копироваться, если источник новее, чем место назначения.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/XO</b></td>
    <td>Исключает более старый исходный ресурс. Ресурс не будет копироваться, если источник старее, чем место назначения.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/A</b></td>
    <td>Отправляет только файлы с установленным атрибутом «Архивный».</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/IA:[RASHCNETOI]</b></td>
    <td>Передает файлы, содержащие любой из следующих заданных атрибутов.<br />
        Доступные атрибуты:  
        <br />
        R&#160;&#160;&#160;файлы только для чтения
        <br />
        A&#160;&#160;&#160;файлы, готовые к архивированию
        <br />
        S&#160;&#160;&#160;системные файлы
        <br />
        H&#160;&#160;&#160;скрытые файлы
        <br />
        C&#160;&#160;&#160;сжатые файлы
        <br />
        N&#160;&#160;&#160;обычные файлы
        <br />
        E&#160;&#160;&#160;зашифрованные файлы
        <br />
        T&#160;&#160;&#160;временные файлы
        <br />
        O&#160;&#160;&#160;автономные файлы
        <br />
        I&#160;&#160;&#160;неиндексированные файлы</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/XA:[RASHCNETOI]</b></td>
    <td>Исключает файлы с любым из следующих установленных атрибутов.<br />
        Доступные атрибуты:  
        <br />
        R&#160;&#160;&#160;файлы только для чтения  
        <br />
        A&#160;&#160;&#160;файлы, готовые к архивированию  
        <br />
        S&#160;&#160;&#160;системные файлы  
        <br />
        H&#160;&#160;&#160;скрытые файлы  
        <br />
        C&#160;&#160;&#160;сжатые файлы  
        <br />
        N&#160;&#160;&#160;обычные файлы  
        <br />
        E&#160;&#160;&#160;зашифрованные файлы  
        <br />
        T&#160;&#160;&#160;временные файлы  
        <br />
        O&#160;&#160;&#160;автономные файлы  
        <br />
        I&#160;&#160;&#160;неиндексированные файлы</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/Delimiter:&lt;delimiter></b></td>
    <td>Указывает разделитель, используемый для разделения виртуальных каталогов в имени большого двоичного объекта.<br />
        По умолчанию AzCopy использует / как разделитель. Однако, AzCopy поддерживает любой общий символ (например, @, # или %) в качестве разделителя. Если необходимо ввести любой из этих специальных символов в командную строку следует заключить имя файла в двойные кавычки. 
        <br />
        Этот параметр применяется только для загрузки BLOB-объектов.</td>
    <td>Да</td>
    <td>Нет</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/NC:&lt;number-of-concurrents></b></td>
    <td>Задает количество одновременных операций.
        <br />
        По умолчанию AzCopy запускает несколько одновременных операций для увеличения скорости передачи данных. Обратите внимание, что большое количество одновременных операций в среде с низкой пропускной способностью может переполнить сетевое подключение и помешать полному завершению операций. Регулируйте количество одновременных операций в зависимости от фактической доступной пропускной способности сети.
        <br />
		Верхний лимит количества одновременно выполняемых операций составляет 512.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/SourceType:Blob|Table</b></td>
    <td>Указывает, что ресурс <code>source</code> представляет собой BLOB-объект, доступный в локальной среде разработки, в которой запущен эмулятор хранения.</td>
    <td>Да</td>
    <td>Нет</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/DestType:Blob|Table</b></td>
    <td>Указывает, что ресурс <code>destination</code> представляет собой BLOB-объект, доступный в локальной среде разработки, в которой запущен эмулятор хранения.</td>
    <td>Да</td>
    <td>Нет</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><strong>/PKRS:&lt;"key1#key2#key3#..."></strong></td>
    <td>Разбивает диапазоны ключей секций для обеспечения параллельной передачи данных с целью увеличения скорости экспорта данных.
        <br />
        Если параметр не задан, то AzCopy будет использовать одиночный поток для экспорта данных таблицы. Например, если пользователем задан параметр /PKRS:"aa#bb", то AzCopy начинает три одновременных операции передачи.
        <br />
        Каждая операция экспортирует один из диапазонов ключей секций, как это показано на примере ниже: 
        <br />
        &#160;&#160;&#160;[&lt;first partition key>, aa) 
        <br />
        &#160;&#160;&#160;[aa, bb)
        <br />
        &#160;&#160;&#160;[bb, &lt;last partition key>] </td>
    <td>Нет</td>
    <td>Нет</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><strong>/SplitSize:</strong><file-size><strong>&lt;file-size></strong></td>
    <td>Указывает размер разбитого экспортированного файла в МБ, минимальное допустимое значение — 32.
        <br />
        Если данный параметр не задан, то AzCopy поместит все экспортированные данные в один файл.
        <br />
        Если данные таблицы экспортируются в BLOB-объект и размер экспортированного файла достигает 200 ГБ для BLOB-объекта, то AzCopy разделяет экспортированный файл, даже если данный параметр не задан. </td>
    <td>Нет</td>
    <td>Нет</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/EntityOperation:&lt;InsertOrSkip | InsertOrMerge | InsertOrReplace> </b>
</td>
    <td>Задает поведение импортированных данных таблиц.
        <br />
        InsertOrSkip — Пропускает существующий объект или вставляет новый, если объект не существует в таблице.
        <br />
        InsertOrMerg — Объединяет существующий объект или вставляет новый, если объект не существует в таблице.
        <br />
        InsertOrReplace — Заменяет существующий объект или вставляет новый, если объект не существует в таблице. </td>
    <td>Нет</td>
    <td>Нет</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/Manifest:&lt;manifest-file></b></td>
    <td>Задает файл описания для операций экспорта и импорта таблицы. <br />
    Во время операции экспорта этот параметр является необязательным. Если он не указан, AzCopy создаст файл манифеста с предварительно определенным именем.
    <br />
    Этот параметр является обязательным во время операции импорта для обнаружения файлов данных.</td>
    <td>Нет</td>
    <td>Нет</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
  <tr>
    <td><b>/SyncCopy</b></td>
    <td>Указывает, копируются ли большие двоичные объекты или файлы синхронно между двумя конечными точками службы хранилища Azure. <br />
		По умолчанию AzCopy использует серверное асинхронное копирование. Задайте этот параметр, чтобы выполнить синхронное копирование, при котором большие двоичные объекты или файлы скачиваются в локальную память, а затем передаются в службу хранилища Azure. Вы можете использовать этот параметр для копирования файлов в хранилище больших двоичных объектов и хранилище файлов или из хранилища больших двоичных объектов в хранилище файлов и наоборот.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
  <tr>
    <td><b>/SetContentType:&lt;content-type></b></td>
    <td>Задает тип содержимого MIME для целевых больших двоичных объектов или файлов. <br />
		AzCopy по умолчанию задает тип содержимого для BLOB-объекта или файла <code>application/octet-stream</code>. Вы можете задать тип содержимого для всех больших двоичных объектов или файлов, указав значение для этого параметра. Если вы задали этот параметр, не указав значение, AzCopy установит тип содержимого для каждого большого двоичного объекта или файла в соответствии с расширением файла.</td>
    <td>Да</td>
    <td>Да<br /> (только для предварительной версии)</td>
    <td>Нет</td>
  </tr>
    <tr>
    <td><b>/PayloadFormat:&lt;JSON | CSV></b></td>
    <td>Указывает формат файла экспортируемых данных таблицы.<br />
    Если этот параметр не указан, по умолчанию AzCopy экспортирует файл данных таблицы в формате JSON.</td>
    <td>Нет</td>
    <td>Нет</td>
    <td>Да<br /> (только для предварительной версии)</td>
  </tr>
</table>
<br/>

## Ограничение одновременных операций записи при копировании данных

При копировании BLOB-объектов или файлов с помощью AzCopy следует иметь в виду, что другое приложение может изменять данные в то время, когда они копируются. Если это возможно, обеспечьте, чтобы во время операции копирования не происходило изменение копируемых данных. Например, при копировании VHD, связанного с виртуальной машиной Azure, убедитесь в том, что никакое другое приложение в это время не записывает данные на VHD. В качестве альтернативы можно сначала создать моментальный снимок VHD, а затем скопировать его.

Если не удается предотвратить запись в BLOB-объекты или файлы во время их копирования со стороны других приложений, следует иметь в виду, что к моменту завершения задания скопированные ресурсы могут больше не иметь полного соответствия с исходными ресурсами.

## Копирование больших двоичных объектов Azure с помощью AzCopy

В приведенных ниже примерах рассматриваются различные сценарии копирования BLOB-объектов с помощью AzCopy.

### Копирование одного BLOB-объекта

**Отправка файла из файловой системы в хранилище больших двоичных объектов:**
	
	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer /DestKey:key /Pattern:abc.txt

**Скачивание большого двоичного объекта из хранилища больших двоичных объектов в файловую систему:**

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer /Dest:C:\myfolder /SourceKey:key /Pattern:abc.txt

Дополнительные сведения о работе с ключами доступа к хранилищу см. в разделе [Просмотр, копирование и повторное создание ключей доступа к хранилищу](../storage-create-storage-account/#regeneratestoragekeys).

### Копирование BLOB-объекта через копирование на стороне сервера

При копировании BLOB-объекта в пределах учетной записи хранения или между разными учетными записями хранения выполняется операция копирования на стороне сервера. Для получения дополнительной информации об операциях копирования на стороне сервера см. [Сведения об асинхронных операциях копирования BLOB-объектов между различными учетными записями](http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/introducing-asynchronous-cross-account-copy-blob.aspx).

**Копирование больших двоичных объектов в пределах учетной записи хранения:**

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer1 /Dest:https://myaccount.blob.core.windows.net/mycontainer2 /SourceKey:key /DestKey:key /Pattern:abc.txt 

**Копирование большого двоичного объекта между различными учетными записями хранения:**

	AzCopy /Source:https://sourceaccount.blob.core.windows.net/mycontainer1 /Dest:https://destaccount.blob.core.windows.net/mycontainer2 /SourceKey:key1 /DestKey:key2 /Pattern:abc.txt
 
### Копирование BLOB-объекта из вторичного региона 

Если учетная запись хранения имеет включенное геоизбыточное хранилище для доступа с правом чтения, можно копировать данные из вторичного региона.

**Копирование большого двоичного объекта из основной учетной записи во вторичную:**

	AzCopy /Source:https://myaccount1-secondary.blob.core.windows.net/mynewcontainer1 /Dest:https://myaccount2.blob.core.windows.net/mynewcontainer2 /SourceKey:key1 /DestKey:key2 /Pattern:abc.txt

**Скачивание большого двоичного объекта во вторичной учетной записи в файл в файловой системе:**

	AzCopy /Source:https://myaccount-secondary.blob.core.windows.net/mynewcontainer /Dest:C:\myfolder /SourceKey:key /Pattern:abc.txt

### Отправка файла в новый контейнер BLOB-объектов или виртуальный каталог

**Отправка файла в новый контейнер больших двоичных объектов**

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mynewcontainer /DestKey:key /Pattern:abc.txt

Обратите внимание, что если указанный контейнер назначения не существует, AzCopy создаст его и загрузит в него файл.

**Отправка файла в новый виртуальный каталог больших двоичных объектов**

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer/vd /DestKey:key /Pattern:abc.txt

Обратите внимание, что если указанный виртуальный каталог не существует, AzCopy отправит файл, чтобы включить его в виртуальный каталог от своего имени (*например*, `vd/abc.txt` в указанном выше примере).

### Загрузка BLOB-объекта в новую папку

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer /Dest:C:\myfolder /SourceKey:key /Pattern:abc.txt

Если папка `C:\myfolder` еще не существует, AzCopy создаст ее в файловой системе и загрузит `abc.txt ` в новую папку.

### Рекурсивная отправка файлов и подпапок каталога в контейнер

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer /DestKey:key /S

Задание параметра `/S` обеспечивает рекурсивное копирование указанного каталога в хранилище BLOB-объектов. Это означает, что все вложенные папки и файлы также будут скопированы. Например, предположим, что следующие файлы находятся в папке `C:\myfolder`:

	C:\myfolder\abc.txt
	C:\myfolder\abc1.txt
	C:\myfolder\abc2.txt
	C:\myfolder\subfolder\a.txt
	C:\myfolder\subfolder\abcd.txt

После операции копирования в контейнер будут помещены следующие файлы:

    abc.txt
    abc1.txt
    abc2.txt
    subfolder\a.txt
    subfolder\abcd.txt

### Нерекурсивная отправка файлов из каталога в контейнер

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer /DestKey:key

Если в командной строке не указан параметр `/S`, AzCopy не будет копировать рекурсивно. Копируются только файлы в указанном каталоге. Никакие подпапки и их файлы НЕ копируются. Например, предположим, что следующие файлы находятся в папке `C:\myfolder`:

	C:\myfolder\abc.txt
	C:\myfolder\abc1.txt
	C:\myfolder\abc2.txt
	C:\myfolder\subfolder\a.txt
	C:\myfolder\subfolder\abcd.txt

После операции копирования в контейнер будут помещены следующие файлы:

	abc.txt
	abc1.txt
	abc2.txt

### Рекурсивная загрузка всех BLOB-объектов контейнера в каталог файловой системы

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer /Dest:C:\myfolder /SourceKey:key /S

Предположим, что в указанном контейнере находятся следующие BLOB-объекты:

	abc.txt
	abc1.txt
	abc2.txt
	vd1\a.txt
	vd1\abcd.txt

После операции копирования в каталог `C:\myfolder` будут помещены следующие файлы:

	C:\myfolder\abc.txt
	C:\myfolder\abc1.txt
	C:\myfolder\abc2.txt
	C:\myfolder\vd1\a.txt
	C:\myfolder\vd1\abcd.txt

### Рекурсивная загрузка всех BLOB-объектов виртуального каталога BLOB-объектов в файловую систему

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer/vd1/ /Dest:C:\myfolder /SourceKey:key /S

Предположим, что в указанном контейнере находятся следующие BLOB-объекты:

	abc.txt
	abc1.txt
	abc2.txt
	vd1\a.txt
	vd1\abcd.txt

После операции копирования в каталог `C:\myfolder` будут помещены следующие файлы: Обратите внимание, что копируются только BLOB-объекты в виртуальном каталоге:

	C:\myfolder\a.txt
	C:\myfolder\abcd.txt

### Рекурсивная отправка файлов, соответствующих определенному шаблону файла, в контейнер 

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer /DestKey:key /Pattern:a* /S

Предположим, что следующие файлы размещены в папке `C:\myfolder`:

	C:\myfolder\abc.txt
	C:\myfolder\abc1.txt
	C:\myfolder\abc2.txt
	C:\myfolder\xyz.txt
	C:\myfolder\subfolder\a.txt
	C:\myfolder\subfolder\abcd.txt

После операции копирования в контейнер будут помещены следующие файлы:

	abc.txt
	abc1.txt
	abc2.txt
	subfolder\a.txt
	subfolder\abcd.txt
	
### Рекурсивная загрузка BLOB-объектов с заданным префиксом в файловую систему

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer /Dest:C:\myfolder /SourceKey:key /Pattern:a /S

Предположим, что в указанном контейнере находятся следующие BLOB-объекты: Все BLOB-объекты, начинающиеся с префикса `a`, будут скопированы:

	abc.txt
	abc1.txt
	abc2.txt
	xyz.txt
	vd1\a.txt
	vd1\abcd.txt

После операции копирования в папку `C:\myfolder` будут помещены следующие файлы:

	C:\myfolder\abc.txt
	C:\myfolder\abc1.txt
	C:\myfolder\abc2.txt

Обратите внимание, что префикс применяется к виртуальному каталогу, который формирует первую часть имени BLOB-объекта. В указанном выше примере виртуальный каталог не соответствует заданному префиксу и не копируется.


### Копирование BLOB-объекта и его моментальных снимков на другую учетную запись хранения

	AzCopy /Source:https://sourceaccount.blob.core.windows.net/mycontainer1 /Dest:https://destaccount.blob.core.windows.net/mycontainer2 /SourceKey:key1 /DestKey:key2 /Pattern:abc.txt /Snapshot

После выполнения копирования целевой контейнер будет содержать BLOB-объект и его моментальные снимки. Предположим, что в BLOB-объект в приведенном выше примере имеет два моментальных снимка, тогда контейнер будет содержать следующий BLOB-объект и моментальные снимки:

	abc.txt
	abc (2013-02-25 080757).txt
	abc (2014-02-21 150331).txt


### Использование файла ответа для задания параметров командной строки

	AzCopy /@:"C:\myfolder\abc.txt"

В файл ответа можно включить параметры командной строки AzCopy. AzCopy обрабатывает параметры в файле, как если бы он были заданы в командной строке, выполняя прямую замену содержимого файла.

**Задайте один или нескольких однострочных файлов ответа**

Предположим, что у нас имеется файл ответа с именем `source.txt`, который указывает исходный контейнер:

	/Source:http://myaccount.blob.core.windows.net/mycontainer

И файл ответа с именем `dest.txt`, который указывает папку назначения в файловой системе:

	/Dest:C:\myfolder

А также файл ответа с именем `options.txt`, определяющий параметры для AzCopy:

	/S /Y

Чтобы вызвать AzCopy с этими файлами ответов, размещенными в каталоге `C:\responsefiles`, используйте команду:

	AzCopy /@:"C:\responsefiles\source.txt" /@:"C:\responsefiles\dest.txt" /SourceKey:<sourcekey> /@:"C:\responsefiles\options.txt"   

AzCopy обрабатывает эту команду, как если бы все индивидуальные параметры были включены в командную строку:

	AzCopy /Source:http://myaccount.blob.core.windows.net/mycontainer /Dest:C:\myfolder /SourceKey:<sourcekey> /S /Y

**Задайте многострочный файл ответа**

Предположим, у нас имеется файл ответа с именем `copyoperation.txt`, содержащий следующие строки: Каждый параметр AzCopy задается на своей собственной строке:

	/Source:http://myaccount.blob.core.windows.net/mycontainer
	/Dest:C:\myfolder
	/SourceKey:<sourcekey>
	/S 
	/Y

Чтобы вызвать AzCopy с этими файлами ответов, используйте команду:

	AzCopy /@:"C:\responsefiles\copyoperation.txt"

AzCopy обрабатывает эту команду, как если бы все индивидуальные параметры были включены в командную строку:

	AzCopy /Source:http://myaccount.blob.core.windows.net/mycontainer /Dest:C:\myfolder /SourceKey:<sourcekey> /S /Y

Обратите внимание, что каждый параметр AzCopy должен быть полностью задан на одной строке. Например, при выполнении AzCopy возникнет ошибка, если разделить параметр на две строки, как показано здесь для параметра `/sourcekey`:

	http://myaccount.blob.core.windows.net/mycontainer
 	C:\myfolder
	/sourcekey:
	[sourcekey]
	/S 
	/Y

### Указание подписи общего доступа (SAS)
	
**Указание SAS для исходного контейнера с помощью параметра /sourceSAS**

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer1 /DestC:\myfolder /SourceSAS:SAS /S

**Указание SAS для исходного контейнера в URI исходного контейнера**

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer1/?SourceSASToken /Dest:C:\myfolder /S

**Указание SAS для целевого контейнера с помощью параметра /destSAS**

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer1 /DestSAS:SAS /Pattern:abc.txt

**Указание SAS для исходного контейнера и контейнера назначения**

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer1 /Dest:https://myaccount.blob.core.windows.net/mycontainer2 /SourceSAS:SAS1 /DestSAS:SAS2 /Pattern:abc.txt

### Указание папки файла журнала

При каждом вводе команды для AzCopy выполняется проверка на наличие файла журнала в папке по умолчанию или в папке, которая была задана с помощью данного параметра. Если в обоих местах файл журнала отсутствует, AzCopy воспринимает операцию как новую и создает новый файл журнала.

Если файл журнала не существует, AzCopy проверяет, соответствует ли введенная командная строка командной строке в файле журнала. Если две командные строки совпадают, AzCopy возобновляет незавершенную операцию. Если они не совпадают, вам будет предложено либо переписать файл журнала, чтобы начать новую операцию, либо отменить текущую операцию.

**Использование расположения по умолчанию для файла журнала**

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer /DestKey:key /Z

Если опустить параметр`/Z` или задать параметр `/Z` без пути папки, как указано выше, AzCopy создает файл журнала в расположении по умолчанию: `%SystemDrive%\Users\%username%\AppData\Local\Microsoft\Azure\AzCopy`. Если файл журнала уже существует, то AzCopy возобновляет операцию на основе файла журнала.

**Задание настраиваемого расположения для файла журнала**

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer /DestKey:key /Z:C:\journalfolder\

В этом примере создается файл журнала, если он еще не существует. Если такой файл существует, то AzCopy возобновляет операцию на основе файла журнала.

**Возобновление операции AzCopy**

	AzCopy /Z:C:\journalfolder\

В этом примере возобновляется последняя операция, при завершении которой произошел сбой.


### Создание файла журнала

**Запись в файл журнала с подробными данными в расположении по умолчанию**

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer /DestKey:key /V

Если задать параметр `/V` без указания пути файла к журналу с подробными данными, AzCopy создает файл журнала в расположении по умолчанию: `%SystemDrive%\Users\%username%\AppData\Local\Microsoft\Azure\AzCopy`.

**Запись в файл журнала с подробными данными в настраиваемом расположении**

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer /DestKey:key /V:C:\myfolder\azcopy1.log

Обратите внимание, что если задать относительный путь после параметра `/V`, например `/V:test/azcopy1.log`, то журнал с подробными данными создается в текущем рабочем каталоге в подпапке с именем `test`.


### Установка такого же времени последнего изменения загруженных файлов, как в исходных BLOB-объектах

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer /Dest:C:\myfolder /SourceKey:key /MT

### Исключение BLOB-объектов из операции копирования на основании времени их последнего изменения

Задайте параметр `/MT`, чтобы сравнить время последнего изменения исходного большого двоичного объекта и файла назначения.

**Исключение более новых больших двоичных объектов, чем файл назначения**

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer /Dest:C:\myfolder /SourceKey:key /MT /XN

**Исключение более старых больших двоичных объектов, чем целевой файл**

	AzCopy /Source:https://myaccount.blob.core.windows.net/mycontainer /Dest:C:\myfolder /SourceKey:key /MT /XO

### Задание количества одновременных операций для запуска

Параметр `/NC` задает количество одновременных операций копирования. По умолчанию AzCopy начинает одновременные операции в количестве, в восемь раз превышающем имеющееся количество ядер процессоров. При выполнении AzCopy в сети с низкой пропускной способностью можно задать меньшее количество для этого параметра, чтобы избежать сбоев, вызванных конкуренцией за ресурсы.


### 	Запуск AzCopy с использованием ресурсов BLOB-объектов в эмуляторе хранилища

	AzCopy /Source:https://127.0.0.1:10004/myaccount/myfileshare/ /Dest:C:\myfolder /SourceKey:key /SourceType:Blob /S

### Синхронное копирование больших двоичных объектов между двумя конечными точками службы хранилища Azure

По умолчанию AzCopy выполняет асинхронное копирование данных между двумя конечными точками хранилища. Таким образом, операция копирования будет выполняться в фоновом режиме, используя свободную пропускную способность, для которой не предусмотрено соглашение об уровне обслуживания касательно скорости копирования большого двоичного объекта, и AzCopy будет периодически проверять состояние операции копирования до ее завершения или сбоя.

Параметр `/SyncCopy`, обеспечивает постоянную скорость операции копирования. AzCopy выполняет синхронное копирование, при котором большие двоичные объекты копируются из указанного источника в локальную память путем скачивания, а затем загружаются в целевое хранилище больших двоичных объектов.

	AzCopy /Source:https://myaccount1.blob.core.windows.net/myContainer/ /Dest:https://myaccount2.blob.core.windows.net/myContainer/ /SourceKey:key1 /DestKey:key2 /Pattern:ab /SyncCopy

Обратите внимание, что использование параметра `/SyncCopy` может повлечь дополнительные затраты на исходящие данные по сравнению с асинхронным копированием. Во избежание таких затрат мы советуем использовать этот параметр в виртуальных машинах Azure, которые находятся в одном регионе с вашей учетной записью хранения.

### Задание типа содержимого MIME целевого большого двоичного объекта

По умолчанию AzCopy задает для типа содержимого целевого большого двоичного объекта значение `application/octet-stream`. Начиная с версии 3.1.0 вы можете задать тип содержимого с помощью параметра `/SetContentType:[content-type]`. Этот синтаксис задает тип содержимого для всех больших двоичных объектов в операции копирования.

	AzCopy /Source:C:\myfolder\ /Dest:https://myaccount.blob.core.windows.net/myContainer/ /DestKey:key /Pattern:ab /SetContentType:video/mp4

Если вы задали параметр `/SetContentType`, не указав значение, AzCopy задаст тип содержимого для каждого большого двоичного объекта или файла в соответствии с расширением файла.

	AzCopy /Source:C:\myfolder\ /Dest:https://myaccount.blob.core.windows.net/myContainer/ /DestKey:key /Pattern:ab /SetContentType

## Копирование файлов в файловое хранилище Azure с помощью AzCopy (только для предварительной версии)

В приведенных ниже примерах рассматриваются различные сценарии копирования файлов Azure с помощью AzCopy.

### Загрузка файла из общей папки Azure в файловую систему

	AzCopy /Source:https://myaccount.file.core.windows.net/myfileshare/myfolder1/ /Dest:C:\myfolder /SourceKey:key /Pattern:abc.txt

Обратите внимание, что если исходный файл для копирования находится в общей папке Azure, то вам необходимо либо указать точное имя файла (*например*, `abc.txt`) для копирования одного файла, либо указать параметр `/S` для рекурсивного копирования всех файлов в общей папке. Попытка одновременно задать шаблон файла и параметр `/S` приведет к ошибке.

### При рекурсивной загрузке файлов и папок в общей папке Azure в файловую систему необходимо указать подпись общего доступа.

	AzCopy /Source:https://myaccount.file.core.windows.net/myfileshare/ /Dest:C:\myfolder /SourceSAS:SAS /S

Обратите внимание, что пустые папки не копируются.


### Рекурсивная отправка файлов и папок из файловой системы в общую папку Azure

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.file.core.windows.net/myfileshare/ /DestKey:key /S

Обратите внимание, что пустые папки не копируются.


### Рекурсивная отправка файлов, соответствующих определенному шаблону файла, в общую папку Azure

	AzCopy /Source:C:\myfolder /Dest:https://myaccount.file.core.windows.net/myfileshare/ /DestKey:key /Pattern:ab* /S

### Асинхронное копирование файлов в хранилище файлов Azure

Хранилище файлов Azure поддерживает асинхронное копирование на серверной стороне.

Асинхронное копирование из хранилища файлов в хранилище файлов:

	AzCopy /Source:https://myaccount1.file.core.windows.net/myfileshare1/ /Dest:https://myaccount2.file.core.windows.net/myfileshare2/ /SourceKey:key1 /DestKey:key2 /S

Асинхронное копирование из хранилища файлов в хранилище блочных BLOB-объектов:
  
	AzCopy /Source:https://myaccount1.file.core.windows.net/myfileshare/ /Dest:https://myaccount2.blob.core.windows.net/mycontainer/ /SourceKey:key1 /DestKey:key2 /S

Асинхронное копирование из хранилища блочных или страничных BLOB-объектов в хранилище файлов:

	AzCopy /Source:https://myaccount1.blob.core.windows.net/mycontainer/ /Dest:https://myaccount2.file.core.windows.net/myfileshare/ /SourceKey:key1 /DestKey:key2 /S

Обратите внимание, что асинхронное копирование из хранилища файлов в хранилище страничных BLOB-объектов не поддерживается.

### Синхронное копирование файлов в хранилище файлов Azure

Помимо асинхронного копирования пользователь также может указать параметр `/SyncCopy` для синхронного копирования данных из хранилища файлов в хранилище файлов, из хранилища файлов в хранилище BLOB-объектов и из хранилища BLOB-объектов в хранилище файлов. AzCopy сделает это путем загрузки данных источника в локальную память и выгрузки в место назначения.

	AzCopy /Source:https://myaccount1.file.core.windows.net/myfileshare1/ /Dest:https://myaccount2.file.core.windows.net/myfileshare2/ /SourceKey:key1 /DestKey:key2 /S /SyncCopy

	AzCopy /Source:https://myaccount1.file.core.windows.net/myfileshare/ /Dest:https://myaccount2.blob.core.windows.net/mycontainer/ /SourceKey:key1 /DestKey:key2 /S /SyncCopy
	
	AzCopy /Source:https://myaccount1.blob.core.windows.net/mycontainer/ /Dest:https://myaccount2.file.core.windows.net/myfileshare/ /SourceKey:key1 /DestKey:key2 /S /SyncCopy

При копировании из хранилища файлов в хранилище BLOB-объектов пользователь может указать параметр `/BlobType:page` для изменения типа BLOB-объекта места назначения.

Обратите внимание, что использование параметра `/SyncCopy` может повлечь дополнительные затраты на исходящие данные по сравнению с асинхронным копированием. Во избежание таких затрат мы советуем использовать этот параметр в виртуальных машинах Azure, которые находятся в одном регионе с вашей учетной записью хранения.


## Копирование данных в таблицу Azure с помощью AzCopy (только для предварительной версии)

В приведенных ниже примерах рассматриваются различные сценарии копирования данных таблиц Azure с помощью AzCopy.

### Экспорт данных в локальную файловую систему

	AzCopy /Source:https://myaccount.table.core.windows.net/myTable/ /Dest:C:\myfolder\ /SourceKey:key

AzCopy создает файл описания в заданной папке места назначения или контейнере BLOB-объекта. Файл описания используется процессом для нахождения нужных файлов и проверки корректности данных в файлах во время импорта. В файле описания по умолчанию используется следующее соглашение о наименовании:

	<account name>_<table name>_<timestamp>.manifest

Пользователь может также указать имя файла описания в параметре `/Manifest:<manifest file name>`.

	AzCopy /Source:https://myaccount.table.core.windows.net/myTable/ /Dest:C:\myfolder\ /SourceKey:key /Manifest:abc.manifest


### Экспорт записей в файл формата JSON и CSV

AzCopy по умолчанию экспортирует записи таблицы в файлы JSON, с помощью параметра `/PayloadFormat:JSON|CSV` пользователь может указать тип файла экспортируемых данных.

	AzCopy /Source:https://myaccount.table.core.windows.net/myTable/ /Dest:C:\myfolder\ /SourceKey:key /PayloadFormat:CSV

При указании формата полезных данных CSV AzCopy создаст файл схемы с расширением `.schema.csv` для каждого файла данных, а также для файлов данных с расширением `.csv`, которые находятся в месте, указанном в параметре `/Dest`. Обратите внимание, что AzCopy не поддерживает импорт файлов данных CSV. Для экспорта и импорта данных в таблицу можно использовать формат JSON.

### Экспорт данных в BLOB-объект Azure

	AzCopy /Source:https://myaccount.table.core.windows.net/myTable/ /Dest:https://myaccount.blob.core.windows.net/mycontainer/ /SourceKey:key1 /Destkey:key2

AzCopy создает файл данных JSON в локальной папке или контейнере BLOB-объектов в соответствии с соглашением об именовании:

	<account name>_<table name>_<timestamp>_<volume index>_<CRC>.json

Созданный JSON-файл следует формату полезных метаданных. За более подробной информацией о формате полезных данных обратитесь к разделу [Формат полезных данных для служб работы с таблицами](http://msdn.microsoft.com/library/azure/dn535600.aspx).

Обратите внимание, что при экспорте сущности таблицы для хранения в хранилище BLOB-объектов, AzCopy будет сначала экспортировать сущности таблицы в локальные временные файлы данных, а затем отправлять их в BLOB-объект. Эти временные файлы данных помещаются в папку файла журнала с путем по умолчанию <code>%LocalAppData%\\Microsoft\\Azure\\AzCopy</code>. Вы можете указать параметр /Z: [папка журнала файла], чтобы изменить расположение папки файлов журнала и таким образом изменить расположение файлов временных данных. Размер файлов временных данных определяется по размеру сущностей таблицы и размеру, указанному в параметре /SplitSize. Хотя файл временных данных на локальном диске будет немедленно удален после передачи в BLOB-объект, убедитесь, что на диске достаточно места для хранения этих файлов временных данных до удаления.

### Разделение экспортируемых файлов

	AzCopy /Source:https://myaccount.table.core.windows.net/mytable/ /Dest:C:\myfolder /SourceKey:key /S /SplitSize:100

AzCopy использует *индекс тома* в именах разделенных файлов для того, чтобы отличить один файл от другого. Индекс тома состоит из двух частей: *индекс диапазонов ключей секций* и *индекс разделенного файла*. Оба индекса отсчитываются, начиная с нуля.

Индекс диапазонов ключей разделов будет равен 0, если пользователь не укажет параметр `/PKRS` (более подробно об этом в следующем разделе).

Предположим, например, что AzCopy создает два файла данных после того, как пользователь задал значение параметра `/SplitSize`. В таком случае конечные имена файлов могут выглядеть следующим образом:

	myaccount_mytable_20140903T051850.8128447Z_0_0_C3040FE8.json
	myaccount_mytable_20140903T051850.8128447Z_0_1_0AB9AC20.json

Обратите внимание, что минимальное возможное значение для `/SplitSize` составляет 32 МБ. Если в качестве назначения задано хранилище больших двоичных объектов, AzCopy разделит файл данных, как только размер файла достигнет предельного значения (200 ГБ), вне зависимости от того, задал ли пользователь параметр `/SplitSize`.

### Экспорт данных в несколько потоков

	AzCopy /Source:https://myaccount.table.core.windows.net/myTable/ /Dest:C:\myfolder\ /SourceKey:key /PKRS:"aa#bb"

Если пользователь задал параметр `/PKRS`, AzCopy начнет выполнение одновременных операций для экспорта сущностей. Каждая операция экспортирует объем данных равный значению объема, указанного в индексе диапазонов ключей секций.

Обратите внимание на то, что количество одновременных операций можно контролировать с помощью параметра `/NC`. При копировании сущностей таблиц AzCopy использует информацию о количестве основных процессоров в качестве значения `/NC` по умолчанию для параметра `/NC`, даже если параметр не задан. Если пользователь задал параметр `/PKRS`, AzCopy использует меньшее из двух значений (индекса диапазонов ключей разделов и явно или неявно заданный параметр количества одновременных операций), чтобы определить количество одновременных операций, которые можно запустить. Для получения более подробной информации введите в командной строке `AzCopy /?:NC`.

### Импорт данных в несколько потоков

	AzCopy /Source:C:\myfolder\ /Dest:https://myaccount.table.core.windows.net/mytable1/ /DestKey:key /Manifest:"myaccount_mytable_20140103T112020.manifest" /EntityOperation:InsertOrReplace 

Параметр `/EntityOperation` определяет способ размещения данных в таблице. Возможные значения:

- `InsertOrSkip`: пропускает существующую сущность или вставляет новую, если сущности нет в таблице.
- `InsertOrMerge`: объединяет существующую сущность или вставляет новую, если сущности нет в таблице.
- `InsertOrReplace`: заменяет существующую сущность или вставляет новую, если сущности нет в таблице.

Обратите внимание на то, что вы не можете задать значение параметра `/PKRS` в сценарии импорта данных. В отличие от сценария экспорта данных, в котором необходимо задавать параметр `/PKRS` для начала одновременных операций, при импорте сущностей AzCopy по умолчанию задает параметр передачи в несколько потоков. Количество потоков по умолчанию соответствует количеству основных процессоров. Однако вы можете задать свое значение с помощью параметра `/NC`. Для получения более подробной информации введите в командной строке `AzCopy /?:NC`.


## Известные проблемы и рекомендации

#### Запускайте один экземпляр AzCopy на одном компьютере.
AzCopy предназначен для максимального использования ресурсов компьютера для ускорения передачи данных. Рекомендуется запускать только один экземпляр AzCopy на одном компьютере и указать параметр `/NC`, если требуется несколько параллельных операций. Для получения более подробной информации введите в командной строке `AzCopy /?:NC`.

#### Включайте FIPS-совместимые алгоритмы MD5 для AzCopy при использовании FIPS-совместимых алгоритмов для шифрования, хэширования и подписывания.
По умолчанию в AzCopy используется реализация .NET MD5 для вычисления MD5 при копировании объектов, но существует ряд требований безопасности, при которых в AzCopy необходимо включать FIPS-совместимую реализацию MD5.

Для этого можно создать файл app.config `AzCopy.exe.config` со свойством `AzureStorageUseV1MD5` и поместить его в папку с файлом AzCopy.exe.

	<?xml version="1.0" encoding="utf-8" ?>
	<configuration>
	  <appSettings>
	    <add key="AzureStorageUseV1MD5" value="false"/>
	  </appSettings>
	</configuration>

Свойство AzureStorageUseV1MD5: • True - значение по умолчанию, будет использоваться реализация .NET MD5. • False - будет использоваться FIPS-совместимый алгоритм MD5.

Обратите внимание, что по умолчанию на компьютере Windows FIPS-совместимые алгоритмы отключены. Эту настройку можно изменить, набрав в окне запуска команд "secpol.msc" и выбрав "Настройки безопасности -> Локальные политики -> Параметры безопасности -> Системная криптография: Использовать FIPS-совместимые алгоритмы для шифрования, хеширования и подписывания".

## Версии AzCopy

| Версия | Новые возможности |
|---------|-----------------------------------------------------------------------------------------------------------------|
| **Версия 4.2.0** | **Текущая предварительная версия. Включает в себя весь набор функциональных возможностей версии 3.2.0. Также поддерживает SAS ресурса хранилища файлов, асинхронное копирование хранилища файлов, экспорт записей таблицы в файл формата CSV и указание имени файла манифеста при экспорте записей таблицы**
| **Версия 3.2.0** | **Текущая версия выпуска. Поддерживает расширенные BLOB-объекты и выбор FIPS-совместимого MD5 **
| V4.1.0 | Включает в себя весь набор функциональных возможностей версии 3.1.0. Она поддерживает синхронное копирование больших двоичных объектов и файлов и позволяет указывать тип содержимого для целевых больших двоичных объектов и файлов
| V3.1.0 | Она поддерживает синхронное копирование больших двоичных объектов и позволяет указывать тип содержимого для целевых больших двоичных объектов.
| Версия 4.0.0 | Включает в себя весь набор функциональных возможностей версии 3.0.0. Версия поддерживает возможность копирования файлов в хранилище файлов Azure и импорт файлов из него, а также копирование данных в хранилище таблиц Azure и извлечение данных из него.
| Версия 3.0.0 | Изменен синтаксис командной строки AzCopy: теперь необходимо указывать имя параметра. Изменен внешний вид справки по командной строке. Данная версия поддерживает только копирование данных в BLOB-объекты и копирование данных из них.	
| Версия 2.5.1 | Повышена производительность при использовании /xo и /xn. Исправлены ошибки, возникающие при наличии в имени исходного файла специальных символов, а также появление ошибок в файле журнала из-за неправильного введения команд пользователем в командной строке.	
| V2.5.0 | Улучшена производительность при крупномасштабных сценариях копирования, а также реализовано несколько важных улучшений для повышения удобства использования.
| V2.4.1 | Поддерживает указание папки назначения в мастере установки.                     			
| V2.4.0 | Поддерживает отправку и загрузку файлов для хранилища файлов Azure.
| V2.3.0 | Поддерживает геоизбыточные учетные записи хранения для доступа с правом чтения.|
| V2.2.2 | Обновлена для использования библиотеки клиента хранилища Azure версии 3.0.3.
| V2.2.1 | Устранение проблем с производительностью при копировании большого количества файлов в пределах одной учетной записи хранения.
| V2.2 | Поддерживает задание разделителя виртуального каталога для имен BLOB-объектов. Поддерживает задание пути файла журнала.|
| V2.1 | Предоставляет более 20 параметров для выполнения эффективных операций отправки, загрузки и копирования BLOB-объектов.|


## Дальнейшие действия

Для получения дополнительной информации о хранилище Azure и AzCopy см. следующие ресурсы.

### Документация по хранилищу Azure:

- [Введение в хранилище Azure](storage-introduction.md)
- [Хранение файлов в хранилище больших двоичных объектов](storage-dotnet-how-to-use-blobs.md)
- [Создание общей папки SMB в Azure с помощью хранилища файлов](storage-dotnet-how-to-use-files.md)

### Записи блога по хранилищу Azure:
- [AzCopy: введение в синхронное копирование и настраиваемый тип содержимого](http://blogs.msdn.com/b/windowsazurestorage/archive/2015/01/13/azcopy-introducing-synchronous-copy-and-customized-content-type.aspx)
- [AzCopy: выпуск общедоступной версии AzCopy 3.0 и предварительной версии AzCopy 4.0 с поддержкой таблиц и файлов](http://blogs.msdn.com/b/windowsazurestorage/archive/2014/10/29/azcopy-announcing-general-availability-of-azcopy-3-0-plus-preview-release-of-azcopy-4-0-with-table-and-file-support.aspx)
- [AzCopy: оптимизированные сценарии для крупномасштабного копирования](http://go.microsoft.com/fwlink/?LinkId=507682)
- [Введение в службы файлов Microsoft Azure](http://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/12/introducing-microsoft-azure-file-service.aspx)
- [AzCopy: поддержка геоизбыточного хранилища для доступа с правом чтения](http://blogs.msdn.com/b/windowsazurestorage/archive/2014/04/07/azcopy-support-for-read-access-geo-redundant-account.aspx)
- [AzCopy: передача данных с использованием перезапускаемого режима и маркера SAS](http://blogs.msdn.com/b/windowsazurestorage/archive/2013/09/07/azcopy-transfer-data-with-re-startable-mode-and-sas-token.aspx)
- [AzCopy: использование копирования больших двоичных объектов между разными учетными записями](http://blogs.msdn.com/b/windowsazurestorage/archive/2013/04/01/azcopy-using-cross-account-copy-blob.aspx)
- [AzCopy: отправка и скачивание файлов для больших двоичных объектов Microsoft Azure](http://blogs.msdn.com/b/windowsazurestorage/archive/2012/12/03/azcopy-uploading-downloading-files-for-windows-azure-blobs.aspx)

 

<!---HONumber=Sept15_HO2-->