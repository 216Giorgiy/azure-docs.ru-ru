<properties 
	pageTitle="Настройка строк подключения для Azure" 
	description="Узнайте, как настроить строки подключения к учетной записи хранения в Azure." 
	services="storage" 
	documentationCenter="" 
	authors="tamram" 
	manager="adinah" 
	editor="cgronlun"/>

<tags 
	ms.service="storage" 
	ms.workload="storage" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="02/20/2015" 
	ms.author="tamram"/>

# Настройка строк подключения службы хранилища Azure

## Обзор

Строка подключения содержит сведения, необходимые для доступа к учетной записи хранения в Azure программными способами. Вы можете настроить строку подключения для подключения к службе хранилища Azure следующими способами.

- Подключиться к эмулятору хранения Azure при локальном тестировании службы или приложения.

- Подключиться к учетной записи хранения в Azure с помощью конечных точек по умолчанию для служб хранилища.

- Подключиться к учетной записи хранения в Azure с помощью явно заданных точек для служб хранилища.

Если приложение является облачной службой, запущенной в Azure, обычно строка подключения сохраняется в [файле схемы конфигурации службы Azure (CSCFG)](https://msdn.microsoft.com/library/ee758710.aspx). Если приложение запущено в другой среде (например на настольном ПК), то строка подключения, скорее всего, будет храниться в файле app.config или другом файле конфигурации. Для доступа к строке подключения во время выполнения независимо от используемой среды можно использовать класс Azure `CloudConfigurationManager`.

## Создание строки подключения в эмуляторе хранения

Эмулятор хранения - это локальная учетная запись с известным именем и ключом. Так как имя и ключ учетной записи одинаковы для всех пользователей, то для обращения к эмулятору хранения в строке подключения можно использовать сокращенный формат строки. Задайте строке подключения значение `UseDevelopmentStorage=true`.

Если вы тестируете службу на эмуляторе хранения, можно также указать прокси-сервер HTTP. Это может быть полезно для отслеживания HTTP-запросов и ответов при отладке операций со службами хранилища. Чтобы задать прокси-сервер, добавьте параметр `DevelopmentStorageProxyUri` в строку подключения и укажите в нем универсальный код ресурса (URI) прокси-сервера. В качестве примера приведена строка подключения, которая указывает эмулятор хранения и задает прокси-сервер HTTP:

    UseDevelopmentStorage=true;DevelopmentStorageProxyUri=http://myProxyUri

## Создание строки подключения к учетной записи хранения Azure

Чтобы создать строку подключения к учетной записи хранения Azure, используйте формат строки подключения, указанный ниже. Укажите, собираетесь ли вы подключиться к учетной записи хранения с помощью протокола HTTP или HTTPS (рекомендуется), замените  `myAccountName` именем своей учетной записи хранения, а  `myAccountKey` - ключом доступа к учетной записи:

    DefaultEndpointsProtocol=[http|https];AccountName=myAccountName;AccountKey=myAccountKey

Созданная строка подключения будет выглядеть так, как строка из следующего примера:

```        DefaultEndpointsProtocol=https;AccountName=storagesample;AccountKey=KWPLd0rpW2T0U7K2pVpF8rYr1BgYtB7wYQw33AYiXeUoquiaY6o0TWqduxmPHlqeCNZ3LU0DHptbeIAy5l/Yhg==
```

> [AZURE.NOTE] Служба хранилища Azure поддерживает как HTTP, так и HTTPS в строке подключения; однако настоятельно рекомендуется использовать HTTPS.
    
## Создание строки подключения к явной конечной точке хранилища

Вы можете явно указать конечные точки службы в своей строке подключения, если:

- вы сопоставили собственное доменное имя для учетной записи хранения со службой BLOB-объектов;
- у вас есть подписанный URL-адрес для доступа к ресурсам хранилища в учетной записи хранения.

Чтобы создать строку подключения, определяющую явную конечную точку BLOB-объекта, укажите полную конечную точку для каждой службы, включая спецификацию протокола (HTTP или HTTPS), в следующем формате:

``` 
BlobEndpoint=myBlobEndpoint;QueueEndpoint=myQueueEndpoint;TableEndpoint=myTableEndpoint;FileEndpoint=myFileEndpoint;[credentials]
```

Вы должны указать хотя бы одну конечную точку службы, но необязательно указывать их все. Например, если вы создаете строку подключения для использования с пользовательской конечной точкой большого двоичного объекта, можно не указывать конечные точки для очереди и таблицы. Обратите внимание, что если вы решили не указывать в строке подключения конечные точки очередей и таблиц, вы не сможете получить доступ к службам очередей и таблиц из кода, используя эту строку подключения.

Если вы явно указываете конечные точки службы в строке подключения, вы можете указать `credentials` в строке выше двумя способами:

- можно указать имя и ключ учетной записи: `AccountName=myAccountName;AccountKey=myAccountKey`; 
- можно указать подписанный URL-адрес: `SharedAccessSignature=base64Signature`.

### Назначение конечной точки BLOB-объекта с помощью пользовательского доменного имени 

Если вы зарегистрировали собственное доменное имя для использования со службой BLOB-объектов, то можно явным образом указать в строке подключения конечную точку большого двоичного объекта. Значение конечной точки из строки подключения применяется для создания универсальных кодов ресурса (URI) к службе BLOB-объектов, а также определяет форму любых универсальных кодов ресурса (URI), возвращаемых в код. 

Например, строка подключения к конечной точке BLOB-объекта в пользовательском доменном имени может выглядеть следующим образом:

```
DefaultEndpointsProtocol=https;BlobEndpoint=www.mydomain.com;AccountName=storagesample;AccountKey=KWPLd0rpW2T0U7K2pVpF8rYr1BgYtB7wYQw33AYiXeUoquiaY6o0TWqduxmPHlqeCNZ3LU0DHptbeIAy5l/Yhg== 
```

### Назначение конечной точки BLOB-объекта с помощью подписанного URL-адреса 

Вы можете создать строку подключения с явно заданными конечными точками для доступа к ресурсам хранилища с помощью подписанного URL-адреса. В этом случае можно указать подписанный URL-адрес как часть строки подключения, а не как часть учетных данных имени и ключа учетной записи. Маркер подписанного URL-адреса инкапсулирует данные о запрашиваемом ресурсе, периоде, во время которого он доступен, и имеющихся разрешениях. Дополнительные сведения о подписанных URL-адресах см. в разделе [Делегирование доступа с помощью подписанного URL-адреса](https://msdn.microsoft.com/library/ee395415.aspx).

Чтобы создать строку подключения, содержащую подписанный URL-адрес, задайте ее в следующем формате:

    BlobEndpoint=myBlobEndpoint; QueueEndpoint=myQueueEndpoint;TableEndpoint=myTableEndpoint;SharedAccessSignature=base64Signature

Конечная точка может быть конечной точкой службы по умолчанию или пользовательской конечной точкой. Значение `base64Signature` соответствует подписи в подписанном URL-адресе. Подпись представляет собой код HMAC, рассчитанный по алгоритму SHA256 с использованием ключа и преобразования строки в символы. Полученное значение преобразуется в кодировку Base64.

### Создание строки подключения с суффиксом конечной точки

Чтобы создать строку подключения для службы хранилища в регионах или экземплярах с разными суффиксами конечных точек, например Azure China (Azure для Китая) или Azure Governance (Azure для правительственных организаций), используйте следующий формат строки подключения. Укажите, следует ли подключиться к учетной записи хранения с помощью протокола HTTP или HTTPS, замените `myAccountName` именем своей учетной записи хранения, `myAccountKey` - ключом доступа к учетной записи, а `mySuffix` - суффиксом универсального кода ресурса (URI):


	DefaultEndpointsProtocol=[http|https];AccountName=myAccountName;AccountKey=myAccountKey;EndpointSuffix=mySuffix;


Созданная строка подключения должна выглядеть так, как строка из следующего примера:

	DefaultEndpointsProtocol=https;AccountName=storagesample;AccountKey=KWPLd0rpW2T0U7K2pVpF8rYr1BgYtR7wYQk33AYiXeUoquiaY6o0TWqduxmPHlqeCNZ3LU0DHptbeIHy5l/Yhg==;EndpointSuffix=core.chinacloudapi.cn;



<!--HONumber=52--> 