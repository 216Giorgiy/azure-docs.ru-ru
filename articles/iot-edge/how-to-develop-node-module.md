---
title: Отладка модулей Node.js для Azure IoT Edge | Документация Майкрософт
description: Сведения о разработке и отладке модулей Node.js для Azure IoT Edge в Visual Studio Code
services: iot-edge
keywords: ''
author: shizn
manager: timlt
ms.author: xshi
ms.date: 06/26/2018
ms.topic: article
ms.service: iot-edge
ms.openlocfilehash: 78e952b5b1eedc1757cfe636eb13e411044dce54
ms.sourcegitcommit: 0fcd6e1d03e1df505cf6cb9e6069dc674e1de0be
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/14/2018
ms.locfileid: "42142166"
---
# <a name="develop-and-debug-nodejs-modules-with-azure-iot-edge-for-visual-studio-code"></a>Разработка и отладка модулей Node.js для Azure IoT Edge в Visual Studio Code

Вы можете перенести исполнение бизнес-логики в граничную систему, преобразовав ее в модули для Azure IoT Edge. В этой статье приведены подробные инструкции по использованию Visual Studio Code (VS Code) в качестве основного средства разработки для отладки модулей Node.js.

## <a name="prerequisites"></a>Предварительные требования
В этой статье предполагается, что для разработки вы используете компьютер или виртуальную машину под управлением Windows или Linux. Устройством IoT Edge может быть другое физическое устройство или имитация устройства, запущенная на компьютере разработки.

> [!NOTE]
> В этом руководстве по отладке показано, как присоединить процесс в контейнер модуля и выполнить отладку модуля с помощью VS Code. Можно отлаживать модули Node.js в контейнерах linux-amd64, windows и arm32. С возможностями отладки Visual Studio Code можно ознакомиться в [этой статье](https://code.visualstudio.com/Docs/editor/debugging). 

Так как в этой статье Visual Studio Code используется как основное средство разработки, установите VS Code, а затем добавьте необходимые расширения:
* [Visual Studio Code](https://code.visualstudio.com/) 
* [расширение Azure IoT Edge](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge); 
* [Расширение Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker).

Чтобы создать модуль, требуется Node.js, включая npm для создания папки проекта, Docker для создания образа модуля и реестр контейнеров для хранения образа модуля:
* [Node.js](https://nodejs.org)
* [Docker](https://docs.docker.com/engine/installation/)
* [Реестр контейнеров Azure](https://docs.microsoft.com/azure/container-registry/) или [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).

   >[!TIP]
   >Вместо облачного реестра можно использовать локальный реестр Docker для создания прототипов и тестирования. 

Для тестирования модуля на устройстве требуется действующий Центр Интернета вещей по крайней мере с одним устройством IoT Edge. Чтобы использовать компьютер в качестве устройства IoT Edge, выполните инструкции в руководстве для [Windows](quickstart.md) или [Linux](quickstart-linux.md). 

## <a name="create-a-new-solution-template"></a>Создайте новый шаблон решения

На следующих этапах показано, как создать модуль IoT Edge на основе Node.js с использованием Visual Studio Code и расширения Azure IoT Edge. Сначала нужно создать решение, а затем сформировать первый модуль в этом решении. Каждое решение может содержать несколько модулей. 

1. В Visual Studio Code выберите **Вид** > **Интегрированный терминал**.
2. В интегрированном терминале введите следующую команду, чтобы установить (или обновить) последнюю версию шаблона модуля Azure IoT Edge для Node.js:

   ```cmd/sh
   npm install -g yo generator-azure-iot-edge-module
   ```
3. В Visual Studio Code выберите **Вид** > **Палитра команд**. 
4. В палитре команд введите и выполните команду**Azure IoT Edge: New IoT Edge Solution**.

   ![Запуск команды создания решения IoT Edge](./media/how-to-develop-csharp-module/new-solution.png)

5. Перейдите к папке, где требуется создать решение, и щелкните **Выбрать папку**. 
6. Укажите имя для решения. 
7. Выберите **Модуль Node.js** в качестве шаблона для первого модуля в решении.
8. Присвойте модулю имя. Оно должно быть уникальным в пределах реестра контейнеров. 
9. Укажите репозиторий образов для модуля. VS Code автоматически заполняет имя модуля, поэтому нужно только заменить **localhost:5000** данными вашего реестра. Если для тестирования вы используете локальный реестр Docker, вполне подойдет значение localhost. Если используется Реестр контейнеров Azure, укажите сервер входа, заданный в параметрах реестра. Значение для сервера входа выглядит так: **\<имя реестра\>.azurecr.io**.

VS Code принимает предоставленные сведения, создает решение IoT Edge, а затем загружает его в новом окне.

В решении имеется три элемента: 
* Папка **.vscode** содержит конфигурации отладки.
* Папка **modules** содержит вложенные папки для каждого модуля. Сейчас у вас только один модуль, но вы можете добавить модули в палитре команд с помощью команды **Azure IoT Edge: Add IoT Edge Module**. 
* В файле **ENV** перечислены переменные среды. Если реестр контейнеров Azure является вашим реестром, вы получите в нем имя пользователя и пароль для реестра контейнеров Azure.

   >[!NOTE]
   >Файл среды создается только в том случае, если вы указали репозиторий образов для модуля. Если вы не изменяли значения по умолчанию localhost для тестирования и отладки локально, объявлять переменные среды не требуется. 

* В файле **deployment.template.json** указан новый модуль, а также пример модуля **tempSensor**, который моделирует данные для тестирования. Дополнительные сведения о работе манифестов развертывания см. в статье [Сведения об использовании, настройке и повторном использовании модулей Azure IoT Edge (предварительная версия)](module-composition.md).

## <a name="develop-your-module"></a>Разработка модуля

Код Node.js, который поставляется с решением, по умолчанию находится в **modules** > **\<имя вашего модуля\>** > **app.js**. Модуль и файл deployment.template.json настраиваются так, чтобы можно было собрать решение, передать его в реестр контейнеров и развернуть на устройстве, чтобы начать тестирование, не меняя код. Модуль просто принимает входные данные из источника (в данном случае модуль tempSensor имитирует данные) и передает их в Центр Интернета вещей. 

Когда вы будете готовы настроить шаблон Node.js с добавлением собственного кода, используйте [пакеты SDK для Центра Интернета вещей Azure](../iot-hub/iot-hub-devguide-sdks.md), чтобы создать модули, которые удовлетворяют ключевые потребности решений Интернета вещей, такие как безопасность, управление устройствами и надежность. 

## <a name="build-and-deploy-your-module-for-debugging"></a>Создание и развертывание модуля для отладки

В папке каждого модуля существует несколько файлов Docker для разных типов контейнеров. Вы можете использовать любой **DEBUG**-файл, чтобы создать модуль для тестирования. В настоящее время модули Node.js поддерживают отладку только в контейнерах linux amd64, windows-amd64 и linux-arm32v7.

1. В VS Code перейдите к файлу `deployment.template.json`. Обновите URL-адрес образа модуля, добавив в конце **.debug**.
2. Замените модуль Node.js createOptions в файле **deployment.template.json** содержимым ниже и сохраните этот файл: 
    ```json
    "createOptions": "{\"ExposedPorts\":{\"9229/tcp\":{}},\"HostConfig\":{\"PortBindings\":{\"9229/tcp\":[{\"HostPort\":\"9229\"}]}}}"
    ```

2. В палитре команд VS Code введите и выполните команду **Azure IoT Edge: Build IoT Edge solution**.
3. Выберите файл `deployment.template.json` для решения из палитры команд. 
4. В обозревателе устройств Центра Интернета вещей Azure щелкните правой кнопкой мыши идентификатор устройства IoT Edge и выберите **Create deployment for IoT Edge device** (Создать развертывание для устройства IoT Edge). 
5. Откройте папку **config** вашего решения, а затем выберите файл `deployment.json`. Щелкните **Select Edge Deployment Manifest** (Выбрать манифест развертывания Edge). 

Ход развертывания можно отслеживать с помощью идентификатора развертывания во встроенном терминале VS Code.

Чтобы проверить состояние контейнера, откройте обозреватель кода Docker VS или выполните команду `docker ps` в окне терминала.

## <a name="start-debugging-nodejs-module-in-vs-code"></a>Запуск отладки модуля Node.js в VS Code

VS Code хранит информацию о конфигурации отладки в файле `launch.json`, расположенном в папке `.vscode` рабочей области. Этот файл `launch.json` создан при создании решения IoT Edge. Он автоматически обновляется при каждом добавлении нового модуля, который поддерживает отладку. 

1. Перейдите к представлению отладки VS Code и выберите файл конфигурации отладки для модуля.

2. Перейдите на страницу `app.js`. Добавьте точку останова в этот файл.

3. Нажмите кнопку **Начать отладку** или клавишу **F5**, затем выберите процесс для присоединения.

4. В представлении отладки VS Code можно просмотреть переменные на панели слева. 

В предыдущем примере показаны способы отладки модулей Node.js IoT Edge в контейнерах. В нем добавлены открытые порты в контейнере модуля createOptions. После завершения отладки модулей Node.js рекомендуется удалить эти открытые порты для модулей IoT Edge, готовых для рабочей среды.

## <a name="next-steps"></a>Дополнительная информация

После создания модуля узнайте, как [развернуть модули Azure IoT Edge в Visual Studio Code](how-to-deploy-modules-vscode.md).

Чтобы разрабатывать модули для устройств IoT Edge, см. раздел [Понимание и использование пакетов SDK для Центра Интернета вещей Azure](../iot-hub/iot-hub-devguide-sdks.md).
