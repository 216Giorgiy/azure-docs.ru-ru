---
title: Общие сведения о модулях Центра IoT Edge Azure | Документация Майкрософт
description: Узнайте о том, что такое модули Azure IoT Edge и как их настраивать
author: kgremban
manager: timlt
ms.author: kgremban
ms.date: 02/15/2018
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 9c196ec92fc7997617fa464d676dc93ca9fe84f0
ms.sourcegitcommit: 150a40d8ba2beaf9e22b6feff414f8298a8ef868
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/27/2018
ms.locfileid: "37029102"
---
# <a name="understand-azure-iot-edge-modules"></a>Общие сведения о модулях IoT Edge Azure

Azure IoT Edge позволяет развертывать *модули* бизнес-логики на пограничных устройствах и управлять этими модулями. Модуль Azure IoT Edge представляет собой наименьшую единицу вычислительных ресурсов, которыми управляет IoT Edge. Эти модули могут содержать службы Azure (например, Azure Stream Analytics) или пользовательский код для конкретного решения. Чтобы составить представление о разработке, развертывании и обслуживании модулей, важно разобраться с четырьмя основными компонентами, образующими концепцию модуля.

* **Образ модуля** — это пакет с программным обеспечением для модуля.
* **Экземпляр модуля** — это единица вычислительных ресурсов, выполняющая образ модуля на устройстве IoT Edge. Экземпляр модуля запускается средой выполнения IoT Edge.
* **Идентификатор модуля** — это сведения о модуле (включая учетные данные безопасности), которые хранятся в Центре Интернета вещей и относятся к конкретному экземпляру модуля.
* **Двойник модуля** — это документ JSON, хранящийся в Центре Интернета вещей, который содержит данные о состоянии экземпляра модуля, в том числе метаданные, конфигурации и условия. 

## <a name="module-images-and-instances"></a>Образы и экземпляры модулей

Образы модулей IoT Edge содержат приложения, в которых используются функции управления, безопасности и обмена данными среды выполнения IoT Edge. Вы можете создавать собственные образы модулей или экспортировать их из поддерживаемых служб Azure, таких как Azure Stream Analytics.
Образы существуют в облаке, и вы можете обновлять их, изменять и развертывать в разных решениях. Например, существует отдельный модуль, который прогнозирует мощность производственной линии с применением технологий машинного обучения, и другой модуль, который использует компьютерное зрение для управления дроном. 

Каждый раз, когда среда выполнения IoT Edge запускает развернутый на устройстве образ модуля, она создает новый экземпляр этого модуля. Один и тот же образ модуля может выполняться одновременно на разных устройствах в разных частях мира, но для каждого из этих устройств при запуске модуля создается собственный экземпляр модуля. 

![Образы модулей в облаке — экземпляры модулей на устройствах][1]

На практике образы модулей существуют как образы контейнеров в хранилище данных, а экземпляры модулей реализованы как контейнеры на устройствах. По мере роста возможностей для использования Azure IoT Edge будут появляться новые типы образов и экземпляров модулей. Например, устройства с ограниченными ресурсами не могут выполнять контейнеры, поэтому для них следует использовать образы модулей в виде библиотек DLL и экземпляры в виде исполняемых файлов. 

## <a name="module-identities"></a>Идентификаторы модулей

Когда в среде выполнения IoT Edge создается новый экземпляр модуля, он сопоставляется с определенным идентификатором модуля. Идентификатор модуля хранится в Центре Интернета вещей и работает как область адресации и безопасности для всех локальных и облачных взаимодействий с конкретным экземпляром модуля.
Имя идентификатора составляется из идентификатора устройства, на котором запущен этот экземпляр, и имени модуля, указанного в вашем решении. Например, когда вы вызываете модуль `insight`, в котором используется Azure Stream Analytics, и развертываете его на устройстве `Hannover01`, среда выполнения IoT Edge создает для него идентификатор модуля с именем `/devices/Hannover01/modules/insight`.

Иногда нужно развернуть один образ модуля несколько раз на одном устройстве. В таком случае для экземпляров будут использоваться разные имена.

![Идентификаторы модулей должны быть уникальными][2]

## <a name="module-twins"></a>Двойники модулей

С каждым экземпляром модуля сопоставлен определенный двойник модуля, который применяется для настройки экземпляра. Экземпляр и двойник связаны друг с другом через идентификатор модуля. 

Двойник модуля представляет собой документ JSON, в котором собраны сведения о модуле и параметры его конфигурации. Эта концепция работает так же, как и [двойник устройства][lnk-device-twin] в Центре Интернета вещей. Структура двойника модуля полностью идентична структуре двойника устройства. Для взаимодействия с двойниками обоих типов используются одни и те же API-интерфейсы. Единственное различие между ними — идентификатор, который применяется для создания экземпляра клиентского пакета SDK. 

```csharp
// Create a DeviceClient object. This DeviceClient will act on behalf of a 
// module since it is created with a module’s connection string instead 
// of a device connection string. 
DeviceClient client = new DeviceClient.CreateFromConnectionString(moduleConnectionString, settings); 
await client.OpenAsync(); 
 
// Get the model twin 
Twin twin = await client.GetTwinAsync(); 
```

## <a name="offline-capabilities"></a>Возможности автономной работы

Azure IoT Edge поддерживает автономные операции с устройствами IoT Edge. Сейчас эти возможности ограничены, и ведется разработка дополнительных сценариев. 

Модули IoT Edge могут находиться вне сети в течение продолжительного времени при соблюдении следующих требований: 

* **Не истек срок жизни (TTL) сообщения**. По умолчанию срок жизни сообщения составляет два часа, но его можно увеличить или уменьшить в разделе "Конфигурация хранения и пересылки" параметров центра IoT Edge. 
* **В автономном состоянии модулям не требуется повторно проходить проверку подлинности в центре IoT Edge**. Модули могут проходить проверку подлинности только в центрах Edge, имеющих активное соединение с Центром Интернета вещей. Модулям нужно повторить проверку подлинности при перезапуске по любой причине. Модули по-прежнему могут отправлять сообщения центру Edge после истечения срока действия токена SAS. При возобновлении подключения центр Edge запрашивает у модуля новый токен и проверяет его на соответствие в Центре Интернета вещей. В случае успешной проверки центр Edge пересылает сохраненные сообщения модуля — даже сообщения, отправленные после истечения срока действия токена модуля. 
* **При возобновлении подключения модуль, отправивший сообщения в автономном режиме, продолжает работать**. При восстановлении подключения к Центру Интернета вещей центр Edge должен проверить новый токен модуля (если срок действия предыдущего истек), прежде чем пересылать сообщения этого модуля. Если модуль не может предоставить новый токен, центр Edge не обрабатывает хранимые сообщения этого модуля. 
* **Центр Edge располагает местом на диске для хранения сообщений**. По умолчанию сообщения хранятся в файловой системе контейнера центра Edge. В конфигурации есть параметр, позволяющий задать для хранения сообщений подключенный том. В любом случае для хранения сообщений с отложенной доставкой в Центр Интернета вещей требуется наличие доступного пространства.  

## <a name="next-steps"></a>Дополнительная информация
 - [Общие сведения о среде выполнения Azure IoT Edge и ее архитектуре][lnk-runtime]

<!-- Images -->
[1]: ./media/iot-edge-modules/image_instance.png
[2]: ./media/iot-edge-modules/identity.png

<!-- Links -->
[lnk-device-identity]: ../iot-hub/iot-hub-devguide-identity-registry.md
[lnk-device-twin]: ../iot-hub/iot-hub-devguide-device-twins.md
[lnk-runtime]: iot-edge-runtime.md