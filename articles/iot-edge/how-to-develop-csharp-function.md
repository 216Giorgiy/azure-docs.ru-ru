---
title: Отладка модулей Функций Azure для Azure IoT Edge | Документы Майкрософт
description: Использование Visual Studio Code для отладки Функций Azure C# с помощью Azure IoT Edge
author: shizn
manager: ''
ms.author: xshi
ms.date: 06/26/2018
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: bf2d1af66cc3ecc35dafe3bcd43bf10399d71641
ms.sourcegitcommit: 30fd606162804fe8ceaccbca057a6d3f8c4dd56d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/30/2018
ms.locfileid: "39346721"
---
# <a name="use-visual-studio-code-to-develop-and-debug-azure-functions-for-azure-iot-edge"></a>Использование Visual Studio Code для разработки и отладки Функций Azure для Azure IoT Edge

Эта статья описывает, как использовать [Visual Studio Code (VS Code)](https://code.visualstudio.com/) для отладки Функций Azure в Azure IoT Edge.

## <a name="prerequisites"></a>Предварительные требования
В этой статье предполагается, что для разработки вы используете компьютер или виртуальную машину под управлением Windows или Linux. Устройство IoT Edge может быть другим физическим устройством. Или вы можете имитировать устройство IoT Edge на компьютере разработки.

> [!NOTE]
> В этой статье об отладке показано, как присоединить процесс в контейнер модуля и выполнить отладку модуля с помощью VS Code. Функции C# можно отлаживать только в контейнерах amd64 Linux. С возможностями отладки Visual Studio Code можно ознакомиться в [этой статье](https://code.visualstudio.com/Docs/editor/debugging). 

В этой статье в качестве основного средства разработки используется Visual Studio Code. Установите VS Code. Затем добавьте все необходимые расширения: 

* [Visual Studio Code](https://code.visualstudio.com/) 
* [расширение Azure IoT Edge](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge); 
* [расширение C#](https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp); 
* [расширение Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker).

Чтобы создать модуль, требуется .NET для создания папки проекта, Docker для создания образа модуля и реестр контейнеров для хранения образа модуля:
* [Пакет SDK для .NET Core 2.1](https://www.microsoft.com/net/download).
* [Docker Community Edition](https://docs.docker.com/install/) на компьютере, на котором ведется разработка. 
* [Реестр контейнеров Azure](https://docs.microsoft.com/azure/container-registry/) или [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).

   > [!TIP]
   > Вместо облачного реестра можно использовать локальный реестр Docker для создания прототипов и тестирования. 

Для тестирования модуля на устройстве требуется действующий Центр Интернета вещей по крайней мере с одним устройством IoT Edge. Чтобы использовать компьютер в качестве устройства IoT Edge, выполните инструкции в кратком руководстве для [Windows](quickstart.md) или [Linux](quickstart-linux.md). 

## <a name="create-a-new-solution-template"></a>Создайте новый шаблон решения

Далее описано, как создать решение IoT Edge, которое содержит один модуль функции на языке C#. Каждое решение имеет несколько модулей.

1. В Visual Studio Code выберите **Вид** > **Интегрированный терминал**.
3. Выберите **Представление** > **Палитра команд**.
4. В палитре команд введите и выполните команду **Azure IoT Edge: New IoT Edge Solution**. 

   ![Запуск команды для создания решения IoT Edge](./media/how-to-develop-csharp-module/new-solution.png)

5. Перейдите к папке, где требуется создать решение. Щелкните **Выбрать папку**. 
6. Введите имя для решения. 
7. Выберите **Функции Azure — C#** в качестве шаблона для первого модуля в решении.
8. Введите имя модуля. Оно должно быть уникальным в пределах реестра контейнеров. 
9. Укажите репозиторий образов для модуля. VS Code автоматически заполняет имя модуля значением **localhost:5000**. Замените его собственными данными реестра. Если для тестирования вы используете локальный реестр Docker, вполне подойдет значение **localhost**. Если используется Реестр контейнеров Azure, укажите сервер входа, заданный в параметрах реестра. Значение для сервера входа выглядит так: **\<имя реестра\>.azurecr.io**.

VS Code принимает предоставленные сведения, создает решение IoT Edge с проектом Функций Azure, а затем загружает его в новом окне.

В решении существует четыре элемента: 

* Папка **.vscode** содержит конфигурации отладки.
* Папка **modules** содержит вложенные папки для каждого модуля. На этом этапе у вас всего один модуль. Но вы можете добавить модули в палитре команд с помощью команды **Azure IoT Edge: Add IoT Edge Module**.
* В файле **ENV** перечислены переменные среды. Если реестр контейнеров Azure является вашим реестром, вы получите в нем имя пользователя и пароль для реестра контейнеров Azure. 

   >[!NOTE]
   >Файл среды создается только в том случае, если вы указали репозиторий образов для модуля. Если вы не изменяли значения по умолчанию localhost для тестирования и отладки локально, объявлять переменные среды не требуется. 

* В файле **deployment.template.json** указан новый модуль, а также пример модуля **tempSensor**, который имитирует данные для тестирования. Дополнительные сведения о том, как работают манифесты развертывания, см. в разделе [Сведения об использовании манифестов развертывания для развертывания модулей и установки маршрутов](module-composition.md).

## <a name="develop-your-module"></a>Разработка модуля

Код Функции Azure по умолчанию, который поставляется с решением, находится в **modules** > **\<имя вашего модуля\>** > **EdgeHubTrigger-Csharp** > **run.csx**. Модуль и файл deployment.template.json настраиваются так, чтобы можно было собрать решение, передать его в реестр контейнеров и развернуть на устройстве, чтобы начать тестирование, не меняя код. Модуль просто принимает входные данные из источника (в данном случае модуль tempSensor имитирует данные) и передает их в Центр Интернета вещей. 

Когда вы будете готовы настроить шаблон Функций Azure с добавлением собственного кода, используйте [пакеты SDK для Центра Интернета вещей Azure](../iot-hub/iot-hub-devguide-sdks.md), чтобы создать модули, которые удовлетворяют ключевые потребности решений Интернета вещей, такие как безопасность, управление устройствами и надежность. 

## <a name="build-your-module-for-debugging"></a>Сборка модуля для отладки
1. Чтобы начать отладку, повторно выполните сборку образа Docker с помощью **Dockerfile.amd64.debug** и повторно разверните решение Edge. В проводнике VS Code перейдите к файлу `deployment.template.json`. Обновите URL-адрес образа функции, добавив в конце `.debug`.

    ![Создание образа для отладки](./media/how-to-debug-csharp-function/build-debug-image.png)

2. Перестройте решение. В палитре команд VS Code введите и выполните команду **Azure IoT Edge: Build IoT Edge solution**.
3. В обозревателе устройств Центра Интернета вещей Azure щелкните правой кнопкой мыши идентификатор устройства IoT Edge и выберите **Create deployment for Edge device** (Создать развертывание для устройства Edge). Выберите файл `deployment.json` в папке `config`. Ход развертывания можно отслеживать по идентификатору развертывания во встроенном терминале VS Code.

Чтобы проверить состояние контейнера, откройте обозреватель Docker VS Code или выполните команду `docker images` в окне терминала.

## <a name="start-debugging-c-functions-in-vs-code"></a>Запуск отладки функций C# в VS Code
1. VS Code хранит информацию о конфигурации отладки в файле `launch.json`, расположенном в папке `.vscode` рабочей области. Этот файл `launch.json` создан при создании решения IoT Edge. Он автоматически обновляется при каждом добавлении нового модуля, который поддерживает отладку. Перейдите в представление отладки. Выберите соответствующий файл конфигурации отладки. Действие отладки должно иметь такое имя: **Удаленная отладка имя_модуля (.NET Core)**.

   ![Выбор конфигурации отладки](./media/how-to-debug-csharp-function/select-debug-configuration.jpg)

2. Перейдите на страницу `run.csx`. Добавьте в функцию точку останова.
3. Выберите **Начать отладку** или нажмите клавишу **F5**. Выберите процесс для присоединения.
4. В представлении отладки VS Code можно просмотреть переменные на панели слева. 


> [!NOTE]
> В этом примере показаны способы отладки функций IoT Edge .NET Core в контейнерах. Он основан на отладочной версии файла `Dockerfile.amd64.debug`, который при сборке образа контейнера включает в него отладчик командной строки .NET Core (VSDBG). После отладки функций C# рекомендуется непосредственно использовать или настраивать файл `Dockerfile` без VSDBG для готовых функций IoT Edge.

## <a name="next-steps"></a>Дополнительная информация

После создания модуля узнайте, как [развернуть модули Azure IoT Edge в Visual Studio Code](how-to-deploy-modules-vscode.md).

Чтобы разрабатывать модули для устройств IoT Edge, см. раздел [Понимание и использование пакетов SDK для Центра Интернета вещей Azure](../iot-hub/iot-hub-devguide-sdks.md).
