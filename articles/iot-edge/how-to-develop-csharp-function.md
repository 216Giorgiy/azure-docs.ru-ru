---
title: Отладка модулей службы "Функции" для Azure IoT Edge | Документация Майкрософт
description: Использование Visual Studio Code для отладки решения "Функции Azure" C# с помощью Azure IoT Edge
author: shizn
manager: ''
ms.author: xshi
ms.date: 06/26/2018
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 5ee5d368bde0f176442a01ba266791f8a9c2cbc3
ms.sourcegitcommit: 0c490934b5596204d175be89af6b45aafc7ff730
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/27/2018
ms.locfileid: "37052833"
---
# <a name="use-visual-studio-code-to-develop-and-debug-azure-functions-for-azure-iot-edge"></a>Использование Visual Studio Code для разработки и отладки решения "Функции Azure" для Azure IoT Edge

В этой статье содержатся подробные инструкции по использованию [кода Visual Studio (VS)](https://code.visualstudio.com/) для отладки службы "Функции Azure" на IoT Edge.

## <a name="prerequisites"></a>предварительным требованиям
В этой статье предполагается, что для разработки вы используете компьютер или виртуальную машину под управлением Windows или Linux. Устройством Azure IoT Edge может быть другое физическое устройство или имитация устройства, запущенная на компьютере разработки.

> [!NOTE]
> В этом руководстве по отладке показано, как присоединить процесс в контейнер модуля и выполнить отладку модуля с помощью VS Code. Модули C# можно отлаживать только в контейнерах linux-amd64. С возможностями отладки Visual Studio Code можно ознакомиться в [этой статье](https://code.visualstudio.com/Docs/editor/debugging). 

В этой статье в качестве основного средства разработки используется Visual Studio Code. Установите VS Code и добавьте все необходимые расширения: 

* [Visual Studio Code](https://code.visualstudio.com/); 
* [расширение Azure IoT Edge](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge); 
* [расширение C#](https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp); 
* [расширение Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker).

Чтобы создать модуль, требуется .NET для создания папки проекта, Docker для создания образа модуля и реестр контейнеров для хранения образа модуля:
* [Пакет SDK для .NET Core 2.1](https://www.microsoft.com/net/download).
* [Docker CE](https://docs.docker.com/install/) на компьютере, на котором ведется разработка. 
* [Реестр контейнеров Azure](https://docs.microsoft.com/azure/container-registry/) или [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).

   > [!TIP]
   > Вместо облачного реестра можно использовать локальный реестр Docker для создания прототипов и тестирования. 

Для тестирования модуля на устройстве требуется действующий Центр Интернета вещей по крайней мере с одним устройством IoT Edge. Чтобы использовать компьютер в качестве устройства IoT Edge, выполните инструкции в руководстве для [Windows](quickstart.md) или [Linux](quickstart-linux.md). 

## <a name="create-a-new-solution-template"></a>Создайте новый шаблон решения

Далее описано, как создать решение IoT Edge, которое содержит один модуль функции на языке C#. Каждое решение может содержать несколько модулей.

1. В Visual Studio Code выберите **Вид** > **Интегрированный терминал**.
3. Выберите **Представление** > **Палитра команд**.
4. В палитре команд введите и выполните команду**Azure IoT Edge: New IoT Edge Solution**. 

   ![Запуск команды создания решения IoT Edge](./media/how-to-develop-csharp-module/new-solution.png)

5. Перейдите к папке, где требуется создать решение, и щелкните **Выбрать папку**. 
6. Укажите имя для решения. 
7. Выберите **Функции Azure — C#** в качестве шаблона для первого модуля в решении.
8. Присвойте модулю имя. Оно должно быть уникальным в пределах реестра контейнеров. 
9. Укажите репозиторий образов для модуля. VS Code автоматически заполняет имя модуля, поэтому нужно только заменить **localhost:5000** данными вашего реестра. Если для тестирования вы используете локальный реестр Docker, вполне подойдет значение localhost. Если используется Реестр контейнеров Azure, укажите сервер входа, заданный в параметрах реестра. Значение для сервера входа выглядит так: **\<имя реестра\>.azurecr.io**.

VS Code принимает предоставленные сведения, создает решение IoT Edge в проекте функции, а затем загружает его в новом окне.

В решении имеется три элемента: 

* Папка **.vscode**, которая содержит конфигурации отладки.
* Папка **modules**, которая содержит вложенные папки для каждого модуля. Сейчас у вас только один модуль, но вы можете добавить модули в палитре команд с помощью команды **Azure IoT Edge: Add IoT Edge Module**.
* В файле **ENV** перечислены переменные среды. Если вы используете ACR в качестве реестра, в этом файле указаны имя пользователя и пароль ACR. 
* В файле **deployment.template.json** указан новый модуль, а также пример модуля **tempSensor**, который моделирует данные для тестирования. Дополнительные сведения о работе манифестов развертывания см. в статье [Сведения об использовании, настройке и повторном использовании модулей Azure IoT Edge (предварительная версия)](module-composition.md).

## <a name="build-your-iot-edge-function-module-for-debugging-purpose"></a>Создайте свой модуль функции IoT Edge для целей отладки
1. Чтобы начать отладку, повторно выполните сборку образа Docker с помощью **Dockerfile.amd64.debug** и повторно разверните решение Edge. В проводнике VS Code перейдите к файлу `deployment.template.json`. Обновите URL-адрес образа функции, добавив `.debug` в конце.

    ![Сборка образа для отладки](./media/how-to-debug-csharp-function/build-debug-image.png)

2. Перестройте решение. В палитре команд VS Code введите и выполните команду **Azure IoT Edge: Build IoT Edge Solution**.
3. В обозревателе устройств Центра Интернета вещей Azure щелкните правой кнопкой мыши идентификатор устройства IoT Edge и выберите **Create deployment for Edge device** (Создать развертывание для устройства Edge). Выберите файл `deployment.json` в папке `config`. Ход развертывания можно отслеживать с помощью идентификатора развертывания во встроенном терминале VS Code.

Чтобы проверить состояние контейнера, откройте обозреватель кода Docker VS или выполните команду `docker images` в окне терминала.

## <a name="start-debugging-c-function-in-vs-code"></a>Запуск отладки функции C# в VS Code
1. VS Code хранит информацию о конфигурации отладки в файле `launch.json`, расположенном в папке `.vscode` рабочей области. Этот файл `launch.json` создан при создании решения IoT Edge. Он автоматически обновляется при каждом добавлении нового модуля, который поддерживает отладку. Перейдите к представлению отладки и выберите соответствующий файл конфигурации отладки. Действие отладки должно иметь такое имя: **Удаленная отладка имя_модуля (.NET Core)** ![Выбор конфигурации отладки](./media/how-to-debug-csharp-function/select-debug-configuration.jpg)

2. Перейдите на страницу `run.csx`. Добавьте в функцию точку останова.
3. Нажмите кнопку **Начать отладку** или клавишу **F5**, затем выберите процесс для присоединения.
4. В представлении отладки VS Code можно просмотреть переменные на панели слева. 


> [!NOTE]
> В примере выше показан процесс отладки функции .NET Core IoT Edge в контейнерах. Он основан на отладочной версии файла `Dockerfile.amd64.debug`, который при сборке образа контейнера включает в него отладчик командной строки .NET Core (VSDBG). Мы рекомендуем использовать для рабочей версии функции IoT Edge готовый или отдельно настроенный файл `Dockerfile` без отладчика VSDBG, когда вы завершите отладку функции C#.

## <a name="next-steps"></a>Дополнительная информация

После создания модуля узнайте, как [развернуть модули Azure IoT Edge в Visual Studio Code](how-to-deploy-modules-vscode.md).
