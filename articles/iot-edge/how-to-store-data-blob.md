---
title: Хранение блочных BLOB-объектов на устройствах — Azure IoT Edge | Документация Майкрософт
description: Разверните модуль хранилища BLOB-объектов Azure на вашем устройстве IoT Edge для хранения данных на границе.
author: kgremban
manager: philmea
ms.author: kgremban
ms.reviewer: arduppal
ms.date: 01/04/2019
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.custom: seodec18
ms.openlocfilehash: 9faed53540d449f8658655ff7285b38aa20bee6c
ms.sourcegitcommit: 644de9305293600faf9c7dad951bfeee334f0ba3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2019
ms.locfileid: "54901825"
---
# <a name="store-data-at-the-edge-with-azure-blob-storage-on-iot-edge-preview"></a>Хранение данных на границе с помощью хранилища BLOB-объектов Azure в IoT Edge (предварительная версия)

Хранилище BLOB-объектов Azure в IoT Edge предоставляет решение по хранению [блочных BLOB-объектов](https://docs.microsoft.com/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs#about-block-blobs) на пограничных устройствах. Модуль хранилища BLOB-объектов на устройстве IoT Edge ведет себя как служба BLOB-объектов Azure, но блочные BLOB-объекты хранятся локально на вашем устройстве IoT Edge. Вы можете получить доступ к BLOB-объектам с помощью тех же методов SDK службы хранилища Azure или вызовов API к блочным BLOB-объектам, к которым вы уже привыкли. 

Этот модуль подходит для сценариев, в которых необходимо локально хранить такие данные, как видео, изображения, финансовые данные, данные больницы, или любые данные, которые могут позже обрабатываться локально или передаваться в облако.

В этой статье приведены инструкции по развертыванию хранилища BLOB-объектов Azure в контейнере IoT Edge, в котором работает служба BLOB-объектов на вашем устройстве IoT Edge. 

>[!NOTE]
>Хранилище BLOB-объектов в IoT Edge находится в [общедоступной предварительной версии](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). 

## <a name="prerequisites"></a>Предварительные требования

Устройство Azure IoT Edge.

* В качестве устройства Azure IoT Edge можно использовать компьютер, на котором ведется разработка, или виртуальную машину. Для этого выполните действия, описанные в кратком руководстве для устройств [Linux](quickstart-linux.md) или [Windows](quickstart.md).
* Хранилище BLOB-объектов в модуле IoT Edge поддерживает следующие конфигурации устройств:

   | Операционная система | Архитектура |
   | ---------------- | ------------ |
   | Ubuntu Server 16.04 | AMD64 |
   | Ubuntu Server 18.04 | AMD64 |
   | Windows 10 IoT Core (обновление за октябрь) | AMD64 |
   | Windows 10 IoT Enterprise (обновление за октябрь) | AMD64 |
   | Windows Server 2019 | AMD64 |
   | Raspbian Stretch | ARM32 |

Облачные ресурсы.

* [Центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md) цен. категории "Стандартный" в Azure. 


## <a name="deploy-blob-storage-to-your-device"></a>Развертывание хранилища BLOB-объектов на устройстве

Существует несколько способов развертывания модулей на устройстве IoT Edge, и все они подходят для хранилища BLOB-объектов на модулях IoT Edge. Два простейших метода — это портал Azure или шаблоны Visual Studio Code. 

### <a name="azure-portal"></a>Портал Azure

Azure Marketplace предоставляет модули IoT Edge, развертываемые непосредственно на устройствах IoT Edge, включая хранилище BLOB-объектов Azure в IoT Edge. Выполните следующие действия для развертывания модуля с помощью портала Azure.

1. На [портале Azure](https://portal.azure.com) выполните поиск по запросу "Хранилище BLOB-объектов Azure в IoT Edge". Затем **выберите** результат поиска в Marketplace.

   ![Создание модуля в результате поиска в Marketplace](./media/how-to-store-data-blob/marketplace-module.png)

2. Выберите устройство IoT Edge, чтобы получить этот модуль. На странице **Целевые устройства для модуля IoT Edge** укажите следующие сведения:

   1. Выберите **подписку**, которая содержит используемый Центр Интернета вещей.

   2. Выберите нужный **Центр Интернета вещей**.

   3. Если вам известно **имя устройства IoT Edge**, введите его в текстовое поле. Кроме того, вы можете щелкнуть **Найти устройство**, чтобы выбрать его из списка устройств IoT Edge в Центре Интернета вещей. 
   
   4. Нажмите кнопку **Создать**.

   После выбора модуля IoT Edge из Azure Marketplace и устройства IoT Edge для получения модуля откроется мастер, который состоит из трех шагов. Он поможет точно определить, как будет развернут модуль.

3. На шаге **добавления модулей** мастера настройки модулей обратите внимание, что модуль **AzureBlobStorageonIoTEdge** уже указан в разделе **Модули развертывания**. 

2. Из списка модулей развертывания выберите модуль хранилища BLOB-объектов, чтобы просмотреть сведения о нем. 

   ![Выбор имени модуля для просмотра сведений о нем](./media/how-to-store-data-blob/open-module-details.png)

3. На странице **Пользовательские модули IoT Edge** обновите хранилище BLOB-объектов Azure в модуле IoT Edge, выполнив следующие действия:

   1. Замените заглавную букву **имени** модуля буквой нижнего регистра. При необходимости переименуйте модуль или используйте `azureblobstorageoniotedge`. 

      >[!IMPORTANT]
      >Azure IoT Edge учитывает регистр при вызове модулей, а название пакета SDK службы хранилища по умолчанию преобразовывается в нижний регистр. Чтобы подключения к хранилищу BLOB-объектов Azure в модуле IoT Edge не прерывались, следует задать имя модуля с использованием знаков нижнего регистра. 

   2. Контейнеру необходимы привязки портов со значениями **параметров создания контейнера** по умолчанию. На устройство также следует добавить сведения об учетной записи хранения и информацию о привязке для каталога хранения. Замените имеющийся на портале JSON-файл указанным ниже:
    
      ```json
      {
          "Env":[
              "LOCAL_STORAGE_ACCOUNT_NAME=<your storage account name>",
              "LOCAL_STORAGE_ACCOUNT_KEY=<your storage account key>"
          ],
          "HostConfig":{
              "Binds":[
                  "<storage directory bind>"
              ],
              "PortBindings":{
                  "11002/tcp":[{"HostPort":"11002"}]
              }
          }
      }
      ```   
   3. Обновите в скопированном JSON-файле следующие сведения: 

      * Замените `<your storage account name>` запоминаемым именем. Имена учетных записей должны содержать от 3 до 24 знаков — строчных букв и цифр.
      * Замените `<your storage account key>` на 64-байтовый ключ Base64. Вы можете создать ключ с помощью таких средств, как [GeneratePlus](https://generate.plus/en/base64?gp_base64_base[length]=64). Вы будете использовать эти учетные данные для доступа к хранилищу BLOB-объектов из других модулей.
      * Замените `<storage directory bind>` в зависимости от операционной системы контейнера. Укажите имя [тома](https://docs.docker.com/storage/volumes/) или абсолютный путь к каталогу на устройстве IoT Edge, где модуль BLOB-объектов должен хранить данные. Привязка каталога хранения сопоставляет указанное расположение на устройстве с определением расположения в модуле. 

         * Контейнеры Linux: **\<путь к хранилищу>:/blobroot**. Например, /srv/containerdata:/blobroot. Или my-volume:/blobroot. 
         * Контейнеры Windows: **\<путь к хранилищу>:C:/BlobRoot**. Например, C:/ContainerData:C:/BlobRoot. Или my-volume:C:/blobroot.
   
      > [!IMPORTANT]
      > Не изменяйте вторую половину значения привязки каталога хранения, которая указывает на определенное расположение в модуле. Привязка каталога хранения всегда должна заканчиваться на **:/blobroot** — для контейнеров Linux и **:C:/BlobRoot** — для контейнеров Windows.

      ![Изменение значений для параметров создания контейнера модуля на портале](./media/how-to-store-data-blob/edit-module.png)

   4. Щелкните **Сохранить**.

4. Выберите **Далее**, чтобы перейти к следующему шагу мастера.
5. На шаге мастера **Укажите маршруты** выберите **Далее**.
6. В мастере на шаге **Проверка развертывания** выберите **Отправить**.
7. Сразу после отправки развертывания можно вернуться на страницу **IoT Edge** Центра Интернета вещей. Выберите устройство IoT Edge, на которое отправили развертывание, чтобы открыть сведения о нем. 
8. В сведениях об устройстве убедитесь, что для модуля службы хранилища BLOB-объектов настроены параметры **Указано в развертывании** и **Данные, полученные от устройства**. Запуск модуля на устройстве может занять несколько секунд. Затем информация о нем передается в Центр Интернета вещей. Обновите страницу, чтобы увидеть обновленное состояние. 

### <a name="visual-studio-code-templates"></a>Шаблоны Visual Studio Code

Azure IoT Edge предоставляет шаблоны в Visual Studio Code для разработки решений для границы. Для выполнения этих действий необходимо, чтобы на компьютере была установлена служба [Visual Studio Code](https://code.visualstudio.com/), настроенная со [средствами Azure IoT](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-tools).

Выполните следующие действия для создания нового решения IoT Edge с модулем хранилища BLOB-объектов и настройки манифеста развертывания. 

1. Выберите **Представление** > **Палитра команд**. 

2. В палитре команд введите и выполните команду **Azure IoT Edge: New IoT Edge Solution** (Azure IoT Edge: создать решение IoT Edge). Следуйте инструкциям на экране в палитре команд для создания решения.

   | Поле | Значение |
   | ----- | ----- |
   | Выбор папки | Выберите расположение на компьютере разработчика для VS Code, чтобы создать файлы решения. |
   | Введите название решения. | Введите описательное имя решения или примите имя по умолчанию **EdgeSolution**. |
   | Выбор шаблона модуля | Выберите **Existing Module (Enter full image URL)** (Имеющийся модуль (введите полный URL-адрес образа)). |
   | Указание имени модуля | Введите имя модуля, используя знаки нижнего регистра, например **azureblobstorage**.<br><br>В модуле IoT Edge очень важно использовать знаки нижнего регистра для имени хранилища BLOB-объектов Azure. IoT Edge учитывает регистр при ссылке на модули, а название пакета SDK службы хранилища по умолчанию преобразовывается в нижний регистр. |
   | Указание образа Docker для модуля | Укажите универсальный код ресурса (URI) образа: **mcr.microsoft.com/azure-blob-storage:latest**. |

   VS Code принимает предоставленные сведения, создает решение IoT Edge, а затем загружает его в новом окне. Шаблон решения создает шаблон манифеста развертывания, который содержит образ модуля хранилища BLOB-объектов, но вам нужно настроить параметры создания модуля. 

3. Откройте **deployment.template.json** в рабочей области нового решения и найдите раздел **modules**. Внесите следующие изменения конфигурации.

   1. Удалите модуль **tempSensor**, так как он не требуется для этого развертывания. 

   2. Скопируйте и вставьте следующий код в поле **createOptions** модуля хранилища BLOB-объектов: 

      ```json
      "Env": [
        "LOCAL_STORAGE_ACCOUNT_NAME=$STORAGE_ACCOUNT_NAME","LOCAL_STORAGE_ACCOUNT_KEY=$STORAGE_ACCOUNT_KEY"
      ],
      "HostConfig":{
        "Binds": ["<storage directory bind>"],
        "PortBindings":{
          "11002/tcp": [{"HostPort":"11002"}]
        }
      }
      ```

      ![Изменение значений для параметров создания модуля в VS Code](./media/how-to-store-data-blob/create-options.png)

4. В файле JSON с параметрами создания обновите `<storage directory bind>` в зависимости от операционной системы контейнера. Укажите имя [тома](https://docs.docker.com/storage/volumes/) или абсолютный путь к каталогу на устройстве IoT Edge, где модуль BLOB-объектов должен хранить данные. Привязка каталога хранения сопоставляет указанное расположение на устройстве с определением расположения в модуле.  

   * Контейнеры Linux: **\<путь к хранилищу>:/blobroot**. Например, /srv/containerdata:/blobroot. Или my-volume:/blobroot.
   * Контейнеры Windows: **\<путь к хранилищу>:C:/BlobRoot**. Например, C:/ContainerData:C:/BlobRoot. Или my-volume:C:/blobroot.
   
   > [!IMPORTANT]
   > Не изменяйте вторую половину значения привязки каталога хранения, которая указывает на определенное расположение в модуле. Привязка каталога хранения всегда должна заканчиваться на **:/blobroot** — для контейнеров Linux и **:C:/BlobRoot** — для контейнеров Windows.

5. Сохраните файл **deployment.template.json**.

6. Откройте **ENV**-файл в рабочей области решения. 

7. В ENV-файле заданы параметры для получения учетных данных реестра контейнеров. Он не требуется для образа хранилища BLOB-объектов, так как находится в открытом доступе. Вместо этого укажите в файле две новые переменные среды: 

   ```env
   STORAGE_ACCOUNT_NAME=
   STORAGE_ACCOUNT_KEY=
   ```

8. Укажите значение `STORAGE_ACCOUNT_NAME`. Имена учетных записей должны содержать от 3 до 24 знаков (строчные буквы и цифры). Укажите 64-байтовый ключ Base64 в качестве значения `STORAGE_ACCOUNT_KEY`. Вы можете создать ключ с помощью таких средств, как [GeneratePlus](https://generate.plus/en/base64?gp_base64_base[length]=64). Вы будете использовать эти учетные данные для доступа к хранилищу BLOB-объектов из других модулей. 

   Не добавляйте пробелы или кавычки вокруг указанных значений. 

9. Сохраните файл **.env**. 

10. Щелкните правой кнопкой мыши **deployment.template.json** и выберите **Создать манифест развертывания IoT Edge**. 

11. Visual Studio Code принимает данные из deployment.template.json и .env и использует их для создания файла манифеста развертывания. Манифест развертывания создается в новой папке **config** в рабочей области решения. Получив этот файл, выполните действия, описанные в разделе [Развертывание модулей Azure IoT Edge из Visual Studio Code](how-to-deploy-modules-vscode.md) или [Развертывание модулей IoT Edge Azure с помощью Azure CLI 2.0](how-to-deploy-modules-cli.md).

## <a name="connect-to-your-blob-storage-module"></a>Подключение к модулю хранилища BLOB-объектов

Вы можете использовать имя учетной записи и ключ учетной записи, настроенные для вашего модуля, для доступа к хранилищу BLOB-объектов на устройстве IoT Edge. 

Укажите устройство IoT Edge в качестве конечной точки большого двоичного объекта для любых запросов к хранилищу. Вы можете [создать строку подключения для явной конечной точки хранилища](../storage/common/storage-configure-connection-string.md#create-a-connection-string-for-an-explicit-storage-endpoint) с помощью сведений об устройстве IoT Edge и имени учетной записи. 

1. Для модулей, которые развернуты на одном и том же устройстве Edge, где выполняется хранилище BLOB-объектов Azure в IoT Edge, конечная точка большого двоичного объекта будет следующей: `http://<module name>:11002/<account name>`. 
2. Для модулей, которые развернуты на другом устройстве Edge (не на устройстве, где выполняется хранилище BLOB-объектов Azure в IoT Edge), в зависимости от настройки конечная точка большого двоичного объекта может быть следующей: `http://<device IP >:11002/<account name>`, `http://<IoT Edge device hostname>:11002/<account name>` или `http://<FQDN>:11002/<account name>`.

## <a name="logs"></a>Журналы

Вы можете найти журналы в контейнере в следующем разделе: 
* Для Linux: /blobroot/logs/platformblob.log

## <a name="deploy-multiple-instances"></a>Развертывание нескольких экземпляров

Если вы хотите развернуть несколько экземпляров хранилища BLOB-объектов Azure в IoT Edge, необходимо просто изменить HostPort, к которому привязан модуль. Модули службы хранилища BLOB-объектов всегда предоставляют порт 11002 в контейнере, но вы можете объявить, к какому порту он привязан в узле. 

Измените параметры создания модуля, чтобы изменить значение HostPort:

```json
\"PortBindings\": {\"11002/tcp\": [{\"HostPort\":\"<port number>\"}]}
```

При подключении к дополнительным модулям хранилища BLOB-объектов измените конечную точку, чтобы она указывала на обновленный порт узла. 

### <a name="try-it-out"></a>Попробуйте сейчас

Документация по хранилищу BLOB-объектов Azure содержит краткие руководства с примерами кода на нескольких языках. Вы можете запустить эти примеры, чтобы протестировать хранилище BLOB-объектов Azure в IoT Edge путем изменения конечной точки большого двоичного объекта для указания на модуль хранилища BLOB-объектов.

В следующих кратких руководствах используются языки, которые также поддерживаются в IoT Edge, поэтому их можно развернуть как модули IoT Edge наряду с модулями хранилища BLOB-объектов:

* [.NET](../storage/blobs/storage-quickstart-blobs-dotnet.md)
* [Java](../storage/blobs/storage-quickstart-blobs-java.md)
* [Python](../storage/blobs/storage-quickstart-blobs-python.md)
* [Node.js](../storage/blobs/storage-quickstart-blobs-nodejs.md)

## <a name="supported-storage-operations"></a>Поддерживаемые операции в хранилище

Модули службы хранилища BLOB-объектов в IoT Edge используют те же пакеты SDK службы хранилища Azure и согласованы с версией 2018-03-28 API службы хранилища Azure для конечных точек блочных BLOB-объектов. Более поздние версии зависят от потребностей клиентов. 

Не все операции в хранилище BLOB-объектов Azure поддерживаются в хранилище BLOB-объектов Azure в IoT Edge. В следующих разделах подробно описывается, какие операции поддерживается, а какие — нет. 

### <a name="account"></a>Учетная запись.

Поддерживается: 
* Перечисление контейнеров

Не поддерживается: 
* Получение и задание свойств службы BLOB-объектов
* Предварительный запрос к BLOB-объектам
* Получение статистики службы BLOB-объектов
* Получение данных об учетной записи

### <a name="containers"></a>Контейнеры

Поддерживается: 
* Создание и удаление контейнера
* Получение свойств и метаданных контейнера
* Отображение списка больших двоичных объектов

Не поддерживается: 
* Получение и задание списка управления доступом для контейнера
* Аренда контейнера
* Определение метаданных контейнера

### <a name="blobs"></a>BLOB-объекты

Поддерживается: 
* Помещение, получение и удаление BLOB-объекта
* Получение и задание свойств BLOB-объекта
* Получение и задание метаданных BLOB-объекта

Не поддерживается: 
* Аренда BLOB-объекта
* Создание моментального снимка BLOB-объекта
* Копирование и прерывание копирования BLOB-объекта
* Отмена удаления BLOB-объекта
* Установка уровня BLOB-объекта

### <a name="block-blobs"></a>Blob-блоки

Поддерживается: 
* Вставка блока. Размер блока должен быть не более 4 МБ.
* Вставка и получение списка блоков

Не поддерживается:
* Вставка блока по URL-адресу

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о [хранилище BLOB-объектов Azure](../storage/blobs/storage-blobs-introduction.md)

