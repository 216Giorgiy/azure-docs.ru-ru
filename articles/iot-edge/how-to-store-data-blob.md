---
title: Хранилище BLOB-объектов на устройствах Azure IoT Edge | Документы Майкрософт
description: Разверните модуль хранилища BLOB-объектов Azure на вашем устройстве IoT Edge для хранения данных на границе.
author: kgremban
manager: timlt
ms.author: kgremban
ms.reviewer: arduppal
ms.date: 09/20/2018
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: b9e48eba4b46f024b056fe53b3b3df24feec802e
ms.sourcegitcommit: 32d218f5bd74f1cd106f4248115985df631d0a8c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46995675"
---
# <a name="store-data-at-the-edge-with-azure-blob-storage-on-iot-edge-preview"></a>Хранение данных на границе с помощью хранилища BLOB-объектов Azure в IoT Edge (предварительная версия)

Хранилище блогов Azure в IoT Edge предоставляет решение по хранению блочных BLOB-объектов на границе. Модуль хранилища BLOB-объектов на устройстве IoT Edge ведет себя как служба BLOB-объектов Azure, но блочные BLOB-объекты хранятся локально на вашем устройстве IoT Edge. Вы можете получить доступ к BLOB-объектам с помощью тех же методов SDK службы хранилища Azure или вызовов API к блочным BLOB-объектам, к которым вы уже привыкли. 

В этой статье приведены инструкции по развертыванию хранилища BLOB-объектов Azure в контейнере IoT Edge, в котором работает служба BLOB-объектов на вашем устройстве IoT Edge. 

>[!NOTE]
>Хранилище BLOB-объектов в IoT Edge находится в [общедоступной предварительной версии](https://azure.microsoft.com/support/legal/preview-supplemental-terms/). 

## <a name="prerequisites"></a>Предварительные требования

Устройство Azure IoT Edge.

* В качестве устройства Azure IoT Edge можно использовать компьютер, на котором ведется разработка, или виртуальную машину. Для этого выполните действия, описанные в кратком руководстве для устройств [Linux](quickstart-linux.md) или [Windows](quickstart.md).
* Хранилище BLOB-объектов в модуле IoT Edge поддерживает следующие конфигурации устройств:

   | Операционная система | Архитектура |
   | ---------------- | ------------ |
   | Ubuntu Server 16.04 | AMD64 |
   | Ubuntu Server 18.04 | AMD64 |
   | Windows 10 IoT Core (обновление за октябрь) | AMD64 |
   | Windows 10 IoT Enterprise (обновление за октябрь) | AMD64 |
   | Windows Server 2019 | AMD64 |
   | Raspbian Stretch | ARM32 |

Облачные ресурсы.

* [Центр Интернета вещей](../iot-hub/iot-hub-create-through-portal.md) цен. категории "Стандартный" в Azure. 


## <a name="deploy-blob-storage-to-your-device"></a>Развертывание хранилища BLOB-объектов на устройстве

Хранилище BLOB-объектов в IoT Edge предоставляет три стандартных образа контейнера — два для контейнеров Linux (архитектур AMD64 и ARM32) и один для контейнеров Windows (AMD64). При использовании одного из этих образов модуля для развертывания хранилища BLOB-объектов на вашем устройстве IoT Edge вы указываете три значения для настройки экземпляра модуля для устройства:

* **Имя учетной записи** и **ключ учетной записи**. Чтобы сохранить согласованность в службе хранилища Azure, модули хранилища BLOB-объектов используют имена учетных записей и ключи учетных записей для управления доступом. Имена учетных записей должны содержать от 3 до 24 знаков — строчных букв и цифр. Ключи учетных записей должны быть в кодировке base64 и иметь длину 64 байта. Вы можете создать ключ с помощью таких средств, как [GeneratePlus](https://generate.plus/en/base64).
* **Вариант локального хранилища**. Модуль службы хранилища BLOB-объектов хранит большие двоичные объекты локально на устройстве IoT Edge, чтобы большие двоичные объекты сохранялись, если модуль останавливается или перезапускается. Объявите существующий [том](https://docs.docker.com/storage/volumes
) или путь к локальной папке, где должны храниться большие двоичные объекты на вашем устройстве. 

Существует несколько способов развертывания модулей на устройстве IoT Edge, и все они подходят для хранилища BLOB-объектов на модулях IoT Edge. Два простейших метода — это портал Azure или шаблоны Visual Studio Code. 

### <a name="azure-portal"></a>Портал Azure

Чтобы развернуть хранилище BLOB-объектов на портале Azure, выполните действия, описанные в разделе [Развертывание модулей Azure IoT Edge с помощью портала Azure](how-to-deploy-modules-portal.md). Прежде чем перейти к развертыванию модуля, скопируйте URI образа и подготовьте параметры создания контейнера в зависимости от операционной системы контейнера. Используйте эти значения в разделе **Настройка манифеста развертывания** в статье о развертывании. 

Укажите URI образа для модуля хранилища BLOB-объектов: **mcr.microsoft.com/azure-blob-storage**. 
   
Используйте следующий шаблон JSON для поля **Параметры создания контейнера**. Настройка JSON с именем учетной записи хранения, ключ учетной записи хранения и привязка каталога хранилища.  
   
   ```json
   {
       "Env":[
           "LOCAL_STORAGE_ACCOUNT_NAME=<your storage account name>",
           "LOCAL_STORAGE_ACCOUNT_KEY=<your storage account key>"
       ],
       "HostConfig":[
           "Binds":[
               "<storage directory bind>"
           ],
           "PortBindings":{
               "11002/tcp":[{"HostPort":"11002"}]
           }
       ]
   }
   ```   
   
В параметрах создания JSON замените `\<your storage account name\>` на любое имя. Замените `\<your storage account key\>` на 64-байтовый ключ base64. Можно создать ключ с помощью таких средств, как [GeneratePlus](https://generate.plus/en/base64), который позволяет выбрать длину в байтах. Вы будете использовать эти учетные данные для доступа к хранилищу BLOB-объектов из других модулей.

В файле JSON с параметрами создания обновите `<storage directory bind>` в зависимости от операционной системы контейнера. Укажите имя [тома](https://docs.docker.com/storage/volumes/) или абсолютный путь к каталогу на устройстве IoT Edge, где модуль BLOB-объектов должен хранить данные.  

   * Контейнеры Linux: **\<путь к хранилищу>:/blobroot**. Например, /srv/containerdata:/blobroot. Или my-volume:/blobroot. 
   * Контейнеры Windows: **\<путь к хранилищу>:C:/BlobRoot**. Например, C:/ContainerData:C:/BlobRoot. Или my-volume:C:/blobroot. 


Не нужно предоставлять учетные данные реестра для доступа к хранилищу BLOB-объектов Azure в IoT Edge и объявлять маршруты для развертывания. 

### <a name="visual-studio-code-templates"></a>Шаблоны Visual Studio Code

Azure IoT Edge предоставляет шаблоны в Visual Studio Code для разработки решений для границы. Для выполнения этих действий необходимо, чтобы [Visual Studio Code](https://code.visualstudio.com/) был установлен на компьютере разработки и имел [расширение Azure IoT Edge](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge).

Выполните следующие действия для создания нового решения IoT Edge с модулем хранилища BLOB-объектов и настройки манифеста развертывания. 

1. Выберите **Представление** > **Палитра команд**. 

2. В палитре команд введите и выполните команду **Azure IoT Edge: New IoT Edge Solution**. 

3. Следуйте инструкциям для создания нового решения: 

   1. **Выберите папку**. Перейдите к папке, где требуется создать решение.  
   
   2. **Укажите имя решения**. Введите имя своего решения или примите имя по умолчанию.
   
   3. **Выберите шаблон модуля**. Выберите **Существующий модуль (введите полный URL-адрес образа)**.
   
   4. **Укажите имя модуля**. Введите запоминающееся имя для модуля, например **azureBlobStorage**.
   
   5. **Укажите образ Docker для модуля**. Укажите URI образа: **mcr.microsoft.com/azure-blob-storage**

VS Code принимает предоставленные сведения, создает решение IoT Edge, а затем загружает его в новом окне. 

Шаблон решения создает шаблон манифеста развертывания, который содержит образ модуля хранилища BLOB-объектов, но вам нужно настроить параметры создания модуля. 

1. Откройте **deployment.template.json** в рабочей области нового решения и найдите раздел **modules**. 

2. Удалите модуль **tempSensor**, так как он не требуется для этого развертывания. 

3. Скопируйте и вставьте следующий код в поле **createOptions** модуля хранилища BLOB-объектов: 

   ```json
   {\"Env\": [\"LOCAL_STORAGE_ACCOUNT_NAME=$STORAGE_ACCOUNT_NAME\",\" LOCAL_STORAGE_ACCOUNT_KEY=$STORAGE_ACCOUNT_KEY\"],\"HostConfig\": {\"Binds\": [\"<storage directory bind>\"],\"PortBindings\": {\"11002/tcp\": [{\"HostPort\":\"11002\"}]}}}
   ```

   ![Параметры создания модуля обновления](./media/how-to-store-data-blob/create-options.png)

4. В файле JSON с параметрами создания обновите `<storage directory bind>` в зависимости от операционной системы контейнера. Укажите имя [тома](https://docs.docker.com/storage/volumes/) или абсолютный путь к каталогу на устройстве IoT Edge, где модуль BLOB-объектов должен хранить данные.  

   * Контейнеры Linux: **\<путь к хранилищу>:/blobroot**. Например, /srv/containerdata:/blobroot. Или my-volume:/blobroot.
   * Контейнеры Windows: **\<путь к хранилищу>:C:/BlobRoot**. Например, C:/ContainerData:C:/BlobRoot. Или my-volume:C:/blobroot.

5. Сохраните **deployment.template.json**.

6. Откройте **.env** в рабочей области решения. 

7. Вам не нужно вводить значения реестра контейнеров для образа хранилища BLOB-объектов, так как он находится в открытом доступе. Вместо этого добавьте две новые переменные среды: 

   ```env
   STORAGE_ACCOUNT_NAME=
   STORAGE_ACCOUNT_KEY=
   ```

8. Укажите любое имя для учетной записи хранения и предоставьте 64-байтовый ключ base64. Вы можете создать ключ с помощью таких средств, как [GeneratePlus](https://generate.plus/en/base64). Вы будете использовать эти учетные данные для доступа к хранилищу BLOB-объектов из других модулей. 

9. Сохраните **.env**. 

10. Щелкните правой кнопкой мыши **deployment.template.json** и выберите **Создать манифест развертывания IoT Edge**. 

Visual Studio Code принимает данные из deployment.template.json и .env и использует их для создания файла манифеста развертывания. Манифест развертывания создается в новой папке **config** в рабочей области решения. Получив этот файл, выполните действия, описанные в разделе [Развертывание модулей Azure IoT Edge из Visual Studio Code](how-to-deploy-modules-vscode.md) или [Развертывание модулей IoT Edge Azure с помощью Azure CLI 2.0](how-to-deploy-modules-cli.md).

## <a name="connect-to-your-blob-storage-module"></a>Подключение к модулю хранилища BLOB-объектов

Вы можете использовать имя учетной записи и ключ учетной записи, настроенные для вашего модуля, для доступа к хранилищу BLOB-объектов на устройстве IoT Edge. 

Укажите устройство IoT Edge в качестве конечной точки большого двоичного объекта для любых запросов к хранилищу. Вы можете [создать строку подключения для явной конечной точки хранилища](../storage/common/storage-configure-connection-string.md#create-a-connection-string-for-an-explicit-storage-endpoint) с помощью сведений об устройстве IoT Edge и имени учетной записи. 

Конечная точка BLOB-объектов для хранилища BLOB-объектов Azure в IoT Edge — `http://<IoT Edge device hostname>:11002/<account name>`. 

## <a name="deploy-multiple-instances"></a>Развертывание нескольких экземпляров

Если вы хотите развернуть несколько экземпляров хранилища BLOB-объектов Azure в IoT Edge, необходимо просто изменить HostPort, к которому привязан модуль. Модули службы хранилища BLOB-объектов всегда предоставляют порт 11002 в контейнере, но вы можете объявить, к какому порту он привязан в узле. 

Измените параметры создания модуля, чтобы изменить значение HostPort:

```json
\"PortBindings\": {\"11002/tcp\": [{\"HostPort\":\"<port number>\"}]}
```

При подключении к дополнительным модулям хранилища BLOB-объектов измените конечную точку, чтобы она указывала на обновленный порт узла. 

### <a name="try-it-out"></a>Попробуйте сейчас

Документация по хранилищу BLOB-объектов Azure содержит краткие руководства с примерами кода на нескольких языках. Вы можете запустить эти примеры, чтобы протестировать хранилище BLOB-объектов Azure в IoT Edge путем изменения конечной точки большого двоичного объекта для указания на модуль хранилища BLOB-объектов.

В следующих кратких руководствах используются языки, которые также поддерживаются в IoT Edge, поэтому их можно развернуть как модули IoT Edge наряду с модулями хранилища BLOB-объектов:

* [.NET](../storage/blobs/storage-quickstart-blobs-dotnet.md)
* [Java](../storage/blobs/storage-quickstart-blobs-java.md)
* [Python](../storage/blobs/storage-quickstart-blobs-python.md)
* [Node.js](../storage/blobs/storage-quickstart-blobs-nodejs.md)

## <a name="supported-storage-operations"></a>Поддерживаемые операции в хранилище

Модули службы хранилища BLOB-объектов в IoT Edge используют те же пакеты SDK службы хранилища Azure и согласованы с версией 2018-03-28 API службы хранилища Azure для конечных точек блочных BLOB-объектов. Более поздние версии зависят от потребностей клиентов. 

Не все операции в хранилище BLOB-объектов Azure поддерживаются в хранилище BLOB-объектов Azure в IoT Edge. В следующих разделах подробно описывается, какие операции поддерживается, а какие — нет. 

### <a name="account"></a>Учетная запись.

Поддерживается: 
* Перечисление контейнеров

Не поддерживается: 
* Получение и задание свойств службы BLOB-объектов
* Предварительный запрос к BLOB-объектам
* Получение статистики службы BLOB-объектов
* Получение данных об учетной записи

### <a name="containers"></a>Контейнеры

Поддерживается: 
* Создание и удаление контейнера
* Получение свойств и метаданных контейнера
* Отображение списка больших двоичных объектов

Не поддерживается: 
* Получение и задание списка управления доступом для контейнера
* Аренда контейнера
* Определение метаданных контейнера

### <a name="blobs"></a>BLOB-объекты

Поддерживается: 
* Помещение, получение и удаление BLOB-объекта
* Получение и задание свойств BLOB-объекта
* Получение и задание метаданных BLOB-объекта

Не поддерживается: 
* Аренда BLOB-объекта
* Создание моментального снимка BLOB-объекта
* Копирование и прерывание копирования BLOB-объекта
* Отмена удаления BLOB-объекта
* Установка уровня BLOB-объекта

### <a name="block-blobs"></a>Blob-блоки

Поддерживается: 
* Вставка блока
* Вставка и получение списка блоков

Не поддерживается:
* Вставка блока по URL-адресу

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о [хранилище BLOB-объектов Azure](../storage/blobs/storage-blobs-introduction.md)

