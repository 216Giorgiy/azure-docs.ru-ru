---
title: Имитация Azure IoT Edge в Linux | Документация Майкрософт
description: Из этого краткого руководства вы узнаете, как удаленно развертывать готовый код на устройстве IoT Edge.
author: kgremban
manager: timlt
ms.author: kgremban
ms.date: 07/02/2018
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
ms.custom: mvc
ms.openlocfilehash: dfbe931bbe5887e9c0545558c4d2b2565718dd0a
ms.sourcegitcommit: 615403e8c5045ff6629c0433ef19e8e127fe58ac
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2018
ms.locfileid: "39578496"
---
# <a name="quickstart-deploy-your-first-iot-edge-module-to-a-linux-x64-device"></a>Краткое руководство. Развертывание первого модуля IoT Edge на устройстве под управлением 64-разрядной ОС Linux

Azure IoT Edge позволяет выполнять анализ и обработку данных на устройствах вместо того, чтобы принудительно отправлять все данные в облако. В руководствах по IoT Edge демонстрируется развертывание различных типов модулей, однако сначала вам потребуется устройство для тестирования. 

Из этого краткого руководства вы узнаете, как выполнять следующие задачи:

1. Создайте Центр Интернета вещей.
2. Регистрация устройства IoT Edge в Центре Интернета вещей.
3. Запуск среды выполнения IoT Edge.
4. Удаленное развертывание модуля на устройстве IoT Edge.

![Архитектура, используемая в руководстве][2]

В рамках этого краткого руководства компьютер или виртуальная машина Linux используются в качестве устройства IoT Edge. Вы можете развернуть модуль на портале Azure для устройства. Модуль, который вы развернете в рамках этого краткого руководства, представляет собой имитированный датчик, генерирующий данные температуры, влажности и давления. В других руководствах по Azure IoT Edge используются наработки из этой статьи: развернутые модули, которые анализируют смоделированные данные для бизнес-аналитики. 

Если у вас еще нет подписки Azure, перед началом работы [создайте бесплатную учетную запись Azure][lnk-account].

## <a name="prerequisites"></a>Предварительные требования

В этом кратком руководстве в качестве устройства IoT Edge используется компьютер Linux. Если у вас нет доступного устройства для тестирования, следуйте инструкциям в статье [Краткое руководство. Создание виртуальной машины под управлением Linux на портале Azure](../virtual-machines/linux/quick-create-portal.md). 
* Вам не нужно следовать инструкциям по установке и запуску веб-сервера. Для этого достаточно подключиться к виртуальной машине.  
* Создайте виртуальную машину в новой группе ресурсов, которую можно использовать при создании остальных ресурсов Azure в рамках этого краткого руководства. Укажите для нее узнаваемое название, например *IoTEdgeResources*. 
* Для тестирования IoT Edge не требуется очень большая виртуальная машина. Достаточно виртуальной машины размера **B1ms**. 

## <a name="create-an-iot-hub"></a>Создание Центра Интернета вещей

Начните с создания Центра Интернета вещей на портале Azure.
![Создание Центра Интернета вещей][3]

[!INCLUDE [iot-hub-create-hub](../../includes/iot-hub-create-hub.md)]

## <a name="register-an-iot-edge-device"></a>Регистрация устройства IoT Edge

Зарегистрируйте устройство IoT Edge в только что созданном Центре Интернета вещей.
![Регистрация устройства][4]

[!INCLUDE [iot-edge-register-device](../../includes/iot-edge-register-device.md)]


## <a name="install-and-start-the-iot-edge-runtime"></a>Установка и запуск среды выполнения IoT Edge

Установите и запустите среду выполнения Azure IoT Edge на устройстве. 
![Регистрация устройства][5]

Среда выполнения IoT Edge развертывается на всех устройствах IoT Edge. Она состоит из трех компонентов. **Управляющая программа безопасности IoT Edge** запускается при каждой загрузке устройства Edge и перезагружает устройство, запустив агент IoT Edge. **Агент IoT Edge** упрощает развертывание и мониторинг модулей на устройстве IoT Edge, включая центр IoT Edge. **Центр IoT Edge** управляет взаимодействием между модулями на устройстве IoT Edge, а также между устройством и Центром Интернета вещей. 

Выполните следующие действия на компьютере Linux или виртуальной машине, подготовленной для работы с этим кратким руководством. 

### <a name="register-your-device-to-use-the-software-repository"></a>Регистрация устройства для использования репозитория программного обеспечения

Пакеты, которые необходимо запускать в среде выполнения IoT Edge, управляются в репозитории программного обеспечения. Настройте устройство IoT Edge для доступа к этому репозиторию. 

Все действия, описанные в этом разделе, предназначены для устройств под управлением **Ubuntu 16.04**. Сведения о том, как получить доступ к репозиторию программного обеспечения в других версиях Linux, см. в статьях по [установке среды выполнения Azure IoT Edge в Linux (x64)](how-to-install-iot-edge-linux.md) или [установке среды выполнения Azure IoT Edge в Linux (ARM32v7/armhf)](how-to-install-iot-edge-linux-arm.md).

1. На компьютере, используемом в качестве устройства IoT Edge, установите конфигурацию репозитория.

   ```bash
   curl https://packages.microsoft.com/config/ubuntu/16.04/prod.list > ./microsoft-prod.list
   sudo cp ./microsoft-prod.list /etc/apt/sources.list.d/
   ```

2. Установите открытый ключ для доступа к репозиторию.

   ```bash
   curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
   sudo cp ./microsoft.gpg /etc/apt/trusted.gpg.d/
   ```

### <a name="install-a-container-runtime"></a>Установка среды выполнения контейнера

Среда выполнения IoT Edge — это набор контейнеров и логическое приложение, которое развертывается на устройстве IoT Edge и упаковано в контейнеры. Подготовьте устройство для этих компонентов, установив среду выполнения контейнера.

Обновите **apt-get**.

   ```bash
   sudo apt-get update
   ```

Установите среду выполнения контейнера **Moby**.

   ```bash
   sudo apt-get install moby-engine
   ```

Установите команды CLI для Moby. 

   ```bash
   sudo apt-get install moby-cli
   ```

### <a name="install-and-configure-the-iot-edge-security-daemon"></a>Установка и настройка управляющей программы безопасности IoT Edge

Управляющая программа безопасности устанавливается как системная служба, поэтому среда выполнения IoT Edge будет запускаться каждый раз при загрузке устройства. Пакет установки также включает версию **hsmlib**, позволяющую управляющей программе безопасности взаимодействовать с аппаратным модулем безопасности устройства. 

1. Загрузите и установите управляющую программу безопасности IoT Edge. 

   ```bash
   sudo apt-get update
   sudo apt-get install iotedge
   ```

2. Откройте файл конфигурации IoT Edge. Это защищенный файл, поэтому для доступа к нему нужно использовать более высокий уровень привилегий.
   
   ```bash
   sudo nano /etc/iotedge/config.yaml
   ```

3. Добавьте строку подключения устройства IoT Edge. Найдите переменную **device_connection_string** и измените ее значение с помощью строки, скопированной после регистрации устройства.

4. Сохраните и закройте файл. 

   `CTRL + X`, `Y`, `Enter`

4. Перезапустите управляющую программу безопасности IoT Edge.

   ```bash
   sudo systemctl restart iotedge
   ```

5. Убедитесь, что управляющая программа безопасности Edge выполняется как системная служба.

   ```bash
   sudo systemctl status iotedge
   ```

   ![Проверка того, выполняется ли управляющая программа Edge как системная служба](./media/quickstart-linux/iotedged-running.png)

   Можно также просмотреть журналы управляющей программы безопасности Edge, выполнив следующую команду:

   ```bash
   journalctl -u iotedge
   ```

6. Просмотрите модули, запущенные на устройстве. 

   >[!TIP]
   >Сначала необходимо использовать *sudo* для выполнения команд `iotedge`. Выйдите из системы компьютера и войдите снова, чтобы обновить разрешения. После этого можно выполнить команды `iotedge`, не используя более высокий уровень привилегий. 

   ```bash
   sudo iotedge list
   ```

   ![Просмотр данных об одном модуле на устройстве](./media/quickstart-linux/iotedge-list-1.png)

## <a name="deploy-a-module"></a>Развертывание модуля

Управляя устройством Azure IoT Edge из облака, разверните модуль, который будет передавать данные телеметрии в Центр Интернета вещей.
![Регистрация устройства][6]

[!INCLUDE [iot-edge-deploy-module](../../includes/iot-edge-deploy-module.md)]


## <a name="view-generated-data"></a>Просмотр сформированных данных

В этом руководстве мы создали новое устройство IoT Edge и установили на нем среду выполнения IoT Edge. Затем с помощью портала Azure мы отправили на устройство и запустили модуль IoT Edge, не изменяя на устройстве никаких настроек. В этом примере отправленный модуль создает данные среды, которые можно использовать для работы с руководствами. 

Еще раз откройте командную строку на компьютере, на котором работает имитированное устройство. Убедитесь, что развернутый из облака модуль работает на вашем устройстве IoT Edge.

   ```bash
   sudo iotedge list
   ```

   ![Просмотр трех модулей на устройстве](./media/quickstart-linux/iotedge-list-2.png)

Убедитесь, что сообщения отправляются из модуля tempSensor.

  ```bash
   sudo iotedge logs tempSensor -f 
   ```

Когда вы выйдете из системы и войдете в нее, *sudo* больше не потребуется для приведенной выше команды.

![Просмотр получаемых с модуля данных](./media/quickstart-linux/iotedge-logs.png)

Модуль датчика температуры может ожидать подключения к центру Edge, если последней строкой в журнале оказывается `Using transport Mqtt_Tcp_Only`. Попробуйте завершить модуль, и пусть агент Edge перезапустит его. Для завершения можно воспользоваться командой `sudo docker stop tempSensor`.

Данные телеметрии, которые передает устройство, можно также просматривать с помощью [расширения Azure IoT Toolkit для Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-toolkit). 

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы хотите продолжить ознакомление с руководствами по IoT Edge, используйте устройство, зарегистрированное и настроенное в рамках этого краткого руководства. В противном случае можно удалить с устройства созданные ресурсы Azure и среду выполнения IoT Edge. 

### <a name="delete-azure-resources"></a>Удаление ресурсов Azure

Если вы создали виртуальную машину и Центр Интернета вещей в новой группе ресурсов, можно удалить эту группу и все связанные с ней ресурсы. Если в группе ресурсов, которую необходимо удалить, имеются важные данные, можно удалить только ненужные ресурсы. 

Чтобы удалить группу ресурсов, сделайте следующее. 

1. Войдите на [портал Azure](https://portal.azure.com) и щелкните **Группы ресурсов**.
2. Введите в текстовое поле **Фильтровать по имени...** имя группы ресурсов, содержащей Центр Интернета вещей. 
3. Справа от своей группы ресурсов в списке результатов щелкните **...**, а затем выберите **Удалить группу ресурсов**.
4. Подтвердите операцию удаления группы ресурсов. Еще раз введите имя группы ресурсов для подтверждения и нажмите кнопку **Удалить**. Через некоторое время группа ресурсов и все ее ресурсы будут удалены.

### <a name="remove-the-iot-edge-runtime"></a>Удаление среды выполнения IoT Edge

Чтобы удалить файлы установки с устройства, используйте приведенные ниже команды.  

Удалите среду выполнения IoT Edge.

   ```bash
   sudo apt-get remove --purge iotedge
   ```

При удалении среды выполнения IoT Edge созданные с ее помощью контейнеры остановятся, но будут по-прежнему храниться на устройстве. Просмотрите все контейнеры.

   ```bash
   sudo docker ps -a
   ```

Удалите контейнеры, созданные на устройстве средой выполнения IoT Edge. Измените имя контейнера tempSensor, если вы указали для него другое имя. 

   ```bash
   sudo docker rm -f tempSensor
   sudo docker rm -f edgeHub
   sudo docker rm -f edgeAgent
   ```

Удалите среду выполнения контейнера.

   ```bash
   sudo apt-get remove --purge moby
   ```

## <a name="next-steps"></a>Дополнительная информация

При работе с этим кратким руководством вы создали устройство IoT Edge и с помощью облачного интерфейса Azure IoT Edge развернули код на устройстве. В итоге мы получили имитированное устройство, генерирующее необработанные данные о своей среде. 

Изучение этого этим краткого руководства обязательно для дальнейшей работы со всеми остальными руководствами по IoT Edge. Вы можете перейти к любому из руководств, чтобы узнать, как Azure IoT Edge может помочь вам превратить данные в бизнес-аналитику на пограничном устройстве.

> [!div class="nextstepaction"]
> [Фильтрация данных датчика с помощью Функций Azure](tutorial-deploy-function.md)


<!-- Images -->
[1]: ./media/quickstart-linux/view-module.png
[2]: ./media/quickstart-linux/install-edge-full.png
[3]: ./media/quickstart-linux/create-iot-hub.png
[4]: ./media/quickstart-linux/register-device.png
[5]: ./media/quickstart-linux/start-runtime.png
[6]: ./media/quickstart-linux/deploy-module.png
[7]: ./media/quickstart-linux/iotedged-running.png
[8]: ./media/tutorial-simulate-device-linux/running-modules.png
[9]: ./media/tutorial-simulate-device-linux/sensor-data.png

<!-- Links -->
[lnk-account]: https://azure.microsoft.com/free
[lnk-docker-ubuntu]: https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/ 
