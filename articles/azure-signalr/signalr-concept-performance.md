---
title: Руководства по повышению производительности для службы Azure SignalR
description: Обзор производительности служба Azure SignalR.
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: zhshang
ms.openlocfilehash: 53139dd253c491ea6578fd0b9cbada4e7b331c7d
ms.sourcegitcommit: 1a19a5845ae5d9f5752b4c905a43bf959a60eb9d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/11/2019
ms.locfileid: "59502043"
---
# <a name="performance-guide-for-azure-signalr-service"></a>Руководства по повышению производительности для службы Azure SignalR

Одно из основных преимуществ использования службы Azure SignalR является простота масштабирования приложений SignalR. В случае крупномасштабных производительности становится важным фактором. В этом руководстве вы узнаете, факторы, которые имеют влияние на производительность приложения SignalR и в разделе различных сценариев использования, что является обычной производительностью? В конце концов мы также занимают среды и средства, используемые для создания отчета о производительности.

## <a name="terms-definition"></a>Определение терминов

*ASRS*: Служба SignalR Azure

*Входящие*: входящее сообщение, чтобы служба Azure SignalR

*Исходящие*: исходящего сообщения из SignalR службы Azure

*Пропускная способность*: общий размер всех сообщений в секунду

*Режим по умолчанию*: ASRS ожидает сервера приложений, чтобы установить соединение с ним, прежде чем принимать подключения клиентов. Это режим по умолчанию при создании ASRS.

*Режим без сервера*: ASRS принимает только подключения клиентов. Допускается нет соединения с сервером.

## <a name="overview"></a>Обзор

ASRS определяет семь стандартных уровней для емкостей производительности, а в этом руководстве планирует ответить на следующие вопросы:

-   Что такое обычной производительностью ASRS для каждого уровня?

-   ASRS соответствует моей требование скорость обработки сообщений, например, 100 000 сообщений в секунду?

-   Для моей конкретного сценария, какой уровень подходит для меня? Или, как можно выбрать правильный уровень?

-   Какого рода сервера приложений (размер виртуальной Машины) подходит для меня, и сколько из них должен развернуть?

Чтобы ответить на эти вопросы, в этом руководстве производительности сначала предоставляет высокоуровневый описание факторов, которые оказывают влияние на производительность, а затем демонстрируется максимальное количество входящих и исходящих сообщений для каждого уровня для типичные случаи использования: **echo**, **вещания**, **группа отправки**, и **подключение для отправки** (одноранговая беседы).

Это невозможно для этого документа охватить все сценарии (и различных вариантах использования, размер сообщений или шаблон отправку сообщений и т.д.). Тем не менее он предоставляет некоторые методы оценки, чтобы помочь пользователям приблизительно оценить свои требования входящие или исходящие сообщения, а затем найти соответствующие уровни, проверяя таблицу производительности.

## <a name="performance-insight"></a>Анализ производительности

В этом разделе описаны методики оценки производительности, а затем список всех факторов, которые оказывают влияние на производительность. В конечном счете он предоставляет методы для оценки требований к производительности.

### <a name="methodology"></a>Методика

**Пропускная способность** и **задержки** два типичных аспекта проверки производительности. Для ASRS другой уровень SKU имеет разные уровни пропускной способности в политике регулирования. Этот документ описывает **максимально допустимая пропускная способность (полоса пропускания входящего и исходящего)** как максимальный совокупный результат пропускной способности сообщений для 99% иметь задержку менее 1 секунды.

Задержка — это интервал времени из подключения, передающего сообщения с получением сообщения-ответа от ASRS. Давайте **echo** в качестве примера каждое соединение клиент добавляет метку времени в сообщении. На сервере приложений центр отправляет исходное сообщение обратно клиенту. Поэтому задержки распространения легко вычисляется путем каждое подключение клиента. Отметка времени подключен для каждого сообщения в **вещания**, **группа отправки**, и **подключение для отправки**.

Чтобы смоделировать тысячи параллельных клиентов подключений, несколько виртуальных машин создаются в виртуальной частной сети в Azure. Все эти виртуальные машины подключитесь к тому же экземпляру ASRS.

В режиме по умолчанию ASRS сервера приложений виртуальные машины будут развернуты в одной виртуальной частной сети как виртуальных машин клиента.

Все виртуальные машины клиента и сервера приложений что виртуальные машины развертываются в той же сети, в одном регионе, во избежание кросс-задержки в регионе.

### <a name="performance-factors"></a>Факторы производительности

Теоретически ASRS емкость ограничена вычислительные ресурсы: ЦП, памяти и сети. Например несколько подключений к ASRS дополнительные памяти ASRS под. Для больших сообщений трафика например, каждое сообщение, размер которых превышает 2048 байт, необходимо ASRS тратить больше циклов ЦП для обработки также. В то же время пропускной способности сети Azure также налагает ограничение для максимального трафика.

Тип транспорта, [WebSocket](https://en.wikipedia.org/wiki/WebSocket), [отправленных событий сервера](https://en.wikipedia.org/wiki/Server-sent_events), или [продолжительным опросом](https://en.wikipedia.org/wiki/Push_technology), является другой фактор влияет на производительность. WebSocket — это протокол двустороннего и дуплексная связь через одно подключение TCP. Тем не менее отправленных событий сервера — протокол Однонаправленная Push-сообщения от сервера клиенту. Продолжительным опросом требует клиентами для периодического опроса сведения с сервера через HTTP-запроса. Тот же API, в то же условие WebSocket характеризуется более высокой производительностью, отправленных событий сервера занимает больше времени и продолжительным опросом является самым медленным. ASRS рекомендует WebSocket по умолчанию.

Кроме того стоимость маршрутизации сообщений также ограничивает производительность. ASRS играет роль как маршрутизатор сообщение, которое направляет сообщения из набора клиентов или серверов в других клиентов или серверов. Другой сценарий или API требует другую политику маршрутизации. Для **echo**, клиент отправляет сообщение на себя и назначения маршрутизации также сам является. Этот шаблон имеет наименьшую стоимость. Но для **вещания**, **группа отправки**, **подключение для отправки**, ASRS требуется найти целевые соединения через структуру внутренней распределенных данных, которой потребляет больше ресурсов ЦП, памяти и даже пропускной способности сети. В результате производительность выполняется медленнее, чем **echo**.

В режиме по умолчанию так как пакет SDK для Azure SignalR для вызова концентратора, между тем, он поддерживает активное соединение с любого клиента через сигналы пульса сервера приложений может стать узким местом для определенных сценариев.

В режиме без сервера клиент отправляет сообщение с помощью HTTP post, который не является настолько эффективна, насколько WebSocket.

Еще одним фактором является протокол: JSON и [MessagePack](https://msgpack.org/index.html). MessagePack меньшими по размеру и доставляться быстрее, чем JSON. Интуитивно MessagePack получают преимущества производительности, но ASRS производительности не является конфиденциальным с протоколами, так как не удается декодировать полезных данных сообщения во время пересылки сообщений от клиентов на серверах или наоборот.

Таким образом следующие факторы задействована мощности входящего и исходящего трафика:

-   Уровень SKU (ЦП и памяти)

-   количества подключений;

-   Размер сообщения

-   скорость отправки сообщений

-   Тип транспорта (WebSocket/сервера-отправлено-событие/продолжительным опросом)

-   сценарий (Цена маршрутной) использования

-   подключения сервера и службы приложений (в режиме сервера)


### <a name="find-a-proper-sku"></a>Найти правильный номер SKU

Как оценить входящие и исходящие емкости или как найти какой уровень подходит для конкретного сценария использования?

Мы предполагаем, сервера приложений обладает достаточными возможностями и не является узким местом производительности. Затем можно проверить максимальную пропускную способность входящего и исходящего трафика для каждого уровня.

#### <a name="quick-evaluation"></a>Краткий обзор

Давайте упростим оценки сначала, предполагая, что некоторые параметры по умолчанию: WebSocket, размер сообщения составляет 2048 байт, отправка сообщения каждую секунду и используется по умолчанию является режимом.

Каждый уровень имеет свои собственные максимальную пропускную способность для входящих и исходящей пропускной способности. Для удобства пользователей не гарантируется после входящего или исходящего трафика превышает предел.

**Echo** предоставляет максимальную пропускную способность для входящих, так как он имеет наименьшую стоимость. **Рассылка** определяет пропускную способность исходящего сообщения.

Сделать **не** превышать выделенные значения в следующих двух таблицах.

|       echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения                       | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| **Входящий пропускная способность (байт/с)** | **2 МБ**    | **4 МИН**    | **10 МЛН**   | **20 МЛН**    | **40 М**    | **100 МЛН СТРОК**   | **200 МБ**    |
| Исходящие пропускная способность (байт/с) | 2 МБ    | 4 МИН    | 10 МЛН   | 20 МЛН    | 40 М    | 100 МЛН СТРОК   | 200 МБ    |


|     Трансляция             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящий пропускная способность (байт/с)  | 4K    | 4K    | 4K     | 4K     | 4K     | 4K      | 4K     |
| **Исходящие пропускная способность (байт/с)** | **4 МИН**    | **8M**    | **20 МЛН**    | **40 М**    | **80 МБ**    | **200 МБ**    | **400 МБ**   |

Входящей пропускной способности и пропускной способности исходящего канала формулы:
```
  inboundBandwidth = inboundConnections * messageSize / sendInterval
  outboundBandwidth = outboundConnections * messageSize / sendInterval
```

*inboundConnections*: количество подключений, отправка сообщения

*outboundConnections*: количество подключений, получения сообщения

*messageSize*: размер одного сообщения (среднее значение). Для небольших сообщение, размер которого меньше 1024 байта она содержит аналогичные влияние на производительность как сообщение 1024 байтов.

*sendInterval*: время отправки одного сообщения, обычно он составляет 1 секунду каждого сообщения, значит, отправка одного сообщения каждую секунду. Меньше sendInterval означает, что отправка дополнительные сообщения заданный период времени. Например 0,5 секунд на каждое сообщение означает, что отправкой двух сообщений каждую секунду.

*Подключения* является ASRS зафиксированных максимальное пороговое значение для каждого уровня. Если дальнейшей увеличивается номер соединения, он будет испытывать после подключения регулирования.

*Полоса пропускания для входящих* и *пропускной способности исходящего канала* являются общим размером сообщения в секунду. Здесь меня "означает мегабайт для простоты.

#### <a name="evaluation-for-complex-use-cases"></a>Ознакомительная версия для вариантов использования сложных

##### <a name="bigger-message-size-or-different-sending-rate"></a>Чем больше размер сообщения или различные скорости отправки

Реальный вариант использования более сложен. Он может отправить сообщение размером более 2048 байт или скорость отправки сообщений является не одно сообщение в секунду. Давайте вещания unit100 например о том, как можно оценить его производительность.

В следующей таблице показаны действительный случай **вещания**, но размер сообщения, число соединений и частота, отправляющим сообщения, отличаются от предполагается в предыдущем разделе. Вопрос состоит в том, как мы можем предположить, любого из этих элементов (размер сообщения, число соединений или скорость отправки сообщений), если известно только 2 из них.

| Трансляция  | Размер сообщения (в байтах) | Входящие (сообщения в секунду) | Подключения | Отправить интервалы (в секунду) |
|---|---------------------|--------------------------|-------------|-------------------------|
| 1 | 20 ТЫСЯЧ                 | 1                        | 100 000     | 5                       |
| 2 | 256 КБ                | 1                        | 8000       | 5                       |

Следующая формула является легко быть выведен на основании указанной выше формуле существующего:

```
outboundConnections = outboundBandwidth * sendInterval / messageSize
```

Для unit100, мы знаем, максимальная полоса пропускания исходящих — 400 МБ из предыдущей таблицы, а затем для размера сообщения 20 КБ, максимальное число исходящих подключений должно быть 400 млн \* 5 / 20 КБ = 100 000, удовлетворяющее значения.

##### <a name="mixed-use-cases"></a>Варианты использования смешанных

Реальный вариант использования обычно содержатся одновременно четыре основные варианты друг с другом: **echo**, **вещания**, **отправки группу**, или **отправку подключения**. Метод, используемый для оценки емкости состоит в разделении варианты использования смешанных в четырех случаях базовое использование **рассчитать пропускную способность максимальное входящие и исходящие сообщения** отдельно с помощью формул выше и суммировать их, чтобы получить общее Максимальная пропускная способность, входящие и Исходящие. Затем выберите правильный уровень из таблиц максимальной пропускной способности для входящего и исходящего.

В то же время для отправки сообщения на сотни или тысячи небольших групп и тысяч клиентов, отправка сообщения друг с другом, Цена маршрутной станет главным. Влияние этой конфигурации следует принимать во внимание. Дополнительные подробности описаны в следующих разделах «Исследование».

В случае использования отправки сообщения клиентам, убедитесь, что сервер приложений **не** узкое место. Раздел «Исследование» дает рекомендации, какое множество серверов приложений требуется и сколько подключений сервера должны быть настроены.

## <a name="case-study"></a>Пример использования

В следующих разделах описываются через четыре типичные случаи использования для транспорта WebSocket: **echo**, **вещания**, **группа отправки**, и **подключение для отправки** . Для каждого сценария показываются текущее ASRS входящие и исходящие емкость, в то же время объясняется, что такое основные факторы, на производительность.

По умолчанию режим сервера приложений через пакет SDK службы Azure SignalR по умолчанию создает пять подключений к серверу с ASRS. На панели тестов производительности ниже, результата сервер подключений увеличивается до 15 (или более для вещания и отправить сообщение для большой группы).

Разные варианты использования имеют различные требования на серверы приложений. **Рассылка** требуется небольшое количество серверов приложений. **Echo** или **подключение для отправки** должен многие серверы приложений.

Во всех вариантов использования, по умолчанию размер сообщения составляет 2048 байт и интервал отправки сообщения составляет 1 секунду.

## <a name="default-mode"></a>Режим по умолчанию

Клиенты, серверы веб-приложений и ASRS участвуют в этом режиме. Каждый клиент — это одно подключение.

### <a name="echo"></a>echo

Во-первых веб-приложения подключиться к ASRS. Во-вторых, многие клиенты подключаются к веб-приложения, которые перенаправлением клиентов для ASRS с конечной точки и маркером доступа. Затем клиенты устанавливают соединения WebSocket с ASRS.

После подключения всех клиентов, они приступить к отправке сообщения, которое содержит метку времени определенным центром каждую секунду. Концентратор возвращает пользователю сообщение обратно к его исходному клиенту. Каждый клиент вычисляет время задержки при получении сообщения проверки связи обратно.

Шаги 5\~8 (красный выделенный трафик) находятся в цикл, который будет выполняться в течение времени по умолчанию (5 минут) и получить статистику всех задержка сообщений.
Руководства по повышению производительности показывает максимальный номер соединения клиента.

![echo](./media/signalr-concept-performance/echo.png)

**Echo**поведение определяет, равен что максимальной пропускной способности для входящего трафика максимальную пропускную способность исходящего трафика. См. в следующей таблице.

|       echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения                       | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Входящий/исходящий (сообщения в секунду) | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Пропускная способность входящих и исходящих (байт/с) | 2 МБ    | 4 МИН    | 10 МЛН   | 20 МЛН    | 40 М    | 100 МЛН СТРОК   | 200 МБ    |

В этом случае каждый клиент вызывает концентратору, описанному в сервера приложений. Концентратор, просто вызывает метод, определенный на исходной стороне клиента. Этот центр является наиболее светлой взвешенная концентратор для **echo**.

```
        public void Echo(IDictionary<string, object> data)
        {
            Clients.Client(Context.ConnectionId).SendAsync("RecordLatency", data);
        }
```

Даже для этого простого концентратора нагрузку трафика на сервер приложений также известных как **echo** входящих сообщений увеличивается. Поэтому многие серверы приложений требуется для больших уровней SKU. В следующей таблице перечислены числа серверов приложений для каждого уровня.


|    echo          | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
>
> Клиент подключения number, размер сообщения, скорость, уровень SKU и на сервере приложений ЦП и памяти, отправляющим сообщения, оказывают влияние на общую производительность **echo**.

### <a name="broadcast"></a>Трансляция

Для **вещания**, когда веб-приложение получает сообщение, она рассылает всем клиентам. Чем больше клиентов для передачи, больше трафика сообщений для всех клиентов. См. в следующей схеме.

![Трансляция](./media/signalr-concept-performance/broadcast.png)

Характеристика вещания — что существует небольшое количество клиентов широковещательной рассылки, это означает, что пропускная способность входящих сообщений, small, но огромен исходящей пропускной способности. Увеличивает пропускную способность исходящего сообщения как клиентского соединения или увеличивает частота широковещательных пакетов.

Максимальное число клиентских подключений, число входящих и исходящих сообщений и пропускной способности перечислены в следующей таблице.

|     Трансляция             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящие (сообщения в секунду)  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| Исходящие (сообщения в секунду) | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200 000 |
| Входящий пропускная способность (байт/с)  | 4K    | 4K    | 4K     | 4K     | 4K     | 4K      | 4K      |
| Исходящие пропускная способность (байт/с) | 4 МИН    | 8M    | 20 МЛН    | 40 М    | 80 МБ    | 200 МБ    | 400 МБ    |

Клиенты широковещательной рассылки, отправлять сообщения — не более чем 4, поэтому требуется меньшее количество серверов приложений, по сравнению с **echo** так, как небольшой объем входящего сообщения. Два сервера приложений являются достаточно для рассмотрения соглашение об уровне ОБСЛУЖИВАНИЯ и производительности. Но подключения сервера по умолчанию должно быть увеличено во избежание несбалансированное проблемы, особенно для Unit50 и Unit100.

|   Трансляция      | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
>
> Увеличьте подключения сервера по умолчанию от 5 до 40, на каждом сервере приложений, чтобы избежать возможных несбалансированное подключений к ASRS.
>
> Номер соединения клиента, размер сообщения, скорость отправки сообщений и уровень SKU оказать влияние на общую производительность для **вещания**

### <a name="send-to-group"></a>Отправить в группу

**Группа отправки** имеет аналогичную схему трафика, за исключением того, что после установления подключения WebSocket с ASRS клиентов, они должны присоединить группы перед отправкой сообщения для определенной группы. Поток трафика проиллюстрирован на следующей схеме.

![Отправить группе](./media/signalr-concept-performance/sendtogroup.png)

Число групп и элементов группы являются факторами влияния на производительность. Чтобы упростить анализ, мы определим два типа групп: небольших и больших групп.

- `small group`: 10 соединений в каждой группе. Номер группы равен (max подключения count) / 10. Например, для 1 единицы, если 1000 применяется ограничение на число соединений, у нас есть 1000 / 10 = 100 групп.

- `Big group`: Номер группы всегда равно 10. Число участников группы равен (max подключения count) / 10. К примеру, для 1 единицы, если 1000 применяется ограничение на число соединений, то каждая группа имеет 1000 / 10 = 100 членов.

**Группа отправки** привносит Цена маршрутной ASRS, так как он должен найти целевые соединения в структуре распределенных данных. По мере отправки подключений увеличить, стоимость увеличивается также.

#### <a name="small-group"></a>Небольшая группа

Цена маршрутной важен для отправки сообщения в несколько небольших групп. В настоящее время реализации ASRS достигает предельное значение стоимости маршрутизации в unit50. Добавив дополнительные ЦП и памяти не помогают, поэтому не может улучшить unit100 дальнейшего намеренно. Если вам требуется более входящей пропускной способности, обратитесь в службу поддержки для настройки.

|   Отправить небольшой группе     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50 | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|--------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000 | 100 000
| Число участников группы        | 10    | 10    | 10     | 10     | 10     | 10     | 10 
| Количество групп               | 100   | 200   | 500    | 1000  | 2 000  | 5 000  | 10 000 
| Входящие (сообщения в секунду)  | 200   | 400   | 1000  | 2500  | 4000  | 7000  | 7000   |
| Входящий пропускная способность (байт/с)  | 400 КБ  | 800 КБ  | 2 МБ     | 5M     | 8M     | 14 МИН    | 14 МИН     |
| Исходящие (сообщения в секунду) | 2 000 | 4000 | 10 000 | 25 000 | 40 000 | 70,000 | 70,000  |
| Исходящие пропускная способность (байт/с) | 4 МИН    | 8M    | 20 МЛН    | 50 МЛН     | 80 МБ    | 140M   | 140M    |

Существует множество клиентских подключений, вызова концентратора, таким образом, номер сервера приложений, также является критически важным для производительности. В следующей таблице указывается число предлагаемых приложения сервера.

|  Отправить небольшой группе   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
>
> Номер подключения клиента, размер сообщения, скорости отправки сообщения, Цена маршрутной, уровень SKU и на сервере приложений ЦП и памяти оказать влияние на общую производительность **отправки малого группы**.

#### <a name="big-group"></a>Большие группы

Для **send больших group**, пропускной способности исходящего канала станет узким местом, перед попадание маршрутизацию затрат ограничение. В следующей таблице перечислены максимальное исходящей пропускной способности, которая практически не отличается от как **вещания**.

|    Отправить большой группе      | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000
| Число участников группы        | 100   | 200   | 500    | 1000  | 2 000  | 5 000   | 10 000 
| Количество групп               | 10    | 10    | 10     | 10     | 10     | 10      | 10
| Входящие (сообщения в секунду)  | 20    | 20    | 20     | 20     | 20     | 20      | 20      |
| Входящий пропускная способность (байт/с)  | 80 КБ   | 40 КБ   | 40 КБ    | 20 ТЫСЯЧ    | 40 КБ    | 40 КБ     | 40 КБ     |
| Исходящие (сообщения в секунду) | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200 000 |
| Исходящие пропускная способность (байт/с) | 8M    | 8M    | 20 МЛН    | 40 М    | 80 МБ    | 200 МБ    | 400 МБ    |

Отправку количество подключений — не более чем 40, нагрузку на сервер приложений имеет небольшой размер, таким образом номер предлагаемые веб также небольшой.

|  Отправить большой группе  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
>
> Увеличьте подключения сервера по умолчанию от 5 до 40, на каждом сервере приложений, чтобы избежать возможных несбалансированное подключений к ASRS.
> 
> Номер соединения клиента, размер сообщения, скорости отправки сообщения, Цена маршрутной и уровень SKU оказать влияние на общую производительность **send больших group**.

### <a name="send-to-connection"></a>Отправить подключения

В этом случае при клиенты устанавливают соединения с ASRS, каждый клиент вызывает специальный концентратора для получения идентификатора собственные подключения. В тесте производительности отвечает для сбора всех идентификаторов подключений, shuffle их и переназначьте их ко всем клиентам, отправляющим целевого объекта. Клиенты отправлять сообщения для подключения к целевой до завершения теста производительности.

![Отправлять клиенту](./media/signalr-concept-performance/sendtoclient.png)

Маршрутизация затрат для **подключение для отправки** аналогичен **отправки малого группы**.

По мере увеличения числа подключений общую производительность ограничивается маршрутизации затрат. 50 модульных достигнут предел. Таким образом не может улучшить 100 единицы.

В следующей таблице приводится сводка статистику после многоэтапной выполнение **подключение для отправки** теста производительности

|   Отправить подключения   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50          | Unit100         |
|------------------------------------|-------|-------|-------|--------|--------|-----------------|-----------------|
| Подключения                        | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000          | 100 000         |
| Входящих и исходящих (сообщения в секунду) | 1000 | 2 000 | 5 000 | 8000  | 9000  | 20 000 | 20 000 |
| Входящих и исходящих пропускная способность (байт/с) | 2 МБ    | 4 МИН    | 10 МЛН   | 16M    | 18 МИН    | 40 М       | 40 М       |

Этот вариант использования требует высокой нагрузки на стороне сервера приложения. См. в разделе сервера приложений, предлагаемых подсчета в следующей таблице.

|  Отправить подключения  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
>
> Номер подключения клиента, размер сообщения, скорости отправки сообщения, Цена маршрутной, уровень SKU и на сервере приложений ЦП и памяти оказать влияние на общую производительность **подключение для отправки**.

### <a name="aspnet-signalr-echobroadcastsend-to-connection"></a>ASP.NET SignalR echo/вещания или отправки для подключения

ASRS предоставляет такие же возможности производительности для ASP.NET SignalR. В этом разделе приводится число предлагаемых web app для ASP.NET SignalR **echo**, **вещания**, и **отправки малого группы**.

Тест производительности использует веб-приложения Azure из [стандартный S3 план службы](https://azure.microsoft.com/pricing/details/app-service/windows/) для ASP.NET SignalR.

- `echo`

|   echo           | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 4.     | 4.      | 8      | 32      | 40       |

- `broadcast`

|  Трансляция       | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

- `Send-to-small-group`

|  Отправить небольшой группе     | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 4.     | 4.      | 8      | 32      | 40       |

## <a name="serverless-mode"></a>Режим без сервера

Клиенты и ASRS участвуют в этом режиме. Каждый клиент — это одно подключение. Клиент отправляет сообщения с помощью REST API для другого клиента или широковещательной передачи сообщений, ко всем.

Отправка сообщений с высокой плотностью через REST API не так эффективно, как веб-сокет, так как он требуется для создания нового подключения HTTP каждый раз - дополнительная плата за в режиме без сервера.

### <a name="broadcast-through-rest-api"></a>Рассылка по REST API
Все клиенты устанавливают соединения WebSocket с ASRS. Некоторые клиенты запустите широковещательной рассылки с помощью REST API. Сообщения, отправкой (входящий трафик) — все это HTTP-Post, который не является эффективным по сравнению с WebSocket.

|   Рассылка по REST API     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящие (сообщения в секунду)  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| Исходящие (сообщения в секунду) | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200 000 |
| Входящий пропускная способность (байт/с)  | 4K    | 4K    | 4K     | 4K     | 4K     | 4K      | 4K      |
| Исходящие пропускная способность (байт/с) | 4 МИН    | 8M    | 20 МЛН    | 40 М    | 80 МБ    | 200 МБ    | 400 МБ    |

### <a name="send-to-user-through-rest-api"></a>Отправить пользователю через REST API
Тест производительности назначает имена пользователей для всех клиентов, до их запуска, подключении к ASRS. После установления подключения WebSocket с ASRS клиентов они приступить к отправке сообщений через HTTP Post.

|   Отправить пользователю через REST API | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящие (сообщения в секунду)  | 300   | 600   | 900    | 1,300  | 2 000  | 10 000  | 18,000  |
| Исходящие (сообщения в секунду) | 300   | 600   | 900    | 1,300  | 2 000  | 10 000  | 18,000 |
| Входящий пропускная способность (байт/с)  | 600 КБ  | 1.2 M  | 1.8 M   | 2.6 M   | 4 МИН     | 10 МЛН     | 36M    |
| Исходящие пропускная способность (байт/с) | 600 КБ  | 1.2 M  | 1.8 M   | 2.6 M   | 4 МИН     | 10 МЛН     | 36M    |

## <a name="performance-test-environments"></a>Среды для тестирования производительности

Тест производительности для всех перечисленных выше случаев проведенных в среде Azure. На большинстве виртуальных машин 50 клиента и 20 сервера приложений используются виртуальные машины.

Размер виртуальной Машины клиента: StandardDS2V2 (2 виртуальных ЦП, память 7G)

Размер виртуальной Машины сервера приложений: StandardF4sV2 (4 виртуальных ЦП, памяти 8G)

Подключения сервера Azure SignalR SDK: 15

## <a name="performance-tools"></a>Средства повышения производительности

https://github.com/Azure/azure-signalr-bench/tree/master/SignalRServiceBenchmarkPlugin

## <a name="next-steps"></a>Дальнейшие действия

В этой статье вы получите Общие сведения о производительности службы SignalR в типичных ситуациях.

Чтобы получить дополнительные сведения о внутренних компонентов службы SignalR и масштабирования для службы SignalR, прочтите следующую структуру.

* [Внутренние компоненты служба Azure SignalR](signalr-concept-internals.md)
* [Служба Azure SignalR масштабирование](signalr-howto-scale-multi-instances.md)