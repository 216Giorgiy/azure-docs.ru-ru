<properties linkid="manage-linux-common-tasks-manage-certs" urlDisplayName="Управление сертификатами" pageTitle="Управление сертификатами для виртуальных машин Linux в Azure" metaKeywords="управление сертификатами Azure, передача сертификатов управления, API управления службой Azure" description="Узнайте, как создавать и передавать сертификаты управления для Linux в Azure. Сертификат необходим при использовании API-интерфейса управления службой." metaCanonical="" services="virtual-machines" documentationCenter="" title="Создание сертификатов управления для Linux в Azure" authors="kathydav" solutions="" manager="jeffreyg" editor="tysonn" />





#Создание сертификатов управления для Linux в Azure

Сертификат управления необходим, если вы собираетесь использовать API-интерфейс управления службой для взаимодействия с платформой образов Azure. 

На сайте [http://msdn.microsoft.com/ru-ru/library/windowsazure/gg551721.aspx](http://msdn.microsoft.com/ru-ru/library/windowsazure/gg551721.aspx) представлена документация о способах создания этих сертификатов и управления ими. Можно также использовать OpenSSL для создания сертификата управления.  Дополнительные сведения см. на сайте [OpenSSL](http://openssl.org/). Однако в этой документации основное внимание уделяется использованию портала Silverlight, который может быть доступен не всем пользователям Linux. В ней рассказывается, как можно получить доступ к этим сертификатам и интегрировать их с другими средствами и партнерами, а также использовать их самостоятельно, пока эта функция не будет добавлена на портал управления Azure. 


##Оглавление##

* [Получение сертификата управления из файла publishsettings](#createcert)
* [Установка сертификата управления с помощью портала управления Azure](#management)

<h2><a id="publishsettings"></a>Практическое руководство. Создание и передача сертификата управления</h2>


Мы предлагаем простой способ создания сертификата управления для Azure по следующему адресу: [https://windows.azure.com/download/publishprofile.aspx](https://windows.azure.com/download/publishprofile.aspx).

На этот веб-сайт потребуется войти с использованием учетных данных портала, а затем создать сертификат управления, поставляемый вместе с вашим идентификатором подписки в файле publishsettings, который вам будет предложено загрузить. 

![linuxcredentials](./media/linux-create-management-cert/linuxcredentials.png)

Обязательно сохраните этот файл в безопасном месте, поскольку вы не сможете его восстановить и будете вынуждены создать новый сертификат управления. (Общее количество сертификатов, которые можно использовать в системе, ограничено. Чтобы убедиться в этом, см. соответствующий раздел на веб-сайте.) Затем вы можете использовать сертификат разными способами.

###В Visual Studio###

![VSpublish](./media/linux-create-management-cert/VSpublish.png)


###В командной строке Azure для Linux.###

Вы можете импортировать сертификат, чтобы использовать его с помощью команды импорта учетной записи Azure:

![cmdlinepublish](./media/linux-create-management-cert/cmdlinepublish.png)

Если вам потребуется это средство при работе с другим партнером или программным обеспечением, вы должны будете извлечь сертификат управления из самого файла и декодировать его из Base 64. Некоторые партнеры, например ScaleXtreme и SUSE Studio, будут использовать файл непосредственно в его текущей форме. 

Чтобы извлечь сертификат управления, необходимо выполнить описанную здесь процедуру.

Необходимо извлечь из файла содержимое в кодировке base 64, расположенное между кавычками после ManagementCertificate.

	?xml version="1.0" encoding="utf-8"?>
	<PublishData>
	  <PublishProfile
	    PublishMethod="AzureServiceManagementAPI"
	    Url="https://management.core.windows.net/"
	    ManagementCertificate="xxxxx">
	    <Subscription
	      Id="8a4a0a51-728e-482e-8daa-c477f03c541d"
	      Name="hjereztest" />
	  </PublishProfile>
	</PublishData>
	
Необходимо скопировать это содержимое в файл, а затем декодировать его, используя декодер base 64 в Linux.

	Base64 -d [encodedfile] > [decodedfile].pfx

При этом вы получите PFX-файл, который можно преобразовать в другие форматы, используя при необходимости openssl для извлечения закрытого ключа.

 	openssl.exe pkcs12 -in publicAndprivate.pfx -nocerts -out privateKey.pem 

В Windows можно декодировать и извлечь PFX-файл с помощью powershell или бесплатного декодера windows base 64, например [http://www.fourmilab.ch/webtools/base64/base64.zip](http://www.fourmilab.ch/webtools/base64/base64.zip), выполнив команду: 

	base64 -d key.txt ->key.pfx

####Ограничение на создание сертификатов####

Количество сертификатов, которые вы можете создать на платформе с помощью этого средства, ограничено до 10.
К сожалению, не существует способа восстановления созданных ключей после их создания, поскольку мы не храним эти закрытые ключи в системе.
При достижении ограничения на количество сертификатов в системе необходимо обратиться в службу поддержки через форумы Azure, чтобы удалить ваши сертификаты, или использовать браузер, который может отображать старый портал Silverlight для выполнения этих задач.

####Если ваш закрытый ключ взломан ####

В случае взлома закрытого ключа необходимо с помощью браузера, поддерживающего Silverlight, зайти на старый портал и удалить соответствующие сертификаты управления в файле или обратиться в службу поддержки через форумы.  
Создания новых сертификатов недостаточно, поскольку все 10 сертификатов действительны и старый взломанный ключ по-прежнему может использоваться для доступ к веб-сайту.

<h2><a id="management"></a>Установка сертификата управления с помощью портала управления Azure</h2>

Сертификат управления можно создать различными способами.  Дополнительные сведения о создании сертификатов см. в разделе [Создание сертификата управления в Azure](http://msdn.microsoft.com/ru-ru/library/windowsazure/gg551722.aspx).  После создания сертификата добавьте его в свою подписку в Azure. 

1. Выполните вход на портал управления Azure.

2. В области навигации щелкните **Параметры**.

3. В разделе **Сертификаты управления** щелкните **Отправить сертификат управления**.

4. В окне **Отправить сертификат управления** перейдите к файлу сертификата и нажмите кнопку **ОК**.

### Получение отпечатка сертификата и идентификатора подписки ###

Для передачи VHD-файла в Azure вам необходимы отпечаток добавленного сертификата управления и идентификатор подписки.

1. На портале управления щелкните **Параметры**.

2. В разделе **Сертификаты управления** щелкните ваш сертификат, а затем запишите отпечаток с панели **Свойства**, скопировав и вставив его туда, откуда его можно извлечь позднее.

Для передачи VHD-файла необходим также идентификатор подписки.

1. На портале управления щелкните **Все элементы**.

2. На центральной панели в разделе **Подписка** скопируйте подписку и вставьте ее туда, откуда ее можно извлечь позднее.

###Передача этих сведений в средства, если создан собственный ключ###

####Для CSUPLOAD

1.	Откройте окно командной строки Azure SDK как администратор.
2.	Задайте строку подключения с помощью следующей команды, заменив **Subscriptionid** и **CertThumbprint** полученными ранее значениями:


		csupload Set-Connection "SubscriptionID=<Subscriptionid>;CertificateThumbprint=<Thumbprint>;ServiceManagementEndpoint=https://management.core.windows.net"

####Для средств командной строки Linux в Azure

PFX-файл, созданный с использованием openssl, необходимо преобразовать в кодировку base 64 с помощью команды:

 		Base64 [file] > [econded file]

Затем идентификатор подписки и PFX-файл в кодировке base64 необходимо объединить в один файл, имеющий следующую структуру: 

		?xml version="1.0" encoding="utf-8"?>
		<PublishData>
		  <PublishProfile
		    PublishMethod="AzureServiceManagementAPI"
		    Url="https://management.core.windows.net/"
		    ManagementCertificate="xxxxx">
		    <Subscription
		      Id="8a4a0a51-728e-482e-8daa-c477f03c541d"
		      Name="hjereztest" />
		  </PublishProfile>
		</PublishData>
		
Где xxxxx — содержимое [кодированного файла], который будет использоваться для передачи сведений в средство командной строки Linux в Azure с помощью команд:
Azure account import (File)

