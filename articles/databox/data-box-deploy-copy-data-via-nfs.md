---
title: Копирование данных в Microsoft Azure Data Box через NFS | Документация Майкрософт
description: Узнайте, как копировать данные в Azure Data Box
services: databox
author: alkohli
ms.service: databox
ms.subservice: pod
ms.topic: tutorial
ms.date: 11/20/2018
ms.author: alkohli
ms.openlocfilehash: 7ba6bc2cf3cf5286719bc6da519aabb364302af3
ms.sourcegitcommit: 71ee622bdba6e24db4d7ce92107b1ef1a4fa2600
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2018
ms.locfileid: "53550360"
---
# <a name="tutorial-copy-data-to-azure-data-box-via-nfs"></a>Руководство. Копирование данных в Azure Data Box через NFS 

В этом руководстве рассказано, как подключиться и скопировать данные с главного компьютера с помощью локального пользовательского веб-интерфейса, а затем подготовить Data Box к отправке.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * подключение к Data Box;
> * копирование данных в Data Box;
> * подготовка Data Box к отправке.

## <a name="prerequisites"></a>Предварительные требования

Перед тем как начать, убедитесь в следующем.

1. Вы завершили [руководство по настройке Azure Data Box](data-box-deploy-set-up.md).
2. Вы получили Data Box; состояние заказа на портале **Доставлено**.
3. У вас есть главный компьютер с данными, которые необходимо скопировать в Data Box. На главном компьютере должно быть следующее ПО:
    - [поддерживаемая операционная система](data-box-system-requirements.md);
    - Компьютер должен быть подключен к высокоскоростной сети. Настоятельно рекомендуем использовать хотя бы одно подключение 10 GbE. Если подключение 10 GbE недоступно, можно использовать канал передачи данных 1 GbE, но при этом скорость копирования будет снижена. 

## <a name="connect-to-data-box"></a>Подключение к Data Box

В зависимости от выбранной учетной записи хранения Data Box создает указанные ниже ресурсы.
- До трех общих папок для каждой связанной учетной записи хранения (GPv1 и GPv2).
- Одну общую папку для учетной записи хранилища BLOB-объектов или учетной записи хранения уровня "Премиум". 

В общих папках для блочных и страничных BLOB-объектов объектами первого уровня являются контейнеры, а второго — большие двоичные объекты. В общих папках для файлов Azure объекты первого уровня — общие папки, а объекты второго уровня — файлы.

Рассмотрим следующий пример. 

- Учетная запись хранения: *Mystoracct*.
- Общая папка для блочного BLOB-объекта: *Mystoracct_BlockBlob/my-container/blob*.
- Общая папка для страничного BLOB-объекта: *Mystoracct_PageBlob/my-container/blob*.
- Общая папка для файла: *Mystoracct_AzFile/my-share*.

Если вы используете главный компьютер с ОС Linux, то выполните указанные ниже действия, чтобы настроить Data Box для доступа к NFS-клиентам.

1. Укажите IP-адреса клиентов, которым разрешен доступ к общей папке. В локальном пользовательском веб-интерфейсе перейдите на страницу **Подключение и копирование**. В разделе **Параметры NFS** щелкните **Клиентский доступ NFS**. 

    ![Настройка клиентского доступа NFS 1](media/data-box-deploy-copy-data/nfs-client-access.png)

2. Укажите IP-адрес NFS-клиента и щелкните **Добавить**. Вы можете настроить доступ для нескольких NFS-клиентов, выполнив это действие для каждого клиента. Последовательно выберите **ОК**.

    ![Настройка клиентского доступа NFS 2](media/data-box-deploy-copy-data/nfs-client-access2.png)

2. Убедитесь, что на главном компьютере с ОС Linux установлен NFS-клиент [поддерживаемой версии](data-box-system-requirements.md). Используйте версию, подходящую для используемого вами дистрибутива ОС Linux. 

3. После установки NFS-клиента подключите общую папку NFS на устройстве Data Box, выполнив указанную ниже команду.

    `sudo mount <Data Box device IP>:/<NFS share on Data Box device> <Path to the folder on local Linux computer>`

    В примере ниже показано, как подключиться к общей папке Data Box по протоколу NFS. Устройство Data Box имеет IP-адрес `10.161.23.130`, общая папка `Mystoracct_Blob` подключена в виртуальной машине ubuntuVM, а точка подключения имеет название `/home/databoxubuntuhost/databox`.

    `sudo mount -t nfs 10.161.23.130:/Mystoracct_Blob /home/databoxubuntuhost/databox`

## <a name="copy-data-to-data-box"></a>Копирование данных в Data Box

После подключения к общим папкам Data Box можно скопировать данные. Прежде чем копировать данные, выполните указанные ниже проверки.

- Убедитесь, что вы собираетесь копировать данные в общие папки, предназначенные для используемого вами формата данных. Например, данные блочного BLOB-объекта необходимо копировать в общую папку для блочных BLOB-объектов. Если формат данных не соответствует общей папке, то на следующем этапе вам не удастся отправить данные в Azure.
-  При копировании данных убедитесь, что размер данных соответствует ограничениям на размер, указанным в статье [Ограничения для службы хранилища Azure и Data Box](data-box-limits.md). 
- Если данные, отправляемые Data Box, одновременно отправляются другими приложениями за пределами Data Box, это может привести к сбоям заданий отправки и повреждению данных.
- Рекомендуем не использовать протоколы SMB и NFS одновременно либо копировать одни и те же данные в одно и то же конечное расположение в Azure. В таких случаях невозможно предсказать окончательный результат.

Если у вас главный компьютер с ОС Linux, используйте программу копирования, аналогичную Robocopy. Вот некоторые программы, доступные в ОС Linux: [rsync](https://rsync.samba.org/), [FreeFileSync](https://www.freefilesync.org/), [Unison](https://www.cis.upenn.edu/~bcpierce/unison/), [Ultracopier](https://ultracopier.first-world.info/).  

Команда `cp` — один из лучших способов копировать каталоги. Дополнительные сведения об использовании команды см. на [страницах руководства команды cp](http://man7.org/linux/man-pages/man1/cp.1.html).

При копировании при помощи rsync с использованием нескольких потоков следуйте указанным ниже рекомендациям.

 - Установите пакет **CIFS Utils** или **NFS Utils** (в зависимости от того, какая файловая система используется в клиенте с ОС Linux).

    `sudo apt-get install cifs-utils`

    `sudo apt-get install nfs-utils`

 -  Установите программу **Rsync** и **Parallel** (в зависимости от версии используемого дистрибутива ОС Linux).

    `sudo apt-get install rsync`
   
    `sudo apt-get install parallel` 

 - Создайте точку подключения.

    `sudo mkdir /mnt/databox`

 - Подключите том.

    `sudo mount -t NFS4  //Databox IP Address/share_name /mnt/databox` 

 - Сделайте зеркальное отражение структуры каталогов.  

    `rsync -za --include='*/' --exclude='*' /local_path/ /mnt/databox`

 - Скопируйте файлы. 

    `cd /local_path/; find -L . -type f | parallel -j X rsync -za {} /mnt/databox/{}`

     здесь j — количество случаев распараллеливания, а X — количество параллельных копий

     Рекомендуем начать работу с 16 параллельных копий и увеличить количество потоков в зависимости от доступных ресурсов.

## <a name="prepare-to-ship"></a>Подготовка к отправке

[!INCLUDE [data-box-prepare-to-ship](../../includes/data-box-prepare-to-ship.md)]

## <a name="next-steps"></a>Дополнительная информация

В этом руководстве были освещены следующие темы относительно Azure Data Box.

> [!div class="checklist"]
> * подключение к Data Box;
> * Копирование данных в Data Box
> * Подготовка Data Box к отправке

Перейдите к следующему руководству, чтобы узнать, как отправить свой диск Data Box обратно в корпорацию Майкрософт.

> [!div class="nextstepaction"]
> [Отправка Azure Data Box в корпорацию Майкрософт](./data-box-deploy-picked-up.md)

