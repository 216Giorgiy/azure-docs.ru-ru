<properties
   pageTitle="Подключение устройства к предварительно настроенному решению | Microsoft Azure"
   description="Описывает, как подключить устройство к предварительно настроенному решению для удаленного мониторинга из набора Azure IoT Suite на примере, использующем данные температуры и влажности."
   services=""
   documentationCenter="na"
   authors="hegate"
   manager="timlt"
   editor=""/>

<tags
   ms.service="na"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="nana"
   ms.date="09/29/2015"
   ms.author="hegate"/>


# Подключение устройства к решению для удаленного мониторинга Azure IoT


## Обзор сценария

В этом примере мы предполагаем, что получаем из трех источников данные о наружной и внутренней температуре, а также влажности. В целях упрощения мы не будем использовать реальные датчики (данные генерируются самостоятельно в клиентском коде), однако после изучения этой статьи рекомендуем подключить датчик и отправить реальные данные. Для получения дополнительных сведений ознакомьтесь с ресурсами, ссылки на которые указаны в разделе «Расширение решения».

## Предварительные требования

### Подготовка набора IoT

Если вы еще не подготовили свое предварительно настроенное решение для удаленного мониторинга, это можно сделать [здесь](http://www.microsoft.com/ru-RU/server-cloud/internet-of-things/getting-started.aspx).


### Подготовка устройства в решении для удаленного мониторинга
```
Note: if you have already provisioned a device on your solution, you can skip this step.
```
Чтобы подключить устройство к предварительно настроенному решению, необходимо получить на панели мониторинга учетные данные устройства. Они будут использоваться для его идентификации в клиентском приложении. Выполните следующие действия:

1.  В левом нижнем углу панели мониторинга щелкните «Добавить устройство». ![][1]
2.  В разделе «Пользовательское устройство» нажмите кнопку «Добавить новое».

    ![][2]
3.  Выберите идентификатор своего устройства, указав имя, например realdevice1, и щелкните «Проверить идентификатор», чтобы убедиться, что оно не занято. ![][3]

5. Скопируйте предоставленные учетные данные (идентификатор устройства, имя узла в центре IoT и ключ устройства). Они потребуются позже для подключения устройства к решению из клиентского приложения. ![][4]
6. В разделе «Устройства» убедитесь, что ваше устройство отображается правильно. Для него будет отображаться статус «В ожидании», пока не будет установлено соединение между устройством и облаком.

    ![][5]

[1]: ./media/iot-suite-connecting-devices/suite0.png
[2]: ./media/iot-suite-connecting-devices/suite1.png
[3]: ./media/iot-suite-connecting-devices/suite2.png
[4]: ./media/iot-suite-connecting-devices/suite3.png
[5]: ./media/iot-suite-connecting-devices/suite5new.png

Теперь выберите язык, который хотите использовать в примере. В этом учебнике мы создали образец кода для C и node.js, но вы можете реализовать его также на C# и Java.

## Отправка данных устройства в решение для удаленного мониторинга с помощью C


### Запуск устройства под управлением Linux

1. Настройте среду. Если вы ранее не пользовались пакетом Device SDK, узнайте, как настроить среду в Linux, [здесь](https://github.com/azure/azure-iot-sdks/blob/develop/c/doc/devbox_setup.md#linux).

1. Откройте файл **c/serializer/samples/serializer/remote\_monitoring.c** в текстовом редакторе.

2. Найдите в файле следующий код: ```
    static const char* deviceId = "[Device Id]";
    static const char* deviceKey = "[Device Key]";
    static const char* hubName = "[IoTHub Name]";
    static const char* hubSuffix = "[IoTHub Suffix, i.e. azure-devices.net]";
    ```
3. Замените [Device Id] и [Device Key] данными вашего устройства.

4. Используйте имя узла центра IoT на устройстве, чтобы заполнить поля «Имя IoTHub» и «Суффикс IoTHub». Для этого потребуется разделить IoTHub и IoTHubSuffix. Например, если имя узла центра IoT — Contoso.azure devices.net, то Contoso будет именем IoTHub, а все остальное — суффиксом. Результат будет выглядеть так:

    ```
    static const char* deviceId = "mydevice";
    static const char* deviceKey = "mykey";
    static const char* hubName = "Contoso";
    static const char* hubSuffix = "azure-devices.net";
    ```

5. Сохраните изменения и соберите примеры. Чтобы собрать пример, запустите скрипт build.sh из папки **build\_all/c/linux**.

6. Запустите приложение **c/serializer/samples/remote\_monitoring/linux/remote\_monitoring**.

Визуализация зарегистрированного устройства и данных

7. Вернитесь к панели мониторинга в решении для удаленного мониторинга. Вы увидите, что состояние устройства в списке устройств изменилось на «Работает». ![][18]

8. Щелкните панель мониторинга, чтобы просмотреть поступающие данные. Пример настроен для отправки 50 единиц данных о внутренней температуре, 55 единиц данных о наружной температуре и 50 единиц данных о влажности. Обратите внимание, что на панели мониторинга отображаются только температура и влажность по умолчанию.

8. Теперь перейдите к разделу [Управление устройством и отправка команд](#command), чтобы изменить температуру на устройстве из решения для удаленного мониторинга.


### Запуск устройства под управлением Windows


1. Настройте среду. Если вы ранее не пользовались пакетом Device SDK, узнайте, как настроить среду в Windows, [здесь](https://github.com/azure/azure-iot-sdks/blob/develop/c/doc/devbox_setup.md#windows).

1. Запустите новый экземпляр Visual Studio 2015. Откройте решение **remote\_monitoring.sln** в папке **c\\serializer\\build\\windows** в локальном репозитории.

2. В **обозревателе решений** в Visual Studio перейдите к папке \\samples. В проекте **remote\_monitoring** откройте файл **remote\_monitoring.c**.

2. Найдите в файле следующий код: ```
    static const char* deviceId = "[Device Id]";
    static const char* deviceKey = "[Device Key]";
    static const char* hubName = "[IoTHub Name]";
    static const char* hubSuffix = "[IoTHub Suffix, i.e. azure-devices.net]";
    ```
3. Замените [Device Id] и [Device Key] данными вашего устройства.

4. Используйте имя узла центра IoT на устройстве, чтобы заполнить поля «Имя IoTHub» и «Суффикс IoTHub». Для этого необходимо разделить значение следующим образом:

    Если имя вашего узла центра IoT — Contoso.azure devices.net, Contoso будет именем IoTHub, а все остальное — суффиксом. Результат будет выглядеть так:

    ```
    static const char* deviceId = "mydevice";
    static const char* deviceKey = "mykey";
    static const char* hubName = "Contoso";
    static const char* hubSuffix = "azure-devices.net";
    ```

6. В **обозревателе решений** щелкните правой кнопкой мыши проект **remote\_monitoring**, нажмите кнопку **Отладка**, а затем щелкните **Запустить новый экземпляр**, чтобы собрать и запустить пример. В консоли отображаются сообщения между устройством и облаком, которые приложение отправляет в центр IoT.

Визуализация зарегистрированного устройства и данных

7. Вернитесь к панели мониторинга в решении для удаленного мониторинга. Вы увидите, что состояние устройства в списке устройств изменилось на «Работает». ![][18]

8. Щелкните панель мониторинга, чтобы просмотреть поступающие данные. Пример настроен для отправки 50 единиц данных о внутренней температуре, 55 единиц данных о наружной температуре и 50 единиц данных о влажности. Обратите внимание, что на панели мониторинга отображаются только температура и влажность по умолчанию.

8. Теперь перейдите к разделу [Управление устройством и отправка команд](#command), чтобы изменить температуру на устройстве из решения для удаленного мониторинга.


8. Теперь перейдите к разделу «Управление устройством и отправка команд», чтобы изменить температуру на устройстве из решения для удаленного мониторинга.

### Запуск устройства с помощью mbed

Ниже перечислены инструкции по подключению устройства [mbed-enabled Freescale FRDM-K64F](https://developer.mbed.org/platforms/FRDM-K64F/) к центру IoT Azure.


Требования

- Необходимое оборудование: [mbed-enabled Freescale K64F](https://developer.mbed.org/platforms/FRDM-K64F/) или аналог.

Подключение устройства

- Подключите плату к сети, используя Ethernet-кабель. Этот шаг является обязательным, так как для работы примера необходимо подключение к Интернету.

- Подключите устройство к компьютеру с помощью кабеля micro-USB. Убедитесь, что подключаете кабель к USB-порту на устройстве так, как показано на [рисунке](https://developer.mbed.org/platforms/frdm-k64f/) в разделе «Приступая к работе».

- Выполните [инструкции по установке mbed](https://developer.mbed.org/handbook/SerialPC), чтобы настроить последовательное подключение к устройству на компьютере, на котором ведется разработка. Если вы работаете в Windows, установите драйверы для последовательного порта Windows [отсюда](http://developer.mbed.org/handbook/Windows-serial-configuration#1-download-the-mbed-windows-serial-port).

Создание проекта mbed и импорт примера кода

- Откройте в веб-браузере [раздел для разработчиков](https://developer.mbed.org/) на сайте mbed.org. Если у вас еще нет учетной записи, зарегистрируйтесь (бесплатно). Если учетная запись есть, используйте ее для входа. Щелкните **Компилятор** в правом верхнем углу страницы. Откроется интерфейс управления рабочими областями.

- Убедитесь, что в правом верхнем углу окна отображается аппаратная платформа, которую вы используете. В противном случае щелкните значок и выберите другую платформу.

- Щелкните **Импорт** в главном меню. Затем выберите ссылку «**Щелкните здесь**, чтобы выполнить импорт с URL-адреса» рядом со значком земного шара и логотипом mbed.

	![][6]

- Во всплывающем окне введите ссылку на образец кода: https://developer.mbed.org/users/AzureIoTClient/code/remote_monitoring/

	![][7]

- В компиляторе mbed вы увидите, что при импорте проекта были импортированы различные библиотеки. Некоторые из них предоставляются и обслуживаются командой Azure IoT ([azureiot\_common](https://developer.mbed.org/users/AzureIoTClient/code/azureiot_common/), [iothub\_client](https://developer.mbed.org/users/AzureIoTClient/code/iothub_client/), [iothub\_amqp\_transport](https://developer.mbed.org/users/AzureIoTClient/code/iothub_amqp_transport/), [iothub\_http\_transport](https://developer.mbed.org/users/AzureIoTClient/code/iothub_http_transport/), [proton-c-mbed](https://developer.mbed.org/users/AzureIoTClient/code/proton-c-mbed/)), остальные являются библиотеками сторонних производителей, доступными в каталоге библиотек mbed.

	![][8]

- Откройте файл remote\_monitoring\\remote\_monitoring.c и найдите в нем следующий код: ```
    static const char* deviceId = "[Device Id]";
    static const char* deviceKey = "[Device Key]";
    static const char* hubName = "[IoTHub Name]";
    static const char* hubSuffix = "[IoTHub Suffix, i.e. azure-devices.net]";
    ```
3. Замените [Device Id] и [Device Key] данными вашего устройства.

4. Используйте имя узла центра IoT на устройстве, чтобы заполнить поля «Имя IoTHub» и «Суффикс IoTHub». Для этого необходимо разделить значение следующим образом:

    Если имя вашего узла центра IoT — Contoso.azure devices.net, Contoso будет именем IoTHub, а все остальное — суффиксом. Результат будет выглядеть так:

    ```
    static const char* deviceId = "mydevice";
    static const char* deviceKey = "mykey";
    static const char* hubName = "Contoso";
    static const char* hubSuffix = "azure-devices.net";
    ```
    ![][9]

Сборка и запуск проекта

- Щелкните **Скомпилировать**, чтобы собрать программу. Вы можете проигнорировать все предупреждения. Однако если при сборке возникают ошибки, исправьте их, прежде чем продолжить.

- Если сборка выполнена успешно, создается файл с именем проекта и расширением BIN. Скопируйте BIN-файл на устройство. При этом терминальное соединение с устройством будет перезапущено. После повторного подключения сбросьте терминал вручную или установите новое терминальное соединение. Это позволяет сбросить данные устройства mbed и приступить к запуску программы.

- Подключитесь к устройству с помощью клиентского SSH-приложения, такого как PuTTY. Вы можете посмотреть, какой последовательный порт использует устройство, в диспетчере устройств Windows.


- В PuTTY выберите **Последовательный** тип подключения. Скорее всего, устройство подключается на скорости 115 200 бит/с, поэтому введите это значение в поле **Скорость**. Щелкните **Открыть**.

	![][11]

Начнется выполнение программы. Если программа не запускается автоматически при подключении, возможно, нужно перезагрузить плату (для этого нажмите клавиши CTRL+BREAK или кнопку сброса на плате).

Визуализируйте зарегистрированное устройство и данные 7. Вернитесь к панели мониторинга в решении для удаленного мониторинга. Вы увидите, что состояние устройства в списке устройств изменилось на «Работает». ![][18]

8. Щелкните панель мониторинга, чтобы просмотреть поступающие данные. Пример настроен для отправки 50 единиц данных о внутренней температуре, 55 единиц данных о наружной температуре и 50 единиц данных о влажности. Обратите внимание, что на панели мониторинга отображаются только температура и влажность по умолчанию.

8. Теперь перейдите к разделу [Управление устройством и отправка команд](#command), чтобы изменить температуру на устройстве из решения для удаленного мониторинга.



[6]: ./media/iot-suite-connecting-devices/mbed1.png
[7]: ./media/iot-suite-connecting-devices/mbed2a.png
[8]: ./media/iot-suite-connecting-devices/mbed3a.png
[9]: ./media/iot-suite-connecting-devices/suite6.png
[10]: ./media/iot-suite-connecting-devices/mbed5a.png
[11]: ./media/iot-suite-connecting-devices/mbed6.png
[12]: ./media/iot-suite-connecting-devices/mbed7.png

Чтобы узнать больше об управлении и отправке команд, ознакомьтесь с соответствующим разделом этого учебника.

## Отправка данных устройства в решение для удаленного мониторинга с помощью node.js



-   В репозитории azure-iot-sdks найдите следующие файлы: packages.json (в папке /node/common) и remote\_monitoring.js (в папке node/device/samples/). Скопируйте их в одну папку на своем устройстве.

- Откройте файл remote-monitoring.js и найдите следующие переменные:


   ```
   static const char* deviceId = "[Device Id]";
   static const char* deviceKey = "[Device Key]";
   static const char* hubName = "[IoTHub Name]";
   static const char* hubSuffix = "[IoTHub Suffix, i.e. azure-devices.net]";
   ```

-  Замените [Device Id] и [Device Key] данными вашего устройства.

-  Используйте имя узла центра IoT на устройстве, чтобы заполнить поля «Имя IoTHub» и «Суффикс IoTHub». Для этого необходимо разделить значение следующим образом:

   Если имя вашего узла центра IoT — Contoso.azure devices.net, Contoso будет именем IoTHub, а все остальное — суффиксом. Результат будет выглядеть так:


   ```
     static const char* deviceId = "mydevice";
   static const char* deviceKey = "mykey";
   static const char* hubName = "Contoso";
   static const char* hubSuffix = "azure-devices.net";
   ```


- Сохраните файл. Выполните следующую команду для папки назначения:

```
npm install
node .
```

3.  Замените все переменные сведениями, полученными на предыдущем шаге. Сохраните изменения.


4. Откройте оболочку (Linux) или командную строку Node.js (Windows) и перейдите к папке **node\\samples**. Запустите приложение, используя следующую команду:

    ```
    node simple_sample_remotemonitoring.js
    ```

Визуализация устройства и входящих данных

6. На портале предварительно настроенного решения щелкните раздел «Устройства», чтобы убедиться, что состояние устройства изменилось на «Работает» и что отображаются все данные о производителе.

7. Щелкните панель мониторинга и выберите свое устройство в разделе «Устройство для просмотра». Должны отображаться данные телеметрии, отслеживаемые в решении для удаленного мониторинга.


## <a name="command"></a>Управление устройством и отправка команд из панели мониторинга

Теперь, когда устройство подключено и отправляет самостоятельно генерируемые данные температуры, вы можете управлять им удаленно, используя центр IoT. Вы можете реализовать несколько типов команд, которые лучше всего подходят для вашего бизнес-приложения. В этом примере мы предположили, что нам нужно изменить температуру, и реализовали соответствующую команду. Чтобы отправить команду, сделайте следующее.

-  Щелкните идентификатор устройства в списке устройств (раздел «Устройства» в меню слева).

	![][13]

- В меню справа, где отображаются сведения об устройстве, нажмите кнопку «Отправить команду».


- Выберите команду, которую вы хотите выполнить. В нашем примере мы выбрали «Задать температуру», поскольку нам нужно изменить температуру, заданную на устройстве. Выберите эту команду и установите значение температуры. Щелкните «Отправить команду», и новая температура будет передана на устройство. Примечание. Вы увидите, что в журнале команд результат выполнения команды отображается со статусом «В ожидании». Это связано с тем, что для упрощения примера мы не реализовали логику, которая позволила бы устройству отправить ответ в центр IoT. Добавить логику можно, расширив решение.

	![][14]
- Вернитесь к панели мониторинга и убедитесь, что поступают обновленные данные. Вы увидите обновленную статистику по температуре, а также новые данные в журнале телеметрии.




[13]: ./media/iot-suite-connecting-devices/suite4.png
[14]: ./media/iot-suite-connecting-devices/suite7-1.png
[15]: ./media/iot-suite-connecting-devices/suite8a.png
[16]: ./media/iot-suite-connecting-devices/mbed4a.png
[17]: ./media/iot-suite-connecting-devices/suite9.png
[18]: ./media/iot-suite-connecting-devices/suite10.png


## Дальнейшие действия

Есть несколько способов расширить функциональные возможности, описываемые в данной статье. Например, можно подключить датчик к устройству для отправки реальных данных или реализовать функциональность управления и отправки команд. Дополнительные сведения о расширении решения для удаленного мониторинга см. в соответствующем [руководстве](articles/iot-suite/iot-suite-guidance-on-customizing-preconfigured-solutions.md).

<!---HONumber=Oct15_HO3-->