---
title: Локальное развертывание решения для удаленного мониторинга в Azure | Документация Майкрософт
description: В этом руководстве показано, как развернуть предварительно настроенное решение для удаленного мониторинга на локальном компьютере в целях тестирования и разработки.
services: iot-suite
suite: iot-suite
author: dominicbetts
manager: timlt
ms.author: dobett
ms.service: iot-suite
ms.date: 03/07/2018
ms.topic: article
ms.devlang: NA
ms.tgt_pltfrm: NA
ms.workload: NA
ms.openlocfilehash: 77f40e2f10cbdb9930a22a4248e19bb3356af7af
ms.sourcegitcommit: a0be2dc237d30b7f79914e8adfb85299571374ec
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2018
---
# <a name="deploy-the-remote-monitoring-preconfigured-solution-locally"></a>Локальное развертывание предварительно настроенного решения для удаленного мониторинга

В этой статье показано, как развернуть предварительно настроенное решение для удаленного мониторинга на локальном компьютере в целях тестирования и разработки. При этом подходе выполняется развертывание микрослужб в локальном контейнере Docker и используются Центр Интернета вещей, база данных Cosmos DB и службы хранения Azure в облаке. Для развертывания облачных служб Azure используется интерфейс командной строки (CLI) предварительно настроенных решений (PCS).

## <a name="prerequisites"></a>предварительным требованиям

Для развертывания служб Azure, используемых предварительно настроенным решением для удаленного мониторинга, требуется активная подписка Azure.

Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в разделе [Бесплатная пробная версия Azure](http://azure.microsoft.com/pricing/free-trial/).

Для завершения локального развертывания необходимо установить следующие средства на локальный компьютер разработчика:

* [Git](https://git-scm.com/);
* [Docker](https://www.docker.com);
* [Docker Compose](https://docs.docker.com/compose/install/);
* [Node.js](https://nodejs.org/) (это программное обеспечение является необходимым условием для интерфейса командной строки PCS);
* интерфейс командной строки PCS.

> [!NOTE]
> Эти средства доступны на многих платформах, включая Windows, Linux и iOS.

### <a name="install-the-pcs-cli"></a>Установка интерфейса командной строки PCS

Чтобы установить интерфейс командной строки, в среде командной строки выполните следующую команду:

```cmd/sh
npm install iot-solutions -g
```

Дополнительные сведения об интерфейсе командной строки см. в статье [Azure IoT PCS CLI Overview](https://github.com/Azure/pcs-cli/blob/master/README.md)(Обзор интерфейса командной строки для предварительно настроенного решения Центра Интернета вещей Azure).

## <a name="deploy-the-azure-services"></a>Развертывание служб Azure

Несмотря на то что в этой статье показано, как запускать микрослужбы локально, они зависят от трех служб Azure, выполняемых в облаке. Эти службы Azure можно развернуть вручную с помощью портала Azure или интерфейса командной строки PCS. В этой статье описано, как использовать средство `pcs`.

### <a name="sign-in-to-the-cli"></a>Вход в интерфейс командной строки

Прежде чем развернуть предварительно настроенное решение, необходимо войти в подписку Azure с помощью интерфейса командной строки:

```cmd/sh
pcs login
```

Для завершения процесса входа следуйте инструкциям на экране.

### <a name="run-a-local-deployment"></a>Запуск локального развертывания

Выполните следующую команду для запуска локального развертывания:

```cmd/pcs
pcs -s local
```

Скрипт запрашивает следующие сведения:

* имя решения;
* подписка Azure, которую нужно использовать;
* расположение центра обработки данных Azure, который будет использоваться.

Скрипт создает экземпляр Центра Интернета вещей, экземпляр Cosmos DB и учетную запись хранения Azure в группе ресурсов в подписке Azure. Имя группы ресурсов — это имя решения, выбранного при запуске средства `pcs`.

Выполнение скрипта занимает несколько минут. По завершении отобразится сообщение `Copy the following environment variables to /scripts/local/.env file:`. Скопируйте определения переменных среды, которые следуют за сообщением. Они будут использоваться на последующем этапе.

## <a name="download-the-source-code"></a>Скачивание исходного кода

Репозиторий исходного кода для удаленного мониторинга включает в себя файлы конфигурации Docker, необходимые для скачивания, настройки и запуска образов Docker, содержащих микрослужбы. Чтобы клонировать репозиторий, перейдите в подходящую папку на локальном компьютере и выполните одну из следующих команд:

Чтобы установить реализации микрослужб для Java, выполните следующую команду:

```cmd/sh
git clone --recursive https://github.com/Azure/azure-iot-pcs-remote-monitoring-java
```

Чтобы установить реализации микрослужб для .NET, выполните следующую команду:

```cmd\sh
git clone --recursive https://github.com/Azure/azure-iot-pcs-remote-monitoring-dotnet
```

Эти команды скачивают исходный код для всех микрослужб. Хотя для запуска микрослужб в Docker не требуется исходный код, он полезен на случай, если в дальнейшем планируется изменить предварительно настроенное решение и протестировать изменения локально.

## <a name="run-the-microservices-in-docker"></a>Запуск микрослужб в Docker

Чтобы запустить микрослужбы в Docker, сначала измените файл **scripts\\local\\.env** в локальной копии репозитория. Замените все содержимое файла определениями переменных среды, записанными ранее при выполнении команды `pcs`. Эти переменные среды позволяют микрослужбам в контейнере Docker подключаться к службам Azure, созданным средством `pcs`.

Чтобы запустить предварительно настроенное решение, перейдите в папку **scripts\local** в среде командной строки и выполните следующую команду:

```cmd\sh
docker-compose up
```

При первом выполнении этой команды Docker скачивает образы микрослужб из центра Docker для локальной сборки контейнеров. При последующих выполнениях Docker запускает контейнеры немедленно.

С помощью отдельной оболочки можно просмотреть журналы из контейнера. Для этого сначала найдите идентификатор контейнера с помощью команды `docker ps -a`. Затем с помощью `docker logs {container-id} --tail 1000` просмотрите последние 1000 записей журнала для указанного контейнера.

Для доступа к информационной панели решения для удаленного мониторинга перейдите в браузере по адресу [http://localhost:8080](http://localhost:8080).

## <a name="tidy-up"></a>Удаление ненужных элементов

Чтобы избежать ненужных затрат, после завершения тестирования удалите облачные службы из подписки Azure. Самый простой способ удалить службы — с помощью портала Azure удалить группу ресурсов, созданную средством `pcs`.

Воспользуйтесь командой `docker-compose down --rmi all`, чтобы удалить образы Docker и освободить место на локальном компьютере. Также можно удалить локальную копию репозитория удаленного мониторинга, созданную при клонировании исходного кода из GitHub.

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * Настройка предварительно настроенного решения.
> * Развертывание предварительно настроенного решения.
> * Вход в предварительно настроенное решение.

Теперь, когда вы развернули решение для удаленного мониторинга, [изучите возможности панели мониторинга решения](./iot-suite-remote-monitoring-deploy.md).

<!-- Next tutorials in the sequence -->