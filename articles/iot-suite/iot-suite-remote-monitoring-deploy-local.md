---
title: Локальное развертывание решения для удаленного мониторинга в Azure | Документация Майкрософт
description: В этом руководстве показано, как развернуть акселератор решений для удаленного мониторинга на локальном компьютере в целях тестирования и разработки.
services: iot-suite
suite: iot-suite
author: dominicbetts
manager: timlt
ms.author: dobett
ms.service: iot-suite
ms.date: 03/07/2018
ms.topic: article
ms.devlang: NA
ms.tgt_pltfrm: NA
ms.workload: NA
ms.openlocfilehash: a470987c4e8b5755554e4827cf1295a174d301e8
ms.sourcegitcommit: e221d1a2e0fb245610a6dd886e7e74c362f06467
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2018
ms.locfileid: "33774481"
---
# <a name="deploy-the-remote-monitoring-solution-accelerator-locally"></a>Локальное развертывание акселератора решений для удаленного мониторинга

В этой статье показано, как развернуть акселератор решений для удаленного мониторинга на локальном компьютере в целях тестирования и разработки. При этом подходе выполняется развертывание микрослужб в локальном контейнере Docker и используются Центр Интернета вещей, база данных Cosmos DB и службы хранения Azure в облаке. Для развертывания облачных служб Azure используется интерфейс командной строки (CLI) акселераторов решений (PCS).

## <a name="prerequisites"></a>предварительным требованиям

Для развертывания служб Azure, используемых акселератором решений для удаленного мониторинга, требуется активная подписка Azure.

Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в разделе [Бесплатная пробная версия Azure](http://azure.microsoft.com/pricing/free-trial/).

Для завершения локального развертывания необходимо установить следующие средства на локальный компьютер разработчика:

* [Git.](https://git-scm.com/)
* [Docker](https://www.docker.com)
* [Docker Compose](https://docs.docker.com/compose/install/);
* [Node.js](https://nodejs.org/) (это программное обеспечение является необходимым условием для интерфейса командной строки PCS);
* интерфейс командной строки PCS.
* Локальный репозиторий исходного кода

> [!NOTE]
> Эти средства доступны на многих платформах, включая Windows, Linux и iOS.

### <a name="install-the-pcs-cli"></a>Установка интерфейса командной строки PCS

Чтобы установить CLI акселераторов решений через npm, выполните следующую команду в среде командной строки:

```cmd/sh
npm install iot-solutions -g
```

Дополнительные сведения об интерфейсе командной строки см. в статье [Azure IoT PCS CLI Overview](https://github.com/Azure/pcs-cli/blob/master/README.md)(Обзор интерфейса командной строки для предварительно настроенного решения Центра Интернета вещей Azure).

### <a name="download-the-source-code"></a>Скачивание исходного кода

 Репозиторий исходного кода для удаленного мониторинга включает в себя файлы конфигурации Docker, необходимые для скачивания, настройки и запуска образов Docker, содержащих микрослужбы. Чтобы клонировать и создать локальную версию репозитория, откройте любую программу интерфейса командной строки или терминал, перейдите в подходящую папку на локальном компьютере и выполните одну из следующих команд:

Чтобы установить реализации микрослужб для Java, выполните следующую команду:

```cmd/sh
git clone --recursive https://github.com/Azure/azure-iot-pcs-remote-monitoring-java
```

Чтобы установить реализации микрослужб для .NET, выполните следующую команду:

```cmd\sh
git clone --recursive https://github.com/Azure/azure-iot-pcs-remote-monitoring-dotnet
```

Репозиторий и дополнительные модули предварительно настроенного решения для удаленного мониторинга: [ [Java](https://github.com/Azure/azure-iot-pcs-remote-monitoring-java) | [.Net](https://github.com/Azure/azure-iot-pcs-remote-monitoring-dotnet) ]

> [!NOTE]
> Эти команды скачивают исходный код для всех микрослужб. Хотя для запуска микрослужб в Docker не требуется исходный код, он полезен на случай, если в дальнейшем планируется изменить предварительно настроенное решение и протестировать изменения локально.

## <a name="deploy-the-azure-services"></a>Развертывание служб Azure

Несмотря на то что в этой статье показано, как запускать микрослужбы локально, они зависят от трех служб Azure, выполняемых в облаке. Эти службы Azure можно [развернуть вручную с помощью портала Azure](https://github.com/Azure/azure-iot-pcs-remote-monitoring-dotnet/wiki/Manual-steps-to-create-azure-resources-for-local-setup) или CLI акселераторов решений. В этой статье описано, как использовать средство `pcs`.

### <a name="sign-in-to-the-cli"></a>Вход в интерфейс командной строки

Прежде чем развернуть акселератор решений, необходимо войти в подписку Azure с помощью интерфейса командной строки:

```cmd/sh
pcs login
```

Для завершения процесса входа следуйте инструкциям на экране. Если вы случайно щелкнете любой элемент в интерфейсе командной строки, попытка входа может завершиться сбоем. По завершении входа вы увидите сообщение об успешном входе в CLI. 

### <a name="run-a-local-deployment"></a>Запуск локального развертывания

Выполните приведенную ниже команду, чтобы запустить локальное развертывание: Она создает необходимые ресурсы Azure и выводит в консоль переменные среды. 

```cmd/pcs
pcs -s local
```

Скрипт запрашивает следующие сведения:

* имя решения;
* Подписка Azure, которую нужно использовать.
* расположение центра обработки данных Azure, который будет использоваться.

> [!NOTE]
> Скрипт создает экземпляр Центра Интернета вещей, экземпляр Cosmos DB и учетную запись хранения Azure в группе ресурсов в подписке Azure. Имя группы ресурсов совпадает с именем решения, которое вы выбрали при запуске средства `pcs`. 

> [!IMPORTANT]
> Выполнение скрипта занимает несколько минут. По завершении отобразится сообщение `Copy the following environment variables to /scripts/local/.env file:`. Скопируйте определения переменных среды, которые следуют за сообщением. Они пригодятся вам на последующем этапе.

## <a name="run-the-microservices-in-docker"></a>Запуск микрослужб в Docker

Чтобы запустить микрослужбы в Docker, сначала измените файл **scripts\\local\\.env** в локальной копии репозитория, который вы клонировали на предыдущем этапе. Замените все содержимое файла определениями переменных среды, которые вы сохранили на предыдущем этапе при выполнении команды `pcs`. Эти переменные среды позволяют микрослужбам в контейнере Docker подключаться к службам Azure, созданным средством `pcs`.

Чтобы запустить акселератор решений, перейдите в папку **scripts\local** в среде командной строки и выполните следующую команду:

```cmd\sh
docker-compose up
```

При первом выполнении этой команды Docker скачивает образы микрослужб из центра Docker для локальной сборки контейнеров. При последующих выполнениях Docker запускает контейнеры немедленно.

С помощью отдельной оболочки можно просмотреть журналы из контейнера. Для этого сначала найдите идентификатор контейнера с помощью команды `docker ps -a`. Затем с помощью `docker logs {container-id} --tail 1000` просмотрите последние 1000 записей журнала для указанного контейнера.

Для доступа к панели мониторинга решения для удаленного мониторинга перейдите по адресу [http://localhost:8080](http://localhost:8080) в браузере.

## <a name="clean-up"></a>Очистка

Чтобы избежать ненужных затрат, после завершения тестирования удалите облачные службы из подписки Azure. Самый простой способ удалить службы — удалить на [портале Azure](https://ms.portal.azure.com) группу ресурсов, созданную с помощью средства `pcs`.

Воспользуйтесь командой `docker-compose down --rmi all`, чтобы удалить образы Docker и освободить место на локальном компьютере. Также можно удалить локальную копию репозитория удаленного мониторинга, созданную при клонировании исходного кода из GitHub.

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * настройка локальной среды разработки;
> * настройка акселератора решений;
> * развертывание акселератора решений;
> * вход в акселератор решений.

Теперь, когда вы развернули решение для удаленного мониторинга, [изучите возможности панели мониторинга решения](./iot-suite-remote-monitoring-deploy.md).

<!-- Next tutorials in the sequence -->