---
title: Непрерывность облачных бизнес-процессов — восстановление базы данных — база данных SQL | Документация Майкрософт
description: Узнайте, как базы данных SQL Azure поддерживают непрерывное выполнение облачных бизнес-процессов и восстановление баз данных, а также помогают обеспечить выполнение важных облачных приложений.
keywords: непрерывность бизнес-процессов, непрерывность облачных бизнес-процессов, аварийное восстановление базы данных, восстановление базы данных
services: sql-database
author: anosov1960
manager: craigg
ms.service: sql-database
ms.custom: business continuity
ms.topic: conceptual
ms.workload: On Demand
ms.date: 07/25/2018
ms.author: sashan
ms.reviewer: carlrab
ms.openlocfilehash: ce0684f9ab06b5362ccdf25aeaff15ea668ce96c
ms.sourcegitcommit: fab878ff9aaf4efb3eaff6b7656184b0bafba13b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/22/2018
ms.locfileid: "42444154"
---
# <a name="overview-of-business-continuity-with-azure-sql-database"></a>Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure

База данных SQL Azure — это реализация последнего стабильного ядра СУБД SQL Server, настроенного и оптимизированного для облачной среды Azure, которая обеспечивает [высокий уровень доступности](sql-database-high-availability.md) и отказоустойчивость к ошибкам, которые могут повлиять на ваши бизнес-процессы. **Непрерывность бизнес-процессов** в Базе данных SQL Azure относится к механизмам, политикам и процедурам, которые позволяют бизнес-процессам продолжить работу при возникновении сбоев, особенно в вычислительной инфраструктуре.  В большинстве случаев База данных SQL Azure будет обрабатывать аварийные события, которые могут произойти в облачной среде, и поддерживать выполнение бизнес-процессов. Однако существуют аварийные события, которые База данных SQL Azure обработать не может, например:
 - Пользователь случайно удалил или обновил строку в таблице.
 - Злоумышленник удалил данные или базу данных.
 - Землетрясение привело к отключению электроэнергии и временному отключению центра обработки данных.
 
База данных SQL Azure не может контролировать данные случаи, поэтому вам нужно будет использовать функции обеспечения непрерывности бизнес-процессов, которые позволяют восстанавливать данные и поддерживать работу приложений.

В этом обзоре описываются возможности базы данных SQL Azure по обеспечению непрерывности бизнес-процессов и аварийного восстановления. Вы узнаете о параметрах, рекомендациях и руководствах по восстановлению после аварийных событий, которые могут приводить к потере данных или недоступности базы данных и приложений. Здесь также содержатся сведения о том, как действовать в ситуациях, когда ошибка пользователя или приложения нарушает целостность данных, происходит сбой региона Azure или приложение требует обслуживания.

## <a name="sql-database-features-that-you-can-use-to-provide-business-continuity"></a>Функции базы данных SQL, которые можно использовать для обеспечения непрерывности бизнес-процессов

С точки зрения базы данных существуют четыре основных сценария возможных нарушений:
- **Локальные сбои оборудования или программного обеспечения**, влияющие на узел базы данных, например сбой диска.
- **Повреждение или удаление данных**, которое, как правило, возникает по причине ошибки приложения или пользователя.  Такие сбои по своей сути относятся к конкретному приложению и, как правило, автоматически не обнаруживаются и не устраняются с помощью инфраструктуры.
- **Отключение центра обработки данных**, возможно вызванное стихийным бедствием.  Этот сценарий требует определенного уровня геоизбыточности с отработкой отказа приложений в альтернативном центре обработки данных.
- **Ошибки обновления или обслуживания** — непредвиденные проблемы, возникающие во время планового обновления или обслуживания приложения или базы данных. Они могут потребовать быстрого отката к предыдущему состоянию базы данных.

База данных SQL предоставляет несколько функций обеспечения непрерывности бизнес-процессов, включая автоматизированную архивацию и необязательную репликацию баз данных, которые могут справиться с этими сценариями. Во-первых, вам нужно понять, как [архитектура высокого уровня доступности](sql-database-high-availability.md) Базы данных SQL обеспечивает доступность на уровне 99,99 % и отказоустойчивость к определенным аварийным событиям, которые могут повлиять на бизнес-процесс.
Затем вы можете узнать о дополнительных механизмах, позволяющих выполнить восстановление после аварийных событий, которые невозможно обработать с помощью архитектуры высокой доступности Базы данных SQL, например:
 - [Временные таблицы](sql-database-temporal-tables.md) позволяют восстанавливать версии строк из любой точки во времени.
 - [Встроенные автоматически создаваемые резервные копии](sql-database-automated-backups.md) и [восстановление до точки во времени](sql-database-recovery-using-backups.md#point-in-time-restore) позволяют восстановить полную базу данных до определенной точки во времени в течение последних 35 дней.
 - Вы можете [восстановить удаленную базу](sql-database-recovery-using-backups.md#deleted-database-restore) данных до точки, когда она была удалена, если **логический сервер не был удален**.
 - [Долгосрочное хранение архивных копий](sql-database-long-term-retention.md) позволяет хранить резервные копии до 10 лет.
 - [Георепликация](sql-database-geo-replication-overview.md) позволяет приложению выполнять быстрое аварийное восстановление в случае сбоя масштабирования в центре обработки данных.

У каждой из них разные параметры оценки времени восстановления (ERT) и возможной потери данных последних транзакций. Поняв, на что влияют эти параметры, вы сможете выбрать те, которые вам подходят, и, в большинстве случаев, использовать их вместе в различных сценариях. При разработке плана обеспечения непрерывности бизнес-процессов нужно понимать, какое максимальное время до полного восстановления приложения после аварийного события допустимо. Время, необходимое приложению для полного восстановления, называется целевым временем восстановления (RTO). Необходимо также понимать, потерю какого максимального периода последних обновлений данных (т. е. за какой интервал времени) приложение может допустить при восстановлении после аварийного события. Этот период обновлений является целевой точкой восстановления (RPO).

В приведенной ниже таблице сравниваются ERT и RPO для каждого уровня служб в трех наиболее распространенных сценариях.

| Функция | базовая; | Стандартная | Премиум  | Общего назначения | Критически важный для бизнеса
| --- | --- | --- | --- |--- |--- |
| Восстановление до точки во времени из резервной копии |Все точки восстановления в течение семи дней |Все точки восстановления в течение 35 дней |Все точки восстановления в течение 35 дней |Все точки восстановления за указанный период (до 35 дней)|Все точки восстановления за указанный период (до 35 дней)|
| Геовосстановление из геореплицированных резервных копий |ERT < 12 ч, RPO < 1 ч |ERT < 12 ч, RPO < 1 ч |ERT < 12 ч, RPO < 1 ч |ERT < 12 ч, RPO < 1 ч|ERT < 12 ч, RPO < 1 ч|
| Восстановление из резервной копии долгосрочного хранения SQL |ERT < 12 ч, RPO < 1 нед. |ERT < 12 ч, RPO < 1 нед. |ERT < 12 ч, RPO < 1 нед. |ERT < 12 ч, RPO < 1 нед.|ERT < 12 ч, RPO < 1 нед.|
| Активная георепликация |ERT < 30 с, RPO < 5 с |ERT < 30 с, RPO < 5 с |ERT < 30 с, RPO < 5 с |ERT < 30 с, RPO < 5 с|ERT < 30 с, RPO < 5 с|

## <a name="recover-a-database-to-the-existing-server"></a>Восстановление базы данных на имеющемся сервере

База данных SQL автоматически создает полные резервные копии (раз в неделю) и разностные резервные копии базы данных (раз в час), а также резервные копии журнала транзакций (раз в 5–10 минут) для защиты вашей компании от потери данных. Резервные копии хранятся в хранилище RA-GRS в течение 35 дней для всех уровней обслуживания, за исключением базовых с единицами DTU, где резервные копии хранятся в течение 7 дней. Дополнительные сведения см. в статье [Подробнее о резервном копировании базы данных SQL](sql-database-automated-backups.md). Вы можете восстановить существующую базу данных из автоматически создаваемых резервных копий до предшествующей точки во времени как новую базу данных на том же логическом сервере с помощью портала Azure, PowerShell или REST API. Дополнительные сведения см. в разделе [Восстановление до точки во времени](sql-database-recovery-using-backups.md#point-in-time-restore).

Если для вашего приложения недостаточно максимального поддерживаемого срока хранения для восстановления до точки во времени (PITR), его можно увеличить, настроив для баз данных долгосрочную политику хранения (LTR). Дополнительные сведения см. в разделе [Долгосрочное хранение резервных копий](sql-database-long-term-retention.md).

Эти создаваемые автоматически резервные копии можно использовать для восстановления базы данных после различных аварийных событий как в своем, так и в другом центре обработки данных. При использовании создаваемых автоматически резервных копий базы данных предполагаемое время восстановления будет зависеть от нескольких факторов, включая общее количество баз данных, восстанавливаемых в том же регионе и в то же время, размера базы данных, размера журнала транзакций и пропускной способности сети. Обычно время восстановления составляет менее 12 часов. Большая или активная база данных может восстанавливаться дольше. Дополнительные сведения см. в разделе [Время восстановления](sql-database-recovery-using-backups.md#recovery-time). При восстановлении в другой регион данных потенциальные потери данных ограничены 1 часом благодаря геоизбыточному хранилищу ежечасных разностных резервных копий базы данных.

Используйте автоматически создаваемые резервные копии и [восстановление до точки во времени](sql-database-recovery-using-backups.md#point-in-time-restore) для обеспечения непрерывности бизнес-процессов и восстановления, если ваше приложение:

* не является критически важным;
* на него не распространяется действие соглашений об уровне обслуживания, то есть перерыв в работе на 24 часа и более не повлечет финансовой ответственности;
* имеет низкую частоту изменения данных (количество транзакций в час), и потеря до часа изменений данных считается допустимой;
* имеет ограниченный бюджет.

Если вам требуется более быстрое восстановление, используйте [активную георепликацию](sql-database-geo-replication-overview.md) (рассматривается далее). Если вам нужна возможность восстанавливать данные за период больше 35 дней, используйте [долгосрочное хранение резервных копий](sql-database-long-term-retention.md). 

## <a name="recover-a-database-to-another-region"></a>Восстановление базы данных в другом регионе
<!-- Explain this scenario -->

В редких случаях возможен сбой центра обработки данных Azure. Такой сбой вызывает нарушение работы компании, которое может длиться от считанных минут до нескольких часов.

* Один из вариантов — дождаться возобновления работы базы данных после того, как сбой центра обработки данных будет устранен. Это подходит для приложений, которые допускают отключение базы данных от сети. Например, вам не нужно непрерывно работать с проектом по разработке или бесплатной пробной версией. После того как произошел сбой центра обработки данных, неизвестно, как долго будет длиться простой. Поэтому этот вариант используется, только если база данных некоторое время не нужна.
* Другим вариантом является восстановление базы данных на любом сервере в любом регионе Azure с использованием [резервных копий геоизбыточных баз данных](sql-database-recovery-using-backups.md#geo-restore) (геовосстановление). В качестве источника геовосстановление использует геоизбыточную резервную копию для восстановления базы данных, даже если она или центр обработки данных недоступны из-за сбоя.
* Наконец, вы можете быстро повысить уровень дополнительной области данных до основной (также называется отработкой отказа) и при использовании активной георепликации настроить приложения для подключения к новой основной области. Небольшой объем данных последних транзакций может быть потерян ввиду характера асинхронной репликации. С помощью групп автоматической отработки отказа можно настроить политику отработки отказа, чтобы свести к минимуму возможные потери данных. Во всех случаях пользователи заметят небольшой простой и должны будут подключиться повторно. Отработка отказа занимает несколько секунд, тогда как на восстановление базы данных из резервных копий требуются часы.

Выполнить отработку отказа в другой регион можно с помощью [активной георепликации](sql-database-geo-replication-overview.md). Это позволит настроить для базы данных до четырех доступных для чтения баз данных-получателей в выбранных вами регионах. Эти базы данных-получатели синхронизируются с базой данных-источником с помощью механизма асинхронной репликации. 

> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-protecting-important-DBs-from-regional-disasters-is-easy/player]
>


> [!IMPORTANT]
> Для использования активной георепликации и групп автоматической отработки отказа необходимо быть владельцем подписки или иметь разрешения администратора в SQL Server. Для настройки и отработки отказа можно использовать портал Azure, PowerShell или REST API, имея разрешения для подписки Azure, или Transact-SQL, имея разрешения для SQL Server.
> 

Эта функция используется, чтобы предотвратить нарушение работы компании при сбое центра обработки данных или во время обновления приложения. Для включения автоматической и прозрачной отработки отказа вам следует распределить геореплицируемые базы данных по группам с помощью функции [автоматическая отработка отказа](sql-database-geo-replication-overview.md) Базы данных SQL. Используйте активную георепликацию и группы автоматической отработки отказа, если ваше приложение удовлетворяет какому-либо из следующих требований:

* оно является критически важным;
* регулируется соглашением об уровне обслуживания (SLA), которое не допускает более 24 часов простоя;
* его простой может повлечь финансовую ответственность;
* имеет высокую частоту изменения данных, и потеря данных за час не допускается;
* дополнительные затраты на активную георепликацию ниже, чем потенциальная финансовая ответственность и связанная с ней утрата деловых возможностей.

Сколько времени займет восстановление и каковы будут потери данных зависит от того, как вы решите использовать в приложении возможности обеспечения непрерывности бизнес-процессов. Разумеется, вы можете использовать сочетание резервных копий базы данных и активной георепликации, в зависимости от требований приложения. Вопросы разработки приложений для автономных баз данных и пулов эластичных БД, использующих эти возможности обеспечения непрерывности бизнес-процессов, рассматриваются в статьях [Создание приложения для аварийного восстановления облака с использованием активной георепликации в базе данных SQL](sql-database-designing-cloud-solutions-for-disaster-recovery.md) и [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).

В следующих разделах описываются инструкции по восстановлению с использованием резервных копий базы данных или активной георепликации. Подробные инструкции, включающие в себя планирование требований, действия после восстановления и сведения о том, как имитировать сбой для отработки аварийного восстановления, см. в статье [Восстановление базы данных SQL Azure или переход на базу данных-получатель при отказе](sql-database-disaster-recovery.md).

### <a name="prepare-for-an-outage"></a>Подготовка к сбою
Независимо от выбранной функции обеспечения непрерывности бизнес-процессов необходимо выполнить следующее.

* Определите и подготовьте целевой сервер, включая правила брандмауэра уровня сервера, имена для входа и разрешения уровня базы данных master.
* Определите, как клиенты и клиентские приложения будут перенаправляться на новый сервер.
* Задокументируйте прочие зависимости, такие как параметры аудита и оповещения.

Без соответствующей подготовки возобновление работы приложений после отработки отказа или восстановления базы данных занимает больше времени и, вероятно, также требует устранения неполадок во время стрессовой нагрузки, а это весьма неудачное сочетание.

### <a name="fail-over-to-a-geo-replicated-secondary-database"></a>Отработка отказа в геореплицируемую базу данных-получатель
При использовании активной георепликации и групп автоматической отработки отказа в качестве механизма восстановления можно настроить политику автоматической отработки отказа или использовать [ручную отработку отказа](sql-database-disaster-recovery.md#fail-over-to-geo-replicated-secondary-server-in-the-failover-group). После запуска отработка отказа приводит к повышению базы данных-получателя до новой базы данных-источника и делает ее доступной для записи новых транзакций и реагирования на запросы. При этом происходят минимальные потери данных, которые еще не реплицированы. Сведения о разработке процесса отработки отказа см. в статье [Проектирование приложения для облачного аварийного восстановления с использованием активной георепликации в базе данных SQL](sql-database-designing-cloud-solutions-for-disaster-recovery.md).

> [!NOTE]
> После возобновления работы центра обработки данных старые базы данных-источники автоматически переподключаются к новым базам данных-источникам и становятся базами данных-получателями. Если базу данных-источник необходимо повторно переместить в исходный регион, вы можете вручную запустить плановую отработку отказа (восстановление размещения). 
> 

### <a name="perform-a-geo-restore"></a>Процедура геовосстановления
При использовании автоматически создаваемых резервных копий и репликации в геоизбыточное хранилище в качестве механизма восстановления можно [начать восстановление базы данных с помощью геовосстановления](sql-database-disaster-recovery.md#recover-using-geo-restore). Обычно восстановление будет выполнено в пределах 12 часов с потерей данных за период до 1 часа, что зависит от времени создания и репликации последней ежечасной разностной резервной копии. До завершения восстановления база данных не может записывать какие-либо транзакции или отвечать на запросы. Хотя база данных будет восстановлена до последней доступной точки во времени, восстановление геореплицируемых данных до любой точки во времени сейчас не поддерживается.

> [!NOTE]
> Если работа центра обработки данных возобновится до переключения приложения на восстановленную базу данных, то можно будет отменить восстановление.  
>
>

### <a name="perform-post-failover--recovery-tasks"></a>Выполнение задач после восстановления размещения и восстановления
После восстановления посредством любого из механизмов восстановления необходимо выполнить следующие дополнительные задачи, прежде чем данные пользователей и приложений будут заархивированы, а они смогут возобновить работу.

* Перенаправьте клиенты и клиентские приложения на новый сервер и восстановленную базу данных.
* Убедитесь, что заданы соответствующие правила брандмауэра уровня сервера, позволяющие пользователям подключаться (или используйте [брандмауэры уровня базы данных](sql-database-firewall-configure.md#creating-and-managing-firewall-rules)).
* Убедитесь, что заданы соответствующие имена для входа и разрешения уровня базы данных master (или используйте [автономных пользователей](https://msdn.microsoft.com/library/ff929188.aspx)).
* Настройте аудит соответствующим образом.
* Настройте оповещения соответствующим образом.

## <a name="upgrade-an-application-with-minimal-downtime"></a>Обновление приложения с минимальным простоем
Иногда приложение нужно перевести в автономный режим для планового обслуживания, например, чтобы обновить его. В статье [Управление последовательными обновлениями для облачных приложений с помощью активной георепликации базы данных SQL](sql-database-manage-application-rolling-upgrade.md) описывается, как с помощью активной георепликации обеспечить последовательное обновление облачного приложения, чтобы свести к минимуму простой при обновлениях и обеспечить путь восстановления, если случится сбой. 

## <a name="next-steps"></a>Дополнительная информация
Вопросы разработки приложений для автономных баз данных и пулов эластичных БД рассматриваются в статьях [Создание приложения для аварийного восстановления облака с использованием активной георепликации в базе данных SQL](sql-database-designing-cloud-solutions-for-disaster-recovery.md) и [Стратегии аварийного восстановления для приложений с использованием пула эластичных баз данных SQL](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).
