---
title: "Восстановление базы данных SQL Azure из резервной копии | Документация Майкрософт"
description: "В этой статье описывается функция восстановления до точки во времени, позволяющая откатить Базу данных Azure SQL до состояния на момент времени в прошлом (до 35 дней)."
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: monicar
ms.assetid: fd1d334d-a035-4a55-9446-d1cf750d9cf7
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/25/2017
ms.author: carlrab
ms.openlocfilehash: 3b9be28143060537b1a35004c3b3486b8738e956
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="recover-an-azure-sql-database-using-automated-database-backups"></a>Восстановление базы данных Azure SQL с помощью создаваемых автоматически резервных копий
База данных SQL предоставляет такие варианты восстановления базы данных с помощью [создаваемых автоматически резервных копий баз данных](sql-database-automated-backups.md) и [резервных копий в хранилище с включенной функцией долгосрочного хранения](sql-database-long-term-retention.md) Вы можете восстановить из резервной копии базы данных следующее:

* Новую базу данных на том же логическом сервере, восстановленную до указанной точки во времени в пределах срока хранения. 
* Базу данных на том же логическом сервере, восстановленную до момента удаления, если исходная база данных была удалена.
* Новую базу данных на любом логическом сервере в любом регионе, восстановленную до точки во времени последней ежедневной резервной копии в геореплицированном хранилище BLOB-объектов (RA-GRS).

> [!IMPORTANT]
> При восстановлении существующую базу данных невозможно перезаписать.
>

За восстановленную базу данных взимается дополнительная оплата за хранилище при следующих условиях. 
- Восстановление P11–P15 в S4–S12 или P1–P6, если максимальный размер базы данных превышает 500 ГБ.
- Восстановление P1–P6 или PRS1–PRS6 в S4–S12, если максимальный размер базы данных превышает 250 ГБ.

Дополнительная плата связана с тем, что максимальный размер восстановленной базы данных превышает объем хранилища для уровня производительности. За все дополнительные ресурсы хранилища, подготовленные сверх включенного объема, взимается дополнительная плата.  Сведения о ценах на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/).  Если фактический объем пространства, которое используется, меньше, чем включенный объем хранилища, то этих дополнительных затрат можно избежать, уменьшив максимальный размер базы данных до включенного объема. Дополнительные сведения о размерах хранилищ базы данных и изменении максимального размера базы данных см. в разделе [Ограничения ресурсов базы данных SQL Azure](sql-database-resource-limits.md#single-database-storage-sizes-and-performance-levels).  

> [!NOTE]
> [Создаваемые автоматически резервные копии базы данных](sql-database-automated-backups.md) используются при создании [копии базы данных](sql-database-copy.md). 
>


## <a name="recovery-time"></a>Время восстановления
На время восстановления базы данных с использованием создаваемых автоматически резервных копий влияет несколько факторов: 

* размер базы данных;
* уровень производительности базы данных;
* число участвующих журналов транзакций;
* объем операций, которые требуется воспроизвести для восстановления до точки восстановления;
* пропускная способность сети, если выполняется восстановление в другой регион; 
* количество одновременных запросов на восстановление, обрабатываемых в целевом регионе. 
  
  Восстановление очень большой и (или) активной базы данных может занять несколько часов. В случае длительного простоя в регионе возможно появление большого количества запросов на геовосстановление, обрабатываемых другими регионами. Наличие большого числа запросов может увеличить время восстановления баз данных в соответствующем регионе. В большинстве случаев на восстановление базы данных требуется до 12 часов.
  
Возможность массового восстановления встроенными средствами не предусмотрена. Сценарий [База данных SQL Azure: полное восстановление сервера](https://gallery.technet.microsoft.com/Azure-SQL-Database-Full-82941666) является примером одного из способов выполнения этой задачи.

> [!IMPORTANT]
> Чтобы использовать восстановление с помощью автоматически создаваемых резервных копий, нужно быть участником роли "Участник SQL Server" в подписке или владельцем подписки. Выполнить восстановление можно с помощью портала Azure, PowerShell или REST API. Использовать для этого Transact-SQL невозможно. 
> 

## <a name="point-in-time-restore"></a>Восстановление до точки во времени

Вы можете восстановить существующую базу данных до предшествующей точки во времени как новую базу данных на том же логическом сервере с помощью портала Azure, [PowerShell](https://docs.microsoft.com/en-us/powershell/module/azurerm.sql/restore-azurermsqldatabase) или [REST API](https://msdn.microsoft.com/library/azure/mt163685.aspx). 

> [!TIP]
> Пример сценария PowerShell, показывающий, как выполнить восстановление базы данных до точки во времени, приведен в разделе [Восстановление базы данных SQL с помощью PowerShell](scripts/sql-database-restore-database-powershell.md).
>

Базу данных можно восстановить для любого уровня служб или уровня производительности как отдельную базу данных либо как базу данных в эластичном пуле. Убедитесь, что на логическом сервере или в эластичном пуле, в который выполняется восстановление базы данных, достаточно ресурсов. После завершения восстановленная вы получите обычную полностью доступную базу данных в сети. Использование восстановленной базы данных оплачивается по обычным тарифам на основе уровня служб и уровня производительности. Плата не взимается до завершения восстановления базы данных.

Обычно база данных восстанавливается до более ранней точки во времени. Таким образом восстановленную базу данных можно рассматривать как замену исходной базы данных или же использовать для извлечения данных, чтобы затем обновить исходную базу данных. 

* ***Замена базы данных.*** Если восстановленная база данных предназначена для замены исходной базы данных, то следует проверить, настроен ли для нее соответствующий уровень производительности и (или) служб, и при необходимости масштабировать эту базу данных. Можно переименовать исходную базу данных, а затем присвоить восстановленной базе данных исходное имя с помощью команды ALTER DATABASE в T-SQL. 
* ***Восстановление данных.*** Если вы планируете извлечь данные из восстановленной базы данных для восстановления после ошибки пользователя или приложения, то потребуется создать и выполнить сценарии восстановления данных, необходимые для извлечения данных из восстановленной базы данных в исходную. Несмотря на то, что операция восстановления может занять много времени, восстанавливаемая база данных будет отображаться в списке баз данных на протяжении всего процесса. Если удалить эту базу данных во время восстановления, то операция будет отменена и плата за базу данных, восстановление которой не было завершено, взиматься не будет. 

### <a name="azure-portal"></a>Портал Azure

Чтобы выполнить восстановление до точки во времени с помощью портала Azure, откройте страницу для базы данных и щелкните **Восстановление** на панели инструментов.

![point-in-time-restore](./media/sql-database-recovery-using-backups/point-in-time-recovery.png)

## <a name="deleted-database-restore"></a>Восстановление удаленной базы данных
Вы можете восстановить удаленную базу данных до момента удаления на том же логическом сервере с помощью портала Azure, [PowerShell](https://docs.microsoft.com/en-us/powershell/module/azurerm.sql/restore-azurermsqldatabase) или [REST (createMode=Restore)](https://msdn.microsoft.com/library/azure/mt163685.aspx). 

> [!TIP]
> Пример сценария PowerShell, показывающий, как восстановить удаленную базу данных, приведен в разделе [Восстановление базы данных SQL с помощью PowerShell](scripts/sql-database-restore-database-powershell.md).
>

> [!IMPORTANT]
> При удалении экземпляра сервера базы данных SQL Azure все базы данных, находившиеся на нем, также будут удалены без возможности восстановления. В настоящее время восстановление удаленного сервера не поддерживается.
> 

### <a name="azure-portal"></a>Портал Azure

Чтобы восстановить удаленную базу данных в течение [срока хранения](sql-database-service-tiers.md) с помощью портала Azure, откройте страницу сервера и в области операций щелкните **Удаленные базы данных**.

![deleted-database-restore-1](./media/sql-database-recovery-using-backups/deleted-database-restore-1.png)


![deleted-database-restore-2](./media/sql-database-recovery-using-backups/deleted-database-restore-2.png)

## <a name="geo-restore"></a>Геовосстановление
Можно восстановить базу данных SQL на любой сервер в любом регионе Azure из последней геореплицированной полной или разностной резервной копии. В качестве источника геовосстановление использует геоизбыточную резервную копию для восстановления базы данных, даже если она или центр обработки данных недоступны из-за сбоя. 

Геовосстановление используется по умолчанию, когда база данных недоступна из-за происшествия в регионе, в котором она размещена. Если масштабная авария в регионе приведет к недоступности приложения базы данных, то базу данных можно будет восстановить из геореплицированных резервных копий на сервер в любом другом регионе. Между созданием разностной резервной копии и ее георепликацией в большой двоичный объект Azure в другом регионе существует задержка. Эта задержка может длиться до часа, поэтому в случае аварии возможна потеря данных за час или менее. На следующем рисунке показано восстановление базы данных из последней доступной резервной копии в другом регионе.

![Геовосстановление](./media/sql-database-geo-restore/geo-restore-2.png)

> [!TIP]
> Пример сценария PowerShell, показывающий, как выполнить геовосстановление, приведен в разделе [Восстановление базы данных SQL с помощью PowerShell](scripts/sql-database-restore-database-powershell.md).
> 

Восстановление до точки во времени для базы данных-получателя геореплицируемых данных в настоящее время не поддерживается. Восстановление до точки во времени может выполняться только для базы данных-источника. Дополнительные сведения об использовании геовосстановления для восстановления после сбоя см. в статье [Восстановление базы данных SQL Azure или переход на базу данных-получатель при отказе](sql-database-disaster-recovery.md).

> [!IMPORTANT]
> Восстановление из резервных копий — это наиболее простое из решений аварийного восстановления, доступных в Базе данных SQL, с наибольшими значениями RPO и предполагаемого времени восстановления (ERT). Для решений, использующих базы данных уровня "Базовый", геовосстановление часто предусматривает решение аварийного восстановления с ERT, равного 12 часам. В решениях, использующих базы данных уровня "Стандартный" или "Премиум", для которых требуется минимизировать интервалы восстановления, мы рекомендуем использовать [активную георепликацию](sql-database-geo-replication-overview.md). Активная георепликация обеспечивает более низкие значения RPO и ERT, так как требует только инициировать отработку отказа для перехода на непрерывно реплицируемую базу данных-получатель. Дополнительные сведения о непрерывности бизнес-процессов см. в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](sql-database-business-continuity.md).
> 

### <a name="azure-portal"></a>Портал Azure

Для геовосстановления базы данных в течение [срока хранения](sql-database-service-tiers.md) с помощью портала Azure, откройте страницу базы данных SQL и щелкните **Добавить**. В текстовом поле **Выбрать источник** выберите **Резервная копия**. Укажите, из какой резервной копии будет выполняться восстановление в регионе и на сервере по своему усмотрению. 

## <a name="programmatically-performing-recovery-using-automated-backups"></a>Программное восстановление с помощью создаваемых автоматически резервных копий
Как уже говорилось ранее, в дополнение к порталу Azure восстановление базы данных можно выполнить программно, с помощью Azure PowerShell или REST API. В приведенных ниже таблицах описан доступный для этого набор команд.

### <a name="powershell"></a>PowerShell
| Командлет | Описание |
| --- | --- |
| [Get-AzureRmSqlDatabase](/powershell/module/azurerm.sql/get-azurermsqldatabase) |Получает одну или несколько баз данных. |
| [Get-AzureRMSqlDeletedDatabaseBackup](/powershell/module/azurerm.sql/get-azurermsqldeleteddatabasebackup) | Получает удаленную базу данных, которую можно восстановить. |
| [Get-AzureRmSqlDatabaseGeoBackup](/powershell/module/azurerm.sql/get-azurermsqldatabasegeobackup) |Получает геоизбыточную резервную копию базы данных. |
| [Restore-AzureRmSqlDatabase](/powershell/module/azurerm.sql/restore-azurermsqldatabase) |Восстанавливает базу данных SQL. |
|  | |

### <a name="rest-api"></a>REST API
| API | Описание |
| --- | --- |
| [REST (createMode=Recovery)](https://msdn.microsoft.com/library/azure/mt163685.aspx) |Восстанавливает базу данных. |
| [Получение, создание или обновление состояния базы данных](https://msdn.microsoft.com/library/azure/mt643934.aspx) |Возвращает состояние во время операции восстановления. |
|  | |

## <a name="summary"></a>Сводка
Создаваемые автоматически резервные копии позволяют защитить базы данных от ошибок пользователей и приложений, случайного удаления базы данных и длительных простоев. Эта встроенная возможность доступна для всех уровней служб и уровней производительности. 

## <a name="next-steps"></a>Дальнейшие действия
* Сведения об обеспечении непрерывности бизнес-процессов и возможные сценарии описаны в [обзоре непрерывности бизнес-процессов](sql-database-business-continuity.md)
* Чтобы узнать об автоматически создаваемых резервных копиях базы данных SQL Azure, ознакомьтесь с разделом [создаваемых автоматически резервных копий базы данных SQL](sql-database-automated-backups.md)
* Дополнительные сведения о долгосрочном хранении резервных копий см. в статье [Хранение резервных копий базы данных SQL Azure до 10 лет](sql-database-long-term-retention.md).
* Сведения о настройке и администрировании долгосрочного хранения создаваемых автоматически резервных копий в хранилище служб восстановления Azure, а также о восстановлении с помощью таких резервных копий на портале Azure см. в статье [Configure and use long-term backup retention](sql-database-long-term-backup-retention-configure.md) (Настройка и использование долгосрочного хранения резервных копий баз данных). 
* Чтобы узнать о более быстрых вариантах восстановления, ознакомьтесь со сведениями об [активной георепликации](sql-database-geo-replication-overview.md).  
