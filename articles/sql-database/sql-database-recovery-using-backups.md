---
title: "Непрерывность облачных бизнес-процессов — восстановление удаленной базы данных — база данных SQL | Документация Майкрософт"
description: "В этой статье описывается функция восстановления до точки во времени, позволяющая откатить Базу данных Azure SQL до состояния на момент времени в прошлом (до 35 дней)."
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: monicar
ms.assetid: fd1d334d-a035-4a55-9446-d1cf750d9cf7
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 11/11/2016
ms.author: sstein
translationtype: Human Translation
ms.sourcegitcommit: 14ba9a0d5a373dc46fcb38ad157e97496311c0d3
ms.openlocfilehash: 9db1ce94e4cfdf6caadb22111ffe05afb96220d1


---
# <a name="recover-an-azure-sql-database-using-automated-database-backups"></a>Восстановление базы данных Azure SQL с помощью создаваемых автоматически резервных копий
База данных SQL предоставляет три варианта восстановления базы данных с помощью [создаваемых автоматически резервных копий базы данных SQL](sql-database-automated-backups.md). Вы можете восстановить базу данных из резервных копий, инициированных службой, в пределах их [срока хранения](sql-database-service-tiers.md) в:

* Новую базу данных на том же логическом сервере, восстановленную до указанной точки во времени в пределах срока хранения. 
* Базу данных на том же логическом сервере, восстановленную до момента удаления, если исходная база данных была удалена.
* Новую базу данных на любом логическом сервере в любом регионе, восстановленную до последней ежедневной резервной копии в геореплицированном хранилище BLOB-объектов (RA-GRS).

Чтобы создать на любом логическом сервере в любом регионе [копию базы данных](sql-database-copy.md), транзакционно согласованную с текущей базой данных SQL, можно также использовать [автоматически создаваемые резервные копии базы данных SQL](sql-database-automated-backups.md). Вы можете использовать копию базы данных и [экспортировать ее в BACPAC-файл](sql-database-export.md) , чтобы заархивировать транзакционно согласованную копию базы данных для долгосрочного хранения, превышающего срок хранения, или передачи в локальный экземпляр SQL Server или экземпляр SQL Server на виртуальной машине Azure.

## <a name="recovery-time"></a>Время восстановления
На время восстановления базы данных с использованием создаваемых автоматически резервных копий влияет несколько факторов: 

* размер базы данных;
* уровень производительности базы данных;
* число участвующих журналов транзакций;
* объем операций, которые требуется воспроизвести для восстановления до точки восстановления;
* пропускная способность сети, если выполняется восстановление в другой регион; 
* количество одновременных запросов на восстановление, обрабатываемых в целевом регионе. 
  
  Восстановление очень большой и (или) активной базы данных может занять несколько часов. В случае длительного простоя в регионе возможно появление большого количества запросов на геовосстановление, обрабатываемых другими регионами. При наличии большого числа запросов это может увеличить время восстановления баз данных в соответствующем регионе. В большинстве случаев на восстановление базы данных требуется до 12 часов.
  
  Возможность массового восстановления встроенными средствами не предусмотрена. Сценарий [База данных SQL Azure: полное восстановление сервера](https://gallery.technet.microsoft.com/Azure-SQL-Database-Full-82941666) является примером одного из способов выполнения этой задачи.

> [!IMPORTANT]
> Чтобы использовать восстановление с помощью автоматически создаваемых резервных копий, нужно быть участником роли "Участник SQL Server" в подписке или владельцем подписки. Выполнить восстановление можно с помощью портала Azure, PowerShell или REST API. Использовать для этого Transact-SQL невозможно. 
> 
> 

## <a name="point-in-time-restore"></a>Восстановление до точки во времени
Функция восстановления до точки во времени позволяет восстановить существующую базу данных до момента времени в прошлом в виде новой базы данных с помощью [автоматически создаваемых резервных копий базы данных SQL](sql-database-automated-backups.md). Существующую базу данных невозможно перезаписать. Базу данных можно восстановить до точки во времени в прошлом с помощью [портала Azure](sql-database-point-in-time-restore-portal.md), [PowerShell](sql-database-point-in-time-restore-powershell.md) или [REST API](https://msdn.microsoft.com/library/azure/mt163685.aspx).


Базу данных можно восстановить до любого уровня производительности и в любом пуле эластичных БД. Необходимо убедиться в достаточности имеющейся квоты DTU на логический сервер или пул эластичных БД. Помните, что при восстановлении создается новая база данных, а уровень служб и производительности восстановленной базы данных может отличаться от текущего состояния работающей базы данных. Восстановленная база данных — это обычная полностью доступная оперативная база данных, пользование которой оплачивается по обычной тарификации на основе уровня служб и производительности. Плата не взимается до завершения восстановления базы данных.

Обычно база данных восстанавливается до более ранней точки во времени. Таким образом восстановленную базу данных можно рассматривать как замену исходной базы данных или же использовать для извлечения данных, чтобы затем обновить исходную базу данных. 

* ***Замена базы данных.*** Если восстановленная база данных предназначена для замены исходной базы данных, то следует проверить, настроен ли для нее соответствующий уровень производительности и (или) служб, и при необходимости масштабировать эту базу данных. Можно переименовать исходную базу данных, а затем присвоить восстановленной базе данных исходное имя с помощью команды ALTER DATABASE в T-SQL. 
* ***Восстановление данных.*** Если вы планируете извлечь данные из восстановленной базы данных для восстановления после ошибки пользователя или приложения, то потребуется отдельно создать и выполнить всевозможные сценарии восстановления данных, необходимые для извлечения данных из восстановленной базы данных в исходную. Несмотря на то, что операция восстановления может занять много времени, восстанавливаемая база данных будет отображаться в списке баз данных на протяжении всего процесса. Если удалить эту базу данных во время восстановления, то операция будет отменена и плата за базу данных, восстановление которой не было завершено, взиматься не будет. 

Дополнительные сведения об использовании восстановления до точки во времени после ошибок пользователей и приложений см. в разделе [Восстановление до точки во времени](sql-database-recovery-using-backups.md#point-in-time-restore).

## <a name="deleted-database-restore"></a>Восстановление удаленной базы данных
Эта функция позволяет восстановить существующую базу данных до момента удаления на том же логическом сервере с помощью [автоматически создаваемых резервных копий базы данных SQL](sql-database-automated-backups.md). 

> [!IMPORTANT]
> При удалении экземпляра сервера базы данных SQL Azure все базы данных, находившиеся на нем, также будут удалены без возможности восстановления. В настоящее время восстановление удаленного сервера не поддерживается.
> 
> 

Для восстановленной базы данных можно использовать прежнее или новое имя. Это можно сделать с помощью [портала Azure](sql-database-restore-deleted-database-portal.md), [PowerShell](sql-database-restore-deleted-database-powershell.md) или [REST (createMode=Restore)](https://msdn.microsoft.com/library/azure/mt163685.aspx). 


## <a name="geo-restore"></a>Геовосстановление
Геовосстановление позволяет восстановить базу данных SQL на любой сервер в любом регионе Azure из самой последней геореплицированной [ежедневной автоматически создаваемой резервной копии](sql-database-automated-backups.md). В качестве источника геовосстановление использует геоизбыточную резервную копию для восстановления базы данных, даже если она или центр обработки данных недоступны из-за сбоя. Это можно сделать с помощью [портала Azure](sql-database-geo-restore-portal.md), [PowerShell](sql-database-geo-restore-powershell.md) или [REST (createMode=Recovery)](https://msdn.microsoft.com/library/azure/mt163685.aspx). 


Геовосстановление используется по умолчанию, когда база данных недоступна из-за происшествия в регионе, где она размещена. Если масштабный инцидент в регионе приведет к недоступности приложения базы данных, с помощью геовосстановления можно будет восстановить базу данных из последней резервной копии на сервер в любом другом регионе. Все резервные копии географически реплицируются, поэтому создание резервной копии и георепликация в BLOB-объект Azure в другом регионе может выполняться с задержкой. Эта задержка может длиться до часа, поэтому в случае аварии возможна потеря данных за час или менее (т. е. значение целевой точки восстановления составит до 1 часа). Ниже показано восстановление базы данных из последней ежедневной резервной копии.

![Геовосстановление](./media/sql-database-geo-restore/geo-restore-2.png)

Дополнительные сведения об использовании геовосстановления для восстановления после сбоя см. в статье [Восстановление базы данных SQL Azure или переход на базу данных-получатель при отказе](sql-database-disaster-recovery.md).

> [!IMPORTANT]
> Хотя геовосстановление доступно для всех уровней обслуживания, это наиболее простое из решений аварийного восстановления, доступных в базе данных SQL с наибольшими значениями RPO и предполагаемого времени восстановления (ERT). Для баз данных уровня "Базовый" с максимальным размером 2 ГБ геовосстановление предусматривает аварийное восстановление с ERT 12 часов. Если требуется минимизировать интервалы восстановления и риск потери данных для более крупных баз данных уровня "Стандартный" или "Премиум", мы рекомендуем использовать активную георепликацию. Активная георепликация обеспечивает более низкие значения RPO и ERT, так как требует только инициировать переход на непрерывно реплицируемую базу данных-получатель. Дополнительные сведения см. в статье [Обзор: активная георепликация для базы данных SQL](sql-database-geo-replication-overview.md).
> 
> 

## <a name="programmatically-performing-recovery-using-automated-backups"></a>Программное восстановление с помощью создаваемых автоматически резервных копий
Как уже говорилось ранее, в дополнение к порталу Azure восстановление базы данных можно выполнить программно, с помощью Azure PowerShell и REST API. В приведенных ниже таблицах описан набор команд, доступных для этого.

### <a name="powershell"></a>PowerShell
| Командлет | Описание |
| --- | --- |
| [Get-AzureRmSqlDatabase](https://msdn.microsoft.com/en-us/library/azure/mt603648.aspx) |Получает одну или несколько баз данных. |
| [Get-AzureRMSqlDeletedDatabaseBackup](https://msdn.microsoft.com/en-us/library/azure/mt693387.aspx) |Получает удаленную базу данных, которую можно восстановить. |
| [Get-AzureRmSqlDatabaseGeoBackup](https://msdn.microsoft.com/library/azure/mt693388.aspx) |Получает геоизбыточную резервную копию базы данных. |
| [Restore-AzureRmSqlDatabase](https://msdn.microsoft.com/library/azure/mt693390.aspx) |Восстанавливает базу данных SQL. |
|  | |

### <a name="rest-api"></a>REST API
| API | Описание |
| --- | --- |
| [REST (createMode=Recovery)](https://msdn.microsoft.com/library/azure/mt163685.aspx) |Восстанавливает базу данных. |
| [Получение, создание или обновление состояния базы данных](https://msdn.microsoft.com/library/azure/mt643934.aspx) |Возвращает состояние во время операции восстановления. |
|  | |

## <a name="summary"></a>Сводка
Создаваемые автоматически резервные копии позволяют защитить базы данных от ошибок пользователей и приложений, случайного удаления базы данных и длительных простоев. Это бесплатное решение, которое не требует участия администратора и доступно для всех баз данных SQL. 

## <a name="next-steps"></a>Дальнейшие действия
* Сведения об обеспечении непрерывности бизнес-процессов и возможные сценарии описаны в [обзоре непрерывности бизнес-процессов](sql-database-business-continuity.md)
* Чтобы узнать об автоматически создаваемых резервных копиях базы данных SQL Azure, ознакомьтесь с разделом [создаваемых автоматически резервных копий базы данных SQL](sql-database-automated-backups.md)
* Чтобы узнать о более быстрых вариантах восстановления, ознакомьтесь с [активной георепликацией](sql-database-geo-replication-overview.md)  
* Чтобы узнать об использовании автоматически создаваемых резервных копий для архивации, ознакомьтесь с [копированием базы данных](sql-database-copy.md)




<!--HONumber=Nov16_HO3-->


