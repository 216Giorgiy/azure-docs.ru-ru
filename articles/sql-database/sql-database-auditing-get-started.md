<properties
	pageTitle="Приступая к работе с аудитом базы данных SQL | Microsoft Azure"
	description="Приступая к работе с аудитом базы данных SQL"
	services="sql-database"
	documentationCenter=""
	authors="jeffgoll"
	manager="jeffreyg"
	editor=""/>

<tags
	ms.service="sql-database"
	ms.workload="data-management"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="02/03/2016"
	ms.author="jeffreyg; ronitr"/>
 
# Приступая к работе с аудитом базы данных SQL
Аудит базы данных Azure отслеживает события базы данных и записывает их в журнал аудита, расположенный в учетной записи хранения Azure. Функция аудита доступна для уровней Basic, Standard и Premium.

Аудит может помочь вам соблюсти требования нормативов, проанализировать работу с базой данных и получить представление о расхождениях и аномалиях, которые могут указывать на бизнес-проблемы или предполагаемые нарушения безопасности.

Средства аудита позволяют и способствуют соблюдению стандартов, но не гарантируют соответствия им. Дополнительные сведения о программах Azure, поддерживающих проверку соблюдения стандартов, см. [Центр управления безопасностью Azure](https://azure.microsoft.com/support/trust-center/compliance/).

+ [Основы аудита баз данных SQL Azure]
+ [Настройка аудита базы данных]
+ [Анализ журналов и отчетов аудита]

##<a id="subheading-1"></a>Основы аудита баз данных SQL Azure

В следующих разделах описывается настройка аудита на портале Azure. Кроме того, вы можете [настроить аудит базы данных с помощью классического портала Azure].

Аудит базы данных SQL позволяет:

- **Сохранить** журнал аудита выбранных событий. Вы можете указать, какие категории действий базы данных должны проходить аудит.
- **Создавать отчеты** по действиям, производимым с базой данных. Вы можете использовать предварительно настроенные отчеты и панель мониторинга для быстрого начала работы с отчетностью по действиям и событиям.
- **Анализировать** отчеты. Вы можете искать подозрительные события, необычную деятельность и тенденции.

> [AZURE.NOTE] Новая функция **обнаружения угроз**, доступная на данном этапе в предварительной версии, позволяет настроить упреждающие оповещения об аномальной активности в базах данных, которая может указывать на потенциальные угрозы безопасности. Обнаружение угроз включается и настраивается в колонке настройки аудита. Дополнительные сведения см. в статье [Приступая к работе с системой обнаружения угроз](sql-database-threat-detection-get-started.md).

Аудит можно настроить для событий следующих категорий:

**Простой SQL** и **параметризованный SQL**, для которого собранные журналы аудита классифицируются как:

- **Доступ к данным**
- **Изменения в схеме данных (DDL)**
- **Изменения данных (DML)**
- **Учетные записи, роли и разрешения (DCL)**
- **Хранимая процедура**, **Вход в систему** и **Управления транзакциями**.

Для каждой категории событий **успешные** и **неуспешные** операции аудита настраиваются отдельно.

Дополнительные сведения об аудируемых действиях и событиях см. [справочнике по формату журнала аудита (скачиваемый DOC-файл)](http://go.microsoft.com/fwlink/?LinkId=506733).

Журналы аудита хранятся в учетной записи хранения Azure. Срок хранения журналов аудита можно настроить.

Политику аудита можно определить для конкретной базы данных или как политику сервера по умолчанию. Политика аудита по умолчанию применяется ко всем базам данных на сервере, для которых не установлена иная переопределяющая политика аудирования базы данных.

Если вы пользуетесь [клиентом прежних версий](sql-database-auditing-and-dynamic-data-masking-downlevel-clients.md), перед настройкой аудита проверьте контроль аудирования.


##<a id="subheading-2"></a>Настройка аудита базы данных

1. Откройте [портал Azure](https://portal.azure.com) по адресу: https://portal.azure.com. Или откройте [классический портал Azure](https://manage.windowsazure.com/) по адресу: https://manage.windowsazure.com/. См. подробности ниже.

2. Перейдите в колонку параметров базы данных SQL или SQL Server, где нужно выполнить аудит. В колонке «Параметры» выберите **Аудит и обнаружение угроз**.

	![Область навигации][1]

3. В колонке настройки аудита выберите параметр **ВКЛ**.

4. Выберите **Сведения о хранилище**, чтобы открыть колонку хранилища журналов аудита. Выберите учетную запись хранения Azure, где будут храниться журналы, и укажите срок хранения. **Совет.** Для того чтобы в полной мере воспользоваться возможностями шаблонов отчетов об аудите, используйте одну и ту же учетную запись хранения для всех баз данных.

	![Область навигации][2]

5. Щелкните **События аудита**, чтобы указать, какие события требуют аудита. В колонке **Журнал событий** щелкните **Успех** и **Отказ**, чтобы включить в журнал все события, или выберите отдельные категории событий.


6. Установленный флажок **Наследовать настройки аудита от сервера** означает, что аудит базы данных будет выполняться в соответствии с настройками сервера. Установив этот флажок, вы увидите ссылку, позволяющую просмотреть или изменить параметры аудита сервера.

	![Область навигации][3]

7. После настройки параметров аудита можно **включить** обнаружение угроз и указать адреса электронной почты для получения предупреждений системы безопасности. Дополнительные сведения см. на странице [Приступая к работе с системой обнаружения угроз](sql-database-threat-detection-get-started.md).

8. Щелкните **Сохранить**.



##<a id="subheading-3"></a>Анализ журналов и отчетов аудита

Журналы аудита объединяются в коллекцию таблиц хранилища с префиксом **SQLDBAuditLogs** в учетной записи хранилища Azure, выбранной во время установки. Просматривать файлы журнала можно с помощью таких средств, как [Обозреватель хранилищ Azure](http://azurestorageexplorer.codeplex.com/).

Для скачивания доступен предварительно настроенный шаблон отчета в виде [скачиваемой таблицы Excel](http://go.microsoft.com/fwlink/?LinkId=403540), что позволит быстро проанализировать данные журнала. Для того, чтобы использовать шаблон с вашими журналами аудита, вам потребуется Excel 2013 и выше и Power Query, который можно загрузите по [этой ссылке](http://www.microsoft.com/download/details.aspx?id=39379).

С помощью Power Query журналы аудита можно импортировать в шаблон Excel непосредственно из учетной записи хранения Azure. После этого вы сможете просматривать записи аудита и создавать панели управления и отчеты на основе данных журнала.


![Область навигации][4]


##<a id="subheading-4"></a>Настройка аудита базы данных с помощью классического портала Azure

1. Откройте [классический портал Azure](https://manage.windowsazure.com/) по адресу: https://manage.windowsazure.com/.

2. Выберите базу данных SQL или SQL Server, для которого нужно выполнить аудит, и откройте вкладку **АУДИТ И БЕЗОПАСНОСТЬ**.

3. Выберите для параметра "Аудит" значение **ВКЛЮЧЕНО**.

	![Область навигации][5]

4. Укажите, какие события требуют аудита, выбрав необходимые параметры для **ЖУРНАЛА СОБЫТИЙ**.

	![Область навигации][6]

5. Выберите **УЧЕТНУЮ ЗАПИСЬ ХРАНЕНИЯ** и настройте **ХРАНЕНИЕ**.

	![Область навигации][7]

6. Щелкните **СОХРАНИТЬ**.




##<a id="subheading-5">Рекомендации по использованию в рабочей среде</a>
Описания в этом разделе относятся к снимкам экрана выше. Можно использовать [портал Azure](https://portal.azure.com) или [классический портал Azure](https://manage.windowsazure.com/).


##<a id="subheading-6"></a>Повторное создание ключа хранилища

Обычно, в рабочей среде приходится периодически обновлять ключи хранилища. При обновлении ключей необходимо сохранить политику аудирования повторно. Вот как это можно сделать:


1. В колонке настройки аудита измените значение параметра **Ключ доступа к хранилищу** с *Первичный* на *Вторичный* и нажмите кнопку **СОХРАНИТЬ**.

	![][8]

2. Перейдите в колонку конфигурации хранилища и **повторно создайте** *первичный ключ доступа*.

3. В колонке настройки аудита измените значение параметра **Ключ доступа к хранилищу** с *Вторичный* на *Первичный* и нажмите кнопку **СОХРАНИТЬ**.

4. В пользовательском интерфейсе хранилища **повторно создайте** *вторичный ключ доступа* (для подготовки к следующему циклу обновления ключей).
  
##<a id="subheading-7"></a>Автоматизация
Существует несколько командлетов PowerShell, которые можно использовать для настройки аудита в базе данных SQL Azure:

- [Get-AzureRMSqlDatabaseAuditingPolicy](https://msdn.microsoft.com/library/azure/mt603731.aspx)
- [Get-AzureRMSqlServerAuditingPolicy](https://msdn.microsoft.com/library/azure/mt619329.aspx)
- [Remove-AzureRMSqlDatabaseAuditing](https://msdn.microsoft.com/library/azure/mt603796.aspx)
- [Remove-AzureRMSqlServerAuditing](https://msdn.microsoft.com/library/azure/mt603574.aspx)
- [Set-AzureRMSqlDatabaseAuditingPolicy](https://msdn.microsoft.com/library/azure/mt603531.aspx)
- [Set-AzureRMSqlServerAuditingPolicy](https://msdn.microsoft.com/library/azure/mt603794.aspx)
- [Use-AzureRMSqlServerAuditingPolicy](https://msdn.microsoft.com/library/azure/mt619353.aspx)




<!--Anchors-->
[Основы аудита баз данных SQL Azure]: #subheading-1
[Настройка аудита базы данных]: #subheading-2
[Анализ журналов и отчетов аудита]: #subheading-3
[настроить аудит базы данных с помощью классического портала Azure]: #subheading-4
[Practices for usage in production]: #subheading-5
[Storage Key Regeneration]: #subheading-6
[Automation]: #subheading-7


<!--Image references-->
[1]: ./media/sql-database-auditing-get-started/1_auditing_get_started_settings.png
[2]: ./media/sql-database-auditing-get-started/2_auditing_get_started_storage_account.png
[3]: ./media/sql-database-auditing-get-started/3_auditing_get_started_inherit_from_server.png
[4]: ./media/sql-database-auditing-get-started/4_auditing_get_started_report_template.png
[5]: ./media/sql-database-auditing-get-started/5_auditing_get_started_classic_portal_enable.png
[6]: ./media/sql-database-auditing-get-started/6_auditing_get_started_classic_portal_events.png
[7]: ./media/sql-database-auditing-get-started/7_auditing_get_started_classic_portal_storage.png
[8]: ./media/sql-database-auditing-get-started/8_auditing_get_started_storage_key_rotation.png


 

<!---HONumber=AcomDC_0204_2016-->