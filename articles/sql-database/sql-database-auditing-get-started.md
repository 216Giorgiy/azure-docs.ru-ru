<properties 
	pageTitle="Приступая к работе с аудитом базы данных SQL | Azure" 
	description="Приступая к работе с аудитом базы данных SQL" 
	services="sql-database" 
	documentationCenter="" 
	authors="jeffgoll" 
	manager="jeffreyg" 
	editor=""/>

<tags 
	ms.service="sql-database" 
	ms.workload="data-management" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="06/01/2015" 
	ms.author="jeffreyg"/>
 
# Приступая к работе с аудитом базы данных SQL 
<p> Аудит базы данных SQL Azure отслеживает события базы данных и записывает их в журнал аудита, расположенный в учетной записи хранения Azure. Функция аудита доступна для уровней Basic, Standard и Premium.

Аудит может помочь вам соблюсти требования нормативов, проанализировать работу с базой данных и получить представление о расхождениях и аномалиях, которые могут указывать на бизнес-проблемы или предполагаемые нарушения безопасности.

Средства аудита позволяют и способствуют соблюдению стандартов, но не гарантируют соответствия им. Дополнительную информацию о программах Azure, поддерживающих проверку соблюдения стандартов, см. в <a href="http://azure.microsoft.com/support/trust-center/compliance/" target="_blank">Центре управления безопасностью Azure</a>.

+ [Основы аудита баз данных SQL Azure] 
+ [Настройка аудита базы данных]
+ [Анализ журналов и отчетов аудита]

##<a id="subheading-1"></a>Основы аудита баз данных SQL Azure

В следующих разделах описывается настройка аудита через портал предварительной версии Azure. См. также раздел [Настройка аудита базы данных с помощью классического портала Azure].

Аудит базы данных SQL позволяет:

- **Сохранить** журнал аудита выбранных событий. Вы можете указать, какие категории действий базы данных должны проходить аудит.
- **Создавать отчеты** по действиям, производимым с базой данных. Вы можете использовать предварительно настроенные отчеты и панель мониторинга для быстрого начала работы с отчетностью по действиям и событиям.
- **Анализировать** отчеты. Вы можете искать подозрительные события, необычную деятельность и тенденции.

Аудит можно настроить для событий следующих категорий:

**Простой SQL** и **параметризованный SQL**, для которого собранные журналы аудита классифицируются как:

- **Доступ к данным**
- **Изменения в схеме данных (DDL)**
- **Изменения данных (DML)**
- **Учетные записи, роли и разрешения (DCL)**

**Хранимая процедура**, **Вход в систему** и **Управления транзакциями**.

Для каждой категории событий **успешный** и **неуспешные** операции аудита настраиваются отдельно.

Дополнительные сведения об аудируемых действиях и событиях см. в разделе <a href="http://go.microsoft.com/fwlink/?LinkId=506733" target="_blank">Справочник по формату журнала аудита (DOC)</a>.

Журналы аудита хранятся в учетной записи хранения Azure. Срок хранения журнала аудита можно установить.

Политику аудита можно определить для конкретной базы данных или как политику сервера по умолчанию. Политика аудита по умолчанию применяется ко всем базам данных на сервере, для которых не установлена иная переопределяющая политика аудирования базы данных.

Если вы пользуетесь [клиентом прежних версий](sql-database-auditing-and-dynamic-data-masking-downlevel-clients.md), перед настройкой аудита проверьте контроль аудирования.


##<a id="subheading-2"></a>Настройка аудита базы данных

1. Запустите <a href="https://portal.azure.com" target="_blank">портал предварительной версии Azure</a> на https://portal.azure.com либо <a href= "https://manage.windowsazure.com/" target="_bank">классический портала Azure</a> на https://manage.windowsazure.com/. См. подробности ниже.

2. Перейдите в колонку конфигурации базы данных SQL или SQL Server, для которой нужно выполнить аудит. Нажмите в верхней части кнопку **Параметры**, а затем в колонке "Параметры" выберите **Аудит**.

	![][1]

3. В колонке конфигурации аудита выберите СВЕДЕНИЯ О ХРАНИЛИЩЕ, чтобы открыть колонку хранилищ для журналов аудита. Выберите учетную запись хранения Azure, в котором будут хранится журналы, и укажите срок хранения. **Совет.** Для того чтобы в полной мере воспользоваться возможностями шаблонов предварительно настроенных отчетов, используйте одну и ту же учетную запись хранения для всех баз данных.

	![][2]

4. В разделе **ВЕДЕНИЕ ЖУРНАЛА ПО СОБЫТИЯМ** щелкните **УСПЕШНО** и **СБОЙ**, чтобы включить в журнал все события, или выберите отдельные категории событий.


5. При настройке аудита для базы данных SQL выберите параметр **Для принудительного аудита щелкните здесь...**, а затем в разделе **БЕЗОПАСНЫЙ ДОСТУП** выберите **ОБЯЗАТЕЛЬНО**. При настройке аудита для SQL Server возможны два варианта: (1) после выполнения шага 6 перейдите к каждой базе данных SQL на сервере и выполните этот шаг либо (2) [измените FDQN сервера в строке подключения](sql-database-auditing-and-dynamic-data-masking-downlevel-clients.md).


	![][5]

6. Нажмите кнопку **ОК**.



##<a id="subheading-3">Анализ журналов и отчетов аудита</a>

Журналы аудита объединяются в коллекцию таблиц хранилища с префиксом **SQLDBAuditLogs** в учетной записи хранилища Azure, выбранной во время установки. Просматривать файлы журнала можно с помощью таких инструментов, как <a href="http://azurestorageexplorer.codeplex.com/" target="_blank">обозреватель хранилищ Azure</a>.

Для скачивания доступен предварительно настроенный шаблон отчета панели мониторинга в виде <a href="http://go.microsoft.com/fwlink/?LinkId=403540" target="_blank">таблицы Excel</a>, что позволит быстро проанализировать данные журнала. Чтобы использовать шаблон с вашими журналами аудита, вам потребуется Excel 2013 или более поздней версии и Power Query, который можно скачать по этой <a href="http://www.microsoft.com/download/details.aspx?id=39379">ссылке</a>.

В шаблоне приведен пример вымышленных данных, вы можете настроить Power Query для импорта журнала аудита непосредственно в учетную запись хранения Azure.

Более подробные указания по работе с шаблоном отчета см. в <a href="http://go.microsoft.com/fwlink/?LinkId=506731">Практическом руководстве (DOC)</a>.

![][6]


##<a id="subheading-4"></a>Настройка аудита базы данных с помощью классического портала Azure

1. Запустите <a href= "https://manage.windowsazure.com/" target="_bank">классический портал Azure</a> на https://manage.windowsazure.com/.
 
2.   Выберите базу данных SQL или SQL Server, для которого нужно выполнить аудит, и откройте вкладку **АУДИТ И БЕЗОПАСНОСТЬ**.

3.   Если аудит настраивается для базы данных SQL, в разделе **БЕЗОПАСНЫЙ ДОСТУП** выберите **ОБЯЗАТЕЛЬНО**. При настройке аудита для SQL Server возможны два варианта: (1) после выполнения шага 7 перейдите к каждой базе данных SQL на сервере и выполните этот шаг либо (2) [измените FDQN сервера в строке подключения](sql-database-auditing-and-dynamic-data-masking-downlevel-clients.md).

4. В разделе аудита щелкните **ВКЛЮЧИТЬ**.


	![][7]

5. При необходимости измените параметр **ВЕДЕНИЕ ЖУРНАЛА ПО СОБЫТИЯМ**.

	![][8]

6. Выберите **УЧЕТНУЮ ЗАПИСЬ ХРАНЕНИЯ** и настройте **ХРАНЕНИЕ**.

	![][11]

7. Щелкните **СОХРАНИТЬ**.




##<a id="subheading-3">Рекомендации по использованию в рабочей среде</a>
Описания в этом разделе относятся к снимкам экрана выше. Можно использовать <a href="https://portal.azure.com" target="_blank">предварительную версию портала Azure</a> или <a href= "https://manage.windowsazure.com/" target="_bank">классический портал Azure</a>.
 

##<a id="subheading-4"></a>Повторное создание ключа хранилища

Обычно, в рабочей среде приходится периодически обновлять ключи хранилища. При обновлении ключей необходимо сохранять политику повторно. Вот как это можно сделать:


1. В колонке конфигурации аудита (описанной выше в разделе о настройке аудита) измените значение параметра **Ключ доступа к хранилищу** с *Первичный* на *Вторичный* и нажмите кнопку **СОХРАНИТЬ**.![][10]
2. Перейдите в колонку конфигурации хранилища и **повторно создайте** *первичный ключ доступа*.

3. В колонке конфигурации аудита измените значение параметра **Ключ доступа к хранилищу** с *Вторичный* на *Первичный* и нажмите кнопку **СОХРАНИТЬ**.

4. В интерфейсе хранилища **повторно создайте** *вторичный ключ доступа* (для подготовки к следующему циклу обновления ключей).
  
##<a id="subheading-4"></a>Автоматизация
Существует несколько командлетов PowerShell, которые можно использовать для настройки аудита в базе данных SQL Azure. Для доступа к аудиту командлетов необходимо наличие PowerShell в режиме диспетчера ресурсов Azure.

> [AZURE.NOTE]Модуль [диспетчера ресурсов Azure](https://msdn.microsoft.com/library/dn654592.aspx) в настоящее время находится на стадии предварительной версии. Он может не обеспечивать те же возможности управления, что и модуль Azure.

При работе в режиме диспетчера ресурсов Azure выполните команду `Get-Command *AzureSql*`, чтобы получить список доступных командлетов.







<!--Anchors-->
[Основы аудита баз данных SQL Azure]: #subheading-1
[Настройка аудита базы данных]: #subheading-2
[Анализ журналов и отчетов аудита]: #subheading-3
[Настройка аудита базы данных с помощью классического портала Azure]: #subheading-4


<!--Image references-->
[1]: ./media/sql-database-auditing-get-started/sql-database-get-started-auditingpreview.png
[2]: ./media/sql-database-auditing-get-started/sql-database-get-started-storageaccount.png
[3]: ./media/sql-database-auditing-get-started/sql-database-auditing-eventtype.png
[5]: ./media/sql-database-auditing-get-started/sql-database-get-started-connectionstring.png
[6]: ./media/sql-database-auditing-get-started/sql-database-auditing-dashboard.png
[7]: ./media/sql-database-auditing-get-started/sql-database-auditing-classic-portal-enable.png
[8]: ./media/sql-database-auditing-get-started/sql-database-auditing-classic-portal-configure.png
[9]: ./media/sql-database-auditing-get-started/sql-database-auditing-security-enabled-access.png
[10]: ./media/sql-database-auditing-get-started/sql-database-auditing-storage-account.png
[11]: ./media/sql-database-auditing-get-started/sql-database-auditing-classic-portal-configure-storage.png






<!--Link references-->
[Link 1 to another azure.microsoft.com documentation topic]: ../virtual-machines-windows-tutorial.md
[Link 2 to another azure.microsoft.com documentation topic]: ../web-sites-custom-domain-name.md
[Link 3 to another azure.microsoft.com documentation topic]: ../storage-whatis-account.md

 

<!---HONumber=July15_HO3-->