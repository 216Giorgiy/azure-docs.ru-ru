<properties
   pageTitle="Управление базами данных и именами входа в Базе данных SQL Azure | Microsoft Azure"
	description="Использование участника уровня сервера и других учетных записей для управления именами входа и базами данных в Базе данных SQL"
	services="sql-database"
	documentationCenter=""
	authors="BYHAM"
	manager="jeffreyg"
	editor=""
	tags=""/>

<tags
   ms.service="sql-database"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="data-management"
	ms.date="08/20/2015"
	ms.author="rickbyh"/>

# Управление базами данных и учетными записями в Базе данных SQL Azure

В Базе данных SQL Microsoft Azure при подписке на службу процесс подготовки создает сервер Базы данных SQL Azure, базу данных с именем **master** и имя входа, которое является участником уровня сервера для вашего сервера Базы данных SQL Azure. Для экземпляра SQL Server в локальной среде это имя входа совпадает с участником уровня сервера — **sa**.

Учетная запись участника уровня сервера для Базы данных SQL Azure всегда имеет разрешения на управление всеми параметрами безопасности уровня сервера и уровня базы данных. В этой теме описывается, как использовать участника уровня сервера и другие учетные записи для управления именами входа и базами данных в Базе данных SQL.

> [AZURE.IMPORTANT]База данных SQL версии 12 позволяет пользователям проходить проверку подлинности в базе данных с помощью пользователей автономной базы данных. Для пользователей автономной базы данных имена входа не требуются. Это повышает переносимость баз данных, но снижает возможность управления доступом к базе данных для участника уровня сервера. Включение пользователей автономной базы данных значительно влияет на безопасность. Дополнительные сведения можно найти в разделах [Пользователи автономной базы данных — создание переносимой базы данных](https://msdn.microsoft.com/library/ff929188.aspx), [CREATE USER (Transact-SQL)](https://msdn.microsoft.com/library/ms173463.aspx) и [Автономные базы данных](https://msdn.microsoft.com/library/ff929071.aspx).

## Общие сведения об администрировании безопасности в Базе данных SQL

Администрирование безопасности в Базе данных SQL сходно с администрированием безопасности для локального экземпляра SQL Server. Управление безопасностью на уровне базы данных практически идентично, различия только в доступных параметрах. Так как Базы данных SQL поддерживают масштабирование до одного или нескольких физических компьютеров, База данных SQL Azure использует другую стратегию администрирования на уровне сервера. В следующей таблице показано как администрирование безопасности для локального SQL Server отличается от Базы данных SQL Azure.

| Различие | Локальный сервер SQL Server | База данных SQL Azure |
|------------------------------------------------|-----------------------------------------------------------------------------|--------------------------------------------------|
| Место управления безопасностью уровня сервера | Папка безопасности в обозревателе объектов SQL Server Management Studio | База данных master и портал Azure |
| Роль безопасности уровня сервера для создания имен входа | Предопределенная роль сервера securityadmin. Дополнительные сведения можно найти в разделе «Роли уровня сервера» | Роль базы данных loginmanager в базе данных master |
| Команды для управления именами входа | CREATE LOGIN, ALTER LOGIN, DROP LOGIN | CREATE LOGIN, ALTER LOGIN, DROP LOGIN (существуют некоторые ограничения параметров, требуется подключение к базе данных master) |
| Представление, в котором отображаются все имена входа | sys.server\_principals | sys.sql\_logins (необходимо подключение к базе данных master)|
| Роль уровня сервера для создания баз данных | Предопределенная роль базы данных dbcreator. Дополнительные сведения можно найти в разделе «Роли уровня сервера» | Роль базы данных dbmanager в базе данных master |
| Команда для создания базы данных | CREATE DATABASE | CREATE DATABASE (существуют некоторые ограничения параметров, требуется подключение к базе данных master) |
| Представление, в котором перечислены все базы данных | sys.databases | sys.databases (необходимо подключение к базе данных master) |

### Администрирование уровня сервера и база данных master

Сервер Базы данных SQL Azure представляет собой абстракцию для группирования баз данных. Базы данных, связанные с сервером Базы данных SQL Azure могут размещаться на разных физических компьютерах в центре обработки данных корпорации Майкрософт. Администрирование уровня сервера для них всех можно выполнить с помощью отдельной базы данных с именем master.

База данных master отслеживает учетные записи и то, какие из них имеют разрешение на создание баз данных или других имен входа. При создании, изменении или удалении имен входа или баз данных требуется подключение к базе данных master. База данных **master** также имеет представления ``sys.sql_logins`` и ``sys.databases``, которые можно использовать для просмотра имен входа и баз данных соответственно.

> [AZURE.NOTE]Команда ``USE`` не поддерживается для переключения между базами данных. Установите подключение непосредственно к целевой базе данных.

Вы можете управлять безопасностью на уровне базы данных для пользователей и объектов в Базе данных SQL Microsoft Azure аналогично управлению на локальном экземпляре SQL Server. Различия существуют лишь в доступности параметров для соответствующих команд. Дополнительные сведения можно найти в разделе [Безопасность в Базе данных SQL Azure: рекомендации и ограничения](https://msdn.microsoft.com/library/azure/ff394108.aspx).

### Управление именами входа

Управление именами входа осуществляется с помощью имени входа участника уровня сервера посредством подключения к базе данных master. Вы можете использовать инструкции ``CREATE LOGIN``, ``ALTER LOGIN`` или ``DROP LOGIN``. В следующем примере создается имя входа **login1**:

```
-- first, connect to the master database
CREATE LOGIN login1 WITH password='<ProvidePassword>';
```

> [AZURE.NOTE]При создании имени входа необходимо использовать надежный пароль. Дополнительные сведения см. в разделе [Надежные пароли](https://msdn.microsoft.com/library/ms161962.aspx).

#### Использование новых имен входа

Для подключения к Базе данных SQL Microsoft Azure с использованием созданных имен входа сначала необходимо предоставить разрешения уровня базы данных для каждого имени входа с помощью команды ``CREATE USER``. Дополнительные сведения можно найти в разделе «Предоставление разрешений уровня сервера для имени входа».

Поскольку некоторые средства реализуют поток табличных данных (TDS) по-другому, возможно, потребуется добавить имя сервера Базы данных SQL Azure в имя входа в строке подключения, использующей формат ``<login>@<server>``. В таких случаях разделяйте имя входа и имя сервера Базы данных SQL Azure символом ``@``. Например, если ваше имя входа **login1**, а полное имя сервера Базы данных SQL Azure — **servername.database.windows.net**, параметр username для вашей строки подключения будет выглядеть как ****login1@servername**. Это правило накладывает ограничения на текст, который можно выбрать для имени входа. Дополнительные сведения можно найти в разделе [CREATE LOGIN (Transact-SQL)](https://msdn.microsoft.com/library/ms189751.aspx).

## Предоставление разрешений уровня сервера для имени входа

Для имен входа, отличных от участника уровня сервера для управления безопасностью уровня сервера, База данных SQL Microsoft Azure предлагает две роли безопасности: **loginmanager** (для создания имен входа) и **dbmanager** (для создания баз данных). Для этих ролей базы данных могут быть добавлены только пользователи в базе данных **master**.

> [AZURE.NOTE]Для создания имен входа или баз данных необходимо подключиться к базе данных **master** (которая является логическим представлением **master**).

### Роль loginmanager

Как и предопределенная роль сервера **securityadmin** для локального экземпляра SQL Server, роль базы данных **loginmanager** в Базе данных SQL Microsoft Azure имеет разрешение на создание имен входа. Новое имя входа может быть создано только именем входа субъекта уровня сервера (созданного процессом подготовки) или членом роли базы данных **loginmanager**.

### Роль dbmanager

Роль базы данных **dbmanager** в Базе данных SQL Microsoft Azure схожа с предопределенной ролью сервера **dbcreator** для локального экземпляра SQL Server. Новые базы данных могут быть созданы только именем входа субъекта уровня сервера (созданного процессом подготовки) или членом роли базы данных **dbmanager**. Если пользователь является членом роли базы данных **dbmanager**, он может создать базу данных с помощью команды ``CREATE DATABASE`` Базы данных SQL Azure, но эту команду необходимо выполнять в базе данных master. Более подробную информацию можно узнать в разделе [CREATE DATABASE (SQL Server Transact-SQL)](https://msdn.microsoft.com/library/ms176061.aspx).

### Назначение ролей уровня сервера Базы данных SQL

Для создания имени входа и связанного пользователя, который может создавать базы данных или другие имена входа, выполните следующие действия:

1. Подключитесь к базе данных **master** с помощью учетных данных имени входа субъекта уровня сервера (созданного процессом подготовки) или учетных данных существующего члена роли базы данных **loginmanager**.
2. Создайте имя входа, используя команду ``CREATE LOGIN``. Дополнительные сведения можно найти в разделе [CREATE LOGIN (Transact-SQL)](https://msdn.microsoft.com/library/ms189751.aspx).
3. С помощью команды ``CREATE USER`` создайте нового пользователя для этого имени входа в базе данных master. Дополнительные сведения можно найти в разделе [CREATE USER (Transact-SQL)](https://msdn.microsoft.com/library/ms173463.aspx).
4. Используйте хранимую процедуру ``sp_addrolememeber``, чтобы добавить нового пользователя в роль базы данных **dbmanager**, роль базы данных loginmanager или в обе эти роли.

В следующем примере кода показано, как создать имя входа с именем **login1** и соответствующего пользователя базы данных с именем **login1User**, который сможет создавать базы данных или другие имена входа при подключении к базе данных **master**:

```
-- first, connect to the master database
CREATE LOGIN login1 WITH password='<ProvidePassword>';
CREATE USER login1User FROM LOGIN login1;
EXEC sp_addrolemember 'dbmanager', 'login1User';
EXEC sp_addrolemember 'loginmanager', 'login1User';
```

> [AZURE.NOTE]При создании имени входа необходимо использовать надежный пароль. Дополнительные сведения см. в разделе [Надежные пароли](https://msdn.microsoft.com/library/ms161962.aspx).

## Предоставление доступа к базе данных для имени входа

Все имена входа должны быть созданы в базе данных master. После создания имени входа для него можно создать учетную запись пользователя в другой базе данных. Кроме того, База данных SQL Microsoft Azure поддерживает роли базы данных точно также, как локальный экземпляр SQL Server.

Для создания учетной записи пользователя в другой базе данных, при условии, что вы не создавали имя входа или базу данных, выполните следующие действия:

1. Подключитесь к базе данных **master** (с помощью имени входа, имеющего роли **loginmanager** и **dbmanager**).
2. Создайте имя входа с помощью команды ``CREATE LOGIN``. Дополнительные сведения можно найти в разделе [CREATE LOGIN (Transact-SQL)](https://msdn.microsoft.com/library/ms189751.aspx). Проверка подлинности Windows не поддерживается.
3. Создайте базу данных с помощью команды ``CREATE DATABASE``. Более подробную информацию можно узнать в разделе [CREATE DATABASE (SQL Server Transact-SQL)](https://msdn.microsoft.com/library/ms176061.aspx).
4. Установите подключение к новой базе данных (с помощью имени входа, создавшего эту базу данных).
5. Создайте в новой базе данных пользователя с помощью команды ``CREATE USER``. Дополнительные сведения можно найти в разделе [CREATE USER (Transact-SQL)](https://msdn.microsoft.com/library/ms173463.aspx).

В следующем примере кода показано, как создать имя входа **login1** и базу данных с именем **database1**:

```
-- first, connect to the master database
CREATE LOGIN login1 WITH password='<ProvidePassword>';
CREATE DATABASE database1;
```

> [AZURE.NOTE]При создании имени входа необходимо использовать надежный пароль. Дополнительные сведения см. в разделе [Надежные пароли](https://msdn.microsoft.com/library/ms161962.aspx).

В следующем примере показано, как создать пользователя базы данных с именем **login1User** в базе данных **database1**, которая соответствует имени входа **login1**:

```
-- Establish a new connection to the database1 database
CREATE USER login1User FROM LOGIN login1;
```

Эта модель разрешений уровня базы данных в Базе данных SQL Microsoft Azure аналогична локальному экземпляру SQL Server. Дополнительные сведения можно найти в следующих разделах электронной документации по SQL Server.

- [Инструкции по управлению именами входа, пользователями и схемами](https://msdn.microsoft.com/library/aa337552.aspx) 
- [Занятие 2: Настройка разрешений на объекты базы данных](https://msdn.microsoft.com/library/ms365345.aspx) 

> [AZURE.NOTE]Связанные с безопасностью инструкции Transact-SQL в Базе данных SQL Microsoft Azure могут немного отличаться по доступным параметрам. Дополнительные сведения можно найти в разделе [Сведения об инструкциях Transact-SQL Базы данных SQL Azure](sql-database-transact-sql-information.md).

## Просмотр имен входа и баз данных

Для просмотра имен входа и баз данных на сервере Базы данных SQL Azure используйте, соответственно, представления ``sys.sql_logins`` и ``sys.databases`` базы данных master. В следующем примере показано, как отобразить список всех имен входа и баз данных на сервере Базы данных SQL Azure.

```
-- first, connect to the master database
SELECT * FROM sys.sql_logins;
SELECT * FROM sys.databases; 
```

## См. также

[Безопасность в Базе данных SQL Azure: рекомендации и ограничения](sql-database-security-guidelines.md)

<!---HONumber=August15_HO9-->