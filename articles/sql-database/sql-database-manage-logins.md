<properties
   pageTitle="Управление безопасностью баз данных SQL — защита входа в систему | Microsoft Azure"
   description="Дополнительные сведения об управлении безопасностью баз данных SQL, в частности о том, как управлять доступом к базе данных и защитить вход в систему с помощью учетной записи участника уровня сервера."
   keywords="безопасность баз данных SQL, управление безопасностью баз данных, защита входа в систему, безопасность баз данных, доступ к базе данных"
   services="sql-database"
   documentationCenter=""
   authors="BYHAM"
   manager="jhubbard"
   editor=""
   tags=""/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management"
   ms.date="03/22/2016"
   ms.author="rickbyh"/>

# Безопасность баз данных SQL: управление доступом к базе данных и защита входа в систему  

Дополнительные сведения об управлении безопасностью баз данных SQL, в частности о том, как управлять доступом к базе данных и защитить вход в систему с помощью учетной записи участника уровня сервера. Прочитав эту статью, вы поймете некоторые сходства и различия в вариантах защиты входа в систему для базы данных SQL и локального сервера SQL. Краткое руководство см. в документе [Azure SQL Database Tutorial: Get Started with Azure SQL Database Security (Учебник по базам данных SQL Azure. Приступая к работе с безопасностью базы данных SQL Azure)](sql-database-get-started-security.md).

## Подготовка базы данных и вход в систему участника уровня сервера

В Базе данных SQL Microsoft Azure при подписке на службу процесс подготовки создает сервер Базы данных SQL Azure, базу данных с именем **master** и имя входа, которое является участником уровня сервера для вашего сервера Базы данных SQL Azure. Эти учетные данные аналогичны объекту серверного уровня (**sa**) для локального экземпляра SQL Server

Учетная запись участника уровня сервера для Базы данных SQL Azure всегда имеет разрешения на управление всеми параметрами безопасности уровня сервера и уровня базы данных. В этой теме описывается, как использовать участника уровня сервера и другие учетные записи для управления именами входа и базами данных в Базе данных SQL.

Пользователи Azure, которые работают с базой данных SQL с использованием управления доступом на основе ролей Azure (RBAC) и API REST Azure Resource Manager, получают разрешения из соответствующих ролей Azure. Эти роли предоставляют доступ к операциям плоскости управления, но не к операциям плоскости данных. Операции плоскости управления включают в себя возможность чтения различных свойств и элементов схемы в базе данных SQL. Кроме того, они разрешают создавать, удалять и настраивать некоторые компоненты уровня сервера, связанные с базой данных SQL. Многие из этих операций плоскости управления представляют собой элементы, которые можно просматривать и настраивать с помощью портала Azure. При использовании ролей RBAC действия членов роли Azure в базе данных (например перечисление таблиц) выполняются ядром СУБД, поэтому на них не влияет стандартная система разрешений SQL Server на основе инструкций GRANT, REVOKE и DENY. Роли RBAC не включают возможность чтения и изменения данных, так как это операции плоскости данных. Дополнительные сведения см. в статье [RBAC: встроенные роли](../active-directory/role-based-access-built-in-roles.md).

> [AZURE.IMPORTANT] База данных SQL версии 12 позволяет пользователям проходить проверку подлинности в базе данных с помощью пользователей автономной базы данных. Для пользователей автономной базы данных имена входа не требуются. Это повышает переносимость баз данных, но снижает возможность управления доступом к базе данных для участника уровня сервера. Включение пользователей автономной базы данных значительно влияет на безопасность. Дополнительные сведения см. в статьях [Пользователи автономной базы данных — создание переносимой базы данных](https://msdn.microsoft.com/library/ff929188.aspx), [Автономные базы данных](https://technet.microsoft.com/library/ff929071.aspx), [CREATE USER (Transact-SQL)](https://technet.microsoft.com/library/ms173463.aspx) и [Подключение к базе данных SQL с помощью проверки подлинности Azure Active Directory](sql-database-aad-authentication.md).

## Общие сведения об управлении безопасностью в базах данных SQL

Управление безопасностью баз данных SQL сходно с управлением безопасностью для локального экземпляра SQL Server. Управление безопасностью на уровне базы данных практически идентично, различия только в доступных параметрах. Так как Базы данных SQL поддерживают масштабирование до одного или нескольких физических компьютеров, База данных SQL Azure использует другую стратегию администрирования на уровне сервера. В следующей таблице показано, чем управление безопасности для локального SQL Server отличается от управления безопасностью для баз данных SQL Azure.

| Различие | Локальный сервер SQL Server | База данных SQL Azure |
|------------------------------------------------|-----------------------------------------------------------------------------|--------------------------------------------------|
| Место управления безопасностью уровня сервера | Папка **Безопасность** в обозревателе объектов SQL Server Management Studio | База данных **master** и портал Azure |
| Проверка подлинности Windows | Удостоверения Active Directory | Удостоверения Azure Active Directory |
| Роль безопасности уровня сервера для создания имен входа | Предопределенная роль сервера **securityadmin** | Роль базы данных **loginmanager** в базе данных **master** |
| Команды для управления именами входа | CREATE LOGIN, ALTER LOGIN, DROP LOGIN | CREATE LOGIN, ALTER LOGIN, DROP LOGIN (существуют некоторые ограничения параметров; требуется подключение к базе данных **master**) |
| Представление, в котором отображаются все имена входа | sys.server\_principals | sys.sql\_logins (требуется подключение к базе данных **master**)|
| Роль уровня сервера для создания баз данных | Предопределенная роль базы данных **dbcreator** | Роль базы данных **dbmanager** в базе данных **master** |
| Команда для создания базы данных | CREATE DATABASE | CREATE DATABASE (существуют некоторые ограничения параметров; требуется подключение к базе данных **master**) |
| Представление, в котором перечислены все базы данных | sys.databases | sys.databases (требуется подключение к базе данных **master**) |

## Администрирование уровня сервера и база данных master

Сервер Базы данных SQL Azure представляет собой абстракцию для группирования баз данных. Базы данных, связанные с сервером Базы данных SQL Azure могут размещаться на разных физических компьютерах в центре обработки данных корпорации Майкрософт. Администрировать все базы данных на уровне сервера можно с помощью одной базы данных с именем **master**.

База данных **master** отслеживает учетные данные. Также она отслеживает, имеют ли учетные данные разрешение создавать базы данных или другие учетные данные. При создании, изменении или удалении учетных данных или баз данных требуется подключение к базе данных **master**. В базе данных **master** также есть представления ``sys.sql_logins`` и ``sys.databases``, которые можно использовать для просмотра учетных данных и баз данных.

> [AZURE.NOTE] Переключение между базами данных с помощью команды ``USE`` не поддерживается. Установите подключение непосредственно к целевой базе данных.

Вы можете управлять защитой (на уровне базы данных) пользователей и объектов в базе данных SQL Azure так же, как и в локальном экземпляре SQL Server. Различия существуют лишь в доступности параметров для соответствующих команд. Дополнительные сведения см. в статье [Безопасность в базе данных SQL Azure: рекомендации и ограничения](sql-database-security-guidelines.md).

## Управление пользователями автономной базы данных

Создайте первого пользователя автономной базы данных, подключившись к базе данных с помощью объекта серверного уровня. Используйте инструкции ``CREATE USER``, ``ALTER USER`` или ``DROP USER``. В следующем примере создается пользователь с именем user1.

```
CREATE USER user1 WITH password='<Strong_Password>';
```

> [AZURE.NOTE] При создании пользователя автономной базы данных используйте надежный пароль. Дополнительные сведения см. в разделе [Надежные пароли](https://msdn.microsoft.com/library/ms161962.aspx).

Дополнительных пользователей автономной базы данных могут создавать любые пользователи с разрешением **ALTER ANY USER**.

База данных SQL версии 12 поддерживает удостоверения Azure Active Directory в качестве пользователей автономной базы данных. Эта функция реализована в предварительной версии. Дополнительную информацию см. в разделе [Подключение к базе данных SQL с помощью проверки подлинности Azure Active Directory](sql-database-aad-authentication.md).

Для работы с базой данных SQL Майкрософт рекомендует использовать пользователей автономной базы данных. Дополнительные сведения см. в разделе [Пользователи автономной базы данных — создание переносимой базы данных](https://msdn.microsoft.com/library/ff929188.aspx).

## Управление именами входа

Управление именами входа осуществляется с помощью имени входа участника уровня сервера посредством подключения к базе данных master. Вы можете использовать инструкции ``CREATE LOGIN``, ``ALTER LOGIN`` или ``DROP LOGIN``. В следующем примере создаются учетные данные **login1**:

```
-- first, connect to the master database
CREATE LOGIN login1 WITH password='<ProvidePassword>';
```

> [AZURE.NOTE] При создании имени входа необходимо использовать надежный пароль. Дополнительные сведения см. в разделе [Надежные пароли](https://msdn.microsoft.com/library/ms161962.aspx).

#### Использование новых имен входа

Чтобы подключиться к базе данных SQL Microsoft Azure с помощью созданных учетных данных, вам сначала нужно предоставить всем учетным данным разрешения уровня базы данных. Для этого воспользуйтесь командой ``CREATE USER``. Подробнее об этом см. в разделе **Предоставление имения для входа доступа к базе данных**.

Некоторые инструменты реализуют поток табличных данных (TDS) по-разному. Поэтому вам, возможно, надо будет добавить имя сервера базы данных SQL Azure к имени для входа в строке подключения. Для этого используйте нотацию ``<login>@<server>``. Кроме того, необходимо разделить имя для входа и имя сервера базы данных SQL Azure символом ``@``. Например, если ваше имя для входа — **login1**, а полное имя сервера базы данных SQL Azure — **servername.database.windows.net**, параметр username для строки подключения будет выглядеть так: ****login1@servername**. Это правило накладывает ограничения на текст, который можно выбрать для имени входа. Дополнительные сведения см. в разделе [CREATE LOGIN (Transact-SQL)](https://msdn.microsoft.com/library/ms189751.aspx).

## Предоставление разрешений уровня сервера для имени входа

Для управления защитой на уровне сервера могут использоваться имена для входа, отличные от объекта серверного уровня. Для таких имен база данных SQL Microsoft Azure предлагает две роли безопасности: **loginmanager** (для создания имен для входа) и **dbmanager** (для создания баз данных). Эти роли базы данных можно назначать только пользователям из базы данных **master**.

> [AZURE.NOTE] Чтобы создавать учетные данные или базы данных, необходимо подключиться к базе данных **master** (которая является логическим представлением **master**).

### Роль loginmanager

Как и предопределенная роль сервера **securityadmin** для локального экземпляра SQL Server, роль базы данных **loginmanager** в базе данных SQL Azure имеет разрешение на создание имен для входа. Новые имена для входа могут создаваться только с помощью имени для входа субъекта серверного уровня (создается в процессе подготовки) или участниками роли базы данных **loginmanager**.

### Роль dbmanager

Роль базы данных **dbmanager** в базе данных SQL Azure похожа на предопределенную роль сервера **dbcreator** для локального экземпляра SQL Server. Новые базы данных могут создаваться только с помощью имени для входа субъекта серверного уровня (создается в процессе подготовки) или участниками роли базы данных **dbmanager**. Если пользователь является участником роли базы данных **dbmanager**, он может создать базу данных с помощью команды ``CREATE DATABASE`` базы данных SQL Azure. Эту команду необходимо выполнить в базе данных master. Дополнительные сведения см. в разделе [CREATE DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/dn268335.aspx).

### Назначение ролей уровня сервера Базы данных SQL

Для создания имени входа и связанного пользователя, который может создавать базы данных или другие имена входа, выполните следующие действия:

1. Подключитесь к базе данных **master** с помощью имени для входа субъекта серверного уровня (создается в процессе подготовки) или учетных данных существующего участника роли базы данных **loginmanager**.
2. Создайте имя для входа, используя команду ``CREATE LOGIN``. Дополнительные сведения см. в разделе [CREATE LOGIN (Transact-SQL)](https://msdn.microsoft.com/library/ms189751.aspx).
3. С помощью команды ``CREATE USER`` создайте нового пользователя для этого имени входа в базе данных master. Дополнительные сведения см. в разделе [CREATE USER (Transact-SQL)](https://msdn.microsoft.com/library/ms173463.aspx).
4. Используйте хранимую процедуру ``sp_addrolememeber``, чтобы добавить нового пользователя в роль базы данных **dbmanager**, роль базы данных loginmanager или в обе эти роли.

В следующем примере кода показано, как создать учетные данные с именем **login1** и соответствующего пользователя базы данных с именем **login1User**. Этот пользователь сможет создавать базы данных или другие учетные данные при подключении к базе данных **master**:

```
-- first, connect to the master database
CREATE LOGIN login1 WITH password='<ProvidePassword>';
CREATE USER login1User FROM LOGIN login1;
EXEC sp_addrolemember 'dbmanager', 'login1User';
EXEC sp_addrolemember 'loginmanager', 'login1User';
```

> [AZURE.NOTE] При создании имени входа необходимо использовать надежный пароль. Дополнительные сведения см. в разделе [Надежные пароли](https://msdn.microsoft.com/library/ms161962.aspx).

## Предоставление доступа к базе данных для имени входа

Все имена для входа должны быть созданы в базе данных **master**. После создания имени входа для него можно создать учетную запись пользователя в другой базе данных. Кроме того, база данных SQL Azure поддерживает роли базы данных так же, как и локальный экземпляр SQL Server.

Для создания учетной записи пользователя в другой базе данных, при условии, что вы не создавали имя входа или базу данных, выполните следующие действия:

1. Подключитесь к базе данных **master** (с помощью учетных данных с ролями **loginmanager** и **dbmanager**).
2. Создайте имя для входа с помощью команды ``CREATE LOGIN``. Дополнительные сведения см. в статье [CREATE LOGIN (Transact-SQL)](https://msdn.microsoft.com/library/ms189751.aspx). Проверка подлинности Windows не поддерживается.
3. Создайте базу данных с помощью команды ``CREATE DATABASE``. Дополнительные сведения см. в разделе [CREATE DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/dn268335.aspx).
4. Установите подключение к новой базе данных (с помощью имени входа, создавшего эту базу данных).
5. Создайте в новой базе данных пользователя с помощью команды ``CREATE USER``. Дополнительные сведения см. в разделе [CREATE USER (Transact-SQL)](https://msdn.microsoft.com/library/ms173463.aspx).

В следующем примере кода показано, как создать имя для входа **login1** и базу данных с именем **database1**:

```
-- first, connect to the master database
CREATE LOGIN login1 WITH password='<ProvidePassword>';
CREATE DATABASE database1;
```

> [AZURE.NOTE] При создании имени входа необходимо использовать надежный пароль. Дополнительные сведения см. в разделе [Надежные пароли](https://msdn.microsoft.com/library/ms161962.aspx).

В следующем примере показано, как создать пользователя базы данных с именем **login1User** в базе данных **database1**, который соответствует имени для входа **login1**. Чтобы запустить следующий пример, необходимо сначала создать новое подключение к базе данных database1, используя имя для входа с разрешением **ALTER ANY USER** в этой базе данных. Это разрешение есть у всех пользователей, которые подключаются как участники роли **db\_owner**, например тех, кто создал базу данных.

```
-- Establish a new connection to the database1 database
CREATE USER login1User FROM LOGIN login1;
```

Эта модель разрешений уровня базы данных в базе данных SQL Azure соответствует модели разрешений в локальном экземпляре SQL Server. Дополнительные сведения можно найти в следующих разделах электронной документации по SQL Server.

- [Инструкции по управлению именами входа, пользователями и схемами](https://msdn.microsoft.com/library/aa337552.aspx)
- [Занятие 2: Настройка разрешений на объекты базы данных](https://msdn.microsoft.com/library/ms365345.aspx)

> [AZURE.NOTE] Связанные с безопасностью инструкции Transact-SQL в базе данных SQL Azure могут немного отличаться по доступным параметрам. Дополнительные сведения об определенных инструкциях см. в электронной документации по синтаксису.

## Просмотр имен входа и баз данных


Просмотреть имена для входа и базы данных на сервере Базы данных SQL Azure можно с помощью соответствующих представлений ``sys.sql_logins`` и ``sys.databases`` базы данных master. В следующем примере показано, как отобразить список всех имен входа и баз данных на сервере Базы данных SQL Azure.

```
-- first, connect to the master database
SELECT * FROM sys.sql_logins;
SELECT * FROM sys.databases;
```

## См. также

[Azure SQL Database Tutorial: Get Started with Azure SQL Database Security (Учебник по базам данных SQL Azure. Приступая к работе с безопасностью базы данных SQL Azure)](sql-database-get-started-security.md), [Безопасность в Базе данных SQL Azure: рекомендации и ограничения](sql-database-security-guidelines.md), [Подключение к Базе данных SQL с помощью проверки подлинности Azure Active Directory](sql-database-aad-authentication.md)

<!---HONumber=AcomDC_0420_2016-->