<properties
   pageTitle="Проверка подлинности и авторизация в базе данных SQL: предоставление доступа | Microsoft Azure"
   description="Дополнительные сведения об управлении безопасностью баз данных SQL, в частности о том, как управлять доступом к базе данных и защитить вход в систему с помощью учетной записи участника уровня сервера."
   keywords="безопасность баз данных SQL, управление безопасностью баз данных, защита входа в систему, безопасность баз данных, доступ к базе данных"
   services="sql-database"
   documentationCenter=""
   authors="BYHAM"
   manager="jhubbard"
   editor=""
   tags=""/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management"
   ms.date="09/01/2016"
   ms.author="rickbyh"/>

# Проверка подлинности и авторизация в базе данных SQL: предоставление доступа 


> [AZURE.SELECTOR]
- [Учебник по началу работы](sql-database-get-started-security.md)
- [Предоставление доступа](sql-database-manage-logins.md)


Сначала ознакомьтесь с принципами предоставления доступа к базе данных SQL для администраторов, пользователей без прав администратора, а также ролей.

## Административные учетные записи с неограниченным доступом

Для получения неограниченного доступа к виртуальной базе данных master и всем остальным пользовательским базам данных используются две административные учетные записи. Эти учетные записи называются учетными записями субъектов серверного уровня.

### Учетная запись подписчика базы данных SQL Azure 

При создании логического экземпляра SQL создается единая учетная запись, которая называется учетной записью подписчика базы данных SQL. Эта учетная запись подключается с использованием проверки подлинности SQL Server (с предоставлением имени пользователя и пароля). Эта учетная запись является администратором для экземпляра логического сервера, а также для всех пользовательских баз данных, присоединенных к этому экземпляру. Разрешения учетной записи подписчика нельзя ограничить. Может существовать только одна такая учетная запись.

### Администратор Azure Active Directory
Одной учетной записи Azure Active Directory также можно предоставить права администратора. Эта учетная запись может быть отдельным пользователем Azure AD или группой Azure AD, в которую входит несколько пользователей Azure AD. Администратора Azure AD необходимо настраивать, только если вы хотите использовать проверку подлинности Windows для учетных записей Azure AD при подключении к базе данных SQL. Дополнительные сведения о настройке доступа Azure Active Directory см. в разделах [Подключение к базе данных SQL или хранилищу данных SQL c использованием проверки подлинности Azure Active Directory](sql-database-aad-authentication.md) и [Поддержка SSMS в Azure AD MFA для базы данных SQL и хранилища данных SQL](sql-database-ssms-mfa-authentication.md).

### Настройка брандмауэра
Если настроен брандмауэр уровня сервера, то учетная запись подписчика Базы данных SQL Azure и учетная запись Azure Active Directory смогут подключаться к базе данных master и всем пользовательским базам данных. Брандмауэр серверного уровня можно настроить на портале. После подключения также можно настроить дополнительные правила брандмауэра уровня сервера с помощью инструкции Transact-SQL [sp\_set\_firewall\_rule](https://msdn.microsoft.com/library/dn270017.aspx). Дополнительные сведения о настройке брандмауэра см. в статье [Практическое руководство. Настройка брандмауэра базы данных SQL Azure с помощью портала Azure](sql-database-configure-firewall-settings.md).

### Путь доступа администратора

При правильной настройке брандмауэра серверного уровня учетная запись подписчика базы данных SQL и учетная запись администратора SQL Server Azure Active Directory смогут подключаться с помощью таких клиентских средств, как SQL Server Management Studio или SQL Server Data Tools. Все функции и возможности доступны только в последних версиях средств. На схеме ниже показана типичная конфигурация для двух учетных записей администраторов. ![Путь доступа администратора](./media/sql-database-manage-logins/1sql-db-administrator-access.png)

При использовании открытого порта брандмауэра серверного уровня администраторы могут подключаться к любой базе данных SQL.

### Подключение к базе данных с помощью SQL Server Management Studio
Пошаговое руководство по подключению с помощью SQL Server Management Studio см. в статье [Подключение к базе данных SQL с помощью SQL Server Management Studio и выполнение пробного запроса T-SQL](sql-database-connect-query-ssms.md).


> [AZURE.IMPORTANT] Чтобы обеспечить синхронизацию с обновлениями Microsoft Azure и Базой данных SQL, рекомендуется всегда использовать последнюю версию Management Studio. [Обновите среду SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).


## Дополнительные специальные учетные записи
База данных SQL позволяет использовать две административные роли с ограниченными правами в виртуальной базе данных master, к которой можно добавлять учетные записи пользователей.

### Создатели баз данных
Учетные записи администраторов могут создавать новые базы данных. Чтобы создать дополнительную учетную запись, которая может создавать базы данных, создайте пользователя в базе данных master и добавьте его в специальную роль базы данных **dbmanager**. Пользователь может быть пользователем автономной базы данных или пользователем с именем входа SQL Server в виртуальную базу данных master.

1.	С помощью учетной записи администратора подключитесь к виртуальной базе данных master.
2.	Необязательный шаг. Создайте имя для входа для аутентификации SQL Server с помощью инструкции [CREATE LOGIN](https://msdn.microsoft.com/library/ms189751.aspx). Пример инструкции:

     ```
     CREATE LOGIN Mary WITH PASSWORD = '<strong_password>';
     ```

     > [AZURE.NOTE] Создавая имя для входа или пользователя автономной базы данных, используйте надежный пароль. Дополнительные сведения см. в разделе [Надежные пароли](https://msdn.microsoft.com/library/ms161962.aspx).

3.	В виртуальной базе данных master создайте пользователя с помощью инструкции [CREATE USER](https://msdn.microsoft.com/library/ms173463.aspx). Пользователь может быть пользователем автономной базы данных проверки подлинности Azure Active Directory (если вы настроили среду для проверки подлинности Azure AD), пользователем автономной базы данных проверки подлинности SQL Server или пользователем проверки подлинности SQL Server с именем входа проверки подлинности SQL Server (созданным на предыдущем шаге). Примеры инструкций:

     ```
     CREATE USER [mike@contoso.com] FROM EXTERNAL PROVIDER;
     CREATE USER Tran WITH PASSWORD = '<strong_password>';
     CREATE USER Mary FROM LOGIN Mary; 
     ```

4.	Добавьте нового пользователя в роль базы данных **dbmanager** с помощью инструкции [ALTER ROLE](https://msdn.microsoft.com/library/ms189775.aspx). Примеры инструкций:

     ```
     ALTER ROLE dbmanager ADD MEMBER Mary; 
     ALTER ROLE dbmanager ADD MEMBER [mike@contoso.com];
     ```

     > [AZURE.NOTE] Так как dbmanager — это роль базы данных в виртуальной базе данных master, вы можете назначить роль dbmanager только пользователю. Невозможно добавить имя входа серверного уровня в роль уровня базы данных.

5.	При необходимости настройте брандмауэр серверного уровня, чтобы разрешить подключение новому пользователю.

Теперь пользователь может подключаться к виртуальной базе данных master и создавать базы данных. Учетная запись, создавшая базу данных, становится владельцем базы данных.

### Диспетчеры входа

При желании можно выполнить те же действия (создание имени для входа и пользователя и назначение пользователю роли **loginmanager**), чтобы разрешить пользователю создавать имена для входа в виртуальную базу данных master. Обычно это не требуется, так как корпорация Microsoft рекомендует использовать пользователей автономной базы данных, аутентификация которых выполняется на уровне базы данных, а не пользователей с именами для входа. Дополнительные сведения см. в статье [Пользователи автономной базы данных — создание переносимой базы данных](https://msdn.microsoft.com/library/ff929188.aspx).

## Пользователи без прав администратора

Как правило, учетным записям без прав администратора не требуется доступ к виртуальной базе данных master. Создайте пользователей автономной базы данных на уровне базы данных с помощью инструкции [CREATE USER (Transact-SQL)](https://msdn.microsoft.com/library/ms173463.aspx). Пользователь может быть пользователем автономной базы данных проверки подлинности Azure Active Directory (если вы настроили среду для проверки подлинности Azure AD), пользователем автономной базы данных проверки подлинности SQL Server или пользователем проверки подлинности SQL Server с именем входа проверки подлинности SQL Server (созданным на предыдущем шаге). Дополнительные сведения см. в статье [Пользователи автономной базы данных — создание переносимой базы данных](https://msdn.microsoft.com/library/ff929188.aspx).

Чтобы создать пользователей, подключитесь к базе данных и выполните инструкции, аналогичные приведенным ниже.

```
CREATE USER Mary FROM LOGIN Mary; 
CREATE USER [mike@contoso.com] FROM EXTERNAL PROVIDER;
```

Изначально создавать пользователей может только один администратор или владелец базы данных. Чтобы разрешить другим пользователям создавать пользователей, предоставьте выбранному пользователю разрешение `ALTER ANY USER` с помощью следующей инструкции.

```
GRANT ALTER ANY USER TO Mary;
```

Чтобы предоставить другим пользователям полный доступ к базе данных, сделайте соответствующего пользователя участником фиксированной роли базы данных **db\_owner** с помощью инструкции `ALTER ROLE`.

> [AZURE.NOTE] Пользователей базы данных с именами для входа нужно создавать, если у вас есть пользователи аутентификации SQL Server, которым необходим доступ к нескольким базам данных. Пользователи с именам входа привязаны к имени входа и паролю этого имени входа. Пользователи автономной базы данных в отдельных базах данных являются отдельными сущностями с собственным паролем. Это может запутать пользователей автономной базы данных, если их пароли не одинаковы.

### Настройка брандмауэра на уровне базы данных

Пользователям без прав администратора рекомендуется предоставлять доступ к нужным им базам данных только через брандмауэр. Вместо авторизации их IP-адресов с помощью брандмауэра уровня сервера и предоставления им доступа ко всем базам данных используйте инструкцию [sp\_set\_database\_firewall\_rule](https://msdn.microsoft.com/library/dn270010.aspx), чтобы настроить брандмауэр уровня базы данных. С помощью портала нельзя настроить брандмауэр уровня базы данных.

### Путь доступа пользователя без прав администратора

При правильной настройке брандмауэра уровня базы данных пользователи базы данных могут подключаться к базе данных с помощью таких клиентских средств, как SQL Server Management Studio или SQL Server Data Tools. Все функции и возможности доступны только в последних версиях средств. На следующей схеме показан типичный путь доступа пользователя без прав администратора. ![Путь доступа пользователя без прав администратора](./media/sql-database-manage-logins/2sql-db-nonadmin-access.png)
 
## Группы и роли
При эффективном управлении доступом используются разрешения, назначенные группам и ролям, а не отдельным пользователям. Например, при использовании аутентификации Azure Active Directory следуйте такой процедуре.

- Включите пользователей Azure Active Directory в группу Azure Active Directory. Создайте пользователя автономной базы данных для группы. Назначьте одному или нескольким пользователям базы данных роль базы данных. Затем назначьте разрешения для роли базы данных.

Например, при использовании проверки подлинности SQL Server следуйте такой процедуре.

- Создайте пользователей автономной базы данных в базе данных. Назначьте одному или нескольким пользователям базы данных роль базы данных. Затем назначьте разрешения для роли базы данных.

Роли базы данных могут быть встроенными ролями, например **db\_owner**, **db\_ddladmin**, **db\_datawriter**, **db\_datareader**, **db\_denydatawriter** и **db\_denydatareader**. Роль **db\_owner** обычно используется для предоставления полных прав ограниченному числу пользователей. Другие фиксированные роли можно использовать для быстрого получения простых баз данных при разработке, но их не рекомендуется использовать для большинства рабочих баз данных. Например, фиксированная роль базы данных **db\_datareader** предоставляет доступ (как правило, строго обязательный) на чтение к каждой таблице в базе данных. Рекомендуется использовать инструкцию [CREATE ROLE](https://msdn.microsoft.com/library/ms187936.aspx), чтобы создавать пользовательские роли базы данных, а затем внимательно предоставлять каждой роли наименьший набор разрешений, необходимый для работы. Если пользователь является участником нескольких ролей, то ему предоставлены разрешения всех этих ролей.

## Разрешения

Существует более 100 разрешений, которые можно по отдельности предоставлять или отменять в базе данных SQL. Многие эти разрешения являются частью других разрешений. Например, разрешение `UPDATE` на схеме включает в себя разрешение `UPDATE` для каждой таблицы в этой схеме. Как и в большинстве систем разрешений, отмена разрешения переопределяет предоставление. Так как некоторые разрешения включены в другие разрешения и их достаточно много, необходимо внимательно изучить их, чтобы спроектировать соответствующую систему разрешений, которая будет надежно защищать базу данных. Изучите список разрешений на странице [Permissions (Database Engine)](https://msdn.microsoft.com/library/ms191291.aspx) (Разрешения (ядро СУБД)) и ознакомьтесь с [графическим представлением](http://go.microsoft.com/fwlink/?LinkId=229142) разрешений.


## Дальнейшие действия

[Защита Базы данных SQL](sql-database-security.md)

[Creating a Table (Tutorial) (Руководство: создание таблицы)](https://msdn.microsoft.com/library/ms365315.aspx)

[Inserting and Updating Data in a Table (Tutorial) (Руководство: вставка и обновление данных в таблице)](https://msdn.microsoft.com/library/ms365309.aspx)

[Reading the Data in a Table (Tutorial) (Руководство: чтение данных из таблицы)](https://msdn.microsoft.com/library/ms365310.aspx)

[Creating views and stored procedures (Создание представлений и хранимых процедур)](https://msdn.microsoft.com/library/ms365311.aspx)

[Granting Access to a Database Object (Предоставление доступа к объекту базы данных)](https://msdn.microsoft.com/library/ms365327.aspx)


## Дополнительные ресурсы

[Защита Базы данных SQL](sql-database-security.md)

[Центр обеспечения безопасности для ядра СУБД SQL Server и базы данных Azure SQL](https://msdn.microsoft.com/library/bb510589.aspx)

<!---HONumber=AcomDC_0907_2016-->