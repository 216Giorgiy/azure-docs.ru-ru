---
title: "Приступая к работе с синхронизацией данных SQL Azure (предварительная версия) | Документация Майкрософт"
description: "Это руководство поможет вам приступить к работе с синхронизацией данных SQL Azure (предварительная версия)."
services: sql-database
documentationcenter: 
author: douglaslms
manager: craigg
editor: 
ms.assetid: a295a768-7ff2-4a86-a253-0090281c8efa
ms.service: sql-database
ms.custom: load & move data
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/08/2017
ms.author: douglasl
ms.translationtype: HT
ms.sourcegitcommit: 8f9234fe1f33625685b66e1d0e0024469f54f95c
ms.openlocfilehash: 1943e87ffd991d099ab655af5a7d16d7f1608d22
ms.contentlocale: ru-ru
ms.lasthandoff: 09/20/2017

---
# <a name="getting-started-with-azure-sql-data-sync-preview"></a>Приступая к работе с синхронизацией данных SQL Azure (предварительная версия)
В этом руководстве вы узнаете, как для настроить синхронизацию данных SQL Azure, создав гибридную группу синхронизации, содержащую экземпляры базы данных SQL Azure и SQL Server. Новая группа синхронизации полностью настраивается и синхронизируется по заданному расписанию.

В этом руководстве предполагается, что у вас имеется некоторый опыт работы с базой данных SQL и SQL Server. 

Общие сведения о синхронизации данных SQL см. в разделе [Синхронизация данных](sql-database-sync-data.md).

Полные примеры PowerShell, которые демонстрируют, как настроить синхронизацию данных SQL, приведены в следующих статьях:
-   [Использование PowerShell для синхронизации данных между несколькими базами данных SQL Azure](scripts/sql-database-sync-data-between-sql-databases.md)
-   [Использование PowerShell для синхронизации данных между базой данных SQL Azure и локальной базой данных SQL Server](scripts/sql-database-sync-data-between-azure-onprem.md)

> [!NOTE]
> Полная техническая документация по синхронизации данных SQL Azure, которая ранее располагалась на сайте MSDN, доступна в виде PDF-файла. Его можно скачать [здесь](https://github.com/Microsoft/sql-server-samples/raw/master/samples/features/sql-data-sync/Data_Sync_Preview_full_documentation.pdf?raw=true).

## <a name="step-1---create-sync-group"></a>Шаг 1. Создание группы синхронизации

### <a name="locate-the-data-sync-settings"></a>Поиск параметров синхронизации данных

1.  В браузере перейдите на портал Azure.

2.  На портале найдите базы данных SQL, воспользовавшись панелью мониторинга или значком баз данных SQL на панели инструментов.

    ![Список баз данных SQL Azure](media/sql-database-get-started-sql-data-sync/datasync-preview-sqldbs.png)

3.  В колонке **Базы данных SQL** выберите базу данных SQL, которую требуется использовать в качестве центральной базы данных для синхронизации данных. Откроется колонка "База данных SQL".

4.  В колонке выбранной базы данных SQL щелкните **Синхронизировать с другими базами данных**. Откроется колонка "Синхронизация данных".

    ![Параметр "Синхронизировать с другими базами данных"](media/sql-database-get-started-sql-data-sync/datasync-preview-newsyncgroup.png)

### <a name="create-a-new-sync-group"></a>Создание группы синхронизации

1.  В колонке "Синхронизация данных" выберите **Новая группа синхронизации**. Откроется колонка **Новая группа синхронизации**, в которой будет выделен шаг 1, **Создание группы синхронизации**. Кроме того, откроется колонка **Создание группы синхронизации данных**.

2.  В колонке **Создание группы синхронизации данных** выполните следующее.

    1.  В поле **Имя группы синхронизации** введите имя новой группы синхронизации.

    2.  В разделе **База данных для метаданных синхронизации** выберите, следует ли создать новую базу данных (рекомендуется) или использовать существующую.

        > [!NOTE]
        > Корпорация Майкрософт рекомендует создать пустую базу данных для метаданных синхронизации. Служба синхронизации данных создает таблицы в этой базе данных и часто выполняет рабочую нагрузку. Эта база данных автоматически совместно используется как база данных для метаданных синхронизации всеми группами синхронизации в выбранном регионе. Невозможно изменить базу данных для метаданных синхронизации или ее имя, не удалив ее.

        Если вы выбрали параметр **Новая база данных**, щелкните **Создать новую базу данных**. Откроется колонка **База данных SQL**. В колонке **База данных SQL** задайте имя и параметры новой базы данных. Нажмите кнопку **ОК**.

        Если вы выбрали параметр **Использовать существующую базу данных**, выберите базу данных из списка.

    3.  В разделе **Автоматическая синхронизация** сначала выберите **Вкл.** или **Выкл.**

        Если вы выбрали **Вкл.**, в разделе **Частота синхронизации** введите число и выберите единицы измерения: секунды, минуты, часы или дни.

        ![Указание частоты синхронизации](media/sql-database-get-started-sql-data-sync/datasync-preview-syncfreq.png)

    4.  В разделе **Устранение конфликтов** выберите "Выигрывает концентратор" или "Member wins" (Выигрывает член).

        ![Настройка устранения конфликтов](media/sql-database-get-started-sql-data-sync/datasync-preview-conflictres.png)

    5.  Нажмите кнопку **ОК** и подождите, пока будет создана и развернута новая группа синхронизации.

## <a name="step-2---add-sync-members"></a>Шаг 2. Добавление членов синхронизации

После создания и развертывания группы синхронизации в колонке **Новая группа синхронизации** выделяется шаг 2, **Добавление членов синхронизации**.

В разделе **Центральная база данных** введите существующие учетные данные для сервера Базы данных SQL, на котором расположена центральная база данных. Не вводите *новые* учетные данные в этом разделе.

![Центральная база данных добавлена в группу синхронизации](media/sql-database-get-started-sql-data-sync/datasync-preview-hubadded.png)

## <a name="add-an-azure-sql-database"></a>Добавление базы данных SQL Azure

В разделе **Рядовая база данных** можно дополнительно добавить в группу синхронизации базу данных SQL Azure, щелкнув **Добавление базы данных Azure**. Откроется колонка **Настройка базы данных Azure**.

В колонке **Настройка базы данных Azure** выполните следующее.

1.  В поле **Имя участника синхронизации** укажите имя нового члена синхронизации. Это имя должно отличаться от имени самой базы данных.

2.  В поле **Подписка** выберите связанную подписку Azure для выставления счетов.

3.  В поле **Azure SQL Server** выберите существующий сервер базы данных SQL.

4.  В поле **База данных SQL Azure** выберите существующую базу данных SQL.

5.  В поле **Направления синхронизации** выберите параметр "Двунаправленная синхронизация", "К концентратору" или "Из концентратора".

    ![Добавление нового члена синхронизации для базы данных SQL](media/sql-database-get-started-sql-data-sync/datasync-preview-memberadding.png)

6.  В полях **Имя пользователя** и **Пароль** введите существующие учетные данные для сервера Базы данных SQL, на котором расположена рядовая база данных. Не вводите *новые* учетные данные в этом разделе.

7.  Нажмите кнопку **ОК** и подождите, пока будет создан и развернут новый член синхронизации.

    ![Добавлен новый член синхронизации для базы данных SQL](media/sql-database-get-started-sql-data-sync/datasync-preview-memberadded.png)

## <a name="add-an-on-premises-sql-server-database"></a>Добавление локальной базы данных SQL Server

В разделе **Рядовая база данных** можно дополнительно добавить в группу синхронизации локальную базу данных SQL Server, щелкнув **Добавление локальной базы данных**. Откроется колонка **Настройка локальной среды**.

В колонке **Настройка локальной среды** выполните следующее.

1.  Щелкните **Выбор шлюза агента синхронизации**. Откроется колонка **Выбор агента синхронизации**.

    ![Выбор шлюза агента синхронизации](media/sql-database-get-started-sql-data-sync/datasync-preview-choosegateway.png)

2.  В колонке **Выбор шлюза агента синхронизации** укажите, следует ли использовать существующий агент или создать новый.

    Если вы выбрали параметр **Существующие агенты**, то выберите из списка имеющийся агент.

    Если вы выбрали параметр **Создание агента**, то выполните следующее.

    1.  Скачайте программное обеспечение агента клиента синхронизации, воспользовавшись приведенной ссылкой, и установите его на компьютере, на котором размещен сервер SQL Server.
 
        > [!IMPORTANT]
        > Необходимо открыть исходящий TCP-порт 1433 в брандмауэре, чтобы позволить агенту клиента обмениваться данными с сервером.


    2.  Введите имя агента.

    3.  Выберите **Создание и генерация ключа**.

    4.  Скопируйте ключ агента в буфер обмена.
        
        ![Создание агента синхронизации](media/sql-database-get-started-sql-data-sync/datasync-preview-selectsyncagent.png)

    5.  Нажмите кнопку **ОК**, чтобы закрыть колонку **Выбор агента синхронизации**.

    6.  На компьютере SQL Server найдите и запустите приложение агента клиента синхронизации.

        ![Приложение агента клиента синхронизации данных](media/sql-database-get-started-sql-data-sync/datasync-preview-clientagent.png)

    7.  В приложении агента синхронизации выберите **Submit Agent Key** (Отправить ключ агента). Откроется диалоговое окно **Sync Metadata Database Configuration** (Конфигурация базы данных для метаданных синхронизации).

    8.  В диалоговом окне **Sync Metadata Database Configuration** (Конфигурация базы данных для метаданных синхронизации) вставьте ключ агента, скопированный на портале Azure. Укажите также существующие учетные данные для сервера Базы данных SQL, на котором расположена база данных для метаданных. (Если вы создали новую базу данных для метаданных, то она находится на том же сервере, что и центральная база данных.) Нажмите кнопку **ОК** и дождитесь завершения настройки.

        ![Ввод ключа агента и учетных данных сервера](media/sql-database-get-started-sql-data-sync/datasync-preview-agent-enterkey.png)

        >   [!NOTE] 
        >   Если на этом этапе произошла ошибка брандмауэра, необходимо создать правило брандмауэра в Azure, чтобы разрешить входящий трафик от компьютера SQL Server. Правило можно создать вручную на портале, но может оказаться проще создать его в SQL Server Management Studio (SSMS). В SSMS попытайтесь подключиться к центральной базе данных в Azure. Введите ее имя как \<имя_центральной_базы_данных\>.database.windows.net. Следуйте указаниям в диалоговом окне, чтобы настроить правило брандмауэра Azure. Затем вернитесь в приложение агента клиента синхронизации.

    9.  В приложении агента клиента синхронизации щелкните **Register** (Зарегистрировать), чтобы зарегистрировать базу данных SQL Server в агенте. Откроется диалоговое окно **SQL Server Configuration** (Конфигурация SQL Server).

        ![Добавление и настройка базы данных SQL Server](media/sql-database-get-started-sql-data-sync/datasync-preview-agent-adddb.png)

    10. В диалоговом окне **SQL Server Configuration** (Конфигурация SQL Server) выберите, следует ли устанавливать подключение с использованием аутентификации SQL Server или аутентификации Windows. Если выбрана аутентификация SQL Server, то следует ввести существующие учетные данные. Укажите имя SQL Server и имя базы данных, которую требуется синхронизировать. Нажмите кнопку **Test connection** (Проверить подключение), чтобы проверить параметры. Затем нажмите кнопку **Save** (Сохранить). Зарегистрированная база данных появится в списке.

        ![База данных SQL Server зарегистрирована](media/sql-database-get-started-sql-data-sync/datasync-preview-agent-dbadded.png)

    11. Теперь можно закрыть приложение агента клиента синхронизации.

    12. На портале в колонке **Настройка локальной среды** щелкните **Выберите базу данных**. Откроется колонка **Выбор базы данных**.

    13. В колонке **Выбор базы данных** в поле **Имя участника синхронизации** укажите имя нового члена синхронизации. Это имя должно отличаться от имени самой базы данных. Выберите базу данных из списка. В поле **Направления синхронизации** выберите параметр "Двунаправленная синхронизация", "К концентратору" или "Из концентратора".

        ![Выбор локальной базы данных](media/sql-database-get-started-sql-data-sync/datasync-preview-selectdb.png)

    14. Нажмите кнопку **ОК**, чтобы закрыть колонку **Выбор базы данных**. Затем нажмите кнопку **ОК**, чтобы закрыть колонку **Настройка локальной среды** и подождите, пока новый член синхронизации будет создан и развернут. Наконец, нажмите кнопку **ОК**, чтобы закрыть колонку **Выбор членов синхронизации**.

        ![Локальная база данных добавлена в группу синхронизации](media/sql-database-get-started-sql-data-sync/datasync-preview-onpremadded.png)

3.  Чтобы подключиться к службе синхронизации данных SQL и локальному агенту, добавьте имя пользователя в роль `DataSync_Executor`. Служба синхронизации данных создает эту роль в экземпляре SQL Server.

## <a name="step-3---configure-sync-group"></a>Шаг 3. Настройка группы синхронизации

После создания и развертывания группы синхронизации в колонке **Новая группа синхронизации** выделяется шаг 3, **Настройка группы синхронизации**.

1.  В колонке **Таблицы** выберите базу данных из списка членов группы синхронизации, а затем щелкните **Обновить схему**.

2.  Из списка доступных таблиц выберите таблицы, которые необходимо синхронизировать.

    ![Выбор таблиц для синхронизации](media/sql-database-get-started-sql-data-sync/datasync-preview-tables.png)

3.  По умолчанию выбраны все столбцы в таблице. Если вы не хотите синхронизировать все столбцы, снимите флажки для столбцов, которые не нужно синхронизировать. Обязательно оставьте выбранным столбец первичного ключа.

    ![Выбор полей для синхронизации](media/sql-database-get-started-sql-data-sync/datasync-preview-tables2.png)

4.  Наконец, щелкните **Сохранить**.

## <a name="next-steps"></a>Дальнейшие действия
Поздравляем! Вы создали группу синхронизации, которая включает и экземпляр базы данных SQL, и базу данных SQL Server.

Дополнительные сведения о базе данных SQL и синхронизации данных SQL:

-   [Загрузка технической документации по синхронизации данных SQL](https://github.com/Microsoft/sql-server-samples/raw/master/samples/features/sql-data-sync/Data_Sync_Preview_full_documentation.pdf?raw=true)
-   [Документация по REST API синхронизации данных SQL](https://github.com/Microsoft/sql-server-samples/raw/master/samples/features/sql-data-sync/Data_Sync_Preview_REST_API.pdf?raw=true)
-   [Обзор Базы данных SQL](sql-database-technical-overview.md)
-   [Управление жизненным циклом базы данных](https://msdn.microsoft.com/library/jj907294.aspx)

