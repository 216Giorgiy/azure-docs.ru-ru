<properties 
	pageTitle="Подключение к базе данных SQL: ссылки, рекомендации и советы по разработке"
	description="Начальный раздел, в котором содержатся ссылки и рекомендации для клиентских программ, которые подключаются к базе данных Azure SQL из разных технологий, например ADO.NET и PHP."
	services="sql-database"
	documentationCenter=""
	authors="MightyPen"
	manager="jeffreyg"
	editor=""/>


<tags 
	ms.service="sql-database"
	ms.workload="data-management"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="09/02/2015"
	ms.author="genemi"/>


# Подключение к базе данных SQL: ссылки, рекомендации и советы по разработке


В этом разделе описывается, как приступить к подключению клиента к базе данных SQL Azure. Здесь содержатся ссылки на примеры кодов для различных технологий, которые можно использовать для подключения к базе данных SQL и взаимодействия с ней. К таким технологиям относятся Enterprise Library, JDBC, PHP и ряд других. Сведения, содержащиеся в данной статье, можно применять независимо от того, какие технологии вы используете для подключения к базе данных SQL.


## Универсальные рекомендации


- [Рекомендации по подключению к базе данных SQL Azure программными средствами](http://msdn.microsoft.com/library/azure/ee336282.aspx). В этой статье рассматриваются следующие темы:
 - [порты и брандмауэры;](sql-database-configure-firewall-settings.md/)
 - строки подключения.
- [Управление ресурсами в базе данных SQL Azure](https://msdn.microsoft.com/library/azure/dn338083.aspx). В этой статье рассматриваются следующие темы:
 - управление ресурсами;
 - принудительные ограничения;
 - Регулирование


## Рекомендации по аутентификации


- Используйте проверку подлинности базы данных SQL Azure, а не проверку подлинности Windows, которая недоступна в базе данных SQL Azure.
- Укажите конкретную базу данных, а не базу данных *master*, использующуюся по умолчанию.
 - В базе данных SQL невозможно использовать инструкцию Transact-SQL **USE myDatabaseName;** для переключения на другую базу данных.


### Автономные пользователи


При добавлении нового пользователя базы данных SQL, доступны следующие варианты:

- Добавить *имя входа* и пароль для **основной** базы данных, а затем добавить соответствующего *пользователя* в одну или нескольких других баз данных на том же сервере.

- Добавить *автономного пользователя* с паролем в одну или нескольких других баз данных без ссылки на какое-либо *имя входа* в **основной** базе данных.


Метод автономного пользователя иметь свои преимущества и недостатки.

- Преимущество в том, что в случае, когда все пользователи базы данных автономны, ее легко можно перенести с одного сервера баз данных SQL Azure на другой.

- Недостаток — более сложные процедуры стандартного администрирования. Например:
 - Перенести несколько автономных пользователей сложнее, чем перенести одно имя входа.
 - Человеку, который является автономным пользователем сразу нескольких баз данных, придется запомнить или изменить больше паролей.


Дополнительные сведения см. в статье [Автономные базы данных](http://msdn.microsoft.com/library/ff929071.aspx).


## Рекомендации по подключению


- В логике подключения к клиенту задайте для времени ожидания по умолчанию 30 секунд.
 - Установленных изначально 15 секунд недостаточно, если подключение зависит от Интернета.


- Убедитесь, что [брандмауэр базы данных SQL Azure](sql-database-firewall-configure.md) пропускает исходящие TCP-подключения через порт 1433.
 - Параметры брандмауэра можно настроить на сервере базы данных SQL или для отдельной базы данных.


- Для обработки *временных сбоев* добавьте в клиентские программы, взаимодействующие с базой данных SQL Azure, логику [*повтора*](#TransientFaultsAndRetryLogicGm).


### Пул подключений


Если вы используете [пул подключений](http://msdn.microsoft.com/library/8xx3tyca.aspx), то закройте экземпляр подключения, который ваша программа не использует активно и который не предполагается использовать повторно.

Если программа сразу же, без задержки, не инициирует повторное подключение для выполнения другой операции, рекомендуем вам выполнить следующие действия.

- Откройте подключение.
- Выполните одну операцию за время подключения.
- Закройте подключение.


#### Исключение, возникающее при использовании пула


Если пул подключений включен и возникает ошибка времени ожидания или другая ошибка входа, выдается исключение. В течение следующих 5 секунд (так называемого *периода блокировки*) попытки подключения будут завершаться ошибкой.

Если приложение пытается установить подключение до конца периода блокировки, первое исключение будет выдано снова. Сбои, возникшие после завершения периода блокировки, вызовут новый период блокировки, который продлится в два раза дольше, чем предыдущий.

Максимальная длительность периода блокировки — 60 секунд.


### Порты, отличные от 1433, в версии 12


Клиентские подключения к версии 12 Базы данных SQL Azure иногда обходят прокси-сервер и взаимодействуют непосредственно с базой данных. Порты, отличные от 1433, становятся важными. Дополнительные сведения см. в статье <br/> [Порты кроме 1433 для ADO.NET 4.5 и базы данных SQL версии 12](sql-database-develop-direct-route-ports-adonet-v12.md).


В следующем разделе приводятся дополнительные сведения о логике повторных попыток и обработке временных сбоев.



<a name="TransientFaultsAndRetryLogicGm" id="TransientFaultsAndRetryLogicGm"></a>

&nbsp;

## Временные сбои и логика повторных попыток


Система Azure способна динамически изменять конфигурацию серверов в случае высокой рабочей нагрузки на службу баз данных SQL.

При этом в результате изменения конфигурации программа клиента может потерять подключение к базе данных SQL. Эта ошибка вызывается *временным сбоем*.

Программа клиента может попытаться восстановить подключение, выждав от 6 до 60 секунд после каждой попытки. В клиенте необходимо установить логику повторных попыток.

Примеры кода, демонстрирующие логику повторных попыток, см. в статье [Простые примеры кода клиентских приложений для работы с базой данных SQL￼](sql-database-develop-quick-start-client-code-samples.md).


### Номера ошибок для временных сбоев


При появлении любой ошибки, связанной с базой данных SQL, возникает исключение [SqlException](http://msdn.microsoft.com/library/system.data.sqlclient.sqlexception.aspx). **SqlException** содержит числовой код ошибки в своем свойстве **Number**. Если код ошибки указан в списке временных ошибок, программа должна повторить вызов.


- [Сообщения об ошибках для клиентских программ базы данных SQL](sql-database-develop-error-messages.md#bkmk_connection_errors)
 - Раздел **Временные ошибки, ошибки потери подключения** содержит список временных ошибок, которые гарантируют автоматический повтор попытки.
 - Например, повторная попытка будет выполнена при появлении ошибки 40613, имеющей примерно следующее описание: <br/>*База данных "моя\_база\_данных" на сервере "сервер" сейчас недоступна.*


Дополнительные сведения см. в разделе: [Разработка баз данных SQL Azure: практические руководства](http://msdn.microsoft.com/library/azure/ee621787.aspx) — [Устранение проблем подключения к базе данных SQL Azure](http://support.microsoft.com/kb/2980233/)


## Технологии


В следующих разделах содержатся ссылки на примеры кода для нескольких языков и технологии драйверов, которые можно использовать для подключения к базе данных SQL Azure из клиентской программы.


Примеры кода приведены для клиентов, работающих в среде Windows, Linux и Mac OS X.


**Общие примеры.** Имеется несколько [примеров кода](sql-database-develop-quick-start-client-code-samples.md) для различных языков программирования, включая PHP, Python, Node.js и .NET CSharp. Кроме того, представлены примеры для клиентов под управлением Windows, Linux и Mac OS X.


**Эластичное масштабирование.** Сведения о том, как подключаться к базам данных с эластичным масштабированием, см. в указанных ниже статьях.

- [Начало работы с эластичным масштабированием базы данных SQL Azure (предварительная версия)](sql-database-elastic-scale-get-started.md)
- [Маршрутизация, зависящая от данных](sql-database-elastic-scale-data-dependent-routing.md)


**Библиотеки драйверов.** Сведения о библиотеках драйверов подключений, включая рекомендуемые версии, см. в указанных ниже статьях.

- [Библиотеки подключений для базы данных SQL и SQL Server](sql-database-libraries.md)

<!---HONumber=September15_HO1-->