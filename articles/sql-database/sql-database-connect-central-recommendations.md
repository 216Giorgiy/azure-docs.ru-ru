<properties 
	pageTitle="Подключение к базе данных SQL: ссылки, рекомендации и советы по разработке" 
	description="Начальный раздел, в котором содержатся ссылки и рекомендации для клиентских программ, которые подключаются к базе данных Azure SQL из разных технологий, например ADO.NET и PHP." 
	services="sql-database" 
	documentationCenter="" 
	authors="MightyPen" 
	manager="jeffreyg" 
	editor=""/>


<tags 
	ms.service="sql-database" 
	ms.workload="data-management" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="07/21/2015" 
	ms.author="genemi"/>


# Подключение к базе данных SQL: ссылки, рекомендации и советы по разработке


В этом разделе описывается, как приступить к подключению клиента к базе данных SQL Azure. Здесь содержатся ссылки на примеры кодов для различных технологий, которые можно использовать для подключения к базе данных SQL и взаимодействия с ней. К таким технологиям относятся Enterprise Library, JDBC, PHP и ряд других. Приведенные здесь рекомендации являются универсальными и применяются независимо от технологии подключения или языка программирования.


## Универсальные рекомендации


Приведенные в этом разделе сведения не зависят от технологий подключения к базе данных SQL.


- [Рекомендации по программному подключению к базе данных SQL Azure](http://msdn.microsoft.com/library/azure/ee336282.aspx). В данном разделе рассматриваются следующие темы:
 - порты;
 - брандмауэры;
 - Строки подключения
- [Управление ресурсами в базе данных SQL Azure](https://msdn.microsoft.com/library/azure/dn338083.aspx). В данном разделе рассматриваются следующие темы:
 - управление ресурсами;
 - принудительные ограничения;
 - Регулирование


Независимо от используемой технологии подключения некоторые настройки брандмауэра для сервера базы данных SQL и даже для отдельных баз данных все же имеют значение.


- [Брандмауэр базы данных SQL Azure](https://msdn.microsoft.com/library/azure/ee621782.aspx)


## Рекомендация: проверка подлинности


- Используйте аутентификацию базы данных SQL, а не Windows.
- Укажите конкретную базу данных, а не *главную* базу данных по умолчанию.
- В некоторых случаях к имени пользователя необходимо добавить суффикс *@имя_сервера*, но обычно его можно не использовать. Все зависит от того, как написано ваше средство или API.
 - Проверьте информацию для каждой технологии.
- Для подключения укажите пользователя в [автономной базе данных](http://msdn.microsoft.com/library/ff929071.aspx).
 - Это даст более высокую производительность и масштабируемость, так как вход в базу данных master будет исключен.
 - Вы не можете использовать инструкцию Transact-SQL **USE myDatabaseName;** в Базе данных SQL.


## Рекомендации: подключение


- В логике подключения к клиенту задайте для времени ожидания по умолчанию 30 секунд.
 - Установленных изначально 15 секунд недостаточно, если подключение зависит от Интернета.
- Убедитесь, что [брандмауэр Базы данных Azure SQL](http://msdn.microsoft.com/library/ee621782.aspx) пропускает исходящие подключения TCP через порт 1433.
 - Параметры [брандмауэра](http://msdn.microsoft.com/library/azure/ee621782.aspx) можно настроить на сервере Базы данных SQL или для отдельной базы данных.
- Если вы используете [пул подключений](http://msdn.microsoft.com/library/8xx3tyca.aspx), закройте экземпляр подключения, который программа активно не использует и не собирается использовать повторно.
 - Если программа сразу же, без задержки, не инициирует повторное подключение для выполнения другой операции, рекомендуем вам выполнить следующие действия:<br/><br/>Откройте подключение. <br/>Выполните одну операцию за время подключения. <br/>Закройте подключение.<br/><br/>
- Используйте логический алгоритм повтора для логики подключений, но только в отношении временных ошибок. Если используется база данных SQL, попытка открыть подключение или отправить запрос может завершиться ошибкой. Причины могут быть разные.
 - Одна из основных — неправильный формат строки подключения.
 - Одной из временных причин сбоев может быть то, что системе базы данных Azure SQL нужно сбалансировать общую нагрузку. Временная причина исчезает сама по себе, а это означает, что программа успешно выполнит повторную попытку подключения.
 - При повторной попытке отправки запроса сперва закройте подключение, а затем откройте его снова.


В следующем разделе приводятся дополнительные сведения о логике повторных попыток и обработке временных сбоев.


## Временные ошибки и логика повторных попыток


Облачные службы, например Azure и ее служба базы данных SQL, всегда сталкиваются с проблемой балансировки рабочих нагрузок и управления ресурсами. Если в ходе выполнения некоторой сложной задачи, для которой нужен очень внушительный объем ресурсов, одновременно применяются две базы данных, размещенные на одном компьютере, то система управления может принять решение о сдвиге рабочей нагрузки с одной базы данных на другой ресурс, который имеет лишние ресурсы.


Во время такого сдвига базы данных могут быть временно недоступны. Это может вызвать блокировку новых подключений или привести к тому, что соединение с клиентской программой будет потеряно. Но сдвиг ресурсов носит временный характер. Данный процесс может завершиться в течение несколько минут или даже секунд. По окончании сдвига клиентская программа может восстановить подключение и возобновить работу. Приостановка в работе является менее болезненной ситуацией, чем сбой клиентской программы (который можно предотвратить).


При возникновении любой ошибки с Базой данных SQL возникает исключение [SqlException](https://msdn.microsoft.com/library/system.data.sqlclient.sqlexception.aspx). `SqlException` содержит числовой код ошибки в своем свойстве **Number**. Если код ошибки указан в списке временных ошибок, программа должна повторить вызов.


- [Сообщения об ошибках (База данных SQL Azure)](http://msdn.microsoft.com/library/azure/ff394106.aspx)
 - Раздел **Временные ошибки, ошибки потери соединения** содержит список временных ошибок, которые гарантируют автоматический повтор попытки.
 - Например, повторная попытка выполняется, если происходит ошибка номер 40613, которая сообщает примерно следующее: <br/>*База данных "mydatabase" на сервере "сервер" в данный момент недоступна.*


Временные *ошибки* иногда называются временными *сбоями*. В данном разделе два этих термина являются синонимами.


Дополнительные сведения о том, что делать при возникновении ошибок подключения (постоянных или временных), см. в следующем разделе:


- [Устранение неполадок подключения к базе данных SQL Microsoft Azure](http://support.microsoft.com/kb/2980233/)


Ссылки на примеры кода, которые демонстрируют логику повторных попыток, см. на следующих страницах:


- [Простые примеры кода клиентских приложений для работы с Базой данных SQL](sql-database-develop-quick-start-client-code-samples.md)


<a id="gatewaynoretry" name="gatewaynoretry">&nbsp;</a>


## В версии 12 шлюз больше не предоставляет логику повторных попыток


До версии 12 Базы данных SQL Azure включали шлюз, который действовал как прокси для буферизации всех взаимодействий между базой данных и клиентской программой. Шлюз был дополнительным прыжком сети, который иногда повышал задержку доступа к базам данных.


В версии 12 этот шлюз отсутствует. Теперь:


- клиентская программа взаимодействует *непосредственно* с базой данных, что является более эффективным;
- небольшие искажения шлюза в сообщениях об ошибках и других сообщениях программе устранены;
 - внешний вид Базы данных SQL и SQL Server больше похож на внешний вид вашей программы.


#### Устранение логики повторных попыток


Шлюз обеспечивал обработку некоторых временных ошибок с помощью логики повторных попыток. Теперь ваша программа должна обеспечивать более полную обработку временных ошибок. Примеры кода, связанные с логикой повторных ошибок, см. на следующих страницах:


- [Разработка клиентских приложений и примеры кода для быстрого запуска в Базе данных SQL](sql-database-develop-quick-start-client-code-samples.md)
 - Содержит ссылки на примеры кода, включающие логику повторных ошибок, а также на более простые примеры с подключением и запросами.
- [Практическое руководство. Надежное подключение к Базе данных Azure SQL](http://msdn.microsoft.com/library/azure/dn864744.aspx)
- [Практическое руководство. Подключение к Базе данных Azure SQL с помощью ADO.NET с Enterprise Library](http://msdn.microsoft.com/library/azure/dn961167.aspx)
- [Практическое руководство. Подключение к Базе данных Azure SQL с помощью ADO.NET](http://msdn.microsoft.com/library/azure/ee336243.aspx)


## Технологии


В следующих разделах содержатся ссылки на примеры кода для нескольких языков и технологии драйверов, которые можно использовать для подключения к базе данных SQL Azure из клиентской программы.


Примеры кода приведены для клиентов, работающих в среде Windows, Linux и Mac OS X.


**Общие примеры:** есть несколько примеров кода для различных языков программирования, включая PHP, Python, Node.js и .NET CSharp. Кроме того, представлены примеры для клиентов под управлением Windows, Linux и Mac OS X.


- [Разработка клиентских приложений и примеры кода для быстрого запуска в Базе данных SQL](sql-database-develop-quick-start-client-code-samples.md)
- [Разработка для базы данных SQL Azure: разделы практического руководства](http://msdn.microsoft.com/library/azure/ee621787.aspx)


**Эластичное масштабирование.** Сведения о возможности подключения к базам данных с эластичным масштабированием см. в разделах:


- [Начало работы с эластичным масштабированием базы данных SQL Azure (предварительная версия)](sql-database-elastic-scale-get-started.md)
- [Маршрутизация, зависящая от данных](sql-database-elastic-scale-data-dependent-routing.md)


**Библиотеки драйверов.** Сведения о библиотеках драйверов для подключения, включая рекомендуемые версии, см. в разделах:


- [Библиотеки подключений для базы данных SQL и SQL Server](sql-database-libraries.md)


## См. также


- [Создание первой базы данных SQL Azure](sql-database-get-started.md)

 

<!---HONumber=July15_HO4-->