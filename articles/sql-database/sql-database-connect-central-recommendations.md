<properties 
	pageTitle="Подключение к базе данных SQL: рекомендации | Microsoft Azure" 
	description="Начальный раздел, в котором содержатся ссылки и рекомендации для клиентских программ, которые подключаются к базе данных Azure SQL из разных технологий, например ADO.NET и PHP." 
	services="sql-database" 
	documentationCenter="" 
	authors="MightyPen" 
	manager="jeffreyg" 
	editor=""/>


<tags 
	ms.service="sql-database" 
	ms.workload="data-management" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/07/2016" 
	ms.author="genemi"/>


# Подключение к базе данных SQL: рекомендации и советы по разработке


В этом разделе описывается, как приступить к подключению клиента к базе данных SQL Azure. Здесь содержатся ссылки на примеры кодов для различных технологий, которые можно использовать для подключения к базе данных SQL и взаимодействия с ней. К таким технологиям относятся Enterprise Library, JDBC, PHP и ряд других. Сведения, содержащиеся в данной статье, можно применять независимо от того, какие технологии вы используете для подключения к базе данных SQL.


<a id="a-tech-independent-recommend" name="a-tech-independent-recommend"></a>

## Универсальные рекомендации


- [Рекомендации по подключению к базе данных SQL Azure программными средствами](http://msdn.microsoft.com/library/azure/ee336282.aspx). В этой статье рассматриваются следующие темы:
 - [порты и брандмауэры;](sql-database-configure-firewall-settings.md)
 - строки подключения.
- [Управление ресурсами в базе данных SQL Azure](http://msdn.microsoft.com/library/azure/dn338083.aspx). В данном разделе рассматриваются следующие темы:
 - управление ресурсами;
 - принудительные ограничения;
 - Регулирование


<a id="b-authentication-recommend" name="b-authentication-recommend"></a>

## Рекомендации по аутентификации


- Используйте проверку подлинности базы данных SQL Azure, а не проверку подлинности Windows, которая недоступна в базе данных SQL Azure.
- Укажите конкретную базу данных, а не базу данных *master*, использующуюся по умолчанию.
 - В базе данных SQL невозможно использовать инструкцию Transact-SQL **USE myDatabaseName;** для переключения на другую базу данных.


### Автономные пользователи


При добавлении нового пользователя базы данных SQL, доступны следующие варианты:

- Добавьте *имя входа* и пароль для **основной** базы данных, а затем добавьте соответствующего *пользователя* в одну или нескольких других баз данных на том же сервере.

- Добавьте *автономного пользователя* с паролем в одну или несколько баз данных без ссылки на какое-либо *имя входа* в базе данных **master**.


Метод автономного пользователя иметь свои преимущества и недостатки.

- Преимущество в том, что в случае, когда все пользователи базы данных автономны, ее легко можно перенести с одного сервера баз данных SQL Azure на другой.

- Недостаток — более сложные процедуры стандартного администрирования. Например:
 - Перенести несколько автономных пользователей сложнее, чем перенести одно имя входа.
 - Человеку, который является автономным пользователем сразу нескольких баз данных, придется запомнить или изменить больше паролей.


Дополнительные сведения см. в статье [Пользователи автономной базы данных — создание переносимой базы данных](http://msdn.microsoft.com/library/ff929188.aspx).


<a id="c-connection-recommend" name="c-connection-recommend"></a>

## Рекомендации по подключению


- В логике подключения к клиенту задайте для времени ожидания по умолчанию 30 секунд.
 - Установленных изначально 15 секунд недостаточно, если подключение зависит от Интернета.


- На компьютере с вашей клиентской программой убедитесь, что брандмауэр разрешает исходящие TCP-соединения через порт 1433.


- Если клиентская программа подключается к базы данных SQL V12, а клиент работает на виртуальной машине Azure (ВМ), необходимо открыть на ней диапазоны портов 11000–11999 и 14000–14999. Щелкните [здесь](sql-database-develop-direct-route-ports-adonet-v12.md), чтобы узнать больше.


- Для обработки *временных сбоев* добавьте в клиентские программы, взаимодействующие с базой данных SQL Azure, логику [*повторных попыток*](#TransientFaultsAndRetryLogicGm).


### Пул подключений


Если вы используете [пул подключений](http://msdn.microsoft.com/library/8xx3tyca.aspx), закройте экземпляр подключения, который ваша программа не использует активно и который не предполагается использовать повторно.

Если программа сразу же, без задержки, не инициирует повторное подключение для выполнения другой операции, рекомендуем вам выполнить следующие действия.

- Откройте подключение.
- Выполните одну операцию за время подключения.
- Закройте подключение.


### Порты, отличные от 1433, в версии 12


Клиентские подключения к версии 12 Базы данных SQL Azure иногда обходят прокси-сервер и взаимодействуют непосредственно с базой данных. Порты, отличные от 1433, становятся важными. Дополнительные сведения см. в статье <br/> [Порты кроме 1433 для ADO.NET 4.5 и базы данных SQL версии 12](sql-database-develop-direct-route-ports-adonet-v12.md).


В следующем разделе приводятся дополнительные сведения о логике повторных попыток и обработке временных сбоев.



<a name="TransientFaultsAndRetryLogicGm" id="TransientFaultsAndRetryLogicGm"></a>

&nbsp;

## Временные сбои и логика повторных попыток


Система Azure способна динамически изменять конфигурацию серверов в случае высокой рабочей нагрузки на службу баз данных SQL.

При этом в результате изменения конфигурации программа клиента может потерять подключение к базе данных SQL. Эта ошибка вызывается *временным сбоем*.

Если клиентская программа содержит логику повторных попыток, она может попытаться восстановить соединение после определенного периода, позволяющего временной ошибке самоустраниться.

Рекомендуется подождать 5 секунд, прежде чем выполнять первую повторную попытку. Повторная попытка после ожидания менее 5 секунд может привести к перегрузке облачной службы. Для каждой последующей повторной попытки ожидание должно увеличиваться экспоненциально, но не более чем до 60 секунд.

Обсуждение *периода блокировки* для клиентов, которые используют ADO.NET, см. в статье [Пул подключений SQL Server (ADO.NET)](http://msdn.microsoft.com/library/8xx3tyca.aspx).


Примеры кода, иллюстрирующие логику повторных попыток, см. в следующих разделах:

- [Простые примеры кода клиентских приложений для работы с базой данных SQL](sql-database-develop-quick-start-client-code-samples.md)


### Номера ошибок для временных сбоев


При появлении любой ошибки, связанной с базой данных SQL, возникает исключение [SqlException](http://msdn.microsoft.com/library/system.data.sqlclient.sqlexception.aspx). В свойстве **Number** исключения **SqlException** содержится числовой код ошибки. Если код ошибки указан в списке временных ошибок, программа должна повторить вызов.


- [Сообщения об ошибках для клиентских программ базы данных SQL](sql-database-develop-error-messages.md#bkmk_connection_errors)
 - Раздел **Временные ошибки, ошибки потери подключения** содержит список временных ошибок, которые гарантируют автоматический повтор попытки.
 - Например, повторная попытка будет выполнена при появлении ошибки 40613, имеющей примерно следующее описание: <br/>*База данных «моя\_база\_данных» на сервере «сервер» сейчас недоступна.*


Дополнительную информацию см. в следующих статьях:

- [Разработка для базы данных SQL Azure: разделы практического руководства](http://msdn.microsoft.com/library/azure/ee621787.aspx)

<!--  (per Penny Lee, 2016/01/07.  MightyPen==GeneMi)
- [Troubleshoot connection problems to Azure SQL Database](http://support.microsoft.com/kb/2980233/)
-->


<a id="e-technologies" name="e-technologies"></a>

## Технологии


В следующих разделах содержатся ссылки на примеры кода для нескольких языков и технологии драйверов, которые можно использовать для подключения к базе данных SQL Azure из клиентской программы.


Примеры кода приведены для клиентов, работающих в среде Windows, Linux и Mac OS X.


**Общие примеры.** Существует несколько [примеров кода](sql-database-develop-quick-start-client-code-samples.md) для различных языков программирования, включая PHP, Python, Node.js и .NET CSharp. Кроме того, представлены примеры для клиентов под управлением Windows, Linux и Mac OS X.


**Эластичное масштабирование.** Сведения о том, как подключаться к базам данных с эластичным масштабированием, см. в указанных ниже статьях.

- [Начало работы с эластичным масштабированием базы данных SQL Azure (предварительная версия)](sql-database-elastic-scale-get-started.md)
- [Маршрутизация, зависящая от данных](sql-database-elastic-scale-data-dependent-routing.md)


**Библиотеки драйверов.** Сведения о библиотеках драйверов подключений, включая рекомендуемые версии, см. в указанных ниже статьях.

- [Библиотеки подключений для базы данных SQL и SQL Server](sql-database-libraries.md)

<!---HONumber=AcomDC_0114_2016-->