<properties 
	pageTitle="Подключение к базе данных SQL: ссылки, рекомендации и советы по разработке"
	description="Начальный раздел, в котором содержатся ссылки и рекомендации для клиентских программ, которые подключаются к базе данных Azure SQL из разных технологий, например ADO.NET и PHP."
	services="sql-database"
	documentationCenter=""
	authors="MightyPen"
	manager="jeffreyg"
	editor=""/>


<tags 
	ms.service="sql-database"
	ms.workload="data-management"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="08/05/2015"
	ms.author="genemi"/>


# Подключение к базе данных SQL: ссылки, рекомендации и советы по разработке


В этом разделе описывается, как приступить к подключению клиента к базе данных SQL Azure. Здесь содержатся ссылки на примеры кодов для различных технологий, которые можно использовать для подключения к базе данных SQL и взаимодействия с ней. К таким технологиям относятся Enterprise Library, JDBC, PHP и ряд других. Сведения, содержащиеся в данной статье, можно применять независимо от того, какие технологии вы используете для подключения к базе данных SQL.


## Универсальные рекомендации


- [Рекомендации по подключению к базе данных SQL Azure программными средствами](http://msdn.microsoft.com/library/azure/ee336282.aspx). В этой статье рассматриваются следующие темы:
 - [порты и брандмауэры;](https://azure.microsoft.com/ru-RU/documentation/articles/sql-database-configure-firewall-settings/)
 - строки подключения.
- [Управление ресурсами в базе данных SQL Azure](https://msdn.microsoft.com/library/azure/dn338083.aspx). В этой статье рассматриваются следующие темы:
 - управление ресурсами;
 - принудительные ограничения;
 - Регулирование




## Рекомендации по аутентификации


- Используйте проверку подлинности базы данных SQL Azure, а не проверку подлинности Windows, которая недоступна в базе данных SQL Azure.
- Укажите конкретную базу данных, а не базу данных *master*, использующуюся по умолчанию.
- Для подключения укажите пользователя в [автономной базе данных](http://msdn.microsoft.com/library/ff929071.aspx).
 - Это даст более высокую производительность и масштабируемость, так как вход в базу данных master будет исключен.
 - В базе данных SQL невозможно использовать инструкцию Transact-SQL **USE myDatabaseName;**.


## Рекомендации по подключению


- В логике подключения к клиенту задайте для времени ожидания по умолчанию 30 секунд.
 - Установленных изначально 15 секунд недостаточно, если подключение зависит от Интернета.
- Убедитесь, что [брандмауэр базы данных SQL Azure](http://msdn.microsoft.com/library/ee621782.aspx) пропускает исходящие TCP-подключения через порт 1433.
 - Параметры [брандмауэра](http://msdn.microsoft.com/library/azure/ee621782.aspx) можно настроить на сервере базы данных SQL или для отдельной базы данных.
- Если вы используете [пул подключений](http://msdn.microsoft.com/library/8xx3tyca.aspx), то закройте экземпляр подключения, который ваша программа не использует активно и который не предполагается использовать повторно.
 - Если не предполагается, что программа сразу же, без задержки, будет инициировать повторное подключение для выполнения другой операции, то рекомендуем выполнять указанные ниже действия.<br/><br/>Откройте подключение. <br/>Выполните одну операцию за время подключения. <br/>Закройте подключение.<br/><br/>
- Используйте логический алгоритм повтора для логики подключений, но только в отношении временных ошибок. Если используется база данных SQL, попытка открыть подключение или отправить запрос может завершиться ошибкой. Причины могут быть разные.
 - Одна из основных — неправильный формат строки подключения.
 - Одной из временных причин сбоев может быть то, что системе базы данных Azure SQL нужно сбалансировать общую нагрузку. Временная причина исчезает сама по себе, а это означает, что программа успешно выполнит повторную попытку подключения.
 - При повторной попытке отправки запроса сперва закройте подключение, а затем откройте его снова.


### Порты, отличные от 1433, в версии 12


Клиентские подключения к версии 12 Базы данных SQL Azure иногда обходят прокси-сервер и взаимодействуют непосредственно с базой данных. Порты, отличные от 1433, становятся важными. Дополнительные сведения см. в статье <br/> [Порты кроме 1433 для ADO.NET 4.5, ODBC 11 и базы данных SQL версии 12](sql-database-develop-direct-route-ports-adonet-v12.md).


В следующем разделе приводятся дополнительные сведения о логике повторных попыток и обработке временных сбоев.


## Временные ошибки и логика повторных попыток


Облачные службы, например Azure и ее служба базы данных SQL, всегда сталкиваются с проблемой балансировки рабочих нагрузок и управления ресурсами. Если в ходе выполнения некоторой сложной задачи, для которой нужен очень внушительный объем ресурсов, одновременно применяются две базы данных, размещенные на одном компьютере, то система управления может принять решение о сдвиге рабочей нагрузки с одной базы данных на другой ресурс, который имеет лишние ресурсы.


Во время такого сдвига базы данных могут быть временно недоступны. Это может вызвать блокировку новых подключений или привести к тому, что соединение с клиентской программой будет потеряно. Но сдвиг ресурсов носит временный характер. Данный процесс может завершиться в течение несколько минут или даже секунд. По окончании сдвига клиентская программа может восстановить подключение и возобновить работу. Приостановка в работе является менее болезненной ситуацией, чем сбой клиентской программы (который можно предотвратить).


При появлении любой ошибки, связанной с базой данных SQL, возникает исключение [SqlException](https://msdn.microsoft.com/library/system.data.sqlclient.sqlexception.aspx). Свойство **Number** исключения `SqlException` содержит числовой код ошибки. Если код ошибки указан в списке временных ошибок, программа должна повторить вызов.


- [Сообщения об ошибках для клиентских программ базы данных SQL](sql-database-develop-error-messages.md)
 - Раздел **Временные ошибки, ошибки потери подключения** содержит список временных ошибок, которые гарантируют автоматический повтор попытки.
 - Например, повторная попытка будет выполнена при появлении ошибки 40613, имеющей примерно следующее описание: <br/>*База данных "моя\_база\_данных" на сервере "сервер" сейчас недоступна.*


Иногда временные *ошибки* называют временными *сбоями*. В данном разделе два этих термина являются синонимами.


Дополнительные сведения о том, что делать при возникновении ошибок подключения (постоянных или временных), см. в следующем разделе:


- [Устранение неполадок подключения к базе данных SQL Microsoft Azure](http://support.microsoft.com/kb/2980233/)


Ссылки на примеры кода, которые демонстрируют логику повторных попыток, см. на следующих страницах:


- [Простые примеры кода клиентских приложений для работы с Базой данных SQL](sql-database-develop-quick-start-client-code-samples.md)


<a id="gatewaynoretry" name="gatewaynoretry">&nbsp;</a>


## Прокси промежуточного слоя и логика повторных попыток


Прокси-сервер промежуточного слоя, который является посредником между V11 и вашим клиентом ADO.NET 4.5, безопасно обрабатывает небольшое подмножество временных сбоев с помощью логической схемы повторных попыток. В случаях, когда прокси-сервер успешно подключается со второй попытки, клиентская программа так и не получает сведения о том, что первая попытка была неудачной.


Прокси-сервер V12 обрабатывает меньшее подмножество временных сбоев. В других случаях V12 выполняется обход прокси-сервера для увеличения скорости, обеспечиваемого прямым подключением к Базе данных SQL. В связи с этими изменениями База данных SQL Azure (V12) для клиентской программы ADO.NET 4.5 больше похожа на Microsoft SQL Server.


Примеры кода, демонстрирующие логику повторных попыток, см. в статье <br/>[Простые примеры кода клиентских приложений для работы с базой данных SQL](sql-database-develop-quick-start-client-code-samples.md).


> [AZURE.TIP]В рабочей среде клиентам, подключающимся к версии 11 или 12 Базы данных SQL Azure, рекомендуется реализовывать логику повторных попыток в своем коде. Это может быть пользовательский код или код, который использует API, например Enterprise Library.


## Технологии


В следующих разделах содержатся ссылки на примеры кода для нескольких языков и технологии драйверов, которые можно использовать для подключения к базе данных SQL Azure из клиентской программы.


Примеры кода приведены для клиентов, работающих в среде Windows, Linux и Mac OS X.


**Общие примеры.** Имеется несколько примеров кода для различных языков программирования, включая PHP, Python, Node.js и .NET CSharp. Кроме того, представлены примеры для клиентов под управлением Windows, Linux и Mac OS X.


- [Разработка клиентских приложений и примеры кода для быстрого запуска в Базе данных SQL](sql-database-develop-quick-start-client-code-samples.md)
- [Разработка для базы данных SQL Azure: разделы практического руководства](http://msdn.microsoft.com/library/azure/ee621787.aspx)


**Эластичное масштабирование.** Сведения о том, как подключаться к базам данных с эластичным масштабированием, см. в указанных ниже статьях.


- [Начало работы с эластичным масштабированием базы данных SQL Azure (предварительная версия)](sql-database-elastic-scale-get-started.md)
- [Маршрутизация, зависящая от данных](sql-database-elastic-scale-data-dependent-routing.md)


**Библиотеки драйверов.** Сведения о библиотеках драйверов подключений, включая рекомендуемые версии, см. в указанных ниже статьях.


- [Библиотеки подключений для базы данных SQL и SQL Server](sql-database-libraries.md)


## См. также


- [Создание первой базы данных SQL Azure](sql-database-get-started.md)

 

<!---HONumber=August15_HO9-->