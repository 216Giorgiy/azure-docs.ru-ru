---
title: "Защита базы данных SQL Azure | Документация Майкрософт"
description: "Узнайте о методах и функциях, используемых для защиты Базы данных SQL Azure."
services: sql-database
documentationcenter: 
author: DRediske
manager: jhubbard
editor: 
tags: 
ms.assetid: 
ms.service: sql-database
ms.custom: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: 
ms.date: 05/07/2017
ms.author: daredis
ms.translationtype: Human Translation
ms.sourcegitcommit: 18d4994f303a11e9ce2d07bc1124aaedf570fc82
ms.openlocfilehash: 34815f5b716a38f957392d8955f924eeb6fe621e
ms.contentlocale: ru-ru
ms.lasthandoff: 05/09/2017


---
# <a name="secure-your-azure-sql-database"></a>Защита базы данных SQL Azure

База данных SQL защищает данные путем ограничения доступа к ним с помощью правил брандмауэра, механизмов проверки подлинности, предусматривающих идентификацию пользователей, и авторизации доступа на основе членства с учетом ролей и разрешений, а также с использованием безопасности на уровне строк и динамического маскирования данных.

Выполнив всего несколько простых действий, можно значительно повысить уровень защиты базы данных от пользователей-злоумышленников или несанкционированного доступа. Из этого руководства вы узнаете, как выполнять такие задачи. 

> [!div class="checklist"]
> * Настройка правил брандмауэра для сервера и базы данных.
> * Подключение к базе данных с помощью безопасной строки подключения.
> * Управление доступом пользователей.
> * Защита данных с помощью шифрования
> * Включение аудита базы данных SQL
> * Включение обнаружения угроз базы данных SQL

Для работы с этим руководством у вас должны быть установлены Excel и последняя версия [SQL Server Management Studio](https://msdn.microsoft.com/library/ms174173.aspx) (SSMS).


## <a name="set-up-firewall-rules-for-your-database"></a>Настройка правил брандмауэра для базы данных

Базы данных SQL защищены брандмауэром в Azure. По умолчанию все подключения к серверу и базам данных на сервере отклоняются, за исключением подключений служб Azure. Чтобы обеспечить наибольшую безопасность, для параметра "Разрешить доступ к службам Azure" следует установить значение "Выключено". Если необходимо подключаться к базе данных из виртуальной машины Azure или облачной службы, необходимо создать [зарезервированный IP-адрес](../virtual-network/virtual-networks-reserved-public-ip.md) и разрешить доступ через брандмауэр только с этого зарезервированного IP-адреса. 

Выполните приведенные ниже действия, чтобы создать для сервера [правило брандмауэра уровня сервера базы данных SQL](sql-database-firewall-configure.md), разрешающее подключения с определенного IP-адреса. 

1. Войдите на [портал Azure](https://portal.azure.com/).
1. Щелкните **Базы данных SQL** в левом меню, затем на странице **Базы данных SQL** щелкните базу данных, для которой вы хотите настроить правило брандмауэра. После этого откроется страница обзора базы данных, где будет указано полное имя сервера (например, **mynewserver-20170313.database.windows.net**) и предоставлены параметры для дальнейшей настройки.

      ![правило брандмауэра для сервера](./media/sql-database-security-tutorial/server-firewall-rule.png) 

2. Щелкните **Настройка брандмауэра для сервера** на панели инструментов, как показано на предыдущем рисунке. Откроется страница **параметров брандмауэра** для сервера базы данных SQL. 

3. Щелкните **Добавить IP-адрес клиента** на панели инструментов, чтобы добавить общедоступный IP-адрес компьютера, подключающегося к порталу, или вручную введите правило брандмауэра. Нажмите кнопку **Сохранить**.

      ![Настройка правила брандмауэра для сервера](./media/sql-database-security-tutorial/server-firewall-rule-set.png) 

4. Нажмите кнопку **ОК**, а затем щелкните **X**, чтобы закрыть страницу **Параметры брандмауэра**.

Теперь можно подключиться к любой базе данных на сервере с указанным IP-адресом или диапазоном IP-адресов.

> [!NOTE]
> База данных SQL обменивается данными через порт 1433. Если вы пытаетесь подключиться из корпоративной сети, исходящий трафик через порт 1433 может быть запрещен сетевым брандмауэром. В таком случае вы не сможете подключиться к серверу базы данных SQL Azure. Для этого ваш ИТ-отдел должен открыть порт 1433.
>

Если требуется использовать разные параметры брандмауэра для разных баз данных на одном логическом сервере, необходимо создать правило уровня базы данных для каждой базы данных. Правила брандмауэра уровня базы данных можно настроить только с помощью инструкций Transact-SQL и только после настройки первого правила брандмауэра уровня сервера. Ниже приведены инструкции по созданию правила брандмауэра для конкретной базы данных.

1. Подключитесь к базе данных, например с помощью [SQL Server Management Studio](./sql-database-connect-query-ssms.md).

2. В обозревателе объектов щелкните правой кнопкой мыши базу данных, для которой нужно добавить правило брандмауэра, и щелкните **Создать запрос**. Откроется пустое окно запроса, подключенное к базе данных.

3. В окне запроса введите следующее:

    ```sql
    EXECUTE sp_set_database_firewall_rule N'Example DB Rule','0.0.0.4','0.0.0.4';
    ```

4. На панели инструментов щелкните **Выполнить**, чтобы создать правило брандмауэра.

## <a name="connect-to-your-database-using-a-secure-connection-string"></a>Подключение к базе данных с помощью безопасной строки подключения.

Чтобы обеспечить безопасное зашифрованное подключение между клиентом и базой данных SQL, строка подключения должна: 1) запрашивать зашифрованное подключение и 2) не доверять сертификату сервера. В этом случае устанавливается подключение по протоколу TLS и уменьшается риск атак "злоумышленник в середине". Правильно настроенные строки подключения к базе данных SQL для поддерживаемых драйверов клиента можно получить на портале Azure, как показано для ADO.NET на приведенном снимке экрана.

1. В меню слева выберите **Базы данных SQL** и на странице **Базы данных SQL** щелкните имя своей базы данных.

2. На странице **Обзор** для базы данных щелкните **Показать строки подключения к базам данных**.

3. Просмотрите полную строку подключения **ADO.NET**.

    ![Строка подключения по протоколу ADO.NET](./media/sql-database-security-tutorial/adonet-connection-string.png)


## <a name="user-management"></a>Управление пользователями

Прежде чем создавать пользователей, необходимо выбрать один из двух типов аутентификации, поддерживаемых базой данных SQL Azure: 

**Аутентификация SQL**: для имен для входа и пользователей используются имя пользователя и пароль, действительные только в контексте конкретной базы данных на логическом сервере. 

**Аутентификация Azure Active Directory**: используются удостоверения, управляемые Azure Active Directory. 

Если вы хотите использовать [Azure Active Directory](./sql-database-aad-authentication.md) для аутентификации базы данных SQL, должен существовать предварительно заполненный каталог Azure Active Directory.

Выполните следующее, чтобы создать пользователя, использующего аутентификацию SQL.

1. Подключитесь к базе данных, например с помощью [SQL Server Management Studio](./sql-database-connect-query-ssms.md), с использованием учетных данных администратора сервера.

2. В обозревателе объектов щелкните правой кнопкой мыши базу данных, для которой нужно добавить нового пользователя, и щелкните **Создать запрос**. Откроется пустое окно запроса, связанное с выбранной базой данных.

3. В окне запроса введите следующее:

    ```sql
    CREATE USER ApplicationUserUse' WITH PASSWORD = 'YourStrongPassword1';
    ```

4. На панели инструментов щелкните **Выполнить**, чтобы создать пользователя.

5. По умолчанию пользователь может подключаться к базе данных, но не имеет разрешений на чтение и запись данных. Чтобы предоставить эти разрешения только что созданному пользователю, выполните следующие две команды в новом окне запроса.

    ```sql
    ALTER ROLE db_datareader ADD MEMBER ApplicationUserUser;
    ALTER ROLE db_datawriter ADD MEMBER ApplicationUserUser;
    ```

Рекомендуется создавать эти учетные записи без прав администратора на уровне базы данных для подключения к базе данных, если только не требуется выполнять задачи администрирования, например создавать пользователей. Ознакомьтесь с [руководством по Azure Active Directory](./sql-database-aad-authentication-configure.md), посвященном аутентификации с помощью Azure Active Directory.


## <a name="protect-your-data-with-encryption"></a>Защита данных с помощью шифрования

Прозрачное шифрование данных базы данных SQL Azure (TDE) позволяет автоматически шифровать неактивные данные, не внося каких-либо изменений в приложение, обращающееся к зашифрованной базе данных. Чтобы включить TDE для базы данных, выполните следующее.

1. В меню слева выберите **Базы данных SQL** и на странице **Базы данных SQL** щелкните имя своей базы данных. 

2. Щелкните **Прозрачное шифрование данных**, чтобы открыть страницу настройки TDE.

    ![Прозрачное шифрование данных](./media/sql-database-security-tutorial/transparent-data-encryption-enabled.png)

3. Для параметра **Шифрование данных** задайте значение "Вкл." и нажмите кнопку **Сохранить**.

Начнется процесс шифрования в фоновом режиме. Вы можете отслеживать ход выполнения, подключившись к базе данных SQL с помощью [SQL Server Management Studio](./sql-database-connect-query-ssms.md), запросив столбец encryption_state представления `sys.dm_database_encryption_keys`.

## <a name="enable-sql-database-auditing"></a>Включение аудита базы данных SQL

Аудит базы данных SQL Azure позволяет отслеживать события базы данных и записывать их в журнал аудита в учетной записи хранения Azure. Аудит может помочь вам соблюсти требования нормативов, проанализировать работу с базой данных и получить представление о расхождениях и аномалиях, которые могут указывать на предполагаемые нарушения безопасности. Чтобы создать политику аудита по умолчанию для базы данных SQL, сделайте следующее:

1. В меню слева выберите **Базы данных SQL** и на странице **Базы данных SQL** щелкните имя своей базы данных.

2. В колонке "Параметры" выберите **Аудит и обнаружение угроз**.

    ![Колонка "Аудит"](./media/sql-database-security-tutorial/auditing-get-started-settings.png)

3. В колонке для настройки аудита базы данных можно установить флажок **Наследовать настройки от сервера**. Это означает, что аудит базы данных будет выполняться в соответствии с настройками сервера. Установив этот флажок, вы увидите ссылку **Просмотр настроек аудита сервера**, позволяющую просмотреть или изменить настройки аудита сервера.

    ![Наследование параметров](./media/sql-database-security-tutorial/auditing-get-started-server-inherit.png)

4. Если вы хотите включить тип аудита (или расположение), отличный от указанного на уровне сервера, **снимите** флажок **Наследовать настройки аудита от сервера**, **включите** аудит и выберите тип аудита **Аудит BLOB-объектов**.

    > Если включен аудит BLOB-объектов сервера, настроенный аудит для базы данных будет существовать параллельно с ним.

    ![Включение аудита](./media/sql-database-security-tutorial/auditing-get-started-turn-on.png)

5. Выберите **Сведения о хранилище** , чтобы открыть колонку хранилища журналов аудита. Выберите учетную запись хранения Azure, в которой будут сохраняться журналы, и срок хранения, по истечении которого старые журналы будут удалены. Затем нажмите кнопку **ОК** внизу. **Совет.** Для того чтобы в полной мере воспользоваться возможностями шаблонов отчетов об аудите, используйте одну и ту же учетную запись хранения для всех баз данных.

    ![Область навигации](./media/sql-database-security-tutorial/auditing-get-started-storage-details.png)

6. Если вы хотите настроить события аудита, это можно сделать с помощью PowerShell или REST API. Дополнительные сведения см. в разделе [Автоматизация (PowerShell или REST API)](#subheading-7).

7. Щелкните **Сохранить**.


## <a name="enable-sql-database-threat-detection"></a>Включение обнаружения угроз базы данных SQL

Благодаря оповещениям безопасности о подозрительной активности система обнаружения угроз формирует дополнительный уровень безопасности, позволяющий клиентам обнаруживать потенциальные угрозы по мере возникновения и реагировать на них. Пользователи могут анализировать подозрительные события с помощью аудита базы данных SQL, который позволяет определить причину таких событий (попытка получить доступ к данным в базе данных, нарушить безопасность или использовать их уязвимость). Система обнаружения угроз упрощает устранение потенциальных угроз безопасности базы данных, не требуя наличия у пользователя экспертных навыков в сфере безопасности либо умения работать в сложных системах отслеживания угроз.
Например, система обнаружения угроз обнаруживает определенную подозрительную активность в базе данных, указывающую на потенциальные попытки внедрения кода SQL. Внедрение кода SQL — один из распространенных видов угроз безопасности веб-приложений в Интернете, используемый для получения несанкционированного доступа к приложениям, управляемым данными. Взломщики используют уязвимые места приложения, чтобы ввести вредоносные инструкции SQL в поля ввода приложения, чтобы нарушить или изменить данные в базе данных.

1. Перейдите к колонке настройки базы данных SQL, которую требуется отслеживать. В колонке "Параметры" выберите **Аудит и обнаружение угроз**.

    ![Область навигации](./media/sql-database-security-tutorial/auditing-get-started-settings.png)
2. В колонке настроек **Аудит и обнаружение угроз** установите переключатель аудита в положение **Вкл.**, после чего отобразятся настройки обнаружения угроз.

3. Переведите переключатель обнаружения угроз в положение **Вкл.**

4. Настройте список электронных адресов, на которые будут приходить оповещения безопасности в случае обнаружения подозрительной активности в базе данных.

5. В колонке **Аудит и обнаружение угроз** щелкните **Сохранить**, чтобы сохранить новую или обновленную версию политики аудита и обнаружения угроз.

    ![Область навигации](./media/sql-database-security-tutorial/td-turn-on-threat-detection.png)

    При обнаружении подозрительной активности в базе данных вы получите уведомление по электронной почте. В электронном сообщении будет содержаться информация о подозрительном событии безопасности, включая характер подозрительной активности, имя базы данных и сервера, а также время, когда произошло событие. Кроме того, в сообщении приводится информация о возможных причинах возникновения события, а также рекомендуемые действия по поиску и устранению потенциальной угрозы безопасности базы данных. Ниже описывается, что делать, если вы получили приведенное ниже электронное сообщение.

    ![Электронное сообщение об обнаружении угроз](./media/sql-database-threat-detection-get-started/4_td_email.png)

6. В электронном сообщении щелкните ссылку **Журнал аудита SQL Azure**, после чего откроется портал Azure и будут показаны соответствующие записи аудита, зафиксированные примерно во время возникновения подозрительного события.

    ![Записи аудита](./media/sql-database-threat-detection-get-started/5_td_audit_records.png)

7. Щелкните записи аудита, чтобы просмотреть более подробную информацию о подозрительной активности в базе данных, включая инструкции SQL, причины ошибки и IP-адрес клиента.

    ![Сведения о записи](./media/sql-database-security-tutorial/6_td_audit_record_details.png)

8. В колонке записей аудита щелкните **Открыть в Excel**, чтобы открыть предварительно настроенный шаблон Excel и импортировать для более детального анализа записи из журнала аудита, зафиксированные примерно во время возникновения подозрительного события.

    > [!NOTE]
    > В Excel 2010 или более поздней версии требуется Power Query и параметр **Быстрое объединение**.

    ![Открытые записей в Excel](./media/sql-database-threat-detection-get-started/7_td_audit_records_open_excel.png)

9. Чтобы настроить параметр **Быстрое объединение**, на вкладке ленты **POWER QUERY** выберите **Параметры**, чтобы открыть диалоговое окно "Параметры". Щелкните раздел «Конфиденциальность» и выберите в нем второй вариант — «Игнорировать уровни конфиденциальности и по возможности повышать производительность»:

    ![Быстрое объединение в Excel](./media/sql-database-threat-detection-get-started/8_td_excel_fast_combine.png)

10. Чтобы загрузить записи журнала аудита SQL, убедитесь, что параметры на вкладке настроек установлены правильно, а затем откройте ленту «Данные» и нажмите кнопку «Обновить все».

    ![Параметры Excel](./media/sql-database-threat-detection-get-started/9_td_excel_parameters.png)

11. Результаты появятся на листе **Записи журнала аудита SQL** , что позволит выполнить более детальный анализ обнаруженной подозрительной активности, а также снизить степень влияния событий безопасности в приложении.


## <a name="next-steps"></a>Дальнейшие действия
Выполнив всего несколько простых действий, можно значительно повысить уровень защиты базы данных от пользователей-злоумышленников или несанкционированного доступа. Из этого руководства вы узнаете, как выполнять такие задачи. 

> [!div class="checklist"]
> * Настройка правил брандмауэра для сервера и базы данных.
> * Подключение к базе данных с помощью безопасной строки подключения.
> * Управление доступом пользователей.
> * Защита данных с помощью шифрования
> * Включение аудита базы данных SQL
> * Включение обнаружения угроз базы данных SQL

> [!div class="nextstepaction"]
>[Troubleshoot performance issues and optimize your database](sql-database-performance-tutorial.md) (Устранение проблем с производительностью и оптимизация базы данных)


