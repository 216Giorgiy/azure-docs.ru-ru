<properties 
	pageTitle="Планирование и подготовка к обновлению базы данных SQL Azure до версии 12" 
	description="Описывает подготовительные меры и ограничения, которые следует учитывать при обновлении до версии 12 базы данных SQL Azure." 
	services="sql-database" 
	documentationCenter="" 
	authors="MightyPen" 
	manager="jeffreyg" 
	editor=""/>


<tags 
	ms.service="sql-database" 
	ms.workload="sql-database" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="03/05/2015" 
	ms.author="genemi"/>


# Планирование и подготовка к обновлению базы данных SQL Azure до версии 12


<!--
GeneMi, четверг, 5 марта 2015 года, 20:06
Удалить 'Azure' из заголовка.
-->


В этой статье описано планирование обновления с версии 11 до 12 базы данных SQL Azure, а также необходимые подготовительные действия.


Доступен новый [портал Azure](http://portal.azure.com/), поддерживающий обновление до версии 12.


> [AZURE.NOTE]
> Мы советуем сначала попрактиковаться на тестовых базах данных, копиях баз данных или пустых базах данных. Прежде чем обновлять рабочие базы данных, участвующие в бизнес-процессах, необходимо дождаться завершения периода использования предварительной версии.<br/><br/>
> Вы можете определить, какое состояние - предварительной версии или общей доступности - назначено базе данных семейства версии 12 в том или ином географическом регионе, просмотрев таблицу регионов в статье [Новые возможности версии 12 базы данных SQL](http://azure.microsoft.com/documentation/articles/sql-database-preview-whats-new/#V12AzureSqlDbPreviewGaTable).


В таблице ниже перечислены и описаны другие справочные статьи для версии 12.


| Заголовок и ссылка | Описание содержимого |
| :--- | :--- |
| [Новые возможности версии 12 базы данных SQL](http://azure.microsoft.com/documentation/articles/sql-database-preview-whats-new/) | Подробно описывает, как версия 12 приближает базы данных SQL Azure к полной четности с помощью Microsoft SQL Server 2014. |
| [Пошаговое руководство. Подписка на последнюю версию 12 обновления базы данных SQL (предварительная версия)](http://azure.microsoft.com/documentation/articles/sql-database-preview-sign-up/) | Описывает необходимые действия для обновления ваших баз данных SQL Azure до последней предварительной версии. |
| [Создание базы данных в последней версии 12 обновления базы данных SQL (предварительная версия)](http://azure.microsoft.com/documentation/articles/sql-database-preview-create/) | Описывает создание базы данных SQL Azure, содержащей новые функции последней предварительной версии. Перечислены различные варианты, кроме создания пустой базы данных. |
| [Обновление до последней версии 12 базы данных SQL (предварительная версия)](http://azure.microsoft.com/documentation/articles/sql-database-preview-upgrade/) | Описано обновление баз данных SQL Azure до последней предварительной версии. Подчеркнута необходимость создания резервной копии базы данных, так как обновление выполняется безвозвратно и не может быть отменено. |


## A. Предварительное планирование


В приведенных ниже подразделах перечислены необходимые сведения, а также решения, которые необходимо принять, прежде чем начинать обновление своей базы данных SQL Azure до версии 12.

### A.1 Уточнение версии


В этом документе описывается обновление Базы данных SQL Microsoft Azure с версии 11 до 12. С формальной точки зрения номера версий приближены к таким двум значениям, как указано в инструкции Transact-SQL **SELECT @@version;**:


- 11.0.9228.18 *(версия 11)*
- 12.0.2000.8 *(или немного более поздняя, 12)*


### A.2 Планирование уровня служб


Начиная с этой версии 12, база данных SQL Azure поддерживает только уровни служб Basic, Standard и Premium. Уровни служб Web и Business не поддерживаются в версии 12. Таким образом, если вы планируете обновить свою базу данных SQL Azure с текущим уровнем служб Web или Business, необходимо решить, каким будет ее новый уровень служб.


Подробнее об уровнях служб Basic, Standard и Premium:


- [Обновление баз данных SQL уровня Web или Business до новых уровней служб](http://azure.microsoft.com/documentation/articles/sql-database-upgrade-new-service-tiers/)
- [Ценообразование базы данных SQL Azure](http://azure.microsoft.com/pricing/details/sql-database/)


### A.3 Обзор конфигурации георепликации


Если ваша база данных SQL настроена для георепликации, необходимо задокументировать свою текущую конфигурацию и остановить георепликацию, прежде чем приступать к подготовке обновления. После завершения обновления потребуется перенастроить свою базу данных для георепликации.


При этом важно оставить источник нетронутым и попрактиковаться на копии базы данных.


### A.4 Локальное обновление или копирование базы данных на новый сервер


Вам необходимо выбрать один из двух доступных способов обновления своей базы данных SQL Azure с версии 11 до 12:


- Локальное обновление. После выполнения этого способа обновления ваша база данных версии 11 перестанет существовать. Сервер базы данных SQL будет перемещен в версию 12.
- Копирование базы данных на сервер версии 12. При этом ваша база данных версии 11 остается нетронутой и создается ее обновленная копия на сервере базы данных Azure 12. <br/> Обратите внимание: сведения о DNS, используемые вашим клиентским кодом для доступа к базе данных, больше не будут обеспечивать доступ к версии 11 (для этого их потребуется изменить).


## B. Подготовительные действия


Завершив планирование, можно приступить к выполнению действий, описанных в последующих подразделах, для подготовки завершающего этапа обновления.


Подробное описание завершающего этапа обновления можно найти в справочных статьях, ссылки на которые приведены в начале этой статьи.


### B.1 Действия для уровней служб


Ценовые категории служб уровня Web и Business не поддерживаются в версии 12.


Если уровень служб вашей базы данных SQL Azure 11 - Web или Business, в процессе обновления вам будет предложено активировать для нее поддерживаемый уровень. Вам будет предложен уровень, соответствующий показателям рабочей нагрузки вашей базы данных. Однако вы можете выбрать любой поддерживаемый уровень служб.


Можно уменьшить количество необходимых действий во время обновления, отключив для своей базы данных версии 11 уровень служб Web или Business до начала обновления. Это можно сделать на портале Azure.


Если вы не знаете, какой уровень служб выбрать, мы советует начать с уровня Standard S0.


### B.2 Приостановка георепликации во время обновления


Обновление до версии 12 невозможно, если для базы данных активирована георепликация. Необходимо сначала перенастроить свою базу данных, остановив использование георепликации.


После обновления можно снова активировать георепликацию для своей базы данных.


##<a id="limitations"></a>C. Ограничения во время обновления до версии 12 и после него


В этом разделе описаны ограничения, связанные с обновлением базы данных SQL Azure до версии 12.


### C.1 Портал предварительной версии для версии 12


Только первый из следующих двух порталов управления Azure поддерживает базы данных версии 12:


- [http://portal.azure.com/](http://portal.azure.com/)
 - Этот более новый портал находится в состоянии предварительной версии и еще не перешел на этап общей доступности.<br/><br/>
- [http://manage.windowsazure.com/](http://manage.windowsazure.com/)
 - Этот старый портал не будет обновлен для поддержки версии 12.


Мы рекомендуем клиентам подключаться к своим базам данных SQL Azure с помощью Visual Studio 2013 (VS2013). VS2013 можно использовать для следующих задач.


- Выполнение инструкции T-SQL.
- Проектирование схемы.
- Разработка базы данных, работающей в сети или в автономном режиме.


Вместо этого можно подключиться с помощью [Visual Studio Community 2013](https://www.visualstudio.com/ru-ru/news/vs2013-community-vs.aspx/) - бесплатной и полнофункциональной версии VS2013.


На странице базы данных на старом портале управления Azure можно щелкнуть **Открыть в Visual Studio**, чтобы запустить VS2013 на компьютере для подключения к базе данных SQL Azure.


Кроме того, можно использовать SQL Server Management Studio (SSMS) 2014 с [CU6](http://support.microsoft.com/kb/3031047/) для подключения к базе данных SQL Azure. Дополнительные сведения приведены в этой записи блога:<br/>[Обновление клиентских средств для базы данных SQL Azure](http://azure.microsoft.com/blog/2014/12/22/client-tooling-updates-for-azure-sql-database/).


### C.2 Ограничения *during* обновления до версии 12

В следующей таблице описаны ограничения, действующие в ходе обновления.


| Ограничение | Описание |
| :--- | :--- |
| Продолжительность обновления | Обновление очень больших баз данных, размер которых превышает 50 ГБ, может длиться до 24 часов. |
| Задержка обновления DNS-записи | После завершения обновления потребуется подождать несколько минут, прежде чем DNS-запись будет обновлена в системе для вашей базы данных версии 12, чтобы обеспечить возможность подключения из вашего клиентского приложения. |
| Невозможность создания базы данных | В процессе обновления недоступны следующие операции создания базы данных на конечном сервере базы данных SQL Azure версии 12: <p></p> * Создание базы данных <br/> * Копирование базы данных на сервер <br/> * Восстановление удаленной базы данных <br/> * Восстановление состояния базы данных на определенный момент времени <br/><br/> Однако поддержка восстановления определенного состояния в процессе обновления может поддерживаться до завершения срока действия предварительной версии 12. |
| Отсутствие георепликации | Георепликация не поддерживается на сервере версии 12, если на нем выполняется обновление с версии 11. |
| Правила оповещения | В базу данных версии 12 нельзя добавить правила оповещения. |


### C.3 Ограничения *after* обновления до версии 12

В следующей таблице описаны ограничения, действующие после обновления.


| Ограничение | Описание |
| :--- | :--- |
| DNS для базы данных версии 11 | После завершения обновления путем копирования базы данных версии 11 на новый сервер версии 12 информация о DNS, используемая вашим клиентским кодом для подключения, ссылается на базу данных версии 12. <p> </p> Вашему клиентскому коду потребуется использовать измененные сведения DNS для обращения к базе данных версии 11. |
| Невозможность восстановления версии 11 | Обновление на месте невозможно откатить или отменить. |
| Уровень служб Web или Business | После начала обновления сервер новой базы данных версии 12 уже не сможет распознать или принять уровень служб Web или Business. |
| Скидка в размере 50 % не отображается в карточках ценовых уровней на портале Azure. | В течение периода действия предварительной версии предоставляется 50-процентная скидка* на базы данных, зарегистрированные на обновление предварительной версии последней версии базы данных SQL (12). Даже если скидка не отображается на портале ознакомительной версии в колонке ценовых категорий, она применяется.<br/><br/> Скидка 50 % действует во всех географических регионах до **31 марта 2015 года**, даты истечения срока ее действия для всех регионов. Скидка действует даже в регионах с состоянием общей доступности.<br/><br/> * Использование предварительной версии последней версии базы данных SQL Azure (12) осуществляется в соответствии с условиями предварительной версии, указанными в лицензионном соглашении (например, в соглашении о корпоративном лицензировании, соглашении для Microsoft Azure или соглашении Microsoft Online Subscription), а также любыми применимыми условиями, указанными в статье [Дополнительные условия использования предварительных версий Microsoft Azure](http://azure.microsoft.com/support/legal/preview-supplemental-terms/).  В течение срока действия предварительной версии корпорация Майкрософт (или ее торговый посредник, если это предусмотрено) будет выставлять вам счета, равные половине стоимости общедоступной версии, за все базы данных, входящие в эту предварительную версию. Таким образом, вы получаете 50-процентную скидку на предварительную версию. Корпорация Майкрософт уведомляет об истечении периода действия предварительной версии и скидки на предварительную версию по электронной почте за 30 дней до истечения.) |


### C.4 Экспорт и импорт *after* обновления до версии V12


Вы можете экспортировать или импортировать базу данных версии 12 с помощью [веб-портала Azure](http://portal.azure.com/). Также вы можете выполнять экспорт или импорт с помощью любого из следующих инструментов:


- SQL Server Management Studio (SSMS);
- Visual Studio 2013
- Платформа Data-Tier Application Framework (DacFx)


Тем не менее, чтобы использовать эти инструменты, необходимо сначала установить их последние обновления, чтобы убедиться, что они поддерживают новые возможности версии 12:


- [Накопительный пакет обновления 6 для SQL Server Management Studio 2014](http://support2.microsoft.com/kb/3031047)
- [Обновление для средств SQL Server Database в Visual Studio 2013 (февраль 2015 г.)](https://msdn.microsoft.com/data/hh297027)
- [Платформа Data-Tier Application Framework (DacFx) для Azure SQL Database версии 12 (февраль 2015 г.)](http://www.microsoft.com/download/details.aspx?id=45886)


> [AZURE.NOTE] Ссылки на предыдущие средства были обновлены 2 марта 2015 г. или позднее. Рекомендуется использовать эти обновленные средства.


#### C.4.1 Существуют временные проблемы с импортом BACPAC-файлов


 (на среду, 18 февраля 2015 г.)


Существует известная проблема экспорта BACPAC-файлов с сервера базы данных SQL Azure, обновленного до версии 12. Экспортированные BACPAC-файлы содержат объекты с именем script_deployment_databases, которые создают ошибку. BACPAC-файлы, которые содержат такой объект, нельзя импортировать с помощью инструментов SQL Server Management Studio (SSMS), SqlPackage.exe или API платформы приложений уровня данных (DacFx).


Однако затронутые BACPAC-файлы можно импортировать в базу данных SQL Azure с помощью веб-портала Azure. В пятницу 27 февраля 2015 года ожидается выпуск решения, которое позволит полностью решить проблему, а также обновлений для инструментов, затронутых данной проблемой. До этого времени за дополнительной поддержкой по восстановлению экспортированного файла с расширением BACPAC обращайтесь в службу поддержки Майкрософт.


Помимо проблемы с экспортом, у ограниченного количества серверов и клиентов, недавно выполнивших обновление до версии 12, может возникать другая ошибка при попытке импортировать BACPAC-файл. Эта связанная с разрешениями ошибка временная. Обычно ее можно устранить на затронутом сервере в течение одного дня. Мы ожидаем, что эта проблема будет также окончательно исправлена в течение недели, начиная с 23 февраля 2015 года. До этого времени повторная операция импорта может пройти успешно. За дополнительной поддержкой по импорту BACPAC-файлов в базу данных SQL Azure обращайтесь в службу поддержки Майкрософт.


Если необходимо, сделайте следующее, чтобы обратиться в службу поддержки Майкрософт.


1. Перейдите на портал Azure.
2. Щелкните правой кнопкой мыши имя учетной записи в правом верхнем углу.
3. В отразившемся контекстном меню щелкните элемент поддержки.
 - Этот элемент может называться **Обратитесь в службу поддержки Майкрософт** или **Справка + поддержка**.


> [AZURE.NOTE] (понедельник, 2 марта 2015 г.)
> 
> Проблема, описанная в этом разделе C.4.1, была решена. Для продолжения работы клиентам не нужно ни иметь специальных знаний, ни предпринимать какие-либо действия.
> 
> Автоматический импорт и экспорт работают правильно независимо от того, настолько стар ваш BACPAC-файл.
> 
> Клиентам, обрабатывающим свои BACPAC-файлы с помощью DacFx, следует скачать обновленные средства. Ссылки для загрузки приведены в разделе C.4.


### C.5. Восстановление удаленной базы данных версии 11 до версии 12

В приведенном ниже сценарии описано восстановление удаленной базы данных SQL Azure 11 на сервере базы данных SQL Azure 12.

1. Предположим, у вас есть сервер базы данных SQL Azure 11. <br/> На сервере расположена база данных с уровнем служб Web или Business.
2. Вы удаляете базу данных.
3. Вы обновляете сервер до версии 12.
4. Затем вы восстанавливаете базу данных на сервере. <br/> Таким образом база данных будет обновлена до версии 12 с уровнем служб Standard S0.
5. Вы можете активировать для базы данных другой поддерживаемый уровень служб, если S0 не подходит вам.



## D. Устранение ошибок

Если обновление завершится какой-либо ошибкой, ваша база данных версии 11 останется активной и доступной.


## Связанные ссылки

- [Возможности предварительной версии](http://azure.microsoft.com/services/preview/) Microsoft Azure


<!--Anchors-->
[Подзаголовок 1]: #subheading-1
<!--HONumber=47-->
 