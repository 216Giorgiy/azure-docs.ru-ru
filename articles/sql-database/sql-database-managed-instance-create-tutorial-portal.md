---
title: 'Портал Azure: создание управляемого экземпляра базы данных SQL | Документация Майкрософт'
description: Создание Управляемого экземпляра базы данных SQL Azure в виртуальной сети
keywords: руководство по базе данных sql, создание управляемого экземпляра базы данных sql
services: sql-database
author: bonova
ms.reviewer: carlrab, srbozovi
ms.service: sql-database
ms.custom: managed instance
ms.topic: tutorial
ms.date: 04/10/2018
ms.author: bonova
manager: craigg
ms.openlocfilehash: 1e04b12241121d3894e2d71df423bae4f000a60d
ms.sourcegitcommit: 59914a06e1f337399e4db3c6f3bc15c573079832
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/19/2018
---
# <a name="create-an-azure-sql-database-managed-instance-in-the-azure-portal"></a>Создание управляемого экземпляра базы данных SQL Azure на портале Azure

В этом руководстве описывается, как создать Управляемый экземпляр базы данных SQL Azure (предварительная версия) с помощью портала Azure в выделенной подсети виртуальной сети, а затем подключиться к нему с помощью SQL Server Management Studio на виртуальной машине в той же сети.

> [!div class="checklist"]
> * Добавление подписки в список разрешенных
> * Настройка виртуальной сети
> * Создание таблицы маршрутов и маршрута
> * Применение таблицы маршрутов к подсети Управляемого экземпляра
> * Создание управляемого экземпляра
> * Создание подсети в виртуальной сети для виртуальной машины
> * Создание виртуальной машины в новой подсети в виртуальной сети
> * Подключение к виртуальной машине
> * Установка SSMS и подключение к управляемому экземпляру


Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.

> [!IMPORTANT]
> Список регионов, в которых сейчас доступен Управляемый экземпляр см. в статье[Migrate your databases to a fully managed service with Azure SQL Database Managed Instance](https://azure.microsoft.com/blog/migrate-your-databases-to-a-fully-managed-service-with-azure-sql-database-managed-instance/) (Перенос баз данных в полностью управляемую службу при помощи Управляемого экземпляра Базы данных SQL Azure).
 
## <a name="log-in-to-the-azure-portal"></a>Войдите на портал Azure.

Войдите на [портал Azure](https://portal.azure.com/#create/Microsoft.SQLManagedInstance).

## <a name="whitelist-your-subscription"></a>Добавление подписки в список разрешенных

Управляемый экземпляр выпускается изначально как условная общедоступная предварительная версия. Чтобы ее использовать, необходимо добавить вашу подписку в список разрешенных. Если вы этого еще не сделали, выполните шаги ниже, чтобы принять условия предварительной версии и отправить запрос на включение вашей подписки в список разрешенных.

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. Найдите **Управляемый экземпляр**, а затем выберите **Azure SQL Database Managed Instance (preview)** (Управляемый экземпляр базы данных SQL Azure (предварительная версия)).
3. Нажмите кнопку **Создать**.

   ![создание управляемого экземпляра](./media/sql-database-managed-instance-tutorial/managed-instance-create.png)

3. Выберите подписку, щелкните **Условия предварительной версии**, а затем введите необходимые сведения.

   ![условия предварительной версии управляемого экземпляра](./media/sql-database-managed-instance-tutorial/preview-terms.png)

5. По завершении нажмите кнопку **ОК**.

   ![условия предварительной версии управляемого экземпляра](./media/sql-database-managed-instance-tutorial/preview-approval-pending.png)

   > [!NOTE]
   > В ожидании утверждения предварительной версии можно продолжить работу с этим руководством и выполнить шаги, описанные в разделах ниже.

## <a name="configure-a-virtual-network-vnet"></a>Настройка виртуальной сети

В шагах ниже описывается, как создать виртуальную сеть [Azure Resource Manager](../azure-resource-manager/resource-manager-deployment-model.md) для управляемого экземпляра. Дополнительные сведения о настройке виртуальной сети для управляемого экземпляра базы данных SQL Azure см. в [этой статье](sql-database-managed-instance-vnet-configuration.md).

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. Найдите и выберите **виртуальную сеть**, для режима развертывания выберите **диспетчер ресурсов**, а затем нажмите кнопку **Создать**.

   ![создание виртуальной сети](./media/sql-database-managed-instance-tutorial/virtual-network-create.png)

3. Укажите запрошенные сведения в форме виртуальной сети, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | Описание |
   | ------ | --------------- | ----------- |
   |**Имя**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Пространство адресов**|Любой допустимый диапазон адресов, например 10.14.0.0/24.|Имя адреса виртуальной сети в нотации CIDR.|
   |**Подписка**|Ваша подписка|Дополнительные сведения о подписках см. [здесь](https://account.windowsazure.com/Subscriptions).|
   |**Группа ресурсов**|Любая допустимая группа ресурсов (новая или имеющаяся)|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Местоположение.**|Любое допустимое расположение| Дополнительные сведения о регионах Azure см. [здесь](https://azure.microsoft.com/regions/).|
   |**Имя подсети**|Любое допустимое имя подсети, например mi_subnet|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Диапазон адресов подсети**|Любой допустимый адрес подсети, например 10.14.0.0/28. Используйте адресное пространство подсети меньше адресного пространства виртуальной сети, чтобы позволить создавать в последней другие подсети, например подсеть для размещения тестовых и клиентских приложений или подсети шлюза для подключения из локальных или других виртуальных сетей.|Диапазон адресов подсети в нотации CIDR. Он должен содержаться в адресном пространстве виртуальной сети.|
   |**Конечные точки службы**|Отключено|Включает одну или несколько конечных точек службы для этой подсети.|
   ||||

   ![форма создания виртуальной сети](./media/sql-database-managed-instance-tutorial/virtual-network-create-form.png)

4. Нажмите кнопку **Создать**.

## <a name="create-new-route-table-and-a-route"></a>Создание таблицы маршрутов и маршрута

В шагах ниже показано, как создать интернет-маршрут следующего прыжка 0.0.0.0/0.

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. Найдите и выберите **Таблица маршрутов**, а затем на странице таблицы маршрутов нажмите кнопку **Создать**. 

   ![создание таблицы маршрутов](./media/sql-database-managed-instance-tutorial/route-table-create.png)

3. Укажите запрошенные сведения в форме таблицы маршрутов, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | Описание |
   | ------ | --------------- | ----------- |
   |**Имя**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Подписка**|Ваша подписка|Дополнительные сведения о подписках см. [здесь](https://account.windowsazure.com/Subscriptions).|
   |**Группа ресурсов**|Выберите группу ресурсов, созданную на предыдущем шаге.|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Местоположение.**|Выберите расположение, указанное в процедуре выше.| Дополнительные сведения о регионах Azure см. [здесь](https://azure.microsoft.com/regions/).|
   |**Отключение распространения маршрутов BCP**|Отключено||
   ||||

   ![форма создания таблицы маршрутов](./media/sql-database-managed-instance-tutorial/route-table-create-form.png)

4. Нажмите кнопку **Создать**.
5. После создания таблицы маршрутов откройте ее.

   ![таблица маршрутов](./media/sql-database-managed-instance-tutorial/route-table.png)

6. Щелкните **Маршруты**, а затем нажмите кнопку **Добавить**.

   ![добавление таблицы маршрутов](./media/sql-database-managed-instance-tutorial/route-table-add.png)

7.  Добавьте **интернет-маршрут следующего прыжка 0.0.0.0/0** как **единственный** маршрут, используя сведения в таблице ниже.

    | Параметр| Рекомендуемое значение | ОПИСАНИЕ |
    | ------ | --------------- | ----------- |
    |**Имя маршрута**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
    |**Префикс адреса**|0.0.0.0/0|IP-адрес назначения в нотации CIDR, к которому относится этот маршрут.|
    |**Тип следующего прыжка**|Интернет|Следующий прыжок обрабатывает соответствующие пакеты для этого маршрута.|
    |||

    ![маршрут](./media/sql-database-managed-instance-tutorial/route.png)

8. Последовательно выберите **ОК**.

## <a name="apply-the-route-table-to-the-managed-instance-subnet"></a>Применение таблицы маршрутов к подсети Управляемого экземпляра

Ниже показано, как задать новую таблицу маршрутов для подсети управляемого экземпляра.

1. Для установки таблицы маршрутов в подсети управляемого экземпляра откройте ранее созданную виртуальную сеть.
2. Щелкните **Подсети**, а затем выберите подсеть управляемого экземпляра (**mi_subnet** на следующем снимке экрана).

    ![подсеть](./media/sql-database-managed-instance-tutorial/subnet.png)

11. Щелкните **Таблица маршрутов** и выберите **myMI_route_table**.

    ![настройка таблицы маршрутов](./media/sql-database-managed-instance-tutorial/set-route-table.png)

12. Нажмите кнопку **Сохранить**

    ![настройка и сохранение таблицы маршрутов](./media/sql-database-managed-instance-tutorial/set-route-table-save.png)

## <a name="create-a-managed-instance"></a>Создание управляемого экземпляра

Ниже показано, как создать управляемый экземпляр после утверждения предварительной версии.

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. Найдите **Управляемый экземпляр**, а затем выберите **Azure SQL Database Managed Instance (preview)** (Управляемый экземпляр базы данных SQL Azure (предварительная версия)).
3. Нажмите кнопку **Создать**.

   ![создание управляемого экземпляра](./media/sql-database-managed-instance-tutorial/managed-instance-create.png)

3. Выберите свою подписку и проверьте, чтобы для условий предварительной версии было выбрано значение **Принято**.

   ![значение "Принято" для условий предварительной версии управляемого экземпляра](./media/sql-database-managed-instance-tutorial/preview-accepted.png)

4. Укажите запрошенные сведения в форме управляемого экземпляра, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | ОПИСАНИЕ |
   | ------ | --------------- | ----------- |
   |**Имя управляемого экземпляра**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Имя для входа администратора управляемого экземпляра**|Любое допустимое имя пользователя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).| 
   |**Пароль**|Любой допустимый пароль|Пароль должен включать минимум 16 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md#what-are-the-password-requirements-when-creating-a-vm).|
   |**Группа ресурсов**|Группа ресурсов, созданная ранее||
   |**Местоположение.**|Ранее выбранное расположение|Дополнительные сведения о регионах Azure см. [здесь](https://azure.microsoft.com/regions/).|
   |**Виртуальная сеть**|Созданная ранее виртуальная сеть|

   ![форма создания управляемого экземпляра](./media/sql-database-managed-instance-tutorial/managed-instance-create-form.png)

5. Щелкните поле **Ценовая категория**, чтобы выбрать размер вычислительных ресурсов и ресурсов хранения, а также просмотреть варианты ценовой категории. По умолчанию ваш экземпляр бесплатно получает 32 ГБ свободного места в хранилище, чего может быть недостаточно для приложений.
6. Укажите нужный объем хранилища и количество виртуальных ядер, используя ползунки или текстовые поля. 
   ![форма создания управляемого экземпляра](./media/sql-database-managed-instance-tutorial/managed-instance-pricing-tier.png)

7. По завершении нажмите кнопку **Применить** для сохранения выбранных параметров.  
8. Нажмите кнопку **Создать**, чтобы развернуть управляемый экземпляр.
9. Щелкните значок **уведомлений**, чтобы просмотреть состояние развертывания.
 
   ![ход выполнения развертывания](./media/sql-database-managed-instance-tutorial/deployment-progress.png)

9. Щелкните **Deployment in progress** (Развертывание в процессе выполнения), чтобы открыть окно управляемого экземпляра для дальнейшего мониторинга хода выполнения развертывания.
 
   ![ход выполнения развертывания, часть 2](./media/sql-database-managed-instance-tutorial/managed-instance.png)

В ходе выполнения развертывания приступите к выполнению шага ниже.

> [!IMPORTANT]
> Первый экземпляр в подсети обычно развертывается намного дольше, чем последующие экземпляры. Иногда развертывание первого экземпляра может занять более 24 часов. Не стоит из-за этого отменять развертывание, так как это временное явление. После выпуска общедоступной предварительной версии развертывание будет занимать значительно меньше времени.

## <a name="create-a-new-subnet-in-the-vnet-for-a-virtual-machine"></a>Создание подсети в виртуальной сети для виртуальной машины

Ниже показано, как создать вторую подсеть в виртуальной сети для виртуальной машины, на которой вы установите решение SQL Server Management Studio и с которой подключитесь к управляемому экземпляру.

1. Откройте ресурс виртуальной сети.
 
   ![Виртуальная сеть](./media/sql-database-managed-instance-tutorial/vnet.png)

2. Щелкните **Подсети**, а затем — **Подсеть**.
 
   ![добавление подсети](./media/sql-database-managed-instance-tutorial/add-subnet.png)

3. Укажите запрошенные сведения в форме подсети, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | Описание |
   | ------ | --------------- | ----------- |
   |**Имя**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Диапазон адресов (блок CIDR)**|Любой допустимый диапазон адресов в виртуальной сети (используется по умолчанию).||
   |**группа безопасности сети**.|None||
   |**Таблица маршрутов**|Нет||
   |**Конечные точки службы**|None||

   ![сведения о подсети виртуальной машины](./media/sql-database-managed-instance-tutorial/vm-subnet-details.png)

4. Последовательно выберите **ОК**.

## <a name="create-a-virtual-machine-in-the-new-subnet-in-the-vnet"></a>Создание виртуальной машины в новой подсети в виртуальной сети

Ниже показано, как создать виртуальную машину в той же виртуальной сети, в которой создан управляемый экземпляр. 

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. Выберите **Вычисления**, а затем — **Windows Server 2016 Datacenter** или **Windows 10**. В этом разделе руководства используется Windows Server. Настройка Windows 10 выполняется похожим образом. 

   ![среда выполнения приложений](./media/sql-database-managed-instance-tutorial/compute.png)

3. Укажите запрошенные сведения в форме виртуальной машины, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | Описание |
   | ------ | --------------- | ----------- |
   |**Имя**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   | **Тип диска виртуальной машины**|SSD|Диски SSD обеспечивают оптимальный баланс между ценой и производительностью.|   
   |**Имя пользователя**|Любое допустимое имя пользователя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).| 
   |**Пароль**|Любой допустимый пароль|Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md#what-are-the-password-requirements-when-creating-a-vm).| 
   |**Подписка**|Ваша подписка|Дополнительные сведения о подписках см. [здесь](https://account.windowsazure.com/Subscriptions).|
   |**Группа ресурсов**|Группа ресурсов, созданная ранее||
   |**Местоположение.**|Ранее выбранное расположение||
   |**Уже есть лицензия Windows**|Нет |Если вы владеете лицензиями Windows с активной подпиской Software Assurance (SA), используйте преимущество гибридного использования Azure, чтобы снизить стоимость вычислений.|
   ||||

   ![форма создания виртуальной машины](./media/sql-database-managed-instance-tutorial/virtual-machine-create-form.png)

3. Последовательно выберите **ОК**.
4. Выберите размер виртуальной машины. Чтобы просмотреть дополнительные размеры, выберите **Просмотреть все** или измените фильтр **Supported disk type** (Поддерживаемые типы диска). Для работы с этим руководством требуется только виртуальная машина небольшого размера.

    ![Размеры виртуальной машины](./media/sql-database-managed-instance-tutorial/virtual-machine-size.png)  

5. Нажмите кнопку **Выбрать**.
6. В форме **Параметры** щелкните **Подсеть**, а затем выберите **vm_subnet**. Не выбирайте подсеть, в которой подготовлен управляемый экземпляр, выберите другую подсеть в этой же виртуальной сети.

    ![Параметры виртуальной машины](./media/sql-database-managed-instance-tutorial/virtual-machine-settings.png)  

7. Последовательно выберите **ОК**.
8. На странице сводки просмотрите сведения о предложении и нажмите кнопку **Создать**, чтобы начать развертывание виртуальной машины.
 
## <a name="connect-to-virtual-machine"></a>Подключение к виртуальной машине

В шагах ниже показано, как подключиться к только что созданной виртуальной машине по протоколу удаленного рабочего стола.

1. После завершения развертывания перейдите в ресурс виртуальной машины.

    ![ВМ](./media/sql-database-managed-instance-tutorial/vm.png)  

2. Нажмите кнопку **Подключиться** в свойствах виртуальной машины. Будет создан и скачан файл протокола удаленного рабочего стола (RDP-файл).
3. Чтобы подключиться к виртуальной машине, откройте скачанный RDP-файл. 
4. При появлении запроса нажмите кнопку **Подключиться**. На компьютере Mac вам понадобится клиент RDP, например [Remote Desktop Client](https://itunes.apple.com/us/app/microsoft-remote-desktop/id715768417?mt=12) из Mac App Store.

5. Введите имя пользователя и пароль, указанные при создании виртуальной машины, и нажмите кнопку **ОК**.

6. При входе в систему может появиться предупреждение о сертификате. Чтобы продолжить процесс подключения, нажмите кнопку **Да** или **Продолжить**.

Вы подключились к виртуальной машине на панели мониторинга диспетчера сервера.

> [!IMPORTANT]
> Подождите, пока не завершится подготовка управляемого экземпляра. После подготовки введите имя узла экземпляра в поле **Управляемый экземпляр** на вкладке **Обзор**. Имя будет выглядеть примерно так: **drfadfadsfd.tr23.westus1-a.worker.database.windows.net**.

## <a name="install-ssms-and-connect-to-the-managed-instance"></a>Установка SSMS и подключение к управляемому экземпляру

В шагах ниже описано, как загрузить и установить SSMS, а затем подключиться к управляемому экземпляру.

1. Щелкните **Локальный сервер** в левой части окна диспетчера сервера.

    ![свойства диспетчера сервера](./media/sql-database-managed-instance-tutorial/server-manager-properties.png)  

2. В области **свойств** щелкните **Вкл.**, чтобы изменить конфигурацию усиленной безопасности IE.
3. В диалоговом окне **Конфигурация усиленной безопасности Internet Explorer** щелкните **Выкл.** в разделе администраторов, а затем нажмите кнопку **ОК**.

    ![конфигурация усиленной безопасности Internet Explorer](./media/sql-database-managed-instance-tutorial/internet-explorer-security-configuration.png)  
4. На панели задач откройте **Internet Explorer**.
5. Выберите **Использовать рекомендуемые параметры безопасности, конфиденциальности и совместимости** и нажмите кнопку **ОК**, чтобы завершить установку Internet Explorer 11.
6. Введите в поле URL-адреса https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms и щелкните **Ввод**. 
7. Загрузите последнюю версию SQL Server Management Studio и при появлении запроса щелкните **Запустить**.
8. При появлении запроса щелкните **Установить**.
9. По завершении установки щелкните **Закрыть**.
10. Откройте среду SSMS.
11. В диалоговом окне **подключения к серверу** введите **имя узла* для управляемого экземпляра в поле **Имя сервера**, для типа аутентификации выберите **Проверка подлинности SQL Server**, введите имя пользователя и пароль, а затем нажмите кнопку **Подключиться**.

    ![подключение SSMS](./media/sql-database-managed-instance-tutorial/ssms-connect.png)  

После подключения можно просмотреть системные и пользовательские базы данных на узле "Базы данных" и различные объекты на узлах "Безопасность", "Объекты сервера", "Репликация", "Управление", "Агент SQL Server" и "Профилировщик XEvent".

> [!NOTE]
> Чтобы восстановить существующую базу данных SQL в управляемый экземпляр, можно использовать [Azure Database Migration Service](../dms/tutorial-sql-server-to-managed-instance.md) или [команду T-SQL RESTORE](sql-database-managed-instance-restore-from-backup-tutorial.md) для восстановления из файла резервной копии базы данных либо [импорт из файла BACPAC](sql-database-import.md).

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как создать Управляемый экземпляр базы данных SQL Azure (предварительная версия) с помощью портала Azure в выделенной подсети виртуальной сети, а затем подключиться к нему с помощью SQL Server Management Studio на виртуальной машине в той же сети.  Вы научились выполнять следующие задачи: 

> [!div class="checklist"]
> * Добавление подписки в список разрешенных
> * Настройка виртуальной сети
> * Создание таблицы маршрутов и маршрута
> * Применение таблицы маршрутов к подсети Управляемого экземпляра
> * Создание управляемого экземпляра
> * Создание подсети в виртуальной сети для виртуальной машины
> * Создание виртуальной машины в новой подсети в виртуальной сети
> * Подключение к виртуальной машине
> * Установка SSMS и подключение к управляемому экземпляру

Переходите к следующему руководству, чтобы узнать, как восстановить резервную копию базы данных в Управляемый экземпляр Базы данных SQL Azure

> [!div class="nextstepaction"]
>[Восстановление резервной копии базы данных в Управляемый экземпляр Базы данных SQL Azure](sql-database-managed-instance-restore-from-backup-tutorial.md)
