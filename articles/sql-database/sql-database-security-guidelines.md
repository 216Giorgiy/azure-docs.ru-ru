<properties
   pageTitle="Безопасность в Базе данных SQL Azure: рекомендации и ограничения | Microsoft Azure"
   description="Узнайте о связанных с безопасностью рекомендациях и ограничениях для Базы данных SQL Microsoft Azure."
   services="sql-database"
   documentationCenter=""
   authors="BYHAM"
   manager="jeffreyg"
   editor=""
   tags=""/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management"
   ms.date="08/20/2015"
   ms.author="rickbyh"/>

# Безопасность в Базе данных SQL Azure: рекомендации и ограничения

В этой теме описываются связанные с безопасностью рекомендации и ограничения для Базы данных SQL Microsoft Azure. При управлении безопасностью Баз данных SQL Azure учитывайте представленные далее пункты.

## Брандмауэр

Служба Базы данных SQL Microsoft Azure доступна только на TCP-порте 1433. Для получения доступа к Базе данных Azure со своего компьютера убедитесь, что ваш брандмауэр пропускает исходящие подключения по протоколу TCP через порт 1433. В рамках процесса подключения все подключения от виртуальных машин Azure будут перенаправлены на другой IP-адрес и порт, уникальный для каждой рабочей роли. Номер порта будет находиться в диапазоне от 11 000 до 11 999.

Перед первым подключением к серверу Базы данных SQL Azure настройте брандмауэр Базы данных SQL Azure с помощью [портала Azure](https://portal.azure.com) или [портала управления платформой Azure](https://manage.windowsazure.com/microsoft.onmicrosoft.com#Workspaces/All/dashboard). При этом необходимо создать параметр брандмауэра уровня сервера, который разрешает осуществлять попытки подключения с вашего компьютера или из Azure к серверу Базы данных SQL Azure. Далее, если требуется управлять доступом к определенным базам данных, размещенным на сервере Базы данных SQL Azure, создайте правила брандмауэра уровня базы данных для соответствующих баз данных. Дополнительные сведения см. в статье [Брандмауэр Базы данных SQL Azure](sql-database-firewall-configure.md).

## Шифрование подключения и проверка сертификатов

Весь обмен данными между Базой данных SQL Microsoft Azure и вашим приложением требует постоянного шифрования (SSL). Если в клиентском приложении не проводится проверка сертификатов после создания подключения, то подключение к Базе данных SQL Microsoft Azure становится восприимчивым к атакам «злоумышленник в середине».

Для проверки сертификатов с помощью кода приложения или инструментов явно запрашивайте зашифрованное подключение и не доверяйте сертификатам сервера. Если код приложение или инструменты не запрашивают зашифрованное подключение, они все равно его получат. Но эти программные средства могут не проверять сертификаты сервера, поэтому становятся восприимчивыми к атакам «злоумышленник в середине».

Для проверки сертификатов с помощью кода приложения ADO.NET задайте параметры ``Encrypt=True`` и ``TrustServerCertificate=False`` в строке подключения к базе данных. Дополнительную информацию можно найти в разделе [Пример кода: логика повторов для подключения к Базе данных SQL Azure с использованием ADO.NET](https://msdn.microsoft.com/library/azure/ee336243.aspx).

Среда SQL Server Management Studio также поддерживает проверку сертификатов. В диалоговом окне **Подключение к серверу** нажмите кнопку **Шифровать соединение** на вкладке **Свойства соединения**.

> [AZURE.NOTE]Среда SQL Server Management Studio не поддерживает подключение к Базе данных SQL Microsoft Azure в версиях, предшествующих SQL Server 2008 R2.

Программа SQLCMD поддерживала Базу данных SQL Microsoft Azure, начиная с версии SQL Server 2008, но не обеспечивала проверку сертификатов в версиях, предшествующих SQL Server 2008 R2. Для проверки сертификатов с применением SQLCMD, начиная с версии SQL Server 2008 R2, используйте параметр командной строки ``-N`` и не задавайте параметр ``-C``. С помощью параметра -N программа SQLCMD запрашивает зашифрованное подключение. Если параметр ``-C`` не используется, SQLCMD не будет по умолчанию доверять сертификату сервера и будет вынуждена проверить этот сертификат.

Дополнительные технические сведения можно найти в статье [Безопасность подключения Базы данных SQL Azure](http://social.technet.microsoft.com/wiki/contents/articles/2951.windows-azure-sql-database-connection-security.aspx#comment-4847) на веб-сайте TechNet Wiki.

## Аутентификация

Аутентификация Active Directory (встроенная система безопасности) доступна в качестве предварительной версии в Базе данных SQL 12. Дополнительную информацию см. в статье [Подключение к Базе данных SQL с помощью аутентификации Azure Active Directory](sql-database-aad-authentication.md). Если используется не предварительная версия, пользователи должны предоставлять учетные данные (имя для входа и пароль) при каждом подключении к Базе данных SQL. Дополнительные сведения об аутентификации SQL Server можно найти в статье [Выбор режима проверки подлинности](https://msdn.microsoft.com/library/ms144284.aspx) в электронной документации по SQL Server.

[База данных SQL версии 12](sql-database-v12-whats-new.md) позволяет пользователям проходить аутентификацию в базе данных с помощью пользователей автономной базы данных. Дополнительные сведения можно найти в статьях [Пользователи автономной базы данных — создание переносимой базы данных](https://msdn.microsoft.com/library/ff929188.aspx), [CREATE USER (Transact-SQL)](https://technet.microsoft.com/library/ms173463.aspx) и [Автономные базы данных](https://technet.microsoft.com/library/ff929071.aspx).

> [AZURE.NOTE]Для повышения масштабируемости корпорация Майкрософт рекомендует использовать пользователей автономной базы данных.

Ядро СУБД закрывает подключения, которые оставались неактивными более 30 минут. Перед использованием подключения необходимо выполнить вход повторно.

Для постоянных активных подключений к Базе данных SQL требуется повторная авторизация (выполняется ядром СУБД) по крайней мере каждые 10 часов. Ядро СУБД пытается пройти повторную авторизацию с помощью изначально предоставленного пароля и не требует выполнения никаких действий со стороны пользователя. Для повышения производительности повторная проверка подлинности в подключении не проводится после сброса пароля в Базе данных SQL, даже если это подключение сбрасывается из-за пула подключений. В этом состоит отличие от поведения локального экземпляра SQL Server. Если со времени первой авторизации подключения пароль был изменен, произойдет разрыв подключения, а новое подключение будет установлено с использованием нового пароля. Пользователь с разрешением KILL DATABASE CONNECTION может явно разорвать подключение к Базе данных SQL с помощью команды [KILL](https://msdn.microsoft.com/library/ms173730.aspx).

## Имена входа и пользователи

При управлении учетными записями и пользователями в Базе данных SQL необходимо соблюдать определенные ограничения.

Для имени входа субъекта серверного уровня применяются следующие ограничения:

- Пользователь базы данных master, соответствующий имени входа субъекта серверного уровня, не может быть изменен или уничтожен. 
- Хотя пользователь с именем для входа субъекта серверного уровня не является членом ролей базы данных **dbmanager** и **loginmanager** в базе данных **master**, он обладает всеми разрешениями, предоставляемыми этим двум ролям.

> [AZURE.NOTE]Это имя для входа создается во время подготовки сервера и аналогично имени для входа **sa** в экземпляре SQL Server.

На все имена входа распространяются следующие ограничения:

- Языком по умолчанию является американский диалект английского языка.
- Для доступа к базе данных **master** необходимо сопоставить каждое имя для входа с учетной записью пользователя в базе данных **master**. База данных **master** не поддерживает пользователей автономной базы данных.
- Если в строке подключения не указана база данных, то по умолчанию происходит подключение к базе данных **master**.
- Для выполнения инструкций ``CREATE/ALTER/DROP LOGIN`` и ``CREATE/ALTER/DROP DATABASE`` требуется подключение к базе данных **master** 
- При выполнении инструкций ``CREATE/ALTER/DROP LOGIN`` и ``CREATE/ALTER/DROP DATABASE`` в приложении ADO.NET не разрешается использовать параметризованные команды. Дополнительные сведения можно найти в статье [Команды и параметры](https://msdn.microsoft.com/library/ms254953.aspx).
- При выполнении инструкций ``CREATE/ALTER/DROP DATABASE`` и ``CREATE/ALTER/DROP LOGIN`` каждая из них должна быть единственной инструкцией в пакете Transact-SQL. В противном случае возникает ошибка. Например, следующая инструкция Transact-SQL проверяет существование базы данных. Если она существует, то вызывается инструкция ``DROP DATABASE`` для удаления базы данных. Поскольку инструкция ``DROP DATABASE`` не является единственной инструкцией в пакете, выполнение этого пакета Transact-SQL приводит к ошибке.

```
IF EXISTS (SELECT [name]
           FROM   [sys].[databases]
           WHERE  [name] = N'database_name')
     DROP DATABASE [database_name];
GO
```

- Если применяется инструкция ``CREATE USER`` с параметром ``FOR/FROM LOGIN``, то она должна быть единственной инструкцией в пакете Transact-SQL.
- Если применяется инструкция ``ALTER USER`` с параметром ``WITH LOGIN``, то она должна быть единственной инструкцией в пакете Transact-SQL.
- Только имя для входа субъекта серверного уровня и члены роли базы данных **dbmanager** в базе данных **master** имеют разрешение на выполнение инструкции ``CREATE DATABASE`` и ``DROP DATABASE``.
- Только имя для входа субъекта серверного уровня и члены роли базы данных **loginmanager** в базе данных **master** имеют разрешение на выполнение инструкции ``CREATE LOGIN``, ``ALTER LOGIN`` и ``DROP LOGIN``.
- Для выполнения инструкций ``CREATE/ALTER/DROP`` пользователю требуется разрешение ``ALTER ANY USER`` для базы данных.
- Если владелец роли базы данных пытается добавить или удалить другого пользователя базы данных в роль или из роли базы данных, может произойти следующая ошибка: **В этой базе данных не существует пользователь или роль "Имя".** Эта ошибка возникает, поскольку данный пользователь не является видимым для владельца. Чтобы устранить эту проблему, предоставьте владельцу роли разрешение ``VIEW DEFINITION`` по отношению к данному пользователю. 

Дополнительную информацию об именах входа и пользователях можно найти в статье [Управление базами данных и учетными записями в Базе данных SQL Azure](sql-database-manage-logins.md).

## Рекомендации по обеспечению безопасности

Чтобы сделать приложения Базы данных SQL Azure менее уязвимыми к угрозам безопасности, необходимо учесть следующие требования:

- Всегда используйте последние обновления. При подключении к Базе данных SQL Azure всегда используйте самую последнюю версию средств и библиотек для предотвращения возникновения уязвимостей в системе безопасности. Дополнительные сведения о поддерживаемых средствах и библиотеках можно найти в статье [Общие рекомендации и ограничения в Базе данных SQL Azure](https://msdn.microsoft.com/library/azure/ee336245.aspx).
- Блокировать входящие подключения через порт 1433 протокола TCP. Для обеспечения взаимодействия приложений с Базой данных SQL требуются лишь входящие подключения через порт 1433 протокола TCP. Если входящие подключения не требуются ни для одного прочего приложения на компьютере, убедитесь, что брандмауэр продолжает блокировать входящие подключения через порт 1433 протокола TCP.
- Предотвращение возникновения уязвимостей по принципу внедрения кода. Чтобы обеспечить отсутствие уязвимостей в приложении, обусловленных внедрением кода SQL, по возможности следует использовать параметризованные запросы. Кроме того, следует обязательно подвергать код тщательной проверке и выполнять тестирование на возможность проникновения перед развертыванием приложения.


## См. также

[Брандмауэр Базы данных SQL Azure](sql-database-firewall-configure.md)

[Практическое руководство. Настройка параметров брандмауэра (База данных Azure SQL)](sql-database-configure-firewall-settings.md)

[Общие рекомендации и ограничения для Базы данных SQL Azure](https://msdn.microsoft.com/library/azure/ee336245.aspx)

[Управление базами данных и именами входа в Базе данных SQL Azure](sql-database-manage-logins.md)

<!---HONumber=Sept15_HO4-->