---
title: 'Безопасность в Базе данных SQL Azure: рекомендации и ограничения | Microsoft Docs'
description: Узнайте о связанных с безопасностью рекомендациях и ограничениях для Базы данных SQL Microsoft Azure.
services: sql-database
documentationcenter: ''
author: BYHAM
manager: jhubbard
editor: ''
tags: ''

ms.service: sql-database
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 08/02/2016
ms.author: rickbyh

---
# Безопасность в Базе данных SQL Azure: рекомендации и ограничения
В этой теме описываются связанные с безопасностью рекомендации и ограничения для Базы данных SQL Microsoft Azure. При управлении безопасностью Баз данных SQL Azure учитывайте представленные далее пункты.

## Доступ к виртуальной базе данных master
Как правило, доступ к базе данных master нужен только администраторам. Постоянный доступ к каждой пользовательской базе данных должен обеспечиваться через пользователей автономной базы данных, созданных в каждой базе данных и не являющихся администраторами. В этом случае создавать имена входа в базе данных master не требуется. Дополнительные сведения см. в разделе [Пользователи автономной базы данных – создание переносимой базы данных](https://msdn.microsoft.com/library/ff929188.aspx).

## Брандмауэр
Брандмауэр SQL Server, предназначенный для всего сервера Azure SQL, обычно настраивается на портале и должен принимать только те IP-адреса, которые используются администраторами. Подключитесь к базе данных пользователей, а затем воспользуйтесь инструкцией Transact-SQL [sp\_set\_database\_firewall\_rule](https://msdn.microsoft.com/library/dn270010.aspx), чтобы создать для базы данных правило брандмауэра, которое открывает необходимый диапазон IP-адресов для каждой базы данных.

Служба Базы данных SQL Microsoft Azure доступна только на TCP-порте 1433. Для получения доступа к базе данных Azure со своего компьютера убедитесь, что брандмауэр клиентского компьютера пропускает исходящие подключения по протоколу TCP через порт 1433. Заблокируйте входящие подключения по протоколу TCP через порт 1433, если они не требуются для других приложений.

В рамках процесса подключения все подключения от виртуальных машин Azure будут перенаправлены на другой IP-адрес и порт, уникальный для каждой рабочей роли. Номер порта будет находиться в диапазоне от 11 000 до 11 999. Дополнительные сведения о портах TCP см. в статье [Порты, кроме 1433, для ADO.NET 4.5 и Базы данных SQL версии 12](sql-database-develop-direct-route-ports-adonet-v12.md)

## Аутентификация
По возможности используйте проверку подлинности Active Directory (встроенная безопасность). Дополнительные сведения о настройке проверки подлинности AD см. в статьях [Подключение к Базе данных SQL с помощью аутентификации Azure Active Directory](sql-database-aad-authentication.md) и [Выбор модели проверки подлинности](https://msdn.microsoft.com/library/ms144284.aspx) в электронной документации по SQL Server.

Масштабируемость можно увеличить за счет пользователей автономной базы данных. Дополнительные сведения можно найти в разделах [Пользователи автономной базы данных — создание переносимой базы данных](https://msdn.microsoft.com/library/ff929188.aspx), [CREATE USER (Transact-SQL)](https://technet.microsoft.com/library/ms173463.aspx) и [Автономные базы данных](https://technet.microsoft.com/library/ff929071.aspx).

Ядро СУБД закрывает подключения, которые оставались неактивными более 30 минут. Перед использованием подключения необходимо выполнить вход повторно.

Для постоянных активных подключений к Базе данных SQL требуется повторная авторизация (выполняется ядром СУБД) по крайней мере каждые 10 часов. Ядро СУБД пытается пройти повторную авторизацию с помощью изначально предоставленного пароля и не требует выполнения никаких действий со стороны пользователя. Для повышения производительности повторная проверка подлинности в подключении не проводится после сброса пароля в Базе данных SQL, даже если это подключение сбрасывается из-за пула подключений. В этом состоит отличие от поведения локального экземпляра SQL Server. Если со времени первой авторизации подключения пароль был изменен, произойдет разрыв подключения, а новое подключение будет установлено с использованием нового пароля. Пользователь с разрешением KILL DATABASE CONNECTION может явно разорвать подключение к Базе данных SQL с помощью команды [KILL](https://msdn.microsoft.com/library/ms173730.aspx).

## Имена входа и пользователи
При управлении учетными записями и пользователями в Базе данных SQL необходимо соблюдать определенные ограничения.

* Необходимо подключение к базе данных **master** для выполнения инструкций ``CREATE/ALTER/DROP DATABASE``. Пользователь базы данных master, соответствующий имени входа субъекта серверного уровня, не может быть изменен или уничтожен.
* Языком по умолчанию для имени входа субъекта на уровне сервера является американский диалект английского языка.
* Для доступа к базе данных **master** необходимо сопоставить каждое имя для входа с учетной записью пользователя в базе данных **master**. База данных **master** не поддерживает пользователей автономной базы данных.
* Только имя для входа субъекта серверного уровня и члены роли базы данных **dbmanager** в базе данных **master** имеют разрешение на выполнение инструкции ``CREATE DATABASE`` и ``DROP DATABASE``.
* Необходимо подключение к базе данных master для выполнения инструкций ``CREATE/ALTER/DROP LOGIN``. В то же время использовать имена входа не рекомендуется. Вместо них используйте пользователей автономной базы данных.
* Для подключения к пользовательской базе данных необходимо указать имя базы данных в строке подключения.
* Только имя для входа субъекта серверного уровня и члены роли базы данных **loginmanager** в базе данных **master** имеют разрешение на выполнение инструкции ``CREATE LOGIN``, ``ALTER LOGIN`` и ``DROP LOGIN``.
* При выполнении инструкций ``CREATE/ALTER/DROP LOGIN`` и ``CREATE/ALTER/DROP DATABASE`` в приложении ADO.NET не разрешается использовать параметризованные команды. Дополнительные сведения можно найти в статье [Команды и параметры](https://msdn.microsoft.com/library/ms254953.aspx).
* При выполнении инструкций ``CREATE/ALTER/DROP DATABASE`` и ``CREATE/ALTER/DROP LOGIN`` каждая из них должна быть единственной инструкцией в пакете Transact-SQL. В противном случае возникает ошибка. Например, следующая инструкция Transact-SQL проверяет существование базы данных. Если она существует, то вызывается инструкция ``DROP DATABASE`` для удаления базы данных. Поскольку инструкция ``DROP DATABASE`` не является единственной инструкцией в пакете, выполнение этого пакета Transact-SQL приводит к ошибке.

```
IF EXISTS (SELECT [name]
           FROM   [sys].[databases]
           WHERE  [name] = N'database_name')
     DROP DATABASE [database_name];
GO
```

* Если применяется инструкция ``CREATE USER`` с параметром ``FOR/FROM LOGIN``, то она должна быть единственной инструкцией в пакете Transact-SQL.
* Если применяется инструкция ``ALTER USER`` с параметром ``WITH LOGIN``, то она должна быть единственной инструкцией в пакете Transact-SQL.
* Для выполнения инструкций ``CREATE/ALTER/DROP`` пользователю требуется разрешение ``ALTER ANY USER`` для базы данных.
* Если владелец роли базы данных пытается добавить или удалить другого пользователя базы данных в роль или из роли базы данных, может произойти следующая ошибка: **В этой базе данных не существует пользователь или роль "Имя".** Эта ошибка возникает, поскольку данный пользователь не является видимым для владельца. Чтобы устранить эту проблему, предоставьте владельцу роли разрешение ``VIEW DEFINITION`` по отношению к данному пользователю.

Дополнительную информацию об именах входа и пользователях можно найти в разделе [Управление базами данных и именами входа в Базе данных SQL Azure](sql-database-manage-logins.md).

## См. также
[Брандмауэр базы данных SQL Azure](sql-database-firewall-configure.md)

[Практическое руководство. Настройка параметров брандмауэра (База данных Azure SQL)](sql-database-configure-firewall-settings.md)

[Управление базами данных и именами входа в Базе данных SQL Azure](sql-database-manage-logins.md)

[Центр обеспечения безопасности для ядра СУБД SQL Server и базы данных Azure SQL](https://msdn.microsoft.com/library/bb510589)

<!---HONumber=AcomDC_0803_2016-->