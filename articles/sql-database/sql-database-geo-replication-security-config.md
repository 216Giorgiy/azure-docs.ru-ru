<properties
	pageTitle="Настройки безопасности для стандартной и активной георепликаций"
	description="В этом разделе приведены рекомендации по безопасному управлению сценариями стандартной и активной георепликаций для баз данных SQL."
	services="sql-database"
	documentationCenter="na"
	authors="rothja"
	manager="jeffreyg"
	editor="monicar" />


<tags
	ms.service="sql-database"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="data-management"
	ms.date="10/22/2015"
	ms.author="jroth" />

# Настройки безопасности для стандартной и активной георепликаций

## Обзор
В этом разделе описываются требования к проверке подлинности для настройки и управления [стандартной и активной георепликациями](sql-database-geo-replication-overview.md), а также приведены шаги, необходимые для настройки доступа пользователей к базе данных-получателю. Дополнительные сведения об использовании георепликации см. в статье [Восстановление базы данных SQL Azure после сбоя](sql-database-disaster-recovery.md).

## Использование автономных пользователей
Начиная с версии [V12 базы данных SQL Azure](sql-database-v12-whats-new.md), база данных SQL поддерживает автономных пользователей. В отличие от традиционных пользователей, которые должны сопоставляться с учетными записями в базе данных master, автономными пользователями управляет только база данных. Это имеет два преимущества. При использовании георепликации пользователи могут продолжать подключаться к базе данных-получателю без каких-либо дополнительных настроек, так как пользователями управляет база данных. Кроме этого, с точки зрения входа такая конфигурация потенциально может иметь преимущества масштабируемости и производительности. Дополнительные сведения см. в статье [Пользователи автономной базы данных — создание переносимой базы данных](https://msdn.microsoft.com/library/ff929188.aspx).

Если у вас есть несколько баз данных, которые используют одну и ту же учетную запись, управлять автономными пользователями необходимо в каждой базе данных отдельно (например, для смены пароля), а не на уровне сервера.

>[AZURE.NOTE]Если требуется изменить доступ на чтение базы данных-источника и получателя независимо друг от друга, необходимо использовать традиционные учетные записи и пользователей. Автономными пользователями нельзя управлять в базе данных-получателе независимо от источника.

## Использование традиционных учетных записей и пользователей
Если используются традиционные учетные записи и пользователи (а не автономные), выполните дополнительные шаги, чтобы убедиться, что такие учетные записи существуют на сервере базы данных-получателя. В следующих разделах описаны необходимые действия и приведены дополнительные рекомендации.

### Настройка доступа пользователей к оперативной базе данных-получателю
Чтобы использовать базу данных-получатель только для чтения (оперативную базу данных-получатель) или копию реальной базы данных в случае отказа, база данных-получатель должна иметь соответствующие настройки безопасности.

Только администратор сервера может успешно выполнить все действия, описанные далее в этом разделе. Далее в этом разделе описываются конкретные разрешения для каждого шага.

Подготовить доступ пользователей к оперативной базе данных-получателю с активной георепликацией можно в любое время. Это делается в три указанные ниже этапа.

1. Определение учетных записей с доступом к базе данных-источнику.
2. Поиск ИД безопасности для этих учетных записей на сервере-источнике.
3. Создание учетных записей на целевом сервере с соответствующими ИД безопасности с исходного сервера.

#### 1\. Определение учетных записей с доступом к базе данных-источнику.
Первым шагом процесса является определение того, какие учетные записи следует дублировать на целевом сервере. Это можно сделать с помощью пары инструкций SELECT в логической базе данных master на исходном сервере и в самой базе данных-источнике.

Только администратор сервера или учетные записи с ролью **LoginManager** могут определить учетные записи на исходном сервере с помощью следующей инструкции SELECT.

	SELECT [name], [sid] 
	FROM [sys].[sql_logins] 
	WHERE [type_desc] = 'SQL_Login'

Только учетные записи базы данных с ролью db\_owner, пользователь dbo или администратор сервера могут определять всех субъектов-пользователей базы данных в базе данных-источнике.

	SELECT [name], [sid]
	FROM [sys].[database_principals]
	WHERE [type_desc] = 'SQL_USER'

#### 2\. Поиск ИД безопасности для учетных записей, определенных на шаге 1.
Сравнивая выходные данные запросов из предыдущего раздела с соответствующими ИД безопасности, можно сопоставить учетные записи на сервере с пользователями базы данных. Учетные записи пользователей базы данных с соответствующими ИД безопасности имеют пользовательский доступ к базе данных в качестве субъекта-пользователя.

Следующий запрос можно использовать для просмотра всех субъектов-пользователей и их ИД безопасности в базе данных. Этот запрос могут выполнять только учетные записи базы данных с ролью db\_owner или администратор сервера.

	SELECT [name], [sid]
	FROM [sys].[database_principals]
	WHERE [type_desc] = 'SQL_USER'

>[AZURE.NOTE]Пользователи **INFORMATION\_SCHEMA** и **sys** имеют ИД безопасности *NULL*, а ИД безопасности пользователя **guest** — **0x00**. ИД безопасности **Dbo** может начинаться с *0x01060000000001648000000000048454*, если создателем базы данных является администратор сервера, а не участник **DbManager**.

#### 3\. Создание учетных записей на целевом сервере.
Последним шагом является переход к целевому серверу или серверам и создание учетных записей с соответствующими ИД безопасности. Базовый синтаксис выглядит так.

	CREATE LOGIN [<login name>]
	WITH PASSWORD = <login password>,
	SID = <desired login SID>

>[AZURE.NOTE]Чтобы предоставить пользователю доступ на сервер-получатель (но не на сервер-источник), измените учетную запись пользователя на сервере-источнике с помощью следующего синтаксиса.
>
>ALTER LOGIN <login name> DISABLE
>
>DISABLE не изменяет пароль, поэтому при любой необходимости можно вернуть ENABLE.

## Настройка доступа пользователей после завершения связи непрерывной копии
В случае отказа необходимо завершить связь непрерывной копии между базой данных-источником и получателями. Подробнее об этом процессе см. в статье [Восстановление базы данных SQL Azure после сбоя](sql-database-disaster-recovery.md).

Если используется стандартная георепликация, пользователь не имеет доступа к автономной базе данных-получателю. Поэтому после прекращения связи непрерывной копии необходимо внести изменения в учетные записи пользователей.

Если на целевом сервере ИД безопасности учетных записей не дублируются, после завершения связи доступ к базе данных-получателю будет иметь только администратор сервера. Если пользователем, инициирующим репликацию, является DbManager, он не получит доступ на сервер-получатель, пока ИД безопасности его учетной записи будет дублироваться с исходного сервера. Это применимо также к жизненному циклу процесса репликации.

После завершения репликации в рамках этого процесса субъект-пользователь [dbo] будет изменен для сопоставления с ИД безопасности учетной записи пользователя, инициировавшего репликацию. В результате доступ этого пользователя будет восстановлен. С другими пользователями базы данных так не происходит.

Учетная запись пользователя и соответствующее имя для входа, которое использовалось, чтобы начать операцию завершения, должны присутствовать на целевом сервере и в базе данных. Это необходимо для того, чтобы убедиться, что учетная запись пользователя имеет доступ к базе данных-получателю после выполнения процесса завершения.

Дополнительные сведения о действиях, которые необходимо выполнить после отработки отказа, см. в статье [Финализация восстановленной базы данных SQL Azure](sql-database-recovered-finalize.md).

## Дальнейшие действия
Дополнительные сведения о георепликации и описание дополнительных возможностей базы данных SQL для обеспечения непрерывности бизнес-процессов см. в статье [Обзор непрерывности бизнес-процессов](sql-database-business-continuity.md).

<!---HONumber=Oct15_HO4-->