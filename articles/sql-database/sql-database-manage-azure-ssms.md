<properties 
	pageTitle="Управление Базой данных SQL с помощью SSMS | Microsoft Azure" 
	description="Узнайте, как использовать SQL Server Management Studio для управления серверами и базами данных Базы данных SQL." 
	services="sql-database" 
	documentationCenter=".net" 
	authors="jeffgoll" 
	manager="jeffreyg" 
	editor="tysonn"/>

<tags 
	ms.service="sql-database" 
	ms.workload="data-management" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="03/07/2016" 
	ms.author="jeffreyg"/>


# Управление базой данных SQL Azure с помощью SQL Server Management Studio 


> [AZURE.SELECTOR]
- [Портал Azure](sql-database-manage-portal.md)
- [SSMS](sql-database-manage-azure-ssms.md)
- [PowerShell](sql-database-command-line-tools.md)

SQL Server Management Studio (SSMS) можно использовать для администрирования логических серверов и баз данных Базы данных SQL Azure. В этом разделе описываются типичные задачи с использованием SSMS. Прежде чем начать, необходимо создать логический сервер и базу данных в Базе данных SQL Azure. Подробнее о том, как подключить и выполнить простой запрос SELECT, см. в разделе [Руководство по базам данных SQL: создание базы данных SQL за несколько минут с помощью демонстрационных данных и портала Azure](sql-database-get-started.md) и статье [Подключение к базе данных SQL с помощью SQL Server Management Studio и выполнение пробного запроса T-SQL](sql-database-connect-query-ssms.md).

Мы советуем использовать последнюю версию SSMS при работе с Базой данных SQL Azure. Чтобы получить SSMS, см. статью [Скачивание SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).

## Создание баз данных SQL и управление ими

После подключения к базе данных **master** вы можете создать новые базы данных на сервере и изменить или удалить существующие базы данных. Следующие действия описывают выполнение ряда типовых задач управления базами данных в среде Management Studio. Для выполнения этих задач убедитесь, что вы подключены к базе данных **master** под основной учетной записью на уровне сервера, которую вы создали при настройке сервера.

Для открытия окна запроса в среде Management Studio откройте папку «Базы данных», разверните папку **Системные базы данных**, щелкните правой кнопкой мыши базу данных **master** и нажмите кнопку **Создать запрос**.

-   Для создания новой базы данных используйте инструкцию **CREATE DATABASE**. Для получения дополнительных сведений см. статью [CREATE DATABASE (база данных SQL)](https://msdn.microsoft.com/library/dn268335.aspx). Инструкция, приведенная ниже, позволяет создать новую базу данных с именем **myTestDB** и указывает, что это выпуск базы данных Standard S0 с максимальным размером по умолчанию, равным 250 ГБ.

        CREATE DATABASE myTestDB
        (EDITION='Standard',
         SERVICE_OBJECTIVE='S0');

Нажмите кнопку **Выполнить** для выполнения запроса.

-   Используйте инструкцию **ALTER DATABASE**, чтобы изменить существующую базу данных, если, например, вы хотите изменить имя или выпуск базы данных. Дополнительные сведения см. в разделе [ALTER DATABASE (база данных SQL)](https://msdn.microsoft.com/library/ms174269.aspx). Приведенная ниже инструкция позволяет модифицировать базу данных, которую вы создали на предыдущем шаге, чтобы изменить выпуск на Standard S1.

        ALTER DATABASE myTestDB
        MODIFY
        (SERVICE_OBJECTIVE='S1');

-   Используйте инструкцию **DROP DATABASE**, чтобы удалить существующую базу данных. Дополнительные сведения см. в разделе [DROP DATABASE (база данных SQL)](https://msdn.microsoft.com/library/ms178613.aspx). Приведенная ниже инструкция позволяет удалить базу данных **myTestDB**, но не удаляйте ее сейчас, потому что эта база будет использоваться для создания учетных записей на следующем шаге.

        DROP DATABASE myTestBase;

-   У главной базы данных есть представление **sys.databases**, которое можно использовать для просмотра сведений обо всех базах данных. Чтобы просмотреть все существующие базы данных, выполните следующую инструкцию:

        SELECT * FROM sys.databases;

-   В базе данных SQL инструкция **USE** не поддерживается для переключения между базами данных. Вместо нее необходимо установить подключение непосредственно к целевой базе данных.

>[AZURE.NOTE] Многие инструкции Transact-SQL, позволяющие создавать и изменять базы данных, должны выполняться в своем собственном пакете и не могут быть сгруппированы с другими инструкциями Transact-SQL. Дополнительные сведения см. в описании конкретной инструкции по приведенным ниже ссылкам.

## Создание имен входа и управление ими

База данных **master** отслеживает учетные записи и то, какие из них имеют разрешение на создание баз данных или других учетных записей. Управление учетными записями выполняется посредством подключения к базе данных **master** под основной учетной записью на уровне сервера, которую вы создали, когда настраивали свой сервер. Вы можете использовать инструкции **CREATE LOGIN**, **ALTER LOGIN** или **DROP LOGIN**, чтобы выполнять запросы к базе данных «master», которая будет управлять учетными записями по всему серверу. Дополнительные сведения см. в разделе [Управление базами данных и учетными записями в базе данных SQL](http://msdn.microsoft.com/library/azure/ee336235.aspx)


-   Чтобы создать новую учетную запись на уровне сервера, используйте инструкцию **CREATE LOGIN**. Дополнительные сведения см. в разделе [CREATE LOGIN (база данных SQL)](https://msdn.microsoft.com/library/ms189751.aspx). Приведенная ниже инструкция создает новую учетную запись с именем **login1**. Замените **password1** на пароль по вашему выбору.

        CREATE LOGIN login1 WITH password='password1';

-   Для предоставления разрешений на уровне базы данных используйте инструкцию **CREATE USER**. Все учетные записи должны быть созданы в главной базе данных **master**, но для подключения по учетной записи к другой базе данных необходимо предоставить соответствующие разрешения на уровне базы данных с помощью инструкции **CREATE USER**. Дополнительные сведения см. в разделе [CREATE USER (база данных SQL)](https://msdn.microsoft.com/library/ms173463.aspx).

-   Чтобы разрешить учетной записи "login1" подключение к базе данных **myTestDB**, выполните следующие действия:

 1.  Для обновления показа вновь созданной базы данных обозревателем объектов **myTestDB** щелкните правой кнопкой мыши по имени сервера в обозревателе объектов, а затем выберите пункт **Обновить**.  

     Если подключение закрыто, можно подключиться повторно, выбрав **Подключить обозреватель объектов** в меню "Файл".

 2. Щелкните правой кнопкой мыши по базе данных **myTestDB** и выберите пункт **Создать запрос**.

    3.  Выполните следующую инструкцию в базе данных «myTestDB», чтобы создать пользователя базы данных с именем **login1User**, которое соответствует учетной записи уровня сервера **login1**.

            CREATE USER login1User FROM LOGIN login1;

-   Воспользуйтесь хранимой процедурой **sp\_addrolemember**, чтобы предоставить учетной записи пользователя соответствующий уровень полномочий в базе данных. Для получения более подробной информации см. [sp\_addrolemember (Transact-SQL)](http://msdn.microsoft.com/library/ms187750.aspx). Приведенная ниже инструкция дает **login1User** разрешение только на чтение из базы данных, добавляя **login1User** к роли **db\_datareader**.

        exec sp_addrolemember 'db_datareader', 'login1User';    

-   Используйте инструкцию **ALTER LOGIN**, чтобы изменить существующую учетную запись, если, например, вы хотите изменить пароль для нее. Для получения дополнительных сведений см. [ALTER LOGIN (база данных SQL)](https://msdn.microsoft.com/library/ms189828.aspx). Инструкция **ALTER LOGIN** должна выполняться в базе данных **master**. Переключитесь в окно запроса, подключенного к этой базе данных.

    Приведенная ниже инструкция изменяет учетную запись **login1**, сбрасывая пароль. Замените **newPassword** на пароль по своему выбору, а старый пароль **oldPassword** замените на текущий пароль для учетной записи.

        ALTER LOGIN login1
        WITH PASSWORD = 'newPassword'
        OLD_PASSWORD = 'oldPassword';

-   Воспользуйтесь инструкцией **DROP LOGIN**, чтобы удалить существующую учетную запись. При удалении учетной записи на уровне сервера удаляются и все связанные учетные записи пользователей баз данных. Дополнительные сведения см. в разделе [DROP DATABASE (база данных SQL)](https://msdn.microsoft.com/library/ms178613.aspx). Инструкция **DROP LOGIN** должна выполняться для базы данных **master**. Приведенная ниже инструкция удаляет учетную запись **login1**.

        DROP LOGIN login1;

-   В базе данных «master» предусмотрено представление **sys.sql\_logins**, которое можно использовать для просмотра учетных записей. Чтобы просмотреть все существующие учетные записи, выполните следующую инструкцию:

        SELECT * FROM sys.sql_logins;

## Мониторинг базы данных SQL с помощью динамических представлений управления</h2>

База данных SQL поддерживает несколько динамических представлений управления, которые можно использовать для мониторинга отдельных баз данных. Ниже приведен ряд примеров типов контролируемых данных, которые можно получить с помощью этих представлений. Подробные сведения и дополнительные примеры см. в разделе [Мониторинг базы данных SQL с помощью динамических представлений управления](https://msdn.microsoft.com/library/azure/ff394114.aspx).

-   Запрос динамического представления управления требует наличия разрешений **VIEW DATABASE STATE**. Чтобы предоставить разрешение **VIEW DATABASE STATE** для определенного пользователя базы данных, подключитесь к базе данных, которой вы хотите управлять, под основной учетной записью на уровне сервера и выполните следующую инструкцию в базе данных:

        GRANT VIEW DATABASE STATE TO login1User;

-   Рассчитайте размер базы данных с помощью представления **sys.dm\\_db\\_partition\\_stats**. Представление **sys.dm\\_db\\_partition\\_stats** возвращает информацию о странице и числе строк для каждого раздела в базе данных, позволяя рассчитать размер базы данных. Следующий запрос возвращает размер базы данных в мегабайтах:

        SELECT SUM(reserved_page_count)*8.0/1024
        FROM sys.dm_db_partition_stats;   

-   Используйте представления **sys.dm\\_exec\\_connections** и **sys.dm\\_exec\\_sessions** для получения информации о текущих пользовательских подключениях и внутренних задачах, связанных с базой данных. Следующий запрос возвращает сведения о текущем подключении:

        SELECT
            e.connection_id,
            s.session_id,
            s.login_name,
            s.last_request_end_time,
            s.cpu_time
        FROM
            sys.dm_exec_sessions s
            INNER JOIN sys.dm_exec_connections e
              ON s.session_id = e.session_id;

-   Используйте представление **sys.dm\\_exec\\_query\\_stats** для получения объединенной статистики производительности для кэшированных планов запросов. Следующий запрос возвращает сведения о пяти первых запросах, упорядоченных по среднему времени ЦП.

        SELECT TOP 5 query_stats.query_hash AS "Query Hash",
            SUM(query_stats.total_worker_time), SUM(query_stats.execution_count) AS "Avg CPU Time",
            MIN(query_stats.statement_text) AS "Statement Text"
        FROM
            (SELECT QS.*,
            SUBSTRING(ST.text, (QS.statement_start_offset/2) + 1,
            ((CASE statement_end_offset
                WHEN -1 THEN DATALENGTH(ST.text)
                ELSE QS.statement_end_offset END
                    - QS.statement_start_offset)/2) + 1) AS statement_text
             FROM sys.dm_exec_query_stats AS QS
             CROSS APPLY sys.dm_exec_sql_text(QS.sql_handle) as ST) as query_stats
        GROUP BY query_stats.query_hash
        ORDER BY 2 DESC;
 
 

<!---HONumber=AcomDC_0309_2016-->