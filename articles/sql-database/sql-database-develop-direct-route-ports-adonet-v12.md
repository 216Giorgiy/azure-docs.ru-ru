<properties 
	pageTitle="Порты кроме 1433 для ADO.NET 4.5, ODBC 11 и версии 12 базы данных SQL | Microsoft Azure"
	description="Клиентские подключения к версии 12 базы данных SQL Azure иногда обходят прокси-сервер и взаимодействуют непосредственно с базой данных. Порты, отличные от 1433, становятся важными."
	services="sql-database"
	documentationCenter=""
	authors="MightyPen"
	manager="jeffreyg"
	editor="" />


<tags 
	ms.service="sql-database" 
	ms.workload="data-management" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="08/06/2015" 
	ms.author="genemi"/>


# Порты кроме 1433 для ADO.NET 4.5, ODBC 11 и базы данных SQL версии 12


В этом разделе описываются изменения, которые версия 12 базы данных SQL привносит в поведение подключения клиентов, использующих ADO.NET 4.5 или более поздней версии.


## Версия 11 базы данных SQL: порт 1433


Когда программа клиента использует ADO.NET 4.5 для подключения и запроса к версии 11 базы данных SQL, внутренняя последовательность выглядит следующим образом.


1. ADO.NET пытается подключиться к базе данных SQL.

2. ADO.NET использует порт 1433 для вызова модуля промежуточного слоя, который в свою очередь подключается к базе данных SQL.

3. База данных SQL отправляет свой ответ обратно в промежуточный слой, который перенаправляет ответ в ADO.NET на порт 1433.


**Терминология.** Описывая предыдущую последовательность, мы говорим, что ADO.NET взаимодействует с базой данных SQL с помощью *маршрута прокси*. Если бы промежуточный слой не использовался, мы бы сказали, что использовался *прямой маршрут*.


## Версия 12 базы данных SQL: внешняя и внутренняя программа


В случае подключения к версии 12 мы должны спросить, запускается ли клиентская программа *за пределами* или *внутри* границ облака Azure. В подразделах рассматриваются два типичных сценария.


#### *Внешняя программа.* Клиент работает на настольном компьютере


Порт 1433 — единственный порт, который должен быть открыт на компьютере, где размещено ваше клиентское приложение базы данных SQL.


#### *Внутренняя программа.* Клиент работает в Azure


При запуске внутри границ облака Azure для взаимодействия с сервером Базы данных SQL клиент использует то, что можно назвать *прямым маршрутом*. После установления подключения дальнейшее взаимодействие между клиентом и базой данных не включает промежуточный слой прокси-сервера.


Последовательность выглядит так:


1. ADO.NET 4.5 (или более поздней версии) инициирует краткое взаимодействие с облаком Azure и получает динамически указанный номер порта.
 - Динамически указанный номер порта находится в диапазоне от 11000 до 11999.

2. Затем ADO.NET подключается к серверу базы данных SQL напрямую, с без промежуточного слоя.

3. Запросы отправляются непосредственно в базу данных, а результаты возвращаются клиенту.


Убедитесь, что диапазон портов с 11000 по 11999 на компьютере с клиентом Azure остается доступным для взаимодействия клиента ADO.NET 4.5 с версией 12 базы данных SQL.

- В частности, порты в этом диапазоне должны оставаться свободными от других исходящих ошибок.
- Брандмауэр Windows на виртуальной машине Azure управляет параметрами порта.


## Неявная логика повторных попыток, содержащаяся в маршруте прокси-сервера


В рабочей среде клиентам, подключающимся к версии 11 или 12 базы данных SQL Azure, рекомендуется реализовывать логику повторных попыток в своем коде. Это может быть пользовательский код или код, который использует API, например Enterprise Library.


Маршрут прокси, описанный ранее в этом разделе, относится к вопросу логики повторных попыток:


- В версии 11 модуль промежуточного слоя, который действует как прокси-сервер, также обеспечивает небольшую степень логики повторных попыток для правильной обработки некоторых временных сбоев.

- В версии 12 прокси-сервер не предоставляет логику повторных попыток.


В обоих случаях мы рекомендуем клиентам реализовывать логику повторных попыток в своем коде. Возможно, потребность в реализации логики повторных попыток клиентом возросла с появлением последнего маршрута прокси, который не предоставляет логику повторных попыток.


Примеры кода, демонстрирующие логику повторных попыток, см. в разделе [Простые примеры кода клиентских приложений для работы с Базой данных SQL](sql-database-develop-quick-start-client-code-samples.md).


## Уточнение версии


В этом разделе описываются псевдонимы, относящиеся к версиям продуктов. В нем также перечисляются некоторые пары версий продуктов.


#### ADO.NET


- ADO.NET 4.0 поддерживает протокол TDS 7.3, но не 7.4.
- ADO.NET 4.5 и более поздних версий поддерживает протокол TDS 7.4.


#### Версии 11 и 12 базы данных SQL


В этом разделе перечислены различия между клиентскими подключениями в версиях 11 и 12 базы данных SQL.


*Примечание.* Оператор Transact-SQL `SELECT @@version;` возвращает значение, которое начинается с числа, например "11." или "12.". Эти значения соответствуют именам версий 11 и 12 Базы данных SQL.


## Связанные ссылки


- [Новые возможности Базы данных SQL версии 12](sql-database-v12-whats-new.md)

- Вопросы логики повторных попыток см. в [разделе "В версии 12 шлюз больше не предоставляет логику повторных попыток" статьи "Подключение к Базе данных SQL: ссылки, рекомендации и советы по разработке"](sql-database-connect-central-recommendations.md#gatewaynoretry)

- 20 июля 2015 г. был выпущен ADO.NET 4.6. Объявления в блоге группы разработчиков .NET доступно [здесь](http://blogs.msdn.com/b/dotnet/archive/2015/07/20/announcing-net-framework-4-6.aspx).

- 15 августа 2012 г. был выпущен ADO.NET 4.5. Объявления в блоге группы разработчиков .NET доступно [здесь](http://blogs.msdn.com/b/dotnet/archive/2012/08/15/announcing-the-release-of-net-framework-4-5-rtm-product-and-source-code.aspx).
 - Запись блога о ADO.NET 4.5.1 доступна [здесь](http://blogs.msdn.com/b/dotnet/archive/2013/06/26/announcing-the-net-framework-4-5-1-preview.aspx).

- [Список версий протокола TDS](http://www.freetds.org/userguide/tdshistory.htm)

<!---HONumber=August15_HO7-->