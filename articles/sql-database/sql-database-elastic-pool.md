---
title: "Что такое эластичные пулы? Управление несколькими базами данных SQL с помощью Azure | Документация Майкрософт"
description: "Управление несколькими базами данных SQL (сотнями и тысячами) и их масштабирование с помощью эластичных пулов. Фиксированная цена за ресурсы, которые можно распределить туда, где они нужны."
keywords: "несколько баз данных, ресурсы базы данных, производительность базы данных"
services: sql-database
documentationcenter: 
author: ddove
manager: jhubbard
editor: 
ms.assetid: b46e7fdc-2238-4b3b-a944-8ab36c5bdb8e
ms.service: sql-database
ms.custom: multiple databases
ms.devlang: NA
ms.date: 05/15/2017
ms.author: ddove
ms.workload: data-management
ms.topic: article
ms.tgt_pltfrm: NA
ms.translationtype: Human Translation
ms.sourcegitcommit: 95b8c100246815f72570d898b4a5555e6196a1a0
ms.openlocfilehash: de0c9969ec28e7b6e57bc384ac3ec47191096a9b
ms.contentlocale: ru-ru
ms.lasthandoff: 05/18/2017


---

# <a name="elastic-pools-help-you-manage-and-scale-multiple-sql-databases"></a>Эластичные пулы помогают управлять несколькими базами данных SQL и масштабировать их

Эластичные пулы баз данных SQL — это простое и экономичное решение для администрирования и масштабирования нескольких баз данных с отличными и непредсказуемыми требованиями к ресурсам. Базы данных в составе эластичного пула размещены на одном сервере базы данных SQL Azure и совместно используют определенный набор ресурсов ([единицы транзакций эластичных баз данных](sql-database-what-is-a-dtu.md) (eDTU)) по фиксированной цене. Пулы эластичных БД в базе данных SQL Azure позволяют разработчикам SaaS оптимизировать соотношение цены и производительности для группы баз данных с назначенным бюджетом и при этом обеспечить эластичность производительности для каждой базы данных.   

> [!NOTE]
> Пулы эластичных БД общедоступны во всех регионах Azure, кроме западной Индии, где сейчас доступна только предварительная версия.  Общедоступные пулы эластичных БД появятся в этом регионе в самое ближайшее время.
>

## <a name="overview-of-elastic-pools"></a>Обзор эластичных пулов 

Разработчики SaaS создают приложения на основе уровней данных большого размера, состоящих из нескольких баз данных. Обычно для каждого клиента подготавливается одна база данных. Но нередко разные клиенты по-разному и непредсказуемо используют приложения, в связи с этим трудно спрогнозировать требования к ресурсам каждого отдельного пользователя базы данных. Обычно имеется два варианта: 

- избыточная подготовка ресурсов в соответствии с пиковой нагрузкой и переплата или
- подготовка недостаточного числа ресурсов в целях экономии в ущерб производительности и удовлетворенности клиентов во время всплесков загрузки. 

Эластичные пулы устраняют эту проблему, обеспечивая базы данных необходимыми ресурсами производительности, когда они нужны. Они предоставляют простой механизм распределения ресурсов в рамках прогнозируемого бюджета. Дополнительные сведения о шаблонах разработки для приложений SaaS, использующих пулы эластичных БД, см. в статье [Шаблоны разработки для мультитенантных приложений SaaS с использованием базы данных Azure SQL](sql-database-design-patterns-multi-tenancy-saas-applications.md).

> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Elastic-databases-helps-SaaS-developers-tame-explosive-growth/player]
>

Эластичные пулы позволяют разработчикам покупать [единицы транзакций эластичных баз данных](sql-database-what-is-a-dtu.md) (eDTU) для пула, который совместно используется несколькими базами данных, чтобы обеспечить работу отдельных баз данных в непрогнозируемые периоды использования. Требование к DTU для пула определяется совокупным использованием его баз данных. Число единиц eDTU, доступных для пула, определяется бюджетом разработчика. Разработчик просто добавляет базы данных в пул, задает минимальное и максимальное число eDTU для баз данных и затем задает значение eDTU для пула на основе своего бюджета. С помощью пулов разработчик может легко перевести качество своих услуг с уровня небольшой новой компании на уровень состоявшегося бизнеса с возможностями роста.

Отдельным базам данных в пуле предоставляется возможность гибкого автоматического масштабирования в рамках заданных параметров. В условиях интенсивной нагрузки база данных может использовать дополнительные единицы eDTU для удовлетворения потребности в ресурсах. При небольших нагрузках базы данных используют меньше ресурсов (eDTU), а при отсутствии нагрузок не используют их вовсе. Подготовка ресурсов для всего пула, а не для отдельной базы данных упрощает задачи управления. Кроме того, используя пул, вы можете спрогнозировать расходы. Добавить дополнительные единицы eDTU в существующий пул можно без простоя баз данных. Однако чтобы предоставить дополнительные вычислительные ресурсы для нового резервирования eDTU может понадобиться переместить базы данных. Точно так же, если eDTU больше не нужны, они могут быть удалены из существующего пула в любой момент времени. Вы также можете добавлять базы данных в пул или удалять их из него. Если у базы данных прогнозируемо низкие показатели использования ресурсов, ее можно удалить.

Вы также можете создать эластичный пул Azure и управлять им с помощью с [портала Azure](sql-database-elastic-pool-manage-portal.md), [PowerShell](sql-database-elastic-pool-manage-powershell.md), [Transact-SQL](sql-database-elastic-pool-manage-tsql.md), [языка C#](sql-database-elastic-pool-manage-csharp.md) и REST API. 

## <a name="when-to-consider-a-pool"></a>Когда следует использовать пул
Пулы хорошо подходят для большого числа баз данных с конкретными закономерностями использования. Для заданной базы данных эта закономерность характеризуется низким средним использованием с относительно редкими пиками использования.

Чем больше баз данных можно добавить в пул, тем больше экономия. Но в зависимости от закономерности использования приложения можно сэкономить средства при наличии всего двух баз данных уровня S3.  

Следующие разделы помогут вам понять, как оценить преимущества, связанные с использованием пула с определенным набором баз данных. В примерах используются пулы уровня Стандартный, однако эти же принципы применимы к пулам уровней Базовый и Премиум.

### <a name="assessing-database-utilization-patterns"></a>Оценка закономерностей использования баз данных
На следующем рисунке показан пример базы данных, которая большую часть времени находится в режиме ожидания, но также у нее периодически возникают пики активности. Такая модель использования хорошо подходит для пула:

   ![отдельная база данных, подходящая для пула](./media/sql-database-elastic-pool/one-database.png)

В течение пяти минут пики базы данных DB1 достигают 90 DTU, но общее среднее использование составляет менее 5 DTU. Для запуска этой рабочей нагрузки в одной базе данных требуется уровень производительности S3, но при этом большая часть ресурсов останется неиспользуемой в периоды низкой активности.

Пул позволяет разделить эти незадействованные единицы DTU между несколькими базами данных, тем самым сокращая общее число необходимых единиц DTU и, следовательно, расходы.

На основе предыдущего примера предположим, что существуют дополнительные базы данных с закономерностями использования, схожими с закономерностью использования базы данных DB1. На следующих двух рисунках показано использование четырех и двадцати баз данных на одной диаграмме, чтобы продемонстрировать, что их использование не пересекается во времени:

   ![четыре базы данных с закономерностями использования, подходящими для пула](./media/sql-database-elastic-pool/four-databases.png)

  ![двадцать баз данных с закономерностями использования, подходящими для пула](./media/sql-database-elastic-pool/twenty-databases.png)

Совокупное использование DTU для всех 20 баз данных представлено черной линией на рисунке выше. На рисунке видно, что совокупное использование DTU никогда не превышает 100 DTU, и показано, что 20 баз данных могут совместно использовать 100 eDTU в этом периоде времени. Это приводит к 20-кратному сокращению количества единиц DTU и 13-кратному снижению цены по сравнению с размещением каждой базы данных на уровнях производительности S3 для отдельных баз данных.

Этот пример является идеальным по следующим причинам.

* Существует большая разница между пиковым использованием и средним использованием для каждой базы данных.  
* Пиковое использование для каждой базы данных возникает в разное время.
* eDTU совместно используются многими базами данных.

Цена пула зависит от количества eDTU в пуле. Хотя цена единицы eDTU для пула в 1,5 раза выше цены единицы DTU для отдельной базы данных, **единицы eDTU пула могут совместно использоваться множеством баз данных, следовательно, требуется меньшее общее число единиц eDTU**. Эти различия в цене и совместное использование единиц eDTU является основой возможности экономии, которую может предоставить пул.  

Следующие практические правила в отношении количества баз данных и их использования помогут гарантировать, что стоимость использования пула будет ниже по сравнению со стоимостью уровней производительности для отдельных баз данных.


### <a name="minimum-number-of-databases"></a>Минимальное число баз данных
Если сумма DTU уровней производительности для одной базы данных превышает 1,5 единицы eDTU, необходимых для пула, использовать эластичный пул будет более экономично. Доступные размеры см. в разделе [eDTU и размеры хранилища для эластичных баз данных и пулов эластичных баз данных](sql-database-elastic-pool.md#edtu-and-storage-limits-for-elastic-pools).

***Пример***<br>
Чтобы использование пула было более экономичным, чем использование уровней производительности для отдельных баз данных, требуется не менее двух баз данных уровня S3 или не менее 15 баз данных уровня S0 для пула со 100 единицами eDTU.

### <a name="maximum-number-of-concurrently-peaking-databases"></a>Максимальное число баз данных с одновременными пиками
Из-за совместного использования единиц eDTU не все базы данных в пуле могут одновременно использовать предельные значения единиц eDTU, которые доступны при использовании уровней производительности для отдельных баз данных. Чем меньше баз данных с одновременными пиками, тем меньше значение для единиц eDTU, которое можно задавать, и тем более экономичным становится пул. Как правило, в пуле должно быть не более 2/3 (или 67 %) от всего числа баз данных с одновременным пиком до предельных значений единиц eDTU.

***Пример***<br>
Чтобы сократить затраты для трех баз данных уровня S3 в пуле с 200 единицами eDTU, одновременно испытывать пиковые нагрузки должны не более двух баз данных в пуле. В противном случае, если пиковую нагрузку одновременно испытывают более двух из этих четырех баз данных уровня S3, размер пула необходимо увеличить, так чтобы количество единиц eDTU было больше 200. Если значение размера пула превышает 200 единиц eDTU, необходимо добавить больше баз данных S3, чтобы расходы были ниже, чем на уровни производительности для отдельных баз данных.

Обратите внимание, что в данном примере не учитывается использование других баз данных в пуле. Если все базы данных используются в любой заданной временной точке, тогда одновременно испытывать пиковую нагрузку могут менее 2/3 (или 67 %) от числа баз данных.

### <a name="dtu-utilization-per-database"></a>Использование единиц DTU на одну базу данных
Большая разница между пиковым и средним использованием базы данных указывает на продолжительные периоды низкого уровня использования и короткие периоды высокого уровня использования. Эта закономерность использования идеально подходит для совместного использования ресурсов несколькими базами данных. Следует рассматривать помещение базы данных в пул, если ее загрузка пикового использования в 1,5 раза больше загрузки среднего использования.

***Пример***<br>
База данных уровня S3 с пиковым использованием 100 единиц DTU и средним использованием до 67 единиц DTU хорошо подходит для совместного использования единиц eDTU в пуле. Кроме того, база данных уровня S1 с пиковым использованием 20 единиц DTU и средним использованием 13 единиц DTU или менее хорошо подходит для пула.

## <a name="sizing-an-elastic-pool"></a>Изменение размера пула эластичных БД
Наилучший размер пула зависит от совокупного количества единиц eDTU и ресурсов хранения, необходимых для всех баз данных в пуле. Для этого необходимо определить наибольшую из следующих двух величин:

* Максимальное число единиц DTU, используемых всеми базами данных в пуле.
* Максимальное число байтов памяти, используемых всеми базами данных в пуле.

Доступные размеры см. в разделе [eDTU и размеры хранилища для эластичных баз данных и пулов эластичных баз данных](sql-database-elastic-pool.md#edtu-and-storage-limits-for-elastic-pools).

База данных SQL автоматически оценивает историю использования ресурсов баз данных на существующем сервере баз данных SQL и рекомендует подходящую конфигурацию пула в портале Azure. В дополнение к рекомендациям существуют встроенные возможности по оценке использования единиц eDTU для пользовательских групп баз данных на сервере. Это позволяет выполнить анализ "что если", интерактивно добавляя базы данных в пул и удаляя их, а также получить аналитические данные об использовании ресурсов и изменить размер перед выполнением изменений на практике. Инструкции см. в статье [Мониторинг пула эластичных баз данных и управление им на портале Azure](sql-database-elastic-pool-manage-portal.md).

В случаях, когда невозможно использовать инструменты, вы сможете оценить экономность пула по сравнению с отдельными базами данных, выполнив следующие пошаговые инструкции:

1. Оцените количество единиц eDTU, необходимых для пула, следующим образом:

   MAX(<*общее число баз данных* X *среднее использование DTU на базу данных*>,<br>
   <*количество баз данных с одновременными пиками* X *пиковое использование единиц DTU на базу данных*)
2. Оцените пространство хранилища, необходимое для пула, сложив количество байтов, необходимых для всех баз данных в пуле. Затем определите размер пула eDTU, который предоставляет этот объем хранилища. Ограничения хранилища пула по размеру пула в eDTU см. в разделе [eDTU и размеры хранилища для эластичных баз данных и пулов эластичных баз данных](sql-database-elastic-pool.md#edtu-and-storage-limits-for-elastic-pools).
3. Выберите максимальную из оценок количества единиц eDTU, полученных на шаге 1 и шаге 2.
4. Загляните на [страницу цен для баз данных SQL](https://azure.microsoft.com/pricing/details/sql-database/) и найдите наименьшее количество единиц eDTU для пула, которое будет больше оценки, полученной на шаге 3.
5. Сравните стоимость пула из шага 5 со стоимостью использования подходящих уровней производительности отдельных баз данных.

## <a name="edtu-and-storage-limits-for-elastic-pools"></a>eDTU и размеры хранилища для пулов эластичных БД

В следующих таблицах описываются ограничения ресурсов эластичных пулов.  Обратите внимание, что ограничения ресурсов отдельных баз данных в эластичных пулах обычно такие же, как и у отдельных баз данных за их пределами, и основаны на DTU и уровне служб.  Например, максимальное количество одновременных рабочих экземпляров для базы данных S2 — 120.  Таким образом, максимальное количество одновременных рабочих экземпляров в базе данных в стандартном пуле также составляет 120, если максимальное значение DTU для одной базы данных в пуле равно 50 (что эквивалентно уровню S2).

[!INCLUDE [SQL DB service tiers table for elastic pools](../../includes/sql-database-service-tiers-table-elastic-pools.md)]

Если использованы все DTU пула эластичных БД, то каждая база данных в пуле получает равное количество ресурсов для обработки запросов.  Служба базы данных SQL обеспечивает равное разделение ресурсов между базами данных за счет равных срезов времени вычислений. Если задано минимальное значение DTU на базу данных, отличное от нуля, то такое равное разделение ресурсов в пуле эластичных БД также позволяет гарантировать любое дополнительное количество ресурсов каждой базе данных.

## <a name="database-properties-for-pooled-databases"></a>Свойства базы данных в составе пула

В следующей таблице описаны свойства баз данных в составе пула.

| Свойство | Описание |
|:--- |:--- |
| Максимальное количество eDTU на базу данных |Максимальное количество eDTU, которое может использовать любая база данных в пуле, если оно доступно и не используется другими базами данных в пуле.  Это значение не гарантирует предоставление ресурсов базе данных.  Это глобальный параметр, который применяется ко всем базам данных в пуле. Задайте большое максимальное количество eDTU на базу данных, достаточное для обработки пиков использования базы данных. Значение параметра может быть несколько преувеличенным, так как использование пула предполагает обращение к более и менее активным базам данных в условиях, когда не все базы одновременно обрабатывают пиковое количество запросов. Предположим, например, что пиковая нагрузка одной базы данных равна 20 eDTU и только 20 % из 100 баз данных в пуле одновременно работают с такой нагрузкой.  Если в качестве максимального количества eDTU для каждой базы данных задано значение 20, для пула целесообразно увеличить количество eDTU в 5 раз и задать 400 eDTU на пул. |
| Минимальное количество eDTU на базу данных |Минимальное количество eDTU, которое гарантируется любой базе данных в пуле.  Это глобальный параметр, который применяется ко всем базам данных в пуле. Можно задать минимальное количество eDTU на базу данных, равное 0, что также является значением по умолчанию. Для этого свойства задается значение в диапазоне от 0 до среднего количества eDTU, используемых на одну базу данных. Произведение количества баз данных в пуле и минимального количества eDTU на базу данных не может превышать количество eDTU на пул.  Например, если в пуле 20 баз данных и минимальное количество eDTU на базу данных равно 10, то количество eDTU на пул должно быть не меньше 200. |
| Максимальный размер хранилища данных на базу данных |Максимальный размер хранилища для базы данных в пуле. Базы данных в составе пула совместно используют хранилище пула, поэтому размер хранилища базы данных находится в пределах от наименьшего оставшегося объема хранилища пула до максимального размера хранилища для базы данных. Максимальный объем хранилища базы данных означает максимальный размер файлов данных и не включает пространство, используемое файлами журнала. |
|||

## <a name="elastic-jobs"></a>Задания обработки эластичных БД
Пул упрощает выполнение задач управления, так как позволяет выполнять сценарии в **[заданиях обработки эластичных БД](sql-database-elastic-jobs-overview.md)**. Задания обработки эластичных БД позволяют сократить объем трудоемких операций, связанных с управлением большим количеством баз данных. Сведения о начале работы см. в статье [Начало работы с заданиями обработки эластичных баз данных](sql-database-elastic-jobs-getting-started.md).

Дополнительные сведения о других средствах баз данных для работы с несколькими базами данных см. в статье [Развертывание с помощью Базы данных SQL Azure](sql-database-elastic-scale-introduction.md).

## <a name="business-continuity-features-for-databases-in-a-pool"></a>Возможности обеспечения непрерывности бизнеса для баз данных в пуле
Базы данных в составе пула поддерживают те же [возможности по обеспечению непрерывности бизнес-процессов](sql-database-business-continuity.md), что и отдельные базы данных.

### <a name="point-in-time-restore"></a>Восстановление до точки во времени
При восстановлении до точки во времени используются создаваемые автоматически резервные копии баз данных, чтобы восстановить базу данных в пуле на определенный момент времени. Ознакомьтесь с разделом [Восстановление до точки во времени](sql-database-recovery-using-backups.md#point-in-time-restore)

### <a name="geo-restore"></a>Геовосстановление
Геовосстановление используется по умолчанию, когда база данных недоступна из-за происшествия в регионе, где она размещена. Ознакомьтесь с разделом [Восстановление базы данных SQL Azure или переход на базу данных-получатель при отказе](sql-database-disaster-recovery.md)

### <a name="active-geo-replication"></a>Активная георепликация
Для приложений c более высокими требованиями к восстановлению по сравнению с возможностями геовосстановления настройте [активную георепликацию](sql-database-geo-replication-overview.md).

## <a name="next-steps"></a>Дальнейшие действия

* Вы также можете создать эластичный пул Azure и управлять им с помощью с [портала Azure](sql-database-elastic-pool-manage-portal.md), [PowerShell](sql-database-elastic-pool-manage-powershell.md), [Transact-SQL](sql-database-elastic-pool-manage-tsql.md), [языка C#](sql-database-elastic-pool-manage-csharp.md) и REST API.
* Мы рекомендуем просмотреть [видеокурс о возможностях эластичной базы данных SQL Azure на сайте Microsoft Virtual Academy](https://mva.microsoft.com/training-courses/elastic-database-capabilities-with-azure-sql-db-16554).
* Дополнительные сведения о шаблонах разработки для приложений SaaS, использующих пулы эластичных БД, см. в статье [Шаблоны разработки для мультитенантных приложений SaaS с использованием базы данных Azure SQL](sql-database-design-patterns-multi-tenancy-saas-applications.md).

