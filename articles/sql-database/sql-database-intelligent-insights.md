---
title: "Как Intelligent Insights отслеживает использование базы данных SQL Azure | Документация Майкрософт"
description: "Intelligent Insights позволяет узнать, что происходит с производительностью базы данных."
services: sql-database
documentationcenter: 
author: danimir
manager: drasumic
editor: carlrab
ms.assetid: 
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: NA
ms.date: 09/25/2017
ms.author: v-daljep
ms.translationtype: HT
ms.sourcegitcommit: c3a2462b4ce4e1410a670624bcbcec26fd51b811
ms.openlocfilehash: c3b11dd50fa8c94d3bf80e02a8a319030c375133
ms.contentlocale: ru-ru
ms.lasthandoff: 09/25/2017

---
# <a name="intelligent-insights"></a>Intelligent Insights

***&#8220;Intelligent Insights позволяет узнать, что происходит с производительностью базы данных.&#8221;***

Встроенный аналитический механизм базы данных SQL Azure постоянно отслеживают использование базы данных с помощью искусственного интеллекта и обнаруживают аварийные события, снижающие производительность. После обнаружения выполняется подробный анализ и интеллектуальная оценка проблемы, после чего полученные результаты записываются в журнал диагностики. Эта оценка состоит из анализа первопричин проблемы с производительностью базы данных и возможных рекомендаций по повышению производительности, то есть ***&#8220;ценной аналитики.&#8221;*** 

## <a name="what-can-intelligent-insights-do-for-you"></a>Что Intelligent Insights может сделать для вас?

Intelligent Insights — уникальная функция встроенного аналитического механизма Azure. Ее ценность заключается в следующих возможностях:

- упреждающий мониторинг;
- специализированная аналитика производительности;
- заблаговременное выявление снижения производительности базы данных;
- анализ первопричин (RCA) обнаруженных проблем;
- рекомендации по повышению производительности;
- возможность развертывания сотен тысяч баз данных;
- положительное влияние на ресурсы DevOps и совокупную стоимость владения.

## <a name="how-does-intelligent-insights-work"></a>Как работает Intelligent Insights?

Intelligent Insights анализирует производительность базы данных SQL Azure и сравнивает ее рабочую нагрузку за последний час с базовыми показателями рабочей нагрузки за последние 7 дней. Рабочая нагрузка базы данных состоит из запросов, которые считаются наиболее важными для производительности базы данных. Например, это наиболее повторяющиеся запросы и запросы наибольшего размера. Каждая база данных является уникальным ввиду своей структуры, данных, использования и назначения. Поэтому все создаваемые базовые показатели рабочей нагрузки являются уникальными для каждого отдельного экземпляра. Независимо от базовых показателей рабочей нагрузки Intelligent Insights также отслеживает абсолютные рабочие пороговые значения и обнаруживает проблемы, связанные с повышенным временем ожидания, критическими исключениями и параметризацией запросов, которые могут негативно повлиять на производительность.

После обнаружения проблемы снижения производительности в нескольких наблюдаемых метриках с помощью искусственного интеллекта выполняется анализ. Его результаты записываются в журнал диагностики. Они содержат ценную аналитику по операциям с базой данных. Intelligent Insights позволяет легко отслеживать проблемы с производительностью базы данных с момента их выявления и до устранения. Для этого отслеживаются состояния каждой обнаруженной проблемы на протяжении всего ее жизненного цикла: первое обнаружение, проверка повышения производительности и завершение. Обновление журнала диагностики выполняется каждые 15 минут. 

<center>![Сервер](./media/sql-database-intelligent-insights/intelligent-insights-concept.png)</center>

Для измерения производительности и обнаружения проблем с производительностью базы данных используются метрики длительности запросов, времени ожидания запросов, повышенного времени ожидания и запросов со сбоем. Они подробно рассмотрены в разделе [Метрики обнаружения](sql-database-intelligent-insights.md#detection-metrics) этого документа.

## <a name="degradations-detected"></a>Обнаружение снижения производительности

Выявленные проблемы снижения производительности базы данных SQL Azure записываются в журнал диагностики. Эти аналитические записи состоят из следующих свойств.

| Свойство             | Сведения              |
| :------------------- | ------------------- |
| сведения о базе данных;  | Метаданные базы данных, для которой была обнаружена аналитика. Например, как универсальный код ресурса (URI) ресурса. |
| Наблюдаемый диапазон времени | Время начала и окончания периода обнаруженной аналитики. |
| Затронутые метрики | Метрики, которые привели к созданию аналитики. <ul><li>Увеличение длительности запросов [сек]</li><li>Повышенное время ожидания [сек]</li><li>Запросы, время ожидания которых истекло [процент]</li><li>Запросы, завершившиеся сбоем [процент]</li></ul>|
| Значение последствий | Значение измеренной метрики. |
| Затронутые запросы и коды ошибок | Хэш запроса или код ошибки. Их можно легко сопоставить с затронутыми запросами. Предоставляются метрики увеличения продолжительности запросов, времени ожидания, счетчиков времени ожидания или кодов ошибок. |
| Обнаружения | Проблема обнаруживается в базе данных во время события. Существуют 15 шаблонов обнаружения. Ознакомьтесь с разделом [Устранение проблем с производительностью базы данных SQL Azure с помощью Intelligent Insights](sql-database-intelligent-insights-troubleshoot-performance.md). |
| Анализ первопричин | Анализ первопричин (RCA) обнаруженной проблемы в понятном для понимания формате. Некоторые аналитические данные могут содержать рекомендации по улучшению производительности, если это возможно. |
|||

## <a name="issues-state-lifecycle-active-verifying-and-completed"></a>Жизненный цикл состояний проблемы: "Active" (Активная), "Verifying" (Проверка) и "Completed" (Завершено)

Проблемы с производительностью, записываемые в журнал диагностики, описываются одним из трех состояний: "Active" (Активная), "Verifying" (Проверка) и "Completed" (Завершено). После обнаружения проблемы с производительностью, пока считается, что она не устранена, встроенный аналитический механизм SQL Azure помечает проблему как &#8220;***Active***&#8221; (Активная). После предполагаемого устранения проблемы будет выполнена проверка, и состояние проблемы изменится на &#8220;***Verifying***&#8221; (Проверка). После того, как встроенный аналитический механизм SQL Azure посчитает, что проблема действительно устранена, ее состояние изменится на &#8220;***Completed***&#8221; (Завершено).

## <a name="using-intelligent-insights"></a>Использование Intelligent Insights

Журнал диагностики Intelligent Insights можно отправить в Azure Log Analytics, концентратор событий Azure или службу хранилища Azure, как описывается в разделе [Метрики и журналы диагностики базы данных SQL Azure](sql-database-metrics-diag-logging.md). После отправки журнала в одно из этих решений его можно использовать для разработки настраиваемых оповещений и мониторинга с помощью инструментов корпорации Майкрософт или сторонних производителей. Практическое руководство по устранению проблем с производительностью базы данных SQL Azure с помощью Intelligent Insights приведено в статье [Устранение проблем с производительностью базы данных SQL Azure с помощью Intelligent Insights](sql-database-intelligent-insights-troubleshoot-performance.md).

## <a name="built-in-intelligent-insights-analytics-with-azure-log-analytics"></a>Использование встроенного аналитического механизма Intelligent Insights с Azure Log Analytics 

Решение Azure Log Analytics предоставляет возможности создания отчетов и оповещений на основе данных журнала диагностики Intelligent Insights. Ниже приведен пример отчета Intelligent Insights в службе "Аналитика SQL Azure".

![сервер;](./media/sql-database-intelligent-insights/intelligent-insights-azure-sql-analytics.png)

После настройки журнала диагностики Intelligent Insights для потоковой передачи данных в службу "Аналитика SQL Azure" можно [отслеживать базу данных SQL Azure с помощью службы "Аналитика SQL Azure"](../log-analytics/log-analytics-azure-sql.md).

## <a name="custom-integrations-of-intelligent-insights-log"></a>Настраиваемая интеграция журнала Intelligent Insights

Разработка настраиваемых оповещений и мониторинга с помощью инструментов корпорации Майкрософт и сторонних производителей описывается в разделе [Использование журнала диагностики производительности Intelligent Insights для базы данных SQL Azure](sql-database-intelligent-insights-use-diagnostics-log.md).

## <a name="how-to-set-up-intelligent-insights-with-azure-event-hub"></a>Как настроить Intelligent Insights для концентратора событий Azure

- Настройка Intelligent Insights для потоковой передачи событий журнала в концентратор событий Azure описывается в разделе [Потоковая передача журналов диагностики Azure в пространство имен концентраторов событий](../monitoring-and-diagnostics/monitoring-stream-diagnostic-logs-to-event-hubs.md).
- Использование концентратора событий Azure для настраиваемого мониторинга и оповещений описывается в разделе [Метрики и журналы диагностики базы данных SQL Azure](sql-database-metrics-diag-logging.md#stream-into-azure-storage). 

## <a name="how-to-set-up-intelligent-insights-with-azure-storage"></a>Как настроить Intelligent Insights для службы хранилища Azure

- Настройка сохранения данных Intelligent Insights в службе хранилища Azure описывается в разделе [Потоковая передача в службу хранилища Azure](sql-database-metrics-diag-logging.md#stream-into-azure-storage).

## <a name="detection-metrics"></a>Метрики обнаружения

Метрики, используемые в моделях обнаружения, создаваемых Intelligent Insights, отслеживают:

- длительность запросов;
- запросы, время ожидания которых истекло;
- повышенное время ожидания; 
- запросы, завершившиеся сбоем.

Метрики длительности запросов и времени ожидания запросов используются в качестве основных моделей для обнаружения проблем, связанных с производительностью рабочей нагрузки базы данных. Причина этого состоит в том, что они непосредственно измеряют рабочую нагрузку. Для обнаружения всех возможных вариантов снижения производительности рабочей нагрузки в качестве дополнительных моделей используются метрики повышенного времени ожидания и запросов, завершенных сбоем. Это позволяет выявлять проблемы, влияющие на производительность рабочей нагрузки.

Система автоматически учитывает изменения рабочей нагрузки и числа запросов к базе данных, чтобы динамически определять нормальные и ненормальные пороговые значения производительности базы данных.

Все метрики учитываются вместе в различных сочетаниях благодаря научной модели данных, позволяющей классифицировать каждую обнаруженную проблему с производительностью. Информация, предоставленные благодаря интеллектуальной аналитике, содержит сведения об обнаруженных проблемах производительности, результаты анализа первопричин проблем и рекомендации по повышению производительности отслеживаемой базы данных SQL Azure, если это возможно.

## <a name="query-duration"></a>Длительность запросов

Модель снижения производительности из-за повышения длительности запросов анализирует отдельные запросы и выявляет увеличение времени, необходимого для компиляции и выполнения запроса, по сравнению с базовыми показателями производительности.

Когда встроенный аналитический механизм базы данных SQL Azure обнаруживает существенное увеличение времени, затрачиваемого на компиляцию или выполнения запросов, которое негативно влияет на производительность рабочей нагрузки, такие запросы помечаются как снижающие производительность из-за увеличения длительности. 

Журнал диагностики Intelligent Insights содержит хэш запроса, снижающего производительность, который указывает, связано ли это снижение с увеличением времени компиляции или выполнения запроса. Он также содержит увеличенную длительность запроса.

## <a name="timeout-requests"></a>Запросы, время ожидания которых истекло

Модель снижения производительности из-за истечения времени ожидания запросов анализирует отдельные запросы и выявляет увеличение числа случаев истечения времени ожидания на уровне выполнения запроса, а также общее число случаев истечения времени ожидания запросов на уровне базы данных по сравнению с периодом базовых показателей производительности.

Так как время ожидания некоторых запросов может истечь еще до этапа выполнения, встроенный аналитический механизм базы данных SQL Azure также измеряет и анализирует (сравнивая прерванные рабочие роли и отправленные запросы) все запросы, которые достигли базы данных, вне зависимости от того, достигли ли они также этапа выполнения или нет. 

Как только число выполненных запросов, время ожидания которых истекло, или число прерванных рабочих ролей запросов превысит системное пороговое значение, журнал диагностики заполнится ценной аналитикой.

Создаваемая аналитика содержит число запросов, время ожидания которых истекло, а также сведения о том, было ли снижение производительности связано с увеличением числа запросов, время ожидания которых истекло на этапе выполнения, или с увеличением числа запросов, время ожидания которых истекло на общем уровне базы данных. Если увеличение числа запросов, время ожидания которых истекло, является существенным для производительности базы данных, то эти запросы помечаются как снижающие производительность из-за истечения времени ожидания. 

## <a name="excessive-wait-times"></a>Повышенное время ожидания

Модель повышенного времени ожидания отслеживает отдельные запросы к базе данных и выявляет необычно высокие значения статистики по времени ожидания запросов, превышающие абсолютные пороговые значения, управляемые системой. Ниже приведены метрики запросов с повышенным временем ожидания, отслеживаемые с помощью нового компонента SQL Server, Query Store Wait Stats, отображающего статистику времени ожидания из хранилища запросов (sys.query_store_wait_stats):

- достижение лимитов ресурсов;
- достижение лимитов ресурсов эластичного пула;
- чрезмерное количество рабочих потоков или потоков сеансов;
- чрезмерная блокировка базы данных;
- нехватка памяти;
- прочая статистика времени ожидания.

Достижение лимитов ресурсов или лимитов ресурсов эластичного пула означает, что потребление ресурсов, доступных для подписки, или ресурсов в эластичном пуле превысило абсолютные пороговые значения, что является признаком снижения производительности рабочей нагрузки. Чрезмерное количество рабочих потоков или потоков сеанса означает, что число запущенных рабочих потоков или потоков сеансов достигло абсолютного порогового значения, указывающее, что является признаком снижения производительности рабочей нагрузки.

Чрезмерная блокировка базы данных означает, что число блокировок базы данных превысило абсолютное пороговое значение, что также является признаком снижения производительности рабочей нагрузки. Нехватка памяти — это состояние, в котором количество потоков, запрашивающих временно предоставляемый буфер памяти, превысило абсолютное пороговое значение, что является признаком снижения производительности рабочей нагрузки.

Прочая статистика времени ожидания указывает, что различные метрики, измеряемые с помощью компонента Query Store Wait Stats, превысили абсолютное пороговое значение, что является признаком снижения производительности рабочей нагрузки.

После обнаружения повышенного времени ожидания, в зависимости от доступных данных, в журнал диагностики Intelligent Insights записываются хэши запросов, снижающих производительность, и запросов, производительность которых понизилась. В него также добавляются сведения о метриках, выявивших запросы с повышенным временем ожидания выполнения и измеривших это время.

## <a name="errored-requests"></a>Запросы с ошибками

Модель снижения производительности из-за запросов с ошибками отслеживает отдельные запросы и выявляет увеличение количества запросов с ошибками по сравнению с периодом базовых показателей. Эта модель также отслеживает критические исключения, которые достигли абсолютных пороговых значений, которыми управляет встроенный аналитический механизм базы данных Azure. Система автоматически учитывает количество запросов к базе данных и изменения рабочей нагрузки за отслеживаемых период.

Когда измеряемое увеличение запросов с ошибками относительно общего количества выполняемых запросов становится значительным и влияет на производительность рабочей нагрузки, затронутые запросы помечаются как снижающие производительность из-за запросов с ошибками.

Журнал Intelligent Insights содержит количество запросов с ошибками и сведения о том, было ли связано снижение производительности с увеличением количества запросов с ошибками или достижением одного из пороговых значений критического исключения, а также он содержит измеренное время снижения производительности. 

В случае, если какое-либо из отслеживаемых критических исключений превышает абсолютное пороговое значение, управляемое системой, создается ценная аналитика, содержащая сведения о критическом исключении.

## <a name="next-steps"></a>Дальнейшие действия
* Изучите [устранение проблем с производительностью базы данных SQL Azure с помощью Intelligent Insights](sql-database-intelligent-insights-troubleshoot-performance.md).
* Используйте [журнал диагностики производительности Intelligent Insights для базы данных SQL Azure](sql-database-intelligent-insights-use-diagnostics-log.md).
* Ознакомьтесь с [мониторингом базы данных SQL Azure с помощью службы "Аналитика SQL Azure"](../log-analytics/log-analytics-azure-sql.md).
* Изучите [сбор и использование данных журнала из ресурсов Azure](../monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs.md).



