---
title: Подключение приложений к Управляемому экземпляру Базы данных SQL Azure | Документация Майкрософт
description: В этой статье описывается, как подключить приложение к Управляемому экземпляру Базы данных SQL.
ms.service: sql-database
author: srdan-bozovic-msft
manager: craigg
ms.custom: managed instance
ms.topic: conceptual
ms.date: 05/21/2018
ms.author: srbozovi
ms.reviewer: bonova, carlrab
ms.openlocfilehash: 82e8836892b033ccbb3c3ad9806257348afe3702
ms.sourcegitcommit: 58c5cd866ade5aac4354ea1fe8705cee2b50ba9f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/24/2018
ms.locfileid: "42818408"
---
# <a name="connect-your-application-to-azure-sql-database-managed-instance"></a>Подключение приложения к Управляемому экземпляру Базы данных SQL

Сейчас вам доступно много вариантов для размещения приложений. 
 
Например, вы можете разместить приложение в облаке, используя Службу приложений Azure или любую службу виртуальных сетей Azure, например среду службы приложений Azure, виртуальные машины или масштабируемый набор виртуальных машин. Также можно применить гибридную схему работы с облаком, оставляя приложения в локальной среде. 
 
Независимо от выбранной схемы, вы можете подключить приложение к Управляемому экземпляру (предварительная версия).  

![Высокая доступность](./media/sql-database-managed-instance/application-deployment-topologies.png)  

## <a name="connect-an-application-inside-the-same-vnet"></a>Подключение приложений внутри одной виртуальной сети 

Это самый простой сценарий. Виртуальные машины внутри виртуальной сети могут свободно подключаться друг к другу напрямую, даже если находятся в разных подсетях. Это означает, что для подключения приложений, размещенных в среде приложений Azure или на виртуальной машине, достаточно лишь настроить строку подключения.  
 
Если в этой ситуации возникнут проблемы с подключением, проверьте, настроена ли группа безопасности сети для подсети вашего приложения. В этом сценарии необходимо открыть исходящее подключение на порт SQL 1433, а также для диапазона портов 11 000–12 000, используемых для перенаправления. 

## <a name="connect-an-application-inside-a-different-vnet"></a>Подключение приложений из другой виртуальной сети 

Этот сценарий немного сложнее, поскольку Управляемый экземпляр получает частный IP-адрес, принадлежащий его виртуальной сети. Поэтому приложению для подключения нужно получить доступ к виртуальной сети, в которой развернут Управляемый экземпляр. Сначала необходимо создать подключение между приложением и виртуальной сетью Управляемого экземпляра. Для этого сценария не обязательно размещать виртуальные сети в одной подписке. 
 
Существует два варианта подключения виртуальных сетей. 
- [Пиринговая связь между виртуальными сетями Azure](../virtual-network/virtual-network-peering-overview.md). 
- VPN-шлюз между виртуальными сетями ([портал Azure](../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md), [PowerShell](../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md), [Azure CLI](../vpn-gateway/vpn-gateway-howto-vnet-vnet-cli.md)). 
 
Лучше использовать пиринговую связь, поскольку она использует магистральную сеть корпорации Майкрософт и не добавляет существенных задержек по сравнению с подключением виртуальных машин в одной виртуальной сети. Пиринг виртуальной сети ограничен сетями в том же регионе.  
 
> [!IMPORTANT]
> Сценарий пиринга виртуальной сети для службы "Управляемый экземпляр" ограничен сетями в том же регионе из-за [ограничений пиринга глобальной виртуальной сети](../virtual-network/virtual-network-manage-peering.md#requirements-and-constraints). 

## <a name="connect-an-on-premises-application"></a>Подключение локального приложения 

Доступ к управляемому экземпляру возможен только по частному IP-адресу. Чтобы обратиться к нему из локальной среды, необходимо установить подключение типа "сеть — сеть" между приложением и виртуальной сетью управляемого экземпляра. 
 
Есть два способа подключить локальную сеть к виртуальной сети Azure. 
- VPN-подключение типа "сеть — сеть" ([Портал Azure](../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md), [PowerShell](../vpn-gateway/vpn-gateway-create-site-to-site-rm-powershell.md), [Azure CLI](../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-cli.md)). 
- Подключение [ExpressRoute](../expressroute/expressroute-introduction.md).  
 
Если подключение к Azure из локальной среды установлено успешно, но вам не удается подключиться к Управляемому экземпляру, проверьте правила брандмауэра: исходящее подключение на порт SQL 1433, а также к диапазону портов 11 000–12 000 для перенаправления. 

## <a name="connect-an-azure-app-service-hosted-application"></a>Подключение приложения, размещенного в службе приложений Azure 

Доступ к Управляемому экземпляру возможен только по частному IP-адресу, а значит для доступа к нему из локальной среды необходимо установить подключение типа "сеть — сеть" между приложением и виртуальной сетью управляемого экземпляра. См. статью [Интеграция приложения с виртуальной сетью Azure](../app-service/web-sites-integrate-with-vnet.md).  
 
Сведения об устранении неполадок вы найдете [здесь](../app-service/web-sites-integrate-with-vnet.md#troubleshooting). Если соединение не удается установить, изучите статью о [синхронизации сетевой конфигурации](sql-database-managed-instance-sync-network-configuration.md). 
 
В сценарии подключения службы приложений Azure к Управляемому экземпляру следует отдельно рассмотреть интеграцию службы приложений Azure с сетью, имеющую пиринговую связь с виртуальной сетью Управляемого экземпляра. В этом случае следует дополнительно настроить следующее. 

- Виртуальная сеть Управляемого экземпляра НЕ ДОЛЖНА иметь шлюз.  
- Для виртуальной сети Управляемого экземпляра нужно настроить удаленные шлюзы. 
- Пиринговые виртуальные сети должны разрешать транзит шлюзов. 
 
Этот вариант сценария показан на схеме ниже.

![Пиринговая связь с интеграцией приложения](./media/sql-database-managed-instance/integrated-app-peering.png)
 
## <a name="connect-an-application-on-the-developers-box"></a>Подключение приложения через окно разработчика 

Доступ к Управляемому экземпляру возможен только по частному IP-адресу, а значит для доступа к нему из окна разработчика необходимо установить подключение между окном разработчика и виртуальной сетью Управляемого экземпляра.  
 
Настройка подключения типа "точка — сеть" к виртуальной сети с аутентификацией по собственным сертификатам Azure подробно описана в статьях для каждого средства: [портал Azure](../vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal.md), [PowerShell](../vpn-gateway/vpn-gateway-howto-point-to-site-rm-ps.md), [Azure CLI](../vpn-gateway/vpn-gateway-howto-point-to-site-classic-azure-portal.md). 

## <a name="required-versions-of-drivers-and-tools"></a>Необходимые версии драйверов и средств

Ниже приведены рекомендуемые минимальные версии средств и драйверов, необходимые, чтобы подключиться к Управляемому экземпляру.

| Драйвер или средство | Version (версия) |
| --- | --- |
|.NET Framework | 4.6.1 (или .NET Core) | 
|Драйвер ODBC    | версия 17 |
|Драйвер PHP | 5.2.0 |
|Драйвер JDBC    | 6.4.0 |
|Драйвер Node.js | 2.1.1 |
|Драйвер OLEDB   | 18.0.2.0 |
|SSMS   | 17.8.1 или [более поздней версии](https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017) |

## <a name="next-steps"></a>Дополнительная информация

- Сведения об Управляемом экземпляре см. в [обзоре Управляемого экземпляра](sql-database-managed-instance.md).
- См. инструкцию по [созданию Управляемого экземпляра](sql-database-managed-instance-get-started.md).
