<properties
	pageTitle="Пределы ресурсов Базы данных SQL Azure"
	description="На этой странице описываются некоторые общие ограничения ресурсов для Базы данных SQL Azure."
	services="sql-database"
	documentationCenter="na"
	authors="rothja"
	manager="jeffreyg"
	editor="monicar" />


<tags
	ms.service="sql-database"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="data-management"
	ms.date="08/10/2015"
	ms.author="jroth" />


# Пределы ресурсов Базы данных SQL Azure


База данных SQL Azure отслеживает использование общих ресурсов, таких как журнал транзакций, ввод-вывод и многие другие. Это позволяет Базе данных SQL Azure держать базы данных в пределах установленных границ ресурсов. Эта граница или порог называется пределом ресурсов. Если при использовании ресурсов клиенты превышают эти пределы на уровне клиента или физического узла, База данных SQL Azure реагирует путем регулирования использования ресурсов, что ведет к потере подключения или отклонению запросов.

> [AZURE.NOTE]Если пределы ресурсов не позволяют запросам анализировать проблемы производительности базы данных, возможно, вам придется использовать выделенное административное подключение (DAC), доступное в Azure SQL Database версии 12 и более поздних версий. Подробнее об использовании выделенного административного подключения можно узнать в разделе [Диагностическое подключение для администраторов баз данных](https://msdn.microsoft.com/library/ms189595.aspx).

## Сводная таблица пределов ресурсов

В следующей таблице представлена сводка пределов для каждого ресурса, при превышении которых База данных SQL Azure отклоняет запросы или прерывает подключения к соответствующему ресурсу, а также возвращает код ошибки. В некоторых случаях точный предел определяют [уровень службы (Basic, Standard, Premium)](sql-database-service-tiers.md) и уровень производительности. В таких случаях обращайтесь к разделу [Уровни служб и уровни производительности в Базе данных SQL Azure](https://msdn.microsoft.com/library/azure/dn741336.aspx).

[AZURE.INCLUDE [azure-sql-database-limits](../../includes/azure-sql-database-limits.md)]

## Общие сведения о кодах ошибок

Иногда один и тот же код ошибки возвращается по нескольким ограничительным условиям для ресурса. В сообщении об ошибке эти условия определяются как состояния. Например, следующие два сообщения об ошибке отображаются для ресурса "Длина журнала транзакций". Хотя текст сообщений совпадает, значения параметра "State" в них различаются (1 и 2 соответственно) в соответствии с разными ограничительными условиями.

Сообщение об ошибке 1:

	Msg 40552, Level 17, State 1, Line 1
	The session has been terminated because of excessive transaction log space usage.
	Try modifying fewer rows in a single transaction.

Сообщение об ошибке 2:

	Msg 40552, Level 17, State 2, Line 1
	The session has been terminated because of excessive transaction log space usage.
	Try modifying fewer rows in a single transaction.

То же самое действительно для идентификаторов ресурсов, появляющихся в некоторых сообщениях. Идентификатор ресурса относится к ресурсу системы, предел использования которого был превышен.

В оставшейся части этого раздела более подробно описываются возможные коды ошибок, включая случаи, когда значение "State" и идентификатор ресурса предоставляют дополнительные сведения об ошибке.

## Размер базы данных

| &nbsp; | Дополнительные сведения |
| :--- | :--- |
| **Условие** | При заполнении места, назначенного пользовательской базе данных, пользователь получает ошибку заполнения базы данных. |
| **Код ошибки** | **40544**. База данных достигла предельного размера. Секционируйте или удалите данные, удалите индексы или попробуйте найти возможное решение в документации. |
| **Ограничение** | Зависит от [уровня службы и уровня производительности](https://msdn.microsoft.com/library/azure/dn741336.aspx). |
| **Тип отклоненных запросов** | Все инструкции DML, кроме Select (Insert, Update, Merge, выполняющие вставку или обновление). |
| **Рекомендации** | Используйте инструкции DELETE/DROP для удаления данных из базы данных, пока ее размер не станет ниже предела. |

## Входы

| &nbsp; | Дополнительные сведения |
| :--- | :--- |
| **Условие** | База данных SQL регулирует максимально возможное количество одновременных входов в базу данных. При достижении предела одновременных входов в базу данных, новые запросы на вход в базу данных отклоняются и возвращается код ошибки 10928. |
| **Код ошибки** | **10928**. Идентификатор ресурса: 3. Предел %s для базы данных составляет %d, и он достигнут. Дополнительные сведения см. в разделе http://go.microsoft.com/fwlink/?LinkId=267637. |
| **Ограничение** | Зависит от [уровня службы и уровня производительности](https://msdn.microsoft.com/library/azure/dn741336.aspx). |
| **Рекомендации** | Обратитесь к представлению dm\_exec\_connections, чтобы просмотреть активные подключения пользователей.<br><br>Подождите 10 секунд и повторите попытку входа. |

> [AZURE.NOTE]Значение идентификатора ресурса в сообщении об ошибке указывает на ресурс, предел которого был достигнут. Для входов идентификатор ресурса = 3.

## Использование памяти

| &nbsp; | Дополнительные сведения |
| :--- | :--- |
| **Условие** | При наличии сеансов, ожидающих предоставления памяти 20 секунд и дольше, сеансы, использующие более 16 МБ выделенной памяти в течение более 20 секунд, останавливаются в убывающем порядке продолжительности удержания ресурса, то есть первым останавливается самый давний сеанс. Остановка сеансов прекращается, как только высвобождается необходимый объем памяти. |
| **Код ошибки** | **40553**. Сеанс остановлен из-за чрезмерного потребления памяти. Попробуйте изменить запрос и задать обработку меньшего числа строк. |
| **Ограничение** | Предоставление более 16 МБ памяти в течение более 20 секунд. |
| **Тип отклоненных запросов** | Запросы, использующие выделенную память, включая запросы, использующие сортировку и хэш-соединения. |
| **Рекомендации** | Выполните настройку запросов, требующих использования сортировки и (или) хэш-соединений. |

## Сеансы:

| &nbsp; | Дополнительные сведения |
| :--- | :--- |
| **Условие** | База данных SQL регулирует максимально возможное количество одновременных сеансов для базы данных. При достижении предела одновременных сеансов для базы данных, новые подключения к базе данных отклоняются, а пользователь получает код ошибки 10928. Однако существующие сеансы в базе данных не останавливаются. |
| **Код ошибки** | **10928**. Идентификатор ресурса: 2. Предел %s для базы данных составляет %d, и он достигнут. Дополнительные сведения см. в разделе http://go.microsoft.com/fwlink/?LinkId=267637. |
| **Ограничение** | Зависит от [уровня службы и уровня производительности](https://msdn.microsoft.com/library/azure/dn741336.aspx). |
| **Рекомендации** | Проверьте представление dm\_exec\_requests, что увидеть выполняемые в данный момент пользовательские запросы. |

> [AZURE.NOTE]Значение идентификатора ресурса в сообщении об ошибке указывает на ресурс, предел которого был достигнут. Для сеансов идентификатор ресурса = 2.

## Tempdb

| &nbsp; | Дополнительные сведения |
| :--- | :--- |
| **Условие** | Запросы к tempdb могут отклоняться при любом из следующих условий:<br><br>**Состояние 1.** Если сеанс использует более 5 ГБ места tempdb, он останавливается.<br><br>**Состояние 2.** Транзакции в tempdb с журналами размером более 2 ГБ сокращаются. Примеры операций, которые могут использовать место для журналов в tempdb: вставка, обновление, удаление, слияние, создание индекса.<br><br>**Состояние 3.** Незафиксированные транзакции в tempdb могут блокировать сокращение файлов журналов. Чтобы предотвратить это, расстояние между самым ранним активным регистрационным номером транзакции в журнале (LSN) и заключительным фрагментом журнала (текущим номером LSN) в tempdb не должно превышать 20 % размера файла журнала. При нарушении этого условия соответствующая транзакция в tempdb останавливается и откатывается, чтобы позволить сократить журнал. |
| **Код ошибки** | **40551**. Сеанс остановлен из-за чрезмерного использования tempdb. Попробуйте изменить запрос, чтобы сократить использование временного табличного пространства. |
| **Ограничение** | **Состояние 1.** 5 ГБ места в tempdb <br><br> **Состояние 2.** 2 ГБ на транзакцию в tempdb <br><br>**Состояние 3.** 20 % всего места для журналов в tempdb |
| **Тип отклоненных запросов** | Все инструкции DDL или DML в tempdb. |
| **Рекомендации** | Измените запросы, чтобы сократить использование временного табличного пространства, удалить временные объекты после того, как они станут не нужны, сократить таблицы или удалить неиспользуемые таблицы. Сократите размер данных в транзакции в tempdb за счет уменьшения количества строк или разбиения операции на несколько транзакций. |

## Длительность транзакции

| &nbsp; | Дополнительные сведения |
| :--- | :--- |
| **Условие** | Транзакции запрашивают блокировку ресурсов, от которых зависят, таких как строки, страницы или таблицы, а затем снимают блокировку после исчезновения потребности в этих ресурсах. Запросы могут отклоняться при любом из следующих двух условий. Состояние 1: если транзакция выполняется более 24 часов, ее выполнение прекращается. Состояние 2: если транзакция блокирует ресурс, необходимый базовой системной задаче, дольше 20 секунд, ее выполнение прекращается. |
| **Код ошибки** | **40549**. Сеанс остановлен из-за наличия транзакции с длительным временем выполнения. Попробуйте сократить время выполнения транзакции. |
| **Ограничение** | **Состояние 1:** 24 часа<br><br>**Состояние 2:** 20 секунд, если транзакция блокирует ресурс, необходимый базовой системной задаче |
| **Тип отклоненных запросов** | Любая транзакция, выполняемая в течение более 24 часов, а также любые инструкции DDL или DML, блокирующие ресурсы, что ведет к блокировке системной задачи. |
| **Рекомендации** | Операции с Базой данных SQL не должны блокировать пользовательский ввод или иметь прочие зависимости, ведущие к появлению транзакций с длительным временем выполнения. |

## Количество блокировок транзакций

| &nbsp; | Дополнительные сведения |
| :--- | :--- |
| **Условие** | Сеансы, использующие более миллиона блокировок, останавливаются. |
| **Код ошибки** | **40550**. Сеанс остановлен, поскольку он использует слишком много блокировок. Попробуйте сократить количество читаемых или изменяемых строк в одной транзакции. |
| **Ограничение** | миллион блокировок на одну транзакцию |
| **Тип отклоненных запросов** | Любые инструкции DDL или DML. |
| **Рекомендации** | Следующие динамические административные представления можно использовать для мониторинга транзакций: **sys.dm\_tran\_active\_transactions**, **sys.dm\_tran\_database\_transactions**, **sys.dm\_tran\_locks** и **sys.dm\_tran\_session\_transactions**. В зависимости от типа приложения, можно использовать более грубые указания блокировки, такие как **PAGLOCK** или **TABLOCK**, чтобы сократить количество блокировок в определенной инструкции или транзакции. Обратите внимание, что это может негативно отразиться на параллелизме приложений. |


## Длина журнала транзакций


Для версии V12 Базы данных SQL Azure в ценовой категории Standard или Premium максимальная длина журнала транзакций больше не ограничена 2 ГБ.

В таблице ниже указаны ограничения для длины журнала транзакций для версии V11.


| &nbsp; | Дополнительные сведения |
| :--- | :--- |
| **Условие** | Запросы могут отклоняться при любом из следующих двух условий:<br><br>**Состояние 1:** База данных SQL поддерживает транзакции, создающие журналы размером не более 2 ГБ. Транзакции, размер журналов которых превышает этот предел, сокращаются. Примеры операций, которые могут использовать место для журналов в этом томе: вставка, обновление, удаление, слияние, создание индекса.<br><br>**Состояние 2.** Незафиксированные транзакции могут блокировать сокращение файлов журналов. Чтобы предотвратить это, расстояние между самым ранним активным регистрационным номером транзакции в журнале (LSN) и заключительным фрагментом журнала (текущим номером LSN) не должно превышать 20 % размера файла журнала. При нарушении этого условия соответствующая транзакция останавливается и откатывается, чтобы позволить сократить журнал. |
| **Код ошибки** | **40552**. Сеанс остановлен из-за чрезмерного использования места для журналов транзакций. Попробуйте сократить количество изменяемых строк в одной транзакции. |
| **Ограничение** | **Состояние 1:** 2 ГБ на транзакцию<br><br>**Состояние 2:** 20 % всего места для журналов |
| **Тип отклоненных запросов** | Любые инструкции DDL или DML. |
| **Рекомендации** | Для строковых операций сократите размер данных в транзакции, например путем уменьшения количества строк или разбиения операции на несколько транзакций. Для табличных и индексных операций, требующих единой транзакции, необходимо следовать следующей формуле: количество задействуемых строк в таблице * (средний размер обновляемого поля в байтах + 80) < 2 ГБ (при перестроении индекса средний размер обновляемого поля следует заменить средним размером индекса). |

## Рабочие потоки (максимальное количество одновременных запросов)

| &nbsp; | Дополнительные сведения |
| :--- | :--- |
| **Условие** | База данных SQL регулирует предел количества рабочих потоков (одновременных запросов) в базе данных. Любая база данных, превышающая максимально возможное количество одновременных запросов, получает ошибку 10928, а дальнейшие запросы к этой базе данных могут быть отклонены. |
| **Коды ошибок** | **10928**. Идентификатор ресурса: 1. Предел %s для базы данных составляет %d, и он достигнут. Дополнительные сведения см. в разделе http://go.microsoft.com/fwlink/?LinkId=267637.<br><br>**10929**. Идентификатор ресурса: 1. Минимальная гарантия %s составляет %d, максимальное значение равно %d, а текущее использование для базы данных — %d. Тем не менее, в настоящее время сервер слишком занят, чтобы обработать более чем %d запросов для этой базы данных. Дополнительные сведения см. в разделе http://go.microsoft.com/fwlink/?LinkId=267637. В противном случае повторите попытку позже. |
| **Ограничение** | Для уровней Basic, Standard и Premium предел зависит от [уровня производительности](https://msdn.microsoft.com/library/azure/dn741336.aspx). Для более ранних версий баз данных выпусков Web/Business Edition максимальный предел одновременных запросов равен 180, но может быть ниже в зависимости от системной активности. |
| **Рекомендации** | Обратитесь к представлению dm\_exec\_requests, что просмотреть выполняемые в данный момент пользовательские запросы. <br><br>Подождите 10 секунд и повторите запрос. |

> [AZURE.NOTE]Значение идентификатора ресурса в сообщении об ошибке указывает на ресурс, предел которого был достигнут. Для рабочих потоков идентификатор ресурса = 1.

Ошибки, связанные с управлением рабочими потоками (10928/10929), заменяют исходную ошибку регулирования ресурсов ядра (40501) для рабочих потоков. В нормальных условиях пользователи должны перестать получать ошибку регулирования ресурсов ядра для рабочих потоков.

В некоторых сценариях, например при использовании компонента федеративной базы данных, при входе в базу данных может отобразиться ошибка превышения предела рабочих потоков (10928), поскольку эта операция использует рабочий поток под вызовом Connection.Open. Это может вывести приложение за пороговое значение рабочего потока. Приложения следует оснащать встроенной логикой для корректной обработки этой ошибки в подобных случаях.

## См. также

[Управление ресурсами в базе данных SQL Azure](https://msdn.microsoft.com/library/azure/dn338083.aspx)

[Сообщения об ошибках для клиентских программ базы данных SQL](sql-database-develop-error-messages.md)

[Рекомендации по предотвращению отклонения запросов и завершения подключений в базе данных SQL Azure](https://msdn.microsoft.com/library/azure/dn338082.aspx)

<!---HONumber=August15_HO7-->