---
title: 'Резервные копии Базы данных SQL Azure: автоматически создаваемые и геоизбыточные | Документация Майкрософт'
description: База данных SQL автоматически создает локальную резервную копию базы данных каждые пять минут и использует геоизбыточное хранилище Azure с доступом на чтение для обеспечения геоизбыточности.
services: sql-database
author: anosov1960
manager: craigg
ms.service: sql-database
ms.custom: business continuity
ms.topic: article
ms.workload: Active
ms.date: 04/04/2018
ms.author: sashan
ms.reviewer: carlrab
ms.openlocfilehash: 37bbbf8ea5a5d8439b300d0740e4f1a048e98e91
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
ms.locfileid: "32189074"
---
# <a name="learn-about-automatic-sql-database-backups"></a>Подробнее об автоматически создаваемых резервных копиях в Базе данных SQL

База данных SQL автоматически создает резервную копию базы данных и использует геоизбыточное хранилище Azure (RA-GRS) с доступом для чтения для обеспечения геоизбыточности. Эти резервные копии создаются автоматически и без дополнительной платы. Не нужно ничего делать для того, чтобы это происходило. Резервные копии базы данных являются важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления, так как они защищают данные от случайного повреждения или удаления. Если вы хотите хранить резервные копии в собственном контейнере хранилища, можно настроить политику длительного периода удержания резервных копий. Дополнительные сведения см. в статье [Storing Azure SQL Database Backups for up to 10 years](sql-database-long-term-retention.md) (Хранение резервных копий баз данных SQL Azure до 10 лет).

## <a name="what-is-a-sql-database-backup"></a>Что такое резервная копия Базы данных SQL?

Для создания [полных](https://msdn.microsoft.com/library/ms186289.aspx), [разностных](https://msdn.microsoft.com/library/ms175526.aspx) и резервных копий [журналов транзакций](https://msdn.microsoft.com/library/ms191429.aspx) с целью восстановления до точки во времени (PITR) база данных SQL использует технологию SQL Server. Как правило, резервные копии журналов транзакций создаются каждые 5–10 минут. Периодичность архивации зависит от уровня производительности и числа действий, производимых с базой данных. Резервные копии журналов транзакций и полные, разностные резервные копии позволяют восстановить базу данных на определенный момент времени на том же сервере, на котором размещена база данных. При восстановлении базы данных служба сама определяет, какие резервные копии (полные, разностные или резервные копии журналов транзакций) следует восстановить.


Эти резервные копии позволяют выполнить следующие операции:

* Восстановление базы данных на определенный момент времени в течение периода хранения. В результате этой операции будет создана база данных на том же сервере, что и исходная база данных.
* Восстановление удаленной базы данных на момент удаления или на любой момент в пределах периода удержания. Удаленную базу данных можно восстановить только на том же сервере, на котором была создана исходная база данных.
* Восстановление базы данных в другом географическом регионе. Эта операция позволяет выполнить восстановление после сбоя в регионе при отсутствии доступа к серверу и базе данных. В результате создается база данных на любом существующем сервере в любой точке мира. 
* Восстановление базы данных из определенной резервной копии длительного хранения, если для базы данных настроена политика длительного хранения. Эта операция позволяет восстановить старую версию базы данных, чтобы удовлетворить запрос на соответствие или запустить старую версию приложения. Ознакомьтесь со статьей [Long-term retention](sql-database-long-term-retention.md) (Длительный период удержания).
* Инструкции по восстановлению см. в статье о [восстановлении базы данных из резервной копии](sql-database-recovery-using-backups.md).

> [!NOTE]
> В службе хранилища Azure термин *репликация* обозначает копирование файлов из одного расположения в другое. *Репликация базы данных SQL* означает хранение нескольких баз данных-получателей, синхронизированных с основной базой данных. 
> 

## <a name="how-often-do-backups-happen"></a>Как часто создаются резервные копии?
Полные резервные копии базы данных создаются каждую неделю, разностные резервные копии, как правило, создаются каждые несколько часов, а резервные копии журналов транзакций создаются каждые 5–10 минут. Первое полное резервное копирование планируется сразу после создания базы данных. Обычно оно занимает не более 30 минут, но для базы данных большого размера может потребоваться больше времени. Например, начальное резервное копирование будет выполняться дольше для восстановленной базы данных или копии базы данных. После первого полного резервного копирования все последующие операции резервного копирования планируются автоматически и управляются без участия пользователя в фоновом режиме. Точное время создания всех копий базы данных определяет служба Базы данных SQL с учетом распределения общей рабочей нагрузки в системе. 

Георепликация хранилища службы архивации осуществляется по расписанию репликации службы хранилища Azure.

## <a name="how-long-do-you-keep-my-backups"></a>Как долго хранятся мои резервные копии?
Каждая резервная копия базы данных SQL имеет период хранения, основанный на уровне служб базы данных, и для [модели приобретения на основе DTU](sql-database-service-tiers-dtu.md) и [модели приобретения на основе виртуальных ядер (предварительная версия)](sql-database-service-tiers-vcore.md) они разные. 


### <a name="database-retention-for-dtu-based-purchasing-model"></a>Хранение базы данных в модели приобретения на основе DTU
Срок хранения базы данных в модели приобретения на основе DTU зависит от уровня служб. Ниже перечислены сроки хранения баз данных для разных уровней служб:

* Уровень служб "Базовый" — 7 дней.
* Уровень служб "Стандартный" — 35 дней.
* Уровень служб "Премиум" — 35 дней.
* Уровень общего назначения настраивается максимум на 35 дней (по умолчанию — 7 дней)*.
* Уровень "Критически важный для бизнеса" настраивается максимум на 35 дней (по умолчанию — 7 дней)*.

\* На стадии предварительной версии период хранения резервных копий нельзя настроить, он имеет фиксированную продолжительность — 7 дней.

При преобразовании базы данных с более длительным периодом хранения резервных копий в базу данных с более коротким периодом хранения все существующие резервные копии, превышающие целевой период хранения, будут недоступны.

При обратном преобразовании (с более короткого периода) в базе данных SQL резервные копии будут храниться до достижения более длительного периода хранения. 

При удалении базы данных База данных SQL хранит резервные копии так же, как и для базы данных в Интернете. Например, предположим, что была удалена база данных уровня "Базовый", имеющая срок хранения 7 дней. Резервная копия, хранящаяся четыре дня, будет храниться еще три дня.

> [!IMPORTANT]
> Если вы удаляете сервер SQL Azure, на котором размещены базы данных SQL, то все связанные с ним базы данных также будут удалены без возможности восстановления. Удаленный сервер восстановить невозможно.

### <a name="database-retention-for-the-vcore-based-purchasing-model-preview"></a>Хранение базы данных в модели приобретения на основе виртуальных ядер (предварительная версия)

Хранилище для резервных копий базы данных выделяется для поддержки следующих возможностей базы данных SQL: восстановления до точки во времени (PITR) и долгосрочного хранения (LTR). Это хранилище выделяется отдельно для каждой базы данных. За эти возможности выставляются два отдельных счета. 

- **Восстановление до точки во времени**. Резервные копии отдельной базы данных автоматически копируются в хранилище RA-GRS. Размер хранилища динамически увеличивается по мере создания новых резервных копий.  Хранилище используется для полных резервных копий, созданных за неделю, разностных резервных копий, созданных за день, и резервных копий журналов транзакций, копируемых каждые 5 минут. Использование хранилища зависит от скорости изменения базы данных и периода хранения. Вы можете настроить отдельный период хранения для каждой базы данных длительностью от 7 до 35 дней. Минимальный объем хранилища, равный размеру данных, предоставляется без дополнительной оплаты. Для большинства баз данных этого объема достаточно для хранения резервных копий за 7 дней. Дополнительную информацию см. в статье [Восстановление до точки во времени](sql-database-recovery-using-backups.md#point-in-time-restore).
- **Долгосрочное хранение**. База данных SQL предоставляет возможность настройки долгосрочного периода хранения полных резервных копий до 10 лет. Если политика долгосрочно хранения включена, эти резервные копии автоматически сохраняются в хранилище RA-GRS, однако вы можете контролировать частоту их копирования. Чтобы удовлетворять различные требования к соответствию, вы можете выбрать разные периоды хранения для резервных копий, создаваемых еженедельно, ежемесячно или ежегодно. Эта конфигурация определит, какой объем хранилища будет использоваться для резервных копий долгосрочного хранения. Вы можете использовать калькулятор цен LTR, чтобы определить стоимость долгосрочного хранения резервных копий. Дополнительные сведения см. в статье [Storing Azure SQL Database Backups for up to 10 years](sql-database-long-term-retention.md) (Хранение резервных копий баз данных SQL Azure до 10 лет).

## <a name="how-to-extend-the-backup-retention-period"></a>Как увеличить период удержания резервной копии?

Если приложению требуется, чтобы резервные копии были доступны в течение более длительного периода времени, нежели максимальный период хранения резервных копий PITR, можно настроить политику длительного периода хранения резервных копий для отдельных баз данных (политика LTR). Это позволит увеличить встроенный период хранения с максимальных 35 дней до 10 лет. Дополнительные сведения см. в статье [Storing Azure SQL Database Backups for up to 10 years](sql-database-long-term-retention.md) (Хранение резервных копий баз данных SQL Azure до 10 лет).

После добавления политики длительного периода хранения резервных копий в базу данных с помощью портала Azure или API еженедельные полные резервные копии базы данных будут автоматически скопированы в отдельное хранилище контейнеров RA-GRS для длительного хранения (хранилище LTR). Если база данных зашифрована с использованием прозрачного шифрования, резервные копии будут автоматически шифроваться при хранении. База данных SQL будет автоматически удалять резервные копии с истекшим сроком действия с учетом меток времени и политики длительного периода хранения резервных копий. После настройки политики вам не нужно управлять расписанием резервного копирования или беспокоиться об очистке старых файлов. Для просмотра, восстановления и удаления этих резервных копий можно воспользоваться порталом Azure или PowerShell.

## <a name="are-backups-encrypted"></a>Резервные копии зашифрованы?

Когда для базы данных Azure SQL включено прозрачное шифрование данных, также шифруются резервные копии. Прозрачное шифрование данных включено по умолчанию для всех новых баз данных SQL Azure. Дополнительные сведения о TDE см. в статье [Прозрачное шифрование данных в Базе данных SQL Azure](/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql).

## <a name="are-the-automatic-backups-compliant-with-gdpr"></a>Совместимы ли автоматические резервные копии с GDPR?
Если в резервных копиях находятся персональные данные, на которые распространяется Общий регламент по защите данных (GDPR), вам требуется применить усиленные меры безопасности для их защити от несанкционированного доступа. Чтобы соответствовать GDPR, найдите способ управлять запросами к данным владельцев, не получая доступа к резервным копиям.  Для резервных копий, хранимых на протяжении короткого периода времени, можно сократить их период хранения до 30 дней, что соответствует времени, необходимому для завершения запросов на доступ к данным.  Если резервные копии требуются хранить на протяжении длительного периода, то в них рекомендуется хранить только анонимные данные. Например, если нужно удалить или изменить данные о пользователе, удалять или обновлять существующие резервные копии не потребуется. Дополнительные сведения о рекомендациях GDPR можно узнать в техническом документе об [управлении данными для соответствия GDPR](https://info.microsoft.com/DataGovernanceforGDPRCompliancePrinciplesProcessesandPractices-Registration.html).

## <a name="next-steps"></a>Дополнительная информация

- Резервные копии базы данных являются важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления, так как они защищают данные от случайного повреждения или удаления. Дополнительные сведения о других решениях для базы данных SQL Azure, обеспечивающих непрерывность бизнес-процессов, см. в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](sql-database-business-continuity.md).
- Сведения о восстановлении базы данных на определенный момент времени с помощью портала Azure см .в [этой статье](sql-database-recovery-using-backups.md).
- Сведения о восстановлении базы данных на определенный момент времени с помощью PowerShell см .в [этой статье](scripts/sql-database-restore-database-powershell.md).
- Сведения о настройке и администрировании долгосрочного хранения создаваемых автоматически резервных копий в хранилище служб восстановления Azure, а также о восстановлении с помощью таких резервных копий на портале Azure см. в разделе [Настройка и администрирование долгосрочного хранения резервных копий баз данных в хранилище служб восстановления Azure и восстановление посредством этих резервных копий с помощью портала Azure](sql-database-long-term-backup-retention-configure.md).
- Сведения о настройке и администрировании долгосрочного хранения создаваемых автоматически резервных копий в хранилище служб восстановления Azure, а также о восстановлении посредством таких резервных копий с помощью PowerShell см. в разделе [Настройка долгосрочного хранения создаваемых автоматически резервных копий баз данных в хранилище служб восстановления Azure с помощью PowerShell](sql-database-long-term-backup-retention-configure.md).
