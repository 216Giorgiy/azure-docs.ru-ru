---
title: 'Резервные копии Базы данных SQL Azure: автоматически создаваемые и геоизбыточные | Документация Майкрософт'
description: База данных SQL автоматически создает локальную резервную копию базы данных каждые пять минут и использует геоизбыточное хранилище Azure с доступом на чтение для обеспечения геоизбыточности.
services: sql-database
author: anosov1960
manager: craigg
ms.service: sql-database
ms.custom: business continuity
ms.topic: conceptual
ms.workload: Active
ms.date: 07/25/2018
ms.author: sashan
ms.reviewer: carlrab
ms.openlocfilehash: ce7c41730bec4e014225fb8c744d029493f5ec2c
ms.sourcegitcommit: 2b2129fa6413230cf35ac18ff386d40d1e8d0677
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/30/2018
ms.locfileid: "43246792"
---
# <a name="learn-about-automatic-sql-database-backups"></a>Подробнее об автоматически создаваемых резервных копиях в Базе данных SQL

База данных SQL автоматически создает резервную копию базы данных и использует геоизбыточное хранилище Azure (RA-GRS) с доступом для чтения для обеспечения геоизбыточности. Эти резервные копии создаются автоматически и без дополнительной платы. Не нужно ничего делать для того, чтобы это происходило. Резервные копии базы данных являются важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления, так как они защищают данные от случайного повреждения или удаления. Если правила безопасности требуют, чтобы резервные копии были доступны в течение продолжительного времени, можно настроить политику долгосрочного хранения резервных копий. Дополнительные сведения см. в статье [Storing Azure SQL Database Backups for up to 10 years](sql-database-long-term-retention.md) (Хранение резервных копий баз данных SQL Azure до 10 лет).

[!INCLUDE [GDPR-related guidance](../../includes/gdpr-intro-sentence.md)]

## <a name="what-is-a-sql-database-backup"></a>Что такое резервная копия Базы данных SQL?

Для создания [полных](https://msdn.microsoft.com/library/ms186289.aspx), [разностных](https://docs.microsoft.com/sql/relational-databases/backup-restore/differential-backups-sql-server) и резервных копий [журналов транзакций](https://msdn.microsoft.com/library/ms191429.aspx) с целью восстановления до точки во времени (PITR) база данных SQL использует технологию SQL Server. Как правило, резервные копии журналов транзакций создаются каждые 5–10 минут, а разностные резервные копии — каждые 12 часов. Периодичность архивации зависит от уровня производительности и числа действий, производимых с базой данных. Резервные копии журналов транзакций и полные, разностные резервные копии позволяют восстановить базу данных на определенный момент времени на том же сервере, на котором размещена база данных. Резервные копии сохраняются в больших двоичных объектах в геоизбыточном хранилище с доступом на чтение, которые реплицируются в [сопряженный центр обработки данных](../best-practices-availability-paired-regions.md) для защиты от сбоя центра обработки данных. При восстановлении базы данных служба сама определяет, какие резервные копии (полные, разностные или резервные копии журналов транзакций) следует восстановить.


Эти резервные копии позволяют выполнить следующие операции:

* Восстановление базы данных на определенный момент времени в течение периода хранения. В результате этой операции будет создана база данных на том же сервере, что и исходная база данных.
* Восстановление удаленной базы данных на момент удаления или на любой момент в пределах периода удержания. Удаленную базу данных можно восстановить только на том же сервере, на котором была создана исходная база данных.
* Восстановление базы данных в другом географическом регионе. Эта операция позволяет выполнить восстановление после сбоя в регионе при отсутствии доступа к серверу и базе данных. В результате создается база данных на любом существующем сервере в любой точке мира. 
* Восстановление базы данных из определенной резервной копии длительного хранения, если для базы данных настроена политика долгосрочного хранения (LTR). Эта операция позволяет восстановить старую версию базы данных, чтобы удовлетворить запрос на соответствие или запустить старую версию приложения. Ознакомьтесь со статьей [Long-term retention](sql-database-long-term-retention.md) (Длительный период удержания).
* Инструкции по восстановлению см. в статье о [восстановлении базы данных из резервной копии](sql-database-recovery-using-backups.md).

> [!NOTE]
> В службе хранилища Azure термин *репликация* обозначает копирование файлов из одного расположения в другое. *Репликация базы данных SQL* означает хранение нескольких баз данных-получателей, синхронизированных с основной базой данных. 
> 

## <a name="how-long-are-backups-kept"></a>Как долго хранятся резервные копии?
У каждой резервной копии Базы данных SQL есть период хранения по умолчанию, основанный на уровне службы базы данных. Период хранения различается для [модели приобретения на основе DTU](sql-database-service-tiers-dtu.md) и [модели приобретения на основе виртуальных ядер](sql-database-service-tiers-vcore.md). Вы можете изменить период хранения резервных копий для базы данных. Дополнительные сведения см. в разделе [Изменение периода хранения резервных копий](#how-to-change-backup-retention-period).

При удалении базы данных резервные копии для базы данных SQL будут храниться точно так же, как и для базы данных в Интернете. Например, если вы удалите базу данных уровня "Базовый" с периодом хранения семь дней, резервная копия, хранящаяся четыре дня, будет храниться еще три дня.

Если вам нужно сохранить резервные копии на более долгий срок по сравнению с максимальным периодом хранения PITR, вы можете изменить свойства резервной копии, добавив в базу данных один или несколько периодов долгосрочного хранения. Дополнительные сведения см. в разделе [Долгосрочное хранение резервных копий](sql-database-long-term-retention.md).

> [!IMPORTANT]
> Если вы удаляете сервер SQL Azure, на котором размещены базы данных SQL, то все эластичные пулы и базы данных, находящиеся на этом сервере, также будут удалены без возможности восстановления. Удаленный сервер восстановить невозможно. Но если вы настроили долгосрочное хранение, резервные копии баз данных с LTR не будут удалены, и вы сможете восстановить эти базы данных.

### <a name="pitr-retention-period"></a>Срок хранения резервных копий для восстановления на определенный момент времени
Период хранения по умолчанию для баз данных, созданных с использованием модели приобретения на основе DTU, зависит от уровня служб:

* Для уровня служб "Базовый" он составляет 1 неделю.
* Для уровня служб "Стандартный" — 5 недель.
* Для уровня служб "Премиум" — 5 недель.

Если вы используете [модель приобретения на основе виртуальных ядер](sql-database-service-tiers-vcore.md), то можно настроить период хранения резервных копий до 35 дней. 

Если уменьшить текущий период хранения PITR, то все существующие резервные копии, которые хранились дольше нового установленного периода хранения, будут недоступны. 

Если увеличить текущий период хранения PITR, то база данных SQL будет хранить существующие резервные копии до достижения нового установленного периода хранения.

## <a name="how-often-do-backups-happen"></a>Как часто создаются резервные копии?
### <a name="backups-for-point-in-time-restore"></a>Резервные копии для восстановления на момент времени
База данных SQL поддерживает самообслуживание для восстановления на момент времени (PITR) путем автоматического создания полной резервной копии, разностных резервных копий и резервных копий журналов транзакций. Полные резервные копии базы данных создаются каждую неделю, разностные резервные копии — как правило, каждые 12 часов, а резервные копии журналов транзакций создаются каждые 5 – 10 минут. Периодичность архивации зависит от уровня производительности и числа действий, производимых с базой данных. Первое полное резервное копирование планируется сразу после создания базы данных. Обычно оно занимает не более 30 минут, но для базы данных большого размера может потребоваться больше времени. Например, начальное резервное копирование будет выполняться дольше для восстановленной базы данных или копии базы данных. После первого полного резервного копирования все последующие операции резервного копирования планируются автоматически и управляются без участия пользователя в фоновом режиме. Точное время создания всех копий базы данных определяет служба Базы данных SQL с учетом распределения общей рабочей нагрузки в системе.

Резервные копии PITR также обладают географической избыточностью и защищены с помощью [репликации службы хранилища Azure между регионами](../storage/common/storage-redundancy-grs.md#read-access-geo-redundant-storage).

Дополнительную информацию см. в статье [Восстановление до точки во времени](sql-database-recovery-using-backups.md#point-in-time-restore).

### <a name="backups-for-long-term-retention"></a>Резервные копии для долгосрочного хранения
База данных SQL предоставляет возможность настройки долгосрочного периода хранения (LTR) полных резервных копий до 10 лет в хранилище BLOB-объектов Azure. Если политика LTR включена, еженедельные полные резервные копии автоматически копируются в другой контейнер геоизбыточного хранилища с доступом на чтение. Чтобы удовлетворять различные требования к соответствию, вы можете выбрать разные периоды хранения для резервных копий, создаваемых еженедельно, ежемесячно или ежегодно. Использование хранилища зависит от частоты резервного копирования и периода хранения. Вы можете использовать [калькулятор цен LTR](https://azure.microsoft.com/pricing/calculator/?service=sql-database), чтобы определить стоимость долгосрочного хранения резервных копий. 

Как и резервные копии PITR, резервные копии LTR также обладают географической избыточностью и защищены с помощью [репликации службы хранилища Azure между регионами](../storage/common/storage-redundancy-grs.md#read-access-geo-redundant-storage).

Дополнительные сведения см. в разделе [Долгосрочное хранение резервных копий](sql-database-long-term-retention.md).

## <a name="are-backups-encrypted"></a>Резервные копии зашифрованы?

Если база данных зашифрована с использованием прозрачного шифрования, резервные копии, включая резервные копии LTR, будут автоматически шифроваться при хранении. Когда для базы данных Azure SQL включено прозрачное шифрование данных, также шифруются резервные копии. Прозрачное шифрование данных включено по умолчанию для всех новых баз данных SQL Azure. Дополнительные сведения о прозрачном шифровании данных см. в статье [Прозрачное шифрование данных в базе данных SQL Azure](/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql).

## <a name="how-do-automated-backups-impact-my-compliance"></a>Как автоматически создаваемые резервные копии влияют на соответствие?

При переносе базы данных с уровня служб на основе DTU с периодом хранения PITR по умолчанию 35 дней на уровень служб на основе виртуальных ядер, чтобы не нарушить политику восстановления данных приложения период хранения PITR сохраняется. Если период хранения по умолчанию не соответствует вашим требованиям соответствия, вы можете изменить период хранения PITR с помощью PowerShell или REST API. Дополнительные сведения см. в разделе [Изменение периода хранения резервных копий](#how-to-change-backup-retention-period).

[!INCLUDE [GDPR-related guidance](../../includes/gdpr-intro-sentence.md)]

## <a name="how-to-change-backup-retention-period"></a>Как изменить период хранения резервной копии
Вы можете изменить период хранения по умолчанию с помощью REST API или PowerShell. Поддерживаемые значения: 7, 14, 21, 28 и 35 дней. В следующих примерах показано, как установить период хранения PITR на 28 дней. 

> [!NOTE]
> Эти API-интерфейсы влияют только на период хранения PITR. Если для базы данных настроено LTR, оно не будет затронуто. Дополнительные сведения о том, как изменить период хранения LTR, см. в разделе [Долгосрочное хранение резервных копий](sql-database-long-term-retention.md).

### <a name="change-pitr-backup-retention-period-using-powershell"></a>Изменение периода хранения PITR с помощью PowerShell
```powershell
Set-AzureRmSqlDatabaseBackupShortTermRetentionPolicy -ResourceGroupName resourceGroup -ServerName testserver -DatabaseName testDatabase -RetentionDays 28
```
> [!IMPORTANT]
> Этот API включен в модуль PowerShell AzureRM.Sql, начиная с версии [4.7.0-preview](https://www.powershellgallery.com/packages/AzureRM.Sql/4.7.0-preview). 

### <a name="change-pitr-retention-period-using-rest-api"></a>Изменение периода хранения PITR с помощью REST API
**Пример запроса**
```http
PUT https://management.azure.com/subscriptions/00000000-1111-2222-3333-444444444444/resourceGroups/resourceGroup/providers/Microsoft.Sql/servers/testserver/databases/testDatabase/backupShortTermRetentionPolicies/default?api-version=2017-10-01-preview
```
**Тело запроса**
```json
{
  "properties":{  
      "retentionDays":28
   }
}
```
**Пример ответа**

Код состояния: 200.
```json
{
  "id": "/subscriptions/00000000-1111-2222-3333-444444444444/providers/Microsoft.Sql/resourceGroups/resourceGroup/servers/testserver/databases/testDatabase/backupShortTermRetentionPolicies/default",
  "name": "default",
  "type": "Microsoft.Sql/resourceGroups/servers/databases/backupShortTermRetentionPolicies",
  "properties": {
    "retentionDays": 28
  }
}
```
Дополнительные сведения см. в разделе [REST API для хранения резервных копий](https://docs.microsoft.com/rest/api/sql/backupshorttermretentionpolicies).

## <a name="next-steps"></a>Дополнительная информация

- Резервные копии базы данных являются важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления, так как они защищают данные от случайного повреждения или удаления. Дополнительные сведения о других решениях для базы данных SQL Azure, обеспечивающих непрерывность бизнес-процессов, см. в статье [Обзор обеспечения непрерывности бизнес-процессов с помощью базы данных SQL Azure](sql-database-business-continuity.md).
- Сведения о восстановлении базы данных на определенный момент времени с помощью портала Azure см .в [этой статье](sql-database-recovery-using-backups.md).
- Сведения о восстановлении базы данных на определенный момент времени с помощью PowerShell см .в [этой статье](scripts/sql-database-restore-database-powershell.md).
- Сведения о настройке и администрировании долгосрочного хранения создаваемых автоматически резервных копий в хранилище BLOB-объектов Azure, а также о восстановлении таких резервных копий на портале Azure см. в [этой статье](sql-database-long-term-backup-retention-configure.md).
- Сведения о настройке и администрировании долгосрочного хранения создаваемых автоматически резервных копий в хранилище BLOB-объектов Azure, а также о восстановлении таких резервных копий с использованием PowerShell см. в [этой статье](sql-database-long-term-backup-retention-configure.md).
