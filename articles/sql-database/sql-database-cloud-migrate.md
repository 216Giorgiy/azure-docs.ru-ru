<properties 
   pageTitle="Миграция в Базу данных SQL Azure" 
   description="База данных SQL Microsoft Azure, развертывание базы данных, миграция базы данных, импорт базы данных, экспорт базы данных, мастер миграции" 
   services="sql-database" 
   documentationCenter="" 
   authors="pehteh" 
   manager="jeffreyg" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-management" 
   ms.date="04/15/2015"
   ms.author="pehteh"/>

# Общие сведения
База данных SQL Azure версии 12 обеспечивает практически полную совместимость с SQL Server 2014 на уровне ядра, что значительно упрощает миграцию баз данных из SQL Server в Базу данных SQL Azure. В большинстве случаев миграция сводится к простой операции перемещения, не требующей изменения схемы или доработки приложений. А когда изменения базы данных все же необходимы, их объем весьма ограничен.

Серверные функции SQL Server не поддерживаются в Базе данных SQL, поэтому прежде чем выполнять миграцию, нужно доработать базы данных и приложения, которые их используют. Несмотря на то что База данных SQL версии 12 лучше совместима с SQL Server, миграцию все равно необходимо тщательно планировать, особенно для массивных баз данных со сложной структурой.

## Краткий обзор
Существуют разные варианты миграции баз данных SQL Server в Azure, каждый из которых предусматривает использование специальных инструментов. В одних случаях она выполняется быстро и легко, другие способы требуют больше времени для подготовки. Обратите внимание, что для миграции больших баз данных со сложной структурой может потребоваться несколько часов!

### Вариант 1.
***Миграция полностью совместимой базы данных с помощью среды SQL Server Management Studio (SSMS)***

База данных развертывается в Базе данных SQL Azure с помощью среды SSMS. Можно выполнить развертывание напрямую или же сначала экспортировать базу данных в файл BACPAC, а потом импортировать его в новую базу данных SQL Azure. Этот вариант используется, когда исходная база данных полностью совместима с Базой данных SQL Azure.

### Вариант 2.
***Миграция практически полностью совместимой базы данных с помощью мастера миграции SQL Azure (SAMW)***

База данных обрабатывается с помощью мастера миграции SQL Azure, в результате чего создается скрипт миграции, содержащий схему или схему с данными в формате BCP. Этот вариант используется, когда нужно изменить схему базы данных и требуемые изменения можно обработать с помощью мастера.

### Вариант 3.
***Автономное обновление схемы базы данных с помощью Visual Studio (VS) и мастера SAMW с последующим развертыванием из среды SSMS***

Исходная база данных импортируется в проект базы данных Visual Studio и обрабатывается в автономном режиме. Затем мастер миграции SQL Azure обрабатывает все скрипты в проекте, чтобы применить необходимые преобразования и исправления. Проект компилируется и оптимизируется для Базы данных SQL версии 12, а все неисправленные ошибки регистрируются в журнале и затем обрабатываются вручную с помощью инструментов Visual Studio для работы с SQL Server. После успешной компиляции проект публикуется в копии исходной базы данных. Затем развертывание обновленной базы данных в Базе данных SQL Azure выполняется по плану, описанному в первом варианте. Если требуется перенести только схему, можно опубликовать ее в Базе данных SQL Azure непосредственно из Visual Studio. Этот вариант используется, когда нужно существенно изменить схему базы данных и такие изменения нельзя обработать с помощью мастера SAMW.

## Выбор варианта миграции
- Если вы уверены, что базу данных можно перенести без каких-либо изменений, следует выбрать первый вариант. Если нет, экспортируйте из базы данных только схему в файл BACPAC по плану, описанному в первом варианте. Если экспорт завершится без ошибок, можно использовать первый вариант для миграции базы данных с данными.  
- Если возникнут ошибки, обработайте базу данных в режиме «Только схема», используя мастер миграции SQL Azure (SAMW) по плану, описанному во втором варианте. Если отчет SAMW не будет содержать ошибок, можно выбрать второй вариант. 
- Если ошибки будут выявлены, то лучше остановиться на третьем варианте и исправить схему базы данных в автономном режиме в Visual Studio, используя мастер SAMW и корректируя схему вручную. После этого копия исходной базы данных обновляется на месте и переносится в Azure по плану, описанному в первом варианте.

## Инструменты для миграции
Используемые для миграции инструменты включают среду SQL Server Management Studio (SSMS), инструменты Visual Studio для работы с SQL Server (VS, SSDT), мастер миграции SQL Azure (SAMW), а также портал Azure.

> Всегда устанавливайте последние версии клиентских инструментов, так как более ранние несовместимы с Базой данных SQL версии 12.

### SQL Server Management Studio (SSMS)
Используя среду SSMS, можно развернуть совместимую базу данных непосредственно в Базе данных SQL Azure или экспортировать ее логическую резервную копию в файл BACPAC, а затем импортировать его в новую базу данных SQL Azure.

Необходимо использовать последнюю версию среды SSMS (SQL Server 2013 с накопительным пакетом обновления 6 или выше). Актуальную версию можно скачать [здесь](http://msdn.microsoft.com/evalcenter/dn434042.aspx).

### Мастер миграции SQL Azure (SAMW)
С помощью мастера SAMW можно проанализировать схему существующей базы данных на совместимость с Базой данных SQL Azure. Во многих случаях его также можно использовать для создания и выполнения скриптов T-SQL со схемой и данными. Если в процессе преобразования мастер обнаружит элементы схемы, которые не удается преобразовать, будет выведено сообщение об ошибках. В этом случае перед запуском скрипт нужно будет дополнительно отредактировать. Мастер SAMW также обрабатывает функции и хранимые процедуры, которые обычно не включаются в проверку при использовании инструментов Visual Studio для работы с SQL Server (см. ниже), поэтому он может обнаружить ошибки, которые не выявляются в Visual Studio. Сочетание возможностей мастера SAMW и инструментов Visual Studio для работы с базами данных SQL Server может значительно сократить объем работы по переносу сложных схем.

Всегда используйте последнюю версию [мастера миграции SQL Azure](http://sqlazuremw.codeplex.com/), доступную на веб-сайте CodePlex.

### Инструменты Visual Studio для работы с SQL Server (VS, SSDT)
С помощью инструментов Visual Studio для работы с SQL Server можно создавать проекты баз данных и управлять ими. Проект при этом представляет собой набор файлов T-SQL для каждого объекта в схеме. Проект можно импортировать из базы данных или файла скрипта. Впоследствии его можно оптимизировать для Базы данных SQL Azure версии 12. При компиляции проекта схема будет проверена на совместимость. Чтобы устранить выявленные ошибки, нужно щелкнуть их в списке и соответствующим образом отредактировать открывшиеся файлы T-SQL. После исправления всех ошибок вы можете опубликовать проект либо сразу в новой базе данных SQL, либо в исходной базе данных SQL Server или ее копии. В последнем случае схема будет обновлена и базу данных можно будет развернуть со всеми данными с помощью среды SSMS.

Чтобы обеспечить совместимость с последним обновлением Базы данных SQL Azure (версией 12), используйте последнюю версию инструментов Visual Studio для работы с базами данных SQL Server. Убедитесь, что на вашем компьютере установлена версия Visual Studio 2013 с обновлением 4.

## Сравнение
| Вариант 1. | Вариант 2. | Вариант 3. |
| ------------ | ------------ | ------------ |
| Развертывание полностью совместимой базы данных в Базе данных SQL Azure | Создание скрипта миграции с необходимыми изменениями и его выполнение в Базе данных SQL Azure | Обновление базы данных на месте с последующим развертыванием в Базе данных SQL Azure |
|![SSMS](./media/sql-database-cloud-migrate/01SSMSDiagram.png)| ![SAMW](./media/sql-database-cloud-migrate/02SAMWDiagram.png) | ![Изменение в автономном режиме](./media/sql-database-cloud-migrate/03VSSSDTDiagram.png) |
| Используется SSMS | Используется SAMW | Используются SAMW, VS и SSMS |
|Простой процесс; схема должна быть совместима. Схема переносится без изменений. | Мастер SAMW создает скрипт T-SQL с изменениями, необходимыми для обеспечения совместимости. Некоторые неподдерживаемые функции будут удалены из схемы. Большинство помечаются как ошибки. | Схема импортируется в проект базы данных Visual Studio. Можно выполнить дополнительное преобразование с помощью мастера SAMW. Дополнительные изменения вносятся с помощью инструментов Visual Studio для работы с базами данных SQL Server. Окончательная схема используется для обновления базы данных на месте. |
| Можно экспортировать в файл BACPAC схему без данных. | Можно запустить в мастере скрипт обработки только схемы или схемы и данных. | Можно опубликовать схему без данных из Visual Studio напрямую в Azure. Все изменения базы данных применяются на месте, после чего схему и данные можно развернуть или экспортировать. |
| Всегда выполняется развертывание или экспорт всей базы данных. | Можно выполнить миграцию без конкретных объектов. | Полный контроль над объектами, которые включаются в миграцию. |
| Возможность изменять результат на выходе в случае ошибок не предусмотрена. Исходная схема должна быть совместимой. | Редактирование неделимого скрипта может вызывать сложности. При необходимости можно открыть и изменить его в среде SSMS или в Visual Studio с инструментами для работы с базами данных SQL Server. Все ошибки необходимо исправить до развертывания скрипта в Базе данных SQL Azure.| Доступны все возможности инструментов Visual Studio для работы с базами данных SQL Server. Схема изменяется в автономном режиме. |
| Проверка приложений выполняется в Azure. Как правило, она не занимает много времени, так как схема переносится без изменений. | Проверка приложений выполняется в Azure после миграции. Чтобы проверить исходное приложение, скрипт можно также выполнить локально. | Проверку приложений можно выполнить в SQL Server до развертывания базы данных в Azure. |
| Инструмент поддерживается корпорацией Майкрософт. | Инструмент поддерживается сообществом разработчиков и доступен для загрузки с сайта CodePlex. | Инструменты поддерживаются корпорацией Майкрософт. Дополнительно используется инструмент, поддерживаемый сообществом разработчиков и доступный для загрузки с сайта CodePlex. |
| Простой одно- или двухшаговый процесс с минимальными корректировками. | Управление преобразованием схемы, созданием скрипта и развертыванием базы данных в облаке осуществляется с помощью одного удобного мастера. | Более сложный многоэтапный процесс (может быть проще, если требуется развернуть только схему). |


 

<!---HONumber=July15_HO2-->