<properties
   pageTitle="Перенос базы данных в базу данных SQL Azure"
	description="База данных SQL Microsoft Azure, развертывание базы данных, миграция базы данных, импорт базы данных, экспорт базы данных, мастер миграции"
	services="sql-database"
	documentationCenter=""
	authors="carlrabeler"
	manager="jeffreyg"
	editor=""/>

<tags
   ms.service="sql-database"
	ms.devlang="NA"
	ms.topic="article"
	ms.tgt_pltfrm="NA"
	ms.workload="data-management"
	ms.date="08/26/2015"
	ms.author="carlrab"/>

# Перенос базы данных в Базу данных SQL Azure

База данных SQL Azure версии 12 обеспечивает практически полную совместимость на уровне ядра с SQL Server 2014 и более новыми версиями. Таким образом, задача миграции большинства баз данных из локального экземпляра SQL Server 2005 или более новых версий в Базе данных SQL Azure значительно упрощена. В большинстве случаев миграция сводится к простой операции перемещения схемы и данных, не требующей изменения схемы или доработки приложений. Если изменения базы данных все же необходимы, их объем весьма ограничен.

Функции уровня сервера SQL Server не поддерживаются Базой данных SQL Azure версии 12 преднамеренно. Базы данных и приложения, опирающиеся на эти функции, потребуют небольшой доработки перед их миграцией. Несмотря на то что База данных SQL Azure версии 12 лучше совместима с базой данных локального SQL Server, миграцию все равно необходимо тщательно планировать и осторожно запускать, особенно для массивных баз данных со сложной структурой.

## Определение совместимости
Чтобы определить, совместима ли ваша база данных локального SQL Server с Базой данных SQL Azure версии 12, вы можете начать миграцию одним из двух способов, описанных в разделе «Вариант 1» ниже и посмотреть, обнаружит ли несовместимости процедура проверки схемы, либо проверить совместимость с помощью SQL Server Data Tools в Visual Studio, как описано в разделе «Вариант 2». Если ваша база данных локального SQL Server имеет проблемы совместимости, вы можете воспользоваться SQL Server Data Tools в Visual Studio или SQL Server Management Studio, чтобы выявить и устранить проблемы совместимости.

## Способы переноса
Существует несколько методов миграции совместимой базы данных локального SQL Server в Базу данных SQL Azure версии 12.

- Для малых и средних баз данных миграция совместимых баз данных SQL Server 2005 или более поздних версий также проста, как запуск мастера по развертыванию базы данных в Базе данных Microsoft Azure в SQL Server Management Studio, и не имеет проблем с подключением (отсутствием подключения, низкой пропускной способностью или проблем из-за превышения времени ожидания).
- Для средних и больших баз данных или при наличии проблем с подключением вы можете воспользоваться SQL Server Management Studio для экспорта данных и схемы в файл BACPAC (хранящихся локально или в большом двоичном объекте Azure), а затем импортировать файл BACPAC в экземпляр Azure SQL. При хранении BACPAC в большом двоичном объекте Azure вы также можете импортировать файл BACPAC внутри портала Azure.  
- В больших базах данных можно достичь повышения производительности за счет отдельного переноса схемы и данных. Вы можете извлечь схему в проект базы данных с помощью SQL Server Management Studio или Visual Studio, а затем развернуть эту схему, чтобы создать Базу данных SQL Azure. Затем можно извлечь данные с помощью программы BCP и использовать ее для импорта этих данных в Базу данных SQL Azure с помощью параллельных потоков. Процесс миграции крупной сложной базы данных займет большое количество часов независимо от выбранного метода.

### Вариант 1.
******Миграция полностью совместимой базы данных с помощью среды SQL Server Management Studio***

SQL Server Management Studio предоставляет два способа для миграции совместимой базы данных локального SQL Server в Базу данных SQL Azure. Вы можете использовать мастер развертывания базы данных в Базу данных SQL Microsoft Azure или экспортировать базу данных в файл BACPAC, который затем можно импортировать для создания новой Базы данных Azure SQL. Мастер проверяет совместимость Базы данных SQL Azure версии 12, извлекает схему и данные в файл BACPAC, а затем импортирует его в указанный экземпляр Базы данных SQL Azure.

### Вариант 2.
***Автономное обновление схемы базы данных с помощью Visual Studio и последующее развертывание с помощью SQL Server Management Studio***

Если ваша база данных локального SQL Server не поддерживается, либо для определения ее совместимости, вы можете импортировать схему базы данных в проект базы данных Visual Studio для анализа. Для анализа укажите целевую платформу для проекта как Базу данных SQL версии 12, а затем соберите проект. Если построение выполнено успешно, база данных совместима. Если построение завершается неудачей, можно устранить ошибки в SQL Server Data Tools для Visual Studio (SSDT). После успешного построения проекта, вы можете опубликовать его в качестве копии базы данных-источника, а затем использовать функцию сравнения данных в SSDT, чтобы скопировать данные из базы данных-источника в базу данных, совместимую с SQL Azure версии 12. Затем развертывание обновленной базы данных в Базе данных SQL Azure выполняется по плану, описанному в первом варианте. Если требуется перенести только схему, можно опубликовать ее в Базе данных SQL Azure непосредственно из Visual Studio. Этот метод используется, если схема баз данных требует больше изменений, чем может обработать мастер миграции.

## Выбор варианта миграции
- Если вы уверены, что базу данных можно перенести без каких-либо изменений, следует выбрать первый вариант. Если нет, экспортируйте из базы данных только схему в файл BACPAC по плану, описанному в первом варианте. Если экспорт завершится без ошибок, можно использовать первый вариант для миграции базы данных с данными.  
- При возникновении ошибок во время экспорта варианта 1, воспользуйтесь вариантом 2 и автономно исправьте схему базы данных в Visual Studio с помощью мастера миграции и ручного применения изменений схемы. После этого копия исходной базы данных обновляется на месте и переносится в Azure по плану, описанному в первом варианте.

## Инструменты для миграции
Используемые для миграции инструменты включают среду SQL Server Management Studio (SSMS) и инструменты Visual Studio для работы с SQL Server (VS, SSDT), а также портал Azure.

> Всегда устанавливайте последние версии клиентских инструментов, так как более ранние несовместимы с Базой данных SQL Azure версии 12.

### SQL Server Management Studio (SSMS);
Используя среду SSMS, можно развернуть совместимую базу данных непосредственно в Базе данных SQL Azure или экспортировать ее логическую резервную копию в файл BACPAC, а затем импортировать его в новую базу данных SQL Azure.

[Скачайте последнюю версию SSMS](https://msdn.microsoft.com/library/mt238290.aspx)

### Инструменты Visual Studio для работы с SQL Server (VS, SSDT)
С помощью инструментов Visual Studio для работы с SQL Server можно создавать проекты баз данных и управлять ими. Проект при этом представляет собой набор файлов Transact-SQL для каждого объекта в схеме. Проект можно импортировать из базы данных или файла скрипта. Впоследствии его можно оптимизировать для Базы данных SQL Azure версии 12. При компиляции проекта схема будет проверена на совместимость. Чтобы устранить выявленные ошибки, нужно щелкнуть их в списке и соответствующим образом отредактировать открывшиеся файлы Transact-SQL. После исправления всех ошибок вы можете опубликовать проект либо сразу в новой базе данных SQL, либо в исходной базе данных SQL Server или ее копии. В последнем случае схема будет обновлена и базу данных можно будет развернуть со всеми данными с помощью среды SSMS.

Используйте [последнюю версию средств для работы с данными SQL Server для Visual Studio](https://msdn.microsoft.com/library/mt204009.aspx) вместе с Visual Studio 2013 с обновлением 4 или выше.

## Сравнение
| Вариант 1. | Вариант 2. |
| ------------ | ------------ | ------------ |
| Развертывание полностью совместимой базы данных в Базе данных SQL Azure | Обновление базы данных на месте с последующим развертыванием в Базе данных SQL Azure |
|![SSMS](./media/sql-database-cloud-migrate/01SSMSDiagram.png)| ![Изменение в автономном режиме](./media/sql-database-cloud-migrate/03VSSSDTDiagram.png) |
| Используется SSMS | Используется VS и SSMS |
|Простой процесс; схема должна быть совместима. Схема переносится без изменений. | Схема импортируется в проект базы данных Visual Studio. Дополнительные изменения вносятся с помощью SSDT для Visual Studio. Окончательная схема используется для обновления базы данных на месте. |
| Всегда выполняется развертывание или экспорт всей базы данных. | Полный контроль над объектами, которые включаются в миграцию. |
| Возможность изменять результат на выходе в случае ошибок не предусмотрена. Исходная схема должна быть совместимой. | Все доступные возможности SSDT для Visual Studio. Схема изменяется в автономном режиме. | Проверка приложений выполняется в Azure. Как правило, она не занимает много времени, так как схема переносится без изменений. | Проверку приложений можно выполнить в SQL Server до развертывания базы данных в Azure. |
| Простой одно- или двухэтапный процесс с минимальными корректировками. | Более сложный многоэтапный процесс (может быть проще, если требуется развернуть только схему). |

<!---HONumber=August15_HO9-->