<properties 
	pageTitle="Управление базой данных SQL" 
	description="Узнайте, как управлять базой данных SQL Azure." 
	authors="jeffgoll" 
	manager="jeffreyg" 
	editor="" 
	services="sql-database" 
	documentationCenter=""/>

<tags 
	ms.service="sql-database" 
	ms.workload="data-management" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/13/2015" 
	ms.author="jeffreyg"/>


# Управление Базой данных SQL

В этой статье описаны способы выполнения простых задач управления базой данных SQL Azure.

## Практическое руководство. Подключение к базе данных SQL в Azure с помощью среды Management Studio

Среда Management Studio является средством администрирования, которое позволяет управлять несколькими экземплярами SQL Server и серверами в одной рабочей области. Если у вас уже есть локальный экземпляр SQL Server, можно открыть подключение к локальному экземпляру и логическому серверу в Azure для параллельного выполнения задач.

Среда Management Studio включает в себя функции, которые в настоящее время недоступны на портале управления, например проверку синтаксиса и возможность сохранять скрипты и именованные запросы для повторного использования. База данных SQL является просто конечной точкой потока табличных данных (TDS). Для операций с базой данных SQL подходят любые средства, которые работают с TDS, включая среду Management Studio. Скрипты, разрабатываемые для локального сервера, запускаются на логическом сервере базы данных SQL.

На следующем этапе будем использовать среду Management Studio для подключения к логическому серверу в Azure. Чтобы выполнить этот шаг, необходима среда SQL Server Management Studio версии 2008 R2 или 2012. Дополнительную информацию по скачиванию или подключению к Management Studio см. в статье [Управление Базой данных SQL с помощью среды Management Studio][] на этом сайте.

Иногда перед подключением необходимо создать исключение брандмауэра, разрешающее исходящие запросы через порт 1433 в локальной системе. У компьютеров с конфигурацией защиты по умолчанию порт 1433 обычно закрыт.

## Настройка брандмауэра для локального сервера

1. Создайте в брандмауэре Windows в режиме повышенной безопасности новое правило для исходящего трафика.

2. Выберите **Порт**, укажите "TCP 1433", укажите **Разрешить подключение** и убедитесь, что выбран профиль **Открытый**.

3. Укажите понятное имя, например *WindowsAzureSQLDatabase (tcp-out) port 1433*.


## Подключение к логическому серверу

1. Убедитесь, что в области "Подключение к серверу" среды Management Studio выбран "Компонент Database Engine", а затем введите имя логического сервера в следующем формате: *имя_сервера*.database.widnows.net.

	Также можно получить полное имя сервера на портале управления, в панели мониторинга сервера, в области "УПРАВЛЕНИЕ URL-АДРЕСАМИ".

2. В поле "Проверка подлинности" выберите **Проверка подлинности SQL Server**, а затем введите имя входа администратора, созданное при настройке логического сервера.

3. Щелкните по элементу **Параметры**.

4. В поле "Подключение к базе данных" укажите **master**.


## Подключение к локальному серверу

1. Убедитесь, что в области "Подключение к серверу" среды Management Studio выбран "Компонент Database Engine", а затем введите имя локального экземпляра в следующем формате: *имя_сервера*\имя_экземпляра. Если сервер является локальным экземпляром по умолчанию, введите *localhost*.

2. В поле "Проверка подлинности" выберите **Проверка подлинности Windows**, а затем введите учетную запись Windows, которая является членом роли sysadmin.


## Практическое руководство: добавление имен входа и пользователей в Базу данных SQL Azure

После развертывания базы данных необходимо настроить имена входа и назначить разрешения. Далее следует запустить два скрипта.

Для первого скрипта можно подключиться к базе данных "master" и выполнить сценарий, создающий имена входа. Имена входа будут использоваться для поддержки операций чтения и записи, а также для делегирования операционных задач, таких как возможность выполнения запросов системы без разрешений sa.

Создаваемые имена входа должны быть именами входа для проверки подлинности SQL Server. Если имеются уже готовые скрипты, использующие удостоверения пользователей Windows или удостоверения утверждений, этот скрипт не будет работать для базы данных SQL.

Второй скрипт присваивает разрешения пользователей базы данных. Для этого скрипта вы будете подключаться к базе данных, уже загруженной в Azure.

## Создание имен входа

1. В среде Management Studio подключитесь к логическому серверу в Azure, разверните папку "Базы данных", щелкните правой кнопкой мыши по элементу **master** и выберите **Создать запрос**.

2. Для создания имен входа следуйте инструкциям Transact-SQL. Замените пароль на действительный пароль. Выберите каждый из элементов по отдельности, а затем щелкните **Выполнить**. Повторите для остальных имен входа.

<div style="width:auto; height:auto; overflow:auto"><pre>
    -- запускайте на главной базе данных (мастере), выполняйте каждую строку отдельно
    -- используйте это имя входа для управления другими именами на этом сервере
    CREATE LOGIN sqladmin WITH password='&lt;ProvidePassword>'; 
    CREATE USER sqladmin FROM LOGIN sqladmin;
    EXEC sp_addrolemember 'loginmanager', 'sqladmin';

    -- используйте этот логин для создания или копирования базы данных
    CREATE LOGIN sqlops WITH password='&lt;ProvidePassword>';
    CREATE USER sqlops FROM LOGIN sqlops;
    EXEC sp_addrolemember 'dbmanager', 'sqlops';
</pre></div>


## Создание пользователей базы данных

1. Разверните папку "Базы данных", щелкните правой кнопкой мыши по элементу **school** и выберите **Создать запрос**.

2. Для добавления пользователей базы данных следуйте инструкциям Transact-SQL. Замените пароль на действительный пароль.

<div style="width:auto; height:auto; overflow:auto"><pre>
    -- запускайте на обычной базе данных, выполняйте каждую строку отдельно
    -- используйте это имя входа для операций чтения
    CREATE LOGIN sqlreader WITH password='&lt;ProvidePassword>';
    CREATE USER sqlreader FROM LOGIN sqlreader;
    EXEC sp_addrolemember 'db_datareader', 'sqlreader';

    -- используйте это имя входа для операций записи
    CREATE LOGIN sqlwriter WITH password='&lt;ProvidePassword>';
    CREATE USER sqlwriter FROM LOGIN sqlwriter;
    EXEC sp_addrolemember 'db_datawriter', 'sqlwriter';

    -- предоставьте разрешения DMV в базе данных school объекту 'sqlops'
    GRANT VIEW DATABASE STATE to 'sqlops';
</pre></div>

## Представления и тестовые имена входа

1. В окне нового запроса подключитесь к базе данных **master** и далее руководствуйтесь следующей инструкцией: 

        SELECT * from sys.sql_logins;

2. В Management Studio щелкните по базе данных **school** правой кнопкой мыши и выберите пункт **Создать запрос**.

3. В меню "Запрос" выберите пункт **Подключение** и щелкните по элементу **Изменить подключение**.

4. Выполните вход с именем *sqlreader*.

5. Скопируйте и попробуйте запустить следующую инструкцию. Вы должны получить сообщение о том, что объект не существует.

        INSERT INTO dbo.StudentGrade (CourseID, StudentID, Grade)
        VALUES (1061, 30, 9);

6. Откройте второе окно запроса и измените контекст подключения на *sqlwriter*. Теперь этот запрос должен выполняться успешно.

Вы создали и протестировали несколько имен входа. Дополнительные сведения см. в разделах [Управление базами данных и учетными записями в базе данных SQL][] и [Мониторинг базы данных SQL с помощью динамических административных представлений][].

[Управление базами данных и учетными записями в базе данных SQL]: http://msdn.microsoft.com/library/windowsazure/ee336235.aspx
[Мониторинг базы данных SQL с помощью динамических административных представлений]: http://msdn.microsoft.com/library/windowsazure/ff394114.aspx
[Управление Базой данных SQL с помощью среды Management Studio]: http://www.windowsazure.com/develop/net/common-tasks/sql-azure-management/





 

<!---HONumber=July15_HO2-->