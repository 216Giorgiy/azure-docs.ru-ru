<properties
	pageTitle="Использование службы хранилища Azure для резервного копирования и восстановления SQL Server | Microsoft Azure"
	description="Создайте резервную копию сервера SQL Server и базы данных SQL в хранилище Azure. В этой статье описаны преимущества резервного копирования баз данных SQL в хранилище Azure. В ней также рассказывается об обязательных компонентах сервера SQL Server и хранилища Azure."
	services="sql-database, virtual-machines"
	documentationCenter=""
	authors="carlrabeler"
	manager="jeffreyg"
	editor="tysonn"/>

<tags
	ms.service="sql-database"
	ms.workload="data-management"
	ms.tgt_pltfrm="na"
	ms.devlang="vm-windows-sql-server"
	ms.topic="article"
	ms.date="10/20/2015"
	ms.author="carlrab"/>



# Использование хранилища Azure для резервного копирования и восстановления SQL Server

## Обзор

Функция, обеспечивающая возможность записи резервных копий SQL Server в службу хранилища BLOB-объектов Azure, появилась в SQL Server 2012 SP1 CU2. Эта функция позволяет использовать службу BLOB-объектов Azure для резервного копирования и восстановления локальной Базы данных SQL Server или Базы данных SQL Server на виртуальной машине Azure. Резервное копирование в облако обеспечивает следующие преимущества: доступность, неограниченное хранилище вне организации с поддержкой георепликации и простота миграции данных в облако и обратно. Для выполнения операторов BACKUP и RESTORE можно использовать Transact-SQL или SMO.

## Преимущества использования службы BLOB-объектов Azure для резервных копий SQL Server

Управление хранилищами, риск отказа хранилища, доступ к внешнему хранилищу и настройка устройств — вот ряд общих проблем резервного копирования. Для SQL Server, работающего на виртуальной машине Azure, возникают дополнительные сложности, связанные с настройкой и резервным копированием виртуальных жестких дисков, а также с настройкой подключенных дисков. Ниже перечислены некоторые из основных преимуществ использования службы хранилища BLOB-объектов Azure для резервных копий SQL Server:

* Гибкое, надежное и неограниченное внешнее хранилище: хранение резервных копий в службе BLOB-объектов Azure может быть удобным, гибким и доступным вариантом внешнего хранения. Создание внешнего хранилища для резервных копий SQL Server может быть не сложнее изменения существующих сценариев и заданий. Внешнее хранилище обычно должно находиться достаточно далеко от расположения производственной базы данных, чтобы предотвратить возможное одновременное влияние одной аварии на расположение внешней и производственной баз данных. Выбор георепликации хранилища BLOB-объектов обеспечивает дополнительный уровень защиты в случае аварии, которая может повлиять на весь регион. Кроме того, резервные копии оказываются доступны для восстановления отовсюду в любое время.
* Архив резервных копий: служба хранилища BLOB-объектов Azure предлагает лучшую альтернативу частому использованию ленточных накопителей для архивирования резервных копий. Использование ленточного накопителя может потребовать физического переноса на внешние средства и принятия мер для защиты носителей. Хранение резервных копий в хранилище BLOB-объектов Azure предоставляет возможность мгновенного и долговременного архивирования с высокой доступностью.
* Отсутствие накладных расходов на управление оборудованием: при использовании служб Azure отсутствуют накладные расходы на управление оборудованием. Службы Azure управляют оборудованием, обеспечивая при этом георепликацию для избыточности и защиту от сбоев оборудования.
* В настоящее время для экземпляров SQL Server, работающих на виртуальной машине Azure, резервное копирование в службы BLOB-объектов Azure может выполняться путем создания подключенных дисков. Но число дисков, которые можно подключить к виртуальной машине Azure, ограничено. Оно равно 16 для очень крупного экземпляра и меньше этого значения для экземпляров меньшего размера. Использование прямого резервного копирования в хранилище BLOB-объектов Azure позволяет обойти ограничение в 16 дисков.
* Кроме того, файл резервной копии, который теперь хранится в службе хранилища BLOB-объектов Azure, напрямую доступен как на локальном экземпляре SQL Server, так и на другом экземпляре SQL Server, работающем на виртуальной машине Azure, без необходимости подключать и отключать базы данных или загружать и подключать виртуальный жесткий диск.
* Преимущества снижения расходов: платите только за используемые услуги. Может быть экономичным вариантом внешнего архива и архива резервных копий. Дополнительную информацию см. на страницах [Калькулятор стоимости Azure](http://go.microsoft.com/fwlink/?LinkId=277060 "Калькулятор стоимости") и [Цены Azure](http://go.microsoft.com/fwlink/?LinkId=277059 "Цены").

Дополнительные сведения см. в статье [Резервное копирование и восстановление SQL Server с помощью службы хранилища BLOB-объектов Azure](http://go.microsoft.com/fwlink/?LinkId=271617)

В двух следующих разделах представлены службы хранилища BLOB-объектов Azure и компоненты SQL Server, используемые при резервном копировании и восстановлении с помощью службы хранилища BLOB-объектов Azure. При использовании службы хранилища BLOB-объектов Azure для резервного копирования и восстановления важно понимать компоненты и их взаимодействие.

Первым шагом в этом процессе является создание учетной записи Azure. SQL Server использует имя учетной записи хранения Azure и значения ее ключей доступа для проверки подлинности и для записи и чтения BLOB-объектов при взаимодействии со службой хранилища. Эти данные проверки подлинности хранятся в учетных данных SQL Server, которые используются для операций резервного копирования и восстановления.

Полное пошаговое руководство по созданию учетной записи хранения и выполнению простого восстановления см. в статье [Архивация и восстановление SQL Server с помощью службы хранилища BLOB-объектов Microsoft Azure](http://go.microsoft.com/fwlink/?LinkId=271615)

## Компоненты службы хранилища BLOB-объектов Azure

* Учетная запись хранения: учетная запись хранения является отправной точкой для всех служб хранилища. Для доступа к службе хранилища BLOB-объектов Azure необходимо сначала создать учетную запись хранения Azure. Имя учетной записи хранения и свойства ее ключей доступа необходимы для проверки подлинности при взаимодействии со службой хранилища BLOB-объектов Azure и ее компонентами. Дополнительные сведения о службе хранилища больших двоичных объектов Azure см. в разделе [Использование службы хранилища больших двоичных объектов](http://azure.microsoft.com/develop/net/how-to-guides/blob-storage/)

* Контейнер: контейнер обеспечивает группировку набора BLOB-объектов и может хранить неограниченное количество BLOB-объектов. Для записи резервной копии SQL Server в службу BLOB-объектов Azure необходимо создать, по крайней мере, корневой контейнер.

* BLOB-объект. Файл любого типа и размера. Существует два типа BLOB-объектов, которые могут храниться в службе хранилища BLOB-объектов Azure: BLOB-объекты блоков и страниц. Для хранения резервных копий SQL Server используются BLOB-объекты страниц. Для адресации BLOB-объектов используется следующий формат URL-адресов: `https://<storage account>.blob.core.windows.net/<container>/<blob>` Дополнительные сведения о BLOB-объектах см. в разделе [Что такое блочные и страничные BLOB-объекты](http://msdn.microsoft.com/library/azure/ee691964.aspx)

## Компоненты SQL Server

* URL-адрес: URL-адрес определяет универсальный идентификатор ресурса (URI) для уникального файла резервной копии. URL-адрес используется, чтобы предоставить местоположение и имя файла резервной копии SQL Server. В этой реализации единственным допустимым URL-адресом является адрес, указывающий на BLOB-объект страницы в учетной записи хранения Azure. URL-адрес должен указывать на фактический BLOB-объект, а не только на контейнер. Если BLOB-объект не существует, он будет создан. Если указан существующий BLOB-объект, при отсутствии параметра > WITH FORMAT происходит сбой инструкции BACKUP. Ниже приведен пример URL-адреса, который можно указать в команде BACKUP: ****`http[s]://ACCOUNTNAME.Blob.core.windows.net/<CONTAINER>/<FILENAME.bak>`

<b>Примечание.</b> Использование HTTPS не является обязательным, но рекомендуется. <b>Важное примечание.</b> Если нужно скопировать и отправить файл резервной копии в службу хранилища больших двоичных объектов Azure и планируется использовать этот файл для операций восстановления, то в качестве варианта хранилища необходимо использовать страничный BLOB-объект. Восстановление (RESTORE) из BLOB-объекта блочного типа завершится ошибкой.

* Учетные данные: сведения, необходимые для подключения к службе хранилища BLOB-объектов Azure и проверки подлинности, хранятся в виде учетных данных. Чтобы разрешить SQL Server записывать резервные копии как BLOB-объекты Azure или выполнять восстановление из BLOB-объектов, необходимо создать учетные данные SQL Server. В учетных данных хранятся имя учетной записи хранения и ключ доступа к учетной записи хранения. После создания эти учетные данные необходимо указывать в параметре WITH CREDENTIAL инструкций BACKUP и RESTORE. Пошаговые указания для создания учетных данных SQL Server см. в статье [Начало работы со службой хранилища Azure для архивации и восстановления SQL Server](http://go.microsoft.com/fwlink/?LinkId=271615).

## Резервное копирование и восстановление базы данных SQL Server с помощью больших двоичных объектов Azure — основные понятия и задачи

**Основные понятия, вопросы и примеры кода:**

[Резервное копирование и восстановление SQL Server с помощью службы хранилища BLOB-объектов Azure](http://go.microsoft.com/fwlink/?LinkId=271617)

**Учебник по началу работы:**

[Начало работы с резервным копированием и восстановлением SQL Server с использованием службы хранилища BLOB-объектов Azure](http://go.microsoft.com/fwlink/?LinkID=271615 "Учебник")

**Рекомендации и устранение неполадок:**

[Рекомендации по резервному копированию и восстановлению (служба хранилища BLOB-объектов Azure)](http://go.microsoft.com/fwlink/?LinkId=272394)

<!---HONumber=Oct15_HO4-->