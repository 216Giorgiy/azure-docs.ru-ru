---
title: Высокая доступность службы базы данных SQL Azure | Документация Майкрософт
description: Узнайте о возможностях и функциях высокой доступности службы базы данных SQL Azure
services: sql-database
author: jovanpop-msft
manager: craigg
ms.service: sql-database
ms.topic: conceptual
ms.date: 06/20/2018
ms.author: jovanpop
ms.reviewer: carlrab, sashan
ms.openlocfilehash: a9874681d59d193fc3c3d0fd4271e2a6a0fb0dc6
ms.sourcegitcommit: f06925d15cfe1b3872c22497577ea745ca9a4881
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/27/2018
ms.locfileid: "37060389"
---
# <a name="high-availability-and-azure-sql-database"></a>Высокая доступность и база данных SQL Azure

База данных SQL Azure — это высокодоступная служба базы данных, предоставляемая по модели "платформа как услуга", которая гарантирует, что база данных работает в течение 99,99 % времени, позволяя вам не беспокоиться об обслуживании и простое. Этот полностью управляемый процесс ядра СУБД SQL Server, размещенный в облаке Azure, обеспечивает постоянное обновление и исправление базы данных SQL Server без влияния на рабочую нагрузку. Базу данных SQL Azure можно быстро восстановить даже в самых критических обстоятельствах, что гарантирует постоянную доступность ваших данных.

Платформа Azure полностью управляет каждой базой данных SQL Azure и гарантирует высокий процент доступности данных без их потери. Azure автоматически обрабатывает исправления, резервное копирование, репликацию, выявление сбоев, потенциальные сбои основного оборудования, программного обеспечения или сети, исправления ошибок при развертывании, отработку отказа, обновления баз данных и другие задачи обслуживания. Инженеры SQL Server применили лучшие рекомендации, чтобы обеспечить завершение всех операций обслуживания менее чем за 0,01 % времени существования базы данных. Эта архитектура гарантирует, что зафиксированные данные не теряются и что операции по обслуживанию выполняются без влияния на рабочую нагрузку. Периоды обслуживания и простой, из-за которых нужно остановить рабочую нагрузку во время обновления или обслуживания базы данных, отсутствуют. Благодаря встроенной высокой доступности службы "База данных SQL Azure" база данных никогда не будет единой точкой отказа в архитектуре программного обеспечения.

В базе данных SQL Azure применяются две модели обеспечения высокого уровня доступности:

- Модель "Стандартная" или "Общего назначения", которая предоставляет доступность на уровне 99,99 %, но с некоторым потенциальным замедлением во время выполнения операций обслуживания.
- Модель "Премиум" или "Критически важная для бизнеса" также обеспечивает доступность на уровне 99,99 % с минимальным воздействием на производительность рабочей нагрузки даже во время выполнения операций обслуживания.

Azure прозрачно обновляет и исправляет базовую операционную систему, драйверы и ядро СУБД SQL Server с минимальным простоем работы пользователей. База данных SQL Azure работает на базе последней стабильной версии ядра СУБД SQL Server в ОС Windows, и большинство пользователей не заметят непрерывную установку обновлений.

## <a name="standard-availability"></a>Модель стандартного уровня доступности

В стандартной модели реализуется соглашение об уровне обслуживания, гарантирующее доступность 99,99 % времени, применяемое на уровнях "Стандартный", "Базовый" и "Общего назначения". Доступность достигается за счет разделения уровня вычислений и уровня хранения. В стандартной модели доступности есть два уровня:

- Уровень вычислений без отслеживания состояния, на котором выполняется процесс sqlserver.exe и содержатся только временные и кэшированные данные (например, кэш планов, буферный пул, пул хранения столбцов). Этим узлом SQL Server без отслеживания состояния управляет Azure Service Fabric, которая инициализирует процесс, контролирует работоспособность узла и при необходимости выполняет переход на другой ресурс.
- Уровень данных с отслеживанием состояния, где файлы базы данных (MDF/LDF) хранятся на дисках хранилища Azure класса Premium. Хранилище Azure гарантирует, что каждая запись, размещенная в любом файле базы данных, не будет потеряна. Благодаря встроенной доступности и избыточности этого хранилища каждая запись в файле журнала или страница в файле данных будет сохранена даже в случае отказа процесса SQL Server.

Каждый раз, когда ядро СУБД либо операционная система обновляется или в процессе SQL Server обнаруживается критическая проблема, Azure Service Fabric перемещает процесс SQL Server без отслеживания состояния на другой узел вычислений без отслеживания состояния. Это не влияет на данные на уровне хранилища Azure, а файлы данных и журнала присоединяются к только что инициализированному процессу SQL Server. Ожидаемое время отработки отказа может измеряться в секундах. Этот процесс гарантирует доступность на уровне 99,99 %, но он может иметь некоторое воздействие на производительность интенсивной выполняемой рабочей нагрузки из-за времени перехода и того, что новый узел SQL Server запускается с холодным кэшем.

## <a name="premium-availability"></a>Модель доступности "Премиум"

Модель доступности "Премиум" обеспечивается на уровне "Премиум" базы данных SQL Azure. Она предназначена для интенсивных рабочих нагрузок, для которых недопустимо снижение производительности из-за текущих операций обслуживания.

В модели "Премиум" база данных SQL Azure объединяет ресурсы вычисления и хранения в одном узле. Процесс ядра СУБД SQL Server и базовые файлы MDF и LDF размещаются на одном узле с локально подключенным хранилищем SSD, что обеспечивает малую задержку рабочей нагрузки.

Высокий уровень доступности реализуется с помощью стандартных [групп доступности AlwaysOn](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server). Каждая база данных представляет собой кластер узлов баз данных с одной базой данных-источником, доступной для клиентской рабочей нагрузки, и несколькими вторичными процессами, содержащими копии данных. Основной узел постоянно отправляет изменения на дополнительные узлы, чтобы данные были доступны на вторичных репликах в случае сбоя основного узла по любой причине. Отработку отказа выполняет ядро СУБД SQL Server — одна вторичная реплика становится основным узлом, и создается новая вторичная реплика, чтобы обеспечить достаточное количество узлов в кластере. Рабочая нагрузка автоматически перенаправляется на новый основной узел. Время отработки отказа измеряется в миллисекундах, и новый основной экземпляр сразу же может продолжить обслуживание запросов.

## <a name="zone-redundant-configuration-preview"></a>Конфигурация с избыточностью в пределах зоны (предварительная версия)

По умолчанию реплики набора кворума для конфигураций локальных хранилищ создаются в одном центре обработки данных. С введением [зон доступности Azure](../availability-zones/az-overview.md) появилась возможность разместить разные реплики в наборах кворума в разных зонах доступности в одном регионе. Чтобы исключить единую точку сбоя, круг управления также дублируется в нескольких зонах в виде трех кругов шлюзов. Маршрутизацией для конкретного круга шлюза управляет [диспетчер трафика Azure](../traffic-manager/traffic-manager-overview.md) (ATM). Так как конфигурация с избыточностью в пределах зоны не обеспечивает дополнительную избыточность баз данных, использование зон доступности на уровне служб "Премиум" или "Критически важный для бизнеса" (предварительная версия) не требует дополнительных затрат. Выбрав базу данных, избыточную в пределах зоны, можно сделать базы данных уровня "Премиум" или "Критически важный для бизнеса" (предварительная версия) устойчивыми ко множеству сбоев, включая крупные аварии в центрах обработки данных, без изменения логики приложения. Можно также преобразовать любые существующие базы данных или пулы уровня "Премиум" или "Критически важный для бизнеса" (предварительная версия) в конфигурацию с избыточностью в пределах зоны.

Так как наборы кворума с избыточностью в пределах зоны содержат реплики в разных центрах обработки данных, которые удалены на некоторое расстояние друг от друга, задержка сети может увеличить время фиксации и тем самым повлиять на производительность некоторых рабочих нагрузок OLTP. Вы всегда можете вернуться к конфигурации с одной зоной, отключив параметр избыточности в пределах зоны. Это процесс масштаба операции с данными, и он аналогичен регулярному обновлению цели уровня обслуживания (SLO). В конце этого процесса база данных или пул переносится из круга с избыточностью в пределах зоны в круг с одной зоной, или наоборот.

> [!IMPORTANT]
> Базы данных с избыточностью в пределах зоны и эластичными пулами пока поддерживаются только на уровне обслуживания "Премиум". На этапе общедоступной предварительной версии резервные копии и записи аудита хранятся в хранилище RA-GRS, поэтому они могут не оказаться автоматически доступны в случае сбоя всей зоны. 

На следующей схеме показана версия архитектуры с высоким уровнем доступности и избыточностью в пределах зоны.
 
![Архитектура с высоким уровнем доступности и избыточностью в пределах зоны](./media/sql-database-high-availability/high-availability-architecture-zone-redundant.png)

## <a name="read-scale-out"></a>Горизонтальное масштабирование для чтения
Как описано выше, уровни служб "Премиум" и "Критически важный для бизнеса" (предварительная версия) используют наборы кворума и технологию AlwaysOn для обеспечения высокой доступности в однозонных конфигурациях и конфигурациях с избыточностью в пределах зоны. Одним из преимуществ AlwaysOn является то, что реплики всегда находятся в состоянии транзакционной согласованности. Так как реплики имеют тот же уровень производительности, что и источник, приложение может использовать дополнительную производительность для обработки рабочих нагрузок только для чтения без дополнительных затрат (горизонтальное масштабирование для чтения). Таким образом запросы только на чтение изолируются от главных рабочих нагрузок чтения и записи и не влияют на производительность приложения. Функция горизонтального масштабирования для чтения предназначена для приложений, в которые включены такие логические разделенные рабочие нагрузки только для чтения, как аналитика, и поэтому они могут использовать эту дополнительную производительность без подключения к источнику. 

Чтобы использовать масштабирование для чтения с определенной базой данных, его следует явно включить в момент создания базы данных. Эту функцию также можно включить позже путем изменения ее конфигурации с помощью PowerShell, вызвав командлет [Set-AzureRmSqlDatabase](/powershell/module/azurerm.sql/set-azurermsqldatabase) или [New-AzureRmSqlDatabase](/powershell/module/azurerm.sql/new-azurermsqldatabase), или путем использования метода [создания или обновления базы данных](/rest/api/sql/databases/createorupdate) в REST API Azure Resource Manager.

Когда для базы данных будет включена функция горизонтального масштабирования для чтения, приложения, которые подключаются к ней, будут перенаправлены к реплике для чтения и записи или к реплике только для чтения текущей базы данных в соответствии со свойством `ApplicationIntent`, настроенным в строке подключения приложения. Дополнительные сведения о свойстве `ApplicationIntent` см. в разделе об [указании назначения приложения](https://docs.microsoft.com/sql/relational-databases/native-client/features/sql-server-native-client-support-for-high-availability-disaster-recovery#specifying-application-intent). 

Если масштабирование для чтения отключено или установлено свойство ReadScale на уровне служб, который не поддерживается, то все подключения направляются к реплике для чтения и записи независимо от свойства `ApplicationIntent`.  

> [!NOTE]
> Можно активировать масштабирование для чтения для базы данных уровня "Стандартный" или "Общего назначения", хотя это не приведет к перенаправлению сеанса только для чтения к отдельной реплике. Это делается для поддержки существующих приложений, масштаб которых меняется между уровнями "Стандартный" или "Общего назначения" и "Премиум" или "Критически важный для бизнеса".  

Функция горизонтального масштабирования для чтения поддерживает согласованность на уровне сеанса. Если сеанс только для чтения будет повторно подключаться после ошибки соединения, которая была вызвана недоступностью реплики, он может быть перенаправлен в другую реплику. Хотя это маловероятно, но это может привести к обработке устаревшего набора данных. Аналогичным образом, если приложение записывает данные с помощью сеанса чтения и записи и сразу же считывает их с помощью сеанса только для чтения, возможно, что новые данные не будут отображены немедленно.

## <a name="conclusion"></a>Заключение
База данных SQL Azure тесно интегрирована с платформой Azure и в значительной мере зависит от Service Fabric для обнаружения сбоев и восстановления данных, а также от больших двоичных объектов службы хранилища Azure для защиты данных и от зон доступности для повышения отказоустойчивости. В то же время база данных SQL Azure использует все возможности технологии группы доступности AlwaysOn из готового продукта SQL Server для репликации и отработки отказа. Сочетание этих технологий позволяет приложениям полностью реализовать преимущества смешанной модели хранения и поддерживать самые требовательные Соглашения об уровне обслуживания. 

## <a name="next-steps"></a>Дополнительная информация

- Узнайте больше о [зонах доступности Azure](../availability-zones/az-overview.md).
- Дополнительные сведения о [Service Fabric](../service-fabric/service-fabric-overview.md).
- Дополнительные сведения о [диспетчере трафика Azure](../traffic-manager/traffic-manager-overview.md). 
