---
title: Высокая доступность службы базы данных SQL Azure | Документация Майкрософт
description: Узнайте о возможностях и функциях высокой доступности службы базы данных SQL Azure
services: sql-database
ms.service: sql-database
ms.subservice: ''
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: jovanpop-msft
ms.author: jovanpop
ms.reviewer: carlrab, sashan
manager: craigg
ms.date: 01/25/2019
ms.openlocfilehash: ce232332413a0b859b82ebfa7bd5b3505bd923bb
ms.sourcegitcommit: 698a3d3c7e0cc48f784a7e8f081928888712f34b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2019
ms.locfileid: "55453133"
---
# <a name="high-availability-and-azure-sql-database"></a>Высокая доступность и база данных SQL Azure

База данных SQL Azure — это высокодоступная служба базы данных, предоставляемая по модели "платформа как услуга", которая гарантирует, что база данных работает в течение 99,99 % времени, позволяя вам не беспокоиться об обслуживании и простое. Этот полностью управляемый процесс ядра СУБД SQL Server, размещенный в облаке Azure, обеспечивает постоянное обновление и исправление базы данных SQL Server без влияния на рабочую нагрузку. Когда на экземпляр устанавливаются исправления или для него выполняется отработка отказа, время простоя, как правило, не заметно, если в приложении [применяется логика повтора](sql-database-develop-overview.md#resiliency). Если время выполнения отработки отказа превышает 60 секунд, следует обратиться в службу поддержки. Базу данных SQL Azure можно быстро восстановить даже в самых критических обстоятельствах, что гарантирует постоянную доступность ваших данных.

Платформа Azure полностью управляет каждой базой данных SQL Azure и гарантирует высокий процент доступности данных без их потери. Azure автоматически обрабатывает исправления, резервное копирование, репликацию, выявление сбоев, потенциальные сбои основного оборудования, программного обеспечения или сети, исправления ошибок при развертывании, отработку отказа, обновления баз данных и другие задачи обслуживания. Инженеры SQL Server применили лучшие рекомендации, чтобы обеспечить завершение всех операций обслуживания менее чем за 0,01 % времени существования базы данных. Эта архитектура гарантирует, что зафиксированные данные не теряются и что операции по обслуживанию выполняются без влияния на рабочую нагрузку. Периоды обслуживания и простой, из-за которых нужно остановить рабочую нагрузку во время обновления или обслуживания базы данных, отсутствуют. Благодаря встроенной высокой доступности службы "База данных SQL Azure" база данных никогда не будет единой точкой отказа в архитектуре программного обеспечения.

База данных SQL Azure основана на архитектуре ядра СУБД SQL Server, которая соответствует облачной среде, чтобы даже в случае сбоя инфраструктуры обеспечить доступность на уровне 99,99 %. В базе данных SQL Azure применяются две архитектурные модели обеспечения высокого уровня доступности (обе обеспечивают доступность на уровне 99,99 %):

- Модель уровня служб "Стандартный" или "Общего назначения", которая предусматривает разделение ресурсов вычисления и хранения. Эта архитектурная модель обеспечивает высокодоступность и надежность уровня хранилища, но может иметь некоторое потенциальное снижение производительности во время операций обслуживания.
- Модель уровня служб "Премиум" или "Критически важный для бизнеса", которая основана на кластере процессов ядра СУБД. Эта модель полагается на тот факт, что всегда есть кворум доступных узлов ядра СУБД, и она имеет минимальное влияние на производительность рабочей нагрузки даже во время обслуживания.

Azure прозрачно обновляет и исправляет базовую операционную систему, драйверы и ядро СУБД SQL Server с минимальным простоем работы пользователей. База данных SQL Azure работает на базе последней стабильной версии ядра СУБД SQL Server в ОС Windows, и большинство пользователей не заметят непрерывную установку обновлений.

## <a name="basic-standard-and-general-purpose-service-tier-availability"></a>Доступность уровня служб для ценовых категорий "Базовый", "Стандартный" и "Общего назначения"

Доступность ценовой категории "Стандартный" регулируется соглашением об уровне обслуживания, гарантирующим доступность 99,99 % времени, применяемым для уровней служб ценовых категорий "Стандартный", "Базовый" и "Общего назначения". Высокодоступность в этой архитектурной модели достигается за счет разделения уровня вычислений и хранения, а также репликации данных на уровне хранилища.

На следующем рисунке показано четыре узла в стандартной архитектурной модели с разделенными уровнями вычислений и хранения.

![Разделение уровней вычисления и хранения](media/sql-database-managed-instance/general-purpose-service-tier.png)

В стандартной модели доступности есть два уровня:

- Уровень вычислений без отслеживания состояния, на котором выполняется процесс `sqlserver.exe` и содержатся только временные и кэшированные данные (например, кэш планов, буферный пул, пул хранения столбцов). Этим узлом SQL Server без отслеживания состояния управляет Azure Service Fabric, которая инициализирует процесс, контролирует работоспособность узла и при необходимости выполняет переход на другой ресурс.
- Уровень данных с отслеживанием состояния, где файлы базы данных (MDF/LDF) хранятся в хранилище Azure класса Premium. Хранилище Azure гарантирует, что каждая запись, размещенная в любом файле базы данных, не будет потеряна. Благодаря встроенной доступности и избыточности этого хранилища каждая запись в файле журнала или страница в файле данных будет сохранена даже в случае отказа процесса SQL Server.

Каждый раз, когда ядро СУБД или операционная система обновляется, некоторые компоненты базовой инфраструктуры завершаются сбоем или в процессе SQL Server обнаруживается критическая проблема, Azure Service Fabric перемещает процесс SQL Server на другой узел вычислений без отслеживания состояния. Существует набор резервных узлов, на которых можно выполнить новую службу вычислений в случае отработки отказа, чтобы свести к минимуму время отработки отказа. Это не влияет на данные на уровне хранилища Azure, а файлы данных и журнала присоединяются к только что инициализированному процессу SQL Server. Этот процесс гарантирует доступность на уровне 99,99 %, но он может иметь некоторое воздействие на производительность интенсивной выполняемой рабочей нагрузки из-за времени перехода и того, что новый узел SQL Server запускается с холодным кэшем.

## <a name="premium-and-business-critical-service-tier-availability"></a>Доступность уровня служб ценовых категорий "Премиум" и "Критически важный для бизнеса"

Доступность ценовой категории"Премиум" обеспечивается на уровне служб ценовых категорий "Премиум" и "Критически важный для бизнеса" Базы данных SQL Azure. Она предназначена для интенсивных рабочих нагрузок, для которых недопустимо снижение производительности из-за текущих операций обслуживания.

В модели "Премиум" база данных SQL Azure объединяет ресурсы вычисления и хранения в одном узле. Высокий уровень доступности в этой архитектурной модели достигается за счет репликации вычислений (процесс ядра СУБД SQL Server) и хранения (локально подключенный диск SSD), развернутых в 4-узловом кластере, использующего технологию, аналогичную [группам доступности AlwaysOn](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) SQL Server.

![Кластер узлов ядра СУБД](media/sql-database-managed-instance/business-critical-service-tier.png)

Процесс ядра СУБД SQL и базовые MDF- и LDF-файлы размещаются на одном узле с локально подключенным хранилищем SSD, что обеспечивает малую задержку рабочей нагрузки. Высокий уровень доступности реализуется с помощью технологии, аналогичной [группам доступности AlwaysOn](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) SQL Server Каждая база данных представляет собой кластер узлов баз данных с одной базой данных-источником, доступной для клиентской рабочей нагрузки, и тремя вторичными процессами, содержащими копии данных. Основной узел постоянно отправляет изменения на дополнительные узлы, чтобы данные были доступны на вторичных репликах в случае сбоя основного узла по любой причине. Отработку отказа выполняет Azure Service Fabric — одна вторичная реплика становится основным узлом, и создается вторичная реплика, чтобы обеспечить достаточное количество узлов в кластере. Рабочая нагрузка автоматически перенаправляется на новый основной узел.

Кроме того, в кластер ценовой категории "Критически важный для бизнеса" встроена возможность [масштабирования для чтения](sql-database-read-scale-out.md), предоставляющая встроенный бесплатный узел только для чтения, который может использоваться для выполнения запросов только на чтение (например, чтение отчетов), которые не должен влиять на производительность основной рабочей нагрузки.

## <a name="zone-redundant-configuration"></a>Конфигурация с избыточностью в пределах зоны

По умолчанию реплики набора кворума для конфигураций локальных хранилищ создаются в одном центре обработки данных. С введением [зон доступности Azure](../availability-zones/az-overview.md) появилась возможность разместить разные реплики в наборах кворума в разных зонах доступности в одном регионе. Чтобы исключить единую точку сбоя, круг управления также дублируется в нескольких зонах в виде трех кругов шлюзов. Маршрутизацией для конкретного круга шлюза управляет [диспетчер трафика Azure](../traffic-manager/traffic-manager-overview.md) (ATM). Так как конфигурация с избыточностью в пределах зоны не обеспечивает дополнительную избыточность баз данных, использование зон доступности на уровне служб ценовых категорий "Премиум" или "Критически важный для бизнеса" не требует дополнительных затрат. Выбрав базу данных, избыточную в пределах зоны, можно сделать базы данных уровня "Премиум" или "Критически важный для бизнеса" устойчивыми ко множеству сбоев, включая крупные аварии в центрах обработки данных, без изменения логики приложения. Можно также преобразовать любые существующие базы данных или пулы уровня "Премиум" или "Критически важный для бизнеса" в конфигурацию с избыточностью в пределах зоны.

Так как наборы кворума с избыточностью в пределах зоны содержат реплики в разных центрах обработки данных, которые удалены на некоторое расстояние друг от друга, задержка сети может увеличить время фиксации и тем самым повлиять на производительность некоторых рабочих нагрузок OLTP. Вы всегда можете вернуться к конфигурации с одной зоной, отключив параметр избыточности в пределах зоны. Это процесс масштаба операции с данными, и он аналогичен регулярному обновлению уровня служб. В конце этого процесса база данных или пул переносится из круга с избыточностью в пределах зоны в круг с одной зоной, или наоборот.

> [!IMPORTANT]
> Базы данных с избыточностью в пределах зоны и эластичными пулами пока поддерживаются только на уровне обслуживания "Премиум". По умолчанию резервные копии и записи аудита хранятся в хранилище RA-GRS, поэтому они могут не оказаться автоматически доступны в случае сбоя всей зоны. 

На следующей схеме показана версия архитектуры с высоким уровнем доступности и избыточностью в пределах зоны.

![Архитектура с высоким уровнем доступности и избыточностью в пределах зоны](./media/sql-database-high-availability/high-availability-architecture-zone-redundant.png)

## <a name="accelerated-database-recovery-adr"></a>Ускоренное восстановление базы данных (ADR)

[Ускоренное восстановление базы данных (ADR)](sql-database-accelerated-database-recovery.md) — это новая функция ядра СУБД SQL, которая значительно повышает доступность базы данных, особенно при наличии длительных транзакций, путем изменения процесса восстановления ядра СУБД SQL. В настоящее время функция ADR доступна для отдельных баз данных, эластичных пулов и Хранилища данных SQL Azure.

## <a name="conclusion"></a>Заключение

База данных SQL Azure тесно интегрирована с платформой Azure и в значительной мере зависит от Service Fabric для обнаружения сбоев и восстановления данных, а также от больших двоичных объектов службы хранилища Azure для защиты данных и от зон доступности для повышения отказоустойчивости. В то же время база данных SQL Azure использует все возможности технологии группы доступности AlwaysOn из готового продукта SQL Server для репликации и отработки отказа. Сочетание этих технологий позволяет приложениям полностью реализовать преимущества смешанной модели хранения и поддерживать самые требовательные Соглашения об уровне обслуживания.

## <a name="next-steps"></a>Дополнительная информация

- Узнайте больше о [зонах доступности Azure](../availability-zones/az-overview.md).
- Дополнительные сведения о [Service Fabric](../service-fabric/service-fabric-overview.md).
- Дополнительные сведения о [диспетчере трафика Azure](../traffic-manager/traffic-manager-overview.md).
- Чтобы изучить дополнительные возможности обеспечения высокой доступности и аварийного восстановления, ознакомьтесь с [непрерывностью бизнес-процессов](sql-database-business-continuity.md).
