---
title: "Проектирование первой базы данных SQL Azure | Документация Майкрософт"
description: "Проектирование первой базы данных SQL Azure."
services: sql-database
documentationcenter: 
author: janeng
manager: jstrauss
editor: 
tags: 
ms.assetid: 
ms.service: sql-database
ms.custom: tutorial
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: 
ms.date: 03/23/2017
ms.author: janeng
translationtype: Human Translation
ms.sourcegitcommit: 07635b0eb4650f0c30898ea1600697dacb33477c
ms.openlocfilehash: 313bcf4fbc0ab7f251dd62b1e2151afef8392a55
ms.lasthandoff: 03/28/2017


---

# <a name="design-your-first-azure-sql-database"></a>Проектирование первой базы данных SQL Azure

В этом руководстве с помощью портала Azure вы создадите на новом сервере базу данных, защищенную брандмауэром на уровне сервера. Затем вы с помощью SQL Server Management Studio создадите таблицу, загрузите в нее данные, выполните запрос к таблице и создадите индекс. И наконец, вы примените автоматически созданные резервные копии службы базы данных SQL, чтобы восстановить базу данных до точки во времени, когда новая таблица не была добавлена.

Для работы с этим руководством у вас должна быть установлена последняя версия [SQL Server Management Studio](https://msdn.microsoft.com/library/ms174173.aspx) (среда SSMS). 

## <a name="step-1---log-in-to-the-azure-portal"></a>Шаг 1. Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com/).

## <a name="step-2---create-a-sql-database"></a>Шаг 2. Создание базы данных SQL

База данных Azure SQL создается с определенным набором [вычислительных ресурсов и ресурсов хранения](sql-database-service-tiers.md). База данных создается в пределах [группы ресурсов Azure](../azure-resource-manager/resource-group-overview.md) и [логического сервера базы данных SQL Azure](sql-database-features.md). 

Выполните следующие действия, чтобы создать базу данных SQL, содержащую образец данных Adventure Works LT. 

1. Щелкните **Создать** в верхнем левом углу портала Azure.

2. Выберите **Базы данных** на странице **создания** и щелкните **База данных SQL** на странице **Базы данных**.

3. Внесите в форму базы данных SQL необходимые сведения: 
   - Имя базы данных. Укажите имя базы данных.
   - Подписка. Выберите подписку.
   - Группа ресурсов. Выберите новую или существующую.
   - Источник. Выберите **Пример (AdventureWorksLT)**.
   - Сервер. Создайте новый сервер (имя **сервера** должно быть глобально уникальным).
   - Эластичный пул. В этом случае выберите **Не сейчас**.
   - Ценовая категория. Выберите **20 DTU** и хранилище объемом **250** ГБ.
   - Сортировка. Это значение нельзя изменить при импорте образца базы данных. 
   - Установите флажок "Закрепить на панели мониторинга".

      ![создание базы данных](./media/sql-database-get-started/create-database-s1.png)

4. По завершении нажмите кнопку **Создать**. Подготовка занимает несколько минут.
5. После завершения развертывания базы данных SQL выберите **Базы данных SQL** на панели мониторинга или в меню слева и щелкните новую базу данных на странице **Базы данных SQL**.**** Откроется страница с общими сведениями о базе данных, где будет указано полное имя сервера (например, **mynewserver20170313.database.windows.net**) и предоставлены настойки для дальнейшей конфигурации.

      ![new-sql database](./media/sql-database-get-started/new-database-s1-overview.png) 

## <a name="step-3---create-a-server-level-firewall-rule"></a>Шаг 3. Создание правила брандмауэра на уровне сервера

Служба базы данных SQL создает брандмауэр, который препятствует подключению внешних приложений и средств к серверу и базе данных. Выполните следующие действия, чтобы создать [правило брандмауэра уровня сервера базы данных SQL](sql-database-firewall-configure.md) для IP-адреса, чтобы разрешить внешнее подключение через брандмауэр базы данных SQL. 

1. Щелкните **Настройка брандмауэра для сервера** на панели инструментов базы данных. Откроется страница **параметров брандмауэра** для сервера базы данных SQL. 

      ![правило брандмауэра для сервера](./media/sql-database-get-started/server-firewall-rule.png) 

2. Нажмите кнопку **Добавить IP-адрес клиента** на панели инструментов, а затем щелкните **Сохранить**. Для текущего IP-адреса будет создано правило брандмауэра уровня сервера.

3. Щелкните **ОК** и нажмите кнопку **X**, чтобы закрыть диалоговое окно параметров брандмауэра.

Теперь можно подключиться к базе данных и ее серверу с помощью SQL Server Management Studio или другого средства по своему усмотрению.

## <a name="step-4---get-connection-information"></a>Шаг 4. Получение сведений о подключении

Получите полное имя сервера для сервера базы данных SQL Azure на портале Azure. Используйте полное имя сервера, чтобы подключиться к серверу с помощью SQL Server Management Studio.

1. Войдите на [портал Azure](https://portal.azure.com/).
2. В меню слева выберите **Базы данных SQL** и на странице **Базы данных SQL** щелкните имя своей базы данных. 
3. На странице портала Azure вашей базы данных в области **Основные компоненты** найдите и скопируйте **имя сервера**.

    <img src="./media/sql-database-connect-query-ssms/connection-information.png" alt="connection information" style="width: 780px;" />

## <a name="step-5---connect-to-the-server-using-ssms"></a>Шаг 5. Подключение к серверу с помощью SSMS

Используйте SQL Server Management Studio для подключения к серверу базы данных SQL Azure.

1. Введите **SSMS** в поле поиска Windows и нажмите клавишу **ВВОД**, чтобы открыть SSMS.

2. В диалоговом окне **Подключение к серверу** введите следующие значения.
   - **Тип сервера** — укажите ядро СУБД.
   - **Имя сервера** — введите полное имя сервера, например **mynewserver20170313.database.windows.net**.
   - **Проверка подлинности** — укажите проверку подлинности SQL Server.
   - **Имя входа** — введите учетную запись администратора сервера.
   - **Пароль** — введите пароль учетной записи администратора сервера.
 
    <img src="./media/sql-database-connect-query-ssms/connect.png" alt="connect to server" style="width: 780px;" />

3. Щелкните **Подключить**. Откроется окно обозревателя объектов в SSMS. 

    <img src="./media/sql-database-connect-query-ssms/connected.png" alt="connected to server" style="width: 780px;" />

4. В обозревателе объектов разверните **базы данных**, затем выберите **mySampleDatabase**, чтобы просмотреть объекты в образце базы данных.

## <a name="step-6---create-and-query-a-table"></a>Шаг 6. Создание таблицы и запрос к ней 
1. В обозревателе объектов щелкните правой кнопкой мыши **mySampleDatabase** и выберите пункт **Новый запрос**. Откроется пустое окно запроса, подключенное к базе данных.
2. В окне запроса выполните такой запрос:

   ```sql 
   CREATE TABLE [dbo].[Students]
   (
     [student_id] int, 
     [name] varchar(100),
     [age] int,
     [email] varchar(100),
     [AddressID] int REFERENCES [SalesLT].[Address] (AddressID)
   );
   ```

   Этот запрос создает пустую таблицу в базе данных с именем "Students".

3. В окне запроса SSMS выполните такой запрос: 

   ```sql
   SELECT name, age, email 
   FROM [dbo].[Students]
   ```

   Таблица "Students" не возвращает никаких данных.

## <a name="step-7---load-data-into-the-table"></a>Шаг 7. Загрузка данных в таблицу 
1. Откройте окно командной строки.

2. Выполните следующую команду PowerShell, чтобы загрузить пример текстового файла в текущий каталог.

   ```powershell
   powershell -command "& { (New-Object Net.WebClient).DownloadFile('https://sqldbtutorial.blob.core.windows.net/tutorials/SampleStudentData.txt', 'SampleStudentData.txt'); echo 'Download complete' }" 
   ``` 

3. Когда эта операция завершится, выполните следующую команду, которая вставляет 1000 строк в таблицу "Students". Не забудьте указать значения **ServerName**, **DatabaseName**, **UserName** и **Password**, соответствующие вашей среде.

   ```bcp
   bcp Students in SampleStudentData.txt -S <ServerName> -d <DatabaseName> -U <Username> -P <password> -q -c -t ","
   ```

Итак, вы загрузили образец данных в созданную ранее таблицу.

## <a name="step-8---add-an-index-to-a-table"></a>Шаг 8. Добавление индекса для таблицы
Чтобы поиск определенного значения выполнялся более эффективно, создайте индекс для таблицы "Students". Этот индекс упорядочивает информацию так, чтобы для поиска определенного значения не приходилось просматривать все данные.

1. В окне запроса SSMS выполните такой запрос:

   ```sql 
   CREATE NONCLUSTERED INDEX IX_Age ON Students (age);
   ```

2. В окне запроса SSMS выполните такой запрос:

   ```sql
   SELECT name, age, email 
   FROM [dbo].[Students]
   WHERE age > 20
   ```

   Этот запрос возвращает имя, возраст и адрес электронной почты для всех студентов, которым уже исполнилось 20 лет.

## <a name="step-9---restore-a-database-to-a-point-in-time"></a>Шаг 9. Восстановление базы данных до точки во времени 
Для баз данных в Azure применяется [непрерывное резервное копирование](sql-database-automated-backups.md), которое автоматически создает копии каждые 5–10 минут. Эти резервные копии позволяют восстановить базу данных до предыдущей точки во времени. Восстановление базы данных до точки во времени создает копию базы данных на том же сервере, где расположена исходная база данных, с состоянием на момент указанной точки во времени (в пределах срока хранения, установленного для вашего уровня обслуживания). Следующие шаги позволяют восстановить базу данных до точки во времени, когда была создана таблица **Students**. 

1. На странице "База данных SQL" на панели инструментов щелкните **Восстановить**. Откроется страница **Восстановление**.

    <img src="./media/sql-database-design-first-database/restore.png" alt="restore" style="width: 780px;" />

2. Заполните форму **Восстановление**, указав следующие сведения.
    * Имя базы данных. Укажите имя базы данных. 
    * Момент времени. Выберите вкладку **Момент времени** в форме восстановления. 
    * Точка восстановления. Выберите время до того момента, когда была изменена база данных.
    * Целевой сервер. Это значение нельзя изменить при восстановлении базы данных. 
    * Пул эластичных баз данных. Выберите вариант **Нет**.  
    * Ценовая категория. Выберите **20 DTU** и хранилище объемом **250 ГБ**.

    <img src="./media/sql-database-design-first-database/restore-point.png" alt="restore-point" style="width: 780px;" />

3. Щелкните **OK**, чтобы восстановить базу данных на момент времени до создания таблицы *Students*.

## <a name="next-steps"></a>Дальнейшие действия 
Примеры PowerShell для выполнения стандартных задач см. в статье [ Примеры Azure PowerShell для базы данных SQL Azure](sql-database-powershell-samples.md).

