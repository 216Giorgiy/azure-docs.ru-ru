---
title: "Синхронизация данных (предварительная версия) | Документация Майкрософт"
description: "В этом обзоре представлена синхронизация данных SQL Azure (предварительная версия)."
services: sql-database
documentationcenter: 
author: douglaslms
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: load & move data
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: douglasl
ms.openlocfilehash: ed2266004e60843749233f92c8f4b069e4c17ba5
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="sync-data-across-multiple-cloud-and-on-premises-databases-with-sql-data-sync"></a>Синхронизация данных в нескольких облачных и локальных базах данных с помощью синхронизации данных SQL

Синхронизация данных SQL — это служба, созданная на основе базы данных SQL Azure, которая позволяет в двунаправленном режиме синхронизировать выбранные данные в нескольких базах данных SQL и экземплярах SQL Server.

В основе синхронизации данных лежит понятие группы синхронизации. Группа синхронизации — это группа баз данных, которые требуется синхронизировать.

Группа синхронизации имеет следующие свойства.

-   **Схема синхронизации**: описывает, какие данные синхронизируются.

-   **Направление синхронизации**: синхронизация может быть двунаправленной или выполняться в одном направлении. То есть синхронизация может выполняться *из центральной базы данных в член*, *из члена в центральную базу данных* или в обоих этих направлениях.

-   **Интервал синхронизации**: определяет, как часто выполняется синхронизация.

-   **Политика устранения конфликтов** — это политика уровня группы, которая может задавать режим *Выигрывает концентратор* или *Member wins* (Выигрывает член).

Служба синхронизации данных использует звездообразную топологию для синхронизации данных. Одну из баз данных в группе необходимо определить как центральную базу данных. Остальные базы данных являются рядовыми базами данных. Синхронизация происходит только между центральной базой данных и отдельными членами.
-   **Центральной базой данных** должна быть база данных SQL Azure.
-   **Рядовыми базами данных** могут быть базы данных SQL, локальные базы данных SQL Server или экземпляры SQL Server на виртуальных машинах Azure.
-   **База данных синхронизации** содержит метаданные и журнал синхронизации данных. Базой данных синхронизации должна быть база данных SQL Azure, которая находится в том же регионе, что и центральная база данных. База данных синхронизации создается клиентом и принадлежит ему.

> [!NOTE]
> Если вы используете локальную базу данных, необходимо [настроить локальный агент](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-get-started-sql-data-sync).

![Синхронизация данных между базами данных](media/sql-database-sync-data/sync-data-overview.png)

## <a name="when-to-use-data-sync"></a>Когда следует использовать синхронизацию данных

Использовать синхронизацию данных удобно в случаях, когда требуется обеспечить актуальное состояние данных в нескольких базах данных SQL Azure или базах данных SQL Server. Ниже приведены основных варианты использования синхронизации данных.

-   **Гибридная синхронизация данных.** Можно обеспечить синхронизацию данных между локальными базами данных и базами данных SQL Azure, чтобы включить гибридные приложения. Эта возможность может привлечь клиентов, которые рассматривают переход в облако и собираются поместить некоторые из своих приложений в Azure.

-   **Распределенные приложения**. Во многих случаях полезно разделить разные рабочие нагрузки на разные базы данных. Например, если у вас есть большая рабочая база данных, но необходимо также выполнять рабочую нагрузку для составления отчетов и анализа этих данных, удобно иметь вторую базу данных для этих целей. Такой подход сводит к минимуму влияние на производительность производственной рабочей нагрузки. Чтобы синхронизировать эти две базы данных, можно использовать службу синхронизации данных.

-   **Глобально распределенные приложения**. Многие организации охватывают несколько регионов и даже несколько стран. Чтобы свести к минимуму задержки в сети, рекомендуется хранить свои данные в регионе, ближайшем к вам. Используя синхронизацию данных, можно легко обеспечить синхронизацию баз данных в регионах по всему миру.

Мы не рекомендуем использовать синхронизацию данных в следующих сценариях:

-   Аварийное восстановление

-   масштаб чтения;

-   ETL (OLTP в OLAP);

-   перенос из локальной базы данных SQL Server в базу данных SQL Azure.

## <a name="how-does-data-sync-work"></a>Как работает синхронизация данных? 

-   **Отслеживание изменения данных**. Служба синхронизации данных отслеживают изменения при помощи триггеров вставки, обновления и удаления. Изменения записываются во вспомогательную таблицу в пользовательской базе данных.

-   **Синхронизация данных**. Служба синхронизации данных разработана на основе звездообразной модели. Центральная база данных синхронизируется с каждым членом по отдельности. Изменения в центральной базе данных передаются в член, после чего изменения из члена передаются в центральную базу данных.

-   **Устранение конфликтов**. Служба синхронизации данных предоставляет два параметра для устранения конфликтов, *Выигрывает концентратор* и *Member wins* (Выигрывает член).
    -   Если выбран параметр *Выигрывает концентратор*, то изменения в центральной базе данных всегда записываются поверх изменений в члене.
    -   Если выбран параметр *Member wins* (Выигрывает член), то изменения в члене всегда записываются поверх изменений в центральной базе данных. Если имеется несколько членов, то конечное значение зависит от того, какой член синхронизируется первым.

## <a name="limitations-and-considerations"></a>Ограничения и рекомендации

### <a name="performance-impact"></a>Влияние на производительность
Служба синхронизация данных использует триггеры вставки, обновления и удаления для отслеживания изменений. Она создает вспомогательные таблицы в пользовательской базе данных для отслеживания изменений. Действия по отслеживанию изменений оказывают влияние на рабочую нагрузку базы данных. Оцените текущий уровень служб и повысьте его, если потребуется.

### <a name="eventual-consistency"></a>Итоговая согласованность
Так как синхронизация данных основана на триггерах, транзакционная согласованность не гарантируется. Корпорация Майкрософт гарантирует, что все изменения будут внесены в конечном счете и что синхронизация данных не приведет к потере данных.

### <a name="unsupported-data-types"></a>Неподдерживаемые типы данных

-   FileStream;

-   UDT SQL или CLR;

-   XMLSchemaCollection (поддерживается XML);

-   Cursor, Timestamp, Hierarchyid.

### <a name="requirements"></a>Требования

-   Каждая таблица должна иметь первичный ключ. Не изменяйте значение первичного ключа ни в какой строке. Если это необходимо сделать, удалите строку и создайте ее повторно с новым значением первичного ключа. 

-   В таблице не должно быть столбцов идентификаторов, которые не являются первичным ключом.

-   Имена объектов (баз данных, таблиц и столбцов) не могут содержать печатаемые символы: точку (.), левую квадратную скобку ([) или правую квадратную скобку (]).

-   Необходимо включить изоляцию моментального снимка. Дополнительные сведения см. в статье [Изоляция моментального снимка в SQL Server](https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql/snapshot-isolation-in-sql-server).

### <a name="limitations-on-service-and-database-dimensions"></a>Ограничения характеристик служб и баз данных

|                                                                 |                        |                             |
|-----------------------------------------------------------------|------------------------|-----------------------------|
| **Характеристики**                                                      | **Ограничение**              | **Возможное решение**              |
| Максимальное количество групп синхронизации, которым может принадлежать любая база данных       | 5                      |                             |
| Максимальное количество конечных точек в отдельной группе синхронизации              | 30                     | Создайте несколько групп синхронизации. |
| Максимальное количество локальных конечных точек в отдельной группе синхронизации | 5                      | Создайте несколько групп синхронизации. |
| Имена баз данных, таблиц, схем и столбцов                       | Имя может содержать до 50 знаков. |                             |
| Таблицы в группе синхронизации                                          | 500                    | Создайте несколько групп синхронизации. |
| Столбцы в таблице в группе синхронизации                              | 1000                   |                             |
| Размер строки данных в таблице                                        | 24 МБ                  |                             |
| Минимальный интервал синхронизации                                           | 5 мин              |                             |

## <a name="common-questions"></a>Часто задаваемые вопросы

### <a name="how-frequently-can-data-sync-synchronize-my-data"></a>Как часто функция синхронизации данных может синхронизировать мои данные? 
Минимальная частота — каждые пять минут.

### <a name="can-i-use-data-sync-to-sync-between-sql-server-on-premises-databases-only"></a>Можно ли использовать функцию синхронизации данных только для синхронизации между локальными базами данных SQL Server? 
Не напрямую. Вы можете опосредованно выполнять синхронизацию между локальными базами данных SQL Server. Это можно сделать, создав центральную базу данных в Azure, а затем добавив локальные базы данных в группу синхронизации.
   
### <a name="can-i-use-data-sync-to-seed-data-from-my-production-database-to-an-empty-database-and-then-keep-them-synchronized"></a>Можно ли использовать синхронизацию данных для заполнения данных из рабочей базы данных в пустую базу данных с последующей синхронизацией? 
Да. Вручную создайте схему в новой базе данных из оригинала с помощью скрипта. После создания схемы добавьте таблицы в группу синхронизации, чтобы скопировать данные и обеспечить их синхронизацию.

### <a name="why-do-i-see-tables-that-i-did-not-create"></a>Почему я вижу таблицы, созданные не мной?  
Синхронизация данных создает вспомогательные таблицы в вашей базе данных для отслеживания изменений. Не удаляйте их, иначе функция синхронизации данных перестанет работать.
   
### <a name="i-got-an-error-message-that-said-cannot-insert-the-value-null-into-the-column-column-column-does-not-allow-nulls-what-does-this-mean-and-how-can-i-fix-the-error"></a>Получено сообщение об ошибке "Не удалось вставить значение NULL в столбец \<столбец\>. В столбце запрещены значения NULL". Что это означает, и как можно исправить эту ошибку? 
Это сообщение об ошибке указывает на одну из двух следующих проблем:
1.  Возможно, таблица не имеет первичного ключа. Чтобы устранить эту проблему, добавьте первичный ключ во все таблицы, которые синхронизируются.
2.  Возможно, в инструкции CREATE INDEX присутствует предложение WHERE. Синхронизация не обрабатывает это условие. Чтобы устранить эту проблему, удалите предложение WHERE или вручную внесите изменения во все базы данных. 
 
### <a name="how-does-data-sync-handle-circular-references-that-is-when-the-same-data-is-synced-in-multiple-sync-groups-and-keeps-changing-as-a-result"></a>Как синхронизация данных обрабатывает циклические ссылки? То есть, когда одни и те же данные синхронизируются в нескольких группах синхронизации и в результате постоянно изменяются?
Синхронизация данных не обрабатывает циклические ссылки. Не используйте их. 

### <a name="how-can-i-export-and-import-a-database-with-data-sync"></a>Как экспортировать и импортировать базу данных с синхронизацией данных?
После того как вы экспортировали базу данных в виде BACPAC-файла и импортировали ее для создания новой базы данных, нужно выполнить два действия, чтобы использовать синхронизацию данных в новой базе данных.
1.  Очистите объекты синхронизации данных и вспомогательные таблицы в **новой базе данных** с помощью [этого скрипта](https://github.com/Microsoft/sql-server-samples/blob/master/samples/features/sql-data-sync/clean_up_data_sync_objects.sql). Этот скрип удаляет все необходимые объекты синхронизации данных из базы данных.
2.  Повторно создайте группу синхронизации с новой базой данных. Если старая группа синхронизации больше не нужна, удалите ее.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о синхронизации данных SQL:

-   [Приступая к работе с синхронизацией данных SQL Azure (предварительная версия)](sql-database-get-started-sql-data-sync.md)

-   Полные примеры PowerShell, которые демонстрируют, как настроить синхронизацию данных SQL:
    -   [Использование PowerShell для синхронизации данных между несколькими базами данных SQL Azure](scripts/sql-database-sync-data-between-sql-databases.md)
    -   [Использование PowerShell для синхронизации данных между базой данных SQL Azure и локальной базой данных SQL Server](scripts/sql-database-sync-data-between-azure-onprem.md)

-   [Загрузка технической документации по синхронизации данных SQL](https://github.com/Microsoft/sql-server-samples/raw/master/samples/features/sql-data-sync/Data_Sync_Preview_full_documentation.pdf?raw=true)

-   [Документация по REST API синхронизации данных SQL](https://github.com/Microsoft/sql-server-samples/raw/master/samples/features/sql-data-sync/Data_Sync_Preview_REST_API.pdf?raw=true)

Дополнительные сведения о Базе данных SQL:

-   [Обзор Базы данных SQL](sql-database-technical-overview.md)

-   [Управление жизненным циклом базы данных](https://msdn.microsoft.com/library/jj907294.aspx)
