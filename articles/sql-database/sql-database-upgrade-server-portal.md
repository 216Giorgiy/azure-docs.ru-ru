<properties 
	pageTitle="Обновление базы данных SQL Azure до версии 12 с помощью портала предварительной версии Azure | Microsoft Azure" 
	description="Объясняется, как выполнить обновление до версии 12 базы данных SQL Azure, включая способы обновления баз данных Web и Business, а также как выполнить обновление сервера версии 11 путем переноса баз данных непосредственно в пул эластичных баз данных в портале предварительной версии Azure." 
	services="sql-database" 
	documentationCenter="" 
	authors="stevestein" 
	manager="jeffreyg"
	editor=""/>

<tags 
	ms.service="sql-database" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.workload="data-management" 
	ms.date="11/11/2015" 
	ms.author="sstein"/>


# Обновление базы данных SQL Azure до версии 12 с помощью портала предварительной версии Azure


> [AZURE.SELECTOR]
- [Azure preview portal](sql-database-upgrade-server-portal.md)
- [PowerShell](sql-database-upgrade-server-powershell.md)


Версия 12 базы данных SQL является последней версией, поэтому рекомендуется выполнить обновление до нее. У базы данных SQL версии 12 есть множество [преимуществ по сравнению с предыдущей версией](sql-database-v12-whats-new.md), включая следующие:

- Улучшенная совместимость с сервером SQL Server.
- Улучшенная производительность для категории Премиум и новые уровни производительности.
- [Пулы эластичных баз данных](sql-database-elastic-pool.md).

Эта статья содержит инструкции для обновления серверов баз данных SQL версии 11 до версии 12.

В процессе обновления до версии 12 выполняется обновление всех баз данных Web и Business до нового уровня служб, поэтому в статью также включены инструкции по обновлению баз данных Web и Business.

Кроме того, переход на [пул эластичных баз данных](sql-database-elastic-pool.md) может быть более экономически эффективным, чем обновление до индивидуальных уровней производительности (ценовых категорий) для отдельных баз данных. Пулы также упрощают управление базами данных, поскольку с ними необходимо управлять только параметрами производительности для пула, а не уровнями производительности отдельных баз данных. Если ваши базы данных расположены на нескольких серверах, подумайте об их переносе на один и тот же сервер и помещении в пул. Вы можете легко [выполнить автоматический перенос баз данных с серверов версии 11 напрямую в пулы эластичных баз данных с помощью PowerShell](sql-database-upgrade-server.md). С помощью портала также можно перенести базы данных версии 11 в пул, но в этом случае на портале уже должен быть сервер версии 12 для создания пула. Далее в этой статье приведены инструкции по созданию пула после обновления сервера при наличии [баз данных, которые могут использовать преимущества пула](sql-database-elastic-pool-guidance.md).

Обратите внимание, что на протяжении всей операции обновления базы данных останутся в сети и будут продолжать работать. Во время фактического перехода на новый уровень производительности может произойти кратковременное отключение от базы данных. Обычно оно составляет порядка 90 секунд, но может продолжаться до 5 минут. Если в приложении предусмотрена [обработка временных отказов подключения](sql-database-connect-central-recommendations.md), то этого достаточно, чтобы обеспечить защиту от отключения на завершающем этапе обновления.

Обновление базы данных SQL до версии 12 не может быть отменено. После обновления сервер нельзя вернуть к версии 11.

После обновления до версии 12 [рекомендации уровня службы](sql-database-service-tier-advisor.md) и [рекомендации пула эластичных баз данных](sql-database-elastic-pool-portal.md#step-2-choose-a-pricing-tier) не будут доступны, пока служба не выполнит оценку рабочих нагрузок на новом сервере. Журнал рекомендаций сервера версии 11 не применяется к серверам версии 12, поэтому он не сохраняется.


## Подготовка к обновлению

- **Обновление всех баз данных Web и Business**: см. раздел [Обновление всех баз данных Web и Business](sql-database-upgrade-server-portal.md#upgrade-all-web-and-business-databases) ниже или воспользуйтесь [PowerShell для обновления баз данных и сервера](sql-database-upgrade-server-powershell.md).
- **Обзор и приостановка георепликации**: если ваша база данных SQL настроена для георепликации, необходимо задокументировать ее текущую конфигурацию и [остановить георепликацию](sql-database-geo-replication-portal.md#remove-secondary-database). После завершения обновления потребуется перенастроить свою базу данных для георепликации.
- **Откройте следующие порты, если у вас есть клиенты на виртуальной машине Azure**: если клиентская программа подключается к базе данных SQL версии 12, а клиент работает на виртуальной машине Azure, необходимо открыть на ней диапазоны портов 11000–11999 и 14000–14999. Дополнительные сведения см. в разделе [Порты для базы данных SQL версии 12](sql-database-develop-direct-route-ports-adonet-v12.md).



## Начало обновления

1. На [портале предварительной версии Azure](http://portal.azure.com/) перейдите к серверу, который требуется обновить, выбрав **ПРОСМОТРЕТЬ ВСЕ** > **Серверы SQL** и указав нужный сервер.
2. Выберите **Последнее обновление базы данных SQL** и затем **Обновить этот сервер**.

      ![обновление сервера][1]

## Обновите все базы данных Web и Business.

Если на сервере имеются базы данных Web или Business, их необходимо обновить. В ходе обновления базы данных SQL до версии V12 также будет произведено обновление всех баз данных Web и Business до нового уровня службы.

В целях упрощения процедуры обновления служба Базы данных SQL рекомендует подходящий уровень службы и уровень производительности (ценовую категорию) для каждой базы данных. Путем анализа журнала использования вашей базы данных служба предложит оптимальный уровень для выполнения рабочей нагрузки базы данных.
    
3. В колонке **Обновить этот сервер** выберите каждую базу данных, которую хотите проанализировать, и рекомендуемую ценовую категорию, на которую следует перейти. Вы в любое время можете просмотреть доступные ценовые категории и выбрать ту из них, которая лучше всего соответствует вашей среде.


     ![databases][2]


7. После выбора предлагаемого уровня отображается колонка **Выберите ценовую категорию**, в которой можно выбрать одну из категорий. Затем нажмите кнопку **Выбрать**, чтобы изменить категорию на выбранную. Выберите новый уровень для каждой базы данных Web или Business.

    Следует отметить, что база данных SQL не привязана к конкретному уровню служб или уровню производительности. По мере изменения требований к базе данных вы можете с легкостью переходить с одних доступных уровней служб и уровней производительности на другие. Для Баз данных SQL уровней «Базовый», «Стандартный» и «Премиум» выставляются счета за почасовое использование. Каждую базу данных можно масштабировать вверх или вниз 4 раза в течение 24 часов.

    ![к просмотру фильмов][6]


После того как все базы данных на сервере будут приведены в соответствующее состояние, можно начать обновление.

## Подтверждение обновления

3. Когда все базы данных на сервере готовы к обновлению, необходимо **ВВЕСТИ ИМЯ СЕРВЕРА**, чтобы подтвердить выполнение обновления, а затем нажать кнопку **ОК**. 

    ![проверка обновления][3]


4. Начинается обновление, и отображается уведомление о ходе выполнения. Будет запущен процесс обновления. В зависимости от конкретных особенностей баз данных, обновляемых до версии V12, процедура обновления может занять некоторое время. В течение этого времени все базы данных на сервере остаются доступными, однако на операции управления сервером и базами данных накладываются определенные ограничения.

    ![выполняется обновление][4]

    Во время фактического перехода на новый уровень производительности может произойти кратковременное (как правило порядка нескольких секунд) отключение от базы данных. Если в приложении предусмотрена обработка (логика повторных попыток) временных отказов подключения, то этого достаточно, чтобы обеспечить защиту от разъединений соединения на завершающем этапе обновления.

5. После завершения операции обновления в колонке **Последнее обновление** будет отображаться **Включено**.

    ![функции V12 включены][5]

## Перемещение баз данных в пул эластичных баз данных

В [портале предварительной версии Azure](https://ms.portal.azure.com/) перейдите к серверу версии 12 и щелкните **Добавить пул**.

-или-

Если появится сообщение **Щелкните здесь, чтобы просмотреть рекомендуемые пулы эластичных баз данных для этого сервера**, щелкните его, чтобы с легкостью создать пул, оптимизированный для баз данных вашего сервера. Дополнительные сведения см. в статье [Рекомендуемые пулы эластичных баз данных](sql-database-elastic-pool-portal.md#recommended-elastic-database-pools).

![Добавление пула на сервер][7]
   
Следуйте инструкциям в статье [Создание пула эластичных баз данных](sql-database-elastic-pool.md), чтобы завершить создание пула.

## Мониторинг баз данных после обновления базы данных SQL до версии 12


После обновления рекомендуется регулярно отслеживать состояние базы данных, чтобы обеспечить надлежащую производительность приложений и оптимизированное использование ресурсов.

В дополнение к наблюдению за отдельными базами данных можно отслеживать пулы эластичных баз данных с помощью [портала](sql-database-elastic-pool-portal.md#monitor-and-manage-an-elastic-database-pool) или [PowerShell](sql-database-elastic-pool-powershell.md#monitoring-elastic-databases-and-elastic-database-pools).


**Данные о потреблении ресурсов:** для баз данных уровня Базовый, Стандартный и Премиум более точные данные о потреблении ресурсов доступны в новом динамическом административном представлении [sys.dm\_ db\_ resource\_stats](http://msdn.microsoft.com/library/azure/dn800981.aspx) в базе данных пользователя. Это динамическое административное представление предоставляет данные о потреблении практически в реальном времени с 15-секундной детализацией за предыдущий час работы. Относительное потребление DTU за интервал вычисляется как максимальное относительное потребление показателей ЦП, операций ввода-вывода и журнала. Ниже приведен запрос, который вычисляет среднее относительное потребление DTU за последний час:

    SELECT end_time
    	 , (SELECT Max(v)
             FROM (VALUES (avg_cpu_percent)
                         , (avg_data_io_percent)
                         , (avg_log_write_percent)
    	   ) AS value(v)) AS [avg_DTU_percent]
    FROM sys.dm_db_resource_stats
    ORDER BY end_time DESC;

Дополнительные сведения о мониторинге:

- [Руководство по производительности базы данных SQL Azure для отдельных баз данных](http://msdn.microsoft.com/library/azure/dn369873.aspx).
- [Вопросы цены и производительности для пула эластичных баз данных](sql-database=elastic-pool-guidance.md).
- [Мониторинг базы данных SQL Azure с помощью динамических представлений управления](sql-database-monitoring-with-dmvs.md)




**Оповещения:** настройте оповещения на портале Azure, чтобы получать уведомления о приближении показателя потребления DTU для обновленной базы данных к заданному высокому уровню. На портале Azure можно настроить оповещения базы данных для различных метрик производительности, например DTU, ЦП, ввод-вывод и журнал. Перейдите к своей базе данных и выберите **Правила оповещения** в колонке **Параметры**.

Например, можно настроить оповещение в сообщении электронной почты об относительном потреблении DTU, если среднее относительное потребление DTU превышает 75 % за последние 5 минут. См. статью [Получение уведомлений об оповещениях](insights-receive-alert-notifications.md), чтобы подробнее узнать о настройке уведомлений об оповещениях.





## Дальнейшие действия

- Ознакомьтесь с [Рекомендациями по выбору пула эластичных баз данных](sql-database-elastic-pool-portal.md#recommended-elastic-database-pools).
- [Создайте пул эластичных баз данных](sql-database-elastic-pool-portal.md) и добавьте в пул некоторые или все ваши базы данных.
- [Измените уровень службы и уровень производительности вашей базы данных](sql-database-scale-up.md).



## Связанные ссылки

- [Новые возможности Базы данных SQL версии 12](sql-database-v12-whats-new.md)
- [Планирование и подготовка к обновлению Базы данных SQL до версии 12](sql-database-v12-plan-prepare-upgrade.md)


<!--Image references-->
[1]: ./media/sql-database-upgrade-server-portal/latest-sql-database-update.png
[2]: ./media/sql-database-upgrade-server-portal/upgrade-server2.png
[3]: ./media/sql-database-upgrade-server-portal/upgrade-server3.png
[4]: ./media/sql-database-upgrade-server-portal/online-during-upgrade.png
[5]: ./media/sql-database-upgrade-server-portal/enabled.png
[6]: ./media/sql-database-upgrade-server-portal/recommendations.png
[7]: ./media/sql-database-upgrade-server-portal/new-elastic-pool.png

<!---HONumber=Nov15_HO4-->