---
title: Модели приобретения для базы данных SQL Azure | Документы Майкрософт
description: Сведения о модели приобретения для базы данных SQL Azure.
services: sql-database
author: CarlRabeler
ms.service: sql-database
ms.custom: DBs & servers
ms.topic: conceptual
ms.date: 06/20/2018
manager: craigg
ms.author: carlrab
ms.openlocfilehash: dda37600dffaf1e8e1c85c9757696f2d8219febb
ms.sourcegitcommit: 6eb14a2c7ffb1afa4d502f5162f7283d4aceb9e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/25/2018
ms.locfileid: "36751676"
---
# <a name="azure-sql-database-purchasing-models-and-resources"></a>Ресурсы и модели приобретения для базы данных SQL Azure 

Логические серверы в [Базе данных SQL Azure](sql-database-technical-overview.md) предлагают две модели приобретения для ресурсов вычисления, хранения и операций ввода-вывода: на основе единиц DTU и на основе виртуальных ядер (предварительная версия). 

> [!NOTE]
> [Управляемые экземпляры](sql-database-managed-instance.md) в базе данных SQL Azure предлагают только модель приобретения на основе виртуальных ядер.

В следующей таблице и на расположенном под ней рисунке приведено сравнение этих моделей приобретения.

> [!IMPORTANT]
> Узнайте больше о [модели приобретения на основе виртуальных ядер (предварительная версия)](sql-database-service-tiers-vcore.md).

|**Модель приобретения**|**Описание**|**Оптимально для**|
|---|---|---|
|Модель приобретения на основе единиц DTU|Эта модель основана на комплексной оценке вычислительных ресурсов, ресурсов хранилища и ресурсов для операций ввода-вывода. Уровни производительности выражаются в единицах транзакций базы данных (DTU) для отдельных баз данных, а для эластичных пулов — в единицах транзакций эластичной базы данных (eDTU). Дополнительные сведения см. в статье [Единицы транзакций базы данных (DTU) и единицы транзакций эластичной базы данных (eDTU)](sql-database-service-tiers.md#what-are-database-transaction-units-dtus).|Для клиентов, которым нужны простые, предварительно настроенные варианты ресурсов.| 
|Модель приобретения на основе виртуальных ядер|Эта модель позволяет независимо масштабировать ресурсы вычисления и хранилища. Кроме того, она позволяет экономить средства благодаря программе "Преимущество гибридного использования Azure для SQL Server".|Для клиентов, которые ценят гибкость, контроль и прозрачность.|
||||  

![модель ценообразования](./media/sql-database-service-tiers/pricing-model.png)

## <a name="vcore-based-purchasing-model--preview"></a>Модель приобретения на основе виртуальных ядер (предварительная версия)

Виртуальное ядро — это логический ЦП с возможностью выбора поколения оборудования. Модель приобретения на основе виртуальных ядер (предварительная версия) обеспечивает гибкость, контроль и прозрачность потребления отдельных ресурсов. Это эффективный способ удовлетворить свои требования к локальной рабочей нагрузке в облаке. Эта модель позволяет масштабировать ресурсы вычислений, памяти и хранилища с учетом потребностей рабочих нагрузок. В модели приобретения на основе виртуальных ядер (предварительная версия) клиенты могут выбрать между уровнями служб ("Общего назначения" и "Критически важный для бизнеса") для [отдельных баз данных](sql-database-single-database-scale.md) и [эластичных пулов](sql-database-elastic-pool.md). 

Модель приобретения на основе виртуальных ядер (предварительная версия) позволяет независимо масштабировать вычислительные ресурсы и ресурсы хранилища, обеспечивать производительность на уровне локальной среды и оптимизировать затраты. Если база данных или эластичный пул потребляет более 300 единиц DTU, переход на модель на основе виртуальных ядер может сократить ваши расходы. Вы можете перейти с помощью API или портала Azure без простоя. Тем не менее этот переход необязателен. Если модель приобретения на основе единиц DTU удовлетворяет вашим требованиям к производительности и бизнес-требованиям, продолжайте использовать ее. Если вы решите перейти с модели на основе единиц DTU на модель на основе виртуальных ядер, выберите уровень производительности, следуя такому правилу: для каждых 100 единиц DTU уровня "Стандартный" требуется по меньшей мере 1 виртуальное ядро уровня "Общего назначения"; для каждых 125 единиц DTU уровня "Премиум" требуется по меньшей мере 1 виртуальное ядро уровня "Критически важный для бизнеса".

В модели приобретения на основе виртуальных ядер (предварительная версия) клиенты оплачивают:
- вычислительные ресурсы (уровень обслуживания + количество виртуальных ядер + поколение программного обеспечения)*;
- тип и объем хранилища данных и журналов; 
- количество операций ввода-вывода**;
- хранилище резервных копий(геоизбыточное хранилище с доступом на чтение (RA-GRS))**. 

\* В исходной общедоступной предварительной версии логические ЦП 4-го поколения основаны на процессорах Intel E5-2673 v3 (Haswell) с тактовой частотой 2,4 ГГц.

\*\* На этапе предварительной версии резервные копии и операции ввода-вывода бесплатны на протяжении 7 дней.

> [!IMPORTANT]
> Плата за вычислительные ресурсы, операции ввода-вывода, хранилища данных и журналов взимается для каждой базы данных или эластичного пула. Плата за хранилище резервных копий взимается для каждой базы данных. Дополнительные сведения о плате за использование управляемого экземпляра см. в статье [Общие сведения об Управляемом экземпляре Базы данных SQL Azure (предварительная версия)](sql-database-managed-instance.md).
> **Ограничения по регионам**. Модель приобретения на основе виртуальных ядер (предварительная версия) недоступна в следующих регионах: Западная Европа, Центральная Франция, южная часть Соединенного Королевства, западная часть Соединенного Королевства и Юго-Восточная Австралия.

## <a name="dtu-based-purchasing-model"></a>Модель приобретения на основе единиц DTU

Единица пропускной способности базы данных (DTU) предоставляет объединенный показатель мощности ЦП, памяти, операций чтения и записи. Модель приобретения на основе единиц DTU предлагает ряд предварительно настроенных пакетов вычислительных ресурсов и включенный объем хранилища для обеспечения различных уровней производительности приложений. Эта модель подходит клиентам, которые предпочитают простоту предварительно настроенного пакета и фиксированные платежи каждый месяц. При использовании модели приобретения на основе единиц DTU клиенты могут выбрать между разными уровнями служб (**Базовый**, **Стандартный** и **Премиум**) для [отдельных баз данных](sql-database-single-database-scale.md) и [эластичных пулов](sql-database-elastic-pool.md). 

### <a name="what-are-database-transaction-units-dtus"></a>Что такое единицы транзакций базы данных (DTU)?
Для одной базы данных SQL Azure с определенным уровнем производительности на [ уровне обслуживания ](sql-database-single-database-scale.md) Майкрософт гарантирует определенный уровень ресурсов (независимо от любой другой базы данных в облаке Azure) и обеспечивает предсказуемый уровень производительности. Объем ресурсов рассчитывается как количество единиц передачи данных или DTU и является комплексной оценкой вычислительных ресурсов, ресурсов хранилища и ресурсов ввода-вывода. Коэффициент этих ресурсов первоначально определялся по [тестовой рабочей нагрузке OLTP](sql-database-benchmark-overview.md), отражающей фактические рабочие нагрузки OLTP. Если рабочая нагрузка превышает объем любого из этих ресурсов, пропускная способность регулируется, что приводит к снижению производительности и простоям. Ресурсы, используемые вашей рабочей нагрузкой, не влияют на ресурсы, доступные для других баз данных SQL в облаке Azure, а ресурсы, используемые другими рабочими нагрузками, не влияют на ресурсы, доступные вашей базе данных SQL.

![ограничивающая рамка](./media/sql-database-what-is-a-dtu/bounding-box.png)

DTU лучше всего помогают определить относительный объем ресурсов баз данных SQL Azure с разными уровнями производительности и обслуживания. Например, повысить производительность базы данных (через удвоение DTU) означает удвоить количество ресурсов, доступных для этой базы данных. Например, база данных P11 уровня "Премиум" с 1750 единицами DTU обеспечивает в 350 раз больше вычислительной мощи, чем база данных уровня "Базовый" с 5 единицами DTU.  

Чтобы узнать, как используются ресурсы (DTU) в вашей рабочей нагрузке, см. статью [Анализ производительности запросов базы данных Azure SQL](sql-database-query-performance.md). После этого вы сможете:

- Выявлять запросы, максимально использующие ресурсы процессора, имеющие максимальную длительность или число выполнений, которые потенциально можно настроить, чтобы повысить производительность. Например, запрос на большое число операций ввода-вывода может выполняться быстрее за счет [методов оптимизации в памяти](sql-database-in-memory.md). Так вы сможете оптимизировать использование доступной памяти на определенном уровне обслуживания и производительности.
- Перейти к подробным сведениям о запросе, просмотреть его текст и журнал использования ресурсов.
- Получать доступ к рекомендациям по настройке производительности, отображающим действия [Помощника по базам данных SQL](sql-database-advisor.md).

Вы можете изменять [уровни обслуживания DTU](sql-database-service-tiers-dtu.md) в любое время. Это приведет лишь к минимальному простою приложения (обычно в среднем не более четырех секунд). Для многих организаций и приложений достаточно иметь возможность создавать и уменьшать или увеличивать производительность баз данных по запросу, особенно если закономерности использования базы данных относительно хорошо прогнозируются. Но если закономерности использования непредсказуемы, это может усложнить управление расходами и бизнес-моделью. В этом сценарии вы используете эластичный пул с определенным числом единиц eDTU, распределенных между несколькими базами данных в пуле.

![Общие сведения о базе данных SQL: единицы DTU отдельных баз данных по категориям и уровням](./media/sql-database-what-is-a-dtu/single_db_dtus.png)

### <a name="what-are-elastic-database-transaction-units-edtus"></a>Что такое единицы транзакций эластичной базы данных (eDTU)?
Вместо выделения определенного набора ресурсов (DTU) базе данных SQL, доступных вне зависимости от того, нужны они или нет, вы можете поместить базы данных в [эластичный пул](sql-database-elastic-pool.md) на сервере базы данных SQL, который распределяет пул ресурсов между этими базами данных. Общие ресурсы в эластичном пуле измеряются в эластичных единицах передачи данных или eDTU. Пулы эластичных баз данных обеспечивают простое и экономически выгодное решение для управления целевыми показателями производительности для нескольких баз данных с совершенно разными и непредсказуемыми моделями функционирования. Пул эластичных баз данных гарантирует, что ни одна из баз данных в пуле не использует все ресурсы и что каждой из них всегда доступен минимальный необходимый объем ресурсов. 

![Общие сведения о базе данных SQL: единицы eDTU по категориям и уровням](./media/sql-database-what-is-a-dtu/sqldb_elastic_pools.png)

Пулу предоставляется заданное количество единиц eDTU по фиксированной цене. Отдельным базам данных в пуле эластичных баз данных предоставляется возможность гибкого автоматического масштабирования в рамках заданных границ. Базы данных, на которые приходится значительная нагрузка, могут потреблять больше eDTU, чтобы обслужить имеющийся спрос. Базы данных с меньшей нагрузкой будут потреблять меньше eDTU. Базы данных без нагрузки не будут потреблять eDTU. Благодаря подготовке ресурсов для всего пула, а не одной базы данных, задачи управления упрощаются и вы можете спрогнозировать затраты на пул.

Добавить дополнительные единицы eDTU в имеющийся пул можно без простоя баз данных в пуле или снижения их производительности. Точно так же, если eDTU больше не нужны, их можно удалить из имеющегося пула в любой момент времени. Вы можете добавить базы данных в пул или удалить их либо ограничить количество eDTU, которые базы данных могут использовать в условиях интенсивной нагрузки, чтобы сохранить eDTU для остальных баз данных. Если у базы данных прогнозируемо низкие показатели использования ресурсов, ее можно переместить из пула и настроить в качестве отдельной базы данных с прогнозируемым объемом требуемых ресурсов.

### <a name="how-can-i-determine-the-number-of-dtus-needed-by-my-workload"></a>Как определить, сколько единиц DTU нужно для моей рабочей нагрузки
Если нужно перенести существующую локальную рабочую нагрузку или нагрузку виртуальной машины SQL Server в базу данных SQL Azure, вы можете приблизительно вычислить нужное количество единиц DTU с помощью [калькулятора DTU](http://dtucalculator.azurewebsites.net/) . Чтобы узнать, как используются ресурсы (DTU) в существующей рабочей нагрузке базы данных SQL Azure, и понять, как оптимизировать эту нагрузку, вы можете использовать [анализ производительности запросов к базе данных SQL](sql-database-query-performance.md). Кроме того, с помощью динамического административного представления [sys.dm_db_ resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) можно просмотреть сведения об использовании ресурсов за последний час. Представление каталога [sys.resource_stats](http://msdn.microsoft.com/library/dn269979.aspx) содержит эти же сведения, но только за последние 14 дней, причем с менее точными средними значениями за пять минут.

### <a name="how-do-i-know-if-i-could-benefit-from-an-elastic-pool-of-resources"></a>Как понять, что мне нужен пул эластичных БД?
Пулы подходят для большого числа баз данных с конкретными закономерностями использования. Для заданной базы данных эта закономерность характеризуется низким средним использованием с относительно редкими пиками использования. База данных SQL автоматически оценивает историю использования ресурсов баз данных на существующем сервере баз данных SQL и рекомендует подходящую конфигурацию пула в портале Azure. Дополнительные сведения см. в статье [Когда следует использовать пул эластичных баз данных?](sql-database-elastic-pool.md)

### <a name="what-happens-when-i-hit-my-maximum-dtus"></a>Что происходит, когда количество единиц DTU становится максимальным?
Уровни производительности определяются и регулируются, чтобы обеспечить необходимые ресурсы для работы базы данных в условиях максимальной нагрузки, предусмотренной вашим уровнем обслуживания или производительности. Если ваша рабочая нагрузка достигнет предела по одному из показателей (ЦП, ввод-вывод данных, ввод-вывод журнала), вы продолжите получать ресурсы на максимально допустимом уровне, но может увеличиться задержка обработки запросов. Превышение одного из этих ограничений ведет не к возникновению ошибок, а к замедлению работы (за исключением случаев, когда работа идет настолько медленно, что время ожидания запросов начинает истекать). Когда количество параллельных пользовательских сеансов или запросов (рабочих потоков) достигает максимально допустимого значения, выводятся явные ошибки. Сведения об ограничениях на использование ресурсов, не связанных с ЦП, памятью, вводом-выводом данных и вводом-выводом журналов, см. в разделе [Ограничения ресурсов базы данных SQL Azure]( sql-database-resource-limits.md#what-happens-when-database-resource-limits-are-reached).

### <a name="correlating-benchmark-results-to-real-world-database-performance"></a>Соотнесение результатов тестирования производительности с реальной производительностью базы данных
Важно понимать, что все тесты производительности являются лишь показательными и ориентировочными. Показатели скорости транзакций, достигнутые приложением тестирования производительности, будут отличаться от таких показателей других приложений. Тест производительности состоит из набора транзакций разных типов, выполняемых в схеме, которая содержит целый ряд таблиц и типов данных. Хотя тест производительности выполняет основные операции, свойственные для всех рабочих нагрузок OLTP, он не представляет какой-либо определенный класс базы данных или приложения. Цель тестирования производительности заключается в предоставлении приемлемых рекомендаций для относительной производительности базы данных, которую можно ожидать при переходе на более высокий или более низкий уровень производительности. На самом деле базы данных имеют разные размеры и сложность, обрабатывают разные сочетания рабочих нагрузок и реагируют разными способами. Например, приложение с большим объемом операций ввода-вывода может быстрее достигнуть порогового значения таких операций или приложение с интенсивной нагрузкой ЦП может быстрее достигнуть порогового значения такой нагрузки. Нет никакой гарантии, что конкретная база данных будет увеличиваться так же, как это показывает тест производительности при увеличении нагрузки.

Тест производительности и его методология подробно описаны ниже.

### <a name="benchmark-summary"></a>Сводка о тесте производительности
Тест ASDB измеряет производительность набора основных операций базы данных, выполняемых чаще всего при рабочих нагрузках оперативной обработки транзакций (OLTP). Хотя тест производительности разрабатывался для облачных вычислений, схемы базы данных, заполнение данными и транзакции рассчитаны на максимально широкий уровень репрезентативности основных элементов, которые чаще всего используются в рабочих нагрузках OLTP.

### <a name="schema"></a>Схема
Схема разработана таким образом, чтобы предоставить достаточную степень разнообразия и сложности для поддержки широкого диапазона операций. Тест производительности выполняется в базе данных, состоящей из шести таблиц. Эти таблицы делятся на три категории: фиксированного размера, масштабируемые и расширяемые. Есть две таблицы фиксированного размера, три масштабируемые таблицы и одна расширяемая таблица. Таблицы фиксированного размера имеют неизменное количество строк. Масштабируемые таблицы имеют кратность, пропорциональную производительности базы данных, но не изменяемую во время тестирования производительности. Расширяемая таблица имеет такой же размер, что и масштабируемая таблица при начальной нагрузке, но затем в процессе тестирования производительности кратность изменяется по мере добавления и удаления строк.

Схема включает сочетание типов данных, в том числе целое число, цифру, символ, а также дату и время. Схема включает первичные и вторичные ключи, но не имеет внешних ключей, т. е. между таблицами нет ограничений ссылочной целостности.

Программа формирования данных создает данные для исходной базы данных. Целочисленные и числовые данные создаются с помощью разных стратегий. В некоторых случаях значения случайным образом распределяются в диапазоне. Чтобы гарантировать соблюдение конкретного распределения в других случаях, набор значений переставляется случайным образом. Текстовые поля создаются из взвешенного списка слов для формирования реалистичных данных.

Размер базы данных устанавливается в соответствии с «коэффициентом масштабирования». Коэффициент масштабирования (сокращенно SF) определяет кратность элементов в масштабируемых и растущих таблицах. Как описано ниже, в разделе «Пользователи и пошаговое продвижение», размер базы данных, количество пользователей и максимальная производительность масштабируются пропорционально друг к другу.

### <a name="transactions"></a>Транзакции
Рабочая нагрузка состоит из девяти типов транзакций, как показано в следующей таблице. Каждая транзакция должна подчеркивать определенный набор системных характеристик в ядре СУБД и системном оборудовании. При этом она должна явно отличаться от других транзакций. Такой подход упрощает оценку влияния различных компонентов на общую производительность. Например, транзакция «Чтение, высокая интенсивность» создает значительное число операций чтения с диска.

| Тип транзакции | ОПИСАНИЕ |
| --- | --- |
| Чтение, низкая интенсивность |ВЫБОР; в памяти; только для чтения |
| Носитель для чтения |ВЫБОР; в основном в памяти; только для чтения |
| Чтение, высокая интенсивность |ВЫБОР; в основном не в памяти; только для чтения |
| Обновление, низкая интенсивность |ОБНОВЛЕНИЕ; в памяти; чтение и запись |
| Обновление, высокая интенсивность |ОБНОВЛЕНИЕ; в основном не в памяти; чтение и запись |
| Вставка, низкая интенсивность |ВСТАВКА; в памяти; чтение и запись |
| Вставка, высокая интенсивность |ВСТАВКА; в основном не в памяти; чтение и запись |
| Delete |УДАЛЕНИЕ; сочетание в памяти и не в памяти; чтение и запись |
| ЦП, высокая интенсивность |ВЫБОР; в памяти; относительно высокая загрузка ЦП; только для чтения |

### <a name="workload-mix"></a>Сочетание рабочих нагрузок
Транзакции выбираются случайным образом из взвешенного распределения следующего общего сочетания. Обще сочетание имеет соотношение чтения и записи 2:1.

| Тип транзакции | Процент от сочетания |
| --- | --- |
| Чтение, низкая интенсивность |35 |
| Носитель для чтения |20 |
| Чтение, высокая интенсивность |5 |
| Обновление, низкая интенсивность |20 |
| Обновление, высокая интенсивность |3 |
| Вставка, низкая интенсивность |3 |
| Вставка, высокая интенсивность |2 |
| Delete |2 |
| ЦП, высокая интенсивность |10 |

### <a name="users-and-pacing"></a>Пользователи и пошаговое продвижение
Рабочая нагрузка теста производительности определяется с помощью средства, которое передает транзакции через ряд подключений для имитации работы определенного количества одновременных пользователей. Хотя все подключения и транзакции создаются компьютером, для простоты мы называем эти подключения «пользователи». Несмотря на то, что каждый пользователь работает независимо от других пользователей, все они выполняют одинаковый цикл, показанный ниже:

1. Установление подключения к базе данных.
2. Повторение до получения сигнала выхода:
   * случайный выбор транзакций (из взвешенного распределения);
   * выполнение выбранной транзакции и измерение времени ответа;
   * ожидание задержки шага.
3. Завершение подключения к базе данных.
4. Выход.

Задержка шага (в действии 2в) выбирается случайным образом, однако с распределением со средним значением в 1,0 секунду. Таким образом, в среднем каждый пользователь может создавать максимум одну транзакцию в секунду.

### <a name="scaling-rules"></a>Правила масштабирования
Количество пользователей определяется размером базы данных (в единицах коэффициента масштабирования). Существует один пользователь на каждые пять единиц коэффициента масштабирования. Из-за задержки шага один пользователь может в среднем создавать не более одной транзакции в секунду.

Например, база данных с коэффициентом масштабирования 500 (SF=500) будет иметь 100 пользователей и может достичь максимальной скорости в 100 транзакций в секунду. Для более высокой скорости требуется больше пользователей и большие размеры базы данных.

В таблице ниже показано количество пользователей, фактически поддерживаемых для каждого уровня службы и уровня производительности.

| Уровень службы (уровень производительности) | Пользователи | Размер базы данных |
| --- | --- | --- |
| базовая; |5 |720 МБ |
| Standard (S0) |10 |1 GB |
| Standard (S1) |20 |2,1 ГБ |
| Standard (S2) |50 |7,1 ГБ |
| Premium (P1) |100 |14 ГБ |
| Premium (P2) |200 |28 ГБ |
| Premium (P6) |800 |114 ГБ |

### <a name="measurement-duration"></a>Продолжительность измерения
Для правильного выполнения теста производительности требуется измерять устойчивое состояние по крайней мере один час.

### <a name="metrics"></a>Метрики
Ключевыми показателями теста производительности являются пропускная способность и время ответа.

* Пропускная способность — это важный показатель производительности в тесте производительности. Пропускная способность измеряется в транзакциях в единицу времени, учитывая все типы транзакций.
* Время отклика — это показатель прогнозируемости производительности. Ограничение времени ответа зависит от класса службы. Более высокие классы службы имеют более строгие требования ко времени ответа, как показано ниже.

| Класс службы | Единица пропускной способности | Требование ко времени ответа |
| --- | --- | --- |
| Премиум |Транзакций в секунду |95-й процентиль при 0,5 секунды |
| Стандартная |Транзакций в минуту |90-й процентиль при 1,0 секунде |
| Basic |Транзакций в час |80-й процентиль при 2,0 секундах |

## <a name="next-steps"></a>Дополнительная информация

- Узнайте больше о [модели приобретения на основе виртуальных ядер (предварительная версия)](sql-database-service-tiers-vcore.md).
- Узнайте больше о [модели приобретения на основе DTU](sql-database-service-tiers-dtu.md).
