---
title: 'Служба Базы данных SQL: модель на основе виртуальных ядер | Документация Майкрософт'
description: Дополнительные сведения об уровнях обслуживания для одной базы данных или пула баз данных в зависимости от уровней производительности и размеров хранилища.
services: sql-database
author: CarlRabeler
ms.service: sql-database
ms.custom: DBs & servers
ms.topic: article
ms.date: 05/14/2018
manager: craigg
ms.author: carlrab
ms.openlocfilehash: 9abe7743906064d182453fea403ff94a097c3558
ms.sourcegitcommit: eb75f177fc59d90b1b667afcfe64ac51936e2638
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2018
ms.locfileid: "34212387"
---
# <a name="vcore-based-purchasing-model-for-azure-sql-database-preview"></a>Модель приобретения на основе виртуальных ядер для базы данных SQL Azure (предварительная версия)

[База данных SQL Azure](sql-database-technical-overview.md) предлагает две модели приобретения для ресурсов вычисления, хранения и операций ввода-вывода: на основе единиц DTU и на основе виртуальных ядер (предварительная версия). В следующей таблице и на расположенном под ней рисунке приведено сравнение этих моделей приобретения.

> [!IMPORTANT]
> Узнайте больше о [модели приобретения на основе DTU](sql-database-service-tiers-dtu.md).


|**Модель приобретения**|**Описание**|**Оптимально для**|
|---|---|---|
|Модель приобретения на основе единиц DTU|Эта модель основана на комплексной оценке вычислительных ресурсов, ресурсов хранилища и ресурсов для операций ввода-вывода. Уровни производительности выражаются в единицах транзакций базы данных (DTU) для отдельных баз данных, а для эластичных пулов — в единицах транзакций эластичной базы данных (eDTU). Дополнительные сведения см. в статье [Единицы транзакций базы данных (DTU) и единицы транзакций эластичной базы данных (eDTU)](sql-database-what-is-a-dtu.md).|Для клиентов, которым нужны простые, предварительно настроенные варианты ресурсов.| 
|Модель приобретения на основе виртуальных ядер|Эта модель позволяет независимо масштабировать вычислительные ресурсы и ресурсы хранилища до 80 виртуальных ядер, 4 ТБ хранилища данных и 200 000 операций ввода-вывода в секунду. Кроме того, она позволяет экономить средства благодаря программе "Преимущество гибридного использования Azure для SQL Server".|Для клиентов, которые ценят гибкость, контроль и прозрачность.|
||||  

![модель ценообразования](./media/sql-database-service-tiers/pricing-model.png)

## <a name="vcore-based-purchasing-model--preview"></a>Модель приобретения на основе виртуальных ядер (предварительная версия)

Виртуальное ядро — это логический ЦП с возможностью выбора поколения оборудования. Модель приобретения на основе виртуальных ядер (предварительная версия) обеспечивает гибкость, контроль и прозрачность потребления отдельных ресурсов. Это эффективный способ удовлетворить свои требования к локальной рабочей нагрузке в облаке. Эта модель позволяет масштабировать ресурсы вычислений, памяти и хранилища с учетом потребностей рабочих нагрузок. В модели приобретения на основе виртуальных ядер (предварительная версия) клиенты могут выбрать между уровнями служб ("Общего назначения" и "Критически важный для бизнеса") для [отдельных баз данных](sql-database-single-database-resources.md) и [эластичных пулов](sql-database-elastic-pool.md). 

Уровни служб отличаются диапазоном уровней производительности, структурой для обеспечения высокого уровня доступности, способом обеспечения изоляции от сбоев, типами хранилища и диапазоном операций ввода-вывода. Клиент должен отдельно настроить необходимое хранилище и период хранения резервных копий. Отдельные базы данных и эластичные пулы, в которых используется модель на основе виртуальных ядер, обеспечивают экономию до 30 % при использовании [программы преимущества гибридного использования Azure для SQL Server](../virtual-machines/windows/hybrid-use-benefit-licensing.md).

В модели приобретения на основе виртуальных ядер (предварительная версия) клиенты оплачивают:
- вычислительные ресурсы (уровень обслуживания + количество виртуальных ядер + поколение программного обеспечения)*;
- тип и объем хранилища данных и журналов; 
- количество операций ввода-вывода**;
- хранилище резервных копий(геоизбыточное хранилище с доступом на чтение (RA-GRS))**. 

\* В исходной общедоступной предварительной версии логические ЦП 4-го поколения основаны на процессорах Intel E5-2673 v3 (Haswell) с тактовой частотой 2,4 ГГц.

\*\* На этапе предварительной версии резервные копии и операции ввода-вывода бесплатны на протяжении 7 дней.

> [!IMPORTANT]
> Плата за вычислительные ресурсы, операции ввода-вывода, хранилища данных и журналов взимается для каждой базы данных или эластичного пула. Плата за хранилище резервных копий взимается для каждой базы данных. Дополнительные сведения о плате за использование управляемого экземпляра см. в статье [Общие сведения об Управляемом экземпляре Базы данных SQL Azure (предварительная версия)](sql-database-managed-instance.md).

> [!IMPORTANT]
> Ограничения для регионов: 
>
> В Юго-Восточной Австралии модель приобретения на основе виртуальных ядер (предварительная версия) пока недоступна. Предварительная версия недоступна в следующих регионах: Западная Европа, Центральная Франция, южная часть Соединенного Королевства и западная часть Соединенного Королевства
> 

## <a name="choosing-service-tier-compute-memory-storage-and-io-resources"></a>Выбор уровня служб, показателей ресурсов вычисления, памяти, хранилища и операций ввода-вывода

Перейдя на модель приобретения на основе виртуальных ядер (предварительная версия), вы сможете независимо масштабировать вычислительные ресурсы и ресурсы хранилища, обеспечивать производительность на уровне локальной среды и оптимизировать затраты. Если база данных или эластичный пул потребляет более 300 единиц DTU, переход на модель на основе виртуальных ядер может сократить ваши расходы. Вы можете перейти с помощью API или портала Azure без простоя. Тем не менее этот переход необязателен. Если модель приобретения на основе единиц DTU удовлетворяет вашим требованиям к производительности и бизнес-требованиям, продолжайте использовать ее. Если вы решите перейти с модели на основе единиц DTU на модель на основе виртуальных ядер, выберите уровень производительности, следуя такому правилу: для каждых 100 единиц DTU уровня "Стандартный" требуется по меньшей мере 1 виртуальное ядро уровня "Общего назначения"; для каждых 125 единиц DTU уровня "Премиум" требуется по меньшей мере 1 виртуальное ядро уровня "Критически важный для бизнеса".

В следующей таблице представлены различия между этими двумя уровнями:

||**Общего назначения**|**Критически важный для бизнеса**|
|---|---|---|
|Оптимально для|Большинства рабочих нагрузок. Предлагает бюджетные сбалансированные и масштабируемые варианты ресурсов вычисления и хранилища.|Бизнес-приложений с высокими требованиями к операциям ввода-вывода. Предлагает самую высокую отказоустойчивость к сбоям благодаря использованию нескольких изолированных реплик.|
|Службы вычислений|1–80 виртуальных ядер поколений 4 и 5 |1–80 виртуальных ядер поколений 4 и 5|
|Память|7 ГБ на ядро |7 ГБ на ядро |
|Служба хранилища|Удаленное хранилище уровня "Премиум", 5 ГБ–4 ТБ|Локальное хранилище на дисках SSD по 5 ГБ, 4 ТБ|
|Пропускная способность ввода-вывода (приблизительно)|500 операций ввода-вывода в секунду на виртуальное ядро с максимальным количеством 7000|5000 операций ввода-вывода в секунду на виртуальное ядро с максимальным количеством 200 000|
|Доступность|1 реплика, отсутствие возможности масштабирования для чтения|3 реплики, 1 операция [масштабирования для чтения](sql-database-read-scale-out.md), избыточная в пределах зоны высокая доступность|
|Резервные копии|Геоизбыточное хранилище с доступом на чтение, 7–35 дней (7 дней по умолчанию)|Геоизбыточное хранилище с доступом на чтение 7–35 дней (7 дней по умолчанию)*|
|В памяти|Недоступно|Поддерживаются|
|||

\* На стадии предварительной версии период хранения резервных копий нельзя настроить, он имеет фиксированную продолжительность — 7 дней.

> [!IMPORTANT]
> Если вам требуется меньше одного виртуального ядра емкости вычислительных ресурсов, используйте модель приобретения на основе единиц DTU.

Дополнительные сведения о конкретных уровнях производительности и доступных размерах хранилища для отдельной базы данных см. в разделе [Single database: Storage sizes and performance levels](sql-database-vcore-resource-limits.md#single-database-storage-sizes-and-performance-levels) (Отдельная база данных: размеры хранилища и уровни производительности), а для эластичных пулов — в разделе [Elastic pool: Storage sizes and performance levels](sql-database-vcore-resource-limits.md#elastic-pool-storage-sizes-and-performance-levels) (Эластичный пул: размеры хранилища и уровни производительности).

См. [часто задаваемые вопросы о службе "База данных SQL"](sql-database-faq.md). 

## <a name="storage-considerations"></a>Рекомендации по работе с хранилищем

Рассмотрим следующее:
- В выделенном хранилище хранятся файлы данных (MDF) и файлы журналов (LDF).
- Каждый уровень производительности поддерживает максимальный размер базы данных (размер по умолчанию — 32 ГБ).
- Когда вы настраиваете необходимый размер базы данных (размер MDF), для поддержки файлов LDF автоматически добавляются 30 % места в хранилище.
- Вы можете выбрать любой размер базы данных: от 10 ГБ до максимально допустимого значения.
 - Для хранилища уровня "Стандартный" можно увеличить или уменьшить размер с шагом приращения в 10 ГБ.
 - Для хранилища уровня "Премиум" можно увеличить или уменьшить размер с шагом приращения в 250 ГБ.
- При использовании уровня службы "Общего назначения" `tempdb` использует подключенный диск SSD, а затраты на хранилище входят в стоимость виртуального ядра.
- При использовании уровня службы "Критически важный для бизнеса" подключенный диск SSD используется для `tempdb` и файлов MDF и LDF, а затраты на хранилище tempDB входят в стоимость виртуального ядра.

> [!IMPORTANT]
> С клиента взимается плата за общее хранилище, выделенное для MDF и LDF.

Чтобы просмотреть текущий общий размер MDF и LDF, используйте [sp_spaceused](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-spaceused-transact-sql). Чтобы отслеживать текущий размер отдельных файлов MDF и LDF, используйте [sys.database_files](https://docs.microsoft.com/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql).

## <a name="backups-and-storage"></a>Резервные копии и хранилище

Хранилище для резервных копий базы данных выделяется для поддержки следующих возможностей базы данных SQL: восстановления до точки во времени (PITR) и долгосрочного хранения (LTR). Это хранилище выделяется отдельно для каждой базы данных. За эти возможности выставляются два отдельных счета. 

- **Восстановление до точки во времени**. Резервные копии отдельной базы данных автоматически копируются в хранилище RA-GRS. Размер хранилища динамически увеличивается по мере создания новых резервных копий.  Хранилище используется для полных резервных копий, созданных за неделю, разностных резервных копий, созданных за день, и резервных копий журналов транзакций, копируемых каждые 5 минут. Использование хранилища зависит от скорости изменения базы данных и периода хранения. Вы можете настроить отдельный период хранения для каждой базы данных длительностью от 7 до 35 дней. Минимальный объем хранилища, равный размеру данных, предоставляется без дополнительной оплаты. Для большинства баз данных этого объема достаточно для хранения резервных копий за 7 дней.
- **Долгосрочное хранение**. База данных SQL предоставляет возможность настройки долгосрочного периода хранения полных резервных копий до 10 лет. Если политика долгосрочно хранения включена, эти резервные копии автоматически сохраняются в хранилище RA-GRS, однако вы можете контролировать частоту их копирования. Чтобы удовлетворять различные требования к соответствию, вы можете выбрать разные периоды хранения для резервных копий, создаваемых еженедельно, ежемесячно или ежегодно. Эта конфигурация определит, какой объем хранилища будет использоваться для резервных копий долгосрочного хранения. Вы можете использовать калькулятор цен LTR, чтобы определить стоимость долгосрочного хранения резервных копий. Дополнительные сведения см. в статье [Storing Azure SQL Database Backups for up to 10 years](sql-database-long-term-retention.md) (Хранение резервных копий баз данных SQL Azure до 10 лет).

## <a name="azure-hybrid-use-benefit"></a>Программа преимуществ гибридного использования Azure

В модели приобретения на основе виртуальных ядер (предварительная версия) можно обменять имеющиеся лицензии, чтобы получить сниженные тарифы на базу данных SQL при использовании программы [Преимущества гибридного использования Azure для SQL Server](../virtual-machines/windows/hybrid-use-benefit-licensing.md). При этом благодаря локальным лицензиям SQL Server и подписке Software Assurance вы сможете сэкономить до 30 % на базу данных SQL Azure.

![цены](./media/sql-database-service-tiers/pricing.png)

## <a name="migration-of-single-databases-with-geo-replication-links"></a>Перемещение отдельных баз данных со связями георепликации

Переход с модели на основе единиц DTU на модель на основе виртуальных ядер аналогичен повышению или понижению уровня связей георепликации между базами данных уровня "Стандартный" и "Премиум". При этом не нужно завершать георепликацию, однако пользователь должен соблюдать правила последовательности. При повышении сначала повысьте уровень производительности базы данных-получателя, а затем — уровень базы данных-источника. При понижении следует действовать в обратном порядке: сначала нужно понизить уровень производительности базы данных-источника, а после этого — базы данных-получателя. 

При использовании георепликации между двумя эластичными пулами настоятельно рекомендуем указать один пул как первичный, а другой — как вторичный. В этом случае при перемещении эластичных пулов следует учитывать такую конфигурацию.  Однако технически возможно, что эластичный пул содержит как первичные, так и вторичные базы данных. В таком случае для правильного перемещения вы должны рассматривать пул с более высоким показателем использования как "первичный" и соответствующим образом следовать правилам последовательности.  

В следующей таблице приведены рекомендации для конкретных сценариев перемещения: 

|Текущий уровень служб|Целевой уровень служб|Тип перемещения|Действия пользователя|
|---|---|---|---|
|Стандартная|Универсальные|Горизонтальный|Можно выполнять перемещение в любом порядке, но необходимо обеспечить соответствующий размер виртуального ядра*|
|Премиум|Критически важный для бизнеса|Горизонтальный|Можно выполнять миграцию в любом порядке, но необходимо обеспечить соответствующий размер виртуального ядра*|
|Стандартная|Критически важный для бизнеса|Обновление|Сначала необходимо перенести базу данных-получатель|
|Критически важный для бизнеса|Стандартная|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Премиум|Универсальные|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Универсальные|Премиум|Обновление|Сначала необходимо перенести базу данных-получатель|
|Критически важный для бизнеса|Универсальные|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Универсальные|Критически важный для бизнеса|Обновление|Сначала необходимо перенести базу данных-получатель|
||||

\* Для каждых 100 единиц DTU уровня "Стандартный" и каждых 125 единиц DTU уровня "Премиум" требуется по меньшей мере 1 виртуальное ядро.

## <a name="migration-of-failover-groups"></a>Перемещение групп отработки отказа 

Перемещение групп отработки отказа с несколькими базами данных требует отдельного перемещения базы данных-источника и базы данных-получателя. Во время этого процесса применяются те же рекомендации и правила последовательности. После перевода базы данных на модель на основе виртуальных ядер в группе отработки отказа останутся те же параметры политики. 

## <a name="creation-of-a-geo-replication-secondary"></a>Создание базы данных-получателя георепликации

Вы можете создать базу данных-получателя георепликации, используя тот же уровень служб, что и у базы данных-источника. Для базы данных с высокой скоростью создания журналов настоятельно рекомендуем создавать базу данных-получателя с таким же уровнем производительности, как у базы данных-источника. Если вы создаете базу данных-получателя георепликации в эластичном пуле для отдельной базы данных-источника, настоятельно рекомендуем настроить для пула параметр `maxVCore`, который соответствует уровню производительности базы данных-источника. При создании базы данных-получателя георепликации в одном эластичном пуле для базы данных-источника в другом эластичном пуле настоятельно рекомендуем настроить для пулов одинаковые параметры `maxVCore`.

## <a name="using-database-copy-to-convert-a-dtu-based-database-to-a-vcore-based-database"></a>Использование копии базы данных для перевода базы данных с модели на основе единиц DTU на модель на основе виртуальных ядер

Вы можете скопировать любую базу данных с уровнем производительности на основе DTU в базу данных с уровнем производительности на основе виртуальных ядер без ограничений или соблюдения специальной последовательности, если целевой уровень производительности поддерживает максимальный размер базы данных-источника. Это связано с тем, что копия базы данных создает моментальный снимок данных на момент начала операции копирования и не выполняет синхронизацию данных между источником и целевым объектом. 

## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения о конкретных уровнях производительности и доступных размерах хранилища см. в разделах [Single database: Storage sizes and performance levels](sql-database-dtu-resource-limits.md) (Отдельная база данных: размеры хранилища и уровни производительности) и [Elastic pool: Storage sizes and performance levels](sql-database-vcore-resource-limits.md) (Эластичный пул: размеры хранилища и уровни производительности).
- См. [часто задаваемые вопросы о службе "База данных SQL"](sql-database-faq.md).
- Узнайте о [лимитах, квотах и ограничениях подписок и служб Azure](../azure-subscription-service-limits.md).
