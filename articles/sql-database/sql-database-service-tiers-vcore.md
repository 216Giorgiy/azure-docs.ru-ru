---
title: 'Служба Базы данных SQL: модель на основе виртуальных ядер | Документация Майкрософт'
description: Модель приобретения на основе виртуальных ядер позволяет независимо масштабировать вычислительные ресурсы и ресурсы хранилища, обеспечивать производительность на уровне локальной среды и оптимизировать затраты.
services: sql-database
author: CarlRabeler
ms.service: sql-database
ms.custom: DBs & servers
ms.topic: conceptual
ms.date: 08/30/2018
manager: craigg
ms.author: carlrab
ms.openlocfilehash: 8266d9e3530969154ac9c8c877badda9f8b4fed3
ms.sourcegitcommit: 1fb353cfca800e741678b200f23af6f31bd03e87
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/30/2018
ms.locfileid: "43307278"
---
# <a name="choosing-a-vcore-service-tier-compute-memory-storage-and-io-resources"></a>Выбор уровня служб для виртуальных ядер, ресурсов вычислений, памяти, хранилища и операций ввода-вывода

Модель приобретения на основе виртуальных ядер позволяет независимо масштабировать вычислительные ресурсы и ресурсы хранилища, обеспечивать производительность на уровне локальной среды и оптимизировать затраты. Она также позволяет выбрать поколение аппаратного обеспечения:
- 4-е поколение — до 24 логических объектов ЦП на базе процессоров Intel E5-2673 v3 (Haswell) 2,4 ГГц, виртуальное ядро = 1 PP (физическое ядро), 7 ГБ на ядро, подключенные SSD
- 5-е поколение — до 80 логических объектов ЦП на базе процессоров Intel E5-2673 V4 (Broadwell) 2,3 ГГц, виртуальное ядро = 1 LP (hyper-thread), 5,1 ГБ на ядро, быстрый накопитель SSD eNVM

Модель виртуального ядра также позволяет использовать [Преимущество гибридного использования Azure для SQL Server](../virtual-machines/windows/hybrid-use-benefit-licensing.md), чтобы добиться снижения затрат.

## <a name="service-tier-characteristics"></a>Характеристики уровней служб

Модель виртуального ядра обеспечивает два уровня служб: общего назначения и критически важный для бизнеса. Уровни служб отличаются диапазоном уровней производительности, структурой для обеспечения высокого уровня доступности, способом обеспечения изоляции от сбоев, типами хранилища и диапазоном операций ввода-вывода. Клиент должен отдельно настроить необходимое хранилище и период хранения резервных копий.

В следующей таблице представлены различия между этими двумя уровнями:

||**Общего назначения**|**Критически важный для бизнеса**|
|---|---|---|
|Оптимально для|Большинства рабочих нагрузок. Предлагает бюджетные сбалансированные и масштабируемые варианты ресурсов вычисления и хранилища.|Бизнес-приложений с высокими требованиями к операциям ввода-вывода. Предлагает самую высокую отказоустойчивость к сбоям благодаря использованию нескольких изолированных реплик.|
|Службы вычислений|4-е поколение: от 1 до 24 виртуальных ядер<br/>5-е поколение: от 1 до 80 виртуальных ядер|4-е поколение: от 1 до 24 виртуальных ядер<br/>5-е поколение: от 1 до 80 виртуальных ядер|
|Память|4-е поколение: 7 ГБ на ядро<br>5-е поколение: 5,1 ГБ на ядро | 4-е поколение: 7 ГБ на ядро<br>5-е поколение: 5,1 ГБ на ядро |
|служба хранилища.|[Удаленное хранилище уровня "Премиум"](../virtual-machines/windows/premium-storage.md),<br/>Отдельная база данных: 5 ГБ – 4 ТБ<br/>Управляемый экземпляр: 32 ГБ — 8 ТБ |Локальное хранилище на SSD-накопителях,<br/>Отдельная база данных: 5 ГБ – 1 ТБ<br/>Управляемый экземпляр: 32 ГБ — 4 ТБ |
|Пропускная способность ввода-вывода (приблизительно)|Отдельная база данных: 500 операций ввода-вывода в секунду на виртуальное ядро с максимальным количеством операций в секунду, равным 7000</br>Управляемый экземпляр: зависит от [размера файла](../virtual-machines/windows/premium-storage-performance.md#premium-storage-disk-sizes)|5000 операций ввода-вывода в секунду на виртуальное ядро с максимальным количеством 200 000|
|Доступность|1 реплика, отсутствие возможности масштабирования для чтения|3 реплики, 1 [реплика чтения и масштабирования](sql-database-read-scale-out.md),<br/>Высокая доступность, избыточная в пределах зоны|
|Резервные копии|[RA-GRS](../storage/common/storage-designing-ha-apps-with-ragrs.md), 7–35 дней (7 дней по умолчанию)|[RA-GRS](../storage/common/storage-designing-ha-apps-with-ragrs.md), 7–35 дней (7 дней по умолчанию)|
|В памяти|Недоступно|Поддерживаются|
|||

Дополнительные сведения см. в разделах [Ограничения ресурсов для отдельной базы данных в Базе данных SQL Azure при использовании модели приобретения на основе виртуальных ядер](sql-database-vcore-resource-limits-single-databases.md) и [Общие сведения об Управляемом экземпляре Базы данных SQL Azure (предварительная версия)](sql-database-managed-instance.md#vcore-based-purchasing-model). 

> [!IMPORTANT]
> Если вам требуется меньше одного виртуального ядра емкости вычислительных ресурсов, используйте модель приобретения на основе единиц DTU.

См. [часто задаваемые вопросы о службе "База данных SQL"](sql-database-faq.md). 

## <a name="storage-considerations"></a>Рекомендации по работе с хранилищем

Рассмотрим следующее:
- В выделенном хранилище хранятся файлы данных (MDF) и файлы журналов (LDF).
- Уровень производительности каждой отдельной базы данных поддерживает максимальный размер базы данных (размер по умолчанию — 32 ГБ).
- Когда настраиваете необходимый размер отдельной базы данных (размер MDF), для поддержки файлов LDF автоматически добавляется 30 % дополнительного места в хранилище
- Размер хранилища в управляемом экземпляре должен быть кратным 32 ГБ.
- Выбрать можно любой размер отдельной базы данных: от 10 ГБ до максимально допустимого значения
 - Для хранилища уровня "Стандартный" можно увеличить или уменьшить размер с шагом приращения в 10 ГБ.
 - Для хранилища уровня "Премиум" можно увеличить или уменьшить размер с шагом приращения в 250 ГБ.
- При использовании уровня службы "Общего назначения" `tempdb` использует подключенный диск SSD, а затраты на хранилище входят в стоимость виртуального ядра.
- При использовании уровня службы "Критически важный для бизнеса" подключенный диск SSD используется для `tempdb` и файлов MDF и LDF, а затраты на хранилище tempDB входят в стоимость виртуального ядра.

> [!IMPORTANT]
> С клиента взимается плата за общее хранилище, выделенное для MDF и LDF.

Чтобы просмотреть текущий общий размер MDF и LDF, используйте [sp_spaceused](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-spaceused-transact-sql). Чтобы отслеживать текущий размер отдельных файлов MDF и LDF, используйте [sys.database_files](https://docs.microsoft.com/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql).

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Дополнительные сведения см. в статье об [управлении файловым пространством в Базе данных SQL Azure](sql-database-file-space-management.md).

## <a name="backups-and-storage"></a>Резервные копии и хранилище

Хранение резервных копий базы данных предназначено для поддержки возможностей базы данных SQL восстановления до точки во времени (PITR) и [долгосрочного хранения резервных копий (LTR)](sql-database-long-term-retention.md). Это хранилище выделяется отдельно для каждой базы данных. За эти возможности выставляются два отдельных счета. 

- **PITR**: отдельные резервные копии базы данных автоматически копируются в [хранилище RA-GRS](../storage/common/storage-designing-ha-apps-with-ragrs.md). Размер хранилища динамически увеличивается по мере создания новых резервных копий.  Хранилище используется для полных резервных копий, созданных за неделю, разностных резервных копий, созданных за день, и резервных копий журналов транзакций, копируемых каждые 5 минут. Использование хранилища зависит от скорости изменения базы данных и периода хранения. Вы можете настроить отдельный период хранения для каждой базы данных длительностью от 7 до 35 дней. Минимальный объем хранилища, равный размеру данных, предоставляется без дополнительной оплаты. Для большинства баз данных этого объема достаточно для хранения резервных копий за 7 дней.
- **Долгосрочное хранение**. База данных SQL предоставляет возможность настройки долгосрочного периода хранения полных резервных копий до 10 лет. Если политика долгосрочно хранения включена, эти резервные копии автоматически сохраняются в хранилище RA-GRS, однако вы можете контролировать частоту их копирования. Чтобы удовлетворять различные требования к соответствию, вы можете выбрать разные периоды хранения для резервных копий, создаваемых еженедельно, ежемесячно или ежегодно. Эта конфигурация определит, какой объем хранилища будет использоваться для резервных копий долгосрочного хранения. Вы можете использовать калькулятор цен LTR, чтобы определить стоимость долгосрочного хранения резервных копий. Дополнительные сведения см. в статье [Storing Azure SQL Database Backups for up to 10 years](sql-database-long-term-retention.md) (Хранение резервных копий баз данных SQL Azure до 10 лет).

## <a name="azure-hybrid-use-benefit"></a>Программа преимуществ гибридного использования Azure

В модели приобретения на основе виртуальных ядер можно обменять имеющиеся лицензии, чтобы получить сниженные тарифы на базу данных SQL при использовании программы [Преимущества гибридного использования Azure для SQL Server](../virtual-machines/windows/hybrid-use-benefit-licensing.md). При этом благодаря локальным лицензиям SQL Server и подписке Software Assurance вы сможете сэкономить до 30 % на базу данных SQL Azure.

![цены](./media/sql-database-service-tiers/pricing.png)

## <a name="migration-from-dtu-model-to-vcore-model"></a>Переход с модели DTU на модель с виртуальными ядрами

### <a name="migration-of-single-databases-with-geo-replication-links"></a>Перемещение отдельных баз данных со связями георепликации

Переход с модели на основе единиц DTU на модель на основе виртуальных ядер аналогичен повышению или понижению уровня связей георепликации между базами данных уровня "Стандартный" и "Премиум". При этом не нужно завершать георепликацию, однако пользователь должен соблюдать правила последовательности. При повышении сначала повысьте уровень производительности базы данных-получателя, а затем — уровень базы данных-источника. При понижении следует действовать в обратном порядке: сначала нужно понизить уровень производительности базы данных-источника, а после этого — базы данных-получателя. 

При использовании георепликации между двумя эластичными пулами рекомендуем указать один пул как первичный, а другой — как вторичный. В этом случае при перемещении эластичных пулов следует учитывать такую конфигурацию.  Однако технически возможно, что эластичный пул содержит как первичные, так и вторичные базы данных. В таком случае для правильного перемещения вы должны рассматривать пул с более высоким показателем использования как "первичный" и соответствующим образом следовать правилам последовательности.  

В следующей таблице приведены рекомендации для конкретных сценариев перемещения: 

|Текущий уровень служб|Целевой уровень служб|Тип перемещения|Действия пользователя|
|---|---|---|---|
|Стандартная|Универсальные|Горизонтальный|Можно выполнять перемещение в любом порядке, но необходимо обеспечить соответствующий размер виртуального ядра*|
|Премиум|Критически важный для бизнеса|Горизонтальный|Можно выполнять миграцию в любом порядке, но необходимо обеспечить соответствующий размер виртуального ядра*|
|Стандартная|Критически важный для бизнеса|Обновление|Сначала необходимо перенести базу данных-получатель|
|Критически важный для бизнеса|Стандартная|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Премиум|Универсальные|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Универсальные|Премиум|Обновление|Сначала необходимо перенести базу данных-получатель|
|Критически важный для бизнеса|Универсальные|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Универсальные|Критически важный для бизнеса|Обновление|Сначала необходимо перенести базу данных-получатель|
||||

\* Для каждых 100 единиц DTU уровня "Стандартный" и каждых 125 единиц DTU уровня "Премиум" требуется по меньшей мере 1 виртуальное ядро.

### <a name="migration-of-failover-groups"></a>Перемещение групп отработки отказа 

Перемещение групп отработки отказа с несколькими базами данных требует отдельного перемещения базы данных-источника и базы данных-получателя. Во время этого процесса применяются те же рекомендации и правила последовательности. После перевода базы данных на модель на основе виртуальных ядер в группе отработки отказа останутся те же параметры политики. 

### <a name="creation-of-a-geo-replication-secondary"></a>Создание базы данных-получателя георепликации

Вы можете создать базу данных-получателя георепликации, используя тот же уровень служб, что и у базы данных-источника. Для базы данных с высокой скоростью создания журналов рекомендуется создавать базу данных-получатель с таким же уровнем производительности, как у базы данных-источника. Если вы создаете базу данных-получатель георепликации в эластичном пуле для отдельной базы данных-источника, рекомендуем настроить для пула параметр `maxVCore`, который соответствует уровню производительности базы данных-источника. При создании базы данных-получателя георепликации в одном эластичном пуле для базы данных-источника в другом эластичном пуле рекомендуется настроить для пулов одинаковые параметры `maxVCore`.

### <a name="using-database-copy-to-convert-a-dtu-based-database-to-a-vcore-based-database"></a>Использование копии базы данных для перевода базы данных с модели на основе единиц DTU на модель на основе виртуальных ядер

Вы можете скопировать любую базу данных с уровнем производительности на основе DTU в базу данных с уровнем производительности на основе виртуальных ядер без ограничений или соблюдения специальной последовательности, если целевой уровень производительности поддерживает максимальный размер базы данных-источника. Это связано с тем, что копия базы данных создает моментальный снимок данных на момент начала операции копирования и не выполняет синхронизацию данных между источником и целевым объектом. 

## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения о конкретных уровнях производительности и доступных размерах хранилища для отдельной базы данных см. в разделе [Ограничения ресурсов на основе виртуальных ядер SQL Database для отдельных баз данных](sql-database-vcore-resource-limits-single-databases.md#single-database-storage-sizes-and-performance-levels).
- Дополнительные сведения о конкретных уровнях производительности и доступных размерах хранилища для эластичных пулов см. в разделе [Ограничения ресурсов на основе виртуальных ядер SQL Database для эластичных пулов](sql-database-vcore-resource-limits-elastic-pools.md#elastic-pool-storage-sizes-and-performance-levels).
