---
title: 'Служба Базы данных SQL: модель на основе виртуальных ядер | Документация Майкрософт'
description: Модель приобретения на основе виртуальных ядер (предварительная версия) позволяет независимо масштабировать вычислительные ресурсы и ресурсы хранилища, обеспечивать производительность на уровне локальной среды и оптимизировать затраты.
services: sql-database
author: CarlRabeler
ms.service: sql-database
ms.custom: DBs & servers
ms.topic: conceptual
ms.date: 07/23/2018
manager: craigg
ms.author: carlrab
ms.openlocfilehash: dec995d0b9177e4fb88c836c3ea0fef25a3b3ba3
ms.sourcegitcommit: 0b4da003fc0063c6232f795d6b67fa8101695b61
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/05/2018
ms.locfileid: "37859941"
---
# <a name="choosing-a-vcore-service-tier-compute-memory-storage-and-io-resources"></a>Выбор уровня служб для виртуальных ядер, ресурсов вычислений, памяти, хранилища и операций ввода-вывода

Уровни служб отличаются диапазоном уровней производительности, структурой для обеспечения высокого уровня доступности, способом обеспечения изоляции от сбоев, типами хранилища и диапазоном операций ввода-вывода. Клиент должен отдельно настроить необходимое хранилище и период хранения резервных копий. Благодаря модели на основе виртуальных ядер отдельные базы данных и эластичные пулы обеспечивают экономию до 30 % при использовании [программы преимущества гибридного использования Azure для SQL Server](../virtual-machines/windows/hybrid-use-benefit-licensing.md).

В следующей таблице представлены различия между этими двумя уровнями:

||**Общего назначения**|**Критически важный для бизнеса**|
|---|---|---|
|Оптимально для|Большинства рабочих нагрузок. Предлагает бюджетные сбалансированные и масштабируемые варианты ресурсов вычисления и хранилища.|Бизнес-приложений с высокими требованиями к операциям ввода-вывода. Предлагает самую высокую отказоустойчивость к сбоям благодаря использованию нескольких изолированных реплик.|
|Службы вычислений|1–80 виртуальных ядер 4-го и 5-го поколения |1–80 виртуальных ядер 4-го и 5-го поколения|
|Память|4-е поколение: 7 ГБ на ядро<br>5-е поколение: 5,5 ГБ на ядро | 4-е поколение: 7 ГБ на ядро<br>5-е поколение: 5,5 ГБ на ядро |
|Служба хранилища|Удаленное хранилище уровня "Премиум", 5 ГБ–4 ТБ|Локальное хранилище на дисках SSD по 5 ГБ, 4 ТБ|
|Пропускная способность ввода-вывода (приблизительно)|500 операций ввода-вывода в секунду на виртуальное ядро с максимальным количеством 7000|5000 операций ввода-вывода в секунду на виртуальное ядро с максимальным количеством 200 000|
|Доступность|1 реплика, отсутствие возможности масштабирования для чтения|3 реплики, 1 операция [масштабирования для чтения](sql-database-read-scale-out.md), избыточная в пределах зоны высокая доступность|
|Резервные копии|Геоизбыточное хранилище с доступом на чтение, 7–35 дней (7 дней по умолчанию)|Геоизбыточное хранилище с доступом на чтение 7–35 дней (7 дней по умолчанию)*|
|В памяти|Недоступно|Поддерживаются|
|||

\* На стадии предварительной версии период хранения резервных копий нельзя настроить, он имеет фиксированную продолжительность — 7 дней.

> [!IMPORTANT]
> Если вам требуется меньше одного виртуального ядра емкости вычислительных ресурсов, используйте модель приобретения на основе единиц DTU.

См. [часто задаваемые вопросы о службе "База данных SQL"](sql-database-faq.md). 

## <a name="storage-considerations"></a>Рекомендации по работе с хранилищем

Рассмотрим следующее:
- В выделенном хранилище хранятся файлы данных (MDF) и файлы журналов (LDF).
- Каждый уровень производительности поддерживает максимальный размер базы данных (размер по умолчанию — 32 ГБ).
- Когда вы настраиваете необходимый размер базы данных (размер MDF), для поддержки файлов LDF автоматически добавляются 30 % места в хранилище.
- Вы можете выбрать любой размер базы данных: от 10 ГБ до максимально допустимого значения.
 - Для хранилища уровня "Стандартный" можно увеличить или уменьшить размер с шагом приращения в 10 ГБ.
 - Для хранилища уровня "Премиум" можно увеличить или уменьшить размер с шагом приращения в 250 ГБ.
- При использовании уровня службы "Общего назначения" `tempdb` использует подключенный диск SSD, а затраты на хранилище входят в стоимость виртуального ядра.
- При использовании уровня службы "Критически важный для бизнеса" подключенный диск SSD используется для `tempdb` и файлов MDF и LDF, а затраты на хранилище tempDB входят в стоимость виртуального ядра.

> [!IMPORTANT]
> С клиента взимается плата за общее хранилище, выделенное для MDF и LDF.

Чтобы просмотреть текущий общий размер MDF и LDF, используйте [sp_spaceused](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-spaceused-transact-sql). Чтобы отслеживать текущий размер отдельных файлов MDF и LDF, используйте [sys.database_files](https://docs.microsoft.com/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql).

## <a name="backups-and-storage"></a>Резервные копии и хранилище

Хранилище для резервных копий базы данных выделяется для поддержки следующих возможностей базы данных SQL: восстановления до точки во времени (PITR) и долгосрочного хранения (LTR). Это хранилище выделяется отдельно для каждой базы данных. За эти возможности выставляются два отдельных счета. 

- **Восстановление до точки во времени**. Резервные копии отдельной базы данных автоматически копируются в хранилище RA-GRS. Размер хранилища динамически увеличивается по мере создания новых резервных копий.  Хранилище используется для полных резервных копий, созданных за неделю, разностных резервных копий, созданных за день, и резервных копий журналов транзакций, копируемых каждые 5 минут. Использование хранилища зависит от скорости изменения базы данных и периода хранения. Вы можете настроить отдельный период хранения для каждой базы данных длительностью от 7 до 35 дней. Минимальный объем хранилища, равный размеру данных, предоставляется без дополнительной оплаты. Для большинства баз данных этого объема достаточно для хранения резервных копий за 7 дней.
- **Долгосрочное хранение**. База данных SQL предоставляет возможность настройки долгосрочного периода хранения полных резервных копий до 10 лет. Если политика долгосрочно хранения включена, эти резервные копии автоматически сохраняются в хранилище RA-GRS, однако вы можете контролировать частоту их копирования. Чтобы удовлетворять различные требования к соответствию, вы можете выбрать разные периоды хранения для резервных копий, создаваемых еженедельно, ежемесячно или ежегодно. Эта конфигурация определит, какой объем хранилища будет использоваться для резервных копий долгосрочного хранения. Вы можете использовать калькулятор цен LTR, чтобы определить стоимость долгосрочного хранения резервных копий. Дополнительные сведения см. в статье [Storing Azure SQL Database Backups for up to 10 years](sql-database-long-term-retention.md) (Хранение резервных копий баз данных SQL Azure до 10 лет).

## <a name="azure-hybrid-use-benefit"></a>Программа преимуществ гибридного использования Azure

В модели приобретения на основе виртуальных ядер (предварительная версия) можно обменять имеющиеся лицензии, чтобы получить сниженные тарифы на базу данных SQL при использовании программы [Преимущества гибридного использования Azure для SQL Server](../virtual-machines/windows/hybrid-use-benefit-licensing.md). При этом благодаря локальным лицензиям SQL Server и подписке Software Assurance вы сможете сэкономить до 30 % на базу данных SQL Azure.

![цены](./media/sql-database-service-tiers/pricing.png)

## <a name="migration-of-single-databases-with-geo-replication-links"></a>Перемещение отдельных баз данных со связями георепликации

Переход с модели на основе единиц DTU на модель на основе виртуальных ядер аналогичен повышению или понижению уровня связей георепликации между базами данных уровня "Стандартный" и "Премиум". При этом не нужно завершать георепликацию, однако пользователь должен соблюдать правила последовательности. При повышении сначала повысьте уровень производительности базы данных-получателя, а затем — уровень базы данных-источника. При понижении следует действовать в обратном порядке: сначала нужно понизить уровень производительности базы данных-источника, а после этого — базы данных-получателя. 

При использовании георепликации между двумя эластичными пулами рекомендуем указать один пул как первичный, а другой — как вторичный. В этом случае при перемещении эластичных пулов следует учитывать такую конфигурацию.  Однако технически возможно, что эластичный пул содержит как первичные, так и вторичные базы данных. В таком случае для правильного перемещения вы должны рассматривать пул с более высоким показателем использования как "первичный" и соответствующим образом следовать правилам последовательности.  

В следующей таблице приведены рекомендации для конкретных сценариев перемещения: 

|Текущий уровень служб|Целевой уровень служб|Тип перемещения|Действия пользователя|
|---|---|---|---|
|Стандартная|Универсальные|Горизонтальный|Можно выполнять перемещение в любом порядке, но необходимо обеспечить соответствующий размер виртуального ядра*|
|Премиум|Критически важный для бизнеса|Горизонтальный|Можно выполнять миграцию в любом порядке, но необходимо обеспечить соответствующий размер виртуального ядра*|
|Стандартная|Критически важный для бизнеса|Обновление|Сначала необходимо перенести базу данных-получатель|
|Критически важный для бизнеса|Стандартная|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Премиум|Универсальные|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Универсальные|Премиум|Обновление|Сначала необходимо перенести базу данных-получатель|
|Критически важный для бизнеса|Универсальные|Понижение уровня|Сначала необходимо перенести базу данных-источник|
|Универсальные|Критически важный для бизнеса|Обновление|Сначала необходимо перенести базу данных-получатель|
||||

\* Для каждых 100 единиц DTU уровня "Стандартный" и каждых 125 единиц DTU уровня "Премиум" требуется по меньшей мере 1 виртуальное ядро.

## <a name="migration-of-failover-groups"></a>Перемещение групп отработки отказа 

Перемещение групп отработки отказа с несколькими базами данных требует отдельного перемещения базы данных-источника и базы данных-получателя. Во время этого процесса применяются те же рекомендации и правила последовательности. После перевода базы данных на модель на основе виртуальных ядер в группе отработки отказа останутся те же параметры политики. 

## <a name="creation-of-a-geo-replication-secondary"></a>Создание базы данных-получателя георепликации

Вы можете создать базу данных-получателя георепликации, используя тот же уровень служб, что и у базы данных-источника. Для базы данных с высокой скоростью создания журналов рекомендуется создавать базу данных-получатель с таким же уровнем производительности, как у базы данных-источника. Если вы создаете базу данных-получатель георепликации в эластичном пуле для отдельной базы данных-источника, рекомендуем настроить для пула параметр `maxVCore`, который соответствует уровню производительности базы данных-источника. При создании базы данных-получателя георепликации в одном эластичном пуле для базы данных-источника в другом эластичном пуле рекомендуется настроить для пулов одинаковые параметры `maxVCore`.

## <a name="using-database-copy-to-convert-a-dtu-based-database-to-a-vcore-based-database"></a>Использование копии базы данных для перевода базы данных с модели на основе единиц DTU на модель на основе виртуальных ядер

Вы можете скопировать любую базу данных с уровнем производительности на основе DTU в базу данных с уровнем производительности на основе виртуальных ядер без ограничений или соблюдения специальной последовательности, если целевой уровень производительности поддерживает максимальный размер базы данных-источника. Это связано с тем, что копия базы данных создает моментальный снимок данных на момент начала операции копирования и не выполняет синхронизацию данных между источником и целевым объектом. 

## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения о конкретных уровнях производительности и доступных размерах хранилища для отдельной базы данных см. в разделе [Ограничения ресурсов на основе виртуальных ядер SQL Database для отдельных баз данных](sql-database-vcore-resource-limits-single-databases.md#single-database-storage-sizes-and-performance-levels).
- Дополнительные сведения о конкретных уровнях производительности и доступных размерах хранилища для эластичных пулов см. в разделе [Ограничения ресурсов на основе виртуальных ядер SQL Database для эластичных пулов](sql-database-vcore-resource-limits-elastic-pools.md#elastic-pool-storage-sizes-and-performance-levels).
