<properties 
   pageTitle="Мастер миграции SQL Azure | Майкрософт" 
   description="База данных SQL Microsoft Azure, перенос базы данных, импорт базы данных, экспорт базы данных, мастер миграции" 
   services="sql-database" 
   documentationCenter="" 
   authors="pehteh" 
   manager="jeffreyg" 
   editor="monicar"/>


<tags
   ms.service="sql-database"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-management" 
   ms.date="07/01/2015"
   ms.author="pehteh"/>


# Как использовать мастер миграции SQL Azure


![замещающий текст](./media/sql-database-migration-wizard/01SAMWDiagram.png)


Этот вариант миграции подразумевает создание мастером миграции SQL Azure сценария T-SQL из базы данных-источника, которая затем преобразуется мастером, чтобы сделать его совместимым с Базой данных SQL, и последующее подключение к Базе данных SQL Azure для выполнения сценария с пустой базой данных SQL Azure. Сценарии могут создаваться только со схемой или могут содержать данные в формате BCP. Мастер также позволяет включить в сценарий или исключить из него определенные объекты из базы данных.


Обратите внимание, что не все несовместимые схемы, которые могут быть обнаружены с помощью мастера, подлежат обработке с помощью его встроенных средств преобразования. Если имеются несовместимые сценарии, которые не удается обработать, то о них будет сообщено как об ошибках. Такие сценарии будут внедрены в созданный сценарий с соответствующими комментариями. В этом случае сценарий следует сохранить и вручную изменить перед отправкой в Базу данных SQL Azure. Если требуются изменения, сценарий можно сохранить и отредактировать в среде SSMS или с помощью средств SQL Server в Visual Studio, затем, обеспечив совместимость сценария, его можно выполнить извне в отношении Базы данных SQL Azure.


> **Примечание.** В качестве дополнения к этому варианту миграции, если обнаружено много ошибок, устранить которые будет непросто, файл скрипта можно импортировать в проект базы данных в Visual Studio. Если в качестве целевого объекта проекта выбрана База данных SQL версии 12, можно создать проект и постепенно устранять ошибки с помощью инструментов SQL Server в Visual Studio. Устранив все ошибки в схеме, ее можно опубликовать в копии базы данных-источника, а затем воспользоваться средой SSMS для развертывания базы данных или для ее импорта в базу данных SQL Azure и экспорта из нее, как описано в первом варианте.


## Загрузка SQLAzureMW.exe


Мастер миграции SQL Azure можно скачать с сайта CodePlex:


[Загрузка SQLAzureMW.exe](http://sqlazuremw.codeplex.com/)


## Этапы миграции


&nbsp;1. Подготовьте новую базу данных на новом сервере в Базе данных SQL или на существующем сервере, который обновлен в соответствии с инструкциями, указанными ранее. Сценарий миграции, создаваемый в данном варианте для этой базы данных, будет выполняться на последнем этапе.


&nbsp;2. Откройте мастер миграции и установите переключатель **Analyze/Migrate a Database** (Анализ/перенос базы данных) и выберите в раскрывающемся списке **Target Server** (Целевой сервер) Базу данных SQL Azure версии 12, а затем нажмите кнопку **Next** (Далее).


![замещающий текст](./media/sql-database-migration-wizard/02MigrationWizard.png)


&nbsp;3. На следующей странице нажмите кнопку **Connect to Server** (Подключиться к серверу) и укажите информацию о подключении к исходному серверу. Укажите базу данных-источник в диалоговом окне настройки подключения или подключитесь к серверу и выберите базу данных-источник из списка доступных баз данных.


![замещающий текст](./media/sql-database-migration-wizard/03MigrationWizard.png)


&nbsp;4. На следующей странице "Choose Objects" (Выбор объектов) можно установить переключатель "Script all database object" (Добавить в сценарий все объекты базы данных) (по умолчанию) или переключатель "Select specific database objects" (Выбрать отдельные объекты базы данных). Рекомендуется сначала добавить в сценарий все объекты при первом проходе, а затем при необходимости вернуться к этому этапу и исключить требуемые объекты, если мастер сообщит об ошибках создания сценария или преобразования. Сначала мастер добавляет в сценарий объекты в базе данных (с помощью объектов SMO), а затем выполняет последующую обработку созданного сценария: проводит ряд проверок с использованием регулярных выражений и правил преобразования.


![замещающий текст](./media/sql-database-migration-wizard/04MigrationWizard.png)


&nbsp;5. Нажмите кнопку "Advanced" (Дополнительно), чтобы просмотреть параметры конфигурации, используемые мастером. При первом проходе, особенно для больших баз данных, необходимо задать для параметра **Script Table/Data** (Таблица/данные сценария) значение "Table Schema Only" (Только схема таблицы), убедиться, что для параметра **Target Server** (Целевой сервер) выбрано значение "Microsoft Azure SQL Database V12" (База данных SQL Microsoft Azure версии 12), а для параметра **Compatibility Checks** (Проверки совместимости) — значение "Override: Perform All Compatibility Checks" (Переопределение: выполнять все проверки совместимости).


![замещающий текст](./media/sql-database-migration-wizard/05MigrationWizard.png)


&nbsp;6. Нажмите кнопку **Next** (Далее), чтобы просмотреть выбранные параметры, а затем снова нажмите кнопку **Next** (Далее), чтобы создать сценарий и преобразовать его. Просмотреть сценарий можно на вкладке "SQL Script" (Сценарий SQL).


&nbsp;7. Если схема несовместима с Базой данных SQL и ее невозможно преобразовать с помощью мастера, то при создании сценария будут обозначены соответствующие ошибки. На снимке экрана ниже показано, что в процессе преобразования были обнаружены проблемы с одной из хранимых процедур. В этом случае в процедуре используется полнотекстовый поиск, который еще не поддерживается в V12 (соответствующая поддержка будет реализована в более поздней версии).


![замещающий текст](./media/sql-database-migration-wizard/06MigrationWizard.png)


- В зависимости от оценки ошибок можно вернуться в мастер, исключить объекты, вызывающие проблемы, и повторно создать скрипт. При рассмотрении способа устранения ошибок учитывайте влияние на другие объекты в базе данных, а также на приложения, которые используют базу данных.
- Если в скрипте имеются ошибки, которые необходимо исправить, на вкладке "Скрипт SQL" можно сохранить файл скрипта только со схемой, а затем изменить скрипт в предпочтительном редакторе, чтобы исправить ошибки перед его выполнением вне SAMW в новой базе данных, созданной на этапе 1. Если сценарий слишком большой или в нем имеется большое количество ошибок, следует использовать третий вариант. Обратите внимание, что при импорте файла созданного сценария в Visual Studio импорт из файла SQL может занять значительно больше времени, чем импорт из базы данных, как описано в третьем варианте. 


&nbsp;8. При отсутствии ошибок или после устранения вами всех источников ошибок, возникших в результате создания сценария, можно нажать кнопку **Next** (Далее). Затем на следующей странице нажмите кнопку **Connect to Server** (Подключиться к серверу) для подключения к серверу Базы данных SQL Azure, созданному на этапе 1.


![замещающий текст](./media/sql-database-migration-wizard/07MigrationWizard.png)


&nbsp;9. На следующем этапе необходимо выбрать базу данных, для которой будет выполняться сценарий. Будут перечислены все базы данных, существующие на сервере. Выберите базу данных, созданную на этапе 1. Для выполнения этой операции база данных должна быть пустой и иметь соответствующую ценовую категорию. При необходимости на этом этапе можно создать базу данных с помощью мастера. Для этого нажмите кнопку "Create Database" (Создать базу данных), чтобы настроить и создать ее. Сведения о выборе уровня производительности во время миграции см. в разделе "Начало работы". После создания базы данных выберите ее и продолжите.


&nbsp;10. Выбрав пустую базу данных, нажмите кнопку **Next** (Далее) и подтвердите выполнение сценария для завершения миграции.

 

<!---HONumber=August15_HO6-->