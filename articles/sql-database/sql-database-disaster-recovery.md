<properties 
   pageTitle="Аварийное восстановление Базы данных SQL" 
   description="Узнайте, как функции активной георепликации и геовосстановления базы данных SQL Azure помогают восстановить базу данных после сбоя в региональном центре обработки данных." 
   services="sql-database" 
   documentationCenter="" 
   authors="carlrabeler" 
   manager="jhubbard" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-management" 
   ms.date="05/10/2016"
   ms.author="carlrab"/>

# Восстановление базы данных SQL Azure или переход на базу данных-получатель при отказе

База данных SQL Azure предоставляет следующие возможности восстановления после сбоя:

- [Активная георепликация](sql-database-geo-replication-overview.md)
- [Геовосстановление](sql-database-geo-restore.md)

Информацию о подготовке к аварии и времени восстановления базы данных см. на нашей странице [проекта обеспечения непрерывности бизнес-процессов](sql-database-business-continuity-design.md).

## Время начала восстановления

Операция восстановления влияет на приложение. Для выполнения этой операции необходимо изменить строку подключения SQL, и она может привести к безвозвратной потере данных. Поэтому ее следует выполнять, только если сбой будет длиться дольше, чем целевое время восстановления (RTO) приложения. При развертывании приложения в рабочей среде следует выполнять регулярное отслеживание работоспособности приложений и использовать следующие точки данных для подтверждения гарантированного восстановления.

1.	Постоянная ошибка подключения из уровня приложения к базе данных.
2.	На портале Azure отображается предупреждение о происшествии с большой степенью воздействия в регионе.
3.	Сервер базы данных SQL Azure работает со снижением производительности. 

В зависимости от устойчивости приложения к простоям базы данных и возможных последствий для бизнеса можно рассмотреть следующие варианты восстановления.

## Ожидание восстановления служб

Группы Azure прилагают все усилия для максимально быстрого восстановления работоспособности служб, но в зависимости от причины это может занимать часы и даже дни. Если длительный простой некритичен для вашего приложения, вы можете просто дождаться завершения восстановления. В этом случае вам не нужно предпринимать какие-либо действия. Текущее состояние служб можно просмотреть на [панели мониторинга работоспособности служб Azure](https://azure.microsoft.com/status/). После восстановления региона ваше приложение снова станет доступным.

## Отработка отказа с помощью геореплицируемой базы данных-получателя

Если простой в работе приложения может иметь последствия для вашего бизнеса, в приложении следует использовать геореплицируемые базы данных. Это позволит приложению в случае сбоя быстро восстановить доступность в другом регионе. Узнайте, как [настроить георепликацию](sql-database-geo-replication-portal.md).

Для восстановления доступности баз данных необходимо инициировать переход на геореплицированную базу данных-получатель с помощью одного из поддерживаемых методов.


Чтобы настроить переход на геореплицированную базу данных-получатель, используйте одно из следующих руководств.

- [Настройка георепликации для базы данных SQL Azure с помощью портала Azure](sql-database-geo-replication-portal.md).
- [Настройка георепликации базы данных SQL Azure с помощью PowerShell](sql-database-geo-replication-powershell.md).
- [Настройка георепликации базы данных SQL Azure с помощью Transact-SQL](sql-database-geo-replication-transact-sql.md). 



## Восстановление с использованием геовосстановления

Если простой в работе приложения не скажется на вашем бизнесе, в качестве метода восстановления баз данных приложения можно использовать геовосстановление. Эта функция создает копию базы данных из последней геоизбыточной резервной копии.

Чтобы настроить геовосстановление базы данных в новом регионе, используйте одно из следующих руководств.

- [Геовосстановление базы данных SQL Azure из геоизбыточной резервной копии с помощью портала Azure](sql-database-geo-restore-portal.md).
- [Восстановление базы данных SQL Azure из геоизбыточной резервной копии с помощью PowerShell](sql-database-geo-restore-powershell.md). 


## Настройка базы данных после восстановления

Если для восстановления приложения после сбоя вы используете геореплицированную отработку отказа или методы геовосстановления, убедитесь, что подключение к новым базам данных настроено надлежащим образом. В противном случае вы не сможете восстановить нормальную работу приложения. Ниже приведен контрольный список задач для подготовки восстановленной базы данных к использованию в рабочей среде.

### Обновление строк подключения

Так как восстановленная база данных будет находиться на другом сервере, измените строку подключения в приложении, чтобы она ссылалась на этот сервер.

Дополнительные сведения об изменении строк подключения см. в разделе о соответствующем языке разработки для вашей [библиотеки подключений](sql-database-libraries.md).

### Настройка правил брандмауэра

Убедитесь, что правила брандмауэра, настроенные на сервере и в базе данных, соответствуют правилам, настроенным на основном сервере и в базе данных-источнике. Дополнительные сведения см. в статье [Практическое руководство. Настройка параметров брандмауэра для Базы данных SQL](sql-database-configure-firewall-settings.md).


### Настройка учетных данных и пользователей базы данных

Убедитесь, что все учетные данные, используемые приложением, существуют на сервере с восстановленной базой данных. Дополнительные сведения см. в статье об управлении безопасностью во время аварийного восстановления. Дополнительные сведения см. в статье [Настройки безопасности для стандартной и активной георепликации](sql-database-geo-replication-security-config.md).

>[AZURE.NOTE] Если для возобновления работы после сбоя вы используете вариант с геовосстановлением, настраивайте на сервере правила брандмауэра и учетные данные на этапе отработки аварийного восстановления. Таким образом сервер-источник гарантированно будет доступен, и вы сможете получить его конфигурацию. Поскольку при геовосстановлении используются резервные копии базы данных, конфигурация уровня сервера может быть недоступна во время сбоя. После отработки восстановленные базы данных можно удалить. Сервер и его конфигурацию не удаляйте, так как они потребуются при восстановлении. Дополнительные сведения об отработке аварийного восстановления см. [здесь](sql-database-disaster-recovery-drills.md).

### Настройка оповещений телеметрии

Убедитесь, что существующие настройки правил оповещения обновлены. Они должны соответствовать восстановленной базе данных и другому серверу.

Подробнее о правилах генерации оповещений базы данных см. в разделах [Получение уведомлений об оповещениях](../azure-portal/insights-receive-alert-notifications.md) и [Получение информации о работоспособности службы](../azure-portal/insights-service-health.md).

### Включение аудита

Если для доступа к базе данных требуется аудит, то после восстановления базы данных необходимо включить аудит. На необходимость аудита указывает использование в клиентских приложениях строк защищенного подключения в виде *.database.secure.windows.net. Дополнительные сведения см. в статье [Приступая к работе с аудитом базы данных SQL](sql-database-auditing-get-started.md).




## Дополнительные ресурсы


- [Обзор. Непрерывность облачных бизнес-процессов и аварийное восстановление баз данных с базой данных SQL](sql-database-business-continuity.md)
- [Обзор. Функция восстановления до точки во времени в Базе данных SQL](sql-database-point-in-time-restore.md)
- [Геовосстановление](sql-database-geo-restore.md)
- [Активная георепликация](sql-database-geo-replication-overview.md)
- [Проектирование приложений для аварийного восстановления в облаке](sql-database-designing-cloud-solutions-for-disaster-recovery.md)
- [Финализация восстановленной Базы данных SQL Azure](sql-database-recovered-finalize.md)
- [Настройки безопасности для георепликации](sql-database-geo-replication-security-config.md)
- [Часто задаваемые вопросы о непрерывности бизнес-процессов и аварийном восстановлении в базах данных SQL](sql-database-bcdr-faq.md)

<!---HONumber=AcomDC_0615_2016-->