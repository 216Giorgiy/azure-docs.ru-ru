---
title: Аварийное восстановление базы данных SQL | Microsoft Docs
description: Узнайте, как функции активной георепликации и геовосстановления базы данных SQL Azure помогают восстановить базу данных после сбоя в региональном центре обработки данных.
services: sql-database
documentationcenter: ''
author: CarlRabeler
manager: jhubbard
editor: monicar

ms.service: sql-database
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/20/2016
ms.author: carlrab

---
# Восстановление базы данных SQL Azure или переход на базу данных-получатель при отказе
База данных SQL Azure предоставляет следующие возможности восстановления после сбоя:

* [Активная георепликация](sql-database-geo-replication-overview.md)
* [Геовосстановление](sql-database-recovery-using-backups.md#point-in-time-restore)

Чтобы узнать о сценариях непрерывности бизнес-процессов и функциях, которые их обеспечивают, ознакомьтесь с [непрерывностью бизнес-процессов](sql-database-business-continuity.md).

### Подготовка к событию сбоя
Для успешного восстановления в другой регион с помощью активной георепликации или геоизбыточных резервных копий необходимо подготовить сервер в другом центре обработки данных, который в случае сбоя станет новым сервером-источником, если это будет необходимо. Следует также задокументировать и внедрить четко определенные инструкции, чтобы обеспечить отсутствие проблем при восстановлении. Эти подготовительные действия приведены ниже.

* Определите в другом регионе логический сервер, который станет новым сервером-источником. При использовании активной георепликации это будет по крайней мере один сервер и, возможно, еще по одному для каждого сервера-получателя. При использовании геовосстановления обычно это сервер в [сопряженном регионе](../best-practices-availability-paired-regions.md) региона, в котором расположена база данных.
* Идентифицируйте и при необходимости определите правила брандмауэра уровня сервера, требуемые пользователям для доступа к новой базе данных-источнику.
* Определите, как пользователи будут перенаправляться к новому серверу-источнику: например, изменяя строки подключения или записи DNS.
* Определите и при необходимости создайте имена для входа, которые должны присутствовать в базе данных master на новом сервере-источнике, и убедитесь, что эти имена для входа имеют соответствующие разрешения в базе данных master, если таковые имеются. Дополнительные сведения см. в разделе [Как управлять безопасностью базы данных SQL после аварийного восстановления](sql-database-geo-replication-security-config.md).
* Определите правила генерации оповещений, которые потребуется обновить для сопоставления с новой базой данных-источником.
* Задокументируйте конфигурацию аудита текущей базы данных-источника.
* Выполните [отработку аварийного восстановления](sql-database-disaster-recovery-drills.md). Чтобы сымитировать сбой для географического восстановления, можно удалить или переименовать исходную базу данных, что приведет к сбою подключения приложения. Чтобы сымитировать сбой для активной георепликации, можно отключить веб-приложение или виртуальную машину, подключенную к базе данных, или отработать отказ базы данных, вызвать сбой подключения приложения.

## Время начала восстановления
Операция восстановления влияет на приложение. Для ее выполнения необходимо изменить строку подключения SQL или перенаправление с помощью DNS, что может привести к безвозвратной потере данных. Поэтому восстановление следует выполнять, только если сбой будет длиться дольше, чем целевое время восстановления приложения. При развертывании приложения в рабочей среде следует выполнять регулярное отслеживание работоспособности приложений и использовать следующие точки данных для подтверждения гарантированного восстановления.

1. Постоянная ошибка подключения из уровня приложения к базе данных.
2. На портале Azure отображается оповещение о происшествии с большой степенью воздействия в регионе.
3. Сервер базы данных SQL Azure работает со снижением функциональности.

В зависимости от устойчивости приложения к простоям базы данных и возможных последствий для бизнеса можно рассмотреть следующие варианты восстановления.

Для получения последней геореплицированной точки восстановления используйте операцию [получения восстанавливаемой базы данных](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*).

## Ожидание восстановления служб
Группы Azure прилагают все усилия для максимально быстрого восстановления работоспособности служб, но в зависимости от причины это может занимать часы и даже дни. Если длительный простой некритичен для вашего приложения, вы можете просто дождаться завершения восстановления. В этом случае вам не нужно предпринимать какие-либо действия. Текущее состояние служб можно просмотреть на [панели мониторинга работоспособности служб Azure](https://azure.microsoft.com/status/). После восстановления региона ваше приложение снова станет доступным.

## Отработка отказа с помощью геореплицируемой базы данных-получателя
Если простой в работе приложения может иметь последствия для вашего бизнеса, в приложении следует использовать геореплицируемые базы данных. Это позволит приложению в случае сбоя быстро восстановить доступность в другом регионе. Узнайте, как [настроить георепликацию](sql-database-geo-replication-portal.md).

Для восстановления доступности баз данных необходимо инициировать переход на геореплицированную базу данных-получатель с помощью одного из поддерживаемых методов.

Чтобы настроить переход на геореплицированную базу данных-получатель, используйте одно из следующих руководств.

* [Настройка георепликации для базы данных SQL Azure с помощью портала Azure.](sql-database-geo-replication-portal.md)
* [Настройка георепликации базы данных SQL Azure с помощью PowerShell.](sql-database-geo-replication-powershell.md)
* [Настройка георепликации базы данных SQL Azure с помощью Transact-SQL.](sql-database-geo-replication-transact-sql.md)

## Восстановление с использованием геовосстановления
Если простой в работе приложения не скажется на вашем бизнесе, в качестве метода восстановления баз данных приложения можно использовать геовосстановление. Эта функция создает копию базы данных из последней геоизбыточной резервной копии.

Чтобы настроить геовосстановление базы данных в новом регионе, используйте одно из следующих руководств.

* [Геовосстановление базы данных SQL Azure из геоизбыточной резервной копии с помощью портала Azure.](sql-database-geo-restore-portal.md)
* [Восстановление базы данных SQL Azure из геоизбыточной резервной копии с помощью PowerShell.](sql-database-geo-restore-powershell.md)

## Настройка базы данных после восстановления
Если для восстановления после сбоя вы используете отработку отказа георепликации или геовосстановление, убедитесь, что подключение к новым базам данных настроено надлежащим образом. В противном случае вы не сможете восстановить нормальную работу приложения. Ниже приведен контрольный список задач для подготовки восстановленной базы данных к использованию в рабочей среде.

### Обновление строк подключения
Так как восстановленная база данных будет находиться на другом сервере, измените строку подключения в приложении, чтобы она указывала на этот сервер.

Дополнительные сведения об изменении строк подключения см. в разделе о соответствующем языке разработки для вашей [библиотеки подключений](sql-database-libraries.md).

### Настройка правил брандмауэра
Убедитесь, что правила брандмауэра, настроенные на сервере и в базе данных, соответствуют правилам, настроенным на основном сервере и в базе данных-источнике. Дополнительные сведения см. в статье [Практическое руководство. Настройка параметров брандмауэра для Базы данных SQL](sql-database-configure-firewall-settings.md).

### Настройка учетных данных и пользователей базы данных
Убедитесь, что все учетные данные, используемые приложением, существуют на сервере с восстановленной базой данных. Дополнительные сведения см. в статье [Управление безопасностью после аварийного восстановления](sql-database-geo-replication-security-config.md).

> [!NOTE]
> Необходимо настроить и протестировать правила брандмауэра и имена для входа (и их разрешения) на сервере во время отработки аварийного восстановления. Эти объекты уровня сервера и их конфигурации могут быть недоступны во время сбоя.
> 
> 

### Настройка оповещений телеметрии
Убедитесь, что существующие настройки правил оповещения обновлены. Они должны соответствовать восстановленной базе данных и другому серверу.

Подробнее о правилах генерации оповещений базы данных см. в разделах [Получение уведомлений об оповещениях](../azure-portal/insights-receive-alert-notifications.md) и [Получение информации о работоспособности службы](../azure-portal/insights-service-health.md).

### Включение аудита
Если для доступа к базе данных требуется аудит, то после восстановления базы данных необходимо включить аудит. На необходимость аудита указывает использование в клиентских приложениях строк защищенного подключения в виде *.database.secure.windows.net. Дополнительные сведения см. в статье [Приступая к работе с аудитом базы данных SQL](sql-database-auditing-get-started.md).

## Дальнейшие действия
* Чтобы узнать об автоматически создаваемых резервных копиях базы данных SQL Azure, ознакомьтесь с разделом [Общие сведения об автоматическом резервном копировании базы данных SQL](sql-database-automated-backups.md).
* Чтобы изучить сценарии проектирования и восстановления непрерывности бизнес-процессов, ознакомьтесь со [сценариями обеспечения непрерывности](sql-database-business-continuity.md).
* Чтобы узнать об использовании автоматически создаваемых резервных копий для восстановления, ознакомьтесь с [восстановлением базы данных из резервных копий, инициируемых службой](sql-database-recovery-using-backups.md).

<!---HONumber=AcomDC_0803_2016-->