---
title: "Развертывание и изучение приложения Wingtip Tickets Platform (WTP) (примера приложения SaaS с помощью базы данных SQL Azure) | Документация Майкрософт"
description: "Развертывание и изучение примера приложения SaaS, использующего базу данных SQL Azure"
keywords: "руководство по базе данных sql"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: tutorial
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 05/10/2017
ms.author: billgib; sstein
ms.translationtype: Human Translation
ms.sourcegitcommit: 71fea4a41b2e3a60f2f610609a14372e678b7ec4
ms.openlocfilehash: ff4dc19bb6e24ea9ceeed9721cfb3a85b4d10965
ms.contentlocale: ru-ru
ms.lasthandoff: 05/10/2017


---
# <a name="deploy-and-explore-a-multi-tenant-saas-application-that-uses-azure-sql-database"></a>Развертывание и изучение мультитенантного приложения SaaS, использующего базу данных SQL Azure

В этом руководстве рассматривается развертывание и изучение приложения SaaS для Wingtip Tickets Platform (WTP). Для обслуживания нескольких клиентов приложение использует шаблон приложения SaaS, в котором на один клиент используется одна база данных. Приложение разработано для демонстрации возможностей базы данных SQL Azure, которые позволяют работать со сценариями SaaS, а также моделями проектирования и управления SaaS.

Если вы нажмете кнопку *Развертывания в Azure* ниже, то через пять минут вы получите облачное мультитенантное приложение SaaS, использующее базу данных SQL. Приложение развертывается с помощью трех примеров клиентов, каждый из которых содержит свою базу данных, развернутую в эластичный пул SQL. Приложение развертывается в подписку Azure, предоставляя полный доступ для изучения отдельных компонентов приложения и работы с ними.

Из этого руководства вы узнаете следующее:

> [!div class="checklist"]

> * Как развернуть приложение WTP.
> * О серверах, пулах и базах данных, формирующих приложение.
> * О клиентах, сопоставленных с данными с помощью *каталога*.
> * Как подготовить новые клиенты.
> * Как просмотреть историю использования пула для отслеживания работы клиента.
> * Как удалить примеры ресурсов, чтобы прекратить связанное выставление счетов.

Чтобы изучить различные модели проектирования и управления SaaS, вы можете ознакомиться с доступной [серией связанных руководств](sql-database-wtp-overview.md), которые являются продолжением этого руководства, необходимого для выполнения первоначального развертывания. Изучая руководства, постарайтесь разобраться с приведенными сценариями, а также понять способ реализации различных моделей SaaS. Знакомство со сценариями, представленными в каждом руководстве, необходимо, чтобы разобраться с реализацией множества возможностей базы данных SQL, упрощающих разработку приложений SaaS.

Для работы с этим руководством выполните следующие предварительные требования:

* Установите Azure PowerShell. Дополнительные сведения см. в статье [Начало работы с Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).

## <a name="deploy-the-wingtip-tickets-wtp-saas-application"></a>Развертывание приложения SaaS для Wingtip Tickets Platform (WTP)

Разверните Wingtip Tickets Platform менее чем за 5 минут:

1. Для развертывания щелкните:

   <a href="http://aka.ms/deploywtpapp" target="_blank"><img src="http://azuredeploy.net/deploybutton.png"/></a>

1. Введите необходимые значения параметров для развертывания.

    > [!IMPORTANT]
    > Некоторые проверки подлинности и брандмауэры сервера не защищены специально, так как предназначены для демонстрации. **Создайте группу ресурсов.** Не нужно использовать для рабочих сред имеющиеся группы ресурсов, серверы или пулы. Кроме того, не стоит использовать это приложение или какие-либо из ресурсов, созданных им. Поработав с приложением, удалите эту группу ресурсов, чтобы завершить связанное выставление счетов.

    * В поле **Группа ресурсов** выберите **Создать**, а затем введите **имя** и **расположение**.
    * Поле **Пользователь**. Некоторым ресурсам необходимо присвоить имена, уникальные для всех подписок Azure. Чтобы гарантировать уникальность имени, укажите значение, по которому созданные ресурсы будут отличаться от ресурсов, созданных другими пользователями, развертывающими приложение Wingtip. Мы рекомендуем использовать короткое имя **пользователя**, в частности инициалы и какое-либо число (например, *bg1*), а затем использовать это значение для имени группы ресурсов (например, *wingtip-bg1*). Параметр **Пользователь** может содержать только буквы, цифры и дефисы. В качестве первого и последнего символа используйте букву или цифру (желательно символы нижнего регистра).

     ![шаблон](./media/sql-database-saas-tutorial/template.png)

1. **Разверните приложение.**

    * Установите флажок "Я принимаю указанные выше условия".
    * Кроме того, установите флажок **Закрепить на панели мониторинга**.
    * Щелкните **Приобрести**.

1. Отслеживайте состояние развертывания. Для этого щелкните **Уведомления** (значок колокольчика справа от поля поиска). Развертывание приложения WTP занимает примерно четыре минуты.

   ![Развертывание выполнено](media/sql-database-saas-tutorial/succeeded.png)

## <a name="explore-the-application"></a>Обзор приложения

Приложение демонстрирует различные объекты, например концертные залы, джазовые и спортивные клубы, в которых проходят определенные события. Объекты регистрируются как клиенты платформы Wingtip Tickets Platform (WTP) — для удобного перечисления событий и продажи билетов. Каждому объекту присваивается персонализированное веб-приложение для управления событиями и их перечисления, а также для продажи билетов. Все это выполняется независимо от других клиентов. На самом деле каждый клиент получает базу данных SQL, развернутую в эластичный пул SQL.

Основной **концентратор событий** предоставляет список URL-адресов клиента, уникальных для развертывания. Все URL-адреса клиента содержат уникальное значение *пользователя* и представлены в следующем формате: http://events.wtp.&lt;пользователь&gt;.trafficmanager.net/*fabrikamjazzclub*. 

1. Откройте _концентратор событий_: http://events.wtp.&lt;пользователь&gt;.trafficmanager.net. Параметр "Пользователь" замените на нужное имя пользователя:

    ![Концентратор событий](media/sql-database-saas-tutorial/events-hub.png)

1. Щелкните **Fabrikam Jazz Club** в *концентраторе событий*.

   ![События](./media/sql-database-saas-tutorial/fabrikam.png)

1. Щелкните **Билеты** и ознакомьтесь со стоимостью билета для события.

Приложение WTP использует [*диспетчер трафика Azure*](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-overview), чтобы управлять распределением входящего трафика. Для страниц событий для определенного клиента необходимо, чтобы имена клиентов были включены в URL-адреса. Приложение событий анализирует имя клиента из URL-адреса и использует его, чтобы создать ключ для доступа к каталогу при помощи [*управления размещением сегментов*](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-scale-shard-map-management). Каталог сопоставляет ключ с расположением базы данных клиента. **Концентратор событий** использует расширенные метаданные в каталоге, чтобы получить имя клиента, связанное с каждой базой данных.

В рабочей среде обычно создают запись CNAME DNS, чтобы [*указать интернет-домен компании*](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-point-internet-domain) для профиля диспетчера трафика.

## <a name="get-the-wingtip-application-scripts"></a>Получение скриптов приложения Wingtip

Скрипты Wingtip Tickets и исходный код приложения доступны в репозитории GitHub [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS). Файлы скриптов находятся в [папке Learning Modules](https://github.com/Microsoft/WingtipSaaS/tree/master/Learning%20Modules). Скачайте папку **Learning Modules** на локальный компьютер, сохраняя ее структуру.

## <a name="provision-a-new-tenant"></a>Подготовка нового клиента

При первоначальном развертывании создается три примера клиента. Однако чтобы разобраться в теме обсуждения, представленной в этом руководстве, нам необходимо создать больше примеров. На этом шаге вы сможете быстро создать клиент. Дальше вам необходимо будет глубже вникнуть в подробности подготовки новых клиентов, приведенных в [руководстве по подготовке и каталогу](sql-database-saas-tutorial-provision-and-catalog.md). Вы узнаете, насколько просто внедрить компонент регистрации в приложение, а также автоматически подготовить клиенты при регистрации пользователей.

### <a name="initialize-the-user-config-file-for-your-deployment"></a>Инициализация файла конфигурации пользователя для развертывания

Так как это первый скрипт, который вы собираетесь выполнить после первоначального развертывания приложения WTP, вам необходимо обновить файл конфигурации пользователя. Обновите переменные уникальными значениями развертывания.

   1. В *интегрированной среде сценариев PowerShell* откройте файл \\Learning Modules\\*UserConfig.psm1*.
   1. Измените _$userConfig.ResourceGroupName_ на _группу ресурсов_, заданную при развертывании приложения.
   1. Измените _$userConfig.Name_ на имя _пользователя_, заданное при развертывании приложения.

### <a name="provision-the-new-tenant"></a>Подготовка нового клиента

1. В *интегрированной среде сценариев PowerShell* откройте файл \\Learning Modules\Provision and Catalog\\*Demo-ProvisionAndCatalog.ps1*.
1. Нажмите клавишу **F5** для запуска скрипта (оставьте значения по умолчанию).

Новый клиент регистрируется в каталоге. Для него создается база данных, а затем она добавляется в эластичный пул SQL. После успешной подготовки в браузере появится созданный сайт продажи билетов клиента:

![Новый клиент](./media/sql-database-saas-tutorial/red-maple-racing.png)

Обновите концентратор событий, чтобы увидеть в списке новый клиент.

## <a name="start-generating-load-on-the-tenant-databases"></a>Запуск создания нагрузки в базах данных клиента

Теперь, когда у нас есть несколько клиентских баз данных, давайте рассмотрим их работу. Предоставляется скрипт PowerShell для моделирования рабочих нагрузок, выполняющихся во всех клиентских базах данных. По умолчанию нагрузка выполняется в течение 60 минут. Wingtip Tickets является приложением SaaS, а реальная нагрузка в приложении SaaS обычно случайна и непредсказуема. Для ее моделирования генератор нагрузки создает случайную нагрузку, распределенную во всех клиентах. Чтобы появилась модель, необходимо несколько минут, поэтому генератор нагрузки должен работать около 5–10 минут. Затем можно приступить к отслеживанию нагрузки в разделах ниже.

1. В **интегрированной среде сценариев PowerShell** откройте файл \\Learning Modules\\Utilities\\*Demo-LoadGenerator.psm1*.
1. Нажмите клавишу **F5**, чтобы запустить скрипт и генератор нагрузки (оставьте значения параметра по умолчанию).

> [!IMPORTANT]
> В локальном сеансе PowerShell генератор нагрузки выполняется как серия заданий, поэтому не закрывайте этот сеанс PowerShell. Если вы закроете PowerShell, вкладку, на которой был запущен генератор нагрузки, или приостановите работу компьютера, выполнение заданий прекратится.


## <a name="explore-the-servers-pools-and-tenant-databases"></a>Изучение серверов, пулов и клиентских баз данных

Теперь, когда вы ознакомились с приложением, подготовили новый клиент и запустили выполнение нагрузки в коллекции клиентов, давайте рассмотрим некоторые из развернутых ресурсов.

1. На [портале Azure](http://portal.azure.com) откройте сервер **catalog-&lt;пользователь&gt;**. Сервер каталога содержит две базы данных — **tenantcatalog** и **basetenantdb** (пустая *"золотая"* база данных, скопированная для создания клиентов).

   ![databases](./media/sql-database-saas-tutorial/databases.png)

1. Откройте сервер **tenants1-&lt;пользователь&gt;**, который содержит клиентские базы данных. Обратите внимание, что каждая клиентская база данных является эластичной базой данных _уровня "Стандартный"_ в пуле уровня "Стандартный" на 50 eDTU. Также обратите внимание, что существует база данных _Red Maple Racing_ (подготовленный ранее клиент).

   ![server](./media/sql-database-saas-tutorial/server.png)

## <a name="monitor-the-pool"></a>Отслеживание пула

Если генератор нагрузки выполнялся несколько минут, тогда доступен достаточный объем данных, чтобы рассмотреть некоторые функции мониторинга, встроенные в пулы и базы данных.

1. Перейдите к серверу *tenants1-&lt;пользователь&gt;*, а затем щелкните **пул 1**, чтобы просмотреть использование ресурсов для пула:

   ![Отслеживание пула](./media/sql-database-saas-tutorial/monitor-pool.png)

На этих диаграммах хорошо видно, насколько хорошо подходят эластичные пулы и база данных SQL для рабочих нагрузок приложения SaaS. Четыре базы данных, каждая из которых передает 40 eDTU, легко поддерживаются пулом, рассчитанным на 50 eDTU. Если бы все базы данных были подготовлены как автономные, то каждой из них требовалось бы иметь уровень S2 (т. е. на 50 DTU), чтобы поддерживать необходимые объемы передачи. Однако стоимость 4 автономных баз данных уровня S2 в 3 раза бы превышала стоимость пула. И кроме того, для пула предусмотрен большой резерв, так что он может вместить гораздо большее число баз данных. На самом деле клиенты используют до 500 баз данных в пулах на 200 eDTU. Дополнительные сведения см. в статье об [отслеживании производительности примера приложения SaaS для WTP](sql-database-saas-tutorial-performance-monitoring.md).


## <a name="deleting-the-resources-created-with-this-tutorial"></a>Удаление ресурсов, созданных в рамках этого руководства

Ознакомившись с приложением WTP и поняв принцип работы с этим приложением, перейдите на портале в группу ресурсов приложения и удалите ее, чтобы завершить выставление счетов, связанных с этим развертыванием. Если вы использовали какие-либо другие дополнительные руководства, удалите также в приложении любые ресурсы, созданные в рамках этих руководств.


## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали следующее:

> [!div class="checklist"]

> * Как развернуть приложение WTP.
> * О серверах, пулах и базах данных, формирующих приложение.
> * О клиентах, сопоставленных с данными с помощью *каталога*.
> * Как подготовить новые клиенты.
> * Как просмотреть историю использования пула для отслеживания работы клиента.
> * Как удалить примеры ресурсов, чтобы прекратить связанное выставление счетов.

А теперь мы рекомендуем ознакомиться со статьей [Provision new tenants and register them in the catalog](sql-database-saas-tutorial-provision-and-catalog.md) (Подготовка новых клиентов и их регистрация в каталоге).



## <a name="additional-resources"></a>Дополнительные ресурсы

* [Руководства по работе с SaaS-приложением WTP, использующим базу данных SQL Azure](sql-database-wtp-overview.md#sql-database-wtp-saas-tutorials)
* Дополнительные сведения об эластичных пулах см. в статье [*Эластичные пулы помогают управлять несколькими базами данных SQL и масштабировать их*](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-pool).
* Дополнительные сведения об эластичных заданиях см. в статье [*Управление масштабируемыми облачными базами данных*](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-jobs-overview).
* Дополнительные сведения о шаблонах разработки для мультитенантных приложений SaaS и базы данных SQL Azure см. в [*этой статье*](https://docs.microsoft.com/azure/sql-database/sql-database-design-patterns-multi-tenancy-saas-applications).

