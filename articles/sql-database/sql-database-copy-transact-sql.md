<properties 
    pageTitle="Создание копии Базы данных SQL Azure с помощью Transact-SQL" 
    description="Создание копии Базы данных SQL Azure с помощью Transact-SQL" 
	services="sql-database"
	documentationCenter=""
	authors="stevestein"
	manager="jeffreyg"
	editor=""/>

<tags
	ms.service="sql-database"
	ms.devlang="NA"
	ms.date="02/23/2016"
	ms.author="sstein"
	ms.workload="data-management"
	ms.topic="article"
	ms.tgt_pltfrm="NA"/>


# Создание копии Базы данных SQL Azure с помощью Transact-SQL

**Отдельная база данных**

> [AZURE.SELECTOR]
- [Azure Portal](sql-database-copy.md)
- [PowerShell](sql-database-copy-powershell.md)
- [SQL](sql-database-copy-transact-sql.md)



Ниже показано, как скопировать Базу данных SQL Azure с помощью Transact-SQL. Операция копирования базы данных копирует Базу данных SQL в новую базу данных с помощью оператора [CREATE DATABASE](). Такая копия представляет собой моментальный снимок базы данных, созданный на том же или на другом сервере.


> [AZURE.NOTE] База данных SQL Azure автоматически создает и обслуживает резервные копии для каждой пользовательской базы данных, которую можно восстановить. Дополнительные сведения см. в статье [Общие сведения о непрерывности бизнес-процессов](sql-database-business-continuity.md).


Скопированная база данных становится полностью работоспособной и не зависит от оригинала. На момент завершения копирования новая база данных будет транзакционно согласована с исходной базой данных. Уровень службы и производительности (ценовая категория) скопированная база данных наследует у оригинала. После завершения копирования копия становится полностью работоспособной и независимой. Именами входа, пользователями и разрешениями можно управлять независимо.


При копировании базы данных на тот же логический сервер можно использовать для обеих баз данных одинаковые имена входа. Субъект безопасности, используемый для копирования базы данных, становится владельцем новой базы данных (DBO). В копируемую базу данных копируются все пользователи, их разрешения и идентификаторы безопасности (SID).


Чтобы выполнить действия, описанные в этой статье, необходимо следующее:

- Подписка Azure. Если вам требуется подписка Azure, нажмите в верхней части этой страницы кнопку **БЕСПЛАТНАЯ ПРОБНАЯ ВЕРСИЯ**. Оформив подписку, вернитесь к этой статье.
- База данных Azure SQL. Если у вас нет базы данных SQL, создайте ее в соответствии с инструкциями в следующей статье: [Создание первой базы данных SQL Azure](sql-database-get-started.md).
- [SQL Server Management Studio (SSMS)](https://msdn.microsoft.com/library/ms174173.aspx) Если у вас нет SSMS или функции, описанные в этой статье, недоступны, [загрузите последнюю версию](https://msdn.microsoft.com/library/mt238290.aspx).




## Копирование Базы данных SQL

Войдите в главную базу данных под основным именем входа на уровне сервера или под именем входа, которое использовалось для создания копируемой базы данных. Для копирования баз данных имена входа, не являющиеся основными на уровне сервера, должны относиться к роли dbmanager. Дополнительные сведения об именах входа и подключении к серверу см. в статьях «Управление базами данных, именами входа и пользователями в Базе данных SQL Azure» и «Разработка Баз данных SQL Azure: практические руководства» соответственно.

Запустите копирование исходной базы данных с помощью оператора CREATE DATABASE. Данный оператор запускает процесс копирования базы данных. Поскольку копирование базы данных — процесс асинхронный, оператор CREATE DATABASE возвращается до завершения копирования базы данных.


### Копирование Базы данных SQL на тот же сервер

Войдите в главную базу данных под основным именем входа на уровне сервера или под именем входа, которое использовалось для создания копируемой базы данных. Для копирования баз данных имена входа, не являющиеся основными на уровне сервера, должны относиться к роли dbmanager.

Эта команда копирует Database1 в новую базу данных с именем Database2 на том же сервере. Операция копирования может занять некоторое время в зависимости от размера базы данных.

    -- Execute on the master database.
    -- Start copying.
    CREATE DATABASE Database1_copy AS COPY OF Database1;

### Копирование Базы данных SQL на другой сервер

Войдите в главную базу данных на целевом сервере, т. е. сервере Базы данных SQL Azure, на котором должна быть создана новая база данных. Для входа укажите имя пользователя и пароль владельца исходной базы данных на исходном сервере Базы данных SQL Azure. Имя входа на целевом сервере также должно относиться к роли dbmanager или являться основным именем входа на уровне сервера.

Эта команда копирует Database1 на сервере server1 в новую базу данных с именем Database2 на сервере server2. Операция копирования может занять некоторое время в зависимости от размера базы данных.


    -- Execute on the master database of the target server (server2)
    -- Start copying from Server1 to Server2
    CREATE DATABASE Database1_copy AS COPY OF server1.Database1;
    

## Отслеживание хода выполнения операции копирования

Следить за ходом процесса копирования можно в представлениях sys.databases и sys.dm\_database\_copies. Во время копирования в столбце state\_desc представления sys.databases для новой базы данных отображается значение COPYING.


- Если копирование завершается неудачей, в столбце state\_desc представления sys.databases для новой базы данных отображается значение COPYING. В этом случае выполните оператор DROP для новой базы данных и повторите попытку позднее.
- Если копирование завершается успешно, в столбце state\_desc представления sys.databases для новой базы данных отображается значение ONLINE. Это означает, что копирование завершено и новая база данных является обычной базой данных, которую можно изменять независимо от исходной.



## Дальнейшие действия


- Чтобы отменить копирование до его завершения, выполните в новой базе данных оператор [DROP DATABASE](https://msdn.microsoft.com/library/ms178613.aspx). Кроме того, процесс копирования отменяет также выполнение оператора DROP DATABASE в исходной базе данных.
- После того как новая база данных на целевом сервере будет в сети, сопоставьте пользователей из новой базы данных с именами входа на сервере назначения с помощью оператора [ALTER USER](https://msdn.microsoft.com/library/ms176060.aspx). Все пользователи в новой базе данных получают такие же разрешения, как и в исходной базе данных. Пользователь, инициировавший копирование базы данных, становится владельцем новой базы данных и получает новый идентификатор безопасности (SID). С момента успешного завершения копирования и вплоть до сопоставления остальных пользователей войти в новую базу данных может только ее владелец, т. е. пользователь, инициировавший копирование.




## Дополнительные ресурсы

- [Общие сведения о непрерывности бизнес-процессов](sql-database-business-continuity.md)
- [Отработка аварийного восстановления](sql-database-disaster-recovery-drills.md)
- [База данных SQL — документация](https://azure.microsoft.com/documentation/services/sql-database/)

<!---HONumber=AcomDC_0224_2016-->