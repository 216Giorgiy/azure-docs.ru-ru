<properties
	pageTitle="Обзор заданий обработки эластичных баз данных | Microsoft Azure" 
	description="Описание службы заданий обработки эластичных баз данных" 
	metaKeywords="azure sql database elastic databases" 
	services="sql-database" documentationCenter=""  
	manager="jeffreyg" 
	authors="ddove"/>

<tags 
	ms.service="sql-database" 
	ms.workload="sql-database" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="02/23/2016" 
	ms.author="ddove;sidneyh" />

# Обзор заданий обработки эластичных баз данных

Служба **заданий обработки эластичных баз данных** (предварительная версия) позволяет надежно выполнить сценарий Transact-SQL (T-SQL) или применить файл DACPAC ([приложение уровня данных](https://msdn.microsoft.com/library/ee210546.aspx)) к группе баз данных, включая:

* пользовательское семейство баз данных (см. ниже);
* все базы данных [в пуле эластичных баз данных](sql-database-elastic-pool.md);
* набор сегментов (созданный с помощью [клиентской библиотеки эластичной базы данных ](sql-database-elastic-database-client-library.md)). 
 
Инструкции по установке см. в статье [Обзор установки заданий обработки эластичных баз данных](sql-database-elastic-jobs-service-installation.md). Также см. раздел [Начало работы с заданиями обработки эластичных баз данных](sql-database-elastic-jobs-getting-started.md).

Сейчас служба **заданий обработки эластичных баз данных** —это размещаемая на стороне клиента облачная служба Azure, которая дает возможность выполнять ситуативные и запланированные административные задачи, именуемые **заданиями**. С помощью заданий вы можете легко и уверенно управлять большими группами баз данных SQL Azure, выполняя административные операции с помощью сценариев Transact-SQL.

![Служба заданий обработки эластичных баз данных][1]

## Преимущества
* Удобство управления изменениями схемы, управление учетными данными, обновление ссылочных данных, сбор телеметрических клиентских данных или сведений о производительности.
* Снижение расходов. Обычно, чтобы запустить инструкции Transact-SQL или выполнить другие административные задачи, к каждой базе данных необходимо подключаться отдельно, тогда как задание автоматически входит в каждую базу данных в целевой группе.
* Учет. Задания запускают сценарий и записывают состояние выполнения каждой базы данных. 
* Гибкость. Возможность определять пользовательские группы баз данных SQL Azure.
* Определение, поддержка и сохранение сценариев Transact-SQL, которые могут выполняться в группе баз данных SQL Azure. 
* Развертывание приложения на уровне данных (DACPAC)
* Автоматический повтор при выполнении сценариев.
* Определение расписаний выполнения
* Сбор данных из семейства баз данных SQL Azure в одну целевую таблицу.

> [AZURE.NOTE] На портале Azure доступен сокращенный набор функций. Эти функции предназначены для работы с пулами эластичных баз данных SQL Azure. Чтобы получить полный набор доступных на данный момент возможностей, используйте API-интерфейсы PowerShell.

## Сценарии

* Выполнение административных задач, таких как развертывание новой схемы.
* Обновление эталонных данных (например, сведений о продукте, общих для всех баз данных) и использование расписаний для автоматизации обновлений каждый будний день после работы.
* Перестроение индексов для повышения скорости обработки запросов. Вы можете настроить регулярное перестроение в семействе баз данных, например во время низкой нагрузки.
* Собирайте результаты запросов из набора баз данных в центральную таблицу на постоянной основе. Запросы производительности могут выполняться непрерывно и вызывать дополнительные задачи.
* Выполняйте запросы обработки данных с повышенным временем выполнения для большого набора баз данных, например коллекции телеметрии клиентов. Результаты собираются в одну целевую таблицу для дальнейшего анализа.

## Работа с заданиями обработки эластичных баз данных 
1.	Установите компоненты службы **заданий обработки эластичных баз данных**. Дополнительные сведения см. в статье [Обзор установки заданий обработки эластичных баз данных](sql-database-elastic-jobs-service-installation.md). Если во время установки произошла ошибка, [удалите установленные компоненты](sql-database-elastic-jobs-uninstall.md).
2.	Используйте API-интерфейсы PowerShell, чтобы получить дополнительные возможности, например создание пользовательских семейств баз данных, добавление расписаний и/или сбор наборов результатов. Портал используется для простой установки, создания и мониторинга заданий, которые выполняются только в **пуле эластичных баз данных**. 
3.	Создайте зашифрованные учетные данные для выполнения заданий и [добавьте пользователя (или роль) в каждую базу данных в группе](sql-database-security.md).
4.	Создайте сложный сценарий T-SQL, который можно запускать для каждой базы данных в группе. 
5.	Чтобы создать задания с помощью портала Azure, выполните действия, описанные в статье [Создание заданий обработки эластичных баз данных SQL и управление ими с помощью портала (предварительная версия)](sql-database-elastic-jobs-create-and-manage.md). 
6.	Вы также можете воспользоваться сценариями PowerShell. См. статью [Создание заданий обработки эластичных баз данных для базы данных SQL и управление ими с помощью PowerShell (предварительная версия)](sql-database-elastic-jobs-powershell.md).

## Важность идемпотентных сценариев
Сценарии должны быть [идемпотентными](https://en.wikipedia.org/wiki/Idempotence). Проще говоря, «идемпотентный» означает, что, если сценарий выполнился успешно и запустился снова, его результат останется неизменным. Сценарий может завершиться ошибкой из-за временных проблем в сети. В этом случае задание будет автоматически пытаться выполнить сценарий указанное количество раз, после чего попытки будут прекращены. Идемпотентный сценарий дает неизменный результат даже после двух успешных запусков.

Прежде чем создавать объект, рекомендуется сначала проверить, не существует ли он уже.

	IF NOT EXIST (some_object)
	-- Create the object 
	-- If it exists, drop the object before recreating it.

Аналогичным образом сценарий должен успешно завершаться, выполняя логическую проверку на существование различных условий и их обработку.

## Сбои и журналы

Если после нескольких попыток сценарий завершается сбоем, задание записывает в журнал ошибку и продолжает работу. После завершения задания (т. е. после его выполнения во всех базах данных в группе) вы можете просмотреть список неудачных попыток. Сведения в журналах можно использовать для отладки неисправных сценариев.

## Типы групп и их создание

Группы бывают двух типов:

1. наборы сегментов;
2. настраиваемые группы.

Группы наборов сегментов создаются с помощью [инструментов для эластичных баз данных](sql-database-elastic-scale-introduction.md). В таких группах базы данных добавляются и удаляются автоматически. Например, в группу будет автоматически добавлен новый сегмент. Задания будут выполняться в группе без корректировки.

Настраиваемые группы определяются строго. В таких группах базы данных нужно добавлять и удалять явно. Если в группе удалить какую-то базу данных, задание попытается выполнить в ней сценарий, что в конечном итоге приведет к ошибке. На портале Azure сейчас можно создавать только настраиваемые группы.


## Компоненты и цены 
Ниже перечислены компоненты, которые вместе формируют облачную службу Azure, позволяющую в любой момент выполнять административные задания. Компоненты устанавливаются и настраиваются в вашей подписке автоматически во время установки. Эти службы можно легко идентифицировать — все они имеют одно и тоже автоматически сгенерированное уникальное имя, которое состоит из префикса edj и 21 произвольного символа.

* **Облачная служба Azure**. Служба заданий эластичной базы данных (предварительная версия) поставляется как облачная служба Azure, размещаемая клиентом для выполнения требуемых задачи. На портале служба развертывается и размещается в вашей подписке Microsoft Azure. По умолчанию развернутая служба выполняется как минимум с двумя рабочими ролями, что обеспечивает высокую доступность службы. Каждая роль стандартного размера (ElasticDatabaseJobWorker) работает на экземпляре A0. Сведения о ценах на облачные службы см. [здесь](https://azure.microsoft.com/pricing/details/cloud-services/). 
* **База данных SQL Azure**. Также называется **управляющей базой данных**. Используется для хранения всех метаданных заданий. По умолчанию используется уровень служб S0. Сведения о ценах на базы данных SQL см. [здесь](https://azure.microsoft.com/pricing/details/sql-database/).
* **Служебная шина Azure**. Используется для координации работы в облачной службе Azure. Сведения о ценах на служебную шину см. [здесь](https://azure.microsoft.com/pricing/details/service-bus/).
* **Служба хранилища Azure**. Для хранения диагностических сведений используется учетная запись хранения Azure. Эти данные могут понадобиться в случае, если для решения проблемы потребуется дальнейшая отладка (см. статью [Включение диагностики в облачных службах и виртуальных машинах Azure](../cloud-services/cloud-services-dotnet-diagnostics.md)). Сведения о ценах на хранилище Azure см. [здесь](https://azure.microsoft.com/pricing/details/storage/).

## Как работают задания обработки эластичных баз данных
1.	Базе данных SQL Azure назначается управляющая база данных, в которой хранятся все метаданные и сведения о состоянии.
2.	Служба **заданий обработки эластичных баз данных** обращается к управляющей базе данных для запуска и отслеживания выполняемых заданий.
3.	С управляющей базой данных связываются две роли: 
	* Контроллер: определяет, каким заданиям для выполнения требуются задачи, и повторно запускает невыполненные задания, создавая новые задачи.
	* Выполнение задач: выполняет задачи.

### Типы задач
Существует несколько типов задач, которые выполняют задания:

* ShardMapRefresh: отправляет карте сегментов запрос, чтобы определить все базы данных, используемые как сегменты
* ScriptSplit: разбивает сценарий на группы между инструкциями GO
* ExpandJob: создает дочерние задачи для каждой базы данных из задачи, которая направлена на группу баз данных
* ScriptExecution: выполняет сценарий для определенной базы данных с использованием заданных учетных данных
* Dacpac: применяет DACPAC к определенной базе данных с использованием определенных учетных данных

## Рабочий процесс выполнения заданий
1.	С помощью портала или API PowerShell задание добавляется в **управляющую базу данных**. Задание требует выполнения сценарий Transact-SQL для группы баз данных с использованием определенных учетных данных.
2.	Контроллер определяет новое задание. Создаются и выполняются задачи для разделения сценария и обновления баз данных группы. Напоследок создается и выполняется новое задание для расширения задания и создания дочерних заданий, каждое из которых выполняет сценарий Transact-SQL для отдельной базы данных в группе.
3.	Контроллер определяет созданные дочерние задания. Для каждого задания контроллер создает и запускает задачу для выполнения сценария в базе данных. 
4.	После завершения задач контроллер задает состояние завершения заданий. Во время выполнения задания в любой момент можно использовать API PowerShell для просмотра текущего состояния его выполнения. Время, возвращаемое API-интерфейсами PowerShell, представлено в формате UTC. При желании можно отправить запрос на отмену, чтобы остановить задание. 

## Дальнейшие действия
[Установите компоненты](sql-database-elastic-jobs-service-installation.md), а затем [создайте и добавьте учетные данные для входа в каждую базу данных в группе](sql-database-security.md). Дополнительные сведения о создании заданий и управлении ими см. в статье [Создание заданий эластичной базы данных и управление ими](sql-database-elastic-jobs-create-and-manage.md). Также см. раздел [Начало работы с заданиями обработки эластичных баз данных](sql-database-elastic-jobs-getting-started.md).

[AZURE.INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-jobs-overview/elastic-jobs.png
<!--anchors-->

<!---HONumber=AcomDC_0224_2016-->