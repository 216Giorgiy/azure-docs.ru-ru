<properties 
   pageTitle="Миграция с помощью Visual Studio и SSDT"
	description="База данных SQL Microsoft Azure, перенос базы данных, импорт базы данных, экспорт базы данных, мастер миграции"
	services="sql-database"
	documentationCenter=""
	authors="carlrabeler"
	manager="jeffreyg"
	editor=""/>

<tags
   ms.service="sql-database"
	ms.devlang="NA"
	ms.topic="article"
	ms.tgt_pltfrm="NA"
	ms.workload="data-management"
	ms.date="08/24/2015"
	ms.author="carlrab"/>

#Обновление базы данных на месте с последующим развертыванием в Базе данных SQL Azure

![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/01VSSSDTDiagram.png)

Используйте этот вариант, если для переноса локальной базы данных в Базу данных SQL Azure версии 12 требуются изменения схемы, поскольку база данных использует функции SQL Server, которые не поддерживаются Базой данных Azure SQL или для проверки наличия неподдерживаемых функций в локальной базе данных.

Используйте [последнюю версию SQL Server Data Tools для Visual Studio](https://msdn.microsoft.com/library/mt204009.aspx) в Visual Studio 2013 с обновлением 4 или выше.

С помощью этого параметра:

 - SQL Server Data Tools для Visual Studio (SSDT) сначала используется для создания проекта базы данных из базы данных-источника. 
 - Затем в качестве целевой платформы проекта задается База данных SQL Azure V12 и выполняется создание проекта для выявления всех проблем совместимости. 
 - После успешного создания проекта схема публикуется обратно в копии базы данных (не перезаписывает базу данных-источник).
 - Функция сравнения данных в SSDT используется для сравнения базы данных-источника с вновь созданной базой данных, совместимой с Azure SQL, а затем обновляет новую базу данных новыми данными из этой базы данных-источника. 
 - Затем обновленная база данных развертывается в Azure с помощью SSMS, либо напрямую или путем экспорта и импорта файла BACPAC.
 
>[AZURE.NOTE]Примечание. Если требуется развернуть только схему, то обновленную схему можно опубликовать в Базе данных SQL Azure непосредственно из Visual Studio.

## Этапы миграции

1.	Откройте **обозреватель объектов SQL Server** в Visual Studio. Выберите **Добавить SQL Server** для подключения к экземпляру SQL Server, содержащему базу данных для переноса. Найдите базу данных в обозревателе, щелкните ее правой кнопкой мыши и выберите команду **Создать новый проект**. 

	![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/02MigrateSSDT.png)

2.	В настройках параметров импорта установите флажок **Импортировать только объекты области приложения**. Снимите флажки для импорта упоминаемых имена входа, разрешений и параметров базы данных.

	![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/03MigrateSSDT.png)

3.	Нажмите кнопку **Начать**, чтобы приступить к импорту базы данных и создать проект, который будет содержать файл сценария T-SQL для каждого объекта в базе данных. Файлы сценариев вложены в папки проекта.

	![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/04MigrateSSDT.png)

4.	В обозревателе решений Visual Studio щелкните правой кнопкой мыши проект базы данных и выберите "Свойства". После этого откроется страница **Параметры проекта**, на которой необходимо настроить целевую платформу для Базы данных SQL Microsoft Azure V12.

	![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/05MigrateSSDT.png)

5.	Щелкните проект правой кнопкой мыши и выберите пункт **Сборка** для сборки проекта.

	![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/06MigrateSSDT.png)

6.	**Список ошибок** отображает каждую несовместимость. В этом случае имя пользователя NT AUTHORITY\\NETWORK SERVICE является несовместимым. Поскольку оно несовместимо, его можно закомментировать или удалить (и разрешить последствия удаления данного имени входа и роли из решения базы данных).

	![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/07MigrateSSDT.png)
7.	Дважды щелкните первый скрипт, чтобы открыть сценарий в окне запроса, закомментировать его, а затем выполнить. ![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/08MigrateSSDT.png)

8.	Повторяйте эту процедуру для каждого сценария, имеющего несовместимости, пока все ошибки не будут устранены. ![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/09MigrateSSDT.png)
9.	Устранив все ошибки, щелкните правой кнопкой мыши проект и выберите команду **Опубликовать**, чтобы создать и опубликовать базу данных в копии базы данных-источника (настоятельно рекомендуется использовать именно копию, по крайней мере первоначально). 
 - В зависимости от версии SQL Server источника (более ранней, чем SQL Server 2014) перед публикацией может потребоваться сбросить целевую платформу проекта, чтобы обеспечить возможность развертывания. 
 - Если вы переносите старую базу данных SQL Server, вам не следует добавлять в проект какие-либо функции, которые не поддерживается исходным сервером SQL Server, за исключением случаев, когда база данных сначала была перенесена в более новую версию SQL Server. 

	![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/10MigrateSSDT.png)

	![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/11MigrateSSDT.png)

10.	В обозревателе объектов SQL Server щелкните правой кнопкой мыши базу данных и команду **Сравнение данных** для сравнения проекта с базой данных-источником, чтобы понять, какие изменения были внесены мастером. Выберите базу данных Azure SQL версии 12 и нажмите кнопку **Готово**.

	![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/12MigrateSSDT.png)

	![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/13MigrateSSDT.png)

12.	Просмотрите обнаруженные различия и нажмите кнопку **Обновить цель** для переноса данных из базы данных-источника в базу данных Azure SQL версии 12.

	![замещающий текст](./media/sql-database-migrate-visualstudio-ssdt/14MigrateSSDT.png)

14.	Разверните схему базы данных, совместимую с Azure SQL версии 12, и данные в Базу данных SQL Azure SQL с помощью среды SSMS. Ознакомьтесь с разделом [Миграция совместимой базы данных с помощью среды SSMS.](sql-database-migrate-ssms.md)

<!---HONumber=August15_HO9-->