<properties 
    pageTitle="База данных SQL Azure — средства работы с эластичными базами данных" 
    description="Легкое масштабирование ресурсов базы данных в облаке с помощью эластичной базы данных." 
    services="sql-database" 
    documentationCenter="" 
    manager="jeffreyg" 
    authors="sidneyh" 
    editor=""/>

<tags 
    ms.service="sql-database" 
    ms.workload="sql-database" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="04/24/2015" 
    ms.author="sidneyh"/>

# База данных SQL Azure — средства работы с эластичными базами данных

## Перспективы и трудности

Базы данных SQL Azure обеспечивает практически неограниченную производительность и гибкость решений по рабочей нагрузке транзакций. Это достигается с помощью таких функций, как **клиентская библиотека эластичной базы данных** и **служба разбиения и объединения**, под общим названием **средства работы с эластичными базами данных**. Эти компоненты предназначены для упрощения разработки решений на основе сегментированных баз данных и управления ими.

В то время как гибкость решений по масштабированию для облачных приложений не вызывает затруднений в отношении вычислений и хранилищ больших двоичных объектов, это по-прежнему остается проблемой, когда дело доходит до обработки с отслеживанием состояния, особенно при управлении реляционной базой данных. Мы выяснили, что эти проблемы наиболее ярко проявляются в двух следующих случаях.

* Увеличение и уменьшение производительности реляционной базы данных как части рабочей нагрузки решения.
* Управление хот-спотами при влиянии на конкретное подмножество данных, например особенно загруженный конечный пользователь (клиент).

В большинстве случаев такие сценарии решаются путем приобретения дополнительных серверов баз данных для поддержки приложения. Тем не менее реализация этого варианта ограничена облаком, в котором вся обработка выполняется на предустановленном стандартном оборудовании. Использование вместо этого распределения данных и обработки в нескольких идентично структурированных базах данных (метод масштабирования, известный как сегментирование) является убедительной альтернативой традиционным подходам к масштабированию в контексте повышения производительности.

Функции эластичной базы данных SQL Azure делают масштабирование проще и эластичнее, чем когда-либо. При разработке "программного обеспечения как службы" **пулы эластичных баз данных** упрощают создание отдельных баз данных для каждого конечного пользователя или клиента, позволяя автоматически расширять или сужать объем ресурсов динамически, оставаясь в рамках прогнозируемого бюджета. **Задания обработки эластичных баз данных** позволяют надежно выполнять операции управления в масштабе всего набора баз данных, используя сценарии T-SQL для выполнения изменений схемы, управления учетными данными или любой другой операции обслуживания базы данных. Дополнительные сведения о заданиях эластичной базы данных см. в разделе [Обзор службы заданий эластичной базы данных](sql-database-elastic-jobs-overview.md).

Вне зависимости от того, используются ли отдельные базы данных для каждого клиента или несколько диапазонов данных упакованы в каждую базу данных коллекции, клиентская библиотека эластичной базы данных клиента и/или служба разбиения и объединения сократит трудозатраты, необходимые для создания приложений и управления ими, используя преимущества сегментирования. Вместо написания кода для макета документа данных в базах данных и маршрутизации соединения в нужное местоположение клиентская библиотека позволяет сосредоточиться на бизнес-логике приложения.

## Горизонтальное и вертикальное масштабирование
На рисунке ниже показаны горизонтальные и вертикальные размеры масштабирования.
 
![Горизонтальное и вертикальное масштабирование][4]

Горизонтальное масштабирование означает добавление или удаление баз данных для настройки емкости или общей производительности. Такое действие часто называют расширением. Сегментирование является наиболее распространенным методом горизонтального масштабирования, где данные секционируются по набору идентично структурированных баз данных.

Вертикальное масштабирование означает увеличение или уменьшение уровня производительности отдельной базы данных — также называется "увеличением масштаба".

В большей части баз данных облачных приложений для масштабирования будет использоваться сочетание этих двух стратегий. Например, приложение "программное обеспечение как сервис" может использовать горизонтальное масштабирование для подготовки новых конечных пользователей и вертикальное масштабирование для увеличения или уменьшения ресурсов базы данных каждого конечного клиента, согласно требованиям рабочей нагрузки.

Средства работы с эластичными базами данных упрощают создание приложений, использующих сегментирование — горизонтальное масштабирование инфраструктуры. С помощью пула эластичных баз данных для семейства баз данных, вертикального масштабирования обрабатывается системой автоматически. При использовании пулов вы отвечаете за установку ограничений по общей системе и диапазон вариантов, которые нужно разрешить каждой базе данных. Можно также вручную изменить выпуски баз данных или уровни ресурсов для базы данных, которые не задействованы в пулах эластичных баз данных. Например, можно создать новый сегмент для обработки большого притока данных в конце месяца. При поступлении новых данных сегмент масштабируется в сторону увеличения, а затем в сторону уменьшения при уменьшении притока данных.

Дополнительную информацию о пулах эластичных баз данных см. в статье [Обзор пулов эластичных баз данных](sql-database-elastic-pool.md).

## Возможности средств работы с эластичными базами данных. 

Разработка, масштабирование и управление масштабируемыми приложениями с использованием сегментирования представляет собой непростую задачу как для разработчика, так и для администратора. Средства работы с эластичной базой данных упрощают работу как для первого, так и для последнего. Значения на рисунке ниже отражают основные возможности, предоставляемые клиентской библиотекой эластичной базы данных и службой разбиения и объединения. На рисунке показана среда с несколькими базами данных, где каждая база данных соответствует сегменту. Средства упрощают разработку приложений на основе сегментированных баз данных SQL Azure, обеспечивая следующие возможности:

Определения используемых терминов см. в [Глоссарии по средствам работы с эластичными базами данных](sql-database-elastic-scale-glossary.md).

![Возможности эластичного масштабирования][1]

1.  **Управление сопоставлениями сегментов**: управление сопоставлениями сегментов — это возможность приложения управлять различными метаданными о своих сегментах. Управление сопоставлениями сегментов — это функция клиентской библиотеки эластичной базы данных. Разработчики могут использовать этот функционал для регистрации баз данных в качестве сегментов, описания сопоставлений отдельных ключей сегментирования или диапазонов этих баз данных. Функции библиотеки задействуются и для обновления метаданных по мере изменения числа и композиций баз данных для отражения вносимых в систему баз данных изменений. Управление сопоставлениями сегментов заменяет большую часть того типового кода, который приходилось писать клиентам в своих приложениях при самостоятельной реализации сегментирования. Подробности см. в статье [Управление сопоставлениями сегментов](sql-database-elastic-scale-shard-map-management.md)
 
* **Маршрутизация на основе данных**: допустим, приложению приходит запрос. На основании значения ключа сегментирования из запроса приложение должно определить соответствующую базу данных, содержащую данные для этого ключа, а затем открыть подключение, чтобы выполнить запрос. Маршрутизация на основе данных позволяет открыть соединение, сделав один простой вызов в диспетчер сопоставлений сегментов приложения. Маршрутизация на основе данных — еще один уровень кода для поддержки инфраструктуры сегментирования, который теперь решается за счет клиентской библиотеки эластичной базы данных. Подробности см. в статье [Маршрутизация на основе данных](sql-database-elastic-scale-data-dependent-routing.md).

* **Многосегментное формирование запросов (MSQ)**: многосегментное формирование запросов применяется в том случае, когда запрос относится к некоторым (или всем) сегментам. Многосегментный запрос выполняет одинаковый код T-SQL во всех сегментах или наборе сегментов. Результаты из задействованных сегментов объединяются в общий набор результатов с помощью семантики UNION ALL. Предоставляемая клиентской библиотекой функциональная возможность решает множество задач, в том числе управление подключениями, управление потоками, обработка сбоев и обработка промежуточных результатов. MSQ может посылать запросы к сотням сегментов. Подробнее см. в разделе [Многосегментное формирование запросов](sql-database-elastic-scale-multishard-querying.md)


* **Служба разбиения и объединения**: если не используется простая модель распределения отдельных баз данных в пуле эластичных баз данных, приложениям нужно гибко распределять информацию на несколько баз данных, чтобы обеспечить изменение производительности согласно динамике бизнеса. Средства работы с эластичными базами данных включают в себя службу разбиения и объединения, размещаемую на стороне клиента, для увеличения и уменьшения производительности уровня данных и управления хот-спотами сегментированных приложений в случаях, в которых также требуется перемещение данных. Она основана на базовой возможности перемещения по запросу данных сегментов (шардлетов) между разными базами данных и интегрировано в управление сопоставлениями сегментов, что обеспечивает поддержку согласованных сопоставлений и установку правильных соединений при маршрутизации на основе данных. Дополнительные сведения см. в разделе [Разбиение и объединение с помощью средств работы с эластичными базами данных](sql-database-elastic-scale-overview-split-and-merge.md).

Как правило, клиенты, использующие средства работы с эластичными базами данных, могут получить полную функциональности T-SQL при отправке операций в пределах одного сегмента в отличие от операций между сегментами, для которых применяется собственная семантика.

## Распространенные шаблоны сегментирования

**Сегментирование** — это технология распределения больших объемов данных с одинаковой структурой по множеству независимых баз данных. Она пользуется особенной популярностью среди разработчиков облачных технологий при создании для конечных пользователей и предприятий SAAS-решений. Эти конечные пользователи часто именуются "клиентами". Сегментирование может потребоваться по ряду причин:

* общий объем данных слишком велик для размещения в пределах одной базы данных; 
* пропускная способность транзакций общей рабочей нагрузки превышает возможности одной базы данных; 
* клиентам может потребоваться физическая изоляция друг от друга, для чего требуются отдельные базы данных для каждого клиента; 
* разные части базы данных могут размещаться в разных регионах по соображениям соответствия требованиям законодательства, производительности или по геополитическим причинам. 

В других сценариях, например в приеме данных из распределенных устройств, сегментирование может использоваться для заполнения набора баз данных по временному признаку. Например, отдельная база данных может выделяться под каждый день или неделю. В этом случае ключом сегментирования может быть целое число, представляющее дату (присутствующую во всех строках сегментированных таблиц), а запросы получения информации о диапазоне дат должны передаваться приложением в подмножество баз данных, которые покрывают рассматриваемый диапазон.
 
Сегментирование лучше всего работает, когда каждая транзакция в приложении может ограничиваться одним значением ключа сегментирования. Это гарантирует, что все транзакции будут осуществляться в пределах отдельной базы данных.

Некоторые приложения используют простой способ создания отдельной базы данных для каждого клиента. Это **шаблон сегментирования для одного клиента**, который предоставляет возможность изолирования, архивации и восстановления, а также масштабирования ресурсов согласно детализации клиента. Благодаря сегментированию для одного клиента каждая база данных привязывается к отдельному идентификатору клиента (или значению ключа клиента), но этот ключ не должен постоянно присутствовать в самих данных. За направление каждого запроса к соответствующей базе данных отвечает само приложение, а клиентская библиотека эластичной базы данных может упростить этот процесс.

![Сравнение многопользовательских версий одного клиента][3]

Другие сценарии объединяют несколько клиентов вместе в базах данных вместо изолирования их в отдельных базах данных. Это типовой **шаблон сегментирования на нескольких клиентов**; он может использоваться при обработке приложением большого числа очень маленьких клиентов. При сегментировании на несколько клиентов строки таблиц базы данных спроектированы для хранения ключа, идентифицирующего пользователя, или ключа сегментирования. Кроме того, уровень приложения отвечает за направление запроса клиента к соответствующей базе данных, что поддерживается клиентской библиотекой эластичной базы данных. Кроме того, безопасность на уровне строк можно использовать для фильтрации строк, доступных для каждого клиента — дополнительную информацию см. в разделе [Мультитенантные приложения с инструментами эластичных баз данных и безопасностью на уровне строк](sql-database-elastic-tools-multi-tenant-row-level-security.md). Перераспределение данных между базами данных может потребоваться при использовании шаблона многопользовательского сегментирования и обеспечивается службой разбиения и объединения эластичной базы данных.

[AZURE.INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]: ./media/sql-database-elastic-scale-introduction/overview.png
[2]: ./media/sql-database-elastic-scale-intro/tenancy.png
[3]: ./media/sql-database-elastic-scale-introduction/single_v_multi_tenant.png
[4]: ./media/sql-database-elastic-scale-introduction/h_versus_vert.png
 

<!---HONumber=July15_HO4-->