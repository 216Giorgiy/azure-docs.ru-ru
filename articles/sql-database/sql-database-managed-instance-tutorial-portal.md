---
title: 'Портал Azure: создание управляемого экземпляра базы данных SQL | Документация Майкрософт'
description: Создайте управляемый экземпляр базы данных SQL Azure в виртуальной сети и используйте SSMS для восстановления резервной копии базы данных Wide World Importers.
keywords: руководство по базе данных sql, создание управляемого экземпляра базы данных sql
services: sql-database
author: bonova
ms.reviewer: carlrab, srbozovi
ms.service: sql-database
ms.custom: managed instance
ms.topic: tutorial
ms.date: 03/14/2018
ms.author: bonova
manager: craigg
ms.openlocfilehash: 774a761465cfd886b85378a35dd43ac656a7ee48
ms.sourcegitcommit: 3a4ebcb58192f5bf7969482393090cb356294399
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/12/2018
---
# <a name="create-an-azure-sql-database-managed-instance-in-the-azure-portal"></a>Создание управляемого экземпляра базы данных SQL Azure на портале Azure

В этом руководстве описывается, как создать управляемый экземпляр базы данных SQL Azure (предварительная версия) с помощью портала Azure в выделенной подсети виртуальной сети. В нем также приводятся сведения о том, как подключиться к управляемому экземпляру с помощью SQL Server Management Studio на виртуальной машине в той же виртуальной сети, а затем восстановить резервную копию базы данных из хранилища BLOB-объектов Azure в управляемый экземпляр.

Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.

> [!IMPORTANT]
> Список регионов, в которых сейчас доступен Управляемый экземпляр см. в статье[Migrate your databases to a fully managed service with Azure SQL Database Managed Instance](https://azure.microsoft.com/blog/migrate-your-databases-to-a-fully-managed-service-with-azure-sql-database-managed-instance/) (Перенос баз данных в полностью управляемую службу при помощи Управляемого экземпляра Базы данных SQL Azure).
 
## <a name="log-in-to-the-azure-portal"></a>Войдите на портал Azure.

Войдите на [портал Azure](https://portal.azure.com/#create/Microsoft.SQLManagedInstance).

## <a name="whitelist-your-subscription"></a>Добавление подписки в список разрешенных

Управляемый экземпляр выпускается изначально как условная общедоступная предварительная версия. Чтобы ее использовать, необходимо добавить вашу подписку в список разрешенных. Если вы этого еще не сделали, выполните шаги ниже, чтобы принять условия предварительной версии и отправить запрос на включение вашей подписки в список разрешенных.

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. Найдите **Управляемый экземпляр**, а затем выберите **Azure SQL Database Managed Instance (preview)** (Управляемый экземпляр базы данных SQL Azure (предварительная версия)).
3. Нажмите кнопку **Создать**.

   ![создание управляемого экземпляра](./media/sql-database-managed-instance-tutorial/managed-instance-create.png)

3. Выберите подписку, щелкните **Условия предварительной версии**, а затем введите необходимые сведения.

   ![условия предварительной версии управляемого экземпляра](./media/sql-database-managed-instance-tutorial/preview-terms.png)

5. По завершении нажмите кнопку **ОК**.

   ![условия предварительной версии управляемого экземпляра](./media/sql-database-managed-instance-tutorial/preview-approval-pending.png)

   > [!NOTE]
   > В ожидании утверждения предварительной версии можно продолжить работу с этим руководством и выполнить шаги, описанные в разделах ниже.

## <a name="configure-a-virtual-network-vnet"></a>Настройка виртуальной сети

В шагах ниже описывается, как создать виртуальную сеть [Azure Resource Manager](../azure-resource-manager/resource-manager-deployment-model.md) для управляемого экземпляра. Дополнительные сведения о настройке виртуальной сети для управляемого экземпляра базы данных SQL Azure см. в [этой статье](sql-database-managed-instance-vnet-configuration.md).

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. Найдите и выберите **виртуальную сеть**, для режима развертывания выберите **диспетчер ресурсов**, а затем нажмите кнопку **Создать**.

   ![создание виртуальной сети](./media/sql-database-managed-instance-tutorial/virtual-network-create.png)

3. Укажите запрошенные сведения в форме виртуальной сети, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | Описание |
   | ------ | --------------- | ----------- |
   |**Имя**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Пространство адресов**|Любой допустимый диапазон адресов, например 10.14.0.0/24.|Имя адреса виртуальной сети в нотации CIDR.|
   |**Подписка**|Ваша подписка|Дополнительные сведения о подписках см. [здесь](https://account.windowsazure.com/Subscriptions).|
   |**Группа ресурсов**|Любая допустимая группа ресурсов (новая или имеющаяся)|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Местоположение.**|Любое допустимое расположение| Дополнительные сведения о регионах Azure см. [здесь](https://azure.microsoft.com/regions/).|
   |**Имя подсети**|Любое допустимое имя подсети, например mi_subnet|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Диапазон адресов подсети**|Любой допустимый адрес подсети, например 10.14.0.0/28. Используйте адресное пространство подсети меньше адресного пространства виртуальной сети, чтобы позволить создавать в последней другие подсети, например подсеть для размещения тестовых и клиентских приложений или подсети шлюза для подключения из локальных или других виртуальных сетей.|Диапазон адресов подсети в нотации CIDR. Он должен содержаться в адресном пространстве виртуальной сети.|
   |**Конечные точки службы**|Отключено|Включает одну или несколько конечных точек службы для этой подсети.|
   ||||

   ![форма создания виртуальной сети](./media/sql-database-managed-instance-tutorial/virtual-network-create-form.png)

4. Нажмите кнопку **Создать**.

## <a name="create-new-route-table-and-a-route"></a>Создание таблицы маршрутов и маршрута

В шагах ниже показано, как создать интернет-маршрут следующего прыжка 0.0.0.0/0.

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. Найдите и выберите **Таблица маршрутов**, а затем на странице таблицы маршрутов нажмите кнопку **Создать**. 

   ![создание таблицы маршрутов](./media/sql-database-managed-instance-tutorial/route-table-create.png)

3. Укажите запрошенные сведения в форме таблицы маршрутов, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | Описание |
   | ------ | --------------- | ----------- |
   |**Имя**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Подписка**|Ваша подписка|Дополнительные сведения о подписках см. [здесь](https://account.windowsazure.com/Subscriptions).|
   |**Группа ресурсов**|Выберите группу ресурсов, созданную на предыдущем шаге.|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Местоположение.**|Выберите расположение, указанное в процедуре выше.| Дополнительные сведения о регионах Azure см. [здесь](https://azure.microsoft.com/regions/).|
   |**Отключение распространения маршрутов BCP**|Отключено||
   ||||

   ![форма создания таблицы маршрутов](./media/sql-database-managed-instance-tutorial/route-table-create-form.png)

4. Нажмите кнопку **Создать**.
5. После создания таблицы маршрутов откройте ее.

   ![таблица маршрутов](./media/sql-database-managed-instance-tutorial/route-table.png)

6. Щелкните **Маршруты**, а затем нажмите кнопку **Добавить**.

   ![добавление таблицы маршрутов](./media/sql-database-managed-instance-tutorial/route-table-add.png)

7.  Добавьте **интернет-маршрут следующего прыжка 0.0.0.0/0** как **единственный** маршрут, используя сведения в таблице ниже.

    | Параметр| Рекомендуемое значение | ОПИСАНИЕ |
    | ------ | --------------- | ----------- |
    |**Имя маршрута**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
    |**Префикс адреса**|0.0.0.0/0|IP-адрес назначения в нотации CIDR, к которому относится этот маршрут.|
    |**Тип следующего прыжка**|Интернет|Следующий прыжок обрабатывает соответствующие пакеты для этого маршрута.|
    |||

    ![маршрут](./media/sql-database-managed-instance-tutorial/route.png)

8. Последовательно выберите **ОК**.

## <a name="to-apply-the-route-table-to-the-managed-instance-subnet"></a>Применение таблицы маршрутов к подсети управляемого экземпляра

Ниже показано, как задать новую таблицу маршрутов для подсети управляемого экземпляра.

1. Для установки таблицы маршрутов в подсети управляемого экземпляра откройте ранее созданную виртуальную сеть.
2. Щелкните **Подсети**, а затем выберите подсеть управляемого экземпляра (**mi_subnet** на следующем снимке экрана).

    ![подсеть](./media/sql-database-managed-instance-tutorial/subnet.png)

11. Щелкните **Таблица маршрутов** и выберите **myMI_route_table**.

    ![настройка таблицы маршрутов](./media/sql-database-managed-instance-tutorial/set-route-table.png)

12. Нажмите кнопку **Сохранить**

    ![настройка и сохранение таблицы маршрутов](./media/sql-database-managed-instance-tutorial/set-route-table-save.png)

## <a name="create-a-managed-instance"></a>Создание управляемого экземпляра

Ниже показано, как создать управляемый экземпляр после утверждения предварительной версии.

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. Найдите **Управляемый экземпляр**, а затем выберите **Azure SQL Database Managed Instance (preview)** (Управляемый экземпляр базы данных SQL Azure (предварительная версия)).
3. Нажмите кнопку **Создать**.

   ![создание управляемого экземпляра](./media/sql-database-managed-instance-tutorial/managed-instance-create.png)

3. Выберите свою подписку и проверьте, чтобы для условий предварительной версии было выбрано значение **Принято**.

   ![значение "Принято" для условий предварительной версии управляемого экземпляра](./media/sql-database-managed-instance-tutorial/preview-accepted.png)

4. Укажите запрошенные сведения в форме управляемого экземпляра, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | ОПИСАНИЕ |
   | ------ | --------------- | ----------- |
   |**Имя управляемого экземпляра**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Имя для входа администратора управляемого экземпляра**|Любое допустимое имя пользователя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).| 
   |**Пароль**|Любой допустимый пароль|Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md#what-are-the-password-requirements-when-creating-a-vm).|
   |**Группа ресурсов**|Группа ресурсов, созданная ранее||
   |**Местоположение.**|Ранее выбранное расположение|Дополнительные сведения о регионах Azure см. [здесь](https://azure.microsoft.com/regions/).|
   |**Виртуальная сеть**|Созданная ранее виртуальная сеть|

   ![форма создания управляемого экземпляра](./media/sql-database-managed-instance-tutorial/managed-instance-create-form.png)

5. Щелкните поле **Ценовая категория**, чтобы выбрать размер вычислительных ресурсов и ресурсов хранения, а также просмотреть варианты ценовой категории. По умолчанию ваш экземпляр бесплатно получает 32 ГБ свободного места в хранилище, чего может быть недостаточно для приложений.
6. Укажите нужный объем хранилища и количество виртуальных ядер, используя ползунки или текстовые поля. 
   ![форма создания управляемого экземпляра](./media/sql-database-managed-instance-tutorial/managed-instance-pricing-tier.png)

7. По завершении нажмите кнопку **Применить** для сохранения выбранных параметров.  
8. Нажмите кнопку **Создать**, чтобы развернуть управляемый экземпляр.
9. Щелкните значок **уведомлений**, чтобы просмотреть состояние развертывания.
 
   ![ход выполнения развертывания](./media/sql-database-managed-instance-tutorial/deployment-progress.png)

9. Щелкните **Deployment in progress** (Развертывание в процессе выполнения), чтобы открыть окно управляемого экземпляра для дальнейшего мониторинга хода выполнения развертывания.
 
   ![ход выполнения развертывания, часть 2](./media/sql-database-managed-instance-tutorial/managed-instance.png)

В ходе выполнения развертывания приступите к выполнению шага ниже.

> [!IMPORTANT]
> Первый экземпляр в подсети обычно развертывается намного дольше, чем последующие экземпляры. Иногда развертывание первого экземпляра может занять более 24 часов. Не стоит из-за этого отменять развертывание, так как это временное явление. После выпуска общедоступной предварительной версии развертывание будет занимать значительно меньше времени.

## <a name="create-a-new-subnet-in-the-vnet-for-a-virtual-machine"></a>Создание подсети в виртуальной сети для виртуальной машины

Ниже показано, как создать вторую подсеть в виртуальной сети для виртуальной машины, на которой вы установите решение SQL Server Management Studio и с которой подключитесь к управляемому экземпляру.

1. Откройте ресурс виртуальной сети.
 
   ![Виртуальная сеть](./media/sql-database-managed-instance-tutorial/vnet.png)

2. Щелкните **Подсети**, а затем — **Подсеть**.
 
   ![добавление подсети](./media/sql-database-managed-instance-tutorial/add-subnet.png)

3. Укажите запрошенные сведения в форме подсети, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | Описание |
   | ------ | --------------- | ----------- |
   |**Имя**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Диапазон адресов (блок CIDR)**|Любой допустимый диапазон адресов в виртуальной сети (используется по умолчанию).||
   |**группа безопасности сети**.|Нет||
   |**Таблица маршрутов**|None||
   |**Конечные точки службы**|None||

   ![сведения о подсети виртуальной машины](./media/sql-database-managed-instance-tutorial/vm-subnet-details.png)

4. Последовательно выберите **ОК**.

## <a name="create-a-virtual-machine-in-the-new-subnet-in-the-vnet"></a>Создание виртуальной машины в новой подсети в виртуальной сети

Ниже показано, как создать виртуальную машину в той же виртуальной сети, в которой создан управляемый экземпляр. 

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. Выберите **Вычисления**, а затем — **Windows Server 2016 Datacenter** или **Windows 10**. В этом разделе руководства используется Windows Server. Настройка Windows 10 выполняется похожим образом. 

   ![среда выполнения приложений](./media/sql-database-managed-instance-tutorial/compute.png)

3. Укажите запрошенные сведения в форме виртуальной машины, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | Описание |
   | ------ | --------------- | ----------- |
   |**Имя**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   | **Тип диска виртуальной машины**|SSD|Диски SSD обеспечивают оптимальный баланс между ценой и производительностью.|   
   |**Имя пользователя**|Любое допустимое имя пользователя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).| 
   |**Пароль**|Любой допустимый пароль|Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md#what-are-the-password-requirements-when-creating-a-vm).| 
   |**Подписка**|Ваша подписка|Дополнительные сведения о подписках см. [здесь](https://account.windowsazure.com/Subscriptions).|
   |**Группа ресурсов**|Группа ресурсов, созданная ранее||
   |**Местоположение.**|Ранее выбранное расположение||
   |**Уже есть лицензия Windows**|Нет |Если вы владеете лицензиями Windows с активной подпиской Software Assurance (SA), используйте преимущество гибридного использования Azure, чтобы снизить стоимость вычислений.|
   ||||

   ![форма создания виртуальной машины](./media/sql-database-managed-instance-tutorial/virtual-machine-create-form.png)

3. Последовательно выберите **ОК**.
4. Выберите размер виртуальной машины. Чтобы просмотреть дополнительные размеры, выберите **Просмотреть все** или измените фильтр **Supported disk type** (Поддерживаемые типы диска). Для работы с этим руководством требуется только виртуальная машина небольшого размера.

    ![Размеры виртуальной машины](./media/sql-database-managed-instance-tutorial/virtual-machine-size.png)  

5. Нажмите кнопку **Выбрать**.
6. В форме **Параметры** щелкните **Подсеть**, а затем выберите **vm_subnet**. Не выбирайте подсеть, в которой подготовлен управляемый экземпляр, выберите другую подсеть в этой же виртуальной сети.

    ![Параметры виртуальной машины](./media/sql-database-managed-instance-tutorial/virtual-machine-settings.png)  

7. Последовательно выберите **ОК**.
8. На странице сводки просмотрите сведения о предложении и нажмите кнопку **Создать**, чтобы начать развертывание виртуальной машины.
 
## <a name="connect-to-virtual-machine"></a>Подключение к виртуальной машине

В шагах ниже показано, как подключиться к только что созданной виртуальной машине по протоколу удаленного рабочего стола.

1. После завершения развертывания перейдите в ресурс виртуальной машины.

    ![ВМ](./media/sql-database-managed-instance-tutorial/vm.png)  

2. Нажмите кнопку **Подключиться** в свойствах виртуальной машины. Будет создан и скачан файл протокола удаленного рабочего стола (RDP-файл).
3. Чтобы подключиться к виртуальной машине, откройте скачанный RDP-файл. 
4. При появлении запроса нажмите кнопку **Подключиться**. На компьютере Mac вам понадобится клиент RDP, например [Remote Desktop Client](https://itunes.apple.com/us/app/microsoft-remote-desktop/id715768417?mt=12) из Mac App Store.

5. Введите имя пользователя и пароль, указанные при создании виртуальной машины, и нажмите кнопку **ОК**.

6. При входе в систему может появиться предупреждение о сертификате. Чтобы продолжить процесс подключения, нажмите кнопку **Да** или **Продолжить**.

Вы подключились к виртуальной машине на панели мониторинга диспетчера сервера.

> [!IMPORTANT]
> Подождите, пока не завершится подготовка управляемого экземпляра. После подготовки введите имя узла экземпляра в поле **Управляемый экземпляр** на вкладке **Обзор**. Имя будет выглядеть примерно так: **drfadfadsfd.tr23.westus1-a.worker.database.windows.net**.

## <a name="install-ssms-and-connect-to-the-managed-instance"></a>Установка SSMS и подключение к управляемому экземпляру

В шагах ниже описано, как загрузить и установить SSMS, а затем подключиться к управляемому экземпляру.

1. Щелкните **Локальный сервер** в левой части окна диспетчера сервера.

    ![свойства диспетчера сервера](./media/sql-database-managed-instance-tutorial/server-manager-properties.png)  

2. В области **свойств** щелкните **Вкл.**, чтобы изменить конфигурацию усиленной безопасности IE.
3. В диалоговом окне **Конфигурация усиленной безопасности Internet Explorer** щелкните **Выкл.** в разделе администраторов, а затем нажмите кнопку **ОК**.

    ![конфигурация усиленной безопасности Internet Explorer](./media/sql-database-managed-instance-tutorial/internet-explorer-security-configuration.png)  
4. На панели задач откройте **Internet Explorer**.
5. Выберите **Использовать рекомендуемые параметры безопасности, конфиденциальности и совместимости** и нажмите кнопку **ОК**, чтобы завершить установку Internet Explorer 11.
6. Введите в поле URL-адреса https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms и щелкните **Ввод**. 
7. Загрузите последнюю версию SQL Server Management Studio и при появлении запроса щелкните **Запустить**.
8. При появлении запроса щелкните **Установить**.
9. По завершении установки щелкните **Закрыть**.
10. Откройте среду SSMS.
11. В диалоговом окне **подключения к серверу** введите **имя узла* для управляемого экземпляра в поле **Имя сервера**, для типа аутентификации выберите **Проверка подлинности SQL Server**, введите имя пользователя и пароль, а затем нажмите кнопку **Подключиться**.

    ![подключение SSMS](./media/sql-database-managed-instance-tutorial/ssms-connect.png)  

После подключения можно просмотреть системные и пользовательские базы данных на узле "Базы данных" и различные объекты на узлах "Безопасность", "Объекты сервера", "Репликация", "Управление", "Агент SQL Server" и "Профилировщик XEvent".

## <a name="download-the-wide-world-importers---standard-backup-file"></a>Загрузка Wide World Importers — стандартного файла резервной копии

Чтобы загрузить Wide World Importers — стандартный файл резервной копии, выполните шаги ниже.

В Internet Explorer введите в поле URL-адреса https://github.com/Microsoft/sql-server-samples/releases/download/wide-world-importers-v1.0/WideWorldImporters-Standard.bak и при появлении запроса щелкните **Сохранить**, чтобы сохранить этого файла в папку **Загрузки**.

## <a name="create-azure-storage-account-and-upload-backup-file"></a>Создание учетной записи хранения Azure и передача файла резервной копии

1. Щелкните **Создать ресурс** в верхнем левом углу окна портала Azure.
2. Найдите **Хранилище**, а затем щелкните **Учетная запись хранения**, чтобы открыть форму учетной записи хранения.

   ![запись хранения Azure](./media/sql-database-managed-instance-tutorial/storage-account.png)

3. Укажите запрошенные сведения в форме учетной записи хранения, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | Описание |
   | ------ | --------------- | ----------- |
   |**Имя**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Модель развертывания**|Модель ресурсов||
   |**Account kind** (Тип учетной записи)|Хранилище BLOB-объектов||
   |**Производительность**|Standard или Premium|Магнитные диски или диски SSD.|
   |**Репликация**|Локально избыточное хранилище||
   |**Уровень доступа (по умолчанию)|"Холодный" или "горячий"||
   |**Secure transfer required** (Требуется безопасное перемещение)|Отключено||
   |**Подписка**|Ваша подписка|Дополнительные сведения о подписках см. [здесь](https://account.windowsazure.com/Subscriptions).|
   |**Группа ресурсов**|Группа ресурсов, созданная ранее|| 
   |**Местоположение.**|Ранее выбранное расположение||
   |**Виртуальные сети**|Отключено||

4. Нажмите кнопку **Создать**.

   ![сведения об учетной записи хранения](./media/sql-database-managed-instance-tutorial/storage-account-details.png)

5. После успешного развертывания учетной записи хранения откройте новую учетную запись хранения.
6. В разделе **Параметры** щелкните **Подписанный URL-адрес**, чтобы открыть форму подписанного URL-адреса (SAS).

   ![форма SAS](./media/sql-database-managed-instance-tutorial/sas-form.png)

7. При необходимости измените в форме SAS значения по умолчанию. Обратите внимание, что по умолчанию дата и время истечения срока действия составляет всего 8 часов.
8. Нажмите кнопку **Создать SAS**.

   ![завершение создания формы SAS](./media/sql-database-managed-instance-tutorial/sas-generate.png)

9. Скопируйте и сохраните **маркер SAS** и **подписанный URL-адрес сервера больших двоичных объектов**.
10. В разделе **Параметры** щелкните **Контейнеры**.

    ![containers](./media/sql-database-managed-instance-tutorial/containers.png)

11. Нажмите кнопку **+ Контейнер**, чтобы создать контейнер для хранения файла резервной копии.
12. Укажите запрошенные сведения в форме контейнера, используя данные в таблице ниже.

    | Параметр| Рекомендуемое значение | Описание |
   | ------ | --------------- | ----------- |
   |**Имя**|Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Уровень общего доступа**|Закрытый (отсутствие анонимного доступа)||

    ![сведения о контейнере](./media/sql-database-managed-instance-tutorial/container-detail.png)

13. Последовательно выберите **ОК**.
14. После создания контейнера откройте его.

    ![container](./media/sql-database-managed-instance-tutorial/container.png)

15. Щелкните **Свойства контейнера**, а затем скопируйте URL-адрес контейнера.

    ![URL-адрес контейнера](./media/sql-database-managed-instance-tutorial/container-url.png)

16. Щелкните **Отправить**, чтобы открыть форму **Отправить BLOB-объект**.

    ![upload](./media/sql-database-managed-instance-tutorial/upload.png)

17. Перейдите в папку "Загрузки" и выберите файл **AdventureWorks2016.bak**.

    ![upload](./media/sql-database-managed-instance-tutorial/upload-bak.png)

18. Щелкните **Отправить**.
19. Подождите завершения отправки.

    ![завершение отправки](./media/sql-database-managed-instance-tutorial/upload-complete.png)


## <a name="restore-the-wide-world-importers-database-from-a-backup-file"></a>Восстановление базы данных Wide World Importers из файла резервной копии

С помощью SSMS выполните следующие шаги для восстановления базы данных Wide World Importers в управляемый экземпляр из файла резервной копии.

1. Откройте в SSMS окно нового запроса.
2. Используйте сценарий ниже для создания учетных данных SAS. Введите URL-адрес контейнера учетной записи хранения и ключ SAS, как указано.

   ```
CREATE CREDENTIAL [https://<storage_account_name>.blob.core.windows.net/<container>] 
WITH IDENTITY = 'SHARED ACCESS SIGNATURE'
, SECRET = '<shared_access_signature_key_with_removed_first_?_symbol>' 
   ```

    ![credential](./media/sql-database-managed-instance-tutorial/credential.png)

3. Используйте сценарий ниже для проверки учетных данных SAS и срока действия резервной копии. Укажите URL-адрес контейнера, в котором находится файл резервной копии.

   ```
   RESTORE FILELISTONLY FROM URL = 
   'https://<storage_account_name>.blob.core.windows.net/<container>/WideWorldImporters-Standard.bak'
   ```

    ![список файлов](./media/sql-database-managed-instance-tutorial/file-list.png)

4. Используйте сценарий ниже для восстановления базы данных Adventure Works 2012 из файла резервной копии. Укажите URL-адрес контейнера, в котором находится этот файл.

   ```
   RESTORE DATABASE [Wide World Importers] FROM URL =
  'https://<storage_account_name>.blob.core.windows.net/<container>/WideWorldImporters-Standard.bak'`
   ```

    ![выполнение восстановления](./media/sql-database-managed-instance-tutorial/restore-executing.png)

5. Чтобы отслеживать состояние восстановления, выполните следующий запрос в новом сеансе запроса:

   ```
SELECT session_id as SPID, command, a.text AS Query, start_time, percent_complete
, dateadd(second,estimated_completion_time/1000, getdate()) as estimated_completion_time 
FROM sys.dm_exec_requests r 
CROSS APPLY sys.dm_exec_sql_text(r.sql_handle) a 
WHERE r.command in ('BACKUP DATABASE','RESTORE DATABASE')`
   ```

    ![завершение восстановления в процентах](./media/sql-database-managed-instance-tutorial/restore-percent-complete.png)

6. По завершении восстановления просмотрите восстановленную базу данных в обозревателе объектов. 

    ![полное завершение восстановления](./media/sql-database-managed-instance-tutorial/restore-complete.png)

## <a name="next-steps"></a>Дополнительная информация

- Сведения об управляемом экземпляре см. в статье [обзора управляемого экземпляра](sql-database-managed-instance.md).
- Дополнительные сведения о настройке виртуальной сети для управляемого экземпляра базы данных SQL Azure см. в [этой статье](sql-database-managed-instance-vnet-configuration.md).
- Сведения о подключении приложения к управляемому экземпляру базы данных SQL Azure см. в [этой статье](sql-database-managed-instance-connect-app.md).
- Сведения об использовании Azure Database Migration Service (DMS) для миграции см. в статье о [миграции SQL Server в управляемый экземпляр базы данных SQL Azure](../dms/tutorial-sql-server-to-managed-instance.md).
