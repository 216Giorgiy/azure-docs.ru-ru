---
title: "Выполнение запросов ad-hoc-аналитики по всем клиентам (пример приложения SaaS, использующего базу данных SQL Azure) | Документация Майкрософт"
description: "Выполнение запросов ad-hoc-аналитики по всем клиентам"
keywords: "руководство по базе данных sql"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: tutorial
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 05/10/2017
ms.author: billgib; sstein
ms.translationtype: Human Translation
ms.sourcegitcommit: 71fea4a41b2e3a60f2f610609a14372e678b7ec4
ms.openlocfilehash: c00c25116002c46fc94c5ea59acc101a2055b689
ms.contentlocale: ru-ru
ms.lasthandoff: 05/10/2017


---
# <a name="run-ad-hoc-analytics-queries-across-all-wtp-tenants"></a>Выполнение запросов ad-hoc-аналитики по всем клиентам WTP

С помощью этого руководства вы сможете создать базу данных ad-hoc-аналитики и выполнить несколько запросов по всем клиентам. С помощью этих запросов можно извлекать сводки, скрытые в текущих операционных данных приложения WTP.

Чтобы выполнить запросы ad-hoc-аналитики (по всем клиентам), приложение WTP использует [эластичный запрос](sql-database-elastic-query-overview.md) и базу данных аналитики.


Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]

> * Развертывание базы данных ad-hoc-аналитики
> * как выполнить распределенные запросы по всем клиентским базам данных.



Для работы с этим руководством выполните следующие предварительные требования:

* Разверните приложение WTP. Чтобы развернуть его менее чем за пять минут, см. сведения в статье [Развертывание и изучение мультитенантного приложения SaaS, использующего базу данных Azure SQL](sql-database-saas-tutorial.md).
* Установите Azure PowerShell. Дополнительные сведения см. в статье [Начало работы с Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).


## <a name="ad-hoc-analytics-pattern"></a>Модель ad-hoc-аналитики

Одной из основных возможностей приложений SaaS является использование огромного числа клиентских данных, хранящихся в облаке. Используйте эти данные для более детального ознакомления с работой и использованием приложений, клиентов, их пользователей, а также с преимуществами клиентов и их режимом работы. Эти сведения будут полезны при разработке функций, помогут повысить удобство использования, а также обеспечить вложение дополнительных средств в приложения и службы.

Доступ к этим данным получить очень просто, если они содержатся в отдельной мультитенантной базе данных, но не так просто, если они распределены по тысячам масштабируемых баз данных. Одним из подходов является использование эластичного запроса, который позволяет выполнять ad-hoc-запросы в распределенном наборе баз данных с общей схемой. Эластичный запрос использует отдельную *головную* базу данных, в которой внешние таблицы определены как зеркальные в распределенных (клиентских) базах данных. Запросы, отправленные к этой головной базе данных, компилируются для создания распределенного плана запроса с частями запроса, которые при необходимости можно принудительно установить в клиентских базах данных. Эластичный запрос использует карту сегментов в базе данных каталога для предоставления расположения клиентских баз данных. При настройке и выполнении запроса используется стандартный язык T-SQL, поддерживающий ad-hoc-запросы из инструментов Power BI и Excel.

## <a name="get-the-wingtip-application-scripts"></a>Получение сценариев приложения Wingtip

Сценарий Wingtip Tickets и исходный код приложения доступны в репозитории GitHub [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS). Файлы сценариев находятся в папке [Learning Modules](https://github.com/Microsoft/WingtipSaaS/tree/master/Learning%20Modules). Скачайте папку **Learning Modules** на локальный компьютер, сохраняя ее структуру.

## <a name="deploy-the-database-used-for-ad-hoc-analytics-queries"></a>Развертывание базы данных, используемой для запросов ad-hoc-аналитики

С помощью этого действия можно выполнить развертывание базы данных ad-hoc-аналитики, содержащей схему, используемую для выполнения ad-hoc-запросов, охватывающих все клиентские базы данных.

1. Откройте в *интегрированной среде сценариев PowerShell* \\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1*, а затем задайте следующие значения:
   * **$DemoScenario** = 2, **Deploy Ad-hoc analytics database**.

1. Нажмите клавишу **F5**, чтобы запустить сценарий и создать новую базу данных SQL для ad-hoc-аналитики, а затем добавить ее в каталог WTP. Таблицы TicketPurchases, Tickets и Venues добавляются как внешние таблицы, которые можно запросить.
   Вы можете получить предупреждение *Сервер RPC недоступен*. Это обычное явление.


Теперь у вас есть база данных *adhocanalytics*, которую можно использовать для выполнения распределенных запросов, а также сбора сведений по всем клиентам.

## <a name="run-ad-hoc-analytics-queries"></a>Выполнение запросов ad-hoc-аналитики

С помощью этого действия можно выполнить запросы ad-hoc-аналитики, чтобы получить сведения о клиенте из приложения WTP.

1. Откройте в SSMS \\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql*.
1. Подключитесь к базе данных **adhocanalytics**.
1. Выберите отдельный запрос, который вы хотите выполнить, а затем нажмите клавишу **F5**:

    ![query](media/sql-database-saas-tutorial-adhoc-analytics/query.png)




## <a name="next-steps"></a>Дальнейшие действия

Из этого руководства вы узнали следующее:

> [!div class="checklist"]

> * Развертывание базы данных ad-hoc-аналитики
> * как выполнить распределенные запросы по всем клиентским базам данных.

[Setup and use Log Analytics (OMS) with the WTP sample SaaS app](sql-database-saas-tutorial-log-analytics.md) (Установка и использование Log Analytics (OMS) с примером приложения SaaS WTP)

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Руководства по работе с SaaS-приложением WTP, использующим базу данных SQL Azure](sql-database-wtp-overview.md#sql-database-wtp-saas-tutorials)
* [Обзор эластичных запросов к базе данных SQL Azure (предварительная версия)](sql-database-elastic-query-overview.md)

