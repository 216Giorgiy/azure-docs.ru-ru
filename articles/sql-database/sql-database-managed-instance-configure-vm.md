---
title: Подключение клиентской виртуальной машины к Управляемому экземпляру Базы данных SQL Azure | Документация Майкрософт
description: Подключение к Управляемому экземпляру Базы данных SQL Azure из виртуальной машины Azure с помощью SQL Server Management Studio.
services: sql-database
ms.service: sql-database
ms.subservice: managed-instance
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: jovanpop-msft
ms.author: jovanpop
ms.reviewer: carlrab, srbozovi, bonova
manager: craigg
ms.date: 09/13/2018
ms.openlocfilehash: 08b8e37493ea7bc549a2352aaa6714ef7c65bfdb
ms.sourcegitcommit: 51a1476c85ca518a6d8b4cc35aed7a76b33e130f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2018
ms.locfileid: "47159522"
---
# <a name="configure-azure-vm-to-connect-to-an-azure-sql-database-managed-instance"></a>Настройка виртуальной машины Azure для подключения к Управляемому экземпляру Базы данных SQL Azure

В этом кратком руководстве показано, как настроить виртуальную машину Azure для подключения к Управляемому экземпляру Базы данных SQL Azure с помощью SQL Server Management Studio (SSMS). Краткое руководство по подключению с локального клиентского компьютера с использованием подключения "точка — сеть" см. в [этой статье](sql-database-managed-instance-configure-p2s.md) 

## <a name="prerequisites"></a>Предварительные требования

В рамках этого краткого руководства в качестве начальной точки используются ресурсы, созданные в руководстве: [Создание Управляемого экземпляра SQL Azure](sql-database-managed-instance-get-started.md).

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портале Azure](https://portal.azure.com/).

## <a name="create-a-new-subnet-in-the-managed-instance-vnet"></a>Создание подсети в виртуальной сети Управляемого экземпляра

Здесь показано, как создать подсеть в виртуальной сети Управляемого экземпляра, чтобы виртуальная машина Azure могла подключаться к Управляемому экземпляру. Для Управляемых экземпляров выделяется подсеть, и вы не можете создавать какие-либо другие ресурсы (например, Виртуальные машины Azure) в этой подсети. 

1. Откройте группу ресурсов для Управляемого экземпляра, созданного в рамках краткого руководства [по созданию Управляемого экземпляра](sql-database-managed-instance-get-started.md), выберите виртуальную сеть для Управляемого экземпляра, а затем щелкните **Подсети**.

   ![Ресурсы Управляемого экземпляра](./media/sql-database-managed-instance-configure-vm/resources.png)

2. Щелкните знак **+** рядом с разделом **Подсети**, чтобы создать подсеть.

   ![Подсети Управляемого экземпляра](./media/sql-database-managed-instance-configure-vm/subnets.png)

3. Укажите запрошенные сведения в форме, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | Описание |
   | ---------------- | ----------------- | ----------- | 
   | **Имя** | Любое допустимое имя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   | **Диапазон адресов (блок CIDR)** | Допустимый диапазон значений | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **группа безопасности сети**. | None | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **Таблица маршрутов** | None | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **Конечные точки службы ** | Выбрано значение 0. | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
   | **Делегирование подсети** | None | Значение по умолчанию подходит для использования в рамках этого краткого руководства.|
 
   ![Создание подсети Управляемого экземпляра для клиентской виртуальной машины](./media/sql-database-managed-instance-configure-vm/new-subnet.png)

4. Нажмите кнопку **ОК**, чтобы создать дополнительную подсеть в виртуальной сети Управляемого экземпляра.

## <a name="create-a-virtual-machine-in-the-new-subnet-in-the-vnet"></a>Создание виртуальной машины в новой подсети в виртуальной сети

Ниже показано, как создать виртуальную машину в новой подсети, для подключения к Управляемому экземпляру. 

## <a name="prepare-the-azure-virtual-machine"></a>Подготовка виртуальной машины Azure

Так как Управляемый экземпляр SQL размещается в частной виртуальной сети, необходимо создать виртуальную машину Azure с помощью какого-либо установленного инструмента клиента SQL, например SQL Server Management Studio или Azure Data Studio, для подключения к Управляемому экземпляру и выполнения запросов. В этом кратком руководстве используется SQL Server Management Studio.

Самый простой способ создать виртуальную машину клиента со всеми необходимыми инструментами — использовать шаблоны Azure Resource Manager.

1. Нажмите следующую кнопку, чтобы создать виртуальную машину клиента и установить SQL Server Management Studio (убедитесь, что на другой вкладке браузера выполнен вход на портал Azure):

    <a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fjovanpop-msft%2Fazure-quickstart-templates%2Fsql-win-vm-w-tools%2F201-vm-win-vnet-sql-tools%2Fazuredeploy.json" target="_blank"><img src="http://azuredeploy.net/deploybutton.png"/></a>

2. Укажите запрошенные сведения в форме, используя данные в таблице ниже.

   | Параметр| Рекомендуемое значение | Описание |
   | ---------------- | ----------------- | ----------- |
   | **Подписка** | Допустимая подписка | Необходимо использовать подписку, в которой есть разрешение на создание ресурсов. |
   | **Группа ресурсов** |Группа ресурсов, указанная в кратком руководстве по [созданию Управляемого экземпляра](sql-database-managed-instance-get-started.md).|Необходимо использовать группу ресурсов, в которой находится виртуальная сеть.|
   | **Местоположение.** | Расположение группы ресурсов | Это значение заполняется на основе выбранной группы ресурсов. | 
   | **Имя виртуальной машины**  | Любое допустимое имя | Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions).|
   |**Имя администратора**|Любое допустимое имя пользователя|Сведения о допустимых именах см. в статье [Соглашения об именовании](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions). Не используйте serveradmin. Это имя зарезервировано для роли уровня сервера.| 
   |**Пароль**|Любой допустимый пароль|Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md#what-are-the-password-requirements-when-creating-a-vm).|
   | **Размер виртуальной машины** | Любой допустимый размер | Размера по умолчанию в этом шаблоне (**Standard_B2s) достаточно для работы с этим руководством. |
   | **Местоположение.**|[resourceGroup().location].| Не изменяйте это значение. |
   | **Имя виртуальной сети**|Ранее выбранное расположение|Дополнительные сведения о регионах Azure см. [здесь](https://azure.microsoft.com/regions/).|
   | **Имя подсети**|Имя подсети, созданной при выполнении предыдущей процедуры| Не выбирайте подсеть, в которой создан Управляемый экземпляр.|
   | **artifacts Location** (Расположение артефактов) | [deployment().properties.templateLink.uri]. Не изменяйте это значение |
   | **artifacts Location Sas token** (Маркер SAS расположения артефактов) | Не указывайте. | Не изменяйте это значение. |

   ![создание виртуальной машины клиента](./media/sql-database-managed-instance-configure-vm/create-client-sql-vm.png)

   Если вы использовали предложенное имя виртуальной сети и подсеть по умолчанию из статьи [Создание Управляемого экземпляра SQL Azure](sql-database-managed-instance-get-started.md), не изменяйте последние два параметра. В противном случае следует заменить эти значения на те, которые вы ввели при настройке сетевой среды.

3. Установите флажок **I agree to terms and conditions stated above** (Я принимаю указанные выше условия).
4. Нажмите кнопку **Приобрести**, чтобы развернуть виртуальную машину Azure в вашей сети.
5. Щелкните значок **уведомлений**, чтобы просмотреть состояние развертывания.
   
   Подождите, пока создается виртуальная машина Azure. 

## <a name="connect-to-virtual-machine"></a>Подключение к виртуальной машине

В шагах ниже показано, как подключиться к только что созданной виртуальной машине по протоколу удаленного рабочего стола.

1. После завершения развертывания перейдите в ресурс виртуальной машины.

    ![ВМ](./media/sql-database-managed-instance-configure-vm/vm.png)  

2. Щелкните **Подключить**. 
   
   Для виртуальной машины отобразится форма файла протокола удаленного рабочего стола (RDP-файл), а также общедоступный IP-адрес и номер порта. 

   ![Форма RDP](./media/sql-database-managed-instance-configure-vm/rdp.png)  

3. Щелкните **Скачать RDP-файл**.
 
   > [!NOTE]
   > Вы также можете подключаться к виртуальной машине по протоколу SSH.

4. Закройте форму **Connect to virtual machine** (Подключение к виртуальной машине).
5. Чтобы подключиться к виртуальной машине, откройте скачанный RDP-файл. 
6. При появлении запроса нажмите кнопку **Подключиться**. На компьютере Mac вам понадобится клиент RDP, например [Remote Desktop Client](https://itunes.apple.com/us/app/microsoft-remote-desktop/id715768417?mt=12) из Mac App Store.

6. Введите имя пользователя и пароль, указанные при создании виртуальной машины, и нажмите кнопку **ОК**.

7. При входе в систему может появиться предупреждение о сертификате. Чтобы продолжить процесс подключения, нажмите кнопку **Да** или **Продолжить**.

Вы подключились к виртуальной машине на панели мониторинга диспетчера сервера.

## <a name="use-ssms-to-connect-to-the-managed-instance"></a>Подключение к Управляемому экземпляру с использованием SSMS

1. На виртуальной машине откройте SQL Server Management Studio (SSMS).
 
   Так как SSMS запускается впервые, открытие может занять несколько минут ввиду выполнения конфигурации.
2. В диалоговом окне **Connect to Server** (Подключение к серверу) введите полное **имя узла** для Управляемого экземпляра в поле **Имя сервера**, выберите **Проверка подлинности SQL Server** для типа аутентификации, введите имя пользователя и пароль, а затем нажмите кнопку **Подключиться**.

    ![подключение SSMS](./media/sql-database-managed-instance-configure-vm/ssms-connect.png)  

После подключения можно просмотреть системные и пользовательские базы данных на узле "Базы данных" и различные объекты на узлах "Безопасность", "Объекты сервера", "Репликация", "Управление", "Агент SQL Server" и "Профилировщик XEvent".

## <a name="next-steps"></a>Дополнительная информация

- Краткое руководство по подключению с локального клиентского компьютера с помощью подключения "точка — сеть" см. в [этой статье](sql-database-managed-instance-configure-p2s.md).
- Обзор вариантов подключения для приложений см. в статье [Подключение приложения к Управляемому экземпляру Базы данных SQL](sql-database-managed-instance-connect-app.md).
- Чтобы восстановить имеющуюся базу данных SQL Server из локальной среды в Управляемый экземпляр, можно использовать [Azure Database Migration Service для миграции](../dms/tutorial-sql-server-to-managed-instance.md) или [команду T-SQL RESTORE](sql-database-managed-instance-get-started-restore.md) для восстановления из файла резервной копии базы данных.
