<properties 
   pageTitle="Помощник по индексу для базы данных SQL Azure" 
   description="Рассматриваются рекомендации по простому созданию индексов, которые могут улучшить производительность рабочих нагрузок базы данных SQL Azure." 
   services="sql-database" 
   documentationCenter="" 
   authors="stevestein" 
   manager="jeffreyg" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management" 
   ms.date="06/30/2015"
   ms.author="sstein"/>

# Помощник по индексу базы данных SQL

Помощник по индексу базы данных SQL Azure рекомендует новые индексы для существующих баз данных SQL, которые могут улучшить эффективность текущих запросов.

Служба базы данных SQL оценивает производительность индекса путем анализа использования ресурсов журнала для базы данных SQL и рекомендует индексы, которые лучше всего подходят для выполнения обычной рабочей нагрузки базы данных.

Помощник по индексу упрощает управление индексами, предоставляя рекомендации в отношении того, какие индексы лучше использовать. Для серверов V12 помощник по индексу также может создавать и проверять индексы несколькими щелчками мыши на [портале Azure](https://portal.azure.com/). После создания индекса служба базы данных SQL анализирует производительность рабочей нагрузки базы данных и предоставляет подробные сведения об эффективности нового индекса. Если при анализе определяется, что рекомендованный индекс отрицательно сказывается на производительности, происходит автоматический возврат к прежнему индексу.

Помощник по индексу позволяет тратить меньше времени на настройку производительности базы данных.


> [AZURE.NOTE]В настоящее время помощник по индексу работает в предварительной версии и доступен только на [портале Azure](https://portal.azure.com/).


## Рекомендации по предварительной версии

Помощник по индексу в настоящее время доступен в предварительной версии и имеет следующие ограничения.

- Рекомендации по индексу можно автоматически создать и проверить только для серверов версии V12 (скрипты для создания рекомендаций и индекса предоставляются для серверов V12).
- Рекомендации и управление доступны только для некластеризованных индексов.

## Предварительные требования

Чтобы просмотреть и создать рекомендации по индексам, необходимо изменить разрешения [контроля доступа на основе ролей](role-based-access-control-configure.md) в Azure.

- Для просмотра рекомендаций требуются разрешения на **чтение** и **участника базы данных SQL**.
- Разрешения **владельца** и **участника базы данных SQL** необходимы для выполнения действий: создание, удаление индекса и отмена создания индекса.


## Использование помощника по индексу

Помощник по индексу прост в использовании. Чтобы упростить управление индексом для базы данных, следуйте приведенным далее инструкциям.

- Сначала просмотрите список рекомендаций по индексу и решите, какие индексы необходимо создать, а какие — оставить как есть. Список рекомендаций отсортирован и помечен по возможному влиянию на производительность (см. ниже). 
- Создайте рекомендованные индексы или пропустите их. Чтобы создать индекс автоматически, на портале щелкните **Создать индекс**; чтобы создать индекс вручную, выполните скрипт создания индекса.
- Для индексов, создаваемых вручную, необходимо следить за процессом создания и влиянием на производительность. Для автоматически создаваемых индексов мониторинг и влияние на производительность выполняются автоматически службой базы данных SQL Azure. 



## Просмотр рекомендованных индексов

Помощник по индексу предоставляет список рекомендаций по индексу в колонке базы данных на [портале Azure](https://portal.azure.com/). Наилучшие рекомендации показаны для каждой таблицы из выбранной базы данных, где создание нового индекса может обеспечить рост производительности.

### Чтобы просмотреть рекомендации по индексам, доступные на данный момент, выполните следующие действия.

1. Войдите на [портал Azure](https://portal.azure.com/).
2. В меню слева нажмите **ОБЗОР**.
3. В появившейся колонке **Обзор** выберите пункт **Базы данных SQL**.
4. В колонке **Базы данных SQL** щелкните нужную базу данных.
5. Щелкните **Помощник по индексу**, чтобы просмотреть доступные **рекомендации по индексам** для выбранной базы данных.

> [AZURE.NOTE]Чтобы получить рекомендации по индексам, база данных должна использоваться примерно одну неделю и в течение этой недели должна быть активность. Кроме того, активность должна быть однообразной. Помощник по индексу лучше оптимизирует индекс на основе совпадающих запросов, чем на основе случайных всплесков активности.

![Рекомендованные индексы][3]

Рекомендации сортируются по их возможному влиянию на производительность и делятся на 4 категории:

| Влияние | Описание |
| :--- | :--- |
| Высокий | Рекомендации с высоким уровнем влияния должны обеспечить наиболее значимое изменение производительности. |
| Существенный | Рекомендации с существенным уровнем влияния смогут заметным образом улучшить производительность. |
| Средний | Рекомендации со средним уровнем влияния должны улучшить производительность, но не существенным образом. |
| Низкий | Рекомендации с низким уровнем влияния должны улучшить производительность, но улучшения не будут значительными. 
Используйте метку влияния, чтобы определить наиболее подходящие рекомендации для создания новых индексов.

### Управление списком рекомендованных индексов

Если список рекомендованных индексов содержит индексы, которые не окажут положительного влияния, помощник по индексу позволяет отклонить рекомендации (пропущенные индексы можно позднее снова добавить в список **рекомендованных индексов**).

#### Отклонение рекомендации по индексу

1. Выберите индекс в списке **рекомендованных индексов**.
1. Щелкните **Отклонить индекс** в колонке **Сведения об индексе**.

#### Просмотр отклоненных индексов и возврат в основной список

1. В колонке **Рекомендации по индексам** щелкните **Просмотр отклоненных рекомендаций по индексам**.
1. Выберите отклоненный индекс из списка, чтобы просмотреть сведения о нем.
1. При необходимости щелкните **Отменить отклонение**, чтобы вернуть индекс обратно в основной список **рекомендаций по индексам**.



## Создание новых индексов

Помощник по индексу обеспечивает полный доступ к созданию индексов. Каждая рекомендация содержит скрипт T-SQL для создания индекса, при этом вы можете просмотреть точные сведения о том, как индекс будет создан, прежде чем предпринимать какие-либо действия в базе данных.

Рекомендации по индексам доступны для всех серверов баз данных SQL Azure, но автоматическое создание индексов доступно только для серверов V12. Серверы, отличные от V12, могут использовать преимущества помощника по индексу, но создавать индексы нужно вручную в соответствии с приведенными далее инструкциями.

Как для автоматического, так и для ручного создания индекса выберите рекомендованный индекс в колонке **Рекомендации по индексам** и выполните следующие действия.

### Автоматическое создание индекса (только для серверов V12)

Если база данных находится на сервере V12, чтобы создать рекомендованный индекс, выберите индекс на портале и нажмите **Создать индекс**.

База данных остается доступной во время создания индекса. При использовании помощника по индексу при создании индекса база данных не переводится в автономный режим.

Кроме того, индексы, созданные с помощью кнопки **Создать индекс**, не нужно отслеживать в дальнейшем. Если индекс оказывает отрицательное влияние на производительность, происходит автоматический возврат индекса. После создания индекса показатели влияния нового индекса доступны на портале.


### Ручное создание индекса (любой сервер)

Выберите рекомендованный индекс на портале и нажмите кнопку **Просмотр скрипта**. Выполните скрипт для базы данных, чтобы создать рекомендованный индекс. Для индексов, созданных вручную, не выполняется мониторинг и проверка фактического влияния на производительность, поэтому рекомендуется после создания убедиться, что созданный индекс действительно улучшил показатели производительности, и при необходимости изменить или удалить индекс. Дополнительные сведения о создании индексов см. в разделе [CREATE INDEX (Transact-SQL)](https://msdn.microsoft.com/library/ms188783.aspx).


### Отмена создания индекса

Индексы в состоянии **Ожидание** можно отменить. Индексы, которые создаются (состояние **Выполнение**) в настоящий момент, не могут быть отменены.

1. Выберите индекс в состоянии **Ожидание** в области **Действия с индексами**, чтобы открыть колонку **Сведения об индексе**.
1. Щелкните **Отмена**, чтобы прервать процесс создания индекса.

## Мониторинг операций с индексами после создания

Создание индекса не происходит мгновенно. Портал предоставляет сведения о состоянии операций с индексами. Ниже перечислены состояния, которые проходит индекс.

| Состояние | Описание |
| :--- | :--- |
| Ожидает | Команда на создание индекса получена, и создание индекса запланировано. |
| Executing | Команда на создание индекса выполняется, и индекс создается в настоящий момент. |
| Успешно | Индекс успешно создан. |
| Сбой | Индекс не был создан. Это может быть временной проблемой, либо это может быть результатом изменения схемы, в результате чего скрипт больше не работает. |
| Возврат | Создание индекса отменено, либо индекс не дал существенного улучшения и был отменен. |



![Рекомендованные индексы][4]



## Удаление индекса
Индексы, созданные с использованием помощника по индексу, можно удалить.


1. Выберите успешно созданный индекс в списке **Операции с индексами**.
1. Щелкните **Удалить индекс** в колонке **Сведения об индексе** или **Просмотр скрипта** для скрипта DROP INDEX.



## Сводка

Рекомендации по индексам обеспечивают автоматизацию управления созданием индекса и анализа для каждой базы данных SQL после выбора наиболее подходящих индексов. Щелкните плитку **Помощник по индексу** в колонке базы данных, чтобы просмотреть рекомендации по индексу.



## Дальнейшие действия

Отслеживайте рекомендации по индексам и продолжайте применять их для улучшения производительности. Рабочие нагрузки базы данных являются динамическими и меняются непрерывно. Помощник по индексу продолжит отслеживать работу и будет рекомендовать индексы, которые могут улучшить производительность базы данных.


<!--Image references-->
[1]: ./media/sql-database-index-advisor/index-recommendations.png
[2]: ./media/sql-database-index-advisor/index-details.png
[3]: ./media/sql-database-index-advisor/recommended-indexes.png
[4]: ./media/sql-database-index-advisor/index-operations.png

<!---HONumber=July15_HO4-->