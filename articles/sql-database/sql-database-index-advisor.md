<properties 
   pageTitle="Помощник по индексу для базы данных SQL Azure" 
   description="Помощник по индексу базы данных SQL Azure рекомендует новые индексы для существующих баз данных SQL, которые могут улучшить эффективность текущих запросов." 
   services="sql-database" 
   documentationCenter="" 
   authors="stevestein" 
   manager="jeffreyg" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management" 
   ms.date="01/23/2016"
   ms.author="sstein"/>

# Помощник по индексу базы данных SQL

Помощник по индексу базы данных SQL Azure рекомендует новые индексы для существующих баз данных SQL, которые могут улучшить эффективность текущих запросов. Служба базы данных SQL оценивает производительность индекса, анализируя журнал использования базы данных SQL. Рекомендуется использовать индексы, которые максимально соответствуют типовой нагрузке на вашу базу данных.

Помощник по индексу помогает в настройке производительности базы данных следующим образом:

- рекомендует, какие индексы следует создать (рекомендации доступны только для некластеризованных индексов);
- рекомендует, какие индексы следует удалить (функция удаления рекомендаций по индексу доступна только в предварительной версии и в настоящее время применяется только к дубликатам индексов);
- позволяет подтвердить автоматическое применение рекомендаций по индексу без вмешательства пользователя (для автоматического применения рекомендаций должно быть включено и запущено [хранилище запросов](https://msdn.microsoft.com/library/dn817826.aspx));
- автоматически выполняет откат рекомендаций, ухудшивших производительность. 


В этой статье описывается помощник по индексу для серверов версии 12. Рекомендации по индексам доступны для серверов версии 11, но для их реализации требуется выполнение сценария Transact-SQL (T-SQL). Помощник не отменяет операции с индексами на серверах версии 11, поэтому необходимо отслеживать влияние на производительность и отменять операции по мере необходимости.


### Разрешения

Чтобы просмотреть и создать рекомендации по индексам, необходимо изменить разрешения [контроля доступа на основе ролей](../active-directory/role-based-access-control-configure.md) в Azure.

- Для просмотра рекомендаций требуются разрешения на **чтение** и **участника базы данных SQL**.
- Разрешения **владельца** и **участника базы данных SQL** необходимы для выполнения действий: создание, удаление индекса и отмена создания индекса.


## Просмотр рекомендаций по индексам

На странице рекомендаций по индексам приводится список основных предлагаемых индексов с учетом их потенциального влияния на повышение производительности. Здесь же можно увидеть состояние последних операций с индексами. Выберите рекомендацию или состояние, чтобы увидеть подробные сведения.

Просмотр рекомендаций по индексам:

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Щелкните **ОБЗОР** > **Базы данных SQL** и выберите свою базу данных.
5. Щелкните **Все параметры** > **Помощник по индексу**, чтобы просмотреть доступные **рекомендации по индексам** для выбранной базы данных.

> [AZURE.NOTE] Чтобы получить рекомендации по индексам, база данных должна использоваться примерно одну неделю и в течение этой недели должна быть активность. Кроме того, активность должна быть однообразной. Помощник по индексу лучше оптимизирует индекс на основе совпадающих запросов, чем на основе случайных всплесков активности. Если доступных рекомендаций нет, на странице **рекомендаций по индексам** будет указана причина.

![Рекомендованные индексы](./media/sql-database-index-advisor/recommendations.png)

Рекомендации сортируются по их возможному влиянию на производительность и делятся на 4 категории:

| Влияние | Описание |
| :--- | :--- |
| Высокий | Рекомендации с высоким уровнем влияния должны обеспечить наиболее значимое изменение производительности. |
| Существенный | Рекомендации с существенным уровнем влияния смогут заметным образом улучшить производительность. |
| Средний | Рекомендации со средним уровнем влияния должны улучшить производительность, но не существенным образом. |
| Низкий | Рекомендации с низким уровнем влияния должны улучшить производительность, но улучшения не будут значительными. 
Используйте метку влияния, чтобы определить наиболее подходящие рекомендации для создания новых индексов.


### Удаление рекомендации по индексам из списка

Если вы хотите удалить какие-либо индексы из списка рекомендуемых индексов, отклоните соответствующую рекомендацию, выполнив описанные ниже действия.

1. Выберите рекомендацию в списке **рекомендованных индексов**.
2. Щелкните **Отклонить индекс** в колонке **Сведения об индексе**.


При необходимости отклоненные индексы можно добавить в список **рекомендованных индексов** снова:

1. В колонке **Рекомендации по индексам** щелкните **Просмотр отклоненных рекомендаций по индексам**.
1. Выберите отклоненный индекс из списка, чтобы просмотреть сведения о нем.
1. При необходимости щелкните **Отменить отклонение**, чтобы вернуть индекс обратно в основной список **рекомендаций по индексам**.



## Применение рекомендаций по индексам

Помощник по индексу позволяет полностью контролировать активность рекомендаций по индексам, используя следующие 3 варианта:

- применять отдельные рекомендаций по одной;
- настроить помощник по индексу на автоматическое применение рекомендаций по индексам;
- запустить рекомендованный сценарий T-SQL для выполнения рекомендации в базе данных вручную.

Выберите рекомендацию, чтобы просмотреть ее данные, и нажмите кнопку **Просмотреть сценарий**, чтобы узнать, как будет создана рекомендация.

Пока помощник по индексу применяет рекомендацию, база данных остается доступной — его работа никак не препятствует доступу к базе данных.

### Применение отдельной рекомендации

Рекомендации можно просматривать и применять по одной.

1. В колонке **Рекомендации по индексам** щелкните рекомендацию.
2. В колонке **Сведения об индексе** щелкните **Применить**.

    ![Применить рекомендацию](./media/sql-database-index-advisor/apply.png)


### Включение автоматического управления индексами

Помощник по индексу можно настроить на автоматическое выполнение рекомендаций. В этом случае появляющиеся рекомендации будут применяться автоматически. Как и во всех остальных операциях с индексами, управляемых службой, если выполнение рекомендации ведет к ухудшению производительности, она отменяется.

1. В колонке **Рекомендации по индексам** щелкните **Все параметры**:

    ![Настройки помощника](./media/sql-database-index-advisor/settings.png)

2. Настройте помощник на автоматическое **создание** или **удаление** индекса:

    ![Рекомендованные индексы](./media/sql-database-index-advisor/automation.png)




### Выполнение рекомендованного сценария T-SQL вручную

Выберите рекомендацию и щелкните **Просмотреть сценарий**. Выполните этот сценарий для базы данных, чтобы применить рекомендацию вручную.

*Для индексов, созданных вручную, не выполняется мониторинг и проверка влияния на производительность службы*, поэтому после создания индекса убедитесь в том, что он действительно повысил производительность, и при необходимости измените или удалите индекс. Дополнительные сведения о создании индексов см. в разделе [CREATE INDEX (Transact-SQL)](https://msdn.microsoft.com/library/ms188783.aspx).


### Отмена создания индекса

Индексы в состоянии **Ожидание** можно отменить. Индексы, которые создаются (состояние **Выполнение**) в настоящий момент, не могут быть отменены.

1. Выберите индекс в состоянии **Ожидание** в области **Действия с индексами**, чтобы открыть колонку **Сведения об индексе**.
2. Нажмите кнопку **Отмена**, чтобы прервать процесс создания индекса.



## Мониторинг операций с индексами

Применение рекомендаций может происходить не мгновенно. Портал предоставляет сведения о состоянии операций с индексами. Ниже перечислены состояния, которые проходит индекс.

| Состояние | Описание |
| :--- | :--- |
| Ожидает | Команда на создание индекса получена, и создание индекса запланировано. |
| Executing | Команда на создание индекса выполняется, и индекс создается в настоящий момент. |
| Успешно | Индекс успешно создан. |
| Сбой | Индекс не был создан. Это может быть временной проблемой, либо это может быть результатом изменения схемы, в результате чего скрипт больше не работает. |
| Возврат | Создание индекса отменено, либо индекс не дал существенного улучшения и был отменен. |

Щелкните внутрипроцессную рекомендацию в списке, чтобы увидеть ее данные:

![Рекомендованные индексы](./media/sql-database-index-advisor/operations.png)



### Возврат индекса

Если для создания индексов используется помощник (т. е. вы не запускали сценарий T-SQL вручную), он автоматически отменит индекс, ухудшивший производительность. Если по какой-то причине действие помощника по индексу необходимо отменить, выполните указанные ниже действия.


1. Выберите успешно созданный индекс в списке **Операции с индексами**.
2. Щелкните **Отменить** в колонке **Сведения об индексе** или **Просмотреть сценарий** для выполненного сценария DROP INDEX.

![Рекомендованные индексы](./media/sql-database-index-advisor/details.png)


## Мониторинг влияния рекомендаций по индексам на производительность

Выполнив рекомендации, щелкните **Подробные сведения о запросе** в колонке сведений об индексе, чтобы открыть [подробные сведения о производительности запросов](sql-database-query-performance.md) и узнать, как влияют на производительность ваши основные запросы.

![Мониторинг влияния на производительность](./media/sql-database-index-advisor/query-insights.png)


## Сводка

Помощник по индексу дает рекомендации по индексам и позволяет автоматизировать управление индексами для базы данных SQL. Предоставляя сценарии T-SQL, а также параметры индивидуального или полностью автоматизированного управления индексами, помощник по индексу помогает оптимизировать индексы базы данных и, таким образом, повысить производительность запросов.



## Дальнейшие действия

Отслеживайте рекомендации по индексам и продолжайте применять их для улучшения производительности. Рабочие нагрузки базы данных являются динамическими и меняются непрерывно. Помощник по индексу продолжит отслеживать работу и будет рекомендовать индексы, которые могут улучшить производительность базы данных.

<!---HONumber=AcomDC_0224_2016-->