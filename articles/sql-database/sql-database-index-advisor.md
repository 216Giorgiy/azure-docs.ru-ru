<properties 
   pageTitle="Помощник по работе с базами данных SQL Azure" 
   description="Помощник по работе с базами данных SQL Azure предоставляет рекомендации для существующих баз данных SQL, которые могут повысить производительность текущих запросов." 
   services="sql-database" 
   documentationCenter="" 
   authors="stevestein" 
   manager="jhubbard" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management" 
   ms.date="04/28/2016"
   ms.author="sstein"/>

# Помощник по работе с базами данных SQL

Помощник по построению индексов Базы данных SQL Azure был обновлен и теперь не только предоставляет рекомендации по созданию и удалению индексов, но и рекомендации по параметризации запросов и устранению ошибок схемы. После включения этих дополнительных рекомендаций помощник по построению индексов стал называться **Помощником по работе с базами данных SQL**.

Помощник по работе с базами данных SQL оценивает производительность, анализируя журнал использования базы данных SQL. После этого он предоставляет рекомендации, наиболее подходящие для типовых нагрузок в вашей базе данных.

Для серверов версии 12 (для серверов версии 11 рекомендации недоступны) доступны следующие рекомендации. В настоящее время можно настроить автоматическое применение рекомендаций по созданию и удалению индексов. Подробности см. ниже в разделе [Автоматическое управление индексами](#enable-automatic-index-management).

## Рекомендации по созданию индексов 

Рекомендации по **созданию индексов** появляются, когда служба базы данных SQL обнаруживает отсутствующий индекс, создание которого приведет к повышению производительности рабочих нагрузок в ваших базах данных (только некластеризованные индексы).


## Рекомендации по удалению индексов

Рекомендации по **удалению индексов** появляются, когда служба базы данных SQL обнаруживает повторяющиеся индексы (в настоящее время доступны только в предварительной версии и применяются только для повторяющихся индексов).

## Рекомендации по параметризации запросов

Рекомендации по **параметризации запросов** появляются, когда служба базы данных SQL обнаруживает наличие одного или нескольких запросов, которые постоянно перекомпилируются, но в результате для них создается одинаковый план выполнения запроса. Это дает возможность применить принудительную параметризацию, которая позволит кэшировать планы запросов и повторно использовать их в будущем, повышая производительность и снижая использование ресурсов.

## Рекомендации по устранению ошибок схемы

Рекомендации по **устранению ошибок схемы** появляются, когда служба базы данных SQL обнаруживает аномальное количество относящихся к схеме ошибок SQL, которые возникают в вашей базе данных SQL Azure. Эта рекомендация обычно появляется, когда в базе данных возникает несколько связанных со схемой ошибок (недопустимое имя столбца, недопустимое имя объекта и т. д.) в течение часа.


## Просмотр рекомендаций

На странице рекомендаций приводится список основных предлагаемых рекомендаций с учетом их потенциального влияния на повышение производительности. Здесь же можно увидеть состояние последних операций. Выберите рекомендацию или состояние, чтобы увидеть подробные сведения.

Чтобы просмотреть и применить рекомендации, необходимо изменить разрешения [контроля доступа на основе ролей](../active-directory/role-based-access-control-configure.md) в Azure. Разрешения **Читатель** и **Участник SQL DB** необходимы для просмотра рекомендаций, а разрешения **Владелец**, **Участник SQL DB** необходимы для выполнения действий: создание, удаление индекса и отмена создания индекса.

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Выберите **ОБЗОР** > **Базы данных SQL** и выберите свою базу данных.
5. Выберите **Все параметры** > **Рекомендации**, чтобы просмотреть доступные **Рекомендации** для выбранной базы данных.

> [AZURE.NOTE] Чтобы рекомендации сформировались, база данных должна использоваться примерно одну неделю и в течение этой недели должна быть активность. Кроме того, активность должна быть однообразной. Помощник по работе с базами данных SQL обеспечивает более эффективную оптимизацию при стабильном потоке запросов, чем на основе случайных всплесков активности. Если доступных рекомендаций нет, на странице **Рекомендации** будет указана причина.

![Рекомендации](./media/sql-database-index-advisor/recommendations.png)

Рекомендации сортируются по их возможному влиянию на производительность и делятся на 4 категории:

| Влияние | Описание |
| :--- | :--- |
| Высокий | Рекомендации с высоким уровнем влияния должны обеспечить наиболее значимое изменение производительности. |
| Средний | Рекомендации со средним уровнем влияния должны улучшить производительность, но не существенным образом. |
| Низкий | Рекомендации с низким уровнем влияния должны улучшить производительность, но улучшения не будут значительными. 


### Удаление рекомендаций из списка

Если какие-либо рекомендации в списке нужно удалить, отклоните соответствующую рекомендацию, выполнив описанные ниже действия.

1. Выберите рекомендацию в списке **Рекомендации**.
2. Щелкните **Отменить** в колонке **Сведения**.


При необходимости отклоненные рекомендации можно вернуть в список **Рекомендации**, выполнив следующие действия.

1. В колонке **Рекомендации** щелкните **Просмотр отклоненных**.
1. Выберите отклоненный элемент из списка, чтобы просмотреть сведения о нем.
1. При необходимости щелкните **Отменить отклонение**, чтобы вернуть индекс обратно в основной список **Рекомендаций**.



## Применение рекомендаций

Помощник по работе с базами данных SQL предоставляет полный контроль над применением рекомендаций с помощью следующих 3 параметров:

- применять отдельные рекомендаций по одной;
- разрешить помощнику автоматически применять рекомендации (в настоящее время применяется только к рекомендациям по индексам);
- запустить рекомендованный сценарий T-SQL для выполнения рекомендации в базе данных вручную.

Выберите рекомендацию, чтобы просмотреть ее данные, и нажмите кнопку **Просмотреть сценарий**, чтобы узнать, как будет создана рекомендация.

Пока помощник применяет рекомендацию, база данных остается доступной — при работе помощника по работе с базами данных SQL база данных никогда не оказывается вне сети.

### Применение отдельной рекомендации

Рекомендации можно просматривать и применять по одной.

1. В колонке **Рекомендации** щелкните рекомендацию.
2. В колонке **Сведения** щелкните **Применить**.

    ![Применить рекомендацию](./media/sql-database-index-advisor/apply.png)


### Включение автоматического управления индексами

Помощник по работе с базами данных SQL можно настроить на автоматическое выполнение рекомендаций. В этом случае появляющиеся рекомендации будут применяться автоматически. Как и во всех остальных операциях с индексами, управляемых службой, если выполнение рекомендации ведет к ухудшению производительности, она отменяется.

1. В колонке **Рекомендации** щелкните **Автоматически**.

    ![Настройки помощника](./media/sql-database-index-advisor/settings.png)

2. Настройте помощник на автоматическое **создание** или **удаление** индекса:

    ![Рекомендованные индексы](./media/sql-database-index-advisor/automation.png)




### Выполнение рекомендованного сценария T-SQL вручную

Выберите рекомендацию и щелкните **Просмотреть сценарий**. Выполните этот сценарий для базы данных, чтобы применить рекомендацию вручную.

*Для индексов, созданных вручную, не выполняется мониторинг и проверка влияния на производительность службы*, поэтому после создания индекса убедитесь в том, что он действительно повысил производительность, и при необходимости измените или удалите индекс. Дополнительные сведения о создании индексов см. в разделе [CREATE INDEX (Transact-SQL)](https://msdn.microsoft.com/library/ms188783.aspx).


### Отмена рекомендаций

Рекомендации с состоянием **Ожидает**, **Проверка** или **Успешно** можно отменить. Рекомендация с состоянием **Выполняется** не может быть отменена.

1. Выберите рекомендацию в области **Журнал настройки**, чтобы открыть колонку **сведений о рекомендации**.
2. Щелкните **Отменить**, чтобы прервать процесс применения рекомендации.



## Мониторинг операций

Применение рекомендаций может происходить не мгновенно. Портал предоставляет сведения о состоянии операций с рекомендациями. Ниже перечислены состояния, в которых может находиться индекс.

| Состояние | Описание |
| :--- | :--- |
| Ожидает | Команда на применение рекомендации получена и запланирована для выполнения. |
| Executing | Идет применение рекомендации. |
| Успешно | Рекомендация была успешно применена. |
| Ошибка | В процессе применения рекомендации возникла ошибка. Это может быть временной проблемой, либо это может быть результатом изменения схемы, в результате чего скрипт больше не работает. |
| Возврат | Рекомендация была применена, но не дала существенного улучшения и была автоматически отменена. |
| Отмена | Рекомендация была отменена. |

Щелкните внутрипроцессную рекомендацию в списке, чтобы увидеть ее данные:

![Рекомендованные индексы](./media/sql-database-index-advisor/operations.png)



### Отмена рекомендации

Если для применения рекомендации использовался помощник (то есть вы не запускали сценарий T-SQL вручную), он автоматически отменит рекомендацию, ухудшившую производительность. Если по какой-то причине рекомендацию необходимо отменить, выполните указанные ниже действия.


1. Выберите успешно примененную рекомендацию в области **Журнал настройки**.
2. Щелкните **Отменить** в колонке **Сведения о рекомендации**.

![Рекомендованные индексы](./media/sql-database-index-advisor/details.png)


## Мониторинг влияния рекомендаций по индексам на производительность

После успешного применения рекомендаций (в настоящее время доступны только рекомендации по операциям с индексами и параметризации запросов) щелкните **Подробные сведения о запросе** в колонке сведений о рекомендации, чтобы открыть [подробные сведения о производительности запросов](sql-database-query-performance.md) и просмотреть влияние на производительность ваших основных запросов.

![Мониторинг влияния на производительность](./media/sql-database-index-advisor/query-insights.png)



## Сводка

Помощник по работе с базами данных SQL предоставляет рекомендации по повышению производительности базы данных SQL. Предоставляя сценарии T-SQL, а также параметры индивидуального или полностью автоматизированного управления (в настоящее время только для индексов), помощник помогает оптимизировать базу данных и, таким образом, повысить производительность запросов.



## Дальнейшие действия

Отслеживайте рекомендации и продолжайте применять их для повышения производительности. Рабочие нагрузки базы данных являются динамическими и меняются непрерывно. Помощник по работе с базами данных SQL продолжит отслеживать работу и давать рекомендации, которые могут повысить производительность базы данных.

<!---HONumber=AcomDC_0504_2016-->