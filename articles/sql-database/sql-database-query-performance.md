<properties 
   pageTitle="Анализ производительности запросов базы данных Azure SQL" 
   description="Мониторинг производительности запросов определяет запросы, потребляющие наибольшее количество DTU в базе данных SQL Azure." 
   services="sql-database" 
   documentationCenter="" 
   authors="stevestein" 
   manager="jeffreyg" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management" 
   ms.date="09/30/2015"
   ms.author="sstein"/>

# Анализ производительности запросов базы данных Azure SQL


Управление производительностью реляционных баз данных и ее настройка являются сложной задачей, требующей значительного опыта и времени. Анализ производительности запросов позволяет тратить меньше времени на устранение неполадок с производительностью базы данных, предоставляя следующие возможности:

- Более глубокое понимание потребления ресурсов базы данных (DTU). 
- Определение запросов, потребляющих наибольшее количество единиц DTU. Этот показатель можно настроить и улучшить производительность. 
- Возможность получить подробные сведения о запросе.

> [AZURE.NOTE]Сейчас существует только предварительная версия функции анализа производительности запросов, доступная только на [портале Azure](https://portal.azure.com/).



## Предварительные требования

- Анализ производительности запросов доступен только с базой данных SQL Azure версии 12.
- Для анализа производительности запросов необходимо запустить [хранилище запросов](https://msdn.microsoft.com/library/dn817826.aspx), поэтому оно включается автоматически при подписке на анализ производительности запросов.
 
 
## Разрешения

Для использования анализа производительности запросов необходимо [управление доступом на основе ролей](role-based-access-control-configure.md) с такими разрешениями:

- разрешения **читатель**, **владелец**, **участник**, **участник базы данных SQL** или **участник сервера SQL Server** для просмотра основных ресурсов, потребляющих запросы и диаграммы; 
- разрешения **владелец**, **участник**, **участник базы данных SQL** или **участник сервера SQL Server** для просмотра текста запросов.



## Использование анализа производительности запросов

Анализ производительности запросов легко использовать:

- Просмотрите список самых ресурсоемких запросов. 
- Выберите отдельный запрос, чтобы просмотреть сведения о нем.
- **Измените диаграмму** для настройки отображения данных о потреблении DTU или для отображения других периодов времени.



> [AZURE.NOTE]Хранилище запросов должно сохранить несколько часов данных, чтобы база данных SQL могла предоставить анализ производительности запросов. Если в базе данных нет активности или хранилище запросов было неактивно в течение определенного времени, диаграммы не будут содержать данные этого периода. Можно включить хранилище запросов в любой момент, если оно не запущено.





## Просмотр запросов, использующих наибольшее количество DTU

На [портале](https://portal.azure.com) выполните следующие действия.

1. Перейдите к базе данных SQL и выберите элемент **Анализ производительности запросов**. 

    ![Анализ производительности запросов][1]

    Откроется представление популярных запросов и список запросов, использующих наибольшее количество DTU.

1. Щелкните диаграмму, чтобы просмотреть подробные сведения.<br>Верхняя строка показывает общий процент DTU для базы данных, а полосы показывают процент DTU, использованных выбранными запросами. Выделите отдельные запросы или отмените их выделение, чтобы включить их в диаграмму или исключить из нее.

    ![наиболее ресурсоемкие запросы][2]

1. Либо щелкните команду **Изменить диаграмму**, чтобы настроить отображение данных о потреблении DTU или отобразить другие периоды времени.

## Просмотр подробных сведений для отдельного запроса

Чтобы просмотреть сведения о запросе, выполните следующие действия.

1. Щелкните любой запрос в списке популярных запросов.<br>Откроется представление сведений, в котором потребление DTU запросами разбито по времени. 
3. Щелкните диаграмму для получения сведений.<br>Верхняя строка показывает общий процент DTU, а полосы показывают процент DTU, который был использован выбранными запросами.
4. Изучите данные, чтобы увидеть подробные показатели, в том числе длительность, количество выполнений, процент использования ресурсов для каждого интервала, в течение которого выполнялся запрос.
    
    ![сведения о запросе][3]

1. Или щелкните элемент **Просмотр сценария**, чтобы просмотреть текст запроса, и выберите команду **Изменить диаграмму**, чтобы настроить отображение данных о потреблении DTU или отобразить другие периоды времени.




## Сводка

Анализ производительности запросов помогает понять влияние рабочей нагрузки запросов и его связь с потреблением ресурсов базы данных. Благодаря этой функции можно узнать о наиболее ресурсоемких запросах и легко определить запросы, которые нужно исправить, прежде чем они станут проблемными. Щелкните элемент **Анализ производительности запросов** в колонке базы данных, чтобы увидеть наиболее ресурсоемкие запросы.




## Дальнейшие действия

Рабочие нагрузки базы данных являются динамическими и меняются непрерывно. Отслеживайте запросы и продолжайте их настраивать для повышения производительности.

Дополнительные рекомендации для повышения производительности базы данных SQL см. в статье [Помощник по индексу](sql-database-index-advisor.md).

<!--Image references-->
[1]: ./media/sql-database-query-performance/tile.png
[2]: ./media/sql-database-query-performance/top-queries.png
[3]: ./media/sql-database-query-performance/query-details.png

<!---HONumber=AcomDC_1203_2015-->