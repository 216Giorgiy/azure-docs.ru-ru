<properties 
	pageTitle="Использование Базы данных SQL (.NET) | Microsoft Azure" 
	description="Приступая к работе с Базой данных SQL. Узнайте, как создать экземпляр Базы данных SQL и подключиться к нему с помощью поставщика ADO.NET, ODBC и EntityClient." 
	services="sql-database" 
	documentationCenter=".net" 
	authors="annemill" 
	manager="jhubbard" 
	editor=""/>

<tags 
	ms.service="sql-database" 
	ms.workload="data-management" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="04/14/2016" 
	ms.author="annemill"/>


# Как использовать базу данных SQL Azure в приложениях .NET

В этом руководстве показано, как создать логический сервер и экземпляр базы данных в Базе данных SQL Azure и подключиться к базе данных с использованием следующих технологий поставщика данных платформы .NET Framework: ADO.NET, ODBC и поставщика EntityClient.


## Что такое база данных SQL

База данных SQL представляет собой систему управления реляционной базой данных для Azure и основана на технологии сервера SQL. С экземпляром базы данных SQL можно легко подготовить и развернуть решения реляционных баз данных в облаке и воспользоваться преимуществами центра распределенных данных, которые представляют собой корпоративные преимущества доступности, масштабируемости и безопасности вместе со встроенной защитой данных и возможностями самостоятельной регенерации.



## Вход в Azure

База данных SQL предоставляет хранилище реляционных данных, доступ и управление службами на Azure. Для ее использования необходима подписка Azure.

1. Откройте браузер и перейдите по адресу [http://azure.microsoft.com](https://azure.microsoft.com/). Чтобы начать работу с бесплатной учетной записью, щелкните «Бесплатная пробная версия» в верхнем правом углу и следуйте дальнейшим указаниям.

2. Ваша учетная запись создана. Вы готовы начать работу.


## Создание и настройка базы данных SQL

Теперь создайте и настройте базу данных и сервер. На классическом портале Azure исправленные рабочие процессы позволяют сначала создать базу данных, а затем подготовить сервер к работе.

**Создание логического сервера и экземпляра базы данных**

1. Перейдите на [классический портал Azure](http://manage.windowsazure.com).

2. В нижней части страницы щелкните **СОЗДАТЬ**.

3. Щелкните элемент **Службы данных**.

4. Щелкните элемент **База данных SQL**.

5. Щелкните элемент **Настраиваемое создание**.

6. В поле «Имя» введите имя базы данных.

7. Выберите выпуск, максимальный размер и параметры сортировки. В рамках данного руководства можно использовать значения по умолчанию.

	Базы данных SQL представлены в трех вариантах: Базовый, Стандартный и Премиум.

	МАКСИМАЛЬНЫЙ РАЗМЕР задается при создании базы данных, и затем может быть изменен с помощью элемента "ИЗМЕНИТЬ БАЗУ ДАННЫХ". МАКСИМАЛЬНЫЙ РАЗМЕР обеспечивает возможность ограничивать размер базы данных.

	Для любой базы данных, созданной на Azure, существует три реплики. Это необходимо для обеспечения высокой доступности. Отработка отказа является прозрачной и интегрирована в службу.

8. В разделе «Сервер» выберите **Создать сервер базы данных SQL**.

9. Нажмите кнопку со стрелкой, чтобы перейти к следующей странице.

10. В диалоговом окне «Параметры сервера» укажите имя входа для аутентификации SQL Server.

	База данных SQL использует проверку подлинности SQL с помощью шифрованного подключения. Будет создана новая учетная запись для проверки подлинности SQL Server, назначенная предопределенной роли сервера sysadmin и использующая введенное имя.

	Именем входа не может быть адрес электронной почты, учетная запись пользователя Windows или идентификатор Windows Live ID. Для базы данных SQL не поддерживается ни проверка подлинности на основе утверждений, ни проверка подлинности Windows.

11. Укажите надежный пароль, который содержит более восьми знаков, в том числе символы в верхнем и нижнем регистре, а также цифры и символы.

12. Выберите регион. Регион определяет географическое расположение сервера. Изменение региона достаточно трудоемко, поэтому выберите регион, имеющий смысл для этого сервера. Выберите местоположение, максимально близкое к вам. Хранение приложения и базы данных Azure в том же регионе снижает расходы на пропускную способность и задержку данных.

13. Убедитесь, что выбран параметр **Разрешить службам Azure доступ к серверу**, чтобы к этой базе данных можно было подключиться из классического портала Azure для баз данных SQL, служб хранилища и других служб Azure.

14. Закончив, щелкните флажок внизу страницы.

Обратите внимание, что имя сервера не было задано. База данных SQL автоматически создает имя сервера, гарантируя отсутствие повторяющихся записей DNS. Имя сервера является буквенно-цифровой строкой, состоящей из 10 знаков. Невозможно изменить имя сервера баз данных SQL.

После создания базы данных щелкните ее, чтобы открыть соответствующую панель мониторинга. Панель мониторинга содержит строки подключения, которые можно копировать и использовать в коде приложения. В ней также отображается URL-адрес управления, который необходимо указать при подключении к базе данных из среды Management Studio или другого средства администрирования.


![Панель мониторинга Базы данных SQL](./media/sql-database-dotnet-how-to-use/SQLDbDashboard.PNG)


На следующем шаге будет настроен брандмауэр, чтобы разрешить подключение для приложений, работающих в вашей сети.

**Настройка брандмауэра для логического сервера**

1. Выберите **Базы данных SQL**, щелкните элемент **Серверы** в верхней части страницы, а затем — только что созданный сервер.

	![Настройка брандмауэра](./media/sql-database-dotnet-how-to-use/SQLDBFirewall.PNG)

2. Нажмите **Настроить**.

3. Скопируйте текущий IP-адрес клиента. В случае подключения из сети это IP-адрес, прослушиваемый вашим маршрутизатором или прокси-сервером. База данных SQL определяет IP-адрес, используемый текущим подключением, чтобы можно создать правило брандмауэра для принятия запросов на подключение от этого устройства.

4. Вставьте IP-адрес в поля «НАЧАЛЬНЫЙ IP-АДРЕС» и «КОНЕЧНЫЙ IP-АДРЕС», чтобы задать диапазон адресов, которым разрешен доступ к серверу. Позже в случае ошибки подключения, сообщающей о слишком узком диапазоне, можно изменить это правило, расширяя диапазон.

	Если клиентские компьютеры используют динамически назначаемые IP-адреса, необходимо указать диапазон, достаточно широкий для включения IP-адресов, назначенных компьютерам в сети. Начните с узкого диапазона и расширяйте его только в случае необходимости.

5. Введите имя для правила брандмауэра, например имя своего компьютера или компании.

6. Щелкните значок галочки рядом с правилом, чтобы сохранить его.

	![Диапазон IP-адресов для настройки брандмауэра](./media/sql-database-dotnet-how-to-use/SQLDBIPRange.PNG)

7. Чтобы завершить шаг, нажмите кнопку **Сохранить** в нижней части страницы. Если кнопка **Сохранить** не видна, обновите страницу браузера.

Теперь у вас есть экземпляр базы данных, логический сервер, правило брандмауэра, разрешающее входящие подключения с вашего IP-адреса, и учетная запись администратора. Теперь все готово для программного подключения к базе данных SQL.


## Подключение к базе данных SQL

В этом разделе описано подключение к экземпляру базы данных SQL с помощью других поставщиков данных .NET Framework. Основные рекомендации по подключению к серверу Базы данных и базе данных SQL см. в статье:


- [Подключение к базе данных SQL: основные рекомендации](sql-database-connect-central-recommendations.md).


Если вы решили использовать Visual Studio и при этом текущая конфигурация не содержит внешнее веб-приложение Azure, на компьютере разработчика не потребуется устанавливать какие-либо дополнительные инструменты или пакеты SDK. Просто начните разработку вашего приложения.

В Visual Studio вы можете пользоваться теми же инструментами разработки для баз данных SQL, что и для сервера SQL. Обозреватель серверов позволяет просматривать (но не редактировать) базу данных. Разработчик Visual Studio Entity Data Model Designer имеет все необходимые функции, и его можно использовать для создания моделей для баз данных SQL в работе с платформой Entity Framework.

## Использование поставщика данных на платформе .NET для сервера SQL.

Пространство имен **System.Data.SqlClient** является поставщиком данных .NET Framework для SQL Server.

Стандартная строка подключения выглядит следующим образом:

    Server=tcp:.database.windows.net;
    Database=;
    User ID=@;
    Password=;
    Trusted_Connection=False;
    Encrypt=True;

Вы можете использовать класс **SQLConnectionStringBuilder** для создания строки подключения, как показано в следующем примере кода:

    SqlConnectionStringBuilder csBuilder;
    csBuilder = new SqlConnectionStringBuilder();
    csBuilder.DataSource = xxxxxxxxxx.database.windows.net;
    csBuilder.InitialCatalog = testDB;
    csBuilder.Encrypt = true;
    csBuilder.TrustServerCertificate = false;
    csBuilder.UserID = MyAdmin;
    csBuilder.Password = pass@word1;

Если элементы строки подключения известны заранее, они могут быть сохранены в файле конфигурации и извлечены в соответствующий момент для построения строк подключения. Вот пример строки подключения в файле конфигурации:

    <connectionStrings>
      <add name="ConnectionString" 
           connectionString ="Server=tcp:xxxxxxxxxx.database.windows.net;Database=testDB;User ID=MyAdmin@xxxxxxxxxx;Password=pass@word1;Trusted_Connection=False;Encrypt=True;" />
    </connectionStrings>

Чтобы получить строку подключения в файле конфигурации, используйте класс **ConfigurationManager**:

    SqlConnectionStringBuilder csBuilder;
    csBuilder = new SqlConnectionStringBuilder(ConfigurationManager.ConnectionStrings["ConnectionString"].ConnectionString);
    After you have built your connection string, you can use the SQLConnection class to connect the SQL Database server:
    SqlConnection conn = new SqlConnection(csBuilder.ToString());
    conn.Open();

## Использование поставщика данных на платформе .NET для ODBC

Пространство имен **System.Data.Odbc** является поставщиком данных .NET Framework для ODBC. Ниже приведен пример строки подключения ODBC:

    Driver={SQL Server Native Client 10.0};
    Server=tcp:.database.windows.net;
    Database=;
    Uid=@;
    Pwd=;
    Encrypt=yes;

Класс **OdbcConnection** позволяет устанавливать открытое подключение к источнику данных. Ниже приведен пример кода, где показано, как открыть соединение.

    string cs = "Driver={SQL Server Native Client 10.0};" +
                "Server=tcp:xxxxxxxxxx.database.windows.net;" +
                "Database=testDB;"+
                "Uid=MyAdmin@xxxxxxxxxx;" +
                "Pwd=pass@word1;"+
                "Encrypt=yes;";

    OdbcConnection conn = new OdbcConnection(cs);
    conn.Open();

Если вы хотите создать строку подключения во время выполнения, то можете использовать класс **OdbcConnectionStringBuilder**.

## Использование поставщика EntityClient

Пространство имен **System.Data.EntityClient** является поставщиком данных .NET Framework для Entity Framework.

Платформа Entity Framework позволяет разработчикам создавать приложения для доступа к данным на основе концептуальных моделей приложения, вместо прямого программирования на основе реляционной схемы хранения. Платформа Entity Framework создается поверх поставщика данных ADO.NET хранилища, обеспечивая объект **EntityConnection** для базового поставщика данных и реляционной базы данных.

Для создания объекта **EntityConnection** необходима ссылка на набор метаданных, содержащий необходимые модели и сопоставления, а также строка подключения и имя поставщика данных, связанного с определенным хранилищем. После добавления объекта **EntityConnection** доступ к сущностям может осуществляться через классы, сформированные из концептуальной модели.

Ниже приведен пример строки подключения:

    metadata=res://*/SchoolModel.csdl|res://*/SchoolModel.ssdl|res://*/SchoolModel.msl;provider=System.Data.SqlClient;provider connection string="Data Source=xxxxxxxxxx.database.windows.net;Initial Catalog=School;Persist Security Info=True;User ID=MyAdmin;Password=***********"

Дополнительную информацию см. в разделе [Поставщик EntityClient для платформы Entity Framework](http://msdn.microsoft.com/library/bb738561.aspx).

## Дальнейшие действия

Ознакомившись с основами подключения к базе данных SQL, просмотрите раздел [Разработка в базе данных SQL Azure: инструкции](http://msdn.microsoft.com/library/windowsazure/ee621787.aspx)
 

<!---HONumber=AcomDC_0420_2016-->