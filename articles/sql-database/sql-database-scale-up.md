<properties 
   pageTitle="Изменение уровней служб и уровней производительности базы данных" 
   description="Узнайте, как динамически увеличивать и уменьшать масштаб облачной базы данных с помощью уровней служб Базы данных SQL Azure, которые можно использовать для увеличения или снижения производительности с учетом потребностей бизнеса и затрат, избегая при этом простоев приложения." 
   services="sql-database" 
   documentationCenter="" 
   authors="stevestein" 
   manager="jeffreyg" 
   editor=""/>

<tags
   ms.service="sql-database"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services" 
   ms.date="04/02/2015"
   ms.author="sstein"/>


# Изменение уровней служб и уровней производительности базы данных 

В этом разделе описываются действия, которые выполняются при перемещении Базы данных SQL Azure на другой уровень служб или на другой уровень производительности.

## Изменение уровней служб 

Используйте сведения, представленные в статьях [Обновление баз данных SQL уровня Web или Business до новых уровней служб](sql-database-upgrade-new-service-tiers.md) и [Уровни служб и уровни производительности в Базе данных SQL Azure](https://msdn.microsoft.com/library/azure/dn741336.aspx), для определения уровня служб и уровня производительности, соответствующих Базе данных SQL Azure.

Вы можете с легкостью переходить между любыми уровнями служб с помощь портала управления Azure, [PowerShell](https://msdn.microsoft.com/library/azure/dn546726.aspx), или [API REST](https://msdn.microsoft.com/library/dn505719.aspx).

При переходе между уровнями обслуживания убедитесь, 
- что у вас есть доступная квота на сервере, прежде чем переходить на более высокий уровень служб или производительности. Если необходима дополнительная квота, обратитесь в службу поддержки. 
- федеративные базы данных не удастся обновить до уровня Basic, Standard или Premium.

- При снижении уровня базы данных ее размер не должен превышать максимально допустимый размер целевого уровня служб. Дополнительные сведения о разрешенных размерах для каждого уровня см. в таблице с уровнями обслуживания и размерами баз данных далее в этом разделе.

- При обновлении базы данных с включенной [стандартной](https://msdn.microsoft.com/library/azure/dn758204.aspx) или [активной](https://msdn.microsoft.com/library/azure/dn741339.aspx) георепликацией необходимо сначала обновить базы данные-получатели до требуемого уровня производительности перед обновлением базы данных-источника.

- При понижении от уровня обслуживания Premium необходимо сначала завершить все активные отношения георепликации. Чтобы остановить процесс репликации между базой данных-источником и действующими базами данных-получателями, выполните действия, описанные в разделе [Завершение связи непрерывной копии](https://msdn.microsoft.com/library/azure/dn741323.aspx).

- Предложения службы восстановления отличаются для разных уровней служб. При переходе на более низкий уровень можно потерять возможность восстановления на момент времени или получить меньший срок хранения резервных копий. Дополнительные сведения см. в статье [Резервное копирование и восстановление Базы данных SQL Azure](https://msdn.microsoft.com/library/azure/jj650016.aspx).

- В течение 24 часов можно выполнять не более четырех отдельных изменений базы данных (уровней служб или уровней производительности).

- Новые свойства базы данных не применяются до тех пор, пока изменение не завершится.

Обратите внимание, 
- что поддержка уровней служб Business и Web будет прекращена в сентябре 2015 года. Дополнительные сведения см. в статье [Вопросы и ответы по остановке Web Edition и Business Edition](https://msdn.microsoft.com/library/azure/dn741330.aspx).

<note included>
- Важно отметить, что текущая реализация федераций станет [устаревшей вместе с уровнями обслуживания Web и Business](https://msdn.microsoft.com/library/azure/dn741330.aspx). Рассмотрите возможность использования [гибкого масштабирования в Базе данных SQL Azure](sql-database-elastic-scale-get-started.md) для создания сегментированного масштабируемого решения в Базе данных SQL Azure. Сведения об этом представлены в статье "Начало работы с эластичным масштабированием Базы данных SQL Azure (предварительная версия)".

## Обновление до более высокого уровня служб
Для обновления базы данных используйте один из указанных ниже методов. Приведенные действия относятся к обновлению до уровня Premium, но могут применяться для любых обновлений.

### Использование портала управления Azure
1. Войдите на портал управления Azure с помощью учетной записи Майкрософт.
2. Перейдите на вкладку **БАЗЫ ДАННЫХ SQL**.
3. Выберите базу данных из списка **Базы данных**. База данных откроется на **панели мониторинга базы данных** или на странице **Быстрый запуск**.
4. Перейдите на вкладку **Масштаб** базы данных.
5. В разделе **Общие** выберите для уровня служб значение **PREMIUM**.
6. В качестве **уровня производительности** выберите **P1**, **P2** или **P3**. Наращивание ресурсов на каждом уровне производительности представляется в DTU. Дополнительные сведения об уровнях производительности и DTU см. в статье "Уровни служб и уровни производительности в Базе данных SQL".
8. На панели команд в нижней части экрана нажмите кнопку **Сохранить**.
9. Появится сообщение с **запросом на подтверждение**. Ознакомьтесь представленной информацией и установите флажок, чтобы подтвердить свой выбор.


### Использование Azure PowerShell
1. Воспользуйтесь командлетом Set-AzureSqlDatabase, чтобы указать уровень производительности, максимальный размер базы данных и уровень служб для базы данных. Список размеров базы данных, поддерживаемых разными уровнями служб, см. в статье "Уровни служб (версии) в Базе данных SQL Azure".
2. Установите контекст сервера, воспользовавшись командлетом New-AzureSqlDatabaseServerContext. Пример синтаксиса приведен в подразделе "Использование команд Azure PowerShell".
3. Получите дескриптор базы данных и целевой уровень производительности. Укажите уровень производительности с помощью командлета Set-AzureSqlDatabase –ServiceObjective.

**Пример использования**.
В этом примере:
- демонстрируется обновление до уровня служб Premium; 
- создается переменная $db, указывающая на базу данных с именем "somedb"; 
- создается дескриптор $P1, который указывает на уровень производительности Premium 1; 
- для базы данных $db устанавливается уровень производительности $P1.

		Windows PowerShell:

		$db = Get-AzureSqlDatabase $serverContext –DatabaseName "somedb"

		$P1= Get-AzureSqlDatabaseServiceObjective $serverContext -ServiceObjectiveName "P1"

		Set-AzureSqlDatabase $serverContext –Database $db –ServiceObjective $P1 –Edition Premium



## Переход на более низкий уровень служб
Для перевода базы данных на более низкий уровень служб используйте один из приведенных ниже методов.

### Использование портала управления Azure
1. Войдите на портал управления Azure с помощью учетной записи Майкрософт.
2. Перейдите на вкладку **БАЗЫ ДАННЫХ SQL**.
3. Перейдите на вкладку **МАСШТАБ** для нужной базы данных.
4. В разделе **Общие** выберите нужный уровень служб.
5. На панели команд в нижней части экрана нажмите кнопку **Сохранить**.
6. При необходимости на странице **Подтверждение** ознакомьтесь с приведенной информацией и установите флажок, чтобы подтвердить изменение.

### Использование Azure PowerShell
1. Воспользуйтесь командлетом Set-AzureSqlDatabase, чтобы указать уровень служб, уровень производительности и максимальный размер для базы данных.
2. Установите контекст сервера с помощью командлета New-AzureSqlDatabaseServerContext и примера синтаксиса из подраздела "Использование команд Azure PowerShell".
3. Выполните следующие действия.
 - Получите дескриптор базы данных.
 - Получите дескриптор уровня производительности.
 - Укажите уровень служб, уровень производительности и максимальный размер для базы данных с помощью командлета Set-AzureSqlDatabase –ServiceObjective.

**Пример использования**

В этом примере показано, как понизить уровень служб базы данных с Premium до Standard:

- Создается дескриптор $db, указывающий на базу данных с именем "somedb".

- Создается переменная $S2, которая указывает на уровень производительности Standard S2.

- Для базы данных $db устанавливается уровень производительности $S2.

- С помощью параметров –Edition и –MaxSizeGB указывается уровень обслуживания базы данных и максимальный размер для базы данных. Значение, указанное для –MaxSizeGB, должно быть допустимым для целевого уровня обслуживания. Ранее в этом разделе приведена таблица значений MaxSize для каждого уровня обслуживания.

		Windows PowerShell:

		$db = Get-AzureSqlDatabase $serverContext –DatabaseName “somedb”

		$S2 = Get-AzureSqlDatabaseServiceObjective $serverContext -ServiceObjectiveName "S2"

		Set-AzureSqlDatabase $serverContext –Database $db –ServiceObjective $S2 –Edition Standard –MaxSizeGB 40

##Изменение уровней производительности
Можно повысить или понизить уровень производительности базы данных Standard или Premium с помощью одного из предложенных ниже методов. Изменение уровня производительности базы данных может занять некоторое время. Дополнительные сведения см. в подразделе [Влияние изменений базы данных](https://msdn.microsoft.com/library/azure/dn369872.aspx#Impact) ниже.

Если вы изменяете уровень производительности базы данных Premium, в которой настроены отношения "Активная георепликация", используйте следующий порядок для базы данных-источника и действующей базы данных-получателя.

Этот порядок объясняется тем, что уровень производительности действующей базы данных-получателя должен быть не ниже уровня производительности базы данных-источника. 
- При переходе на более низкий уровень производительности начните с базы данных-источника, а затем продолжите с базами данных-получателями.

- При переходе на более высокий уровень производительности начните с действующих баз данных-получателей и завершите базой данных-источником.

###Использование портала управления Azure
1. Войдите на портал управления Azure с помощью учетной записи Майкрософт.
2. Перейдите на вкладку **БАЗЫ ДАННЫХ SQL**.
3. Выберите базу данных из списка **Базы данных** для учетной записи или для определенного сервера База данных откроется на **панели мониторинга базы данных** или на странице **Быстрый запуск**.
5. Перейдите на вкладку **Масштаб** базы данных.
6. Для параметра **Уровень производительности** выберите уровень производительности.
7. На панели команд в нижней части экрана нажмите кнопку **Сохранить**.

###Использование Azure PowerShell
1. Воспользуйтесь командлетом Set-AzureSqlDatabase, чтобы указать уровень производительности базы данных.
2. Установите контекст сервера, воспользовавшись командлетом New-AzureSqlDatabaseServerContext. Пример синтаксиса приведен в подразделе "Использование команд Azure PowerShell".
3. Выполните следующие действия.
- Получите дескриптор базы данных.
- Получите дескриптор уровня производительности.
- Укажите уровень производительности с помощью командлета Set-AzureSqlDatabase –ServiceObjective.

**Пример использования**

В данном примере:

- Создается дескриптор $db, указывающий на базу данных с именем "somedb".

- Создается дескриптор $P2, который указывает на уровень производительности Premium 2.

- Для базы данных $db устанавливается уровень производительности $P2.

		Windows PowerShell
		$db = Get-AzureSqlDatabase $serverContext –DatabaseName “somedb”

		$P2 = Get-AzureSqlDatabaseServiceObjective $serverContext -ServiceObjectiveName "P2"

		Set-AzureSqlDatabase $serverContext –Database $db –ServiceObjective $P2

##Влияние изменений базы данных
В этом разделе даются сведения о результатах обновления до уровня служб Standard или Premium или изменения уровней производительности базы данных.

###Обработка подключений к приложению во время изменений базы данных
Подключения к базе данных могут быть временно разорваны при выполнении изменения уровня производительности или уровня служб. Перед возобновлением подключений может пройти несколько секунд. Приложения Базы данных SQL должны уже содержать в коде устойчивость к потере подключений, так как это может случиться в Базе данных SQL в любой момент при сбое сервера в центре обработки данных и при отработке отказа службой Базы данных SQL. Не требуется никаких изменений в приложении для использования базы данных Premium, равно как и для изменения уровня производительности базы данных Premium.

###Понимание и оценка задержки при изменениях базы данных
Изменение SLO для базы данных часто связано с перемещением данных; таким образом, может пройти много часов, прежде чем запрос на изменение завершится и связанные с ним изменения в тарификации начнут действовать. Перемещение данных происходит при изменении уровня служб базы данных и может также происходить при изменении уровня производительности базы данных.

**Задержка для изменений SLO, связанных с перемещением данных**

После определения размера хранилища базы данных задержка запроса на изменение SLO может быть оценена по следующей эвристике:

3 x (5 минут + размер базы данных / 150 МБ/мин)

Например, если размер базы данных составляет 50 ГБ, задержка запроса на изменение SLO оценивается следующим образом:

3 x (5 минут + 50 ГБ x 1024 МБ/GB / 150 МБ/мин) ≈ 17 часов

Оценки нижней и верхней границ при использовании этой эвристики варьируются от 15 минут для пустой базы данных до приблизительно 2 дней для базы данных объемом 150 ГБ. Оценки могут варьироваться еще больше в зависимости от условий в центре обработки данных.

**Задержка при переходе на более низкий уровень производительности**

Обычно при изменении уровня производительности базы данных на более низкий не происходит перемещения данных. В таких случаях задержка изменения SLO намного меньше и обычно занимает несколько секунд.

Предупреждение. Это применимо только к переходу с Premium на Standard. Переход на уровень обслуживания Web, Business или Basic приводит к перемещению данных.

###Проверка состояния изменения базы данных
Можно проверить состояние базы данных во время перехода на более высокий или на более низкий уровень обслуживания и при изменении уровня производительности с помощью одного из представленных ниже способов.

####Использование портала управления Azure
1. Войдите на портал управления Azure с помощью учетной записи Майкрософт.
2. Выберите базу данных из списка **Базы данных**. База данных откроется на **панели мониторинга базы данных** или на странице **Быстрый запуск**.
3. На **панели мониторинга баз данных** обратитесь к области **Краткий обзор** с информацией о состоянии в разделе **Выпуск**.
4. Цель уровня обслуживания (SLO) представляет уровень производительности в рамках уровня служб.


##Использование команд Azure PowerShell
В этом разделе приводятся предварительные требования для использования команд Azure PowerShell.

**Предварительные требования**

Для использования командлетов Azure PowerShell, описанных в этом разделе, на компьютере, где запускается PowerShell, должно быть установлено следующее программное обеспечение.
1. Загрузите Windows PowerShell версии не ниже 3.0 на странице http://www.microsoft.com/ru-ru/download/details.aspx?id=34595.

2. Загрузите Azure PowerShell в разделе программы командной строки на странице [загрузок пакета Azure SDK и инструментов](http://azure.microsoft.com/downloads/).

Выполните указанные ниже действия. 
На **начальном экране** или в меню **Пуск** перейдите к Azure PowerShell и запустите его.

Укажите имя пользователя и пароль для сервера.

Создайте контекст сервера, воспользовавшись командлетом **New-AzureSqlDatabaseServerContext**.

**Пример**

		Windows PowerShell
		$subId = <Subscription ID>
		$thumbprint = <Certificate Thumbprint>
		$myCert = Get-Item Cert:\CurrentUser\My\$thumbprint
		Set-AzureSubscription -SubscriptionName "mySubscription" -SubscriptionId $subId -Certificate $myCert
		Select-AzureSubscription -SubscriptionName "mySubscription"
		$serverContext = New-AzureSqlDatabaseServerContext -ServerName "myserver" -UseSubscription


**Справочник по PowerShell для Azure**
Дополнительные сведения о командлетах Azure PowerShell, используемых в этом разделе, см. раздел [Командлеты Базы данных SQL Azure](https://msdn.microsoft.com/library/dn546726.aspx).

[New-AzureSqlDatabaseServerContext](http://go.microsoft.com/fwlink/?LinkId=391026)

[New-AzureSqlDatabase](http://go.microsoft.com/fwlink/?LinkId=391027)

[Set-AzureSqlDatabase](http://go.microsoft.com/fwlink/?LinkId=391412)
 

<!---HONumber=July15_HO4-->