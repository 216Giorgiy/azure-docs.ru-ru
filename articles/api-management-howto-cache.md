<properties pageTitle="How to cache operation results in Azure API Management" metaKeywords="" description="Learn how to improve the latency, bandwidth consumption, and web service load for API Management service calls." metaCanonical="" services="" documentationCenter="API Management" title="How to cache operation results in Azure API Management" authors="sdanie" solutions="" manager="" editor="" />

<tags ms.service="api-management" ms.workload="mobile" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="sdanie"></tags>

# Как кэшировать результаты операции в Azure API Management

Операции в API Management (предварительная версия) можно настроить для кэширования ответов. Кэширование ответов может значительно уменьшить время задержки API, потребляемую пропускную способность, и нагрузку на веб-службу применительно к данным, которые изменяются редко.

В этом учебнике будут рассмотрены параметры и политики кэширования для одной из типовых операций интерфейса Echo API, а также вызов операции на портале разработчика, чтобы увидеть процесс кэширования в действии.

## Содержание раздела

-   [Настройка операции для кэширования][Настройка операции для кэширования]
-   [Анализ политик кэширования][Анализ политик кэширования]
-   [Вызов операции и проверка кэширования][Вызов операции и проверка кэширования]
-   [Дальнейшие действия][Дальнейшие действия]

## <a name="configure-caching"> </a>Настройка операции для кэширования

На этом этапе необходимо проанализировать параметры кэширования операции **GET Resource (cached)** типового интерфейса Echo Api.

> Каждый экземпляр службы API Management поставляется предварительно настроенным с Echo API, с которым можно экспериментировать при изучении API Management. Дополнительные сведения см. в разделе [Начало работы с Azure API Management][Начало работы с Azure API Management].

Для начала щелкните **Консоль управления** на портале Azure службы API Management. Открывается административный портал API Management.

![Консоль API Management][Консоль API Management]

> Если экземпляр службы API Management еще не создан, см. раздел [Создание экземпляра службы API Management][Создание экземпляра службы API Management] в руководстве [Начинаем работу с API Management][Начало работы с Azure API Management].

Щелкните **API** в левом меню **API Management**, а затем **Echo API**.

![Echo API][Echo API]

Перейдите на вкладку **Операции** и щелкните операцию **GET Resource (cached)** в списке **Операции**.

![Операции интерфейса Echo API][Операции интерфейса Echo API]

Перейдите на вкладку **Кэширование** для просмотра параметров кэширования для этой операции.

![Вкладка «Кэширование»][Вкладка «Кэширование»]

Чтобы включить кэширование для операции, установите флажок **Включить**. В этом примере кэширование включено.

Каждый ответ операции содержит ключ на основе значений в полях **В зависимости от параметров строки запроса** и **В зависимости от заголовков**. Если вы хотите кэшировать несколько ответов на основании параметров строки запроса или заголовков, то такой режим можно настроить с помощью этих полей.

**Длительность** указывает интервал срока действия кэшированных ответов. В этом примере интервал составляет **3600** секунд, что эквивалентно одному часу.

В случае использования конфигурации кэширования в этом примере операция **GET Resource (cached)** будет возвращать ответ из серверной службы. Этот ответ будет кэшироваться, а также отмечаться (ключом) указанных заголовков и параметров строки запроса. Для последующих вызовов операции с совпадающими параметрами будет возвращаться кэшированный ответ до тех пор, пока не истечет срок действия кэша.

## <a name="caching-policies"> </a>Анализ политик кэширования

После настройки параметров кэширования на вкладке **Кэширование** для операции добавляются политики кэширования. Эти политики можно просматривать и изменять в редакторе политик.

Щелкните **Политики** в левом меню **API Management** и выберите **Echo API / GET Resource (cached)** в раскрывающемся списке **Операция**.

![Операция с диапазоном политик][Операция с диапазоном политик]

При этом в редакторе политик отображаются политики для данной операции.

![Редактор политик API Management][Редактор политик API Management]

Определение политики для этой операции содержит политики, определяющие конфигурацию кэширования, которые были проанализированы с помощью вкладки **Кэширование** на предыдущем этапе.

    <policies>
        <inbound>
            <base />
            <cache-lookup vary-by-developer="false" vary-by-developer-groups="false">
                <vary-by-header>Accept</vary-by-header>
                <vary-by-header>Accept-Charset</vary-by-header>
            </cache-lookup>
            <rewrite-uri template="/resource" />
        </inbound>
        <outbound>
            <base />
            <cache-store caching-mode="cache-on" duration="3600" />
        </outbound>
    </policies>

> Изменения, внесенные в политики кэширования в редакторе политик, будут отражаться на вкладке **Кэширование** операции и наоборот.

## <a name="test-operation"> </a>Вызов операции и проверка кэширования

Чтобы увидеть процесс кэширования в действии, можно вызвать операцию из портала разработчика. Щелкните **Портал разработчика** в верхнем правом меню.

![Портал разработчика][Портал разработчика]

Щелкните **API** в меню вверху и выберите **Echo API**.

![Echo API][1]

> Если есть только один настроенный или видимый API для данной учетной записи, тогда щелчок по API сразу приведет к операциям для этого API.

Выберите операцию **GET Resource (cached)** и щелкните **Открыть консоль**.

![Открытие консоли][Открытие консоли]

Консоль позволяет вызывать операции прямо на портале разработчика.

![Консоль][Консоль]

Сохраните значения по умолчанию для **param1** и **param2**.

Выберите требуемый ключ в раскрывающемся списке **ключ подписки**. Если ваша учетная запись содержит только одну подписку, то она уже будет выбрана.

Введите **sampleheader:value1** в текстовом поле **Заголовки запроса**.

Щелкните **HTTP Get** и запишите значение заголовков ответа.

Введите **sampleheader:value2** в текстовом поле **Заголовки запроса** и щелкните **HTTP Get**.

Следует отметить, что значение **sampleheader** по-прежнему совпадает со значение **value1** в ответе. Попробуйте ввести другие значения и убедитесь, что возвращается кэшированный ответ из первого вызова.

Введите **25** в поле **param2** и щелкните **HTTP Get**.

Следует отметить, что значением **sampleheader** в ответе теперь является **value2**. Так как результаты операции определяются строкой запроса, то предыдущий кэшированный ответ не возвращается.

## <a name="next-steps"> </a>Дальнейшие действия

-   Просмотрите другие разделы в руководстве [Приступая к работе с расширенными параметрами API][Приступая к работе с расширенными параметрами API].
-   Дополнительные сведения о политиках кэширования см. в разделе [Политики кэширования][Политики кэширования] в [Справочнике по политикам API Management][Справочнике по политикам API Management].

  [Настройка операции для кэширования]: #configure-caching
  [Анализ политик кэширования]: #caching-policies
  [Вызов операции и проверка кэширования]: #test-operation
  [Дальнейшие действия]: #next-steps
  [Начало работы с Azure API Management]: ../api-management-get-started
  [Консоль API Management]: ./media/api-management-howto-cache/api-management-management-console.png
  [Создание экземпляра службы API Management]: ../api-management-get-started/#create-service-instance
  [Echo API]: ./media/api-management-howto-cache/api-management-echo-api.png
  [Операции интерфейса Echo API]: ./media/api-management-howto-cache/api-management-echo-api-operations.png
  [Вкладка «Кэширование»]: ./media/api-management-howto-cache/api-management-caching-tab.png
  [Операция с диапазоном политик]: ./media/api-management-howto-cache/api-management-operation-dropdown.png
  [Редактор политик API Management]: ./media/api-management-howto-cache/api-management-policy-editor.png
  [Портал разработчика]: ./media/api-management-howto-cache/api-management-developer-portal-menu.png
  [1]: ./media/api-management-howto-cache/api-management-apis-echo-api.png
  [Открытие консоли]: ./media/api-management-howto-cache/api-management-open-console.png
  [Консоль]: ./media/api-management-howto-cache/api-management-console.png
  [Приступая к работе с расширенными параметрами API]: ../api-management-get-started-advanced
  [Политики кэширования]: ../api-management-policy-reference/#caching-policies
  [Справочнике по политикам API Management]: ../api-management-policy-reference
