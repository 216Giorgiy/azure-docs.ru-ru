<properties 
	pageTitle="Настройка SSL для рабочей роли облачной службы (Node.js)" 
	description="" 
	services="cloud-services" 
	documentationCenter="nodejs" 
	authors="" 
	manager="wpickett" 
	editor=""/>

<tags 
	ms.service="cloud-services" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="na" 
	ms.devlang="nodejs" 
	ms.topic="article" 
	ms.date="09/17/2014" 
	ms.author="wpickett"/>





# Настройка SSL для приложения Node.js в рабочей роли Azure

SSL-шифрование - это наиболее распространенный метод обеспечения безопасности данных,
отправленных через Интернет. В этой теме, посвященной общим задачам, обсуждается, как
определить конечную точку HTTPS для приложения Node.js, размещенного в рабочей роли в облачной службе Azure.

> [AZURE.NOTE] Действия, приведенные в этой статье, применяются только к приложениям узла, размещенным в рабочей роли в облачной службе Azure.

Эта задача включает следующие шаги:

-   [Шаг 1. Создание службы Node.js и ее публикация в облаке]
-   [Шаг 2. Получение сертификата SSL]
-   [Шаг 3. Изменение приложения для использования SSL-сертификата]
-   [Шаг 4. Изменение файла определения службы]
-   [Шаг 5. Подключение к экземпляру роли с использованием HTTPS]

## <a name="step1"> </a>Шаг 1. Создание службы Node.js и ее публикация в облаке

Вы можете создать простую службу Node.js 'hello
world' с помощью Azure PowerShell, выполнив следующее:

1. В меню **Пуск** или на **начальном экране** найдите **Azure PowerShell**. Щелкните правой кнопкой мыши **Azure PowerShell** и выберите **Запуск от имени администратора**.

	![Azure PowerShell icon][powershell-menu]

	

2.  Создайте новую службу с помощью командлета **New-AzureServiceProject**.

	![][1]

3.  Добавьте в службу рабочую роль с помощью командлета **Add-AzureNodeWorkerRole**:

    ![][2]

4.  Опубликуйте службу в облаке с помощью командлета **Publish-AzureServiceProject**:

    ![][3]

	> [AZURE.NOTE] Если вы ранее не импортировали параметры публикации для своей подписки Azure, при попытке выполнить публикацию появится сообщение об ошибке. Дополнительную информацию о скачивании и импорте параметров публикации для подписки см. в разделе [Использование Azure PowerShell для Node.js](https://www.windowsazure.com/ru-ru/develop/nodejs/how-to-guides/powershell-cmdlets/#ImportPubSettings).

Значение **URL-адрес созданного веб-сайта**, возвращаемое командлетом **Publish-AzureServiceProject**, содержит полное доменное имя вашего размещенного приложения. Далее вам необходимо получить SSL-сертификат для указанного полного доменного имени и развернуть его в Azure.

## <a name="step2"> </a>Шаг 2. Получение сертификата SSL

Чтобы настроить протокол SSL для приложения, сначала необходимо получить SSL-сертификат,
подписанный центром сертификации (ЦС) -
доверенным сторонним поставщиком, который выдает сертификаты для этой цели. Если у вас еще нет сертификата,
нужно получить его в компании,
продающей SSL-сертификаты.

Сертификат должен отвечать следующим требованиям для
SSL-сертификатов в Azure:

-   Сертификат должен содержать закрытый ключ.
-   Сертификат должен быть создан для обмена ключами (**PFX-файлами**).
-   Имя субъекта сертификата должно совпадать с именем домена, которое используется для обращения
    к облачной службе. Вы не можете получить SSL-сертификат для домена
    cloudapp.net, поэтому имя субъекта сертификата должно совпадать
    с именем пользовательского домена, используемого для доступа к приложению. Например, __mysecuresite.cloudapp.net__.
-   Сертификат должен использовать как минимум 2048-разрядное шифрование.

**PFX**-файл, содержащий сертификат, будет добавлен в проект службы и развернут в Azure на следующих шагах.

## <a name="step3"> </a>Шаг 3. Изменение приложения для использования SSL-сертификата

При развертывании приложения Node.js в рабочую роль управление сертификатом сервера и SSL-подключением осуществляется с помощью Node.exe. Для обработки SSL-трафика вместо модуля  'http'необходимо использовать  'https'. Выполните следующие шаги, чтобы добавить SSL-сертификат в проект и настроить приложение для работы с ним.

1.   Сохраните **PFX-файл**, предоставленный центром сертификации, в каталог с вашим приложением. Например, в этой статье используется приложение, размещаемое в каталоге **c:\\node\\securesite\\workerrole1**.

2.   Откройте файл **c:\\node\\securesite\\workerrole1\server.js** с помощью приложения "Блокнот" и замените его содержимое следующим кодом:

		var https = require('https');
		var fs = require('fs');

		var options = {
			pfx: fs.readFileSync('certificate.pfx'),
			passphrase: "password"
		};
		var port = process.env.PORT || 8000;
		https.createServer(options, function (req, res) {
 		    res.writeHead(200, { 'Content-Type': 'text/plain' });
		    res.end('Hello World\n');
		}).listen(port);

	> [AZURE.IMPORTANT] Замените атрибут  'certificate.pfx' именем файла сертификата, а password - паролем файла сертификата, если таковой установлен.

3.   Сохраните файл **server.js**.

В результате этих изменений в файле **server.js** приложение, развернутое в Azure, будет прослушивать обмен данными через порт 443, который является стандартным для протокола SSL. Для реализации обмена данными по протоколу SSL в этом случае используется **PFX**-файл.

## <a name="step4"> </a>Шаг 4. Изменение файла определения службы

Поскольку приложение теперь прослушивает обмен данными через порт 443, вам необходимо соответствующим образом изменить определение службы.

1.  В каталоге службы откройте файл определения службы
    (**ServiceDefinition.csdef**), обновите элемент http **InputEndpoint** в разделе **Endpoints**, чтобы обеспечить обмен данными через порт 443:

        <WorkerRole name="WorkerRole1" vmsize="Small">
        ...
            <Endpoints>
                <InputEndpoint name="HttpIn" protocol="tcp" 
                    port="443" />
            </Endpoints>
        ...
        </WorkerRole>

	После внесения изменений сохраните файл **ServiceDefinition.csdef**.

4.  Обновите измененную конфигурацию в облаке, выполнив публикацию
    своей службы еще раз. В командной строке Azure PowerShell
    из каталога службы введите **Publish-AzureServiceProject**.

## <a name="step5"> </a>Шаг 5. Подключение к экземпляру роли с использованием HTTPS

Теперь, когда развертывание передано и запущено в Azure, вы можете
подключиться к нему, используя HTTPS.

1.  На портале управления выберите свою облачную службу, а затем щелкните **Панель мониторинга**.

2. Выполните прокрутку вниз и щелкните ссылку **URL-адрес сайта**:

    ![the site url][site-url]

	> [AZURE.IMPORTANT] Если отображаемый на портале URL-адрес сайта не задает протокол HTTPS, необходимо вручную ввести адрес в браузере, указав префикс HTTPS вместо HTTP.

3.  Веб-сайт откроется в новом окне браузера.

    Кроме того, в браузере будет отображаться значок замка, свидетельствующий о том,
    что установлено подключение HTTPS. Это также означает, что приложение
    правильно настроено для использования SSL.

    ![][8]

## Дополнительные ресурсы

[Как связать сертификат со службой]

[Настройка SSL для приложения Node.js в веб-роли Azure]

[Как настроить SSL-сертификат на конечной точке HTTPS]

  [Шаг 1. Создание службы Node.js и ее публикация в облаке]: #step1
  [Шаг 2. Получение сертификата SSL]: #step2
  [Шаг 3. Изменение приложения для использования SSL-сертификата]: #step3
  [Шаг 4. Изменение файла определения службы]: #step4
  [Шаг 5. Подключение к экземпляру роли с использованием HTTPS]: #step5
  [**Azure PowerShell**]: http://go.microsoft.com/?linkid=9790229&clcid=0x409
  
  
  
  
  [1]: ./media/cloud-services-nodejs-configure-ssl-certficate-worker-role/enable-ssl-01.png
  [2]: ./media/cloud-services-nodejs-configure-ssl-certficate-worker-role/enable-ssl-02-worker.png
  [3]: ./media/cloud-services-nodejs-configure-ssl-certficate-worker-role/enable-ssl-03-worker.png
  [Портал управления Azure]: http://manage.windowsazure.com
  
  
  [Как связать сертификат со службой]: http://msdn.microsoft.com/library/windowsazure/gg465718.aspx
  
  [site-url]: ./media/cloud-services-nodejs-configure-ssl-certficate-worker-role/site-url.png
  [8]: ./media/cloud-services-nodejs-configure-ssl-certficate-worker-role/enable-ssl-08.png
  [Как настроить SSL-сертификат на конечной точке HTTPS]: http://msdn.microsoft.com/library/windowsazure/ff795779.aspx
  [powershell-menu]: ./media/cloud-services-nodejs-configure-ssl-certficate-worker-role/azure-powershell-start.png
  
  
  [Настройка SSL для приложения Node.js в веб-роли Azure]: /ru-ru/develop/nodejs/common-tasks/enable-ssl/
  

<!--HONumber=45--> 
