---
title: Подключение учетной записи Amazon Web Services к службе "Управление затратами Azure" | Документация Майкрософт
description: Подключение учетной записи Amazon Web Services для просмотра затрат и использования данных в отчетах по управлению затратами.
services: cost-management
keywords: ''
author: bandersmsft
ms.author: banders
ms.date: 04/26/2018
ms.topic: conceptual
ms.service: cost-management
manager: dougeby
ms.custom: ''
ms.openlocfilehash: 0c18fc065ae4d9a9401a8d603f051e9d6236c538
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
---
# <a name="connect-an-amazon-web-services-account"></a>Подключение учетной записи Amazon Web Services

Имеется два способа подключения учетной записи Amazon Web Services (AWS) к службе "Управление затратами Azure". Вы можете подключиться, используя роль IAM, или с помощью учетной записи пользователя IAM с правами только для чтения. Рекомендуется использовать роль IAM, так как она позволяет передавать права доступа доверенным сущностям с помощью разрешений. Применяя роль IAM, вам не нужно предоставлять ключи долгосрочного доступа. После подключения учетной записи AWS к службе "Управление затратами" сведения о затратах и использовании доступны для просмотра в отчетах по управлению затратами. В этом документе содержатся инструкции по выполнению обоих вариантов.

Дополнительные сведения об удостоверениях AWS IAM см. в разделе об [удостоверениях (пользователей, групп и ролей)](https://docs.aws.amazon.com/IAM/latest/UserGuide/id.html).

Вы также включите подробные отчеты о выставлении счетов AWS и будете хранить информацию в контейнере Simple Storage Service (S3) AWS. Подробные отчеты о выставлении счетов включают в себя плату за почасовое использование со сведениями о тегах и ресурсах. Благодаря сохранению отчетов служба "Управление затратами" может извлекать их из контейнера и отображать данные в своих отчетах.


## <a name="aws-role-based-access"></a>Получение доступа на основе роли AWS

В следующих разделах рассматривается создание роли IAM с правами только на чтение для предоставления доступа к службе "Управление затратами".

### <a name="get-your-cost-management-account-external-id"></a>Получение внешнего идентификатора учетной записи службы "Управление затратами"

Сначала нужно получить уникальную парольную фразу для подключения с портала службы "Управление затратами Azure". В AWS эта парольная фраза используется в качестве **внешнего идентификатора**.

1. Откройте портал Cloudyn с портала Azure или перейдите по адресу [https://azure.cloudyn.com](https://azure.cloudyn.com) и выполните вход.
2. Щелкните значок шестеренки, а затем выберите **Cloud Accounts** (Облачные учетные записи).
3. На странице управления учетными записями выберите вкладку **AWS Accounts** (Учетные записи AWS), а затем щелкните **Add new +** (Добавить новый элемент +).
4. В диалоговом окне **Add AWS Account** (Добавление учетной записи AWS) скопируйте **внешний идентификатор** и сохраните его для использования на шагах по созданию роли AWS (в следующем разделе). Внешний идентификатор уникален для вашей учетной записи. На следующем изображении примером внешнего идентификатора является _Contoso_, за которым следует номер. Ваш идентификатор отличается.  
    ![Внешний идентификатор](./media/connect-aws-account/external-id.png)

### <a name="add-aws-read-only-role-based-access"></a>Предоставление доступа только для чтения на основе ролей AWS

1. Войдите в консоль AWS по ссылке https://console.aws.amazon.com/iam/home и выберите **Roles** (Роли).
2. Щелкните **Create Role** (Создать роль) и выберите **Another AWS account** (Другая учетная запись AWS).
3. В поле **Account ID** (Идентификатор учетной записи) вставьте `432263259397`. Этот идентификатор учетной записи является учетной записью сборщика данных службы "Управление затратами", назначенной AWS службе Cloudyn. Используйте показанный идентификатор учетной записи.
4. Рядом с пунктом **Options** (Параметры) выберите **Require external ID** (Требовать внешний идентификатор). Вставьте уникальное значение, которое было скопировано ранее из поля **External ID** (Внешний идентификатор), в службе "Управление затратами". Затем щелкните **Next: Permissions** (Далее: разрешения).  
    ![Создание роли](./media/connect-aws-account/create-role01.png)
5. В разделе **Attach permissions policies** (Подключение политик разрешений) в поле поиска фильтра **Policy type** (Тип политики) введите `ReadOnlyAccess`, выберите **ReadOnlyAccess**, а затем щелкните **Next: Review** (Далее: отзыв).  
    ![Доступ только для чтения](./media/connect-aws-account/readonlyaccess.png)
6. На странице отзывов проверьте выбранные параметры и укажите **имя роли**. Например, *Azure-Cost-Mgt*. Введите **описание роли**. Например, _Назначение ролей для службы "Управление затратами Azure"_ и щелкните **Create role** (Создать роль).
7. В списке **Roles** (Роли) выберите роль и скопируйте значение **Role ARN** (Роль ARN) на странице сводки. Используйте значение имени ресурса Amazon (ARN) роли при регистрации настройки в службе "Управление затратами Azure".  
    ![Роль ARN](./media/connect-aws-account/role-arn.png)

### <a name="configure-aws-iam-role-access-in-cost-management"></a>Настройка доступа роли AWS IAM в службе "Управление затратами"

1. Откройте портал Cloudyn с портала Azure или перейдите по адресу https://azure.cloudyn.com/ и выполните вход.
2. Щелкните значок шестеренки, а затем выберите **Cloud Accounts** (Облачные учетные записи).
3. На странице управления учетными записями выберите вкладку **AWS Accounts** (Учетные записи AWS), а затем щелкните **Add new +** (Добавить новый элемент +).
4. В столбце **Account Name** (Имя учетной записи) отметьте имя учетной записи.
5. В разделе **Access Type** (Тип доступа) выберите **IAM Role** (Роль IAM).
6. В поле **IAM Role** (Роль IAM) вставьте скопированное ранее значение и щелкните **Save** (Сохранить).  
    ![Окно добавления учетной записи AWS](./media/connect-aws-account/add-aws-account-box.png)


Учетная запись AWS появится в списке учетных записей. Значение, указанное в столбце **Owner ID** (Идентификатор владельца), соответствует вашему значению роли ARN. В столбце **Account Status** (Состояние учетной записи) должен появиться символ с зеленой галочкой, указывающий, что служба "Управление затратами" может получить доступ к вашей учетной записи AWS. Пока вы не включите подробное выставление счетов AWS, состояние консолидации отображается как **Standalone** (Автономная).

![Состояние учетной записи AWS](./media/connect-aws-account/aws-account-status01.png)

Служба "Управление затратами" начинает сбор данных и заполнение отчетов. Далее [включите подробное выставление счетов AWS](#enable-detailed-aws-billing).


## <a name="aws-user-based-access"></a>Доступ на основе пользователя AWS

В следующих разделах рассматривается создание роли пользователя с правами только для чтения для предоставления доступа к службе по управлению затратами.

### <a name="add-aws-read-only-user-based-access"></a>Предоставление доступа только для чтения на основе пользователя

1. Войдите в консоль AWS по ссылке https://console.aws.amazon.com/iam/home и выберите **Users** (Пользователи).
2. Нажмите кнопку **Add User**(Добавить пользователя).
3. В поле **User name** (Имя пользователя) введите имя пользователя.
4. В качестве **типа доступа** выберите **Programmatic access** (Программный доступ) и щелкните **Next: Permissions** (Далее: разрешения).  
    ![Добавление пользователя](./media/connect-aws-account/add-user01.png)
5. Чтобы просмотреть разрешения, щелкните **Attach existing policies directly** (Подключить имеющиеся политики напрямую).
6. В разделе **Attach permissions policies** (Подключение политик разрешений) в поле поиска фильтра **Policy type** (Тип политики) введите `ReadOnlyAccess`, выберите **ReadOnlyAccess**, а затем щелкните **Next: Review** (Далее: отзыв).  
    ![Задание разрешений для пользователя](./media/connect-aws-account/set-permission-for-user.png)
7. На странице отзывов проверьте выбранные параметры и щелкните **Create user** (Создать пользователя).
8. На завершающей странице отображаются идентификатор и секрет ключа доступа. Используйте эти сведения для настройки регистрации в службе "Управление затратами".
9. Щелкните **Download .csv** (Скачать CSV-файл) и сохраните файл credentials.csv в безопасном месте.  
    ![Загрузка учетных данных](./media/connect-aws-account/download-csv.png)

### <a name="configure-aws-iam-user-based-access-in-cost-management"></a>Настройка доступа на основе пользователя AWS IAM в службе "Управление затратами"

1. Откройте портал Cloudyn из портала Azure или перейдите по адресу https://azure.cloudyn.com/ и выполните вход.
2. Щелкните значок шестеренки, а затем выберите **Cloud Accounts** (Облачные учетные записи).
3. На странице управления учетными записями выберите вкладку **AWS Accounts** (Учетные записи AWS), а затем щелкните **Add new +** (Добавить новый элемент +).
4. В столбце **Account Name** (Имя учетной записи) отметьте имя учетной записи.
5. В разделе **Access Type** (Тип доступа) выберите **IAM User** (Пользователь IAM).
6. В столбец **Access Type** (Тип доступа) вставьте значение **идентификатора ключа доступа** из файла credentials.csv.
7. В качестве **секретного ключа** используйте **секретный ключ доступа** из файла credentials.csv и щелкните **Save** (Сохранить).  

Учетная запись AWS появится в списке учетных записей. В столбце **Account Status** (Состояние учетной записи) должен отобразиться зеленый значок галочки.

Служба "Управление затратами" начинает сбор данных и заполнение отчетов. Далее [включите подробное выставление счетов AWS](#enable-detailed-aws-billing).

## <a name="enable-detailed-aws-billing"></a>Включение подробного выставления счетов AWS

Для получения ARN роли AWS выполните следующие шаги. Используйте ARN роли для предоставления разрешений на чтение контейнеру выставления счетов.

1. Войдите в консоль AWS по ссылке https://console.aws.amazon.com и выберите **Services** (Службы).
2. В поле поиска служб введите *IAM* и выберите этот вариант, когда он появится.
3. Щелкните **Roles** (Роли) в левом меню.
4. В списке ролей выберите роль, которую вы создали для доступа к Cloudyn.
5. На странице сводки ролей скопируйте **ARN роли**. Сохраните ARN роли для использования на следующих шагах.

### <a name="create-an-s3-bucket"></a>Создание контейнера S3

Создайте контейнер S3 для хранения подробных данных для выставления счетов.

1. Войдите в консоль AWS по ссылке https://console.aws.amazon.com и выберите **Services** (Службы).
2. В поле поиска служб введите *S3*, а затем выберите вариант **S3**, когда он появится.
3. На странице Amazon S3 щелкните **Create bucket** (Создать контейнер).
4. В мастере создания контейнеров выберите имя и регион для контейнера и нажмите кнопку **Next** (Далее).  
    ![Создание контейнера](./media/connect-aws-account/create-bucket.png)
5. На странице **Set properties** (Настройка свойств) оставьте значения по умолчанию, а затем нажмите кнопку **Next** (Далее).
6. На странице Review (Обзор) щелкните **Create bucket** (Создать контейнер). Отобразится список ваших контейнеров.
7. Выберите созданный контейнер и щелкните вкладку **Permissions** (​​Разрешения), а затем выберите **Bucket Policy** (Политика контейнеров). Откроется редактор политики контейнеров.
8. Скопируйте следующий пример JSON и вставьте его в редактор политики контейнеров.
  - Замените `<BillingBucketName>` именем контейнера S3.
  - Замените `<ReadOnlyUserOrRole>` ARN роли или пользователя, который вы ранее скопировали.

  ```
  {
    "Version": "2012-10-17",
    "Id": "Policy1426774604000",
    "Statement": [
        {
            "Sid": "Stmt1426774604000",
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::386209384616:root"
            },
            "Action": [
                "s3:GetBucketAcl",
                "s3:GetBucketPolicy"
            ],
            "Resource": "arn:aws:s3:::<BillingBucketName>"
        },
        {
            "Sid": "Stmt1426774604001",
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::386209384616:root"
            },
            "Action": "s3:PutObject",
            "Resource": "arn:aws:s3:::<BillingBucketName>/*"
        },
        {
            "Sid": "Stmt1426774604002",
            "Effect": "Allow",
            "Principal": {
                "AWS": "<ReadOnlyUserOrRole>"
            },
            "Action": [
                "s3:List*",
                "s3:Get*"
            ],
            "Resource": "arn:aws:s3:::<BillingBucketName>/*"
        }
    ]
  }
  ```

9. Выберите команду **Сохранить**.  
    ![Редактор политики контейнеров](./media/connect-aws-account/bucket-policy-editor.png)


### <a name="enable-aws-billing-reports"></a>Включение отчетов о выставлении счетов AWS

После создания и настройки контейнера S3 в консоли AWS выберите [Billing Preferences](https://console.aws.amazon.com/billing/home?#/preference) (Параметры выставления счетов).

1. На странице параметров выберите **Receive Billing Reports** (Получить отчеты о выставлении счетов).
2. В разделе **Receive Billing Reports** (Получить отчеты о выставлении счетов) введите имя созданного контейнера и нажмите кнопку **Verify** (Проверить).  
3. Выберите все четыре параметра степени детализации отчета, а затем нажмите кнопку **Save preferences** (Сохранить параметры).  
    ![Включение отчетов](./media/connect-aws-account/enable-reports.png)

Служба "Управление затратами" извлекает подробные сведения о выставлении счетов из контейнера S3 и заполняет отчеты после включения подробного выставления счетов. Подробные данные о выставлении счетов могут появиться в консоли Cloudyn в течение 24 часов. Когда данные станут доступны, состояние консолидации учетной записи отобразится как **Consolidated** (Консолидирована). Состояние учетной записи отобразится как **Completed** (Завершена).

![Консолидированное состояние учетной записи](./media/connect-aws-account/consolidated-status.png)

Для некоторых отчетов по оптимизации могут потребоваться данные за несколько дней, чтобы получить выборку данных достаточного размера для предоставления точных рекомендаций.

## <a name="next-steps"></a>Дополнительная информация

- См. дополнительные сведения о [просмотре данных об использовании и затратах с помощью службы "Управление затратами Azure"](tutorial-review-usage.md).
