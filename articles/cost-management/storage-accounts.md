---
title: Настройка учетных записей хранения для службы "Управление затратами Azure" | Документация Майкрософт
description: В этой статье описывается, как настроить учетные записи хранения Azure и контейнеры хранилища AWS для службы "Управление затратами Azure".
services: cost-management
keywords: ''
author: bandersmsft
ms.author: banders
ms.date: 03/27/2018
ms.topic: article
ms.service: cost-management
manager: carmonm
ms.custom: ''
ms.openlocfilehash: 4ddd70501821941120d0d22e273b69842b567532
ms.sourcegitcommit: c3d53d8901622f93efcd13a31863161019325216
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/29/2018
---
# <a name="configure-storage-accounts-for-cost-management"></a>Настройка учетных записей хранения для службы "Управление затратами"

<!--- intent: As a Cost Management user, I want to configure Cost Management to use my cloud service provider storage account to store my reports. -->

Отчеты службы "Управление затратами" можно сохранять на портале Cloudyn, в службе хранилища Azure или контейнерах хранилища AWS. За сохранение отчетов на портале Cloudyn не требуется плата. Тем не менее сохранение отчетов в хранилище вашего поставщика облачных служб является необязательным и требует дополнительных затрат. Эта статья поможет вам настроить учетные записи хранения Azure и контейнеры хранилища Amazon Web Services (AWS) для хранения отчетов.

## <a name="prerequisites"></a>предварительным требованиям

Необходима учетная запись хранения Azure или контейнер хранилища Amazon.

Если у вас нет учетной записи хранения Azure, то вам потребуется ее создать. Сведения о создании учетной записи хранения Azure см. в разделе [Создайте учетную запись хранения](../storage/common/storage-create-storage-account.md#create-a-storage-account).

Если у вас нет контейнера службы Simple Storage Service (S3) AWS, его необходимо создать. Дополнительные сведения о создании контейнера S3 см. в статье [Create a Bucket](https://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html) (Создание контейнера).

## <a name="configure-your-azure-storage-account"></a>Настройка учетной записи хранения Azure

Настроить службу хранилища Azure для использования службы "Управление затратами" нетрудно. Соберите сведения об учетной записи хранения и скопируйте их на портале Cloudyn.

1. Войдите на портал Azure по адресу http://portal.azure.com.
2. Щелкните **Все службы**, выберите **Учетные записи хранения**, перейдите к учетной записи хранения, которую требуется использовать, а затем выберите ее.
3. На странице учетной записи хранения в разделе **Параметры** щелкните **Ключи доступа**.
4. Скопируйте **имя учетной записи хранения** и **строку подключения** для ключа key1.  
![Ключи доступа к службе хранилища Azure](./media/storage-accounts/azure-storage-access-keys.png)  
5. Откройте портал Cloudyn из портала Azure или перейдите по адресу https://azure.cloudyn.com и выполните вход.
6. Щелкните значок шестеренки и выберите **Reports Storage Management** (Управление хранение отчетов).
7. Щелкните **Add new +** (Добавить новый) и убедитесь, что выбрана служба Microsoft Azure. Вставьте имя учетной записи хранения Azure в области **Имя**. Вставьте **строку подключения** в соответствующей области. Введите имя контейнера и нажмите кнопку **Сохранить**.  
![Хранилище Cloudyn, настроенное для Azure](./media/storage-accounts/azure-cloudyn-storage.png)

  Новая запись хранилища отчетов Azure отобразится в списке учетных записей хранения.  
    ![Новое хранилище отчетов Azure в списке](./media/storage-accounts/azure-storage-entry.png)


Теперь отчеты можно сохранять в службе хранилища Azure. При просмотре любого отчета щелкните **Actions** (Действия), а затем выберите **Schedule report** (Запланировать отчет). Назовите отчет, а затем добавьте свой URL-адрес или используйте автоматически созданный. Щелкните **Save to storage** (Сохранить в хранилище) и выберите учетную запись хранения. Введите префикс, который добавляется к имени файла отчета. Выберите формат файла CSV или JSON, а затем сохраните отчет.

## <a name="configure-an-aws-storage-bucket"></a>Настройка контейнера хранилища AWS

Cloudyn использует существующие учетные данные AWS, пользователя или роль, чтобы сохранять отчеты в контейнере. Для проверки доступа Cloudyn пытается сохранить небольшой текстовый файл _check-bucket-permission.txt_ в контейнер.

Укажите роль или пользователя Cloudyn с разрешением PutObject для контейнера. Затем используйте для сохранения отчетов существующий контейнер или создайте новый. Наконец, выберите способ управления классом хранилища, задайте правила жизненного цикла или удалите ненужные файлы.

###  <a name="assign-permissions-to-your-aws-user-or-role"></a>Назначение разрешений для пользователя или роли AWS

При создании новой политики указываются точные разрешения, необходимые для сохранения отчета в контейнер S3.

1. Войдите в консоль AWS и выберите **Services** (Службы).
2. Из списка служб выберите **IAM**.
3. Выберите **Policies** (Политики) в левой части консоли и щелкните **Create Policy** (Создать политику).
4. Щелкните вкладку **JSON**.
5. Приведенная ниже политика позволяет сохранить отчет в контейнер S3. Скопируйте приведенный пример политики и вставьте его на вкладке **JSON**. Замените &lt;bucketname&gt; именем контейнера.

  ```
{
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid":  "CloudynSaveReport2S3",
        "Effect":      "Allow",
        "Action": [
          "s3:PutObject"
        ],
        "Resource": [
          "arn:aws:s3:::<bucketname>/*"
        ]
      }
    ]
}
```

6. Щелкните **Review policy** (Просмотреть политику).  
    ![Просмотр политики](./media/storage-accounts/aws-policy.png)  
7. На странице "Review policy" (Просмотр политики) введите имя политики. Например, _CloudynSaveReport2S3_.
8. Щелкните **Create policy** (Создать политику).

### <a name="attach-the-policy-to-a-cloudyn-role-or-user-in-your-account"></a>Привязка политики к роли или пользователю Cloudyn в вашей учетной записи

Чтобы привязать новую политику, откройте консоль AWS и измените роль или пользователя Cloudyn.

1. Войдите в консоль AWS и выберите **Services** (Службы), а затем из списка служб выберите **IAM**.
2. В левой части консоли выберите **Roles** (Роли) или **Users** (Пользователи).

**Для ролей:**

  1. Щелкните имя роли Cloudyn.
  2. На вкладке **Permissions** (Разрешения) щелкните **Attach Policy** (Привязать политику).
  3. Найдите созданную вами политику и выберите ее, затем щелкните **Attach Policy** (Привязать политику).
    ![AWS: привязка политики к роли](./media/storage-accounts/aws-attach-policy-role.png)

**Для пользователей:**

1. Выберите пользователя Cloudyn.
2. На вкладке **Permissions** (Разрешения) щелкните **Add permissions** (Добавить разрешения).
3. В разделе **Grant Permission** (Предоставление разрешения) щелкните **Attach existing policies directly** (Привязать имеющиеся политики напрямую).
4. Найдите созданную вами политику и выберите ее, затем щелкните **Next: Review** (Далее: проверка).
5. На странице "Add permissions to role name" (Добавление разрешений для имени роли) щелкните **Add permissions** (Добавить разрешения).  
    ![AWS: привязка политики к пользователю](./media/storage-accounts/aws-attach-policy-user.png)


### <a name="optional-set-permission-with-bucket-policy"></a>Необязательно. Настройка разрешения с помощью политики контейнеров

Можно также задать разрешение для создания отчетов в контейнере S3 с помощью политики контейнеров. Сделайте следующее в классическом представлении S3.

1. Создайте новый контейнер или выберите существующий.
2. Щелкните вкладку **Permissions** (Разрешения) и щелкните **Bucket policy** (Политика контейнеров).
3. Скопируйте и вставьте приведенный ниже пример политики. Замените &lt;bucket\_name&gt; и &lt;Cloudyn\_principle&gt; данными ARN своего контейнера. Замените ARN роли или пользователя, используемого Cloudyn.

  ```
{
  "Id": "Policy1485775646248",
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "SaveReport2S3",
      "Action": [
        "s3:PutObject"
      ],
      "Effect": "Allow",
      "Resource": "<bucket_name>/*",
      "Principal": {
        "AWS": [
          "<Cloudyn_principle>"
        ]
      }
    }
  ]
}
```

4. В редакторе политики контейнеров нажмите кнопку **Save** (Сохранить).

### <a name="add-aws-report-storage-to-cloudyn"></a>Добавление хранилища отчетов AWS в Cloudyn

1. Откройте портал Cloudyn из портала Azure или перейдите по адресу https://azure.cloudyn.com и выполните вход.
2. Щелкните значок шестеренки и выберите **Reports Storage Management** (Управление хранение отчетов).
3. Щелкните **Add new +** (Добавить новый) и убедитесь, что выбрана служба AWS.
4. Выберите учетную запись и контейнер хранилища. Имя контейнера хранилища AWS будет указано автоматически.  
    ![Добавление хранилища отчетов для контейнера AWS](./media/storage-accounts/aws-cloudyn-storage.png)  
5. Нажмите кнопку **Save** (Сохранить), затем — кнопку **ОК**.

    Новая запись хранилища отчетов AWS отобразится в списке учетных записей хранения.  
    ![Новое хранилище отчетов AWS в списке](./media/storage-accounts/aws-storage-entry.png)


Теперь отчеты можно сохранять в службе хранилища Azure. При просмотре любого отчета щелкните **Actions** (Действия), а затем выберите **Schedule report** (Запланировать отчет). Назовите отчет, а затем добавьте свой URL-адрес или используйте автоматически созданный. Щелкните **Save to storage** (Сохранить в хранилище) и выберите учетную запись хранения. Введите префикс, который добавляется к имени файла отчета. Выберите формат файла CSV или JSON, а затем сохраните отчет.

## <a name="next-steps"></a>Дополнительная информация

- Ознакомьтесь с разделом [Сведения об отчетах по управлению затратами](understanding-cost-reports.md), чтобы изучить базовую структуру и функции отчетов по управлению затратами.
