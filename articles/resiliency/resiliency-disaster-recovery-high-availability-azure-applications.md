---
title: "Аварийное восстановление и высокая доступность приложений Azure | Документация Майкрософт"
description: "Технические обзоры и подробные сведения о разработке приложений c высокой доступностью и аварийным восстановлением на платформе Microsoft Azure."
services: 
documentationcenter: na
author: adamglick
manager: saladki
editor: 
ms.assetid: e13d5f49-2b91-44ba-829a-1e0f1fceaae8
ms.service: resiliency
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/18/2016
ms.author: aglick
translationtype: Human Translation
ms.sourcegitcommit: 0c23ee550d8ac88994e8c7c54a33d348ffc24372
ms.openlocfilehash: ee3e7103bd647c2d8651ec912fbb764a342781e2


---
# <a name="disaster-recovery-and-high-availability-for-applications-built-on-microsoft-azure"></a>Аварийное восстановление и высокая доступность для приложений на платформе Azure
## <a name="introduction"></a>Введение
В этой статье рассматриваются вопросы, связанные с обеспечением высокой доступности приложений, работающих в Azure. Общая стратегия обеспечения доступности включает в себя также функцию аварийного восстановления. Любой план реагирования на сбои и аварии в облаке предполагает быстрое обнаружение сбоев. Затем реализуется стратегия, которая учитывает допустимые сроки простоя приложения. Кроме того, необходимо оценить, потерю какого объема данных приложение может выдержать при восстановлении без существенных последствий для компании.

Большинство компаний уверены, что готовы к временным или крупномасштабным сбоям. Но, прежде чем вы ответите на этот вопрос, подумайте, отрабатываются ли в вашей компании действия на случай аварии? Проводится ли у вас тестовое восстановление баз данных для проверки правильности выполняемых процессов? Скорее всего, нет. Причина заключается в том, что в основе успешного аварийного восстановления лежит тщательное планирование и разработка соответствующей архитектуры. Как и в случае со многими другими нефункциональными задачами, включая вопросы обеспечения безопасности, аварийному восстановлению редко уделяется достаточно времени и ресурсов, в том числе для предварительного анализа. Большинство компаний также обычно не включают в бюджет поддержку географически распределенных регионов с избыточной емкостью. В итоге даже для самых критически важных приложений зачастую отсутствует план аварийного восстановления.

Облачные платформы, например Azure, базируются на географически распределенных регионах во всем мире. Они также предусматривают средства для обеспечения доступности и реализации разных сценариев аварийного восстановления. Таким образом каждое критическое облачное приложение теперь можно на системном уровне защитить от сбоев. Средства обеспечения устойчивости и аварийного восстановления встроены во многие службы Azure. Вам следует тщательно изучить эти возможности платформы и дополнить их стратегиями для приложений.

В этой статье описываются необходимые действия по созданию архитектуры для защиты развертываний Azure от сбоев. Затем вы сможете реализовать масштабную инфраструктуру, обеспечивающую непрерывность бизнес-процессов. План обеспечения непрерывности бизнес-процессов — это программа действий, которые позволяют продолжать работу в неблагоприятных условиях. К таким условиям относятся технологические сбои, например недоступность службы, а также погодные катаклизмы или отключение электричества. Устойчивость приложения к авариям — это часть обширной программы по обеспечению аварийного восстановления (общие сведения см. в документе NIST [Contingency Planning Guide for Information Technology Systems](https://www.fismacenter.com/sp800-34.pdf) (Руководство по планированию действий в непредвиденных ситуациях для информационно-технологических систем)).

В следующем разделе описываются разные уровни сбоев, методы работы с ними, а также типы архитектуры, позволяющие реализовать эти методы. Эта информация позволит вам подготовить процессы и процедуры аварийного восстановления, чтобы обеспечить правильную и эффективную реализацию стратегии аварийного восстановления.

## <a name="characteristics-of-resilient-cloud-applications"></a>Характеристики устойчивых облачных приложений
Приложение с хорошо продуманной архитектурой должно выдерживать как локальные технические сбои, так и глобальные системные сбои на региональном уровне. В следующих разделах приведена терминология, которая используется в этом документе для описания разных аспектов устойчивых облачных служб.

### <a name="high-availability"></a>высокую доступность;
Облачное приложение с высоким уровнем доступности использует стратегии, нейтрализующие недоступность систем, от которых оно зависит, например управляемых служб облачной платформы. Такой подход позволяет приложению сохранить заявленные функциональные и нефункциональные системные характеристики даже при возможных сбоях функций облачной платформы. Этот вопрос подробно рассматривается в серии видео Channel 9 [FailSafe: Building Scalable, Resilient Cloud Services](https://channel9.msdn.com/Series/FailSafe) (Отказоустойчивость. Создание устойчивой облачной архитектуры).

При реализации приложения обязательно оцените вероятность сбоя определенных функций. Учтите также влияние такого сбоя на приложение в контексте бизнес-процессов и лишь после этого углубляйтесь в разработку стратегий реализации. Если влияние на бизнес-процессы и вероятность развития аварийных состояний не будут правильно учтены, реализация может оказаться затратной или бесполезной.

Рассмотрим обеспечение высокой доступности на примере автомобиля. Даже если вы будете использовать качественные детали и идеально спроектированную систему, это не застрахует вас от случайных сбоев. Например, автомобиль с пробитым колесом продолжает работать, но уже с ограниченной функциональностью. Если вы подготовились к такому сценарию, вы сможете воспользоваться запасным колесом с тонким ободом, чтобы доехать до СТО. Такое колесо не позволит ехать быстро, но с ним вы сможете управлять автомобилем, пока не замените шину. Аналогичным образом, разработанный для облачной службы план на случай сбоя обеспечит непрерывную работу приложения при сравнительно небольших проблемах. Это справедливо даже для тех ситуаций, когда облачная служба вынуждена работать с ограниченной функциональностью.

Есть несколько ключевых характеристик высокой доступности облачных служб: доступность, масштабируемость и устойчивость к сбоям. Хотя эти характеристики тесно взаимосвязаны, важно понимать, что означает каждая из них и как она влияет на общую доступность решения.

### <a name="availability"></a>Доступность
Доступное приложение предполагает доступность базовой инфраструктуры и зависимых служб. Доступные приложения не используют отдельные неисправные точки, компенсируя их избыточностью и устойчивой архитектурой. Когда мы говорим о доступности в Azure, важно понимать концепцию эффективной доступности платформы. Эффективная доступность учитывает соглашения об уровне обслуживания (SLA) для каждой зависимой службы и их общее влияние на доступность всей системы.

Доступность системы — это показатель периода работоспособности системы в процентах. Например, соглашение об уровне обслуживания для двух и более экземпляров рабочей или веб-роли в Azure предусматривает доступность с показателем 99,95 % (из 100 %). Здесь не учитывается производительность или функциональность служб, запущенных на этих ролях. Однако эффективная доступность облачной службы зависит от разных соглашений об уровне обслуживания для всех зависимых служб. Чем больше в системе частей, тем больше потребуется усилий для того, чтобы приложение безотказно выполняло требования конечных пользователей к доступности.

Рассмотрим соглашения об уровне обслуживания для службы Azure, которая использует несколько служб Azure: службы вычислений, базы данных Azure SQL и служба хранилища Azure.

| Служба Azure | Соглашение об уровне обслуживания | Потенциальное количество минут простоя в месяц (30 дней) |
|:--- |:--- |:---:|
| Среда выполнения приложений |99,95 % |21,6 мин |
| База данных SQL |99,99 % |4,3 минуты |
| Хранилище |99,90 % |43,2 мин |

Необходимо включить в план все службы, которые могут стать недоступными в разное время. В этом упрощенном примере предполагается, что приложение не будет работать в течение 108 минут в месяц. 30 дней месяца — это 43 200 минут. 108 минут составляют 0,25 % от общего количества минут за 30 дней (43 200 минут). Следовательно, эффективная доступность этой облачной службы составляет 99,75 %.

Но этот показатель можно улучшить с помощью методов, описанных в этом документе. Например, если приложение будет разработано так, чтобы продолжать работу при недоступности базы данных SQL, этот фактор можно вообще не рассматривать. Возможно, приложение будет работать с ограниченными возможностями, поэтому необходимо учесть все бизнес-требования. Полный список соглашений об уровне обслуживания для Azure см. в разделе [Соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/).

### <a name="scalability"></a>Масштабируемость
Масштабируемость напрямую влияет на доступность. Если приложение выходит из строя при повышении нагрузки, оно становится недоступным. Масштабируемые приложения должны обеспечить стабильные результаты при росте потребностей с учетом допустимых интервалов. Масштабируемая система предусматривает горизонтальное или вертикальное масштабирование в соответствии с ростом нагрузки наряду со стабильной производительностью. По сути, горизонтальное масштабирование — это добавление новых компьютеров такой же мощности (процессор, память, пропускная способность), а вертикальное масштабирование — увеличение размера существующих компьютеров. В Azure предусмотрены разные варианты вертикального масштабирования для выбора размеров виртуальных машин в соответствии с вычислительной нагрузкой. Но виртуальную машину необходимо развернуть повторно, чтобы изменить ее размер. Поэтому самые гибкие решения предусматривают горизонтальное масштабирование. Это относится, в первую очередь, к вычислительным ресурсам, так как количество запущенных экземпляров любых веб-ролей или рабочих ролей можно легко увеличить. Эти дополнительные экземпляры обрабатывают увеличивающийся трафик с помощью веб-портала Azure, сценариев PowerShell или кода. Такое решение следует принимать при увеличении определенных отслеживаемых метрик. В этом случае производительность или метрики не будут существенно снижаться под нагрузкой. Как правило, веб-роли и рабочие роли хранят состояние на внешних ресурсах. Это обеспечивает гибкую балансировку нагрузки и плавную обработку при изменении количества экземпляров. Горизонтальное масштабирование неплохо работает и для служб (включая службу хранилища Azure), которые не предоставляют многоуровневые возможности вертикального масштабирования.

Облачные развертывания следует рассматривать как коллекцию единиц масштабирования. Это позволяет приложению гибко обслуживать потребности пользователей с нужной пропускной способностью. Единицы масштабирования проще представить на уровне сервера приложений и веб-сервера. Это связано с тем, что Azure уже предоставляет вычислительные узлы без сохранения состояния в виде веб-ролей и рабочих ролей. Если вы добавите в развертывание новые единицы масштабирования вычислительных ресурсов, это никак не скажется на управлении состоянием приложения, так как единицы масштабирования вычислительных ресурсов не имеют состояния. Единица масштабирования хранилища отвечает за управление сегментом данных (структурированных и неструктурированных). Например, к единицам масштабирования хранилища относятся: секция таблицы Azure, контейнер больших двоичных объектов Azure и База данных SQL Azure. Масштабируемость приложения напрямую зависит даже от использования нескольких учетных записей хранения Azure. Масштабируемость облачной службы обеспечивается включением нескольких единиц масштабирования хранилища. Например, если приложение использует реляционные данные, распределите данные между несколькими базами данных SQL. Таким образом хранилище будет соответствовать эластичной модели ресурсов вычислений. Кроме того, служба хранилища Azure поддерживает схемы секционирования данных, которые требуют тщательного проектирования в соответствии с пропускной способностью вычислительного уровня. Список рекомендаций по разработке масштабируемых облачных служб см. в записи блога [Best Practices for the Design of Large-Scale Services on Azure Cloud Services](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/) (Рекомендации по разработке крупномасштабных служб на базе облачных служб Azure).

### <a name="fault-tolerance"></a>Отказоустойчивость
В приложениях нужно учитывать, что любая зависимая облачная служба может стать недоступной в любой момент времени. Отказоустойчивое приложение должно обнаруживать и исключать отказавшие элементы, чтобы выполнять работу с правильными результатами и в установленные сроки. При временных ошибках отказоустойчивая система будет использовать политику повторных попыток. В более серьезных ситуациях приложение выявляет сбой и использует альтернативное оборудование или реализует аварийные планы до устранения проблемы. Надежное приложение способно справиться со сбоем одного или нескольких компонентов, продолжая правильно функционировать. Отказоустойчивое приложение может использовать одну или несколько специальных стратегий проектирования, например избыточность, репликацию или режим ограниченной функциональности.

## <a name="disaster-recovery"></a>Аварийное восстановление
Облачное развертывание может перестать работать из-за системного сбоя зависимых служб или базовой инфраструктуры. В таких условиях активируется процесс аварийного восстановления в соответствии с планом обеспечения непрерывности бизнес-процессов. Обычно этот процесс включает действия обслуживающего персонала и автоматизированные процедуры, позволяющие запустить приложение в доступном регионе. Для этого нужно перенести в новый регион пользователей, данные и службы приложения. Также используются носители резервных копий или постоянная репликация.

Снова вспомним приведенную выше аналогию, где высокую доступность мы сравнили с возможностью восстановления работоспособности при проколе шины с помощью запасного колеса. Аварийное восстановление, в свою очередь, определяет действия в случае ДТП, после которого автомобиль уже не может функционировать. В этом случае лучшим решением будет найти способ заменить автомобиль. Например, вы можете вызвать такси или позвонить другу. В этом сценарии возобновление движения будет, скорее всего, более отсроченным. Также не будем забывать про возврат и ремонт поврежденного автомобиля. Аналогичным образом, аварийное восстановление в другой регион — это сложная задача, которая обычно сопряжена с периодом простоя и возможностью потери данных. Чтобы лучше понять и оценить стратегии аварийного восстановления, важно определить два термина: целевое время восстановления (RTO) и целевая точка восстановления (RPO).

### <a name="recovery-time-objective"></a>Целевое время восстановления
Целевое время восстановления (RTO) — это максимально допустимое время до восстановления функциональности приложения. Оно определяется на основе бизнес-требований и напрямую связано с важностью приложения. Для критически важных бизнес-приложений значение RTO будет низким.

### <a name="recovery-point-objective"></a>Целевая точка восстановления
Целевая точка восстановления (RPO) — это максимально допустимый период времени, данные за который будут потеряны в процессе восстановления. Например если для RPO установлено значение 1 час, следует создавать полную резервную копию или выполнять репликацию данных не реже одного раза в час. После развертывания приложения в другом регионе в резервной копии могут отсутствовать данные за последний час. Как и в случае с RTO, критически важные приложения имеют низкие значения RPO.

## <a name="checklist"></a>Контрольный список
Подытожим ключевые моменты, описанные в этой статье (а также в связанных статьях об [обеспечении высокого уровня доступности](resiliency-high-availability-azure-applications.md) и [аварийном восстановлении](resiliency-disaster-recovery-azure-applications.md) для приложений Azure). Эту сводку вы можете использовать в качестве контрольного списка элементов, которые следует учитывать при планировании стратегии обеспечения доступности и аварийного восстановления. Эти рекомендации пригодились клиентам, которые хотят создать эффективное решение.

1. Оценивайте риски отдельно для каждого приложения в соответствии с индивидуальными требованиями. Некоторые приложения более важны, чем другие, и это будет хорошим стимулом дополнительно вложиться в реализацию стратегии их аварийного восстановления.
2. Используйте эту информацию, чтобы определить значения RTO и RPO для каждого приложения.
3. Вся разработка, начиная с архитектуры приложения, должна основываться на факте неизбежности сбоев.
4. Реализуйте рекомендации по обеспечению высокой доступности, соблюдая разумный баланс между затратами, сложностью и рисками.
5. Разработайте планы и процессы аварийного восстановления.
   * Учитывайте сбои разных уровней — от ошибок в отдельном модуле до полного отключения облачной платформы.
   * Разработайте стратегии резервного копирования для всех ссылочных и транзакционных данных.
   * Выберите архитектуру многоузлового аварийного восстановления.
6. Определите конкретного сотрудника, ответственного за операции аварийного восстановления, автоматизации и тестирования. Этот человек должен руководить всем процессом.
7. Задокументируйте процессы, чтобы их можно было легко воспроизвести. Хотя ответственным будет один человек, должно быть еще несколько компетентных сотрудников, которые смогут выполнить все операции в экстренной ситуации.
8. Обучите сотрудников этому.
9. Регулярно проводите имитации аварийных ситуаций для обучения процессу и его проверки.

## <a name="summary"></a>Сводка
Когда в среде Azure происходит аппаратный или программный сбой, методы и стратегии управления ситуацией отличаются от аналогичных процессов в локальных системах. Основная причина заключается в том, что облачные решения обычно имеют больше зависимостей от инфраструктуры, включающей в себя отдельные службы, распределенные по региону Azure. Для частичных сбоев следует применять методы обеспечения доступности. Для более серьезных ситуаций, включая масштабные аварии, используйте стратегии аварийного восстановления.

Azure обнаруживает и обрабатывает многие ошибки, но существуют разные типы сбоев, для которых требуются стратегии на уровне приложения. Вам следует активно готовиться к сбоям приложений, служб и данных, а также учиться управлять такими ситуациями.

Когда вы создаете план аварийного восстановления и обеспечения доступности, учитывайте последствия сбоя приложения на бизнес-процессы. Потребуется много времени, подготовки и усилий, чтобы определить процессы, политики и процедуры для восстановления критичных систем после аварии. Но нельзя останавливаться на создании планов. Необходимо регулярно анализировать, тестировать и постоянно улучшать планы с учетом существующих приложений, бизнес-требований и доступных технологий. Azure предоставляет новые возможности и ставит новые задачи для создания надежных приложений, устойчивых к сбоям.

## <a name="additional-resources"></a>Дополнительные ресурсы
[Обеспечение высокой доступности для приложений на платформе Microsoft Azure](resiliency-high-availability-azure-applications.md)

[Аварийное восстановление для приложений на платформе Microsoft Azure](resiliency-disaster-recovery-azure-applications.md)

[Техническое руководство по обеспечению устойчивости в Azure](resiliency-technical-guidance.md)

[Обзор. Непрерывность облачных бизнес-процессов и аварийное восстановление баз данных с базой данных SQL](../sql-database/sql-database-business-continuity.md)

[Высокий уровень доступности и аварийное восстановление для SQL Server на виртуальных машинах Azure](../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md)

[FailSafe: Building Scalable, Resilient Cloud Services (Отказоустойчивость. Создание устойчивой облачной архитектуры)](https://channel9.msdn.com/Series/FailSafe)

[Best Practices for the design of large-scale services on Azure Cloud Services (Рекомендации по разработке крупномасштабных служб на базе облачных служб Azure)](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/)

## <a name="next-steps"></a>Дальнейшие действия
Эта статья входит в цикл статей, посвященных аварийному восстановлению и обеспечению высокой доступности приложений Azure. Следующая статья в этой серии — [Обеспечение высокой доступности для приложений на платформе Microsoft Azure](resiliency-high-availability-azure-applications.md).




<!--HONumber=Jan17_HO2-->


