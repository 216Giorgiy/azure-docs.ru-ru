<properties
   pageTitle="Техническое руководство по устойчивости для Azure. Восстановление данных после повреждения или случайного удаления | Microsoft Azure"
   description="В этой статье объясняется, как восстанавливать данные после повреждения или случайного удаления, как создавать надежные, высокодоступные и отказоустойчивые приложения и как правильно планировать аварийное восстановление."
   services=""
   documentationCenter="na"
   authors="adamglick"
   manager="hongfeig"
   editor=""/>

<tags
   ms.service="resiliency"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="05/13/2016"
   ms.author="patw;jroth;aglick"/>

#Техническое руководство по обеспечению устойчивости в Azure. Восстановление данных после повреждения или случайного удаления

Надежный план обеспечения непрерывности бизнес-процессов должен включать в себя меры на случай повреждения или случайного удаления данных. Ниже приводятся сведения о восстановлении после повреждения или случайного удаления данных в результате ошибки приложения или оператора.

##Виртуальные машины

Чтобы защитить виртуальные машины Azure, предоставляемые в формате "инфраструктура как услуга" (IaaS), от ошибок приложений и случайного удаления данных, используйте [службу архивации Azure](https://azure.microsoft.com/services/backup/). Служба архивации Azure позволяет создавать согласованные резервные копии нескольких дисков виртуальной машины. Кроме того, в хранилище резервных копий предусмотрена репликация между регионами, которая обеспечивает восстановление в случае потери данных в одном из регионов.

##Хранилище

Обратите внимание, что автоматические реплики, которые служба хранилища Azure использует для обеспечения устойчивости данных, не могут помешать коду приложения (а также разработчикам или пользователям) повредить данные путем случайного или непреднамеренного удаления, обновления и т. п. Чтобы сохранить точность данных в случае ошибок приложения или пользователя, требуются более сложные приемы, например копирование данных в дополнительное хранилище и ведение журнала аудита. Разработчики могут использовать [моментальные снимки](https://msdn.microsoft.com/library/azure/ee691971.aspx) больших двоичных объектов для создания копий больших двоичных объектов "только для чтения" по состоянию на конкретный момент времени. Эта функция может стать основой решения по поддержанию точности данных для больших двоичных объектов службы хранилища Azure.

###Резервное копирование хранилищ BLOB-объектов и таблиц

Большие двоичные объекты и таблицы вполне надежны, но они представляют только текущее состояние данных. Иногда после нежелательного изменения или удаления требуется восстановить данные в предыдущем состоянии. Это можно сделать с помощью функций Azure, позволяющих создавать и сохранять копии на определенный момент времени.

Для больших двоичных объектов Azure вы можете создавать резервные копии на момент времени с использованием [функции моментального снимка большого двоичного объекта](https://msdn.microsoft.com/library/ee691971.aspx). По каждому моментальному снимку взимается оплата только за хранение данных, которые отражают отличия состояния большого двоичного объекта по сравнению с предыдущим моментальным снимком. Моментальные снимки применимы, только если существует исходный большой двоичный объект, на котором они основаны. Поэтому мы рекомендуем создавать копии в другом большом двоичном объекте или даже в другой учетной записи хранения. Это гарантирует надежную защиту данных резервных копий от случайного удаления. Для таблиц Azure копию на определенный момент времени можно создать путем копирования в другую таблицу или BLOB-объект Azure. Подробные рекомендации и примеры резервного копирования таблиц и больших двоичных объектов на уровне приложения вы найдете в следующих статьях.

  * [Protecting Your Tables Against Application Errors](https://blogs.msdn.microsoft.com/windowsazurestorage/2010/05/03/protecting-your-tables-against-application-errors/) (Защита таблиц от ошибок в приложениях)
  * [Protecting Your Blobs Against Application Errors](https://blogs.msdn.microsoft.com/windowsazurestorage/2010/04/29/protecting-your-blobs-against-application-errors/) (Защита BLOB-объектов от ошибок в приложениях)

##База данных

Для базы данных SQL Azure существует несколько методов обеспечения [непрерывности бизнес-процессов](../sql-database/sql-database-business-continuity.md) (резервного копирования и восстановления). Базы данных можно копировать с помощью функции [копирования базы данных](../sql-database/sql-database-copy.md) или [экспорта](../sql-database/sql-database-export.md) с последующим [импортом](https://msdn.microsoft.com/library/hh710052.aspx) BACPAC-файла SQL Server. Копирование базы данных обеспечит согласованность на уровне транзакций, в отличие от использования BACPAC-файла (через службу импорта и экспорта). Оба эти действия выполняются службами в центре обработки данных с соблюдением очередности операций, и в настоящее время не существует гарантий относительно времени их выполнения в рамках соглашения об уровне обслуживания.

>[AZURE.NOTE]Действия копирования или импорта и экспорта базы данных создают значительную нагрузку на базу данных-источник. Они могут стать причиной конфликта ресурсов или событий регулирования.

###Резервное копирование базы данных SQL

Резервную копию базы данных SQL Microsoft Azure на определенный момент времени можно создать путем [копирования базы данных SQL Azure](../sql-database/sql-database-copy.md). Эта команда позволяет создать транзакционно согласованную копию базы данных на том же логическом сервере базы данных или на другом сервере. В любом случае копия базы данных будет полностью работоспособной и полностью независимой от базы данных-источника. Каждая создаваемая копия дает возможность восстановить данные на определенный момент времени. Вы сможете полностью восстановить состояние базы данных, присвоив новой базе данных имя, которое использовалось для базы данных-источника. Также вы можете восстановить из новой базы данных определенное подмножество данных с помощью запросов Transact-SQL. Дополнительные сведения о базе данных SQL см. в статье [Обзор. Непрерывность облачных бизнес-процессов и аварийное восстановление баз данных с базой данных SQL](../sql-database/sql-database-business-continuity.md).

###Резервное копирование SQL Server на виртуальных машинах

Для SQL Server, который используется на виртуальных машинах Azure в формате IaaS, существует два варианта резервного копирования: традиционные резервные копии и доставка журналов. Традиционные резервные копии позволяют восстановить данные на определенный момент времени, но процесс восстановления в таком случае будет длительным. Восстановление традиционных резервных копий начинается с первоначальной полной резервной копии, на которую последовательно накладываются все последующие резервные копии. Второй вариант подразумевает, что вы можете настроить сеанс доставки журналов с определенной задержкой до восстановления резервных копий журналов (например, на два часа). Так вы получите временной зазор для восстановления после ошибок, возникших в базе данных-источнике.

##Другие службы платформы Azure

Некоторые службы платформы Azure хранят информацию в настраиваемой пользователем учетной записи хранения или в базе данных SQL Azure. Если учетная запись или ресурс хранилища будут удалены или повреждены, это может вызвать серьезные ошибки в службе. Поэтому важно сохранять резервные копии, которые позволят заново создать эти ресурсы в случае удаления или повреждения.

Для веб-сайтов Azure и мобильных служб Azure следует обеспечить резервное копирование и поддержку связанных баз данных. Для службы мультимедиа и виртуальных машин Azure следует поддерживать связанную учетную запись хранения Azure и все ресурсы в этой учетной записи. Например, для виртуальных машин требуется резервное копирование дисков виртуальной машины, размещенных в хранилище BLOB-объектов Azure, и управление ими.

##Контрольные списки на случай повреждения или случайного удаления данных

##Контрольный список для виртуальных машин
  1. Просмотрите раздел [Виртуальные машины](#virtual-machines) этой статьи.
  2. Для резервного копирования и поддержки дисков виртуальной машины используйте службу архивации Azure (или собственную систему резервного копирования на основе хранилища BLOB-объектов Azure и моментальных снимков виртуальных жестких дисков).

##Контрольный список для хранилища
  1. Просмотрите раздел [Хранилище](#storage) этой статьи.
  2. Регулярно создавайте резервные копии критически важных ресурсов хранилища.
  3. По возможности применяйте функцию моментальных снимков больших двоичных объектов.

##Контрольный список для базы данных
  1. Просмотрите раздел [База данных](#database) этой статьи.
  2. Создавайте резервные копии на определенный момент времени с помощью команды копирования базы данных.

##Контрольный список для резервного копирования SQL Server на виртуальных машинах
  1. Просмотрите раздел [Резервное копирование SQL Server на виртуальных машинах](#sql-server-on-virtual-machines-backup) этой статьи.
  2. Используйте традиционные способы архивации и восстановления.
  3. Создайте сеанс отложенной доставки журналов.

##Контрольный список для веб-приложений
  1. Используйте резервное копирование и поддержку связанной базы данных, если таковая существует.

##Контрольный список для служб мультимедиа
  1. Используйте резервное копирование и поддержку связанных ресурсов хранения.

##Дополнительные сведения

В статье [Сценарии хранения, резервного копирования и восстановления](https://azure.microsoft.com/documentation/scenarios/storage-backup-recovery/) содержатся сведения о возможностях резервного копирования и восстановления в Azure.

##Дальнейшие действия

Этот материал входит в цикл статей, составляющих [техническое руководство по обеспечению устойчивости в Azure](./resiliency-technical-guidance.md). Если вам нужна дополнительная информация по вопросам устойчивости, аварийного восстановления и высокой доступности ресурсов, изучите [дополнительные материалы](./resiliency-technical-guidance.md#additional-resources), входящие в техническое руководство по обеспечению устойчивости в Azure.

<!---HONumber=AcomDC_0615_2016-->