<properties 
	pageTitle="Интеграция веб-приложения с виртуальной сетью Azure" 
	description="В этой статье показано, как подключить веб-приложение Azure к новой или существующей виртуальной сети Azure" 
	services="app-service\web" 
	documentationCenter="" 
	authors="cephalin" 
	manager="wpickett" 
	editor=""/>

<tags 
	ms.service="app-service-web" 
	ms.workload="web" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="08/11/2015" 
	ms.author="cephalin"/>

# Интеграция веб-приложения с виртуальной сетью Azure #
В этом документе описан компонент для предварительного просмотра интеграции с виртуальной сетью и показано, как настроить этот компонент для веб-приложения в [службе приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714). Если вы не знакомы с виртуальными сетями Azure, примите во внимание, что эта функция позволяет создавать гибридные решения с использованием ресурсов в Azure и локальных средах.

Такая интеграция предоставляет веб-приложению доступ к ресурсам виртуальной сети, при этом веб-приложение останется недоступным. Это может быть удобно, например, если веб-приложению нужен доступ к базе данных или веб-службам, запущенным на виртуальных машинах в виртуальной сети или даже в вашем собственном центре обработки данных. Эта функция не позволяет подключать диски. Сейчас компонент также не поддерживает интеграцию с системами проверки подлинности в вашей виртуальной сети. Сейчас эта функция доступна только в предварительной версии и будет усовершенствована к моменту выпуска окончательной версии.

Дополнительные сведения о сценариях использования и преимуществах виртуальных сетей Azure см. в разделе "Обзор виртуальной сети".

## Приступая к работе ##
Перед подключением веб-приложения к виртуальной сети вам следует обратить внимание на некоторые моменты.

1.	К виртуальной сети можно подключить только веб-приложения, которые обслуживаются в рамках плана категории **Standard**. Веб-приложения с планами обслуживания Free, Shared и Basic невозможно подключить к виртуальной сети.
2.	Если необходимая виртуальная сеть уже существует, в ней необходимо активировать подключение типа "точка-сеть" с использованием шлюза с динамической маршрутизацией. Только после этого к ней можно будет подключить веб-приложение. Подключение виртуальной частной сети типа "точка-сеть" (VPN) невозможно активировать, если для шлюза настроена статическая маршрутизация.
3.	В плане обслуживания приложений можно настроить до пяти сетей. Веб-приложение нельзя подключить к нескольким сетям одновременно. Эти пять сетей могут использоваться любым количеством веб-приложений в рамках одного плана обслуживания.  

Вы можете подключиться к существующей виртуальной сети или создать новую. Если выбран второй вариант, шлюз будет заранее настроен. Учтите, что создание и настройка новой виртуальной сети занимают несколько минут.

Если веб-приложение не относится к плану обслуживания категории Standard, система сообщит вам об этом и предоставит информацию о других ценовых категориях и доступных вариантах обновления.

![](./media/web-sites-integrate-with-vnet/upgrade-to-standard.png)

## Принципы работы системы ##
На самом деле работа этой функции основана на технологии VPN типа "точка-сеть", которая используется для подключения вашего веб-приложения к виртуальной сети. Веб-приложения в службе приложений Azure имеют многопользовательскую архитектуру системы, которая не позволяет подготовить веб-приложение к работе непосредственно в виртуальной сети, как это происходит с виртуальными машинами. Технология "точка-сеть" позволяет предоставить доступ к сети только той виртуальной машине, на которой размещено веб-приложение. Доступ к сети ограничивается этими узлами веб-приложений, чтобы веб-приложения получали доступ только к тем сетям, к которым вы его предоставили.

Предоставление доступа к сетям только определенным веб-приложениям предотвращает создание SMB-подключений. При наличии доступа к удаленным ресурсам подключить удаленный диск невозможно.

![](./media/web-sites-integrate-with-vnet/how-it-works.png)
 
Если в виртуальной сети не настроен DNS-сервер, то вам придется использовать IP-адреса. Не забудьте открыть в брандмауэре порты для подключения к нужным конечным точкам. Сейчас протестировать подключение можно только одним способом: с помощью веб-приложения или веб-задания, вызывающего нужную конечную точку. Такие инструменты, как ping или nslookup, пока не работают в консоли Kudu. Однако их поддержка будет добавлена в ближайшем будущем.

## Подключение к уже существующей сети ##
Чтобы подключить веб-приложение к виртуальной сети, откройте его колонку и в разделе "Сеть" щелкните плитку "Виртуальная сеть", а затем выберите одну из уже существующих виртуальных сетей.

![](./media/web-sites-integrate-with-vnet/connect-to-existing-vnet.png)
 
Если это первое веб-приложение в вашей подписке, которое подключается к этой сети, система создаст сертификат для проверки подлинности в виртуальной сети. Чтобы просмотреть сертификат, перейдите в раздел "Виртуальные сети" на [портале Azure](http://go.microsoft.com/fwlink/?LinkId=529715), выберите сеть и откройте вкладку "Сертификаты".

На рисунке выше вы видите сеть cantConnectVnet, которая выделена серым и недоступна для выбора. Такое состояние сети возможно только в двух случаях: в сети не активировано подключение VPN типа "точка-сеть" или для шлюза в виртуальной сети не настроена динамическая маршрутизация. Выполнив оба условия, можно выбрать эту виртуальную сеть для интеграции со своим веб-приложением.

## Создание виртуальной сети и подключение к ней ##
Помимо подключения к существующей виртуальной сети, можно также создать новую виртуальную сеть через пользовательский интерфейс портала Azure и автоматически подключаться к ней. Для этого перейдите к раздел Virtual Network (Виртуальная сеть), следуя описанным выше инструкциям, и выберите пункт Create new virtual network (Создать виртуальную сеть). В открывшемся окне вы можете присвоить новой сети имя, указать адресное пространство, а также задать адреса для DNS-серверов, которые будут использоваться виртуальной сетью.

![](./media/web-sites-integrate-with-vnet/create-new-vnet.png)
 
Создание виртуальной сети и настройка шлюзов могут занять до 30 минут. В это время будет отображаться сообщение о том, что идет подготовка сети:

![](./media/web-sites-integrate-with-vnet/new-vnet-progress.png)

Как только будет установлено подключение веб-приложения к виртуальной сети, у него появится доступ к ее ресурсам по протоколу TCP или UDP. Если вы хотите обращаться к ресурсам в своей локальной системе, доступной через подключение VPN типа "сеть-сеть" к виртуальной сети, добавьте маршруты в свою корпоративную сеть. Они будут перенаправлять трафик из вашей сети на адреса типа "точка-сеть", настроенные в виртуальной сети.

После успешной настройки интеграции на портале Azure будут отображены базовые сведения о подключении. Кроме того, появятся такие возможности, как отключение веб-приложения от сети и синхронизация сертификатов, используемых для проверки подлинности подключения. Синхронизация может потребоваться, если сертификат просрочен или отозван.

![](./media/web-sites-integrate-with-vnet/vnet-status-portal.png)

##Управление подключением к виртуальной сети##
Вы можете просмотреть список всех виртуальных сетей, связанных с веб-приложениями в плане обслуживания, в колонке соответствующего плана. С планом обслуживания приложений категории Standard можно связать до пяти сетей.

При переходе на план обслуживания более низкого уровня, например Free, Shared или Basic, подключения веб-приложений к виртуальным сетям отключаются. При возврате к плану "Стандартный" эти подключения к сети возобновляют свою работу.

На данный момент в Azure невозможно переместить уже существующую виртуальную машину в виртуальную сеть. Виртуальная машина должна быть изначально подготовлена в виртуальной сети в ходе ее создания.

## Доступ к локальным ресурсам ##
При работе с виртуальной сетью, в которой настроено подключение VPN типа "сеть-сеть", необходимо выполнить дополнительное действие, чтобы предоставить вашему веб-приложению доступ к локальным ресурсам. В локальную сеть нужно добавить маршруты, которые будут перенаправлять трафик из нее на адреса типа "точка-сеть", настроенные в виртуальной сети. Чтобы просмотреть свой диапазон IP-адресов для подключения типа "точка-сеть", перейдите в раздел "Сеть" на портале Azure, как показано ниже.

![](./media/web-sites-integrate-with-vnet/vpn-to-onpremise.png)

## Сертификаты ##
Чтобы установить безопасное соединение с виртуальной сетью, требуется обмен сертификатами. На текущем портале сети можно просмотреть отпечаток общего сертификата, создаваемого веб-приложениями.

![](./media/web-sites-integrate-with-vnet/vpn-to-onpremise-certificate.png)

Если по какой-либо причине сертификаты не синхронизированы (например, из-за их случайного удаления с портала сети), подключение разрывается. Чтобы устранить эту проблему и восстановить подключение, воспользуйтесь командой "Синхронизировать подключение" в интерфейсе виртуальной сети веб-приложений.

Кроме того, это действие необходимо выполнить, если вы добавили DNS-сервер в виртуальную сеть или настроили к ней подключение через VPN типа "сайт-сайт".

![](./media/web-sites-integrate-with-vnet/vnet-sync-connection.png)

## Сравнение с гибридными подключениями ##
Веб-приложения также поддерживают гибридные подключения — эта функция отчасти похожа на интеграцию виртуальной сети. Эти возможности иногда используются в сходных случаях, однако они не заменяют друг друга. Гибридные подключения позволяют взаимодействовать с несколькими конечными точками приложений в различных сетях. В свою очередь, функция виртуальных сетей дает возможность подключить веб-приложение к виртуальной сети, которая может быть подключена к локальной сети. Это удобно, если все ресурсы находятся в области действия данной сети.

Еще одно различие состоит в том, что для работы гибридных подключений необходимо установить агент ретрансляции. Он должен работать в экземпляре сервера Windows Server. Для функции виртуальных сетей не нужно ничего устанавливать. При этом она обеспечивает доступ к удаленным ресурсам независимо от того, какие операционные системы установлены на физических компьютерах.

Кроме того, на сегодняшний день эти функции доступны в разных ценовых категориях. Это связано с тем, что гибридные подключения, доступные на уровнях с самыми низкими ценами, особенно полезны при разработке и тестировании и предоставляют доступ только к небольшому числу конечных точек. Функция виртуальных сетей предоставляет доступ ко всем ресурсам, содержащимся в виртуальной сети или подключенным к ней.

>[AZURE.NOTE]Чтобы приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.

## Изменения
* Указания по изменениям при переходе от веб-сайтов к службе приложений см. в разделе [Служба приложений Azure и ее влияние на существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714).
* Руководство по смене старого портала на новый портал см. в разделе [Справочник по навигации на предварительной версии портала](http://go.microsoft.com/fwlink/?LinkId=529715).
 

<!---HONumber=August15_HO7-->