<properties
	pageTitle="Настройка PHP в веб-приложениях службы приложений Azure"
	description="Узнайте, как настроить установку PHP по умолчанию или добавить пользовательскую установку PHP для веб-приложений в службе приложений Azure."
	services="app-service\web"
	documentationCenter="php"
	authors="tfitzmac"
	manager="wpickett"
	editor=""/>

<tags
	ms.service="app-service"
	ms.workload="web"
	ms.tgt_pltfrm="na"
	ms.devlang="PHP"
	ms.topic="article"
	ms.date="09/16/2015"
	ms.author="tomfitz"/>

#Настройка PHP в веб-приложениях службы приложений Azure

## Введение

В этом руководстве показано, как настроить встроенную среду выполнения PHP в веб-приложениях [службы приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714), предоставить настраиваемую среду выполнения PHP и включить расширения. Чтобы использовать службу приложений, подпишитесь на [бесплатную пробную версию]. Чтобы это руководство было для вас максимально эффективным, необходимо сначала создать веб-приложение PHP в службе приложений.

[AZURE.INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## Практическое руководство. Изменение встроенной версии PHP
По умолчанию при создании веб-приложения службы приложений устанавливается среда PHP 5.4, которая будет сразу готова для использования. Оптимальный способ увидеть доступные версии, конфигурацию по умолчанию и поддерживаемые расширения заключается в развертывании сценария, который вызывает функцию [phpinfo()].

Версии PHP 5.5 и PHP 5.6 также доступны, но не включены по умолчанию. Чтобы обновить версию PHP, выполните следующие действия.

### Портал Azure

1. Перейдите к своему веб-приложению на [портале Azure](http://go.microsoft.com/fwlink/?LinkId=529715) и нажмите кнопку **Параметры**.

	![Параметры веб-приложения][settings-button]

2. В колонке **Параметры** откройте **Параметры приложения** и выберите новую версию PHP.

    ![Параметры приложения][application-settings]

3. Нажмите кнопку **Сохранить** в верхней части колонки **Параметры веб-приложения**.

	![Сохранение параметров конфигурации][save-button]

### Azure PowerShell (только для Windows)

1. Откройте Windows PowerShell
2. Введите `Set-AzureWebsite -PhpVersion [5.4 | 5.5 | 5.6] -Name <site-name>` и нажмите клавишу "ВВОД".
3. После этого версия PHP будет установлена.

	![Задание версии PHP с помощью Azure PowerShell][SETPHPVERPS]
4. Чтобы подтвердить параметры, введите `Get-AzureWebiste -Name <site-name>` и нажмите клавишу "ВВОД".

	![Проверка версии PHP с помощью Azure PowerShell][GETPHPVERPS]

### Интерфейс командной строки Azure для Mac, Linux и Windows

Для использования интерфейса командной строки Azure требуется установить на компьютер **Node.js**.

1. Откройте терминал.
2. Введите `azure site set --php-version [5.4 | 5.5] [site-name]` и нажмите клавишу "ВВОД".
3. После этого версия PHP будет установлена.

	![Задание версии PHP с помощью интерфейса командной строки Azure][SETPHPVERCLI]
4. Чтобы подтвердить параметры, введите `azure site show [site-name]` и нажмите клавишу "ВВОД".

	![Проверка версии PHP с помощью интерфейса командной строки Azure][GETPHPVERCLI]

## Практическое руководство. Изменение встроенной конфигурации PHP

Для любой встроенной среды выполнения PHP можно изменить параметры конфигурации, для чего выполните следующие действия. (Дополнительные сведения о директивах php.ini см. в разделе [Список директив php.ini].)

### Изменение параметров конфигурации PHP\_INI\_USER, PHP\_INI\_PERDIR, PHP\_INI\_ALL

1. Добавьте файл [.user.ini] в корневой каталог.
2. Добавьте параметры конфигурации в файл `.user.ini`, используя тот же синтаксис, что и для файла `php.ini`. Например, чтобы включить параметр `display_errors` и установить для параметра `upload_max_filesize` значение 10 М, в файле `.user.ini` будет указан следующий текст:

		; Example Settings
		display_errors=On
		upload_max_filesize=10M

3. Разверните веб-приложение.
4. Перезапустите веб-приложение. (Перезапуск необходим, так как частота считывания PHP файлов `.user.ini` регулируется параметром `user_ini.cache_ttl`, который является параметром уровня системы; по умолчанию значение этого параметра составляет 300 секунд (5 минут). Перезапуск веб-приложения заставляет PHP считать новые параметры из файла `.user.ini`.)

В качестве альтернативы использованию файла `.user.ini` можно использовать функцию [ini\_set()] в скрипте для установки параметров конфигурации, не являющихся директивами системного уровня.

### Изменение параметров конфигурации PHP\_INI\_SYSTEM

1. Добавьте параметр приложения для веб-приложения с помощью ключа `PHP_INI_SCAN_DIR` и значения `d:\home\site\ini`
2. Создайте файл `settings.ini` с помощью консоли Kudu (http://&lt;site-name&gt;.scm.azurewebsite.net) в каталоге `d:\home\site\ini`.
3. Добавьте параметры конфигурации в файл `settings.ini`, используя тот же синтаксис, что и для файла php.ini. Например, если необходимо, чтобы параметр `curl.cainfo` указывал на файл `*.crt`, а параметр wincache.maxfilesize имел значение 512K, файл `settings.ini` должен содержать следующий текст:

		; Example Settings
		curl.cainfo="%ProgramFiles(x86)%\Git\bin\curl-ca-bundle.crt"
		wincache.maxfilesize=512
4. Перезапустите веб-приложение для загрузки изменений.

## Практическое руководство. Включение расширений в среде выполнения PHP по умолчанию
Как было отмечено в предыдущем разделе, оптимальный способ увидеть версию PHP по умолчанию, конфигурацию по умолчанию и поддерживаемые расширения заключается в развертывании сценария, который вызывает функцию [phpinfo()]. Чтобы включить дополнительные расширения, выполните следующие действия.

### Настройка с помощью параметров ini

1. Добавьте каталог `ext` в каталог `d:\home\site`.
2. Поместите файлы с расширением `.dll` в каталог `ext` (например, `php_mongo.dll` и `php_xdebug.dll`). Убедитесь, что расширения совместимы с версией PHP по умолчанию (на момент написания этого учебника в качестве версии по умолчанию используется PHP 5.4), а также совместимы с VC9 и непотокобезопасной технологией (nts).
3. Добавьте параметр приложения для веб-приложения с помощью ключа `PHP_INI_SCAN_DIR` и значения `d:\home\site\ini`
4. Создайте файл `ini` в `d:\home\site\ini` с именем `extensions.ini`.
5. Добавьте параметры конфигурации в файл `extensions.ini`, используя тот же синтаксис, что и для файла php.ini. Например, чтобы включить расширения MongoDB и XDebug, файл `extensions.ini` должен содержать следующий текст:

		; Enable Extensions
		extension=d:\home\site\ext\php_mongo.dll
		zend_extension=d:\home\site\ext\php_xdebug.dll
6. Перезапустите веб-приложение для загрузки изменений.

### Настройка с помощью параметров приложения

1. Добавьте каталог `bin` в корневой каталог.
2. Поместите файлы с расширением `.dll` в каталог `bin` (например, `php_mongo.dll`). Убедитесь, что расширения совместимы с версией PHP по умолчанию (на момент написания этого учебника в качестве версии по умолчанию используется PHP 5.4), а также совместимы с VC9 и непотокобезопасной технологией (nts).
3. Разверните веб-приложение.
4. Перейдите к своему веб-приложению на портале Azure и нажмите кнопку **Параметры**.

	![Параметры веб-приложения][settings-button]

5. В колонке **Параметры** откройте **Параметры приложения** и выполните прокрутку к разделу **Параметры приложения**.
6. В разделе **Параметры приложения** создайте ключ **PHP\_EXTENSIONS**. Значением для этого ключа будет путь относительно корневого веб-сайта: **bin\\ваш-внешний-файл**.

	![Включение расширения в параметрах приложения][php-extensions]

7. Нажмите кнопку **Сохранить** в верхней части колонки **Параметры веб-приложения**.

	![Сохранение параметров конфигурации][save-button]

Расширения Zend также поддерживаются с помощью ключа **PHP\_ZENDEXTENSIONS**. Чтобы включить несколько расширений, включите список разделенных запятыми файлов `.dll` для значения параметра приложения.


## Практическое руководство. Настраиваемая среда выполнения PHP
Вместо среды выполнения PHP по умолчанию веб-приложения службы приложений могут использовать среду выполнения PHP, предоставляемую для выполнения скриптов PHP. Предоставляемую среду выполнения можно настроить с помощью файла `php.ini`, также предоставляемого пользователем. Чтобы использовать настраиваемую среду выполнения PHP с веб-приложениями, выполните следующие действия.

1. Получите версию PHP для Windows, совместимую с VC9 или VC11 и непотокобезопасной технологией (nts). Последние версии PHP для Windows можно найти здесь: [http://windows.php.net/download/]. Более старые версии можно найти в архиве здесь: [http://windows.php.net/downloads/releases/archives/].
2. Измените файл `php.ini` для среды выполнения. Обратите внимание, что все параметры конфигурации, являющиеся директивами system-level-only, не будут учитываться веб-приложениями. (Дополнительные сведения о директивах только системного уровня см. в разделе [Список директив php.ini].)
3. При необходимости добавьте расширения для вашей среды выполнения PHP и включите их в файл `php.ini`.
4. Добавьте каталог `bin` в корневой каталог и поместите в него каталог, в котором содержится ваша среда выполнения PHP (например, `bin\php`).
5. Разверните веб-приложение.
4. Перейдите к своему веб-приложению на портале Azure и нажмите кнопку **Параметры**.

	![Параметры веб-приложения][settings-button]

7. В колонке **Параметры** откройте **Параметры приложения** и выполните прокрутку к разделу **Сопоставление обработчиков**. Добавьте расширение `*.php` в поле "Расширение" и путь к исполняемому файлу `php-cgi.exe`. Если поместить среду выполнения PHP в каталог `bin` в корневом каталоге приложения, путь будет выглядеть так: `D:\home\site\wwwroot\bin\php\php-cgi.exe`.

	![Укажите обработчик в сопоставлении обработчика][handler-mappings]

8. Нажмите кнопку **Сохранить** в верхней части колонки **Параметры веб-приложения**.

	![Сохранение параметров конфигурации][save-button]

## Дальнейшие действия

Дополнительные сведения можно найти в [Центре разработчика PHP](/develop/php/).

>[AZURE.NOTE]Чтобы приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.

## Изменения
* Указания по изменениям при переходе от веб-сайтов к службе приложений см. в разделе [Служба приложений Azure и ее влияние на существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714).
* Руководство по смене старого портала на новый портал см. в разделе [Справочник по навигации на предварительной версии портала](http://go.microsoft.com/fwlink/?LinkId=529715).

[бесплатную пробную версию]: https://www.windowsazure.com/pricing/free-trial/
[phpinfo()]: http://php.net/manual/en/function.phpinfo.php
[select-php-version]: ./media/web-sites-php-configure/select-php-version.png
[Список директив php.ini]: http://www.php.net/manual/en/ini.list.php
[.user.ini]: http://www.php.net/manual/en/configuration.file.per-user.php
[ini\_set()]: http://www.php.net/manual/en/function.ini-set.php
[application-settings]: ./media/web-sites-php-configure/application-settings.png
[settings-button]: ./media/web-sites-php-configure/settings-button.png
[save-button]: ./media/web-sites-php-configure/save-button.png
[php-extensions]: ./media/web-sites-php-configure/php-extensions.png
[handler-mappings]: ./media/web-sites-php-configure/handler-mappings.png
[http://windows.php.net/download/]: http://windows.php.net/download/
[http://windows.php.net/downloads/releases/archives/]: http://windows.php.net/downloads/releases/archives/
[SETPHPVERCLI]: ./media/web-sites-php-configure/ChangePHPVersion-XPlatCLI.png
[GETPHPVERCLI]: ./media/web-sites-php-configure/ShowPHPVersion-XplatCLI.png
[SETPHPVERPS]: ./media/web-sites-php-configure/ChangePHPVersion-PS.png
[GETPHPVERPS]: ./media/web-sites-php-configure/ShowPHPVersion-PS.png
 

<!---HONumber=Oct15_HO1-->