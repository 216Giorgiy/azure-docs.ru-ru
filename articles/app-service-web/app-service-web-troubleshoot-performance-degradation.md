<properties pageTitle="Низкая производительность веб-приложения в службе приложений | Microsoft Azure" description="Эта статья поможет устранить причины низкой производительности веб-приложения в службе приложений Azure." services="app-service\\web" documentationCenter="" authors="cephalin" manager="wpickett" editor="" tags="top-support-issue keywords="производтельность веб-приложения, медленное приложение, приложение медленно работает"/>

<tags
	ms.service="app-service-web"
	ms.workload="web"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="07/06/2016"
	ms.author="cephalin"/>

# Устранение причин низкой производительности веб-приложения в службе приложений Azure

Эта статья поможет устранить причины снижения производительности веб-приложения, размещенного в [службе приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714).

Если вам потребуется дополнительная помощь по любому из вопросов, рассматриваемых в статье, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт службы поддержки Azure](https://azure.microsoft.com/support/options/) и щелкните **Поддержка**.

## Симптом

При обращении к веб-приложению загрузка страницы идет медленно и может прерваться, превысив время ожидания.

## Причина:

Эта проблема часто связана с проблемами на уровне приложения, например:

-	слишком долгое выполнение запросов;
-	слишком высокие требования приложения к памяти и процессору;
-	сбой приложения из-за исключения.

## Действия по устранению неполадок

Процесс устранения неполадок можно разделить на три последовательных задачи.

1.	[Наблюдение за поведением приложения.](#observe)
2.	[Сбор данных.](#collect)
3.	[Устранение проблемы.](#mitigate)

[Веб-приложения службы приложений](/services/app-service/web/) содержат несколько инструментов для каждого из этих этапов.

<a name="observe" />
### 1\. Наблюдение за поведением приложения

#### Мониторинг работоспособности службы

Microsoft Azure информирует о каждом случае прерывания работы или снижения производительности службы. Можно следить за работоспособностью службы на [портале Azure](https://portal.azure.com/). Дополнительные сведения см. в статье [Мониторинг работоспособности службы](../azure-portal/insights-service-health.md).

#### Мониторинг веб-приложения

Этот инструмент позволяет определить наличие проблем с приложением. В колонке веб-приложения щелкните элемент **Запросы и ошибки**. Колонка **Метрика** содержит все метрики, которые вы можете добавить.

Некоторые из этих метрик помогут вам отслеживать работу веб-приложения, например:

-	средний размер рабочего набора памяти;
-	Average response time (Среднее время ответа)
-	время ЦП;
-	рабочий набор памяти;
-	Requests (Запросы)

![Мониторинг производительности веб-приложения](./media/app-service-web-troubleshoot-performance-degradation/1-monitor-metrics.png)

Дополнительные сведения см. в следующих статьях:

-	[Мониторинг веб-приложений в службе приложений Azure](web-sites-monitor.md)
-	[Получение уведомлений об оповещениях](../azure-portal/insights-receive-alert-notifications.md)

#### Мониторинг состояния конечной веб-точки

Если вы запускаете веб-приложение с ценовым уровнем **Стандартный**, веб-приложение позволяет отслеживать 2 конечных точки из 3 географических местоположений.

Функция мониторинга конечных точек настраивает веб-тесты из географически распределенных местоположений, позволяя проверить время ответа и время непрерывной работы URL-адресов. Тест выполняет операцию HTTP GET для URL-адреса веб-приложения и определяет время ответа и время непрерывной работы для каждого местоположения. Для каждого настроенного расположения тест выполняется каждые пять минут.

Время непрерывной работы контролируется при помощи кодов ответов HTTP, а время ответа измеряется в миллисекундах. Тест завершается с ошибкой, если код ответа HTTP больше или равен 400 или если на ответ требуется более 30 секунд. Конечная точка считается доступной, если тесты мониторинга завершились для нее успешно для всех указанных расположений.

Настройка описана в статье [Практическое руководство. Мониторинг состояния конечной веб-точки](web-sites-monitor.md#webendpointstatus).

Кроме того, вы можете посмотреть видео, посвященное контролю конечных точек: [Поддержка работы веб-сайтов Azure с помощью мониторинга конечных точек (со Стефаном Щаковым ((Stefan Schackow))](/documentation/videos/azure-web-sites-endpoint-monitoring-and-staying-up/).

#### Контроль производительности приложений с помощью расширений

Вы можете отслеживать производительность приложения через _расширения сайта_.

Каждое веб-приложение службы приложений дает возможность пользоваться расширяемой конечной точкой, которая позволяет использовать набор мощных средств, развернутых в виде расширений сайта. К этим средствам относятся как редакторы исходного кода, например [Visual Studio Team Services](https://www.visualstudio.com/products/what-is-visual-studio-online-vs.aspx), так и средства управления для связанных ресурсов, например подключенные к веб-приложению базы данных MySQL.

Для контроля производительности можно использовать расширения [Azure Application Insights](/services/application-insights/) и [New Relic](/marketplace/partners/newrelic/newrelic/). Чтобы использовать New Relic, необходимо установить агент в среде выполнения. Чтобы использовать Application Insights, перестройте код с помощью пакета SDK. Кроме того, вы можете установить расширение для доступа к дополнительным данным. Пакет SDK позволяет писать код для более подробного отслеживания использования и производительности приложения.

Использование Application Insights описано в статье [Отслеживание производительности в веб-приложениях](../application-insights/app-insights-web-monitor-performance.md).

Использование New Relic описано в статье [Инструмент управления производительностью приложений New Relic для Azure](../store-new-relic-cloud-services-dotnet-application-performance-management.md).

<a name="collect" />
### 2\. Сбор данных

####	Включите ведение журнала диагностики для своего веб-приложения

Среда веб-приложений содержит функции диагностики, которые позволяют сохранять в журналы информацию от веб-сервера и веб-приложения. Используется следующее логическое разделение: диагностика веб-сервера и диагностика приложений.

##### Диагностика веб-сервера

Вы можете включить или отключить такие виды журналов:

-	**Подробное ведение журнала ошибок** — регистрация подробной информации об ошибке для кодов состояния HTTP, которые указывают на сбой (код состояния 400 и выше). Здесь могут содержаться сведения, которые помогут определить причину, по которой сервер вернул код ошибки.
-	**Трассировка неудачно завершенных запросов** — регистрация подробной информации о неудачных запросах, включая трассировку компонентов IIS для обработки запроса и время каждого компонента. Это может быть полезно, если вы пытаетесь повысить производительность веб-приложения или определить причину конкретной ошибки HTTP.
-	**Журналы веб-сервера** — регистрация сведений о HTTP-транзакциях в расширенном формате файла журнала W3C. Это удобно при определении общих показателей веб-приложения, например количества обработанных запросов или количества запросов с определенного IP-адреса.

##### Диагностика приложения

Диагностика приложений позволяет собирать сведения, созданные веб-приложениями. Приложения ASP.NET могут использовать класс `System.Diagnostics.Trace` для записи информации в журнал диагностики приложений.

Подробные инструкции по настройке приложения для ведения журнала вы можете изучить в статье [Включение ведения журнала диагностики для веб-приложений в службе приложений Azure](web-sites-enable-diagnostic-log.md).

#### Используйте удаленное профилирование

Служба приложений Azure позволяет удаленно профилировать веб-приложения, интерфейсные приложения и веб-задания. Если процесс выполняется медленнее, чем вы ожидали, если задержки ответов на HTTP-запросы выше обычных или если процесс использует слишком много процессорного времени, вы можете удаленно профилировать такой процесс. Вы получите выборку стеков обращений к ЦП, по которой можно выполнить анализ действий процесса и критических путей в программном коде.

Подробнее об этом расскажет статья [Поддержка удаленного профилирования в службе приложений Azure](/blog/remote-profiling-support-in-azure-app-service).


#### Используйте портал поддержки службы приложений Azure

Веб-приложения позволяют вам просматривать HTTP-журналы, журналы событий, дампы процессов и другую информацию для диагностики неполадок, связанных с вашим приложением. Эту информацию вы сможете найти на нашем портале поддержки по адресу **http://&lt;your имя приложения>.scm.azurewebsites.net/Support**

На портале поддержки службы приложений Azure вы увидите три отдельные вкладки, соответствующие трем этапам стандартного процесса устранения неполадок.

1.	Наблюдение за поведением.
2.	Сбор диагностических данных и запуск встроенных средств анализа.
3.	Устранение неполадки.

Если проблема происходит прямо сейчас, щелкните **Анализ** > **Диагностика** > **Запустить диагностику**. Так вы создадите сеанс диагностики, в ходе которого будут собираться HTTP-журналы, журналы просмотра событий, дампы памяти, журналы ошибок PHP и отчеты процесса PHP.

После сбора данных будет выполнен их анализ и создан отчет в формате HTML.

Вы также можете загрузить собранные данные на свой компьютер. По умолчанию они сохраняются в папке D:\\home\\data\\DaaS.

Дополнительные сведения о возможностях портала поддержки службы приложений Azure см. в статье [Обновления веб-сайтов Azure для поддержки расширения сайта](/blog/new-updates-to-support-site-extension-for-azure-websites).

#### Использование консоли отладки Kudu

Веб-приложения оснащены консолью отладки, с помощью которой вы можете получать сведения о среде, используя функции отладки, изучения, передачи файлов и конечных точек JSON. Она называется _консолью Kudu_ или _панелью SCM_ вашего приложения.

Вы можете открыть эту панель по ссылке **https://&lt;Your имя приложения>.scm.azurewebsites.net/**.

Вот некоторые возможности консоли Kudu:

-	настройки среды для вашего приложения;
-	потоковая передача журналов;
-	диагностический дамп;
-	консоль отладки с возможностью запуска командлетов Powershell и основных команд DOS.


У консоли Kudu есть еще одна очень полезная функция. Если приложение создает обрабатываемые исключения, с помощью консоли Kudu и средства SysInternals Procdump вы можете получать дампы памяти. Эти дампы представляют собой снимок процессов, выполняемых в момент создания исключения. Вы можете использовать эти данные при анализе сложных проблем в веб-приложении.

Дополнительные сведения о возможностях консоли Kudu см. в разделе [Средства Team Services веб-сайтов Azure, о которых вам нужно знать](/blog/windows-azure-websites-online-tools-you-should-know-about/).

<a name="mitigate" />
### 3\. Устранение проблемы

####	Масштабирование веб-приложения

В службе приложений Azure вы можете изменять масштаб выполнения приложения, чтобы увеличить его производительность и пропускную способность. Масштабирование веб-приложений предполагает два связанных действия: изменение ценовой категории для используемого плана службы приложений на более высокую с последующей настройкой некоторых параметров.

Дополнительные сведения о масштабировании см. в статье [Масштабирование веб-приложения в службе приложений Azure](web-sites-scale.md).

Кроме того, вы можете запустить более одного экземпляра приложения. Это не только увеличит возможности обработки, но и повысит устойчивость приложения к сбоям. Если прекратит работу один экземпляр приложения, другой экземпляр продолжит обрабатывать запросы.

Вы можете выбрать ручной или автоматический режим масштабирования.

####	Использование функции AutoHeal

Функция AutoHeal перезапускает рабочий процесс вашего приложения при определенных условиях, которые вы определяете в настройках (например, при изменении конфигурации, при определенном количестве запросов, при достижении ограничений памяти или времени выполнения запроса). В большинстве случаев повторный запуск процесса будет самым быстрым способом устранения проблемы. Хотя веб-приложение всегда можно вручную перезапустить на портале Azure, функция AutoHeal позволяет выполнять перезапуск автоматически. Для этого достаточно добавить в корневой файл web.config вашего веб-приложения некоторые триггеры. Эти параметры одинаково работают во всех приложениях, а не только в приложениях .NET.

Дополнительные сведения см. в разделе [Автоматическое восстановление веб-сайтов Microsoft Azure](/blog/auto-healing-windows-azure-web-sites/).

####	Перезапуск веб-приложения

Обычно это самый простой способ восстановления после проблемы, которая возникла один раз. Остановить или перезапустить приложение можно при помощи колонки веб-приложения на [портале Azure](https://portal.azure.com/).

 ![Перезапуск веб-приложение для устранения проблем с производительностью](./media/app-service-web-troubleshoot-performance-degradation/2-restart.png)

Управлять приложениями можно также с помощью Azure Powershell. Дополнительные сведения см. в статье [Использование Azure PowerShell с диспетчером ресурсов Azure](../powershell-azure-resource-manager.md).

<!---HONumber=AcomDC_0713_2016-->