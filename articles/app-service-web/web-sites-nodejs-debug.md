<properties
	pageTitle="Отладка веб-приложения Node.js в службе приложений Azure"
	description="Подробнее об отладке веб-приложения Node.js в службе приложений Azure."
	tags="azure-portal"
	services="app-service\web"
	documentationCenter="nodejs"
	authors="MikeWasson"
	manager="wpickett"
	editor="mollybos"/>

<tags
	ms.service="app-service-web"
	ms.workload="web"
	ms.tgt_pltfrm="na"
	ms.devlang="nodejs"
	ms.topic="article"
	ms.date="04/23/2015"
	ms.author="mwasson"/>

# Отладка веб-приложения Node.js в службе приложений Azure

Azure предоставляет встроенные средства диагностики, которые помогают отлаживать приложения Node.js, размещенные в веб-приложениях [службы приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714). В этой статье вы узнаете, как включить ведение журналов stdout и stderr, отображать сведения об ошибке в браузере, а также загружать и просматривать файлы журнала.

Диагностика для приложений Node.js, размещенных в Azure, обеспечивается [IISNode]. Хотя в данной статье рассматриваются наиболее общие параметры для сбора диагностических сведений, она не является полным справочником по работе с IISNode. Дополнительные сведения о работе с IISNode см. в разделе [Справка по IISNode] на GitHub.

<a id="enablelogging"></a>
## Включение ведения журналов

По умолчанию веб-приложения службы приложений записывают только диагностические сведения о развертывании, например при развертывании веб-приложения с использованием Git. Эта информация полезна при возникновении проблем во время развертывания, таких как сбой при установке модуля, на который ссылается файл **package.json**, или при использовании пользовательских сценариев развертывания.

Чтобы включить ведение журнала для потоков stdout и stderr, необходимо создать файл **IISNode.yml** в корне приложения Node.js и добавить следующий код:

	loggingEnabled: true

Это обеспечивает ведение журнала для потоков stderr и stdout из приложения Node.js.

Файл **IISNode.yml** может также использоваться для управления возвратом понятных пользователю ошибок или ошибок разработчика в браузер при сбое. Чтобы включить вывод ошибок разработчика, добавьте в файл **IISNode.yml** следующую строку:

	devErrorsEnabled: true

После включения этого параметра IISNode будет возвращать последние 64 КБ данных, отправленных в stderr, вместо понятного пользователю сообщения об ошибке, такого как "Внутренняя ошибка сервера".

> [AZURE.NOTE]Хотя параметр devErrorsEnabled полезен при диагностике проблем во время разработки, его включение в рабочей среде может привести к тому, что конечному пользователю будут отправляться ошибки разработки.

Если файл **IISNode.yml** еще не существует в приложении, необходимо перезапустить веб-приложение после публикации обновленного приложения. При простом изменении настроек в существующем файле **IISNode.yml**, который ранее был опубликован, перезагрузка не требуется.

> [AZURE.NOTE]Если веб-приложение было создано с помощью средства командной строки Azure или командлетов PowerShell Azure, автоматически создается файл по умолчанию **IISNode.yml**.

Чтобы перезапустить веб-приложение, выберите веб-приложение на [портале предварительной версии Azure](https://portal.azure.com) и нажмите кнопку **ПЕРЕЗАПУСТИТЬ**.

![кнопка перезагрузки][restart-button]

Если в среде разработки установлены средства командной строки Azure, чтобы перезапустить веб-приложение, можно воспользоваться следующей командой:

	azure site restart [sitename]

> [AZURE.NOTE]Параметры конфигурации LoggingEnabled и devErrorsEnabled нужны в IISNode.yml для сбора диагностических сведений, однако IISNode.yml можно использовать для настройки различных параметров среды размещения. Полный список параметров конфигурации см. в файле [iisnode_schema.xml](https://github.com/tjanczuk/iisnode/blob/master/src/config/iisnode_schema.xml).

<a id="viewlogs"></a>
## Доступ к журналам

Доступ к журналам диагностики может осуществляться тремя способами; с использованием протокола FTP (File Transfer), путем загрузки ZIP-архива или в режиме потока журнала с обновлением в реальном времени (также известного как заключительный фрагмент). Загрузка ZIP-архива файлов журналов или просмотр потока в режиме реального времени требует наличия средств командной строки Azure. Их можно установить с помощью следующей команды:

	npm install azure-cli -g

После установки доступ к данным средствам осуществляется с помощью команды "azure". Предварительно в средствах командной строки должно быть настроено использование подписки Azure. Информацию о том, как выполнить эту задачу, см. в разделе **Как скачать и импортировать настройки публикации** [Как использовать программы командной строки Azure].

###FTP

Чтобы получить доступ к диагностической информации через FTP, перейдите на [портал предварительной версии Azure](https://portal.azure.com), выберите свое веб-приложение, а затем **ПАНЕЛЬ МОНИТОРИНГА**. В разделе **быстрых ссылок** ссылки **ЖУРНАЛЫ ДИАГНОСТИКИ FTP** и **ЖУРНАЛЫ ДИАГНОСТИКИ FTPS** позволяют перейти к журналам с использованием протокола FTP.

> [AZURE.NOTE]Если имя пользователя и пароль для FTP или развертывания еще не указаны, это можно сделать на странице управления **QuickStart**, выбрав команду **Настройка учетных данных для развертывания**.

URL-адрес FTP, возвращаемый в панели мониторинга, относится к каталогу **LogFiles**, который будет содержать следующие вложенные папки:

* Метод развертывания. При использовании Git как метода развертывания будет создан одноименный каталог. Он будет содержать сведения, связанные с развертываниями.

* nodejs — данные Stdout и stderr, регистрируемые во всех экземплярах вашего приложения, если параметр loggingEnabled имеет значение true.

###ZIP-архив

Чтобы загрузить ZIP-архив журналов диагностики, выполните следующую команду в средствах командной строки Azure:

	azure site log download [sitename]

В результате в текущий каталог будет помещен файл **diagnostics.zip**. Данный архив содержит следующую структуру каталогов:

* deployments — журнал сведений о развертываниях вашего приложения.

* LogFiles

	* Метод развертывания. При использовании Git как метода развертывания будет создан одноименный каталог. Он будет содержать сведения, связанные с развертываниями.

	* nodejs — данные Stdout и stderr, регистрируемые во всех экземплярах вашего приложения, если параметр loggingEnabled имеет значение true.

###Поток в реальном времени (заключительный фрагмент)

Чтобы просмотреть поток журналов диагностики в реальном времени, выполните следующую команду в средствах командной строки Azure:

	azure site log tail [sitename]

В результате будет возвращен поток событий журнала, которые обновляются по мере их возникновения на сервере. Этот поток будет возвращать сведения о развертывании, а также сведения stdout и stderr (если параметр loggingEnabled имеет значение true).

<a id="nextsteps"></a>
## Дальнейшие действия

В этой статье было показано, как включить данные диагностики для Azure и получить к ним доступ. Хотя эта информация полезна для понимания проблем, возникающих в приложении, она может указывать на проблему с используемым модулем или на то, что версия Node.js, используемая веб-приложениями службы приложений, отличается от версии в среде развертывания.

Сведения по работе с модулями Azure см. в разделе [Использование модулей Node.js с приложениями Azure].

Сведения об определении версии Node.js для своего приложения см. в разделе [Установка версии Node.js в приложении Azure].

## Изменения
* Указания по изменениям при переходе от веб-сайтов к службе приложений см. в разделе [Служба приложений Azure и ее влияние на существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714).
* Руководство по смене старого портала на новый см. в статье [Краткий справочник по навигации на портале Azure](http://go.microsoft.com/fwlink/?LinkId=529715).

>[AZURE.NOTE]Если вы хотите приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.

[IISNode]: https://github.com/tjanczuk/iisnode
[Справка по IISNode]: https://github.com/tjanczuk/iisnode#readme
[How to Use The Azure Command-Line Interface]: ../xplat-cli.md
[Использование модулей Node.js с приложениями Azure]: ../nodejs-use-node-modules-azure-apps.md
[Установка версии Node.js в приложении Azure]: ../nodejs-specify-node-version-azure-apps.md

[restart-button]: ./media/web-sites-nodejs-debug/restartbutton.png
 

<!---HONumber=July15_HO4-->