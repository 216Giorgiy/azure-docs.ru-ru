<properties 
	pageTitle="Миграция сайта Drupal в службу приложений Azure" 
	description="Миграция сайта Drupal на PHP в службу приложений Azure." 
	services="app-service\web" 
	documentationCenter="php" 
	authors="tfitzmac" 
	manager="wpickett" 
	editor="mollybos"/>

<tags 
	ms.service="app-service-web" 
	ms.workload="web" 
	ms.tgt_pltfrm="na" 
	ms.devlang="PHP" 
	ms.topic="article" 
	ms.date="04/29/2015" 
	ms.author="tomfitz"/>


# Миграция сайта Drupal в службу приложений Azure

Поскольку служба приложений Azure поддерживает PHP и MySQL, миграция сайта Drupal в веб-приложения службы приложений Azure выполняется относительно просто. И поскольку Drupal и PHP работают на любой платформе, данный процесс подходит для перемещения Drupal в веб-приложения службы приложений Azure независимо от используемой платформы. Учитывая это, установки Drupal могут значительно отличаться друг от друга, поэтому возможно наличие некоторых уникальных этапов миграции, которые не рассматриваются в приведенном ниже материале. Обратите внимание, что средство Drush не используется, так как оно не поддерживается в веб-службе Azure.

При перемещении большого и сложного приложения Drupal можно также рассмотреть использование облачных служб Azure. Дополнительную информацию о различиях между службой приложений и облачными службами см. в статье <a href="http://go.microsoft.com/fwlink/?LinkId=310123">Сравнение службы приложений, облачных служб и виртуальных машин Azure</a>. Справку по перемещению Drupal в облачные службы см. в статье <a href="http://blogs.msdn.com/b/brian_swan/archive/2012/03/19/azure-real-world-migrating-drupal-from-lamp-to-windows-azure.aspx">Миграция сайта Drupal из LAMP в Azure</a>.
 
## Создание веб-приложения и базы данных MySQL

Во-первых, изучите пошаговое руководство, чтобы узнать, как создать новое веб-приложение с использованием MySQL: [Создание веб-приложения PHP-MySQL в службе приложений Azure и его развертывание с помощью Git][]. Если вы планируете использовать Git для публикации сайта Drupal, то выполните действия из учебника, где объясняется, как настроить репозиторий Git. Обязательно следуйте инструкциям из раздела **Получение сведений об удаленном подключении к MySQL**, так как эта информация потребуется вам позже. Вы можете пропустить оставшуюся часть учебника, если интересуетесь исключительно развертыванием сайта Drupal, но если вы впервые столкнулись со службой приложений Azure (и Git), эта информация может оказаться полезной для вас.

После настройки нового веб-приложения с базой данных MySQL вы получаете данные о подключении к базе данных MySQL и (необязательно) репозиторий Git. Теперь вам необходимо скопировать свою базу данных в базу данных MySQL веб-приложения.

## Копирование базы данных в базу данных MySQL веб-приложения

Есть множество способов миграции базы данных в Azure. Один из способов, который хорошо подходит для баз данных MySQL, заключается в использовании средства MySqlDump. Следующая команда представляет собой пример того, как выполнить копирование с локального компьютера в службу приложений Azure:

    mysqldump -u local_username --password=local_password  drupal | mysql -h remote_host -u remote_username --password=remote_password remote_db_name

Конечно, необходимо предоставить имя пользователя и пароль для существующей базы данных Drupal. Необходимо также предоставить имя узла, имя пользователя, пароль и имя базы данных для базы данных MySQL, созданной в первом шаге. Эта информация присутствует в собранных ранее сведениях строки подключения. Строка подключения должна иметь формат, аналогичный следующей строке:

    Database=remote_db_name;Data Source=remote_host;User Id=remote_username;Password=remote_password

В зависимости от размера базы данных процесс копирования может занять несколько минут.

Теперь база данных Drupal находится в службе приложений Azure. Перед развертыванием кода Drupal необходимо изменить его, чтобы позволить ему подключаться к новой базе данных.

## Изменение сведений о подключении к базе данных в settings.php

Здесь вам снова понадобятся сведения о подключении к новой базе данных. Откройте файл **/drupal/sites/default/setting.php** в текстовом редакторе и замените значения database, username, password и host в массиве **$databases** на правильные значения для новой базы данных. По завершении должно получиться следующее:

    $databases = array (
       'default' => 
       array (
         'default' => 
         array (
           'database' => 'remote_db_name',
           'username' => 'remote_username',
           'password' => 'remote_password',
           'host' => 'remote_host',
           'port' => '',
           'driver' => 'mysql',
           'prefix' => '',
         ),
       ),
     );

Сохраните файл **settings.php**. Теперь все готово к развертыванию.

## Развертывание кода Drupal с помощью Git или FTP

Последний шаг заключается в развертывании кода в веб-приложениях Azure с помощью Git или FTP.

Если вы используете FTP, найдите имя узла FTP и имя пользователя в колонке веб-приложения на [портале предварительной версии Azure](https://portal.azure.com). Затем воспользуйтесь любым FTP-клиентом для передачи файлов Drupal в папку **/site/wwwroot** удаленного сайта.

Если вы использовали Git в предыдущих шагах, должна была осуществиться настройка репозитория Git. Необходимо установить Git на локальном компьютере. После создания репозитория следуйте приведенным инструкциям.

> [AZURE.NOTE]В зависимости от параметров Git может потребоваться изменить файл GITIGNORE (скрытый файл и элемент того же уровня для папки GIT, созданной в локальном корневом каталоге после выполнения git commit). Это позволяет указать файлы в приложении Drupal, которые можно проигнорировать. Если эти сведения содержат файлы, которые должны быть развернуты, удалите эти записи, чтобы такие файлы не игнорировались.

После развертывания Drupal в веб-приложениях Azure можно продолжить развертывание обновлений через Git или FTP.

## Связанные сведения

Дополнительные сведения см. в следующих записях и разделах:

- [Веб-приложения службы приложений Azure с точки зрения PHP][]
- [Сравнение службы приложений, облачных служб и виртуальных машин Azure][]
- [Настройка PHP в веб-приложениях службы приложений Azure с помощью файлов .user.ini][]
- [Модуль интеграции Azure](https://drupal.org/project/azure_auth)
- [Модуль хранилища больших двоичных объектов Azure](https://drupal.org/project/azure_blob)

>[AZURE.NOTE]Чтобы приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.

## Изменения
* Руководство по переходу от веб-сайтов к службе приложений см. в разделе [Служба приложений Azure и ее влияние на существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714).
* Руководство по смене старого портала на новый портал см. в разделе [Справочник по навигации на предварительной версии портала](http://go.microsoft.com/fwlink/?LinkId=529715)

  [Создание веб-приложения PHP-MySQL в службе приложений Azure и его развертывание с помощью Git]: /develop/php/tutorials/website-w-mysql-and-git/
  
  [Веб-приложения службы приложений Azure с точки зрения PHP]: http://blogs.msdn.com/b/silverlining/archive/2012/06/12/windows-azure-websites-a-php-perspective.aspx
  [Сравнение службы приложений, облачных служб и виртуальных машин Azure]: http://go.microsoft.com/fwlink/?LinkId=310123
  [Настройка PHP в веб-приложениях службы приложений Azure с помощью файлов .user.ini]: http://blogs.msdn.com/b/silverlining/archive/2012/07/10/configuring-php-in-windows-azure-websites-with-user-ini-files.aspx
  [Azure Integration Module]: http://drupal.org/project/azure
 

<!---HONumber=62-->