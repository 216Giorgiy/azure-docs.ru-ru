<properties
	pageTitle="Устранение неполадок: недоступность веб-приложения из-за ошибки HTTP 502 или 503"
	description="Эта статья поможет устранить ошибки HTTP 502 или 503, возникшие при использовании веб-приложения, размещенного в службе приложений Azure."
	services="app-service\web"
	documentationCenter=""
	authors="cephalin"
	manager="wpickett"
	editor=""
	tags="top-support-issue"/>

<tags
	ms.service="app-service-web"
	ms.workload="web"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="10/23/2015"
	ms.author="cephalin"/>

# Устранение неполадок: недоступность веб-приложения из-за ошибки HTTP 502 или 503

Эта статья поможет устранить ошибки HTTP 502 или 503, возникшие при использовании веб-приложения, размещенного в [службе приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714).

Если вам потребуется дополнительная помощь по любому из вопросов, рассматриваемых в статье, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](http://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт службы поддержки Azure](http://azure.microsoft.com/support/options/) и щелкните **Поддержка**.

## Симптом

При открытии веб-приложения браузер возвращает ошибку HTTP «502 — недопустимый шлюз» или HTTP «503 — служба недоступна».

## Причина:

Эта проблема часто связана с проблемами на уровне приложения, например:

-	слишком долгое выполнение запросов;
-	слишком высокие требования приложения к памяти и процессору;
-	сбой приложения из-за критического исключения.

## Действия по устранению неполадок

Процесс устранения неполадок можно разделить на три последовательных задачи.

1.	[Наблюдение за поведением приложения](#observe).
2.	[Сбор данных](#collect).
3.	[Устранение проблемы](#mitigate).

[Веб-приложения службы приложений](/services/app-service/web/) содержат несколько инструментов для каждого из этих этапов.

<a name="observe" />
### 1\. Наблюдение за поведением приложения

####	Мониторинг работоспособности службы

Microsoft Azure информирует о каждом случае прерывания работы или снижения производительности службы. Вы можете следить за работоспособностью службы на [портале предварительной версии Azure](https://portal.azure.com/). Дополнительные сведения см. в статье [Мониторинг работоспособности службы](insights-service-health.md).

####	Мониторинг веб-приложения

Этот инструмент позволяет определить наличие проблем с приложением. В колонке веб-приложения щелкните элемент **Запросы и ошибки**. Колонка **Метрика** содержит все метрики, которые вы можете добавить.

Некоторые из этих метрик помогут вам отслеживать работу веб-приложения, например:

-	средний размер рабочего набора памяти;
-	Average response time (Среднее время ответа)
-	время ЦП;
-	рабочий набор памяти;
-	Requests (Запросы)

![](./media/app-service-web-troubleshoot-HTTP-502-503/1-monitor-metrics.png)

Дополнительные сведения см. в следующих статьях:

-	[Мониторинг веб-приложений в службе приложений Azure](web-sites-monitor.md)
-	[Получение уведомлений об оповещениях](insights-receive-alert-notifications.md)

<a name="collect" />
### 2\. Сбор данных

####	Использование портала поддержки службы приложений Azure

Веб-приложения позволяют вам просматривать HTTP-журналы, журналы событий, дампы процессов и другую информацию для диагностики неполадок, связанных с вашим приложением. Эту информацию вы сможете найти на нашем портале поддержки по адресу **http://&lt;your имя\_приложения>.scm.azurewebsites.net/Support**

На портале поддержки службы приложений Azure вы увидите три отдельные вкладки, соответствующие трем этапам стандартного процесса устранения неполадок.

1.	Наблюдение за текущим поведением
2.	Сбор диагностических данных и запуск встроенных средств анализа
3.	Устранение неполадки

Если проблема происходит прямо сейчас, щелкните **Анализ** > **Диагностика** > **Запустить диагностику**. Так вы создадите сеанс диагностики, в ходе которого будут собираться HTTP-журналы, журналы просмотра событий, дампы памяти, журналы ошибок PHP и отчеты процесса PHP.

После сбора данных будет выполнен их анализ и создан отчет в формате HTML.

Вы также можете загрузить собранные данные на свой компьютер. По умолчанию они сохраняются в папке D:\\home\\data\\DaaS.

Дополнительные сведения о возможностях портала поддержки службы приложений Azure см. в статье [Обновления веб-сайтов Azure для поддержки расширения сайта](/blog/new-updates-to-support-site-extension-for-azure-websites).

####	Использование консоли отладки Kudu

Веб-приложения оснащены консолью отладки, с помощью которой вы можете получать сведения о среде, используя функции отладки, изучения, передачи файлов и конечных точек JSON. Эта консоль называется _консолью Kudu_ или _панелью SCM_ приложения.

Вы можете открыть эту панель по ссылке **https://&lt;Your имя\_приложения>.scm.azurewebsites.net/**.

Вот некоторые возможности консоли Kudu:

-	настройка среды для вашего приложения;
-	потоковая передача журналов;
-	запись дампа для диагностики;
-	консоль отладки с возможностью запуска командлетов Powershell и основных команд DOS.


У консоли Kudu есть еще одна очень полезная функция. Если приложение создает обрабатываемые исключения, с помощью консоли Kudu и средства SysInternals Procdump вы можете получать дампы памяти. Эти дампы представляют собой снимок процессов, выполняемых в момент создания исключения. Вы можете использовать эти данные при анализе сложных проблем в веб-приложении.

Дополнительные сведения о возможностях консоли Kudu см. в статье [Онлайн-средства веб-сайтов Azure, о которых вам нужно знать](/blog/windows-azure-websites-online-tools-you-should-know-about/).

<a name="mitigate" />
### 3\. Устранение проблемы

####	Масштабирование веб-приложения

В службе приложений Azure вы можете изменять масштаб выполнения приложения, чтобы увеличить его производительность и пропускную способность. Масштабирование веб-приложений предполагает два связанных действия: изменение ценовой категории для используемого плана службы приложений на более высокую с последующей настройкой некоторых параметров.

Дополнительные сведения о масштабировании см. в статье [Масштабирование веб-приложения в службе приложений Azure](web-sites-scale.md).

Кроме того, вы можете запустить более одного экземпляра приложения. Это не только увеличит возможности обработки, но и повысит устойчивость приложения к сбоям. Если прекратит работу один экземпляр приложения, другой экземпляр продолжит обрабатывать запросы.

Вы можете выбрать ручной или автоматический режим масштабирования.

####	Использование функции AutoHeal

Функция AutoHeal перезапускает рабочий процесс вашего приложения при определенных условиях, которые вы определяете в настройках (например, при изменении конфигурации, при определенном количестве запросов, при достижении ограничений памяти или времени выполнения запроса). В большинстве случаев повторный запуск процесса будет самым быстрым способом устранения проблемы. Хотя вы всегда можете вручную перезапустить веб-приложение на портале предварительной версии Azure, функция AutoHeal позволяет выполнять перезапуск автоматически. Для этого достаточно добавить в корневой файл web.config вашего веб-приложения некоторые триггеры. Эти параметры одинаково работают во всех приложениях, а не только в приложениях .NET.

Дополнительные сведения см. в разделе [Автоматическое восстановление веб-сайтов Windows Azure](/blog/auto-healing-windows-azure-web-sites/).


####	Перезапуск веб-приложения

Обычно это самый простой способ восстановления после проблемы, которая возникла один раз. Вы можете остановить или перезапустить приложение, используя колонку приложения на [Портале предварительной версии Azure](https://portal.azure.com).

 ![](./media/app-service-web-troubleshoot-HTTP-502-503/2-restart.png)

Управлять приложениями можно также с помощью Azure Powershell. Дополнительные сведения см. в статье [Использование Azure PowerShell с диспетчером ресурсов Azure](powershell-azure-resource-manager.md).

<!---HONumber=Nov15_HO1-->