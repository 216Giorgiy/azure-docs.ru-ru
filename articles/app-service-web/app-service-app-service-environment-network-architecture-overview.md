<properties 
	pageTitle="Общие сведения об архитектуре сетевых сред службы приложений" 
	description="Общие сведения об архитектуре топологии сети сред службы приложений." 
	services="app-service" 
	documentationCenter="" 
	authors="stefsch" 
	manager="wpickett" 
	editor=""/>

<tags 
	ms.service="app-service" 
	ms.workload="na" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="10/01/2015" 
	ms.author="stefsch"/>

# Общие сведения об архитектуре сетевых сред службы приложений

## Введение ##
Среда службы приложений всегда создается в подсети [виртуальной сети][virtualnetwork]. Приложения, работающие в среде службы приложений, могут взаимодействовать с закрытыми конечными точками, расположенными в пределах той же топологии виртуальной сети. Поскольку клиенты могут заблокировать части инфраструктуры виртуальной сети, важно понять типы потоков сетевой связи, которые возникают в среде службы приложений.

## Общий поток сетевого трафика ##
 
Среда службы приложений всегда имеет общедоступный виртуальный IP-адрес (VIP). Весь входящий трафик поступает на общедоступный виртуальный IP адрес, включая HTTP- и HTTPS-трафик для приложений, а также другой трафик для FTP, удаленной отладки и операций управления Azure. Полный список всех портов (обязательных и необязательных) с общедоступным виртуальным IP адресом см. в статье [Управление входящим трафиком][controllinginboundtraffic] в среде службы приложений.

Из схемы ниже можно получить общее представление о различных потоках входящего и исходящего сетевого трафика.

![Общие потоки сетевого трафика][GeneralNetworkFlows]

Среда службы приложений может взаимодействовать с разными конечными точками частных клиентов. Например приложения, выполняющиеся в среде службы приложений, можно подключить к серверам баз данных, работающих на виртуальных машинах IaaS в виртуальной сети той же топологии.

Среды служб приложений также взаимодействуют с базами данных SQL и ресурсами хранилищ Azure, необходимыми для работы сред и управления ими. Некоторые ресурсы SQL и хранилищ, с которыми взаимодействует среда службы приложений, находятся в одном регионе со средой службы приложений, тогда как другие расположены в удаленных регионах Azure. Следовательно, для правильной работы среды службы приложений необходимо исходящее подключение к Интернету.

Поскольку среда службы приложений развертывается в подсети, группы безопасности сети можно использовать для управления входящим трафиком подсети. Дополнительные сведения об управлении входящим трафиком в среде службы приложений см. в следующей [статье][controllinginboundtraffic].

Дополнительную информацию о разрешении исходящего подключения к Интернету в среде службы приложений см. в статье о работе с [Express Route][ExpressRoute]. Метод, описанный в статье, применяется также при работе с подключением «сеть — сеть» и при использовании принудительного туннелирования.

## Исходящие сетевые адреса ##
Когда среда службы приложений отправляет исходящие вызовы, с ними всегда ассоциирован IP-адрес. Используемый IP-адрес определяется расположением вызываемой конечной точки — в виртуальной сети или за ее пределами.

Если вызываемая конечная точка расположена **за пределами** виртуальной сети, используемый исходящий адрес (или исходящий адрес NAT), является общедоступным виртуальным IP-адресом среды службы приложений. Этот адрес можно найти в пользовательском интерфейсе портала для среды службы приложений в колонке «Свойства».
 
![Исходящий IP-адрес][OutboundIPAddress]

Этот адрес можно также определить, создав приложение в среде службы приложений, а затем выполнив команду *nslookup* для адреса приложения. Полученный IP-адрес является общедоступным виртуальным IP-адресом и исходящим адресом NAT среды службы приложений.

Если вызываемая конечная точка расположена **внутри** виртуальной сети, исходящим адресом вызывающего приложения будет внутренний IP-адрес отдельного вычислительного ресурса, на котором запущено приложение. Однако постоянное сопоставление внутренних IP-адресов виртуальной сети с приложениями не происходит. Приложения можно перемещать между различными вычислительными ресурсами, но из-за операций масштабирования размер пула доступных вычислительных ресурсов в среде службы приложений может меняться.

Но поскольку среда службы приложений всегда расположена в подсети, внутренний IP-адрес вычислительного ресурса, на котором работает приложение, будет всегда находиться в диапазоне подсети CIDR. Поэтому при использовании детальных списков управления доступом или групп безопасности сети для защиты доступа к другим конечным точкам в виртуальной сети необходимо предоставить доступ к подсети, содержащей среду службы приложений.

На следующей схеме эти понятия показаны более подробно.

![Исходящие сетевые адреса][OutboundNetworkAddresses]

Расшифровка схемы выше.

- Так как общедоступный виртуальный IP-адрес среды службы приложений — 192.23.1.2, он является исходящим IP-адресом, используемым при отправке вызовов к конечным точкам в «Интернете».
- Диапазон CIDR подсети, содержащей среду службы приложений — 10.0.1.0/26. Другие конечные точки в пределах инфраструктуры той же виртуальной сети будут «видеть» вызовы из приложений как исходящие из какого-то адреса в этом диапазоне.

## Вызовы между средами службы приложений ##
Более сложный сценарий может наблюдаться в случае, если несколько сред службы приложений развернуты в одной и той же виртуальной сети, при этом из одной среды службы приложений в другую выполняются исходящие вызовы. Такие типы вызовов между разными средами службы приложений также рассматриваются как «интернет-вызовы».

На схеме ниже показан пример многоуровневой архитектуры с приложениями в одной среде службы приложений (например, веб-приложения «входной двери»), которые вызывают приложения во второй среде службы приложений (например, внутренние приложения API серверной части, которые не должны быть доступны из Интернета).

![Вызовы между средами службы приложений][CallsBetweenAppServiceEnvironments]

В приведенном выше примере среда службы приложений «ASE 1» имеет исходящий IP-адрес 192.23.1.2. Если приложение, запущенное в этой среде службы приложений, выполняет исходящий вызов приложения, запущенного во второй среде службы приложений («ASE 2»), которая расположена в той же виртуальной сети, то исходящий вызов будет считаться «обращением к Интернету». В результате сетевой трафик, поступающий во вторую среду службы приложений, будет выглядеть так, как будто он поступает с IP-адреса 192.23.1.2 (т. е. с адреса, не входящего в диапазон адресов подсети первой среды службы приложений).

Даже несмотря на то, что вызовы между различными средами службы приложений считаются вызовами «через Интернет», если обе среды службы приложений находятся в одном регионе Azure, сетевой трафик будет оставаться в региональной сети Azure и физически не будет проходить через общедоступный Интернет. В итоге вы можете использовать сетевую группу безопасности в подсети второй среды службы приложений, чтобы разрешить только входящие вызовы с адреса первой среды службы приложений (исходящий IP-адрес которой 192.23.1.2). Тем самым вы обеспечите защищенный обмен данными между средами службы приложений.

## Дополнительные ссылки и сведения ##
Подробные сведения о входящих портах, используемых средами службы приложений, и о регулировании входящего трафика с помощью сетевых групп безопасности см. [здесь][controllinginboundtraffic].

Подробные сведения о том, как использовать определенные пользователями маршруты для предоставления средам службы приложений исходящего доступа к Интернету, см. в этой [статье][ExpressRoute].


<!-- LINKS -->
[virtualnetwork]: http://azure.microsoft.com/services/virtual-network/
[controllinginboundtraffic]: http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-control-inbound-traffic/
[ExpressRoute]: http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-network-configuration-expressroute/

<!-- IMAGES -->
[GeneralNetworkFlows]: ./media/app-service-app-service-environment-network-architecture-overview/NetworkOverview-1.png
[OutboundIPAddress]: ./media/app-service-app-service-environment-network-architecture-overview/OutboundIPAddress-1.png
[OutboundNetworkAddresses]: ./media/app-service-app-service-environment-network-architecture-overview/OutboundNetworkAddresses-1.png
[CallsBetweenAppServiceEnvironments]: ./media/app-service-app-service-environment-network-architecture-overview/CallsBetweenEnvironments-1.png

<!---HONumber=Oct15_HO3-->