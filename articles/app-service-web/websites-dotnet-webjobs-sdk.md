<properties 
	pageTitle="Информация о пакете SDK веб-заданий" 
	description="Общие сведения о пакете SDK веб-заданий. В данном материале объясняется, что из себя представляет пакет инструментов SDK и в каких ситуациях он может оказаться полезным, а также приводятся примеры программного кода." 
	services="app-service\web, storage" 
	documentationCenter=".net" 
	authors="tdykstra" 
	manager="wpickett" 
	editor="jimbe"/>

<tags 
	ms.service="app-service-web" 
	ms.workload="web" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="04/03/2015" 
	ms.author="tdykstra"/>

# Информация о пакете SDK веб-заданий

## <a id="overview"></a>Обзор

В настоящей статье объясняется, что из себя представляет пакет инструментов SDK веб-заданий, выполняется разбор нескольких наиболее характерных ситуаций, в которых он может применяться, а также приводится краткий обзор его возможного использования при разработке собственного программного кода.

[Веб-задания](web-sites-create-web-jobs.md) — это функция службы приложений Azure, которая позволяет запускать программу или сценарий в том же контексте, что и веб-приложение. Цель пакета SDK для заданий WebJob — упростить задачу написания кода, который используется в качестве задания WebJob, работает с очередями, большими двоичными объектами и таблицами службы хранилища Azure, а также очередями служебных шин.

Пакет SDK веб-заданий содержит следующие компоненты.

* **Пакеты NuGet**. Пакеты NuGet, которые добавляются в проект консольного приложения Visual Studio, предоставляют платформу, которую код использует для работы со службой хранилища Azure или с очередями служебной шины.   
  
* **Панель мониторинга**. Часть пакета SDK веб-заданий включена в службу приложений Azure и предоставляет обширные возможности мониторинга и диагностики для программ, которые создаются с помощью пакетов NuGet. Чтобы использовать эти функции мониторинга и диагностики, не нужно писать код.

## <a id="scenarios"></a>Сценарии

Ниже представлены стандартные сценарии, которые можно проще обработать с помощью пакета SDK веб-заданий Azure:

* Обработка изображений или другая нагружающая ЦП задача. Стандартной функцией веб-сайтов является возможность отправлять изображения или видео. Часто требуется изменить контент после его отправки, но вы не хотите, чтобы пользователь при этом ждал.

* Обработка очередей. Обычно для взаимодействия внешнего сервера с внутренним используются очереди. Когда веб-сайту требуется выполнить задание, он отправляет сообщение в очередь. Служба внутреннего сервера извлекает сообщения из очереди и выполняет задание. Очереди можно использовать для обработки изображений: например, после того, как пользователь загрузит несколько файлов, их имена можно поместить в сообщение очереди, чтобы внутренний сервер мог выбрать их для обработки. Также можно использовать очереди для ускорения отклика сайта. Например, вместо записи непосредственно в базу данных SQL выполните запись в очередь, сообщите пользователю о готовности и позвольте службе внутреннего сервера обработать задание реляционной базы данных с высокой задержкой. Пример обработки очереди с процессом, работающим с изображениями, приводится в [учебнике "Начало работы с пакетом SDK веб-заданий"](websites-dotnet-webjobs-sdk-get-started.md).

* Объединение RSS-каналов. Если ваш сайт обрабатывает список RSS-каналов, можно получить все статьи из веб-каналов в фоновом процессе.

* Обработка файлов, например, объединение или очистка файлов журнала. Файлы журнала могут быть созданы несколькими сайтами или в течение отдельных интервалов времени, которые следует совместить для запуска в них заданий анализа. Также можно запланировать еженедельную задачу для очистки старых файлов журнала.

* Ввод данных в таблицы Azure. В системе могут находится некоторые файлы и BLOB-объекты, и может возникнуть необходимость их обработать и сохранить данные в таблицах. Функции ввода данных могут выполнять запись огромного количества строк (в некоторых случаях этот показатель может исчисляться миллионами), и пакет SDK для веб-заданий позволяет очень просто реализовать подобные функциональные возможности. Помимо этого, пакет SDK предоставляет индикаторы для отслеживания в реальном времени показателей, характеризующих ход выполнения каких-либо операций, среди которых, например, показатель количества строк, записанных в таблицу.

* Другие долгосрочные задачи, которые необходимо запустить в фоновом потоке, например [отправка электронной почты](https://github.com/victorhurdugaci/AzureWebJobsSamples/tree/master/SendEmailOnFailure).

## <a id="code"></a> Примеры кода

Код для обработки стандартных задач, которые работают с хранилищем Azure, прост. В приложении консоли запишите методы для фоновых задач, которые следует выполнить, и добавьте в них атрибуты из пакета SDK веб-заданий. Метод `Main` создает объект `JobHost`, который координирует вызовы записываемых методов. Платформа SDK веб-заданий знает, когда следует вызывать используемые методы на основе атрибутов пакета SDK веб-заданий.

Здесь приводится пример программы, которая опрашивает очередь и для каждого полученного от очереди сообщения создает BLOB-объект.

		public static void Main()
		{
		    JobHost host = new JobHost();
		    host.RunAndBlock();
		}

		public static void ProcessQueueMessage([QueueTrigger("webjobsqueue")] string inputText, 
            [Blob("containername/blobname")]TextWriter writer)
		{
		    writer.WriteLine(inputText);
		}

Объект `JobHost` является контейнером для набора фоновых функций. Объект `JobHost` выполняет мониторинг функций, просматривает события, которые активируют их, и выполняет функции при возникновении событий-триггеров. Метод `JobHost` вызывается, чтобы указать, где следует запускать обработку контейнера: в текущем потоке или в фоновом потоке. В этом примере метод `RunAndBlock` запускает постоянную обработку в текущем потоке.

Так как у метода `ProcessQueueMessage` в этом примере есть атрибут `QueueTrigger`, триггер для этой функции — получение нового сообщения очереди. Объект `JobHost` ищет новые сообщения очереди в указанной очереди (webjobsqueue в этом примере) и при нахождении вызывает `ProcessQueueMessage`. Атрибут `QueueTrigger` также уведомляет платформу о привязке параметра `inputText` к значению сообщения очереди:

<pre class="prettyprint">public static void ProcessQueueMessage([QueueTrigger("webjobsqueue")]] <mark>string inputText</mark>, 
    [Blob("containername/blobname")]TextWriter writer)</pre>

Платформа также привязывает объект `TextWriter` к большому двоичному объекту с именем blobname в контейнере с именем containername:

<pre class="prettyprint">public static void ProcessQueueMessage([QueueTrigger("webjobsqueue")]] string inputText, 
    <mark>[Blob("containername/blobname")]TextWriter writer</mark>)</pre>

Затем функция использует эти параметры для записи значения сообщения очереди в большой двоичный объект:

		writer.WriteLine(inputText);

Функции триггера и модуля привязки пакета SDK веб-заданий значительно упрощают написание программного кода, предназначенного для работы с объектами хранилища Azure. Код низкого уровня, необходимый для обработки очередей и больших двоичных объектов, создается платформой пакета SDK веб-заданий — платформа создает очереди, которые еще не существуют, открывает очередь, читает сообщения очереди, удаляет сообщения очереди по завершении обработки, создает контейнеры больших двоичных объектов, которые еще не существуют, выполняет запись в большие двоичные объекты и т. д.

Пакет SDK веб-заданий предоставляет множество способов работы с хранилищем Azure. Например, если параметр с добавленным атрибутом `QueueTrigger` является массивом байтов или пользовательским типом, выполняется его автоматическая десериализация из JSON. Атрибут `BlobTrigger` можно также использовать для активации обработки при создании нового большого двоичного объекта в учетной записи хранения Azure. (Обратите внимание, что в то время как `QueueTrigger` ищет новые сообщения очереди в течение нескольких секунд, для `BlobTrigger` может потребоваться до 20 минут, чтобы обнаружить новый большой двоичный объект. `BlobTrigger` сканирует большие двоичные объекты при каждом запуске `JobHost`, а затем периодически проверяет журналы службы хранилища Azure для поиска новых больших двоичных объектов.)

## <a id="workerrole"></a>Использование пакета SDK для веб-заданий вне сферы применения веб-заданий

Программа, которая использует пакет SDK для заданий WebJob представляет собой стандартное консольное приложение и может запускаться из любого места; ее необязательно запускать как задание WebJob. Протестировать такую программу можно локально на компьютере разработчика, а в производственной среде ее можно запустить в рабочей роли облачной службы или службе Windows, в соответствии с предпочтениями в отношении какой-либо из этих сред.

Панель мониторинга доступна только как расширение сайта для веб-приложения службы приложений Azure. Если необходимо запустить программу вне веб-заданий и при этом использовать панель мониторинга, можно настроить веб-приложение Azure на использование той же самой учетной записи хранения, которая указана в строке подключения панели мониторинга из пакета SDK веб-заданий. В таком случае в панели мониторинга веб-заданий этого веб-приложения будет отображаться информация о выполнении функций программы, которая работает в иной среде. Затем можно перейти на панель мониторинга по URL-адресу https://*{webappname}*.scm.azurewebsites.net/azurejobs/#/functions. Дополнительные сведения см. в разделе [Получение панели мониторинга для локальной разработки с помощью пакета SDK веб-заданий](http://blogs.msdn.com/b/jmstall/archive/2014/01/27/getting-a-dashboard-for-local-development-with-the-webjobs-sdk.aspx), однако следует обратить внимание, что в ней приводится имя старой строки подключения.

## <a id="nostorage"></a>Использование пакета инструментов SDK для веб-заданий для вызова любой функции

Пакет SDK веб-заданий может предоставить ряд преимуществ даже при отсутствии необходимости напрямую работать с очередями хранилища Azure, таблицами, BLOB-объектами или очередями сервисной шины:

* Можно вызывать необходимые функции из панели мониторинга.
* Можно осуществлять повторное выполнение функций из панели мониторинга.
* Вы можете просматривать журналы на панели мониторинга, связанные с конкретным веб-заданием (журналы приложения, записанные с помощью Console.Out, Console.Error, Trace и т. п.) или с вызовом определенной функции, которая создает их (журналы, записанные с помощью объекта `TextWriter`, который пакет SDK передает функции в качестве параметра). 

* Дополнительную информацию см. в разделах: [Как вызывать функцию в ручном режиме](websites-dotnet-webjobs-sdk-storage-queues-how-to.md#manual) и [Как записывать журналы](websites-dotnet-webjobs-sdk-storage-queues-how-to.md#logs).

## <a id="nextsteps"></a>Дальнейшие действия

Дополнительные сведения о пакете SDK веб-заданий приводятся в разделе [Веб-задания Azure — рекомендуемые ресурсы](http://go.microsoft.com/fwlink/?linkid=390226).
 

<!---HONumber=62-->