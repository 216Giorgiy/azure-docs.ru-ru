<properties
	pageTitle="Приобретение и настройка сертификата SSL для службы приложений Azure"
	description="Узнайте, как приобрести и настроить сертификат SSL для службы приложений Azure."
	services="app-service"
	documentationCenter=".net"
	authors="apurvajo"
	manager="stefsch"
	editor="cephalin"
	tags="buy-ssl-certificates"/>

<tags
	ms.service="app-service"
	ms.workload="na"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="07/01/2016"
	ms.author="apurvajo"/>

#Приобретение и настройка сертификата SSL для службы приложений Azure

> [AZURE.SELECTOR]
- [Приобретение SSL-сертификата в Azure](web-sites-purchase-ssl-web-site.md)
- [Использование SSL-сертификата из другого источника](web-sites-configure-ssl-certificate.md)

По умолчанию в **[службе приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714)** уже включен протокол HTTPS для вашего веб-приложения с групповым сертификатом для домена *.azurewebsites.net. Если вы не планируете настраивать пользовательский домен, можно воспользоваться сертификатом HTTPS по умолчанию. Однако, как и все *[домены с подстановочными знаками](https://casecurity.org/2014/02/26/pros-and-cons-of-single-domain-multi-domain-and-wildcard-certificates), он не так безопасен, как личный домен с собственным сертификатом. Служба приложений Azure теперь позволяет легко приобрести сертификат SSL и управлять им прямо на портале Azure. В этой статье объясняется, как приобрести и настроить SSL-сертификат для вашей **[службы приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714)** всего за 3 простых действия.

> [AZURE.NOTE]
SSL-сертификаты для пользовательских доменных имен нельзя использовать с веб-приложениями в режимах "Бесплатный" и "Общий". Следует настроить веб-приложение для режима "Базовый", "Стандартный" или "Премиум", что может повлиять на сумму в выставляемых за подписку счетах. Дополнительные сведения см. в разделе **[Сведения о ценах на веб-приложения](https://azure.microsoft.com/pricing/details/web-sites/)**.



##<a name="bkmk_Overview"></a>Обзор
> [AZURE.NOTE]
Пожалуйста, не пытайтесь приобрести сертификат SSL с помощью подписки, с которой не связана активная кредитная карта. Это может привести к отключению подписки.

##<a> Приобретение, хранение и назначение SSL-сертификата для личного домена </a>
Чтобы включить протокол HTTPS для личного домена, например contoso.com, необходимо сначала **[настроить имя личного домена в службе приложений Azure](web-sites-custom-domain-name.md)**.

Перед запросом SSL-сертификата необходимо определить, какие доменные имена будут защищены с помощью этого сертификата. От этого зависит требуемый тип сертификата. Если вам необходимо защитить одно доменное имя, например contoso.com или www.contoso.com, вам будет достаточно сертификата категории "Стандартный" (или категории "Базовый"). Если необходимо защитить несколько доменных имен, например contoso.com, www.contoso.com и mail.contoso.com, можно использовать **[групповой сертификат](http://en.wikipedia.org/wiki/Wildcard_certificate)**.

##<a name="bkmk_purchasecert"></a>Шаг 0. Размещение заказа на SSL-сертификат

На этом шаге вы узнаете, как разместить заказ на выбранный сертификат SSL.

1.	На **[портале Azure](https://portal.azure.com/)** нажмите кнопку "Обзор" и введите "Сертификаты службы приложений" в строке поиска. Затем выберите "Сертификаты службы приложений" в результатах поиска и нажмите кнопку "Добавить".

    ![вставить изображение для создания с помощью кнопки "Обзор"](./media/app-service-web-purchase-ssl-web-site/browse.jpg)

    ![вставить изображение для создания с помощью кнопки "Обзор"](./media/app-service-web-purchase-ssl-web-site/add.jpg)

2.	Введите **понятное имя** для SSL-сертификата.

3.	В соответствующем поле введите **имя узла**.
> [AZURE.NOTE]
    Это один из наиболее важных этапов процесса покупки. Не забудьте ввести правильное имя узла (пользовательский домен), который необходимо защитить с помощью этого сертификата. **НЕ** добавляйте к имени узла префикс WWW. Например, для домена www.contoso.com введите в поле "Имя узла" просто contoso.com, и этот сертификат будет защищать как домен www, так и корневой домен.
    
4.	Выберите свою **подписку**.

    Если у вас несколько подписок, убедитесь, что сертификат SSL создается в той же подписке, которая используется для пользовательского домена или веб-приложения.
       
5.	Выберите или создайте **группу ресурсов**.

    Группы ресурсов позволяют управлять ресурсами Azure как единым целым; кроме того, они могут быть полезны при настройке правил контроля доступа на основе ролей (RBAC) для приложений. Дополнительные сведения см. в статье "Управление ресурсами Azure".
     
6.	Выберите **SKU сертификата**.

    Наконец, выберите SKU сертификата, который соответствует требованиям, и нажмите кнопку "Создать". Сейчас служба приложений Azure позволяет приобрести два различных SKU: • S1 — стандартный сертификат со сроком действия 1 год и автоматическим обновлением; • W1 — групповой сертификат со сроком действия 1 год и автоматическим обновлением. Дополнительные сведения см. в разделе **[Сведения о ценах на веб-приложения](https://azure.microsoft.com/pricing/details/web-sites/)**.

![вставить изображение SKU сертификата](./media/app-service-web-purchase-ssl-web-site/SKU.jpg)

> [AZURE.NOTE]
Создание сертификата SSL может занять от 1 до 10 минут. В ходе этого процесса в фоновом режиме выполняется несколько действий, которые являются очень трудоемкими при выполнении вручную.

##<a name="bkmk_StoreKeyVault"></a>Шаг 1. Сохранение сертификата в хранилище ключей Azure

На этом шаге вы узнаете, как разместить приобретенный сертификат SSL в выбранном хранилище ключей Azure.

1.	После завершения покупки SSL-сертификата необходимо вручную открыть колонку ресурса **Сертификаты службы приложений**, перейдя на нее снова (см. шаг 1 выше).

    ![вставить изображение для готовности к размещению в хранилище ключей](./media/app-service-web-purchase-ssl-web-site/ReadyKV.jpg)

    Вы увидите, что состояние сертификата — **Pending Issuance** (Ожидание выдачи). Это вызвано тем, что нужно выполнить еще некоторые действия, прежде чем вы сможете воспользоваться этим сертификатом.
 
2. Щелкните **Конфигурация сертификата** в колонке "Свойства сертификата" и затем **Шаг 1. Хранилище** для сохранения этого сертификата в хранилище ключей Azure.

3.	В колонке **Key Vault Status** (Состояние хранилища ключей) щелкните **Key Vault Repository** (Репозиторий хранилища ключей), чтобы выбрать существующее хранилище ключей для сохранения этого сертификата, или **Create New Key Vault** (Создать новое хранилище ключей), чтобы создать новое хранилище ключей в той же подписке и группе ресурсов.
 
    ![вставить изображение для создания нового хранилища ключей](./media/app-service-web-purchase-ssl-web-site/NewKV.jpg)
 
    > [AZURE.NOTE]
    Расходы для хранения этого сертификата в хранилище ключей будут минимальными. Дополнительные сведения см. в разделе **[Цены на хранилище ключей Azure](https://azure.microsoft.com/pricing/details/key-vault/)**.

4. После выбора репозитория хранилища ключей для сертификата сохраните сертификат, нажав кнопку **Сохранить** в верхней части колонки **Key Vault Status** (Состояние хранилища ключей).

    На этом размещение приобретенного сертификата в хранилище ключей Azure завершено. После обновления колонки напротив этого шага должен появиться зеленый флажок.
    
##<a name="bkmk_VerifyOwnership"></a>Шаг 2. Проверка владельца домена

На этом шаге вы узнаете, как выполнить проверку владельца домена для заказанного SSL-сертификата.

1.	Щелкните **Шаг 2. Проверка** в колонке **Конфигурация сертификата**. Существует 4 типа проверки домена, которые поддерживаются сертификатами службы приложений.

    * **Проверка службы приложений**
    
        * Этот способ наиболее удобен, если у вас уже есть **личный домен, назначенный приложениям службы приложений**. При использовании этого метода будет выведен список всех приложений службы приложений, соответствующих этому критерию. Например, в данном случае **contosocertdemo.com** — личный домен, назначенный приложению службы приложений **ContosoCertDemo**. Поэтому это единственное приложение службы приложений, которое есть в списке. Если бы развертывание выполнялось в нескольких регионах, то был бы выведен список для всех регионов.
        
           Этот метод проверки доступен только для сертификатов, приобретенных в режимах "Стандартный" и "Базовый". Для групповых сертификатов пропустите его и перейдите к вариантам B, C или D ниже.
        * Нажмите кнопку **"Проверить"**, чтобы завершить этот шаг.
        * Нажмите кнопку **"Обновить"**, чтобы обновить состояние сертификата после завершения проверки. Проверка может занять несколько минут.
        
        ![вставить изображение для проверки службы приложений](./media/app-service-web-purchase-ssl-web-site/AppVerify.jpg)

    * **Проверка домена**

        * Этот метод наиболее удобен **ТОЛЬКО В ТОМ СЛУЧАЕ**, если вы приобрели **[пользовательский домен в службе приложений Azure.](custom-dns-web-site-buydomains-web-app.md)**
        
        * Нажмите кнопку **"Проверить"**, чтобы завершить этот шаг.
        
        * Нажмите кнопку **"Обновить"**, чтобы обновить состояние сертификата после завершения проверки. Проверка может занять несколько минут.

    * **Проверка почты**
        
        * Проверочное сообщение уже было отправлено по адресам электронной почты, связанным с этим пользовательским доменом.
         
        * Откройте его и щелкните ссылку для проверки, чтобы завершить шаг проверки электронной почты.
        
        * Если необходимо повторно отправить проверочное сообщение, нажмите кнопку **"Отправить сообщение повторно"**.
         
    * **Проверка вручную**
                 
        1. **Проверка с помощью веб-страницы HTML**
        
            * Создайте HTML-файл с именем **{маркер\_проверки\_домена}**.html (маркер можно скопировать из колонки "Состояние проверки домена").
            
            * Содержимое этого файла должно полностью совпадать с **маркером проверки домена**.
            
            * Разместите этот файл в корне веб-сервера, связанного с вашим доменом.
            
            * Нажмите кнопку **"Обновить"**, чтобы обновить состояние сертификата после завершения проверки. Проверка может занять несколько минут.
            
            Например, если вы приобретаете сертификат режима "Стандартный" для contosocertdemo.com с маркером проверки домена **"cAGgQrKc"**, то веб-запрос по адресу **"http://contosocertdemo.com/cAGgQrKc.html"** должен вернуть ответ **cAGgQrKc**.
        2. **Проверка записей типа TXT DNS**

            * С помощью диспетчера DNS создайте запись типа TXT в поддомене **"DZC"** со значением, равным **маркеру проверки домена**.
            
            * Нажмите кнопку **"Обновить"**, чтобы обновить состояние сертификата после завершения проверки. Проверка может занять несколько минут.
                              
            Например, для проверки группового сертификата с именем узла **\*.contosocertdemo.com** для **\*.subdomain.contosocertdemo.com** и маркером проверки домена **cAGgQrKc** нужно создать запись типа TXT на dzc.contosocertdemo.com со значением **cAGgQrKc**.


##<a name="bkmk_AssignCertificate"></a>Шаг 3. Назначение сертификата приложению службы приложений

На этом шаге вы узнаете, как назначить этот вновь приобретенный сертификат приложению службы приложений.

> [AZURE.NOTE]
Прежде чем выполнять действия, описанные в этом разделе, необходимо связать личное доменное имя с приложением. Дополнительные сведения см. в разделе **[Настройка пользовательского доменного имени для веб-приложения](web-sites-custom-domain-name.md)**.

1.	В браузере откройте **[портал Azure](https://portal.azure.com/)**.
2.	Щелкните **Служба приложений** в левой части страницы.
3.	Щелкните имя приложения, которому вы хотите назначить этот сертификат.
4.	В разделе **Параметры** щелкните **SSL certificates** (SSL-сертификаты).
5.	Щелкните **Импортировать сертификат службы приложений** и выберите сертификат, который вы приобрели.

    ![вставить изображение для импорта сертификата](./media/app-service-web-purchase-ssl-web-site/ImportCertificate.png)

6. В разделе **SSL-привязки** щелкните **Add bindings** (Добавить привязки).
7. В колонке **Добавление привязки SSL** в раскрывающихся списках выберите имя домена для защиты с применением SSL, а также используемый сертификат. Также можно выбрать **[подключение с указанием имени сервера(SNI)](http://en.wikipedia.org/wiki/Server_Name_Indication)** или SSL на основе IP.

    ![вставить изображение для привязок SSL](./media/app-service-web-purchase-ssl-web-site/SSLBindings.png)

       • SSL на основе IP связывает сертификат с именем домена, сопоставляя выделенный открытый IP-адрес сервера с именем домена. Для этого необходимо, чтобы для каждого имени домена (contoso.com, fabricam.com и т. д.), связанного с вашей службой, был доступен выделенный IP-адрес. Это традиционный способ связывания сертификатов SSL с веб-сервером. • SSL на основе SNI является расширением протоколов SSL и **[TLS (протокол безопасности транспортного уровня)](http://en.wikipedia.org/wiki/Transport_Layer_Security)**, которое позволяет нескольким доменам совместно использовать IP-адрес с отдельными сертификатами безопасности для каждого домена. Большинство современных браузеров (включая Internet Explorer, Chrome, Firefox и Opera) поддерживает SNI, однако более старые браузеры могут не поддерживать SNI. Дополнительные сведения об SNI см. в статье Википедии **[Подключения с указанием имени сервера](http://en.wikipedia.org/wiki/Server_Name_Indication)**.
       
7. Чтобы сохранить изменения и активировать SSL, щелкните **Добавить привязку**.



Если выбран **вариант SSL-подключения на основе IP** и пользовательский домен настроен с помощью записи А, необходимо выполнить следующие дополнительные шаги:

* После настройки привязки SSL-подключения на основе IP вашему веб-приложению будет предоставлен выделенный IP-адрес. Этот IP-адрес можно найти на странице **пользовательского домена** в разделе параметров приложения прямо над разделом **Имена узлов**. Он будет указан как **Внешний IP-адрес**.
    
    ![вставить изображение для SSL на основе IP](./media/app-service-web-purchase-ssl-web-site/virtual-ip-address.png)

    Обратите внимание, что этот IP-адрес будет отличаться от виртуального IP-адреса, который использовался ранее для настройки записи A для вашего домена. Если выбрано использование SSL-подключения на основе SNI или если не настроено использование SSL, для этой записи адрес указан не будет.
    
2. С помощью средств, предоставляемых регистратором имени домена, измените запись A для имени пользовательского домена, указав IP-адрес из предыдущего шага. На этом этапе приложение должно открываться с использованием HTTPS://, а не HTTP://, что подтверждает правильность настройки сертификата.


##<a name="bkmk_Rekey"></a>Повторное назначение ключа и синхронизация сертификата

1. Если вам когда-либо придется повторно назначить ключ сертификата по соображениям безопасности, просто выберите **"Повторно назначить ключ и синхронизировать"** в колонке **"Свойства сертификата"**.

2. Для запуска процесса нажмите кнопку **"Повторно назначить ключ"**. Этот процесс может занять от 1 до 10 минут.

    ![вставить изображение для повторного создания ключа SSL](./media/app-service-web-purchase-ssl-web-site/Rekey.jpg)

3. При повторном назначении ключа будет развернут новый сертификат, выданный центром сертификации.
4. Повторное назначение ключа не тарифицируется в течение времени существования сертификата.
5. При повторном назначении ключа сертификат проходит через состояние ожидания выдачи.
6. После подготовки сертификата синхронизируйте ресурсы с помощью этого сертификата, чтобы работа службы не прерывалась.
7. Синхронизация не доступна для сертификатов, которые еще не назначены веб-приложению.

## Дополнительные ресурсы ##
- [Включение протокола HTTPS для приложения в службе приложений Azure](web-sites-configure-ssl-certificate.md)
- [Приобретение и настройка личного домена для службы приложений Azure.](custom-dns-web-site-buydomains-web-app.md)
- [Центр управления безопасностью Microsoft Azure](/support/trust-center/security/)
- [Параметры конфигурации, разблокированные на веб-сайтах Azure](http://azure.microsoft.com/blog/2014/01/28/more-to-explore-configuration-options-unlocked-in-windows-azure-web-sites/)
- [Портал управления Azure](https://manage.windowsazure.com)

>[AZURE.NOTE] Если вы хотите приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.

<!---HONumber=AcomDC_0824_2016-->