---
title: Flask и хранилище таблиц Azure с использованием инструментов Python 2.2 для Visual Studio
description: Информация о том, как создать веб-приложение Flask, которое хранит данные в табличном хранилище Azure, с помощью инструментов Python для Visual Studio и развернуть его в веб-приложениях службы приложений Azure.
services: app-service\web
tags: python
documentationcenter: python
author: huguesv
manager: wpickett
editor: ''

ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: python
ms.topic: article
ms.date: 07/07/2016
ms.author: huvalo

---
# Flask и хранилище таблиц Azure с использованием инструментов Python 2.2 для Visual Studio
В этом учебнике мы используем [Средства Python для Visual Studio], чтобы создать простое веб-приложение опросника с помощью шаблонов PTVS. Также доступна [видеоверсия](https://www.youtube.com/watch?v=qUtZWtPwbTk) этого учебника.

Веб-приложение опросника реализует абстракцию для своего репозитория, что позволяет легко переключаться между разными типами репозиториев (размещенный в памяти, табличном хранилище Azure или MongoDB).

Вы узнаете, как создать учетную запись хранения Azure и настроить веб-приложение для использования табличного хранилища Azure, а также как опубликовать приложение в [веб-приложениях службы приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714).

Зайдите в [Центр по разработке для Python], где можно найти статьи о разработке веб-приложений службы приложений Azure с PTVS при помощи веб-платформ Bottle, Flask и Django, с использованием MongoDB, табличного хранилища Azure, MySQL и служб Базы данных SQL. Хотя эта статья ориентирована в первую очередь на службу приложений, при разработке для [облачных служб Azure] используются аналогичные процедуры.

## Предварительные требования
* Visual Studio 2015
* [Инструменты Python 2.2 для Visual Studio]
* [Образцы VSIX средств Python 2.2 для Visual Studio]
* [Инструменты пакета SDK для Azure для Visual Studio 2015]
* [Python 2.7 (32-разрядный)] или [Python 3.4 (32-разрядный)]

[!INCLUDE [create-account-and-websites-note](../../includes/create-account-and-websites-note.md)]

> [!NOTE]
> Чтобы приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.
> 
> 

## Создание проекта
В этом разделе мы создадим проект Visual Studio с помощью шаблона. Мы создадим виртуальную среду и установим необходимые пакеты. Затем мы запустим приложение локально в размещенном в памяти репозитории.

1. В Visual Studio выберите **Файл** > **Создать проект**.
2. Чтобы найти шаблоны [примеров VSIX для инструментов Python 2.2 для Visual Studio], в разделе **Python** выберите **Примеры**. Выберите **Веб-проект опросов Flask** и нажмите кнопку «ОК», чтобы создать проект.
   
     ![Диалоговое окно «Новый проект»](./media/web-sites-python-ptvs-flask-table-storage/PollsFlaskNewProject.png)
3. Вам будет предложено установить внешние пакеты. Выберите вариант **Установить в виртуальной среде**.
   
     ![Диалоговое окно «Внешние пакеты»](./media/web-sites-python-ptvs-flask-table-storage/PollsFlaskExternalPackages.png)
4. Выберите **Python 2.7** или **Python 3.4** в качестве базового интерпретатора.
   
     ![Диалоговое окно «Добавление виртуальной среды»](./media/web-sites-python-ptvs-flask-table-storage/PollsCommonAddVirtualEnv.png)
5. Убедитесь, что приложение работает, нажав клавишу `F5`. По умолчанию приложение использует размещенный в памяти репозиторий, который не требует настройки. При остановке веб-сервера все данные будут утеряны.
6. Щелкните **Создать примеры опросов**, а затем выберите опросник, чтобы проголосовать.
   
     ![Веб-браузер](./media/web-sites-python-ptvs-flask-table-storage/PollsFlaskInMemoryBrowser.png)

## Создание учетной записи хранения Azure
Для выполнения операций хранилища необходимо использовать учетную запись хранения Azure. Выполнив следующие шаги, вы создадите учетную запись хранения.

1. Войдите на [портал Azure](https://portal.azure.com/).
2. Щелкните значок **Создать** в левом нижнем углу страницы, затем выберите **Данные + хранилище** > **Учетная запись хранения**. Щелкните **Создать**, присвойте учетной записи хранения уникальное имя и создайте для нее новую [группу ресурсов](../resource-group-overview.md).
   
      ![Быстрое создание](./media/web-sites-python-ptvs-flask-table-storage/PollsCommonAzureStorageCreate.png)
   
    После создания учетной записи хранения на кнопке **Уведомления**загорится зеленым слово **УСПЕШНО** и откроется колонка учетной записи хранения, в которой будет видно, что учетная запись относится к созданной вами группе ресурсов.
3. Щелкните элемент **Ключи доступа** в колонке учетной записи хранения. Запишите имя учетной записи и значение key1.
   
      ![ключей](./media/web-sites-python-ptvs-flask-table-storage/PollsCommonAzureStorageKeys.png)
   
    Эта информация нам понадобится для настройки проекта в следующем разделе.

## Настройка проекта
В этом разделе мы настроим приложение для использования только что созданной учетной записи хранения. Мы узнаем, как получить настройки соединения при помощи портала Azure. После этого мы запустим приложение локально.

1. В Visual Studio щелкните правой кнопкой мыши узел проекта в обозревателе решений и выберите **Свойства**. Откройте вкладку **Отладка**.
   
     ![Параметры отладки проекта](./media/web-sites-python-ptvs-flask-table-storage/PollsFlaskAzureTableStorageProjectDebugSettings.png)
2. Установите значения переменных среды для своего приложения в разделе **Команда отладки сервера** > **Среда**.
   
       REPOSITORY_NAME=azuretablestorage
       STORAGE_NAME=<storage account name>
       STORAGE_KEY=<primary access key>
   
   В результате переменные среды будут заданы при **запуске отладки**. Чтобы настроить переменные для **запуска без отладки**, также установите необходимые значения в разделе **Команда запуска сервера**.
   
   Также можно определить значения переменных среды с помощью панели управления Windows. Это будет наилучшим решением, если вы не желаете хранить учетные данные в исходном коде или файле проекта. Чтобы новые значения переменных стали доступными для приложения, будет необходимо перезапустить Visual Studio.
3. Код с реализацией репозитория табличного хранилища Azure находится в файле **models/azuretablestorage.py**. Дополнительную информацию о том, как использовать службу табличного хранилища в Python, см. в [документации].
4. Запустите приложение, нажав клавишу `F5`. Опросы, созданные с помощью команды **Создать примеры опросов**, и отправленные при голосовании данные будут сериализованы в табличном хранилище Azure.
   
   > [!NOTE]
   > Виртуальная среда Python 2.7 может вызвать исключение в Visual Studio. Нажмите клавишу `F5`, чтобы продолжить загрузку веб-проекта.
   > 
   > 
5. Перейдите на страницу **О программе**, чтобы убедиться в том, что приложение использует репозиторий **табличного хранилища Azure**.
   
     ![Веб-браузер](./media/web-sites-python-ptvs-flask-table-storage/PollsFlaskAzureTableStorageAbout.png)

## Знакомство с хранилищем таблиц Azure
Таблицы хранилища легко просматривать и редактировать с помощью Cloud Explorer в Visual Studio. В этом разделе мы будем использовать обозреватель сервера для просмотра содержимого таблиц приложения опросника.

> [!NOTE]
> Для этого требуется установить инструменты Microsoft Azure, которые доступны в составе пакета [SDK для Azure для .NET].
> 
> 

1. Откройте **Cloud Explorer**. Разверните узел **Учетные записи хранения**, свою учетную запись хранения, а затем узел **Таблицы**.
   
     ![Обозреватель облака](./media/web-sites-python-ptvs-bottle-table-storage/PollsCommonServerExplorer.png)
2. Дважды щелкните таблицу **опросов** или **вариантов**, чтобы просмотреть содержимое таблицы в окне документа, а также добавить, удалить или отредактировать записи.
   
     ![Результаты запросов таблицы](./media/web-sites-python-ptvs-bottle-table-storage/PollsCommonServerExplorerTable.png)

## Публикация веб-приложения в службе приложений Azure
С помощью пакета SDK для Azure для .NET можно легко развернуть веб-приложение в службе приложений Azure.

1. В **обозревателе решений** щелкните правой кнопкой мыши узел проекта и выберите **Опубликовать**.
   
     ![Диалоговое окно «Публикация веб-сайта»](./media/web-sites-python-ptvs-bottle-table-storage/PollsCommonPublishWebSiteDialog.png)
2. Щелкните **Веб-приложения Microsoft Azure**.
3. Нажмите **Создать**, чтобы создать новое веб-приложение.
4. Заполните перечисленные ниже поля и нажмите кнопку **Создать**.
   
   * **Имя веб-приложения**
   * **План обслуживания приложения**
   * **Группа ресурсов**
   * **Регион**
   * Для параметра **Сервер баз данных** оставьте значение **Без базы данных**
5. Примите значения по умолчанию и щелкните **Опубликовать**.
6. Опубликованное веб-приложение автоматически откроется в вашем браузере. Если перейти на страницу «О программе», вы увидите, что используется размещенный **в памяти** репозиторий, а не репозиторий **табличного хранилища Azure**.
   
   Это объясняется тем, что переменные среды не устанавливаются на экземпляре веб-приложения Azure, поэтому используются значения по умолчанию, указанные в файле **settings.py**.

## Настройка экземпляра веб-приложений
В этом разделе мы настроим переменные среды для экземпляра веб-приложений.

1. На [портале Azure](https://portal.azure.com) откройте колонку веб-приложения, выбрав **Обзор** > **Службы приложений** > имя вашего веб-приложения.
2. В колонке веб-приложения щелкните **Все параметры**, а затем — **Параметры приложения**.
3. Прокрутите список вниз до раздела **Параметры приложения** и присвойте переменным **REPOSITORY\_NAME**, **STORAGE\_NAME** и **STORAGE\_KEY** значения, описанные ранее в разделе **Настройка проекта**.
   
     ![Параметры приложения](./media/web-sites-python-ptvs-bottle-table-storage/PollsCommonWebSiteConfigureSettingsTableStorage.png)
4. Щелкните **Save** (Сохранить). После получения уведомлений о том, что изменения были применены, щелкните **Обзор** в главной колонке веб-приложения.
5. Вы должны увидеть, что веб-приложение работает корректно и использует репозиторий **табличного хранилища Azure**.
   
   Поздравляем!
   
     ![Веб-браузер](./media/web-sites-python-ptvs-flask-table-storage/PollsFlaskAzureBrowser.png)

## Дальнейшие действия
Для получения более подробной информации о средствах Python для Visual Studio, Flask и хранилища таблиц Azure.

* [Документация по средствам Python для Visual Studio]
  * [Веб-проекты]
  * [Проекты для облачной службы]
  * [Удаленная отладка в Microsoft Azure]
* [Документация по Flask]
* [Хранилище Azure]
* [Пакет SDK для Azure для Python]
* [Как использовать службу табличного хранилища в Python]

## Изменения
* Указания по изменениям при переходе от веб-сайтов к службе приложений см. в разделе [Служба приложений Azure и ее влияние на существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714).

<!--Link references-->
[Центр по разработке для Python]: /develop/python/
[облачных служб Azure]: ../cloud-services-python-ptvs.md
[документации]: ../storage-python-how-to-use-table-storage.md
[Как использовать службу табличного хранилища в Python]: ../storage-python-how-to-use-table-storage.md

<!--External Link references-->
[Azure Portal]: https://portal.azure.com
[SDK для Azure для .NET]: http://azure.microsoft.com/downloads/
[Средства Python для Visual Studio]: http://aka.ms/ptvs
[Инструменты Python 2.2 для Visual Studio]: http://go.microsoft.com/fwlink/?LinkID=624025
[Образцы VSIX средств Python 2.2 для Visual Studio]: http://go.microsoft.com/fwlink/?LinkID=624025
[примеров VSIX для инструментов Python 2.2 для Visual Studio]: http://go.microsoft.com/fwlink/?LinkID=624025
[Инструменты пакета SDK для Azure для Visual Studio 2015]: http://go.microsoft.com/fwlink/?linkid=518003
[Python 2.7 (32-разрядный)]: http://go.microsoft.com/fwlink/?LinkId=517190
[Python 3.4 (32-разрядный)]: http://go.microsoft.com/fwlink/?LinkId=517191
[Документация по средствам Python для Visual Studio]: http://aka.ms/ptvsdocs
[Документация по Flask]: http://flask.pocoo.org/
[Удаленная отладка в Microsoft Azure]: http://go.microsoft.com/fwlink/?LinkId=624026
[Веб-проекты]: http://go.microsoft.com/fwlink/?LinkId=624027
[Проекты для облачной службы]: http://go.microsoft.com/fwlink/?LinkId=624028
[Хранилище Azure]: http://azure.microsoft.com/documentation/services/storage/
[Пакет SDK для Azure для Python]: https://github.com/Azure/azure-sdk-for-python


<!---HONumber=AcomDC_0713_2016-->