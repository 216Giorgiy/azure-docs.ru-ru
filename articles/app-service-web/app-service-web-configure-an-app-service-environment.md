<properties 
	pageTitle="Настройка среды службы приложений" 
	description="Настройка и мониторинг среды службы приложений, а также управление ею" 
	services="app-service" 
	documentationCenter="" 
	authors="ccompy" 
	manager="stefsch" 
	editor=""/>

<tags 
	ms.service="app-service" 
	ms.workload="na" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="04/04/2016" 
	ms.author="ccompy"/>


# Настройка среды службы приложений #

## Обзор ##

На высоком уровне среда службы приложений состоит из нескольких основных компонентов:

- вычислительные ресурсы, работающие в размещенной службе среды приложений Azure;
- Хранилище
- База данных
- Классическая виртуальная сеть v1, включающая по крайней мере одну подсеть;
- подсеть, в которой работает размещенная служба среды приложений Azure.

### Вычислительные ресурсы

Вычислительные ресурсы используются в четырех пулах ресурсов. Каждая среда ASE включает набор внешних интерфейсов и 3 возможных рабочих пула. Использовать все 3 рабочих пула необязательно. При необходимости можно использовать только один или два. Пулы внешних интерфейсов и рабочих ролей недоступны клиентам напрямую. Получить к ним доступ через RDP, вмешаться в процесс их подготовки или управлять ими в качестве администратора нельзя, но можно задать их количество и размер. В среде ASE доступны 4 варианта размеров с метками от P1 до P4. Информацию об этих размерах и их ценах см. в разделе [Ценовые категории службы приложений](../app-service/app-service-value-prop-what-is.md). Одновременно может выполняться только одна такая операция.

**Внешние интерфейсы** Внешние интерфейсы являются конечными точками HTTP/HTTPS для приложений в среде ASE. Не запускайте рабочие нагрузки во внешних интерфейсах.

- ASE начинается с \(2\) P2s — этого достаточно для разработки и тестирования рабочих и низкоуровневых рабочих нагрузок. P3 рекомендуется использовать для средних и больших рабочих нагрузок.
- При средних и больших рабочих нагрузках рекомендуется иметь по крайней мере 4 x P3 — такое количество обеспечит достаточное число внешних интерфейсов при проведении планового обслуживания. Во время планового обслуживания внешние интерфейсы будут отключаться по одному, так что общее число доступных интерфейсов во время обслуживания будет меньше.
- Мгновенно добавить новый экземпляр внешнего интерфейса нельзя. Подготовка занимает 2–3 часа.
- Для более тонкой настройки автомасштабирования клиенты должны отслеживать процент использования ЦП и памяти, а также метрики активных запросов по пулу внешних интерфейсов. Если при запуске P3 ЦП или память используются больше, чем на 70 %, число внешних интерфейсов необходимо увеличить. Если на каждый внешний интерфейс в среднем приходится по 15–20 тысяч активных запросов, значит, внешних интерфейсов должно быть больше. При работе P3 ЦП и память всегда должны использоваться меньше чем на 70 %, а на каждый внешний интерфейс должно приходиться меньше 15 тысяч активных запросов.  

**Рабочие роли** Фактически приложения выполняются в рабочих ролях. При вертикальном масштабировании планов службы приложений используются рабочие процессы в соответствующем рабочем пуле.

- Мгновенно исполнителей добавить нельзя. Подготовка исполнителей занимает 2–3 часа независимо от их количества.
- Объем вычислительного ресурса для любого пула масштабируется 2–3 часа на каждый домен обновления. В среде ASE присутствует 20 доменов обновления. Масштабирование объема вычислительных ресурсов для рабочего пула с 10 экземплярами занимает от 20 до 30 часов. 
- Изменение объема вычислительных ресурсов, используемых в рабочем пуле, может привести к холодному запуску приложений, запущенных в этом пуле.

Чтобы изменить объем вычислительных ресурсов для рабочего пула, в котором не выполняются никакие приложения, максимально быстро, необходимо выполнить следующие действия:

- Уменьшить число экземпляров до нуля \(отмена распределения экземпляров занимает около 30 минут\).
- Выбрать новый объем вычислений и число экземпляров. Масштабирование займет около 2–3 часов.

Описанный выше способ не подходит, если объем вычислительных ресурсов для приложений нужно увеличить. Вместо того чтобы менять размер рабочего пула, в котором находятся приложения, можно заполнить другой рабочий пул рабочими ролями желаемого размера и переместить приложения в новый пул.

- Создать дополнительные экземпляры с необходимым объемом вычислений в другом рабочем пуле. Это займет 2–3 часа.
- Переназначить планы службы приложений, в которых размещаются приложения, требующие увеличения объема вычислений, во вновь созданный рабочий пул. Эта операция выполняется быстро и занимает меньше минуты.  
- Уменьшить размер первого рабочего пула, если неиспользуемые экземпляры вам больше не требуются. Эта операция занимает около 30 минут.

**Автомасштабирование** Одним из средств, помогающих управлять использованием вычислительных ресурсов, является автоматическое масштабирование. Его можно применять к рабочему пулу и к пулу внешних интерфейсов. Оно позволяет выполнять увеличивать число экземпляров в любом типе пула утром и уменьшать его вечером, а также добавлять экземпляры, если число рабочих ролей, доступных в рабочем пуле, становится меньше установленного порога. При настройке правил автомасштабирования необходимо учитывать необходимое время на подготовку. Дополнительные сведения об автоматическом масштабировании в средах ASE см. в статье [Настройка автоматического масштабирования в среде службы приложений][ASEAutoscale].

### Хранилище

Каждая среда ASE предоставляется с хранилищем емкостью 500 ГБ. Это пространство используют все размещенные в среде ASE приложения. Хранилище является частью среды ASE, и в настоящее время вы не можете использовать вместо него пространство пользовательского хранилища. Изменяя маршрутизацию или защиту виртуальной сети, необходимо поддерживать доступ к службе хранилища Azure, иначе ASE работать не будет.

### База данных

Информация о среде и выполняющихся в ней приложениях хранится в базе данных. Хотя эта база данных также предоставляется в рамках подписки Azure, пользователи не могут выполнять с ней какие-либо действия напрямую. Изменяя маршрутизацию или защиту виртуальной сети, необходимо поддерживать доступ к SQL Azure, иначе ASE работать не будет.

### Сеть

С ASE можно использовать существующую виртуальную сеть или ту, которая была создана одновременно со средой. Чтобы среда ASE и VNET были включены в разные группы ресурсов, вам нужно создавать эти ресурсы отдельно. Если при создании ASE создается подсеть, ASE попадает в ту же группу ресурсов, что и виртуальная сеть.

В отношении виртуальной сети для ASE действуют некоторые ограничения:

- В настоящее время поддерживаются только классические виртуальные сети V1.
- виртуальная сеть должна быть региональной.
- Виртуальные сети, в которых размещаются ASE, должны использовать адреса RFC1918 \(т. е. частные адреса\).
- В месте развертывания ASE должна существовать подсеть с 8 или более адресами.
- Если подсеть используется для размещения ASE, диапазон адресов подсети изменять нельзя. Для дальнейшего развития ASE рекомендуется включать в подсеть не меньше 64 адресов. 

В отличие от размещенной службы, которая содержит среду ASE, [виртуальной сетью][virtualnetwork] и подсетью управляет пользователь. Администрирование виртуальной сети выполняется через пользовательский интерфейс виртуальной сети или Powershell.

Так как эта возможность помещает службу приложений Azure в виртуальную сеть, это значит, что ваши приложения, размещенные в ASE, могут теперь получать доступ к ресурсам, теперь доступны ресурсы через ExpressRoute или напрямую через VPN типа "сеть-сеть". Чтобы использовать ресурсы, доступные в сети, в которой размещена среда службы приложений, приложениям этой среды не нужны дополнительные сетевые компоненты. Это означает, что для размещения ресурсов в виртуальной сети или их подключения к этой сети вам не нужно выполнять интеграцию VNET или использовать гибридные подключения. Тем не менее эти функции можно использовать для доступа к ресурсам в сетях, которые не подключены к используемой виртуальной сети. Например, интеграцию VNET можно использовать для интеграции с виртуальной сетью, которая доступна в рамках подписки, но не подключена к виртуальной сети, в которой размещена среда ASE. Гибридные подключения можно использовать для получения доступа к ресурсам в других сетях в стандартном режиме.

Если для виртуальной сети настроено использование ExpressRoute или VPN, следует учитывать некоторые требования к маршрутизации в среде ASE. Некоторые конфигурации определяемых пользователем маршрутов не поддерживаются в среде ASE. Дополнительную информацию о настройке виртуальной сети с ExpressRoute для среды ASE см. в статье [Настройка виртуальной сети с ExpressRoute для среды службы приложений][ExpressRoute].

Можно также управлять доступом к приложениям с помощью групп безопасности сети. Эта возможность позволяет настроить среду службы приложений так, чтобы в ней использовались только нужные вам IP-адреса. Дополнительные сведения о том, как это сделать, см. в статье [Управление входящим трафиком в среде службы приложений](app-service-app-service-environment-control-inbound-traffic.md).

## Портал

Пользовательский интерфейс для мониторинга среды ASE и управления ею доступен на портале Azure. Если у вас есть среда ASE, возможно, вы захотите, чтобы на боковой панели отображался значок службы приложений. Этот значок используется для обозначения сред ASE на портале Azure.

![][1]

Щелкните этот значок или шеврон \(знак «больше чем»\) в нижней части боковой панели, а затем выберите «Среды службы приложений». Оба эти действия открывают пользовательский интерфейс со списком всех сред ASE. Выберите одну из приведенных сред ASE, чтобы открыть пользовательский интерфейс для мониторинга и управления.

![][2]

В первой колонке отображаются некоторые свойства среды ASE, а также диаграмма с метриками для пула ресурсов. Некоторые свойства представлены в разделе «Основные компоненты» в виде гиперссылок. Если щелкнуть какую-либо из них, откроется связанная колонка. Например, можно щелкнуть имя виртуальной сети, чтобы открыть пользовательский интерфейс виртуальной сети, в которой выполняется среда ASE. Если щелкнуть «Планы службы приложений» и «Приложения», откроются колонки со списком соответствующих элементов, размещенных в среде ASE.

### Мониторинг

На диаграммах отображены разные метрики производительности для каждого пула ресурсов. Что касается пула внешних интерфейсов, следует отслеживать средние показатели использования ЦП и памяти. В отношении рабочих пулов отслеживайте используемое и доступное количество рабочих ролей. Рабочие роли, входящие в рабочий пул, могут использоваться несколькими планами службы приложений. Рабочая нагрузка распространяется не так, как внешние серверы, поэтому данные по использованию ЦП и памяти не дают столько же ценной информации. Важнее отслеживать количество используемых и доступных рабочих ролей, особенно если вы управляете этой системой для других пользователей.

Все метрики, которые можно отслеживать на диаграммах, можно также использовать для настройки оповещений. Настройка оповещений является стандартной процедурой в рамках службы приложений. Настроить оповещение можно с помощью пользовательского интерфейса оповещений. Также вы можете выбрать команду «Добавить оповещение» в пользовательском интерфейсе нужной метрики.
 
![][3]

Упомянутые выше метрики — это метрики среды ASE. Но метрики также доступны на уровне плана службы приложений \(ASP\). Именно на этом уровне целесообразно отслеживать показатели использования ЦП и памяти. Все планы ASP в среде ASE являются выделенными. Иными словами, в план ASP включены только те приложения, которые запущены на выделенных этому плану узлах. Чтобы просмотреть подробную информацию о плане ASP, щелкните нужный план в любом списке в пользовательском интерфейсе среды ASE или выберите его из полного списка планов в разделе «Планы службы приложений».

### данных

В колонке ASE есть раздел параметров, содержащий несколько важных функций.

**Параметры \> Свойства** При переходе в колонку ASE автоматически открывается колонка "Параметры". В верхней части колонки находится раздел «Свойства». Наряду с элементами, которые повторяют данные из раздела «Основные компоненты», здесь также отображены и другие полезные сведения, включая виртуальный IP-адрес и исходящий IP-адрес.

![][4]

**Параметры \> IP-адреса** При создании приложения SSL на основе IP в ASE должен присутствовать адреса SSL на основе IP. Для этого в среде ASE должны быть адреса SSL на основе IP, которые можно выделить. Для этой цели в ASE добавляется 1 адрес SSL на основе IP, но позже адреса можно добавить. Дополнительные адреса SSL на основе IP предоставляются на платной основе, как указано в разделе "SSL-подключения" на странице [Цены на App Service][AppServicePricing]. Дополнительные цена — цена за SSL на основе IP.

**Параметры \> Пул внешних интерфейсов/рабочие пулы** В каждой из колонок пулов ресурсов можно просмотреть информацию об определенном пуле ресурсов и воспользоваться элементами управления, позволяющими полностью масштабировать этот пул ресурсов.

В основной колонке каждого пула ресурсов приведена диаграмма с метриками для этого пула. Как и с диаграммами в колонке ASE, вы можете перейти к параметрам диаграммы и настроить оповещения. Настройка оповещений для определенного пула ресурсов в колонке ASE аналогична настройке оповещений непосредственно в параметрах пула ресурсов. В колонке «Параметры» рабочего пула можно выбрать отображение списка всех приложений или планов ASP, запущенных в этом рабочем пуле.

![][5]

### Возможности масштабирования портала  

Существует три типа операций масштабирования:

- изменение количества IP-адресов, доступных в ASE для использования SSL на основе IP;
- изменение объема вычислительных ресурсов, используемых в пуле ресурсов;
- изменение объема вычислительных ресурсов, используемых в пуле ресурсов, вручную либо с помощью автоматического масштабирования.

На портале существует три способа управления количеством серверов в пулах ресурсов.

- Операция масштабирования в главной колонке ASE, которая расположена вверху. Все изменения в конфигурации масштабирования пулов внешних интерфейсов и рабочих пулов применяются за одну операцию.
- Операция ручного масштабирования в колонке "Масштаб" отдельного пула ресурсов, которая расположена в разделе "Параметры".
- Автомасштабирование, которое настраивается в колонке "Масштаб" отдельного пула ресурсов.

Чтобы выполнить масштабирование в колонке ASE, перетащите ползунок до требуемого количества и сохраните изменения. Здесь можно также изменить объем.

![][6]

Чтобы воспользоваться функциями ручного или автоматического масштабирования определенного пула ресурсов, выберите *Параметры \> Пул внешних интерфейсов/рабочие пулы* \(в зависимости от ситуации\) и откройте пул, который нужно изменить. Последовательно выберите пункты *Параметры \> Уменьшить масштаб или Параметры \> Увеличить масштаб *. Колонка *Уменьшить масштаб* позволяет контролировать число экземпляров. Колонка *Увеличить масштаб* позволяет контролировать размер ресурса.

![][7]

## Факторы устойчивости к сбоям

Среду службы приложений можно настроить для использования до 55 вычислительных ресурсов. Из этих 55 вычислительных ресурсов только 50 можно использовать для размещения рабочих нагрузок. Для этого есть две причины. Существует как минимум 2 вычислительных ресурса для интерфейсов. Остается максимум 53 ресурса для поддержки распределения пула работников. Для обеспечения отказоустойчивости необходимо иметь дополнительные вычислительные ресурсы, выделенные в соответствии со следующими правилами:

- для каждого рабочего пула требуется по крайней мере один дополнительный вычислительный ресурс, которому нельзя назначать рабочую нагрузку;
- если количество вычислительных ресурсов в рабочем пуле превышает определенное значение, для обеспечения отказоустойчивости требуется другой вычислительный ресурс. С пулом внешних интерфейсов дела обстоят иначе.

Согласно требованиям к отказоустойчивости любого пула работников данное значение X ресурсов назначается пулу работников при таких условиях:

- если переменная X — это число от 2 до 20, количество доступных вычислительных ресурсов, которые можно использовать для рабочих нагрузок, равно X-1;
- если переменная X — это число от 21 до 40, количество доступных вычислительных ресурсов, которые можно использовать для рабочих нагрузок, равно X-2;
- если переменная X — это число от 41 до 53, количество доступных вычислительных ресурсов, которые можно использовать для рабочих нагрузок, равно X-3.

Минимальная конфигурация включает 2 внешних сервера и 2 рабочих роли. Вот несколько примеров, объясняющих описанное выше.

- Если в одном пуле есть 30 рабочих ролей, для размещения рабочих нагрузок можно использовать 28. 
- Если в одном пуле есть две рабочих роли, для размещения рабочих нагрузок можно использовать одну.
- Если в одном пуле есть 20 рабочих ролей, для размещения рабочих нагрузок можно использовать 19.  
- Если в одном пуле есть 21 рабочая роль, для размещения рабочих нагрузок можно использовать только 19.  

Обеспечение отказоустойчивости — это важный аспект, однако при выполнении масштабирования сверх определенных пороговых значений следует помнить об упомянутых условиях. Если требуется увеличить емкость, имея 20 экземпляров, нужно использовать 22 экземпляра и более, так как вы не добьетесь увеличения емкости, используя 21 экземпляр. Аналогично, чтобы увеличить емкость, имея 40 экземпляров, нужно 42 экземпляра.

## Удаление среды службы приложений ##

Если вы хотите удалить среду службы приложений, просто воспользуйтесь действием удаления в верхней части колонки среды. После этого появится запрос на ввод имени среды ASE, чтобы вы могли подтвердить удаление. ПРИМЕЧАНИЕ. При удалении среды ASE также удаляется все ее содержимое.

![][9]

## Приступая к работе

Чтобы начать работу со средами службы приложений, см. статью [Создание среды службы приложений](app-service-web-how-to-create-an-app-service-environment.md).

Дополнительные сведения о платформе службы приложений Azure см. в статье [Служба приложений Azure](../app-service/app-service-value-prop-what-is.md).

[AZURE.INCLUDE [app-service-web-whats-changed](../../includes/app-service-web-whats-changed.md)]

[AZURE.INCLUDE [app-service-web-try-app-service](../../includes/app-service-web-try-app-service.md)]

<!--Image references-->
[1]: ./media/app-service-web-configure-an-app-service-environment/ase-icon.png
[2]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-aseblade.png
[3]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-poolchart.png
[4]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-properties.png
[5]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-poolblade.png
[6]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-scalecommand.png
[7]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-poolscale.png
[8]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-pricingtiers.png
[9]: ./media/app-service-web-configure-an-app-service-environment/aseconfig-deletease.png

<!--Links-->
[WhatisASE]: http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-intro/
[Appserviceplans]: http://azure.microsoft.com/documentation/articles/azure-web-sites-web-hosting-plans-in-depth-overview/
[HowtoCreateASE]: http://azure.microsoft.com/documentation/articles/app-service-web-how-to-create-an-app-service-environment/
[HowtoScale]: http://azure.microsoft.com/documentation/articles/app-service-web-scale-a-web-app-in-an-app-service-environment/
[ControlInbound]: http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-control-inbound-traffic/
[virtualnetwork]: https://azure.microsoft.com/documentation/articles/virtual-networks-faq/
[AppServicePricing]: http://azure.microsoft.com/pricing/details/app-service/
[AzureAppService]: http://azure.microsoft.com/documentation/articles/app-service-value-prop-what-is/
[ASEAutoscale]: http://azure.microsoft.com/documentation/articles/app-service-environment-auto-scale/
[ExpressRoute]: http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-network-configuration-expressroute/

<!---HONumber=AcomDC_0413_2016-->