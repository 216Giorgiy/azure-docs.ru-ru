<properties 
	pageTitle="Резервное копирование веб-приложений в службе приложений Azure" 
	description="Узнайте, как создавать резервные копии веб-приложений в службе приложений Azure." 
	services="app-service" 
	documentationCenter="" 
	authors="cephalin" 
	manager="wpickett" 
	editor="jimbe"/>

<tags 
	ms.service="app-service" 
	ms.workload="na" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/07/2015" 
	ms.author="cephalin"/>

# Резервное копирование веб-приложений в службе приложений Azure


Компонент резервного копирования и восстановления в [веб-приложениях службы приложений Azure](http://go.microsoft.com/fwlink/?LinkId=529714) позволяет легко создавать резервные копии веб-приложений вручную или автоматически. Вы можете восстановить предыдущее состояние веб-приложения или создать новое на основе одной из резервных копий исходного приложения.

Сведения о восстановлении веб-приложения Azure из резервной копии см. в статье [Восстановление веб-приложения](web-sites-restore.md).

[AZURE.INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

<a name="whatsbackedup"></a>
## Что включается в резервную копию 
Вот какая информация входит в резервную копию веб-приложения:

* конфигурация веб-приложения;
* содержимое файлов веб-приложения;
* подключенные к приложению базы данных SQL Azure или базы данных MySQL (вы можете выбрать конкретные базы для включения в резервную копию).

Эта информация копируется в указанные контейнер и учетную запись хранения Azure.

> [AZURE.NOTE]Каждая резервная копия является полной автономной копией приложения, а не добавочным обновлением.

<a name="requirements"></a>
## Требования и ограничения

* Компонент резервного копирования и восстановления требует, чтобы план службы приложений находился на уровне "Стандартный" или выше. Дополнительные сведения о масштабировании плана службы приложений для использования более высокого уровня см. в статье [Масштабирование веб-приложения в службе приложений Azure](web-sites-scale.md). Обратите внимание, что уровень "Премиум" позволяет создавать большее количество ежедневных резервных копий по сравнению с уровнем "Стандартный".

* Компоненту резервного копирования и восстановления требуется учетная запись хранения Azure и контейнер, принадлежащие к той же подписке, что и веб-приложение, резервную копию которого вы собираетесь создать. Если у вас еще нет учетной записи хранения, вы можете создать ее, щелкнув элемент **Учетная запись хранения** в колонке **Резервные копии** на [портале Azure](http://portal.azure.com) и выбрав **учетную запись хранения** и **контейнер** из колонки **Место назначения**. Дополнительные сведения об учетных записях хранения Azure см. в [ссылках](#moreaboutstorage) в конце этой статьи.

* Компонент резервного копирования и восстановления поддерживает содержимое веб-сайта и базы данных объемом до 10 ГБ. Если компонент резервного копирования не может работать, поскольку объем полезных данных превышает этот предел, возникает ошибка.

<a name="manualbackup"></a>
## Создание резервной копии вручную

1. Выберите веб-приложение в колонке "Веб-приложения" на портале Azure. В результате в новой колонке появятся подробные сведения о веб-приложении.
2. В колонке вашего приложения выберите **Параметры**, а затем **Резервные копии**. Откроется колонка **Резервные копии**.
	
	![Страница резервных копий][ChooseBackupsPage]

3. В колонке **Резервные копии** щелкните **Хранилище: не настроено** для настройки учетной записи хранения.

	![Выбор учетной записи хранения][ChooseStorageAccount]
	
4. Выберите расположение резервной копии, щелкнув элементы **Учетная запись хранения** и **Контейнер**. Эта учетная запись хранения должна принадлежать к той же подписке, что и веб-приложение, резервную копию которого вы собираетесь создать. При необходимости в соответствующих колонках можно создать новую учетную запись хранения или новый контейнер. Закончив, щелкните **Выбрать**.
	
	![Выбор учетной записи хранения](./media/web-sites-backup/02ChooseStorageAccount1.png)
	
5. В колонке **Настройка параметров резервного копирования**, которая по-прежнему открыта, щелкните **Параметры базы данных**, выберите базы данных, которые необходимо включить в резервные копии (база данных SQL или MySQL), а затем нажмите кнопку **ОК**.

	![Выбор учетной записи хранения](./media/web-sites-backup/03ConfigureDatabase.png)

	> [AZURE.NOTE] Чтобы база данных появилась в этом списке, ее строка подключения должна присутствовать в разделе **Строки подключения** колонки **Параметры веб-приложения** на этом портале.

6. В колонке **Настройка параметров резервного копирования** нажмите кнопку **Сохранить**.
6. В колонке **Резервные копии** щелкните элемент **Расположение резервной копии**. Выберите существующую учетную запись хранилища и контейнер.
7. В командной строке колонки **Резервные копии** щелкните **Выполнить архивацию**.
	
	![Кнопка создания резервной копии][BackUpNow]
	
	Во время процесса резервного копирования отображается сообщение о ходе выполнения.
	

В любое время можно выполнить резервное копирование вручную.

<a name="automatedbackups"></a>
## Настройка автоматического резервного копирования

1. В колонке **Резервные копии** щелкните **Расписание: не настроено**. 

	![Выбор учетной записи хранения](./media/web-sites-backup/05ScheduleBackup.png)
	
1. В колонке **Параметры расписания архивации** выберите для параметра **Архивация по расписанию** значение **Включить**, а затем настройте необходимое расписание резервного копирования и нажмите кнопку **ОК**.
	
	![Включение автоматически создаваемых резервных копий][SetAutomatedBackupOn]
	
4. В колонке **Настройка параметров резервного копирования**, которая по-прежнему открыта, щелкните элемент **Параметры хранилища**, а затем выберите расположение резервной копии, щелкнув элементы **Учетная запись хранения** и **Контейнер**. Эта учетная запись хранения должна принадлежать к той же подписке, что и веб-приложение, резервную копию которого вы собираетесь создать. При необходимости в соответствующих колонках можно создать новую учетную запись хранения или новый контейнер. Закончив, щелкните **Выбрать**.
	
	![Выбор учетной записи хранения](./media/web-sites-backup/02ChooseStorageAccount1.png)
	
5. В колонке **Настройка параметров резервного копирования** щелкните **Параметры базы данных**, выберите базы данных, которые необходимо включить в резервные копии (база данных SQL или MySQL), а затем нажмите кнопку **ОК**.

	![Выбор учетной записи хранения](./media/web-sites-backup/03ConfigureDatabase.png)

	> [AZURE.NOTE] Чтобы база данных появилась в этом списке, ее строка подключения должна присутствовать в разделе **Строки подключения** колонки **Параметры веб-приложения** на этом портале.

6. В колонке **Настройка параметров резервного копирования** нажмите кнопку **Сохранить**.

<a name="notes"></a>
## Примечания

* Чтобы компонент резервного копирования и восстановления мог включить ваши базы данных, убедитесь, что вы правильно настроили строки подключения для каждой базы данных в колонке **Параметры веб-приложения** раздела **Параметры**.

>[AZURE.NOTE] Чтобы приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.

<a name="partialbackups"></a>
## Создание резервной копии части веб-приложения

Иногда не нужно создавать резервную копию всего веб-приложения. Вот несколько таких случаев.

-	У вас [настроено еженедельное резервное копирование](web-sites-backup.md#configure-automated-backups) веб-приложения со статическим содержимым, которое никогда не меняется, например старые записи блога или изображения.
-	Размер содержимого веб-приложения составляет 10 ГБ (т. е. максимальный размер резервной копии, которую можно создать за раз).
-	Не нужно создавать резервную копию файлов журнала.

Частичное резервное копирование позволяет выбрать только те файлы, для которых нужно создать резервную копию.

### Исключение файлов из резервной копии

Чтобы исключить файлы и папки из резервных копий, в папке wwwroot веб-приложения создайте файл `_backup.filter` и укажите в нем список файлов и папок, которые необходимо исключить. Сделать это можно с помощью [консоли Kudu](https://github.com/projectkudu/kudu/wiki/Kudu-console).

Допустим, есть сайт, содержащий неизменяемые файлы журнала и статические изображения, собранные за последние несколько лет. У вас уже есть полная резервная копия веб-приложения, которое содержит старые изображения. Выполнять резервное копирование веб-приложения нужно каждый день, но зачем платить за хранение неизменяемых файлов журнала или файлов статических изображений?

![Папка журналов][LogsFolder]
![Папка с изображениями][ImagesFolder]
	
В приведенных ниже шагах показано, как исключить эти файлы из резервной копии.

1. Перейдите по адресу `http://{yourapp}.scm.azurewebsites.net/DebugConsole` и укажите папки, которые нужно исключить из резервных копий. В этом примере необходимо исключить файлы и папки, отображенные в пользовательском интерфейсе.

		D:\home\site\wwwroot\Logs
		D:\home\LogFiles
		D:\home\site\wwwroot\Images\2013
		D:\home\site\wwwroot\Images\2014
		D:\home\site\wwwroot\Images\brand.png

	[AZURE.NOTE]Последняя строка показывает, что можно исключать отдельные файлы и папки.

2. Создайте файл с именем `_backup.filter` и поместите в него приведенный выше список, при этом удалив `D:\home`. В одной строке указывайте один каталог или файл. В результате содержимое файла будет выглядеть так:

    \site\wwwroot\Logs \LogFiles \site\wwwroot\Images\2013 \site\wwwroot\Images\2014 \site\wwwroot\Images\brand.png

3. Отправьте этот файл в каталог `D:\home\site\wwwroot` своего сайта с помощью [ftp](web-sites-deploy.md#ftp) или любым другим способом. При желании можно создать файл непосредственно в `http://{yourapp}.scm.azurewebsites.net/DebugConsole` и вставить в него содержимое.

4. Выполните резервное копирование привычным для вас способом — [вручную](#create-a-manual-backup) или [автоматически](#configure-automated-backups).

Теперь все файлы и папки, указанные в `_backup.filter`, будут исключены из резервной копии. В этом примере больше не будет выполняться резервное копирование файлов журналов и изображений за 2013 и 2014 гг., а также файла brand.png.

>[AZURE.NOTE]Восстановление частичных резервных копий сайта происходит так же, как и [восстановление обычных резервных копий](web-sites-restore.md). Восстановление будет выполнено правильно.
>
>При восстановлении полной резервной копии все содержимое сайта заменяется содержимым из резервной копии. Если файл, который находится на сайте, не включен в резервную копию, он удаляется. Однако при восстановлении частичной резервной копии все содержимое, которое находится в каталогах или файлах из черного списка, остается неизменным.

<a name="aboutbackups"></a>

## Как хранятся резервные копии

После создания одной или нескольких резервных копий веб-приложения они отображаются в колонке **Контейнеры** вашей учетной записи хранения, а также в веб-приложении. В учетной записи хранения каждая резервная копия состоит из ZIP-файла с резервной копией данных и XML-файла с манифестом для содержимого ZIP-файла. Эти файлы можно распаковать и просмотреть, если необходимо получить доступ к резервным копиям без фактического восстановления веб-приложения.

Резервная копия базы данных веб-приложения хранится в корне ZIP-файла. Для базы данных SQL это файл BACPAC (без расширения), и его можно импортировать. Инструкции по созданию новой базы данных SQL на основе экспорта BACPAC см. в статье [Импорт файла BACPAC для создания новой базы данных пользователя](http://technet.microsoft.com/library/hh710052.aspx).

> [AZURE.WARNING]Изменение любого из этих файлов в контейнере **websitebackups** может привести к повреждению резервной копии и сделать восстановление из нее невозможным.

<a name="nextsteps"></a>
## Дальнейшие действия
Сведения о восстановлении веб-приложения из резервной копии см. в статье [Восстановление веб-приложения в службе приложений Azure](web-sites-restore.md). Для создания резервной копии и восстановления приложений службы приложений можно также использовать API REST (см. статью [Использование REST для резервного копирования и восстановления приложений службы приложений](websites-csm-backup.md)).

Чтобы начать работу с Azure, см. раздел [Бесплатная пробная версия Microsoft Azure](/pricing/free-trial/).

## Изменения
* Указания по изменениям при переходе от веб-сайтов к службе приложений см. в разделе [Служба приложений Azure и ее влияние на существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714).

<!-- IMAGES -->
[ChooseBackupsPage]: ./media/web-sites-backup/01ChooseBackupsPage.png
[ChooseStorageAccount]: ./media/web-sites-backup/02ChooseStorageAccount.png
[IncludedDatabases]: ./media/web-sites-backup/03IncludedDatabases.png
[BackUpNow]: ./media/web-sites-backup/04BackUpNow.png
[BackupProgress]: ./media/web-sites-backup/05BackupProgress.png
[SetAutomatedBackupOn]: ./media/web-sites-backup/06SetAutomatedBackupOn.png
[Frequency]: ./media/web-sites-backup/07Frequency.png
[StartDate]: ./media/web-sites-backup/08StartDate.png
[StartTime]: ./media/web-sites-backup/09StartTime.png
[SaveIcon]: ./media/web-sites-backup/10SaveIcon.png
[ImagesFolder]: ./media/web-sites-backup/11Images.png
[LogsFolder]: ./media/web-sites-backup/12Logs.png
[GhostUpgradeWarning]: ./media/web-sites-backup/13GhostUpgradeWarning.png
 

<!---HONumber=AcomDC_0114_2016-->