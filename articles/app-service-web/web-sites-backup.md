---
title: Архивация приложения в Azure
description: Узнайте, как создавать резервные копии приложений в службе приложений Azure.
services: app-service
documentationcenter: ''
author: cephalin
manager: wpickett
editor: jimbe

ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/06/2016
ms.author: cephalin

---
# Архивация приложения в Azure
Функция архивации и восстановления в [службе приложений Azure](../app-service/app-service-value-prop-what-is.md) позволяет легко создавать резервные копии приложений вручную или автоматически. Вы можете восстановить предыдущее состояние приложения или создать новое на основе одной из резервных копий исходного приложения.

Сведения о восстановлении приложения из резервной копии см. в статье [Восстановление приложения в службе приложений Azure](web-sites-restore.md).

<a name="whatsbackedup"></a>

## Что входит в резервную копию
Служба приложений может архивировать следующие данные:

* конфигурация приложения;
* содержимое файла;
* подключенные к приложению базы данных SQL Azure или базы данных MySQL Azure (ClearDB) (вы можете выбрать конкретные базы для включения в резервную копию).

Эта информация копируется в указанные контейнер и учетную запись хранения Azure.

> [!NOTE]
> Каждая резервная копия является полной автономной копией приложения, а не добавочным обновлением.
> 
> 

<a name="requirements"></a>

## Требования и ограничения
* Для использования архивации и восстановления требуется, чтобы у плана службы приложений был уровень **Стандартный** или выше. Дополнительные сведения о масштабировании плана службы приложений для использования более высокого уровня см. в статье [Масштабирование веб-приложения в службе приложений Azure](web-sites-scale.md). Обратите внимание, что уровень **Премиум** позволяет создавать большее количество ежедневных резервных копий по сравнению с уровнем **Стандартный**.
* Для архивации требуется учетная запись хранения Azure и контейнер в той же подписке, что и приложение, для которого вы хотите создавать резервные копии. Дополнительные сведения об учетных записях хранения Azure см. в [ссылках](#moreaboutstorage) в конце этой статьи.
* Резервная копия может вмещать до 10 ГБ содержимого приложения и базы данных. Если размер резервной копии превысит этот лимит, отобразится сообщение об ошибке.

<a name="manualbackup"></a>

## Создание резервной копии вручную
1. На [портале Azure](https://portal.azure.com) перейдите к колонке своего приложения и выберите **Параметры** > **Резервные копии**. Откроется колонка **Резервные копии**.
   
    ![Страница резервных копий][ChooseBackupsPage]
   
   > [!NOTE]
   > Если вы видите сообщение, приведенное ниже, щелкните его, чтобы обновить план службы приложений, прежде чем продолжить архивацию. Дополнительные сведения см. в разделе [Масштабирование веб-приложения в службе приложений Azure](web-sites-scale.md). ![Выбор учетной записи хранения](./media/web-sites-backup/01UpgradePlan.png)
   > 
   > 
2. В колонке **Резервные копии** щелкните **Хранилище: не настроено** для настройки учетной записи хранения.
   
    ![Выбор учетной записи хранения][ChooseStorageAccount]
3. Выберите расположение резервной копии, щелкнув элементы **Учетная запись хранения** и **Контейнер**. Эта учетная запись хранения должна принадлежать к той же подписке, что и приложение, резервную копию которого вы собираетесь создать. При необходимости в соответствующих колонках можно создать новую учетную запись хранения или новый контейнер. Закончив, щелкните **Выбрать**.
   
    ![Выбор учетной записи хранения](./media/web-sites-backup/02ChooseStorageAccount1.png)
4. В колонке **Настройка параметров резервного копирования**, которая по-прежнему открыта, щелкните **Параметры базы данных**, выберите базы данных, которые необходимо включить в резервные копии (база данных SQL или MySQL), а затем нажмите кнопку **ОК**.
   
    ![Выбор учетной записи хранения](./media/web-sites-backup/03ConfigureDatabase.png)
   
   > [!NOTE]
   > Чтобы база данных появилась в этом списке, ее строка подключения должна присутствовать в разделе **Строки подключения** колонки **Параметры приложения** вашего приложения.
   > 
   > 
5. В колонке **Настройка параметров резервного копирования** нажмите кнопку **Сохранить**.
6. В командной строке колонки **Резервные копии** щелкните **Выполнить архивацию**.
   
    ![Кнопка создания резервной копии][BackUpNow]
   
    Во время процесса резервного копирования отображается сообщение о ходе выполнения.

После настройки учетной записи хранения и контейнера для резервных копий можно в любой момент создать резервную копию вручную.

<a name="automatedbackups"></a>

## Настройка автоматического резервного копирования
1. В колонке **Резервные копии** щелкните **Расписание: не настроено**.
   
    ![Выбор учетной записи хранения](./media/web-sites-backup/05ScheduleBackup.png)
2. В колонке **Параметры расписания архивации** выберите для параметра **Архивация по расписанию** значение **Включить**, а затем настройте необходимое расписание резервного копирования и нажмите кнопку **ОК**.
   
    ![Включение автоматически создаваемых резервных копий][SetAutomatedBackupOn]
3. В колонке **Настройка параметров резервного копирования**, которая по-прежнему открыта, щелкните элемент **Параметры хранилища**, а затем выберите расположение резервной копии, щелкнув элементы **Учетная запись хранения** и **Контейнер**. Эта учетная запись хранения должна принадлежать к той же подписке, что и приложение, резервную копию которого вы собираетесь создать. При необходимости в соответствующих колонках можно создать новую учетную запись хранения или новый контейнер. Закончив, щелкните **Выбрать**.
   
    ![Выбор учетной записи хранения](./media/web-sites-backup/02ChooseStorageAccount1.png)
4. В колонке **Настройка параметров резервного копирования** щелкните **Параметры базы данных**, выберите базы данных, которые необходимо включить в резервные копии (база данных SQL или MySQL), а затем нажмите кнопку **ОК**.
   
    ![Выбор учетной записи хранения](./media/web-sites-backup/03ConfigureDatabase.png)
   
   > [!NOTE]
   > Чтобы база данных появилась в этом списке, ее строка подключения должна присутствовать в разделе **Строки подключения** колонки **Параметры приложения** вашего приложения.
   > 
   > 
5. В колонке **Настройка параметров резервного копирования** нажмите кнопку **Сохранить**.

<a name="partialbackups"></a>

## Создание резервной копии части приложения
Иногда не нужно создавать резервную копию всего приложения. Вот несколько таких случаев.

* У вас [настроена еженедельная архивация](web-sites-backup.md#configure-automated-backups) приложения со статическим содержимым, которое никогда не меняется. Это могут быть старые записи блога или изображения.
* Размер содержимого приложения превышает 10 ГБ (т. е. максимальный размер резервной копии, которую можно создать за раз).
* Не нужно создавать резервную копию файлов журнала.

Частичное резервное копирование позволяет выбрать только те файлы, для которых нужно создать резервную копию.

### Исключение файлов из резервной копии
Чтобы исключить файлы и папки из создаваемых резервных копий, в папке D:\\home\\site\\wwwroot приложения создайте файл `_backup.filter` и укажите в нем список файлов и папок, которые необходимо исключить. Сделать это можно с помощью [консоли Kudu](https://github.com/projectkudu/kudu/wiki/Kudu-console).

Допустим, есть приложение, содержащее неизменяемые файлы журнала и статические изображения, собранные за последние несколько лет. У вас уже есть полная резервная копия приложения, которая содержит старые изображения. Теперь архивировать приложение нужно каждый день, но зачем платить за хранение неизменяемых файлов журнала или файлов статических изображений?

![Папка журналов][LogsFolder]
![Папка с изображениями][ImagesFolder]

В приведенных ниже шагах показано, как исключить эти файлы из резервной копии.

1. Перейдите по адресу `http://{yourapp}.scm.azurewebsites.net/DebugConsole` и укажите папки, которые нужно исключить из резервных копий. В этом примере необходимо исключить файлы и папки, отображенные в пользовательском интерфейсе.
   
        D:\home\site\wwwroot\Logs
        D:\home\LogFiles
        D:\home\site\wwwroot\Images\2013
        D:\home\site\wwwroot\Images\2014
        D:\home\site\wwwroot\Images\brand.png
   
    [AZURE.NOTE] Последняя строка показывает, что можно исключать отдельные файлы и папки.
2. Создайте файл с именем `_backup.filter` и поместите в него приведенный выше список, при этом удалив `D:\home`. В одной строке указывайте один каталог или файл. В результате содержимое файла будет выглядеть так:
   
    \\site\\wwwroot\\Logs \\LogFiles \\site\\wwwroot\\Images\\2013 \\site\\wwwroot\\Images\\2014 \\site\\wwwroot\\Images\\brand.png
3. Отправьте этот файл в каталог `D:\home\site\wwwroot` своего сайта с помощью [ftp](web-sites-deploy.md#ftp) или любым другим способом. При желании можно создать файл непосредственно в `http://{yourapp}.scm.azurewebsites.net/DebugConsole` и вставить в него содержимое.
4. Выполните резервное копирование привычным для вас способом — [вручную](#create-a-manual-backup) или [автоматически](#configure-automated-backups).

Теперь все файлы и папки, указанные в `_backup.filter`, будут исключены из резервной копии. В этом примере больше не будет выполняться резервное копирование файлов журналов и изображений за 2013 и 2014 гг., а также файла brand.png.

> [!NOTE]
> Восстановление частичных резервных копий сайта происходит так же, как и [восстановление обычных резервных копий](web-sites-restore.md). Восстановление будет выполнено правильно.
> 
> При восстановлении полной резервной копии все содержимое сайта заменяется содержимым из резервной копии. Если файл, который находится на сайте, не включен в резервную копию, он удаляется. Однако при восстановлении частичной резервной копии все содержимое, которое находится в каталогах или файлах из черного списка, остается неизменным.
> 
> 

<a name="aboutbackups"></a>

## Как хранятся резервные копии
После создания одной или нескольких резервных копий приложения они отображаются в колонке **Контейнеры** вашей учетной записи хранения, как и ваше приложение. В учетной записи хранения каждая резервная копия состоит из ZIP-файла с резервной копией данных и XML-файла с манифестом для содержимого ZIP-файла. Эти файлы можно распаковать и просмотреть, если необходимо получить доступ к резервным копиям без фактического восстановления приложения.

Резервная копия базы данных приложения хранится в корне ZIP-файла. Для базы данных SQL это файл BACPAC (без расширения), и его можно импортировать. Инструкции по созданию новой базы данных SQL на основе экспорта BACPAC см. в статье [Импорт файла BACPAC для создания новой базы данных пользователя](http://technet.microsoft.com/library/hh710052.aspx).

> [!WARNING]
> Изменение любого из этих файлов в контейнере **websitebackups** может привести к повреждению резервной копии и сделать восстановление из нее невозможным.
> 
> 

<a name="nextsteps"></a>

## Дальнейшие действия
Сведения о восстановлении приложения из резервной копии см. в статье [Восстановление приложения в службе приложений Azure](web-sites-restore.md). Для архивации и восстановления приложений службы приложений можно также использовать REST API (см. статью [Использование REST для резервного копирования и восстановления приложений службы приложений](websites-csm-backup.md)).

> [!NOTE]
> Чтобы приступить к работе со службой приложений Azure до создания учетной записи Azure, перейдите к разделу [Пробное использование службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751), где вы можете быстро создать кратковременное веб-приложение начального уровня в службе приложений. Никаких кредитных карт и обязательств.
> 
> 

<!-- IMAGES -->
[ChooseBackupsPage]: ./media/web-sites-backup/01ChooseBackupsPage.png
[ChooseStorageAccount]: ./media/web-sites-backup/02ChooseStorageAccount.png
[IncludedDatabases]: ./media/web-sites-backup/03IncludedDatabases.png
[BackUpNow]: ./media/web-sites-backup/04BackUpNow.png
[BackupProgress]: ./media/web-sites-backup/05BackupProgress.png
[SetAutomatedBackupOn]: ./media/web-sites-backup/06SetAutomatedBackupOn.png
[Frequency]: ./media/web-sites-backup/07Frequency.png
[StartDate]: ./media/web-sites-backup/08StartDate.png
[StartTime]: ./media/web-sites-backup/09StartTime.png
[SaveIcon]: ./media/web-sites-backup/10SaveIcon.png
[ImagesFolder]: ./media/web-sites-backup/11Images.png
[LogsFolder]: ./media/web-sites-backup/12Logs.png
[GhostUpgradeWarning]: ./media/web-sites-backup/13GhostUpgradeWarning.png


<!---HONumber=AcomDC_0810_2016-->