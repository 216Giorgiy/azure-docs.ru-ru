---
title: "Мониторинг веб-приложения | Документы Майкрософт"
description: "Узнайте, как настроить мониторинг веб-приложения"
services: App-Service
keywords: 
author: btardif
ms.author: byvinyal
ms.date: 04/04/2017
ms.topic: article
ms.service: app-service-web
translationtype: Human Translation
ms.sourcegitcommit: e851a3e1b0598345dc8bfdd4341eb1dfb9f6fb5d
ms.openlocfilehash: 63bfc6922de224f56186003991f4a51d8f99ed35
ms.lasthandoff: 04/15/2017

---
# <a name="monitor-app-service"></a>Мониторинг службы приложений
В этом учебнике показано, как отслеживать ваше приложение, размещенное в службе приложений Azure, и выполнять диагностику для этого приложения с помощью встроенных средств платформы. 

## <a name="in-this-tutorial"></a>В этом учебнике рассматриваются следующие темы:

1. [Обозреватель процессов](#explorer)
    - Получите подробные сведения о приложении, которое запущено в экземплярах плана службы приложений
1. [Метрики службы приложений](#metrics) 
   - Узнайте, как отслеживать приложение с помощью встроенных диаграмм
   - Настройте диаграммы в соответствии со своими потребностями
   - Создайте пользовательскую панель мониторинга, закрепляя пользовательские диаграммы
1. [Настройка оповещений](#alerts)
    - Узнайте, как настроить оповещения для приложения и плана службы приложений
1. [Вспомогательное приложение для службы приложений](#Companion)
    - Отслеживайте свое приложение и устраняйте неполадки с помощью мобильных устройств.
1. [Настройка ведения журналов](#logging)
    - Узнайте, как собирать данные из журналов сервера и приложения.
    - Узнайте, где можно хранить журналы и как к ним обращаться.
1. [Потоковая передача журналов](#streaming)
    - Используйте потоковую передачу журналов, чтобы просматривать записи в журналах приложения и wc3 при их появлении.
1. [Удаленная отладка](#remote)
    - Используйте Visual Studio для удаленной отладки проекта, запущенного в службе приложений.
1. [Диагностика и решение проблем](#diagnose)
    - Определяйте проблемы, связанные с вашим приложением, и получайте сведения о том, как их решить.
1. [Application Insights](#insights)
    - Дополнительное профилирование и мониторинг приложения

## <a name="before-you-begin"></a>Перед началом работы

- Для выполнения описанных действий вам понадобится веб-приложение, которое и будет отслеживаться. 
    - Чтобы создать приложение, можно выполнить действия, описанные в руководстве [Создание приложения ASP.NET в Azure с подключением к базе данных SQL](app-service-web-tutorial-dotnet-sqldatabase.md).

- Если вы хотите попробовать **удаленную отладку** приложения, потребуется Visual Studio. 
    - Если вы еще не установили Visual Studio 2017, вы можете скачать и использовать бесплатную среду [Visual Studio 2017 Community Edition](https://www.visualstudio.com/downloads/). 
    - При установке Visual Studio необходимо включить возможность **разработки для Azure**.

## <a name="explorer"></a> Шаг 1. Обозреватель процессов

Обозреватель процессов — это средство, которое позволяет получить подробные сведения о внутренней работе плана службы приложений.

С помощью **обозревателя процессов** можно выполнять следующие действия:

- Получить список всех процессов для различных экземпляров плана службы приложений.
- Просматривать подробные сведения о каждом процессе, в том числе дескрипторы и модули. 
- Просматривать сведения об использовании ЦП, рабочих наборах и количестве потоков на уровне процесса, чтобы определить процессы, выходящие за допустимые пределы.
- Находить открытые дескрипторы файлов и даже завершать конкретные экземпляры процессов.

Чтобы открыть обозреватель процессов, выберите **Мониторинг** > **Обозреватель процессов**.

![Обозреватель процессов](media/app-service-web-tutorial-monitoring/app-service-monitor-processexplorer.png)

## <a name="metrics"></a> Шаг 2. Просмотр метрик службы приложений
**Метрики** предоставляют подробные сведения о веб-приложении и о его взаимодействии с пользователями и с платформой.

С помощью метрик вы сможете узнать:
- сколько ресурсов использует ваше приложение;
- объем трафика для вашего приложения;
- общее количество запросов и сбоев;
- объем принятых и переданных данных.

Для любого приложения, размещенного в службе приложений, необходимо отслеживать веб-приложения и план службы приложений.

- Метрики **приложения** содержат сведения о количестве HTTP-запросов и сбоев и о среднем времени ответа.
- Метрики **плана службы приложений** предоставляют сведения об использовании ресурсов.

На портале Azure можно быстро визуально оценить метрики приложения с помощью **Azure Monitor**.

- Перейдите в колонку **Обзор** приложения, которое требуется отслеживать.

![Мониторинг приложения](media/app-service-web-tutorial-monitoring/app-service-monitor.png)

- Метрики приложения можно просмотреть в **элементе "Мониторинг"**.
- Щелкните элемент, чтобы изменить и настроить отображаемые метрики и интервал времени.

![Настройка диаграммы](media/app-service-web-tutorial-monitoring/app-service-monitor-configure.png)

- Пользовательские диаграммы можно закреплять на панели мониторинга для быстрого и удобного доступа.

![Закрепление диаграммы](media/app-service-web-tutorial-monitoring/app-service-monitor-pin.png)

> [!TIP]
> Дополнительные сведения об Azure Monitor доступны в следующих разделах:
> - [Приступая к работе с Azure Monitor](..\monitoring-and-diagnostics\monitoring-overview.md)
> - [Метрики Azure](..\monitoring-and-diagnostics\monitoring-overview-metrics.md)
> - [Метрики, поддерживаемые Azure Monitor](..\monitoring-and-diagnostics\monitoring-supported-metrics.md#microsoftwebsites-including-functions)
> - [Панели мониторинга на портале Azure](..\azure-portal\azure-portal-dashboards.md)

## <a name="alerts"></a> Шаг 3. Настройка оповещений

С помощью **оповещений** можно автоматизировать мониторинг приложения.

Используйте оповещения, чтобы узнать о появлении интересных условий, влияющих на ваше приложение.

Чтобы создать оповещение, выполните следующие действия:
- Перейдите в колонку **Обзор** приложения, которое требуется отслеживать.
- В меню выберите **Мониторинг** > **Оповещения**
- Выберите **[+] Добавить оповещение**
- Настройте параметры оповещения.

![Оповещения](media/app-service-web-tutorial-monitoring/app-service-monitor-alerts.png)

> [!TIP]
> Дополнительные сведения об оповещениях Azure доступны в следующих разделах:
> - [Что такое оповещения в Microsoft Azure](..\monitoring-and-diagnostics\monitoring-overview-alerts.md)
> - [Действия с метриками](..\monitoring-and-diagnostics\monitoring-overview.md)

## <a name="companion"></a> Шаг 4. Вспомогательное приложение для службы приложений
С помощью **вспомогательного приложения для службы приложений** можно удобно отслеживать приложение с привычным интерфейсом на мобильном устройстве (iOS или Android).

Вспомогательное приложение для службы приложений Azure позволяет выполнять следующие действия:
- Просматривать метрики приложения.
- Просматривать уведомления для приложения и выполнять необходимые действия, а также получать рекомендации.
- Выполнять базовые действия при устранении неполадок (просмотр, запуск, остановка, перезапуск приложения).
- Получать push-уведомления о важных событиях.

![Вспомогательное приложение для службы приложений](media/app-service-web-tutorial-monitoring/app-service-companion.png)

[![Вспомогательное приложение для службы приложений в магазине приложений](media/app-service-web-tutorial-monitoring/app-service-companion-appStore.png)](https://itunes.apple.com/app/azure-app-service-companion/id1146659260)
[![Вспомогательное приложение для службы приложений в Google Play](media/app-service-web-tutorial-monitoring/app-service-companion-googlePlay.png)](https://play.google.com/store/apps/details?id=azureApps.AzureApps)

Вспомогательное приложение для службы приложений можно установить из [магазина приложений](https://itunes.apple.com/app/azure-app-service-companion/id1146659260) или [Google Play](https://play.google.com/store/apps/details?id=azureApps.AzureApps)

## <a name="logging"></a> Шаг 5. Ведение журналов
Ведение журналов позволяет собирать сведения из журналов **диагностики приложений** и **диагностики веб-сервера** для веб-приложения.

Используйте журналы диагностики, чтобы понять поведение приложения, устранить неполадки приложения и определить условия ошибок.

### <a name="application-diagnostics"></a>Диагностика приложений
Диагностика приложений позволяет записывать сведения трассировки, создаваемые приложением во время выполнения. 

Чтобы включить ведение журналов приложений, выполните следующие действия:

- Выберите **Мониторинг** > **Журналы диагностики**. 
- Включите ведение журналов приложений с помощью переключателей.

Журналы приложений можно хранить в файловой системе веб-приложения или отправлять в хранилище BLOB-объектов.

> [!TIP]
> В рабочей среде рекомендуется использовать хранилище BLOB-объектов.

![Мониторинг приложения](media/app-service-web-tutorial-monitoring/app-service-monitor-applogs.png)

В ASP.NET можно воспользоваться [классом System.Diagnostics.Trace](https://msdn.microsoft.com/library/system.diagnostics.trace.aspx) для создания событий трассировки приложений, которые будут зафиксированы инфраструктурой ведения журналов и записаны в журнал. Для упрощения фильтрации записей также можно указать уровень важности трассировки.

```csharp
public ActionResult Delete(Guid? id)
{
    System.Diagnostics.Trace.TraceInformation("GET /Todos/Delete/" + id);
    if (id == null)
    {
        System.Diagnostics.Trace.TraceError("/Todos/Delete/ failed, ID is null");
        return new HttpStatusCodeResult(HttpStatusCode.BadRequest);
    }
    Todo todo = db.Todoes.Find(id);
    if (todo == null)
    {
        System.Diagnostics.Trace.TraceWarning("/Todos/Delete/ failed, ID: " + id + " could not be found");
        return HttpNotFound();
    }
    System.Diagnostics.Trace.TraceInformation("GET /Todos/Delete/" + id + "completed successfully");
    return View(todo);
}
```

> [!IMPORTANT]
> Ведение журналов оказывает влияние на производительность приложения и использование ресурсов. В рабочей среде рекомендуется вести журналы ошибок. Более подробное ведение журнала следует использовать только при устранении ошибок.

 ### <a name="web-server-diagnostics"></a>Диагностика веб-сервера
Служба приложений может собирать сведения для трех различных типов журналов сервера:

- **Ведение журнала веб-сервера** 
    - Сведения об HTTP-транзакциях в [расширенном формате файла журнала W3C](https://msdn.microsoft.com/library/windows/desktop/aa814385.aspx). 
    - Это удобно при определении общих показателей сайта, например количества обработанных запросов или количества запросов, поступивших с определенного IP-адреса.
- **Ведение журнала подробных ошибок** 
    - Подробные сведения об ошибке для кодов состояния HTTP, которые указывают на сбой (код состояния 400 и выше). 
- **Трассировка невыполненных запросов** 
    - Подробные сведения о невыполненных запросах, включая трассировку компонентов IIS, использованных для обработки запроса, и время, потраченное для каждого компонента. 
    - Журналы невыполненных запросов особенно удобны при выявлении причины конкретной ошибки HTTP.

Чтобы включить ведение журнала сервера, выполните следующие действия:
- Выберите **Мониторинг** > **Журналы диагностики**. 
- Включите различные типы диагностики веб-сервера с помощью переключателей.

![Мониторинг приложения](media/app-service-web-tutorial-monitoring/app-service-monitor-serverlogs.png)

> [!IMPORTANT]
> Ведение журналов оказывает влияние на производительность приложения и использование ресурсов. В рабочей среде рекомендуется вести журналы ошибок. Более подробное ведение журнала следует использовать только при устранении ошибок.

### <a name="accessing-logs"></a>Доступ к журналам
Для доступа к журналам в хранилище BLOB-объектов используется обозреватель хранилищ Azure.

Для доступа к журналам в файловой системе веб-приложения используется протокол FTP. Журналы доступны по следующим путям:

- **Журналы приложений** — /LogFiles/Application/. 
    - Эта папка содержит один или несколько текстовых файлов со сведениями, созданными при ведении журнала приложения.
- **Трассировка невыполненных запросов** — /LogFiles/W3SVC#########/. 
    - Эта папка содержит XSL-файл и один или несколько XML-файлов. 
- **Подробные журналы ошибок** — /LogFiles/DetailedErrors/. 
    - Эта папка содержит один или несколько HTML-файлов с подробными сведениями об ошибках HTTP, которые возникли в вашем приложении.
- **Журналы веб-сервера** — /LogFiles/http/RawLogs. 
    - Эта папка содержит один или несколько текстовых файлов, отформатированных с применением расширенного формата журнала W3C.

## <a name="streaming"></a> Шаг 6. Потоковая передача журналов
Служба приложения может передавать **журналы приложений** и **журналы веб-сервера** при их создании. 

Потоковая передача журналов удобна при отладке приложения, так как позволяет сэкономить время по сравнению с обращением к журналам через FTP и другими способами.

> [!TIP]
> Перед включением потоковой передачи журналов убедитесь, что вы включили сбор журналов, как описано в разделе [Ведение журнала](#logging).

Чтобы включить потоковую передачу журналов, выполните следующие действия:
- Выберите **Мониторинг**> **Потоковая передача журналов**.
- Выберите **Журналы приложений** или **Журналы веб-сервера** в зависимости от того, какие сведения вам необходимы.
- Здесь можно также приостановить, перезапустить и очистить буфер.

![Журналы потоковой передачи](media/app-service-web-tutorial-monitoring/app-service-monitor-logstream.png)

> [!TIP]
> Журналы создаются только при наличии трафика у приложения. Также можно повысить уровень детализации журналов, чтобы получить дополнительные события или сведения.

## <a name="remote"></a> Шаг 7. Удаленная отладка
**Удаленная отладка** позволяет подключить отладчик к веб-приложению, запущенному в облаке. Вы можете устанавливать точки останова, обращаться к памяти напрямую, пошагово выполнять код и даже изменять путь к коду, как и для приложения, запускаемого локально.

Используйте удаленную отладку совместно с журналами диагностики для поиска и устранения проблем с приложением.

Чтобы подключить отладчик к приложению, запущенному в облаке, выполните следующие действия:

- Откройте решение для приложения, для которого нужно выполнить отладку, в Visual Studio 2017. 
- Установите несколько точек останова так же, как и для локального приложения.
- Откройте **Cloud Explorer** (CTRL+/, CTRL+X).
- При необходимости войдите в систему с учетными данными Azure.
- Найдите приложение, для которого нужно выполнить отладку.
- Выберите **Подключить отладчик** в области **Действия**.

![Удаленная отладка](media/app-service-web-tutorial-monitoring/app-service-monitor-vsdebug.png)

Visual Studio настраивает приложение для удаленной отладки и затем открывает ваше приложение в окне браузера. Выполните необходимые действия в приложении для срабатывания точек останова и пройдитесь по коду.

> [!WARNING]
> В рабочей среде выполнение в режиме отладки не рекомендуется. Если ваше рабочее приложение не развернуто на несколько экземпляров сервера, то веб-сервер во время отладки не сможет отвечать на запросы от других приложений. Для устранения неполадок в рабочей среде лучше всего [настроить ведение журналов](#logging) и использовать [Application Insights](#insights).

## <a name="diagnose"></a> Шаг 8. Диагностика и решение проблем
**Диагностика и решение проблем** — это встроенное средство, которое сканирует действия веб-приложения за последние 24 часа. После сканирования в окне отображаются общие сведения обо всех обнаруженных проблемах.

С помощью этого средства вы сможете отличить проблемы приложения от проблем платформы и найти пути решения проблем, которые помогут вернуть веб-приложение в работоспособное состояние.

![Диагностика и решение проблем](media/app-service-web-tutorial-monitoring/app-service-monitor-diagnosis.png)

## <a name="insights"></a> Шаг 9. Application Insights
**Application Insights** предоставляет функции профилирования и расширенные функции мониторинга для вашего приложения. 

Application Insights позволяет выявлять и диагностировать исключения и проблемы производительности в веб-приложении.

Вы можете включить Application Insights для своего веб-приложения в разделе **Мониторинг** > **Application Insights**. 

> [!NOTE]
> Application Insights может предложить вам установить расширение сайта Application Insights, чтобы начать сбор данных. Установка расширения сайта приводит к перезапуску приложения.

![Application Insights](media/app-service-web-tutorial-monitoring/app-service-monitor-appinsights.png)

Application Insights обладает богатым набором функций. Дополнительные сведения см. в статьях, указанных в разделе [Дальнейшие действия](#next).

## <a name="next"></a> Дальнейшие действия

 - [Что такое Application Insights](..\application-insights\app-insights-overview.md)
 - [Мониторинг производительности веб-приложения Azure с помощью Application Insights](..\application-insights\app-insights-azure-web-apps.md)
 - [Мониторинг доступности и скорости реагирования веб-сайта с помощью Application Insights](..\application-insights\app-insights-monitor-web-app-availability.md)
