---
title: "Обзор масштабируемых наборов виртуальных машин | Документация Майкрософт"
description: "Дополнительная информация о масштабируемых наборах виртуальных машин"
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 76ac7fd7-2e05-4762-88ca-3b499e87906e
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 1/25/2017
ms.author: guybo
ms.custom: H1Hack27Feb2017
translationtype: Human Translation
ms.sourcegitcommit: 54673cbc69e418bdbe7cb5791dfb5d20e7ebcb9f
ms.openlocfilehash: 2294587fd3f978a3f8383112ece329b47307db7a
ms.lasthandoff: 03/01/2017


---
# <a name="what-are-virtual-machine-scale-sets-in-azure"></a>Что такое масштабируемые наборы виртуальных машин в Azure?
Масштабируемые наборы виртуальных машин относятся к вычислительным ресурсам Azure. Их можно использовать для развертывания набора идентичных виртуальных машин и управления им. Масштабируемые наборы, в которые входят абсолютно одинаково настроенные VM, поддерживают настоящее автомасштабирование без необходимости предварительной подготовки виртуальных машин. Эти наборы упрощают создание крупномасштабных служб для больших вычислений, больших данных и контейнерных рабочих нагрузок.

Для приложений, которые нуждаются в масштабировании вычислительных ресурсов, операции масштабирования неявно распределяются между доменами сбоя и доменами обновления. Общие сведения о наборах масштабирования виртуальных машин см. в этом [объявлении в блоге Azure](https://azure.microsoft.com/blog/azure-virtual-machine-scale-sets-ga/).

Чтобы получить дополнительные сведения о масштабируемых наборах VM, просмотрите эти видео:

* [Марк Руссинович (Mark Russinovich) рассказывает о масштабируемых наборах Azure.](https://channel9.msdn.com/Blogs/Regular-IT-Guy/Mark-Russinovich-Talks-Azure-Scale-Sets/)  
* [Масштабируемые наборы виртуальных машин с Гаем Бауэрманом (Guy Bowerman).](https://channel9.msdn.com/Shows/Cloud+Cover/Episode-191-Virtual-Machine-Scale-Sets-with-Guy-Bowerman)

## <a name="creating-and-managing-vm-scale-sets"></a>Создание масштабируемых наборов виртуальных машин и управление ими
Набор масштабирования виртуальных машин можно создать на [портале Azure](https://portal.azure.com), нажав кнопку *Создать* и введя в строке поиска слово scale. В результатах поиска отобразится Virtual machine scale set (Набор масштабирования виртуальных машин). Здесь вы можете заполнить обязательные поля для настройки и развертывания набора масштабирования. Обратите внимание, на портале также можно настроить основные правила автомасштабирования на основе использования ЦП.

Наборы масштабирования виртуальных машин также можно задавать и развертывать с помощью шаблонов JSON и интерфейсов [REST API](https://msdn.microsoft.com/library/mt589023.aspx), как и отдельные виртуальные машины Azure Resource Manager. Поэтому можно использовать любые стандартные методы развертывания диспетчера ресурсов Azure. Дополнительную информацию о шаблонах см. в статье [Создание шаблонов диспетчера ресурсов Azure](../azure-resource-manager/resource-group-authoring-templates.md).

Набор примеров шаблонов для наборов масштабирования виртуальных машин можно найти в разделе шаблонов быстрого запуска Azure в репозитории GitHub [здесь](https://github.com/Azure/azure-quickstart-templates) (ищите шаблоны со словом *vmss* в названии).

На страницах сведений этих шаблонов есть кнопка, связанная с функцией развертывания на портале. Чтобы развернуть масштабируемый набор виртуальных машин, нажмите кнопку, а затем укажите на портале все необходимые параметры. Если вы не уверены, поддерживает ресурс верхний или смешанный регистр, для надежности всегда вводите значения параметров, используя числа и буквы в нижнем регистре. Вот полезный видеоролик с анализом шаблона масштабируемого набора виртуальных машин:

[Анализ шаблона масштабируемого набора виртуальных машин](https://channel9.msdn.com/Blogs/Azure/VM-Scale-Set-Template-Dissection/player)

## <a name="scaling-a-vm-scale-set-out-and-in"></a>Уменьшение или увеличение масштаба набора VM
Чтобы увеличить или уменьшить число виртуальных машин в масштабируемом наборе, достаточно изменить свойство *capacity* и повторно развернуть шаблон. Это упрощает создание собственного пользовательского уровня масштабирования, если требуется задать события пользовательского масштабирования, которые не поддерживаются автомасштабированием Azure.

При повторном развертывании шаблона для изменения емкости можно задать гораздо меньший шаблон, который будет включать только пакет свойств SKU и обновленную емкость. Пример см. [здесь](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing).

Пошаговое руководство по созданию автомасштабируемого набора см. в статье [Автоматическое масштабирование ВМ в наборе масштабирования ВМ](virtual-machine-scale-sets-windows-autoscale.md).

## <a name="monitoring-your-vm-scale-set"></a>Мониторинг масштабируемого набора VM
На [портале Azure](https://portal.azure.com) перечислены наборы масштабирования, показаны основные свойства и операции, а также приведен список виртуальных машин в наборе и график использования ресурсов. Чтобы получить дополнительные сведения о наборах масштабирования виртуальных машин, используйте [Azure Resource Explorer](https://resources.azure.com). Масштабируемые наборы VM принадлежат к ресурсам Microsoft.Compute. Чтобы просмотреть их на этом сайте, перейдите по следующим ссылкам:

**Подписки -> ваша подписка -> resourceGroups -> поставщики -> Microsoft.Compute -> virtualMachineScaleSets -> ваш масштабируемый набор виртуальных машин -> и т. д.**

## <a name="vm-scale-set-scenarios"></a>Сценарии масштабируемого набора VM
В этом разделе перечислены стандартные сценарии с участием масштабируемых наборов VM. Эти сценарии используются в некоторых службах Azure более высокого уровня (таких как пакетная служба, Service Fabric, служба контейнеров Azure Container Service).

* **Подключение по RDP или SSH к экземплярам наборов масштабирования виртуальных машин.** Набор масштабирования виртуальных машин создается внутри виртуальной сети, при этом отдельным виртуальным машинам в наборе не выделяются общедоступные IP-адреса. Это хорошее решение, так как оно избавляет вас от дополнительных затрат на управление, связанных с выделением отдельных общедоступных IP-адресов для всех ресурсов без отслеживания состояния в сетке вычислений. К этим ВМ можно легко подключиться с других ресурсов в виртуальной сети, в том числе с ресурсов с общедоступными IP-адресами, таких как балансировщики нагрузки или отдельные виртуальные машины.
* **Подключение к виртуальной машине с помощью правил преобразования сетевых адресов (NAT).** Вы можете создать общедоступный IP-адрес, назначить его балансировщику нагрузки и определить правила для входящих подключений пула NAT, которые сопоставляют порт на IP-адресе с портом виртуальной машины из масштабируемого набора виртуальных машин. Например:
  
  | Источник | Исходный порт | Место назначения | Конечный порт |
  | --- | --- | --- | --- |
  |  Общедоступный IP-адрес |Порт 50000 |vmss\_0 |Порт 22 |
  |  Общедоступный IP-адрес |Порт 50001 |vmss\_1 |Порт 22 |
  |  Общедоступный IP-адрес |Порт 50002 |vmss\_2 |Порт 22 |
  
   В следующем примере показано создание масштабируемого набора VM, который использует правила NAT для SSH-подключения к каждой виртуальной машине из набора с помощью одного общедоступного IP-адреса: [https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-nat](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-nat)
  
   Вот пример организации такой же схемы для RDP и Windows: [https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-nat](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-nat)
* **Подключение к ВМ с помощью основной виртуальной машины.** Если в одной виртуальной сети создается масштабируемый набор ВМ и автономная виртуальная машина, эта машина и машины из набора могут подключаться друг к другу с помощью внутренних IP-адресов в соответствии с определением виртуальной сети или подсети. Если создать общедоступный IP-адрес и назначить его автономной виртуальной машине, к ней можно будет подключиться по RDP или SSH, а затем через нее подключиться к экземплярам масштабируемого набора VM. На этом этапе можно заметить, что простой масштабируемый набор ВМ надежнее, чем автономная ВМ с общедоступным IP-адресом, сконфигурированная по умолчанию.
  
   Например, этот шаблон развертывает простой масштабируемый набор с использованием отдельной виртуальной машины: [https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-jumpbox](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-linux-jumpbox).
* **Балансировка нагрузки для экземпляров набора масштабирования виртуальных машин.** Чтобы передать работу вычислительному кластеру виртуальных машин с помощью циклического перебора, следует настроить в Azure Load Balancer соответствующие правила балансировки&4;-го уровня. Вы можете настроить зонды, чтобы проверить работу приложения путем проверки связи с портами с помощью указанного протокола, интервала и пути запроса. [Шлюз приложений](https://azure.microsoft.com/services/application-gateway/) Azure также поддерживает наборы масштабирования,&7;-й уровень и более сложные сценарии балансировки нагрузки.
  
   В следующем примере создается масштабируемый набор ВМ, на котором запущены веб-серверы Apache. Кроме того, в нем используется балансировщик нагрузки для балансировки нагрузки, получаемой каждой виртуальной машиной:[https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-ubuntu-web-ssl](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-ubuntu-web-ssl). (Обратите внимание на тип ресурса Microsoft.Network/loadBalancers и свойства networkProfile и extensionProfile в virtualMachineScaleSet.)
* **Развертывание масштабируемого набора ВМ в качестве вычислительного кластера в диспетчере кластеров PaaS.** Иногда масштабируемые наборы ВМ называют рабочими ролями следующего поколения. Это вполне допустимое название, но вместе с тем существует риск перепутать функции масштабируемого набора с функциями рабочей роли PaaS v1. В этом смысле масштабируемые наборы виртуальных машин предоставляют настоящую "рабочую роль" или рабочий ресурс. Они являются обобщенным вычислительным ресурсом, независимым от платформ и сред выполнения, который может настраиваться и интегрироваться с Azure Resource Manager IaaS.
  
   Рабочая роль PaaS v1, ограниченная с точки зрения поддержки платформ и сред выполнения (только для образов платформы Windows), также включает такие службы: переключение виртуального IP-адреса, настраиваемые параметры обновления, определенные параметры развертывания приложения или среды выполнения. Они либо *еще* недоступны в масштабируемых наборах ВМ, либо будут предоставляться другими службами PaaS более высокого уровня, например Service Fabric. Учитывая эти факторы, масштабируемые наборы ВМ можно рассматривать как инфраструктуру, поддерживающую PaaS. Например, такие решения PaaS, как Service Fabric, или диспетчеры кластера, как Mesos, можно построить на основе масштабируемых наборов ВМ в качестве масштабируемого уровня вычислений.
  
   Пример использования такого подхода: служба контейнеров Azure развертывает кластер на основе масштабируемых наборов с оркестратором контейнеров: [https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-dcos](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-dcos).

## <a name="vm-scale-set-performance-and-scale-guidance"></a>Рекомендации по производительности и масштабированию набора VM
* При использовании наборов масштабирования с неуправляемыми дисками планируйте не более 20 виртуальных машин на учетную запись хранения (если только для свойства *overprovision* не задано значение false — в этом случае можно создать до 40 виртуальных машин). К управляемым дискам эти ограничения учетных записей хранения не применяются.
* При использовании наборов масштабирования с неуправляемыми дисками максимально распределяйте первые буквы имен учетных записей хранения. Примеры шаблонов масштабируемых наборов VM в разделе [Шаблоны быстрого запуска Azure](https://github.com/Azure/azure-quickstart-templates/) демонстрируют, как это сделать.
* При использовании пользовательских виртуальных машин с неуправляемыми дисками планируйте не более 40 виртуальных машин в каждом наборе масштабирования виртуальных машин для одной учетной записи хранения. Прежде чем начинать развертывание масштабируемого набора ВМ, необходимо предварительно скопировать образ в учетную запись хранения. Наборы масштабирования с управляемыми дисками поддерживают до 100 пользовательских образов виртуальных машин. Дополнительные сведения см. в разделе часто задаваемых вопросов.
* Планируйте не более 4096 виртуальных машин в одной виртуальной сети.
* Число создаваемых виртуальных машин ограничивается квотой ядер в регионе, в котором выполняется развертывание. Возможно, придется обратиться в службу поддержки, чтобы увеличить квоту вычислений, даже если сейчас у вас установлен высокий предел ядер для использования с облачными службами или IaaS v1. Запрос на квоту можно отправить с помощью команды интерфейса командной строки Azure `azure vm list-usage` и команды PowerShell `Get-AzureRmVMUsage` (если используется версия PowerShell ниже 1.0, то используйте команду `Get-AzureVMUsage`).

## <a name="vm-scale-set-frequently-asked-questions"></a>Масштабируемый набор VM — часто задаваемые вопросы
**Вопрос.** Сколько виртуальных машин может входить в масштабируемый набор VM?

**Ответ.** При использовании управляемых дисков набор масштабирования может иметь от 0 до 1000 виртуальных машин на основе образов платформ или от 0 до 100 виртуальных машин на основе пользовательских образов. Для неуправляемых дисков (когда вы самостоятельно определяете учетные записи хранения) ограничение составляет 100 виртуальных машин для образов платформ и до 40 для пользовательских образов (если свойство *overprovision* имеет значение false, значение по умолчанию — 20), так как пользовательские образы с неуправляемыми дисками ограничены одной учетной записью.

**Вопрос.** Поддерживаются ли диски данных в масштабируемых наборах VM?

**Ответ.** Да. Набор масштабирования, определяемый управляемым хранилищем, может определять конфигурацию подключенных дисков с данными, которая будет применяться ко всем виртуальным машинам в наборе. Наборы масштабирования, которые не определяются управляемым хранилищем, не имеют подключенных дисков с данными. Ниже перечислены другие варианты хранения данных.

* Файлы Azure (общие диски SMB).
* Диск операционной системы.
* Временный диск (локальный, не поддерживаемый хранилищем Azure).
* Служба данных Azure (например таблицы Azure, BLOB-объекты Azure).
* Внешняя служба данных (например удаленная база данных).

**Вопрос.** Какие регионы Azure поддерживают наборы масштабирования виртуальных машин?

**Ответ.** Все регионы Azure поддерживают масштабируемые наборы ВМ.

**Вопрос.** Как создать набор масштабирования виртуальных машин с помощью пользовательского образа?

**Ответ.** Не указывайте свойство vhdContainers (или пропустите его). Вместо этого укажите URI свойство образа. Например, [201-vmss-windows-customimage].(https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-customimage).


**Вопрос.** Если уменьшить емкость масштабируемого набора VM с 20 до 15, какие виртуальные машины будут удалены?

**Ответ.** Для максимальной доступности виртуальные машины удаляются из масштабируемого набора в доменах обновления и доменах сбоя равномерно. Сначала удаляются виртуальные машины с самым высоким уровнем идентификатора.

**Вопрос.** Что будет, если затем увеличить емкость с 15 до 18?

**Ответ.** Если увеличить емкость до 18, то будут созданы 3 новые виртуальные машины. При этом идентификатор экземпляра виртуальной машины будет каждый раз увеличиваться, начиная с предыдущего наибольшего значения (например: 20, 21, 22). Виртуальные машины распределяются между доменами сбоя и обновления.

**Вопрос.** Можно ли указать последовательность выполнения при использовании нескольких расширений в масштабируемом наборе VM?

**Ответ.** Напрямую нет, но при использовании расширения customScript ваш скрипт может подождать, пока завершится выполнение другого расширения ([например, путем мониторинга журнала расширений](https://github.com/Azure/azure-quickstart-templates/blob/master/201-vmss-lapstack-autoscale/install_lap.sh)). Дополнительные рекомендации по виртуализации расширения см. в записи блога [Extension Sequencing in Azure VM Scale Sets](https://msftstack.wordpress.com/2016/05/12/extension-sequencing-in-azure-vm-scale-sets/) (Последовательность расширений в наборах масштабирования виртуальных машин Azure).

**Вопрос.** Работают ли масштабируемые наборы VM с группами доступности Azure?

**Ответ.** Да. Набор масштабирования виртуальных машин является неявной группой доступности с тремя доменами сбоя и пятью доменами обновления. Ничего настраивать в virtualMachineProfile не нужно. Наборы масштабирования виртуальных машин в количестве, превышающем 100 виртуальных машин, охватывают несколько групп размещения, которые эквивалентны нескольким наборам доступности. Группа доступности виртуальных машин может находиться в той же виртуальной сети, что и набор масштабирования виртуальных машин. Типичная конфигурация — это такое размещение виртуальных машин узла управления, для которого часто требуется уникальная конфигурация в группе доступности и узлы данных в наборе масштабирования.

