---
title: Создание масштабируемого набора Azure, в котором используются виртуальные машины низкого приоритета (предварительная версия) | Документация Майкрософт
description: Узнайте, как создавать масштабируемый набор виртуальных машин Azure, в котором используются виртуальные машины низкого приоритета для экономии затрат.
services: virtual-machine-scale-sets
documentationcenter: ''
author: mmccrory
manager: rajraj
editor: ''
tags: azure-resource-manager
ms.assetid: ''
ms.service: virtual-machine-scale-sets
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/15/2018
ms.author: memccror
ms.openlocfilehash: f25e4d1e3906a610e7c60e348f872a78d7db8fd3
ms.sourcegitcommit: d74657d1926467210454f58970c45b2fd3ca088d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="low-priority-vms-on-scale-sets-preview"></a>Виртуальные машины низкого приоритета в масштабируемых наборах (предварительная версия)

Использование виртуальных машин низкого приоритета в масштабируемых наборах позволяет воспользоваться нашей неиспользуемой емкостью при значительной экономии затрат. В любой момент времени, когда Azure понадобится эта емкость, инфраструктура Azure вытеснит виртуальные машины низкого приоритета. Поэтому низкоприоритетные виртуальные машины прекрасно подходят для рабочих нагрузок, для которых допустимы прерывания, таких как задания пакетной обработки, среды разработки или тестирования, большие вычислительные рабочие нагрузки и другие.

Объем доступной неиспользуемой емкости может варьироваться в зависимости от размера, региона, времени суток и многого другого. При развертывании низкоприоритетных виртуальных машин в масштабируемых наборах Azure выделит их (если имеется емкость), но соглашение об уровне обслуживания (SLA) для этих виртуальных машин отсутствует. Низкоприоритетный масштабируемый набор развертывается в одном домене сбоя и не гарантирует высокого уровня доступности.

> [!NOTE]
> Низкоприоритетные масштабируемые наборы доступны в режиме предварительной версии и готовы для применения в сценариях разработки и тестирования. 

## <a name="eviction-policy"></a>Политика вытеснения

Когда виртуальные машины с низким приоритетом вытесняются, то они по умолчанию будут переведены в состояние "Остановлено" (освобождено). С такой политикой вытеснения можно перераспределить вытесненные экземпляры, но нет гарантии, что распределение будет успешным. Остановленные виртуальные машины будут учитываться в квоте экземпляра масштабируемого набора, и вам будет выставлен счет за базовые диски. 

Если вы хотите, чтобы ваши виртуальные машины в низкоприоритетном масштабируемом наборе были удалены при их вытеснении, можно настроить для политики вытеснения действие удаление в [шаблоне Azure Resource Manager](#use-azure-resource-manager-templates). Если установлена политика вытеснения с действием удаления, то можно создавать новые виртуальные машины, увеличивая свойство количества экземпляров масштабируемого набора. Вытесненные виртуальные машины удаляются вместе с их базовыми дисками, и поэтому вы не будете платить за хранение. Также можно использовать функцию автомасштабирования масштабируемых наборов, чтобы автоматически попытаться компенсировать вытесненные виртуальные машины, однако нет гарантии, что распределение будет успешным. Рекомендуется использовать функцию автомасштабирования на низкоприоритетных масштабируемых наборах, только когда вы устанавливаете политику вытеснения с действием удаления, чтобы избежать затрат за диски и превышения пределов квоты. 

> [!NOTE]
> На этапе предварительной версии можно установить политику вытеснения с помощью [шаблонов Azure Resource Manager](#use-azure-resource-manager-templates). 

## <a name="deploying-low-priority-vms-on-scale-sets"></a>Развертывание виртуальных машин низкого приоритета в масштабируемых наборах

Чтобы развернуть виртуальные машины низкого приоритета в масштабируемых наборах, можно установить для нового параметра *Priority* значение *Low*. Все виртуальные машины в масштабируемом наборе будут настроены как низкоприоритетные. Чтобы создать масштабируемый набор с виртуальными машинами низкого приоритета, используйте один из следующих способов.
- [Azure CLI 2.0](#use-the-azure-cli-20)
- [Azure PowerShell](#use-azure-powershell)
- [Шаблоны диспетчера ресурсов Azure](#use-azure-resource-manager-templates)

## <a name="use-the-azure-cli-20"></a>Использование Azure CLI 2.0

Процесс создания масштабируемого набора с низкоприоритетными виртуальными машинами такой же, как описано в [статье о начале работы](quick-create-cli.md). Просто добавьте параметр "--Priority" при вызове CLI и установите для него значение *Low*, как показано в примере ниже.

```azurecli
az vmss create \
    --resource-group myResourceGroup \
    --name myScaleSet \
    --image UbuntuLTS \
    --upgrade-policy-mode automatic \
    --admin-username azureuser \
    --generate-ssh-keys \
    --priority Low
```

## <a name="use-azure-powershell"></a>Использование Azure PowerShell

Процесс создания масштабируемого набора с низкоприоритетными виртуальными машинами такой же, как описано в [статье о начале работы](quick-create-powershell.md).
Просто добавьте параметр "-Priority" в командлет [New-AzureRmVmssConfig](/powershell/module/azurerm.compute/new-azurermvmssconfig) и установите для него значение *Low*, как показано в примере ниже.

```powershell
$vmssConfig = New-AzureRmVmssConfig `
    -Location "East US 2" `
    -SkuCapacity 2 `
    -SkuName "Standard_DS2" `
    -UpgradePolicyMode Automatic `
    -Priority "Low"
```

## <a name="use-azure-resource-manager-templates"></a>Использование шаблонов Azure Resource Manager

Создание масштабируемого набора, использующего низкоприоритетные виртуальные машины, описано в статьях о начале работы для [Linux](quick-create-template-linux.md) и [Windows](quick-create-template-windows.md). Добавьте свойство "priority" в тип ресурса *Microsoft.Compute/virtualMachineScaleSets/virtualMachineProfile* в шаблоне и укажите *Low* в качестве значения. Обязательно используйте версию API *2017-10-30-preview* или более позднюю. 

Чтобы установить политику вытеснения с действием удаления, добавьте параметр "evictionPolicy" и задайте для него значение *delete*.

В следующем примере создается масштабируемый набор низкоприоритетных виртуальных машин Linux с именем *myScaleSet* в регионе *Западно-центральная часть США*, которые будут *удалены* при вытеснении.

```json
{
  "type": "Microsoft.Compute/virtualMachineScaleSets",
  "name": "myScaleSet",
  "location": "East US 2",
  "apiVersion": "2017-12-01",
  "sku": {
    "name": "Standard_DS2_v2",
    "capacity": "2"
  },
  "properties": {
    "upgradePolicy": {
      "mode": "Automatic"
    },
    "virtualMachineProfile": {
       "priority": "Low",
       "evictionPolicy": "delete",
       "storageProfile": {
        "osDisk": {
          "caching": "ReadWrite",
          "createOption": "FromImage"
        },
        "imageReference":  {
          "publisher": "Canonical",
          "offer": "UbuntuServer",
          "sku": "16.04-LTS",
          "version": "latest"
        }
      },
      "osProfile": {
        "computerNamePrefix": "myvmss",
        "adminUsername": "azureuser",
        "adminPassword": "P@ssw0rd!"
      }
    }
  }
}
```
## <a name="next-steps"></a>Дополнительная информация
Теперь, когда вы создали масштабируемый набор с виртуальными машинами низкого приоритета, попробуйте развернуть [автомасштабируемый шаблон с параметром низкого приоритета](https://github.com/Azure/vm-scale-sets/tree/master/preview/lowpri).

Ознакомьтесь со сведениями о ценах на [странице для определения тарифа масштабируемых наборов виртуальных машин](https://azure.microsoft.com/pricing/details/virtual-machine-scale-sets/linux/).