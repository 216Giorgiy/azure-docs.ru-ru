<properties
	pageTitle="Развертывание набора масштабирования виртуальных машин с помощью Visual Studio | Microsoft Azure"
	description="Развертывание набора масштабирования виртуальных машин с помощью Visual Studio и шаблона Resource Manager"
	services="virtual-machine-scale-sets"
	documentationCenter=""
	authors="gbowerman"
	manager="timlt"
	editor=""
	tags="azure-resource-manager"/>

<tags
	ms.service="virtual-machine-scale-sets"
	ms.workload="na"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="06/13/2016"
	ms.author="guybo"/>

# Развертывание набора масштабирования виртуальных машин с помощью Visual Studio

В этой статье описывается развертывание шаблонов масштабируемых наборов виртуальных машин с использованием развертывания группы ресурсов Visual Studio.


[Масштабируемые наборы виртуальных машин Azure](https://azure.microsoft.com/blog/azure-vm-scale-sets-public-preview/) — вычислительный ресурс Azure для развертывания и управления коллекцией похожих виртуальных машин с легко интегрируемыми параметрами для автоматического масштабирования и балансировки нагрузки. Масштабируемые наборы виртуальных машин можно подготавливать и развертывать с помощью [шаблонов диспетчера ресурсов Azure (ARM)](https://github.com/Azure/azure-quickstart-templates). Шаблоны ARM можно развертывать с помощью интерфейса командной строки Azure, PowerShell, REST, а также непосредственно из Visual Studio. Visual Studio предоставляет набор примеров шаблонов, которые можно развернуть в рамках проекта развертывания группы ресурсов Azure.

Развертывания группы ресурсов Azure позволяют сгруппировать несколько связанных ресурсов Azure и опубликовать их в одной операции развертывания. Дополнительные сведения о них можно получить в статье [Создание и развертывание групп ресурсов Azure с помощью Visual Studio](../vs-azure-tools-resource-groups-deployment-projects-create-deploy.md).

## Предварительные требования

Чтобы приступить к развертыванию шаблонов масштабируемых наборов виртуальных машин в Visual Studio, вам потребуется следующее:

- Visual Studio 2013 или 2015
- Пакет SDK Azure версии 2.7, 2.8 или 2.9

Обратите внимание: при выполнении этих инструкций предполагается, что вы используете Visual Studio 2015 с [пакетом SDK Azure версии 2.8](https://azure.microsoft.com/blog/announcing-the-azure-sdk-2-8-for-net/).

## Создание проекта

1. Создайте новый проект в Visual Studio 2015, выбрав **Файл | Создать | Проект**.

	![Создание файла][file_new]

2. В разделе **Visual C# | Облако** выберите **Диспетчер ресурсов Azure**, чтобы создать проект для развертывания шаблона ARM.

	![Создание проекта][create_project]

3.  В списке шаблонов выберите шаблон масштабируемых наборов виртуальных машин для Linux или Windows.

	![Выбор шаблона][select_Template]

4. После создания проекта вы увидите сценарии развертывания PowerShell, шаблон диспетчера ресурсов Azure и файл параметров для масштабируемого набора виртуальных машин.

	![Обозреватель решений][solution_explorer]

## Настройка проекта

Теперь можно изменить шаблон, настроив его в соответствии с потребностями своего приложения, например, добавить свойства расширения виртуальной машины или изменить правила балансировки нагрузки. По умолчанию шаблоны масштабируемого набора виртуальных машин настроены для развертывания расширения AzureDiagnostics, которое позволяет легко добавлять правила автоматического масштабирования. Также развертывается балансировщик нагрузки с общедоступным IP-адресом, настроенный с правилами входящих подключений NAT, которые позволяют подключаться к экземплярам виртуальных машин с помощью SSH (Linux) или протокола удаленного рабочего стола (Windows) — диапазон портов клиента начинается с 50000, что в случае Linux означает, что если подключиться к порту 50000 общедоступного IP-адреса (или имени домена), то вы будете перенаправлены на порт 22 первой виртуальной машины в наборе. При подключении к порту 50001 вы будете перенаправлены на порт 22 второй виртуальной машины и т. д.

 Удобный способ изменения шаблонов с помощью Visual Studio — использовать структуру JSON для организации параметров, переменных и ресурсов. Понимание схемы Visual Studio позволит обнаружить ошибки в шаблоне перед его развертыванием.

![Обозреватель JSON][json_explorer]

## Развертывание проекта

6. Разверните шаблон ARM в Azure для создания ресурса масштабируемого набора виртуальных машин. Щелкните правой кнопкой мыши по проекту и выберите **Развернуть > Новое развертывание**.

	![Развертывание шаблона][5deploy_Template]

7. Выберите свою подписку в диалоговом окне "Развертывание в группе ресурсов".

	![Развертывание шаблона][6deploy_Template]

8. В нем также можно создать новую группу ресурсов Azure для развертывания шаблона в эту группу.

	![Создание группы ресурсов][new_resource]

9. Затем нажмите кнопку **Изменить параметры**, чтобы ввести параметры, которые будут переданы шаблону. Некоторые параметры, такие как имя пользователя и пароль для операционной системы, обязательны для создания развертывания. При отсутствии средств PowerShell для Visual Studio рекомендуется установить флажок "Сохранить пароли", чтобы избежать скрытого запроса окна командной строки PowerShell, или использовать [поддержку keyvault](https://azure.microsoft.com/blog/keyvault-support-for-arm-templates/).

	![Изменение параметров][edit_parameters]

10. Щелкните **Развернуть**. В окне **Вывод** отображается ход развертывания. Обратите внимание, что действие выполняет сценарий **Deploy-AzureResourceGroup.ps1**.

	![Окно вывода][output_window]

## Изучение масштабируемого набора виртуальных машин

После завершения развертывания можно просмотреть новый масштабируемый набор виртуальных машин в **Обозревателе облака** Visual Studio (обновите список). Обозреватель облака позволяет управлять ресурсами Azure в Visual Studio при разработке приложений. Набор масштабирования виртуальных машин также можно просмотреть на [портале Azure](https://portal.azure.com) и в [обозревателе ресурсов Azure](https://resources.azure.com/).

![Обозреватель облака][cloud_explorer]

 С помощью портала удобнее всего визуально управлять инфраструктурой Azure в браузере, а с помощью обозревателя ресурсов Azure просматривать и отлаживать ресурсы Azure, переключив окно в "режим просмотра экземпляров" и воспользовавшись командами PowerShell для ресурсов, которые вы просматриваете. Хотя масштабируемые наборы виртуальных машин находятся в предварительной версии, в обозревателе ресурсов будут показаны наиболее полные сведения о масштабируемых наборах виртуальных машин.

## Дальнейшие действия

После успешного развертывания масштабируемых наборов виртуальных машин с помощью Visual Studio можно выполнить дальнейшую настройку проекта в соответствии с требованиями приложения. Например, можно настроить автоматическое масштабирование, добавив ресурс Insights, добавить инфраструктуру в шаблон в качестве автономных виртуальных машин или развернуть приложения с помощью расширения пользовательского сценария. Хорошим источником примеров шаблонов является репозиторий [Шаблоны быстрого запуска Azure](https://github.com/Azure/azure-quickstart-templates) в GitHub (введите "vmss" в строке поиска).

[file_new]: ./media/virtual-machine-scale-sets-vs-create/1-FileNew.png
[create_project]: ./media/virtual-machine-scale-sets-vs-create/2-CreateProject.png
[select_Template]: ./media/virtual-machine-scale-sets-vs-create/3b-SelectTemplateLin.png
[solution_explorer]: ./media/virtual-machine-scale-sets-vs-create/4-SolutionExplorer.png
[json_explorer]: ./media/virtual-machine-scale-sets-vs-create/10-JsonExplorer.png
[5deploy_Template]: ./media/virtual-machine-scale-sets-vs-create/5-DeployTemplate.png
[6deploy_Template]: ./media/virtual-machine-scale-sets-vs-create/6-DeployTemplate.png
[new_resource]: ./media/virtual-machine-scale-sets-vs-create/7-NewResourceGroup.png
[edit_parameters]: ./media/virtual-machine-scale-sets-vs-create/8-EditParameter.png
[output_window]: ./media/virtual-machine-scale-sets-vs-create/9-Output.png
[cloud_explorer]: ./media/virtual-machine-scale-sets-vs-create/12-CloudExplorer.png

<!---HONumber=AcomDC_0615_2016-->