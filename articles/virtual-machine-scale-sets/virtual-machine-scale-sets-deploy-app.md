---
title: "Развертывание приложения в масштабируемых наборах виртуальных машин | Документация Майкрософт"
description: "Развертывание приложения в наборах масштабирования виртуальных машин"
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: f8892199-f2e2-4b82-988a-28ca8a7fd1eb
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/07/2017
ms.author: guybo
translationtype: Human Translation
ms.sourcegitcommit: 197ebd6e37066cb4463d540284ec3f3b074d95e1
ms.openlocfilehash: f39840ab2fb31775c9703799393d8c386a8451ee
ms.lasthandoff: 03/31/2017


---
# <a name="deploy-an-app-on-virtual-machine-scale-sets"></a>Развертывание приложения в наборах масштабирования виртуальных машин
Обычно приложение, выполняемое в наборе масштабирования виртуальных машин, развертывается одним из трех способов:

* установка нового программного обеспечения в образ платформы во время развертывания;
* создание пользовательского образа виртуальной машины, содержащего ОС и приложение на одном виртуальном жестком диске;
* развертывание образа платформы или пользовательского образа в качестве узла контейнера и приложения в качестве одного или нескольких контейнеров.

## <a name="install-new-software-on-a-platform-image-at-deployment-time"></a>Установка нового программного обеспечения в образ платформы во время развертывания
Образ платформы в данном контексте — это образ операционной системы из Azure Marketplace, например Ubuntu 16.04, Windows Server 2012 R2 и т. п.

Новое программное обеспечение можно установить в образ платформы, используя [расширения виртуальной машины](../virtual-machines/windows/extensions-features.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json). Расширение виртуальной машины — это программное обеспечение, выполняемое при развертывании виртуальной машины. Используя расширение пользовательских сценариев, вы можете выполнить любой код во время развертывания. [Здесь](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-webapp-dsc-autoscale) приведен пример шаблона Azure Resource Manager, который использует [расширение DSC в Azure](virtual-machine-scale-sets-dsc.md) для установки приложений IIS и .NET MVC, интегрированных с автоматическим масштабированием Azure.

Преимуществом такого подхода является определенный уровень разделения кода приложения и операционной системы, позволяющий хранить приложение отдельно. Разумеется, это также означает большее число динамических частей и более продолжительное развертывание виртуальной машины, если сценарию требуется скачать и настроить много компонентов.

>[!NOTE]
>При передаче конфиденциальных сведений в команде расширения пользовательских сценариев (например, пароля) вместо атрибута `settings` в атрибуте `protectedSettings` этого расширения необходимо указать `commandToExecute`.

## <a name="create-a-custom-vm-image-that-includes-both-the-os-and-the-application-in-a-single-vhd"></a>Создание пользовательского образа виртуальной машины, содержащего ОС и приложение на одном виртуальном жестком диске 
В нашем случае набор масштабирования состоит из ряда виртуальных машин, являющихся копиями созданного вами образа, который вы должны обслуживать. При этом подходе во время развертывания виртуальной машины никакая дополнительная настройка не нужна. Однако в версии `2016-03-30` наборов масштабирования виртуальных машин (и в более ранних версиях) диски ОС для виртуальных машин в наборе масштабирования ограничены одной учетной записью хранения. То есть в наборе масштабирования может быть не более 40 виртуальных машин, тогда как при использовании образов платформы их может быть не менее 100. Дополнительные сведения см. в [обзоре конструктора наборов масштабирования](virtual-machine-scale-sets-design-overview.md).

>[!NOTE]
>Версия API Масштабируемых наборов ВМ `2016-04-30-preview` поддерживает использование Управляемых дисков Azure для диска операционной системы и дополнительных дисков данных. Дополнительные сведения см. в статье [Managed Disks Overview](../storage/storage-managed-disks-overview.md) (Обзор Управляемых дисков) и [Масштабируемые наборы ВМ Azure и подключенные диски данных](virtual-machine-scale-sets-attached-disks.md). 

## <a name="deploy-a-platform-or-a-custom-image-as-a-container-host-and-your-app-as-one-or-more-containers"></a>Развертывание образа платформы или пользовательского образа в качестве узла контейнера и приложения в качестве одного или нескольких контейнеров
Образ платформы или пользовательский образ фактически представляет собой узел контейнера, поэтому можно установить приложение как один или несколько контейнеров.  Управлять контейнерами можно с помощью оркестратора или инструмента управления конфигурацией. Достоинство этого подхода состоит в абстрагировании облачной инфраструктуры от прикладного уровня и их разделении.

## <a name="what-happens-when-a-vm-scale-set-scales-out"></a>Что произойдет при развертывании набора масштабирования виртуальных машин?
При добавлении одной или нескольких виртуальных машин в набор масштабирования для увеличения его емкости (вручную или посредством автомасштабирования) приложение устанавливается на них автоматически. Например, если в наборе масштабирования определены расширения, то они будут запускаться на каждой новой виртуальной машине при ее создании. Если набор масштабирования основан на исходном пользовательском образе, то любая новая виртуальная машина является его копией. Если виртуальные машины в наборе масштабирования являются узлами контейнеров, то в расширении пользовательских сценариев может использоваться код запуска для загрузки контейнеров или это расширение может устанавливать агент, который регистрируется в оркестраторе кластера (например, службе контейнеров Azure).

## <a name="how-do-you-manage-application-updates-in-vm-scale-sets"></a>Как можно управлять обновлениями приложений в наборах масштабирования виртуальных машин?
Для обновления приложений в наборах масштабирования виртуальных машин используются три основных подхода, следующие из трех описанных выше способов развертывания приложений.

* Обновление с помощью расширений виртуальной машины. Любые расширения виртуальной машины, определенные для набора масштабирования виртуальных машин, выполняются при каждом развертывании новой виртуальной машины, пересоздании образа существующей виртуальной машины или обновлении расширения виртуальной машины. Если необходимо обновить приложение, то вы вполне можете сделать это напрямую, с помощью расширения: просто обновите определение этого расширения. Один из простых способов сделать это — изменить fileUris, указав ссылку на новое программное обеспечение.

* Подход с неизменяемым пользовательским образом. При внедрении приложения (или компонентов приложения) в образ виртуальной машины можно поставить себе целью создание надежного конвейера для автоматизации сборки, тестирования и развертывания образов. Можно спроектировать архитектуру таким образом, чтобы упростить быстрый ввод промежуточного набора масштабирования в рабочую среду. Хорошим примером этого подхода является [работа драйвера Azure Spinnaker](https://github.com/spinnaker/deck/tree/master/app/scripts/modules/azure) - [http://www.spinnaker.io/](http://www.spinnaker.io/).

Packer и Terraform также поддерживают Azure Resource Manager, поэтому можно определить свои образы в виде кода, создать их в Azure и затем использовать виртуальный жесткий диск в наборе масштабирования. Однако такой подход не подходит для образов Marketplace, в которых расширения и пользовательские сценарии более важны, так как вы не оперируете битами из Marketplace напрямую.

* Контейнеры обновлений. Абстрагируйте управление жизненным циклом приложений до уровня над облачной инфраструктурой. Например, инкапсулируйте приложения и их компоненты в контейнеры и управляйте этими контейнерами посредством оркестраторов контейнеров и диспетчеров конфигураций, таких как Chef или Puppet.

Тогда виртуальные машины в наборе масштабирования станут прочной основой для контейнеров, и будет необходимо только время от времени устанавливать обновления для системы безопасности и ОС. Как уже упоминалось, служба контейнеров Azure представляет собой хороший пример реализации такого подхода и создания службы на его основе.

## <a name="how-do-you-roll-out-an-os-update-across-update-domains"></a>Как можно развернуть обновление ОС в доменах обновления?
Предположим, что требуется обновить образ ОС, не прерывая работу набора масштабирования виртуальных машин. Один из способов сделать это — обновлять образы виртуальных машин по очереди. Для этого можно использовать PowerShell или интерфейс командной строки Azure. Существуют отдельные команды для обновления модели масштабируемого набора виртуальных машин (т. е. его определения конфигурации) и выполнения вызовов "ручного обновления" на отдельных виртуальных машинах. В документе Azure [Обновление набора масштабирования виртуальных машин](./virtual-machine-scale-sets-upgrade-scale-set.md) также содержатся сведения о том, какие доступны варианты обновления операционной системы в масштабируемом наборе виртуальных машин.


