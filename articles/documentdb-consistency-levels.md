<properties 
	pageTitle="Уровни согласованности в DocumentDB" 
	description="В DocumentDB есть четыре уровня согласованности с соответствующими уровнями производительности. Это позволяет разработчикам приложений идти на прогнозируемые компромиссы между согласованностью, доступностью и задержками." 
	services="documentdb" 
	authors="mimig1" 
	manager="jhubbard" 
	editor="cgronlun" 
	documentationCenter=""/>

<tags 
	ms.service="documentdb" 
	ms.workload="data-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/05/2015" 
	ms.author="mimig"/>

#Уровни согласованности в DocumentDB
Разработчики часто сталкиваются с проблемой выбора между двумя крайними вариантами согласованности: сильной и "в конечном счете". Реальность такова, что существуют еще несколько уровней согласованности между этими двумя крайностями. В большинстве реальных сценариев, приложения выигрывают от создания точных компромиссов между согласованностью, доступностью и временем ожидания. DocumentDB предлагает четыре четко определенных уровня согласованности с соответствующими уровнями производительности. Это позволяет разработчикам приложений найти предсказуемый компромисс между согласованностью, доступностью и временем ожидания.  
 
Сильная согласованность для запросов и операций чтения характерна для всех системных ресурсов, в том числе баз данных и их учетных записей, коллекций, пользователей и разрешений. Уровни согласованности применяются только к определяемым пользователем ресурсам. Для запросов и операций чтения на заданных пользователем ресурсах, в том числе документах, вложениях, хранимых процедурах, триггерах и пользовательских функциях, DocumentDB предлагает четыре различных уровня согласованности: Strong (сильная), Bounded-Staleness (ограниченное запаздывание), Session (уровень сеанса) и Eventual (согласованное "в конечном счете"). Эти разделенные, четко определенные уровни согласованности позволяют принимать обоснованные компромиссы между показателями согласованности, доступности и производительности. Эти уровни согласованности подкреплены предсказуемыми уровнями производительности, что обеспечивает получение устойчивых результатов для вашего приложения.   

##Уровни согласованности
Вы можете настроить уровень согласованности по умолчанию, который будет распространяться на все коллекции (по всем базам данных) под вашей учетной записью базы данных. По умолчанию все операции чтения и запросов к определенным пользователем ресурсам будут использовать уровень согласованности по умолчанию, заданный в учетной записи базы данных. Но вы можете понизить уровень согласованности для конкретного запроса (на чтение или запрос), указав для него заголовок [x-ms-consistency-level]. Существует четыре типа уровней согласованности, поддерживаемых протоколом репликации DocumentDB. Их описание представлено ниже. 

>[AZURE.NOTE] В следующих выпусках мы намерены внедрить поддержку переопределения уровня согласованности по умолчанию для каждой коллекции.  

**Уровень согласованности Strong (сильная)**: Сильный уровень согласованности гарантирует, что операция записи отображается только после ее завершения большинством необходимого набора реплик. Запись либо синхронно завершается первичной и необходимым набором вторичных реплик, либо прерывается. Операция чтения всегда подтверждается кворумом большинства: клиент никогда не видит неисполненные или частичные записи, но гарантированно получает последние подтвержденные записи.   
 
Сильный уровень согласованности обеспечивает абсолютную гарантию согласованности данных, но предлагает самый низкий уровень производительности операций чтения и записи.  

**Уровень Bounded Staleness (ограниченная согласованность с запаздыванием)**: Ограниченная согласованность с запаздыванием гарантирует общий порядок распространения операций записи, при чтении возможно возникновение задержек от записи не более чем на К префиксов. Чтение всегда признается большинством необходимого набора реплик. Ответ на запрос чтения определяет его относительную "свежесть" (в пересчете на К).  

Ограниченная согласованность с запаздыванием обеспечивает более предсказуемое поведение согласованности чтения, предлагая самые низкие задержки для записи. Так как операции чтения подтверждаются кворумом большинства, время задержки чтения не самое низкое их тех, что предлагаются системой.    

**Уровень согласованности Session (сеанс)**: В отличие от глобальных моделей согласованности, предлагаемых сильной и ограниченной согласованностью, уровень "сеанса" подходит специально для конкретного сеанса клиента. Согласованности на уровне сеанса, как правило, достаточно, так как это обеспечивает гарантированное монотонные операции чтения и записи данных, способность читать собственные записи. Запрос чтения для согласованности на уровне сеанса формируется для реплик, которые могут обслужить запрошенную клиентом версию (является частью файла cookie сеанса).  

Сеанс предоставляет предсказуемую согласованность чтения данных для сеанса, предлагая самые низкие задержки при записи. Операции чтения также имеют низкое время ожидания, за исключением тех редких случаев, когда они обслуживаются одной репликой.  

**Уровень согласованности Eventual ("в конечном счете")**: Согласованность "в конечном счете" является самой слабой формой согласованности, в котором клиент может получить значения, которые являются более старыми по отношению к полученным ранее, в течение времени. В отсутствие любых последующих операций записи реплики в группе в конечном счете сходятся. Запрос на чтение обслуживается любой вторичной репликой.  

Согласованность "в конечном счете" оказывается самой слабо связанной согласованностью чтения, но предлагает наименьшую задержку как для чтения, так и для записи. 

##Согласованность запросов
По умолчанию для пользовательских ресурсов уровень согласованности для запросов совпадает с уровнем согласованности для операций чтения. По умолчанию, индекс обновляется синхронно при каждой операции вставки, заменить или удаления документа в коллекции. Это позволяет выполнять запросы с уровнем согласованности, как и в документе. В то время как DocumentDB оптимизирован для операций записи и поддерживает устойчивые объемы записей документов вместе с синхронным обслуживанием индекса и обслуживанием согласованных запросов, вы можете настроить определенные коллекции для отложенного обновления своих ​​индексов. Отложенное индексирование еще больше повышает производительность операций записи и идеально подходит для сценариев пакетной вставки, прежде всего для чтения больших коллекций.  

Режим индексирования|	Операции чтения|	Запросы  
-------------|-------|---------
Режим согласованности (по умолчанию)|	Выбор из Strong (сильная), Bounded Staleness (ограниченная с запаздыванием), Session (на уровне сеанса) или Eventual ("в конечном счете")|	Выбор из Strong (сильная), Bounded Staleness (ограниченная с запаздыванием), Session (на уровне сеанса) или Eventual ("в конечном счете")|
Отложенная|	Выбор из Strong (сильная), Bounded Staleness (ограниченная с запаздыванием), Session (на уровне сеанса) или Eventual ("в конечном счете")|	Согласованность "в конечном счете"  

Как и для запросов на чтение, можно снизить уровень согласованности конкретного запроса, задав заголовок запроса [x-ms-consistency-level].  

##Ссылки
-	Даг Терри. Согласованность реплицированных данных на примере игры в бейсбол.   
[http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf](http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf)
-	Даг Терри. Гарантии согласованности на уровне сеанса для слабо согласованных реплицированных данных.   
[http://www2.parc.com/csl/projects/bayou/pubs/sg-pdis-94/www/SessionGuaranteesPDIS_1.html](http://www2.parc.com/csl/projects/bayou/pubs/sg-pdis-94/www/SessionGuaranteesPDIS_1.html)
-	Дэниэл Абади. Компромиссы согласованности в современных распределенных системах проектирования баз данных: CAP - это только часть истории.   
[http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html](http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html) 
-	Питер Бейлис, Шиварам Венкатараман, Майкл Дж. Франклин, Джозеф М. Хеллерштейн, Ион Стойка. Вероятностная ограниченная согласованность с запаздыванием (PBS) для практических неполных кворумов.   
[http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf](http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf)
-	Вернер Вогелс. Согласованность "в конечном счете": новый взгляд.    
[http://allthingsdistributed.com/2008/12/eventually_consistent.html](http://allthingsdistributed.com/2008/12/eventually_consistent.html)

<!--HONumber=46--> 
