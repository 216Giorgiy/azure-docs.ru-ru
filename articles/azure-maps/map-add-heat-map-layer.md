---
title: Добавление слоя тепловой карты в Azure Maps | Документация Майкрософт
description: Сведения о добавлении слоя тепловой карты на карту Javascript
author: rbrundritt
ms.author: richbrun
ms.date: 12/2/2018
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: ''
ms.custom: codepen
ms.openlocfilehash: cbf134640f981056c0996ffc6768ebc1381ce2ac
ms.sourcegitcommit: fd488a828465e7acec50e7a134e1c2cab117bee8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/03/2019
ms.locfileid: "53995156"
---
# <a name="add-a-heat-map-layer"></a>Добавление слоя тепловой карты

Тепловая карта, которую также называют картой точек плотности, это тип визуализации данных для представления плотности данных с помощью диапазона цветов. Такие визуализации часто используются для отображения "горячих точек" данных на карте, и они особенно полезны для больших наборов точечных данных.  Например, если в представлении карты отрисовать десятки тысяч точек в виде символов, они займут почти всю площадь карты и многие из них будут перекрывать друг друга, усложняя понимание и анализ данных. Если же те же данные будут отображаться на тепловой карте, вы сможете легко заметить области максимальной или относительно низкой плотности относительно других областей карты. Тепловые карты используются в разных сценариях. Вот лишь несколько примеров.

* В формате тепловой карты очень удобно отображать данные о температурах, так как она предоставляет приблизительные значения данных между двумя точками.
* Отображение сведений от датчиков шума в виде тепловой карты не только позволяет оценить уровень шума в точке установки датчика, но и дает некоторое представление о снижении шума на расстоянии. Например, возможна такая ситуация, когда уровень шума а одной области относительно невелик, но близкое расположение таких областей повышает уровень шума в зонах перекрытия. Расположение нескольких датчиков с перекрытием зон чувствительности и отображение этих данных на тепловой карте позволит выявить такие ситуации.
* Визуализация трассировки GPS с данными о скорости в виде тепловой карты высоты, на которой скорость в каждой точке кодируется интенсивностью цвета, позволяет быстро и легко определить зоны ускорения транспортного средства.

> [!TIP]
> Слои пузырьков по умолчанию отображают координаты всех геометрических объектов в источнике данных. Чтобы отображать в слое только геометрические объекты, присвойте параметру `filter` для этого слоя значение `['==', '$type', 'Point']`.

## <a name="add-a-heat-map-layer"></a>Добавление слоя тепловой карты

Чтобы отобразить точечные данные из источника данных в виде тепловой карты, просто передайте этот источник данных в экземпляр класса HeatMapLayer и добавьте его на карту, как показано в этом примере.

<br/>

<iframe height='500' scrolling='no' title='Простой слой тепловой карты' src='//codepen.io/azuremaps/embed/gQqdQB/?height=500&theme-id=0&default-tab=js,result&embed-version=2&editable=true' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>Изучите фрагмент кода <a href='https://codepen.io/azuremaps/pen/gQqdQB/'>простого слоя тепловой карты</a>, опубликованный для Azure Maps (<a href='https://codepen.io/azuremaps'>@azuremaps</a>) в репозитории <a href='https://codepen.io'>CodePen</a>.
</iframe>

В этом примере каждая точка тепловой карты имеет радиус 10 пикселей на любом уровне масштабирования. При добавлении на эту карту слоя тепловой карты этот пример кода помещает его под уровнем меток. Это повышает удобство просмотра для пользователя, позволяя видеть метки над тепловой картой. Данные в этом примере извлекаются из источника, содержащем сведения об [опасности землетрясений USGS](https://earthquake.usgs.gov/). Каждая из точек обозначает значительное землетрясение, произошедшее за последние 30 дней.

## <a name="customizing-the-heat-map-layer"></a>Настройка слоя тепловой карты

В предыдущем примере настройка тепловой карты заключалась в установке параметров радиуса и прозрачности. Слой тепловой карты предоставляет несколько параметров для настройки.

* `radius`: определяет радиус в пикселях для отрисовки каждой точки данных. Радиус определяется как фиксированное число или выражение. Задав радиус как выражение, результат которого зависит от масштаба, вы можете создать тепловые карты, на которых радиус каждой точки всегда будет соответствовать одинаковой области на карте.
* `color`: определяет параметры цвета для тепловой карты. Для тепловых карт часто используется градиентная палитра, но иногда полезны и ступенчатые палитры, которые придают тепловой карте более контурный вид. Эти цветовые палитры определяют цвета в диапазоне от минимальной до максимальной плотности. Значения цветов для тепловых карт указываются в виде выражения для значения `heatmap-density`. Цвет с индексом 0 в выражении градиента или цвет по умолчанию для ступенчатой палитры определяют цвет для всех областей без точек данных, то есть цвет фона. Многие пользователи предпочитают использовать для этого прозрачный или полупрозрачный черный цвет. Вот несколько примеров выражений для определения цвета.

| Выражение для градиентной палитры | Выражение для ступенчатой палитры | 
|---------------------------|--------------------------|
| \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;'interpolate',<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['linear'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['heatmap-density'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;0, 'transparent',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.01, 'purple',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.5, '#fb00fb',<br/>&nbsp;&nbsp;&nbsp;&nbsp;1, '#00c3ff'<br/>\] | \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;'step',<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['heatmap-density'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;'transparent',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.01, 'navy',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.25, 'navy',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.50, 'green',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.75, 'yellow',<br/>&nbsp;&nbsp;&nbsp;&nbsp;1.00, 'red'<br/>\] |   

* `opacity`: указывает степень непрозрачности слоя тепловой карты.
* `intensity`: применяет множитель к весу каждой точки данных, чтобы повысить общую интенсивность тепловой карты. Этот параметр позволяет подчеркнуть небольшие различия в весе точек данных, чтобы сделать визуализацию более наглядной.
* `weight`: по умолчанию все точки данных имеют вес 1, то есть равный вес. Параметр weight используется в качестве множителя. Для него можно использовать фиксированное число или выражение. Если используется число, например 2, плотность каждой точки удваивается, как если бы она была нанесена на карту дважды. Фиксированное число в качестве значения параметра weight изменяет тепловую карту точно так же, как изменение параметра intensity. Но если вы укажете здесь выражение, вес каждой точки данных может быть разным в зависимости от других метрик в свойствах точки данных. В нашем примере данных о землетрясениях каждая точка данных обозначает одно землетрясение, важнейшей метрикой которого является магнитуда. Землетрясения происходят постоянно, но большинство из них имеют низкую магнитуду и практически не заметны. Если мы создадим для параметра weight выражение, основанное на значении магнитуды, значительные землетрясения будут более выраженными и станут лучше заметны на тепловой карте.
* Кроме параметров базового слоя, минимального и максимального масштаба, видимости и фильтра, есть еще и параметр `source`, который позволяет обновлять источник данных, и параметр `source-layer`, который указывает, что источник данных является источником векторных фрагментов.

Это средство позволяет проверить разные настройки для слоя тепловой карты.

<br/>

<iframe height='700' scrolling='no' title='Параметры слоя тепловой карты' src='//codepen.io/azuremaps/embed/WYPaXr/?height=700&theme-id=0&default-tab=result' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>Просмотрите фрагмент кода с <a href='https://codepen.io/azuremaps/pen/WYPaXr/'>параметрами слоя тепловой карты</a> для службы Azure Maps (<a href='https://codepen.io/azuremaps'>@azuremaps</a>), размещенный в репозитории <a href='https://codepen.io'>CodePen</a>.
</iframe>

> [!TIP]
> При включенной кластеризации для источника данных, расположенные близко друг к другу точки данных группируются в кластеризованые точки. Число точек в каждом кластере можно использовать в выражении веса для тепловой карты. Такой подход позволяет значительно сократить число отображаемых точек. Число точек в кластере хранится в свойстве point_count для функции точки, как показано ниже. 
> ```JavaScript
> var layer = new atlas.layer.HeatMapLayer(datasource, null, {
>    weight: ['get', 'point_count']
> });
> ```
> Если радиус кластеризации составляет несколько пикселей, визуальные различия будут минимальными. Больший радиус означает группирование большего числа точек в каждом кластере, что повысит производительность тепловой карты, но одновременно создаст более заметные визуальные различия.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о классах и методах, которые используются в этой статье:

> [!div class="nextstepaction"]
> [HeatMapLayer](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.htmlmarker?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"]
> [HeatMapLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.heatmaplayeroptions?view=azure-iot-typescript-latest)

Дополнительные примеры кода для добавления в карты см. в следующих статьях:

> [!div class="nextstepaction"]
> [Добавление слоя символов](./map-add-pin.md)

