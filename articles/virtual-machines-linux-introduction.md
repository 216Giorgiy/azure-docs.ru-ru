<properties 
	pageTitle="Введение в Linux в Azure - учебник Azure" 
	description="Узнайте о том, как использовать виртуальные машины Linux в Azure." 
	services="virtual-machines" 
	documentationCenter="python" 
	authors="szarkos" 
	manager="timlt" 
	editor=""/>

<tags 
	ms.service="virtual-machines" 
	ms.workload="infrastructure-services" 
	ms.tgt_pltfrm="vm-linux" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="09/13/2014" 
	ms.author="szark"/>





#Введение в Linux в Azure

В этом разделе содержится обзор некоторых аспектов использования виртуальных машин Linux в облаке Azure. При использовании образа из коллекции развертывание виртуальной машины Linux осуществляется просто. 

## Оглавление ##

* [Аутентификация: имена пользователей, пароли и ключи SSH.](#authentication)
* [Создание и использование ключей SSH для входа в виртуальные машины Linux](#keygeneration)
* [Получение привилегий суперпользователя с помощью sudo](#superuserprivileges)
* [Настройка брандмауэра](#firewallconfiguration)
* [Изменения имени узла](#hostnamechanges)
* [Запись образа виртуальной машины](#virtualmachine)
* [Подключение дисков](#attachingdisks)

## <a id="authentication"></a>Аутентификация: имена пользователей, пароли и ключи SSH

При создании виртуальной машины Linux с помощью портала управления Azure вам будет предложено указать имя пользователя, пароль и (при необходимости) открытый SSH-ключ. К имени пользователя при развертывании виртуальной машины Linux на платформе Azure применяется следующее ограничение: запрещается использовать имена учетных записей (идентификатор пользователя <100), которые уже используются в виртуальной машине (например,  'root').

 - См. статью [Использование SSH с Linux в Azure](../linux-use-ssh-key/)


### <a id="keygeneration"></a>Создание ключа SSH

Текущая версия портала управления принимает только открытые ключи SSH, инкапсулированные в сертификате X509. Для создания и использования ключей SSH в Azure выполните описанные ниже действия.

1. С помощью openssl создайте сертификат X509 с парой ключей RSA 2048 бит.
		
		openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout myPrivateKey.key -out myCert.pem

	Ответьте на несколько вопросов, которые запрашивает openssl (можете оставить их пустыми). Контент этих полей не используется платформой.

2. Измените разрешения для закрытого ключа, чтобы защитить его.

		chmod 600 myPrivateKey.key

3. Преобразуйте  `myCert.pem` в  `myCert.cer` (сертификат X509 в кодировке DER).

		openssl  x509 -outform der -in myCert.pem -out myCert.cer

4. При создании виртуальной машины Linux загрузите  `myCert.cer`. В процессе подготовки открытый ключ будет автоматически установлен в этом сертификате в файл `~/.ssh/authorized_keys` для указанного пользователя в виртуальной машине.

5. Подключитесь к виртуальной машине Linux с помощью ssh.

		ssh -i  myPrivateKey.key -p port  username@servicename.cloudapp.net

	Будет предложено принять отпечаток пальца открытого ключа узла при первом входе.

6. Можно скопировать  `myPrivateKey.key` в `~/.ssh/id_rsa` таким образом, чтобы клиент openssh смог автоматически получать это без использования параметра -i.
   Либо можно включить в `~/.ssh/config` раздел для вашей виртуальной машины:

        Host servicename.cloudapp.net
          IdentityFile %d/.ssh/myPrivateKey.key


### Создание ключа из существующего ключа, совместимого с OpenSSH
Предыдущий пример описывает, как создать новый ключ для использования в Windows Azure. В некоторых случаях пользователи могут уже иметь открытый и закрытый ключи, совместимые с OpenSSH, и пожелать использовать те же ключи в Windows Azure.

Закрытые ключи OpenSSH могут считываться напрямую служебной программой  `openssl`. Приведенная ниже команда получает существующий закрытый ключ SSH (id_rsa в представленном ниже примере) и создает открытый ключ  `.pem`, который необходим для Microsoft Azure.

	# openssl req -x509 -key ~/.ssh/id_rsa -nodes -days 365 -newkey rsa:2048 -out myCert.pem

Файл **MyCert.pem** представляет собой открытый ключ, который затем будет использоваться для подготовки виртуальной машины Linux в Windows Azure. Во время подготовки файл  `.pem` будет преобразован в совместимый открытый ключ  `openssh` и помещен в `~/.ssh/authorized_keys`.


## <a id="superuserprivileges"></a>Получение привилегий суперпользователя с помощью  `sudo`

Учетная запись пользователя, указанная во время развертывания экземпляра виртуальной машины в Azure, является привилегированной учетной записью. Эта учетная запись настраивается агентом Linux Azure, чтобы обеспечить возможность повысить привилегии до уровня root (учетная запись суперпользователя) с помощью служебной программы  `sudo`. После входа в систему с помощью этой учетной записи пользователя вы сможете выполнять команды от учетной записи root, используя синтаксис команды

	# sudo <COMMAND>

При необходимости можно получить доступ к оболочке root с помощью команды **sudo -s**.

- См. статью [Использование прав корневой учетной записи на виртуальных машинах Linux в Azure](../virtual-machines-linux-use-root-privileges/)


## <a id="firewallconfiguration"></a>Настройка брандмауэра

Azure предоставляет фильтр входящих пакетов, который ограничивает возможности подключения к портам, указанным на портале управления. По умолчанию разрешен только порт SSH. Можно открыть доступ к дополнительным портам на виртуальной машине Linux, настроив конечные точки на портале управления:

 - См. [Настройка конечных точек виртуальной машины](../virtual-machines-set-up-endpoints/)

Образы Linux в коллекции Azure не включают брандмауэр  *iptables* по умолчанию. При необходимости этот брандмауэр можно настроить для предоставления дополнительных возможностей фильтрации.


## <a id="hostnamechanges"></a>Изменения имени узла

При начальном развертывании экземпляра образа Linux необходимо указать имя узла для виртуальной машины. После запуска виртуальной машины это имя узла публикуется на DNS-серверах платформы, чтобы несколько соединенных между собой виртуальных машин могли выполнять поиск IP-адресов с помощью имен узлов.

При необходимости изменения имени узла после развертывания виртуальной машины рекомендуется использовать команду

	# sudo hostname <newname>

Агент Linux Azure предоставляет функции автоматического обнаружения изменения имени узла и соответствующей настройки виртуальной машины для сохранения этого изменения и его публикации на DNS-серверах платформы.

 - [Руководство пользователя агента Linux для Azure](../virtual-machines-linux-agent-user-guide/)

### Образы Ubuntu
Образы Ubuntu используют программу cloud-init, предоставляющую дополнительные возможности для начальной загрузки виртуальной машины.

 - См. статью [Пользовательские данные и Cloud-Init в Microsoft Azure](http://azure.microsoft.com/blog/2014/04/21/custom-data-and-cloud-init-on-windows-azure/).


## <a id="virtualmachine"></a>Запись образа виртуальной машины

Azure предоставляет возможность записи состояния существующей виртуальной машиной в образ, который впоследствии можно использовать для развертывания дополнительных экземпляров виртуальной машины. Агент Linux Azure может использоваться для отката некоторых настроек, которые были выполнены в процессе подготовки. Вы можете выполнить следующие действия, чтобы записать виртуальную машину в виде образа:

1. Выполните команду **waagent -deprovision** для отмены настройки подготовки. Или выполните команду **waagent -deprovision+user** при необходимости, чтобы удалить учетную запись пользователя, указанную во время подготовки, и все связанные с ней данные.

2. Остановите работу виртуальной машины или выключите ее.

3. Нажмите кнопку  *Capture* на портале управления или используйте программы командной строки или Powershell, чтобы записать образ виртуальной машины.

 - См. [Как записать образ виртуальной машины Linux для использования в качестве шаблона](../virtual-machines-linux-capture-image/)


## <a id="attachingdisks"></a>Подключение дисков

У каждой виртуальной машины также есть подключенный временный локальный  *диск ресурсов*. Так как данные на диске ресурсов могут плохо переносить перезагрузки, его часто используют приложения и процессы, выполняющиеся в виртуальной машине, для **временного** хранения данных. Он также используется для хранения страниц или замены файлов операционной системы.

В системе Linux диск ресурсов обычно управляется агентом Linux Azure, и он автоматически подключается к **/mnt/resource** (или **/mnt** на образах Ubuntu).

	>[AZURE.NOTE] Следует отметить, что диск ресурсов является **временным** и может быть удален и переформатирован при перезагрузке виртуальной машины.

В Linux диск данных можно назвать по ядру, например,  `/dev/sdc`, и пользователям придется выполнить разбиение на разделы, форматирование и подключение этого ресурса. Это подробно рассматривается в учебнике [Как присоединить диск данных к виртуальной машине](../virtual-machines-linux-how-to-attach-disk/).

 - См. также: [Настройка программного RAID-массива в Linux](../virtual-machines-linux-configure-raid/)

<!--HONumber=42-->
