<properties linkid="manage-linux-fundamentals-intro-to-linux" urlDisplayName="Intro to Linux" pageTitle="Introduction to Linux in Azure - Azure Tutorial" metaKeywords="Azure Linux vm, Linux vm" description="Learn about using Linux virtual machines on Azure." metaCanonical="" services="virtual-machines" documentationCenter="Python" title="Introduction to Linux on Azure" authors="szark" solutions="" manager="" editor="" />

<tags ms.service="virtual-machines" ms.workload="infrastructure-services" ms.tgt_pltfrm="vm-linux" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="szark"></tags>

# Введение в Linux в Azure

В этом разделе содержится обзор некоторых аспектов использования виртуальных машин Linux в облаке Azure. Развертывание виртуальной машины Linux представляет собой простой процесс, если используется существующий образ из коллекции.

## Оглавление

-   [Проверка подлинности: имена пользователей, пароли и ключи SSH.][Проверка подлинности: имена пользователей, пароли и ключи SSH.]
-   [Создание и использование SSH-ключей для входа на виртуальные машины Linux.][Создание и использование SSH-ключей для входа на виртуальные машины Linux.]
-   [Получение привилегий суперпользователя с помощью sudo][Получение привилегий суперпользователя с помощью sudo]
-   [Настройка брандмауэра][Настройка брандмауэра]
-   [Изменения имени узла][Изменения имени узла]
-   [Запись образа виртуальной машины][Запись образа виртуальной машины]
-   [Присоединение дисков][Присоединение дисков]

## <span id="authentication"></span></a>Проверка подлинности: имена пользователей, пароли и ключи SSH

При создании виртуальной машины Linux с помощью портала управления Azure вам будет предложено указать имя пользователя, пароль и (при необходимости) открытый SSH-ключ. К имени пользователя при развертывании виртуальной машины Linux на платформе Azure применяется следующее ограничение: имена учетных записей (UID \<100), которые уже используются на виртуальной машине, не допускаются (например, root).

-   См. [Использование SSH с Linux в Azure][Использование SSH с Linux в Azure]

### <span id="keygeneration"></span></a>Создание ключа SSH

Текущая версия портала управления принимает только открытые ключи SSH, инкапсулированные в сертификате X509. Для создания и использования ключей SSH в Azure выполните описанные ниже действия.

1.  С помощью openssl создайте сертификат X509 с парой ключей RSA 2048 бит.

        openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout myPrivateKey.key -out myCert.pem

    Ответьте на несколько вопросов, которые запрашивает openssl (можете оставить их пустыми). Контент этих полей не используется платформой.

2.  Измените разрешения для закрытого ключа, чтобы защитить его.

        chmod 600 myPrivateKey.key

3.  Преобразуйте myCert.pem в myCert.cer (сертификат X 509 в кодировке DER).

        openssl  x509 -outform der -in myCert.pem -out myCert.cer

4.  При создании виртуальной машины Linux отправьте myCert.pem. В процессе подготовки открытый ключ будет автоматически установлен в этом сертификате в файл authorized\_keys для указанного пользователя в виртуальной машине.

5.  Подключитесь к виртуальной машине Linux с помощью ssh.

        ssh -i  myPrivateKey.key -p port  username@servicename.cloudapp.net

    Будет предложено принять отпечаток пальца открытого ключа узла при первом входе.

6.  При необходимости вы можете скопировать myPrivateKey.key в каталог ~/.ssh/id\_rsa, чтобы клиент openssh смог автоматически получать это без использования параметра "-i".

### Создание ключа из существующего ключа, совместимого с OpenSSH

Предыдущий пример описывает, как создать новый ключ для использования в Windows Azure. В некоторых случаях пользователи могут уже иметь открытый и закрытый ключи, совместимые с OpenSSH, и пожелать использовать те же ключи в Windows Azure.

Закрытые ключи OpenSSH могут считываться напрямую программой `openssl`. Приведенная ниже команда получает существующий закрытый ключ SSH (id\_rsa в представленном ниже примере) и создает открытый ключ `.pem`, который необходим для Azure.

    # openssl req -x509 -key ~/.ssh/id_rsa -nodes -days 365 -newkey rsa:2048 -out myCert.pem

Файл **MyCert.pem** представляет собой открытый ключ, который затем будет использоваться для подготовки виртуальной машины Linux в Windows Azure. Во время подготовки файл `.pem` будет преобразован в совместимый с `openssh` открытый ключ и размещен в `~/.ssh/authorized_keys`.

## <span id="superuserprivileges"></span></a>Получение привилегий суперпользователя с помощью `sudo`

Учетная запись пользователя, указанная во время развертывания экземпляра виртуальной машины в Azure, является привилегированной учетной записью. Эта учетная запись настраивается агентом Linux Azure, чтобы иметь возможность повысить привилегии до уровня root (учетная запись суперпользователя) с помощью программы `sudo`. После входа в систему с помощью этой учетной записи пользователя вы сможете выполнять команды от учетной записи root, используя синтаксис команды

    # sudo <COMMAND>

При необходимости можно получить доступ к оболочке root с помощью команды **sudo -s**.

-   См. [Использование прав корневой учетной записи на виртуальных машинах Linux в Azure][Использование прав корневой учетной записи на виртуальных машинах Linux в Azure].

## <span id="firewallconfiguration"></span></a>Настройка брандмауэра

Azure предоставляет фильтр входящих пакетов, который ограничивает возможности подключения к портам, указанным на портале управления. По умолчанию разрешен только порт SSH. Можно открыть доступ к дополнительным портам на виртуальной машине Linux, настроив конечные точки на портале управления:

-   См. [Настройка конечных точек виртуальной машины][Настройка конечных точек виртуальной машины]

Образы Linux в коллекции Azure не включают брандмауэр *iptables* по умолчанию. При необходимости этот брандмауэр можно настроить для предоставления дополнительных возможностей фильтрации.

## <span id="hostnamechanges"></span></a>Изменения имени узла

При начальном развертывании экземпляра образа Linux необходимо указать имя узла для виртуальной машины. После запуска виртуальной машины это имя узла публикуется на DNS-серверах платформы, чтобы несколько соединенных между собой виртуальных машин могли выполнять поиск IP-адресов с помощью имен узлов.

При необходимости изменения имени узла после развертывания виртуальной машины рекомендуется использовать команду

    # sudo hostname <newname>

Агент Linux Azure предоставляет функции автоматического обнаружения изменения имени узла и соответствующей настройки виртуальной машины для сохранения этого изменения и его публикации на DNS-серверах платформы.

-   [Руководство пользователя агента Linux для Azure][Руководство пользователя агента Linux для Azure]

### Образы Ubuntu

Образы Ubuntu используют программу cloud-init, предоставляющую дополнительные возможности для начальной загрузки виртуальной машины.

-   См. [Пользовательские данные и Cloud-Init в Microsoft Azure][Пользовательские данные и Cloud-Init в Microsoft Azure]

## <span id="virtualmachine"></span></a>Запись образа виртуальной машины

Azure предоставляет возможность записи состояния существующей виртуальной машиной в образ, который впоследствии можно использовать для развертывания дополнительных экземпляров виртуальной машины. Агент Linux Azure может использоваться для отката некоторых настроек, которые были выполнены в процессе подготовки. Вы можете выполнить следующие действия, чтобы записать виртуальную машину в виде образа:

1.  Выполните команду **waagent -deprovision** для отмены настройки подготовки. Или выполните команду **waagent -deprovision+user** при необходимости, чтобы удалить учетную запись пользователя, указанную во время подготовки, и все связанные с ней данные.

2.  Остановите работу виртуальной машины или выключите ее.

3.  Нажмите кнопку *Запись* на портале управления либо используйте средства Powershell или CLI, чтобы записать образ виртуальной машины.

-   См. [Запись образа виртуальной машины Linux для использования в качестве шаблона][Запись образа виртуальной машины Linux для использования в качестве шаблона]

## <span id="attachingdisks"></span></a>Подключение дисков

Каждая виртуальная машина также имеет подключенный временный локальный *диск ресурсов*. Так как данные на диске ресурсов могут плохо переносить перезагрузки, его часто используют приложения и процессы, выполняющиеся на виртуальной машине, для промежуточного и **временного** хранения данных. Он также используется для хранения страниц или замены файлов операционной системы.

В системе Linux диск ресурсов обычно управляется агентом Linux Azure, и он автоматически подключается к **/mnt/resource** (или **/mnt** на образах Ubuntu).

    >[WACOM.NOTE] Note that the resource disk is a **temporary** disk, and might be deleted and reformatted when the VM is rebooted.

В Linux диск данных можно назвать по ядру, например, `/dev/sdc`, и пользователям придется выполнить разбиение на разделы, форматирование и подключение этого ресурса. Это подробно рассматривается в учебнике [Подключение диска данных к виртуальной машине][Подключение диска данных к виртуальной машине].

-   Дополнительные материалы: [Настройка программного RAID-массива в Linux][Настройка программного RAID-массива в Linux]

  [Проверка подлинности: имена пользователей, пароли и ключи SSH.]: #authentication
  [Создание и использование SSH-ключей для входа на виртуальные машины Linux.]: #keygeneration
  [Получение привилегий суперпользователя с помощью sudo]: #superuserprivileges
  [Настройка брандмауэра]: #firewallconfiguration
  [Изменения имени узла]: #hostnamechanges
  [Запись образа виртуальной машины]: #virtualmachine
  [Присоединение дисков]: #attachingdisks
  [Использование SSH с Linux в Azure]: ../linux-use-ssh-key/
  [Использование прав корневой учетной записи на виртуальных машинах Linux в Azure]: ../virtual-machines-linux-use-root-privileges/
  [Настройка конечных точек виртуальной машины]: ../virtual-machines-set-up-endpoints/
  [Руководство пользователя агента Linux для Azure]: ../virtual-machines-linux-agent-user-guide/
  [Пользовательские данные и Cloud-Init в Microsoft Azure]: http://azure.microsoft.com/blog/2014/04/21/custom-data-and-cloud-init-on-windows-azure/
  [Запись образа виртуальной машины Linux для использования в качестве шаблона]: ../virtual-machines-linux-capture-image/
  [Подключение диска данных к виртуальной машине]: ../virtual-machines-linux-how-to-attach-disk/
  [Настройка программного RAID-массива в Linux]: ../virtual-machines-linux-configure-raid/
