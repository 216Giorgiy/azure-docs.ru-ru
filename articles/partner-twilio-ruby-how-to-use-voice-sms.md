<properties linkid="develop-ruby-how-to-twilio-sms-voice-service" urlDisplayName="Twilio Voice/SMS Service" pageTitle="How to Use Twilio for Voice and SMS (Ruby) - Azure" metaKeywords="Azure Ruby Twilio, Azure phone calls, Azure phone calls, Azure twilio, Azure SMS, Azure SMS, Azure voice calls, azure voice calls, Azure text messages, Azure text messages" description="Learn how to make a phone call and send a SMS message with the Twilio API service on Azure. Code samples written in Ruby." metaCanonical="" services="" documentationCenter="Ruby" title="How to Use Twilio for Voice and SMS Capabilities in PHP" authors="MicrosoftHelp@twilio.com" solutions="" manager="" editor="" />

<tags ms.service="multiple" ms.workload="na" ms.tgt_pltfrm="na" ms.devlang="ruby" ms.topic="article" ms.date="01/01/1900" ms.author="MicrosoftHelp@twilio.com"></tags>

# Использование Twilio для поддержки голосовых возможностей и SMS в Ruby

В этом руководстве показано, как выполнять типовые задачи программирования с помощью службы Twilio API в Azure. Здесь описываются такие сценарии, как телефонный звонок и отправка SMS-сообщения. Дополнительные сведения о Twilio и использовании голосовых функций и SMS в приложениях см. в разделе [Дальнейшие действия][Дальнейшие действия].

## Оглавление

-   [Что такое Twilio?][Что такое Twilio?]
-   [Цены на Twilio][Цены на Twilio]
-   [Основные понятия][Основные понятия]
-   [Создание учетной записи Twilio][Создание учетной записи Twilio]
-   [Создание приложения Sinatra][Создание приложения Sinatra]
-   [Настройка приложения для использования библиотек Twilio][Настройка приложения для использования библиотек Twilio]
-   [Практическое руководство. Осуществление исходящего вызова][Практическое руководство. Осуществление исходящего вызова]
-   [Практическое руководство. Получение SMS-сообщения][Практическое руководство. Получение SMS-сообщения]
-   [Практическое руководство. Дополнительные службы Twilio][Практическое руководство. Дополнительные службы Twilio]
-   [Дальнейшие действия][Дальнейшие действия]

## <span id="WhatIs"></span></a> Что такое Twilio?

Twilio — это API веб-службы телефонии, позволяющий использовать существующие языки веб-программирования и навыки для создания приложений для работы с голосовыми вызовами и SMS. Twilio — это сторонняя служба (не компонент Azure и не продукт Майкрософт).

**Twilio Voice** позволяет приложениям осуществлять и принимать телефонные вызовы. **Twilio SMS** позволяет приложениям отправлять и принимать SMS-сообщения. **Twilio Client** позволяет приложениям реализовать речевую связь с помощью существующих интернет-подключений, в том числе на мобильных устройствах.

## <span id="Pricing"></span></a>Цены и специальные предложения Twilio

Сведения о ценах на Twilio доступны на веб-сайте [цен на Twilio][цен на Twilio]. Клиентам Azure доступно [специальное предложение][специальное предложение]: бесплатный кредит на 1000 текстовых сообщений или 1000 минут входящих вызовов. Чтобы воспользоваться этим предложением или получить дополнительные сведения, посетите веб-сайт [][специальное предложение]<http://ahoy.twilio.com/azure></a>.

## <span id="Concepts"></span></a>Основные понятия

Twilio API — это интерфейс API RESTful, который предоставляет приложениям функции для работы с голосовыми вызовами и SMS. Клиентские библиотеки доступны на разных языках. Полный список см. в разделе [Библиотеки API Twilio][Библиотеки API Twilio].

### <span id="TwiML"></span></a>TwiML

TwiML — это набор инструкций на основе XML, которые сообщают службе Twilio, как необходимо обработать вызов или SMS.

Например, следующие инструкции TwiML преобразуют текст **Hello World** в речь.

    <?xml version="1.0" encoding="UTF-8" ?>
    <Response>
       <Say>Hello World</Say>
    </Response>

Корневым элементом всех документов TwiML является `<Response>`. Вы будете использовать команды Twilio для определения поведения приложения.

### <span id="Verbs"></span></a>Команды TwiML

Команды Twilio — это XML-теги, сообщающие Twilio, что **делать**. Например, команда **\<Say\>** указывает Twilio, что необходимо воспроизвести сообщение в случае вызова.

Ниже приведен список команд Twilio.

-   **\<Dial\>**: подключение вызывающего абонента к другому телефону.
-   **\<Gather\>**: сбор цифр, введенных на клавиатуре телефона.
-   **\<Hangup\>**: окончание вызова.
-   **\<Play\>**: воспроизведение звукового файла.
-   **\<Pause\>**: автоматическое ожидание в течение указанного времени (в секундах).
-   **\<Record\>**: запись голоса вызывающего абонента и возврат URL-адреса файла, содержащего запись.
-   **\<Redirect\>**: передача управления для вызова или SMS в TwiML по другому URL-адресу.
-   **\<Reject\>**: отклонение входящего вызова на ваш номер Twilio без выставления вам счета.
-   **\<Say\>**: преобразование текста в речь в вызове.
-   **\<Sms\>**: отправка SMS-сообщения.

Дополнительные сведения о командах Twilio, их атрибутах и TwiML см. в разделе [TwiML][TwiML]. Дополнительные сведения об API Twilio см. в разделе [API Twilio][API Twilio].

## <span id="CreateAccount"></span></a>Создание учетной записи Twilio

После подготовки к получению учетной записи Twilio зарегистрируйтесь на странице [Попробуйте Twilio][Попробуйте Twilio]. Вы можете начать с бесплатной учетной записи и обновить ее позднее.

После регистрации учетной записи Twilio вы получите бесплатный номер телефона для вашего приложения. Вы также получите идентификатор безопасности учетной записи и маркер проверки подлинности. Эти элементы необходимы для вызовов Twilio API. Чтобы предотвратить несанкционированный доступ к учетной записи, храните маркер проверки подлинности в безопасности. Код безопасности учетной записи и маркер проверки подлинности отображаются на [странице учетной записи Twilio][странице учетной записи Twilio] в полях **КОД БЕЗОПАСНОСТИ УЧЕТНОЙ ЗАПИСИ** и **МАРКЕР ПРОВЕРКИ ПОДЛИННОСТИ** соответственно.

### <span id="VerifyPhoneNumbers"></span></a>Проверка телефонных номеров

В дополнение к номеру, предоставленному Twilio, вы также можете проверить номера, которыми вы управляете (например, номер сотового или домашнего телефона), для использования в приложениях.

Сведения о том, как проверить номер телефона, см. в разделе [Управление номерами][Управление номерами].

## <span id="create_app"></span></a>Создание приложения Ruby

Приложение Ruby, которое использует службу Twilio и выполняется в Azure, не отличается от других приложений Ruby, которые используют службу Twilio. Хотя службы Twilio поддерживают REST и могут вызываться из Ruby несколькими способами, в этой статье основное внимание уделяется использованию служб Twilio с помощью [вспомогательной библиотеки Twilio для Ruby][вспомогательной библиотеки Twilio для Ruby].

[Для начала][Для начала] создайте новую виртуальную машину Azure с Linux, которая будет использоваться в качестве узла для нового веб-приложения Ruby. Игнорируйте инструкции, связанные с созданием приложения Rails, достаточно настроить виртуальную машину. Обязательно создайте конечную точку с внешним портом 80 и внутренним портом 5000.

В приведенных ниже примерах мы будем использовать [Sinatra][Sinatra], очень простую веб-платформу для Ruby. Однако вы можете использовать вспомогательную библиотеку Twilio для Ruby с любой другой веб-платформой, в том числе Ruby on Rails.

Войдите на новую виртуальную машину по протоколу SSH и создайте каталог для нового приложения. В этом каталоге создайте файл с именем Gemfile и скопируйте в него следующий код:

    source 'https://rubygems.org'
    gem 'sinatra'
    gem 'thin'

В командной строке запустите `bundle install`. Эта команда установит описанные выше зависимости. Затем создайте файл с именем `web.rb`. В нем будет размещен код веб-приложения. Вставьте в него следующий код:

    require 'sinatra'

    get '/' do
        "Hello Monkey!"
    end

На этом этапе вы должны выполнить команду `ruby web.rb -p 5000`. Команда настроит небольшой веб-сервер с портом 5000. Вы сможете просмотреть приложение в браузере, перейдя по URL-адресу, настроенному для виртуальной машины Azure. После открытия веб-приложения в браузере вы готовы к созданию приложения Twilio.

## <span id="configure_app"></span></a>Настройка приложения для использования Twilio

Вы можете настроить веб-приложение для использования библиотеки Twilio, добавив в файл `Gemfile` следующую строку:

    gem 'twilio-ruby'

В командной строке запустите `bundle install`. Теперь откройте `web.rb` и добавьте следующую строку в начало файла:

    require 'twilio-ruby'

Теперь вы готовы к использованию вспомогательной библиотеки Twilio для Ruby в веб-приложении.

## <span id="howto_make_call"></span></a>Практическое руководство. Осуществление исходящего вызова

Далее показано, как осуществлять исходящий вызов. К основным понятиям относятся использование вспомогательной библиотеки Twilio для Ruby для вызова API REST и отрисовки TwiML. Замените значения телефонных номеров **From** (От) и **To** (Кому) и проверьте номер телефона **From** (От) для учетной записи Twilio до выполнения кода.

Добавьте эту функцию в файл `web.md`:

    # Set your account ID and authentication token.
    sid = "your_twilio_account_sid";
    token = "your_twilio_authentication_token";

    # The number of the phone initiating the the call.
    # This should either be a Twilio number or a number that you've verified
    from = "NNNNNNNNNNN";

    # The number of the phone receiving call.
    to = "NNNNNNNNNNN";

    # Use the Twilio-provided site for the TwiML response.
    url = "http://yourdomain.cloudapp.net/voice_url";
      
    get '/make_call' do
      # Create the call client.
      client = Twilio::REST::Client.new(sid, token);
      
      # Make the call
      client.account.calls.create(to: to, from: from, url: url)
    end

    post '/voice_url' do
      "<Response>
         <Say>Hello Monkey!</Say>
       </Response>"
    end

Если открыть страницу `http://yourdomain.cloudapp.net/make_call` в браузере, вы активируете вызов Twilio API для осуществления звонка. Назначение первых двух параметров в `client.account.calls.create` очевидно: номер вызывающего (`from`) и номер вызываемого (`to`) абонента.

Третий параметр (`url`) — это URL-адрес, который используется Twilio для получения инструкций по действиям после вызова. В этом случае мы задаем URL-адрес (`http://yourdomain.cloudapp.net`), который возвращает простой документ TwiML и использует команду `<Say>` для преобразования текста в речь ("Hello Monkey") для принимающего вызов абонента.

## <span id="howto_recieve_sms"></span></a>Практическое руководство. Получение SMS-сообщения

В предыдущем примере мы инициировали **исходящий** звонок. На этот раз мы используем номер телефона, предоставленный Twilio во время регистрации, для обработки **входящего** SMS-сообщения.

Во-первых, войдите в [панель мониторинга Twilio][странице учетной записи Twilio]. Щелкните "Номера" на верхней панели навигации и выберите предоставленный вам номер Twilio. Вы увидите два URL-адреса, которые можно настроить: URL-адрес запроса голосового вызова и URL-адрес запроса SMS. Эти URL-адреса используются Twilio при осуществлении голосового вызова или отправке SMS-сообщения на ваш номер. Эти адреса также называют "веб-привязками".

Мы хотели бы обработать входящие SMS-сообщения, поэтому изменим URL-адрес на `http://yourdomain.cloudapp.net/sms_url`. Нажмите кнопку "Сохранить изменения" в нижней части страницы. Теперь вернемся к файлу `web.rb` и напишем код, чтобы наше приложение могло обработать SMS-сообщение.

    post '/sms_url' do
      "<Response>
         <Sms>Hey, thanks for the ping! Twilio and Azure rock!</Sms>
       </Response>"
    end

После внесения изменений перезапустите веб-приложение. Теперь возьмите телефон и отправьте SMS на ваш номер Twilio. Вы должны быстро получить ответ: "Hey, thanks for the ping! Twilio and Azure rock!" (Спасибо за сообщение. Twilio и Azure лучше всех!).

## <span id="additional_services"></span></a>Практическое руководство. Использование дополнительных служб Twilio

Помимо примеров, перечисленных здесь, Twilio предлагает веб-интерфейсы API, с помощью которых вы можете использовать дополнительные функции Twilio из вашего приложения Azure. Дополнительные сведения см. в [документации по интерфейсу API Twilio][API Twilio].

### <span id="NextSteps"></span></a> Дальнейшие действия

Вы узнали основные сведения о службе Twilio. Для получения дополнительных сведений используйте следующие ссылки.

-   [Рекомендации по безопасности Twilio][Рекомендации по безопасности Twilio]
-   [Практические руководства и примеры кода Twilio][Практические руководства и примеры кода Twilio]
-   [Краткие учебники по Twilio][Краткие учебники по Twilio]
-   [Twilio на GitHub][Twilio на GitHub]
-   [Обращение в службу поддержки Twilio][Обращение в службу поддержки Twilio]

  [Дальнейшие действия]: #NextSteps
  [Что такое Twilio?]: #WhatIs
  [Цены на Twilio]: #Pricing
  [Основные понятия]: #Concepts
  [Создание учетной записи Twilio]: #CreateAccount
  [Создание приложения Sinatra]: #create_app
  [Настройка приложения для использования библиотек Twilio]: #configure_app
  [Практическое руководство. Осуществление исходящего вызова]: #howto_make_call
  [Практическое руководство. Получение SMS-сообщения]: #howto_recieve_sms
  [Практическое руководство. Дополнительные службы Twilio]: #additional_services
  [цен на Twilio]: http://www.twilio.com/pricing
  [специальное предложение]: http://ahoy.twilio.com/azure
  [Библиотеки API Twilio]: https://www.twilio.com/docs/libraries
  [TwiML]: http://www.twilio.com/docs/api/twiml
  [API Twilio]: http://www.twilio.com/api
  [Попробуйте Twilio]: https://www.twilio.com/try-twilio
  [странице учетной записи Twilio]: https://www.twilio.com/user/account
  [Управление номерами]: https://www.twilio.com/user/account/phone-numbers/verified#
  [вспомогательной библиотеки Twilio для Ruby]: https://www.twilio.com/docs/ruby/install
  [Для начала]: http://www.windowsazure.com/ru-ru/develop/ruby/tutorials/web-app-with-linux-vm/
  [Sinatra]: http://www.sinatrarb.com/
  [Рекомендации по безопасности Twilio]: http://www.twilio.com/docs/security
  [Практические руководства и примеры кода Twilio]: http://www.twilio.com/docs/howto
  [Краткие учебники по Twilio]: http://www.twilio.com/docs/quickstart
  [Twilio на GitHub]: https://github.com/twilio
  [Обращение в службу поддержки Twilio]: http://www.twilio.com/help/contact
