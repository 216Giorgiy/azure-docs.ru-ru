<properties linkid="manage-services-how-to-scale-a-cloud-service" urlDisplayName="How to scale" pageTitle="How to scale a cloud service - Azure" metaKeywords="Azure link resource, scaling cloud service" description="Learn how to scale a cloud service and linked resources in Azure." metaCanonical="" services="cloud-services" documentationCenter="" title="How to Scale an Application" authors="davidmu" solutions="" manager="jeffreyg" editor="mattshel" />

<tags ms.service="cloud-services" ms.workload="tbd" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="davidmu" />

# Масштабирование приложения

[WACOM.INCLUDE [отказ от ответственности](../includes/disclaimer.md)]

На странице «Масштаб» портала управления Azure можно вручную масштабировать приложение или задать параметры для автоматического масштабирования. Можно масштабировать приложения, которые выполняют веб-роли, рабочие роли или виртуальные машины. Чтобы масштабировать приложение, которое выполняет экземпляры веб-ролей или рабочих ролей, необходимо распределить рабочую нагрузку путем добавления или удаления экземпляров.

При масштабировании приложения, в котором работают виртуальные машины, новые машины не создаются и не удаляются, а включаются или отключаются в группе доступности ранее созданных машин. Масштабирование можно задать как на основе среднего процента использования ЦП, так и на основе количества сообщений в очереди.

При настройке масштабирования приложения следует учитывать следующие сведения.

-   Необходимо добавить созданные виртуальные машины в группу доступности, чтобы масштабировать использующее их приложение. Добавляемые виртуальные машины могут быть изначально включены или выключены, однако они будут включены при увеличении масштабирования и выключены при его уменьшении. Дополнительную информацию о виртуальных машинах и группах доступности см. в разделе [Управление доступностью виртуальных машин][Управление доступностью виртуальных машин].
-   Масштабирование зависит от использования ядер. Более крупные экземпляры ролей или виртуальные машины задействуют больше ядер. Масштабировать приложение можно только в пределах количества ядер по используемой подписке. Например, если подписка ограничена двадцатью ядрами и выполняется приложение с двумя средними по размерам виртуальными машинами (всего четыре ядра), можно увеличить масштаб других развернутых в рамках подписки облачных служб на шестнадцать ядер. Все виртуальные машины в группе доступности, используемые при масштабировании приложения, должны быть одного размера. Дополнительную информацию об использовании ядер и размерах машин см. в разделе [Размеры виртуальных машин и облачных служб для Azure][Размеры виртуальных машин и облачных служб для Azure].
-   Прежде чем приступить к масштабированию приложения на основе порогового значения сообщений, необходимо создать очередь и связать ее с ролью или группой доступности. Дополнительную информацию см. в разделе [How to use the Queue Storage Service][How to use the Queue Storage Service] (Как использовать службу хранения очередей).
-   Можно масштабировать ресурсы, привязанные к используемой облачной службе. Дополнительные сведения о привязке ресурсов см. в разделе [Привязка Привязка ресурсов к облачной службе][Привязка Привязка ресурсов к облачной службе].
-   В целях обеспечения высокой доступности приложения необходимо убедиться, что приложение развернуто с двумя и более экземплярами ролей или виртуальных машин. Дополнительные сведения см. в разделе [Соглашения об уровне обслуживания][Соглашения об уровне обслуживания].

Можно выполнить следующие действия по масштабированию облачной службы:

-   [вручную масштабировать приложение, которое выполняет веб-роли или рабочие роли;][вручную масштабировать приложение, которое выполняет веб-роли или рабочие роли;]
-   [Автоматическое масштабирование приложения, выполняющего веб-роли, рабочие роли или виртуальные машины][Автоматическое масштабирование приложения, выполняющего веб-роли, рабочие роли или виртуальные машины]
-   [Масштабирование связанных ресурсов][Масштабирование связанных ресурсов]
-   [Планирование масштабирования приложения][Планирование масштабирования приложения]

## <span id="manualscale"></span></a>Масштабирование вручную приложения, которое выполняет веб-роли или рабочие роли

На странице масштаба можно вручную увеличить или уменьшить количество работающих в облачной службе экземпляров.

1.  На [Портале управления][Портале управления] щелкните **Облачные службы**, затем щелкните имя облачной службы, чтобы открыть панель мониторинга.

2.  Щелкните пункт **Масштаб**. Автоматическое масштабирование по умолчанию отключено для всех ролей, что позволяет вручную изменить количество экземпляров, используемых приложением.

    ![Страница «Масштаб»][Страница «Масштаб»]

3.  Каждая роль в облачной службе имеет ползунок для изменения количества используемых экземпляров. Чтобы добавить экземпляр роли, перетащите ползунок вправо. Чтобы удалить экземпляр, перетащите ползунок влево.

    ![Масштабирование роли][Масштабирование роли]

    Количество используемых экземпляров можно увеличить только в том случае, если для поддержки этих экземпляров используется достаточное количество ядер. Цвета ползунка представляют используемые и доступные по подписке ядра:

    -   синий цвет означает ядра, которые используются выбранной ролью;
    -   темно-серый цвет означает ядра, которые используются всеми ролями и виртуальными машинами в рамках подписки;
    -   светло-серый цвет означает ядра, доступные для использования в рамках масштабирования;
    -   розовый цвет означает внесенные изменения, которые еще не были сохранены.

4.  Щелкните **Сохранить**. Экземпляры роли добавляются и удаляются в зависимости от пользовательского выбора.

## <span id="autoscale"></span></a>Автоматическое масштабирование приложения, выполняющего веб-роли, рабочие роли или виртуальные машины

На странице "Масштаб" можно настроить облачную службу для автоматического увеличения или уменьшения количества экземпляров или виртуальных машин, используемых приложением. Можно настроить масштабирование на основе следующих параметров:

-   [Среднее использование ЦП][Среднее использование ЦП] — если средний процент использования ЦП превышает определенные пороговые значения или опускается ниже этих значений, будет выполняться создание или удаление экземпляров роли, включение виртуальных машин в группу доступности или их исключение из нее.
-   [Сообщения в очереди][Сообщения в очереди] — если количество сообщений в очереди превышает определенное пороговое значение или опускается ниже его, экземпляры роли создаются или удаляются или виртуальные машины включаются в группу доступности или исключаются из нее.

### <span id="averagecpu"></span></a>Среднее использование ЦП

1.  На [Портале управления][Портале управления] щелкните **Облачные службы**, затем щелкните имя облачной службы, чтобы открыть панель мониторинга.
2.  Щелкните пункт **Масштаб**.
3.  Перейдите к разделу роли или группы доступности и щелкните пункт **ЦП**. Это приведет к включению автоматического масштабирования приложения на основе среднего процента ресурсов ЦП, которые оно использует.

    ![Автомасштабирование включено][Автомасштабирование включено]

4.  Каждая роль или группа доступности имеет ползунок для изменения числа экземпляров, доступного для использования. Чтобы задать максимальное количество доступных для использования экземпляров, перетащите вправо расположенный справа ползунок. Чтобы задать минимальное количество доступных для использования экземпляров, перетащите влево расположенный слева ползунок.

    **Примечание.** На странице «Масштаб» пункт **Экземпляр** представляет экземпляр роли или экземпляр виртуальной машины.

    ![Диапазон экземпляров][Диапазон экземпляров]

    Максимальное число экземпляров ограничено числом ядер, доступных в рамках используемой подписки. Цвета ползунка представляют используемые и доступные по подписке ядра:

    -   синий цвет представляет максимальное количество ядер, доступных для использования ролью;
    -   темно-серый цвет означает ядра, которые используются всеми ролями и виртуальными машинами в рамках подписки; Если это значение превышает количество ядер, используемых ролью, цвет меняется на темно-синий;
    -   светло-серый цвет означает ядра, доступные для использования в рамках масштабирования;
    -   розовый цвет означает внесенные изменения, которые еще не были сохранены.

5.  Ползунок используется для определения диапазона среднего процента использования ЦП. Если средний процент использования ЦП превышает заданное максимальное значение, создаются дополнительные экземпляры роли или включаются виртуальные машины. Если средний процент использования ЦП опускается ниже заданного минимального значения, экземпляры роли удаляются или виртуальные машины выключаются. Чтобы задать максимальный средний процент ЦП, перетащите расположенный справа ползунок вправо. Чтобы задать минимальный средний процент использования ЦП, перетащите расположенный слева ползунок влево.

    ![Целевой ЦП][Целевой ЦП]

6.  Можно указать число экземпляров для добавления или включения при каждом масштабировании приложения вверх. Чтобы увеличить количество экземпляров, создаваемых или включаемых при масштабировании приложения в сторону увеличения, перетащите ползунок вправо. Чтобы уменьшить это количество, перетащите ползунок влево.

    ![Увеличение масштаба ЦП][Увеличение масштаба ЦП]

7.  Задайте количество минут ожидания между предыдущим действием по масштабированию и следующим действием по увеличению масштаба. Последнее действие по масштабированию может быть как увеличением, так и уменьшением масштаба.

    ![Увеличение масштаба][Увеличение масштаба]

    При вычислении среднего процента использования ЦП учитываются все экземпляры, а среднее значение основано на использовании в течение предыдущего часа. В зависимости от количества экземпляров, используемых приложением, действие по масштабированию может занять дольше указанного времени ожидания, если для последнего указано слишком низкое значение. Минимальное время между масштабированием составляет пять минут. Действия по масштабированию не могут возникать, если любой из экземпляров находится в состоянии перехода.

8.  Можно также указать количество экземпляров для удаления или выключения при масштабировании приложения в сторону уменьшения. Чтобы увеличить количество экземпляров, удаляемых или выключаемых при масштабировании приложения в сторону уменьшения перетащите ползунок вправо. Чтобы уменьшить это количество, перетащите ползунок влево.

    ![Уменьшение масштаба ЦП][Уменьшение масштаба ЦП]

    Если приложение характеризуется внезапными всплесками использования ЦП, необходимо убедиться в наличии достаточного минимального количества экземпляров для надлежащей обработки этой активности.

9.  Задайте количество минут ожидания между предыдущим действием по масштабированию и следующим действием по уменьшению масштаба. Последнее действие по масштабированию может быть как увеличением, так и уменьшением масштаба.

    ![Уменьшение масштаба][Уменьшение масштаба]

10. Щелкните **Сохранить**. Масштабирование может выполняться в течение до пяти минут.

### <span id="queuemessages"></span></a>Сообщения в очереди

1.  На [Портале управления][Портале управления] щелкните **Облачные службы**, затем щелкните имя облачной службы, чтобы открыть панель мониторинга.
2.  Щелкните пункт **Масштаб**.
3.  Перейдите к разделу роли или группы доступности и щелкните пункт **Очередь**. Будет включено автоматическое масштабирование приложения на основе целевого количества сообщений в очереди.

    ![Очередь масштабирования][Очередь масштабирования]

4.  Каждая роль или группа доступности в облачной службе имеет ползунок для изменения доступного для использования числа экземпляров. Чтобы задать максимальное количество доступных для использования экземпляров, перетащите вправо расположенный справа ползунок. Чтобы задать минимальное количество доступных для использования экземпляров, перетащите влево расположенный слева ползунок.

    ![Диапазон очереди][Диапазон очереди]

    **Примечание.** На странице «Масштаб» пункт **Экземпляр** представляет экземпляр роли или экземпляр виртуальной машины.

    Максимальное число экземпляров ограничено числом ядер, доступных в рамках используемой подписки. Цвета ползунка представляют используемые и доступные по подписке ядра:

    -   синий цвет представляет максимальное количество ядер, доступных для использования ролью;
    -   темно-серый цвет означает ядра, которые используются всеми ролями и виртуальными машинами в рамках подписки; Если это значение превышает количество ядер, используемых ролью, цвет меняется на темно-синий;
    -   светло-серый цвет означает ядра, доступные для использования в рамках масштабирования;
    -   розовый цвет означает внесенные изменения, которые еще не были сохранены.

5.  Выберите учетную запись хранения, связанную с очередью, которую следует использовать.

    ![Имя хранилища][Имя хранилища]

6.  Выберите очередь.

    ![Имя очереди][Имя очереди]

7.  Укажите количество сообщений, которое должно поддерживаться каждым экземпляром. Экземпляры будут масштабироваться на основе общего числа сообщений, разделенного на целевое количество сообщений на один компьютер.

    ![Количество сообщений][Количество сообщений]

8.  Можно указать число экземпляров для добавления или включения при каждом масштабировании приложения вверх. Чтобы увеличить количество экземпляров, добавляемых или включаемых при масштабировании приложения в сторону увеличения, перетащите ползунок вправо. Чтобы уменьшить это количество, перетащите ползунок влево.

    ![Увеличение масштаба ЦП][Увеличение масштаба ЦП]

9.  Задайте количество минут ожидания между предыдущим действием по масштабированию и следующим действием по увеличению масштаба. Последнее действие по масштабированию может быть как увеличением, так и уменьшением масштаба.

    ![Увеличение масштаба][Увеличение масштаба]

    Минимальное время между масштабированием составляет пять минут. Действия по масштабированию не могут возникать, если любой из экземпляров находится в состоянии перехода.

10. Можно также указать количество экземпляров для удаления или прекращения использования при масштабировании приложения вниз. Ползунок используется для определения шага масштабирования. Чтобы увеличить количество экземпляров, удаляемых или не используемых при масштабировании приложения в сторону уменьшения перетащите ползунок вправо. Чтобы уменьшить это количество, перетащите ползунок влево.

    ![Уменьшение масштаба ЦП][Уменьшение масштаба ЦП]

11. Задайте количество минут ожидания между предыдущим действием по масштабированию и следующим действием по уменьшению масштаба. Последнее действие по масштабированию может быть как увеличением, так и уменьшением масштаба.

    ![Уменьшение масштаба][Уменьшение масштаба]

12. Щелкните **Сохранить**. Масштабирование может выполняться в течение до пяти минут.

## <span id="scalelink"></span></a>Масштабирование связанных ресурсов

Часто при масштабировании роли выгодно масштабировать также и базу данных, используемую приложением. Если база данных связана с облачной службой, можно изменить версию и размер базы данных SQL на странице "Масштабирование".

1.  На [Портале управления][Портале управления] щелкните **Облачные службы**, затем щелкните имя облачной службы, чтобы открыть панель мониторинга.
2.  Щелкните пункт **Масштаб**.
3.  В разделе «Связанные ресурсы» выберите версию, используемую для базы данных.

    ![Связанные ресурсы][Связанные ресурсы]

4.  Выберите размер базы данных.
5.  Нажмите кнопку **Сохранить**, чтобы обновить связанные ресурсы.

## <span id="schedule"></span></a>Планирование масштабирования приложения

Можно запланировать автоматическое масштабирование приложения путем настройки расписаний для различных периодов. Для автоматического масштабирования доступны следующие параметры:

-   **Без расписания** — это параметр по умолчанию, который делает возможным автоматическое масштабирование приложения одинаковым способом в любое время.

-   **День и ночь** — этот параметр позволяет указывать масштабирование для определенного времени суток.

**Примечание.** Сейчас расписания недоступны для приложений, использующих виртуальные машины.

1.  На [Портале управления][Портале управления] щелкните **Облачные службы**, затем щелкните имя облачной службы, чтобы открыть панель мониторинга.
2.  Щелкните пункт **Масштаб**.
3.  На странице "Масштаб" выберите **Настройка расписания**

    ![Планирование масштабирования][Планирование масштабирования]

4.  Выберите тип расписания масштабирования, которое требуется настроить.

5.  Укажите время начала и окончания дня, а также выберите часовой пояс. При планировании дня и ночи указывается время начала и конца дня, оставшееся время представляет ночь.

6.  Чтобы сохранить расписания, щелкните флажок в нижней части страницы.

7.  После сохранения расписаний они появятся в списке. Можно выбрать график, который требуется использовать, а затем изменить настройки масштабирования. Эти настройки масштабирования будут действовать только во время выбранного расписания. Расписания можно изменить, нажав кнопку **Настройка расписания**

  [Управление доступностью виртуальных машин]: http://www.windowsazure.com/ru-ru/manage/windows/common-tasks/manage-vm-availability/
  [Размеры виртуальных машин и облачных служб для Azure]: http://msdn.microsoft.com/ru-ru/library/dn197896.aspx
  [How to use the Queue Storage Service]: http://www.windowsazure.com/ru-ru/develop/net/how-to-guides/queue-service
  [Привязка Привязка ресурсов к облачной службе]: http://www.windowsazure.com/ru-ru/manage/services/cloud-services/how-to-manage-a-cloud-service/#linkresources
  [Соглашения об уровне обслуживания]: https://www.windowsazure.com/ru-ru/support/legal/sla/
  [вручную масштабировать приложение, которое выполняет веб-роли или рабочие роли;]: #manualscale
  [Автоматическое масштабирование приложения, выполняющего веб-роли, рабочие роли или виртуальные машины]: #autoscale
  [Масштабирование связанных ресурсов]: #scalelink
  [Планирование масштабирования приложения]: #schedule
  [Портале управления]: https://manage.windowsazure.com/
  [Страница «Масштаб»]: ./media/cloud-services-how-to-scale/CloudServices_ManualScaleRoles.png
  [Масштабирование роли]: ./media/cloud-services-how-to-scale/CloudServices_SliderRole.png
  [Среднее использование ЦП]: #averagecpu
  [Сообщения в очереди]: #queuemessages
  [Автомасштабирование включено]: ./media/cloud-services-how-to-scale/CloudServices_AutoscaleOn.png
  [Диапазон экземпляров]: ./media/cloud-services-how-to-scale/CloudServices_InstanceRange.png
  [Целевой ЦП]: ./media/cloud-services-how-to-scale/CloudServices_TargetCPURange.png
  [Увеличение масштаба ЦП]: ./media/cloud-services-how-to-scale/CloudServices_ScaleUpBy.png
  [Увеличение масштаба]: ./media/cloud-services-how-to-scale/CloudServices_ScaleUpWaitTime.png
  [Уменьшение масштаба ЦП]: ./media/cloud-services-how-to-scale/CloudServices_ScaleDownBy.png
  [Уменьшение масштаба]: ./media/cloud-services-how-to-scale/CloudServices_ScaleDownWaitTime.png
  [Очередь масштабирования]: ./media/cloud-services-how-to-scale/CloudServices_QueueScale.png
  [Диапазон очереди]: ./media/cloud-services-how-to-scale/CloudServices_QueueRange.png
  [Имя хранилища]: ./media/cloud-services-how-to-scale/CloudServices_StorageAccountName.png
  [Имя очереди]: ./media/cloud-services-how-to-scale/CloudServices_QueueName.png
  [Количество сообщений]: ./media/cloud-services-how-to-scale/CloudServices_TargetMessageNumber.png
  [Связанные ресурсы]: ./media/cloud-services-how-to-scale/CloudServices_ScaleLinkedResources.png
  [Планирование масштабирования]: ./media/cloud-services-how-to-scale/CloudServices_SetUpSchedule.png
