<properties
   pageTitle="Подготовка к публикации или развертыванию приложения Azure из Visual Studio | Microsoft Azure"
   description="Узнайте, как создавать облачные службы и учетные записи хранения, а также настраивать приложения Azure."
   services="visual-studio-online"
   documentationCenter="na"
   authors="TomArcher"
   manager="douge"
   editor="" />
<tags
   ms.service="multiple"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="multiple"
   ms.date="05/08/2016"
   ms.author="tarcher" />

# Подготовка к публикации или развертыванию приложения Azure из Visual Studio

## Обзор

Чтобы опубликовать проект облачной службы, сначала вам необходимо кое-что создать.

- **Облачная служба**. Отвечает за работу ролей в среде Azure.

- **Учетная запись хранения**. Предоставляет доступ к службам BLOB-объектов, очередей и таблиц.

В этой статье мы расскажем о том, как создать нужные службы и настроить ваше приложение.


## Создание облачной службы

Чтобы опубликовать облачную службу в Azure, сначала необходимо создать облачную службу, которая выполняет роли в среде Azure. Облачную службу можно создать на [классическом портале Azure](http://go.microsoft.com/fwlink/?LinkID=213885). Как это сделать, описано в приведенном ниже разделе **Создание облачной службы на классическом портале Azure**. Ее также можно создать в Visual Studio с помощью мастера публикации.

### Создание облачной службы в Visual Studio

1. Откройте контекстное меню проекта Azure и выберите пункт **Опубликовать**.

    ![VST\_PublishMenu](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/vst-publish-menu.png)

1. Войдите в свою учетную запись Майкрософт или учетную запись своей организации, которая связана с вашей подпиской Azure.

1. Нажмите кнопку **Далее**, чтобы перейти на страницу **Параметры**.

    ![Общие параметры в мастере публикации](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/publish-settings-page.png)

1. В списке **Облачные службы** выберите **Создать**. Откроется диалоговое окно **Создание служб Azure**.

1. Введите имя своей облачной службы. Имя будет частью URL-адреса службы, поэтому оно должно быть глобально уникальным. Регистр в имени не учитывается.

### Создание облачной службы на классическом портале Azure

1. Войдите на [классический портал Azure](http://go.microsoft.com/fwlink/?LinkId=253103) на веб-сайте Майкрософт.

1. Чтобы просмотреть список облачных служб, которые вы уже создали, в левой части страницы выберите ссылку «Облачные службы». Этот шаг можно пропустить.

1. В левом нижнем углу щелкните значок **+**, а затем в появившемся меню выберите пункт **Облачная служба**. Откроется новое окно с двумя вариантами: **Быстрое создание** и **Настраиваемое создание**. Выбрав вариант **Быстрое создание**, вы можете создать облачную службу, просто указав ее URL-адрес и регион, в котором она будет физически размещаться. Если выбрать **Настраиваемое создание**, вы сможете сразу опубликовать облачную службу, указав пакет (CSPKG-файл), файл конфигурации (.cscfg) и сертификат. Вариант настраиваемого создания можно не использовать, если вы планируете опубликовать облачную службу с помощью команды **Опубликовать** в проекте Azure. Команда **Опубликовать** доступна в контекстном меню проекта Azure.

1. Выберите вариант **Быстрое создание**. Позже вы сможете опубликовать облачную службу с помощью Visual Studio.

1. Укажите имя для облачной службы. Рядом с именем отобразится полный URL-адрес.

1. В списке выберите регион, в котором находится большинство ваших пользователей.

1. В нижней части окна выберите ссылку **Создать облачную службу**.

## Создание учетной записи хранения

Учетная запись хранения предоставляет доступ к службам BLOB-объектов, очередей и таблиц. Учетную запись хранения можно создать с помощью Visual Studio или [классического портала Azure](http://go.microsoft.com/fwlink/?LinkId=253103).

### Создание учетной записи хранения в Visual Studio

1. В **обозревателе решений** откройте контекстное меню узла **Хранилище** и выберите пункт **Создание учетной записи хранилища**.

    ![Создание новой учетной записи хранения Azure](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/IC744166.png)

1. В диалоговом окне **Создание учетной записи хранилища** укажите для новой учетной записи следующие сведения.
    - Подписка Azure, в которую следует добавить учетную запись хранения.
    - Имя, которое вы хотите использовать для новой учетной записи хранения.
    - Регион или территориальная группа (например, Запад США или Восточная Азия).
    - Тип репликации учетной записи хранения (например, геоизбыточная).

1. Когда все будет готово, выберите **Создать**. Учетная запись хранения появится в **обозревателе сервера** в списке **Хранилище**.

### Создание учетной записи хранения на классическом портале Azure

1. Войдите на [классический портал Azure](http://go.microsoft.com/fwlink/?LinkId=253103) на веб-сайте Майкрософт.

1. Чтобы просмотреть свои учетные записи хранения, выберите в левой части страницы ссылку **Хранилище**. Этот шаг можно пропустить.

1. В левом нижнем углу страницы щелкните значок **+**.

1. В появившемся меню последовательно выберите **Хранилище** и **Быстрое создание**.

1. Введите имя для учетной записи, которое сформирует уникальный URL-адрес.

1. Введите имя для облачной службы. Рядом с именем отобразится полный URL-адрес.

1. В списке регионов выберите тот, в котором находится большинство ваших пользователей.

1. Укажите, следует ли активировать георепликацию. Когда георепликация активирована, данные хранятся в нескольких местах, что снижает вероятность их потери. Эта функция увеличивает стоимость хранения данных. Чтобы сократить расходы, георепликацию лучше активировать во время создания учетной записи хранения, а не после. Дополнительные сведения см. в статье [Георепликация](http://go.microsoft.com/fwlink/?LinkId=253108).

1. В нижней части окна выберите ссылку **Создать учетную запись хранения**.

После создания учетной записи вы увидите URL-адреса, которые можно использовать для работы с ресурсами в каждой из служб хранилища Azure, а также первичный и вторичный ключи доступа для вашей учетной записи. Эти ключи используются для проверки подлинности запросов к службам хранилища.

>[AZURE.NOTE] Вторичный ключ доступа выполняет те же функции, что и первичный. Он создается как запасной на случай, если первичный ключ будет скомпрометирован. Мы рекомендуем регулярно создавать новые ключи доступа. На момент повторного создания первичного ключа в строке подключения укажите вторичный ключ. Когда будет получен новый первичный ключ, укажите его в строке подключения и создайте новый вторичный ключ.

## Настройка в приложении служб из учетной записи хранения

Все роли, которые обращаются к службам хранилища, необходимо настроить так, чтобы они использовали созданные вами службы хранилища Azure. Это можно сделать с помощью нескольких конфигураций служб для вашего проекта Azure. По умолчанию две конфигурации создаются в вашем проекте Azure. Имея несколько конфигураций служб, в коде можно использовать одну строку подключения, а в каждой конфигурации — разное значение этой строки. Например, одну конфигурацию службы можно использовать для локального запуска и отладки приложения с помощью эмулятора хранения Azure, а другую — для публикации приложения в Azure. Дополнительные сведения о конфигурациях служб см. в разделе [Настройка проекта Azure с помощью несколько конфигураций службы](vs-azure-tools-multiple-services-project-configurations.md).

### Настройка в приложении служб, предоставляемых учетной записью хранения

1. Откройте в Visual Studio свое решение Azure. В обозревателе решений откройте контекстное меню для каждой роли в проекте Azure, которая обращается к службам хранилища, и выберите пункт **Свойства**. В редакторе Visual Studio отобразится страница с именем роли. На странице будут представлены поля для вкладки **Конфигурация**.

1. На странице свойств роли щелкните **Параметры**.

1. В списке **Конфигурация службы** выберите имя конфигурации службы, которую нужно изменить. Если нужно изменить все конфигурации службы для этой роли, выберите пункт **Все конфигурации**. Дополнительные сведения об обновлении конфигураций служб см. в разделе **Управление строками подключения для учетных записей хранения** в статье [Настройка ролей для облачной службы Azure с помощью Visual Studio](vs-azure-tools-configure-roles-for-cloud-service.md).

1. Чтобы изменить какой-либо параметр строки подключения, щелкните рядом с ним кнопку с многоточием (**...**). Откроется диалоговое окно **Создание строки подключения к хранилищу**.

1. В разделе **Подключиться с помощью** выберите вариант **Ваша подписка**.

1. В списке **Подписка** выберите свою подписку. Если в списке нет нужной вам подписки, выберите ссылку **Скачать параметры публикации**.

1. В списке **Имя учетной записи** выберите имя своей учетной записи хранения. Инструменты Azure автоматически получат учетные данные хранилища (используется файл PUBLISHSETTINGS). Чтобы указать учетную запись хранения вручную, выберите параметр **Учетные данные, введенные вручную** и перейдите к следующему шагу. Имя учетной записи хранения и первичный ключ можно получить на [классическом портале Azure](http://go.microsoft.com/fwlink/p/?LinkID=213885). Если вы не хотите указывать параметры учетной записи хранения вручную, нажмите кнопку **ОК**, чтобы закрыть диалоговое окно.

1. Выберите ссылку **Ввод учетной записи хранения**.

1. В поле **Имя учетной записи** введите имя своей учетной записи хранения.

    >[AZURE.NOTE] Войдите на [классический портал Azure](http://go.microsoft.com/fwlink/?LinkID=213885) и нажмите кнопку **Хранилище**. На портале отобразится список учетных записей хранения. Выбрав учетную запись, вы попадете на ее страницу, где можно скопировать имя записи. В предыдущей версии классического портала имя учетной записи хранения можно найти в представлении **Учетные записи хранения**. Чтобы скопировать это имя, выделите его в окне **Свойства** и нажмите клавиши CTRL + C. Чтобы вставить скопированное имя в Visual Studio, щелкните в текстовом поле **Имя учетной записи** и нажмите клавиши CTRL + V.

1. В поле **Ключ учетной записи** укажите свой первичный ключ. Его можно ввести вручную или скопировать и вставить с [классического портала Azure](http://go.microsoft.com/fwlink/?LinkID=213885). Инструкции по копированию ключа приведены ниже.

    1. В нижней части страницы соответствующей учетной записи хранения нажмите кнопку **Управление ключами**.

    1. На странице **Управление ключами доступа** выделите текст первичного ключа и нажмите клавиши CTRL + C.

    1. В инструментах Azure вставьте ключ в поле **Ключ учетной записи**.

    1. Чтобы определить, как служба будет обращаться к учетной записи хранения, необходимо выбрать один из следующих параметров.
        - **Использовать HTTP**. Это вариант по умолчанию. Например, `http://<account name>.blob.core.windows.net`.
        - **Использовать HTTPS**. Вариант для безопасного подключения. Например, `https://<accountname>.blob.core.windows.net`.
        - **Указать пользовательские конечные точки**. Вариант для каждой из трех служб. Выбрав его, нужно указать конечные точки в поле для конкретной службы.

        >[AZURE.NOTE] Пользовательские конечные точки позволяют создать более сложную строку подключения. Используя такой формат строки, вы можете указать конечные точки службы хранилища с именем личного домена, которое вы зарегистрировали для своей учетной записи хранения в службе BLOB-объектов. Кроме того, используя подписанный URL-адрес, вы сможете предоставить доступ только к ресурсам BLOB-объектов из одного контейнера. Дополнительные сведения о создании пользовательских конечных точек см. в статье [Настройка строк подключения службы хранилища Azure](storage-configure-connection-string.md).

1. Чтобы сохранить изменения в строках подключения, щелкните **ОК**, а затем на панели инструментов нажмите кнопку **Сохранить**. Чтобы получить сохраненное значение строки подключения в коде, используйте метод [GetConfigurationSettingValue](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.getconfigurationsettingvalue.aspx). Публикуя приложения в Azure, выберите для строки подключения ту конфигурацию службы, которая содержит учетную запись хранения Azure. После публикации приложения убедитесь, что оно работает со службами хранилища Azure так, как и ожидалось.

## Дальнейшие действия

Дополнительные сведения о публикации приложений в Azure из Visual Studio см. в статье [Публикация облачной службы с помощью средств Azure](vs-azure-tools-publishing-a-cloud-service.md).

<!---HONumber=AcomDC_0511_2016-->