<properties 
   pageTitle="Проверка подлинности и авторизация в служебной шин | Microsoft Azure"
   description="Общие сведения о проверке подлинности подписанного URL-адреса (SAS)."
   services="service-bus"
   documentationCenter="na"
   authors="sethmanheim"
   manager="timlt"
   editor="tysonn" />
<tags 
   ms.service="service-bus"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/04/2015"
   ms.author="sethm" />

# Проверка подлинности и авторизация в служебной шине

Приложения могут проходить проверку подлинности в служебной шине Azure, используя либо проверку подлинности подписанного URL-адреса (SAS), либо службу контроля доступа Azure Active Directory (ACS). Проверка подлинности подписанного URL-адреса позволяет проверить подлинность приложений в служебной шине с помощью ключа доступа, настроенного в пространстве имен, или сущности, с которой связаны определенные права. Этот ключ можно использовать для создания маркера подписанного URL-адреса, который клиенты могут использовать при проверке подлинности в служебной шине.

SAS предпочтительнее, чем ACS, так как представляет собой простую, гибкую и удобную в использовании схему проверки подлинности в служебной шине. Приложения могут использовать SAS в ситуациях, когда такое понятие, как авторизованный пользователь, не задействовано.

## Проверка подлинности с помощью подписанного URL-адреса

[Проверка подлинности SAS](service-bus-sas-overview.md) позволяет предоставлять пользователю доступ к ресурсам служебной шины с определенными правами. Проверка подлинности SAS в служебной шине предусматривает настройку соответствующих прав для криптографического ключа в ресурсе служебной шины. Затем клиенты могут получить доступ к этому ресурсу. Для этого им нужно предоставить маркер SAS, который состоит из URI данного ресурса, а также указать срок действия, подписанный с использованием настроенного ключа.

Ключи для SAS можно настроить в пространстве имен служебной шины. Ключ применяется ко всем сущностям обмена сообщениями в этом пространстве имен. Также можно настроить ключи для очередей и разделов служебной шины. SAS также поддерживается в ретрансляторах служебной шины.

Чтобы использовать SAS, можно настроить объект [SharedAccessAuthorizationRule](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.sharedaccessauthorizationrule.aspx) в пространстве имен, очереди или разделе. Этот объект включает следующие компоненты.

- *KeyName* — определяет правило.

- *PrimaryKey* — криптографический ключ, используемый для подписи и проверки маркеров SAS.

- *SecondaryKey* — криптографический ключ, используемый для подписи и проверки маркеров SAS.

- *Rights* — набор прав на прослушивание, отправку или управление.

Правила авторизации, настроенные на уровне пространства имен, могут предоставлять доступ ко всем сущностям в пространстве имен для клиентов с маркерами, подписанными с использованием соответствующего ключа. В пространстве имен, очереди или разделе служебной шины можно настроить до 12 таких правил авторизации. По умолчанию правило [SharedAccessAuthorizationRule](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.sharedaccessauthorizationrule.aspx) со всеми правами настраивается для каждого пространства имен в ходе первоначальной подготовки.

Чтобы получить доступ к сущности, клиенту требуется маркер SAS, созданный с помощью определенного правила [SharedAccessAuthorizationRule](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.sharedaccessauthorizationrule.aspx). Маркер SAS создается с помощью хэш-функции HMAC-SHA256 строки ресурса, состоящей из URI ресурса, к которому запрашивается доступ, и срока действия с криптографическим ключом, связанным с правилом авторизации.

Поддержка проверки подлинности SAS для служебной шины включена в пакет Azure SDK для .NET 2.0 и более поздних версий. SAS включает поддержку правила [SharedAccessAuthorizationRule](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.sharedaccessauthorizationrule.aspx). Все интерфейсы API, которые принимают строку подключения в качестве параметра, поддерживают строки подключения SAS.

## Проверка подлинности ACS

Проверка подлинности служебной шины с помощью ACS осуществляется с помощью сопутствующего пространства имен ACS (-sb). Вам может потребоваться создать сопутствующее пространство имен ACS для пространства имен служебной шины. При этом вы не сможете создать пространство имен служебной шины с помощью портала Azure. Это нужно сделать с помощью командлета PowerShell [New-AzureSBNamespace](https://msdn.microsoft.com/library/azure/dn495165.aspx). Например:

```
New-AzureSBNamespace <namespaceName> "<Region>” -CreateACSNamespace $true
```

Чтобы не создавать пространство имен ACS, выполните такую команду:

```
New-AzureSBNamespace <namespaceName> "<Region>” -CreateACSNamespace $false
```

Например, если вы создаете пространство имен служебной шины с именем **contoso.servicebus.windows.net**, сопутствующее пространство имен ACS **contoso-sb.accesscontrol.windows.net** подготавливается автоматически. Для всех пространств имен, созданных до августа 2014 г., также создано сопутствующее пространство имен ACS.

По умолчанию владелец учетной записи службы (учетная запись со всеми правами) подготавливается в этом сопутствующем пространстве имен ACS. Для точного управления любой сущностью служебной шины с помощью ACS следует настроить соответствующие отношения доверия. Можно настроить дополнительные удостоверения службы для управления доступом к сущностям служебной шины.

Чтобы получить доступ к сущности, клиент запрашивает маркер SWT из ACS с соответствующими утверждениями, предоставляя свои учетные данные. Затем маркер SWT необходимо отправить в служебную шину как часть запроса. Это позволит авторизовать клиента для получения доступа к сущности.

Поддержка проверки подлинности ACS для служебной шины включена в пакет Azure SDK для .NET 2.0 и более поздних версий. Эта проверка подлинности включает поддержку [SharedSecretTokenProvider](https://msdn.microsoft.com/library/azure/microsoft.servicebus.sharedsecrettokenprovider.aspx). Все интерфейсы API, которые принимают строку подключения в качестве параметра, поддерживают строки подключения ACS.

## Дальнейшие действия

Дополнительные сведения о SAS см. в статье [Проверка подлинности подписанного URL-адреса в служебной шине](service-bus-shared-access-signature-authentication.md).

Более подробные сведения об использовании SAS в служебной шине см. в статье [Подписанные URL-адреса](service-bus-sas-overview.md).

Дополнительные сведения о маркерах ACS см. в статье [Запрос маркера из ACS через протокол OAuth WRAP](https://msdn.microsoft.com/library/hh674475.aspx).

<!---HONumber=Nov15_HO3-->