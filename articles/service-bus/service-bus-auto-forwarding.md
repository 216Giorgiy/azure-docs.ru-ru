<properties 
   pageTitle="Автоматическая пересылка сущностей обмена сообщениями служебной шины | Microsoft Azure"
   description="В этой статье описывается, как привязать очередь или подписку к другой очереди или разделу, которые являются частью одного и того же пространства имен."
   services="service-bus"
   documentationCenter="na"
   authors="sethmanheim"
   manager="timlt"
   editor="tysonn" /> 
<tags 
   ms.service="service-bus"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/18/2015"
   ms.author="sethm" />

# Объединение в цепочки сущностей служебной шины с помощью автоматической пересылки

Функция *автоматической пересылки* позволяет привязать очередь или подписку к другой очереди или разделу, которые являются частью одного и того же пространства имен службы. Если включена автоматическая пересылка, служебная шина автоматически удаляет сообщения, помещенные в первую очередь или подписку (источник), и помещает их во вторую очередь или раздел (адресат). Обратите внимание, что при этом сохраняется возможность отправить сообщение в объект адресата напрямую. Также обратите внимание, что подочередь, например очередь недоставленных сообщений, нельзя привязать к другой очереди или разделу.

## Использование автоматической пересылки

Автоматическую пересылку можно включить, установив свойства [QueueDescription.ForwardTo][] или [SubscriptionDescription.ForwardTo][] объектов [QueueDescription][] или [SubscriptionDescription][] источника, как показано в следующем примере.

```
SubscriptionDescription srcSubscription = new SubscriptionDescription (srcTopic, srcSubscriptionName);
srcSubscription.ForwardTo = destTopic;
namespaceManager.CreateSubscription(srcSubscription));
```

Объект адресата должен существовать на момент создания сущности источника. Если сущность адресата не существует, служебная шина возвращает исключение при попытке создать сущность источника.

С помощью автоматической пересылки можно выполнить масштабирование отдельного раздела. Служебная шина ограничивает количество подписок на определенный раздел. Создав разделы второго уровня, можно разместить дополнительные подписки. Обратите внимание, что даже если вы не связаны ограничением служебной шины на количество подписок, добавление разделов второго уровня может повысить общую пропускную способность раздела.

![Сценарий автоматической пересылки][0]

С помощью автоматической пересылки также можно разделить отправителей и получателей сообщений. Например, представьте систему ERP, состоящую из трех модулей: обработки заказов, управления запасами и управления отношениями с клиентами. Каждый из этих модулей создает сообщения, передаваемые в очередь в соответствующем разделе. Алиса и Роберт — торговые представители, которых интересуют все сообщения, относящиеся к своим клиентам. Для получения этих сообщений Алиса и Роберт создают персональные очереди и подписки на каждом из разделов ERP, которые автоматически пересылают все сообщения в их очереди.

![Сценарий автоматической пересылки][1]

Если Алиса уйдет в отпуск, то заполнится ее личная очередь, а не очередь раздела ERP. В этом сценарии ни один из разделов ERP не достигнет выделенной квоты, так как торговый представитель не получил ни одного сообщения.

## Рекомендации при использовании автоматической пересылки

Если сущность адресата накапливает много сообщений и превышает квоту или сущность адресата отключена, то сущность источника добавляет сообщения в очередь недоставленных сообщений до тех пор, пока у адресата не появится место (или сущность адресата не будет снова включена). Эти сообщения будут находиться в очереди недоставленных сообщений, поэтому необходимо явным образом получать и обрабатывать их из этой очереди.

При объединении в цепочку отдельных разделов для получения составного раздела с несколькими подписками рекомендуется, чтобы количество подписок на раздел первого уровня было умеренным, а на разделы второго уровня — большим. Например, раздел первого уровня с 20 подписками, каждая из которых объединена в цепочку с разделом второго уровня с 200 подписками, позволяет получить более высокую пропускную способность по сравнению с разделом первого уровня с 200 подписками, каждая из которых объединена в цепочку с разделом второго уровня с 20 подписками.

Служебная шина тарифицирует каждое перенаправленное сообщение как одну операцию. Например, отправка сообщения в раздел с 20 подписками, каждая из них настроена на автоматическую пересылку сообщений в другую очередь или раздел, тарифицируется как 21 операция, если все подписки первого уровня получили копию сообщения.

Для создания подписки, которая привязана к другой очереди или разделу, создатель подписки должен иметь разрешение на **управление** для сущности источника и сущности адресата. Для отправки сообщений в раздел источника требуется только разрешение на **отправку** для раздела источника.

## Дальнейшие действия

Подробные сведения об автоматической пересылке см. в следующих разделах:

- [SubscriptionDescription.ForwardTo][]
- [QueueDescription][]
- [SubscriptionDescription][]

Дополнительные сведения об улучшении производительности служебной шины см. в статье [Секционирование сущностей обмена сообщениями][].

  [QueueDescription.ForwardTo]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.queuedescription.forwardto.aspx
  [SubscriptionDescription.ForwardTo]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.subscriptiondescription.forwardto.aspx
  [QueueDescription]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.queuedescription.aspx
  [SubscriptionDescription]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.subscriptiondescription.aspx
  [0]: ./media/service-bus-auto-forwarding/IC628631.gif
  [1]: ./media/service-bus-auto-forwarding/IC628632.gif
  [Секционирование сущностей обмена сообщениями]: service-bus-partitioning.md

<!---HONumber=Oct15_HO3-->