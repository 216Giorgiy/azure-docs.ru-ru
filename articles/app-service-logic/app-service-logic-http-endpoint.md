<properties
   pageTitle="Приложения логики как вызываемые конечные точки"
   description="Создание и настройка прослушивателя HTTP и его использование в приложении логики в службе приложений Azure"
   services="app-service\logic"
   documentationCenter=".net,nodejs,java"
   authors="jeffhollan"
   manager="dwrede"
   editor=""/>

<tags
   ms.service="app-service-logic"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="integration"
   ms.date="04/05/2016"
   ms.author="jehollan"/>


# Приложения логики как вызываемые конечные точки

В предыдущей версии схемы приложений логики (*2014-12-01-preview*) для доступа к конечной точке HTTP с возможностью синхронного вызова требовалось приложение API под названием **Прослушиватель HTTP**. В новой схеме (*2015-08-01-preview*) приложения логики могут обращаться к синхронной конечной точке HTTP самостоятельно.

## Добавление триггера в определение
Первый шаг — это добавить триггер в определение приложения логики, способное принимать входящие запросы. Существует три типа триггеров, которые могут получать запросы:
* manual,
* apiConnectionWebhook,
* httpWebhook.

В этой статье для примера используется триггер **manual**; все описанные принципы точно так же применяются и к двум остальным типам триггеров. Добавление триггера в определение рабочего процесса будет выглядеть следующим образом:

```
{
    "$schema": "http://schema.management.azure.com/providers/Microsoft.Logic/schemas/2015-08-01-preview/workflowdefinition.json#",
    "triggers" : {
        "myendpointtrigger" : {
            "type" : "manual"
        }
    }
}
```

При этом создается конечная точка, вызов которой осуществляется по URL-адресу следующего вида:
 
```
https://prod-03.brazilsouth.logic.azure.com:443/workflows/080cb66c52ea4e9cabe0abf4e197deff/triggers/myendpointtrigger?...
```

Эту конечную точку в пользовательском интерфейсе можно получить здесь:

![][1]

Также можно вызвать следующий метод:

```
POST https://management.azure.com/{resourceID of your logic app}/triggers/myendpointtrigger/listCallbackURL?api-version=2015-08-01-preview
```

## Вызов конечной точки триггера для приложения логики
Созданную конечную точку триггера можно сохранить в серверной системе и вызывать с помощью метода `POST` с полным URL-адресом. В тело можно включать дополнительные параметры запроса, заголовки и любое другое содержимое.

Тип содержимого `application/json` позволяет ссылаться на свойства из самого запроса. При использовании других типов содержимого запрос считается отдельной двоичной единицей, которая может передаваться в другие API, но недоступна для ссылок изнутри.

Кроме того, можно указать схему JSON в определении, чтобы конструктор создавал маркеры, которые можно передавать в действия. Например, следующий код делает маркеры `title` и `name` доступными в конструкторе:

```
{
    "manual": {
        "inputs":{
            "schema": {
                "properties":{
                    "title": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    }
                },
                "required": [
                    "title",
                    "name"
                ],
                "type": "object"
            }
        }
    }
}
```

## Ссылка на содержимое входящего запроса
Функция `@triggerOutputs()` выводит содержимое входящего запроса. Это может выглядеть следующим образом:

```
{
    "headers" : {
        "content-type" : "application/json"
    },
    "body" : {
        "myprop" : "a value"
    }
}
```

Для доступа непосредственно к свойству `body` можно использовать сокращенный вариант `@triggerBody()`.

Это небольшое отличие от версии *2014-12-01-preview*, где доступ к телу прослушивателя HTTP осуществлялся с помощью функции вида `@triggerOutputs().body.Content`.

## Ответ на запрос
Некоторые запросы, запускающие приложение логики, подразумевают определенный ответ. Для составления кода состояния, тела и заголовков ответа можно использовать новый тип действия под названием **response**. Обратите внимание на то, что в отсутствие формы **response** конечная точка приложения логики *мгновенно* отвечает сообщением **202 Запрос принят** (эквивалент действия *Отправлять ответ автоматически* в прослушивателе HTTP).

```
"myresponse" : {
    "type" : "response",
    "inputs" : {
        "statusCode" : 200,
        "body" : {
            "contentFieldOne" : "value100",
            "anotherField" : 10.001
        },
        "headers" : {
            "x-ms-date" : "@utcnow()",
            "Content-type" : "application/json"
        }
    },
    "conditions" : []
}
```

Ответы содержат следующее:

| свойства; | Описание |
| -------- | ----------- |
| statusCode | Код состояния HTTP для ответа на входящий запрос. Это может быть любой допустимый код состояния, который начинается с 2xx, 4xx или 5xx. Коды состояния 3xx не допускаются. | 
| body | Тело ответа. Это может быть строка, объект JSON и даже двоичное содержимое из предыдущего шага. | 
| headers | В ответ можно включить любое число заголовков. | 

Чтобы исходный запрос получил ответ, все необходимые для этого действия в приложении логики должны выполняться в течение *60 секунд*. Если в течение 60 секунд ответное действие выполнено не будет, срок действия входящего запроса истечет и будет получен ответ HTTP **408 Время ожидания клиента истекло**.

## Расширенная настройка конечной точки
Приложения логики имеют встроенную поддержку конечной точки прямого доступа и для запуска выполнения всегда используют метод `POST`. Ранее приложение API **Прослушиватель HTTP** также поддерживало изменение сегментов URL-адреса и метода HTTP. Можно даже настроить дополнительную защиту или пользовательский домен, добавив его в узел приложения API (веб-приложение, в котором находится приложения API).

Эти функции доступны через **управление API**:
* [Изменение метода запроса](https://msdn.microsoft.com/library/azure/dn894085.aspx#SetRequestMethod)
* [Изменение сегментов URL-адреса запроса](https://msdn.microsoft.com/library/azure/7406a8ce-5f9c-4fae-9b0f-e574befb2ee9#RewriteURL)
* Настройка доменов управления API на вкладке **Настройка** классического портала Azure
* Настройка политики для проверки обычной проверки подлинности (**требуется ссылка**)

## Отличия от версии 2014-12-01-preview

| 2014-12-01-preview | 2015-08-01-preview |
|---------------------|--------------------|
| Приложение API **Прослушиватель HTTP** | Параметр **Триггер запуска вручную** (приложение API не требуется) |
| Параметр прослушивателя HTTP *Отправляет ответ автоматически* | Включение (или не включение) действия **response** в определение рабочего процесса |
| Настройка базовой проверки подлинности или OAuth | через управление API |
| Настройка метода HTTP | через управление API |
| Настройка относительного пути | через управление API |
| Ссылка на тело входящего ответа через `@triggerOutputs().body.Content` | Ссылка через `@triggerOutputs().body` |
| Действие **Отправка HTTP-ответа** в прослушивателе HTTP | Параметр **Ответить на HTTP-запрос** (API-приложение не требуется)


[1]: ./media/app-service-logic-http-endpoint/manualtrigger.png

<!---HONumber=AcomDC_0420_2016-->