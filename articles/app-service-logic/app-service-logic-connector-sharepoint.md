<properties
   pageTitle="Создание соединителя SharePoint для использования в приложении логики"
   description="Создание соединителя SharePoint. Использование соединителя SharePoint в приложении логики"
   services="app-service\logic"
   documentationCenter=".net,nodejs,java"
   authors="anuragdalmia"
   manager="dwrede"
   editor=""/>

<tags
   ms.service="app-service-logic"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="integration"
   ms.date="07/02/2015"
   ms.author="sameerch"/>

# Использование соединителя SharePoint в приложении логики

Приложения логики могут запускаться на основе разных источников данных и предлагать соединители для получения и обработки данных в рамках потока. Соединитель Microsoft SharePoint позволяет подключаться к Microsoft SharePoint Server или SharePoint Online, чтобы управлять документами и элементами списка. Вы можете выполнять различные действия, такие как создание, обновление, получение и удаление документов и элементов списка. При использовании локального сервера SharePoint вы можете предоставить строку подключения к служебной шине как часть конфигурации соединителя и установить агент локального прослушивателя для подключения к серверу.

Приложение соединителя SharePoint Online и соединителя SharePoint Server из коллекции предоставляет вам триггер и действия в качестве механизмов взаимодействия с SharePoint.

## Создание соединителя SharePoint Online

Соединитель можно создать в приложении логики или непосредственно в Azure Marketplace. Создание соединителя в Marketplace

1. На начальной панели Azure выберите **Marketplace**.
2. Выберите **Приложения API** и найдите "Соединитель SharePoint Online".
3. Введите имя, план службы приложений и другие свойства.
4. Введите следующие параметры пакета:

	Имя | Обязательно | Описание
--- | --- | ---
URL-адрес сайта | Да | Введите полный URL-адрес веб-сайта SharePoint. Например, введите *https://microsoft.sharepoint.com/teams/wabstest*. Относительные URL-адреса библиотек или списков документов | Да | Введите URL-адреса библиотек или списков документов, связанных с URL-адресом сайта SharePoint, которые могут изменяться соединителем. Например, введите *Lists/Task, Shared Documents*.

5. После завершения параметры пакета будут выглядеть примерно так: <br/> ![][1]

После этого можно создать приложение логики в той же группе ресурсов для использования соединителя SharePoint Online.

## Создание соединителя SharePoint Server

Соединитель можно создать в приложении логики или непосредственно в Azure Marketplace. Создание соединителя в Marketplace

1. На начальной панели Azure выберите **Marketplace**.
2. Выберите **Приложения API** и найдите "Соединитель SharePoint Server".
3. Введите имя, план службы приложений и другие свойства.
4. Введите следующие параметры пакета:

	Имя | Обязательно | Описание
--- | --- | ---
URL-адрес сайта | Да | Введите полный URL-адрес веб-сайта SharePoint. Например, введите *https://microsoft.sharepoint.com/teams/wabstest*. Режим проверки подлинности | Да | Введите режим проверки подлинности для подключения к сайту SharePoint. Возможные варианты:<ul><li>Default</li><li>WindowsAuthentication</li><li>FormBasedAuthentication</li></ul><br/><br/>Если выбрать Default, будут использованы текущие учетные данные соединителя SharePoint, т. е. ввод имени пользователя и пароля не обязателен. Для других типов проверки подлинности необходимо вести имя пользователя и пароль.<br/><br/>**Примечание.** Анонимная проверка подлинности не поддерживается.
Имя пользователя | Нет | Введите допустимое имя пользователя для подключения к веб-сайту SharePoint, если не используется режим проверки подлинности Default.
Пароль | Нет | Введите допустимый пароль для подключения к веб-сайту SharePoint, если не используется режим проверки подлинности Default.
Относительные URL-адреса библиотек документов и списков | Да | Введите URL-адреса библиотек и списков документов, связанных с URL-адресом сайта SharePoint, которые могут изменяться соединителем. Например, введите *Lists/Task, Shared Documents*.
Строка подключения к служебной шине | Нет | При подключении к локальной среде введите строку подключения ретранслятора служебной шины.<br/><br/>[Использование диспетчера гибридных соединений](app-service-logic-hybrid-connection-manager.md)<br/>[Служебная шина — цены](http://azure.microsoft.com/pricing/details/service-bus/)

5. После завершения параметры пакета будут выглядеть примерно так: <br/> ![][2]

После этого можно приступить к созданию приложения логики в той же группе ресурсов для использования соединителя SharePoint Server.


## Использование соединителя SharePoint в приложении логики

После создания приложения API можно использовать соединитель SharePoint как триггер или действие для приложения логики. Для этого необходимо выполнить следующие действия.

1. Создайте новое приложение логики и выберите ту же группу ресурсов, что и у соединителя SharePoint.

2. Откройте раздел **Триггеры и действия**, чтобы открыть конструктор приложения логики и настроить рабочий процесс. Соединитель SharePoint будет отображаться в разделе "Недавно использовавшиеся" в коллекции с правой стороны. Выберите его.

3. Если соединитель SharePoint выбран при запуске приложения логики, он действует как триггер. В противном случае с помощью соединителя можно выполнять действия с учетной записью SharePoint.

4. Если используется соединитель SharePoint Online, необходимо выполнить проверку подлинности и авторизацию приложения логики для выполнения операций от вашего имени. Чтобы запустить авторизацию, нажмите кнопку **Авторизовать** в соединителе SharePoint: <br/> ![][3]

5. После нажатия кнопки "Авторизовать" открывается диалоговое окно проверки подлинности SharePoint. Введите данные для входа учетной записи SharePoint, в которой вы хотите выполнять операции: <br/> ![][4]

6. Предоставьте приложениям логики доступ к своей учетной записи для выполнения операций от вашего имени: <br/> ![][5]

7. Если соединитель SharePoint настроен как триггер, тогда отображаются триггеры. В противном случае отображается список действий и вы можете выбрать соответствующую операцию, которую необходимо выполнить: <br/> ![][6] <br/> **Относительный URL-адрес для библиотеки документов** <br/> ![][7] <br/> **Относительный URL-адрес для списка документов**

> [AZURE.NOTE]Для приведенных далее триггеров предполагается, что пользователь указал "Shared Documents, Lists/Task" в параметрах пакета соединителя, где Shared Documents — это библиотека документов, а Lists/Task — список.

##  Триггеры
Используйте триггеры, если вы хотите инициировать приложение логики.

> [AZURE.NOTE]Триггеры удаляют файлы после их чтения. Чтобы сохранить эти файлы, укажите значение для расположения архива.

### 1. Новый документ в общих документах (JSON)
Этот триггер срабатывает, когда в библиотеке "Общие документы" появляется доступный новый документ.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
Имя представления | Нет | Введите допустимое представление, используемое для фильтрации документов для выбора. Например, введите "Утвержденные заказы". Чтобы обрабатывать все существующие документы, оставьте это поле пустым.
Расположение архива | Нет | Введите допустимый URL-адрес папки относительно сайта SharePoint, куда архивируются обработанные документы.
Перезаписать в архиве | Нет | Установите этот флажок для перезаписи файла в архиве, если он уже существует.
Запрос CAML | Нет, дополнительно | Введите допустимый запрос Caml для сортировки документов. Например, введите `<Where><Geq><FieldRef Name='ID'/><Value Type='Number'>10</Value></Geq></Where>`.

#### Выходные данные

Имя | Описание
--- | ---
Имя | Имя документа.
Содержимое | Содержимое документа.
ContentTransferEncoding | Кодирование передачи содержимого сообщения ("нет" или base64).

**Примечание.** Все столбцы элемента документа отображаются в свойствах выходных данных "Дополнительно".


### 2. Новый элемент в задачах (JSON)
Этот триггер срабатывает, когда в список "Задачи" добавляется новый элемент.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
Имя представления | Нет | Введите допустимое представление, используемое для фильтрации элементов в списке. Например, введите "Утвержденные заказы". Чтобы обрабатывать все новые элементы, оставьте это поле пустым.
Расположение архива | Нет | Введите допустимый URL-адрес папки относительно сайта SharePoint, где архивируются обработанные элементы списка.
Запрос CAML | Нет, дополнительно | Введите допустимый запрос Caml для сортировки документов. Например, введите `<Where><Geq><FieldRef Name='ID'/><Value Type='Number'>10</Value></Geq></Where>`.

#### Выходные данные

Имя | Описание
--- | ---
Столбцы в списке заполняются динамически и отображаются в выходных параметрах. | &nbsp;


### 3. Новый документ в общих документах (XML)

Этот триггер срабатывает, когда в библиотеке "Общие документы" появляется доступный новый документ. Этот новый документ возвращается как XML-сообщение.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
Имя представления | Нет | Введите допустимое представление, используемое для фильтрации документов для выбора. Например, введите "Утвержденные заказы". Чтобы обрабатывать все существующие документы, оставьте это поле пустым.
Расположение архива | Нет | Введите допустимый URL-адрес папки относительно сайта SharePoint, где архивируются обработанные документы списка.
Перезаписать в архиве | Нет | Установите этот флажок для перезаписи файла в архиве, если он уже существует.
Запрос CAML | Нет, дополнительно | Введите допустимый запрос Caml для сортировки документов. Например, введите `<Where><Geq><FieldRef Name='ID'/><Value Type='Number'>10</Value></Geq></Where>`.

#### Выходные данные

Имя | Описание
--- | ---
Содержимое | Содержимое документа.
ContentTransferEncoding | Кодирование передачи содержимого сообщения ("нет" или base64)


### 4. Новый элемент в задачах (XML)

Этот триггер срабатывает, когда в список "Задачи" добавляется новый элемент. Этот новый элемент списка возвращается в виде XML-сообщения.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
Имя представления | Нет | Введите допустимое представление, используемое для фильтрации элементов в списке. Пример: "Утвержденные заказы". Чтобы обрабатывать все новые элементы, оставьте это поле пустым.
Расположение архива | Нет | Введите допустимый URL-адрес папки относительно сайта SharePoint, где архивируются обработанные элементы списка.
Запрос CAML | Нет, дополнительно | Введите допустимый запрос CAML для фильтрации элементов списка. Например, введите `<Where><Geq><FieldRef Name='ID'/><Value Type='Number'>10</Value></Geq></Where>`.

#### Выходные данные

Имя | Описание
--- | ---
Содержимое | Содержимое документа.
ContentTransferEncoding | Кодирование передачи содержимого сообщения ("нет" или base64)


##  Действия
Для приведенных далее действий предполагается, что пользователь указал "Shared Documents, Lists/Task" в параметрах пакета соединителя, где Shared Documents — это библиотека документов, а Lists/Task — список.

### 1. Отправить в общие документы (JSON)

Это действие отправляет новый документ в библиотеку «Общие документы». Входные данные — строго типизированный объект JSON со всеми полями столбцов библиотеки документов.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
Имя | Да | Имя документа.
Содержимое | Да | Содержимое документа.
ContentTransferEncoding | Да | Кодирование передачи содержимого сообщения ("нет" или base64)
Обязательная перезапись | Да | Если указано значение TRUE и документ с заданным именем уже существует, он будет перезаписан.
ReqParam1* | Да | Это один из обязательных параметров для добавления документа в библиотеку документов.
ReqParam2* | Да | Это один из обязательных параметров для добавления документа в библиотеку документов.
OptionalParam1* | Нет. Дополнительно | Это один из необязательных параметров для добавления документа в библиотеку документов.
OptionalParam2* | Нет. Дополнительно | Это один из необязательных параметров для добавления документа в библиотеку документов.

**Примечание.** Все параметры библиотеки документов заполняются динамически. Обязательные параметры видимы, а необязательные параметры находятся в дополнительном разделе.

#### Выходные данные

Имя | Описание
--- | ---
ItemId | Идентификатор элемента документа, добавленного в библиотеку документов.
Состояние | При успешной отправке документа возвращается код состояния 200 (ОК).


 

### 2. Получить из общих документов (JSON)
Это действие возвращает документ из библиотеки документов, исходя из относительного URL-адреса (структуры папок) документа.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
Относительный URI документа | Нет | Введите URL-адрес документа относительно библиотеки "Общие документы". Например, введите *myspec1,myfolder/orders*.

#### Выходные данные

Имя | Описание
--- | ---
Содержимое | Содержимое документа
ContentTransferEncoding | Кодирование передачи содержимого сообщения ("нет" или base64)
Состояние | При успешном выполнении действия возвращается код состояния 200 (ОК).
Param1* | Это один из параметров документа в библиотеке документов.
Param2* | Это один из параметров документа в библиотеке документов.

**Примечание.** Все параметры библиотеки документов заполняются динамически. И они находятся в дополнительном разделе.

 

### 3. Удалить из общих документов

Это действие удаляет документ из библиотеки документов, исходя из относительного URL-адреса (структуры папок) документа.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
Относительный URI документа | Нет | Введите URL-адрес документа относительно библиотеки "Общие документы". Например, введите *myspec1,myfolder/orders*.

#### Выходные данные

Имя | Описание
--- | ---
Состояние | При успешном выполнении действия возвращается код состояния 200 (ОК).


### 4. Вставить в задачи (JSON)

Это действие добавляет элемент в список элементов.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
ReqParam1* | Да | Это один из обязательных параметров для добавления элемента в список.
ReqParam2* | Да | Это один из обязательных параметров для добавления элемента в список.
OptionalParam1* | Нет. Дополнительно | Это один из обязательных параметров для добавления элемента в список.
OptionalParam2* | Нет. Дополнительно | Это один из обязательных параметров для добавления элемента в список.

**Примечание.** Все параметры списка заполняются динамически. Обязательные параметры видимы, а необязательные параметры находятся в дополнительном разделе.

#### Выходные данные

Имя | Описание
--- | ---
ItemId | Идентификатор добавленного элемента списка.
Состояние | При успешной вставке элемента списка возвращается код состояния 200 (ОК).


### 5. Обновить задачи (JSON)

Это действие обновляет элемент в списке элементов.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
ItemId | Да | Идентификатор элемента списка.
ReqParam1* | Нет | Это один из обязательных параметров для добавления элемента в список.
ReqParam2* | Нет | Это один из обязательных параметров для добавления элемента в список.
OptionalParam1* | Нет. Дополнительно | Это один из обязательных параметров для добавления элемента в список.
OptionalParam2* | Нет. Дополнительно | Это один из обязательных параметров для добавления элемента в список.

**Примечание.** Все параметры списка заполняются динамически. Обязательные параметры видимы, а необязательные параметры находятся в дополнительном разделе.

#### Выходные данные

Имя | Описание
--- | ---
Состояние | При успешном обновлении элемента списка возвращается код состояния 200 (ОК).


### 6. Получить элемент из задач (JSON)

Это действие возвращает элемент из списка элементов.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
ItemId | Да | Идентификатор элемента списка.

#### Выходные данные

Имя | Описание
--- | ---
Column1* | Это один из параметров в списке.
Column2* | Это один из параметров в списке.
Состояние | При успешном выполнении действия возвращается код состояния 200 (ОК).

**Примечание.** Столбцы в списке заполняются динамически и отображаются в выходных параметрах.


### 7. Удалить элемент из задач

Это действие удаляет элемент из списка элементов.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
ItemId | Да | Идентификатор элемента списка.

#### Выходные данные

Имя | Описание
--- | ---
Состояние | При успешном удалении элемента списка возвращается код состояния 200 (ОК).


### 8. Список общих документов (JSON)

Это действие возвращает список всех документов в библиотеке документов. Для фильтрации документов можно использовать представление или запрос CAML.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
Имя представления | Нет | Введите допустимое представление, используемое для фильтрации документов для выбора. Например, введите "Утвержденные заказы". Чтобы обрабатывать все существующие документы, оставьте это поле пустым.
Запрос CAML | Нет | Введите допустимый запрос Caml для сортировки документов. Например, введите `<Where><Geq><FieldRef Name='ID'/><Value Type='Number'>10</Value></Geq></Where>`.

#### Выходные данные

Имя | Описание
--- | ---
Документы | Массив из всех документов. Каждый документ имеет следующие поля: <ul><li>Documents </li><li>Name</li><li>Item Id</li><li>Item Full URL</li><li>Advanced</li><li>Item Edit URL</li><li>List Name</li><li>List Full URL</li></ul>
Состояние | При успешной вставке элемента списка возвращается код состояния 200 (ОК).


### 9. Отправить в общие документы (XML)

Это действие отправляет новый документ в библиотеку «Общие документы». Входной документ должен представлять собой полезные XML-данные. Результатом этого действия будут полезные XML-данные.
 
#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
Имя | Да | Имя документа.
Содержимое | Да | Содержимое документа.
ContentTransferEncoding | Да | Кодирование передачи содержимого сообщения ("нет" или base64).
Обязательная перезапись | Да | Если указано значение TRUE и документ с заданным именем уже существует, он перезаписывается.
 
#### Выходные данные

Имя | Описание
--- | ---
Выходные XML-данные | Результат действия отправки в формате XML.
Состояние | При успешной отправке документа возвращается код состояния 200 (ОК).

### 10. Получить из общих документов (XML)

Это действие возвращает документ из библиотеки документов, исходя из относительного URL-адреса (структуры папок) документа.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
Относительный URI документа | Нет | Введите URL-адрес документа относительно библиотеки "Общие документы". Например, введите *myspec1,myfolder/orders*.
Тип файла | Да | Укажите, является ли файл двоичным или текстовым.

#### Выходные данные

Имя | Описание
--- | ---
Выходные XML-данные | Содержимое документа
ContentTransferEncoding | Кодирование передачи содержимого сообщения ("нет" или base64)
Состояние | При успешном выполнении действия возвращается код состояния 200 (ОК).

### 11. Вставить в задачи (XML)

Это действие добавляет элемент в список элементов. Входными данными должны быть полезные XML-данные.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
Входные XML-данные | Да | XML-сообщение, которое содержит значения полей элемента списка для вставки. Создать XML-сообщение можно с помощью приложения API преобразования.

**Примечание.** Все параметры списка заполняются динамически. Обязательные параметры видимы, а необязательные параметры находятся в дополнительном разделе.

#### Выходные данные

Имя | Описание
--- | ---
ItemId | Идентификатор добавленного элемента списка.
Состояние | При успешной вставке элемента списка возвращается код состояния 200 (ОК).


### 12. Обновить задачи (XML)

Это действие обновляет элемент в списке элементов. Входными данными должны быть полезные XML-данные.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
ItemID | Да | Идентификатор элемента списка.
Входные XML-данные | Да | XML-сообщение, которое содержит значения полей элемента списка для вставки. Создать XML-сообщение можно с помощью приложения API преобразования.

**Примечание.** Все параметры списка заполняются динамически. Обязательные параметры видимы, а необязательные параметры находятся в дополнительном разделе.

#### Выходные данные

Имя | Описание
--- | ---
Состояние | При успешном обновлении элемента списка возвращается код состояния 200 (ОК).


### 13. Получить элемент из задач (XML)

Это действие возвращает элемент из списка элементов.

#### Входные данные

Имя | Обязательно | Описание
--- | --- | ---
ItemID | Да | Идентификатор элемента списка.

#### Выходные данные

Имя | Описание
--- | ---
Выходные XML-данные | XML-сообщение, которое содержит значения полей выбранного элемента списка.
Состояние | При успешном выполнении действия возвращается код состояния 200 (ОК).


## Гибридная конфигурация (необязательно)

> [AZURE.NOTE]Этот шаг необходим только в том случае, если SharePoint используется локально под защитой брандмауэра.

Служба приложений использует диспетчер гибридных соединений для безопасного подключения к вашей локальной системе. Если ваш соединитель использует локальный сервер SharePoint, использование диспетчера гибридных соединений обязательно.

См. раздел [Установка диспетчера гибридных соединений](app-service-logic-hybrid-connection-manager.md).

## Дополнительные возможности соединителя
После создания соединителя его можно добавить в рабочий бизнес-процесс с помощью приложения логики. См. раздел [Что такое приложения логики?](app-service-logic-what-are-logic-apps.md).

Можно также просматривать статистику производительности и управлять безопасностью соединителя. См. раздел [Управление приложениями API и соединителем, а также их отслеживание](app-service-api-manage-in-portal.md).

<!--Image references-->
[1]: ./media/app-service-logic-connector-sharepoint/image_0.png
[2]: ./media/app-service-logic-connector-sharepoint/image_1.png
[3]: ./media/app-service-logic-connector-sharepoint/image_2.png
[4]: ./media/app-service-logic-connector-sharepoint/image_3.png
[5]: ./media/app-service-logic-connector-sharepoint/image_4.jpg
[6]: ./media/app-service-logic-connector-sharepoint/image_5.png
[7]: ./media/app-service-logic-connector-sharepoint/image_6.png

<!---HONumber=July15_HO4-->