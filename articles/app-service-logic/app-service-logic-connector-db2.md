<properties
   pageTitle="Использование соединителя DB2 в службе приложений Microsoft Azure | Microsoft Azure"
   description="Использование соединителя DB2 с триггерами и действиями приложения логики"
   services="logic-apps"
   documentationCenter=".net,nodejs,java"
   authors="gplarsen"
   manager="erikre"
   editor=""/>

<tags
   ms.service="logic-apps"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="integration"
   ms.date="05/31/2016"
   ms.author="plarsen"/>

# Соединитель DB2
>[AZURE.NOTE] Эта версия статьи предназначена для приложений логики со схемой версии 2014-12-01-preview.

Соединитель DB2 корпорации Майкрософт — это приложение API для подключения приложений через службу приложений Azure к ресурсам, которые хранятся в базе данных IBM DB2. Соединитель включает клиент Майкрософт для подключения к удаленным серверам DB2 через сетевые подключения TCP/IP, включая гибридные подключения Azure к локальным серверам DB2 с использованием ретранслятора служебной шины Azure. Соединитель поддерживает следующие операции с базой данных:

- чтение строк с помощью инструкции SELECT;
- запрос на чтение строк с помощью инструкции SELECT COUNT, за которой следует SELECT;
- добавление одной или нескольких строк (массовое) с помощью инструкции INSERT;
- изменение одной или нескольких строк (массовое) с помощью инструкции UPDATE;
- удаление одной или нескольких строк (массовое) с помощью инструкции DELETE;
- чтение для изменения строк с помощью инструкции SELECT CURSOR, за которой следует UPDATE WHERE CURRENT OF CURSOR;
- чтение для удаления строк с помощью инструкции SELECT CURSOR, за которой следует UPDATE WHERE CURRENT OF CURSOR;
- запуск процедуры с входными и выходными параметрами, возвращаемым значением и набором данных с помощью инструкции CALL;
- пользовательские команды и составные операции с помощью инструкций SELECT, INSERT, UPDATE, DELETE.

## Триггеры и действия
Соединитель поддерживает следующие триггеры и действия приложения логики:

триггеры; | Действия
--- | ---
<ul><li>Опрос данных</li></ul> | <ul><li>Bulk Insert (Массовая вставка)</li><li>Insert (Вставка)</li><li>Bulk Update (Массовое обновление)</li><li>Update (Обновление)</li><li>Call (Вызов)</li><li>Bulk Delete (Массовое удаление)</li><li>Delete (Удаление)</li><li>Select (Выбор)</li><li>Conditional update (Условное обновление)</li><li>Post to EntitySet (Публикация в набор сущностей)</li><li>Conditional delete (Условное удаление)</li><li>Select single entity (Выбор одной сущности)</li><li>Delete (Удаление)</li><li>Upsert to EntitySet (Добавление с модификацией к набору сущностей)</li><li>Custom commands (Пользовательские команды)</li><li>Composite operations (Составные операции)</li></ul>


## Создание соединителя DB2
Вы можете определить соединитель в приложении логики или в Azure Marketplace, как показано в следующем примере.

1. На начальной панели Azure выберите **Marketplace**.
2. В колонке **Все** наберите **db2** в поле **Поиск по всем** и нажмите клавишу «Ввод».
3. На панели результатов поиска выберите **Соединитель DB2**.
4. В колонке описания соединителя DB2 выберите **Создать**.
5. В колонке пакета соединителя DB2 введите имя (например, «Db2ConnectorNewOrders»), план службы приложений и другие свойства.
6. Выберите **Параметры пакета** и введите следующие параметры пакета:

	Имя | Обязательно | Описание
--- | --- | ---
ConnectionString | Да | Строка соединения клиента DB2 (например, «Network Address=servername;Network Port=50000;User ID=username;Password=password;Initial Catalog=SAMPLE;Package Collection=NWIND;Default Schema=NWIND»).
Таблицы | Да | Разделенный запятыми список таблиц, представлений и псевдонимов, необходимых для операций OData и для создания документации Swagger с примерами (например, *NEWORDERS*).
Процедуры | Да | Разделенный запятыми список имен процедур и функций (например, SPORDERID).
OnPremise | Нет | Локальное развертывание с использованием ретранслятора служебной шины Azure.
ServiceBusConnectionString | Нет | Строка подключения для ретранслятора служебной шины Azure.
PollToCheckData | Нет | Инструкция SELECT COUNT, которая будет использоваться с триггером приложения логики (например, SELECT COUNT(*) FROM NEWORDERS, WHERE SHIPDATE IS NULL).
PollToReadData | Нет | Инструкция SELECT, которая будет использоваться с триггером приложения логики (например, SELECT * FROM NEWORDERS WHERE SHIPDATE IS NULL FOR UPDATE).
PollToAlterData | Нет | Инструкция UPDATE или DELETE, которая будет использоваться с триггером приложения логики (например, UPDATE NEWORDERS SET SHIPDATE = CURRENT DATE WHERE CURRENT OF &lt;CURSOR&gt;).

7. Щелкните **ОК**, а затем выберите **Создать**.
8. После завершения параметры пакета будут выглядеть примерно так: ![][1]


## Приложение логики, которое выполняет действие соединителя DB2 для добавления данных ##
Вы можете определить действие приложения логики для добавления данных в таблицу DB2 с помощью операции API OData «Insert» или «Post to Entity». Например, можно вставить запись для нового заказа клиента, выполнив инструкцию SQL INSERT для таблицы, в которой определен столбец идентификатора, и вернуть в приложение логики значения идентификатора для затронутых строк (SELECT ORDID FROM FINAL TABLE (INSERT INTO NWIND.NEWORDERS (CUSTID,SHIPNAME,SHIPADDR,SHIPCITY,SHIPREG,SHIPZIP) VALUES (?,?,?,?,?,?))).

> [AZURE.TIP] Действие соединителя DB2 «*Post to EntitySet*» возвращает значение столбца идентификатора, а *API Insert* возвращает количество затронутых строк.

1. На начальной панели Azure выберите **+** (знак плюс), **Интернет+мобильные устройства**, а затем — **Приложение логики**.
2. Введите имя (например, NewOrdersDb2), план службы приложений, другие свойства, а затем выберите **Создать**.
3. На начальной панели Azure выберите приложение логики, которое вы только что создали, щелкните **Параметры**, а затем — **Триггеры и действия**.
4. В колонке "Триггеры и действия" выберите **Создание с нуля** для шаблонов приложения логики.
5. На панели приложения API выберите **Повторения**, задайте частоту и интервал, а затем установите **флажок**.
6. На панели приложений API выберите **Соединитель DB2**, разверните список операций и выберите действие **вставки в NEWORDER**.
7. В раскрывающемся списке параметров введите следующие значения:

	Имя | Значение
--- | --- 
CUSTID | 10042
SHIPNAME | Lazy K Kountry Store 
SHIPADDR | 12 Orchestra Terrace
SHIPCITY | Walla Walla 
SHIPREG | WA
SHIPZIP | 99362 

8. Щелкните **флажок**, чтобы сохранить параметры действия, а затем нажмите кнопку **Сохранить**.
9. Параметры должны выглядеть так: ![][3]

10. В списке **Все запуски** в разделе **Операции** выберите первый элемент списка (последнюю запущенную команду).
11. В колонке **Запуск приложения логики** выберите для параметра **ДЕЙСТВИЕ** элемент **db2connectorneworders**.
12. В колонке **Действие приложения логики** щелкните элемент **Ссылка на входные данные**. Соединитель DB2 использует входные данные для обработки инструкции INSERT с параметрами.
13. В колонке **Действие приложения логики** выберите **Ссылка на выходные данные**. Входные данные должны выглядеть так: ![][4]

#### Это важно знать

- Соединитель усекает имена таблиц DB2 при создании имен действий приложения логики. Например, для операции **Insert into NEWORDERS** имя будет усечено до **Insert into NEWORDER**.
- После сохранения **триггеров и действий** приложение логики обрабатывает операцию. Возможна задержка в несколько секунд (например, 3–5 секунд) до начала обработки операции. Кроме того, для выполнения операции вы можете нажать кнопку **Выполнить сейчас**.
- Соединитель DB2 определяет элементы EntitySet с некоторыми атрибутами, чтобы узнать, соответствует ли элемент столбцу таблицы DB2 со значениями по умолчанию или автоматически создаваемыми значениями (например, идентификатор). Приложение логики отображает звездочку красного цвета рядом с именами тех элементов EntitySet, которые обозначают столбцы DB2, для которых ввод значения является обязательным. Не вводите значение для элемента ORDID, который соответствует столбцу идентификатора в DB2. Для других необязательных элементов (ITEMS, ORDDATE, REQDATE, SHIPID, FREIGHT, SHIPCTRY) ввод значений допускается. Это те столбцы DB2, которые имеют значения по умолчанию.
- Соединитель DB2 возвращает приложению логики ответ на действие публикации в EntitySet, в котором указаны значения столбцов идентификаторов, полученные из DRDA SQLDARD (данные ответа области данных SQL) для подготовленной инструкции SQL INSERT. Сервер DB2 не возвращает вставленные значения для столбцов со значениями по умолчанию.


## Приложение логики, которое выполняет действие соединителя DB2 для массового добавления данных ##
Вы можете определить действие приложения логики для массового добавления данных в таблицу DB2 с помощью операции API «Bulk Insert». Например, можно вставить запись для двух новых заказов клиента, выполнив инструкцию SQL INSERT с массивом значений для таблицы, в которой определен столбец идентификатора, и вернуть в приложение логики затронутые строки (SELECT ORDID FROM FINAL TABLE (INSERT INTO NWIND.NEWORDERS (CUSTID,SHIPNAME,SHIPADDR,SHIPCITY,SHIPREG,SHIPZIP) VALUES (?,?,?,?,?,?))).

1. На начальной панели Azure выберите **+** (знак плюс), **Интернет+мобильные устройства**, а затем — **Приложение логики**.
2. Введите имя (например, «NewOrdersBulkDb2»), план службы приложений, другие свойства, а затем выберите **Создать**.
3. На начальной панели Azure выберите приложение логики, которое вы только что создали, щелкните **Параметры**, а затем — **Триггеры и действия**.
4. В колонке "Триггеры и действия" выберите **Создание с нуля** для шаблонов приложения логики.
5. На панели приложения API выберите **Повторения**, задайте частоту и интервал, а затем установите **флажок**.
6. На панели приложения API выберите **Соединитель DB2**, разверните список операций и выберите действие **массовой вставки в NEW**.
7. Введите значения **строк** в формате массива. Например, скопируйте и вставьте такой код:

	```
    [{"CUSTID":10081,"SHIPNAME":"Trail's Head Gourmet Provisioners","SHIPADDR":"722 DaVinci Blvd.","SHIPCITY":"Kirkland","SHIPREG":"WA","SHIPZIP":"98034"},{"CUSTID":10088,"SHIPNAME":"White Clover Markets","SHIPADDR":"305 14th Ave. S. Suite 3B","SHIPCITY":"Seattle","SHIPREG":"WA","SHIPZIP":"98128","SHIPCTRY":"USA"}]
	```

8. Щелкните **флажок**, чтобы сохранить параметры действия, а затем нажмите кнопку **Сохранить**. Параметры должны выглядеть так: ![][6]

9. В списке **Все запуски** в разделе **Операции** выберите первый элемент списка (последнюю запущенную команду).
10. В колонке **Запуск приложения логики** щелкните элемент **Действие**.
11. В колонке **Действие приложения логики** щелкните элемент **Ссылка на входные данные**. Выходные данные должны выглядеть так: [][7]
12. В колонке **Действие приложения логики** щелкните элемент **Ссылка на выходные данные**. Выходные данные должны выглядеть так: ![][8]

#### Это важно знать

- Соединитель усекает имена таблиц DB2 при создании имен действий приложения логики. Например, для операции **Bulk Insert into NEWORDERS** имя будет усечено до **Bulk Insert into NEW**.
- Если опустить столбцы идентификаторов (например, ORDID), столбцы с допустимым значением NULL (например, SHIPDATE) и столбцы со значениями по умолчанию (например, ORDDATE, REQDATE, SHIPID, ТРАНСПОРТИРОВКИ, SHIPCTRY), база данных DB2 создаст для них значения автоматически.
- Если указать today и tomorrow, соединитель DB2 использует функции CURRENT DATE и CURRENT DATE+1 DAY (например, для REQDATE).


## Приложение логики с триггером соединителя DB2 для чтения, изменения или удаления данных ##
Вы можете определить триггер приложения логики для опроса и чтения данных из таблицы DB2 с помощью составной операции API «Poll Data». Например, можно прочитать одну или несколько записей для новых заказов клиентов и вернуть эти записи в приложение логики. Параметры пакета и приложения соединителя DB2 должны выглядеть так:

	App Setting | Value
--- | --- | ---
PollToCheckData | SELECT COUNT(*) FROM NEWORDERS, WHERE SHIPDATE IS NULL
PollToReadData | SELECT * FROM NEWORDERS WHERE SHIPDATE IS NULL FOR UPDATE
PollToAlterData | <значение не указано>


Также вы можете определить триггер приложения логики для опроса, чтения и изменения данных в таблице DB2 с помощью составной операции API «Poll Data». Например, можно прочитать одну или несколько записей для новых заказов клиентов, изменить значения записей и вернуть эти записи (со значениями до обновления) в приложение логики. Параметры пакета и приложения соединителя DB2 должны выглядеть так:

	App Setting | Value
--- | --- | ---
PollToCheckData | SELECT COUNT(*) FROM NEWORDERS, WHERE SHIPDATE IS NULL
PollToReadData | SELECT * FROM NEWORDERS WHERE SHIPDATE IS NULL FOR UPDATE
PollToAlterData | UPDATE NEWORDERS SET SHIPDATE = CURRENT DATE WHERE CURRENT OF &lt;CURSOR&gt;


Также вы можете определить триггер приложения логики для опроса, чтения и удаления данных из таблицы DB2 с помощью составной операции API «Poll Data». Например, можно прочитать одну или несколько записей для новых заказов клиентов, удалить эти записи и вернуть эти записи (со значениями до удаления) в приложение логики. Параметры пакета и приложения соединителя DB2 должны выглядеть так:

	App Setting | Value
--- | --- | ---
PollToCheckData | SELECT COUNT(*) FROM NEWORDERS, WHERE SHIPDATE IS NULL
PollToReadData | SELECT * FROM NEWORDERS WHERE SHIPDATE IS NULL FOR UPDATE
PollToAlterData | DELETE NEWORDERS WHERE CURRENT OF &lt;CURSOR&gt;

В этом примере приложение логики выполнит опрос, чтение, обновление и повторное чтение данных в таблице DB2.

1. На начальной панели Azure выберите **+** (знак плюс), **Интернет+мобильные устройства**, а затем — **Приложение логики**.
2. Введите имя (например, «ShipOrdersDb2»), план службы приложений, другие свойства, а затем выберите **Создать**.
3. На начальной панели Azure выберите приложение логики, которое вы только что создали, щелкните **Параметры**, а затем — **Триггеры и действия**.
4. В колонке "Триггеры и действия" выберите **Создание с нуля** для шаблонов приложения логики.
5. На панели приложения API выберите **Соединитель DB2**, задайте частоту и интервал, а затем установите **флажок**.
6. На панели приложения API выберите **Соединитель DB2**, разверните список операций и выберите действие **выбора из NEWORDERS**.
7. Щелкните **флажок**, чтобы сохранить параметры действия, а затем нажмите кнопку **Сохранить**. Параметры должны выглядеть так: ![][10]
8. Щелкните кнопку закрытия колонки **Триггеры и действия**, а затем закройте колонку **Параметры**.
9. В списке **Все запуски** в разделе **Операции** выберите первый элемент списка (последнюю запущенную команду).
10. В колонке **Запуск приложения логики** щелкните элемент **Действие**.
11. В колонке **Действие приложения логики** щелкните элемент **Ссылка на выходные данные**. Выходные данные должны выглядеть так: ![][11]


## Приложение логики, которое выполняет действие соединителя DB2 для удаления данных ##
Вы можете определить действие приложения логики для удаления данных из таблицы DB2 с помощью операции API OData «Delete» или «Post to Entity». Например, можно вставить запись для нового заказа клиента, выполнив инструкцию SQL INSERT для таблицы, в которой определен столбец идентификатора, и вернуть в приложение логики значения идентификатора для затронутых строк (SELECT ORDID FROM FINAL TABLE (INSERT INTO NWIND.NEWORDERS (CUSTID,SHIPNAME,SHIPADDR,SHIPCITY,SHIPREG,SHIPZIP) VALUES (?,?,?,?,?,?))).

## Создание приложения логики, которое использует соединитель DB2 для удаления данных ##
Вы можете создать новое приложение логики из Azure Marketplace, а затем использовать соединитель DB2 как действие для удаления заказов клиентов. Например, можно использовать условную операцию соединителя DB2 для обработки инструкции SQL DELETE (DELETE FROM NEWORDERS WHERE ORDID >= 10000).

1. В меню концентратора на **начальной панели** Azure нажмите кнопку **+** (знак плюс), а потом щелкните **Интернет+мобильные устройства** и **Приложение логики**.
2. В колонке **Создание приложения логики** введите **имя**, например **RemoveOrdersDb2**.
3. Выберите или определите значения других параметров (например, план обслуживания, группа ресурсов).
4. Параметры будут выглядеть следующим образом. Щелкните **Создать**. ![][12]
5. В колонке **Параметры** щелкните **Триггеры и действия**.
6. В списке **Шаблоны приложений логики** в колонке **Триггеры и действия** щелкните **Создание с нуля**.
7. В колонке **Триггеры и действия** на панели **Приложения API** в группе ресурсов щелкните **Повторения**.
8. В области конструктора приложения логики щелкните элемент **Повторения**, задайте **частоту** и **интервал**, например **Дни** и **1**, и щелкните **флажок**, чтобы сохранить параметры повторения.
9. В колонке **Триггеры и действия** на панели **Приложения API** в группе ресурсов щелкните **Соединитель DB2**.
10. В области конструктора приложения логики щелкните элемент действия **Соединитель DB2**, затем щелкните многоточие (**…**), чтобы развернуть список операций и выберите действие **условного удаления из N**.
11. Для элемента действия соединителя DB2 введите **ORDID ge 10000** в качестве **выражения, которое определяет подмножество записей**.
12. Щелкните **флажок**, чтобы сохранить параметры действия, а затем нажмите кнопку **Сохранить**. Параметры должны выглядеть так: ![][13]
13. Щелкните кнопку закрытия колонки **Триггеры и действия**, а затем закройте колонку **Параметры**.
14. В списке **Все запуски** в разделе **Операции** выберите первый элемент списка (последнюю запущенную команду).
15. В колонке **Запуск приложения логики** щелкните элемент **Действие**.
16. В колонке **Действие приложения логики** щелкните элемент **Ссылка на выходные данные**. Выходные данные должны выглядеть так: ![][14]

**Примечание.** Конструктор приложения логики усекает имена таблиц. Например, для операции **Условное удаление из NEWORDERS** имя будет усечено до **Условное удаление из N**.


> [AZURE.TIP] Используйте следующие инструкции SQL для создания примера таблицы и хранимых процедур.

С помощью следующих инструкций DB2 SQL DDL можно создать тестовую таблицу NEWORDERS.
 
 	CREATE TABLE ORDERS (  
 		ORDID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 10000, INCREMENT BY 1) ,  
 		CUSTID INT NOT NULL ,  
 		EMPID INT NOT NULL DEFAULT 10000 ,  
 		ORDDATE DATE NOT NULL DEFAULT CURRENT DATE ,  
 		REQDATE DATE DEFAULT CURRENT DATE ,  
 		SHIPDATE DATE ,  
 		SHIPID INT NOT NULL DEFAULT 10000,  
 		FREIGHT DECIMAL (9,2) NOT NULL DEFAULT 0.00 ,  
 		SHIPNAME CHAR (40) NOT NULL ,  
 		SHIPADDR CHAR (60) NOT NULL ,  
 		SHIPCITY CHAR (20) NOT NULL ,  
 		SHIPREG CHAR (15) NOT NULL ,  
 		SHIPZIP CHAR (10) NOT NULL ,  
 		SHIPCTRY CHAR (15) NOT NULL DEFAULT 'USA' ,  
 		PRIMARY KEY(ORDID)  
 		)  
 
 	CREATE UNIQUE INDEX XORDID ON ORDERS (ORDID ASC)  



С помощью следующих инструкций DB2 DDL можно создать хранимую процедуру SPOERID.
 
 	CREATE OR REPLACE PROCEDURE NWIND.SPORDERID (IN ORDERID VARCHAR(128))  
 		DYNAMIC RESULT SETS 1  
 	P1: BEGIN  
 		DECLARE CURSOR1 CURSOR WITH RETURN FOR  
 			SELECT * FROM NWIND.NEWORDERS  
 				WHERE ORDID = ORDERID;  
 		OPEN CURSOR1;  
 	END P1  
 	') 


## Гибридная конфигурация (необязательно)

> [AZURE.NOTE] Этот шаг необходим, только если соединитель DB2 используется локально за брандмауэром.

Служба приложений использует диспетчер гибридных соединений для безопасного подключения к вашей локальной системе. Если ваш соединитель использует локальный сервер IBM DB2 Server для Windows, применение диспетчера гибридных подключений обязательно.

См. раздел [Установка диспетчера гибридных соединений](app-service-logic-hybrid-connection-manager.md).


## Дополнительные возможности соединителя
После создания соединителя его можно добавить в рабочий бизнес-процесс с помощью приложения логики. См. статью [Что такое приложения логики?](app-service-logic-what-are-logic-apps.md)

Создание приложений API с помощью интерфейсов REST API. См. статью [Справочник по соединителям и приложениям API](http://go.microsoft.com/fwlink/p/?LinkId=529766).

Можно также просматривать статистику производительности и управлять безопасностью соединителя. См. статью [Управление встроенными приложениями API и соединителями, а также их мониторинг](app-service-logic-monitor-your-connectors.md).


<!--Image references-->
[1]: ./media/app-service-logic-connector-db2/ApiApp_Db2Connector_Create.png
[2]: ./media/app-service-logic-connector-db2/LogicApp_NewOrdersDb2_Create.png
[3]: ./media/app-service-logic-connector-db2/LogicApp_NewOrdersDb2_TriggersActions.png
[4]: ./media/app-service-logic-connector-db2/LogicApp_NewOrdersDb2_Outputs.png
[5]: ./media/app-service-logic-connector-db2/LogicApp_NewOrdersBulkDb2_Create.png
[6]: ./media/app-service-logic-connector-db2/LogicApp_NewOrdersBulkDb2_TriggersActions.png
[7]: ./media/app-service-logic-connector-db2/LogicApp_NewOrdersBulkDb2_Inputs.png
[8]: ./media/app-service-logic-connector-db2/LogicApp_NewOrdersBulkDb2_Outputs.png
[9]: ./media/app-service-logic-connector-db2/LogicApp_UpdateOrdersDb2_Create.png
[10]: ./media/app-service-logic-connector-db2/LogicApp_UpdateOrdersDb2_TriggersActions.png
[11]: ./media/app-service-logic-connector-db2/LogicApp_UpdateOrdersDb2_Outputs.png
[12]: ./media/app-service-logic-connector-db2/LogicApp_RemoveOrdersDb2_Create.png
[13]: ./media/app-service-logic-connector-db2/LogicApp_RemoveOrdersDb2_TriggersActions.png
[14]: ./media/app-service-logic-connector-db2/LogicApp_RemoveOrdersDb2_Outputs.png

<!---HONumber=AcomDC_0803_2016-->