<properties 
   pageTitle="Соединитель SQL" 
   description="Использование соединителя SQL" 
   services="app-service\logic" 
   documentationCenter=".net,nodejs,java" 
   authors="anuragdalmia" 
   manager="dwrede" 
   editor=""/>

<tags
   ms.service="app-service-logic"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="integration" 
   ms.date="03/20/2015"
   ms.author="sutalasi"/>


# Соединитель Microsoft SQL #

Соединители можно использовать в приложениях логики для извлечения, обработки или отправки данных в рамках потока. Существуют сценарии, в которых необходимо работать с базой данных SQL в Azure SQL или на сервере SQL Server, установленной локально под защитой брандмауэра. Используя соединитель SQL в потоке, можно реализовать множество сценариев. Вот несколько примеров.  

1.	Предоставление раздела данных, размещенных в базе данных SQL, через Интернет или внешний интерфейс мобильного пользователя.
2.	Вставка данных в таблицу базы данных SQL для хранения (например, записи сотрудников, заказы на продажу и т. д.)
3.	Извлечение данных из SQL для использования в бизнес-процессе.

Для реализации этих сценариев необходимо выполнить следующее. 

1. Создание экземпляра приложения API соединителя SQL
2. Установите гибридное подключение для приложения API в целях обмена данными с локальным сервером SQL. Этот шаг является необязательным и требуется только для локального сервера SQL Server, а не для SQL Azure.
3. Использование созданного приложения API в приложении логики для реализации нужного бизнес-процесса

	###Основные триггеры и действия
		
    - Данные опроса (триггер) 
    - Вставить в таблицу
    - Обновить таблицу
    - Выбрать из таблицы
    - Удалить из таблицы
    - Вызов хранимой процедуры

## Создание экземпляра приложения API соединителя SQL ##

Чтобы использовать соединитель SQL, необходимо создать экземпляр приложения API соединителя SQL. Это можно сделать следующим образом.

1. Откройте Azure Marketplace, нажав кнопку "+ СОЗДАТЬ" в нижнем левом углу портала Azure.
2. Перейдите в раздел "Мобильные и веб-приложения > Приложения API" и найдите элемент "Соединитель SQL".
3. Предоставьте общие сведения, такие как имя, план обслуживания приложения и т. д., в первой колонке.
4. Укажите параметры пакета, представленные в следующей таблице.	

<style type="text/css">
	table.tableizer-table {
	border: 1px solid #CCC; font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
} 
.tableizer-table td {
	padding: 4px;
	margin: 3px;
	border: 1px solid #ccc;
}
.tableizer-table th {
	background-color: #525B64; 
	color: #FFF;
	font-weight: bold;
}
</style><table class="tableizer-table">
<tr class="tableizer-firstrow"><th>Имя</th><th>Обязательно</th><th>Значение по умолчанию</th><th>Описание</th></tr>
 <tr><td>Имя сервера</td><td>Да</td><td>&nbsp;</td><td>Укажите имя сервера SQL Server. Пример: SQLserver, SQLserver/sqlexpress или SQLserver.mydomain.com.</td></tr>
 <tr><td>Порт</td><td>Нет</td><td> 1433</td><td>Необязательный параметр. Номер порта, с которого устанавливается соединение. Если значение не указано, соединитель подключается через порт по умолчанию.</td></tr>
 <tr><td>Имя пользователя</td><td>Да</td><td>&nbsp;</td><td>Укажите допустимое имя пользователя для подключения к серверу SQL Server.</td></tr>
 <tr><td>Пароль</td><td>Да</td><td>&nbsp;</td><td>Укажите допустимый пароль для подключения к серверу SQL Server.</td></tr>
 <tr><td>Имя базы данных</td><td>Да</td><td>&nbsp;</td><td>Укажите допустимое имя базы данных для подключения к серверу SQL Server. Пример: orders, dbo/orders или myaccount/employees.</td></tr>
 <tr><td>Локальный</td><td>Да</td><td>False</td><td>Укажите, является ли сервер SQL Server локальным сервером под защитой брандмауэра. Если задано значение TRUE, необходимо установить агент прослушивателя на сервере, который может обращаться к серверу SQL Server. Можно перейти на страницу сводных данных по приложению API и выбрать команду '"Гибридное подключение' для установки агента.</td></tr>
 <tr><td>Строка подключения к служебной шине</td><td>Нет</td><td>&nbsp;</td><td>Необязательный параметр. Задайте этот параметр, если сервер SQL Server является локальным. Это должна быть допустимая строка подключения к пространству имен служебной шины. Убедитесь в том, что используется  'Стандартный' выпуск служебной шины Azure, а не  'Базовый'.</td></tr>
 <tr><td>Имя сервера-партнера</td><td>Нет</td><td>&nbsp;</td><td>Необязательный параметр. Укажите сервер-партнер для подключения, когда сервер-источник недоступен.</td></tr>
 <tr><td>Таблицы</td><td>Нет</td><td>&nbsp;</td><td>Необязательный параметр. Укажите таблицы базы данных, которые можно изменить с помощью соединителя. Например: OrdersTable, EmployeeTable</td></tr>
 <tr><td>Хранимые процедуры</td><td>Нет</td><td>&nbsp;</td><td>Необязательный параметр. Укажите хранимые процедуры в базе данных, которые могут вызываться с помощью соединителя. Например: IsEmployeeEligible, CalculateOrderDiscount</td></tr>
 <tr><td>Запрос доступных данных</td><td>Нет</td><td>&nbsp;</td><td>Необязательный параметр. Укажите инструкцию для определения доступности данных для опроса таблицы базы данных сервера SQL Server. Пример: SELECT COUNT(*) from table_name.</td></tr>
 <tr><td>Запрос данных опроса</td><td>Нет</td><td>&nbsp;</td><td>Необязательный параметр. Укажите инструкцию SQL для опроса таблицы базы данных сервера SQL Server. Можно указать любое количество инструкций SQL, разделенных точкой с запятой. Пример: SELECT * from table_name; DELETE from table_name. ПРИМЕЧАНИЕ. Необходимо предоставить такую инструкцию опроса, которая не создаст бесконечного цикла. Например, за выбором должно следовать удаление, а за выбором на основе флага - обновление на основе флага.</td></tr>
</table>


 ![][1]  

## Гибридная конфигурация (дополнительно) ##

Примечание. Этот шаг необходим только в том случае, если сервер SQL Server используется локально под защитой брандмауэра.

Перейдите в только что созданное приложение API, последовательно выбрав "Обзор" -> "Приложения API" -> <Имя созданного приложения API>, и вы увидите следующее поведение. Настройка не завершена, поскольку гибридное подключение еще не установлено.

![][2] 

Чтобы установить гибридное подключение, выполните следующие действия.

1. Скопируйте основную строку подключения.
2. Щелкните ссылку  'Загрузить и настроить'.
3. Выполните инициированный процесс установки и при запросе предоставьте основную строку подключения.
4. После завершения процесса установки появится диалоговое окно, подобное приведенному ниже.

![][3] 

Теперь, если вы снова перейдете в созданное приложение API, то увидите, что гибридное подключение имеет состояние "Подключено". 

![][4] 

Примечание. Если вы хотите переключиться на дополнительную строку подключения, просто повторите установку гибридного подключения и вместо основной строки подключения предоставьте дополнительную.  

## Использование в приложении логики ##

Соединитель SQL может использоваться как триггер или действие в приложении логики. Триггер и все действия поддерживают формат данных JSON и XML. Для каждой таблицы, которая предоставляется в рамках параметров пакета, имеется набор действий JSON и XML. При использовании триггера/действия XML можно использовать приложение API преобразования для преобразования данных в другой формат XML-данных. 

Возьмем простое приложение логики, которое запрашивает данные из таблицы SQL, добавляет данные в другую таблицу и обновляет данные.



-  После создания и редактирования приложения логики выберите приложение API соединителя SQL, созданного в качестве триггера. Будет выведен список доступных триггеров - данные опроса (JSON) и данные опроса (XML).

 ![][5] 


- Выберите триггер - данные опроса (JSON), укажите частоту и нажмите кнопку ✓.

![][6] 



- Триггер будет показан в приложении логики как настроенный. Будут отображены результаты триггера, которые можно использовать в качестве входных данных в следующих действиях. 

![][7] 


- Выберите тот же соединитель SQL из коллекции в качестве действия. Выберите одно из действий вставки - "Вставить в TempEmployeeDetails (JSON)".

![][8] 



- Предоставьте входные данные записи для вставки и нажмите кнопку ✓. 

![][9] 



- Выберите тот же соединитель SQL из коллекции в качестве действия. Выберите действие обновления для той же таблицы (например, Update EmployeeDetails)

![][11] 



- Предоставьте входные данные для действия обновления и нажмите кнопку ✓. 

![][12] 

Можно проверить логику приложения, добавив новую запись в опрашиваемой таблице.

<!--Image references-->
[1]: ./media/app-service-logic-connector-sql/Create.jpg
[2]: ./media/app-service-logic-connector-sql/BrowseSetupIncomplete.jpg
[3]: ./media/app-service-logic-connector-sql/HybridSetup.jpg
[4]: ./media/app-service-logic-connector-sql/BrowseSetupComplete.jpg
[5]: ./media/app-service-logic-connector-sql/LogicApp1.jpg
[6]: ./media/app-service-logic-connector-sql/LogicApp2.jpg
[7]: ./media/app-service-logic-connector-sql/LogicApp3.jpg
[8]: ./media/app-service-logic-connector-sql/LogicApp4.jpg
[9]: ./media/app-service-logic-connector-sql/LogicApp5.jpg
[10]: ./media/app-service-logic-connector-sql/LogicApp6.jpg
[11]: ./media/app-service-logic-connector-sql/LogicApp7.jpg
[12]: ./media/app-service-logic-connector-sql/LogicApp8.jpg




<!--HONumber=52--> 