<properties 
   pageTitle="Создание приложения логики EAI с помощью VETR" 
   description="В этой статье описываются функции проверки, кодирования и преобразования XML-служб BizTalk." 
   services="app-service\logic" 
   documentationCenter=".net,nodejs,java" 
   authors="rajeshramabathiran" 
   manager="dwrede" 
   editor=""/>

<tags
   ms.service="app-service-logic"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="integration" 
   ms.date="06/24/2015"
   ms.author="rajram"/>


# Создание приложения логики EAI с помощью VETR

Большинство сценариев интеграции приложений (EAI) преобразовывают данные между источником и назначением. Такие сценарии часто имеют общий набор требований.

- Проверка правильность формата данных из разных систем.
- Выполнение «просмотра» входящих данных для принятия решений.
- Преобразование данных из одного формата в другой (например, из формата данных системы CRM в формат данных системы ERP).
- Маршрутизация данных в нужное приложение или систему.

В этой статье мы рассмотрим стандартный шаблон интеграции: «одностороннее преобразование сообщений» или VETR — Validate (проверка), Enrich (обогащение), Transform (преобразование), Route (маршрутизация).) Шаблон VETR преобразует данные между исходной сущностью и целевой сущностью. Обычно источник и назначение представляют собой источники данных.

Рассмотрим веб-сайт, который принимает заказы. Пользователи размещают заказы в системе с помощью HTTP. За кулисами система проверяет правильность входных данных, нормализует их и сохраняет их в очереди служебной шины для дальнейшей обработки. Система принимает заказы из очереди, ожидая их в определенном формате. Таким образом, сквозной поток следующий:

HTTP -> Проверка -> Преобразование -> Служебная шина

![Основной поток VETR][1]

Этот шаблон помогают построить следующие приложения API BizTalk:

*Триггер HTTP* — источник активации события сообщения *Проверка* — проверяет правильность входящих данных *Преобразование* — преобразует данные из входящего формата в формат, требуемый подчиненной системой *Соединитель служебной шины* — целевая сущность, куда отправляются данные


## Построение базового шаблона VETR
### Основы

На портале управления Azure нажмите кнопку **+Создать** в нижнем левом углу экрана и выберите приложение логики. Выберите имя, расположение, подписку, группу ресурсов и рабочее расположение. Группы ресурсов действуют как контейнеры для приложений, и все ресурсы для приложения должны быть в одной группе ресурсов.

Теперь давайте добавим триггеры и действия.


## Добавление триггера HTTP

1. Выберите в коллекции элемент **Прослушиватель HTTP**, чтобы создать новый прослушиватель. Назовите его **HTTP1**.
2. Оставьте в параметре **Отправлять ответ автоматически?** значение false. Настройте действие триггера, задав в параметре _Метод HTTP_ значение _POST_, а в параметре _Относительный URL-адрес_ — значение _/OneWayPipeline_.

![Триггер HTTP][2]


## Добавление действия проверки

Теперь давайте зададим действия, которые будут выполняться при каждом срабатывании триггера, то есть всякий раз, когда в конечной точке HTTP принимается вызов.

1. Добавьте элемент **Средство проверки XML BizTalk** из коллекции и дайте ему имя _(Validate1)_, чтобы создать экземпляр.
2. Настройте схему XSD для проверки входящих сообщений XML. Выберите действие _Проверить_ и выберите __triggers(‘httplistener’).outputs.Content_ в качестве значения параметра _inputXml_.

Теперь действие проверки является первым действием после прослушивателя HTTP. Аналогично добавим остальные действия.

![Средство проверки XML BizTalk][3]


## Добавление действия преобразования
Давайте настроим преобразования для нормализации входящих данных.

1. Добавьте действие **Преобразовать** из коллекции. 
2. Чтобы настроить преобразование для преобразования входящих сообщений XML, выберите действие **Преобразовать** в качестве выполняемого действия при вызове этого API и выберите ```triggers(‘httplistener’).outputs.Content``` в качестве значения для _inputXml_. Сопоставление — это необязательный параметр, поскольку входящие данные соответствуют всем настроенным преобразованиям и применяются только те, которые соответствуют схеме.
3. Наконец, преобразование выполняется только в том случае, если проверка завершается успешно. Чтобы настроить это условие, нажмите значок шестеренки в правом верхнем углу и выберите _Добавить условие для выполнения_. В качестве условия задайте ```equals(actions('xmlvalidator').status,'Succeeded')```.


![Преобразования BizTalk][4]


## Добавление соединителя служебной шины
Давайте добавим назначение — очередь служебной шины — для записи в нее данных.

1. Добавьте элемент **Соединитель служебной шины** из коллекции. Задайте для свойства _Имя_ значение _Servicebus1_, в свойстве _Строка подключения_ укажите строку подключения к экземпляру служебной шины, в свойстве _Имя сущности_ задайте _Queue_ и пропустите свойство _Имя подписки_. 
2. Выберите действие **Отправить сообщение** и установите в поле _Сообщение_ для действия значение _actions('transformservice').outputs.OutputXml_.

![Service Bus][5]


## Отправка HTTP-ответа
После завершения конвейерной обработки мы отправляем обратно HTTP-ответ как для успешной, так и для неудачной обработки с помощью следующих действий.

1. Добавьте элемент **Прослушиватель HTTP** из коллекции и выберите действие **Отправить HTTP-ответ**.
2. В поле _Содержимое ответа_ задайте значение «Конвейерная обработка завершена»; в поле _Код состояния ответа_ задайте значение «200», чтобы указать код HTTP 200 ОК, и в качестве условия задайте выражение ```@equals(actions('servicebusconnector').status,'Succeeded')```.
	
Повторите эти действия для отправки HTTP-сообщения при сбое. Измените условие на ```@not(equals(actions('servicebusconnector').status,'Succeeded')).```.


## Выполнение
Каждый раз, когда кто-либо отправляет сообщение в конечную точку HTTP, он активирует приложение и выполняет действия, которые мы только что создали. Чтобы управлять любыми такими созданными приложениями логики, нажмите кнопку **Обзор** на портале управления Azure и выберите **Приложения логики**. Щелкните свое приложение, чтобы просмотреть дополнительные сведения.


<!--image references -->
[1]: ./media/app-service-logic-create-EAI-logic-app-using-VETR/BasicVETR.PNG
[2]: ./media/app-service-logic-create-EAI-logic-app-using-VETR/HTTPListener.PNG
[3]: ./media/app-service-logic-create-EAI-logic-app-using-VETR/BizTalkXMLValidator.PNG
[4]: ./media/app-service-logic-create-EAI-logic-app-using-VETR/BizTalkTransforms.PNG
[5]: ./media/app-service-logic-create-EAI-logic-app-using-VETR/AzureServiceBus.PNG

 

<!---HONumber=July15_HO3-->