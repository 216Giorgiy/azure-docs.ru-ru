<properties
   pageTitle="Создание шаблонов развертывания приложений логики | Microsoft Azure"
   description="Узнайте о создании шаблонов развертывания приложений логики, а также об их использовании для управления выпусками."
   services="app-service\logic"
   documentationCenter=".net,nodejs,java"
   authors="jeffhollan"
   manager="erikre"
   editor=""/>

<tags
   ms.service="app-service-logic"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="integration"
   ms.date="05/25/2016"
   ms.author="jehollan"/>
   
# Создание шаблонов развертывания приложений логики

После создания приложение логики можно настроить в качестве шаблона ресурсов Azure, что позволит с легкостью развернуть это приложение в любой нужной среде или группе ресурсов. Общие сведения о шаблонах Resource Manager см. в статьях [Создание шаблонов диспетчера ресурсов Azure](../resource-group-authoring-templates.md) и [Развертывание ресурсов с использованием шаблонов Azure Resource Manager](../resource-group-template-deploy.md).

## Обзор шаблона развертывания приложения логики

Приложение логики состоит из 3 основных компонентов.

* **ресурс приложения логики** — это ресурс, который содержит такие сведения, как тарифный план, расположение и определение рабочего процесса.
* **определение рабочего процесса** — это то, что отображается при выборе **представления кода**, а именно определение действий процесса и принцип работы механизма. Это свойство `definition` ресурсов приложения логики.
* **Подключения** — это отдельные ресурсы для безопасного хранения метаданных, связанных со всеми подключениями соединителя, таких как строки подключения и маркеры доступа. Они указываются в свойстве `parameters` ресурсов приложения логики.

Вы можете просмотреть все эти компоненты имеющихся приложений логики с помощью таких инструментов, как [обозреватель ресурсов Azure](http://resources.azure.com).

Чтобы создать шаблон для приложения логики, которое можно использовать для развертываний группы ресурсов, необходимо определить ресурсы и при необходимости параметризовать их. Например, если развертывание осуществляется в тестовой, рабочей среде или в среде разработки, скорее всего, в каждой из этих сред потребуется использовать различные строки подключения к базе данных SQL или выполнить развертывания в разных подписках или группах ресурсов.

## Создание шаблона развертывания приложения логики

Шаблон развертывания приложения логики можно создать с помощью нескольких инструментов. Его можно создать вручную, используя указанные выше ресурсы и настроив требуемые параметры. Можно также использовать модуль PowerShell для [создания шаблона приложения логики](https://github.com/jeffhollan/LogicAppTemplateCreator). Модуль с открытым исходным кодом оценивает приложение логики и все подключения, используемые в этом приложении, а также создает ресурсы шаблона с необходимыми параметрами для развертывания. Например, если приложение логики получило сообщение из очереди служебной шины и добавило данные в базу данных SQL Azure, инструмент сохранит всю логику оркестрации и параметризует строки подключения SQL и служебной шины, чтобы их можно было настроить во время развертывания.

>[AZURE.NOTE] Подключения должны относиться к той же группе ресурсов, что и приложение логики.

### Установка модуля PowerShell для шаблона приложения логики

Проще всего установить модуль через [коллекцию PowerShell](https://www.powershellgallery.com/packages/LogicAppTemplate/0.1) с использованием команды `Install-Module -Name LogicAppTemplate`.

Его также можно установить вручную.

1. Скачайте последний выпуск [модуль для создания шаблона приложения логики](https://github.com/jeffhollan/LogicAppTemplateCreator/releases).  
1. Извлеките содержимое папки в папку модуля PowerShell (обычно это `%UserProfile%\Documents\WindowsPowerShell\Modules`).

Чтобы модуль поддерживал любой маркер доступа клиента или подписки, рекомендуется использовать программу командной строки [armclient](https://github.com/projectkudu/ARMClient). См. сведения о `armclient` [здесь](http://blog.davidebbo.com/2015/01/azure-resource-manager-client.html).

### Создание шаблона приложения логики с помощью PowerShell

После установки можно приступить к созданию шаблона, выполнив следующую команду:

`armclient token $SubscriptionId | Get-LogicAppTemplate -LogicApp MyApp -ResourceGroup MyRG -SubscriptionId $SubscriptionId -Verbose | Out-File C:\template.json`

`$SubscriptionId` — это идентификатор подписки Azure. Сначала эта строка получает маркер доступа с помощью `armclient`, передает его в сценарий PowerShell, а затем выводит шаблон в файл `.json`.

## Добавление параметров для шаблона приложения логики

После создания шаблона приложения логики можно по требованию добавлять или изменять любые дополнительные параметры. Например, если определение включает идентификатор ресурса в функции Azure или вложенном рабочем процессе, где планируется одно развертывание, нужно добавить дополнительные ресурсы для шаблона и при необходимости параметризовать идентификаторы. То же касается и ссылок на пользовательские интерфейсы API или конечные точки Swagger, которые будут развернуты в каждой группе ресурсов.

## Развертывание шаблона приложения логики

После создания шаблон можно развернуть, используя любое количество инструментов, включая PowerShell, REST API, Visual Studio, Release Management или портал Azure. Дополнительные сведения о развертывании см. [здесь](../resource-group-template-deploy.md). Рекомендуется также создать [файл параметров](../resource-group-template-deploy.md#parameter-file) для хранения их значений.

### Авторизация подключений OAuth

После развертывания приложение логики будет полноценно работать с допустимыми параметрами, но чтобы создать допустимый маркер доступа, необходимо авторизовать подключения OAuth. Это можно сделать, открыв приложение логики в конструкторе и авторизовав подключения. Чтобы автоматизировать эту процедуру, можно использовать сценарий, предоставляющий разрешение на каждое подключение OAuth. Пример сценария можно найти на сайте GitHub в проекте [Connection Auth](https://github.com/logicappsio/LogicAppConnectionAuth).

## Управление выпусками Visual Studio

При развертывании среды и управлении ею часто используется управление выпусками Visual Studio и шаблон развертывания приложения логики. Служба VSTS включает задачу [развертывания группы ресурсов Azure](https://github.com/Microsoft/vsts-tasks/tree/master/Tasks/DeployAzureResourceGroup), которую можно добавить в любую сборку или конвейер выпуска. Для авторизации развертывания требуется [субъект-служба](https://blogs.msdn.microsoft.com/visualstudioalm/2015/10/04/automating-azure-resource-group-deployment-using-a-service-principal-in-visual-studio-online-buildrelease-management/). При ее наличии можно создать определение выпуска.

1. В разделе **Выпуск** настройте для **нового определения** использование **пустого** определения.

    ![][1]

1. Выберите любые необходимые артефакты. Скорее всего, это будет шаблон приложения логики, созданный вручную или как часть процесса сборки.
1. Добавьте задачу **развертывания группы ресурсов Azure**.
1. Настройте использование [субъекта-службы](https://blogs.msdn.microsoft.com/visualstudioalm/2015/10/04/automating-azure-resource-group-deployment-using-a-service-principal-in-visual-studio-online-buildrelease-management/) и добавьте ссылку на файлы **шаблона** или **параметров шаблона**.
1. При необходимости выполните соответствующие действия в процессе выпуска для других сред, автоматических тестов или механизмов утверждения.
    
<!-- Image References -->
[1]: ./media/app-service-logic-create-deploy-template/emptyReleaseDefinition.PNG

<!---HONumber=AcomDC_0601_2016-->