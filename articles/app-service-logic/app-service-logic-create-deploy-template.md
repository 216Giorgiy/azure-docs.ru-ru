<properties
   pageTitle="Создание шаблона развертывания приложения логики | Microsoft Azure"
   description="Узнайте, как создать шаблон развертывания приложения логики и использовать его для управления выпусками."
   services="logic-apps"
   documentationCenter=".net,nodejs,java"
   authors="jeffhollan"
   manager="erikre"
   editor=""/>

<tags
   ms.service="logic-apps"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="integration"
   ms.date="05/25/2016"
   ms.author="jehollan"/>

# Создание шаблона развертывания приложения логики

После создания приложения логики на его основе можно создать шаблон Azure Resource Manager. Таким образом вы сможете легко развернуть приложение логики в любой среде или группе ресурсов, где это может потребоваться. Общие сведения о шаблонах Resource Manager см. в статьях [Создание шаблонов диспетчера ресурсов Azure](../resource-group-authoring-templates.md) и [Развертывание ресурсов с использованием шаблонов Azure Resource Manager](../resource-group-template-deploy.md).

## Шаблон развертывания приложения логики

Приложение логики состоит из трех основных компонентов:

* **Ресурс приложения логики**. Этот ресурс содержит такие сведения, как тарифный план, расположение и определение рабочего процесса.
* **Определение рабочего процесса**. Это то, что отображается в представлении кода. В него входит определение действий процесса и принцип работы механизма. Это свойство `definition` ресурса приложения логики.
* **Подключения**. Это отдельные ресурсы для безопасного хранения метаданных, связанных со всеми подключениями соединителя, таких как строка подключения и маркер доступа. Они указываются в разделе `parameters` ресурса приложения логики.

Вы можете просмотреть все эти компоненты имеющихся приложений логики с помощью таких инструментов, как [обозреватель ресурсов Azure](http://resources.azure.com).

Чтобы создать шаблон для приложения логики, который можно использовать для развертываний групп ресурсов, необходимо определить ресурсы и при необходимости параметризовать их. Например, если развертывание осуществляется в тестовой, рабочей среде или в среде разработки, скорее всего, в каждой из этих сред потребуется использовать различные строки подключения к базе данных SQL. Или выполнить развертывания в разных подписках или группах ресурсов.

## Создание шаблона развертывания приложения логики

При создании шаблона для развертывания приложения логики могут быть полезными некоторые инструменты. Его можно создать вручную, используя указанные выше ресурсы и настроив требуемые параметры. Также можно использовать модуль PowerShell для [создания шаблона приложения логики](https://github.com/jeffhollan/LogicAppTemplateCreator). Этот модуль с открытым исходным кодом оценивает приложение логики и все подключения, используемые в этом приложении, а затем создает ресурсы шаблона с необходимыми параметрами для развертывания. Например, если приложение логики получило сообщение из очереди служебной шины Azure и добавило данные в базу данных SQL Azure, инструмент сохранит всю логику оркестрации и параметризует строки подключения SQL и служебной шины, чтобы их можно было настроить во время развертывания.

>[AZURE.NOTE] Подключения должны относиться к той же группе ресурсов, что и приложение логики.

### Установка модуля PowerShell для шаблона приложения логики

Проще всего установить модуль через [коллекцию PowerShell](https://www.powershellgallery.com/packages/LogicAppTemplate/0.1) с использованием команды `Install-Module -Name LogicAppTemplate`.

Также можно установить модуль PowerShell вручную:

1. Скачайте последний выпуск [модуля для создания шаблона приложения логики](https://github.com/jeffhollan/LogicAppTemplateCreator/releases).
1. Извлеките содержимое папки в папку модуля PowerShell (обычно это `%UserProfile%\Documents\WindowsPowerShell\Modules`).

Чтобы модуль поддерживал любой маркер доступа клиента или подписки, рекомендуется использовать программу командной строки [ARMClient](https://github.com/projectkudu/ARMClient). В этой [записи блога](http://blog.davidebbo.com/2015/01/azure-resource-manager-client.html) программа ARMClient рассматривается подробней.

### Создание шаблона приложения логики с помощью PowerShell

После установки PowerShell можно создать шаблон, используя следующую команду:

`armclient token $SubscriptionId | Get-LogicAppTemplate -LogicApp MyApp -ResourceGroup MyRG -SubscriptionId $SubscriptionId -Verbose | Out-File C:\template.json`

`$SubscriptionId` — это идентификатор подписки Azure. Эта строка сначала получает маркер доступа через программу ARMClient, затем передает его по конвейеру в сценарий PowerShell и создает шаблон в JSON-файл.

## Добавление параметров для шаблона приложения логики

После создания шаблона приложения логики можно добавлять или изменять любые дополнительные параметры. Например, если определение включает идентификатор ресурса в функции Azure или вложенном рабочем процессе, где планируется одно развертывание, можно добавить дополнительные ресурсы для шаблона и при необходимости параметризовать идентификаторы. То же касается и ссылок на пользовательские интерфейсы API или конечные точки Swagger, которые будут развернуты в каждой группе ресурсов.

## Развертывание шаблона приложения логики

Шаблон можно развернуть, используя любое количество инструментов, включая PowerShell, REST API, управление выпусками Visual Studio или портал Azure. Дополнительные сведения см. в статье [Развертывание ресурсов с использованием шаблонов Azure Resource Manager](../resource-group-template-deploy.md). Рекомендуется также создать [файл параметров](../resource-group-template-deploy.md#parameter-file) для хранения их значений.

### Авторизация подключений OAuth

После развертывания приложение логики будет полноценно работать с допустимыми параметрами. Но чтобы создать допустимый маркер доступа, необходимо авторизовать подключения OAuth. Это можно сделать, открыв приложение логики в конструкторе и авторизовав подключения. Или, чтобы автоматизировать эту процедуру, можно использовать сценарий, предоставляющий разрешение на каждое подключение OAuth. На GitHub есть пример сценария в проекте [LogicAppConnectionAuth](https://github.com/logicappsio/LogicAppConnectionAuth).

## Управление выпусками Visual Studio

При развертывании среды и управлении ею часто используется управление выпусками Visual Studio и шаблон развертывания приложения логики. Visual Studio Team Services содержит задачу [развертывания группы ресурсов Azure](https://github.com/Microsoft/vsts-tasks/tree/master/Tasks/DeployAzureResourceGroup), которую можно добавить в любую сборку или конвейер выпуска. Для авторизации развертывания требуется [субъект-служба](https://blogs.msdn.microsoft.com/visualstudioalm/2015/10/04/automating-azure-resource-group-deployment-using-a-service-principal-in-visual-studio-online-buildrelease-management/). При ее наличии можно создать определение выпуска.

1. Для создания нового определения в управлении выпусками выберите пункт **Пусто**, чтобы открыть пустое определение.

    ![Создание нового пустого определения][1]

1. Выберите все необходимые ресурсы. Это скорее всего будет шаблон приложения логики, созданный вручную или в процессе сборки.
1. Добавьте задачу **развертывания группы ресурсов Azure**.
1. Настройте использование [субъекта-службы](https://blogs.msdn.microsoft.com/visualstudioalm/2015/10/04/automating-azure-resource-group-deployment-using-a-service-principal-in-visual-studio-online-buildrelease-management/) и добавьте ссылку на файлы шаблона и параметров шаблона.
1. При необходимости выполните соответствующие действия в процессе выпуска для других сред, автоматических тестов или механизмов утверждения.

<!-- Image References -->
[1]: ./media/app-service-logic-create-deploy-template/emptyReleaseDefinition.PNG

<!---HONumber=AcomDC_0803_2016-->