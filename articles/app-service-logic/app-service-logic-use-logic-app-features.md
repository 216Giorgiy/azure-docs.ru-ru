<properties 
	pageTitle="Использование функций приложения логики" 
	description="Узнайте, как использовать расширенные функции приложений логики." 
	authors="stepsic-microsoft-com" 
	manager="dwrede" 
	editor="" 
	services="app-service\logic" 
	documentationCenter=""/>

<tags
	ms.service="app-service-logic"
	ms.workload="integration"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="05/23/2015"
	ms.author="stepsic"/>
	
# Использование функций приложений логики

В [предыдущем разделе][Create a new logic app] вы создали свое первое приложение логики. Теперь мы покажем, как построить более сложный процесс с помощью приложений логики службы приложений. В этом разделе вводятся следующие новые понятия, используемые в приложениях логики.

- Условная логика, которая выполняет действие только в том случае, если выполнено определенное условие.
- Повторяющиеся действия.
- Представление кода для изменения существующего приложения логики.
- Варианты запуска рабочего процесса.

Перед выполнением этого раздела следует выполнить действия, описанные в разделе [Создание нового приложения логики]. На [портале Azure] найдите свое приложение логики и щелкните элемент **Триггеры и действия** в сводке, чтобы изменить определение приложения логики.

## Добавление условной логики и повторов

Хотя изначальный процесс работает, некоторые области можно улучшить. Во-первых, это действие только отправляет вам возвращенный верхний твит. Логически вам нужно получить все твиты с ключевым словом. Чтобы повторять действие для списка элементов, например для возвращенных твитов, необходимо использовать свойство `repeat`.

### Использование repeat
Свойство repeat получает список элементов и выполняет действие для каждого элемента в этом списке. С помощью следующих шагов можно обновить существующее действие, чтобы оно использовало повторы, что гораздо более рационально для списка твитов.

1. Вернитесь в созданный рабочий процесс и нажмите ссылку **Определение** в разделе **Основные компоненты**. 

2. Чтобы изменить действие **соединителя Dropbox**, щелкните значок карандаша.

3. Щелкните значок шестеренки и выберите **Повторить по списку**.
 
2. Рядом с полем **Повторить** нажмите кнопку `...` и выберите **Основной текст**. Функция

    	@body('twitterconnector')

	появится в текстовом поле. Эта функция извлекает список твитов.

3. Выберите весь текст в текстовом поле **Содержимое** и удалите его. Затем нажмите `...` и выберите **Текст твита**. Будет вставлена функция **repeatItem()**, которая возвращает каждый элемент из списка.

Обратите внимание, что результаты повторяющихся действий разные. Если вы хотели ссылаться на результаты операции Dropbox,то могли *не* выполнять обычную функцию `@actions('dropboxconnector').outputs.body`, а вместо нее выполнять `@actions('dropboxconnector').outputs.repeatItems`. Эта функция возвращает список, состоящий из времени и результатов каждого выполнения операции. Например, `@first(actions('dropboxconnector').outputs.repeatItems).outputs.body.FilePath` возвращает путь к первому отправленному файлу.

### Условная логика
Это приложение логики приводит к тому, что в Dropbox отправляется много файлов. С помощью следующих действий можно добавить дополнительную логику, чтобы вы получали файл, только если твит имеет определенное количество ретвитов.

1. Щелкните значок шестеренки в верхней части панели действий и выберите команду **Добавить условие для выполнения**.

2. В текстовом поле введите следующее:

    	@greater(repeatItem().Retweet_Count , 5)
    
	Функция **greater** сравнивает два значения и разрешает выполнение действия, если первое значение больше второго. Конкретное свойство указывается с помощью точки (.) и следующего за ней имени свойства, например `.Retweet_Count`, как показано выше.

3. Щелкните флажок, чтобы сохранить это действие Dropbox.

## Использование представления кода для изменения приложения логики

Помимо конструктора, вы можете изменять непосредственно код, задающий приложение логики, как показано далее.

1. Нажмите кнопку **Просмотр кода** в панели команд. 

	Откроется полный редактор, показывающий определение, которое вы только что изменили.

	![Просмотр кода](./media/app-service-logic-use-logic-app-features/codeview.png)

    С помощью текстового редактора вы можете копировать и вставлять любое количество действий в том же приложении логики или в разных приложениях логики. Вы также можете легко добавлять или удалять целые разделы в определении или совместно использовать определения с другими пользователями.

2. После внесения нужных изменений в представлении кода просто нажмите кнопку **Сохранить**.

### Параметры
Некоторые возможности приложений логики можно использовать только в представлении кода. Одним из примеров являются параметры. Параметры облегчают многократное использование значений во всем приложении логики. Например, если вы хотите использовать один адрес электронной почты в нескольких действиях, можно задать его как параметр.

Далее приводится пример изменения существующего приложения логики, чтобы в нем использовались параметры для условия запроса.

1. В представлении кода найдите объект `parameters : {}` и вставьте в него следующий объект topic:

	    "topic" : {
		    "type" : "string",
		    "defaultValue" : "MicrosoftAzure"
	    }
    
2. Прокрутите до действия `twitterconnector`, найдите значение для запроса и замените его на `#@{parameters('topic')}`. Можно также использовать функцию **concat**, чтобы объединить две и более строк, например: `@concat('#',parameters('topic'))` (идентично фрагменту выше).
 
3. Наконец, перейдите к действию `dropboxconnector` и добавьте параметр topic следующим образом:

    	/tweets/@{parameters('topic')}/@{repeatItem().TweetID}.txt

Параметры — это хороший способ извлечения значений, которые вы планируете часто изменять. Их особенно удобно использовать, когда вам нужно переопределять параметры в разных средах. Дополнительные сведения о переопределении параметров в зависимости от среды см. в нашей [документации по REST API](http://go.microsoft.com/fwlink/?LinkID=525617&clcid=0x409).

Теперь, после нажатия кнопки **Сохранить**, вы будете каждый час получать новые твиты, имеющие более 5 ретвитов, которые будут отправляться в папку **tweets** в Dropbox.

Подробнее об определениях приложений логики: [Создание определений приложений логики](app-service-logic-author-definitions.md).

## Запуск рабочего процесса приложения логики
Существует несколько различных вариантов запуска рабочего процесса, заданного в приложении логики. Рабочий процесс всегда можно запустить по запросу на [портале Azure].

### Триггеры повторения
Триггер повторения запускается с заданным интервалом. Если в триггере предусмотрена условная логика, он проверяет, нужно ли запустить рабочий процесс. Триггер указывает, что рабочий процесс должен быть запущен, возвращая код состояния `200`. Если рабочий процесс запускать не нужно, возвращается код состояния `202`.

### Обратный вызов с использованием REST API
Службы могут вызывать конечную точку приложения логики для запуска рабочего процесса. Чтобы найти конечную точку для доступа, перейдите в колонку **Свойства** с помощью кнопки **Параметры** в командной строке вашего приложения логики.

Вы можете использовать обратный вызов для вызова приложения логики из своего пользовательского приложения. Вы должны использовать **обычную** проверку подлинности. Для вас создается имя пользователя `default`, а паролем является значение поля **Первичный ключ доступа** в колонке **Свойства**. Например:

        POST https://default:<<your primary access key>>@<< your endpoint>>/run?api-version=2015-02-01-preview
        Content-type: application/json
        {
            "name" : "nameOfTrigger",
            "outputs" : { "property" : "value" }
        }

Вы можете передавать выходные данные в рабочий процесс и ссылаться на них в рабочем процессе. Например, если в приведенный выше триггер вы включите `@triggers().outputs.property`, то получите `value`.

Дополнительные сведения см. в [документации по REST](http://go.microsoft.com/fwlink/?LinkID=525617&clcid=0x409).

### Выполнение вручную
Вы можете задать приложение логики без триггера. В этом случае рабочий процесс необходимо запускать вручную. Такой тип приложений логики лучше всего подходит для процессов, которые нужно запускать только периодически. Чтобы создать приложение логики без триггера, установите флажок **Запускать эту логику вручную** в поле **Запуск логики** конструктора.

Чтобы запустить приложение логики по требованию, нажмите кнопку **Запустить сейчас** в командной строке.

<!-- Shared links -->
[Create a new logic app]: app-service-logic-create-a-logic-app.md
[Создание нового приложения логики]: app-service-logic-create-a-logic-app.md
[портале Azure]: https://portal.azure.com

<!---HONumber=July15_HO3-->