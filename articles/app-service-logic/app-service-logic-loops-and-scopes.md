<properties
   pageTitle="Циклы, области действия и индивидуальная обработка приложений логики | Microsoft Azure"
   description="Основные понятия циклов, областей действия и индивидуальной обработки приложений логики"
   services="app-service\logic"
   documentationCenter=".net,nodejs,java"
   authors="jeffhollan"
   manager="dwrede"
   editor=""/>

<tags
   ms.service="logic-apps"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="integration"
   ms.date="05/14/2016"
   ms.author="jehollan"/>
   
# Циклы, области действия и индивидуальная обработка приложений логики
  
>[AZURE.NOTE] Эта версия статьи предназначена для приложений логики со схемой версии 2016-04-01-preview и более поздних версий. Основные понятия такие же, как в более ранних схемах, но области действий доступны только для этой и более ранних версий схемы.
  
## Цикл и массивы ForEach
  
Приложения логики позволяют запускать циклы с использованием набора данных и выполнять определенное действие с каждым из них. Это можно сделать с помощью действия `foreach`. В конструкторе можно добавить цикл foreach. Выбрав массив для перебора, можно приступать к добавлению действий. В настоящее время с каждым циклом foreach можно выполнять только одно действие, однако в ближайшие недели это ограничение будет снято. Один раз в цикле можно указать, что должно происходить с каждым значением в массиве.

В представлении кода цикл foreach можно указать представленным ниже образом. Это пример цикла foreach, который отправляет сообщение на каждый адрес электронной почты, который содержит microsoft.com:

```
{
    "email_filter": {
        "type": "query",
        "inputs": {
            "from": "@triggerBody()['emails']",
            "where": "@contains(item()['email'], 'microsoft.com')
        }
    },
    "forEach_email": {
        "type": "foreach",
        "foreach": "@body('email_filter')",
        "actions": {
            "send_email": {
                "type": "ApiConnection",
                "inputs": {
                "body": {
                    "to": "@item()",
                    "from": "me@contoso.com",
                    "message": "Hello, thank you for ordering"
                }
                "host": {
                    "connection": {
                        "id": "@parameters('$connections')['office365']['connection']['id']"
                    }
                }
                }
            }
        },
        "runAfter":{
            "email_filter": [ "Succeeded" ]
        }
    }
}
```
  
  Действие `foreach` может перебирать массивы, содержащие до 5000 строк. Переборы могут выполняться параллельно, поэтому, если требуется управление потоком, сообщения необходимо добавлять в очередь.
  
## Цикл Until
  
  Действие или серию действий можно выполнять, пока не будет выполнено определенное условие. Чаще всего эта возможность применяется для вызова конечной точки до получения искомого ответа. В конструкторе можно добавить цикл until. После добавления действия в цикл можно задать условия выхода, а также ограничения для цикла. Между циклами действует одноминутная задержка.
  
  В представлении кода цикл until можно указать представленным ниже образом. Это пример вызова конечной точки HTTP до получения значения "Выполнен" в теле ответа. Действие будет завершено при выполнении одного из следующих условий:
  
  * HTTP-ответ имеет состояние "Выполнен".
  * Действие выполнялось 1 час.
  * Действие было выполнено 100 раз.
  
  ```
  {
      "until_successful":{
        "type": "until",
        "expression": "@equals(actions('http')['status'], 'Completed'),
        "limit": {
            "count": 100,
            "timeout": "PT1H"
        },
        "actions": {
            "create_resource": {
                "type": "http",
                "inputs": {
                    "url": "http://provisionRseource.com",
                    "body": {
                        "resourceId": "@triggerBody()"
                    }
                }
            }
        }
      }
  }
  ```
  
## SplitOn и индивидуальная обработка

Иногда триггер может получить массив элементов, которые нужно обработать отдельно и запустить для каждого собственный рабочий процесс. Это можно сделать с помощью команды `spliton`. По умолчанию, если триггер Swagger определяет полезные данные, составляющие массив, `spliton` будет добавлен и запустит выполнение каждого элемента. SplitOn можно добавить только к триггеру. Его можно настроить вручную или перезаписать в представлении кода определения. В настоящее время SplitOn может выполнять индивидуальную обработку массивов, содержащих до 5000 элементов. Одновременно использовать `spliton` и реализовать шаблон синхронных ответов нельзя. Любой вызываемый рабочий процесс, содержащий действие `response` помимо `spliton`, будет выполняться асинхронно и отправлять незамедлительный ответ `202 Accepted`.

В приведенном ниже примере SplitOn указывается в представлении кода. Он получает массив элементов и выполняет их по отдельности в каждой строке.

```
{
    "myDebatchTrigger": {
        "type": "Http",
        "inputs": {
            "url": "http://getNewCustomers",
        },
        "recurrence": {
            "frequencey": "Second",
            "interval": 15
        },
        "spliton": "@triggerBody()['rows']"
    }
}
```

## Области действия

Последовательности действий можно группировать, используя область действий. Это можно использовать для обработки исключений. Добавьте новую область в конструкторе и начните добавлять в нее действия. Области можно определять в представлении кода следующим образом:


```
{
    "myScope": {
        "type": "scope",
        "actions": {
            "call_bing": {
                "type": "http",
                "inputs": {
                    "url": "http://www.bing.com"
                }
            }
        }
    }
}
```

<!---HONumber=AcomDC_0727_2016-->