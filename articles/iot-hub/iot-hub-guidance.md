<properties
 pageTitle="Разделы руководства по использованию центра IoT Azure | Microsoft Azure"
 description="Коллекция рекомендаций по решениям для разработки, в которых используется центр IoT Azure."
 services="iot-hub"
 documentationCenter=""
 authors="fsautomata"
 manager="timlt"
 editor=""/>

<tags
 ms.service="iot-hub"
 ms.devlang="na"
 ms.topic="article"
 ms.tgt_pltfrm="na"
 ms.workload="na"
 ms.date="09/29/2015"
 ms.author="elioda"/>

# Центр IoT Azure: руководство

## Подготовка устройств

Решения IoT хранят информацию об устройствах во многих различных системах и хранилищах. Одним из таких хранилищ выступает [реестр удостоверений центра IoT][IoT Hub Developer Guide - identity registry]. Как и в других хранилищах, в реестре хранится информация об устройствах для конкретного приложения. Процесс создания необходимой информации об устройствах во всех этих системах мы называем *подготовкой*.

Существует множество требований и стратегий для подготовки устройств (см. [руководство по управлению устройствами центра IoT] для получения дополнительных сведений). [Реестр удостоверений центра IoT][IoT Hub Developer Guide - identity registry] предоставляет интерфейсы API, необходимые для интеграции центра IoT в ваш процесс подготовки.

## Шлюзы поля

Полевой шлюз — это специализированное устройство или программное обеспечение общего назначения, которое служит средством реализации обмена данными, а также, по возможности, системой управления локальными устройствами и центром обработки данных, получаемых от устройств. Полевой шлюз может локально обрабатывать данные и управлять устройствами; с другой стороны он может фильтровать или агрегировать данные телеметрии устройств и таким образом уменьшать объем данных, передаваемых в серверную часть.

В сферу ответственности полевого шлюза входит сам полевой шлюз и все присоединенные к нему устройства. Как можно догадаться из названия, полевые шлюзы функционируют за пределами ЦОД и обычно привязаны к тому или иному местоположению. Полевой шлюз отличается от обычного маршрутизатора трафика тем, что ему отведена активная роль в управлении доступом и потоком информации. Это значит, что он является ориентированным на приложения объектом, а также терминалом сетевых подключений или сеансов (например, шлюзы в этом контексте могут помогать в подготовке устройств, преобразовании данных, трансляции протоколов и обработке правил событий). Устройства NAT и брандмауэры, напротив, не могут считаться полевыми шлюзами, так как они не являются явными терминалами подключений или сеансов. Они просто маршрутизируют (или запрещают) подключения или сеансы, которые через них выполняются.

### Прозрачные и непрозрачные полевые шлюзы

В отношении удостоверений устройств полевой шлюз называется *прозрачным*, если в реестре удостоверений центра IoT существуют удостоверения других устройств, входящих в сферу ответственности шлюза. Полевой шлюз называется *непрозрачным*, если единственным удостоверением в реестре удостоверений центра IoT является удостоверение полевого шлюза.

Важно отметить, что использование *непрозрачных* шлюзов препятствует [защите удостоверений устройств от спуфинга][IoT Hub Developer Guide - Anti-spoofing] средствами центра IoT. Кроме того, поскольку все устройства, входящие в сферу ответственности полевого шлюза, представлены в центре IoT как единое устройство, ограничения и квоты к ним будут применяться как к единому устройству.

### Дополнительные рекомендации

При реализации полевого шлюза можно использовать [пакеты SDK для устройств IoT Azure][]. Некоторые пакеты SDK предоставляют специальные функции для полевых шлюзов, например возможность мультиплексировать данные, поступающие от нескольких устройств, в одном канале к центру IoT. Как описано в [руководстве для разработчиков центра IoT в разделе «Выбор протокола связи»][], не стоит использовать HTTP/1 в качестве транспортного протокола для полевых шлюзов.

## Использование настраиваемых схем и служб для проверки подлинности устройств

Центр IoT позволяет настраивать контроль доступа и учетные данные безопасности для каждого устройства посредством [реестра удостоверений устройств][IoT Hub Developer Guide - identity registry].

Если в решение IoT уже были вложены значительные средства для реализации настраиваемого реестра удостоверений устройств и/или схемы проверки подлинности, оно все равно позволяет пользоваться другими функциями центра IoT. Для этого нужно создать *службу маркеров* для центра IoT.

Служба маркеров — это саморазвертываемая облачная служба, которая использует *политику общего доступа* центра IoT с разрешениями **DeviceConnect** для создания маркеров *уровня устройства*.

  ![][img-tokenservice]

Ниже приведены основные этапы для схемы службы маркеров.

1. Создание [политики общего доступа центра IoT][IoT Hub Developer Guide - Security] с разрешениями **DeviceConnect** для вашего центра IoT. Эту политику служба маркеров будет использовать для подписания маркеров.
2. Когда устройству требуется доступ к центру IoT, оно запрашивает у службы маркеров подписанный маркер. Устройство может использовать существующую настраиваемую схему проверки подлинности или реестр удостоверений устройств.
3. Служба маркеров возвращает маркер, созданный согласно требованиям к безопасности, описанным в [руководстве для разработчиков центра IoT][]. `/devices/{deviceId}` используется как `resourceURI`, а в качестве `deviceId` указывается устройство, подлинность которого проверяется.
4. Устройство использует маркер для подключения к центру IoT.

При необходимости служба маркеров может задать срок действия маркера. По истечении срока действия центр IoT прекратит обслуживание подключения, а устройству придется запросить новый токен у службы токенов. Очевидно, что короткий срок действия увеличит нагрузку как на устройство, так и на службу маркеров.

Стоит отметить, что в центре IoT по-прежнему необходимо создать удостоверение устройства. В противном случае устройство не сможет подключиться. Это также означает, что контроль доступа на уровне отдельных устройств (путем отключения удостоверений устройств, как описано в руководстве для разработчиков центра IoT в разделе [Реестр удостоверений устройств][]) продолжает работать, даже если устройство проходит проверку подлинности с помощью маркера. Это уменьшает риск существования маркеров с длительным сроком действия.

### Сравнение с настраиваемым шлюзом

Вариант со службой маркеров позволяет центру IoT обрабатывать большую часть трафика решения, поэтому такой вариант является рекомендованным способом внедрения настраиваемого реестра удостоверений или схемы проверки подлинности с использованием центра IoT. Тем не менее существуют случаи, когда настраиваемая схема проверки подлинности настолько тесно переплетена с протоколом (например, [TLS-PSK][]), что для обработки всего трафика требуется отдельная служба (*настраиваемый шлюз*). Дополнительные сведения см. в разделе [Шлюз протокола][].

## Дальнейшие действия

Дополнительные сведения о центре IoT в Azure см. по следующим ссылкам:

- [Начало работы с центром IoT (руководство)][lnk-get-started]
- [Что такое центр IoT в Azure?][]

[img-tokenservice]: ./media/iot-hub-guidance/tokenservice.png

[IoT Hub Developer Guide - identity registry]: iot-hub-devguide.md#identityregistry
[Реестр удостоверений устройств]: iot-hub-devguide.md#identityregistry
[руководство по управлению устройствами центра IoT]: iot-hub-device-management.md
[IoT Hub Developer Guide - Anti-spoofing]: iot-hub-devguide.md#antispoofing
[пакеты SDK для устройств IoT Azure]: iot-hub-sdks-summary.md
[руководстве для разработчиков центра IoT в разделе «Выбор протокола связи»]: iot-hub-devguide.md#amqpvshttp
[IoT Hub Developer Guide - Security]: iot-hub-devguide.md#security
[руководстве для разработчиков центра IoT]: iot-hub-devguide.md#security
[TLS-PSK]: https://tools.ietf.org/html/rfc4279
[Шлюз протокола]: iot-hub-protocol-gateway.md

[lnk-get-started]: iot-hub-csharp-csharp-getstarted.md
[Что такое центр IoT в Azure?]: iot-hub-what-is-iot-hub.md

<!---HONumber=Nov15_HO3-->