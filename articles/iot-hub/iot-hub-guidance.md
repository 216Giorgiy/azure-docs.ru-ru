<properties
 pageTitle="Центр IoT: руководство | Microsoft Azure"
 description="Разделы, посвященные шлюзам, подготовке устройств и проверке подлинности для разработки решений IoT с помощью центра IoT Azure."
 services="iot-hub"
 documentationCenter=""
 authors="dominicbetts"
 manager="timlt"
 editor=""/>

<tags
 ms.service="iot-hub"
 ms.devlang="na"
 ms.topic="article"
 ms.tgt_pltfrm="na"
 ms.workload="na"
 ms.date="11/10/2015"
 ms.author="dobett"/>

# Разработка решения

Эта статья содержит сведения о разработке следующих возможностей в решении IoT.

- Подготовка устройств
- Шлюзы поля
- Проверка подлинности устройства

## Подготовка устройств

IoT решения хранят такие данные об отдельных устройствах, как:

- удостоверения устройств и ключи проверки подлинности;
- тип и версия оборудования устройства;
- состояние устройства;
- версии и возможности программного обеспечения;
- журнал команд устройства.

Данные устройств, хранимые решением IoT, зависят от конкретных требований этого решения. Как минимум решение должно хранить удостоверения устройств и ключи проверки подлинности. Центр IoT имеет [реестр удостоверений][lnk-devguide-identityregistry], который может хранить значения для каждого устройства, например идентификаторы, ключи проверки подлинности и коды состояния. Решение может использовать другие службы Azure, такие как таблицы, большие двоичные объекты или DocumentDB, для хранения любых дополнительных данных устройств.

*Подготовка устройств* — это процесс добавления исходных данных устройства в хранилища в решении. Чтобы новое устройство могло подключиться к центру, необходимо добавить новый идентификатор устройства и ключи в [реестр удостоверений центра IoT][lnk-devguide-identityregistry]. В рамках процесса подготовки может потребоваться инициализировать данные устройства в других хранилищах решения.

В статье [Руководство по управлению устройствами центра IoT][lnk-device-management] описаны некоторые распространенные стратегии подготовки устройства. [API реестра удостоверений центра IoT][lnk-devguide-identityregistry] позволяют интегрировать центр IoT в процесс подготовки.

## Шлюзы поля

В решении IoT *полевой шлюз* располагается между устройствами и центром IoT и обычно находится ближе к устройствам. Устройства напрямую взаимодействуют с полевым шлюзом с помощью протокола, поддерживаемого устройствами, а полевой шлюз взаимодействует с центром IoT с помощью протокола, поддерживаемого центром IoT. Полевой шлюз поля может представлять собой специализированное автономное устройство или программное обеспечение, работающее на существующем оборудовании.

Полевой шлюз поля отличается от обычного маршрутизатора трафика (например, устройства NAT или брандмауэра) тем, что ему отведена активная роль в управлении доступом и потоком информации в решении. Например, полевой шлюз может выполнять следующие задачи.

- Управление локальными устройствами. Например, полевой шлюз может выполнять обработку правил событий и отправлять команды на устройства в ответ на определенные данные телеметрии.
- Фильтрация или статистическая обработка данных телеметрии до их перенаправления в центр IoT. Это может уменьшить объем данных, отправляемых в центр IoT, и потенциально сократить затраты в решении.
- Помощь в подготовке устройств.
- Преобразование данных телеметрии для упрощения обработки в серверной части вашего решения.
- Выполнение преобразования протоколов, чтобы устройства могли взаимодействовать с центром IoT даже в том случае, если они не используют транспортные протоколы, поддерживаемые центром IoT.

> [AZURE.NOTE]Несмотря на то, что обычно полевой шлюз развертывается локально на устройствах, в некоторых случаях можно развернуть [шлюз протокола][lnk-gateway] в облаке.

### Типы полевых шлюзов

Полевой шлюз может быть *прозрачным* или *непрозрачным*.

| &nbsp; | Прозрачный | Непрозрачный |
|--------|-------------|--------|
| Удостоверения, хранящиеся в реестре идентификаторов центра IoT | Все подключенные устройства | Только удостоверение полевого шлюза |
| Центр IoT может обеспечить [защиту от подделок удостоверений устройств][lnk-devguide-antispoofing]. | Да | Нет |
| [Регулирования и квоты][lnk-throttles-quotas] | Применяется к каждому устройству | Применяется к полевому шлюзу |

### Дополнительные рекомендации

Для реализации полевого шлюза можно использовать [пакеты SDK для устройств IoT Azure][lnk-device-sdks]. Некоторые пакеты SDK для устройств предлагают определенные функции для реализации полевого шлюза, такие как возможность мультиплексировать обмен данными из нескольких устройств в рамках того же подключения к центру IoT. Как описано в [руководстве для разработчиков центра IoT в разделе "Выбор протокола связи"][lnk-devguide-protocol], не стоит использовать HTTP/1 в качестве транспортного протокола для полевого шлюза.

## Настраиваемая проверка подлинности устройства

Центр IoT Azure позволяет настроить контроль доступа и учетные данные безопасности для каждого устройства посредством [реестра удостоверений устройств][lnk-devguide-identityregistry]. Если в решение IoT уже были вложены значительные средства для реализации настраиваемого реестра удостоверений устройств и (или) схемы проверки подлинности, эту инфраструктуру можно интегрировать в центр IoT. Для этого нужно создать *службу маркеров*. Таким образом можно использовать и другие функции IoT в решении.

Служба маркеров — это настраиваемая облачная служба, которая использует *политику общего доступа* центра IoT с разрешениями **DeviceConnect** для создания маркеров *уровня устройства*, обеспечивающих подключение устройств к центру IoT.

  ![][img-tokenservice]

Ниже приведены основные этапы для схемы службы маркеров.

1. Создание [политики общего доступа центра IoT][lnk-devguide-security] с разрешениями **DeviceConnect** для вашего центра IoT. Эту политику можно создать на [портале предварительной версии][lnk-preview-portal] или программным способом. Эту политику служба маркеров будет использовать для подписания создаваемых маркеров.
2. Когда устройству требуется доступ к центру IoT, оно запрашивает у службы маркеров подписанный маркер. Для определения удостоверения устройства, используемого службой маркеров для создания маркера, устройство может использовать настраиваемую схему проверки подлинности или реестр удостоверений устройств.
3. Служба маркеров возвращает маркер, созданный согласно требованиям к безопасности, описанным в [руководстве для разработчиков центра IoT][lnk-devguide-security]. `/devices/{deviceId}` используется как `resourceURI`, а в качестве `deviceId` указывается устройство, подлинность которого проверяется. Служба маркеров использует политики общего доступа для создания маркера.
4. Устройство использует маркер для подключения к центру IoT.

> [AZURE.NOTE]Для создания маркера в службе маркеров можно использовать класс .NET [SharedAccessSignatureBuilder][lnk-dotnet-sas] или класс Java [IotHubServiceSasToken][lnk-java-sas].

При необходимости служба маркеров может задать срок действия маркера. По истечении срока действия маркера центр IoT прекратит обслуживание подключения к устройству, а устройству придется запросить новый маркер в службе маркеров. Короткий срок действия увеличит нагрузку как на устройство, так и на службу маркеров.

Чтобы устройство могло подключаться к вашему центру, его необходимо также добавить в реестр удостоверений устройств центра IoT, даже если для подключения устройство использует маркер, а не ключ. Поэтому контроль доступа на уровне отдельных устройств путем включения или отключения удостоверений устройств в разделе [Реестр удостоверений центра IoT][lnk-devguide-identityregistry] продолжает работать, если устройство проходит проверку подлинности с помощью маркера. Это уменьшает риск существования маркеров с длительным сроком действия.

### Сравнение с настраиваемым шлюзом

Вариант со службой маркеров является рекомендованным способом внедрения настраиваемого реестра удостоверений или схемы проверки подлинности с использованием центра IoT, поскольку центр IoT продолжает обрабатывать большую часть трафика решения. Однако существуют случаи, когда настраиваемая схема проверки подлинности настолько тесно переплетена с протоколом (например, [TLS-PSK][lnk-tls-psk]), что для обработки всего трафика требуется отдельная служба (*настраиваемый шлюз*). Дополнительные сведения см. в разделе [Шлюз протокола][lnk-gateway].

## Дальнейшие действия

Дополнительные сведения о центре IoT в Azure см. по следующим ссылкам:

- [Начало работы с центром IoT (руководство)][lnk-get-started]
- [Что такое центр IoT в Azure?][lnk-what-is-hub]

[img-tokenservice]: ./media/iot-hub-guidance/tokenservice.png

[lnk-devguide-identityregistry]: iot-hub-devguide.md#identityregistry
[lnk-device-management]: iot-hub-device-management.md

[lnk-device-sdks]: iot-hub-sdks-summary.md
[lnk-devguide-security]: iot-hub-devguide.md#security
[lnk-tls-psk]: https://tools.ietf.org/html/rfc4279
[lnk-gateway]: iot-hub-protocol-gateway.md

[lnk-get-started]: iot-hub-csharp-csharp-getstarted.md
[lnk-what-is-hub]: iot-hub-what-is-iot-hub.md
[lnk-preview-portal]: https://portal.azure.com
[lnk-throttles-quotas]: ../azure-subscription-service-limits.md/#iot-hub-limits
[lnk-devguide-antispoofing]: iot-hub-devguide.md#antispoofing
[lnk-devguide-protocol]: iot-hub-devguide.md#amqpvshttp
[lnk-dotnet-sas]: https://msdn.microsoft.com/library/microsoft.azure.devices.common.security.sharedaccesssignaturebuilder.aspx
[lnk-java-sas]: http://azure.github.io/azure-iot-sdks/java/service/api_reference/com/microsoft/azure/iot/service/auth/IotHubServiceSasToken.html

<!---HONumber=Nov15_HO4-->