---
title: Общие сведения о пользовательских конечных точках Центра Интернета вещей Azure | Документы Майкрософт
description: Руководство разработчика — использование правил маршрутизации для маршрутизации сообщений, передаваемых с устройства в облако, в пользовательские конечные точки.
author: dominicbetts
manager: timlt
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 04/09/2018
ms.author: dobett
ms.openlocfilehash: b035c7ef6dfe56c4b4534e081e70d95ea7c14847
ms.sourcegitcommit: 6cf20e87414dedd0d4f0ae644696151e728633b6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/06/2018
ms.locfileid: "34808032"
---
# <a name="use-message-routes-and-custom-endpoints-for-device-to-cloud-messages"></a>Использование правил маршрутизации и пользовательских конечных точек для сообщений, отправляемых с устройства в облако

Центр Интернета вещей позволяет направлять [сообщения, отправляемые с устройства в облако][lnk-device-to-cloud], в обращенные к службе конечные точки Центра Интернета вещей, исходя из свойств этих сообщений. Правила маршрутизации обеспечивают гибкость, позволяя отправлять сообщения в нужном направлении без установки каких-либо дополнительных служб или написания дополнительного кода. Каждое настраиваемое правило маршрутизации имеет следующие свойства:

| Свойство      | ОПИСАНИЕ |
| ------------- | ----------- |
| **Имя**      | Уникальное имя, которое определяет правило. |
| **Источник**    | Источник потока данных, в отношении которого выполняются действия. Например, телеметрия устройства. |
| **Condition** | Выражение запроса для правила маршрутизации, которое выполняется для заголовка и текста сообщения и определяет соответствие сообщения конечной точке. Дополнительные сведения о создании условия маршрутизации см. в статье [Справочник по языку запросов Центр Интернета вещей для двойников устройств и заданий][lnk-devguide-query-language]. |
| **Конечная точка**  | Имя конечной точки, в которую Центр Интернета вещей отправляет сообщения, соответствующие условию. Конечные точки должны находиться в одном регионе с Центром Интернета вещей, в противном случае может взиматься плата за межрегиональный трафик. |

Одно сообщение может соответствовать условиям в нескольких правилах маршрутизации. В таких случаях Центр Интернета вещей доставляет сообщение в конечную точку, связанную с каждым из этих правил. Центр Интернета вещей также выполняет автоматическую дедупликацию доставки сообщений. То есть, если сообщение соответствует нескольким правилам, имеющим общее назначение, то оно записывается в это назначение только один раз.

## <a name="endpoints-and-routing"></a>Конечные точки и маршрутизация

Центр Интернета вещей имеет [встроенную конечную точку][lnk-built-in] по умолчанию. Кроме того, можно создать пользовательские конечные точки для маршрутизации сообщений, связав с Центром другие службы в подписке. Сейчас Центр Интернета вещей поддерживает использование следующих служб в качестве пользовательских конечных точек: контейнеры службы хранилища Azure, концентраторы событий, очереди служебной шины и разделы служебной шины.

При использовании маршрутизации и пользовательских конечных точек сообщения доставляются во встроенную конечную точку, только если они не соответствуют правилам. Чтобы доставить сообщения во встроенную конечную точку, а также в пользовательскую конечную точку, добавьте маршрут, который отправляет сообщения в конечную точку **событий**.

> [!NOTE]
> Центр Интернета вещей поддерживает только запись данных в контейнеры службы хранилища Azure в виде больших двоичных объектов.

> [!WARNING]
> Очереди и разделы служебной шины, для которых включены **сеансы** или **поиск повторяющихся данных**, не поддерживаются в качестве пользовательских конечных точек.

Дополнительные сведения о создании пользовательских конечных точек в Центре Интернета вещей см. в статье [Руководство. Конечные точки Центра Интернета вещей][lnk-devguide-endpoints].

Дополнительные сведения о чтении из пользовательских конечных точек см. в статьях, посвященных:

* чтению из [контейнеров службы хранилища Azure][lnk-getstarted-storage];
* чтению из [концентраторов событий][lnk-getstarted-eh];
* чтению из [очередей служебной шины][lnk-getstarted-queue];
* чтению из [разделов служебной шины][lnk-getstarted-topic].

## <a name="latency"></a>Latency

При маршрутизации сообщений телеметрии, передаваемой с устройства в облако с помощью встроенных конечных точек наблюдается небольшое увеличение общей задержки после создания первого маршрута.

В большинстве случаев среднее увеличение задержки не превышает 1 секунду. Вы можете отслеживать задержки с помощью [метрики **d2c.endpoints.latency.builtIn.events** Центра Интернета вещей](https://docs.microsoft.com/azure/iot-hub/iot-hub-metrics). Последующее создание или удаление любого маршрута не влияет на общую задержку.

### <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о конечных точках Центра Интернета вещей см. в руководстве [Конечные точки Центра Интернета вещей][lnk-devguide-endpoints].

Дополнительные сведения о языке запросов, который используется для определения правил маршрутизации, см. в справочнике по [языку запросов Центра Интернета вещей для двойников устройств, заданий и маршрутизации сообщений][lnk-devguide-query-language].

В руководстве [Обработка сообщений Центра Интернета вещей, отправляемых с устройства в облако, с использованием маршрутов][lnk-d2c-tutorial] демонстрируется использование правил маршрутизации и пользовательских конечных точек.

[lnk-built-in]: iot-hub-devguide-messages-read-builtin.md
[lnk-device-to-cloud]: iot-hub-devguide-messages-d2c.md
[lnk-devguide-query-language]: iot-hub-devguide-query-language.md
[lnk-devguide-endpoints]: iot-hub-devguide-endpoints.md
[lnk-d2c-tutorial]: tutorial-routing.md
[lnk-getstarted-eh]: ../event-hubs/event-hubs-csharp-ephcs-getstarted.md
[lnk-getstarted-queue]: ../service-bus-messaging/service-bus-dotnet-get-started-with-queues.md
[lnk-getstarted-topic]: ../service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions.md
[lnk-getstarted-storage]: ../storage/blobs/storage-blobs-introduction.md
