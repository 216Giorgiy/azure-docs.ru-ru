<properties
 pageTitle="Общие сведения об управлении устройствами | Microsoft Azure"
 description="Общие сведения об управлении устройствами в центре IoT Azure: ";двойники"; устройств, запросы устройств и задания устройств"
 services="iot-hub"
 documentationCenter=""
 authors="ellenfosborne"
 manager="timlt"
 editor=""/>

<tags
 ms.service="iot-hub"
 ms.devlang="na"
 ms.topic="article"
 ms.tgt_pltfrm="na"
 ms.workload="na"
 ms.date="04/29/2016"
 ms.author="elfarber"/>

# Общие сведения об управлении устройствами с помощью центра IoT Azure (предварительная версия)

Управление устройствами в центре IoT Azure позволяет использовать стандартизированное управление устройствами IoT для удаленного управления, настройки и обновления устройств.

В IoT Azure для управления устройствами используются три основных понятия:

1.  **"Двойник" устройства:** представление физического устройства в центре IoT.

2.  **Запросы устройства**: позволяют находить "двойники" устройств и составлять общую картину таких "двойников". Например, можно найти все "двойники" устройств с встроенным ПО версии 1.0.

3.  **Задания устройств**: действия, выполняемые на одном или нескольких физических устройствах, такие как обновление встроенного ПО, перезагрузка и сброс параметров к значениям по умолчанию.

## "Двойник" устройства

"Двойник" устройства — это представление физического устройства в центре IoT. Для представления "двойника" устройства используется объект **Microsoft.Azure.Devices.Device**.

![][img-twin]

"Двойник" устройства состоит из следующих компонентов.

1.  **Поля устройства:** предопределенные свойства, которые используются для обмена сообщениями с центром IoT и управления устройствами. Они помогают центру IoT идентифицировать физические устройства и подключаться к ним. Поля устройства не синхронизируются с устройством и хранятся только на "двойнике" устройства. Поля устройства включают идентификатор устройства и данные проверки подлинности.

2.  **Свойства устройства**: предопределенный словарь свойств, описывающий физическое устройство. Физическое устройство определяет каждое свойство устройства и является полномочным хранилищем для всех соответствующих значений. Согласованное представление этих свойств хранится в "двойнике" устройства в облаке. Согласованность и актуальность свойств зависят от параметров синхронизации, описанных в статье [Tutorial: how to use the device twin][lnk-tutorial-twin] \(Учебник по использованию "двойника" устройства). Примерами свойства устройства могут служить версия встроенного ПО, уровень заряда аккумулятора и наименование производителя.

3.  **Свойства службы:** пары **&lt;ключ, значение&gt;**, которые разработчик добавляет в словарь свойств службы. Эти свойства расширяют модель данных для "двойника" устройства, что позволяет лучше характеризовать это устройство. Свойства службы не синхронизируются с устройством и хранятся только на "двойнике" устройства в облаке. В качестве примера можно привести свойство **&lt;NextServiceDate, 11/12/2017&gt;**, которое используется для поиска устройств по следующей дате обслуживания.

4.  **Теги:** подмножество свойств службы, представляющих собой произвольные строки, а не свойства словаря. Их можно использовать для аннотирования "двойников" устройств или организации устройств в группы. Теги не синхронизируются с устройством и хранятся только на "двойнике" устройства. Например, если "двойник" устройства представляет физический грузовик, можно добавить тег для каждого типа груза в этом грузовике: **яблоки**, **апельсины** и **бананы**.

## Запросы устройства

В предыдущем разделе вы узнали о различных компонентах "двойника" устройства. Теперь рассмотрим, как найти "двойники" устройства в реестре устройств центра IoT, используя свойства устройства или службы либо теги. Запрос можно использовать, например, для того, чтобы найти устройства, которые нужно обновить. Вы можете запросить все устройства с определенной версией встроенного ПО и передать результат в определенное действие (в центре IoT это называется действием устройства, оно рассматривается в следующем разделе).

В запросе можно использовать теги и свойства:

-   Для запроса "двойников" устройств с помощью тегов необходимо передать массив строк, после чего запрос возвращает набор устройств, помеченных всеми указанными строками.

-   Для запроса "двойников" устройств с помощью свойств службы или устройства используется выражение запроса JSON. В следующем примере показано, как запросить все устройства со свойством устройства, имеющим ключ **FirmwareVersion** и значение **1.0**. Как видите, **типом** свойства является **устройство**, а значит, запрос основан на свойствах устройства, а не на свойствах службы.

  ```
  {                           
      "filter": {                  
        "property": {                
          "name": "FirmwareVersion",   
          "type": "device"             
        },                           
        "value": "1.0",              
        "comparisonOperator": "eq",  
        "type": "comparison"         
      },                           
      "project": null,             
      "aggregate": null,           
      "sort": null                 
  }
  ```

## Задания устройства

Следующее понятие в управлении устройствами — это задание устройства, позволяющее координировать многоступенчатые взаимодействия сразу на нескольких устройствах.

В настоящее время в управлении устройствами Azure IoT Hub используются шесть типов заданий устройств (при необходимости мы предоставим клиентам дополнительные задания):

- **Обновление встроенного ПО**: обновляет встроенное ПО (или образ операционной системы) на физическом устройстве.
- **Перезагрузка**: перезагружает физическое устройство.
- **Сброс к параметрам по умолчанию**: восстанавливает встроенное ПО (или образ операционной системы) физического устройства к образу резервной копии заводских настроек, сохраненному на устройстве.
- **Обновление конфигурации**: настраивает агент клиента для центра IoT, запущенный на физическом устройстве.
- **Чтение свойства устройства**: возвращает последнее значение свойства устройства на физическом устройстве.
- **Запись свойства устройства:** изменяет свойство устройства на физическом устройстве.

Дополнительные сведения об использовании каждого из этих заданий см. в [документации по API для C# и node.js][lnk-apidocs].

Задание может выполняться сразу на нескольких устройствах. При запуске задания для каждого из этих устройств создается соответствующее дочернее задание. Дочернее задание выполняется на одном устройстве. Каждое дочернее задание содержит указатель на родительское задание. Родительское задание является только контейнером для дочерних заданий. Оно не реализует никакую логику для различения типов устройств (например, обновление Intel Edison или обновление Raspberry Pi). На следующей схеме показана связь между родительским заданием, его дочерними элементами и соответствующими физическими устройствами.

![][img-jobs]

Запрос истории заданий позволяет определить состояние запущенных заданий. Некоторые примеры запросов см. в [библиотеке запросов][lnk-query-samples].

## Реализация устройств

Теперь, когда мы рассмотрели основные понятия на стороне службы, рассмотрим создание устройства с функциями управления. Клиентская библиотека управления устройствами в центре IoT Azure на устройстве включает артефакты, необходимые для реализации взаимодействия между физическим устройством и центром IoT.

Клиентская библиотека управления устройствами в центре IoT Azure абстрагирует стандарт [LWM2M][lnk-lwm2m] и протокол запросов/ответов на основе CoAP. Таким образом, в библиотеке есть модель устройств для *объектов* и *определений ресурсов*:

-   Объекты описывают набор согласованных функциональных сущностей в системе, например устройство и обновления встроенного ПО.
-   Ресурсы описывают атрибуты или действия, включенные в эти объекты, например данные об уровне заряда аккумулятора и действие перезагрузки.

При использовании клиентской библиотеки управления устройствами в центре IoT Azure необходимо реализовать обратные вызовы для чтения, записи и выполнения операций для каждого ресурса на физическом устройстве. При изменении свойств библиотека асинхронно выполняет обновление центра IoT.

На представленной ниже схеме показаны различные компоненты, которые должны присутствовать в агенте клиента для центра IoT Azure.

![][img-client]

Дополнительные сведения о реализации на физическом устройстве см. в статье [Introducing the Azure IoT Hub device management client library for C][lnk-library-c] \(Знакомство с клиентской библиотекой управления устройствами в центре IoT Azure для C).

## Дальнейшие действия

Дополнительные сведения о возможностях управления устройствами центра IoT Azure можно просмотреть в руководствах:

- [Приступая к работе с функцией управления устройствами центра IoT Azure][lnk-get-started]

- [How to use the device twin][lnk-tutorial-twin] (Использование "двойника" устройства)

- [How to find device twins using queries][lnk-tutorial-queries] (Поиск "двойников" устройств с использованием запросов)

- [How to use device jobs to update device firmware][lnk-tutorial-jobs] (Использование заданий устройства для обновления встроенного ПО устройства)

<!-- Images and links -->
[img-twin]: media/iot-hub-device-management-overview/image1.png
[img-jobs]: media/iot-hub-device-management-overview/image2.png
[img-client]: media/iot-hub-device-management-overview/image3.png

[lnk-lwm2m]: http://technical.openmobilealliance.org/Technical/technical-information/release-program/current-releases/oma-lightweightm2m-v1-0
[lnk-library-c]: iot-hub-device-management-library.md
[lnk-get-started]: iot-hub-device-management-get-started.md
[lnk-tutorial-twin]: iot-hub-device-management-device-twin.md
[lnk-tutorial-queries]: iot-hub-device-management-device-query.md
[lnk-tutorial-jobs]: iot-hub-device-management-device-jobs.md
[lnk-apidocs]: http://azure.github.io/azure-iot-sdks/
[lnk-query-samples]: https://github.com/Azure/azure-iot-sdks/blob/dmpreview/doc/get_started/dm_queries/query-samples.md

<!---HONumber=AcomDC_0504_2016-->