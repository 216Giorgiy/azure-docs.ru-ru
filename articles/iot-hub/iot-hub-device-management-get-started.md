<properties
	pageTitle="Приступая к работе с функцией управления устройствами в центре IoT | Microsoft Azure"
	description="Начальное руководство по управлению устройствами в центре IoT Azure для языка C#. Используйте центр IoT Azure, язык C# и пакеты SDK для IoT Microsoft Azure, чтобы реализовать управление устройствами."
	services="iot-hub"
	documentationCenter=".net"
	authors="juanjperez"
	manager="timlt"
	editor=""/>

<tags
 ms.service="iot-hub"
 ms.devlang="dotnet"
 ms.topic="get-started-article"
 ms.tgt_pltfrm="na"
 ms.workload="na"
 ms.date="04/29/2016"
 ms.author="juanpere"/>

# Приступая к работе с функцией управления устройствами центра IoT Azure с использованием C# (предварительная версия)

[AZURE.INCLUDE [iot-hub-device-management-get-started-selector](../../includes/iot-hub-device-management-get-started-selector.md)]

## Введение
Чтобы приступить к управлению устройствами центра IoT Azure, необходимо создать такой центр, подготовить устройства к работе в нем, запустить несколько виртуальных устройств и просмотреть сведения о них в примере пользовательского интерфейса управления устройствами. Все эти шаги описаны в данном руководстве.

> [AZURE.NOTE]  Чтобы обеспечить возможность управления устройствами, необходимо создать центр IoT, даже если он у вас уже есть, так как ваш существующий центр не обладает этой возможностью. После того, как функция управления устройствами станет общедоступной, все существующие центры IoT будут обновлены для поддержки возможностей управления устройствами.

## Предварительные требования

В этом руководстве предполагается, что вы используете компьютер разработки под управлением Windows.

Чтобы выполнить приведенные здесь шаги, необходимо следующее:

- Microsoft Visual Studio 2015;

- Git

- CMake (версии 2.8 или более поздней). Это средство можно установить со страницы <https://cmake.org/download/>. Для ПК Windows используйте установщик Windows (MSI). Установите соответствующий флажок, чтобы добавить CMake в переменную PATH текущего пользователя;

- Node.js версии 6.1.0 или более поздней. Установите Node.js для своей платформы со страницы <https://nodejs.org/>.

- Активная подписка Azure. Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в разделе [Бесплатная пробная версия Azure][lnk-free-trial].

## Создание центра IoT с поддержкой управления устройствами

Для виртуальных устройств, к которым необходимо подключиться, следует создать центр IoT с поддержкой управления устройствами. Ниже показано, как это сделать с помощью портала Azure.

1.  Войдите на [портал Azure].
2.  На панели переходов последовательно выберите **Создать**, **Интернет вещей** и **Центр Azure IoT**.

	![][img-new-hub]

3.  В колонке **Центр IoT** выберите конфигурацию центра IoT.

	![][img-configure-hub]

  -   В поле **Имя** введите имя центра IoT. После проверки **имени** рядом с полем **Имя** появится зеленая галочка.
  -   Выберите **Цены и масштабирование уровня**. Для этого руководства задавать определенный уровень не нужно.
  -   **Группа ресурсов** — создайте новую группу ресурсов Azure или выберите существующую. За дополнительной информацией обратитесь к разделу [Использование групп ресурсов для управления вашими ресурсами Azure].
  -   Установите флажок **Enable Device Management** (Включить управление устройствами).
  -   В поле **Расположение** выберите расположение для размещения центра IoT. На этапе общедоступной предварительной версии функция управления устройствами в центре IoT доступна только в восточной части США, Северной Европе и Восточной Азии. В дальнейшем она будет доступна во всех регионах.

    > [AZURE.NOTE]  Если не установить флажок **Enable Device Management** (Включить управление устройствами), примеры не будут работать.

4.  Выбрав параметры конфигурации центра IoT, нажмите кнопку **Создать**. Создание центра IoT в Azure может занять несколько минут. Чтобы проверить состояние, следите за ходом выполнения на **начальной панели** или **панели уведомлений**.

	![][img-monitor]

5.  После создания центра IoT откройте соответствующую колонку, запишите **имя узла** и щелкните значок **Ключи**.

	![][img-keys]

6.  Выберите политику **iothubowner**, а затем скопируйте и запишите строку подключения в колонке **iothubowner**. Скопируйте ее в расположение, где ее можно будет просмотреть позже, так как она понадобится, чтобы завершить оставшуюся часть этого руководства.

 	> [AZURE.NOTE] Не используйте учетные данные **iothubowner** в рабочих сценариях.

	![][img-connection]

Теперь центр IoT с поддержкой управления устройствами создан. Чтобы завершить оставшуюся часть этого руководства, понадобится строка подключения.

## Создание примеров и подготовка устройств к работе в центре IoT

В этом разделе будет выполнен скрипт, который создает виртуальное устройство и примеры, а также подготавливает набор удостоверений новых устройств к работе в реестре устройств центра IoT. Устройство может подключиться к центру IoT, только если в реестре устройств есть соответствующая запись.

Чтобы создать примеры и подготовить устройства к работе в центре IoT, сделайте следующее:

1.  Откройте **командную строку разработчика для VS2015**.

2.  Клонируйте репозиторий GitHub. **Выполните эту операцию в каталоге, в имени которого нет пробелов.**

	  ```
	  git clone --recursive --branch dmpreview https://github.com/Azure/azure-iot-sdks.git
	  ```

3.  В корневой папке, куда клонирован репозиторий **azure-iot-sdks**, перейдите в папку **\\azure-iot-sdks\\csharp\\service\\samples** и выполните сценарий, заменив значение заполнителя своей строкой подключения из предыдущего раздела.

	  ```
	  setup.bat <IoT Hub Connection String>
	  ```

Скрипт выполняет следующее:

1.  Запускает **cmake**, чтобы создать решение Visual Studio 2015 для виртуального устройства. Файл этого проекта — **azure-iot-sdks\\csharp\\service\\samples\\cmake\\iotdm\_client\\samples\\iotdm\_simple\_sample\\iotdm\_simple\_sample.vcxproj**. Обратите внимание, что исходные файлы находятся в папке **azure-iot-sdks\\c\\iotdm\_client\\samples\\iotdm\_simple\_sample**.

2.  Создает проект виртуального устройства **iotdm\_simple\_sample.vcxproj**.

3.  Создает примеры управления устройствами **azure-iot-sdks\\csharp\\service\\samples\\GetStartedWithIoTDM\\GetStartedWithIoTDM.sln**.

4.  Выполняет файл **GenerateDevices.exe**, чтобы подготовить удостоверения устройств к работе в центре IoT. Устройства описаны в файле **sampledevices.json** (в папке **azure-iot-sdks\\node\\service\\samples**). После подготовки устройств к работе учетные данные сохраняются в файле **devicecreds.txt** (в папке **azure-iot-sdks\\csharp\\service\\samples\\bin**).

## Запуск виртуальных устройств

После добавления устройств в реестр устройств можно запустить виртуальные управляемые устройства. Для каждого удостоверения устройства, подготовленного к работе в центре IoT Azure, запускается одно виртуальное устройство.

В командной строке разработчика в папке **\\azure-iot-sdks\\csharp\\service\\samples\\bin** введите следующее:

  ```
  simulate.bat
  ```

Этот сценарий запускает по одному экземпляру файла **iotdm\_simple\_sample.exe** для каждого устройства, указанного в файле **devicecreds.txt**. Виртуальное устройство будет работать, пока командное окно не будет закрыто.

Пример приложения **iotdm\_simple\_sample** создается с использованием клиентской библиотеки управления устройствами центра IoT Azure для C, позволяющей создавать устройства IoT, которыми можно управлять в центре IoT Azure. С помощью этой библиотеки изготовители устройств могут предоставлять сведения о свойствах устройства и реализовывать выполнимые действия, необходимые для заданий устройства. Эта библиотека поставляется в составе пакетов SDK с открытым кодом для центра IoT Azure.

При выполнении **simulate.bat** в окне вывода появляется поток данных. Здесь отображается входящий и исходящий трафик, а также инструкции **printf** в функциях обратного вызова приложения. Таким образом вы можете следить за входящим и исходящим трафиком, а также за тем, как пример приложения обрабатывает декодированные пакеты. При подключении устройства к центру IoT служба автоматически начинает отслеживать ресурсы на устройстве. Затем клиентская библиотека DM центра IoT осуществляет обратные вызовы устройства, чтобы получить из него последние значения.

Ниже приведен снимок экрана с выходными данными примера приложения **iotdm\_simple\_sample**. Вверху отображается сообщение **REGISTERED**, а также сведения о подключении устройства с идентификатором **Device11-7ce4a850** к центру IoT.

> [AZURE.NOTE]  Чтобы получить менее подробный вывод, создайте и запустите розничную конфигурацию.

![][img-output]

Не выключайте виртуальные устройства, чтобы завершить выполнение оставшейся части этого руководства.

## Выполнение примера пользовательского интерфейса управления устройствами

После подготовки центра IoT, регистрации и запуска нескольких виртуальных устройств для управления вы можете развернуть пример пользовательского интерфейса управления устройствами. В примере пользовательского интерфейса управления устройствами приводится рабочий пример использования API-интерфейсов управления устройствами, чтобы создать интерактивный пользовательский интерфейс. Дополнительные сведения о примере пользовательского интерфейса управления устройствами, включая [известные проблемы](https://github.com/Azure/azure-iot-device-management#knownissues), см. в репозитории GitHub [пользовательского интерфейса управления устройствами центра IoT Azure][lnk-dm-github].

Чтобы получить, создать и выполнить пример пользовательского интерфейса управления устройствами, сделайте следующее:

1. Откройте **окно командой строки**.

2. Установите Node.js версии 6.1.0 или более поздней в соответствии с предварительными требованиями. Для этого введите `node --version`.

3. Клонируйте репозиторий GitHub пользовательского интерфейса управления устройствами центра IoT Azure, выполнив следующую команду:

	```
	git clone https://github.com/Azure/azure-iot-device-management.git
	```
	
4. Чтобы получить зависимые пакеты, в корневой папке, куда клонирована копия репозитория пользовательского интерфейса управления устройствами центра IoT Azure, выполните следующую команду:

	```
	npm install
	```

5. После завершения команды npm install выполните следующую команду, чтобы создать код.

	```
	npm run build
	```

6. Используйте текстовый редактор, чтобы открыть файл user-config.json в корне клонированной папки. Замените текст &lt;YOUR CONNECTION STRING HERE&gt; на строку подключения центра IoT из предыдущего раздела и сохраните файл.

7. Чтобы запустить пользовательское приложение управления устройствами, в командной строке выполните следующую команду:

	```
	npm run start
	```

8. Когда в командной строке появится сообщение "Службы запущены", откройте браузер (сейчас поддерживаются Edge, IE 11 и более поздней версии, Safari и Chrome) и перейдите к приложению управления устройствами по URL-адресу <http://127.0.0.1:3003>, чтобы просмотреть виртуальные устройства.

	![][img-dm-ui]

Не выключайте виртуальные устройства и приложение управления устройствами, так как они потребуются при изучении следующего руководства по управлению устройствами.


## Дальнейшие действия

Чтобы продолжить знакомство с центром IoT, см. статью [Пакет SDK для шлюза IoT (бета-версия): начало работы с Linux][lnk-gateway-SDK].

Чтобы узнать больше о функциях управления устройствами центра IoT Azure, см. руководство [Обзор управления устройствами центра IoT с помощью примера пользовательского интерфейса][lnk-sample-ui].

<!-- images and links -->
[img-new-hub]: media/iot-hub-device-management-get-started/image1.png
[img-configure-hub]: media/iot-hub-device-management-get-started/image2.png
[img-monitor]: media/iot-hub-device-management-get-started/image3.png
[img-keys]: media/iot-hub-device-management-get-started/image4.png
[img-connection]: media/iot-hub-device-management-get-started/image5.png
[img-output]: media/iot-hub-device-management-get-started/image6.png
[img-dm-ui]: media/iot-hub-device-management-get-started/dmui.png

[lnk-free-trial]: http://azure.microsoft.com/pricing/free-trial/
[портал Azure]: https://portal.azure.com/
[Использование групп ресурсов для управления вашими ресурсами Azure]: ../azure-portal/resource-group-portal.md
[lnk-dm-github]: https://github.com/Azure/azure-iot-device-management
[lnk-sample-ui]: iot-hub-device-management-ui-sample.md
[lnk-gateway-SDK]: iot-hub-linux-gateway-sdk-get-started.md

<!---HONumber=AcomDC_0720_2016-->