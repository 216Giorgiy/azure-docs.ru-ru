<properties
	pageTitle="Приступая к работе с функцией управления устройствами в центре IoT | Microsoft Azure"
	description="Начальное руководство по управлению устройствами в центре IoT Azure для языка C#. Используйте центр IoT Azure, язык C# и пакеты SDK для IoT Microsoft Azure, чтобы реализовать управление устройствами."
	services="iot-hub"
	documentationCenter=".net"
	authors="ellenfosborne"
	manager="timlt"
	editor=""/>

<tags
 ms.service="iot-hub"
 ms.devlang="dotnet"
 ms.topic="hero-article"
 ms.tgt_pltfrm="na"
 ms.workload="na"
 ms.date="04/29/2016"
 ms.author="elfarber"/>

# Приступая к работе с функцией управления устройствами центра IoT Azure (предварительная версия)

## Введение
Чтобы приступить к управлению устройствами центра IoT Azure, необходимо создать такой центр, подготовить устройства к работе в нем и запустить несколько виртуальных устройств. Все эти шаги описаны в данном руководстве.

> [AZURE.NOTE]  Чтобы обеспечить возможность управления устройствами, необходимо создать центр IoT, даже если он у вас уже есть, так как ваш существующий центр не обладает этой возможностью. После того, как функция управления устройствами станет общедоступной, все существующие центры IoT будут обновлены для поддержки возможностей управления устройствами.

## Предварительные требования

Чтобы выполнить приведенные здесь шаги, необходимо следующее:

- Microsoft Visual Studio 2015;
- Git
- CMake (версии 2.8 или более поздней). Это средство можно установить со страницы <https://cmake.org/download/>. Для ПК Windows используйте установщик Windows (MSI). Установите соответствующий флажок, чтобы добавить CMake в переменную PATH текущего пользователя;
- Активная подписка Azure.

	Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в разделе [Бесплатная пробная версия Azure][lnk-free-trial].

## Создание центра IoT с поддержкой управления устройствами

Для виртуальных устройств, к которым необходимо подключиться, следует создать центр IoT с поддержкой управления устройствами. Ниже показано, как это сделать с помощью портала Azure.

1.  Войдите на [портал Azure].
2.  На панели переходов последовательно выберите **Создать**, **Интернет вещей** и **Центр Azure IoT**.

	![][img-new-hub]

3.  В колонке **Центр IoT** выберите конфигурацию для центра IoT.

	![][img-configure-hub]

  -   В поле **Имя** введите имя центра IoT. После проверки **имени** рядом с полем **Имя** появится зеленая галочка.
  -   Выберите **Цены и масштабирование уровня**. Для этого руководства задавать определенный уровень не нужно.
  -   **Группа ресурсов** — создайте новую группу ресурсов Azure или выберите существующую. За дополнительной информацией обратитесь к разделу [Использование групп ресурсов для управления вашими ресурсами Azure].
  -   Установите флажок **Enable Device Management** (Включить управление устройствами).
  -   В поле **Расположение** выберите расположение для размещения центра IoT. Функция управления устройствами в центре IoT доступна только в восточной части США, Северной Европе и Восточной Азии.

4.  Выбрав параметры конфигурации центра IoT, нажмите кнопку **Создать**. Создание центра IoT в Azure может занять несколько минут. Вы можете следить за ходом выполнения на **начальной панели** или **панели уведомлений**, где будет отображаться состояние.

	![][img-monitor]

5.  После создания центра IoT откройте соответствующую колонку, запишите **имя узла** и щелкните значок **Ключи**.

	![][img-keys]

6.  Выберите политику **iothubowner**, а затем скопируйте и запишите строку подключения в колонке **iothubowner**. Скопируйте ее в расположение, где ее можно будет просмотреть позже, так как она понадобится, чтобы завершить оставшуюся часть этого руководства.

 	> [AZURE.NOTE] Не используйте учетные данные **iothubowner** в рабочих сценариях.

	![][img-connection]

Теперь центр IoT с поддержкой управления устройствами создан. Чтобы завершить оставшуюся часть этого руководства, понадобится строка подключения.

## Создание примеров и подготовка устройств к работе в центре IoT

В этом разделе будет выполнен скрипт, который создает виртуальное устройство и примеры, а также подготавливает набор удостоверений новых устройств к работе в реестре устройств центра IoT. Устройство может подключиться к центру IoT, только если в реестре устройств есть соответствующая запись.

Чтобы создать примеры и подготовить устройства к работе в центре IoT, сделайте следующее:

1.  Откройте **командную строку разработчика для VS2015**.

2.  Клонируйте репозиторий GitHub. **Выполните эту операцию в каталоге, в имени которого нет пробелов.**

  ```
  git clone --recursive --branch dmpreview https://github.com/Azure/azure-iot-sdks.git
  ```

3.  Из корневой папки, куда клонирован репозиторий **azure-iot-sdks**, перейдите в папку **\\azure-iot-sdks\\csharp\\service\\samples** и выполните скрипт, заменив значение заполнителя своей строкой подключения из предыдущего раздела:

  ```
  setup.bat <IoT Hub Connection String>
  ```

Скрипт выполняет следующее:

1.  Запускает **cmake**, чтобы создать решение Visual Studio 2015 для виртуального устройства. Файл этого проекта — **azure-iot-sdks\\csharp\\service\\samples\\cmake\\iotdm\_client\\samples\\iotdm\_simple\_sample\\iotdm\_simple\_sample.vcxproj**. Обратите внимание, что исходные файлы находятся в папке **azure iot-sdks\\c\\iotdm\_client\\samples\\iotdm\_simple\_sample**.

2.  Создает проект виртуального устройства **iotdm\_simple\_sample.vcxproj**.

3.  Создает примеры управления устройствами **azure-iot-sdks\\csharp\\service\\samples\\GetStartedWithIoTDM\\GetStartedWithIoTDM.sln**.

4.  Выполняет файл **GenerateDevices.exe**, чтобы подготовить удостоверения устройств к работе в центре IoT. Устройства описаны в файле **sampledevices.json** (в папке **azure iot-sdks\\node\\service\\samples**). После подготовки устройств к работе учетные данные сохраняются в файле **devicecreds.txt** (в папке **azure iot-sdks\\csharp\\service\\samples\\bin**).

## Запуск виртуальных устройств

После добавления устройств в реестр устройств можно запустить виртуальные управляемые устройства. Для каждого удостоверения устройства, подготовленного к работе в центре IoT Azure, запускается одно виртуальное устройство.

В командной строке разработчика в папке **\\azure-iot-sdks\\csharp\\service\\samples\\bin** введите следующее:

  ```
  simulate.bat
  ```

Этот скрипт запускает по одному экземпляру файла **iotdm\_simple\_sample.exe** для каждого устройства, указанного в файле **devicecreds.txt**. Виртуальное устройство будет работать, пока командное окно не будет закрыто.

Пример приложения **iotdm\_simple\_sample** создается с использованием клиентской библиотеки управления устройствами центра IoT Azure для C, позволяющей создавать устройства IoT, которыми можно управлять в центре IoT Azure. С помощью этой библиотеки изготовители устройств могут предоставлять сведения о свойствах устройства и реализовывать выполнимые действия, необходимые для заданий устройства. Эта библиотека поставляется в составе пакетов SDK с открытым кодом для центра IoT Azure.

При выполнении **simulate.bat** в окне вывода появляется поток данных. Здесь отображается входящий и исходящий трафик, а также операторы **printf** в функциях обратного вызова приложения. Таким образом вы можете следить за входящим и исходящим трафиком, а также за тем, как пример приложения обрабатывает декодированные пакеты. При подключении устройства к центру IoT служба автоматически начинает отслеживать ресурсы на устройстве. Затем клиентская библиотека DM центра IoT осуществляет обратные вызовы устройства, чтобы получить из него последние значения.

Ниже приведен снимок экрана с выходными данными примера приложения **iotdm\_simple\_sample**. Вверху отображается сообщение **REGISTERED**, а также сведения о подключении устройства с идентификатором **Device11-7ce4a850** к центру IoT.

> [AZURE.NOTE]  Чтобы получить менее подробный вывод, создайте и запустите розничную конфигурацию.

![][img-output]

Не выключайте виртуальные устройства, работая с руководствами в разделе "Дальнейшие действия".

## Дальнейшие действия

Дополнительные сведения о возможностях управления устройствами центра IoT Azure можно просмотреть в руководствах:

- [How to use the device twin][lnk-tutorial-twin] \(Использование "двойника" устройства)

- [How to find device twins using queries][lnk-tutorial-queries] \(Поиск "двойников" устройств с использованием запросов)

- [Учебник по использованию заданий устройства для обновления встроенного ПО устройства (предварительная версия)][lnk-tutorial-jobs]

<!-- images and links -->
[img-new-hub]: media/iot-hub-device-management-get-started/image1.png
[img-configure-hub]: media/iot-hub-device-management-get-started/image2.png
[img-monitor]: media/iot-hub-device-management-get-started/image3.png
[img-keys]: media/iot-hub-device-management-get-started/image4.png
[img-connection]: media/iot-hub-device-management-get-started/image5.png
[img-output]: media/iot-hub-device-management-get-started/image6.png

[lnk-free-trial]: http://azure.microsoft.com/pricing/free-trial/
[портал Azure]: https://portal.azure.com/
[Использование групп ресурсов для управления вашими ресурсами Azure]: ../azure-portal/resource-group-portal.md
[lnk-tutorial-twin]: iot-hub-device-management-device-twin.md
[lnk-tutorial-queries]: iot-hub-device-management-device-query.md
[lnk-tutorial-jobs]: iot-hub-device-management-device-jobs.md

<!---HONumber=AcomDC_0504_2016-->