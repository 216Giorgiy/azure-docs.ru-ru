---
title: "Общие сведения о прямых методах Центра Интернета вещей Azure | Документация Майкрософт"
description: "Руководство разработчика. Использование прямых методов для вызова кода на устройствах из приложения-службы."
services: iot-hub
documentationcenter: .net
author: nberdy
manager: timlt
editor: 
ms.assetid: 9f0535f1-02e6-467a-9fc4-c0950702102d
ms.service: iot-hub
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 01/11/2017
ms.author: nberdy
ms.custom: H1Hack27Feb2017
translationtype: Human Translation
ms.sourcegitcommit: 8a531f70f0d9e173d6ea9fb72b9c997f73c23244
ms.openlocfilehash: ce7860e291c71e825561caf3ee7eafe904101799
ms.lasthandoff: 03/10/2017


---
# <a name="understand-and-invoke-direct-methods-from-iot-hub"></a>Общие сведения о прямых методах и информация о вызове этих методов из Центра Интернета вещей
## <a name="overview"></a>Обзор
Центр Интернета вещей дает возможность вызова прямых методов на устройствах из облака. Прямые методы представляют собой взаимодействие типа "запрос — ответ" с устройством, подобное вызову HTTP тем, что об успешном завершении или сбое становится известно немедленно (после указанного пользователем времени ожидания). Это используется в сценариях, где действия, выполняемые немедленно, отличаются в зависимости от возможности ответа устройства, например отправка SMS для пробуждения устройства, работающего в автономном режиме (при этом отправка SMS обходится дороже, чем вызов метода).

Каждый метод устройства предназначен для одного устройства. [Задания][lnk-devguide-jobs] предоставляют способ вызова прямых методов на нескольких устройствах и планирование вызванных методов для отключенных устройств.

Любой пользователь с разрешениями на **подключение службы** в Центре Интернета вещей может вызвать метод на устройстве.

### <a name="when-to-use"></a>Сценарии использования
Прямые методы следуют шаблону "запрос — ответ" и предназначены для обмена данными, требующего немедленного подтверждения результата, как правило, для интерактивного управления устройством, например включение вентилятора.

Чтобы принять решение об использовании требуемых свойств, прямых методов или сообщений, отправляемых из облака на устройство, см. сведения в [руководстве по обмену данными между облаком и устройством][lnk-c2d-guidance].

## <a name="method-lifecycle"></a>Жизненный цикл метода
Прямые методы реализуются на устройстве. Чтобы процесс создания экземпляра прошел удачно, может потребоваться указать входные данные в полезных данных метода или не указывать их. Вызов прямого метода осуществляется через обращенный к службе URI (`{iot hub}/twins/{device id}/methods/`). Устройство получает прямые методы через раздел MQTT для устройства (`$iothub/methods/POST/{method name}/`). В будущем, возможно, будет реализована поддержка прямых методов в дополнительных сетевых протоколах на стороне устройства.

> [!NOTE]
> При вызове прямого метода на устройстве имена и значения свойств могут содержать только печатаемые буквенно-цифровые знаки US-ASCII, кроме любого из следующих: ``{'$', '(', ')', '<', '>', '@', ',', ';', ':', '\', '"', '/', '[', ']', '?', '=', '{', '}', SP, HT}``.
> 
> 

Прямые методы синхронные, и после истечения времени ожидания (значение по умолчанию — 30 секунд, которое можно увеличить до 3600 секунд) они либо выполняются успешно, либо завершаются с ошибкой. Они полезны в интерактивных сценариях, когда нужно, чтобы устройство отвечало, только если оно находится в сети и принимает команды, такие как включение света с помощью телефона. В этих случаях об успешном или неудачном выполнении нужно узнавать немедленно, чтобы облачная служба смогла как можно быстрее отреагировать с учетом результата. В результате выполнения метода устройство может возвратить некоторый текст сообщения. Однако это действие не является обязательным для метода. Упорядочивание или обеспечение какой-либо семантики параллелизма при вызове метода не гарантировано.

При вызове прямого метода со стороны облака используется только протокол HTTP, а при вызове со стороны устройства — только протокол MQTT.

Полезными данными для запросов и ответов метода является документ JSON объемом не более 8 КБ.

## <a name="reference-topics"></a>Справочные материалы
Далее предоставлены дополнительные сведения об использовании прямых методов.

## <a name="invoke-a-direct-method-from-a-back-end-app"></a>Вызов прямого метода из серверного приложения
### <a name="method-invocation"></a>Вызов метода
Вызов прямого метода на устройстве является вызовом HTTP, включающим следующие элементы:

* *URI* конкретного устройства (`{iot hub}/twins/{device id}/methods/`);
* *метод* POST;
* *заголовки*, содержащие сведения об авторизации, идентификатор запроса, тип и кодировку содержимого;
* прозрачный *текст* JSON в следующем формате:

```
{
    "methodName": "reboot",
    "responseTimeoutInSeconds": 200,
    "payload": {
        "input1": "someInput",
        "input2": "anotherInput"
    }
}
```

Время ожидания измеряется в секундах. Если время ожидания не указано, то используется значение по умолчанию (30 секунд).

### <a name="response"></a>Ответ
Внутреннее приложение получает ответ, включающий в себя следующие элементы:

* *код состояния HTTP*, который используется для ошибок, поступающих из Центра Интернета вещей, включая ошибку 404 для неподключенных устройств;
* *заголовки*, которые содержат тег Etag, идентификатор запроса, тип и кодировку содержимого;
* *текст* JSON в следующем формате:

```
{
    "status" : 201,
    "payload" : {...}
}
```

   Значения `status` и `body` предоставляются устройством и используются для ответа, который содержит код состояния устройства и/или описание.

## <a name="handle-a-direct-method-on-a-device"></a>Обработка прямого метода на устройстве
### <a name="method-invocation"></a>Вызов метода
Устройства получают запросы на прямой метод в разделе MQTT: `$iothub/methods/POST/{method name}/?$rid={request id}`.

Устройство получает текст следующего формата:

```
{
    "input1": "someInput",
    "input2": "anotherInput"
}
```

Запросы метода имеют нулевой уровень качества обслуживания.

### <a name="response"></a>Ответ
Устройство отправляет ответы в `$iothub/methods/res/{status}/?$rid={request id}`, где:

* свойство `status` — это состояние выполнения метода, которое поддерживает устройство;
* свойство `$rid` — это идентификатор запроса из вызова метода, полученного от Центра Интернета вещей.

Текст задает устройство. Он может находиться в любом состоянии.

## <a name="additional-reference-material"></a>Дополнительные справочные материалы
Другие справочные статьи в руководстве разработчика для Центра Интернета вещей:

* Статья [IoT Hub endpoints][lnk-endpoints] (Конечные точки Центра Интернета вещей) содержит сведения о конечных точках, которые каждый Центр Интернета вещей предоставляет для операций управления и среды выполнения.
* Статья [Throttling and quotas][lnk-quotas] (Регулирование и квоты) содержит сведения о квотах, применимых к службе Центра Интернета вещей, и ожидаемом поведении регулирования при использовании службы.
* В статье [Azure IoT device and service SDKs][lnk-sdks] (Пакеты SDK для устройств и служб Azure IoT) указаны различные языковые пакеты SDK, которые можно использовать при разработке приложений для устройств и служб, взаимодействующих с Центром Интернета вещей.
* В статье [Справочник по языку запросов для двойников и заданий][lnk-query] описывается язык запросов, который можно использовать для получения сведений о двойниках устройств и заданиях из Центра Интернета вещей.
* Статья [Поддержка MQTT в центре IoT][lnk-devguide-mqtt] содержит дополнительные сведения о поддержке протокола MQTT в Центре Интернета вещей.

## <a name="next-steps"></a>Дальнейшие действия
Теперь, когда вы узнали, как использовать прямые методы, вас может заинтересовать следующая статья в руководстве разработчика для Центра Интернета вещей:

* [Планирование заданий на нескольких устройствах (предварительная версия)][lnk-devguide-jobs]

Если вы хотели бы применить на практике некоторые основные понятия, описанные в этой статье, можно просмотреть следующее руководство по Центру Интернета вещей:

* [Use direct methods (Node)][lnk-methods-tutorial] (Использование прямых методов (Node))

<!-- links and images -->

[lnk-endpoints]: iot-hub-devguide-endpoints.md
[lnk-quotas]: iot-hub-devguide-quotas-throttling.md
[lnk-sdks]: iot-hub-devguide-sdks.md
[lnk-query]: iot-hub-devguide-query-language.md
[lnk-devguide-mqtt]: iot-hub-mqtt-support.md

[lnk-devguide-jobs]: iot-hub-devguide-jobs.md
[lnk-methods-tutorial]: iot-hub-node-node-direct-methods.md
[lnk-devguide-messages]: iot-hub-devguide-messaging.md
[lnk-c2d-guidance]: iot-hub-devguide-c2d-guidance.md

