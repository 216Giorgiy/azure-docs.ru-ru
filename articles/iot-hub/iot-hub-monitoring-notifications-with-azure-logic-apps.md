---
title: Удаленный мониторинг и отправка уведомлений в Центре Интернета вещей с помощью Azure Logic Apps | Документация Майкрософт
description: Azure Logic Apps можно использовать для мониторинга температуры в Центре Интернета вещей и автоматической отправки уведомлений на электронную почту в случае обнаружения аномалий.
author: robinsh
keywords: мониторинг Центра Интернета вещей, уведомления Центра Интернета вещей, мониторинг температуры в Центре Интернета вещей
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.tgt_pltfrm: arduino
ms.date: 04/11/2018
ms.author: robinsh
ms.openlocfilehash: 5d5b1d1579600767153fcf5ad751e1224631d611
ms.sourcegitcommit: 62d3a040280e83946d1a9548f352da83ef852085
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2019
ms.locfileid: "59262522"
---
# <a name="iot-remote-monitoring-and-notifications-with-azure-logic-apps-connecting-your-iot-hub-and-mailbox"></a>Удаленный мониторинг и отправка уведомлений в Центре Интернета вещей с помощью службы Azure Logic Apps, обеспечивающей подключение между Центром Интернета вещей и почтовым ящиком

![Комплексная схема](media/iot-hub-monitoring-notifications-with-azure-logic-apps/iot-hub-e2e-logic-apps.png)

[!INCLUDE [iot-hub-get-started-note](../../includes/iot-hub-get-started-note.md)]

Azure Logic Apps позволяет автоматизировать процессы в виде последовательности действий. Приложение логики поддерживает подключение к различным службам по различным протоколам. Сначала в нем срабатывает триггер, например "При добавлении учетной записи", а затем выполняется набор действий, например "отправка push-уведомления". Благодаря этой функции Logic Apps, помимо прочего, идеально подходит для мониторинга Центра Интернета вещей, например оповещения об аномалиях.

## <a name="what-you-learn"></a>Что вы узнаете

Вы научитесь создавать приложение логики, обеспечивающее подключение между Центром Интернета вещей и почтовым ящиком для мониторинга температуры и отправки уведомлений. Когда температура превышает 30 °C, клиентское приложение добавляет отметку `temperatureAlert = "true"` в сообщение, которое оно отправляет в Центр Интернета вещей. Сообщение активирует отправку приложением логики уведомления по электронной почте.

## <a name="what-you-do"></a>Что нужно сделать

* Создадим пространство имен служебной шины и добавим в него очередь.
* Добавим конечную точку и правило маршрутизации в Центр Интернета вещей.
* Создадим, настроим и протестируем приложение логики.

## <a name="what-you-need"></a>Необходимые элементы

* Изучите руководство [Настройка вашего устройства](iot-hub-raspberry-pi-kit-node-get-started.md), где описаны следующие требования.

  * Активная подписка Azure.
  * Центр Интернета вещей Azure в подписке;
  * клиентское приложение, которое отправляет сообщения в Центр Интернета вещей Azure.

## <a name="create-service-bus-namespace-and-add-a-queue-to-it"></a>Создание пространства имен служебной шины и добавление в него очереди

### <a name="create-a-service-bus-namespace"></a>Создание пространства имен служебной шины

1. На [портала Azure](https://portal.azure.com/)выберите **создать ресурс** > **интеграция с предприятием** > **служебной шины**.

2. Введите следующие сведения:

   **Имя.** Имя служебной шины.

   **Ценовая категория**. Выберите **основные** > **выберите**. Базового уровня для данного учебника достаточно.

   **Группа ресурсов.** Выберите ту же группу ресурсов, которую использует центр Интернета вещей.

   **Расположение.** Используйте то же расположение, которое использует Центр Интернета вещей.

3. Нажмите кнопку **Создать**.

   ![Создание пространства имен служебной шины с помощью портала Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/1_create-service-bus-namespace-azure-portal.png)

### <a name="add-a-service-bus-queue"></a>Добавление очереди служебной шины

1. Откройте пространство имен служебной шины, а затем выберите **+ очередь**.

1. Введите имя для очереди, а затем выберите **создать**.

1. Откройте очередь служебной шины, а затем выберите **политики общего доступа** > **+ добавить**.

1. Введите имя для политики, установите флажок **управление**, а затем выберите **создать**.

   ![Добавление очереди служебной шины на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/2_add-service-bus-queue-azure-portal.png)

## <a name="add-an-endpoint-and-a-routing-query-to-your-iot-hub"></a>Добавить конечную точку и маршрутизации запросов к центру Интернета вещей

Добавьте конечную точку и маршрутизации запросов к центру Интернета вещей.

### <a name="add-an-endpoint"></a>Добавление конечной точки

1. Откройте центр Интернета вещей, выберите **конечные точки** > **+ добавить**.

1. Введите следующие сведения:

   **Имя.** Имя конечной точки.

   **Тип конечной точки**: Выберите **Очередь служебной шины**.

   **Пространство имен служебной шины**: Выберите созданное пространство имен.

   **Очередь служебной шины.** Выберите созданную очередь.

3. Нажмите кнопку **ОК**.

   ![Добавление конечной точки в Центр Интернета вещей на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/3_add-iot-hub-endpoint-azure-portal.png)

### <a name="add-a-routing-rule"></a>Добавление правила маршрутизации

1. В центре Интернета вещей, выберите **маршруты** > **+ добавить**.

2. Введите следующие сведения:

   **Имя.** Имя правила маршрутизации.

   **Источник данных**: Выберите **DeviceMessages**.

   **Конечная точка**. Выберите конечную точку, в которой вы создали.

   **Строка запроса:** Укажите `temperatureAlert = "true"`.

3. Щелкните **Сохранить**.

   ![Добавление правила маршрутизации на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/4_add-routing-rule-azure-portal.png)

## <a name="create-and-configure-a-logic-app"></a>Создание и настройка приложения логики

Затем создайте и настройте приложение логики.

### <a name="create-a-logic-app"></a>Создайте приложение логики

1. В [портала Azure](https://portal.azure.com/)выберите **создать ресурс** > **интеграция с предприятием** > **приложение логики**.

2. Введите следующие сведения:

   **Имя.** Имя приложения логики.

   **Группа ресурсов.** Выберите ту же группу ресурсов, которую использует центр Интернета вещей.

   **Расположение.** Используйте то же расположение, которое использует Центр Интернета вещей.

3. Нажмите кнопку **Создать**.

### <a name="configure-the-logic-app"></a>Настройка приложения логики

1. Откройте приложение логики в конструкторе Logic Apps.

2. В конструкторе приложений логики, выберите **пустое приложение логики**.

   ![Начало работы с пустым приложением логики на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/5_start-with-blank-logic-app-azure-portal.png)

3. Выберите **служебную шину**.

   ![Выбор служебной шины для начала создания приложения логики на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/6_select-service-bus-when-creating-blank-logic-app-azure-portal.png)

4. Выберите **служебная шина — когда одно или несколько сообщений поступает в очередь (автозавершение)**.

5. Создайте подключение к служебной шине.

   1. Введите имя подключения.

   2. Выберите пространство имен служебной шины > Политика служебной шины > **создать**.

      ![Создание подключения к служебной шине для приложения логики на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/7_create-service-bus-connection-in-logic-app-azure-portal.png)

   3. Выберите **Продолжить** после создания подключения к служебной шине.

   4. Выберите созданную очередь и введите `175` для **максимальное число сообщений**.

      ![Установка максимального числа сообщений для подключения к служебной шине в приложении логики](media/iot-hub-monitoring-notifications-with-azure-logic-apps/8_specify-maximum-message-count-for-service-bus-connection-logic-app-azure-portal.png)

   5. Выберите «Сохранить», чтобы сохранить изменения.

6. Создайте подключение к службе SMTP.

   1. Выберите **New step** (Новый шаг) > **Добавить действие**.

   2. Тип `SMTP`выберите **SMTP** службы в результатах поиска, а затем выберите **SMTP — отправка электронной почты**.

      ![Создание подключения к службе SMTP в приложении логики на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/9_create-smtp-connection-logic-app-azure-portal.png)

   3. Указать параметры SMTP почтового ящика, а затем выберите **создать**.

      ![Ввод сведений о подключении к службе SMTP в приложении логики на портале Azure](media/iot-hub-monitoring-notifications-with-azure-logic-apps/10_enter-smtp-connection-info-logic-app-azure-portal.png)

      Получение сведений об SMTP для [Hotmail/Outlook.com](https://support.office.com/article/Add-your-Outlook-com-account-to-another-mail-app-73f3b178-0009-41ae-aab1-87b80fa94970), [Gmail](https://support.google.com/a/answer/176600?hl=en) и [Yahoo Mail](https://help.yahoo.com/kb/SLN4075.html).

   4. Введите адрес электронной почты в полях **От** и **Кому** и укажите `High temperature detected` в **теме** и **тексте сообщения**.

   5. Щелкните **Сохранить**.

При сохранении приложения логика находится в рабочем состоянии.

## <a name="test-the-logic-app"></a>Тестирование приложения логики

1. Запустите клиентское приложение, развертываемое на устройстве, как описано в статье [Подключение Adafruit Feather HUZZAH ESP8266 к Центру Интернета вещей Azure в облаке](iot-hub-arduino-huzzah-esp8266-get-started.md).

2. Увеличьте температуру среды вокруг устройства SensorTag до отметки свыше 30 °C, например зажгите рядом с ним свечу.

3. Вы должны получить уведомление по электронной почте, отправленное приложением логики.

   > [!NOTE]
   > Возможно, поставщику услуг электронной почты потребуется проверить подлинность отправителя и убедиться, что именно вы отправили это сообщение.

## <a name="next-steps"></a>Дальнейшие действия

Вы успешно создали приложение логики, обеспечивающее подключение между Центром Интернета вещей и почтовым ящиком для мониторинга температуры и отправки уведомлений.

[!INCLUDE [iot-hub-get-started-next-steps](../../includes/iot-hub-get-started-next-steps.md)]
