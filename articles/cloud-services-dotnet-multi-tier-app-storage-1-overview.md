<properties linkid="develop-net-tutorials-multi-tier-web-site-1-overview" pageTitle="Azure Cloud Service Tutorial: ASP.NET MVC Web Role, Worker Role, Azure Storage Tables, Queues, and Blobs" metaKeywords="Azure tutorial, Azure storage tutorial, Azure multi-tier tutorial, MVC Web Role tutorial, Azure worker role tutorial, Azure blobs tutorial, Azure tables tutorial, Azure queues tutorial" description="Learn how to create a multi-tier app using ASP.NET MVC and Azure. The app runs in a cloud service, with web role and worker roles, and uses Azure storage tables, queues, and blobs." metaCanonical="" services="cloud-services,storage" documentationCenter=".NET" title="Azure Cloud Service Tutorial: ASP.NET MVC Web Role, Worker Role, Azure Storage Tables, Queues, and Blobs" authors="tdykstra,riande" solutions="" manager="wpickett" editor="mollybos" />

<tags ms.service="cloud-services" ms.workload="web" ms.tgt_pltfrm="na" ms.devlang="dotnet" ms.topic="article" ms.date="01/01/1900" ms.author="tdykstra,riande"></tags>

# Учебник по облачной службе Azure: веб-роль ASP.NET MVC, рабочая роль, а также таблицы, очереди и большие двоичные объекты службы хранилища Azure — 1 из 5

В этой серии учебников показано, как создать и развернуть многоуровневое веб-приложение ASP.NET MVC, запускаемое в облачной службе Azure и использующее таблицы, очереди и большие двоичные объекты службы хранилища Azure. Можно скачать [готовое приложение][готовое приложение] из коллекции кодов MSDN или [электронную книгу][электронную книгу] более ранней версии из коллекции электронных книг TechNet.

Вот диаграмма, которая показывает, как взаимодействуют части приложения:

![Обработка сообщений электронной почты][Обработка сообщений электронной почты]

Этот учебник состоит из пяти частей. Если вам нужно более быстрое и простое введение в облачные службы, очереди и большие двоичные объекты, см. раздел [Get Started with Azure Cloud Services and ASP.NET][Get Started with Azure Cloud Services and ASP.NET] (Приступаем к работе с облачными службами Azure и ASP.NET). Также вы можете запустить многоуровневое приложение в веб-сайтах и веб-заданиях; дополнительную информацию см. в разделе [Get Started with the Azure WebJobs SDK][Get Started with the Azure WebJobs SDK] (Приступаем к работе с пакетом SDK для Azure WebJobs).

В этой серии учебников вы узнаете следующее:

-   Как подготовить компьютер к разработке для Azure путем установки пакета Azure SDK.
-   Как создать облачный проект Visual Studio с веб-ролью ASP.NET MVC и двумя рабочими ролями.
-   Как опубликовать облачный проект в облачной службе Azure.
-   Как использовать службу хранилища очередей Azure для связи между уровнями или рабочими ролями.
-   Как использовать службу хранилища таблиц Azure в качестве масштабируемого хранилища нереляционных структурированных данных.
-   Как использовать службу больших двоичных объектов Azure для хранения файлов в облаке.
-   Как просмотреть и изменить таблицы, очереди и BLOB-объекты Azure с помощью обозревателя серверов Visual Studio.
-   Как использовать SendGrid для отправки сообщений.
-   Как настроить трассировку и просматривать данные трассировки.
-   Как масштабировать приложение, увеличивая число экземпляров рабочих ролей.

## <a name="toc"></a>Серия учебников

В серию входит пять учебников:

1.  **Введение в приложение службы электронной почты Azure** (этот учебник). Подробный взгляд на приложение и его архитектуру. Его можно пропустить, если вам просто нужно посмотреть, как проводить развертывание, или посмотреть код, а вернуться к нему уже позже, чтобы лучше понять архитектуру.
2.  [Настройка и развертывание приложения службы электронной почты Azure][Настройка и развертывание приложения службы электронной почты Azure] Процедура скачивания примера приложения, его настройки, локального тестирования, развертывания и тестирования в облаке.
3.  [Создание веб-роли для приложения службы электронной почты Azure][Создание веб-роли для приложения службы электронной почты Azure] Как собрать компоненты MVC приложения и локально их протестировать.
4.  [Создание рабочей роли A (планировщик электронной почты) для приложения службы электронной почты Azure][Создание рабочей роли A (планировщик электронной почты) для приложения службы электронной почты Azure]. Процедура построения серверного компонента, который создает очередь рабочих элементов для отправки сообщений электронной почты, и его локального тестирования.
5.  [Создание рабочей роли B (отправитель электронной почты) для приложения службы электронной почты Azure][Создание рабочей роли B (отправитель электронной почты) для приложения службы электронной почты Azure]. Процедура построения серверного компонента, который обрабатывает очередь рабочих элементов для отправки сообщений электронной почты, и его локального тестирования.

## Разделы этого руководства

-   [Предварительные требования][Предварительные требования]
-   [Обзор внешнего интерфейса][Обзор внешнего интерфейса]
-   [Обзор серверной части][Обзор серверной части]
-   [Таблицы Azure][Таблицы Azure]
-   [Очереди Azure][Очереди Azure]
-   [Схема данных][Схема данных]
-   [Большие двоичные объекты Azure][Большие двоичные объекты Azure]
-   [Сравнение облачной службы Azure и веб-сайта Azure][Сравнение облачной службы Azure и веб-сайта Azure]
-   [Стоимость][Стоимость]
-   [Аутентификация и авторизация][Аутентификация и авторизация]
-   [Дальнейшие действия][Дальнейшие действия]

## Предварительные требования

Указания в этих учебниках подходят для следующих продуктов:

-   Visual Studio 2013 с обновлением 2
-   Visual Studio 2013 Express для Web с обновлением 2

Также вам необходима подписка Azure. Можно создать [бесплатную пробную учетную запись][бесплатную пробную учетную запись] или [активировать преимущества подписчика MSDN][активировать преимущества подписчика MSDN].

## <a name="frontend"></a>Обзор внешнего интерфейса

Приложение представляет собой службу списка электронных сообщений. Внешний интерфейс включает в себя веб-страницы, которые администраторы службы используют для управления списками электронных сообщений.

(Снимок экрана показывает стиль шаблонов Visual Studio 2012. Содержимое в Visual Studio 2013 такое же, но стиль отличается.)

![Страница индексов списков рассылки][Страница индексов списков рассылки]

![Страница индексов подписчиков][Страница индексов подписчиков]

Имеется также набор страниц, которые администраторы используют для создания сообщений, отправляемых в список электронной почты.

![Страница индексов сообщений][Страница индексов сообщений]

![Страница создания сообщения][Страница создания сообщения]

Клиенты службы — это компании, которые предоставляют своим клиентам возможность подписаться на список рассылки на клиентском веб-сайте. Например, администратор настраивает список для объявлений отдела истории университета Contoso. Когда учащийся, заинтересованный в объявлениях отдела истории, щелкает ссылку на веб-сайте университета Contoso, университет Contoso выполняет вызов веб-службы в приложение службы электронной почты Azure. Метод обслуживания приводит к отправке сообщения электронной почты клиенту. Сообщение электронной почты содержит гиперссылку, и когда получатель выбирает эту ссылку, отображается страница, приглашающая клиента в список объявлений отдела истории.

![Подтверждение по электронной почте][Подтверждение по электронной почте]

![Страница приветствия для списка][Страница приветствия для списка]

В каждом отправляемом службой электронном сообщении (за исключением подтверждения подписки) содержится гиперссылка для отмены подписки. Когда получатель выбирает эту ссылку, на веб-странице отображается запрос на подтверждение отказа от подписки.

![Страница подтверждения отмены подписки][Страница подтверждения отмены подписки]

Если получатель нажимает кнопку **Подтвердить**, отображается страница, подтверждающая удаление пользователя из списка.

![Страница с подтверждением отмены подписки][Страница с подтверждением отмены подписки]

## <a name="backend"></a>Обзор серверной части

Внешний интерфейс хранит в таблицах Azure списки адресов электронной почты и сообщения для отправки по ним. Когда администратор планирует отправку сообщения, в таблицу `message` добавляется строка с запланированной датой и другими данными, например строкой темы. Рабочая роль периодически сканирует таблицу `message` на предмет сообщений, которые необходимо отправить (мы назовем ее рабочей ролью A).

Когда рабочая роль A находит сообщение для отправки, она выполняет следующие задачи:

-   Получает все электронные адреса в конечном списке сообщений.
-   Помещает сведения, необходимые для отправки каждого электронного сообщения, в таблицу `message`.
-   Создает очередь рабочих элементов для каждого электронного сообщения, которое нужно отправить.

Вторая рабочая роль (рабочая роль B) опрашивает эту очередь на наличие рабочих элементов. Когда рабочая роль B находит рабочий элемент, оно обрабатывает его, отправив сообщение электронной почты, а затем удаляет из очереди. На следующей схеме показаны соответствующие взаимосвязи.

![Обработка сообщений электронной почты][Обработка сообщений электронной почты]

Если рабочая роль B отключается и требуется перезапуска, пропуск сообщений отсутствует, поскольку рабочий элемент очереди для сообщения электронной почты удаляется только после отправки сообщения. Приложение также предотвращает отправку нескольких сообщений, когда происходит сбой рабочей роли A и требуется ее перезапуск.

![Предотвращение дублирования сообщений электронной почты][Предотвращение дублирования сообщений электронной почты]

Рабочая роль B опрашивает очередь подписки на наличие рабочих элементов, помещенных туда методом службы веб-API для новых подписок. При нахождении такого элемента она отправляет письмо с подтверждением.

![Обработка сообщений очереди подписки][Обработка сообщений очереди подписки]

## <a name="tables"></a>Таблицы Azure

Приложение службы электронной почты Azure хранит данные в таблицах хранилища Azure. Таблицы Azure — это хранилище данных NoSQL, а не реляционная база данных, такая как [база данных SQL Azure][база данных SQL Azure]. Таблицы Azure — хороший выбор, когда эффективность и масштабируемость важнее нормализации данных и реляционной целостности. Например, в этом приложении одна рабочая роль создает строку при каждом создании рабочего элемента очереди, а другая получает и обновляет строку каждый раз при отправке сообщения электронной почты, что может вызывать проблемы с производительностью при использовании реляционной базы данных. Кроме того, таблицы Azure дешевле, чем Azure SQL. Дополнительную информацию о таблицах Azure см. по ссылкам, приведенным в конце [последнего учебника данной серии][Создание рабочей роли B (отправитель электронной почты) для приложения службы электронной почты Azure].

В следующих разделах описывается содержимое таблиц Azure, используемых приложением службы электронной почты Azure. Схема с таблицами и их взаимосвязями приведена в подразделе [Схема данных службы электронной почты Azure][Схема данных] ниже на этой странице.

### Таблица "mailinglist"

В таблице `mailinglist` хранятся сведения о списках рассылки и их подписчиках. (Для задания имен в таблице Azure рекомендуется использовать только строчные буквы.)

Различные строки в таблицах Azure могут иметь разные схемы, и такая гибкость обычно используется для хранения данных, которым в реляционной базе данных может потребоваться несколько таблиц, в одной таблице. Например, для хранения данных списка рассылки в базе данных SQL можно использовать три таблицы: таблицу `mailinglist`, которая содержит сведения о списке, таблицу `subscriber`, которая содержит сведения о подписчиках, и таблицу `mailinglistsubscriber`, которая сопоставляет списки рассылки с подписчиками, и наоборот. В таблице NoSQL этого приложения все эти функции выполняет одна таблица с именем `mailinglist`.

В таблице Azure каждая строка имеет *ключ раздела* и *ключ строки*, однозначно определяющие эту строку. Ключ раздела делит таблицу на логические разделы. Ключ строки однозначно определяет строку в разделе. Нет никаких вторичных индексов. Поэтому чтобы убедиться, что приложение будет масштабируемым, важно разрабатывать таблицы таким образом, чтобы всегда можно было указать ключи строки и раздела в запросе.

Ключ раздела для таблицы `mailinglist` — это имя списка рассылки.

Ключ строки для таблицы `mailinglist` может быть одним из двух следующих значений: константа mailinglist или электронный адрес подписчика. Строки с ключом строки "mailinglist" содержат сведения о списке рассылки. Строки, для которых в качестве ключа строки выступает адрес электронной почты, содержат сведения о подписчиках для списка.

Другими словами, строки с ключом строки mailinglist эквивалентны таблице `mailinglist` в реляционной базе данных. Строки с электронным адресом в качестве ключа строки эквивалентны таблице `subscriber` и таблице сопоставлений `mailinglistsubscriber` в реляционной базе данных.

Использование одной таблицы для выполнения нескольких функций позволило повысить производительность. В реляционной базе данных потребовалось бы считать три таблицы, а также отсортировать и сравнить друг с другом три набора строк, что требует времени. В данном случае считывается только одна таблица, а ее строки автоматически возвращаются в порядке ключа раздела и ключа строки.

В следующей таблице приведены свойства строки для строк, содержащих сведения о списке рассылки (row key = "mailinglist").

| Свойство         | Тип данных | Описание                                                                                                                                                                                                                                                             |
|------------------|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PartitionKey     | Строка     | ListName: уникальный идентификатор для списка рассылки, например contoso1. Таблица обычно используется для получения всей информации о конкретном списке рассылки, поэтому использование имени списка представляет собой эффективный способ секционирования таблицы. |
| RowKey           | Строка     | Константа "mailinglist".                                                                                                                                                                                                                                             |
| Описание         | Строка     | Описание списка рассылки, например «Объявления отдела истории университета Contoso».                                                                                                                                                                                 |
| FromEmailAddress | Строка     | Электронный адрес в поле «От» в сообщениях, отправляемых в этот список, например: donotreply@contoso.edu.                                                                                                                                                            |

В следующей таблице приведены свойства строки для строк, содержащих сведения о подписчике для списка (ключ строки = адрес электронной почты).

<table border="1">

<tr bgcolor="lightgray">
<th>Свойство</th>
<th>Тип данных</th>
<th>Описание</th>
</tr>

<tr>
<td>PartitionKey</td>
<td>Строка</td>
<td>ListName:  уникальный идентификатор для списка рассылки, например contoso1. Таблица обычно используется для получения всей информации о конкретном списке рассылки, поэтому использование имени списка представляет собой эффективный способ секционирования таблицы.</td>
</tr>

<tr>
<td>RowKey</td>
<td>Строка</td>
<td>Константа &quot;mailinglist&quot;.</td>
</tr>

<tr>
<td>Описание</td>
<td>Строка</td>
<td>Описание списка рассылки, например &laquo;Объявления отдела истории университета Contoso&raquo;.</td>
</tr>

<tr>
<td>FromEmailAddress</td>
<td>Строка</td>
<td>Электронный адрес в поле &laquo;От&raquo; в сообщениях, отправляемых в этот список, например: donotreply@contoso.edu.</td>
</tr>

</table>
<p>В следующей таблице приведены свойства строки для строк, содержащих сведения о подписчике для списка (ключ строки = адрес электронной почты).</p>
<table border="1">

<tr bgcolor="lightgray">
<th>Свойство</th>
<th>Тип данных</th>
<th>Описание</th>
</tr>

<tr>
<td>PartitionKey</td>
<td>Строка</td>
<td>ListName:  имя (уникальный идентификатор) списка рассылки, например contoso1.</td>
</tr>

<tr>
<td>RowKey</td>
<td>Строка</td>
<td>EmailAddress: электронный адрес подписчика, например student1@contoso.edu.</td>
</tr>

<tr>
<td>SubscriberGUID</td>
<td>Строка</td>
<td>Создается, когда электронный адрес добавляется в список. Используется в ссылках на подписку или отказ от нее, чтобы затруднить использование этих возможностей с адреса электронной почты другого пользователя. 
<br/><br/>
Некоторые запросы для веб-страниц подписки и отказа от подписки указывают только PartitionKey и это свойство. Запрос раздела без использования RowKey ограничивает масштабируемость приложения, поскольку запросы выполняются дольше из-за увеличения размера списков рассылки. Один из способов улучшения масштабируемости заключается в добавлении строк поиска, содержащих в свойстве RowKey значение SubscriberGUID. Например, для каждого адреса электронной почты одна строка может иметь в RowKey значение &quot;email:student1@domain.com&quot;, а другая &mdash; значение &quot;guid:6f32b03b-90ed-41a9-b8ac-c1310c67b66a&quot;. Это легко реализовать благодаря простоте программирования атомарного пакета транзакций по строкам в разделе. Дополнительную информацию см. в разделе <a href="http://msdn.microsoft.com/ru-ru/library/windowsazure/hh508997.aspx">Real World: Designing a Scalable Partitioning Strategy for Azure Table Storage</a> (Реальный мир: разработка стратегии масштабируемого секционирования для хранилища таблиц Azure)
</td>
</tr>

<tr>
<td>Проверено</td>
<td>Логический</td>
<td>При первоначальном создании строки для нового подписчика это значение равно false. Оно изменяется на true только после того, как новый подписчик выбирает гиперссылку подтверждения в приветственном сообщении либо администратор задает для него значение true. Если сообщение отправляется в список, пока значение &laquo;Verified&raquo; для одного из его подписчиков равно false, электронные сообщения этому подписчику не отправляется.</td>
</tr>

</table>

Ниже приведен пример того, как могут выглядеть данные в таблице.

<table border="1">
<tr>
<th width="200" align="right" bgcolor="lightgray">
Ключ раздела

</th>
<td>
contoso1

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Ключ строки

</th>
<td>
mailinglist

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Описание

</th>
<td>
Объявления отдела истории университета Contoso

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
FromEmailAddress

</th>
<td>
donotreply@contoso.edu

</td>
</tr>
</table>

------------------------------------------------------------------------

<table border="1">
<tr>
<th width="200" align="right" bgcolor="lightgray">
Ключ раздела

</th>
<td>
contoso1

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Ключ строки

</th>
<td>
student1@domain.com

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
SubscriberGUID

</th>
<td>
6f32b03b-90ed-41a9-b8ac-c1310c67b66a

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Проверено

</th>
<td>
true

</td>
</tr>
</table>

------------------------------------------------------------------------

<table border="1">
<tr>
<th width="200" align="right" bgcolor="lightgray">
Ключ раздела

</th>
<td>
contoso1

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Ключ строки

</th>
<td>
student2@domain.com

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
SubscriberGUID

</th>
<td>
01234567-90ed-41a9-b8ac-c1310c67b66a

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Проверено

</th>
<td>
нет

</td>
</tr>
</table>

------------------------------------------------------------------------

<table border="1">
<tr>
<th width="200" align="right" bgcolor="lightgray">
Ключ раздела

</th>
<td>
fabrikam1

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Ключ строки

</th>
<td>
mailinglist

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Описание

</th>
<td>
Открытые инженерные вакансии Fabrikam

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
FromEmailAddress

</th>
<td>
donotreply@fabrikam.com

</td>
</tr>
</table>

------------------------------------------------------------------------

<table border="1">
<tr>
<th width="200" align="right" bgcolor="lightgray">
Ключ раздела

</th>
<td>
fabrikam1

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Ключ строки

</th>
<td>
applicant1@domain.com

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
SubscriberGUID

</th>
<td>
76543210-90ed-41a9-b8ac-c1310c67b66a

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Проверено

</th>
<td>
true

</td>
</tr>
</table>
### Таблица "message"

Таблица `message` содержит информацию о сообщениях, которые планируется отправить в список рассылки. Администраторы создают и изменяют строк в этой таблице с помощью веб-страниц, а рабочие роли используют ее для передачи сведений о каждом сообщении электронной почты из рабочей роли A в рабочую роль B.

Ключ раздела для таблицы "message" — это дата запланированной отправки сообщения электронной почты в формате гггг-мм-дд. Это позволяет оптимизировать таблицу для запроса, который чаще всего выполняется для данной таблицы, при этом выбираются строки, у которых значение `ScheduledDate` соответствует сегодняшнему дню или более раннему времени. Однако это создает потенциальные проблемы с производительностью, поскольку максимальная пропускная способность таблиц хранилища Azure составляет 500 сущностей в секунду для раздела. Для каждого отправляемого электронного сообщения приложение записывает строку таблицы `message`, считывает строку и удаляет строку. Таким образом, кратчайший срок для обработки 1 000 000 сообщений электронной почты, запланированных на один день, составляет почти два часа независимо от того, сколько рабочих ролей добавляется для обработки повышенной нагрузки.

Ключ строки для таблицы `message` может иметь одно из следующих значений: константа message с уникальным ключом для сообщения с названием `MessageRef` либо значение `MessageRef` с электронным адресом подписчика. Строки с ключом строки, который начинается с "message", включают сведения о сообщении, например, список рассылки, в который его требуется отправить, и время отправки. Строки, для которых в качестве ключа строки используются значение `MessageRef` и электронный адрес, содержат все сведения, необходимые для отправки электронного сообщения на этот адрес.

В терминах реляционной базы данных строки с ключом строки, начинающимся с «message», эквивалентны таблице `message`. Строки с ключом строки, состоящим из значения `MessageRef` и электронного адреса, эквивалентны представлению запроса на присоединение, содержащему информацию о `mailinglist`, `message` и `subscriber`.

В следующей таблице показаны свойства строки для строк таблицы `message`, содержащие информацию о самом сообщении.

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Свойство</th>
<th align="left">Тип данных</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">PartitionKey</td>
<td align="left">Строка</td>
<td align="left">Дата, на которую запланирована отправка сообщения, в формате гггг-мм-дд.</td>
</tr>
<tr class="even">
<td align="left">RowKey</td>
<td align="left">Строка</td>
<td align="left">Константа «message», сцепленная со значением <code data-inline="1">MessageRef</code>. <code data-inline="1">MessageRef</code> — это уникальное значение, созданное путем получения значения <code data-inline="1">Ticks</code> из <code data-inline="1">DateTime.Now</code> при создании строки.<br /><br />Примечание. Высокопродуктивные многопоточные приложения с несколькими экземплярами следует подготовить к обработке повторяющихся исключений RowKey при использовании тактов. Уникальность тактов не гарантируется.</td>
</tr>
<tr class="odd">
<td align="left">ScheduledDate</td>
<td align="left">Дата</td>
<td align="left">Дата, на которую запланирована отправка сообщения. (Аналогично <code data-inline="1">PartitionKey</code>, но в формате Date.)</td>
</tr>
<tr class="even">
<td align="left">SubjectLine</td>
<td align="left">Строка</td>
<td align="left">Строка темы сообщения электронной почты.</td>
</tr>
<tr class="odd">
<td align="left">ListName</td>
<td align="left">Строка</td>
<td align="left">Список, в который отправляется это сообщение.</td>
</tr>
<tr class="even">
<td align="left">Состояние</td>
<td align="left">Строка</td>
<td align="left"><ul>
<li>&quot;Ожидание&quot; — рабочая роль A еще не запущена, чтобы можно было создать сообщения очереди для планирования сообщений электронной почты.</li>
<li>&quot;Организация очереди&quot; — рабочая роль A уже запущена, чтобы можно было создать сообщения очереди для планирования сообщений электронной почты.</li>
<li>&quot;Обработка&quot; — рабочая роль A создала рабочие элементы очереди для всех сообщений электронной почты в списке, однако пока отправлены не все сообщения электронной почты.</li>
<li>«Сompleted» — рабочая роль B завершила обработку всех рабочих элементов очереди (все электронные сообщения были отправлены). Строки с завершенным состоянием архивируются в таблицу <code data-inline="1">messagearchive</code>, как описано ниже. Мы надеемся, что в следующем выпуске это свойство получит тип <code data-inline="1">enum</code>.</li>
</ul></td>
</tr>
</tbody>
</table>

Когда рабочая роль A создает сообщение очереди для электронного сообщения, отправляемого в список, она создает в таблице `message` строку электронного адреса. Когда рабочая роль B отправляет электронное сообщение, она перемещает строку электронной почты в таблицу `messagearchive` и изменяет свойство `EmailSent` на значение `true`. После архивации всех строк электронной почты для сообщения в состоянии «Processing» рабочая роль A задает состояние «Completed» и перемещает строку `message` в таблицу `messagearchive`.

В следующей таблице показаны свойства строки для строк электронной почты в таблице `message`.

| Свойство          | Тип данных    | Описание                                                                                                                                                                |
|-------------------|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PartitionKey      | Строка        | Дата, на которую запланирована отправка сообщения, в формате гггг-мм-дд.                                                                                                |
| RowKey            | Строка        | Значение `MessageRef` и конечный электронный адрес из строки `subscriber` таблицы `mailinglist`.                                                                        |
| MessageRef        | Длинное целое | Аналогично компоненту `MessageRef` элемента `RowKey`.                                                                                                                   |
| ScheduledDate     | Дата          | Запланированная дата из строки `message` таблицы `message`. (Аналогично `PartitionKey`, но в формате Date.)                                                             |
| SubjectLine       | Строка        | Строка темы электронного сообщения из строки `message` таблицы `message`.                                                                                               |
| ListName          | Строка        | Имя списка рассылки из таблицы `mailinglist`.                                                                                                                           |
| From EmailAddress | Строка        | Адрес в поле «От» электронного сообщения из строки `mailinglist` таблицы `mailinglist`.                                                                                 |
| EmailAddress      | Строка        | Электронный адрес из строки `subscriber` таблицы `mailinglist`.                                                                                                         |
| SubscriberGUID    | Строка        | GUID подписчика из строки `subscriber` таблицы `mailinglist`.                                                                                                           |
| EmailSent         | Логический    | Значение false указывает на то, что сообщение электронной почты еще не было отправлено; значение true указывает на то, что сообщение электронной почты было отправлено. |

В этих строках присутствует избыточность данных, которой следует избегать в реляционной базе данных. Но в этом случае взамен определенных недостатков, связанных с избыточностью данных, вы получаете увеличение эффективности обработки и масштабируемости. Так как все данные, необходимые для сообщения электронной почты, присутствуют в одной из этих строк, рабочей роли B требуется только считать одну строку для отправки сообщения электронной почты, после чего она выводит рабочий элемент из очереди.

Может возникнуть вопрос, откуда получается текст сообщения электронной почты. Эти строки не имеют ссылок на большие двоичные объекты для файлов, которые содержат текст электронного сообщения, поскольку это значение получается из значения `MessageRef`. Например, если `MessageRef` имеет значение 634852858215726983, большие двоичные объекты имеют имена 634852858215726983.htm и 634852858215726983.txt.

Ниже приведен пример того, как могут выглядеть данные в таблице.

<table border="1">
<tr>
<th width="200" align="right" bgcolor="lightgray">
Ключ раздела

</th>
<td>
2012-10-15

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Ключ строки

</th>
<td>
message634852858215726983

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
MessageRef

</th>
<td>
634852858215726983

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
ScheduledDate

</th>
<td>
2012-10-15

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
SubjectLine

</th>
<td>
Новая серия лекций

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
ListName

</th>
<td>
contoso1

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Состояние

</th>
<td>
Обработка

</td>
</tr>
</table>

------------------------------------------------------------------------

<table border="1">
<tr>
<th width="200" align="right" bgcolor="lightgray">
Ключ раздела

</th>
<td>
2012-10-15

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Ключ строки

</th>
<td>
634852858215726983student1@contoso.edu

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
MessageRef

</th>
<td>
634852858215726983

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
ScheduledDate

</th>
<td>
2012-10-15

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
SubjectLine

</th>
<td>
Новая серия лекций

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
ListName

</th>
<td>
contoso1

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
FromEmailAddress

</th>
<td>
donotreply@contoso.edu

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
EmailAddress

</th>
<td>
student1@contoso.edu

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
SubscriberGUID

</th>
<td>
76543210-90ed-41a9-b8ac-c1310c67b66a

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
EmailSent

</th>
<td>
true

</td>
</tr>
</table>

------------------------------------------------------------------------

<table border="1">
<tr>
<th width="200" align="right" bgcolor="lightgray">
Ключ раздела

</th>
<td>
2012-10-15

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Ключ строки

</th>
<td>
634852858215726983student2@contoso.edu

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
MessageRef

</th>
<td>
634852858215726983

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
ScheduledDate

</th>
<td>
2012-10-15

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
SubjectLine

</th>
<td>
Новая серия лекций

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
ListName

</th>
<td>
contoso1

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
FromEmailAddress

</th>
<td>
donotreply@contoso.edu

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
EmailAddress

</th>
<td>
student2@contoso.edu

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
SubscriberGUID

</th>
<td>
12345678-90ed-41a9-b8ac-c1310c679876

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
EmailSent

</th>
<td>
true

</td>
</tr>
</table>

------------------------------------------------------------------------

<table border="1">
<tr>
<th width="200" align="right" bgcolor="lightgray">
Ключ раздела

</th>
<td>
2012-11-15

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Ключ строки

</th>
<td>
message124852858215726999

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
MessageRef

</th>
<td>
124852858215726999

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
ScheduledDate

</th>
<td>
2012-11-15

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
SubjectLine

</th>
<td>
Разноски новых заданий

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
ListName

</th>
<td>
fabrikam

</td>
</tr>
<tr>
<th align="right" bgcolor="lightgray">
Состояние

</th>
<td>
Ожидает

</td>
</tr>
</table>

### Таблица "messagearchive"

Одна из стратегий по обеспечению эффективного выполнения запросов, особенно в том случае, когда требуется искать в полях, отличных от `PartitionKey` и `RowKey`, заключается в ограничении размера таблицы. Запрос в рабочей роли A, проверяющий, все ли электронные сообщения были отправлены для сообщения, должен найти в таблице `message` строки электронной почты, для которых `EmailSent` имеет значение false. Значение `EmailSent` отличается от PartitionKey или RowKey, поэтому такой запрос будет неэффективен для сообщения с большим количеством строк электронной почты. Поэтому по мере отправки электронных сообщений приложение перемещает строки электронной почты в таблицу `messagearchive`. В результате запросу, проверяющему отправку всех электронных сообщений для сообщения, достаточно отправить в таблицу message запрос о `PartitionKey` и `RowKey`, так как обнаружение любых строк электронной почты для сообщения будет означать, что имеются неотправленные сообщения и сообщение нельзя пометить как `Complete`.

Схема строк в таблице `messagearchive` идентична схеме строк в таблице `message`. В зависимости от того, что требуется сделать с этими архивными данными, можно ограничить их размеры и расходы за счет сокращения числа свойств, сохраненных для каждой строки, и удаления строк старше определенного срока.

## <a name="queues"></a>Очереди Azure

Очереди Azure облегчают взаимодействие между уровнями этого многоуровневого приложения, а также между рабочими ролями на серверном уровне.
Очереди используются для связи между рабочими ролями A и B, чтобы сделать приложение масштабируемым. Рабочая роль A может создать строку в таблице "Message" для каждого сообщения электронной почты, а рабочая роль B может просматривать таблицу на предмет строк, соответствующих неотправленным сообщениям электронной почты, однако вы не сможете добавить дополнительные экземпляры рабочей роли B, чтобы поделить работу. Проблема с использованием строк таблицы для координации работы между рабочими ролями A и B заключается в том, что нет способа гарантировать, чтобы только один экземпляр рабочей роли получал одну конкретную строку таблицы для обработки. Очереди дают такую гарантию. Когда экземпляр рабочей роли получает рабочий элемент из очереди, служба очереди гарантирует, что никакой другой экземпляр рабочей роли не сможет получить тот же рабочий элемент. Такая возможность эксклюзивной аренды у очередей Azure упрощает распределение рабочей нагрузки между несколькими экземплярами рабочей роли.

Azure также предоставляет службу очередей Service Bus. Дополнительную информацию об очередях службы хранилища Azure и очередях Service Bus см. в [последнем учебнике данной серии][Создание рабочей роли B (отправитель электронной почты) для приложения службы электронной почты Azure].

Приложение службы электронной почты Azure использует две очереди: `AzureMailQueue` и `AzureMailSubscribeQueue`.

### AzureMailQueue

Очередь `AzureMailQueue` координирует отправку электронных сообщений по спискам. Рабочая роль A помещает в очередь рабочий элемент для каждого отправляемого сообщения электронной, а рабочая роль B получает рабочий элемент из очереди и отправляет сообщение электронной почты.

Рабочий элемент очереди содержит строку с разделителями-запятыми, состоящую из запланированной даты сообщения (ключ раздела для таблицы `message`) и значений `MessageRef` и `EmailAddress` (ключ строки для таблицы `message`), а также флага, указывающего, создается ли элемент после завершения работы и перезапуска рабочей роли, например:

      2012-10-15,634852858215726983,student1@contoso.edu,0

Рабочая роль B использует эти значения для поиска в таблице `message` строки со всеми сведениями, необходимыми для отправки электронного сообщения. Если флаг перезапуска указывает на перезапуск, перед отправкой сообщения электронной почты рабочая роль B проверяет, не было ли оно уже отправлено.

При наличии пиковых нагрузок по трафику облачную службу можно перенастроить, чтобы создать несколько экземпляров рабочей роли B, каждый из которых независимо извлекает рабочие элементы из очереди.

### AzureMailSubscribeQueue

Очередь `AzureMailSubscribeQueue` координирует отправку сообщений с подтверждением подписки. В ответ на вызов метода службы этот метод помещает рабочий элемент в очередь. Рабочая роль B получает рабочий элемент из очереди и отправляет сообщение электронной почты с подтверждением подписки.

Рабочий элемент очереди содержит GUID подписчика. Данное значение однозначно идентифицирует адрес электронной почты и список для оформления подписки — это все, что нужно рабочей роли B для отправки сообщения электронной почты с подтверждением подписки. Как упоминалось ранее, для этого требуется запрос по полю, отличному от `PartitionKey` или `RowKey`, что оказывается неэффективным. Чтобы сделать приложение более масштабируемым, потребуется изменить структуру таблицы `mailinglist`, включив GUID подписчика в `RowKey`.

## <a name="datadiagram"></a><span class="short-header">Схема данных</span>Схема данных службы электронной почты Azure

На следующей показаны таблицы и очереди, а также их взаимосвязи.

![Схема данных для приложения службы электронной почты Azure][Схема данных для приложения службы электронной почты Azure]

## <a name="blobs"></a>Большие двоичные объекты Azure

BLOB-объекты — это "большие двоичные объекты". Служба BLOB-объектов Azure предназначена для передачи и сохранения файлов в облаке. Дополнительную информацию о больших двоичных объектах Azure см. по ссылкам, приведенным в конце [последнего учебника данной серии][Создание рабочей роли B (отправитель электронной почты) для приложения службы электронной почты Azure].

Администраторы почтовой службы Azure помещают текст сообщения электронной почты в формате HTML в *HTM-файл*, а в формате обычного текста — в *TXT-файл*. При планировании сообщения электронной почты они загружают эти файлы на веб-страницу **Создание сообщения**, а контроллер ASP.NET MVC для страницы сохраняет переданный файл в BLOB-объекте Azure.

BLOB-объекты хранятся в контейнерах BLOB-объектов, подобно тому, как файлы хранятся в папках. Приложение почтовой службы Azure использует один контейнер BLOB-объектов с именем **azuremailblobcontainer**. Имя BLOB-объектов в контейнере формируется путем объединения значения MessageRef с расширением файла, например: 634852858215726983.htm и 634852858215726983.txt.

Поскольку сообщения в формате HTML или простого текста по существу являются строками, мы можем разработать приложение для хранения текста электронного сообщения в свойствах строки в таблице `Message`, а не в больших двоичных объектах. Тем не менее размер свойства в строке таблицы ограничен 64 КБ, поэтому использование BLOB-объектов позволяет избежать ограничения размера текста сообщения электронной почты. (64 КБ — это максимальный общий размер свойства, после разрешения кодирования служебных данных максимальный размер сохраняемой строки приближается к 48 КБ.)

## <a name="wawsvswacs"></a>Сравнение облачной службы Azure и веб-сайта Azure

Электронная почта Azure настроена так, что запуск серверной и интерфейсной частей происходит в облачной службе Azure.

![Обзор архитектуры приложения][Обзор архитектуры приложения]

Отличие архитектуры заключается в запуске интерфейсной части на веб-сайте Azure.

![Альтернативная архитектура приложения][Альтернативная архитектура приложения]

Другой альтернативой является запуск интерфейсного компонента на веб-сайте Azure и использование функции WebJobs для фонового компонента на тех же серверах, что и интерфейсный компонент. Дополнительную информацию см. в разделе [Get Started with the Azure WebJobs SDK][Get Started with the Azure WebJobs SDK] (Приступаем к работе с пакетом SDK для Azure WebJobs).

## <a name="cost"></a>Стоимость

Этот раздел содержит краткий обзор затрат на выполнение примера приложения в Azure по ставкам, которые действовали на момент публикации учебника — в декабре 2012 г. Перед принятием бизнес-решений на основе затрат не забудьте уточнить текущие ставки на следующих веб-страницах:

-   [Калькулятор цен Azure][Калькулятор цен Azure]
-   [SendGrid Azure][SendGrid Azure]

Затраты зависят от числа экземпляров веб-ролей и рабочих ролей, которые вы решите использовать. Чтобы получить право на [соглашение об уровне обслуживания облачной службы Azure, которое гарантирует 99,95 % времени безотказной работы][соглашение об уровне обслуживания облачной службы Azure, которое гарантирует 99,95 % времени безотказной работы], необходимо развернуть два или более экземпляров каждой роли. Одна из причин, по которым необходимо запустить по крайней мере два экземпляра роли, связана с тем, что виртуальные машины с вашим приложением перезапускаются примерно два раза в месяц для обновления операционной системы. (Дополнительную информацию об обновлениях ОС см. в разделе [Перезапуск экземпляра роли из-за обновлений ОС][Перезапуск экземпляра роли из-за обновлений ОС].)

Работа, выполняемая двумя рабочими ролями в этом примере, не является критичной по времени и не требует соглашение об уровне обслуживания с доступностью 99,5 %. Таким образом, возможно использовать один экземпляр каждой роли при условии, что один экземпляр справляется с рабочей нагрузкой. Для экземпляра веб-роли время имеет значение, так как пользователи ожидают от веб-сайта бесперебойной работы, поэтому рабочее приложение должно иметь по крайней мере два экземпляра веб-роли.

В следующей таблице показаны затраты на архитектуру по умолчанию для примера приложения службы электронной почты Azure в условиях минимальной рабочей нагрузки. Показанные затраты основаны на использовании очень мелкой (общей) виртуальной машины. По умолчанию при создании облачного проекта Visual Studio используется малый размер виртуальной машины, который примерно в шесть раз дороже очень мелкого размера.

<table border="1">
<tr bgcolor="lightgray">
<th>
Компонент или служба

</th>
<th>
Тариф

</th>
<th>
Стоимость в месяц

</th>
</tr>
<tr>
<td>
Веб-роль

</td>
<td>
2 экземпляра по 0,02 долл. США в час для очень мелких экземпляров

</td>
<td>
$29.00

</td>
</tr>
<tr>
<td>
рабочая роль A (планирует отправляемые сообщения электронной почты)

</td>
<td>
1 экземпляр по 0,02 долл. США в час для очень мелкого экземпляра

</td>
<td>
$14.50

</td>
</tr>
<tr>
<td>
Рабочая роль B (отправляет сообщения электронной почты)

</td>
<td>
1 экземпляр по 0,02 долл. США в час для очень мелкого экземпляра

</td>
<td>
$14.50

</td>
</tr>
<tr>
<td>
Транзакции с хранилищем Azure

</td>
<td>
1 миллион транзакций в месяц по ставке 0,1 долл. США за миллион (каждый запрос считается транзакцией, рабочая роль A постоянно отправляет запросы в таблицы на предмет сообщений, которые необходимо отправить. Приложение также настроено на запись диагностических данных в службу хранилища Azure, и каждая такая операция считается транзакцией).

</td>
<td>
$0.10

</td>
</tr>
<tr>
<td>
Локально избыточное хранилище Azure

</td>
<td>
2,33 долл. США за 25 Гб (включая хранилище для таблиц приложения и диагностических данных).

</td>
<td>
$2.33

</td>
</tr>
<tr>
<td>
Пропускная способность

</td>
<td>
5 ГБ бесплатного исходящего трафика

</td>
<td>
Бесплатно

</td>
</tr>
<tr>
<td>
SendGrid

</td>
<td>
Клиенты Azure могут отправлять 25 000 бесплатных сообщений электронной почты каждый месяц

</td>
<td>
Бесплатно

</td>
</tr>
<tr>
<td colspan="2">
Всего

</td>
<td>
$60.43

</td>
</tr>
</table>
Как вы видите, экземпляры роли являются основной составляющей общей стоимости. Экземпляры роли требуют затрат, даже если они остановлены; необходимо удалить экземпляр роли, чтобы перестать тратить на него средства. Один из экономичных подходов заключается в перемещении всего кода из рабочих ролей A и B в одну рабочую роль. В рамках этих учебников мы намеренно решаем реализовать два экземпляра рабочей роли для упрощения горизонтального масштабирования. Работа, выполняемая рабочей ролью B, координируется службой очередей Azure, то есть для масштабирования рабочей роли B достаточно увеличить число ее экземпляров. (Рабочая роль B является ограничивающим фактором при высокой нагрузке.) Работа, выполняемая рабочей ролью А, не координируется очередями, поэтому нельзя запустить несколько экземпляров рабочей роли A. Если бы две рабочих роли функционировали совместно и нужно было выполнить горизонтальное масштабирование, потребовалось бы реализовать механизм, обеспечивающий выполнение заданий рабочей роли A только в одном экземпляре. (Один из таких механизмов обеспечивается [CloudFx][CloudFx]. См. раздел [Пример WorkerRole.cs][Пример WorkerRole.cs].)

Можно также переместить весь код из двух рабочих ролей в веб-роль, чтобы все выполнялось именно в ней. Однако выполнение фоновых задач в ASP.NET не поддерживается или считается ненадежным, кроме того, такая архитектура может затруднить масштабирование. Дополнительную информацию см. в разделе [Опасность реализации повторяющихся фоновых задач в ASP.NET][Опасность реализации повторяющихся фоновых задач в ASP.NET]. См. также разделы [Процедура объединения рабочей роли и веб-роли в Azure][Процедура объединения рабочей роли и веб-роли в Azure] и [Объединение нескольких рабочих ролей Azure в веб-роль Azure][Объединение нескольких рабочих ролей Azure в веб-роль Azure]. Если вам интересен этот вариант, лучшим решением будет [запуск на веб-сайте Azure и использование функции WebJobs для задач серверной части][запуск на веб-сайте Azure и использование функции WebJobs для задач серверной части].

Другой альтернативной архитектурой, позволяющей снизить затраты, является использование [блока приложений автоматического масштабирования][блока приложений автоматического масштабирования] для автоматического развертывания рабочих ролей только во время запланированных периодов и удаления их после выполнения работы. Дополнительную информацию об автоматическом масштабировании см. по ссылкам, приведенным в конце [последнего учебника данной серии][Создание рабочей роли B (отправитель электронной почты) для приложения службы электронной почты Azure].

В будущем Azure может предоставлять механизм уведомления для запланированных перезагрузок, который позволил бы запускать дополнительный экземпляр веб-роли только на период перезагрузки. Вы не сможете претендовать на соглашение об уровне обслуживания доступностью 99,95 %, однако это позволит почти вполовину сократить расходы и обеспечить доступность веб-приложения во время перезагрузки.

## <a name="auth"></a>Аутентификация и авторизация

В рабочем приложении необходимо реализовать механизм аутентификации и авторизации, такой как [Удостоверение ASP.NET][Удостоверение ASP.NET], для веб-интерфейса ASP.NET MVC, включая метод обслуживания веб-API ASP.NET. Существуют также другие варианты, например использование общего секрета для обеспечения безопасности метода обслуживания веб-API. В целях простоты настройки и развертывания из примера приложения были исключены функциональные возможности проверки подлинности и авторизации.

## <a name="nextsteps"></a>Дальнейшие действия

В [следующем учебнике][Настройка и развертывание приложения службы электронной почты Azure] вы загрузите пример проекта, настроите среду разработки, настроите проект для своей среды и протестируете его локально и в облаке. В учебниках с 3 по 5 вы увидите, как создать проект «с нуля».

Ссылки на дополнительные ресурсы по работе с таблицами, очередями и BLOB-объектами хранилища Azure приведены [в конце последнего учебника данной серии][в конце последнего учебника данной серии].

<div><a href="/ru-ru/develop/net/tutorials/multi-tier-web-site/2-download-and-run/" class="site-arrowboxcta download-cta">Учебник 2</a></div>

  [готовое приложение]: http://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36
  [электронную книгу]: http://social.technet.microsoft.com/wiki/contents/articles/11608.e-book-gallery-for-microsoft-technologies.aspx#ASPNETMultiTierWindowsAzureApplicationUsingStorageTablesQueuesandBlobs
  [Обработка сообщений электронной почты]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-worker-roles-a-and-b.png
  [Get Started with Azure Cloud Services and ASP.NET]: /ru-ru/documentation/articles/cloud-services-dotnet-get-started/
  [Get Started with the Azure WebJobs SDK]: /ru-ru/documentation/articles/websites-dotnet-webjobs-sdk-get-started/
  [Настройка и развертывание приложения службы электронной почты Azure]: /ru-ru/develop/net/tutorials/multi-tier-web-site/2-download-and-run/
  [Создание веб-роли для приложения службы электронной почты Azure]: /ru-ru/develop/net/tutorials/multi-tier-web-site/3-web-role/
  [Создание рабочей роли A (планировщик электронной почты) для приложения службы электронной почты Azure]: /ru-ru/develop/net/tutorials/multi-tier-web-site/4-worker-role-a/
  [Создание рабочей роли B (отправитель электронной почты) для приложения службы электронной почты Azure]: /ru-ru/develop/net/tutorials/multi-tier-web-site/5-worker-role-b/
  [Предварительные требования]: #prerequisites
  [Обзор внешнего интерфейса]: #frontend
  [Обзор серверной части]: #backend
  [Таблицы Azure]: #tables
  [Очереди Azure]: #queues
  [Схема данных]: #datadiagram
  [Большие двоичные объекты Azure]: #blobs
  [Сравнение облачной службы Azure и веб-сайта Azure]: #wawsvswacs
  [Стоимость]: #cost
  [Аутентификация и авторизация]: #auth
  [Дальнейшие действия]: #nextsteps
  [бесплатную пробную учетную запись]: /ru-ru/pricing/free-trial/
  [активировать преимущества подписчика MSDN]: /ru-ru/pricing/member-offers/msdn-benefits/
  [Страница индексов списков рассылки]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-mailing-list-index-page.png
  [Страница индексов подписчиков]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-subscribers-index-page.png
  [Страница индексов сообщений]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-message-index-page.png
  [Страница создания сообщения]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-message-create-page.png
  [Подтверждение по электронной почте]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-subscribe-email.png
  [Страница приветствия для списка]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-subscribe-confirmation-page.png
  [Страница подтверждения отмены подписки]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-unsubscribe-query-page.png
  [Страница с подтверждением отмены подписки]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-unsubscribe-confirmation-page.png
  [Предотвращение дублирования сообщений электронной почты]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-message-processing.png
  [Обработка сообщений очереди подписки]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-subscribe-diagram.png
  [база данных SQL Azure]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee336279.aspx
  [Real World: Designing a Scalable Partitioning Strategy for Azure Table Storage]: http://msdn.microsoft.com/ru-ru/library/windowsazure/hh508997.aspx
  [Схема данных для приложения службы электронной почты Azure]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-datadiagram.png
  [Обзор архитектуры приложения]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-architecture-overview.png
  [Альтернативная архитектура приложения]: ./media/cloud-services-dotnet-multi-tier-app-storage-1-overview/mtas-alternative-architecture.png
  [Калькулятор цен Azure]: http://www.windowsazure.com/ru-ru/pricing/calculator/
  [SendGrid Azure]: http://sendgrid.com/windowsazure.html
  [соглашение об уровне обслуживания облачной службы Azure, которое гарантирует 99,95 % времени безотказной работы]: https://www.windowsazure.com/ru-ru/support/legal/sla/ "соглашение об уровне обслуживания"
  [Перезапуск экземпляра роли из-за обновлений ОС]: http://blogs.msdn.com/b/kwill/archive/2012/09/19/role-instance-restarts-due-to-os-upgrades.aspx
  [CloudFx]: http://nuget.org/packages/Microsoft.Experience.CloudFx "CloudFX"
  [Пример WorkerRole.cs]: http://code.msdn.microsoft.com/windowsazure/CloudFx-Samples-60c3a852/sourcecode?fileId=57087&pathId=528472169
  [Опасность реализации повторяющихся фоновых задач в ASP.NET]: http://haacked.com/archive/2011/10/16/the-dangers-of-implementing-recurring-background-tasks-in-asp-net.aspx
  [Процедура объединения рабочей роли и веб-роли в Azure]: http://www.31a2ba2a-b718-11dc-8314-0800200c9a66.com/2010/12/how-to-combine-worker-and-web-role-in.html
  [Объединение нескольких рабочих ролей Azure в веб-роль Azure]: http://www.31a2ba2a-b718-11dc-8314-0800200c9a66.com/2012/02/combining-multiple-azure-worker-roles.html
  [запуск на веб-сайте Azure и использование функции WebJobs для задач серверной части]: http://go.microsoft.com/fwlink/?LinkId=390226
  [блока приложений автоматического масштабирования]: /ru-ru/develop/net/how-to-guides/autoscaling/
  [Удостоверение ASP.NET]: http://asp.net/identity
  [в конце последнего учебника данной серии]: /ru-ru/develop/net/tutorials/multi-tier-web-site/5-worker-role-b/#nextsteps
