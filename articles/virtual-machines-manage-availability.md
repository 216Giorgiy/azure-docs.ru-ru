<properties linkid="manage-windows-common-tasks-vm-availability" urlDisplayName="Manage Availability of VMs" pageTitle="Manage the availability of virtual machines - Azure" metaKeywords="" description="Learn how to use multiple virtual machines to ensure high availability for your Azure application. " metaCanonical="" services="virtual-machines" documentationCenter="" title="" authors="kenazk" solutions="" manager="dongill" editor="tysonn" />

<tags ms.service="virtual-machines" ms.workload="infrastructure-services" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="kenazk"></tags>

# Управление доступностью виртуальных машин

## Узнайте, чем отличается запланированное обслуживание от незапланированного

Существует два типа событий платформы Azure, которые могут воздействовать на доступность ваших виртуальных машин: запланированное и незапланированное обслуживание.

-   **События запланированного обслуживания** — это периодические обновления, осуществляемые корпорацией Майкрософт на базовой платформе Azure для улучшения общей надежности, производительности и безопасности инфраструктуры платформы, на которой работают ваши виртуальные машины. Большинство таких обновлений выполняется без какого-либо воздействия на ваши виртуальные машины или облачные службы. Тем не менее, в некоторых случаях требуется перезагрузить виртуальную машину, чтобы применить необходимые обновления к инфраструктуре платформы.

-   **События незапланированного обслуживания** происходят в тех случаях, когда в оборудовании или физической инфраструктуре, на основе которых работает виртуальная машина, происходит какая-либо ошибка. Это могут быть сбои локальной сети или локальных жестких дисков, а также другие ошибки на уровне стойки. При выявлении такой ошибки платформа Azure автоматически выполнит перенос вашей виртуальной машины с неработоспособной физической машины, где она размещена, на исправную. Это происходит редко, но также может быть причиной перезагрузки вашей виртуальной машины.

## Следуйте рекомендациям, чтобы обеспечить высокий уровень доступности разрабатываемых вами приложений

Чтобы уменьшить воздействие простоя из-за одного или нескольких из описанных здесь событий, мы рекомендуем вам выполнить на своих виртуальных машинах следующие действия по обеспечению высокого уровня доступности:

-   [Для обеспечения избыточности настройте несколько виртуальных машин в группе доступности][Для обеспечения избыточности настройте несколько виртуальных машин в группе доступности]
-   [Настройте каждый уровень приложений в отдельной группе доступности][Настройте каждый уровень приложений в отдельной группе доступности]
-   [Объедините подсистему балансировки нагрузки с группами доступности][Объедините подсистему балансировки нагрузки с группами доступности]
-   [Не оставляйте в группах доступности одиночные экземпляры виртуальных машин][Не оставляйте в группах доступности одиночные экземпляры виртуальных машин]

### Для обеспечения избыточности настройте несколько виртуальных машин в группе доступности

Чтобы обеспечить избыточность для своего приложения, мы рекомендуем сгруппировать две или больше виртуальных машин в группе доступности. Эта конфигурация обеспечит доступность не менее одной виртуальной машины и достижение показателя 99,95 % уровня обслуживания (SLA) Azure как при событиях запланированного обслуживания, так и при незапланированного. Дополнительную информацию о соглашениях об уровне обслуживания см. в разделе «Облачные службы, виртуальные машины и виртуальные сети» в [Соглашении об уровне обслуживания][Соглашении об уровне обслуживания].

Каждой виртуальной машине в вашей группе доступности базовая платформа Azure присваивает домен обновления (UD) и домен сбоя (FD). Для заданной группы доступности присваивается пять доменов обновления, без возможности изменения пользователем, чтобы указать группы виртуальных машин и базовое физическое оборудование, которые могут быть одновременно перезагружены. Если в одной группе доступности настраивается более пяти виртуальных машин, то шестая виртуальная машина будет помещена в тот же домен обновления, что первая виртуальная машина, седьмая — что и вторая, и т. д. Порядок перезагрузки доменов обновления при выполнении запланированного обслуживания может не быть последовательным, но одновременно будет перезагружаться только один домен обновления.

Домены сбоя определяют группу виртуальных машин, которые совместно используют общий источник питания и сетевой коммутатор. По умолчанию виртуальные машины, настроенные вами в группе доступности, разделяются на два домена сбоя. Внесение виртуальных машин в группу доступности не защитит ваше приложение от сбоев, вызванных операционной системой или приложениями, однако это ограничит воздействие потенциальных ошибок в работе физического оборудования, сбоев сети и прерывания электропитания.

<!--Image reference-->

![Настройка домена обновления и домена сбоя][Настройка домена обновления и домена сбоя]

### Настройте каждый уровень приложений в отдельной группе доступности

Если все виртуальные машины в вашей группе доступности примерно идентичны и служат для одной и то же цели приложения, мы рекомендуем вам настраивать по одной группе доступности для каждого уровня приложений. Если разместить два различных уровня в одной группе доступности, то все виртуальные машины на одном уровне приложений могут перезагрузиться одновременно. Настроив хотя бы по две виртуальные машины в группе доступности для каждого уровня, вы гарантируете, что хотя бы одна виртуальная машина на каждом уровне будет доступна.

Например, вы можете поместить все виртуальные машины из интерфейсной части приложения под управлением IIS, Apache, Nginx или др. в одну группу доступности. Убедитесь, что в одну группу доступности помещены только виртуальные машины из интерфейсной части. Аналогичным образом убедитесь, что в другую группу доступности помещены только виртуальные машины с уровня данных, такие как реплицированные виртуальные машины SQL Server или MySQL.

<!--Image reference-->

![Уровни приложений][Уровни приложений]

### Объедините подсистему балансировки нагрузки с группами доступности

Для получения максимальной устойчивости приложения объедините подсистему балансировки нагрузки Azure с группой доступности. Подсистема балансировки нагрузки Azure распределяет трафик между несколькими виртуальными машинами. Наши виртуальные машины стандартного уровня включают в себя подсистему балансировки нагрузки Azure. Обратите внимание, что не все уровни виртуальных машин имеют подсистему балансировки нагрузки Azure. Дополнительную информацию о балансировке нагрузки виртуальных машин см. в разделе [Балансировка нагрузки виртуальных машин][Балансировка нагрузки виртуальных машин].

Если подсистема балансировки нагрузки не настроена балансировать трафик между несколькими виртуальными машинами, то любое запланированное событие обслуживания будет оказывать воздействие на единственную виртуальную машину, обслуживающую трафик, что приведет к сбою на уровне приложений. Если поместить несколько виртуальных машин одного уровня в одну подсистему балансировки нагрузки и группу доступности, то трафик будет непрерывно обслуживаться хотя бы одним экземпляром.

### Не оставляйте в группах доступности одиночные экземпляры виртуальных машин

Избегайте ситуации, когда в группе доступности остается один экземпляр виртуальной машины. В такой конфигурации виртуальные машины не смогут обеспечивать уровень обслуживания, предусмотренный соглашением SLA, и вы столкнетесь с простоем во время выполнения запланированного обслуживания Azure. Более того, если в группе доступности развернуть только один экземпляр виртуальной машины, вы не получите какого-либо предупреждения или уведомления об обслуживании платформы. В этой конфигурации ваш одиночный экземпляр виртуальной машины будет перезагружаться без предупреждения, когда будет происходить обслуживание платформы.

  [Для обеспечения избыточности настройте несколько виртуальных машин в группе доступности]: #configure-multiple-virtual-machines-in-an-availability-set-for-redundancy
  [Настройте каждый уровень приложений в отдельной группе доступности]: #configure-each-application-tier-into-separate-availability-sets
  [Объедините подсистему балансировки нагрузки с группами доступности]: #combine-the-load-balancer-with-availability-sets
  [Не оставляйте в группах доступности одиночные экземпляры виртуальных машин]: #avoid-single-instance-virtual-machines-in-availability-sets
  [Соглашении об уровне обслуживания]: ../../../support/legal/sla/
  [Настройка домена обновления и домена сбоя]: ./media/virtual-machines-manage-availability/ud-fd-configuration.png
  [Уровни приложений]: ./media/virtual-machines-manage-availability/application-tiers.png
  [Балансировка нагрузки виртуальных машин]: ../load-balance-virtual-machines/
