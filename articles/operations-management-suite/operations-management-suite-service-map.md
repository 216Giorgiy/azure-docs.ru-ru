---
title: "Схема услуги в Operations Management Suite (OMS) | Документация Майкрософт"
description: "Схема услуги — это решение Operations Management Suite (OMS), которое автоматически обнаруживает компоненты приложений в системах Windows и Linux и сопоставляет взаимодействие между службами.  В этой статье содержатся подробные сведения о развертывании схемы услуги в вашей среде и приведены разнообразные сценарии ее использования."
services: operations-management-suite
documentationcenter: 
author: daveirwin1
manager: jwhit
editor: tysonn
ms.assetid: 3ceb84cc-32d7-4a7a-a916-8858ef70c0bd
ms.service: operations-management-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 11/18/2016
ms.author: daseidma;bwren;dairwin
translationtype: Human Translation
ms.sourcegitcommit: cbed591d15daf8060f13d0e9b009d65c85d256aa
ms.openlocfilehash: c5cd77dc53c36c4ad6c41eb876e24b4077d2007c


---

# <a name="using-service-map-solution-in-operations-management-suite-oms"></a>Использование решения схемы услуги в Operations Management Suite (OMS)
![Значок "Управление оповещениями"](media/oms-service-map/icon.png) Служба схемы услуги автоматически обнаруживает компоненты приложений в системах Windows и Linux и сопоставляет взаимодействие между службами. Это решение позволяет рассматривать серверы как взаимосвязанные системы, предоставляющие важные службы.  Схема услуги отображает сведения о подключениях между серверами, процессами и портами в любой подключенной по протоколу TCP архитектуре без дополнительной настройки. Пользователям требуется только установить агент.

В этой статье подробно описано использование схемы услуги.  Дополнительные сведения о настройке схемы услуги и соответствующих агентов подключения см. в статье [Настройка решения схемы услуги в Operations Management Suite (OMS)](operations-management-suite-service-map-configure.md).


## <a name="use-cases-make-your-it-processes-dependency-aware"></a>Сценарии использования. Обеспечение учета зависимостей в ИТ-процессах

### <a name="discovery"></a>Обнаружение
Служба схемы услуги автоматически создает общую ссылочную карту зависимостей между серверами, процессами и сторонними службами.  Она обнаруживает и сопоставляет все TCP-зависимости, определяя неожиданные подключения, удаленные сторонние системы, от которых зависит ваша система, и зависимости в традиционных "темных" областях вашей сети, например DNS и AD.  Кроме того, служба схемы услуги обнаруживает неудачные сетевые подключения пользовательских систем, что позволяет определить потенциальные неверные настройки сервера, простои служб и проблемы с сетью.

### <a name="incident-management"></a>Управление инцидентами
Схема услуги помогает быстрее изолировать проблему, предоставляя сведения о подключениях систем и их влиянии друг на друга.  Помимо сведений о неудачных попытках подключений, это решение также предоставляет информацию о подключенных клиентах, что позволяет определить неправильно настроенные подсистемы балансировки нагрузки, неожиданные или избыточные нагрузки на важные службы и неавторизованные клиенты, таких как компьютеры разработчиков, взаимодействующие с рабочими системами.  Интегрированные с решением для отслеживания изменений OMS рабочие процессы позволяют также определить, вызван ли инцидент событием изменения на внутренней виртуальной машине или во внутренней службе.

### <a name="migration-assurance"></a>Обеспечение миграции
Схема услуги позволяет эффективно спланировать, ускорить и проверить миграцию ресурсов в Azure, гарантируя полный перенос без простоев.  Пользователи могут обнаруживать все взаимозависимые системы, которые нужно переносить вместе, оценивать конфигурацию и емкость системы, а также определять, следует ли переносить систему (возможно, ее уже нужно вывести из эксплуатации).  После переноса пользователи могут проверить нагрузку и удостоверения клиента, чтобы убедиться, что тестовые системы и пользователи подключены.  Если с планированием подсети и определениями брандмауэра возникли проблемы, то на основе неудачных подключений, отображаемых на картах схемы услуги, можно определить системы, для которых требуется установить подключение.

### <a name="business-continuity"></a>Непрерывность бизнес-процессов
Если вы используете Azure Site Recovery и вам нужна помощь с определением последовательности восстановления среды приложения, служба схемы услуги может автоматически показать взаимосвязь между системами. Таким образом вы обеспечите надежный план восстановления.  Выбрав важный сервер и просмотрев его клиенты, можно определить внешние системы, которые следует восстановить только после восстановления и обеспечения доступности важного сервера.  И наоборот, просмотрев внутренние зависимости важного сервера, можно определить системы, которые необходимо восстановить только после восстановления целевой системы.

### <a name="patch-management"></a>Управление исправлениями
За счет предоставления сведений о других группах и серверах, зависящих от вашей службы, схема услуги расширяет возможности использования решения для оценки обновлений системы OMS. Это позволяет заранее уведомлять об отключении системы для установки исправлений.  Схема услуги предоставляет также дополнительные возможности управления исправлениями, отображая сведения о доступности служб и правильности их подключения после установки исправлений или перезапуска.


## <a name="mapping-overview"></a>Общие сведения о сопоставлении
Агенты схемы услуги собирают информацию обо всех подключенных по протоколу TCP процессах на сервере, где они установлены, а также сведения о входящих и исходящих подключениях для каждого процесса.  Выбрав из списка (в левой части решения схемы услуги) виртуальные машины с агентами схемы услуги, можно визуализировать их зависимости для определенного диапазона времени.  Карты зависимостей компьютеров создаются для отдельного компьютера. На них также представлены сведения обо всех компьютерах, которые являются клиентами или серверами TCP, к которым может напрямую подключиться этот компьютер.

![Обзор схемы услуги](media/oms-service-map/service-map-overview.png)

Чтобы получить сведения о выполняющихся процессах с активными сетевыми подключениями в течение определенного периода времени, компьютеры можно развернуть в представлении карты.  При развертывании карты процессов для удаленной виртуальной машины с агентом схемы услуги отображаются только те процессы, которые взаимодействуют с целевой виртуальной машиной.  Сведения о количестве подключенных к целевому компьютеру внешних компьютеров, на которых не установлены агенты, указаны слева от процессов, к которым они подключены.  Если целевая виртуальная машина подключается к внутренней виртуальной машине, на которой не развернут агент, то на карте для этой виртуальной машины отображается узел и его IPv4-адрес. Развернув этот узел, можно просмотреть отдельные порты и службы, с которыми взаимодействует целевая виртуальная машина.

По умолчанию на картах схемы услуги представлены сведения о зависимостях за последние 10 минут.  С помощью элементов управления временем, расположенных в левом верхнем углу, на карте можно запросить сведения за максимум 1 час. Так вы можете получить представление о зависимостях в прошлом, например во время инцидента или перед изменением.    В платных рабочих областях данные схемы услуги хранятся 30 дней, а в бесплатных — 7.

![Карта компьютера с выбранными свойствами](media/oms-service-map/machine-map.png)

## <a name="failed-connections"></a>Неудачные подключения
На картах схемы услуги отображаются сведения о неудачных подключениях компьютеров и процессов. Пунктирная красная линия указывает, что при подключении клиентской системы к процессу или порту произошел сбой.  Сведения о неудачных подключениях поступают из всех систем, на которых развернут агент схемы услуги и где попытка подключения завершилась сбоем.  Служба схемы услуги оценивает это за счет наблюдения за сокетами TCP, которым не удалось установить подключение.  Ошибки подключения могут быть связаны с брандмауэром, неправильными настройками клиента или сервера, а также с недоступностью удаленной службы.

![Неудачные подключения](media/oms-service-map/failed-connections.png)

Понятие причин сбоя подключений может помочь с устранением неполадок, проверкой переноса и выполнением анализа безопасности, а также разобраться, как устроена архитектура.  Иногда неудачные подключения безвредны, но зачастую они указывают на проблему, например внезапная недоступность среды отработки отказа или отсутствие взаимодействия между двумя уровнями приложения после миграции в облако.

## <a name="computer-and-process-properties"></a>Свойства компьютера или процесса
Выбрав на карте схемы услуги виртуальную машину или процесс, можно просмотреть дополнительные сведения об их свойствах.  Для виртуальных машин предоставляются сведения о DNS-имени, IPv4-адресах, мощности ЦП и объеме памяти, типе виртуальной машины, версии операционной системы, времени последнего перезапуска и идентификаторах соответствующих агентов OMS и схемы услуги.

![Свойства виртуальной машины](media/oms-service-map/machine-properties.png)

Сведения о процессах собираются на основе метаданных операционной системы. К ним относятся имя процесса, его описание, имя пользователя и домен (в Windows), название компании, имя продукта, версия продукта, рабочий каталог, командная строка и время запуска процесса.

![Свойства процесса](media/oms-service-map/process-properties.png)

На панели Process Summary (Сводные данные о процессах) приведены дополнительные сведения о подключениях процессов, в том числе привязанные порты, входящие и исходящие подключения, а также неудачные подключения.

![Панель сводных данных о процессах](media/oms-service-map/process-summary.png)

## <a name="computer-summary"></a>Сводка по компьютеру
На панели сводки по виртуальной машине представлены общие сведения об операционной системе сервера и числе зависимостей, а также разнообразные данные из других решений OMS, включая решения для метрик производительности, отслеживания изменений, защиты, управления обновлениями и т. д.

![Сводка по виртуальной машине](media/oms-service-map/machine-summary.png)

## <a name="oms-change-tracking-integration"></a>Интеграция с решением OMS "Отслеживание изменений"
Если схема услуги и отслеживание изменений включены и настроены в вашей рабочей области OMS, то они интегрируются друг с другом автоматически.

На панели Machine Change Tracking (Отслеживание изменений на компьютере) содержится список всех изменений (начиная с последнего события), а также ссылка на поиск по журналу для получения дополнительных сведений.
![Панель отслеживания изменений на компьютере](media/oms-service-map/change-tracking.png)

Ниже приведен пример детальных сведений о событии изменения конфигурации, которые отображаются после выбора команды **Show in Log Analytics** (Показать в Log Analytics).
![Событие изменения конфигурации](media/oms-service-map/configuration-change-event.png)


## <a name="oms-performance-integration"></a>Интеграция с решением для определения производительности OMS
На панели производительности виртуальной машины отображены стандартные метрики производительности для выбранного сервера.  Сюда входят метрики использования ЦП, использования памяти, числа отправленных и полученных по сети байтов, а также список основных процессов, упорядоченный по числу байтов, отправленных и полученных по сети.
![Панель отслеживания изменений на компьютере](media/oms-service-map/machine-performance.png)


## <a name="oms-security-integration"></a>Интеграция с решением для защиты OMS
Если решение схемы услуги и решение для защиты и аудита включены и настроены в вашей рабочей области OMS, то они интегрируются друг с другом автоматически.

Панель безопасности виртуальной машины отображает данные из решения для защиты и аудита OMS для выбранного сервера.  Панель отображает сводку по необработанным проблемам безопасности для сервера для выбранного диапазона времени.  Если щелкнуть какую-либо проблему безопасности, будет выполнен поиск дополнительных сведений о ней в журналах.
![Панель отслеживания изменений на компьютере](media/oms-service-map/machine-security.png)


## <a name="oms-updates-integration"></a>Интеграция с решением для управления обновлениями OMS
Если схема услуги и управлением обновлениями включены и настроены в вашей рабочей области OMS, то они интегрируются друг с другом автоматически.

Панель обновлений виртуальной машины отображает данные из решения для управления обновлениями OMS для выбранного сервера.  Панель отображает сводку по отсутствующим обновлениям для сервера для выбранного диапазона времени.
![Панель отслеживания изменений на компьютере](media/oms-service-map/machine-updates.png)


## <a name="oms-alert-integration"></a>Интеграция с решением для оповещения OMS
Схема услуги интегрируется с оповещениями OMS для отображения активированных оповещений для выбранного сервера за указанный период времени.  При наличии обновлений на сервере будет отображаться соответствующий значок, и эти обновления будут перечислены на панели оповещений виртуальной машины.

![Панель оповещений виртуальной машины](media/oms-service-map/machine-alerts.png)

Обратите внимание, что для того, чтобы решение карты услуг имело возможность отображать соответствующие оповещения, нужно создать правило генерации оповещений, срабатывающее для определенного компьютера или виртуальной машины.  Ниже описано, как правильно создавать оповещения.
- Добавьте предложение для группирования по компьютеру: "by Computer interval 1minute".
- Выберите оповещение на основе измерения метрики.

![Конфигурация оповещения](media/oms-service-map/alert-configuration.png)


## <a name="log-analytics-records"></a>Записи Log Analytics
Данные инвентаризации виртуальных машин и процессов из схемы услуги можно получить, выполнив [поиск](../log-analytics/log-analytics-log-searches.md) в Log Analytics.  Эти сведения используются в разных сценариях, таких как планирование миграции, выполнение анализа емкости, обнаружение и устранение проблем с производительностью.

Для каждой уникальной виртуальной машины и процесса создается одна запись в час. Кроме того, записи создаются во время запуска виртуальной машины или процесса, а также при подключении их к службе схемы услуги.  В таблице ниже приведены свойства этих записей.

На основе созданных в системе свойств можно определить уникальные компьютеры или процессы:

- PersistentKey_s — уникальное свойство, определенное в конфигурации процесса, например командная строка и идентификатор пользователя.  Оно уникальное для определенного компьютера, но может использоваться на нескольких компьютерах.
- ProcessId_s и ComputerId_s — глобально уникальные свойства в модели схемы услуги.



### <a name="servicemapcomputercl-records"></a>Записи ServiceMapComputer_CL
В записях типа **AdmComputer_CL** содержатся данные инвентаризации для серверов с агентами схемы услуги.  У этих записей есть свойства, приведенные в таблице ниже.

| Свойство | Описание |
|:--|:--|
| Тип | *ServiceMapComputer_CL* |
| SourceSystem | *OpsManager* |
| ComputerName_s | Имя компьютера под управлением Windows или Linux |
| CPUSpeed_d | Скорость ЦП (в МГц) |
| DnsNames_s | Список всех DNS-имен этого компьютера |
| IPv4s_s | Список всех IPv4-адресов, используемых на этом компьютере |
| IPv6s_s | Список всех IPv6-адресов, используемых на этом компьютере  (Служба схемы услуги определяет IPv6-адреса, но не обнаруживает зависимости IPv6.) |
| Is64Bit_b | Значение true или false (в зависимости от типа операционной системы) |
| MachineId_s | Внутренний идентификатор GUID, уникальный для определенной рабочей области OMS  |
| OperatingSystemFamily_s | Windows или Linux |
| OperatingSystemVersion_s | Длинная строка с версией ОС |
| TimeGenerated | Дата и время создания записи |
| TotalCPUs_d | Количество ядер ЦП |
| TotalPhysicalMemory_d | Объем памяти (в МБ) |
| VirtualMachine_b | Значение true или false (в зависимости от типа ОС гостевой виртуальной машины) |
| VirtualMachineID_g | Идентификатор виртуальной машины Hyper-V |
| VirtualMachineName_g | Имя виртуальной машины Hyper-V |
| VirtualMachineType_s | Hyperv, Vmware, Xen, Kvm, Ldom, Lpar, Virtualpc |


### <a name="servicemapprocesscl-type-records"></a>Записи типа ServiceMapProcess_CL
В записях типа **ServiceMapProcess_CL** содержатся данные инвентаризации для подключенных по протоколу TCP процессов на серверах с агентами схемы услуги.  У этих записей есть свойства, приведенные в таблице ниже.

| Свойство | Описание |
|:--|:--|
| Тип | *ServiceMapProcess_CL* |
| SourceSystem | *OpsManager* |
| CommandLine_s | Полная командная строка процесса |
| CompanyName_s | Название компании (из Windows PE или Linux RPM) |
| Description_s | Длинное описание процесса (из Windows PE или Linux RPM) |
| FileVersion_s | Версия исполняемого файла (из Windows PE, только для Windows) |
| FirstPid_d | Идентификатор процесса ОС |
| InternalName_s | Внутреннее имя исполняемого файла (из Windows PE, только для Windows) |
| MachineId_s | Внутренний идентификатор GUID, уникальный для определенной рабочей области OMS  |
| Name_s | Имя выполняемого процесса |
| Path_s | Путь файловой системы выполняемого процесса |
| PersistentKey_s | Внутренний идентификатор GUID, уникальный на этом компьютере |
| PoolId_d | Внутренний идентификатор для объединения процессов на основе схожих командных строк |
| ProcessId_s | Внутренний идентификатор GUID, уникальный для определенной рабочей области OMS  |
| ProductName_s | Строка с именем продукта (из Windows PE или Linux RPM) |
| ProductVersion_s | Строка с версией продукта (из Windows PE или Linux RPM) |
| StartTime_t | Время запуска процесса (по времени на локальном компьютере) |
| TimeGenerated | Дата и время создания записи |
| UserDomain_s | Домен владельца процесса (только для Windows) |
| UserName_s | Имя владельца процесса (только для Windows) |
| WorkingDirectory_s | Рабочий каталог процесса |


## <a name="sample-log-searches"></a>Пример поисков журналов

### <a name="list-the-physical-memory-capacity-of-all-managed-computers"></a>Вывод сведений об объеме физической памяти для всех управляемых компьютеров
Type=ServiceMapComputer_CL | select TotalPhysicalMemory_d, ComputerName_s | Dedup ComputerName_s

### <a name="list-computer-name-dns-ip-and-os-version"></a>Вывод сведений об имени компьютера, DNS-имени, IP-адресе и версии ОС
Type=ServiceMapComputer_CL | select ComputerName_s, OperatingSystemVersion_s, DnsNames_s, IPv4s_s  | dedup ComputerName_s

### <a name="find-all-processes-with-sql-in-the-command-line"></a>Поиск всех процессов с sql в командной строке
Type=ServiceMapProcess_CL CommandLine_s = \*sql\* | dedup ProcessId_s

### <a name="after-viewing-event-data-for-given-process-use-its-machine-id-to-retrieve-the-computers-name"></a>Получение имени компьютера на основе идентификатора компьютера, полученного из данных события для определенного процесса
Type=ServiceMapComputer_CL "m!m-9bb187fa-e522-5f73-66d2-211164dc4e2b" | Distinct ComputerName_s

### <a name="list-all-computers-running-sql"></a>Вывод списка всех компьютеров, на которых выполняется SQL
Type=ServiceMapComputer_CL MachineId_s IN {Type=ServiceMapProcess_CL \*sql\* | Distinct MachineId_s} | Distinct ComputerName_s

### <a name="list-of-all-unique-product-versions-of-curl-in-my-datacenter"></a>Вывод списка всех уникальных версий продукта cURL в своем центре обработки данных
Type=ServiceMapProcess_CL Name_s=curl | Distinct ProductVersion_s

### <a name="create-a-computer-group-of-all-computers-running-centos"></a>Создание группы, объединяющей все компьютеры, на которых выполняется CentOS
Type=ServiceMapComputer_CL OperatingSystemVersion_s = "CentOS" | Distinct ComputerName_s



## <a name="diagnostic-and-usage-data"></a>Данные диагностики и использования
Корпорация Майкрософт автоматически собирает данные об использовании и производительности с помощью службы схемы услуги. Эти данные используются, чтобы улучшить качество, повысить безопасность и целостность службы схемы услуги. Они включают в себя сведения о конфигурации программного обеспечения, такие как версия операционной системы, а также IP-адрес, DNS-имя и имя рабочей станции, чтобы предоставить возможности для точного и эффективного устранения неполадок. Корпорация Майкрософт не собирает сведения об именах, адресах и другую контактную информацию.

Дополнительные сведения о сборе и использовании данных см. в [заявлении о конфиденциальности служб Online Services корпорации Майкрософт](hhttps://go.microsoft.com/fwlink/?LinkId=512132).



## <a name="next-steps"></a>Дальнейшие действия
- Узнайте больше об использовании [поиска в журналах](../log-analytics/log-analytics-log-searches.md) в Log Analytics для получения данных, собранных с помощью схемы услуги.



<!--HONumber=Nov16_HO4-->


