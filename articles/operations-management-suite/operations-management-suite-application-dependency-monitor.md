<properties
   pageTitle="Монитор зависимости приложений (ADM) в Operations Management Suite (OMS) | Microsoft Azure"
   description="Монитор зависимости приложений (ADM) — это решение Operations Management Suite (OMS), которое автоматически обнаруживает компоненты приложений в системах Windows и Linux и сопоставляет взаимодействие между службами.  В этой статье содержатся подробные сведения о развертывании ADM в вашей среде и приведены разнообразные сценарии его использования."
   services="operations-management-suite"
   documentationCenter=""
   authors="daseidma"
   manager="jwhit"
   editor="tysonn" />
<tags
   ms.service="operations-management-suite"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="09/28/2016"
   ms.author="daseidma;bwren" />


# <a name="using-application-dependency-monitor-solution-in-operations-management-suite-(oms)"></a>Использование монитора зависимости приложений (ADM) в Operations Management Suite (OMS)
![Значок "Управление оповещениями"](media/operations-management-suite-application-dependency-monitor/icon.png) Монитор зависимости приложений (ADM) автоматически обнаруживает компоненты приложений в системах Windows и Linux и сопоставляет взаимодействие между службами. Это решение позволяет рассматривать серверы как взаимосвязанные системы, предоставляющие важные службы.  Монитор зависимости приложений отображает сведения о подключениях между серверами, процессами и портами в любой подключенной по протоколу TCP архитектуре без дополнительной настройки. Пользователям требуется только установить агент.

В этой статье подробно описано использование монитора зависимости приложений.  Дополнительные сведения о настройке решения ADM и соответствующих агентов см. в статье [Настройка монитора зависимости приложений в Operations Management Suite (OMS)](operations-management-suite-application-dependency-monitor-configure.md).

>[AZURE.NOTE]Сейчас доступна только закрытая предварительная версия монитора зависимости приложений.  Доступ к закрытой предварительной версии решения ADM можно запросить на странице [https://aka.ms/getadm](https://aka.ms/getadm).
>
>На время действия закрытой предварительной версии все учетные записи OMS имеют свободный доступ к решению ADM.  Узлы ADM доступны бесплатно, но данные Log Analytics для типов AdmComputer_CL и AdmProcess_CL будут тарифицироваться, как и другие решения.
>
>После выхода общедоступная предварительная версия ADM будет доступна только пользователям бесплатных и платных версий Insight and Analytics в ценовом плане OMS.  На уровне "Бесплатный" количество узлов ADM будет ограничено до 5.  Если вы используете закрытую предварительную версию и не зарегистрированы в ценовом плане OMS, при появлении общедоступной предварительной версии ADM будет отключен. 


## <a name="use-cases:-make-your-it-processes-dependency-aware"></a>Сценарии использования. Обеспечение учета зависимостей в ИТ-процессах

### <a name="discovery"></a>Обнаружение
Решение ADM автоматически создает общую справочную карту зависимостей между серверами, процессами и сторонними службами.  Оно обнаруживает и сопоставляет все TCP-зависимости, определяя неожиданные подключения, удаленные сторонние системы, от которых зависит ваша система, и зависимости в традиционных темных областях вашей сети, например DNS and AD.  Кроме того, это решение обнаруживает неудачные сетевые подключения пользовательских систем, что позволяет определить потенциальные неверные настройки сервера, простои служб и проблемы с сетью.

### <a name="incident-management"></a>Управление инцидентами
Решение ADM помогает быстрее изолировать проблему, предоставляя сведения о подключениях систем и их влиянии друг на друга.  Кроме сведений о неудачных попытках подключений, это решение также предоставляет информацию о подключенных клиентах, что позволяет определить неправильно настроенные балансировщики нагрузки, неожиданные или избыточные нагрузки на важные службы и неавторизованных клиентов, таких как компьютеры разработчиков, взаимодействующие с рабочими системами.  Интегрированные с решением OMS "Отслеживание изменений" рабочие процессы также позволяют определить, вызван ли инцидент событием изменения на внутреннем компьютере или во внутренней службе.

### <a name="migration-assurance"></a>Обеспечение миграции
Решение ADM позволяет эффективно спланировать, ускорить и проверить миграцию ресурсов в Azure, гарантируя полный перенос без простоев.  Пользователи могут обнаруживать все взаимозависимые системы, которые нужно переносить вместе, оценивать конфигурацию и емкость системы, а также определять, следует ли переносить систему (возможно, ее уже нужно вывести из эксплуатации).  После переноса пользователи могут проверить нагрузку и удостоверения клиента, чтобы убедиться, что тестовые системы и пользователи подключены.  Если с планированием подсети и определениями брандмауэра возникли проблемы, на основе неудачных подключений, отображаемых на картах ADM, можно определить системы, для которых требуется установить соединение.

### <a name="business-continuity"></a>Непрерывность бизнес-процессов
Если вы используете Azure Site Recovery и вам нужна помощь с определением последовательности восстановления среды приложения, решение ADM может автоматически показать взаимосвязь между системами. Таким образом, вы обеспечите надежный план восстановления.  Выбрав важный сервер и просмотрев его клиенты, можно определить внешние системы, которые следует восстановить только после восстановления и обеспечения доступности важного сервера.  И наоборот, просмотрев внутренние зависимости важного сервера, можно определить системы, которые необходимо восстановить только после восстановления целевой системы.

### <a name="patch-management"></a>Управление исправлениями
За счет предоставления сведений о других группах и серверах, зависящих от вашей службы, ADM расширяет возможности использования решения OMS "Оценка обновлений системы". Это позволяет заранее уведомлять об отключении системы для установки исправлений.  Решение ADM также предоставляет дополнительные возможности управления исправлениями, предоставляя сведения о доступности служб и правильности их подключения после установки исправлений или перезапуска. 


## <a name="mapping-overview"></a>Общие сведения о сопоставлении
Агенты ADM собирают информацию обо всех подключенных по протоколу TCP процессах на сервере, где они установлены, а также сведения о входящих и исходящих подключениях для каждого процесса.  Выбрав в списке компьютеров (в левой части решения ADM) компьютеры с агентами ADM, можно визуализировать их зависимости для определенного диапазона времени.  Карты зависимостей компьютеров создаются для отдельного компьютера. На них также представлены сведения обо всех компьютерах, которые являются клиентами или серверами TCP, к которым может напрямую подключиться этот компьютер.

![Общие сведения о решении ADM](media/operations-management-suite-application-dependency-monitor/adm-overview.png)

Чтобы получить сведения о выполняющихся процессах с активными сетевыми подключениями в течение определенного периода времени, компьютеры можно развернуть в представлении карты.  При развертывании карты процессов для удаленного компьютера с агентом ADM отображаются только те процессы, которые взаимодействуют с целевым компьютером.  Сведения о количестве подключенных к целевому компьютеру внешних компьютеров, на которых не установлены агенты, указаны слева от процессов, к которым они подключены.  Если целевой компьютер подключается к внутреннему компьютеру, на котором не развернут агент, на карте для этого компьютера отображается узел и его IPv4-адрес. Развернув этот узел, можно просмотреть отдельные порты и службы, с которыми взаимодействует целевой компьютер.

По умолчанию на картах ADM представлены сведения о зависимостях за последние 10 минут.  С помощью элементов управления временем, расположенных в левом верхнем углу, на карте можно запросить сведения за максимум 1 час. Так вы можете получить представление о зависимостях в прошлом, например во время инцидента или перед изменением.    В платных рабочих областях данные ADM хранятся 30 дней, а в бесплатных — 7.

![Карта компьютера с выбранными свойствами](media/operations-management-suite-application-dependency-monitor/machine-map.png)

## <a name="failed-connections"></a>Неудачные подключения
На картах ADM отображаются сведения о неудачных подключениях компьютеров и процессов. Пунктирная красная линия указывает, что при подключении клиентской системы к процессу или порту произошел сбой.  Сведения о неудачных подключениях поступают со всех систем, на которых развернут агент ADM и где попытка подключения завершилась сбоем.  Решение ADM измеряет это за счет наблюдения за сокетами TCP, которым не удалось установить подключение.  Ошибки подключения могут быть связаны с брандмауэром, неправильными настройками клиента или сервера, а также с недоступностью удаленной службы. 

![Неудачные подключения](media/operations-management-suite-application-dependency-monitor/failed-connections.png)

Понятие причин сбоя подключений может помочь с устранением неполадок, проверкой переноса и выполнением анализа безопасности, а также разобраться, как устроена архитектура.  Иногда неудачные подключения безвредны, но зачастую они указывают на проблему, например внезапная недоступность среды отработки отказа или отсутствие взаимодействия между двумя уровнями приложения после миграции в облако.  На рисунке выше IIS и WebSphere запущены, но они не могут подключиться друг к другу. 

## <a name="computer-and-process-properties"></a>Свойства компьютера или процесса
Выбрав на карте ADM компьютер или процесс, можно просмотреть дополнительные сведения об их свойствах.  Для компьютеров предоставляются сведения о DNS-имени, адресах IPv4, объеме ЦП и памяти, типе виртуальной машины, версии операционной системы, времени последнего перезапуска и идентификаторах соответствующих агентов OMS и ADM.

Сведения о процессах собираются на основе метаданных операционной системы. К ним относятся имя процесса, его описание, имя пользователя и домен (в Windows), название компании, имя продукта, версия продукта, рабочий каталог, командная строка и время запуска процесса.

![Свойства процесса](media/operations-management-suite-application-dependency-monitor/process-properties.png)

На панели Process Summary (Сводные данные о процессах) приведены дополнительные сведения о подключениях процессов, в том числе привязанные порты, входящие и исходящие подключения, а также неудачные подключения. 

![Панель сводных данных о процессах](media/operations-management-suite-application-dependency-monitor/process-summary.png)

## <a name="oms-change-tracking-integration"></a>Интеграция с решением OMS "Отслеживание изменений"
Если решения ADM и "Отслеживание изменений" включены и настроены в вашей рабочей области OMS, они интегрируются друг с другом автоматически.

На панели Machine Summary (Сводные данные о компьютерах) отображаются сведения о событиях отслеживания изменений для выбранного компьютера за определенный период времени.

![Панель сводных данных о компьютерах](media/operations-management-suite-application-dependency-monitor/machine-summary.png)

На панели Machine Change Tracking (Отслеживание изменений на компьютере) содержится список всех изменений (начиная с последнего события), а также ссылка на поиск по журналу для получения дополнительных сведений.
![Панель отслеживания изменений на компьютере](media/operations-management-suite-application-dependency-monitor/machine-change-tracking.png)

Ниже приведен пример детальных сведений о событии изменения конфигурации, которые отображаются после выбора команды **Show in Log Analytics** (Показать в Log Analytics).
![Событие изменения конфигурации](media/operations-management-suite-application-dependency-monitor/configuration-change-event.png)


## <a name="log-analytics-records"></a>Записи Log Analytics
Данные инвентаризации для компьютера и процесса ADM можно получить, выполнив [поиск](../log-analytics/log-analytics-log-searches.md) в Log Analytics.  Эти сведения используются в разных сценариях, таких как планирование миграции, выполнение анализа емкости, обнаружение и устранение проблем с производительностью. 

Для каждого уникального компьютера и процесса создается одна запись в час. Кроме того, записи создаются во время запуска компьютера или процесса, а также при добавлении их в ADM.  В таблице ниже приведены свойства этих записей. 

На основе созданных в системе свойств можно определить уникальные компьютеры или процессы:

- PersistentKey_s — уникальное свойство, определенное в конфигурации процесса, например командная строка и идентификатор пользователя.  Оно уникальное для определенного компьютера, но может использоваться на нескольких компьютерах.
- ProcessId_s and ComputerId_s — глобально уникальные свойства в модели ADM.



### <a name="admcomputer_cl-records"></a>Записи AdmComputer_CL
В записях типа **AdmComputer_CL** содержатся данные инвентаризации для серверов с агентами ADM.  У этих записей есть свойства, приведенные в таблице ниже.  

| Свойство | Описание |
|:--|:--|
| Тип | *AdmComputer_CL* |
| SourceSystem | *OpsManager* |
| ComputerName_s | Имя компьютера под управлением Windows или Linux |
| CPUSpeed_d | Скорость ЦП (в МГц) |
| DnsNames_s | Список всех DNS-имен этого компьютера |
| IPv4s_s | Список всех IPv4-адресов, используемых на этом компьютере |
| IPv6s_s | Список всех IPv6-адресов, используемых на этом компьютере  (ADM определяет IPv6-адреса, но не обнаруживает IPv6-зависимости.) |
| Is64Bit_b | Значение true или false (в зависимости от типа операционной системы) |
| MachineId_s | Внутренний идентификатор GUID, уникальный для определенной рабочей области OMS  |
| OperatingSystemFamily_s | Windows или Linux |
| OperatingSystemVersion_s | Длинная строка с версией ОС |
| TimeGenerated | Дата и время создания записи |
| TotalCPUs_d | Количество ядер ЦП |
| TotalPhysicalMemory_d | Объем памяти (в МБ) |
| VirtualMachine_b | Значение true или false (в зависимости от типа ОС гостевой виртуальной машины) |
| VirtualMachineID_g | Идентификатор виртуальной машины Hyper-V |
| VirtualMachineName_g | Имя виртуальной машины Hyper-V |
| VirtualMachineType_s | Hyperv, Vmware, Xen, Kvm, Ldom, Lpar, Virtualpc |


### <a name="admprocess_cl-type-records"></a>Записи типа AdmProcess_CL 
В записях типа **AdmProcess_CL** содержатся данные инвентаризации для подключенных по протоколу TCP процессов на серверах с агентами ADM.  У этих записей есть свойства, приведенные в таблице ниже.

| Свойство | Описание |
|:--|:--|
| Тип | *AdmProcess_CL* |
| SourceSystem | *OpsManager* |
| CommandLine_s | Полная командная строка процесса |
| CompanyName_s | Название компании (из Windows PE или Linux RPM) |
| Description_s | Длинное описание процесса (из Windows PE или Linux RPM) |
| FileVersion_s | Версия исполняемого файла (из Windows PE, только для Windows) |
| FirstPid_d | Идентификатор процесса ОС |
| InternalName_s | Внутреннее имя исполняемого файла (из Windows PE, только для Windows) |
| MachineId_s | Внутренний идентификатор GUID, уникальный для определенной рабочей области OMS  |
| Name_s | Имя выполняемого процесса |
| Path_s | Путь файловой системы выполняемого процесса |
| PersistentKey_s | Внутренний идентификатор GUID, уникальный на этом компьютере |
| PoolId_d | Внутренний идентификатор для объединения процессов на основе схожих командных строк |
| ProcessId_s | Внутренний идентификатор GUID, уникальный для определенной рабочей области OMS  |
| ProductName_s | Строка с именем продукта (из Windows PE или Linux RPM) |
| ProductVersion_s | Строка с версией продукта (из Windows PE или Linux RPM) |
| StartTime_t | Время запуска процесса (по времени на локальном компьютере) |
| TimeGenerated | Дата и время создания записи |
| UserDomain_s | Домен владельца процесса (только для Windows) |
| UserName_s | Имя владельца процесса (только для Windows) |
| WorkingDirectory_s | Рабочий каталог процесса |


## <a name="sample-log-searches"></a>Пример поисков журналов

### <a name="list-the-physical-memory-capacity-of-all-managed-computers."></a>Вывод сведений об объеме физической памяти для всех управляемых компьютеров 
Type=AdmComputer_CL | select TotalPhysicalMemory_d, ComputerName_s | Dedup ComputerName_s

![Пример запроса ADM](media/operations-management-suite-application-dependency-monitor/adm-example-01.png)

### <a name="list-computer-name,-dns,-ip,-and-os-version."></a>Вывод сведений об имени компьютера, DNS-имени, IP-адресе и версии ОС
Type=AdmComputer_CL | select ComputerName_s, OperatingSystemVersion_s, DnsNames_s, IPv4s_s | dedup ComputerName_s

![Пример запроса ADM](media/operations-management-suite-application-dependency-monitor/adm-example-02.png)

### <a name="find-all-processes-with-"sql"-in-the-command-line"></a>Поиск всех процессов с sql в командной строке
Type=AdmProcess_CL CommandLine_s = \*sql\* | dedup ProcessId_s

![Пример запроса ADM](media/operations-management-suite-application-dependency-monitor/adm-example-03.png)

### <a name="after-viewing-event-data-for-given-process,-use-its-machine-id-to-retrieve-the-computer’s-name"></a>Получение имени компьютера на основе идентификатора компьютера, полученного из данных события для определенного процесса
Type=AdmComputer_CL "m!m-9bb187fa-e522-5f73-66d2-211164dc4e2b" | Distinct ComputerName_s

![Пример запроса ADM](media/operations-management-suite-application-dependency-monitor/adm-example-04.png)

### <a name="list-all-computers-running-sql"></a>Вывод списка всех компьютеров, на которых выполняется SQL
Type=AdmComputer_CL MachineId_s IN {Type=AdmProcess_CL \*sql\* | Distinct MachineId_s} | Distinct ComputerName_s

![Пример запроса ADM](media/operations-management-suite-application-dependency-monitor/adm-example-05.png)

### <a name="list-of-all-unique-product-versions-of-curl-in-my-datacenter"></a>Вывод списка всех уникальных версий продукта cURL в своем центре обработки данных
Type=AdmProcess_CL Name_s=curl | Distinct ProductVersion_s

![Пример запроса ADM](media/operations-management-suite-application-dependency-monitor/adm-example-06.png)

### <a name="create-a-computer-group-of-all-computers-running-centos"></a>Создание группы, объединяющей все компьютеры, на которых выполняется CentOS

![Пример запроса ADM](media/operations-management-suite-application-dependency-monitor/adm-example-07.png)



## <a name="diagnostic-and-usage-data"></a>Данные диагностики и использования
Корпорация Майкрософт автоматически собирает данные об использовании и производительности с помощью службы монитора зависимости приложений. Эти данные используются, чтобы улучшить качество, повысить безопасность и целостность службы монитора зависимости приложений. Они включают в себя сведения о конфигурации программного обеспечения, такие как версия операционной системы, а также IP-адрес, DNS-имя и имя рабочей станции, чтобы предоставить возможности для точного и эффективного устранения неполадок. Корпорация Майкрософт не собирает сведения об именах, адресах и другие контактные сведения.

Дополнительные сведения о сборе и использовании данных см. в [заявлении о конфиденциальности служб Online Services корпорации Майкрософт](hhttps://go.microsoft.com/fwlink/?LinkId=512132).



## <a name="next-steps"></a>Дальнейшие действия
- Узнайте подробнее о [поиске по журналу](../log-analytics/log-analytics-log-searches.md] in Log Analytics to retrieve data collected by Application Dependency Monitor.).



<!--HONumber=Oct16_HO2-->


