<properties linkid="manage-services-hdinsight-hbase-get-started-hdinsight-hadoop" urlDisplayName="Get Started" pageTitle="Get started using HBase with Hadoop in HDInsight | Azure" metaKeywords="" description="Get started using HBase with Hadoop in HDInsight. learn how to created HBase tables and query them with Hive." metaCanonical="" services="hdinsight" documentationCenter="" title="Get started using HBase with Hadoop in HDInsight" authors="bradsev" solutions="big-data" manager="paulettm" editor="cgronlun" />

<tags ms.service="hdinsight" ms.workload="big-data" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="08/21/2014" ms.author="bradsev"/>

# Начало работы с использованием HBase с Hadoop в HDInsight

HBase — это база данных NoSQL с низким уровнем задержки, позволяющая производить транзакционную обработку больших объемов данных. HBase предлагается в форме управляемого кластера, интегрированного в среду Azure. Кластеры настроены на хранение данных непосредственно в хранилище BLOB-объектов Azure, что обеспечивает небольшую задержку и повышенную гибкость в выборе соотношения производительность/стоимость. Это позволяет клиентам создавать интерактивные веб-сайты, работающие с большими наборами данных, создавать службы, которые хранят данные с датчиков и телеметрию миллионов конечных точек, и анализировать эти данные с помощью заданий Hadoop.

В этом уроке вы узнаете, как создавать и формировать запросы к таблицам HBase с HDInsight. Описаны следующие процедуры:

-   Подготовка кластера HBase с использованием портала Azure.
-   Добавление и использование удаленного рабочего стола для доступа к оболочке HBase, использование оболочки HBase для создания таблицы HBase, добавления строк и вывода строк таблицы.
-   Создание таблицы Hive, которая сопоставляется существующей таблице HBase, использование HiveQL для формирования запросов к таблице HBase.
-   Использование пакета SDK для .NET для создания новой таблицы HBase, вывод списка таблиц HBase в учетной записи, добавление и получение содержимого строк из таблиц.

> [WACOM.NOTE] В настоящее время HBase доступна только в предварительной версии для использования с кластерами HDInsight 3.0 на HDInsight (на базе Hadoop 2.2.0). Для получения информации о версиях ПО см. раздел [Новые возможности версий кластеров, предоставляемых HDInsight.][]

Во время периода использования предварительной версии рекомендуется хранить резервную копию рабочей версии любых данных, которые используются в кластере HBase, за его пределами. Причина в том, что формат файлов базы данных в следующих версиях может измениться, и текущий формат данных, используемый в предварительной версии, может не поддерживаться или не конвертироваться в последующие версии.

**Предварительные требования:**

Перед началом работы с этим учебником необходимо иметь следующее:

-   Подписка Azure. Дополнительные сведения о получении подписки см. в разделах [Варианты приобретения][], [Предложения для участников][] или [Бесплатное пробное использование][].
-   Учетная запись хранения Azure. Инструкции см. в разделе [Создание учетной записи хранения][].
-   Установленная Visual Studio.

**Предполагаемое время выполнения:**30 минут

## В этом учебнике рассматриваются следующие темы:

-   [Подготовка кластера HBase на портале Azure][]
-   [Создание примера таблицы HBase в оболочке HBase][]
-   [Использование Hive для формирования запросов к таблице HBase][]
-   [Использование интерфейсов API HBase для C# для создания таблицы HBase и получения из 	 нее данных][Использование интерфейсов API HBase для C# для создания таблицы HBase и получения из нее данных]
-   [Сводка][]

## <a name="create-hbase-cluster"></a>Подготовка кластера HBase на портале Azure

В данном разделе описана подготовка кластера HBase с использованием портала Azure.

**Чтобы подготовить кластер HBase на портале Azure:**

1.  Выполните вход на [портал управления Azure][].

2.  щелкните **HDInsight** слева от списка состояний кластеров в вашей учетной записи, затем щелкните значок **+NEW** слева внизу;

    ![](http://i.imgur.com/PmGynKZ.jpg)

3.  щелкните значок HDInsight во втором столбце слева и параметр HBase в следующем столбце; укажите значения ИМЯ КЛАСТЕРА и РАЗМЕР КЛАСТЕРА, имя учетной записи хранения и пароль для нового кластера HBase;

    ![][1]

4.  щелкните значок галочки слева внизу для создания кластера HBase.

## <a name="create-sample-table"></a>Создание примера таблицы HBase в оболочке HBase

В данном разделе описано добавление и использование удаленного рабочего стола для доступа к оболочке HBase, использование оболочки HBase для создания таблицы HBase, добавления строк и вывода строк таблицы.

Предполагается, что описанная в первом разделе процедура вами выполнена и у вас уже имеется успешно созданный кластер HBase.

**Включение подключения к удаленному рабочему столу для кластера HBase**

1.  Чтобы включить возможность подключения к удаленному рабочему столу для кластера HDInsight, выберите созданный вам кластер HBase и щелкните вкладку **КОНФИГУРАЦИЯ**. Щелкните кнопку **ВКЛЮЧИТЬ УДАЛЕННЫЙ ДОСТУП** внизу страницы, чтобы включить возможность подключения к удаленному рабочему столу кластера.
2.  Введите учетные данные и дату прекращения в мастере **НАСТРОЙКА УДАЛЕННОГО РАБОЧЕГО СТОЛА**, щелкните круг с галочкой справа внизу. (Эта операция может занять несколько минут.)
3.  Чтобы подключиться к кластеру HDInsight, щелкните кнопку **ПОДКЛЮЧИТЬ** в нижней части вкладки **КОНФИГУРАЦИЯ**.

**Откройте оболочку HBase**

1.  В сеансе удаленного рабочего стола щелкните по ссылке **Командная строка Hadoop**, расположенной на Рабочем столе.

2.  Измените папку на домашнюю папку HBase:

        cd %HBASE_HOME%\bin

3.  Откройте оболочку HBase:

        hbase shell

**Создание таблицы, добавление и извлечение данных**

1.  Создание таблицы:

        create 'sampletable', 'cf1'

2.  Добавление строки в таблицу:

        put 'sampletable', 'row1', 'cf1:col1', 'value1'

3.  Вывод списка строк в таблице:

        scan 'sampletable'

## <a name="hive-query"></a>Использование Hive для формирования запросов к таблице HBase

Теперь, когда вы подготовили кластер HBase и создали таблицу, вы можете запросить его с помощью Hive. В данном разделе будет создана таблица Hive, которая сопоставляется существующей таблице HBase и используется для формирования запросов к таблице HBase.

**Чтобы открыть панель мониторинга кластера**

1.  Выполните вход на [портал управления Azure][].
2.  На левой панели щелкните **HDINSIGHT**. Вы увидите список созданных кластеров, включая только что созданный в последнем разделе.
3.  Щелкните имя кластера, в котором вы хотите запустить задание Hive.
4.  Щелкните **УПРАВЛЕНИЕ КЛАСТЕРОМ** внизу страницы, чтобы открыть панель мониторинга кластера. В новой вкладке браузера откроется веб-страница.
5.  Введите имя пользователя и пароль учетной записи Hadoop. По умолчанию имя пользователя **admin**, пароль вы вводили в процессе подготовки. Панель мониторинга имеет следующий вид:

    ![][2]

**Чтобы выполнить запрос Hive**

1.  Чтобы создать таблицу Hive с отображением на таблицу HBase, введите приведенный ниже сценарий HiveQL в окне консоли Hive и нажмите кнопку **ОТПРАВИТЬ**. Убедитесь, что вы создали упомянутую таблицу в HBase с помощью оболочки HBase перед выполнением этого сценария.

        SET hbase.zookeeper.quorum=zookeepernode0,zookeepernode1,zookeepernode2;  
        CREATE EXTERNAL TABLE hbasesampletable(rowkey STRING, col1 STRING, col2 STRING)
        STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'
        WITH SERDEPROPERTIES ('hbase.columns.mapping' = ':key,cf1:col1,cf1:col2')
        TBLPROPERTIES ('hbase.table.name' = 'sampletable');

2.  Чтобы выполнить запрос Hive к данным в HBase, введите приведенный ниже сценарий HiveQL в окне консоли Hive и нажмите кнопку **SUBMIT**.

        SET hbase.zookeeper.quorum=zookeepernode0,zookeepernode1,zookeepernode2;
        SET hive.aux.jars.path=file:///C:/Apps/dist/hive-0.12.0.2.0.9.0-1677/lib/hive-hbase-handler-0.12.0.2.0.9.0-1677.jar,file:///C:/Apps/dist/hive-0.12.0.2.0.9.0-1677/lib/hbase-server-0.96.0.2.0.9.0-1677-hadoop2.jar,file:///C:/Apps/dist/hive-0.12.0.2.0.9.0-1677/lib/hbase-protocol-0.96.0.2.0.9.0-1677-hadoop2.jar,file:///C:/Apps/dist/hive-0.12.0.2.0.9.0-1677/lib/htrace-core-2.01.jar,file:///C:/Apps/dist/hive-0.12.0.2.0.9.0-1677/lib/hbase-client-0.96.0.2.0.9.0-1677-hadoop2.jar,file:///C:/Apps/dist/hive-0.12.0.2.0.9.0-1677/lib/guava-12.0.1.jar;
        SELECT count(*) FROM hbasesampletable;

3.  Для получения результата запроса Hive щелкните ссылку **Подробнее** в окне **Сеанс задания** после окончания выполнения задания.

Примечание. Ссылка на оболочку HBase переключает вкладку на **Оболочка HBase**.

**Для просмотра файла с результатами**

1.  В верхней части панели мониторинга щелкните **Файлы**.
2.  Щелкните **Templeton-Job-Status**.
3.  Щелкните номер GUID, у которого указано самое последнее время изменения, чуть больше времени запуска задания, которые вы записали ранее. Запишите этот GUID. Он понадобится в следующем разделе.
4.  В файле **stdout** содержатся данные, которые потребуются в следующем разделе. Вы можете щелкнуть **stdout** для загрузки копии данных, если хотите.

## <a name="hbase-powershell"></a>Использование интерфейсов API HBase для C# для создания таблицы HBase и получения из нее данных

Marlin представляет собой тонкую надстройку поверх интерфейса API REST, которая взаимодействует с HBase с использованием ProtoBuf в C\#. Проект Marlin необходимо загрузить с github и собрать его для использования с пакетом SDK HBase .NET.

1.  Выполните шаги по сборке, описанные на странице загрузки проекта [страницы проекта Marlin][]. Распакуйте его в локальную папку.

2.  Откройте проект в Visual Studio. Откройте мастер диспетчера пакетов NuGet, выбрав меню **СЕРВИС** -\> **Диспетчер пакетов библиотеки** и **Управление пакетами NuGet для решения ...**

    ![][3]

3.  В расположенном справа вверху поле «Поиск в Интернете» найдите пакет protobuf-net и установите версию v2.0.0.68. Создайте проект Marlin, щелкнув правой кнопкой мыши проект **Marlin** в **обозревателе решений** и выбрав **Создать**.

4.  Добавьте в ваш проект C# полученную в результате библиотеку marlin.dll.

5.  Создайте новый экземпляр Marlin с использованием учетных данных кластера и получите его версию:

        var credentials = ClusterCredentials.Create("https://yourclustername.azurehdinsight.net/", "user", "password");
            var marlin = new Marlin(credentials);
        // retrieve the version as a test
        var version = marlin.GetVersion();
        Console.WriteLine(version);

6.  Чтобы получить список таблиц в кластере, вы можете использовать следующий код:

        var tables = marlin.ListTables();
        foreach(var tableName in tables.name) 
                Console.WriteLine(tableName);

7.  Чтобы создать новую таблицу HBase, используйте этот код:

        var schema = new TableSchema();
        schema.name = "sampletable";
        schema.columns.Add(new ColumnSchema() { name = "cf1" });
        schema.columns.Add(new ColumnSchema() { name = "cf2" });
        marlin.CreateTable(schema);

8.  Для извлечения строки по ее ключу укажите имя таблицы и ключ строки для извлечения значения строки.

        var cells = marlin.GetCells("sampletable", "row1");
        var row = cells.rows[0];
            foreach(var val in row.values) 
            {
               Console.WriteLine(Encoding.UTF8.GetString(val.data));
            }

9.  Чтобы сохранить новую строку данных, можно использовать следующий код:

        CellSet set = new CellSet();
        CellSet.Row row = new CellSet.Row() { key = BitConverter.GetBytes(1337) };
            var value = new Cell()
                    {
                        column = Encoding.UTF8.GetBytes("cf1:d"),
                        data = Encoding.UTF8.GetBytes("Hello World!")
                    };
            row.values.Add(value);
            set.rows.Add(row);
        marlin.StoreCells("sampletable", set);

## <a name="summary"></a>Сводка

В этом уроке вы узнали, как подготовить кластер HBase, как создавать таблицы и просматривать данные в этих таблицах из оболочки HBase. Вы также узнали, как использовать Hive для запроса данных из таблиц HBase и как использовать API-интерфейсы HBase C# для создания и извлечения данных из таблицы HBase.

  [Новые возможности версий кластеров, предоставляемых HDInsight.]: ../hdinsight-component-versioning/
  [Варианты приобретения]: http://azure.microsoft.com/en-us/pricing/purchase-options/
  [Предложения для участников]: http://azure.microsoft.com/en-us/pricing/member-offers/
  [Бесплатное пробное использование]: http://azure.microsoft.com/en-us/pricing/free-trial/
  [Создание учетной записи хранения]: http://azure.microsoft.com/ru-ru/documentation/articles/storage-create-storage-account/
  [Подготовка кластера HBase на портале Azure]: #create-hbase-cluster
  [Создание примера таблицы HBase в оболочке HBase]: #create-sample-table
  [Использование Hive для формирования запросов к таблице HBase]: #hive-query
  [Использование интерфейсов API HBase для C# для создания таблицы HBase и получения из нее данных]: #hbase-powershell
  [Сводка]: #summary
  [портал управления Azure]: https://manage.windowsazure.com/
   
  [1]: http://i.imgur.com/ecxbB9K.jpg
  [2]: http://i.imgur.com/tMwXlj9.jpg
  [страницы проекта Marlin]: https://github.com/thomasjungblut/marlin
  [3]: http://i.imgur.com/hUNoJDJ.jpg
