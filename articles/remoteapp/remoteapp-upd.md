---
title: "Как Azure RemoteApp сохраняет данные и параметры пользователя? | Документация Майкрософт"
description: "Узнайте, как Azure RemoteApp сохраняет пользовательские данные с помощью диска профиля пользователя."
services: remoteapp
documentationcenter: 
author: msmbaldwin
manager: mbaldwin
ms.assetid: e125af62-5c1a-4186-a238-52f537f7bb34
ms.service: remoteapp
ms.workload: compute
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 11/23/2016
ms.author: mbaldwin
translationtype: Human Translation
ms.sourcegitcommit: 5cce99eff6ed75636399153a846654f56fb64a68
ms.openlocfilehash: e1a1848bac1cb339569b813ae5c5e214e1ec2409
ms.lasthandoff: 03/31/2017


---
# <a name="how-does-azure-remoteapp-save-user-data-and-settings"></a>Как Azure RemoteApp сохраняет данные и параметры пользователя?
> [!IMPORTANT]
> Мы выводим службу Azure RemoteApp из эксплуатации 31 августа 2017 года. Дополнительные сведения см. в [объявлении](https://go.microsoft.com/fwlink/?linkid=821148).
> 
> 

Azure RemoteApp сохраняет удостоверения и настройки пользователя для различных устройств и сеансов. Такие данные пользователей хранятся на диске для каждой коллекции и для каждого пользователя, который называется диском профиля пользователя (UPD). Диск привязан к пользователю и гарантирует наличие согласованного интерфейса для него, независимо от того, где выполняется вход в систему.

Диски профилей пользователей полностью прозрачны для пользователя — пользователи сохраняют документы в своей папке Документы (на локальном диске) и изменяют свои параметры приложения обычным образом. В то же время, при подключении к Azure RemoteApp с любого устройства все личные настройки сохраняются. Пользователь только видит, что его данные находятся в том же месте.

Каждый UPD имеет 50 ГБ памяти для постоянного хранения и содержит как данные пользователя, так и параметры приложения. 

Чтение конкретных сведений в данных профиля пользователя.

> [!NOTE]
> Отключение UPD Сведения о том, как это сделать, см. в записи блога Pavithra [Disable User Profile Disks (UPDs) in Azure RemoteApp](https://blogs.technet.microsoft.com/enterprisemobility/2015/11/11/disable-user-profile-disks-upds-in-azure-remoteapp/) (Отключение дисков профилей пользователей в Azure RemoteApp).
> 
> 

## <a name="how-can-an-admin-get-to-the-data"></a>Как администратор может получить доступ к данным?
Если вам требуется доступ к данным одного из своих пользователей (для аварийного восстановления или если пользователь покидает компанию), обратитесь в службу поддержки Azure и предоставьте сведения о подписке для коллекции и идентификации пользователя. Команда Azure RemoteApp предоставит вам URL-адрес для загрузки VHD. Загрузите VHD по ссылке и извлеките документы и файлы, которые вам потребуются. Обратите внимание, что VHD имеет размер 50 ГБ, поэтому для его загрузки потребуется некоторое время.

## <a name="is-the-data-backed-up"></a>Выполняется ли резервное копирование данных?
Да, мы сохраняем резервную копию данных пользователя для каждого географического расположения. Данные доступны только для чтения. Обращаться к ним можно точно так же, как к обычным данным (обратитесь к Azure RemoteApp, чтобы получить сведения о процедуре доступа), если основной ЦОД не работает. Данные копируются в режиме реального времени в папку резервного копирования. Мы не храним копии различных версий. Таким образом, при повреждении данных мы не сможем восстановить предыдущую известную рабочую версию, однако если основной ЦОД не будет работать, вы сможете получить данные пользователя из другого расположения.

## <a name="how-do-users-see-the-upd-on-the-server-side"></a>Каким образом пользователи видят UPD на стороне сервера?
Каждый пользователь будет иметь свой собственный каталог на сервере, который соответствует его имени пользователя — UPD: c:\Users\имя_пользователя.

## <a name="whats-the-best-way-to-use-outlook-and-upd"></a>Как лучше всего использовать Outlook и UPD?
Azure RemoteApp сохраняет состояние Outlook (почтовые ящики, PST-файлы) между сеансами. Для этого нужно сохранить PST-файл в данных профиля пользователя (C:\users\<имя_пользователя>). Это расположение по умолчанию для данных. Следовательно, если это расположение не изменяется, данные будут сохраняться между сеансами.

Также рекомендуем использовать «кэшированный» режим в Outlook, а также режим server/online для поиска.

Дополнительные сведения об использовании Outlook и Azure RemoteApp см. в [этой статье](remoteapp-outlook.md).

## <a name="what-about-redirection"></a>Поддерживается ли перенаправление?
Azure RemoteApp можно настроить так, чтобы пользователи имели возможность доступа к локальным устройствам путем настройки [перенаправления](remoteapp-redirection.md). В результате локальные устройства будут иметь доступ к данным на UPD.

## <a name="can-i-use-my-upd-as-a-network-share"></a>Можно ли использовать мой диск UPD в качестве общей сетевой папки?
Нет. Диски UPD не могут использоваться в качестве общей сетевой папки. Диск UPD доступен пользователю, только если пользователь постоянно подключен к Azure RemoteApp.

## <a name="if-i-delete-a-user-from-a-collection-is-their-upd-deleted"></a>Если удалить пользователя из коллекции, удаляется ли также и его диск UPD?
Нет, при удалении пользователя мы не удаляем UPD автоматически. Вместо этого мы храним данные до тех пор, пока не будет удалена коллекция. Через 90 дней после удаления коллекции мы удалим все диски UPD. 

Если вам необходимо удалить диск UPD из коллекции, обратитесь в службу Azure RemoteApp — мы сможем сами удалить нужный диск UPD.

## <a name="can-i-access-my-users-upds-either-current-or-deleted-users"></a>Можно ли получить доступ к дискам UPD моих пользователей (текущих или удаленных пользователей)?
Да, при обращении в службу [Azure RemoteApp](mailto:remoteappforum@microsoft.com)мы сможем настроить для вас соответствующий URL-адрес для доступа к данным. Вы получите около 10 часов на загрузку любых данных или файлов с диска UPD, а затем доступ окажется невозможен.

## <a name="are-upds-available-offline"></a>Доступны ли диски UPD в автономном режиме (вне сети)?
Сейчас мы не предоставляем автономный доступ к дискам UPD вне 10-часового окна доступа, описанного выше. Это означает, что в настоящее время мы не можем предоставить вам более длительный доступ для выполнения более сложных задач, например для запуска антивирусных программ на дисках UPD или доступа к данным для проведения аудита.

## <a name="do-registry-key-settings-persist"></a>Сохраняются ли параметры раздела реестра?
Да, все записи в HKEY_Current_User является частью UPD.

## <a name="can-i-disable-upds-for-a-collection"></a>Можно ли отключить диски UPD для коллекции?
Да, вы можете попросить удаленное приложение Azure RemoteApp отключить диски UPD для подписки, но не сможете выполнить отключение самостоятельно. Это означает, что диски UPD будут отключены для всех коллекций в подписке.

Отключение UPD может потребоваться в следующих ситуациях: 

* Вам необходим полный доступ и контроль пользовательских данных (для целей аудита и проверки, например, для финансовых учреждений).
* На компьютере установлены сторонние решения для управления профилями пользователей и вы хотите и дальше использовать их в развертывании Azure RemoteApp, присоединенном к домену. Для этого в эталонный образ необходимо загрузить агент профилей. 
* Вам не требуется локальное хранилище данных либо все ваши данные хранятся в облаке или в общей папке, и вы хотели бы локально управлять сохранением данных с помощью Azure RemoteApp.

Дополнительные сведения см. в записи блога [Disable User Profile Disks (UPDs) in Azure RemoteApp](https://blogs.technet.microsoft.com/enterprisemobility/2015/11/11/disable-user-profile-disks-upds-in-azure-remoteapp/) (Отключение дисков профилей пользователей в Azure RemoteApp).

## <a name="can-i-restrict-users-from-saving-data-to-the-system-drive"></a>Можно ли запретить пользователям сохранять данные на системном диске?
Да, но вам потребуется настроить эту функцию в образе шаблона перед созданием коллекции. Чтобы заблокировать доступ к системному диску, выполните следующие действия.

1. Запустите **gpedit.msc** в образе шаблона.
2. Выберите **Конфигурация пользователя > Административные шаблоны > Компоненты Windows > Explorer**.
3. Выберите следующие параметры.
   * **Скрыть выбранные диски на моем компьютере**
   * **Запретить доступ к дискам с моего компьютера**

## <a name="can-i-seed-upds-i-want-to-put-some-data-in-the-upd-thats-available-the-first-time-the-user-signs-in"></a>Могу ли я загружать данные на диски UPD? Я хочу загрузить некоторые данные на диск UPD, который будет доступен при первом входе пользователя в систему.
Да, при создании образа шаблона вы можете добавить сведения в профиль по умолчанию. Затем эти сведения добавляются на UPD.

## <a name="can-i-change-the-size-of-the-upd-depending-on-how-much-data-i-want-to-store"></a>Можно ли изменять размер диска UPD в зависимости от объема данных, которые нужно сохранять?
Нет, все диски UPD имеют емкость 50 ГБ. Если вы хотите хранить различные объемы данных, попробуйте следующий вариант.

1. Отключите диски UPD для коллекции.
2. Настройте доступ к общей папке для пользователей.
3. Загрузите общую папку с помощью сценария запуска. Дополнительные сведения о сценариях запуска в Azure RemoteApp см. ниже.
4. Предложите пользователям сохранять все данные в общей папке.

## <a name="how-do-i-run-a-startup-script-in-azure-remoteapp"></a>Как выполнить сценарий запуска в Azure RemoteApp?
Если необходимо выполнить сценарий запуска, начните с создания запланированной задачи в образе шаблона, который будет использоваться для коллекции. (Сделайте это *до* запуска sysprep.) 

![Создание системной задачи](./media/remoteapp-upd/upd1.png)

![Создайте системную задачу, которая запускается при входе пользователя в систему](./media/remoteapp-upd/upd2.png)

На вкладке **Общие** не забудьте изменить **учетную запись пользователя** в разделе "Безопасность" на BUILTIN\Users.

![Изменение учетной записи пользователя на группу](./media/remoteapp-upd/upd4.png)

Запланированная задача выполнит сценарий запуска с помощью учетных данных пользователя. Запланируйте выполнение задачи при каждом входе пользователя в систему.

![Установите триггер для задачи со значением «При входе в систему»](./media/remoteapp-upd/upd3.png)

Можно также использовать [Сценарии запуска на основе групповой политики](https://technet.microsoft.com/library/cc779329%28v=ws.10%29.aspx). 

## <a name="what-about-placing-a-startup-script-in-the-start-menu-would-that-work"></a>Что будет, если поместить сценарий запуска в меню «Пуск»? Это будет работать?
Другими словами, можно ли создать BAT-файл, который будет запускать сценарий окна настройки, и сохранить его в папке c:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp? Будет ли этот сценарий выполняться при каждом запуске пользователем сеанса RemoteApp?

Нет, Azure RemoteApp такую возможность не поддерживает, так как использует RDSH. Возможность выполнения сценариев запуска в меню «Пуск» также не поддерживается.

## <a name="can-i-use-mstscexe-the-remote-desktop-program-to-configure-logon-scripts"></a>Можно ли использовать mstsc.exe (программу удаленного рабочего стола) для настройки сценариев входа в систему?
Нет, это не поддерживается в Azure RemoteApp.

## <a name="can-i-store-data-on-the-vm-locally"></a>Можно ли хранить данные на виртуальной машине локально?
Нет, данные, хранящиеся на виртуальной машине в любом месте, отличном от UPD, будут потеряны. Существует большая вероятность, что при следующем входе в Azure RemoteApp пользователь не получит ту же самую виртуальную машину. Мы не поддерживаем сохранение виртуальной машины пользователя, поэтому пользователь не будут входить в ту же виртуальную машину, и данные будут потеряны. Кроме того, при обновлении коллекции существующие виртуальные машины заменяются новыми; это означает, что все данные, хранящиеся на самой виртуальной машине, теряются. Рекомендуется хранить данные на диске UPD, в общем хранилище, таком как служба файлов Azure, на файловом сервере в виртуальной сети или в облаке, используя облачную систему хранения, например DropBox.

## <a name="how-do-i-mount-an-azure-file-share-on-a-vm-using-powershell"></a>Как подключить общую папку Azure на виртуальной машине с помощью PowerShell?
Вы можете использовать командлет Net-PSDrive для подключения диска следующим образом:

    New-PSDrive -Name <drive-name> -PSProvider FileSystem -Root \\<storage-account-name>.file.core.windows.net\<share-name> -Credential :<storage-account-name>


Можно также сохранить свои учетные данные, выполнив следующее:

    cmdkey /add:<storage-account-name>.file.core.windows.net /user:<storage-account-name> /pass:<storage-account-key>


Это позволит вам пропускать параметр -Credential в командлете New-PSDrive.


