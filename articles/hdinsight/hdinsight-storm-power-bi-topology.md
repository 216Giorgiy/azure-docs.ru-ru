<properties
 pageTitle="Запись данных в Power BI из Apache Storm | Microsoft Azure"
 description="Запись данных в Power BI из топологии C#, работающей в кластере Apache Storm в HDInsight. Также создание отчета и панели мониторинга в режиме реального времени с помощью Power BI."
 services="hdinsight"
 documentationCenter=""
 authors="Blackmist"
 manager="paulettm"
 editor="cgronlun"
	tags="azure-portal"/>

<tags
 ms.service="hdinsight"
 ms.devlang="dotnet"
 ms.topic="article"
 ms.tgt_pltfrm="na"
 ms.workload="big-data"
 ms.date="07/17/2015"
 ms.author="larryfr"/>

# Использование средств Power BI (предварительная версия) для визуализации данных из топологии Apache Storm

Предварительная версия Power BI позволяет визуально представлять данные в виде отчетов или панелей мониторинга. С помощью API REST Power BI вы можете легко использовать в Power BI данные из топологии в кластере Apache Storm в HDInsight.

В этом документе объясняется, как использовать Power BI для создания отчетов и панелей мониторинга на основе данных, созданных топологией Storm.

## Предварительные требования

- Подписка Azure. См. [Бесплатная пробная версия Azure](http://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/).

* Пользователь Azure Active Directory с доступом к [Power BI](https://powerbi.com)

* Одна из следующих версий Visual Studio:

    * Visual Studio 2012 с [обновлением 4](http://www.microsoft.com/download/details.aspx?id=39305)

    * Visual Studio 2013 с [обновлением 4](http://www.microsoft.com/download/details.aspx?id=44921) или [Visual Studio 2013 Community](http://go.microsoft.com/fwlink/?linkid=517284&clcid=0x409)

    * Visual Studio 2015, [CTP-версия 6](http://visualstudio.com/downloads/visual-studio-2015-ctp-vs)

* Средства HDInsight для Visual Studio: сведения об установке см. в статье [Начало работы со средствами HDInsight для Visual Studio](../HDInsight/hdinsight-hadoop-visual-studio-tools-get-started.md).

## Принцип работы

Этот пример содержит топологию Storm C#, которая случайным образом создает предложение, разбивает его на слова, подсчитывает их и отправляет результат в API REST Power BI. Для взаимодействия с Power BI используется пакет NuGet [PowerBi.Api.Client](https://github.com/Vtek/PowerBI.Api.Client).

Следующие файлы в этом проекте реализуют функции, относящиеся к Power BI:

* **PowerBiBolt.cs**: реализует "сито" Storm, которое отправляет данные в Power BI.

* **Data.cs**: описывает объект или строку данных, которые будет отправляться в Power BI.

> [AZURE.WARNING]В некоторых случаях Power BI позволяет создавать несколько наборов данных с одним и тем же именем. Это может произойти, если набор данных не существует, а топология создает несколько экземпляров "сита" Power BI. Чтобы избежать этого, задайте для подсказки по параллелизму "сита" значение 1 (как в этом примере) или создайте набор данных перед развертыванием топологии.
>
> Консольное приложение **CreateDataset**, включенное в это решение, предоставляется в качестве примера того, как можно создать набор данных за пределами топологии.

## Регистрация приложения Power BI

1. Следуйте указаниям в [кратком руководстве по Power BI](https://msdn.microsoft.com/ru-ru/library/dn931989.aspx) для регистрации в Power BI.

2. Создайте регистрацию приложения, выполнив инструкции в статье [Регистрация приложения](https://msdn.microsoft.com/ru-ru/library/dn877542.aspx). Она будет использоваться при доступе к API REST Power BI.

    > [AZURE.IMPORTANT]Сохраните **идентификатор клиента** для регистрации приложения.

## Скачивание примера

Скачайте [пример Power BI с HDInsight C# Storm](https://github.com/Blackmist/hdinsight-csharp-storm-powerbi). Для этого скопируйте или клонируйте его с помощью [git](http://git-scm.com/) либо используйте ссылку **Скачать**, чтобы скачать ZIP-файл архива.

## Настройка примера

1. Откройте пример в Visual Studio. В **обозревателе решений** откройте файл **SCPHost.exe.config**, а затем найдите элемент **<OAuth .../>**. Введите значения для следующих свойств этого элемента:

    * **Клиент**: идентификатор клиента для регистрации приложения, который вы создали ранее.

    * **Пользователь**: учетная запись Azure Active Directory, имеющая доступ к Power BI.

    * **Пароль**: пароль для учетной записи Azure Active Directory

2. (необязательно). По умолчанию этот проект использует имя набора данных **Words**. Чтобы изменить его, щелкните правой кнопкой мыши проект **WordCount** в **обозревателе решений**, а затем выберите **Свойства** и **Параметры**. Укажите нужное значение для записи **DatasetName**.

2. Сохраните и закройте файлы.

## Развертывание примера

1. В **обозревателе решений** щелкните правой кнопкой мыши проект **WordCount** и выберите **Отправить в Storm в HDInsight**. Выберите кластер HDInsight в раскрывающемся меню **Кластер Storm**.

    > [AZURE.NOTE]Имена серверов могут появиться в раскрывающемся меню **Кластер Storm** только через несколько секунд.
    >
    > При появлении запроса введите учетные данные входа для своей подписки Azure. Если у вас несколько подписок, воспользуйтесь той, что содержит ваш кластер Storm в HDInsight.

2. После успешной отправки топологии должны появиться топологии Storm для кластера. Выберите топологию WordCount в списке, чтобы просмотреть информацию о выполняемой топологии.

    ![Топологии с выбранной топологией WordCount](./media/hdinsight-storm-power-bi-topology/topologysummary.png)

    > [AZURE.NOTE]Вы также можете просмотреть топологии Storm из обозревателя сервера, развернув Azure, HDInsight и затем щелкнув правой кнопкой мыши кластер Storm в HDInsight и выбрав пункт "Просмотреть топологии Storm".

3. Прокрутите **сводку топологии** до раздела **Сита**. В этом разделе обратите внимание на столбец **Выполнено** для "сита" **PowerBI**. С помощью кнопки "Обновить" в верхней части страницы обновляйте страницу, пока значение не станет отличным от нуля. Увеличение этого числа указывает на запись элементов в Power BI.

## Создание отчета

1. В браузере откройте сайт [https://PowerBI.com](https://powerbi.com). Войдите в службу с использованием своей учетной записи.

2. В левой части страницы разверните **Наборы данных**. Выберите запись **Words**. Это набор данных, созданный примером топологии.

    ![Запись набора данных Words](./media/hdinsight-storm-power-bi-topology/words.png)

3. В области **Поля** разверните **WordCount**. Перетащите записи **Count** и **Word** в среднюю часть страницы. При этом будет создана диаграмма с отрезком для каждого слова, показывающим, сколько раз оно встречалось.

    ![Диаграмма WordCount](./media/hdinsight-storm-power-bi-topology/wordcountchart.png)

4. В левом верхнем углу страницы выберите **Сохранить** для создания отчета. Введите **Статистика** в качестве имени отчета.

5. Выберите эмблему Power BI для возврата к панели мониторинга. Отчет **Статистика** появится в списке **Отчеты**.

## Создание динамической панели мониторинга

1. Рядом с надписью **Панель мониторинга** щелкните значок **+** для создания панели мониторинга. Присвойте новой панели мониторинга имя **Динамическая статистика**.

2. Выберите отчет **Статистика**, который вы создали ранее. Когда появится диаграмма, выберите ее, а затем щелкните значок канцелярской кнопки в правом верхнем углу диаграммы. Вы получите уведомление о том, что она закреплена на панели мониторинга.

    ![Диаграмма с канцелярской кнопкой](./media/hdinsight-storm-power-bi-topology/pushpin.png)

2. Выберите эмблему Power BI для возврата к панели мониторинга. Выберите панель мониторинга **Динамическая статистика**. Теперь на ней есть диаграмма "Статистика", которая обновляется по мере того, как в Power BI отправляются новые записи из топологии WordCount, работающей в HDInsight.

    ![Динамическая панель мониторинга](./media/hdinsight-storm-power-bi-topology/dashboard.png)

## Остановка топологии WordCount

Топология будет продолжать работу, пока вы не остановите ее или не удалите кластер Storm в HDInsight. Чтобы удалить топологию, выполните следующие действия:

1. В Visual Studio откройте окно **Сводка топологии** для топологии WordCount. Если сводка топологии еще не открыта, перейдите к **обозревателю сервера**, разверните записи **Azure** и **HDInsight**, щелкните правой кнопкой мыши кластер Storm в HDInsight и выберите **Просмотреть топологии Storm**. После этого выберите топологию **WordCount**.

2. Нажмите кнопку **Удалить**, чтобы остановить топологию **WordCount**.

    ![Кнопка "Удалить" в сводке топологии](./media/hdinsight-storm-power-bi-topology/killtopology.png)

## Дальнейшие действия

В этом документе было рассмотрено, как отправлять данные из топологии Storm в Power BI с помощью REST. Дополнительные сведения о том, как работать с другими технологиями Azure, см. в следующих статьях:

* [Примеры топологий для Storm в HDInsight](hdinsight-storm-example-topology.md)

<!---HONumber=August15_HO8-->