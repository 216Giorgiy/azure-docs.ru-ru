<properties
   pageTitle="Развертывание топологий Apache Storm в HDInsight на основе Linux и управление ими | Microsoft Azure"
   description="Узнайте, как развертывать и отслеживать топологии Apache Storm, а также управлять ими с помощью панели мониторинга Storm в HDInsight на основе Linux. Использование инструментов Hadoop для Visual Studio."
   services="hdinsight"
   documentationCenter=""
   authors="Blackmist"
   manager="paulettm"
   editor="cgronlun"/>

<tags
   ms.service="hdinsight"
   ms.devlang="java"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="big-data"
   ms.date="05/20/2016"
   ms.author="larryfr"/>

# Развертывание топологий Apache Storm в HDInsight под управлением Linux и управление ими

С помощью этого документа вы познакомитесь с основами управления и мониторинга топологий Storm, работающих в Storm под управлением Linux в кластерах HDInsight.

> [AZURE.IMPORTANT] Для выполнения действий, описанных в этой статье, вам потребуется Storm под управлением Linux в кластере HDInsight. Сведения о развертывании и мониторинге топологий в HDInsight под управлением Windows см. в статье [Развертывание и управление топологий Apache Storm в HDInsight под управлением Windows](hdinsight-storm-deploy-monitor-topology.md).

## Предварительные требования

- **Storm под управлением Linux в HDInsight** — инструкции по созданию кластера см. в статье [Приступая к работе с Apache Storm в HDInsight](hdinsight-apache-storm-tutorial-get-started-linux.md)

- **Знакомство с SSH и SCP** — дополнительные сведения об использовании SSH и SCP с HDInsight см. в следующих статьях:
    - **Для клиентов Linux, Unix или OS X**: см. [Использование SSH в Hadoop на HDInsight под управлением Linux из Linux, OS X или Unix](hdinsight-hadoop-linux-use-ssh-unix.md)
    - **Для клиентов Windows**: см. [Использование SSH в Hadoop на HDInsight под управлением Linux из Windows](hdinsight-hadoop-linux-use-ssh-windows.md)

- **Клиент SCP** — доступен во всех системах Linux, Unix и OS X. В клиентах Windows мы рекомендуем использовать PSCP-клиент, доступный для загрузки [на странице загрузки PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).

## Запуск топологии Storm

1. Подключитесь к кластеру HDInsight с помощью SSH. Замените **USERNAME** на имя пользователя SSH. Замените **CLUSTERNAME** на имя кластера HDInsight.

        ssh USERNAME@CLUSTERNAME-ssh.azurehdinsight.net

    Дополнительные сведения об использовании SSH для подключения к кластеру HDInsight см. в следующих документах:
    
        - **Linux, Unix or OS X clients**: See [Use SSH with Linux-based Hadoop on HDInsight from Linux, OS X or Unix](hdinsight-hadoop-linux-use-ssh-unix.md)
        
        - **Windows clients**: See [Use SSH with Linux-based Hadoop on HDInsight from Windows](hdinsight-hadoop-linux-use-ssh-windows.md)

2. Запустите пример топологии, используя следующую команду:

        storm jar /usr/hdp/current/storm-client/contrib/storm-starter/storm-starter-topologies-0.9.3.2.2.4.9-1.jar storm.starter.WordCountTopology WordCount

    Эта команда запустит пример топологии WordCount в кластере. Он будет случайным образом формировать предложения и подсчитывать количество появлений каждого слова в предложениях.

    > [AZURE.NOTE] При отправке топологии в кластер необходимо сначала скопировать jar-файл, содержащий кластер, а затем воспользоваться командой `storm`. Это можно сделать, выполнив команду `scp` на клиенте, на котором находится файл. Например, `scp FILENAME.jar USERNAME@CLUSTERNAME-ssh.azurehdinsight.net:FILENAME.jar`
    >
    > Пример WordCount и другие начальные примеры использования Storm уже включены в ваш кластер в `/usr/hdp/current/storm-client/contrib/storm-starter/`.

##Мониторинг и управление с помощью команды storm

Программа `storm` позволяет работать с запущенными топологиями из командной строки. Ниже приведен список часто используемых команд. Чтобы вывести полный список команд, воспользуйтесь `storm -h`.

###Вывод списка топологий

Чтобы просмотреть список всех запущенных топологий, используйте следующую команду:

    storm list
    
Эта команда возвращает следующую информацию:

    Topology_name        Status     Num_tasks  Num_workers  Uptime_secs
    -------------------------------------------------------------------
    WordCount            ACTIVE     29         2            263

###Деактивация и повторная активация

Деактивация топологии приостанавливает ее до завершения или повторной активации. Чтобы деактивировать и повторно активировать топологию, используйте следующую команду:

    storm Deactivate TOPOLOGYNAME
    
    storm Activate TOPOLOGYNAME

###Завершение запущенной топологии

Топологии Storm после запуска продолжают работать до тех пор, пока не будут завершены. Для завершения топологии введите следующую команду:

    storm stop TOPOLOGYNAME

###Повторная балансировка

Повторная балансировка топологии позволяет системе пересмотреть параллелизм топологии. Например, если вы изменили размер кластера, добавив дополнительные узлы, повторная балансировка позволит запущенной топологии воспользоваться новыми узлами.

> [AZURE.WARNING] При повторной балансировке сначала деактивируется топология, затем рабочие роли равномерно перераспределяются по кластеру и, наконец, топология возвращается в состояние, в котором она находилась перед повторной балансировкой. Поэтому если топология была активна, она снова становится активной. Если она была деактивирована, то останется таковой.

    storm rebalance TOPOLOGYNAME

##Мониторинг и управление с помощью пользовательского интерфейса Storm

Пользовательский интерфейс Storm предоставляет веб-интерфейс для работы с запущенными топологиями и включен в состав кластера HDInsight. Чтобы открыть веб-интерфейс Storm, используйте веб-браузер и перейдите по адресу __https://CLUSTERNAME.azurehdinsight.net/stormui__, где __CLUSTERNAME__ — это имя вашего кластера.

> [AZURE.NOTE] При появлении соответствующего запроса введите имя пользователя и пароль администратора кластера (admin), которые использовались при создании кластера.


### Главная страница

На главной странице пользовательского интерфейса Storm отображается следующая информация.
- **Cluster summary** (Сводка по кластерам) — основная информация о кластере Storm.
- **Topology summary** (Сводка по топологиям) — список запущенных топологий. С помощью ссылок в этом разделе можно просмотреть дополнительную информацию о конкретных топологиях.
- **Supervisor summary** (Сводка по контролеру) — информация о контролере Storm.
- **Nimbus configuration** (Конфигурация Nimbus) — конфигурация Nimbus для кластера.

### Сводка по топологии

При выборе ссылки в разделе **Topology summary** (Сводка по топологиям) отображается следующая информация о топологии.
- **Topology summary** (Сводка по топологии) — основная информация о топологии.
- **Topology actions** (Действия с топологией) — действия управления, которые можно выполнять с топологией.
  - **Activate** (Включить) — возобновление обработки отключенной топологии.
  - **Deactivate** (Отключить) — приостановка выполняемой топологии.
  - **Rebalance** (Повторная балансировка) — корректировка параллелизма топологии. После изменения числа узлов в кластере необходимо выполнить повторную балансировку топологий. Это позволяет топологии скорректировать параллелизм для компенсации увеличения или уменьшения количества узлов в кластере.

      Дополнительные сведения см. в статье <a href="http://storm.apache.org/documentation/Understanding-the-parallelism-of-a-Storm-topology.html" target="_blank">Understanding the parallelism of a Storm topology</a> (Общие сведения о параллелизме топологии Storm).

  - **Kill** (Удалить) — останавливает выполнение топологии Storm по истечении заданного времени ожидания.

- **Topology stats** (Статистика топологии) — статистика по топологии. С помощью ссылок в столбце **Window** (Окно) можно установить временные рамки для оставшихся записей на странице.
- **Spouts** (Воронки) — используемые в топологии источники данных, которые называются воронками. С помощью ссылок в этом разделе можно получить дополнительную информацию о конкретных воронках.
- **Bolts** (Сита — используемые в топологии обработчики данных, которые называются ситами. С помощью ссылок в этом разделе можно получить дополнительную информацию о конкретных ситах.
- **Topology configuration** (Конфигурация топологии) — конфигурация выбранной топологии.

### Сводка по воронкам и ситам

При выборе воронки в разделе **Spouts** (Воронки) или **Bolts** (Сита) отображается следующая информация о выбранном элементе.
- **Component summary** (Сводка по компоненту) — основная информация о воронке или сите.
- **Spout/Bolt stats** (Статистика по воронке или ситу) — статистика по воронке или ситу. С помощью ссылок в столбце **Window** (Окно) можно установить временные рамки для оставшихся записей на странице.
- **Input stats** (Статистика по входным данным, только сита) — информация о входных потоках, проходящих через сито.
- **Output stats** (Статистика по выходным данным) — информация о потоках, создаваемых этой воронкой или ситом.
- **Executors** (Исполнители) — информация об экземплярах воронки или сита. Выберите запись **Port** (Порт) для конкретного исполнителя, чтобы просмотреть журнал диагностической информации, созданный для этого экземпляра.
- **Errors** (Ошибки) — информация об ошибках для данной воронки или сита.

## Интерфейс REST API

Пользовательский интерфейс Storm построен на базе REST API, поэтому функциональность отслеживания и управления можно реализовать аналогичным образом с помощью API. С помощью REST API можно создать пользовательские средства для отслеживания топологий Storm и управления ими.

Дополнительные сведения см. в разделе [API-интерфейс REST пользовательского интерфейса Storm](http://storm.apache.org/releases/0.9.6/STORM-UI-REST-API.html). Следующая информация касается использования REST API с Apache Storm в HDInsight.

> [AZURE.IMPORTANT] API-интерфейс REST для Storm не является общедоступным через Интернет, и обращаться к нему необходимо с помощью туннеля SSH на головной узел кластера HDInsight. Дополнительные сведения о создании и использовании туннеля SSH см. в статье [Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, ResourceManager, JobHistory, NameNode, Oozie и другим веб-интерфейсам](hdinsight-linux-ambari-ssh-tunnel.md).

### Базовый универсальный код ресурса

Базовый универсальный код ресурса для интерфейса REST API в кластерах HDInsight под управлением Linux можно найти на головном узле по адресу **https://HEADNODEFQDN:8744/api/v1/**. Тем не менее доменное имя головного узла создается одновременно с кластером и не является статическим.

Полное доменное имя (FQDN) головного узла кластера можно получить несколькими способами.

* __Из сеанса SSH__. Для этого в сеансе SSH используйте команду `headnode -f`.
* __Из веб-интерфейса Ambari__. В верхней части страницы выберите __Services__ (Службы), а затем выберите __Storm__. На вкладке __Summary__ (Сводка) выберите __Storm UI Server__ (Сервер пользовательского интерфейса Storm). Полное доменное имя сервера, на котором запущены пользовательские интерфейсы Storm и REST API, будет указано в верхней части страницы.
* __Из интерфейса REST API Ambari__. Используйте команду `curl -u admin:PASSWORD -G "https://CLUSTERNAME
.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/STORM/components/STORM_UI_SERVER"`, чтобы получить сведения об узле с выполняемыми пользовательскими интерфейсами Storm и REST API. Замените __PASSWORD__ паролем администратора кластера. Замените __CLUSTERNAME__ именем кластера. Запись host\_name в ответе будет содержать полное доменное имя узла.

### Аутентификация

Для запросов REST API необходимо использовать **обычную проверку подлинности** с помощью имени и пароля администратора кластера HDInsight.

> [AZURE.NOTE] Так как при обычной проверке подлинности данные отправляются открытым текстом, следует **всегда** использовать HTTPS для защиты связи с кластером.

### Возвращаемые значения

Информацию, возвращаемую REST API, можно использовать только в пределах кластера или виртуальной машины в одной виртуальной сети Azure, выполняющей функцию кластера. Например, полное доменное имя (FQDN), возвращаемое для серверов Zookeeper, не будет доступно из Интернета.

## Дальнейшие действия

Теперь, когда вы узнали, как развертывать и отслеживать топологии с помощью панели мониторинга Storm, можно переходить к [разработке топологий на основе Java с помощью Maven](hdinsight-storm-develop-java-topology.md).

Другие примеры топологий Storm см. в разделе [Примеры топологий для Storm в HDInsight](hdinsight-storm-example-topology.md).

<!---HONumber=AcomDC_0525_2016-->