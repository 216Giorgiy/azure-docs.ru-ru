---
title: "Использование туннелирования SSH для доступа к службам Azure HDInsight | Документация Майкрософт"
description: "Узнайте, как безопасно просматривать веб-ресурсы, размещенные на узлах HDInsight под управлением Linux, с помощью туннеля SSH."
services: hdinsight
documentationcenter: 
author: Blackmist
manager: jhubbard
editor: cgronlun
ms.assetid: 879834a4-52d0-499c-a3ae-8d28863abf65
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 03/06/2017
ms.author: larryfr
translationtype: Human Translation
ms.sourcegitcommit: 4f2230ea0cc5b3e258a1a26a39e99433b04ffe18
ms.openlocfilehash: 4d9471fcdff26ac76312fcecdb427dca842f7ee3
ms.lasthandoff: 03/25/2017


---
# <a name="use-ssh-tunneling-to-access-ambari-web-ui-jobhistory-namenode-oozie-and-other-web-uis"></a>Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, JobHistory, NameNode, Oozie и другим веб-интерфейсам

Кластеры HDInsight под управлением Linux предоставляют доступ к веб-интерфейсу Ambari через Интернет, однако при этом доступны не все функции веб-интерфейса. Это относится, например, к веб-интерфейсу других служб, которые доступны через Ambari. Чтобы получить доступ ко всем функциям веб-интерфейса Ambari, необходимо настроить туннель SSH к головному узлу кластера.

## <a name="why-use-an-ssh-tunnel"></a>Причины для использования туннеля SSH

Без туннеля SSH некоторые меню в Ambari будут содержать не все пункты, так как для заполнения этих меню используются веб-сайты и службы, предоставляемые другими службами Hadoop, запущенными в кластере. Часто эти веб-сайты не защищены, поэтому небезопасно открывать прямой доступ к ним через Интернет. Иногда под управлением службы работает веб-сайт на другом узле кластера, например на узле Zookeeper.

Ниже перечислены службы веб-интерфейса Ambari, доступ к которым без использования туннеля SSH невозможен.

* Журнал заданий
* узел имен;
* стеки потоков;
* веб-интерфейс Oozie
* веб-интерфейс главного узла и журналов HBase

При использовании действий сценариев для настройки кластера туннель SSH будет необходим для всех служб и программ, которые вы установили для доступа к веб-интерфейсу. Например, если вы установили Hue с помощью действия сценария, для доступа к веб-интерфейсу Hue потребуется туннель SSH.

## <a name="what-is-an-ssh-tunnel"></a>Что такое туннель SSH?

[Туннель SSH](https://en.wikipedia.org/wiki/Tunneling_protocol#Secure_Shell_tunneling) направляет трафик, приходящий на порт локальной рабочей станции, через подключение SSH на головной узел кластера HDInsight, на котором запрос затем разрешается так же, как если бы он был создан на головном узле. Ответ рабочей станции отправляется обратно через туннель.

## <a name="prerequisites"></a>Предварительные требования

При использовании туннеля SSH для веб-трафика необходимо иметь следующее:

* Клиент SSH. В дистрибутивах Linux, Unix, Macintosh OS X и Bash в Windows 10 команда `ssh` входит в состав операционной системы. Для версий Windows, которые не содержат команду `ssh`, мы рекомендуем использовать [PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).
  
  > [!NOTE]
  > Если вы планируете использовать клиент SSH, отличный от `ssh` или PuTTY, обратитесь к документации своего клиента за информацией о настройке туннеля SSH.

* Веб-браузер, который можно настроить на использование прокси-сервера SOCKS5.

    > [!WARNING]
    > Встроенная в Windows поддержка прокси-сервера SOCKS не применяется к SOCKS5 и не будет работать при выполнении действий в этом документе. Следующие браузеры используют параметры прокси-сервера Windows и в настоящее время не будут работать при выполнении действий в этом документе.
    > 
    > * Microsoft Edge
    > * Microsoft Internet Explorer
    >
    > Google Chrome также использует параметры прокси-сервера Windows. Но можно установить расширения, которые поддерживают SOCKS5. Рекомендуется использовать [FoxyProxy Standard](https://chrome.google.com/webstore/detail/foxyproxy-standard/gcknhkkoolaabfmlnjonogaaifnjlfnp).

## <a name="usessh"></a>Создание туннеля с помощью команды SSH

Используйте следующую команду для создания туннеля SSH с помощью команды `ssh` . Замените **USERNAME** именем пользователя SSH для кластера HDInsight, а **CLUSTERNAME** — именем кластера HDInsight.

```
ssh -C2qTnNf -D 9876 USERNAME@CLUSTERNAME-ssh.azurehdinsight.net
```

В результате создается подключение, которое направляет трафик, поступающий на локальный порт 9876, в кластер по протоколу SSH. Доступны следующие параметры.

* **D 9876** — локальный порт, используемый для направления трафика через туннель;
* **C** — сжатие всех данных, так как веб-трафик преимущественно состоит из текста;
* **2** — принудительная попытка использовать только протокол SSH версии 2;
* **q** — тихий режим;
* **T** — отключение распределения псевдотелетайпа, так как выполняется только перенаправление порта;
* **n** — предотвращение считывания с STDIN, так как выполняется только перенаправление порта;
* **N** — запрет на выполнение удаленной команды, так как выполняется только перенаправление порта;
* **f** — выполнение в фоновом режиме.

При настройке кластера с ключом SSH может потребоваться использовать параметр `-i` и указать путь к закрытому ключу SSH.

После завершения команды трафик, отправленный на порт 9876 на локальном компьютере, будет направляться с использованием SSL на головной узел кластера и выглядеть так, будто его источником является головной узел.

## <a name="useputty"></a>Создание туннеля с помощью PuTTY

Для создания туннеля SSH с помощью PuTTY выполните следующие действия.

1. Откройте PuTTY и введите информацию о подключении. Если вы не работали с PuTTY, ознакомьтесь с [документацией по PuTTY (http://www.chiark.greenend.org.uk/~sgtatham/putty/docs.html)](http://www.chiark.greenend.org.uk/~sgtatham/putty/docs.html).

2. В разделе **Категории** в левой части диалогового окна последовательно разверните **Подключение**, **SSH** и выберите **Туннели**.

3. Введите следующую информацию в форме **Параметры, управляющие перенаправлением портов SSH** :
   
   * **Порт источника** — порт на стороне клиента, трафик которого нужно перенаправлять. Например, **9876**.

   * **Назначение** — адрес SSH для кластера HDInsight под управлением Linux. Например, **mycluster-ssh.azurehdinsight.net**.

   * **Динамическая** — включает динамическую маршрутизацию прокси-сервера SOCKS.
     
     ![изображение параметров туннелирования](./media/hdinsight-linux-ambari-ssh-tunnel/puttytunnel.png)

4. Щелкните **Добавить**, чтобы добавить параметры, а затем щелкните **Открыть**, чтобы открыть подключение SSH.

5. При появлении запроса войдите на сервер. При этом будет установлен сеанс SSH и включен туннель.

## <a name="use-the-tunnel-from-your-browser"></a>Использование туннеля из браузера

> [!IMPORTANT]
> Для действий, описанных в этом разделе, используется браузер FireFox, так как предоставляет те же параметры прокси-сервера на всех платформах. Для других современных браузеров, например Google Chrome, может потребоваться расширение, например FoxyProxy, для работы с туннелем.

1. Настроить браузер для использования **localhost** и порта, использованного при создании туннеля, в качестве прокси-сервера **SOCKS 5**. Вот как выглядят параметры Firefox. Если используется порт, отличный от 9876, измените номер порта соответствующим образом.
   
    ![изображение параметров Firefox](./media/hdinsight-linux-ambari-ssh-tunnel/firefoxproxy.png)
   
   > [!NOTE]
   > Если выбрать параметр **Remote DNS** (Удаленная служба DNS), то запросы службы доменных имен (DNS) будут разрешаться с помощью кластера HDInsight. Если этот параметр не выбран, запросы DNS будут разрешаться локально.

2. Чтобы проверить, что трафик направляется через туннель, зайдите на сайт [http://www.whatismyip.com/](http://www.whatismyip.com/) при включенных и выключенных параметрах прокси-сервера в Firefox. Если настройки включены, возвращенный IP-адрес относится к компьютеру в центре данных Microsoft Azure.

## <a name="verify-with-ambari-web-ui"></a>Проверка для веб-интерфейса Ambari

После настройки кластера выполните следующие действия, чтобы удостовериться, что веб-интерфейсы служб доступны из веб-интерфейса Ambari.

1. В браузере перейдите по адресу: http://headnodehost:8080. Адрес `headnodehost` отправляется через туннель в кластер и преобразовывается в головной узел, на котором выполняется Ambari. При появлении запроса введите имя пользователя (admin) и пароль учетной записи администратора кластера. Веб-интерфейс Ambari может потребовать повторного ввода имени пользователя и пароля. В этом случае повторно введите имя пользователя и пароль.
   
   > [!NOTE]
   > При использовании адреса http://headnodehost:8080 для подключения к кластеру вы подключаетесь через туннель непосредственно к головному узлу, на котором выполняется Ambari, с помощью протокола HTTP, и безопасность обмена данными обеспечивается туннелем SSH. При подключении через Интернет без использования туннеля обмен данными защищается с помощью протокола HTTPS. Для подключения через Интернет по протоколу HTTPS используйте https://CLUSTERNAME.azurehdinsight.net, где **имя_кластера** — имя кластера.

2. В веб-интерфейсе Ambari выберите HDFS в списке в левой части страницы.
   
    ![Изображение с выбранным пунктом HDFS](./media/hdinsight-linux-ambari-ssh-tunnel/hdfsservice.png)
3. После появления информации о службе HDFS выберите **Быстрые ссылки**. Появится список головных узлов кластера. Выберите один из головных узлов, а затем выберите **NameNode UI**(Пользовательский интерфейс NameNode).
   
    ![Изображение с развернутым меню "Быстрые ссылки"](./media/hdinsight-linux-ambari-ssh-tunnel/namenodedropdown.png)
   
   > [!NOTE]
   > Если подключение к Интернету медленное или головной узел занят, при выборе меню **Быстрые ссылки**вместо меню отображается индикатор ожидания. В этом случае подождите одну-две минуты для получения данных с сервера, а затем повторите попытку.
   > 
   > Если у вас монитор с низким разрешением или окно браузера не развернуто, некоторые записи в меню **Быстрые ссылки** могут быть обрезаны правым краем экрана. В этом случае разверните меню с помощью мыши, а затем используйте клавишу со стрелкой вправо, чтобы прокрутить экран вправо и увидеть остальную часть меню.
   > 
   > 
4. Откроется страница, аналогичная следующей:
   
    ![Изображение пользовательского интерфейса NameNode](./media/hdinsight-linux-ambari-ssh-tunnel/namenode.png)
   
   > [!NOTE]
   > Обратите внимание на URL-адрес этой страницы. Он должен иметь вид **http://hn1-CLUSTERNAME.randomcharacters.cx.internal.cloudapp.net:8088/cluster**. Этот адрес использует полное внутреннее доменное имя узла (FQDN), и он недоступен без использования туннеля SSH.
   > 
   > 

## <a name="next-steps"></a>Дальнейшие действия

Теперь когда вы узнали, как создать и использовать туннель SSH, обратитесь к следующим статьям, чтобы узнать об управлении и мониторинге кластера с помощью Ambari:

* [Управление кластерами HDInsight с помощью Ambari](hdinsight-hadoop-manage-ambari.md)

Дополнительные сведения об использовании протокола SSH с HDInsight см. в разделе [Подключение к HDInsight (Hadoop) с помощью SSH](hdinsight-hadoop-linux-use-ssh-unix.md).


