<properties
   pageTitle="Управление кластерами HDInsight с помощью Ambari | Microsoft Azure"
   description="Узнайте, как использовать Ambari для наблюдения за кластерами HDInsight на платформе Linux и управления их функционированием."
   services="hdinsight"
   documentationCenter=""
   authors="Blackmist"
   manager="paulettm"
   editor="cgronlun"/>

<tags
   ms.service="hdinsight"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="big-data"
   ms.date="07/24/2015"
   ms.author="larryfr"/>

#Управление кластерами HDInsight с помощью Ambari (предварительная версия)

Узнайте, как использовать Ambari для управления кластерами Azure HDInsight под управлением Linux и наблюдения за их функционированием.

> [AZURE.NOTE]Большая часть информации в этой статье относится только к кластерам HDInsight под управлением Linux. Для кластеров HDInsight на платформе Windows доступен мониторинг только через Ambari REST API. См. статью [Отслеживание кластеров Hadoop в HDInsight с помощью API Ambari для ОС Windows](hdinsight-monitor-use-ambari-api.md).

##<a id="whatis"></a>Что такое Ambari

<a href="http://ambari.apache.org" target="_blank">Apache Ambari</a> упрощает управление Hadoop, предоставляя простой в использовании веб-интерфейс, который можно использовать для подготовки и мониторинга кластеров Hadoop, а также управления их функционированием. Разработчики могут интегрировать эти возможности в своих приложениях с помощью <a href="https://github.com/apache/ambari/blob/trunk/ambari-server/docs/api/v1/index.md" target="_blank">интерфейсов API REST Ambari</a>.

Ambari предоставляется по умолчанию с кластерами HDInsight на платформе Linux. Кластеры HDInsight на платформе Windows предоставляют средства наблюдения через API REST Ambari.

##Прокси-сервер SSH

> [AZURE.NOTE]Хотя Ambari для кластера можно использовать непосредственно в Интернете, некоторые ссылки из веб-интерфейса Ambari (например, для JobTracker) не доступны в Интернете. Поэтому при попытке доступа к этим функциям может отображаться ошибка «сервер не найден», если вы не используете на головном узле кластера туннель Secure Shell (SSH) для проксирования веб-трафика.

Используйте следующие статьи, чтобы создать туннель SSH от порта на локальном компьютере до кластера.

* <a href="../hdinsight-hadoop-linux-use-ssh-unix/#tunnel" target="_blank">Использование SSH с Hadoop под управлением Linux в HDInsight в Linux, Unix или OS X</a> — шаги по созданию туннеля SSH с помощью команды `ssh`.

* <a href="../hdinsight-hadoop-linux-use-ssh-windows/#tunnel" target="_blank">Использование SSH с Hadoop под управлением Linux в HDInsight в Windows</a> — шаги по использованию PuTTY для создания туннеля SSH.

##Веб-интерфейс Ambari

Веб-интерфейс Ambari доступен в каждом кластере HDInsight под управлением Linux, создаваемом по адресу **https://&lt;clustername>.azurehdinsight.net**.

На странице отобразятся два запроса на прохождение аутентификации. Первый запрос — для аутентификации в кластере HDInsight, а второй — для аутентификации в Ambari.

* **Аутентификация в кластере** — используйте имя пользователя администратора кластера (значение по умолчанию — **admin**) и соответствующий пароль.

* **Аутентификация в Ambari** — по умолчанию используется имя пользователя и пароль **admin**.

	> [AZURE.NOTE]При изменении пароля для пользователя **admin** необходимо ввести новый пароль.

При открытии страницы обратите внимание на панель вверху. Она содержит следующую информацию и элементы управления:

![ambari-nav](./media/hdinsight-hadoop-manage-ambari/ambari-nav.png)

* **Логотип Ambari** — позволяет открыть панель мониторинга, которую можно использовать для мониторинга кластера.

* **Имя кластера, за которым следует поле «К-во операций»** — число текущих операций Ambari. Если выбрать имя кластера или **К-во операций**, отобразится список фоновых операций.

* **К-во оповещений** — число предупреждений или критических оповещений для кластера, если таковые имеются. При выборе этого элемента отобразится список оповещений.

* **Панель мониторинга** — позволяет отобразить панель мониторинга.

* **Службы** — информация и параметры конфигурации служб в кластере.

* **Узлы** — информация и параметры конфигурации узлов в кластере.

* **Оповещения** — журнал с информацией, предупреждениями и критическими оповещениями.

* **Администратор** — стек программного обеспечения и службы, которые были установлены или могут добавляться в кластер, информация об учетной записи службы и данные о безопасности Kerberos.

* **Кнопка «Администратор»** — управление Ambari, параметры пользователя и выход.

##Мониторинг

###Оповещения

Ambari предоставляет множество предупреждений, которые могут находиться в одном из следующих состояний.

* **ОК**;

* **Предупреждение**;

* **КРИТИЧЕСКИЙ**;

* **НЕИЗВЕСТНО**.

При любых оповещениях, кроме **ОК**, в поле **К-во оповещений** в верхней части страницы будет отображаться их общее количество. Выберите эту запись, чтобы отобразить предупреждения и их состояние.

Оповещения разбиты на несколько групп по умолчанию, которые можно просмотреть на странице **Оповещения**.

![страница «Оповещения»](./media/hdinsight-hadoop-manage-ambari/alerts.png)

Группами можно управлять с помощью меню **Действия**, а также выбрав **Управление группами оповещений**. Это позволит изменить существующие группы или создать новые.

![диалоговое окно «Управление группами оповещений»](./media/hdinsight-hadoop-manage-ambari/manage-alerts.png)

С помощью меню **Действия** можно также настроить уведомления об оповещениях. Это позволит создавать триггеры, отправляющие уведомления по **ЭЛЕКТРОННОЙ ПОЧТЕ** или протоколу **SNMP** при появлении определенного оповещения заданной серьезности. Например, оповещение может отправляться, если для какого-либо оповещения в группе **YARN по умолчанию** установлено значение **Критическое**.

![диалоговое окно создания оповещения](./media/hdinsight-hadoop-manage-ambari/create-alert-notification.png)

###HDInsight

На вкладке **Метрики** панели мониторинга содержится ряд мини-приложений, которые позволяют легко определить состояние кластера с первого взгляда. Если щелкнуть некоторые мини-приложения, например **Загрузка ЦП**, отобразится дополнительная информация.

![панель мониторинга с метриками](./media/hdinsight-hadoop-manage-ambari/metrics.png)

На вкладке **Тепловые карты** метрики отображаются в виде цветных тепловых карт с переходом от зеленого к красному.

![панель мониторинга с тепловыми картами](./media/hdinsight-hadoop-manage-ambari/heatmap.png)

Чтобы узнать больше об узлах кластера, выберите **Узлы**, а затем — определенный узел, который вас интересует.

![информация об узле](./media/hdinsight-hadoop-manage-ambari/host-details.png)

###Службы

Боковая панель **Службы** на панели мониторинга позволяет получить общее представление о состоянии служб, работающих в кластере. Для обозначения состояния или мер, которые необходимо предпринять, используются различные значки, например желтый значок циклического повторения, если нужно перезапустить службу.

![боковая панель «Службы»](./media/hdinsight-hadoop-manage-ambari/service-bar.png)

При выборе службы для нее отобразится более подробная информация.

![сводные данные о службе](./media/hdinsight-hadoop-manage-ambari/service-details.png)

####Быстрые ссылки

Для некоторых служб в верхней части страницы отображается ссылка **Быстрые ссылки**. Их можно использовать для доступа к определенным веб-интерфейсам службы, например:

* **Журнал заданий** — журнал заданий MapReduce;

* **Диспетчер ресурсов** — пользовательский интерфейс диспетчера ресурсов YARN;

* **NameNode** — пользовательский интерфейс NameNode распределенной файловой системы Hadoop (HDFS).

* **Веб-интерфейс Oozie** — пользовательский интерфейс Oozie.

При выборе любой из этих ссылок в браузере откроется новая вкладка с выбранной страницей.

> [AZURE.NOTE]Если не используется SSL-туннель для проксирования веб-трафика, поступающего в кластер, выбор ссылки **Быстрые ссылки** для любой службы приведет к ошибке «сервер не найден». Это связано с тем, что веб-приложения, используемые для отображения этих сведений, не доступны в Интернете.
>
> Информацию об использовании SSL-туннеля с HDInsight см. в одной из следующих статей.
>
> * <a href="../hdinsight-hadoop-linux-use-ssh-unix/#tunnel" target="_blank">Использование SSH с Hadoop под управлением Linux в HDInsight в Linux, Unix или OS X</a> — шаги по созданию туннеля SSH с помощью команды `ssh`.
>
>* <a href="../hdinsight-hadoop-linux-use-ssh-windows/#tunnel" target="_blank">Использование SSH с Hadoop под управлением Linux в HDInsight в Windows</a> — шаги по использованию PuTTY для создания туннеля SSH.

##управления

###Пользователи, группы и разрешения Ambari

В предварительной версии HDInsight под управлением Linux не следует использовать управление пользователями, группами и разрешениями.

###Узлы

На странице **Узлы** перечислены все узлы в кластере. Для управления узлами, сделайте следующее.

![страница «Узлы»](./media/hdinsight-hadoop-manage-ambari/hosts.png)

> [AZURE.NOTE]В кластерах HDInsight не следует использовать добавление, списание или восстановление списанного узла.

1. Выберите узлы, которыми вы хотите управлять.

2. С помощью меню **Действия** выберите действие, которое необходимо выполнить.

	* **Запустить все компоненты** — запуск всех компонентов на узле.

	* **Остановить все компоненты** — остановка всех компонентов на узле.

	* **Перезапустить все компоненты** — остановка и запуск всех компонентов на узле.

	* **Включить режим обслуживания** — подавление оповещений для узла. Этот параметр должен быть включен при выполнении действий, которые будут создавать оповещения, например перезапуск службы, которую используют запущенные службы.

	* **Отключить режим обслуживания** — возврат узла к обычному режиму оповещений.

	* **Остановить** — остановка DataNode или NodeManagers на узле.

	* **Запуск** — запуск DataNode или NodeManagers на узле.

	* **Перезапустить** — остановка и запуск DataNode или NodeManagers на узле.

	* **Списать** — удаление узла из кластера.

		> [AZURE.NOTE]Не используйте это действие в кластерах HDInsight.

	* **Восстановить списанные** — добавление списанных ранее узлов в кластер.

		> [AZURE.NOTE]Не используйте это действие в кластерах HDInsight.

###<a id="service"></a>Службы

На странице **Панель мониторинга** или **Службы** используйте кнопку **Действия** в нижней части списка служб, чтобы добавить новые службы или остановить и вновь запустить все службы.

![действия в службе](./media/hdinsight-hadoop-manage-ambari/service-actions.png)

Ниже в общих чертах описана процедура добавления службы:

1. На странице **Панель мониторинга** или **Службы** нажмите кнопку **Действия** и выберите **Добавить службу**.

2. В **мастере добавления службы** выберите службу, которую нужно добавить, а затем щелкните **Далее**.

	![добавить службу](./media/hdinsight-hadoop-manage-ambari/add-service.png)

3. Продолжайте выполнять указания мастера, предоставляя информацию о конфигурации службы. Дополнительную информацию о требованиях к конфигурации см. в документации службы, которую вы добавляете.

4. На странице **Проверка** можно **вывести** информацию о конфигурации или **развернуть** службу в кластере.

5. После развертывания службы отобразится страница **Установка, запуск и тестирование** с информацией о ходе выполнения установки и тестирования службы. Когда индикатор в столбце **Состояние** станет зеленым, выберите **Далее**.

	![изображение страницы «Установка, запуск и тестирование»](./media/hdinsight-hadoop-manage-ambari/install-start-test.png)

6. На странице **Сводка** отображается сводка по процессу установки, а также все возможные действия, которые необходимо предпринять, например перезапуск других служб. Выберите **Завершить**, чтобы завершить работу мастера.

Хотя с помощью кнопки **Действия** можно перезапустить все службы, зачастую требуется запустить, остановить или перезапустить только одну из них. Чтобы выполнить действия для отдельной службы, сделайте следующее.

1. На странице **Панель мониторинга** или **Службы** выберите службу.

2. В верхней части вкладки **Сводка** используйте кнопку **Действия со службой** и выберите действие, которое необходимо выполнить. Это приведет к перезапуску службы на всех узлах.

	![действие в службе](./media/hdinsight-hadoop-manage-ambari/individual-service-actions.png)

	> [AZURE.NOTE]Перезапуск некоторых служб во время работы кластера может привести к формированию предупреждений. Чтобы избежать этого, можно использовать кнопку **Действия со службой**, чтобы включить **режим обслуживания** для службы перед выполнением перезагрузки.

3. После выбора действия значение в поле **К-во операций** в верхней части страницы увеличится, что будет свидетельствовать о выполнении фоновой операции. Если настроено отображение списка фоновых операций, этот список появится на экране.

	> [AZURE.NOTE]Если для службы включен **режим обслуживания**, не забудьте отключить его с помощью кнопки **Действия со службой** после завершения операции.

Чтобы настроить службу, сделайте следующее:

1. На странице **Панель мониторинга** или **Службы** выберите службу.

2. Выберите вкладку **Конфигурации**. Отобразится текущая конфигурация. Отобразится также список предыдущих конфигураций.

	![конфигурации](./media/hdinsight-hadoop-manage-ambari/service-configs.png)

3. Используйте отображаемые поля для изменения конфигурации, а затем выберите **Сохранить**. Можно также выбрать предыдущую конфигурацию, а затем выбрать **Сделать текущей**, чтобы выполнить откат к предыдущим настройкам.

##Интерфейс REST API

Веб-интерфейс Ambari работает на базе API REST, который можно использовать для создания собственных средств управления и наблюдения. Хотя этот API относительно прост в использовании, при работе с ним следует учитывать некоторые особенности Azure.

* **Аутентификация** — для аутентификации службы следует использовать имя пользователя администратора кластера (по умолчанию **admin**) и соответствующий пароль.

* **Безопасность** — Ambari использует обычную аутентификацию, поэтому при взаимодействии с API всегда следует использовать протокол HTTPS (Secure HTTP).

* **IP-адреса** — адрес, возвращаемый для узлов в кластере, недоступен за пределами кластера, если кластер не является частью виртуальной сети Azure. IP-адрес будет доступен для других участников виртуальной сети, но недоступен вне ее.

* **Некоторые функциональные возможности не включены** — некоторые функциональные возможности Ambari отключены, так как ими управляет облачная служба HDInsight, например добавление узлов в кластер или удаление их из него. При этом другие функциональные возможности в предварительной версии HDInsight на платформе Linux могут быть реализованы не полностью.

Полный справочник по REST API см. в статье [Справочник по API Ambari версии 1](https://github.com/apache/ambari/blob/trunk/ambari-server/docs/api/v1/index.md).

<!---HONumber=August15_HO6-->