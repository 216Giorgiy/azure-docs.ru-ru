---
title: Настройка присоединенных к домену кластеров HDInsight с помощью AAD-DS
description: Узнайте, как установить и настроить кластеры HDInsight, присоединенные к домену, с помощью доменных служб Azure Active Directory.
services: hdinsight
author: omidm1
manager: jhubbard
editor: cgronlun
ms.service: hdinsight
ms.topic: conceptual
ms.date: 05/30/2018
ms.author: omidm
ms.openlocfilehash: 8064940e0d0f035010a2521752d6f32f3f9ccd9f
ms.sourcegitcommit: 3c3488fb16a3c3287c3e1cd11435174711e92126
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2018
ms.locfileid: "34849839"
---
# <a name="configure-domain-joined-hdinsight-clusters-using-azure-active-directory-domain-services"></a>Настройка присоединенных к домену кластеров HDInsight с помощью доменных служб Azure Active Directory

Связанные с доменом кластеры обеспечивают многопользовательский доступ к кластерам HDInsight. Присоединенные к домену кластеры HDInsight подключаются к доменам Active Directory. Таким образом, пользователи домена могут использовать свои учетные данные домена для аутентификации в кластерах и выполнения заданий по обработке больших объемов данных. 

Из этой статьи вы узнаете, как настроить кластер HDInsight, присоединенный к домену, с использованием доменных служб Azure Active Directory.

## <a name="create-azure-adds"></a>Создание службы Azure AD DS

Включение Azure AD Domain Services (AAD-DS) является необходимым предварительным условием, прежде чем вы сможете создать объединенный с доменом кластер HDInsight. Чтобы включить экземпляр AAD-доменных служб Active Directory, см. раздел [Включение доменных служб Azure Active Directory с помощью портала Azure](../../active-directory-domain-services/active-directory-ds-getting-started.md). 

> [!NOTE]
> Только администраторы клиентов имеют разрешения на создание экземпляра AAD-DS. Если вы используете Хранилище Azure Data Lake (ADLS) в качестве стандартного хранилища для HDInsight, убедитесь, что стандартный клиент Azure AD для ADLS совпадает с доменом для кластера HDInsight. Sincde Hadoop зависит от Kerberos и базовой аутентификации, поэтому многофакторная проверка подлинности должна быть отключена для пользователей, которые будут иметь доступ к кластеру.

После инициализации экземпляра AAD-DS необходимо создать учетную запись службы в AAD (которая будет синхронизирована с AAD-DS) с правильными разрешениями. Если эта учетная запись службы уже существует, потребуется выполнить сброс пароля и подождать, пока она синхронизируется с AAD-DS (при этом будет создан хэш пароль Kerberos; для синхронизации с AAD-DS может потребоваться до 30 минут). Эта учетная запись службы должна иметь следующие привилегии.

- Присоединение компьютеров к домену и помещение субъектов компьютеров в определенное подразделение, которое указывается во время создания кластера.
- Создание субъектов-служб в определенном подразделении, которое указывается во время создания кластера.

> [!NOTE]
> Так как Apache Zeppelin использует доменное имя для аутентификации административной учетной записи службы, для правильной работы Apache Zeppelin учетная запись ДОЛЖНА иметь то же доменное имя, что и ее суффикс имени участника-пользователя.

Дополнительные сведения о подразделениях и как управлять ими см. в разделе [Создание подразделения в управляемом домене доменных служб Azure AD](../../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md). 

Требуется защищенный протокол LDAP для управляемого домена AAD-DS. Дополнительные сведения о включении защищенного протокола LDAP см. в разделе [Настройка защищенного протокола LDAP (LDAPS) для управляемого домена доменных служб Azure AD](../../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md).

## <a name="create-a-domain-joined-hdinsight-cluster"></a>Создание присоединенного к домену кластера HDInsight

Следующим шагом является создание кластера HDInsight с использованием AAD DS и учетной записи службы, созданной в предыдущем разделе.

Проще разместить AAD-DS и кластер HDInsight в одной и той же виртуальной сети Azure. В случае, если вы решили поместить их в разные виртуальные сети, необходимо установить пиринг между этими виртуальными сетями, таким образом, чтобы виртуальные машины HDI имели линию видимости с контроллером домена для присоединения виртуальных машин. Дополнительные сведения см. в статье [Пиринг между виртуальными сетями](../../virtual-network/virtual-network-peering-overview.md).

При создании кластера HDInsight, присоединенного к домену, необходимо указать следующие параметры:

- **Имя домена**. Имя домена, который связан с AAD-DS. Например, contoso.onmicrosoft.com.
- **Имя пользователя домена**. Учетная запись службы в управляемом домене, созданная в предыдущем разделе. Например, hdiadmin@contoso.onmicrosoft.com. Этот пользователь домена станет администратором этого кластера HDInsight.
- **Пароль домена**. Пароль учетной записи службы.
- **Подразделение**. Уникальное имя подразделения, которое необходимо использовать с кластером HDInsight. Например: OU=HDInsightOU,DC=contoso,DC=onmicrosohift,DC=com. Если это подразделение не существует, кластер HDInsight пытается создать подразделение, используя привилегии, которые имеет учетная запись службы. (Например, если учетная запись службы находится в группе администраторов AAD-DS, то у нее есть права на создание подразделения. В противном случае может понадобиться сначала создать подразделение и дать учетной записи службы полный контроль над этим подразделением. См. [Создание подразделения в управляемом домене доменных служб Azure AD](../../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md)).

    > [!IMPORTANT]
    > Важно включить все службы домена разделенные запятой после подразделения (например, OU=HDInsightOU,DC=contoso,DC=onmicrosohift,DC=com).

- **LDAPS URL** (URL-адрес LDAPS). Например, ldaps://contoso.onmicrosoft.com:636.

    > [!IMPORTANT]
    > Введите полный URL-адрес, включая ldaps:// и номер порта (:636)

- **Access user group** (Группа пользователей с доступом). Группы безопасности, пользователей которых нужно синхронизировать с кластером. Например, HiveUsers. Чтобы указать несколько групп пользователей, разделяйте их запятой (,).
 
На следующем снимке экрана показаны конфигурации на портале Azure:

![Конфигурация доменных служб Active Directory в присоединенном к домену кластере Azure HDInsight](./media/apache-domain-joined-configure-using-azure-adds/hdinsight-domain-joined-configuration-azure-aads-portal.png).


## <a name="next-steps"></a>Дополнительная информация
* Сведения о настройке политик Hive и выполнении запросов Hive для присоединенного к домену кластера HDInsight см. [здесь](apache-domain-joined-run-hive.md).
* Сведения о подключении к присоединенным к домену кластерам HDInsight с использованием SSH см. в статье [Использование SSH с Hadoop на основе Linux в HDInsight из Linux, Unix или OS X](../hdinsight-hadoop-linux-use-ssh-unix.md#domainjoined).

