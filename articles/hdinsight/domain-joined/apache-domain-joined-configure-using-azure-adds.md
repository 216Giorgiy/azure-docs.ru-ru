---
title: Настройка присоединенного к домену кластера HDInsight с помощью доменных служб Azure AD
description: Узнайте, как установить и настроить присоединенные к домену кластеры HDInsight с помощью доменных служб Azure Active Directory.
services: hdinsight
ms.service: hdinsight
author: omidm1
ms.author: omidm
editor: jasonwhowell
ms.topic: conceptual
ms.date: 07/17/2018
ms.openlocfilehash: 0d44812c92fd14bf87aac9a942241f8de55f2eec
ms.sourcegitcommit: 1f0587f29dc1e5aef1502f4f15d5a2079d7683e9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2018
ms.locfileid: "39590595"
---
# <a name="configure-a-domain-joined-hdinsight-cluster-by-using-azure-active-directory-domain-services"></a>Настройка присоединенных к домену кластеров HDInsight с помощью доменных служб Azure Active Directory

Присоединенные к домену кластеры обеспечивают многопользовательский доступ к кластерам Azure HDInsight. Присоединенные к домену кластеры HDInsight подключаются к доменам. Таким образом, пользователи домена могут использовать свои учетные данные домена для аутентификации в кластерах и выполнения заданий по обработке больших объемов данных. 

Из этой статьи вы узнаете, как настроить присоединенный к домену кластер HDInsight с использованием доменных служб Azure Active Directory (Azure AD DS).

## <a name="enable-azure-ad-ds"></a>Включение Azure AD DS

Включение Azure AD DS является необходимым предварительным условием, которое нужно выполнить, прежде чем вы сможете создать присоединенный к домену кластер HDInsight. Дополнительные сведения см. в разделе [Включение доменных служб Azure Active Directory с помощью портала Azure](../../active-directory-domain-services/active-directory-ds-getting-started.md). 

> [!NOTE]
> Только администраторы клиента имеют привилегии для создания экземпляра Azure AD DS. Если вы используете Azure Data Lake Storage 1-го поколения в качестве хранилища по умолчанию для HDInsight, убедитесь, что используемый по умолчанию клиент Azure AD для Data Lake Storage 1-го поколения совпадает с доменом для кластера HDInsight. Так как в Hadoop используется протокол Kerberos и обычная проверка подлинности, многофакторная проверка подлинности должна быть отключена для пользователей, которые будут иметь доступ к кластеру.

После того, как вы подготовили экземпляр Azure AD DS, создайте учетную запись службы в Azure Active Directory (Azure AD) с соответствующими разрешениями. Если эта учетная запись службы уже существует, сбросьте ее пароль и подождите, пока она синхронизируется с Azure AD DS. Сброс приведет к созданию хэша пароля Kerberos, и синхронизация с Azure AD DS может занять до 30 минут. 

Эта учетная запись службы должна иметь такие привилегии:

- Присоединение компьютеров к домену и помещение субъектов компьютеров в определенное подразделение, которое указывается во время создания кластера.
- Создание субъектов-служб в определенном подразделении, которое указывается во время создания кластера.

> [!NOTE]
> Так как в Apache Zeppelin используется доменное имя для аутентификации административной учетной записи службы, для правильной работы Apache Zeppelin учетная запись *должна* иметь то же доменное имя, что и ее суффикс имени участника-пользователя.

Дополнительные сведения о подразделениях и управлении ими см. в разделе [Создание подразделения в управляемом домене доменных служб Azure AD](../../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md). 

Защищенный протокол LDAP предназначен для управляемого домена Azure AD DS. Дополнительные сведения см. в разделе [Настройка защищенного протокола LDAP (LDAPS) для управляемого домена доменных служб Azure AD](../../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md).

## <a name="create-a-domain-joined-hdinsight-cluster"></a>Создание присоединенного к домену кластера HDInsight

Следующим шагом является создание кластера HDInsight с использованием Azure AD DS и учетной записи службы, созданной в предыдущем разделе.

Проще разместить экземпляр Azure AD DS и кластер HDInsight в одной и той же виртуальной сети Azure. Если вы решили поместить их в разные виртуальные сети, необходимо установить пиринг между этими виртуальными сетями, чтобы виртуальные машины HDI могли напрямую обращаться к контроллеру домена для присоединения виртуальных машин. Дополнительные сведения см. в статье [Пиринг между виртуальными сетями](../../virtual-network/virtual-network-peering-overview.md).

При создании кластера HDInsight, присоединенного к домену, необходимо указать следующие параметры:

- **Доменное имя**. Доменное имя, связанное с Azure AD DS. Например, contoso.onmicrosoft.com.

- **Имя пользователя домена**. Учетная запись службы в управляемом домене Azure AD DS в контроллере домена, созданная в предыдущем разделе. Например, hdiadmin@contoso.onmicrosoft.com. Этот пользователь домена станет администратором этого кластера HDInsight.

- **Пароль домена**. Пароль учетной записи службы.

- **Подразделение**. Уникальное имя подразделения, которое необходимо использовать с кластером HDInsight. Например, OU=HDInsightOU,DC=contoso,DC=onmicrosoft,DC=com. Если это подразделение не существует, кластер HDInsight пытается создать подразделение, используя привилегии, которые имеет учетная запись службы. Например, если учетная запись службы добавлена в группу администраторов Azure AD DS, она имеет соответствующие разрешения на создание подразделения. Если нет, вам потребуется сначала создать подразделение, а затем предоставить учетной записи службы полный контроль над этим подразделением. Дополнительные сведения см. в разделе [Создание подразделения в управляемом домене доменных служб Azure AD](../../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md).

    > [!IMPORTANT]
    > Укажите все контроллеры домена, разделенные запятой, после подразделения (например, OU=HDInsightOU,DC=contoso,DC=onmicrosohift,DC=com).

- **URL-адрес LDAPS**. Например, ldaps://contoso.onmicrosoft.com:636.

    > [!IMPORTANT]
    > Следует ввести полный URL-адрес, включая ldaps:// и номер порта (:636).

- **Access user group** (Группа пользователей с доступом). Группы безопасности, пользователей которых нужно синхронизировать с кластером. Например, HiveUsers. Чтобы указать несколько групп пользователей, разделяйте их точкой с запятой (;). Группы должны быть в каталоге до того, как вы начнете подготовку. Дополнительные сведения см. в статье [Создание группы и добавление в нее пользователей в Azure Active Directory](../../active-directory/fundamentals/active-directory-groups-create-azure-portal.md). Если группа отсутствует, отображается сообщение об ошибке "Group HiveUsers not found in the Active Directory" (Группа HiveUsers не найдена в Active Directory).

На следующем снимке экрана показаны конфигурации на портале Azure:

   ![Конфигурация доменных служб Active Directory в присоединенном к домену кластере Azure HDInsight](./media/apache-domain-joined-configure-using-azure-adds/hdinsight-domain-joined-configuration-azure-aads-portal.png).


## <a name="next-steps"></a>Дополнительная информация
* Сведения о настройке политик Hive и выполнении запросов Hive см. в разделе [Настройка политик Hive в присоединенном к домену кластере HDInsight](apache-domain-joined-run-hive.md).
* Сведения о подключении к присоединенным к домену кластерам HDInsight с использованием SSH см. в разделе [Использование SSH с Hadoop на основе Linux в HDInsight из Linux, Unix или OS X](../hdinsight-hadoop-linux-use-ssh-unix.md#domainjoined).

