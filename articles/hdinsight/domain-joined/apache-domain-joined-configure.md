---
title: "Управление присоединенными к домену кластерами HDInsight в Azure | Документы Майкрософт"
description: "Узнайте, как установить и настроить присоединенные к домену кластеры HDInsight"
services: hdinsight
documentationcenter: 
author: saurinsh
manager: jhubbard
editor: cgronlun
tags: 
ms.assetid: 0cbb49cc-0de1-4a1a-b658-99897caf827c
ms.service: hdinsight
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 12/15/2017
ms.author: saurinsh
ms.openlocfilehash: 0a9ed1cad8b8d4c566a0da16ac78d096efe187a5
ms.sourcegitcommit: b7adce69c06b6e70493d13bc02bd31e06f291a91
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/19/2017
---
# <a name="configure-domain-joined-hdinsight-sandbox-environment"></a>Настройка тестовой среды HDInsight, присоединенных к домену

Узнайте, как настроить кластер Azure HDInsight с автономной Active Directory и [круг Apache](http://hortonworks.com/apache/ranger/) преимуществами строгой проверки подлинности и широкий доступ на основе ролей с помощью политик управления (RBAC). Дополнительные сведения см. в статье [Introduce Domain-joined HDInsight clusters](apache-domain-joined-introduction.md) (Введение в присоединенные к домену кластеры HDInsight).

Без кластера HDInsight, присоединенных к домену, каждый кластер может иметь только учетная запись пользователя Hadoop HTTP и учетной записи пользователя SSH.  Проверку подлинности пользователей несколькими может осуществляться с помощью:

-   Автономный Active Directory под управлением Azure IaaS
-   Azure Active Directory
-   Active Directory, работающей в локальной среде клиента.

С помощью автономного Active Directory выполняемой в Azure IaaS рассматривается в этой статье. Это простейший архитектура, которую клиент сможет получить поддержку нескольких пользователей на HDInsight. 

> [!IMPORTANT]
> Диспетчер Oozie не включен в присоединенном к домену кластере HDInsight.

## <a name="prerequisite"></a>Предварительные требования
* Подписка Azure.

## <a name="create-an-active-directory"></a>Создание Active Directory

Шаблон диспетчера ресурсов Azure упрощает создание ресурсов Azure. В этом разделе используется [быстрый запуск Azure шаблона](https://azure.microsoft.com/resources/templates/active-directory-new-domain-ha-2-dc/) для создания нового леса и домена с двумя виртуальными машинами. Две виртуальные машины используются в качестве основного контроллера домена и резервный контроллер домена.

**Для создания домена с контроллерами домена**

1. Щелкните следующее изображение, чтобы открыть шаблон на портале Azure.

    <a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Factive-directory-new-domain-ha-2-dc%2Fazuredeploy.json" target="_blank"><img src="./media/apache-domain-joined-configure/deploy-to-azure.png" alt="Deploy to Azure"></a>

    Шаблон выглядит следующим образом.

    ![HDInsight домену создания леса домена виртуальных машин](./media/apache-domain-joined-configure/hdinsight-domain-joined-create-arm-template.png)

2. Введите следующие значения.

    - **Подписка**— выберите подписку Azure.
    - **Имя группы ресурсов**: Введите имя группы ресурсов.  Группа ресурсов используется для управления ресурсами Azure, связанных с проектом.
    - **Расположение**: выберите расположение Azure, близкий к вам.
    - **Имя пользователя администратора**: это имя пользователя администратора домена. Этот пользователь не является учетная запись пользователя HTTP кластера HDInsight. Это учетную запись, используемую всего учебника.
    - **Пароль администратора**: Введите пароль для администратора домена.
    - **Имя домена**: имя домена должно быть двухкомпонентным именем. Например: contoso.com, или contoso.local или hdinsight.test.
    - **Префикс DNS**: введите префикс DNS
    - **Порт RDP PDC**: (использовать значение по умолчанию для этого учебника)
    - **Порт RDP BDC**: (использовать значение по умолчанию для этого учебника)
    - **расположение артефакты**: (использовать значение по умолчанию для этого учебника)
    - **токен SAS расположения артефакты**: (оставьте поле пустым для этого учебника.)

Для создания ресурсов занимает около 20 минут.

## <a name="setup-ldaps"></a>Программа установки LDAPS

LDAP Lightweight Directory Access Protocol () используется для чтения и записи в AD.

**Для подключения к основному контроллеру домена, с помощью удаленного рабочего стола**

1. Войдите на [портале Azure](https://portal.azure.com).
2. Откройте группу ресурсов, а затем откройте виртуальную машину контроллера домена основного домена. Имя основного контроллера домена по умолчанию — adPDC. 
3. Нажмите кнопку **Connect** для подключения к основному контроллеру домена, с помощью удаленного рабочего стола.

    ![HDInsight домену подключения удаленного рабочего стола основного контроллера домена](./media/apache-domain-joined-configure/hdinsight-domain-joined-remote-desktop-pdc.png)


**Для добавления служб сертификатов Active Directory**

4. Откройте **диспетчера сервера** , если он не открыт.
5. Нажмите кнопку **управление**, а затем нажмите кнопку **Добавить роли и компоненты**.

    ![HDInsight домену добавления ролей и компонентов](./media/apache-domain-joined-configure/hdinsight-domain-joined-add-roles.png)
5. «Перед началом», щелкните **Далее**.
6. Выберите **Установка ролей или компонентов**, а затем нажмите кнопку **Далее**.
7. Выберите контроллер домена и нажмите кнопку **Далее**.  Имя основного контроллера домена по умолчанию — adPDC.
8. Выберите **службы сертификатов Active Directory**.
9. Нажмите кнопку **добавить компоненты** в появившемся диалоговом окне.
10. Следуйте указаниям мастера, используйте параметры по умолчанию для остальной части процедуры.
11. Нажмите кнопку **Закрыть**, чтобы закрыть мастер.

**Настройка сертификата AD**

1. В диспетчере сервера щелкните желтый значок и нажмите кнопку **служб сертификатов Active Directory настроить**.

    ![HDInsight домену настройки сертификата AD](./media/apache-domain-joined-configure/hdinsight-domain-joined-configure-ad-certificate.png)

2. Нажмите кнопку ** служб ролей в левой части экрана выберите **центра сертификации**, а затем нажмите кнопку **Далее**.
3. Следуйте указаниям мастера, используйте параметры по умолчанию для остальной части процедуры (щелкните **Настройка** на последнем шаге).
4. Нажмите кнопку **Закрыть**, чтобы закрыть мастер.

## <a name="optional-create-ad-users-and-groups"></a>(Необязательно) Создание AD пользователей и групп

**Для создания пользователей и групп в AD**
1. Подключитесь к основному контроллеру домена, с помощью удаленного рабочего стола
1. Откройте **пользователи и компьютеры Active Directory**.
2. Выберите имя домена в левой области.
3. Нажмите кнопку **создать нового пользователя в текущем контейнере** значок в верхнем меню.

    ![Создание HDInsight к домену пользователей](./media/apache-domain-joined-configure/hdinsight-domain-joined-create-ad-user.png)
4. Следуйте инструкциям, чтобы создать несколько пользователей. Например hiveuser1 и hiveuser2.
5. Нажмите кнопку **создать новую группу в текущем контейнере** значок в верхнем меню.
6. Следуйте инструкциям, чтобы создать группу с именем **HDInsightUsers**.  Эта группа используется при создании кластера HDInsight далее в этом учебнике.

> [!IMPORTANT]
> Перед созданием кластера HDInsight, присоединенных к домену, необходимо перезагрузить контроллер домена виртуальной машины.

## <a name="create-an-hdinsight-cluster-in-the-vnet"></a>Создание кластера HDInsight в виртуальной сети

В этом разделе используется портал Azure для добавления в кластер HDInsight в виртуальной сети, созданной с помощью шаблона диспетчера ресурсов, ранее в этом учебнике. В этой статье описывается только конкретных сведений о конфигурации кластера, присоединенных к домену.  Общие сведения см. в разделе [кластеров на основе Linux, создайте в портале Azure HDInsight](../hdinsight-hadoop-create-linux-clusters-portal.md).  

**Чтобы создать кластер HDInsight, присоединенных к домену**

1. Выполните вход на [портал Azure](https://portal.azure.com).
2. Откройте группу ресурсов, созданного с помощью шаблона диспетчера ресурсов, ранее в этом учебнике.
3. Добавьте в группу ресурсов кластера HDInsight.
4. Выберите **настраиваемый** параметр:

    ![HDInsight домену настраиваемое Создание параметра](./media/apache-domain-joined-configure/hdinsight-domain-joined-portal-custom-configuration-option.png)

    Состоит из шести разделов, с помощью параметра конфигурации: основы, хранилища, приложения, размер кластера, дополнительные параметры и Сводка.
5. В **основы** раздела:

    - Тип кластера: выберите **пакет безопасности предприятия**. В настоящее время пакет безопасности предприятия можно включить только для следующих типов кластера: Hadoop, интерактивных запросов и Spark.

        ![Пакет безопасности присоединены к домену корпоративного домена HDInsight](./media/apache-domain-joined-configure/hdinsight-creation-enterprise-security-package.png)
    - Кластер имя входа пользователя: пользователь Hadoop HTTP. Эта учетная запись отличается от учетной записи администратора домена.
    - Группа ресурсов: выберите группу ресурсов, созданной ранее с помощью шаблона диспетчера ресурсов.
    - Расположение: Расположение должно совпадать с именами, которая использовалась при создании виртуальной сети и контроллеров домена, с помощью шаблона диспетчера ресурсов.

6. В **Дополнительные параметры** раздела:

    - Параметры домена:

        ![Дополнительные параметры домена, присоединенных к домену HDInsight](./media/apache-domain-joined-configure/hdinsight-domain-joined-portal-advanced-domain-settings.png)
        
        - Имя домена: Введите имя домена, который использовался в [Создание Active Directory](#create-an-active-directory).
        - Имя пользователя домена: Введите имя пользователя администратора AD, который использовался в [Создание Active Directory](#create-an-active-directory).
        - Организационное подразделение: См. снимок экрана в качестве примера.
        - URL-адрес LDAPS: См. снимок экрана, пример
        - Группа доступа пользователей: Введите имя группы пользователей, созданных в [AD Создание пользователей и групп](#optionally-createad-users-and-groups)
    - Виртуальная сеть: выберите виртуальную сеть, созданную в [Создание Active Directory](#create-an-active-directory). Имя по умолчанию, используемые в шаблоне — **adVNET**.
    - Подсети: — Имя по умолчанию, используемые в шаблоне **adSubnet**.



После завершения работы с этим руководством кластер можно удалить. В случае с HDInsight ваши данные хранятся в службе хранилища Azure, что позволяет безопасно удалить неиспользуемый кластер. Плата за кластеры HDInsight взимается, даже когда они не используются. Поскольку стоимость кластера во много раз превышает стоимость хранилища, экономически целесообразно удалять неиспользуемые кластеры. Инструкции по удалению кластера см. в статье [Управление кластерами Hadoop в HDInsight с помощью портала Azure](../hdinsight-administer-use-management-portal.md#delete-clusters).

## <a name="next-steps"></a>Дальнейшие действия
* Сведения о настройке политик Hive и выполнении запросов Hive для присоединенного к домену кластера HDInsight см. [здесь](apache-domain-joined-run-hive.md).
* Сведения о подключении к присоединенным к домену кластерам HDInsight с использованием SSH см. в статье [Использование SSH с Hadoop на основе Linux в HDInsight из Linux, Unix или OS X](../hdinsight-hadoop-linux-use-ssh-unix.md#domainjoined).

