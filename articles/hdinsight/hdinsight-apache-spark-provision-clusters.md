<properties
   pageTitle="Подготовка кластеров Apache Spark в HDInsight | Microsoft Azure"
   description="Подготовка кластеров Spark для Azure HDInsight с помощью портала Azure, Azure PowerShell, командной строки или пакета SDK HDInsight для .NET."
   services="hdinsight"
   documentationCenter=""
   authors="nitinme"
   manager="paulettm"
   editor="cgronlun"
   tags="azure-portal"/>

<tags
    ms.service="hdinsight"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="big-data"
    ms.date="12/08/2015"
    ms.author="nitinme"/>

# Создание кластеров Apache Spark в HDInsight с использованием настраиваемых параметров (Windows)

> [AZURE.NOTE]Теперь HDInsight предоставляет кластеры Spark в Linux. Сведения о том, как создать настраиваемый кластер Spark в HDInsight на платформе Linux, см. в разделе [Создание кластеров под управлением Linux в HDInsight](hdinsight-hadoop-provision-linux-clusters.md).

В большинстве случаев вы можете создать кластер Spark с помощью метода быстрого создания, как описано в разделе [Начало работы с Apache Spark в HDInsight](hdinsight-apache-spark-zeppelin-notebook-jupyter-spark-sql.md). В некоторых сценариях может потребоваться создать настраиваемый кластер. Например, может потребоваться подключить внешнее хранилище метаданных для обеспечения постоянных метаданных Hive после истечения времени существования кластера, или может потребоваться дополнительное хранилище для кластера.

Для этих и других сценариев в данной статье приводятся инструкции по использованию портала Azure, Azure PowerShell или пакета SDK .NET HDInsight для создания настроенного кластера Spark в HDInsight.


**Предварительные требования:**

Прежде чем переходить к выполнению действий, приведенных в этой статье, необходимо оформить подписку Azure. См. [Бесплатная пробная версия Azure](http://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/).

##<a id="configuration"></a>Каковы различные параметры конфигурации?

###Дополнительное хранилище

В процессе настройки вам необходимо задать учетную запись хранилища больших двоичных объектов Azure и контейнер по умолчанию. Кластер будет использовать эти данные для обозначения месторасположения контейнера по умолчанию. При желании можно также указать дополнительную учетную запись хранения Azure, которая будет связана с кластером.

>[AZURE.NOTE]Не используйте один контейнер хранилища больших двоичных объектов для нескольких кластеров. Это не поддерживается.

Дополнительную информацию об использовании дополнительных хранилищ больших двоичных объектов см. в разделе [Использование хранилища больших двоичных объектов Azure с HDInsight](hdinsight-use-blob-storage.md).

###Хранилище мета-данных

Spark позволяет определить схему и таблицы Hive в необработанных данных. Эти схемы и метаданные таблицы можно сохранить в метахранилища. Использование метахранилища помогает сохранять метаданные Hive, чтобы не создавать повторно таблицы Hive при создании нового кластера. По умолчанию Hive использует встроенную базу данных для хранения подобной информации. Встроенная база данных не сохраняет метаданные при удалении кластера.

Инструкции по созданию базы данных SQL см. в статье [Создание первой базы данных SQL Azure](sql-database-get-started.md).

### Настройка кластера

Можно установить дополнительные компоненты или настроить конфигурацию кластера с помощью сценариев во время создания. Такие сценарии вызываются с помощью **действия сценария**, которое является параметром конфигурации и может использоваться посредством портала Azure, командлетов HDInsight PowerShell или пакета SDK для HDInsight .NET. Дополнительную информацию см. в разделе [Настройка кластера HDInsight с помощью действия сценария][hdinsight-customize-cluster].


###Виртуальная сеть

[Виртуальная сеть Azure](http://azure.microsoft.com/documentation/services/virtual-network/) позволяет создать безопасную, стабильную сеть, в которой будут находиться все ресурсы, необходимые для успешного функционирования вашего решения. Виртуальная сеть позволит вам:

* Соединить облачные ресурсы с частной сетью (только для облачных решений).

	![Диаграмма конфигурации только для облачных решений](./media/hdinsight-apache-spark-provision-clusters/hdinsight-vnet-cloud-only.png)

* Соединить ваши облачные ресурсы с сетью локального центра обработки данных (типа "сеть-сеть" или "точка-сеть") при помощи виртуальной частной сети (VPN).

	Конфигурация "сервер-сервер" позволяет соединять несколько ресурсов вашего центра обработки данных с виртуальной сетью Azure при помощи программного обеспечения VPN или маршрутизации и службы удаленного доступа.

	![Диаграмма конфигурации соединения "сервер-сервер"](./media/hdinsight-apache-spark-provision-clusters/hdinsight-vnet-site-to-site.png)

	Конфигурация "точка-сеть" позволит соединить конкретный ресурс с виртуальной сетью Azure при помощи программного обеспечения VPN.

	![Диаграмма конфигурации соединения "клиент-сервер"](./media/hdinsight-apache-spark-provision-clusters/hdinsight-vnet-point-to-site.png)

Для получения более подробной информации о характеристиках, преимуществах и возможностях виртуальной сети Azure см. раздел [Обзор характеристик виртуальной сети Azure](../virtual-network/virtual-networks-overview.md).

> [AZURE.NOTE]Виртуальную сеть Azure необходимо создать до создания кластера. Дополнительную информацию см. в статье [Создание виртуальной сети](virtual-networks-create-vnet.md).
>
> Azure HDInsight поддерживает только географически привязанные виртуальные сети и на данный момент не поддерживает виртуальные сети на основе территориальных групп.
>
> Настоятельно рекомендуется назначать одну подсеть для одного кластера.

##<a id="portal"></a> С помощью портала предварительной версии Azure

Кластеры Spark в HDInsight используют контейнер хранилища больших двоичных объектов Azure как файловую систему по умолчанию. Перед созданием кластера HDInsight необходимо создать учетную запись хранения Azure для того же центра обработки данных. Дополнительные сведения см. в разделе [Использование хранилища BLOB-объектов Azure с HDInsight](hdinsight-hadoop-use-blob-storage.md). Информацию о создании учетной записи хранения Azure см. в разделе [Как создать учетную запись хранения][azure-create-storageaccount].

**Создание кластера HDInsight с использованием параметра «Настраиваемое создание»**

1. Выполните вход на [портал предварительной версии Azure](https://portal.azure.com).
2. Щелкните **Создать**, **Аналитика данных**, а затем — **HDInsight**.

    ![Создание нового кластера на портале предварительной версии Azure](./media/hdinsight-apache-spark-provision-clusters/hdispark.createcluster.1.png "Создание нового кластера на портале предварительной версии Azure")

3. Введите имя в поле **Имя кластера**, выберите значение **Spark** для параметра **Тип кластера** и в раскрывающемся списке **Операционная система кластера** выберите **Центр обработки данных Windows Server 2012 R2**. Если имя кластера доступно, рядом с ним появится зеленый флажок.

	![Введите имя и тип кластера](./media/hdinsight-apache-spark-provision-clusters/hdispark.createcluster.2.png "Введите имя и тип кластера")

4. Если у вас есть несколько подписок, выберите запись **Подписка**, чтобы выбрать подписку Azure для кластера.

5. Щелкните **Группа ресурсов**, чтобы просмотреть список существующих групп ресурсов и выбрать ту, в которой будет создан кластер, или выберите **Создать** и введите имя новой группы ресурсов. Если новое имя группы доступно, рядом с ним появится зеленый флажок.

	> [AZURE.NOTE]Эта запись будет выбрана по умолчанию для одной из существующих групп ресурсов (при их наличии).

6. Выберите **Учетные данные**, затем введите данные в поля **Имя пользователя для входа в кластер** и **Пароль для входа в кластер**. Если необходимо включить удаленный рабочий стол на узле кластера, выберите **Да** для параметра **Включить удаленный рабочий стол**. Укажите, когда истекает срок доступа кластера к удаленному рабочему столу, и предоставьте имя пользователя и пароль для пользователя удаленного рабочего стола. Нажмите **Выбрать** внизу страницы, чтобы сохранить конфигурацию учетных данных.

	![Укажите учетные данные кластера](./media/hdinsight-apache-spark-provision-clusters/hdispark.createcluster.3.png "Укажите учетные данные кластера")

7. Щелкните **Источник данных**, чтобы выбрать для кластера существующий источник данных или создать новый.

	![Колонка "Источник данных"](./media/hdinsight-apache-spark-provision-clusters/hdispark.createcluster.4.png "Укажите конфигурацию источника данных")

	В настоящее время в качестве источника данных для кластера HDInsight можно выбрать учетную запись хранения Azure. Следующие элементы интерфейса помогут вам понять записи в колонке **Источник данных**.

	- **Метод выбора**: выберите значение **Из всех подписок**, чтобы активировать поиск учетных записей хранения во всех своих подписках. Задайте для этого параметра значение **Ключ доступа**, если вы хотите ввести **имя хранилища** и **ключ доступа** существующей учетной записи хранения.

	- **Выбрать учетную запись хранения или создать новую**: щелкните **Выбрать учетную запись хранения**, чтобы найти и выбрать существующую учетную запись хранения, которую нужно связать с кластером. Чтобы создать новую учетную запись хранения, щелкните **Создать новую**. В появившееся поле введите имя учетной записи хранения. Если имя доступно, появится зеленый флажок.

	- **Выбрать контейнер по умолчанию**: позволяет ввести имя контейнера по умолчанию и использовать его для кластера. Вы можете ввести любое имя, однако мы рекомендуем использовать такое же имя, как у кластера, чтобы легко распознавать, какой контейнер используется для конкретного кластера.

	- **Расположение**: географический регион, к которому будет относиться существующая или новая учетная запись хранения.

		> [AZURE.IMPORTANT]Выбранное расположение для источника данных по умолчанию будет также определять расположение кластера HDInsight. Кластер и источник данных по умолчанию должны находиться в одном регионе.

	Нажмите **Выбрать**, чтобы сохранить конфигурацию источника данных.

8. Щелкните **Ценовые категории узла**, чтобы отобразить сведения об узлах, которые будут созданы для этого кластера. Задайте количество рабочих узлов, необходимых для кластера. Оценочная стоимость кластера отобразится в колонке.

	![Колонка "Ценовые категории узла"](./media/hdinsight-apache-spark-provision-clusters/hdispark.createcluster.5.png "Укажите количество узлов кластера")

	Нажмите **Выбрать**, чтобы сохранить конфигурацию цен узла.

9. Щелкните **Необязательная конфигурация**, чтобы выбрать версию кластера и настроить другие необязательные параметры, например присоединение **виртуальной сети** и настройку **внешнего метахранилища** для хранения данных Hive и Oozie. Вы можете настроить кластер для установки пользовательских компонентов с помощью действия сценариев или использовать с кластером дополнительные учетные записи хранения.

	* В раскрывающемся списке **Версия HDInsight** выберите версию, которую вы хотите использовать для кластера. Дополнительную информацию см. в статье [Версии кластеров HDInsight](hdinsight-component-versioning.md).

	* Щелкните **Виртуальная сеть**, чтобы предоставить сведения о конфигурации для настройки кластера как части виртуальной сети. В колонке **Виртуальная сеть** щелкните **Виртуальная сеть** и выберите сеть, которую необходимо использовать. Точно также выберите **Подсеть** для сети и нажмите кнопку **Выбрать**, чтобы сохранить конфигурацию виртуальной сети.

		![Колонка "Виртуальная сеть"](./media/hdinsight-apache-spark-provision-clusters/hdispark.createcluster.6.png "Укажите сведения о виртуальной сети")

	* Щелкните **Внешние метахранилища**, чтобы указать базу данных SQL, которую вы хотите использовать для сохранения метаданных Hive и Oozie, связанных с кластером.

		![Колонка "Пользовательские метахранилища"](./media/hdinsight-apache-spark-provision-clusters/hdispark.createcluster.7.png "Укажите внешние метахранилища")

		Для параметра **Использовать существующую базу данных SQL для метаданных Hive** выберите **Да**, укажите базу данных SQL, а затем введите имя пользователя и пароль для базы данных. Повторите эти шаги, если вы хотите **Использовать существующую базу данных SQL для метаданных Oozie**. Щелкайте **Выбрать**, пока не перейдете в колонку **Необязательная конфигурация**.

		>[AZURE.NOTE]База данных Azure SQL, используемая в качестве хранилища метаданных, должна обеспечивать подключение к другим службам Azure, в том числе Azure HDInsight. На панели мониторинга базы данных SQL Azure в правой части щелкните имя сервера. Это сервер, на котором работает экземпляр базы данных SQL. В представлении сервера щелкните **Настройка**, а затем **Службы Azure**, **Да** и **Сохранить**.

	* Щелкните **Действия скриптов**, если вы хотите использовать пользовательский скрипт для настройки кластера во время его создания. Дополнительную информацию о действиях сценариев см. в статье [Настройка кластеров HDInsight с помощью действия сценария](hdinsight-hadoop-customize-cluster.md). В колонке "Действия сценария" введите данные, как показано на снимке экрана.

		![Колонка "Действие сценария"](./media/hdinsight-apache-spark-provision-clusters/hdispark.createcluster.8.png "Укажите действие сценария")

		Нажмите кнопку **Выбрать**, чтобы сохранить изменения, внесенные в конфигурацию действий скриптов.

	* Щелкните **Ключи хранилища Azure**, чтобы указать дополнительные учетные записи хранения, которые нужно связать с кластером. В колонке **Ключи хранилища Azure** нажмите кнопку **Добавить ключ к хранилищу данных**, а затем выберите существующую учетную запись хранения или создайте новую.

		![Колонка "Дополнительное хранилище"](./media/hdinsight-apache-spark-provision-clusters/hdispark.createcluster.9.png "Укажите дополнительные учетные записи хранения")

		Щелкайте **Выбрать**, пока не перейдете в колонку **Кластер HDInsight**.

10. В колонке **Новый кластер HDInsight** обязательно выберите параметр **Закрепить на начальной панели**, а затем нажмите кнопку **Создать**. После этого кластер будет создан, а на начальную панель портала Azure будет добавлена его плитка. Значок указывает, что выполняется создание кластера. После завершения создания вместо него будет отображаться значок HDInsight.

	| При создании | Создание завершено |
	| ------------------ | --------------------- |
	| ![Индикатор подготовки на начальной панели](./media/hdinsight-apache-spark-provision-clusters/provisioning.png) | ![Плитка создания кластера](./media/hdinsight-apache-spark-provision-clusters/provisioned.png) |

	> [AZURE.NOTE]Обычно создание кластера занимает около 15 минут. Вы можете отслеживать процесс создания с помощью элемента на начальной панели или записи **Уведомления** в левой части страницы.

11. После завершения создания щелкните элемент кластера на начальной панели, чтобы открыть колонку кластера. Колонка кластера содержит важные сведения о кластере, такие как имя, группа ресурсов, к которой он принадлежит, расположение, операционная система, URL-адрес панели мониторинга кластера и т. д.

	![Колонка "Кластер"](./media/hdinsight-apache-spark-provision-clusters/hdispark.cluster.blade.png "Свойства кластера")

	Указанные ниже элементы интерфейса помогут вам понять, что означают значки в верхней части этой колонки, а также в разделах **Основные компоненты** и **Быстрые ссылки**.

	* **Параметры** и **Все параметры**: отображают колонку **Параметры** кластера, которая содержит подробные сведения о конфигурации кластера.

	* **Панель мониторинга** и **URL-адрес**: пути доступа к панели мониторинга кластера, которая представляет собой веб-портал для запуска заданий в кластере.

	* **Удаленный рабочий стол**: позволяет включать или отключать удаленный рабочий стол на узлах кластера.

	* **Масштабировать кластер**: позволяет изменить количество рабочих узлов для этого кластера.

	* **Удалить**: удаление кластера HDInsight.

	* **Быстрый запуск** (![значок облака и молнии = быстрый запуск](./media/hdinsight-apache-spark-provision-clusters/quickstart.png)): отображает данные, необходимые для начала работы с HDInsight.

	* **Пользователи** (![значок "пользователи"](./media/hdinsight-apache-spark-provision-clusters/users.png)): здесь вы можете указать разрешения на доступ к _порталу управления_ этого кластера для других пользователей в своей подписке Azure.

		> [AZURE.IMPORTANT]Этот параметр влияет _только_ на права доступа к этому кластеру на портале предварительной версии Azure. Параметр не влияет на то, кто может подключаться к кластеру HDInsight или отправлять в него задания.

	* **Теги** (![значок "теги"](./media/hdinsight-apache-spark-provision-clusters/tags.png)): теги позволяют задавать пары "ключ — значение" для определения пользовательской таксономии облачных служб. Например, вы можете создать ключ с именем __project__, а затем использовать общее значение для всех служб, связанных с определенным проектом.

	* **Панель мониторинга кластера**: открывает колонку панели мониторинга кластера, откуда вы можете запустить саму панель мониторинга кластера или записные книжки Zeppelin и Jupyter.


##<a id="powershell"></a>Использование Azure PowerShell

См. статью [Создание кластеров HDInsight](hdinsight-provision-clusters.md#create-using-azure-powershell).

Укажите параметр типа кластера Spark в командлете New-AzureRmHDInsightCluster:

	-ClusterType Spark


## Использование пакета SDK HDInsight для .NET на основе ARM

См. статью [Создание кластеров HDInsight](hdinsight-provision-clusters.md#create-using-the-hdinsight-net-sdk).

Укажите тип кластера Spark:

	private const HDInsightClusterType NewClusterType = HDInsightClusterType.Spark;


##<a id="nextsteps"></a>Дальнейшие действия

* См. статью [Выполнение интерактивного анализа данных с помощью Spark в HDInsight и средств бизнес-аналитики](hdinsight-apache-spark-use-bi-tools-v1.md), где описано использование Apache Spark в HDInsight с помощью средств бизнес-аналитики, таких как Power BI и Tableau.
* См. статью [Создание приложений машинного обучения с помощью Spark в HDInsight](hdinsight-apache-spark-ipython-notebook-machine-learning-v1.md), где описано создание приложений машинного обучения с помощью Apache Spark в HDInsight.
* См. статью [Использование Spark в HDInsight для создания приложений потоковой передачи данных в режиме реального времени](hdinsight-apache-spark-csharp-apache-zeppelin-eventhub-streaming.md), где описано создание приложений потоковой передачи с помощью Apache Spark в HDInsight.
* См. статью [Управление ресурсами кластера Apache Spark в Azure HDInsight](hdinsight-apache-spark-resource-manager-v1.md), где описано использование диспетчера ресурсов для управления ресурсами, выделенными для кластера Spark.


[hdinsight-sdk-documentation]: http://msdn.microsoft.com/library/dn479185.aspx
[hdinsight-hbase-custom-provision]: http://azure.microsoft.com/documentation/articles/hdinsight-hbase-get-started/

[hdinsight-customize-cluster]: ../hdinsight-hadoop-customize-cluster/
[hdinsight-get-started]: ../hdinsight-get-started/

[hdinsight-admin-powershell]: ../hdinsight-administer-use-powershell/
[hdinsight-admin-portal]: ../hdinsight-administer-use-management-portal/
[hadoop-hdinsight-intro]: ../hdinsight-hadoop-introduction/
[hdinsight-submit-jobs]: ../hdinsight-submit-hadoop-jobs-programmatically/
[hdinsight-powershell-reference]: https://msdn.microsoft.com/library/dn858087.aspx
[hdinsight-storm-get-started]: ../hdinsight-storm-getting-started/

[azure-management-portal]: https://manage.windowsazure.com/

[azure-command-line-tools]: ../xplat-cli/

[azure-create-storageaccount]: ../storage-create-storage-account/

[apache-hadoop]: http://go.microsoft.com/fwlink/?LinkId=510084
[azure-purchase-options]: http://azure.microsoft.com/pricing/purchase-options/
[azure-member-offers]: http://azure.microsoft.com/pricing/member-offers/
[azure-free-trial]: http://azure.microsoft.com/pricing/free-trial/
[hdi-remote]: http://azure.microsoft.com/documentation/articles/hdinsight-administer-use-management-portal/#rdp


[powershell-install-configure]: ../install-configure-powershell/


[azure-preview-portal]: https://portal.azure.com

[89e2276a]: /documentation/articles/hdinsight-use-sqoop/ "Использование Sqoop вместе с HDInsight"

<!---HONumber=AcomDC_1223_2015-->