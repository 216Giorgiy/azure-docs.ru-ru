---
title: Автоматическое масштабирование кластеров Azure HDInsight
description: Автоматическое масштабирование кластеров с помощью функции автомасштабирования HDInsight
services: hdinsight
author: hrasheed-msft
ms.reviewer: jasonh
ms.service: hdinsight
ms.custom: hdinsightactive
ms.topic: conceptual
ms.date: 01/21/2019
ms.author: hrasheed
ms.openlocfilehash: 043c83e2039d87b1650ba17f770ce16a2ad2c13d
ms.sourcegitcommit: 98645e63f657ffa2cc42f52fea911b1cdcd56453
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54811168"
---
# <a name="automatically-scale-azure-hdinsight-clusters"></a>Автоматическое масштабирование кластеров Azure HDInsight

Функция автомасштабирования кластера Azure HDInsight на основе загрузки автоматически масштабирует количество рабочих узлов в кластере в рамках предварительно заданного диапазона. Во время создания кластера HDInsight можно задать минимальное и максимальное количество рабочих узлов. Затем автомасштабирование отслеживает требования по загрузке аналитики ресурса и масштабирует количество рабочих узлов соответствующим образом. За использование этой функции не взимается дополнительная плата.

## <a name="getting-started"></a>Приступая к работе

### <a name="create-cluster-with-azure-portal"></a>Создание кластера с помощью портала Azure

> [!Note]
> Автомасштабирование в настоящее время поддерживается только для кластеров Azure HDInsight Hive, MapReduce и Spark версии 3.6.

Выполните шаги, описанные в статье [Создание кластеров под управлением Linux в HDInsight с помощью портала Azure](hdinsight-hadoop-create-linux-clusters-portal.md), а когда дойдете до шага 5, **Размер кластера**, выберите **Автомасштабирование узла рабочего процесса (предварительная версия)**, как показано ниже. 

![Включение параметра автоматического масштабирования рабочего узла](./media/hdinsight-autoscale-clusters/worker-node-autoscale-option.png)

Устанавливая этот параметр, можно указать:

* начальное количество рабочих узлов;
* минимальное количество рабочих узлов;
* максимальное количество рабочих узлов.

Начальное количество рабочих узлов должно быть в диапазоне между максимальным и минимальным количеством. Это значение определяет начальный размер кластера при его создании. Минимальное количество рабочих узлов должно быть больше нуля.

После выбора типа виртуальной машины для каждого типа узла вы сможете увидеть предполагаемый диапазон затрат для всего кластера. Затем можно скорректировать эти параметры в соответствии с любым бюджетом.

Ваша подписка имеет квоту емкости для каждого региона. Общее число ядер на головных узлах в сочетании с максимальным числом рабочих узлов не может превышать квоту емкости. Тем не менее эта квота — нестрогое ограничение. Вы всегда можете создать запрос в службу поддержки, чтобы легко ее повысить.

> [!Note]
> Если вы превысите общую квоту на ядра, вы получите сообщение о том, что максимальное число узлов превышает количество доступных ядер в регионе и нужно выбрать другой регион или обратиться в службу поддержки, чтобы увеличить квоту.

### <a name="create-cluster-with-an-resource-manager-template"></a>Создание кластера с использованием шаблона Resource Manager

При создании кластера HDInsight с использованием шаблона Resource Manager необходимо добавить следующие параметры в подраздел worker node раздела computeProfile:

```json
{                            
    "name": "workernode",
    "targetInstanceCount": 4,
    "autoscale": {
        "minInstanceCount": 2,
        "maxInstanceCount": 10
    },
    "hardwareProfile": {
        "vmSize": "Standard_D13_V2"
    },
    "osProfile": {
        "linuxOperatingSystemProfile": {
            "username": "[parameters('sshUserName')]",
            "password": "[parameters('sshPassword')]"
        }
    },
    "virtualNetworkProfile": null,
    "scriptActions": []
}
```

### <a name="enable-and-disabling-autoscale-for-a-running-cluster"></a>Включение и отключение автомасштабирования для работающего кластера

Включение автоматического масштабирования для работающего кластера на этапе закрытой предварительной версии не поддерживается. Оно должно быть включено во время создания кластера.

Отключение автомасштабирования или изменение параметров автомасштабирования для работающего кластера не поддерживается на этапе закрытой предварительной версии. Необходимо удалить кластер и создать новый кластер для удаления или изменения параметров.

## <a name="monitoring"></a>Мониторинг

Вы можете просмотреть журнал увеличения и уменьшения масштаба кластера как часть метрик кластера, а также вывести список всех действий масштабирования за последний день, неделю или более длительный период времени.

## <a name="how-it-works"></a>Принцип работы

### <a name="metrics-monitoring"></a>Мониторинг метрик

Автомасштабирование постоянно выполняет мониторинг кластера и собирает следующие метрики:

1. **Total Pending CPU** (Общее число ожидающих ЦП). Общее число ядер, необходимое для запуска выполнения всех ожидающих контейнеров.
2. **Total Pending Memory** (Общий объем ожидающей памяти). Общий объем памяти (в МБ), необходимый для запуска выполнения всех отложенных контейнеров.
3. **Total Free CPU** (Общее число свободных ЦП). Сумма всех неиспользуемых ядер на активных рабочих узлах.
4. **Total Free Memory** (Общий объем свободной памяти). Сумма неиспользуемой памяти (в МБ) на активных рабочих узлах.
5. **Used Memory per Node** (Объем используемой памяти на каждом узле). Нагрузка на рабочем узле. Рабочий узел, на котором используется 10 ГБ памяти, пребывает под большей нагрузкой, чем рабочий узел с 2 ГБ используемой памяти.
6. **Number of Application Masters per Node** (Количество основных контейнеров приложений на каждом узле). Число основных контейнеров приложений, работающих на рабочем узле. Рабочий узел, где размещено 2 таких контейнера, считается более важным, чем рабочий узел без таких контейнеров.

Эти метрики проверяются каждые 60 секунд. Автомасштабирование будет увеличивать и уменьшать масштаб на основе этих метрик.

### <a name="cluster-scale-up"></a>Увеличение масштаба кластера

При обнаружении следующих условий функция автомасштабирования будет выдавать запрос на увеличение масштаба:

* Общее число ожидающих ЦП больше, чем общее число свободных ЦП в течение более чем 1 минуты.
* Общий объем ожидающей памяти больше, чем общее число свободной памяти в течение более чем 1 минуты.

Мы вычислим, что N новых рабочих узлов требуется для соответствия текущим требованиям к ЦП и памяти, а затем инициируем запрос на увеличение масштаба, запросив N новых рабочих узлов.

### <a name="cluster-scale-down"></a>Уменьшение масштаба кластера

При обнаружении следующих условий функция автомасштабирования выдаст запрос на уменьшение масштаба:

* Общее число ожидающих ЦП меньше, чем общее число свободных ЦП в течение более чем 10 минут.
* Общий объем ожидающей памяти меньше, чем общее количество свободной памяти в течение более чем 10 минут.

Исходя из числа основных контейнеров приложений на каждом узле, а также текущих требований к ЦП и памяти, функция автомасштабирования будет выдавать запрос на удаление N узлов, указав, какие узлы являются потенциальными кандидатами для удаления. По умолчанию два узла будут удалены в рамках одного цикла.

## <a name="next-steps"></a>Дополнительная информация

* Прочитайте рекомендации по масштабированию кластеров вручную [здесь](hdinsight-scaling-best-practices.md).
