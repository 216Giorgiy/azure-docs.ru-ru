---
title: "Настройка присоединенных к домену кластеров HDInsight | Документация Майкрософт"
description: "Узнайте, как установить и настроить присоединенные к домену кластеры HDInsight"
services: hdinsight
documentationcenter: 
author: saurinsh
manager: jhubbard
editor: cgronlun
tags: 
ms.assetid: 0cbb49cc-0de1-4a1a-b658-99897caf827c
ms.service: hdinsight
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 11/02/2016
ms.author: saurinsh
translationtype: Human Translation
ms.sourcegitcommit: 2ea002938d69ad34aff421fa0eb753e449724a8f
ms.openlocfilehash: c28ad5efa3cfcdc63559b50056ca6c79f8d600c9


---
# <a name="configure-domain-joined-hdinsight-clusters-preview"></a>Настройка присоединенных к домену кластеров HDInsight (предварительная версия)
Узнайте, как настроить кластер Azure HDInsight с помощью Azure Active Directory (Azure AD) и [Apache Ranger](http://hortonworks.com/apache/ranger/), чтобы воспользоваться преимуществами политик строгой проверки подлинности и управления доступа на основе ролей (RBAC) с широкими возможностями.  Присоединенный к домену кластер HDInsight можно настроить только с помощью кластеров под управлением Linux. Дополнительные сведения см. в статье [Introduce Domain-joined HDInsight clusters](hdinsight-domain-joined-introduction.md) (Введение в присоединенные к домену кластеры HDInsight).

Эта статья является первым руководством в серии:

* Создайте кластер HDInsight, подключенный к Azure AD (с помощью возможностей доменных служб Azure Directory), с включенным Apache Ranger.
* Создайте и примените политики Hive с помощью Apache Ranger и разрешите пользователям (например, специалистам по обработке и анализу данных) подключиться к Hive с помощью средств на основе ODBC, например Excel, Tableau и т. д. Корпорация Майкрософт планирует в скором времени добавить другие рабочие нагрузки в присоединенный к домену кластер HDInsight, такие как HBase, Spark и Storm.

Пример итоговой топологии выглядит следующим образом:

![Топология присоединенного к домену кластера HDInsight](.\\media\\hdinsight-domain-joined-configure\\hdinsight-domain-joined-topology.png)

Так как в настоящее время Azure AD поддерживает только классические виртуальные сети, а кластеры HDInsight под управлением Linux поддерживают только виртуальные сети на основе Azure Resource Manager, для интеграции HDInsight с Azure AD нужно создать две виртуальные сети и настроить пиринг между ними. Сравнительные сведения о двух моделях развертывания см. в статье [Развертывание с помощью Azure Resource Manager и классическое развертывание: сведения о моделях развертывания и состоянии ресурсов](../resource-manager-deployment-model.md). Две виртуальные сети должны находиться в одном регионе с доменными службами Azure Active Directory.

Имена служб Azure должны быть глобально уникальными. В этом руководстве используются имена, представленные ниже. Contoso — это вымышленное имя. При работе с руководством *contoso* необходимо заменить другим именем. 

**Имена:**

| Свойство | Значение |
| --- | --- |
| Виртуальная сеть Azure AD |contosoaadvnet |
| Группа ресурсов виртуальной сети Azure AD |contosoaadrg |
| Виртуальная машина Azure AD |contosoaadadmin. Эта виртуальная машина используется для настройки подразделения и обратной зоны DNS. |
| Каталог Azure AD |contosoaaddirectory |
| Доменное имя Azure AD |contoso (contoso.onmicrosoft.com) |
| Виртуальная сеть HDInsight |contosohdivnet |
| Группа ресурсов виртуальной сети HDInsight |contosohdirg |
| Кластер HDInsight |contosohdicluster |

В этом руководстве представлены шаги по настройке присоединенного к домену кластера HDInsight. В каждом разделе содержатся ссылки на другие статьи с дополнительными справочными сведениями.

## <a name="prerequisite"></a>Предварительные требования:
* Ознакомьтесь с [доменными службами Azure AD](https://azure.microsoft.com/services/active-directory-ds/) и их [ценовой](https://azure.microsoft.com/pricing/details/active-directory-ds/) структурой.
* Убедитесь, что ваша подписка внесена в список разрешенных подписок для этой общедоступной предварительной версии. Для этого можно отправить сообщение с идентификатором подписки по адресу hdipreview@microsoft.com.
* SSL-сертификат, подписанный заверителем подписи для вашего домена. Сертификат требуется для настройки защищенного протокола LDAP. Нельзя использовать самозаверяющие сертификаты.

## <a name="procedures"></a>Процедуры
1. Создайте классическую виртуальную сеть Azure для Azure AD.  
2. Создайте и настройте Azure AD и доменные службы Azure Active Directory.
3. Добавьте виртуальную машину в классическую виртуальную сеть для создания подразделения. 
4. Создайте подразделение для доменных служб Azure Active Directory.
5. Создайте виртуальную сеть HDInsight в режиме управления ресурсами Azure.
6. Настройте обратные зоны DNS для доменных служб Azure Active Directory.
7. Установите пиринг между двумя виртуальными сетями.
8. Создание кластера HDInsight.

> [!NOTE]
> В этом руководстве предполагается, что служба Azure AD не установлена. Если она установлена, можно пропустить часть инструкций на шаге 2.
> 
> 

Есть скрипт PowerShell, который автоматизирует выполнение шагов 3–7.  Дополнительные сведения см. в статье [Configure Domain-joined HDInsight clusters use Azure PowerShell](hdinsight-domain-joined-configure-use-powershell.md) (Настройка присоединенных к домену кластеров HDInsight с использованием Azure PowerShell).

## <a name="create-an-azure-classic-vnet"></a>Создание классической виртуальной сети Azure
В этом разделе вы создадите классическую виртуальную сеть с помощью портала Azure. В следующем разделе вы включите доменные службы Azure Active Directory для Azure AD в классической виртуальной сети. Дополнительные сведения о следующей процедуре и использовании других методов создания виртуальной сети см. в статье [Создание (классической) виртуальной сети с помощью портала Azure](../virtual-network/virtual-networks-create-vnet-classic-portal.md).

**Создание классической виртуальной сети**

1. Выполните вход на [портал Azure](https://portal.azure.com). 
2. Щелкните **Создать** > **Сети** > **Виртуальная сеть**.
3. В разделе **Выбор модели развертывания** щелкните **Классическая** и нажмите кнопку **Создать**.
4. Введите или выберите следующие значения:
   
   * **Имя**: contosoaadvnet.
   * **Пространство адресов**: 10.1.0.0/16.
   * **Имя подсети**: Subnet1.
   * **Диапазон адресов подсети**: 10.1.0.0/24.
   * **Подписка**. Выберите подписку Azure, используемую для создания этого кластера.
   * **Группа ресурсов.** contosoaadrg.
   * **Расположение**. Выберите регион для кластера HDInsight.
     
     > [!IMPORTANT]
     > Необходимо выбрать расположение, поддерживающее доменные службы Azure Active Directory. Дополнительные сведения см. в статье [Доступность продуктов по регионам](https://azure.microsoft.com/en-us/regions/services/). 
     > 
     > Классическая виртуальная сеть и виртуальная сеть группы ресурсов должны находиться в одном регионе с доменными службами Azure Active Directory.
     > 
     > 
5. Щелкните **Создать**, чтобы создать виртуальную сеть.

## <a name="create-and-configure-azure-ad-ds-for-your-azure-ad"></a>Создание и настройка доменных служб Azure Active Directory для Azure AD
В этом разделе вы сделаете следующее:

1. Создадите каталог Azure AD.
2. Создадите пользователей Azure AD. Эти пользователи являются пользователями домена. Первый из них используется для настройки кластера HDInsight с помощью Azure AD.  В этом руководстве остальные два пользователя являются необязательными. Они будут использоваться в статье [Configure Hive policies for Domain-joined HDInsight clusters](hdinsight-domain-joined-run-hive.md) (Настройка политик Hive для присоединенных к домену кластеров HDInsight) при настройке политики Apache Ranger.
3. Создадите группу "Администраторы контроллера домена AAD" и добавите в нее пользователя Azure AD. Этот пользователь используется для создания подразделения.
4. Включите доменные службы Azure Active Directory для Azure AD.
5. Настроите LDAPS для Azure AD. Протокол LDAP используется для чтения и записи в Azure AD.

Если вы предпочитаете использовать имеющийся каталог Azure AD, можно пропустить шаги 1 и 2.

**Создание каталога Azure AD**

1. На [классическом портале Azure](https://manage.windowsazure.com) щелкните **Создать** > **Службы приложений** > **Active Directory** > **Каталог** > **Настраиваемое создание**. 
2. Введите или выберите следующие значения:
   
   * **Имя**: contosoaaddirectory.
   * **Имя домена**: contoso.  Оно должно быть глобально уникальным.
   * **Страна или регион**. Выберите свою страну или регион.
3. Нажмите **Завершено**.

**Создание пользователя Azure AD**

1. На [классическом портале Azure](https://manage.windowsazure.com) щелкните **Active Directory** -> **contosoaaddirectory**. 
2. В верхнем меню щелкните **Пользователи**.
3. Нажмите кнопку **Add User**(Добавить пользователя).
4. Введите **имя пользователя**, а затем нажмите кнопку **Далее**. 
5. Настройте профиль пользователя. В разделе **Роль** выберите **Глобальный администратор** и нажмите кнопку **Далее**.  Роль глобального администратора требуется для создания подразделений.
6. Щелкните **Создать**, чтобы получить временный пароль.
7. Скопируйте пароль и щелкните **Завершить**. Далее в этом руководстве вы используете этого пользователя глобального администратора, чтобы войти в виртуальную машину администратора для создания подразделения и настройки обратной записи DNS.

Выполните ту же процедуру, чтобы создать еще двух пользователей с ролью **Пользователь** (hiveuser1 и hiveuser2). Они будут использоваться в статье [Configure Hive policies for Domain-joined HDInsight clusters](hdinsight-domain-joined-run-hive.md) (Настройка политик Hive для присоединенных к домену кластеров HDInsight).

**Создание группы "Администраторы контроллера домена AAD" и добавление пользователя Azure AD**

1. На [классическом портале Azure](https://manage.windowsazure.com) щелкните **Active Directory** > **contosoaaddirectory**. 
2. В верхнем меню щелкните **Группы**.
3. Щелкните **Добавить группу**. ****
4. Введите или выберите следующие значения:
   
   * **Имя**: "Администраторы контроллера домена AAD".  Не изменяйте имя группы.
   * **Тип группы**: безопасность.
5. Нажмите **Завершено**.
6. Щелкните **AAD DC Administrators** (Администраторы контроллера домена AAD), чтобы открыть группу.
7. Щелкните **Добавить членов**.
8. Выберите первого пользователя, созданного на предыдущем шаге, и щелкните **Завершить**.
9. Повторите те же действия для создания другой группы с именем **HiveUsers** и добавьте в нее двух пользователей Hive.

Дополнительные сведения см. в разделе ["Создание группы администраторов контроллера домена AAD" в статье "Доменные службы Azure AD (предварительная версия)"](../active-directory-domain-services/active-directory-ds-getting-started.md).

**Включение доменных служб Azure Active Directory для Azure AD**

1. На [классическом портале Azure](https://manage.windowsazure.com) щелкните **Active Directory** > **contosoaaddirectory**. 
2. В верхнем меню щелкните **Настроить**.
3. Прокрутите вниз до раздела **Доменные службы** и задайте следующие значения:
   
   * **Включить доменные службы для этого каталога**. Установите значение "Да".
   * **DNS-имя домена доменных служб**. Этот параметр позволяет отобразить DNS-имя по умолчанию для каталога Azure. Например, contoso.onmicrosoft.com.
   * **Подключение доменных служб к виртуальной сети**. Выберите классическую виртуальную сеть, созданную ранее, т. е. **contosoaadvnet**.
4. В нижней части страницы нажмите кнопку **Сохранить**. Возле пункта **Включить доменные службы для этого каталога** появится сообщение **Ожидание...**.  
5. Подождите, пока сообщение **Ожидание...** не исчезнет и не заполнится поле **IP-адрес**. Будет указано два IP-адреса. Это IP-адреса контроллеров домена, подготовленных с помощью доменных служб. Все IP-адреса отобразятся после того, как соответствующий контроллер домена будет готов к использованию. Запишите эти два IP-адреса. Они вам потребуются позднее.

Дополнительные сведения см. в статье [Включение доменных служб Azure AD](../active-directory-domain-services/active-directory-ds-getting-started-enableaadds.md) из серии статей про доменные службы Azure Active Directory.

**Синхронизация пароля**

При использовании собственного домена необходимо синхронизировать пароль. См. раздел [Включение синхронизации паролей в доменных службах AAD для исключительно облачного каталога Azure AD](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md).

**Настройка LDAPS для Azure AD**

1. Получите SSL-сертификат, подписанный заверителем подписи для вашего домена. Нельзя использовать самозаверяющие сертификаты. Если вам не удается получить SSL-сертификат, обратитесь с просьбой по поводу исключения по адресу hdipreview@microsoft.com.
2. На [классическом портале Azure](https://manage.windowsazure.com) щелкните **Active Directory** > **contosoaaddirectory**. 
3. В верхнем меню щелкните **Настроить**.
4. Прокрутите страницу до раздела **Доменные службы**.
5. Щелкните **Настройка сертификата**.
6. Следуйте инструкциям, чтобы указать файл сертификата и пароль. Возле пункта **Включить доменные службы для этого каталога** появится сообщение **Ожидание...**.  
7. Подождите, пока сообщение **Ожидание...** не исчезнет и не заполнится поле **Сертификат защищенного LDAP**.  Это может занять более 10 минут.

> [!NOTE]
> Если в доменных службах Azure Active Directory выполняются некоторые фоновые задачи, при отправке сертификата может появиться следующая ошибка: <i>В этом клиенте выполняется операция. Повторите попытку позже</i>.  При возникновении этой ошибки повторите попытку через некоторое время. Для подготовки второго IP-адреса контроллера домена может понадобиться не более 3 часов.
> 
> 

Дополнительные сведения см. в статье [Настройка защищенного протокола LDAP (LDAPS) для управляемого домена доменных служб Azure AD](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md).

## <a name="configure-an-organizational-unit-and-reverse-dns"></a>Настройка подразделения и обратных записей DNS
В этом разделе вы добавите виртуальную машину в виртуальную сеть Azure AD и установите в ней средства администрирования для настройки подразделения и обратной записи DNS. Обратный поиск DNS требуется для проверки подлинности Kerberos.

**Создание виртуальной машины в виртуальной сети**

1. На [классическом портале](https://manage.windowsazure.com) щелкните **Создать** > **Вычисления** > **Виртуальная машина** > **Из коллекции**.
2. Выберите образ и нажмите кнопку **Далее**.  Если вы не знаете, какой из них следует использовать, выберите образ по умолчанию, **Windows Server 2012 R2 Datacenter**.
3. Введите или выберите следующие значения:
   
   * Имя виртуальной машины: **contosoaadadmin**.
   * Уровень: **Базовый**.
   * Имя нового пользователя. Введите имя пользователя.
   * Пароль. Введите пароль.
     
     Обратите внимание, что используются имя пользователя и пароль локального администратора.
4. Щелкните **Далее**
5. В разделе **Регион или виртуальная сеть** выберите новую виртуальную сеть, созданную на предыдущем шаге (contosoaadvnet), и нажмите кнопку **Далее**.
6. Нажмите **Завершено**.

**Подключение к виртуальной машине по протоколу удаленного рабочего стола**

1. На [классическом портале Azure](https://manage.windowsazure.com) щелкните **Виртуальные машины** > **contosoaadadmin**.
2. В меню вверху щелкните **Панель мониторинга** .
3. В нижней части страницы щелкните **Подключиться**.
4. Следуйте инструкциям и используйте имя пользователя и пароль локального администратора для подключения.

**Присоединение виртуальной машины к домену Azure AD**

1. В сеансе RDP щелкните **Пуск** и **Диспетчер серверов**.
2. В меню слева щелкните **Локальный сервер**.
3. В рабочей группе щелкните **Рабочая группа**.
4. Щелкните **Изменить**.
5. Щелкните **Домен**, введите **contoso.onmicrosoft.com**, а затем нажмите кнопку **ОК**.
6. Введите учетные данные пользователя домена и нажмите кнопку **ОК**.
7. Нажмите кнопку **ОК**.
8. Щелкните **ОК**, чтобы подтвердить перезагрузку компьютера.
9. Нажмите кнопку **Закрыть**
10. Щелкните **Перезагрузить сейчас**.

Дополнительные сведения см. в статье [Присоединение виртуальной машины Windows Server к управляемому домену](../active-directory-domain-services/active-directory-ds-admin-guide-join-windows-vm.md).

**Установка средств администрирования Active Directory и средств DNS**

1. Подключитесь к **contosoaadadmin** по протоколу удаленного рабочего стола с помощью учетной записи пользователя Azure AD.
2. Щелкните **Пуск** и **Диспетчер серверов**.
3. В меню слева щелкните **Панель мониторинга**.
4. Щелкните **Управление**, а затем — **Добавить роли и компоненты**.
5. Нажмите кнопку **Далее**.
6. Выберите **Установка ролей или компонентов**, а затем нажмите кнопку **Далее**.
7. Выберите текущую виртуальную машину из пула серверов и нажмите кнопку **Далее**.
8. Нажмите кнопку **Далее**, чтобы пропустить роли.
9. Разверните пункт **Средства удаленного администрирования сервера**, а затем — **Средства администрирования ролей** и выберите **Средства AD DS и AD LDS**, а также **Средства DNS-сервера**. Затем нажмите кнопку **Далее**. 
10. Щелкните **Далее**
11. Щелкните **Install**(Установить).

Дополнительные сведения см. в разделе [Установка средств администрирования Active Directory на виртуальную машину](../active-directory-domain-services/active-directory-ds-admin-guide-administer-domain.md#task-2---install-active-directory-administration-tools-on-the-virtual-machine).

**Настройка обратной записи DNS**

1. Подключитесь к contosoaadadmin по протоколу удаленного рабочего стола с помощью учетной записи пользователя Azure AD.
2. Щелкните **Пуск**, **Администрирование** и **DNS**. 
3. Щелкните **Нет**, чтобы пропустить добавление ContosoAADAdmin.
4. Выберите параметр **The following computer** (Следующий компьютер), введите IP-адрес первого DNS-сервера, настроенного ранее, и нажмите кнопку **ОК**.  Контроллер домена и DNS добавятся на панели слева.
5. Разверните пункт контроллера домена и DNS-сервера, щелкните правой кнопкой мыши **Зоны обратного просмотра** и выберите пункт **Новая зона**. Откроется мастер создания новой зоны.
6. Нажмите кнопку **Далее**.
7. Выберите параметр **Основная зона** и нажмите кнопку **Далее**.
8. Выберите параметр **Для всех DNS-серверов, работающих на контроллерах домена в этом домене** и нажмите кнопку **Далее**.
9. Выберите параметр **Зона обратного просмотра IPv4**, а затем нажмите кнопку **Далее**.
10. В поле **ИД сети** введите префикс диапазона номеров сети для виртуальной сети HDInsight и нажмите кнопку **Далее**. В следующем разделе вы создадите виртуальную сеть HDInsight.
11. Нажмите кнопку **Далее**.
12. Нажмите кнопку **Далее**.
13. Нажмите кнопку **Готово**

Подразделение, которое вы создадите, будет использоваться при создании кластера HDInsight. В этом подразделении будут находиться системные пользователи Hadoop и учетные записи компьютеров.

**Создание подразделения в управляемом домене доменных служб Azure Active Directory**

1. Подключитесь к **contosoaadadmin** по протоколу удаленного рабочего стола, используя учетную запись домена в группе **Администраторы контроллера домена AAD**.
2. Щелкните **Пуск**, **Администрирование** и **Центр администрирования Active Directory**.
3. Щелкните имя домена на панели слева. Например, contoso.
4. Под именем домена на панели **Задача** щелкните **Создать**, а затем — **Подразделение**.
5. Введите имя, например **HDInsightOU**, а затем нажмите кнопку **ОК**. 

Дополнительные сведения см. в статье [Создание подразделения в управляемом домене доменных служб Azure AD](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md).

## <a name="create-a-resource-manager-vnet-for-hdinsight-cluster"></a>Создание виртуальной сети Resource Manager для кластера HDInsight
В этом разделе вы создадите виртуальную сеть Azure Resource Manager, которая будет использоваться для кластера HDInsight. Дополнительные сведения о создании виртуальной сети Azure с помощью других методов см. в статье [Создание виртуальной сети с помощью портала Azure](../virtual-network/virtual-networks-create-vnet-arm-pportal.md).

Создав виртуальную сеть Resource Manager, вы настроите ее для использования тех же DNS-серверов, что и для виртуальной сети Azure AD. Если вы следовали инструкциям по созданию классической виртуальной сети и виртуальной сети Azure AD в этом руководстве, вы использовали DNS-серверы 10.1.0.4 и 10.1.0.5.

**Создание виртуальной сети Resource Manager**

1. Выполните вход на [портал Azure](https://portal.azure.com).
2. Щелкните **Создать**, **Сети** и **Виртуальная сеть**. 
3. В разделе **Выбор модели развертывания** выберите **Resource Manager** и нажмите кнопку **Создать**.
4. Введите или выберите следующие значения:
   
   * **Имя**: contosohdivnet.
   * **Адресное пространство**: 10.2.0.0/16. Диапазон адресов не должен перекрываться диапазонами IP-адресов классической виртуальной сети.
   * **Имя подсети**: Subnet1.
   * **Диапазон адресов подсети:** 10.2.0.0/24.
   * **Подписка**. Выберите подписку Azure.
   * **Группа ресурсов**: contosohdirg.
   * **Расположение**. Выберите то же расположение, что и для виртуальной сети Azure AD, т. е. contosoaadvnet.
5. Щелкните **Создать**.

**Настройка DNS для виртуальной сети Resource Manager**

1. На [портале Azure](https://portal.azure.com) щелкните **Больше служб** -> **Виртуальные сети**. Не щелкайте **Виртуальные сети (классика)**.
2. Щелкните **contosohdivnet**.
3. В левой части новой колонки щелкните **DNS-серверы**.
4. Щелкните **Определяется пользователем**, а затем введите следующие значения:
   
   * 10.1.0.4
   * 10.1.0.5
     
     Эти IP-адреса DNS-серверов должны совпадать с адресами DNS-серверов в виртуальной сети Azure AD (классическая виртуальная сеть).
5. Щелкните **Сохранить**.

## <a name="peer-the-azure-ad-vnet-and-the-hdinsight-vnet"></a>Установка пиринга между виртуальной сетью Azure AD и HDInsight
**Установка пиринга между двумя виртуальными сетями**

1. Выполните вход на [портал Azure](https://portal.azure.com).
2. В меню слева щелкните **Больше служб**.
3. Щелкните **Виртуальные сети**. Не щелкайте **Виртуальные сети (классика)**.
4. Щелкните **contosohdivnet**.  Это виртуальная сеть HDInsight.
5. В меню слева в колонке щелкните **Пиринги**.
6. В верхнем меню щелкните **Добавить**. Откроется колонка **Добавить пиринг**.
7. В колонке **Добавить пиринг** установите или выберите следующие значения:
   
   * **Имя**: ContosoAADHDIVNetPeering.
   * **Модель развертывания виртуальной сети**: классическая.
   * **Подписка**. Выберите имя подписки, использованной для классической виртуальной сети (Azure AD).
   * **Виртуальная сеть**: contosoaadvnet.
   * **Разрешить доступ к виртуальным сетям**. Установите этот флажок.
   * **Разрешить перенаправленный трафик**. Установите этот флажок. Не устанавливайте остальные два флажка.
8. Нажмите кнопку **ОК**.

## <a name="create-hdinsight-cluster"></a>Создание кластера HDInsight
В этом разделе вы создадите в HDInsight кластер Hadoop под управлением Linux с помощью портала Azure или [шаблона Azure Resource Manager](../resource-group-template-deploy.md). Сведения о других способах создания кластеров и их параметрах см. в статье [Создание кластеров Hadoop под управлением Linux в HDInsight](hdinsight-hadoop-provision-linux-clusters.md). Дополнительные сведения о создании в HDInsight кластеров Hadoop с помощью шаблонов Resource Manager см. в статье [Создание кластеров Hadoop под управлением Windows в HDInsight с помощью шаблонов Azure Resource Manager](hdinsight-hadoop-create-windows-clusters-arm-templates.md).

**Создание присоединенного к домену кластера HDInsight с помощью портала Azure**

1. Выполните вход на [портал Azure](https://portal.azure.com).
2. Щелкните **Создать**, **Аналитика** и **HDInsight**.
3. В колонке **Новый кластер HDInsight** введите или выберите следующие значения:
   
   * **Имя кластера**. Введите имя нового кластера для присоединенного к домену кластера HDInsight.
   * **Подписка**. Выберите подписку Azure, используемую для создания этого кластера.
   * **Конфигурация кластера**:
     
     * **Тип кластера**: Hadoop. В настоящее время присоединенный к домену кластер HDInsight поддерживают только кластеры Hadoop.
     * **Операционная система**: Linux.  Присоединенный к домену кластер HDInsight поддерживают только кластеры HDInsight под управлением Linux.
     * **Версия**: Hadoop 2.7.3 (HDI 3.5). Присоединенный к домену кластер HDInsight поддерживает только кластер HDInsight версии 3.5.
     * **Тип кластера**: PREMIUM.
       
       Щелкните **Выбрать**, чтобы сохранить изменения.
   * **Учетные данные**. Настройте учетные данные для пользователя кластера и SSH.
   * **Источник данных**. Создайте учетную запись хранения или используйте существующую учетную запись хранения в качестве учетной записи хранения по умолчанию для кластера HDInsight. Расположение должно совпадать с расположением для двух виртуальных сетей.  В этом расположении также находится кластер HDInsight.
   * **Цены**. Выберите количество рабочих узлов для кластера.
   * **Advanced configurations** (Расширенные настройки): 
     
     * **Domain-joining & Vnet/Subnet** (Присоединение к домену, виртуальная сеть и подсеть): 
       
       * **Параметры домена**: 
         
         * **Доменное имя**: contoso.onmicrosoft.com.
         * **Имя пользователя в домене**. Введите имя пользователя домена. Назначьте этому домену следующие права: присоединение компьютеров к домену и их помещение в настроенное ранее подразделение, создание субъектов-служб в настроенном ранее подразделении, создание обратных записей DNS. Этот пользователь домена станет администратором присоединенного к домену кластера HDInsight.
         * **Пароль домена**. Введите пароль пользователя домена.
         * **Подразделение.** Введите различающееся имя подразделения, настроенного ранее. Например, OU=HDInsightOU,DC=contoso,DC=onmicrosoft,DC=com.
         * **LDAPS URL** (URL-адрес LDAPS): ldaps://contoso.onmicrosoft.com:636.
         * **Access user group** (Группа доступа пользователей). Укажите группу безопасности, пользователей которой требуется синхронизировать с кластером. Например, HiveUsers.
           
           Щелкните **Выбрать**, чтобы сохранить изменения.
           
           ![Настройка параметров домена на портале для присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-configure/hdinsight-domain-joined-portal-domain-setting.png)
       * **Виртуальная сеть**: contosohdivnet.
       * **Подсеть**: Subnet1.
         
         Щелкните **Выбрать**, чтобы сохранить изменения.        
         Щелкните **Выбрать**, чтобы сохранить изменения.
   * **Группа ресурсов**. Выберите группу ресурсов, использованную для виртуальной сети HDInsight (contosohdirg).
4. Щелкните **Создать**.  

Присоединенный к домену кластер HDInsight можно также создать с помощью шаблона управления ресурсами Azure. Эта процедура представлена далее.

**Создание присоединенного к домену кластера HDInsight с помощью шаблона управления ресурсами**

1. Щелкните следующее изображение, чтобы открыть шаблон Resource Manager на портале Azure. Шаблон Resource Manager хранится в общедоступном контейнере BLOB-объектов. 
   
    <a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fhditutorialdata.blob.core.windows.net%2Farmtemplates%2Fcreate-domain-joined-hdinsight-cluster.json" target="_blank"><img src="https://acom.azurecomcdn.net/80C57D/cdn/mediahandler/docarticles/dpsmedia-prod/azure.microsoft.com/en-us/documentation/articles/hdinsight-hbase-tutorial-get-started-linux/20160201111850/deploy-to-azure.png" alt="Deploy to Azure"></a>
2. В колонке **Параметры** задайте следующие значения:
   
   * **Подписка**. Выберите подписку Azure.
   * **Группа ресурсов**. Щелкните **Использовать существующий** и укажите используемую группу ресурсов.  Например, contosohdirg. 
   * **Расположение**. Укажите расположение группы ресурсов.
   * **Имя кластера**. Введите имя создаваемого кластера Hadoop. Например, contosohdicluster.
   * **Тип кластера**. Выберите тип кластера.  Значение по умолчанию — **Hadoop**.
   * **Расположение**. Выберите расположение кластера.  Учетная запись хранения по умолчанию использует то же расположение.
   * **Cluster Worker Node count** (Количество рабочих узлов кластера). Выберите количество рабочих узлов.
   * **Имя для входа и пароль кластера**: имя для входа по умолчанию — **admin**.
   * **Имя пользователя SSH и пароль**: по умолчанию используется имя **sshuser**.  Это имя можно изменить. 
   * **Код виртуальной сети**: /subscriptions/&lt;идентификатор_подписки>/resourceGroups/&lt;имя_группы_ресурсов>/providers/Microsoft.Network/virtualNetworks/&lt;имя_виртуальной сети>.
   * **Подсеть виртуальной сети**: /subscriptions/&lt;идентификатор_подписки>/resourceGroups/&lt;имя_группы_ресурсов>/providers/Microsoft.Network/virtualNetworks/&lt;имя_виртуальной сети>/subnets/Subnet1.
   * **Доменное имя**: contoso.onmicrosoft.com.
   * **Organization Unit DN** (Различающееся имя подразделения): OU=HDInsightOU,DC=contoso,DC=onmicrosoft,DC=com.
   * **Cluster Users Group D Ns** (Различающиеся имена группы пользователей кластера): "\"CN=HiveUsers,OU=AADDC Users,DC=<DomainName>,DC=onmicrosoft,DC=com\"".
   * **LDAPUrls** (URL-адреса LDAPS): ["ldaps://contoso.onmicrosoft.com:636"].
   * **DomainAdminUserName** (Имя пользователя администратора домена). Введите имя пользователя администратора домена.
   * **DomainAdminPassword** (Пароль пользователя администратора домена). Введите пароль пользователя администратора домена.
   * **Я принимаю указанные выше условия**. Установите этот флажок.
   * **Закрепить на панели мониторинга**. Установите этот флажок.
3. Щелкните **Приобрести**. Вы увидите новый элемент под названием **Развертывание для развертывания шаблона**. Процесс создания кластера занимает около 20 минут. Когда кластер будет создан, щелкните его колонку на портале, чтобы открыть его.

После завершения работы с этим руководством кластер можно удалить. В случае с HDInsight ваши данные хранятся в службе хранилища Azure, что позволяет безопасно удалить неиспользуемый кластер. Плата за кластеры HDInsight взимается, даже когда они не используются. Поскольку стоимость кластера во много раз превышает стоимость хранилища, экономически целесообразно удалять неиспользуемые кластеры. Инструкции по удалению кластера см. в статье [Управление кластерами Hadoop в HDInsight с помощью портала Azure](hdinsight-administer-use-management-portal.md#delete-clusters).

## <a name="next-steps"></a>Дальнейшие действия
* Сведения о настройке присоединенного к домену кластера HDInsight с использованием Azure PowerShell см. в [этой статье](hdinsight-domain-joined-configure-use-powershell.md).
* Сведения о настройке политик Hive и выполнении запросов Hive для присоединенного к домену кластера HDInsight см. [здесь](hdinsight-domain-joined-run-hive.md).
* Сведения о выполнении запросов Hive с помощью SSH в присоединенных к домену кластерах HDInsight см. в статье [Использование SSH с Hadoop на основе Linux в HDInsight из Linux, Unix или OS X](hdinsight-hadoop-linux-use-ssh-unix.md#connect-to-a-domain-joined-hdinsight-cluster).




<!--HONumber=Nov16_HO3-->


