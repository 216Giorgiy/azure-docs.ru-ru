<properties
	pageTitle="Что такое R в HDInsight? Основные сведения об R Server в HDInsight (предварительная версия) | Microsoft Azure"
	description="Общие сведения о R Server в кластере HDInsight (предварительная версия) и использовании языка R для создания приложений для анализа больших объемов данных."
	services="hdinsight"
	documentationCenter=""
	authors="jeffstokes72"
	manager="paulettm"
	editor="cgronlun"/>

<tags
   ms.service="hdinsight"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="big-data"
   ms.date="06/01/2016"
   ms.author="jeffstok"/>


#Общие сведения об R Server в HDInsight (предварительная версия)

В HDInsight Premium появилась возможность создавать кластеры HDInsight в Azure, используя R Server. Это новшество позволяет специалистам по обработке и анализу данных, статистикам и программистам на R получать доступ к масштабируемым, распределенным методам аналитики в HDInsight по требованию. Кластеры можно масштабировать в соответствии с размерами имеющихся проектов и задач и удалять, когда они больше не требуются. Поскольку такие кластеры входят в Azure HDInsight, они отличаются круглосуточной поддержкой корпоративного уровня, гарантией бесперебойной работы в течение 99,9 % времени и гибкой интеграцией с другими компонентами экосистемы Azure.

>[AZURE.NOTE] R-сервер доступен только в HDInsight Premium. HDInsight Premium пока доступен только для кластеров Hadoop и Spark. Таким образом, сейчас R Server можно использовать только с кластерами Hadoop и Spark в HDInsight. Дополнительные сведения см. в статье [Новые уровни обслуживания и компоненты Hadoop, предоставляемые в HDInsight](hdinsight-component-versioning.md).

R Server в HDInsight предоставляет новейшие возможности для анализа больших наборов данных, загруженных в хранилище BLOB-объектов Azure (WASB), на базе языка R. Поскольку R Server использует открытый код на языке R, создавая приложения на базе языка R, вы можете использовать более 8000 открытых пакетов R, а также процедуры из ScaleR — пакета аналитики больших данных от Майкрософт, который входит в состав R Server. Для подключения к кластеру и выполнения сценариев на языке R удобно использовать граничный узел кластеров Премиум. Он позволяет выполнять распараллеленные распределенные функции ScaleR сразу во всех ядрах сервера граничного узла или сразу во всех узлах кластера, используя для этого ScaleR Hadoop Map Reduce или контексты вычислений Spark. Модели или прогнозы, полученные в результате анализа, можно загрузить для использования в локальном режиме или в любой другой части Azure, например, в [веб-службах](../machine-learning/machine-learning-publish-a-machine-learning-web-service.md) [студии машинного обучения Azure](http://studio.azureml.net) (AML).

## Начало работы с R Server в HDInsight

Чтобы включить R Server в кластере HDInsight, необходимо создать на портале Azure кластер Hadoop или Spark с параметром "Премиум". Оба типа кластеров используют одну и ту же конфигурацию, включающую R Server на узлах данных кластера и граничный узел как платформу для выполнения аналитики на базе R Server. Подробные инструкции по созданию кластера см. в статье [Начало работы с R Server в HDInsight](hdinsight-hadoop-r-server-get-started.md).

## Варианты хранилищ данных

По умолчанию для кластеров HDInsight используется хранилище BLOB-объектов Azure (WASB) в файловой системой HDFS, сопоставленной с контейнером BLOB-объектов. Это гарантирует единообразие работы независимо от того, какие данные передаются или записываются в хранилище кластеров в ходе анализа. Для копирования данных в большие двоичные объекты и из них удобно пользоваться служебной программой [AzCopy](../storage/storage-use-azcopy.md).

Помимо использования больших двоичных объектов, в кластер можно добавить использование [хранилища озера данных Azure](https://azure.microsoft.com/services/data-lake-store/) (ADLS). Если добавить возможности ADLS, то можно сочетать использование больших двоичных объектов и ADLS для хранилища HDFS.

На граничном узле для хранения данных можно также использовать [файлы Azure](../storage/storage-how-to-use-files-linux.md). Они позволяют установить общий файл, созданный в учетной записи хранения Azure, в файловой системе Linux. Дополнительные сведения о вариантах хранения данных для R Server в кластере HDInsight см. в статье [Параметры службы хранилища Azure для R Server в HDInsight (предварительная версия)](hdinsight-hadoop-r-server-storage.md).
  
## R Server: доступ к кластеру

Создав кластер с помощью R Server, вы можете подключиться к R-консоли на граничном узле кластера через SSH/Putty или через браузер (если на граничном узле установлена IDE RStudio Server). Дополнительные сведения об установке сервера RStudio Server см. в статье [Установка RStudio с R Server в HDInsight (предварительная версия)](hdinsight-hadoop-r-server-install-r-studio.md).

## Разработка и выполнение R-скриптов

Для создания и выполнения R-скриптов можно использовать не только распараллеленные, распределенные процедуры из библиотеки ScaleR, но и более 8000 пакетов с открытым исходным кодом. Сценарий, запускаемый на граничном узле R Server, выполняется с помощью интерпретатора R, кроме тех этапов, когда одна из функций ScaleR вызывается с контекстом вычислений Hadoop Map Reduce (RxHadoopMR) или Spark (RxSpark). В этих случаях функция выполняется в распределенном режиме на всех узлах данных (задач) кластера, связанных с соответствующими данными. Дополнительные сведения о различных параметрах контекста вычислений см. в статье [Параметры контекста вычислений для R Server в HDInsight (предварительная версия)](hdinsight-hadoop-r-server-compute-contexts.md).

## Ввод модели в эксплуатацию

После того как моделирование данных будет завершено, вы сможете запустить модель в эксплуатацию для составления прогнозов (или оценок) на основе новых данных в Azure или в локальном режиме. Рассмотрим несколько примеров.

### Оценка в HDInsight

Для получения оценки в HDInsight можно написать функцию R, которая будет вызывать вашу модель для составления прогнозов с учетом нового файла данных, загруженного в учетную запись хранения Azure, и сохранять прогнозы в этой учетной записи. Соответствующая процедура может выполняться на граничном узле кластера по требованию или по расписанию.

### Оценка в компоненте машинного обучения Azure 

Для получения оценки с использованием веб-службы машинного обучения Azure можно использовать [пакет открытого кода R для машинного обучения Azure](http://www.inside-r.org/blogs/2015/11/18/enhancements-azureml-package-connect-r-azureml-studio), который [публикует вашу модель как веб-службу Azure](http://www.r-bloggers.com/deploying-a-car-price-model-using-r-and-azureml/), создает для нее интерфейс, используя средства машинного обучения Azure, и при необходимости вызывает эту веб-службу для составления оценки. При выборе этого варианта объекты модели ScaleR необходимо конвертировать в эквивалентные объекты модели с открытым кодом. Для этого можно использовать функции приведения ScaleR (такие как `as.randomForest()`) для моделей на основе ансамблей.
  
### Локальная оценка

Для получения локальной оценки вновь созданную модель можно сериализовать в R, загрузить на локальный компьютер, десериализовать, а затем использовать для оценки новых данных. Для этого применяется подход, описанный выше в разделе [Оценка в HDInsight](#scoring-in-hdinsight), либо функция [DeployR](https://deployr.revolutionanalytics.com/).

## Поддержка кластера 

### Установка и поддержка пакетов R

Большинство используемых вами пакетов R должно будет находиться на граничном узле, поскольку именно там выполняется основная часть ваших R-скриптов. Для установки дополнительных пакетов R на граничном узле можно использовать обычный для R метод `install.packages()`.
  
Если вы пользуетесь только процедурами из библиотеки ScaleR для выполнения скриптов во всем кластере, устанавливать дополнительные пакеты R на узлы данных вам, скорее всего, не придется. Дополнительные пакеты могут потребоваться для выполнения метода **rxExec** или **RxDataStep** на узлах данных. В подобных случаях после создания кластера необходимо указать дополнительные пакеты с помощью действия скрипта. Дополнительные сведения см. в статье [Приступая к работе с R Server в HDInsight (предварительная версия)](hdinsight-hadoop-r-server-get-started.md).
  
### Изменение параметров памяти Hadoop Map Reduce 

Изменив кластер, можно скорректировать объем памяти, который будет доступен R Server при выполнении задания Map Reduce. Для этого используется пользовательский интерфейс Ambari, который можно найти в колонке вашего кластера на портале Azure. Инструкции по получению доступа к пользовательскому интерфейсу Ambari для кластера см. в статье [Управление кластерами HDInsight с помощью веб-интерфейса Ambari](hdinsight-hadoop-manage-ambari.md).

Изменить объем памяти, доступной R Server, можно также с использованием параметров Hadoop в вызове метода **RxHadoopMR**, как показано ниже.
 
	hadoopSwitches = "-libjars /etc/hadoop/conf -Dmapred.job.map.memory.mb=6656"  

### Масштабирование кластера

Существующий кластер может быть увеличен или уменьшен на портале Azure. Это позволяет получить дополнительную емкость для обработки больших объемов данных или сократить размер кластера, если он не используется. Инструкции по масштабированию кластера см. в статье [Управление кластерами Hadoop в HDInsight с помощью портала Azure](hdinsight-administer-use-portal-linux.md).

### Обслуживание системы 

Обслуживание проводится на соответствующих виртуальных машинах Linux в кластере HDInsight во внеурочное время и включает установку исправлений ОС и т. д. Как правило, обслуживание проводится в 03:30 (по местному времени виртуальной машины) по понедельникам и четвергам. Обновления устанавливаются таким образом, чтобы одновременно затрагивалось не более четверти кластера. Поскольку головные узлы избыточны и затрагиваются не все узлы данных, выполняемые в это время задания могут замедляться, однако должны выполняться до завершения. Обслуживание не затрагивает установленное пользовательское программное обеспечение и локальные данные, если только в системе не возникнет катастрофический сбой, требующий повторной сборки кластера.

## Параметры IDE для R Server в кластере HDInsight

Граничный узел Linux в кластере HDInsight Premium служит платформой для анализа на базе R. Установив подключение к кластеру, вы можете запустить интерфейс консоли для R Server, набрав R в командной строке Linux. Работать с консолью будет гораздо удобнее, если вы откроете текстовый редактор с R-скриптом в другом окне и будете вырезать и вставлять необходимые фрагменты скрипта в R-консоль.
  
Следующий шаг после создания сценария R в простом текстовом редакторе — это использование на настольном компьютере IDE на базе R, такой как недавно объявленное корпорацией Майкрософт решение [R Tools для Visual Studio](https://www.visualstudio.com/ru-RU/features/rtvs-vs.aspx) (RTVS), семейства локальных и серверных инструментов от [RStudio](https://www.rstudio.com/products/rstudio-server/) или [StatET](http://www.walware.de/goto/statet) на базе Eclipse от Walware.
  
Другой вариант — это установка IDE на самом граничном узле Linux. В подобных случаях часто используется [RStudio Server](https://www.rstudio.com/products/rstudio-server/) — IDE на основе браузера, предназначенная для удаленных клиентов. Установка RStudio Server на граничном узле кластера HDInsight Premium предоставляет доступ ко всем функциональным возможностям IDE для разработки и выполнения R-скриптов с использованием R Server в кластере и может значительно повысить производительность по сравнению со стандартным применением R-консоли. Если вас интересует RStudio Server, ознакомьтесь со статьей [Установка RStudio с R Server в HDInsight (предварительная версия)](hdinsight-hadoop-r-server-install-r-studio.md).

## Цены
 
Плата за кластер HDInsight Premium с R Server начисляется как за стандартные кластеры HDInsight и определяется в зависимости от размера соответствующей виртуальной машины для имен, данных и граничных узлов с почасовой надбавкой за категорию "Премиум". Дополнительные сведения о ценах на кластеры HDInsight уровня "Премиум", включая цены в период общедоступной предварительной версии и доступность 30-дневной бесплатной пробной версии, см. на странице [Цены на HDInsight](https://azure.microsoft.com/pricing/details/hdinsight/).

## Дальнейшие действия

По следующим ссылкам вы найдете инструкции по использованию R Server для работы с кластерами HDInsight.

- [Getting Started with R Server on HDInsight (Начало работы с R Server в HDInsight)](hdinsight-hadoop-r-server-get-started.md)

- [Add RStudio Server to HDInsight Premium (Добавление RStudio Server в HDInsight Premium)](hdinsight-hadoop-r-server-install-r-studio.md)

- [Compute context options for R Server on HDInsight Premium (Параметры контекста вычислений для R Server в HDInsight Premium)](hdinsight-hadoop-r-server-compute-contexts.md)

- [Azure Storage options for R Server on HDInsight Premium (Параметры хранилища Azure для R Server в HDInsight Premium)](hdinsight-hadoop-r-server-storage.md)

 

<!---HONumber=AcomDC_0608_2016-->