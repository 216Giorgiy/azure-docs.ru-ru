---
title: "Использование SSH с HDInsight (Hadoop) на платформе Windows, Linux, Unix или OS X | Документация Майкрософт"
description: " Вы можете получить доступ к HDInsight с помощью Secure Shell (SSH). В этом документе содержатся сведения об использовании SSH с HDInsight из клиентов Windows, Linux, Unix и OS X."
services: hdinsight
documentationcenter: 
author: Blackmist
manager: jhubbard
editor: cgronlun
tags: azure-portal
ms.assetid: a6a16405-a4a7-4151-9bbf-ab26972216c5
ms.service: hdinsight
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 01/12/2017
ms.author: larryfr
translationtype: Human Translation
ms.sourcegitcommit: 279990a67ae260b09d056fd84a12160150eb4539
ms.openlocfilehash: 37409ad3f50cdd4a7a384c96a57a35ef8c83fb8f


---
# <a name="use-ssh-with-hdinsight-hadoop-from-windows-linux-unix-or-os-x"></a>Использование SSH с HDInsight (Hadoop) на платформе Windows, Linux, Unix или OS X

> [!div class="op_single_selector"]
> * [PuTTY (Windows)](hdinsight-hadoop-linux-use-ssh-windows.md)
> * [SSH (Windows, Linux, Unix, OS X)](hdinsight-hadoop-linux-use-ssh-unix.md)

[Secure Shell (SSH)](https://en.wikipedia.org/wiki/Secure_Shell) позволяет входить в кластеры HDInsight под управлением Linux и выполнять команды с помощью интерфейса командной строки. В этом документе приведены основные сведения о SSH и подробные данные об использовании SSH с HDInsight.

## <a name="what-is-ssh"></a>Что такое SSH?

SSH — это сетевой протокол шифрования, который позволяет безопасно обмениваться данными с удаленными серверами через незащищенные сети. SSH обеспечивает безопасный вход на удаленный сервер с помощью командной строки, в этом случае — на головные узлы или граничный узел кластера HDInsight.

Вы также можете использовать SSH, чтобы туннелировать сетевой трафик от клиента к кластеру HDInsight. Туннелирование позволяет получить доступ к службам в кластере HDInsight, которые недоступны из Интернета напрямую. Дополнительные сведения о туннелировании SSH с использованием HDInsight см. [здесь](hdinsight-linux-ambari-ssh-tunnel.md).

## <a name="ssh-clients"></a>SSH-клиенты

Во многих операционных системах возможности SSH-клиента предоставляются с помощью служебных программ командной строки `ssh` и `scp`.

* __ssh__ — общий SSH-клиент, с помощью которого можно устанавливать удаленные сеансы командной строки и создавать туннели.
* __scp__ — служебная программа, копирующая файлы между локальными и удаленными системами по протоколу SSH.

В версиях Windows до Windows 10 Anniversary Edition обычно не предоставляется SSH-клиент. В этой версии Windows предусмотрен компонент Bash Windows 10 для разработчиков, в котором можно выполнять `ssh`, `scp` и другие команды Linux. Дополнительные сведения о Bash Windows 10 см. в разделе [Bash on Ubuntu on Windows](https://msdn.microsoft.com/commandline/wsl/about) (Bash для Ubuntu в Windows).

Если вы используете Windows и у вас нет доступа к Bash Windows 10, мы рекомендуем использовать один из SSH-клиентов:

* [Git для Windows](https://git-for-windows.github.io/) — предоставляет доступ к служебным программам командной строки `ssh` и `scp`.
* [PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/) — позволяет использовать графический SSH-клиент.
* [MobaXterm](http://mobaxterm.mobatek.net/) — позволяет использовать графический SSH-клиент.
* [Cygwin](https://cygwin.com/) — предоставляет доступ к служебным программам командной строки `ssh` и `scp`.

> [!NOTE]
> В инструкциях в этом документе предполагается, что у вас есть доступ к команде `ssh`. При использовании клиента, такого как PuTTY или MobaXterm, эквивалентные команду и параметры см. в документации к соответствующему продукту.

## <a name="ssh-authentication"></a>Аутентификация SSH

Для проверки подлинности при подключениях по протоколу SSH можно настроить использование пароля или [шифрование с открытым ключом](https://en.wikipedia.org/wiki/Public-key_cryptography). Использование ключа — самый безопасный вариант, так как ключ не уязвим ко многим атакам, которым подвергаются пароли. Тем не менее создавать ключи и управлять ими сложнее, чем использовать пароли.

Использование шифрования с открытым ключом предполагает создание пары _открытого_ и _закрытого_ ключей.

* **Открытый ключ** передается на узлы кластера HDInsight или в любую другую службу, для которой требуется шифрование с открытым ключом.

* **Закрытый ключ** — это ключ, который передается кластеру HDInsight, чтобы идентифицироваться, при входе с использованием SSH-клиента. Его нужно защищать и нельзя никому предоставлять.

    Вы можете повысить уровень безопасности, создав парольную фразу для закрытого ключа. Эту фразу необходимо указывать, чтобы использовать ключ.

### <a name="create-a-public-and-private-key"></a>Создание открытого и закрытого ключей

Служебная программа `ssh-keygen` является самым простым средством создания пары открытого и закрытого ключей для использования с HDInsight. Чтобы создать пару ключей, которую следует использовать с HDInsight, в командной строке выполните следующую команду:

> [!NOTE]
> Если вы используете SSH-клиент с графическим пользовательским интерфейсом, такой как MobaXterm или PuTTY, сведения о том, как создавать ключи, см. в документации по соответствующему клиенту.

    ssh-keygen -t rsa -b 2048

Вам будет предложено ввести следующую информацию:

* расположение файла — по умолчанию используется `~/.ssh/id_rsa`;

* дополнительную парольную фразу — если вы введете парольную фразу, ее нужно будет вводить снова при проверке подлинности на кластере HDInsight.

> [!IMPORTANT]
> Парольная фраза аналогична паролю для закрытого ключа. При каждом использовании закрытого ключа для проверки подлинности необходимо указывать парольную фразу, чтобы можно было использовать ключ. Если кто-то получит закрытый ключ, он не сможет использовать его без парольной фразы.
>
> Но если вы забудете парольную фразу, восстановить ее будет невозможно.

После выполнения команды будут созданы два файла:

* __id\_rsa__ — здесь содержится закрытый ключ.

    > [!WARNING]
    > Доступ к этому файлу необходимо ограничить, чтобы предотвратить несанкционированное использование служб, защищенным открытым ключом.

* __id\_rsa.pub__ — здесь содержится открытый ключ. Этот файл используется при создании кластера HDInsght.

    > [!NOTE]
    > Неважно, у кого есть доступ к _открытому_ ключу. Открытый ключ предназначен для проверки закрытого ключа. Службы, такие как SSH-сервер, используют открытый ключ для идентификации при проверке подлинности с использованием закрытого ключа.

## <a name="configure-ssh-on-hdinsight"></a>Настройка SSH в HDInsight

При создании кластера HDInsight под управлением Linux необходимо указать _имя пользователя SSH_ и _пароль_ или _открытый ключ_. Во время создания кластера эти сведения используются, чтобы создать имя для входа на узлах кластера HDInsight. Пароль или открытый ключ используется для защиты учетной записи пользователя.

Дополнительные сведения о настройке SSH во время создания кластера см. в одном из следующих документов:

* [Создание кластера HDInsight с использованием портала Azure](hdinsight-hadoop-create-linux-clusters-portal.md)
* [Создание кластера HDInsight с использованием интерфейса командной строки Azure](hdinsight-hadoop-create-linux-clusters-azure-cli.md)
* [Создание кластера HDInsight с использованием Azure PowerShell](hdinsight-hadoop-create-linux-clusters-azure-powershell.md)
* [Создание кластера HDInsight с использованием шаблонов Azure Resource Manager](hdinsight-hadoop-create-linux-clusters-arm-templates.md)
* [Создание кластера HDInsight с использованием пакета SDK для .NET](hdinsight-hadoop-create-linux-clusters-dotnet-sdk.md)
* [Создание кластера HDInsight с использованием REST](hdinsight-hadoop-create-linux-clusters-curl-rest.md)

### <a name="additional-ssh-users"></a>Дополнительные пользователи SSH

После создания кластера не рекомендуется, но можно добавлять в него дополнительных пользователей SSH.

* Для этого новых пользователей SSH нужно вручную добавить в каждый узел в кластере.

* У новых пользователей SSH будут такие же права доступа к HDInsight, как у пользователей по умолчанию. Доступ к данным или заданиям в HDInsight нельзя ограничить на основе учетной записи пользователя SSH.

Чтобы ограничить доступ для отдельного пользователя, необходимо использовать кластер, присоединенный к домену. На кластерах HDInsight, присоединенных к домену, для управления доступом к ресурсам кластера используется Active Directory.

Если кластер HDInsight присоединен к домену, после подключения с использованием SSH для проверки подлинности можно использовать Active Directory. Несколько пользователей могут устанавливать подключение с использованием SSH, а затем проходить проверку подлинности, чтобы войти в свои учетные записи Active Directory. Дополнительные сведения см. в разделе [Кластер HDInsight, присоединенный к домену](#domainjoined).

##<a name="a-idconnecta-connect-to-hdinsight"></a><a id="connect"></a>Подключение к HDInsight

Если все узлы в кластере HDInsight работают на сервере SSH, вы можете открыто подключаться через Интернет только к головным или граничным узлам.

* Чтобы подключиться к _головному узлу_, выполните команду `CLUSTERNAME-ssh.azurehdinsight.net`, где __CLUSTERNAME__ — это имя кластера HDInsight. Чтобы подключиться к первичному головному узлу, установите соединение к порту 22 (порт по умолчанию для SSH). Чтобы подключиться ко вторичному головному узлу, установите соединение к порту 23.

* Чтобы подключиться к _граничному узлу_, выполните команду `EDGENAME.CLUSTERNAME-ssh.azurehdinsight.net`, где __EDGENAME__ — имя граничного узла, а __CLUSTERNAME__ — кластера HDInsight. Чтобы подключиться к граничному узлу, используйте порт 22.

На следующих примерах объясняется, как подключиться к головному и граничному узлу кластера с именем __myhdi__, используя имя пользователя SSH __sshuser__. Имя граничного узла — __myedge__.

| Для этого... | Используйте это... |
| ----- | ----- |
| Подключение к первичному головному узлу | `ssh sshuser@myhdi-ssh.azurehdinsight.net` |
| Подключение ко вторичному головному узлу | `ssh -p 23 sshuser@myhdi-ssh.azurehdinsight.net` |
| Подключение к граничному узлу | `ssh sshuser@edge.myhdi-ssh.azurehdinsight.net` |

Если для защиты учетной записи SSH используется пароль, отобразится запрос на его ввод.

Если для защиты учетной записи SSH используется открытый ключ, возможно, потребуется указать путь к соответствующему закрытому ключу, используя параметр `-i`. На примере ниже показано использование параметра `-i`.

    ssh -i /path/to/public.key sshuser@myhdi-ssh.azurehdinsight.net

### <a name="connect-to-other-nodes"></a>Подключение к другим узлам

Рабочие узлы и узлы ZooKeeper недоступны напрямую за пределами кластера, но к ним можно получить доступ из головного или граничного узла кластера. Шаги ниже описывают общую процедуру, позволяющую сделать это.

1. Используйте SSH, чтобы подключиться к головному или граничному узлу:

        ssh sshuser@myhdi-ssh.azurehdinsight.net

2. После подключения по протоколу SSH используйте команду `ssh`, чтобы соединиться с рабочим узлом в кластере:

        ssh sshuser@wn0-myhdi

    Чтобы узнать, как получить список рабочих узлов в кластере, см. пример получения полного доменного имени для узлов кластера в документе [Управление кластерами HDInsight с помощью REST API Ambari](hdinsight-hadoop-manage-ambari-rest-api.md#example-get-the-fqdn-of-cluster-nodes).

Если учетная запись SSH защищена паролем, отобразится запрос на ввод пароля и будет установлено подключение.

При использовании ключа SSH для проверки подлинности учетной записи пользователя необходимо убедиться, что в локальной среде настроено перенаправление SSH-агента.

> [!IMPORTANT]
> При описании шагов ниже предполагается использование системы под управлением Linux или UNIX, а также Bash Windows 10. Если выполнение этих шагов в вашей системе не дает результатов, см. документацию по соответствующему SSH-клиенту.

1. Откройте в текстовом редакторе файл `~/.ssh/config`. Если этот файл отсутствует, его можно создать. Для этого в командной строке введите команду `touch ~/.ssh/config`.

2. Добавьте в файл следующий код. Замените *CLUSTERNAME* именем кластера HDInsight.

        Host CLUSTERNAME-ssh.azurehdinsight.net
          ForwardAgent yes

    Эта запись позволяет настроить перенаправление агента SSH для кластера HDInsight.

3. Чтобы проверить перенаправление агента SSH, выполните следующую команду в терминале:

        echo "$SSH_AUTH_SOCK"

    Эта команда возвращает сведения аналогичные следующим:

        /tmp/ssh-rfSUL1ldCldQ/agent.1792

    Если сведения не возвратятся, это значит, что `ssh-agent` не работает. Сведения о скриптах запуска агентов см. в документе [Using ssh-agent with ssh](http://mah.everybody.org/docs/ssh) (Использование агента SSH с SSH), а конкретные действия по установке и настройке `ssh-agent` см. в документации по соответствующему SSH-клиенту.

4. Убедившись в том, что **агент SSH** запущен, используйте следующую команду, чтобы добавить закрытый ключ SSH для агента:

        ssh-add ~/.ssh/id_rsa

    Если закрытый ключ хранится в другом файле, замените `~/.ssh/id_rsa` на путь к файлу.

<a id="domainjoined"></a>
### <a name="domain-joined-hdinsight"></a>Кластер HDInsight, присоединенный к домену

[Присоединенный к домену кластер HDInsight](hdinsight-domain-joined-introduction.md) интегрирует Kerberos с Hadoop в HDInsight. Так как пользователь SSH не является пользователем домена Active Directory, вы не сможете выполнять команды Hadoop, пока не пройдете проверку подлинности с помощью Active Directory. Чтобы проверить подлинность сеанса SSH с помощью Active Directory, выполните шаги ниже:

1. Подключитесь к кластеру HDInsight, присоединенному к домену, используя SSH, как упоминалось в разделе о [подключении к HDInsight](#connect). Например, следующая команда устанавливает подключение к кластеру HDInsight __myhdi__, используя учетную запись SSH с именем __sshuser__.

        ssh sshuser@myhdi-ssh.azurehdinsight.net

2. Выполните команду ниже, чтобы аутентифицироваться, используя имя и пароль пользователя домена:

        kinit

     Когда отобразится запрос, введите соответствующие имя пользователя и пароль.

    Дополнительные сведения о том, как настроить пользователей домена при работе с присоединенными к домену кластерами HDInsight см. [здесь](hdinsight-domain-joined-configure.md).

Теперь, после аутентификации с помощью команды `kinit`, можно использовать команды Hadoop, такие как `hdfs dfs -ls /` или `hive`.

## <a name="a-idtunnelassh-tunneling"></a><a id="tunnel"></a>Туннелирование SSH

Протокол SSH может использоваться для туннелирования локальных запросов, например веб-запросов, к кластеру HDInsight. Запрос будет затем перенаправлен к запрошенному ресурсу, как если бы исходил от головного узла кластера HDInsight.

> [!IMPORTANT]
> Туннель SSH обязателен для доступа к веб-интерфейсу некоторых служб Hadoop. Например, доступ к пользовательскому интерфейсу журнала заданий или диспетчера ресурсов можно получить только с помощью туннеля SSH.

Дополнительные сведения о создании и использовании туннеля SSH см. в статье [Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, JobHistory, NameNode, Oozie и другим веб-интерфейсам](hdinsight-linux-ambari-ssh-tunnel.md).

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы знаете, как пройти аутентификацию с помощью ключа SSH, узнайте, как использовать MapReduce с Hadoop в HDInsight.

* [Использование Hive с HDInsight](hdinsight-use-hive.md)
* [Использование Pig с HDInsight](hdinsight-use-pig.md)
* [Использование заданий MapReduce с HDInsight](hdinsight-use-mapreduce.md)

[preview-portal]: https://portal.azure.com/



<!--HONumber=Feb17_HO3-->


