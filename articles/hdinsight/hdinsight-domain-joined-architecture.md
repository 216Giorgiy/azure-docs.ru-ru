---
title: "Архитектура присоединенного к домену кластера Azure HDInsight | Документация Майкрософт"
description: "Сведения о планировании архитектуры присоединенного к домену кластера HDInsight."
services: hdinsight
documentationcenter: 
author: saurinsh
manager: jhubbard
editor: cgronlun
tags: azure-portal
ms.assetid: 7dc6847d-10d4-4b5c-9c83-cc513cf91965
ms.service: hdinsight
ms.devlang: na
ms.topic: hero-article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 02/03/2017
ms.author: saurinsh
translationtype: Human Translation
ms.sourcegitcommit: b5cd321f3cd4c415f5e97ca550b7ab1679324921
ms.openlocfilehash: 94ef8147f1f73b293e818fc508096789373df7fc


---
# <a name="plan-azure-domain-joined-hadoop-clusters-in-hdinsight"></a>Планирование архитектуры присоединенных к домену кластеров Hadoop в Azure HDInsight

Стандартный кластер Hadoop — это однопользовательский кластер. Он подходит для большинства организаций с небольшими отделами по работе с приложениями, создающими рабочие нагрузки больших данных. В связи с ростом популярности кластера Hadoop много организаций переходят на модель, когда ИТ-специалисты управляют кластерами и несколько отделов по работе с приложениями совместно используют кластеры. По этой причине многопользовательские кластеры стали одной из самых запрашиваемых возможностей в HDInsight.

Вместо создания собственной многопользовательской проверки подлинности и авторизации HDInsight полагается на самого популярного поставщика удостоверений — Active Directory (AD). Расширенные возможности групп безопасности в Active Directory можно использовать, чтобы управлять многопользовательской проверкой подлинности в HDInsight. Интегрировав HDInsight с Active Directory, пользователи могут использовать свои учетные данные Active Directory для обмена данными с кластерами. HDInsight сопоставляет пользователя Active Directory с локальным пользователем Hadoop. За счет этого все пользовательские службы, запущенные в HDInsight (Ambari, сервер Hive, Ranger, сервер Thrift Spark и т. д.), работают эффективнее.

## <a name="integrate-hdinsight-with-active-directory"></a>Интеграция HDInsight с Active Directory

В процессе интеграции HDInsight с Active Directory узлы кластера HDInsight присоединяются к домену Active Directory. HDInsight создает субъекты-службы для служб Hadoop, запущенных в кластере, и помещает их в определенное подразделение Active Directory. Кроме того, он создает в домене Active Directory обратные сопоставления DNS для IP-адресов узлов, присоединенных к домену.

Для достижения этой конфигурации доступно несколько вариантов архитектур. Вам необходимо решить, какая из них наиболее соответствует вашим потребностям.

**1. Интеграция HDInsight с Active Directory, выполняемой в Azure IaaS**

Это самый простой вариант архитектуры для интеграции HDInsight с Active Directory. В этом случае контроллер домена Active Directory запущен на одной (или нескольких) виртуальных машинах Azure. Обычно эти виртуальные машины находятся в виртуальной сети. Для кластера HDInsight необходимо настроить еще одну виртуальную сеть. Чтобы обеспечить взаимодействие между HDInsight и Active Directory, между этими виртуальными сетями потребуется настроить пиринговую связь, как описано в [этой статье](../virtual-network/virtual-networks-create-vnetpeering-arm-portal.md).

![Топология присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_1.png)

> [!NOTE]
> В этой архитектуре вы не можете использовать Azure Data Lake Store с кластером HDInsight.
 

Предварительные требования для Active Directory:

* Необходимо создать [подразделение](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), в котором будут размещены виртуальные машины кластера HDInsight и используемые в кластере субъекты-службы.
* Для взаимодействия с Active Directory необходимо настроить [протокол LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md). Сертификат, используемый для настройки LDAPS, должен быть реальным (а не самозаверяющим).
* В домене необходимо создать обратные зоны DNS для диапазона IP-адресов из подсети HDInsight (например, 10.2.0.0/24 на предыдущем рисунке).
* Потребуется учетная запись службы или учетная запись пользователя, используемые для создания кластера HDInsight. Эта учетная запись должна иметь следующие разрешения:

    - Разрешения на создание объектов субъектов-служб и объектов компьютеров в рамках организационного подразделения.
    - разрешения на создание правил прокси-сервера для обратных зон DNS;
    - разрешения на присоединение компьютеров к домену Active Directory.

**2. Интеграция HDInsight с облачной службой Azure AD**

Для облачной службы Azure Active Directory необходимо настроить контроллер домена. Это позволит интегрировать HDInsight с Azure Active Directory. Его можно настроить с помощью [доменных служб Azure Active Directory](../active-directory-domain-services/active-directory-ds-overview.md). Доменные службы Azure Active Directory создают в облаке компьютеры контроллера домена и предоставляют их IP-адреса. Чтобы обеспечить высокий уровень доступности, они создают два контроллера домена.

Сейчас доменные службы Azure Active Directory доступны только в классических виртуальных сетях. Доступ к ним можно получить только на портале Azure. Виртуальную сеть HDInsight можно создать на портале Azure, но между ней и классической виртуальной сетью потребуется настроить пиринговую связь.

> [!NOTE]
> Чтобы создать пиринг между классической виртуальной сетью и виртуальной сетью Azure Resource Manager, они должны находиться в том же регионе и относиться к одной подписке Azure.

![Топология присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

Предварительные требования для Active Directory:

* Необходимо создать [подразделение](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), в котором будут размещены виртуальные машины кластера HDInsight и используемые в кластере субъекты-службы. 
* При настройке AD DS следует настроить [протокол LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md). Сертификат, используемый для настройки LDAPS, должен быть реальным (а не самозаверяющим).
* В домене необходимо создать обратные зоны DNS для диапазона IP-адресов из подсети HDI (например, 10.2.0.0/24 на предыдущем рисунке). 
* Необходимо синхронизировать [хэши паролей](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) из Azure AD в AD DS.
* Потребуется учетная запись службы или учетная запись пользователя, используемые для создания кластера HDInsight. Эта учетная запись должна иметь следующие разрешения:

    - Разрешения на создание объектов субъектов-служб и объектов компьютеров в рамках организационного подразделения.
    - разрешения на создание правил прокси-сервера для обратных зон DNS;
    - разрешения на присоединение компьютеров к домену Active Directory.

**3. Интеграция HDInsight с локальной службой AD через VPN-подключение**

Эта архитектура очень близка к архитектуре № 1. Единственное различие заключается в том, что здесь используется локальная служба Active Directory, для доступа к которой из HDInsight используется [VPN-подключение из Azure к локальной сети](../expressroute/expressroute-introduction.md).

![Топология присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_3.png)

> [!NOTE]
> В этой архитектуре вы не можете использовать Azure Data Lake Store с кластером HDInsight.

Предварительные требования для Active Directory:

* Необходимо создать [подразделение](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), в котором будут размещены виртуальные машины кластера HDInsight и используемые в кластере субъекты-службы.
* Для взаимодействия с Active Directory необходимо настроить [протокол LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md). Сертификат, используемый для настройки LDAPS, должен быть реальным (а не самозаверяющим).
* В домене необходимо создать обратные зоны DNS для диапазона IP-адресов из подсети HDI (например, 10.2.0.0/24 на предыдущем рисунке).
* Потребуется учетная запись службы или учетная запись пользователя, используемые для создания кластера HDInsight. Эта учетная запись должна иметь следующие разрешения:

    - Разрешения на создание объектов субъектов-служб и объектов компьютеров в рамках организационного подразделения.
    - разрешения на создание правил прокси-сервера для обратных зон DNS;
    - разрешения на присоединение компьютеров к домену Active Directory.

**4. Интеграция HDInsight с локальной службой AD, синхронизированной с Azure AD**

Эта архитектура очень близка к архитектуре № 2. Единственное различие заключается в том, что локальная служба Active Directory синхронизирована с Azure Active Directory. Чтобы интегрировать HDInsight с Azure Active Directory, в облаке необходимо настроить контроллер домена. Его можно настроить с помощью [доменных служб Azure Active Directory](../active-directory-domain-services/active-directory-ds-overview.md). Доменные службы Active Directory создают в облаке компьютеры контроллера домена и предоставляют их IP-адреса. Чтобы обеспечить высокий уровень доступности, они создают два контроллера домена.

Сейчас доменные службы Azure Active Directory доступны только в классических виртуальных сетях. Доступ к ним можно получить только на портале Azure. Виртуальную сеть HDInsight можно создать на портале Azure, но между ней и классической виртуальной сетью потребуется настроить пиринговую связь.

> [!NOTE]
> Чтобы создать пиринг между классической виртуальной сетью и виртуальной сетью Azure Resource Manager, они должны находиться в том же регионе и относиться к одной подписке Azure.

![Топология присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

Предварительные требования для Active Directory:

* Необходимо создать [подразделение](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), в котором будут размещены виртуальные машины кластера HDInsight и используемые в кластере субъекты-службы. 
* При настройке AD DS следует настроить [протокол LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md). Сертификат, используемый для настройки LDAPS, должен быть реальным (а не самозаверяющим).
* В домене необходимо создать обратные зоны DNS для диапазона IP-адресов из подсети HDI (например, 10.2.0.0/24 на предыдущем рисунке). 
* Необходимо синхронизировать [хэши паролей](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) из Azure AD в AD DS.
* Потребуется учетная запись службы или учетная запись пользователя, используемые для создания кластера HDInsight. Эта учетная запись должна иметь следующие разрешения:

    - Разрешения на создание объектов субъектов-служб и объектов компьютеров в рамках организационного подразделения.
    - разрешения на создание правил прокси-сервера для обратных зон DNS;
    - разрешения на присоединение компьютеров к домену Active Directory.

**5. Интеграция HDInsight с Azure AD не по умолчанию (мы советуем использовать этот вариант только для тестирования и разработки)**

Эта архитектура очень близка к архитектуре № 2. В большинстве компаний административный доступ к Active Directory имеют только определенные сотрудники. Таким образом, при создании экспериментальной среды или присоединенного к домену кластера эффективнее будет просто создать Azure Active Directory в подписке, а не ждать, пока администратор настроит предварительные требования в Active Directory. Так как Azure AD создали вы, у вас есть все разрешения для настройки AD DS.

Доменные службы Active Directory создают в облаке компьютеры контроллера домена и предоставляют их IP-адреса. Чтобы обеспечить высокий уровень доступности, они создают два контроллера домена.

Сейчас AD DS доступны только в классических виртуальных сетях. Поэтому вам потребуется доступ к классическому порталу, где нужно создать классическую виртуальную сеть для настройки AD DS. Виртуальную сеть HDInsight можно создать на портале Azure, но между ней и классической виртуальной сетью потребуется настроить пиринговую связь.

> [!NOTE]
> Чтобы создать пиринг между классической виртуальной сетью и виртуальной сетью Azure Resource Manager, они должны находиться в том же регионе и относиться к одной подписке Azure.

![Топология присоединенного к домену кластера HDInsight](./media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

Предварительные требования для Active Directory:

* Необходимо создать [подразделение](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md), в котором будут размещены виртуальные машины кластера HDInsight и используемые в кластере субъекты-службы. 
* При настройке AD DS следует настроить [протокол LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md). Чтобы настроить этот протокол, можно создать [самозаверяющий сертификат](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md). Однако, чтобы использовать этот сертификат, необходимо запросить исключение на сайте <a href="mailto:hdipreview@microsoft.com">hdipreview@microsoft.com</a>.
* В домене необходимо создать обратные зоны DNS для диапазона IP-адресов из подсети HDI (например, 10.2.0.0/24 на предыдущем рисунке). 
* Необходимо синхронизировать [хэши паролей](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) из Azure AD в AD DS.
* Потребуется учетная запись службы или учетная запись пользователя, используемые для создания кластера HDInsight. Эта учетная запись должна иметь следующие разрешения:

    - Разрешения на создание объектов субъектов-служб и объектов компьютеров в рамках организационного подразделения.
    - разрешения на создание правил прокси-сервера для обратных зон DNS;
    - разрешения на присоединение компьютеров к домену Active Directory.

## <a name="next-steps"></a>Дальнейшие действия
* Сведения о настройке присоединенного к домену кластера HDInsight см. в [этой статье](hdinsight-domain-joined-configure.md).
* Сведения об управлении присоединенными к домену кластерами HDInsight см. в [этой статье](hdinsight-domain-joined-manage.md).
* Сведения о настройке политик Hive и выполнении запросов Hive для присоединенного к домену кластера HDInsight см. [здесь](hdinsight-domain-joined-run-hive.md).
* Сведения о выполнении запросов Hive с помощью SSH в присоединенных к домену кластерах HDInsight см. в статье [Использование SSH с Hadoop на основе Linux в HDInsight из Linux, Unix или OS X](hdinsight-hadoop-linux-use-ssh-unix.md).




<!--HONumber=Feb17_HO1-->


