<properties
   pageTitle="Использование ключей SSH с Hadoop в кластерах на платформе Linux из Windows | Microsoft Azure"
   description="Узнайте, как создавать и использовать ключи SSH для аутентификации в кластерах HDInsight на основе Linux. Подключайте кластеры с клиентов под управлением Windows с помощью клиента PuTTY SSH."
   services="hdinsight"
   documentationCenter=""
   authors="Blackmist"
   manager="jhubbard"
   editor="cgronlun"
	tags="azure-portal"/>

<tags
   ms.service="hdinsight"
   ms.devlang="na"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="big-data"
   ms.date="08/30/2016"
   ms.author="larryfr"/>

#Использование SSH с Hadoop на основе Linux в HDInsight из Windows

> [AZURE.SELECTOR]
- [Windows](hdinsight-hadoop-linux-use-ssh-windows.md)
- [Linux, Unix, OS X](hdinsight-hadoop-linux-use-ssh-unix.md)

[Secure Shell (SSH)](https://en.wikipedia.org/wiki/Secure_Shell) позволяет удаленно выполнять операции в кластерах HDInsight на основе Linux с помощью интерфейса командной строки. Этот документ содержит информацию о подключении к HDInsight из клиентов Windows с помощью клиента SSH PuTTY.

> [AZURE.NOTE] При описании действий в данной статье предполагается, что вы используете клиент Windows. Если вы используете клиент OS X, Linux или Unix, см. статью [Использование SSH с Hadoop под управлением Linux в HDInsight в Linux, Unix или OS X](hdinsight-hadoop-linux-use-ssh-unix.md).
>
> Если вы работаете на компьютере с Windows 10 и используете [Bash на Ubuntu в Windows](https://msdn.microsoft.com/commandline/wsl/about), следуйте инструкциям в статье [Использование SSH с Hadoop на основе Linux в HDInsight из Linux, Unix или OS X](hdinsight-hadoop-linux-use-ssh-unix.md).

##Предварительные требования

* **PuTTY** и **PuTTYGen** для клиентов Windows. Эти служебные программы доступны по адресу [http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).

* Современный веб-браузер, который поддерживает HTML5.

ИЛИ

* [Интерфейс командной строки Azure](../xplat-cli-install.md).

    [AZURE.INCLUDE [use-latest-version](../../includes/hdinsight-use-latest-cli.md)]

##Что такое SSH?

SSH — это служебная программа для входа в систему и удаленного выполнения команд на удаленном сервере. Используя HDInsight под управлением Linux, SSH устанавливает безопасное подключение к головному узлу кластера и предоставляет окно командной строки, используемое для ввода команд. Команды выполняются непосредственно на сервере.

###Имя пользователя SSH

Имя пользователя SSH — это имя, используемое для аутентификации в кластере HDInsight. При указании имени пользователя SSH во время создания кластера этот пользователь будет создан на всех узлах в кластере. После создания кластера это имя пользователя можно применять для подключения к головным узлам кластера HDInsight. Из головных узлов затем можно подключиться к отдельным рабочим узлам.

###Пароль SSH или открытый ключ

Пользователь SSH может применять для аутентификации пароль или открытый ключ. Пароль — это строка текста, введенная пользователем, а открытый ключ — это часть пары криптографических ключей, созданных для уникальной идентификации пользователя.

Ключ надежнее, чем пароль, однако для его создания требуются дополнительные действия, при этом необходимо хранить файлы ключа в безопасном месте. Если кто-либо получит доступ к файлам ключа, он получит доступ к вашей учетной записи. Если же вы потеряете файлы ключа, то не сможете войти в свою учетную запись.

Пара ключей состоит из открытого ключа (который отправляется на сервер HDInsight) и закрытого ключа (который хранится на клиентском компьютере). При подключении к серверу HDInsight с помощью SSH клиент SSH использует закрытый ключ, хранящийся на вашем компьютере, для аутентификации на сервере.

##Создание ключа SSH

Если вы планируете использовать ключи SSH на своем кластере, используйте следующую информацию. Если вы планируете использовать пароль, этот раздел можно пропустить.

1. Откройте PuTTYGen.

2. Для параметра **Тип формируемого ключа** выберите значение **RSA SSH-2**, а затем нажмите кнопку **Сформировать**.

	![интерфейс PuTTYGen](./media/hdinsight-hadoop-linux-use-ssh-windows/puttygen.png)

3. Перемещайте указатель мыши в области под индикатором выполнения, пока он не заполнится. Перемещение указателя мыши формирует случайные данные, которые используются для создания ключа.

	![перемещение мыши](./media/hdinsight-hadoop-linux-use-ssh-windows/movingmouse.png)

	После создания ключа отобразится открытый ключ.

4. Для большей безопасности можно ввести парольную фразу в поле **Парольная фраза ключа**, а затем ввести то же значение в поле **Подтверждение парольной фразы**.

	![парольная фраза](./media/hdinsight-hadoop-linux-use-ssh-windows/key.png)

	> [AZURE.NOTE] Мы настоятельно рекомендуем использовать безопасную парольную фразу для ключа. Однако если вы забудете парольную фразу, восстановить ее будет невозможно.

5. Щелкните **Сохранить закрытый ключ**, чтобы сохранить ключ в **PPK-файле**. Этот ключ будет использоваться для аутентификации в кластере HDInsight на платформе Linux.

	> [AZURE.NOTE] Этот ключ следует хранить в безопасном месте, так как он будет использоваться для доступа к кластеру HDInsight на платформе Linux.

6. Щелкните **Сохранить открытый ключ**, чтобы сохранить ключ в **TXT-файле**. Это позволяет повторно использовать открытый ключ в будущем при создании дополнительных кластеров HDInsight на платформе Linux.

	> [AZURE.NOTE] Открытый ключ также отображается в верхней части PuTTYGen. Щелкните это поле правой кнопкой мыши, скопируйте его значение и вставьте его в форму во время создания кластера на портале Azure.

##Создание кластера HDInsight на основе Linux

При создании кластера HDInsight на основе Linux необходимо предоставить открытый ключ, созданный ранее. В клиентах Windows кластер HDInsight под управлением Linux можно создать двумя способами:

* **Портал Azure** — для создания кластера используется веб-портал.

* **с помощью интерфейса командной строки Azure для Mac, Linux и Windows** — для создания кластера используются команды командной строки.

Для каждого из этих способов потребуется открытый ключ. Полную информацию о создании кластера HDInsight под управлением Linux см. в статье [Подготовка кластеров HDInsight под управлением Linux](hdinsight-hadoop-provision-linux-clusters.md).

###Портал Azure

При использовании [портала Azure][preview-portal] для создания кластера HDInsight под управлением Linux необходимо ввести значение в поле **Имя пользователя SSH**, а затем ввести значение параметра **ПАРОЛЬ** или параметра **ОТКРЫТЫЙ КЛЮЧ SSH**.

Если выбран параметр **ОТКРЫТЫЙ КЛЮЧ SSH**, можно вставить открытый ключ (отображающийся в поле __Открытый ключ для копирования в файл OpenSSH authorized\_keys__) в поле __Открытый ключ SSH__ или щелкнуть __Выберите файл__, чтобы просмотреть и выбрать файл, содержащий открытый ключ.

![Изображение формы запроса на открытый ключ](./media/hdinsight-hadoop-linux-use-ssh-windows/ssh-key.png)

Создает имя входа для указанного пользователя и позволяет выполнять аутентификацию с помощью пароля или ключа SSH.

###Интерфейс командной строки Azure для Mac, Linux и Windows

Вы можете использовать [интерфейс командной строки Azure для Mac, Linux и Windows](../xplat-cli-install.md) для создания нового кластера с помощью команды `azure hdinsight cluster create`.

Дополнительную информацию об использовании этой команды см. в статье [Подготовка кластеров Hadoop под управлением Linux в HDInsight с помощью настраиваемых параметров](hdinsight-hadoop-provision-linux-clusters.md).

##Подключение к кластеру HDInsight на основе Linux

1. Откройте PuTTY.

	![интерфейс PuTTY](./media/hdinsight-hadoop-linux-use-ssh-windows/putty.png)

2. Если вы указали ключ SSH при создании учетной записи пользователя, необходимо выполнить следующий шаг, чтобы выбрать закрытый ключ, который будет использоваться при аутентификации в кластере.

	В разделе **Категория** последовательно разверните **Подключение**, **SSH** и выберите **Аутентификация**. Наконец, нажмите кнопку **Обзор** и выберите PPK-файл, содержащий закрытый ключ.

	![интерфейс PuTTY, выбор закрытого ключа](./media/hdinsight-hadoop-linux-use-ssh-windows/puttykey.png)

3. В поле **Категория** выберите **Сеанс**. На экране **Основные параметры вашего сеанса PuTTY** в поле **Имя узла (или IP-адрес)** введите адрес SSH своего сервера HDInsight. К кластеру можно подключиться с помощью двух адресов SSH.

    * __Адрес головного узла__. Чтобы подключиться к головному узлу кластера, укажите имя кластера с суффиксом **-ssh.azurehdinsight.net**. Например, **mycluster-ssh.azurehdinsight.net**.
    
    * __Адрес граничного узла__. Если вы подключаетесь к серверу R в кластере HDInsight, вы можете подключиться к граничному узлу сервера R с помощью адреса __RServer.CLUSTERNAME.ssh.azurehdinsight.net__, где CLUSTERNAME — имя кластера. Например, __RServer.mycluster.ssh.azurehdinsight.net__.

	![интерфейс PuTTY с введенным адресом SSH](./media/hdinsight-hadoop-linux-use-ssh-windows/puttyaddress.png)

4. Чтобы сохранить данные о подключении для использования в будущем, в разделе **Сохраненные сеансы** введите имя для этого подключения и нажмите кнопку **Сохранить**. Соединение будет добавлено в список сохраненных сеансов.

5. Щелкните **Открыть** для подключения к кластеру.

	> [AZURE.NOTE] При первом подключении к кластеру, вы получите оповещение системы безопасности. Это нормально. Для продолжения выберите **Да**, чтобы кэшировать ключ RSA2 сервера.

6. При появлении запроса введите имя пользователя, которое было введено при создании кластера. Если для пользователя использовался пароль, отобразится также запрос на ввода пароля.

> [AZURE.NOTE] В шагах выше предполагается, что используется порт 22, который подключается к головному узлу 0 в кластере HDInsight. При использовании порта 23 выполняется подключение к головному узлу 1. Дополнительные сведения о головных узлах см. в статье [Доступность и надежность кластеров Hadoop в HDInsight](hdinsight-high-availability-linux.md).

###Подключение к рабочим узлам

К рабочим узлам нельзя получить прямой доступ за пределами центра обработки данных Azure, но к ним можно получить доступ с головного узла кластера через SSH.

Если вы указали ключ SSH при создании учетной записи пользователя, необходимо выполнить следующие шаги, чтобы использовать закрытый ключ при аутентификации в кластере для подключения к рабочим узлам.

1. Установите Pageant, скачав соответствующий файл со страницы [http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html). Эта служебная программа используется для кэширования ключей SSH для PuTTY.

2. Запустите агент Pageant. Он будет свернут в значок в области состояния. Щелкните его правой кнопкой мыши и выберите **Добавить ключ**.

    ![добавление ключа](./media/hdinsight-hadoop-linux-use-ssh-windows/addkey.png)

3. При появлении диалогового окна обзора выберите PPK-файл, который содержит ключ, и щелкните **Открыть**. Таким образом ключ будет добавлен в Pageant, который предоставит его PuTTY при подключении к кластеру.

    > [AZURE.IMPORTANT] Если ключ SSH используется для защиты вашей учетной записи, прежде чем можно будет подключиться к рабочим узлам, потребуется выполнить предыдущие шаги.

4. Откройте PuTTY.

5. При использовании ключа SSH для аутентификации в разделе **Категории** последовательно разверните **Подключение** и **SSH** и выберите **Аутентификация**.

    В разделе **Параметры аутентификации** установите флажок **Разрешить пересылку агента**. Это позволяет PuTTY автоматически пройти аутентификацию с использованием сертификата с помощью подключения к головному узлу кластера при подключении к рабочим узлам.

    ![разрешить перенаправление агента](./media/hdinsight-hadoop-linux-use-ssh-windows/allowforwarding.png)

6. Подключитесь к кластеру, как описано выше. При использовании ключа SSH для аутентификации кластера вам не требуется выбирать ключ, так как для этого будет использоваться ключ SSH, добавленный в Pageant.

7. После подключения выполните следующие действия, чтобы получить список узлов в кластере. Замените *ADMINPASSWORD* паролем учетной записи администратора кластера. Замените *CLUSTERNAME* именем кластера.

        curl --user admin:ADMINPASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/hosts

    В результате будет возвращена информация в формате JSON для узлов кластера, включая `host_name`, в котором содержится полное доменное имя (FQDN) каждого узла. Ниже приведен пример записи `host_name`, возвращенной командой **curl**:

        "host_name" : "workernode0.workernode-0-e2f35e63355b4f15a31c460b6d4e1230.j1.internal.cloudapp.net"

8. После создания списка необходимых для подключения рабочих узлов используйте следующую команду сеанса PuTTY для подключения к рабочему узлу:

        ssh USERNAME@FQDN

    Замените *USERNAME* своим именем пользователя SSH, а *FQDN* — полным доменным именем рабочего узла. Например, `workernode0.workernode-0-e2f35e63355b4f15a31c460b6d4e1230.j1.internal.cloudapp.net`.

    > [AZURE.NOTE] При использовании пароля для аутентификации сеанса SSH появится запрос на повторный ввод пароля. При использовании ключа SSH подключение завершается без запросов.

9. После установления сеанса PuTTY строка `username@hn0-clustername` изменится на `username@wn0-clustername`, чтобы указать, что вы подключены к рабочему узлу. Все команды на этом этапе выполняются на рабочем узле.

10. После выполнения всех действий на рабочем узле закройте сеанс рабочего узла с помощью команды `exit`. Таким образом вы вернетесь к запросу `username@hn0-clustername`.

##Добавление дополнительных учетных записей

Если требуется добавить дополнительные учетные записи в кластер, сделайте следующее:

1. Создайте новый открытый ключ и закрытый ключ для новой учетной записи пользователя, как было описано ранее.

2. Из сеанса SSH добавьте в кластер нового пользователя с помощью следующей команды:

		sudo adduser --disabled-password <username>

	Она создаст новую учетную запись пользователя, но отключит проверку пароля.

3. Создайте каталог и файлы для хранения ключа, используя следующие команды:

        sudo mkdir -p /home/<username>/.ssh
        sudo touch /home/<username>/.ssh/authorized_keys
        sudo nano /home/<username>/.ssh/authorized_keys

4. Когда откроется редактор nano, скопируйте и вставьте в него содержимое открытого ключа для новой учетной записи пользователя. Наконец, нажмите клавиши **Ctrl-X**, чтобы сохранить файл и закрыть редактор.

	![изображение редактора Nano с примером ключа](./media/hdinsight-hadoop-linux-use-ssh-windows/nano.png)

5. Используйте следующую команду, чтобы изменить владельца папки в формате SSH и ее содержимого на новую учетную запись пользователя:

		sudo chown -hR <username>:<username> /home/<username>/.ssh

6. Теперь можно будет проходить аутентификацию на сервере с новой учетной записью пользователя и закрытым ключом.

##<a id="tunnel"></a>Туннелирование SSH

Протокол SSH может использоваться для туннелирования локальных запросов, например веб-запросов, к кластеру HDInsight. Запрос будет затем перенаправлен к запрошенному ресурсу, как если бы исходил от головного узла кластера HDInsight.

> [AZURE.IMPORTANT] Туннель SSH обязателен для доступа к веб-интерфейсу некоторых служб Hadoop. Например, доступ к пользовательскому интерфейсу журнала заданий или диспетчера ресурсов можно получить только с помощью туннеля SSH.

Дополнительные сведения о создании и использовании туннеля SSH см. в статье [Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, ResourceManager, JobHistory, NameNode, Oozie и другим веб-интерфейсам](hdinsight-linux-ambari-ssh-tunnel.md).

##Дальнейшие действия

Теперь, когда вы знаете, как пройти аутентификацию с помощью ключа SSH, узнайте, как использовать MapReduce с Hadoop в HDInsight.

* [Использование Hive с HDInsight](hdinsight-use-hive.md)

* [Использование Pig с HDInsight](hdinsight-use-pig.md)

* [Использование заданий MapReduce с HDInsight](hdinsight-use-mapreduce.md)

[preview-portal]: https://portal.azure.com/

<!---HONumber=AcomDC_0914_2016-->