<properties
	pageTitle="Доступность кластеров Hadoop в HDInsight | Microsoft Azure"
	description="Использование дополнительного головного узла позволяет повысить надежность и доступность кластеров HDInsight под управлением Linux."
	services="hdinsight"
	editor="cgronlun"
	manager="paulettm"
	authors="Blackmist"
	documentationCenter=""
	tags="azure-portal"/>

<tags
	ms.service="hdinsight"
	ms.workload="big-data"
	ms.tgt_pltfrm="na"
	ms.devlang="multiple"
	ms.topic="article"
	ms.date="09/02/2015"
	ms.author="larryfr"/>

#Доступность и надежность кластеров Hadoop в HDInsight

Второй головной узел используется кластерами Hadoop под управлением Linux, развернутыми с помощью Azure HDInsight. Это повышает доступность и надежность служб и заданий Hadoop, выполняемых в Azure.

> [AZURE.NOTE]Действия, описанные в этом документе, относятся только к кластерам HDInsight под управлением Linux. Если вы используете кластер под управлением Windows, см. статью [Доступность и надежность кластеров Hadoop под управлением Windows в HDInsight](hdinsight-high-availability.md).

##Общие сведения о головных узлах

В некоторых реализациях Hadoop есть только один головной узел, на котором размещены службы и компоненты, управляющие сбоями узлов данных (рабочих узлов) без перебоев в работе. Однако любые отключения основных служб, работающих на головном узле, приводят к прекращению работы кластера.

В кластерах HDInsight предусмотрен дополнительный головной узел, на котором основные службы и компоненты могут продолжать работу в случае сбоя основного.

> [AZURE.IMPORTANT]Оба головных узла активны и работают в кластере одновременно. Некоторые службы, например HDFS или YARN, в отдельно взятый момент времени активны только на одном головном узле (а на другом находятся в «режиме ожидания»). Другие службы, например HiveServer2 или Hive MetaStore, активны одновременно на обоих головных узлах.

Узлы [ZooKeeper](http://zookeeper.apache.org/) (ZK) используются для выбора лидера основных служб на головных узлах, а также для уведомления служб, узлов данных (рабочих узлов) и шлюзов о том, на каком головном узле активна основная служба.

## Доступ к головным узлам

В целом наличие нескольких головных узлов не влияет на доступ к кластеру через общедоступные шлюзы (веб-интерфейсы Ambari и интерфейсы REST API). Запрос перенаправляется на активный головной узел и обслуживается соответствующим образом.

При доступе к кластеру с помощью SSH подключение через порт 22 (используемый по умолчанию для SSH) будет направлено на headnode0, а подключение через порт 23 — на headnode1.

### Внутренние полные доменные имена (FQDN)

Узлы в кластере HDInsight имеют внутренний IP-адрес и полное доменное имя, доступ к которым возможен только из кластера (например, в ходе сеанса SSH на головном узле или посредством задания, выполняемого в кластере). При доступе к службам в кластере с помощью внутреннего FQDN или IP-адреса следует использовать Ambari для проверки IP-адреса или FQDN, которые будут использоваться для доступа к службе.

Например, служба Oozie может выполняться только на одном головном узле, и при использовании команды `oozie` в сеансе SSH требуется URL-адрес службы. Его можно получить из Ambari с помощью следующей команды:

	curl -u admin:PASSWORD "https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/configurations?type=oozie-site&tag=TOPOLOGY_RESOLVED" | grep oozie.base.url

Будет возвращено примерно следующее значение, содержащее внутренний URL-адрес для использования с командой `oozie`:

	"oozie.base.url": "http://headnode0.CLUSTERNAME-ssh.d9.internal.cloudapp.net:11000/oozie"

## Проверка состояния службы

Состояние служб, работающих на головном узле, можно проверить с помощью веб-интерфейса Ambari или Ambari REST API.

###Ambari REST API

Чтобы проверить состояние службы с помощью интерфейса Ambari REST API, можно воспользоваться следующей командой:

	curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICENAME?fields=ServiceInfo/state

* Замените **PASSWORD** паролем учетной записи пользователя (администратора) HTTP.

* Замените **CLUSTERNAME** именем кластера.

* Замените **SERVICENAME** именем службы, состояние которой нужно проверить.

Например, чтобы проверить состояние службы **HDFS** в кластере с именем **mycluster** и паролем **password**, нужно применить следующую команду:

	curl -u admin:password https://mycluster.azurehdinsight.net/api/v1/clusters/mycluster/services/HDFS?fields=ServiceInfo/state

Ответ будет выглядеть примерно так:

	{
	  "href" : "http://headnode0.mycluster-ssh.j7.internal.cloudapp.net:8080/api/v1/clusters/mycluster/services/HDFS?fields=ServiceInfo/state",
	  "ServiceInfo" : {
	    "cluster_name" : "mycluster",
	    "service_name" : "HDFS",
	    "state" : "STARTED"
	  }
	}

URL-адрес указывает, что служба в настоящий момент работает на узле **headnode0**.

Состояние указывает, что служба в настоящий момент запущена (**STARTED**).

Если вам неизвестно, какие службы установлены в кластере, их список можно получить с помощью следующей команды:

	curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services

####Компоненты служб

Иногда службы содержат компоненты, состояние которых может потребоваться проверить по отдельности. Например, служба HDFS содержит компонент NameNode. Чтобы просмотреть сведения о компоненте, используйте следующую команду:

	curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICE/components/component

Если вам неизвестно, какие компоненты содержатся в службе, можно получить их список с помощью следующей команды:

	curl -u admin:PASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/clusters/CLUSTERNAME/services/SERVICE/components/component

###Веб-интерфейс Ambari

Веб-интерфейс Ambari можно просмотреть по адресу https://CLUSTERNAME.azurehdinsight.net. Замените **CLUSTERNAME** именем кластера. При появлении запроса введите учетные данные пользователя HTTP для кластера. По умолчанию используются имя пользователя HTTP **admin** и пароль, который вы ввели при создании кластера.

После входа на страницу Ambari слева вы увидите список установленных служб.

![Установленные службы](./media/hdinsight-high-availability-linux/services.png)

Существует ряд значков, которые могут отображаться рядом со службой и указывать ее состояние. Все оповещения, связанные с той или иной службой, можно просмотреть, щелкнув ссылку **Оповещения** в верхней части страницы. Чтобы просмотреть дополнительные сведения о службе, выберите ее.

На странице службы содержатся сведения о состоянии и конфигурации каждой службы, но не указывается, на каком головном узле она работает. Чтобы просмотреть эти сведения, щелкните ссылку **Узлы** в верхней части страницы. Отобразятся узлы кластера, включая головные.

![список узлов](./media/hdinsight-high-availability-linux/hosts.png)

Если выбрать ссылку на один из головных узлов, отобразятся службы и компоненты, работающие на этом узле.

![Состояние компонента](./media/hdinsight-high-availability-linux/nodeservices.png)

## Как обращаться к файлам журнала на вторичном головном узле

###SSH

Если подключение к головному узлу установлено через SSH, файлы журнала можно найти в папке **/var/log**. Например, в папке **/var/log/hadoop-yarn/yarn** содержатся журналы для YARN.

Каждый головной узел может иметь уникальные записи журнала, поэтому следует проверить журналы на обоих узлах.

###Ambari

> [AZURE.NOTE]Для доступа к файлам журнала через Ambari требуется туннель SSH, так как веб-сайты отдельных служб не отображаются для всех пользователей в Интернете. Сведения об использовании туннеля SSH можно найти в разделе [Использование туннелирования SSH для доступа к веб-интерфейсу Ambari, ResourceManager, JobHistory, NameNode, Oozie и другим веб-интерфейсам](hdinsight-linux-ambari-ssh-tunnel.md).

В веб-интерфейсе Ambari выберите службу, для которой нужно просмотреть журналы (например, YARN), а затем щелкните **Быстрые ссылки**, чтобы выбрать головной узел, журналы которого следует просмотреть.

![Использование быстрых ссылок для просмотра журналов](./media/hdinsight-high-availability-linux/viewlogs.png)

## Как настроить размер головного узла ##

Размер головного узла можно выбрать только во время создания кластера. По умолчанию для головных узлов используется размер **A3**, который предусматривает 4 ядра, 7 ГБ памяти и 285 ГБ локального хранилища. Список различных размеров виртуальных машин, доступных для HDInsight, включая количество ядер, объем памяти и локального хранилища для каждого из них, можно найти на [странице цен на HDInsight](http://azure.microsoft.com/pricing/details/hdinsight/).

При создании нового кластера можно указать размер узлов. Ниже содержатся сведения о том, как указать размер с помощью [портала предварительной версии Azure][preview-portal], [Azure PowerShell][azure-powershell] и [Azure CLI][azure-cli].

* **Портал предварительной версии Azure**. При создании нового кластера можно задать размер (ценовую категорию) как для головных, так и для рабочих узлов (узлов данных) кластера:

	![Изображение мастера создания кластера с выбором размера узла](./media/hdinsight-high-availability-linux/headnodesize.png)

* **Azure CLI**. При использовании команды `azure hdinsight cluster create` можно задать размер головного узла с помощью параметра `--headNodeSize`.

* **Azure PowerShell**. При использовании командлета `New-AzureHDInsightCluster` можно задать размер головного узла с помощью параметра `-HeadNodeVMSize`.

##Дальнейшие действия

В этом документе вы узнали, как Azure HDInsight обеспечивает высокую доступность для Hadoop. Чтобы получить дополнительные сведения, см. следующие ресурсы:

- [Справочник по REST Ambari](https://github.com/apache/ambari/blob/trunk/ambari-server/docs/api/v1/index.md)

- [Установка и настройка CLI Azure](../xplat-cli-install.md)

- [Установка и настройка Azure PowerShell](../powershell-install-configure.md)

- [Управление кластерами HDInsight с помощью Ambari](hdinsight-hadoop-manage-ambari.md)

- [«Подготовка кластеров HDInsight на основе Linux»](hdinsight-hadoop-provision-linux-clusters.md)

[preview-portal]: https://portal.azure.com/
[azure-powershell]: ../powershell-install-configure.md
[azure-cli]: ../xplat-cli-install.md

<!---HONumber=Oct15_HO1-->