<properties
   	pageTitle="Создание кластеров Hadoop, HBase, Storm или Spark на платформе Linux в HDInsight | Microsoft Azure"
   	description="Узнайте, как создавать кластеры Hadoop, HBase, Storm или Spark на базе Linux для HDInsight с помощью браузера, Azure CLI, Azure PowerShell, REST или пакета SDK."
   	services="hdinsight"
   	documentationCenter=""
   	authors="nitinme"
   	manager="paulettm"
   	editor="cgronlun"
	tags="azure-portal"/>

<tags
   	ms.service="hdinsight"
   	ms.devlang="na"
   	ms.topic="article"
   	ms.tgt_pltfrm="na"
   	ms.workload="big-data"
   	ms.date="12/08/2015"
   	ms.author="nitinme"/>


#Создание кластеров Hadoop под управлением Linux в HDInsight

[AZURE.INCLUDE [selector](../../includes/hdinsight-create-linux-cluster-selector.md)]

Из этого документа вы узнаете о различных способах создания кластера HDInsight под управлением Linux в Azure, а также о дополнительных настройках, которые можно применять к кластеру. В HDInsight решения Apache Hadoop, Apache Storm и Apache HBase предоставляются как службы на облачной платформе Azure.

> [AZURE.NOTE]Этот документ содержит инструкции для различных способов создания кластера. Информацию для быстрого создания кластера см. в статье [Приступая к работе с Azure HDInsight на платформе Linux](../hdinsight-hadoop-linux-get-started.md).

## Что такое кластер HDInsight?

Кластер Hadoop включает несколько виртуальных машин (узлов), которые используются для распределенной обработки задач в кластере. Azure абстрагирует сведения об установке и конфигурации отдельных узлов, поэтому вам нужно указать только общие сведения о настройке.

###Типы кластеров

Существует несколько типов кластеров HDInsight.

| Тип кластера | Назначение |
| ------------ | ----------------------------- |
| Hadoop | Запросы и анализ (пакетные задания) |
| HBase | Хранилище данных NoSQL |
| Storm | Обработка событий в режиме реального времени |
| Spark (Предварительная версия) | Обработка в памяти, интерактивные запросы, обработка потоков микро-пакетов |

Во время настройки вам нужно выбрать один из этих типов кластера. С помощью [действий сценария](#scriptaction) к этим базовым типам вы можете добавить другие технологии, например Hue или R.

Для каждого типа кластера используется своя терминология (узлы кластера называются по-разному). Кроме того, типы отличаются количеством узлов и стандартными размерами виртуальных машин.

> [AZURE.IMPORTANT]Если вы планируете использовать более 32 рабочих узлов (при создании кластера или в ходе масштабирования после создания кластера), для головного узла потребуется минимум 8-ядерный процессор и 14 ГБ ОЗУ.

![Узлы кластера HDInsight Hadoop](./media/hdinsight-provision-clusters/HDInsight.Hadoop.roles.png)

Кластеры Hadoop для HDInsight содержат узлы двух типов:

- головной узел (два узла);
- узел данных (по крайней мере один узел).

![Узлы кластера HDInsight HBase](./media/hdinsight-provision-clusters/HDInsight.HBase.roles.png)

Кластеры HBase для HDInsight состоят из узлов трех типов: головные серверы (два узла), региональные серверы (не менее одного узла), главные узлы и узлы Zookeeper (три узла).

![Узлы кластера HDInsight Storm](./media/hdinsight-provision-clusters/HDInsight.Storm.roles.png)

Кластеры Storm для HDInsight включают узлы трех типов: узлы Nimbus (два узла), серверы-контроллеры (не менее одного узла) и узлы Zookeeper (три узла).


![Узлы кластера HDInsight Spark](./media/hdinsight-provision-clusters/HDInsight.Spark.roles.png)

Кластеры Spark для HDInsight состоят из узлов трех типов: головной узел (два узла), рабочий узел (не менее одного узла) и узлы Zookeeper (три узла; предоставляются бесплатно, если для виртуальных машины Zookeeper выбран размер уровня A1).

###Служба хранилища Azure для HDInsight

С каждым типом кластера также связана одна или несколько учетных записей хранения Azure. HDInsight использует BLOB-объекты Azure из этих учетных записей как хранилища данных кластера. Хранение данных отдельно от кластера позволяет удалять кластеры, если они не используются, не затрагивая при этом данные. Затем, если вам нужно дополнительно проанализировать данные, ту же учетную запись можно использовать в новом кластере. Дополнительную информацию см. в статье [Использование хранилища больших двоичных объектов Azure с HDInsight](../hdinsight-use-blob-storage.md).

## <a id="configuration"></a>Базовые параметры конфигурации

В следующих разделах описаны параметры, которые необходимо настроить при создании кластера HDInsight.

###Имя кластера

Имя кластера — это уникальный идентификатор кластера, который используется в доменном имени для доступа к кластеру через Интернет. Например, кластер с именем _mycluster_ будет доступен в Интернете по адресу _mycluster_.azurehdinsight.net.

Имя кластера должно соответствовать таким требованиям:

- длина имени должна быть в пределах от 3 до 63 символов;
- имя должно содержать только буквы, цифры и дефисы.

###Тип кластера

Тип кластера позволяет выбрать специальную конфигурацию кластера. Для кластера HDInsight под управлением Linux доступны такие типы:

| Тип кластера | Назначение |
| ------------ | ----------------------------- |
| Hadoop | Запросы и анализ (пакетные задания) |
| HBase | Хранилище данных NoSQL |
| Storm | Обработка событий в режиме реального времени |
| Spark (Предварительная версия) | Обработка в памяти, интерактивные запросы, обработка потоков микро-пакетов |

С помощью [действий сценария](#scriptaction) к этим базовым типам вы можете добавить другие технологии, например Hue или R.

###Операционная система кластера

Кластер HDInsight можно подготовить на одной из двух операционных систем.

- **HDInsight на базе Windows (Windows Server 2012 R2 Datacenter)** — выберите этот вариант, если вам требуется интеграция со службами и технологиями Windows, которые будут работать в кластере с Hadoop, или если вы переносите существующее решение Hadoop под управлением Windows.

- **HDInsight на базе Linux (Ubuntu 12.04 LTS для Linux)** — выберите этот вариант, если: 1) вы знакомы с Linux или Unix; 2) вы переносите существующее решение Hadoop под управлением Linux; 3) вам требуется быстрая интеграция с компонентами экосистемы Hadoop, созданными для Linux. Дополнительную информацию см. в разделе [Приступая к работе с Hadoop в Linux на платформе HDInsight](hdinsight-hadoop-linux-get-started.md).

> [AZURE.NOTE]В этом документе предполагается, что вы используете кластер HDInsight под управлением Linux. Сведения о кластерах под управлением Windows см. в статье [Подготовка кластеров Hadoop в HDInsight](hdinsight-provision-clusters.md).

###Имя подписки

Если у вас есть несколько подписок Azure, этот параметр позволяет выбрать ту, которая будет использоваться при создании кластера HDInsight.

###Группа ресурсов

Обычно приложения состоят из множества компонентов, например веб-приложения, базы данных, сервера базы данных, хранилища и служб сторонних поставщиков. Диспетчер ресурсов Azure (ARM) позволяет работать с ресурсами в приложении в виде группы, которая называется группой ресурсов Azure. Вы можете развертывать, обновлять, отслеживать или удалять все ресурсы для приложения в рамках одной скоординированной операции. Для развертывания вы используете шаблон, который можно использовать для разных сред, в том числе для тестовой, промежуточной и рабочей. Вы можете уточнить счета для своей организации, просмотрев сведенные затраты для всей группы. Дополнительные сведения см. в статье [Общие сведения о диспетчере ресурсов Azure](resource-group-overview.md).

###Учетные данные

В кластерах HDInsight используются два типа проверки подлинности.

* __Администратор__ или пользователь __HTTPs__ — учетная запись администратора кластера используется преимущественно для доступа к веб-службам или службам REST, которые предоставляет кластер. Ее нельзя использовать непосредственно для входа в кластер.

* __Имя пользователя SSH__ — учетная запись пользователя SSH используется для удаленного доступа к кластеру с помощью клиента [Secure Shell](https://en.wikipedia.org/wiki/Secure_Shell). Этот тип проверки подлинности наиболее часто используется для удаленного доступа к головным узлам кластера с использованием командной строки.

Учетная запись администратора защищена паролем, и все интернет-подключения к кластеру с использованием учетной записи администратора должны выполняться через безопасное подключение HTTPS.

Пользователь SSH может проходить проверку подлинности с помощью пароля или сертификата. Проверка подлинности с помощью сертификата — наиболее безопасный вариант, но для него требуется создание и обслуживание пары открытого и закрытого сертификатов.

Дополнительные сведения об использовании протокола SSH с кластером HDInsight, включая сведения о способах создания и использования ключей SSH, см. в таких статьях:

* [Использование SSH с Hadoop на основе Linux в HDInsight из Linux, Unix или OS X](hdinsight-hadoop-linux-use-ssh-unix.md)
* [Использование SSH с Hadoop на основе Linux в HDInsight из Windows](hdinsight-hadoop-linux-use-ssh-windows.md)

###Источник данных

В качестве базового хранилища кластера HDInsight используется хранилище BLOB-объектов Azure. На внутреннем уровне Hadoop и другое программное обеспечение в кластере считает это хранилище системой, совместимой с распределенной файловой системой Hadoop (HDFS).

При создании нового кластера вам необходимо создать новую учетную запись хранения Azure или использовать существующую.

> [AZURE.IMPORTANT]Географическое расположение, выбранное для учетной записи хранения, определяет расположение кластера HDInsight: стандартная учетная запись хранения и кластер должны быть в одном центре обработки данных.
>
> Просмотреть поддерживаемые регионы можно в раскрывающемся списке **Регион** на странице [Цены на HDInsight](https://go.microsoft.com/fwLink/?LinkID=282635&clcid=0x409).

####Контейнер хранилища по умолчанию

HDInsight также создаст в учетной записи хранения _контейнер хранилища по умолчанию_. Для кластера HDInsight этот контейнер будет хранилищем по умолчанию.

Имя контейнера по умолчанию совпадает с именем кластера. Дополнительные сведения об использовании хранилища BLOB-объектов Azure с кластером HDInsight см. в [этой статье](hdinsight-hadoop-use-blob-storage.md).

>[AZURE.WARNING]Не используйте один контейнер для нескольких кластеров. Это не поддерживается.

###Размер узла

Вы можете выбрать размер вычислительных ресурсов, которые будет использовать кластер. Например, если вы знаете, что будете выполнять операции, требующие большого объема памяти, вам, возможно, следует выбрать вычислительный ресурс с большим объемом памяти.

Кластеры разных типов отличаются типами, количеством и размерами узлов. Например, кластер Hadoop имеет два _головных узла_ и четыре _узла данных_ (по умолчанию), а кластер Storm — два _узла Nimbus_, три _узла Zookeeper_ и четыре _узла супервизора_ (по умолчанию).

> [AZURE.IMPORTANT]Если вы планируете использовать более 32 рабочих узлов (при создании кластера или в ходе масштабирования после создания кластера), для головного узла потребуется минимум 8-ядерный процессор и 14 ГБ ОЗУ.

При настройке кластера на портале предварительной версии Azure размер узла выбирается в колонке __Ценовая категория для узлов__. Здесь также отображаются цены на узлы разных размеров.

> [AZURE.IMPORTANT]Начисление оплаты начинается после создания кластера и прекращается только после его удаления. Дополнительные сведения о ценах см. в статье [Цены на HDInsight](https://azure.microsoft.com/pricing/details/hdinsight/).

##<a id="optionalconfiguration"></a>Дополнительная настройка

В следующих разделах описаны дополнительные параметры, а также ситуации, в которых может потребоваться настройка этих параметров.

### Версия HDInsight

Этот параметр используется для определения версии HDInsight, которая используется для кластера. Дополнительные сведения см. в разделе [Версии HDInsight и компоненты Hadoop](https://go.microsoft.com/fwLink/?LinkID=320896&clcid=0x409)

### Использование виртуальных сетей Azure

[Виртуальная сеть Azure](http://azure.microsoft.com/documentation/services/virtual-network/) позволяет создать безопасную стабильную сеть, в которой будут находиться все ресурсы, связанные с вашим решением. Виртуальная сеть позволит вам:

* Соединить облачные ресурсы с частной сетью (только для облачных решений).

	![Диаграмма конфигурации только для облачных решений](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-vnet-cloud-only.png)

* Соединить ваши облачные ресурсы с сетью локального центра обработки данных (типа "сеть-сеть" или "точка-сеть") при помощи виртуальной частной сети (VPN).

    | Конфигурации «сеть — сеть» | Конфигурации «точка — сеть» |
    | -------------------------- | --------------------------- |
    | Конфигурация «сеть — сеть» позволяет подключить несколько ресурсов центра обработки данных к виртуальной сети Azure с использованием аппаратного обеспечения VPN или службы маршрутизации и удаленного доступа.<br />![Диаграмма конфигурации соединения "сервер-сервер"](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-vnet-site-to-site.png) | Конфигурация «точка — сеть» позволяет подключить конкретный ресурс к виртуальной сети Azure с использованием программного обеспечения VPN.<br />![Диаграмма конфигурации соединения "клиент-сервер"](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-vnet-point-to-site.png) |

Для получения более подробной информации о характеристиках, преимуществах и возможностях виртуальной сети Azure см. раздел [Обзор характеристик виртуальной сети Azure](http://msdn.microsoft.com/library/azure/jj156007.aspx).

> [AZURE.NOTE]Виртуальную сеть Azure необходимо создать до создания кластера. Дополнительную информацию см. в статье [Создание виртуальной сети](virtual-networks-create-vnet.md).
>
> Azure HDInsight поддерживает только географически привязанные виртуальные сети и на данный момент не поддерживает совместные групповые виртуальные сети. Чтобы проверить, является ли существующая виртуальная сеть Azure географически привязанной, используйте командлет Azure PowerShell Get-AzureVNetConfig. Если у вашей виртуальной сети нет географической привязки, вы можете:
>
> - Экспортировать конфигурацию существующей виртуальной сети, а затем создать новую виртуальную сеть. У всех новых виртуальных сетей по умолчанию есть географическая привязка.
> - Выполнить миграцию в географически привязанную виртуальную сеть. Дополнительные сведения см. в статье [Перенос существующих служб на региональный уровень](http://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/).
>
> Настоятельно рекомендуется назначать одну подсеть для одного кластера.
>
> На данный момент (25 августа 2015 г.) в виртуальной сети Azure можно создать только один кластер под управлением Linux.
>
> Вам не удастся использовать виртуальную сеть Azure v1 (классическую) с HDInsight под управлением Linux. Необходимо использовать виртуальную сеть v2 (диспетчер ресурсов Azure), чтобы ее можно было выбрать при создании кластера HDInsight на портале предварительной версии Azure или использовать при создании кластера в Azure CLI или Azure PowerShell.
>
> Если у вас есть ресурсы в сети v1, которым нужно предоставить непосредственный доступ к HDInsight через виртуальную сеть, ознакомьтесь со статьей [Подключение классических виртуальных сетей к новым виртуальным сетям](../virtual-network/virtual-networks-arm-asm-s2s.md), в которой описано подключение виртуальной сети v1 к виртуальной сети v2. После установления подключения можно создать кластер HDInsight в виртуальной сети v2.

### Хранилище мета-данных

Метахранилище содержит метаданные Hive и Oozie, в частности сведения о таблицах, секциях, схемах и столбцах. Использование метахранилища помогает сохранить метаданные Hive и Oozie, чтобы не создавать повторно таблицы Hive или задания Oozie при создании нового кластера.

Возможность настройки метахранилища позволяет указать внешнее метахранилище, используя базу данных SQL. Это, в свою очередь, позволяет сохранить метаданные при удалении кластера, так как они хранятся во внешней базе данных. Инструкции по созданию базы данных SQL см. в статье [Создание первой базы данных SQL Azure](sql-database-get-started.md).

> [AZURE.NOTE]Настройка метахранилища не поддерживается для кластеров типа HBase.

###<a id="scriptaction"></a>Действие сценария

Используя сценарии при подготовке кластера, вы можете установить дополнительные компоненты или настроить конфигурацию кластера. Такие сценарии вызываются с помощью **действия сценария**. Дополнительную информацию см. в статье [Настройка кластера HDInsight с помощью действия сценария](hdinsight-hadoop-customize-cluster-linux.md).

> [AZURE.IMPORTANT]Добавить дополнительные компоненты после создания кластера нельзя, так как после повторного создания образа узла кластера эти компоненты будут недоступны. В процессе повторного создания образа компоненты, установленные с помощью действий сценариев, устанавливаются заново.

### Дополнительное хранилище

В некоторых случаях вам может понадобиться добавить дополнительный объем хранилища в кластер. Например, у вас есть несколько учетных записей хранения Azure для разных географических регионов или разных служб и вам нужно проанализировать их с помощью HDInsight.

Дополнительную информацию об использовании вторичных хранилищ больших двоичных объектов см. в статье [Использование хранилища больших двоичных объектов Azure с HDInsight](../hdinsight-use-blob-storage.md).

##<a id="nextsteps"></a><a id="options"></a> Способы создания

В этой статье мы рассмотрели основные сведения о создании кластера HDInsight под управлением Linux. Приведенная ниже таблица поможет вам получить дополнительные сведения о создании кластера с помощью метода, который наилучшим образом соответствует вашим потребностям.

| Используется для создания кластера… | С помощью веб-браузера | С помощью командной строки | С помощью REST API | С помощью пакета SDK | В ОС Linux, Mac OS X и Unix | В ОС Windows |
| ------------------------------- |:----------------------:|:--------------------:|:------------------:|:------------:|:-----------------------------:|:------------:|
| [Портал предварительной версии Azure](hdinsight-hadoop-create-linux-clusters-portal.md) | ✔ | &nbsp; | &nbsp; | &nbsp; | ✔ | ✔ |
| [Интерфейс командной строки Azure](hdinsight-hadoop-create-linux-clusters-azure-cli.md) | &nbsp; | ✔ | &nbsp; | &nbsp; | ✔ | ✔ |
| [Azure PowerShell](hdinsight-hadoop-create-linux-clusters-azure-powershell.md) | &nbsp; | ✔ | &nbsp; | &nbsp; | &nbsp; | ✔ |
| [cURL](hdinsight-hadoop-create-linux-clusters-curl.md) | &nbsp; | ✔ | ✔ | &nbsp; | ✔ | ✔ |
| [Пакет SDK для .NET](hdinsight-hadoop-create-linux-clusters-dotnet.md) | &nbsp; | &nbsp; | &nbsp; | ✔ | ✔ | ✔ |



[hdinsight-use-mapreduce]: ../hdinsight-use-mapreduce/
[hdinsight-use-hive]: ../hdinsight-use-hive/
[hdinsight-use-pig]: ../hdinsight-use-pig/
[hdinsight-upload-data]: ../hdinsight-upload-data/
[hdinsight-sdk-documentation]: http://msdn.microsoft.com/library/dn479185.aspx


[hdinsight-customize-cluster]: ../hdinsight-hadoop-customize-cluster/
[hdinsight-get-started]: ../hdinsight-get-started/
[hdinsight-admin-powershell]: ../hdinsight-administer-use-powershell/

[hdinsight-submit-jobs]: ../hdinsight-submit-hadoop-jobs-programmatically/
[hdinsight-powershell-reference]: https://msdn.microsoft.com/library/dn858087.aspx

[azure-management-portal]: https://manage.windowsazure.com/

[azure-command-line-tools]: ../xplat-cli/
[azure-create-storageaccount]: ../storage-create-storage-account/

[azure-purchase-options]: http://azure.microsoft.com/pricing/purchase-options/
[azure-member-offers]: http://azure.microsoft.com/pricing/member-offers/
[azure-free-trial]: http://azure.microsoft.com/pricing/free-trial/
[hdi-remote]: http://azure.microsoft.com/documentation/articles/hdinsight-administer-use-management-portal/#rdp


[Powershell-install-configure]: ../install-configure-powershell/

[image-hdi-customcreatecluster]: ./media/hdinsight-get-started/HDI.CustomCreateCluster.png
[image-hdi-customcreatecluster-clusteruser]: ./media/hdinsight-get-started/HDI.CustomCreateCluster.ClusterUser.png
[image-hdi-customcreatecluster-storageaccount]: ./media/hdinsight-get-started/HDI.CustomCreateCluster.StorageAccount.png
[image-hdi-customcreatecluster-addonstorage]: ./media/hdinsight-get-started/HDI.CustomCreateCluster.AddOnStorage.png

[azure-preview-portal]: https://portal.azure.com


[image-cli-account-download-import]: ./media/hdinsight-hadoop-provision-linux-clusters/HDI.CLIAccountDownloadImport.png
[image-cli-clustercreation]: ./media/hdinsight-hadoop-provision-linux-clusters/HDI.CLIClusterCreation.png
[image-cli-clustercreation-config]: ./media/hdinsight-hadoop-provision-linux-clusters/HDI.CLIClusterCreationConfig.png
[image-cli-clusterlisting]: ./media/hdinsight-hadoop-provision-linux-clusters/HDI.CLIListClusters.png "Отображение кластеров"

[image-hdi-ps-provision]: ./media/hdinsight-hadoop-provision-linux-clusters/HDI.ps.provision.png
[image-hdi-ps-config-provision]: ./media/hdinsight-hadoop-provision-linux-clusters/HDI.ps.config.provision.png

[img-hdi-cluster]: ./media/hdinsight-hadoop-provision-linux-clusters/HDI.Cluster.png

  [89e2276a]: /documentation/articles/hdinsight-use-sqoop/ "Использование Sqoop вместе с HDInsight"

<!---HONumber=AcomDC_0107_2016-->