<properties
   	pageTitle="Создание кластеров Hadoop, HBase, Storm или Spark на платформе Linux в HDInsight | Microsoft Azure"
   	description="Узнайте, как создавать кластеры Hadoop, HBase, Storm или Spark на базе Linux для HDInsight с помощью браузера, Azure CLI, Azure PowerShell, REST или пакета SDK."
   	services="hdinsight"
   	documentationCenter=""
   	authors="mumian"
   	manager="paulettm"
   	editor="cgronlun"
	tags="azure-portal"/>

<tags
   	ms.service="hdinsight"
   	ms.devlang="na"
   	ms.topic="article"
   	ms.tgt_pltfrm="na"
   	ms.workload="big-data"
   	ms.date="03/25/2016"
   	ms.author="jgao"/>


# Создание кластеров Hadoop под управлением Linux в HDInsight

[AZURE.INCLUDE [selector](../../includes/hdinsight-selector-create-clusters.md)]

Кластер Hadoop включает в себя несколько виртуальных машин (узлов), которые используются для распределенной обработки задач в кластере. Azure абстрагирует сведения об установке и конфигурации отдельных узлов, поэтому вам нужно указать только общие сведения о настройке. В этой статье вы изучите эти параметры конфигурации.

##Типы кластеров

Сейчас HDInsight предоставляет 5 различных типов кластера, каждый из которых имеет набор компонентов для определенных функциональных возможностей:

| Тип кластера | Назначение |
| ------------ | ----------------------------- |
| Hadoop | Запрос и анализ (пакетные задания) |
| HBase | Хранилище данных NoSQL |
| Storm | Обработка событий в режиме реального времени |
| Spark (Предварительная версия) | Обработка в памяти, интерактивные запросы, обработка потоков микропакетов |
| R Server в Spark | R поддерживает разнообразную статистику больших данных, прогнозное моделирование и возможности машинного обучения. |

Для каждого типа кластера используется своя терминология (узлы кластера называются по-разному). Кроме того, типы отличаются количеством узлов и стандартными размерами виртуальных машин.

| Тип| Узлы (число узлов)| Схема|
|-----|------|--------|
|Hadoop| Головной узел (2), узел данных (от 1)|![Узлы кластера HDInsight Hadoop](./media/hdinsight-provision-clusters/HDInsight.Hadoop.roles.png)|
|HBase|Головной сервер (2), региональный сервер (от 1), основной узел или узел Zookeeper (3)|![Узлы кластера HDInsight HBase](./media/hdinsight-provision-clusters/HDInsight.HBase.roles.png)|
|Storm|Узел Nimbus (2), сервер супервизора (от 1), узел Zookeeper (3)|![Узлы кластера HDInsight Storm](./media/hdinsight-provision-clusters/HDInsight.Storm.roles.png)|
|Spark|Головной узел (2), рабочий узел (от 1), узел Zookeeper (3) (кат. "Бесплатный" для размера виртуальной машины Zookeeper A1)|![Узлы кластера HDInsight Spark](./media/hdinsight-provision-clusters/HDInsight.Spark.roles.png)|

* В скобках указано количество узлов каждого типа.

> [AZURE.IMPORTANT] Если вы планируете использовать более 32 рабочих узлов (при создании кластера или в ходе масштабирования после создания кластера), для головного узла потребуется минимум 8-ядерный процессор и 14 ГБ ОЗУ.

С помощью [действий скриптов](#customize-clusters-using-script-action) вы можете добавлять к этим базовым типам другие компоненты, например Hue или R.

## Уровни кластера

Azure HDInsight предлагает облачные решения для работы с большими данными в двух категориях: "Стандартный" и [Премиум](hdinsight-component-versioning.md#hdinsight-standard-and-hdinsight-premium). HDInsight "Премиум" включает R и другие дополнительные компоненты. HDInsight "Премиум" поддерживается только для HDInsight версии 3.4.

В следующей таблице перечислены типы кластеров HDInsight и приведена матрица поддержки "Премиум" HDInsight.

| Тип кластера | Стандартная | Premium |
|--------------|---------------|--------------|
| Hadoop | Да | Да |
| Spark | Да | Да |
| HBase | Да | Нет |
| Storm | Да | Нет |
| R Server в Spark | Нет | Да |

Эта таблица будет обновляться по мере включения дополнительных типов кластеров в HDInsight "Премиум". На следующем рисунке показаны сведения портала Azure для выбора типов кластера:

![Конфигурация HDInsight категории "Премиум"](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-cluster-type-configuration.png)


## Базовые параметры конфигурации

Ниже приведены базовые параметры конфигурации для создания кластера HDInsight.

- **Имя кластера**

	Имя кластера используется для его идентификации. Имя кластера должно быть глобально уникальным и соответствовать следующим правилам именования:

	- поле должно представлять собой строку длиной от 3 до 63 символов;
	- поле может содержать только буквы, цифры и дефисы.

- **Тип кластера**

    См. разделы [Типы кластеров](#cluster-types) и [Уровни кластеров](#cluster-tiers).

- **Операционная система**

	Кластеры HDInsight можно создавать на основе одной из двух операционных систем:
	- **HDInsight на платформе Linux (Ubuntu 12.04 LTS для Linux)**: HDInsight предоставляет возможность настроить кластеры Linux в Azure. Настройте кластер Linux, если вы знакомы с Linux или Unix, выполняете миграцию из существующего решения Hadoop на платформе Linux или хотите с легкостью выполнить интеграцию с компонентами экосистемы Hadoop, созданными для Linux. Дополнительную информацию см. в разделе [Приступая к работе с Hadoop в Linux на платформе HDInsight](hdinsight-hadoop-linux-tutorial-get-started.md).
	- **HDInsight на платформе Windows (Windows Server 2012 R2 Datacenter)**:
    
- **Версия HDInsight**

	Этот параметр используется для определения версии HDInsight для кластера. Дополнительные сведения см. в разделе [Версии HDInsight и компоненты Hadoop](https://go.microsoft.com/fwLink/?LinkID=320896&clcid=0x409).

- **Название подписки**

	Каждый кластер HDInsight привязывается к одной подписке Azure.
    
- **Имя группы ресурсов**

	[Azure Resource Manager (ARM)](resource-group-overview.md) позволяет работать с ресурсами в приложении в виде группы, которая называется группой ресурсов Azure. Вы можете развертывать, обновлять, отслеживать или удалять все ресурсы для приложения в рамках одной скоординированной операции.

- **Учетные данные**

	Во время создания кластера HDInsight имеется возможность настроить две учетные записи пользователя:

	- Пользователь HTTP. По умолчанию используется имя admin и базовая конфигурация на портале Azure. Иногда его называют "пользователем кластера".
	- Пользователь SSH (кластеры Linux). Она используется для подключения к кластеру через SSH. Вы можете создать дополнительные учетные записи пользователей SSH после создания кластера, следуя инструкциям в статье [Использование SSH с Hadoop в HDInsight на платформе Linux в Linux, Unix или OS X](hdinsight-hadoop-linux-use-ssh-unix.md) или [Использование SSH с Hadoop в HDInsight на платформе Linux в Windows](hdinsight-hadoop-linux-use-ssh-unix.md).

    >[AZURE.NOTE] Для кластера под управлением Windows можно создать пользователя удаленного рабочего стола, который будет использован для подключения к кластеру с помощью протокола удаленного рабочего стола.

- **Источник данных**

	Исходная HDFS использует несколько локальных дисков в кластере, а HDInsight — хранилище BLOB-объектов Azure. Хранилище BLOB-объектов Azure — это надежное, универсальное решение, которое полностью интегрируется с HDInsight. С помощью интерфейса распределенной файловой системы Hadoop (HDFS) все компоненты HDInsight могут напрямую взаимодействовать со структурированными или неструктурированными данными в хранилище больших двоичных объектов. Хранение данных в хранилище BLOB-объектов позволяет безопасно и без потери пользовательских данных удалять используемые для расчетов кластеры HDInsight.

	В процессе настройки необходимо задать учетную запись хранения Azure и контейнер для хранения BLOB-объектов. В некоторых сценариях создания учетную запись и контейнер потребуется создать заранее. Кластер будет использовать этот контейнер в качестве хранилища по умолчанию. Вы также можете указать дополнительные учетные записи хранения Azure (связанные хранилища), к которым кластер получит доступ. Кластер также сможет получать доступ к любым контейнерам BLOB-объектов, настроенным с полным общим доступом для чтения или общим доступом для чтения только на уровне больших двоичных объектов. Дополнительные сведения об ограничениях доступа см. в разделе [Управление доступом к ресурсам хранилища Azure](storage-manage-access-to-resources.md).

	![Хранилище HDInsight](./media/hdinsight-provision-clusters/HDInsight.storage.png)

	>[AZURE.NOTE] BLOB-объекты группируются в контейнерах следующим образом.

	![Хранилище blob-объектов Azure](./media/hdinsight-provision-clusters/Azure.blob.storage.jpg)

    Не рекомендуется использовать контейнер больших двоичных объектов по умолчанию для хранения бизнес-данных. Рекомендуется удалять контейнер больших двоичных объектов по умолчанию после каждого использования, чтобы сократить затраты на хранение. Обратите внимание, что контейнер по умолчанию содержит журналы приложений и системный журнал. Обязательно извлеките эти журналы перед удалением контейнера.
    
	>[AZURE.WARNING] Совместное использование одного контейнера хранилища BLOB-объектов для нескольких кластеров не поддерживается.

	Дополнительную информацию об использовании дополнительных хранилищ больших двоичных объектов см. в разделе [Использование хранилища больших двоичных объектов Azure с HDInsight](hdinsight-hadoop-use-blob-storage.md).

    Наряду с хранилищем BLOB-объектов Azure в качестве учетной записи хранения по умолчанию для кластера HBase в HDInsight, а также в качестве связанного хранилища для всех 4 типов кластера HDInsight можно использовать [хранилище озера данных Azure](data-lake-store-overview.md). Инструкции см. в статье [Создание кластера HDInsight с хранилищем озера данных с помощью портала Azure](../data-lake-store/data-lake-store-hdinsight-hadoop-use-portal.md).
    
- **Расположение (регион)**

	Кластер HDInsight должен находиться в том же расположении Azure, что и его учетная запись хранения, используемая по умолчанию.
	
	![Регионы Azure](./media/hdinsight-provision-clusters/Azure.regions.png)

	Просмотреть поддерживаемые регионы можно в раскрывающемся списке **Регион** на странице [Цены на HDInsight](https://go.microsoft.com/fwLink/?LinkID=282635&clcid=0x409).

- **Ценовые категории узлов**

    Клиенты оплачивают использование этих узлов на протяжении всего срока существования кластера. Начисление начинается сразу после создания кластера и завершается при его удалении (нельзя высвободить память, выделенную для кластеров, или приостановить их работу).

	Кластеры разных типов отличаются типами, количеством и размерами узлов. Например, кластер Hadoop имеет два _головных узла_ и четыре _узла данных_ (по умолчанию), а кластер Storm — два _узла Nimbus_, три _узла Zookeeper_ и четыре _узла супервизора_ (по умолчанию). Затраты на кластеры HDInsight определяются числом узлов и размерами виртуальных машин на узлах. Например, если вы знаете, что будете выполнять операции, требующие большого объема памяти, вам, возможно, следует выбрать вычислительный ресурс с большим объемом памяти. Для учебных целей рекомендуется использовать один узел данных. Дополнительные сведения о ценах на HDInsight см. в статье [Цены на HDInsight](https://go.microsoft.com/fwLink/?LinkID=282635&clcid=0x409).

	>[AZURE.NOTE] Максимальный размер кластера зависит от подписки Azure. Чтобы увеличить лимит, обратитесь в службу поддержки по вопросам выставления счетов.
	
    >Узлы, используемые кластером, не учитываются в общем количестве виртуальных машин, так как образы виртуальных машин для узлов реализуются службой HDInsight; однако вычислительные ядра, используемые узлами, учитываются в общем количестве вычислительных ядер, доступных для вашей подписки. В разделе сводки в колонке "Ценовые категории узла" при создании кластера HDInsight можно просмотреть количество ядер, которые будут использоваться кластером, а также доступное количество ядер.

	При настройке кластера на портале Azure размер узла можно выбрать в колонке __Ценовая категория для узлов__. В ней также отображаются цены для узлов разных размеров. На следующем рисунке показаны варианты для кластера Hadoop под управлением Linux.

	![размеры узла виртуальной машины hdinsight](./media/hdinsight-provision-clusters/hdinsight.node.sizes.png)

    В таблицах ниже перечислены все размеры, поддерживаемые кластерами HDInsight, и предоставляемые ими возможности.

    - Уровень Standard: серия A

        В классической модели развертывания некоторые размеры виртуальных машин немного отличаются в PowerShell и интерфейсе командной строки.

        * Standard\_A3 — "Крупный".
        * Standard\_A4 — "Очень крупный".

        <br>

        |Размер |Ядра ЦП|Память|Сетевые адаптеры (макс.)|Максимальный размер диска|Макс. количество дисков данных (по 1023 ГБ)|Макс. количество операций ввода-вывода в секунду (500 на диск)|
        |---|---|---|---|---|---|---|
        |Standard\_A3\"Крупный"|4|7 ГБ|2|Временный: 285 ГБ |8|8x500|
        |Standard\_A4\"Очень крупный"|8|14 ГБ|4|Временный: 605 ГБ |16|16x500|
        |Standard\_A6|4|28 ГБ|2|Временный: 285 ГБ |8|8x500|
        |Standard\_A7|8|56 ГБ|4|Временный: 605 ГБ |16|16x500|


    - Уровень Standard: серия D

        |Размер |Ядра ЦП|Память|Сетевые адаптеры (макс.)|Максимальный размер диска|Макс. количество дисков данных (по 1023 ГБ)|Макс. количество операций ввода-вывода в секунду (500 на диск)|
        |---|---|---|---|---|---|---|
        |Standard\_D3 |4\.|14 ГБ|4|Временный (SSD): 200 ГБ |8|8x500|
        |Standard\_D4 |8|28 ГБ|8|Временный (SSD): 400 ГБ |16|16x500|
        |Standard\_D12 |4\.|28 ГБ|4|Временный (SSD): 200 ГБ |8|8x500|
        |Standard\_D13 |8|56 ГБ|8|Временный (SSD): 400 ГБ |16|16x500|
        |Standard\_D14 |16|112 ГБ|8|Временный (SSD): 800 ГБ |32|32x500|

    - Уровень Standard: серия Dv2

        |Размер |Ядра ЦП|Память|Сетевые адаптеры (макс.)|Максимальный размер диска|Макс. количество дисков данных (по 1023 ГБ)|Макс. количество операций ввода-вывода в секунду (500 на диск)|
        |---|---|---|---|---|---|---|
        |Standard\_D3\_v2 |4\.|14 ГБ|4|Временный (SSD): 200 ГБ |8|8x500|
        |Standard\_D4\_v2 |8|28 ГБ|8|Временный (SSD): 400 ГБ |16|16x500|
        |Standard\_D12\_v2 |4\.|28 ГБ|4|Временный (SSD): 200 ГБ |8|8x500|
        |Standard\_D13\_v2 |8|56 ГБ|8|Временный (SSD): 400 ГБ |16|16x500|
        |Standard\_D14\_v2 |16|112 ГБ|8|Временный (SSD): 800 ГБ |32|32x500|    
 
    Рекомендации по развертыванию, которые нужно учитывать, если вы планируете использовать эти ресурсы, приведены в статье [Размеры виртуальных машин](../virtual-machines/virtual-machines-size-specs.md). Сведения о ценах на различные размеры см. в статье [Цены на HDInsight](https://azure.microsoft.com/pricing/details/hdinsight).
    
	> [AZURE.IMPORTANT] Если вы планируете использовать более 32 рабочих узлов (при создании кластера или в ходе масштабирования после создания кластера), для головного узла потребуется минимум 8-ядерный процессор и 14 ГБ ОЗУ. Начисление оплаты начинается после создания кластера и прекращается только после его удаления. Дополнительные сведения о ценах см. в статье [Цены на HDInsight](https://azure.microsoft.com/pricing/details/hdinsight/).


## Использование дополнительного объема хранилища

В некоторых случаях вам может понадобиться добавить дополнительный объем хранилища в кластер. Например, у вас есть несколько учетных записей хранения Azure для разных географических регионов или разных служб и вам нужно проанализировать их с помощью HDInsight.

Дополнительную информацию об использовании вторичных хранилищ больших двоичных объектов см. в статье [Использование хранилища больших двоичных объектов Azure с HDInsight](hdinsight-hadoop-use-blob-storage.md). Дополнительные сведения об использовании дополнительных хранилищ озера данных см. в статье [Создание кластера HDInsight с хранилищем озера данных с помощью портала Azure](../data-lake-store/data-lake-store-hdinsight-hadoop-use-portal.md).


## Использование метахранилища Hive/Oozie

Если вы хотите сохранить таблицы Hive после удаления кластера HDInsight, настоятельно рекомендуем использовать пользовательское метахранилище, чтобы в будущем подключить это метахранилище к другому кластеру HDInsight.

Метахранилище содержит метаданные Hive и Oozie, такие как таблицы, секции, схемы и столбцы Hive. Использование метахранилища помогает сохранять метаданные Hive и Oozie, чтобы не создавать повторно таблицы Hive или задания Oozie при создании нового кластера. Для хранения подобной информации Hive по умолчанию использует встроенную базу данных SQL Azure. Встроенная база данных не сохраняет метаданные при удалении кластера. Предположим, вы создали кластер с метахранилищем Hive. и создали некоторые таблицы Hive. Если после удаления кластера вы повторно создадите его с использованием того же метахранилища Hive, то таблицы Hive исходного кластера будут доступны в новом кластере.

> [AZURE.NOTE] Возможность настройки метахранилища не поддерживается для кластеров типа HBase.

## Использование виртуальных сетей Azure

[Виртуальная сеть Azure](https://azure.microsoft.com/documentation/services/virtual-network/) позволяет создать безопасную стабильную сеть, в которой будут находиться все ресурсы, связанные с вашим решением. Виртуальная сеть позволит вам:

* Соединить облачные ресурсы с частной сетью (только для облачных решений).

	![Диаграмма конфигурации только для облачных решений](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-vnet-cloud-only.png)

* Соединить ваши облачные ресурсы с сетью локального центра обработки данных (типа "сеть-сеть" или "точка-сеть") при помощи виртуальной частной сети (VPN).

    | Конфигурации «сеть — сеть» | Конфигурации «точка — сеть» |
    | -------------------------- | --------------------------- |
    | Конфигурация «сеть — сеть» позволяет подключить несколько ресурсов центра обработки данных к виртуальной сети Azure с использованием аппаратного обеспечения VPN или службы маршрутизации и удаленного доступа.<br />![Диаграмма конфигурации соединения "сервер-сервер"](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-vnet-site-to-site.png) | Конфигурация «точка — сеть» позволяет подключить конкретный ресурс к виртуальной сети Azure с использованием программного обеспечения VPN.<br />![Диаграмма конфигурации соединения "клиент-сервер"](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-vnet-point-to-site.png) |

Дополнительные сведения об использовании HDInsight в виртуальной сети, включая требования к конфигурации виртуальной сети, см. в статье [Расширение возможностей HDInsight с помощью виртуальной сети Azure](hdinsight-extend-hadoop-virtual-network.md).

## Настройка кластеров HDInsight (служба начальной загрузки)

В некоторых случаях требуется изменить файлы конфигурации.

- core-site.xml
- hdfs-site.xml
- mapred-site.xml
- yarn-site.xml
- hive-site.xml
- oozie-site.xml

Чтобы изменения сохранялись в течение всего времени существования кластера, можно применить настройки кластера HDInsight во время создания кластера или воспользоваться Ambari в кластерах под управлением Linux. Дополнительные сведения см. в статье [Настройка кластеров HDInsight с помощью начальной загрузки](hdinsight-hadoop-customize-cluster-bootstrap.md).

>[AZURE.NOTE] При пересоздании образа в кластерах под управлением Windows изменения не сохраняются. Дополнительные сведения см. в разделе [Перезапуск экземпляра роли из-за обновлений ОС](http://blogs.msdn.com/b/kwill/archive/2012/09/19/role-instance-restarts-due-to-os-upgrades.aspx). Чтобы изменения сохранялись в течение всего времени существования кластера, необходимо изменить настройки кластера HDInsight во время его создания.

## Настройка кластеров с помощью действия сценария

Можно установить дополнительные компоненты или настроить конфигурацию кластера с помощью сценариев во время создания. Такие сценарии вызываются с помощью **действия сценария**, которое является параметром конфигурации и может использоваться посредством портала, командлетов HDInsight PowerShell или пакета SDK для HDInsight .NET. Дополнительную информацию см. в статье [Настройка кластера HDInsight с помощью действия сценария](hdinsight-hadoop-customize-cluster-linux.md).



## Способы создания кластера

В этой статье мы рассмотрели основные сведения о создании кластера HDInsight под управлением Linux. Приведенная ниже таблица поможет вам получить дополнительные сведения о создании кластера с помощью метода, который наилучшим образом соответствует вашим потребностям.

| Метод для создания кластеров… | Использование веб-браузера… | Использование командной строки | Использование REST API | Использование пакета SDK | В ОС Linux, Mac OS X и Unix | В ОС Windows |
| ------------------------------- |:----------------------:|:--------------------:|:------------------:|:------------:|:-----------------------------:|:------------:|
| [Портал Azure](hdinsight-hadoop-create-linux-clusters-portal.md) | ✔ | &nbsp; | &nbsp; | &nbsp; | ✔ | ✔ |
| [Фабрика данных Azure](hdinsight-hadoop-create-linux-clusters-adf.md) | ✔ | ✔ | ✔ |✔ | ✔ | ✔ |
| [Интерфейс командной строки Azure](hdinsight-hadoop-create-linux-clusters-azure-cli.md) | &nbsp; | ✔ | &nbsp; | &nbsp; | ✔ | ✔ |
| [Azure PowerShell](hdinsight-hadoop-create-linux-clusters-azure-powershell.md) | &nbsp; | ✔ | &nbsp; | &nbsp; | ✔ | ✔ |
| [cURL](hdinsight-hadoop-create-linux-clusters-curl-rest.md) | &nbsp; | ✔ | ✔ | &nbsp; | ✔ | ✔ |
| [Пакет SDK для .NET](hdinsight-hadoop-create-linux-clusters-dotnet-sdk.md) | &nbsp; | &nbsp; | &nbsp; | ✔ | ✔ | ✔ |
| [Шаблоны ARM](hdinsight-hadoop-create-linux-clusters-arm-templates.md) | &nbsp; | ✔ | &nbsp; | &nbsp; | ✔ | ✔ |

<!---HONumber=AcomDC_0330_2016-->