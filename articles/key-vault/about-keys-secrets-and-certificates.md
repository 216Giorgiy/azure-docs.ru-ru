---
title: Сведения о ключах, секретах и сертификатах
description: Обзор интерфейса REST и подробные сведения для разработчиков хранилища ключей
services: key-vault
documentationcenter: ''
author: BryanLa
manager: mbaldwin
tags: azure-resource-manager
ms.assetid: abd1b743-1d58-413f-afc1-d08ebf93828a
ms.service: key-vault
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 08/14/2018
ms.author: bryanla
ms.openlocfilehash: 60b8689e602f0716cdd1a383ab6568979a37e7c0
ms.sourcegitcommit: f3bd5c17a3a189f144008faf1acb9fabc5bc9ab7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2018
ms.locfileid: "44302951"
---
# <a name="about-keys-secrets-and-certificates"></a>Сведения о ключах, секретах и сертификатах
С помощью Azure Key Vault пользователи могут хранить и использовать криптографические ключи в среде Microsoft Azure. Key Vault поддерживает несколько типов ключей и алгоритмов и позволяет использовать аппаратные модули безопасности (HSM) для важных ключей. Кроме того, в этом хранилище ключей пользователи могут безопасно хранить секреты. Секреты — это состоящие из октетов объекты ограниченного размера без определенной семантики. Хранилище ключей также поддерживает сертификаты, которые создаются поверх ключей и секретов и добавляют функцию автоматического обновления.

Дополнительные сведения об Azure Key Vault см. в [этой статье](/azure/key-vault/key-vault-whatis).

**Общие сведения о хранилище ключей**

-   [Поддерживаемые стандарты](#BKMK_Standards)
-   [Типы данных](#BKMK_DataTypes)  
-   [Объекты, идентификаторы и управление версиями](#BKMK_ObjId)  

**Сведения о ключах**

-   [Ключи и их типы](#BKMK_KeyTypes)  
-   [Алгоритмы RSA](#BKMK_RSAAlgorithms)  
-   [Алгоритмы RSA-HSM](#BKMK_RSA-HSMAlgorithms)  
-   [Криптографическая защита](#BKMK_Cryptographic)
-   [Операции с ключами](#BKMK_KeyOperations)  
-   [Атрибуты ключей](#BKMK_KeyAttributes)  
-   [Теги ключей](#BKMK_Keytags)  

**О секретах** 

-   [Работа с секретами](#BKMK_WorkingWithSecrets)  
-   [Атрибуты секретов](#BKMK_SecretAttrs)  
-   [Теги секретов](#BKMK_SecretTags)  
-   [Контроль доступа к секретам](#BKMK_SecretAccessControl)  

**Сведения о сертификатах**

-   [Создание сертификатов](#BKMK_CompositionOfCertificate)  
-   [Атрибуты и теги сертификата](#BKMK_CertificateAttributesAndTags)  
-   [Политика сертификата](#BKMK_CertificatePolicy)  
-   [Издатель сертификата](#BKMK_CertificateIssuer)  
-   [Контакты сертификатов](#BKMK_CertificateContacts)  
-   [Контроль доступа к сертификату](#BKMK_CertificateAccessControl)  

--

## <a name="key-vault-general-details"></a>Общие сведения о хранилище ключей

В следующих разделах представлены общие сведения, применимые к реализации службы Azure Key Vault.

###  <a name="BKMK_Standards"></a> Поддерживаемые стандарты

Спецификации JSON (нотация объектов JavaScript) и JOSE (подпись и шифрование объектов JavaScript) являются важной справочной информацией.  

-   [Веб-ключ JSON (JWK)](http://tools.ietf.org/html/draft-ietf-jose-json-web-key)  
-   [Веб-шифрование JSON (JWE)](http://tools.ietf.org/html/draft-ietf-jose-json-web-encryption)  
-   [Веб-алгоритмы JSON (JWA)](http://tools.ietf.org/html/draft-ietf-jose-json-web-algorithms)  
-   [Веб-подпись JSON (JWS)](http://tools.ietf.org/html/draft-ietf-jose-json-web-signature)  

### <a name="BKMK_DataTypes"></a> Типы данных

Обратитесь к спецификациям [JOSE](#BKMK_Standards) для соответствующих типов данных ключей, шифрования и подписей.  

-   **algorithm** — поддерживаемый алгоритм для операции ключа, например RSA1_5.  
-   **ciphertext-value** — октеты зашифрованного текста, закодированные с помощью Base64URL.  
-   **digest-value** — выходные данные хэш-алгоритма, зашифрованные с помощью Base64URL.  
-   **key-type** — один из поддерживаемых типов ключей, например RSA.  
-   **plaintext-value** — октеты открытого текста, закодированные с помощью Base64URL.  
-   **signature-value** — выходные данные алгоритма подписи, закодированные с помощью Base64URL.  
-   **base64URL** — двоичное значение в кодировке Base64URL [RFC4648].  
-   **boolean** — значение true или false.  
-   **Identity** — удостоверение из Azure Active Directory (AAD).  
-   **IntDate** — десятичное значение JSON, представляющее число секунд, начиная с 1970-01-01T0:0:0Z UTC до указанной даты или времени в формате UTC. Дополнительные сведения о дате и времени в общем формате и в UTC в частности см. в [RFC3339].  

###  <a name="BKMK_ObjId"></a> Объекты, идентификаторы и управление версиями

Объекты, хранящиеся в Azure Key Vault, сохраняют версии всякий раз, когда создается новый экземпляр объекта, и каждая версия имеет уникальный идентификатор и URL-адрес. Когда объект создается впервые, ему присваивается уникальный идентификатор версии, а также метка с текущей версией. При создании экземпляра с тем же именем объекта новому объекту присваивается уникальный идентификатор версии, и эта версия становится текущей.  

К объектам в Azure Key Vault можно получить доступ с использованием текущего идентификатора или идентификатора версии. Например, если ключ с именем MasterKey выполняет операции с текущим идентификатором, система будет использовать последнюю доступную версию. В случае выполнения операций с идентификатором, зависящим от версии, система использует эту конкретную версию объекта.  

В Azure Key Vault объекты уникально идентифицированы с использованием URL-адреса. Так что два объекта в системе, независимо от географического местоположения, не могут иметь один и тот же URL-адрес. Полный URL-адрес к объекту называется идентификатором объекта и состоит из части префикса, которая идентифицирует Key Vault, типа объекта, указанного пользователем имени объекта и версии объекта. Имя объекта не учитывает регистр и является неизменяемым. Идентификаторы, которые не включают версию объекта, называются базовыми.  

Дополнительные сведения см. в статье [Authentication, requests and responses](authentication-requests-and-responses.md) (Проверка подлинности, запросы и ответы).

Идентификатор объекта имеет следующий общий формат:  

`https://{keyvault-name}.vault.azure.net/{object-type}/{object-name}/{object-version}`  

Описание  

|||  
|-|-|  
|`keyvault-name`|Имя хранилища ключей в службе Microsoft Azure Key Vault.<br /><br /> Имена хранилищ ключей выбираются пользователем и являются глобально уникальными.<br /><br /> Имя хранилища ключей должно быть строкой длиной от 3 до 24 символов, содержащей только цифры (0–9), буквы (a–z, A–Z) и символ "-".|  
|`object-type`|Тип объекта: "keys" либо "secrets".|  
|`object-name`|`object-name` — предоставленное пользователем имя, которое должно быть уникальным в Key Vault. Имя должно быть строкой длиной от 1 до 127 символов, содержащей только цифры (0–9), буквы (a–z, A–Z) и символ "-".|  
|`object-version`|`object-version` — созданный системой 32-символьный идентификатор строки, который при необходимости используется для обозначения уникальной версии объекта.|  

## <a name="key-vault-keys"></a>Ключи Key Vault

###  <a name="BKMK_KeyTypes"></a> Ключи и их типы

Ключи шифрования в Azure Key Vault представлены объектами веб-ключей JSON (JWK). Базовые спецификации JWK и JWA также расширены, чтобы включать типы ключей, относящиеся к реализации Azure Key Vault. Например, импорт ключей в Azure Key Vault с использованием упаковки конкретного поставщика HSM (Thales), обеспечивающей безопасную транспортировку ключей, что позволяет использовать их только в HSM Azure Key Vault.  

- **"Программные" ключи** обрабатываются в программном обеспечении с помощью Key Vault, но шифруются при хранении с использованием системного ключа в HSM. Клиенты могут импортировать существующий ключ RSA или ключ EC либо запросить создание ключа в Azure Key Vault.
- **"Аппаратные" ключи** обрабатываются в HSM (аппаратный модуль безопасности). Такие ключи защищены одной из систем безопасности HSM Azure Key Vault (в каждом регионе есть системы безопасности для обеспечения изоляции). Клиенты могут импортировать ключ RSA или EC (программными средствами либо путем экспорта из совместимого устройства HSM) или запросить создание ключа в Azure Key Vault. Этот тип ключа добавляет атрибут T к JWK, позволяющий получить материал ключа HSM.

     Дополнительные сведения о географических ограничениях см. в [центре управления безопасностью Microsoft Azure](https://azure.microsoft.com/support/trust-center/privacy/).  

Azure Key Vault поддерживает только ключи RSA и EC. Последующие выпуски могут поддерживать другие типы ключей, такие как симметричные ключи.

-   **EC** — "программный" ключ эллиптической кривой.
-   **EC-HSM** — "аппаратный" ключ эллиптической кривой.
-   **RSA** — "программный" ключ RSA.
-   **RSA-HSM** — "аппаратный" ключ RSA.

Azure Key Vault поддерживает ключи RSA таких размеров: 2048, 3072 и 4096, а также такие типы ключей EC: P-256, P-384, P-521 и P-256K.

### <a name="BKMK_Cryptographic"></a> Криптографическая защита

Криптографические модули, используемые Azure Key Vault, будь то HSM или программные модули, соответствуют стандартам FIPS. Для выполнения в режиме FIPS не требуется каких-либо дополнительных действий. При **создании** или **импорте** защищенных с помощью HSM ключей они будут гарантированно обработаны в HSM, соответствующих FIPS 140-2 уровня 2 или более поздней версии. При **создании** или **импорте** защищенных программно ключей они будут обрабатываться в криптографических модулях, соответствующих FIPS 140-2 уровня 1 или более поздней версии. Дополнительные сведения см. в разделе [Ключи и их типы](#BKMK_KeyTypes).

###  <a name="BKMK_ECAlgorithms"></a> Алгоритмы EC
 Ниже приведены идентификаторы алгоритмов, которые поддерживаются ключами EC и EC-HSM в Azure Key Vault. 

#### <a name="signverify"></a>SIGN/VERIFY

-   **ES256** — ECDSA для хэшей SHA-256 и ключей, созданных на основе кривой P-256. Этот алгоритм описан в документации по [RFC7518].
-   **ES256K** — ECDSA для хэшей SHA-256 и ключей, созданных на основе кривой P-256K. Этот алгоритм находится на этапе ожидания стандартизации.
-   **ES384** — ECDSA для хэшей SHA-384 и ключей, созданных на основе кривой P-384. Этот алгоритм описан в документации по [RFC7518].
-   **ES512** — ECDSA для хэшей SHA-512 и ключей, созданных на основе кривой P-521. Этот алгоритм описан в документации по [RFC7518].

###  <a name="BKMK_RSAAlgorithms"></a> Алгоритмы RSA  
 Ниже приведены идентификаторы алгоритмов, которые поддерживаются ключами RSA и RSA-HSM в Azure Key Vault.  

#### <a name="wrapkeyunwrapkey-encryptdecrypt"></a>WRAPKEY/UNWRAPKEY, ENCRYPT/DECRYPT

-   **RSA1_5** — это шифрование ключа RSAES-PKCS1-V1_5 [RFC3447].  
-   **RSA-OAEP** — алгоритм RSAES, использующий оптимальное асимметричное шифрование с дополнением (OAEP) [RFC3447], с параметрами по умолчанию, указанными в RFC 3447 в разделе A.2.1. Эти параметры используют хэш-функцию SHA-1 и функцию генерирования масок MGF1 с SHA-1.  

#### <a name="signverify"></a>SIGN/VERIFY

-   **RS256** — RSASSA-PKCS-v1_5, использующий SHA-256. Предоставленное приложением значение хэш-кода должно быть вычислено с помощью SHA-256 и иметь длину в 32 байта.  
-   **RS384** — RSASSA-PKCS-v1_5, использующий SHA-384. Предоставленное приложением значение хэш-кода должно быть вычислено с помощью SHA-384 и иметь длину в 48 байтов.  
-   **RS512** — RSASSA-PKCS-v1_5, использующий SHA-512. Предоставленное приложением значение хэш-кода должно быть вычислено с помощью SHA-512 и иметь длину в 64 байта.  
-   **RSNULL** — специализированный вариант использования для реализации определенных сценариев TLS (см. [RFC2437]).  

###  <a name="BKMK_KeyOperations"></a> Операции с ключами

Azure Key Vault поддерживает следующие операции с объектами ключей:  

-   **Создание**. Клиенты могут создавать ключи в Azure Key Vault. Значение ключа создается в Azure Key Vault и хранится в нем. Оно не выдается клиенту. В Azure Key Vault можно создать асимметричные (и в будущем эллиптические кривые и симметричные) ключи.  
-   **Импорт**. Клиенты могут импортировать имеющиеся ключи в Azure Key Vault. В Azure Key Vault можно импортировать асимметричные (и в будущем эллиптические кривые и симметричные) ключи с помощью нескольких различных способов упаковки внутри конструкции JWK.  
-   **Обновление**. Клиенты с достаточными разрешениями могут изменять метаданные (атрибуты ключей), связанные с ключами, ранее сохраненными в Azure Key Vault.  
-   **Удаление**. Клиенты с достаточными разрешениями могут удалять ключи из Azure Key Vault.  
-   **Вывод списка**. Клиенты могут перечислить все ключи в данном Azure Key Vault.  
-   **Вывод списка версий.** Клиенты могут перечислить все версии данного ключа в данном Azure Key Vault.  
-   **Получение**. Клиенты могут извлечь открытые части данного ключа в Azure Key Vault.  
-   **Резервное копирование**. Экспорт ключей в защищенной форме.  
-   **Восстановление**. Импорт ранее заархивированного ключа.  

Дополнительные сведения о работе с ключами см. в [справочнике по работе с Azure Key Vault с помощью REST API](/rest/api/keyvault).  

После создания ключа в Azure Key Vault с его использованием можно выполнять следующие криптографические операции:  

-   **Подпись и проверка**. Строго говоря, эта операция является подписью хэша или проверкой хэша, так как Azure Key Vault не поддерживает хэширование содержимого в рамках создания подписи. Приложения должны хэшировать данные для подписи локально, а затем запрашивать подпись хэша в Azure Key Vault. Проверка подписанных хэшей поддерживается в качестве удобного механизма для приложений, у которых нет доступа к материалам открытого ключа. Для оптимизации производительности приложений рекомендуется выполнять операции проверки локально.  
-   **Шифрование и упаковка ключа**. Ключ, хранимый в Azure Key Vault, можно использовать для защиты другого ключа, как правило, симметричного ключа шифрования содержимого (CEK). Если ключ в Azure Key Vault асимметричен, используется шифрование ключа, например RSA-OAEP, а операции WRAPKEY/UNWRAPKEY эквивалентны шифрованию и расшифровке. Если ключ в Azure Key Vault симметричен, применяется упаковка ключа, например AES-KW. Операция WRAPKEY поддерживается в качестве удобного механизма для приложений, у которых нет доступа к материалам открытого ключа. Для оптимизации производительности приложений рекомендуется выполнять операции WRAPKEY локально.  
-   **Шифрование и расшифровка**. Ключ, хранимый в Azure Key Vault, можно использовать для шифрования или расшифровки одного блока данных, размер которого определяется типом ключа и выбранным алгоритмом шифрования. Операция шифрования предоставляется в качестве удобного механизма для приложений, у которых нет доступа к материалам открытого ключа. Для оптимизации производительности приложений рекомендуется выполнять операции шифрования локально.  

Хотя операции WRAPKEY и UNWRAPKEY с использованием асимметричных ключей могут показаться излишними, но так как они эквивалентны операции шифрования или расшифровки, использование различных операций обеспечивает разделение семантики и авторизации этих операций, а также целостность в случаях, когда служба поддерживает другие типы ключей.  

Azure Key Vault не поддерживает операции EXPORT. Как только ключ подготовлен в системе, нельзя извлечь его или изменить его материал.  Однако пользователи Azure Key Vault, которым может потребоваться ключ для других вариантов использования или в случае его удаления из Azure Key Vault, могут использовать операции BACKUP и RESTORE для экспорта или импорта ключей в защищенной форме. Ключи, созданные в ходе операции BACKUP, не могут использоваться за пределами Azure Key Vault. Кроме того, в различных экземплярах Azure Key Vault также можно использовать операцию IMPORT.  

Пользователи могут ограничивать любую из криптографических операций, поддерживаемых Azure Key Vault, для каждого ключа с помощью свойства key_ops объекта JWK.  

Дополнительные сведения об объектах JWK см. в статье о [веб-ключе JSON (JWK)](http://tools.ietf.org/html/draft-ietf-jose-json-web-key).  

###  <a name="BKMK_KeyAttributes"></a> Атрибуты ключей

В дополнение к материалу ключа можно указать следующие атрибуты. В запросе JSON ключевое слово атрибутов и кавычки ‘{‘ ‘}’ необходимы, даже если атрибуты не указаны.  

- *enabled*. Необязательный атрибут с логическим значением, по умолчанию — **true**. Указывает, является ли ключ активным и подходит ли для операций шифрования. Атрибут *enabled* используется в сочетании с *nbf* и *exp*. При возникновении операции между *nbf* и *exp* она будет разрешена, только если для *enabled* установлено значение **true**. Операции вне окна *nbf* / *exp* автоматически запрещаются, за исключением определенных типов операции в разделе [определенных условий](#BKMK_key-date-time-ctrld-ops).
- *nbf*. Необязательный атрибут со значением в формате IntDate, значение по умолчанию — "now". Атрибут *nbf* (не ранее) определяет время, до которого ключ не должен использоваться для криптографических операций, за исключением определенных типов операций в разделе [определенных условий.](#BKMK_key-date-time-ctrld-ops) Обработка атрибута *nbf* требует, чтобы текущая дата и время наступали позже или соответствовали дате и времени, перечисленным в атрибуте *nbf*. Azure Key Vault может предоставить кратковременную отсрочку, обычно не более чем несколько минут, чтобы учесть разницу в показаниях часов. Нужно указать число, содержащее значение IntDate.  
- *exp*. Необязательный атрибут со значением в формате IntDate, значение по умолчанию — "forever". Атрибут *exp* (время окончания срока действия) определяет время, до которого или после которого ключ не должен использоваться для криптографических операций, за исключением определенных типов операций в разделе [определенных условий](#BKMK_key-date-time-ctrld-ops). Обработка атрибута *exp* требует, чтобы текущая дата и время наступали раньше или соответствовали дате и времени, перечисленным в атрибуте *exp*. Azure Key Vault может предоставить кратковременную отсрочку, обычно не более чем несколько минут, чтобы учесть разницу в показаниях часов. Нужно указать число, содержащее значение IntDate.  

Есть дополнительные атрибуты только для чтения, которые включены в любой ответ, содержащий атрибуты ключей:  

- *created*. Необязательный атрибут со значением в формате IntDate. Атрибут *created* указывает, когда была создана эта версия ключа. Это значение равно NULL для ключей, созданных перед добавлением данного атрибута. Нужно указать число, содержащее значение IntDate.  
- *updated*. Необязательный атрибут со значением в формате IntDate. Атрибут *updated* указывает, когда была обновлена эта версия ключа. Это значение равно NULL для ключей, которые в последний раз обновлялись перед добавлением данного атрибута. Нужно указать число, содержащее значение IntDate.  

Дополнительные сведения об IntDate и других типах данных см. в разделе о [типах данных](#BKMK_DataTypes).  

#### <a name="BKMK_key-date-time-ctrld-ops"></a> Операции, зависящие от даты и времени

Пока еще не проверенные ключ и ключи с истекшим сроком действия за пределами окна *nbf* / *exp* будут использоваться для операций **расшифровки**, **развертывания** и **проверки** (не будут возвращать код 403, запрещено). Основной причиной использования ключа в состоянии "еще не проверено" является возможность проверить ключ перед использованием в рабочей среде. Основная причина использования ключа в состоянии "истекший срок действия" — возможность выполнения операций восстановления в данных, которые были созданы, когда ключ был допустим. Кроме того, можно отключить доступ к ключу с помощью политик Key Vault или изменения значения атрибута ключа *enabled* на **false**.

Дополнительные сведения о типах данных см. в [этом разделе](#BKMK_DataTypes).

Дополнительные сведения о других возможных атрибутах см. в разделе о [веб-ключе JSON (JWK)](http://tools.ietf.org/html/draft-ietf-jose-json-web-key).

### <a name="BKMK_Keytags"></a> Теги ключей

В форме тегов можно указать дополнительные метаданные для конкретного приложения. Azure Key Vault поддерживает до 15 тегов, каждый из которых может иметь имя и значение длиной 256 символов.  

>[!Note]
>Теги могут быть прочитаны вызывающим объектом, если он имеет разрешения *list* или *get* на такие типы объектов: ключи, секреты или сертификаты.

###  <a name="BKMK_KeyAccessControl"></a> Контроль доступа к ключам

Контроль доступа к ключам, управляемым Key Vault, предоставляется на уровне хранилища ключей, которое выступает в роли контейнера ключей. Существует политика управления доступом к ключам, отличная от политики управления доступом к секретам в том же Key Vault. Пользователи могут создать одно или несколько хранилищ для хранения ключей и должны поддерживать соответствующую сценарию сегментацию и управление ключами. Контроль доступа к ключам не зависит от контроля доступа к секретам.  

Следующие разрешения могут быть предоставлены на каждого пользователя или субъект-службу в записи управления доступом к ключам в хранилище. Эти разрешения точно отражают операции, разрешенные для объекта ключа:  

-   *create*. Создание ключей.
-   *get*. Чтение открытой части ключа и его атрибутов.
-   *list*. Вывод списка ключей или версий ключа, хранимых в хранилище ключей.
-   *update*. Обновление атрибутов ключей.
-   *delete*. Удаление объектов ключей.
-   *sign*. Использование ключа для подписи хэш-кодов.
-   *verify*. Использование ключа для проверки хэш-кодов.
-   *wrapKey*. Использование ключа для защиты симметричного ключа.
-   *unwrapKey*. Использование ключа для снятия защиты с упакованных симметричных ключей.
-   *encrypt*. Использование ключа для защиты произвольной последовательности байтов.
-   *decrypt*. Использование ключа для снятия защиты с последовательности байтов.
-   *import*. Импорт ключа в хранилище ключей.
-   *backup*. Архивация ключа в хранилище ключей.
-   *restore*. Восстановление заархивированного ключа в хранилище ключей.
-   *all*. Все разрешения.

## <a name="key-vault-secrets"></a>Секреты Key Vault 

###  <a name="BKMK_WorkingWithSecrets"></a> Работа с секретами

Секреты в Azure Key Vault представляют собой последовательности октетов максимальным размером 25 КБ каждый. Служба Azure Key Vault не предоставляет никакой семантики для секретов. Она просто принимает данные, шифрует и сохраняет их, возвращая идентификатор секрета, "id", который может использоваться, чтобы получить секрет позже.  

Клиентам следует рассмотреть дополнительные уровни защиты конфиденциальных данных, которые хранятся в Azure Key Vault. Например, предварительное шифрование данных с помощью отдельного ключа защиты.  

Azure Key Vault также поддерживает поле contentType для секретов. Клиенты могут указать тип содержимого, contentType, секрета, чтобы помочь в интерпретации данных секрета при извлечении. Максимальная длина этого поля — 255 символов. Предварительно определенные значения отсутствуют. Предлагаемое использование — это подсказка для интерпретации данных секрета. Например, реализация может сохранить пароли и сертификаты как секреты, а затем использовать это поле для их распознания. Предварительно определенные значения отсутствуют.  

###  <a name="BKMK_SecretAttrs"></a> Атрибуты секретов

В дополнение к секретным данным можно указать следующие атрибуты:  

- *exp*. Необязательный атрибут со значением в формате IntDate, значение по умолчанию — **forever**. Атрибут *exp* (время окончания срока действия) определяет срок действия, в течение или после которого данные секрета НЕ ДОЛЖНЫ быть получены, за исключением [определенных ситуаций](#BKMK_secret-date-time-ctrld-ops). Это поле предназначено для **информационных** целей только потому, что оно информирует пользователей службы хранилища ключей, что конкретный секрет не может использоваться. Нужно указать число, содержащее значение IntDate.   
- *nbf*. Необязательный атрибут со значением в формате IntDate, значение по умолчанию — **now**. Атрибут *nbf* (не ранее) определяет время, до которого данные секрета НЕ ДОЛЖНЫ быть получены, за исключением [определенных ситуаций](#BKMK_secret-date-time-ctrld-ops). Это поле предназначено только для **информационных** целей. Нужно указать число, содержащее значение IntDate. 
- *enabled*. Необязательный атрибут с логическим значением, по умолчанию — **true**. Этот атрибут указывает, можно ли извлечь данные секрета. Атрибут enabled используется совместно с *exp* при возникновении операции между ним и exp. Она будет разрешена, только если атрибут enabled имеет значение **true**. Операции вне окон *nbf* и *exp* автоматически запрещаются, за исключением [определенных ситуаций](#BKMK_secret-date-time-ctrld-ops).  

Есть дополнительные атрибуты только для чтения, которые включены в любой ответ, который содержит атрибуты секрета:  

- *created*. Необязательный атрибут со значением в формате IntDate. Атрибут created указывает, когда была создана эта версия секрета. Это значение равно NULL для секретов, созданных перед добавлением данного атрибута. Нужно указать число, содержащее значение IntDate.  
- *updated*. Необязательный атрибут со значением в формате IntDate. Атрибут updated указывает, когда была обновлена эта версия секрета. Это значение равно NULL для секретов, которые в последний раз обновлялись перед добавлением данного атрибута. Нужно указать число, содержащее значение IntDate.

#### <a name="BKMK_secret-date-time-ctrld-ops"></a> Операции, зависящие от даты и времени

Операцию **получения** секрета можно применять для еще не проверенных секретов и просроченных секретов за пределами окна *nbf* / *exp*. Вызов операции секрета **get** для еще не проверенных секретов может использоваться для тестирования. Извлечение (**получение**) просроченного секрета может использоваться в операциях восстановления.

Дополнительные сведения о типах данных см. в [этом разделе](#BKMK_DataTypes).  

###  <a name="BKMK_SecretAccessControl"></a> Контроль доступа к секретам

Контроль доступа к секретам, управляемым в Azure Key Vault, предоставляется на уровне хранилища ключей, которое выступает в роли контейнера этих секретов. Существует политика управления доступом к секретам, отличная от политики управления доступом к ключам в том же Key Vault. Пользователи могут создать одно или несколько хранилищ для хранения секретов и должны поддерживать соответствующую сценарию сегментацию и управление секретами. Контроль доступа к секретам не зависит от контроля доступа к ключам.  

Следующие разрешения могут использоваться на уровне субъекта в записи управления доступом к секретам в хранилище. Они практически точно отражают операции, разрешенные в объекте секрета.  

-   *set*. Создание секретов.  
-   *get*. Чтение секрета.  
-   *list*. Вывод списка секретов или их версий, хранимых в Key Vault.  
-   *delete*. Удаление секрета.  
-   *all*. Все разрешения.  

Дополнительные сведения о работе с секретами см. в [справочнике по работе с Azure Key Vault с помощью REST API](/rest/api/keyvault).  

###  <a name="BKMK_SecretTags"></a> Теги секретов  
В форме тегов можно указать дополнительные метаданные для конкретного приложения. Azure Key Vault поддерживает до 15 тегов, каждый из которых может иметь имя и значение длиной 256 символов.  

>[!Note]
>Теги могут быть прочитаны вызывающим объектом, если он имеет разрешения *list* или *get* на такие типы объектов: ключи, секреты или сертификаты.

## <a name="key-vault-certificates"></a>Сертификаты Key Vault

Поддержка сертификатов хранилища ключей не только позволяет управлять сертификатами x509, но и предоставляет следующие возможности.  

-   Владелец сертификата может создать сертификат при создании хранилища ключей или импорте существующего сертификата. Это применимо как для самозаверяющих сертификатов, так и для сертификатов, созданных центром сертификации.
-   Владелец сертификата хранилища ключей может безопасно хранить сертификаты X509 и управлять ими без необходимости использовать закрытый ключ.  
-   Владелец сертификата может создать политику, которая определяет для хранилища ключей параметры управления жизненным циклом сертификата.  
-   Владелец сертификата может предоставить контактные данные для получения уведомлений о таких событиях жизненного цикла, как истечение срока действия и обновление сертификата.  
-   Автоматическое обновление с возможностью выбора издателей сертификатов хранилища ключей — партнерских поставщиков сертификатов X509 и центров сертификации.

>[!Note]
>Также разрешено использовать сертификаты, которые предоставляют поставщики и центры, не являющиеся партнерами. Но в таком случае функция автоматического обновления недоступна.

###  <a name="BKMK_CompositionOfCertificate"></a> Создание сертификатов

Когда создается сертификат Key Vault, адресуемые ключ и секрет также создаются с тем же именем. Ключ Key Vault разрешает операции с ключами, а секрет Key Vault позволяет извлечь значение сертификата в виде секрета. Сертификат Key Vault также содержит открытые метаданные сертификата x509.  

Идентификатор и версия сертификатов аналогичны этим объектам у ключей и секретов. Определенная версия адресуемого ключа и секрета, созданная с помощью версии сертификата Key Vault, доступна в ответе сертификата Key Vault.
 
![Сертификаты представляют собой составные объекты.](media/azure-key-vault.png)

###  <a name="BKMK_CertificateExportableOrNonExportableKey"></a> Доступный или недоступный для экспорта ключ

Созданный сертификат Key Vault может быть извлечен из адресуемого секрета с помощью закрытого ключа в формате PFX или PEM, если политика, используемая для создания сертификата, указывает, что ключ доступен для экспорта. Если политика, используемая для создания сертификата Key Vault, указывает, что ключ недоступен для экспорта, тогда закрытый ключ не будет частью значения при извлечении в качестве секрета.  

Адресуемый ключ становится более релевантным с недоступными для экспорта сертификатами Key Vault. Операции с адресуемыми ключами Key Vault сопоставляются из поля *keyusage* политики сертификата Key Vault, используемой для его создания.  

С сертификатом поддерживается два типа ключей: *RSA* или *RSA HSM*. Для экспорта доступен только ключ RSA, но не RSA HSM.  

###  <a name="BKMK_CertificateAttributesAndTags"></a> Атрибуты и теги сертификата

Помимо метаданных сертификата, адресуемых ключа и секрета, сертификат Key Vault также содержит атрибуты и теги.  

#### <a name="attributes"></a>Атрибуты

Атрибуты сертификатов зеркально отражают атрибуты адресуемых ключей и секретов, созданные вместе с сертификатом Key Vault.  

Сертификат Key Vault имеет следующие атрибуты:  

-   *enabled*. Необязательный атрибут с логическим значением, по умолчанию — **true**. Этот атрибут можно задать для указания возможности извлечь данные сертификата в виде секрета или использовать их в качестве ключа. Он используется совместно с *nbf* и *exp* при возникновении операции между *nbf* и *exp*. Она будет разрешена, только если атрибут enabled имеет значение true. Операции вне окна *nbf* и *exp* автоматически запрещаются.  

Есть дополнительные атрибуты только для чтения, которые включены в ответ:

-   *created*. Указывает, когда была создана эта версия сертификата. Значение в формате IntDate.  
-   *updated*. Указывает, когда была обновлена эта версия сертификата. Значение в формате IntDate.  
-   *exp*. Содержит значение даты истечения срока действия сертификата x509. Значение в формате IntDate.  
-   *nbf*. Содержит значение даты сертификата x509. Значение в формате IntDate.  

> [!Note] 
> Если срок действия сертификата в Key Vault истекает, адресуемый ключ и секрет становятся неработоспособными.  

#### <a name="tags"></a>Теги

 Клиент указал словарь пар значений и ключей, аналогичный тегам в ключах и секретах.  

 > [!Note]
> Теги могут быть прочитаны вызывающим объектом, если он имеет разрешения *list* или *get* на такие типы объектов: ключи, секреты или сертификаты.

###  <a name="BKMK_CertificatePolicy"></a> Политика сертификата

Политика сертификата содержит сведения о способах создания сертификатов Key Vault и управления их жизненным циклом. При импорте сертификата с закрытым ключом в хранилище ключей создается политика по умолчанию путем чтения сертификата x509.  

При создании сертификата Key Vault с нуля необходимо предоставить политику для Key Vault, чтобы проинформировать его о том, как создать эту или следующую версию сертификата Key Vault. После того как политика была создана, при последующих операциях создания не требуется создавать следующие версии сертификатов Key Vault.  

Есть только один экземпляр политики для всех версий сертификата Key Vault.  

На высоком уровне политика сертификата содержит следующие элементы:  

-   Свойства сертификата X509. Это имя субъекта, альтернативные имена субъекта и т. д. Используются для создания запроса на сертификат x509.  
-   Свойства ключей. Это поля типа ключа, длины ключа, доступности для экспорта и повторного использования ключа. Эти поля инструктируют хранилище ключей о том, как создать ключ.  
-   Свойства секрета. Это такие свойства, как тип содержимого адресуемого секрета для создания значения секрета, а также для извлечения сертификата в качестве секрета.  
-   Действия на протяжении времени существования. Это соответствующие действия для сертификата Key Vault. Каждое такое действие содержит:  

     - Триггер. Указывается с помощью дней до истечения срока действия или процента времени существования.  

     - Действие. Указывается тип действия: *emailContacts* или *autoRenew*.  

-   Издатель. Параметры, касающиеся издателя сертификата, который выдает сертификаты x509.  
-   Атрибуты политики. Атрибуты, связанные с политикой.  

#### <a name="x509-to-key-vault-usage-mapping"></a>Сопоставление использования параметров X509 и операций Key Vault

В следующей таблице представлено сопоставление политики использования ключа x509 с эффективными операциями с ключами, созданными как часть создания сертификата Key Vault.

|**Параметры использования ключей X509**|**Операции с ключами Key Vault**|**Поведение по умолчанию**|
|----------|--------|--------|
|DataEncipherment|шифрование, расшифровка| Недоступно |
|DecipherOnly|расшифровка| Недоступно  |
|DigitalSignature|подпись, проверка| Key Vault по умолчанию не имеет определения использования при создании сертификата | 
|EncipherOnly|encrypt| Недоступно |
|KeyCertSign|подпись, проверка|Недоступно|
|KeyEncipherment|упаковка и разворачивание ключа| Key Vault по умолчанию не имеет определения использования при создании сертификата | 
|NonRepudiation|подпись, проверка| Недоступно |
|crlsign|подпись, проверка| Недоступно |

###  <a name="BKMK_CertificateIssuer"></a> Издатель сертификата

Объект сертификата Key Vault содержит конфигурацию, используемую для обмена данными с выбранным поставщиком издателей сертификатов для заказа сертификатов x509.  

-   Key Vault сотрудничает со следующими поставщиками издателей для SSL-сертификатов.

|**Имя поставщика**|**Расположения**|
|----------|--------|
|DigiCert;|Поддерживается во всех расположениях службы хранилища ключей в общедоступном облаке и в Azure для государственных организаций|
|GlobalSign;|Поддерживается во всех расположениях службы хранилища ключей в общедоступном облаке и в Azure для государственных организаций|

Перед созданием издателя сертификата в Key Vault необходимо выполнить приведенные ниже обязательные шаги 1 и 2.  

1. Подключение к поставщикам центра сертификации (ЦС).  

    -   Администратор организации должен подключить свою компанию (например, Contoso) хотя бы к одному поставщику ЦС.  

2. Администратор создает учетные данные инициатора запроса, чтобы зарегистрировать (и обновить) SSL-сертификаты в Key Vault.  

    -   Предоставляет конфигурацию, используемую для создания объекта издателя поставщика в хранилище ключей.  

Дополнительные сведения о создании объектов издателя на портале сертификатов см. в [записи блога по сертификатам Key Vault](http://aka.ms/kvcertsblog).  

Key Vault позволяет создать несколько объектов издателей с различной конфигурацией поставщиков издателей. После создания объекта издателя на его имя можно ссылаться в одной или нескольких политиках сертификата. Ссылка на объект издателя указывает, чтобы Key Vault использовал указанную в этом объекте конфигурацию при запросе сертификата x509 из поставщика ЦС во время создания или обновления сертификата.  

Объекты издателя создаются в хранилище и могут использоваться только с сертификатами в том же хранилище.  

###  <a name="BKMK_CertificateContacts"></a> Контакты сертификатов

Контакты сертификатов содержат контактную информацию для отправки уведомлений, активируемых событиями времени существования сертификата. Информация о контактах совместно используется всеми сертификатами в хранилище ключей. Уведомление отправляется всем контактам, указанным для события, связанного с любым сертификатом в хранилище ключей.  

Если в политике сертификата настроено автоматическое продление, уведомление отправляется для следующих событий.  

-   Перед продлением сертификата.
-   После продления сертификата. Указывает, был ли сертификат успешно продлен или произошла ошибка, требующая продления сертификата вручную.  

 Если для политики сертификата настроено продление вручную (только по электронной почте), тогда уведомление отправляется, когда пришло время продлить сертификат.  

###  <a name="BKMK_CertificateAccessControl"></a> Контроль доступа к сертификату

 Контроль доступа к сертификатам, управляемым Key Vault, предоставляется на уровне хранилища ключей, которое выступает в роли контейнера для этих сертификатов. Существует политика управления доступом к сертификатам, отличная от политики управления доступом к ключам и секретам в том же Key Vault. Пользователи могут создать одно или несколько хранилищ для хранения сертификатов и должны поддерживать соответствующую сценарию сегментацию и управление сертификатами.  

 Следующие разрешения могут использоваться на уровне субъекта в записи управления доступом к секретам в хранилище ключей. Они точно отражают операции, разрешенные в объекте секрета:  

-   *get*. Получение текущей или любой версии сертификата. 
-   *list*. Перечисление текущих сертификатов или версий сертификатов.  
-   *delete*. Удаление сертификата, его политики и всех его версий.  
-   *create*. Создание сертификата Key Vault.  
-   *import*. Импорт материала сертификата в сертификат Key Vault.  
-   *update*. Обновление сертификата.  
-   *managecontacts*. Управление контактами сертификата Key Vault.  
-   *getissuers*. Получение издателей сертификатов.  
-   *listissuers*. Перечисление издателей сертификатов.  
-   *setissuers*. Создание и обновление издателей сертификатов Key Vault.  
-   *deleteissuers*. Удаление издателей сертификатов Key Vault.  
-   *all*. Все разрешения.  

Дополнительные сведения о работе с сертификатами см. в [справочнике по работе с Azure Key Vault с помощью REST API](/rest/api/keyvault). 

## <a name="see-also"></a>См. также

- [Аутентификация, запросы и ответы](authentication-requests-and-responses.md)
- [Версии Key Vault](key-vault-versions.md)
- [Руководство разработчика Azure Key Vault](/azure/key-vault/key-vault-developers-guide)
