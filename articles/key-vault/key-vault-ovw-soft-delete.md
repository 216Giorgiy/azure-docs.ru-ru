---
ms.assetid: 
title: "Обратимое удаление в Azure Key Vault | Документация Майкрософт"
ms.service: key-vault
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.date: 05/10/2017
ms.translationtype: Human Translation
ms.sourcegitcommit: 5e92b1b234e4ceea5e0dd5d09ab3203c4a86f633
ms.openlocfilehash: 2b73fb55384cdcc8db2736557e0efef97b34fc45
ms.contentlocale: ru-ru
ms.lasthandoff: 05/10/2017

---
# <a name="azure-key-vault-soft-delete-feature-overview"></a>Общие сведения о функции обратимого удаления в хранилище ключей Azure

>[!NOTE]
>В этой предварительной версии Azure Key Vault только функция **обратимого удаления** находится на стадии предварительной версии. В целом Azure Key Vault — полностью рабочая служба.

Для этой предварительной версии Azure Key Vault мы опишем восстановление удаленных Key Vault и их объектов, известное также как обратимое удаление. В частности, рассматриваются следующие сценарии:

- Поддержка восстанавливаемого удаления Key Vault.
- Поддержка восстанавливаемого удаления объектов Key Vault (например, ключей, секретов, сертификатов).

## <a name="supporting-interfaces"></a>Поддержка интерфейсов

Функция обратимого удаления изначально доступна через интерфейсы REST, .NET или C# и PowerShell. Дополнительные сведения см.в [документации по Key Vault](https://docs.microsoft.com/azure/key-vault/).

## <a name="scenarios"></a>Сценарии

Azure Key Vault — это отслеживаемые ресурсы, управляемые Azure Resource Manager. Azure Resource Manager также задает четко определенное поведение для удаления, которое требует, чтобы после успешной операции удаления этот ресурс больше не был доступен. Функция обратимого восстановления восстанавливает удаленный объект независимо от того, было ли удаление случайным или преднамеренным.

1. В типичном сценарии пользователь может случайно удалить Key Vault или его объект. Если они будут доступны для восстановления в течение предопределенного периода, пользователь сможет отменить удаление и восстановить свои данные.

2. В другом сценарии несанкционированный пользователь может попытаться удалить Key Vault или его объект, например ключ в хранилище, чтобы нарушить работу компании. Разделение удаления Key Vault или его объектов и удаления базовых данных может использоваться как мера предосторожности, к примеру, для ограничения разрешений на удаление данных другой доверенной ролью. Это фактически требует кворума для операции, которая в противном случае может привести к немедленной потере данных.

### <a name="soft-delete-behavior"></a>Поведение обратимого удаления

В этой предварительной версии операция удаления Key Vault или его объекта — это обратимое удаление, при котором ресурсы сохраняются в течение определенного периода, но при этом они как будто удалены. Затем эта служба предоставляет механизм восстановления удаленного объекта, отменяющий удаление. 

Обратимое удаление — это дополнительная функция Key Vault, которая **не включена по умолчанию** в этом выпуске. Дополнительные сведения о включении обратимого удаления для вашего Key Vault см. в [документации по Key Vault](https://docs.microsoft.com/azure/key-vault/).

### <a name="key-vault-recovery"></a>Восстановление Key Vault

После удаления Key Vault служба создаст прокси-ресурс в рамках подписки, добавив достаточное количество метаданных для восстановления. Прокси-ресурс — это хранимый объект, доступный в том же месте, что и удаленное Key Vault. 

### <a name="key-vault-object-recovery"></a>Восстановление объектов Key Vault

После удаления объекта Key Vault, например ключа, служба переведет его в удаленное состояние, делая его недоступным для любой операции извлечения. В этом состоянии объект Key Vault можно только внести в список, восстановить, принудительно или окончательно удалить. 

В то же время Key Vault запланирует удаление базовых данных удаленного Key Vault или его объекта, чтобы удалить их по истечении предопределенного интервала хранения. Запись DNS, соответствующая хранилищу, также сохраняется в течение этого интервала.

### <a name="soft-delete-retention-period"></a>Период хранения при обратимом удалении

Ресурсы обратимого удаления сохраняются в течение заданного периода времени — 90 дней. 

>[!NOTE]
> Срок хранения для обратимого удаления не настраивается в нашей предварительной версии от 10 мая 2017 года. 

В течение интервала хранения применяются следующие условия:

- Вы можете вести список всех Key Vault и их объектов в состоянии обратимого удаления для вашей подписки, а также просматривать сведения об их удалении и восстановлении.
    - Только пользователи со специальными разрешениями могут вести список удаленных хранилищ. Мы советуем нашим пользователям создать настраиваемую роль с этими разрешениями для управления удаленными хранилищами.
- Хранилище ключей с тем же именем не может быть создано в одном и том же месте. Соответственно, объект хранилища ключей не может быть создан в данном хранилище, если оно содержит объект с тем же именем и находится в удаленном состоянии. 
- Только пользователь со специальными привилегиями может восстановить хранилище ключей или его объект, выполнив команду восстановления на соответствующем прокси-ресурсе.
    - Пользователь, участник настраиваемой роли, у которого есть привилегии создавать хранилище ключей в группе ресурсов, может восстановить хранилище.
- Только пользователь со специальными привилегиями может принудительно удалить хранилище ключей или его объект, выполнив команду удаления на соответствующем прокси-ресурсе.

Если хранилище ключей или его объект не восстановлены, то в конце интервала хранения служба выполнит очистку обратимо удаленного хранилища ключей или его объекта и их содержимого. Удаление ресурса нельзя запланировать повторно.

### <a name="permissioned-purge"></a>Разрешенная очистка

Окончательное удаление и очистку хранилища ключей можно выполнить с помощью операции POST на прокси-ресурсе. Это требует специальных привилегий. Как правило, только владелец подписки может очистить хранилище ключей. Операция POST вызовет немедленное и безвозвратное удаление этого хранилища. 

Исключением является случай, когда подписка Azure была помечена как *неудаляемая*. В этом случае только служба может выполнить фактическое удаление, сделав это запланированно. 




