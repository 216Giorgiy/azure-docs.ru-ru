---
title: Перенести существующие Azure стандартные пространства имен служебной шины уровня "премиум" | Документация Майкрософт
description: Руководство, чтобы разрешить перенос существующих Azure стандартные пространства имен служебной шины уровня "премиум"
services: service-bus-messaging
documentationcenter: ''
author: axisc
manager: darosa
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/18/2019
ms.author: aschhab
ms.openlocfilehash: 7b153c36e10f1d4e2be2a0cf42f998c31cb6473a
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "58896586"
---
# <a name="migrate-existing-azure-service-bus-standard-namespaces-to-premium-tier"></a>Перенести существующие Azure стандартные пространства имен служебной шины уровня "премиум"

Ранее служебная шина Azure следующих пространств имен только на уровень "стандартный". Это были настройки нескольких клиентов, которые были оптимизированы для низкой пропускной способности и сред разработки.

В недавнем прошлом служебной шины Azure расширила возможности уровня "премиум", предоставляющая выделенные ресурсы на пространство имен для Прогнозируемая задержка и увеличения пропускной способности по фиксированной цене, которая оптимизирована для высокой пропускной способностью и рабочей среды требовать дополнительные возможности.

Ниже средств включает существующие пространства имен уровня "стандартный" для миграции на уровень "премиум".

>[!WARNING]
> Миграции предназначено для пространства имен служебной шины уровня Standard для ***обновлены*** для уровня "премиум".
>
> Инструментарий переноса ***не*** поддерживает возврат консолей.
>[!NOTE]
> Этот вид миграции предназначен для произойти ***на месте***.
>
> Это означает, что существующие отправителя и получателя приложения не требуют изменения кода или конфигурации.
>
> Существующая строка соединения автоматически укажет новое пространство имен уровня "премиум".
>
> Кроме того, все сущности в стандартное пространство имен, **скопировать** в пространстве имен уровня "премиум" во время процесса миграции.
>
>
> Мы поддерживаем ***1000 сущностей за единицу обмена сообщениями*** на "премиум", поэтому чтобы определить количество единиц обмена сообщениями, необходимые, запустите с числом сущностей, на которые у вас есть на текущем стандартные пространства имен.

## <a name="migration-steps"></a>Этапы миграции

>[!IMPORTANT]
> Существует несколько предостережений, связанный с процессом переноса. Мы рекомендуем полностью ознакомиться с шаги, необходимые для уменьшения возможностей ошибок.

В приведенных ниже руководствах подробно процесс миграции конкретный шаг за шагом.

Ниже перечислены логические этапы процесса-

1. Создайте новое пространство имен уровня "премиум".
2. Пары "стандартный" и "премиум" пространство имен друг с другом.
3. Сущности синхронизации (копирования отработка отказа) "стандартный" от пространства имен уровня "премиум"
4. Фиксировать миграцию
5. Стока сущностей в стандартное пространство имен, используя имя после миграции пространства имен
6. Удаление стандартного пространства имен

>[!NOTE]
> После завершения миграции крайне важно для доступа к старой стандартное пространство имен и очистки очереди и подписки.
>
> После сообщения были остановлены они могут отправляться новое пространство имен уровня "премиум" для обработки приложений получателя.
>
> После потери очередей и подписок рекомендуется удалить старый стандартное пространство имен. Вам не требуется его!

### <a name="migrate-using-azure-cli-or-powershell"></a>Миграция с помощью Azure CLI или PowerShell

Чтобы перенести пространства имен служебной шины уровня Standard для уровня "премиум" с помощью средства Azure CLI или PowerShell, см. ниже руководства.

1. Создайте новое пространство имен служебную шину уровня Premium. Вы можете ссылаться на [шаблонов Azure Resource Manager](service-bus-resource-manager-namespace.md) или [с помощью портала Azure](service-bus-create-namespace-portal.md). Не забудьте выбрать категории «премиум» для **serviceBusSku** параметра.

2. Значение ниже переменные среды для упрощения миграции команды.
   ```
   resourceGroup = <resource group for the standard namespace>
   standardNamespace = <standard namespace to migrate>
   premiumNamespaceArmId = <Azure Resource Manager ID of the Premium namespace to migrate to>
   postMigrationDnsName = <post migration DNS name entry to access the Standard namespace>
   ```

    >[!IMPORTANT]
    > Имя после миграции (post_migration_dns_name) будет использоваться для доступа к старой после миграции стандартное пространство имен. Это необходимо использовать для очистки очереди и подписки, а затем удалить пространство имен.

3. **Пара** пространства имен "стандартный" и "премиум" и **начать синхронизацию** с помощью следующей команды -

    ```
    az servicebus migration start --resource-group $resourceGroup --name $standardNamespace --target-namespace $premiumNamespaceArmId --post-migration-name $postMigrationDnsName
    ```


4. Проверьте состояние миграции с помощью следующей команды -
    ```
    az servicebus migration show --resource-group $resourceGroup --name $standardNamespace
    ```

    Миграция считается завершенной, когда
    * MigrationState = "Active"
    * pendingReplicationsOperationsCount = 0
    * provisioningState = «Succeeded»

    Кроме того, эта команда отображает конфигурацию для переноса. Следует внимательно проверьте, чтобы убедиться, что значения заданы как в предыдущих объявлен.

    Кроме того также проверьте пространство имен уровня "премиум" на портале, чтобы убедиться, что очереди и разделы будут созданы и что они совпадают, что существовали на стандартное пространство имен.

5. Фиксировать миграцию, выполнив следующую команду завершения
   ```
   az servicebus migration complete --resource-group $resourceGroup --name $standardNamespace
   ```

### <a name="migrate-using-azure-portal"></a>Миграция с помощью портала Azure

Миграция на портале Azure имеет одного логического потока как миграция с помощью команд. См. ниже инструкции для процесса шаг за шагом для переноса с помощью портала.

1. Выбрать **«Служба "Миграция" премиум»** пункте меню в меню навигации в левой области. Нажмите кнопку **«Начало»** кнопку, чтобы перейти к следующей странице.
    ![Целевая страница миграции][]

2. Полный **установки**.
   ![Настройка пространства имен][]
   1. Создайте и назначьте для переноса существующих стандартное пространство имен для пространства имен уровня "премиум".
        ![Настройка пространства имен - создание пространства имен уровня "премиум"][]
   2. Выбрать **«После миграции name»** для доступа к стандартное пространство имен, после завершения миграции.
        ![Настройка пространства имен — выбрать имя миграции post][]
   3. Нажмите кнопку **«Далее»** для продолжения.
3. **Синхронизация** сущностей между пространством имен "стандартный" и "премиум".
    ![Настройка пространства имен – синхронизации сущности - start][]

   1. Нажмите кнопку **начать синхронизацию** начинается синхронизация сущностей.
   2. Нажмите кнопку **«Да»** на всплывающее окно, подтверждающее для запуска синхронизации.
   3. Подождите, пока **синхронизации** завершена. Состояние становится доступным в строке состояния.
        ![Пространство имен – синхронизации сущности - ход установки][]
        >[!IMPORTANT]
        > Если вам нужно **прервать** какой-либо причине, см. в статье прерывания потока раздел этого документа.
   4. После завершения синхронизации щелкните **«Далее»** расположенную в нижней части страницы.

4. Просмотрите изменения на странице "Сводка".
    ![Пространство имен switch - меню коммутатора][]

5. Щелкните **«Завершение миграции»** для переключения пространств имен и завершить миграцию.
    ![Пространство имен switch - успех][]

## <a name="faqs"></a>Часто задаваемые вопросы

### <a name="what-happens-when-the-migration-is-committed"></a>Что происходит при фиксации миграции?

После фиксации миграции, строку подключения, на которую указывает стандартное пространство имен будет указывать пространство имен уровня "премиум".

Приложениями отправителя и получателя будет отключиться от стандартного пространства имен и подключиться к пространству имен уровня "премиум", автоматически.

### <a name="what-do-i-do-after-the-standard-to-premium-migration-is-complete"></a>Что следует делать после завершения "стандартный" до уровня "премиум" миграции?

"Стандартный" до уровня "премиум" миграции гарантирует, что метаданные сущности (разделы, подписки, фильтры, т. д.) копируются из стандартного пространства имен уровня "премиум". Данные сообщения, которые были зафиксированы в стандартное пространство имен не копируется из стандартного пространства имен уровня "премиум".

Из-за этого стандартное пространство имен может иметь некоторые сообщения, которые были отправлены и зафиксирована во время миграции был уничтожен. Эти сообщения должны вручную извлечены из стандартного пространства имен и вручную отправляются через пространство имен уровня "премиум".

Чтобы сделать это, вы ***необходимо*** использовать консольное приложение или сценарий, который сток стандартное пространство имен сущностей, с помощью **Post миграции DNS-имя** указан в командах миграции и затем отправить эти сообщения на Пространство имен уровня "премиум", так что они могут обрабатываться получателями.

После сообщения были остановлены, перейдите к удалить стандартное пространство имен.

>[!IMPORTANT]
> Следует учитывать, что после сообщения из стандартного пространства имен были остановлены, вы **необходимо** удалить стандартное пространство имен.
>
> Это важно, так как строка подключения, изначально ссылаются стандартное пространство имен теперь фактически ссылается на пространство имен уровня "премиум". Вам не требуется это стандартное пространство имен больше.
>
> Удаление стандартного пространства имен, что вы перенесли помогает уменьшает путаницы в дальнейшем. 

### <a name="how-much-downtime-do-i-expect"></a>Как долго ожидать?
Описанный выше процесс миграции призвана уменьшить время простоя для приложений. Это делается, используя строку подключения, используйте приложениями отправителя и получателя, чтобы указать новое пространство имен уровня "премиум".

Время простоя, возникающей при работе с приложение ограничено количество времени, необходимое для обновления записи DNS, чтобы она указывала на пространство имен уровня "премиум".

Это может быть предполагается, что ***примерно 5 минут***.

### <a name="do-i-have-to-make-any-configuration-changes-while-performing-the-migration"></a>Нужно ли внести изменения конфигурации во время миграции?
Нет, были внесены изменения кода или конфигурации, не требуется, чтобы выполнить миграцию. Строка подключения, отправителя и получателя приложения используют для доступа к стандартное пространство имен автоматически сопоставляется в качестве **псевдоним** для пространства имен уровня "премиум".

### <a name="what-happens-when-i-abort-the-migration"></a>Что происходит, когда я прервать миграцию?
Миграция может быть прервана, либо с помощью команды «Отмена», либо через портал Azure. 

#### <a name="azure-cli-or-powershell"></a>Azure CLI или PowerShell

    az servicebus migration abort --resource-group $resourceGroup --name $standardNamespace

#### <a name="azure-portal"></a>Портал Azure

![Прервать поток - abort синхронизации][]
![прервать поток - abort завершения][]

При прерывании процесса миграции, он фактически прерывает процесс копирования через сущностей (разделы, подписки и фильтры), "стандартный" от к пространству имен уровня "премиум" и разбивает сопряжение.

Строка подключения **не** указывает пространство имен уровня "премиум". Существующие приложения продолжают работать как перед началом миграции.

Тем не менее он **не** удаление сущностей на пространство имен уровня "премиум" или удалить само пространство имен уровня "премиум". Это должно выполняться вручную, если вы решили дать не переходить к миграции в конце концов.

>[!IMPORTANT]
> Если решено прервать миграцию, удалите пространство имен уровня "премиум", который подготовлен для миграции, таким образом, чтобы не оплачивать ресурсы.

#### <a name="i-dont-want-to-have-to-drain-the-messages-what-do-i-do"></a>Я не хочу завершить сообщения. Что делать?

Возможно, сообщения, отправленные приложения отправителя и зафиксирована в хранилище через стандартное пространство имен во время миграции, и перед началом миграции фиксации.

Учитывая, что во время миграции фактического сообщения/полезных данных не копирования "стандартный" от "премиум", их нужно вручную останавливаются и затем отправляется на пространство имен уровня "премиум".

Тем не менее, если можно перенести в период планового обслуживания или по обслуживанию и не хотите вручную очистки и отправки сообщений, выполните следующие действия —

1. Выйти из приложения отправителя, и получателей для обработки сообщений, которые в настоящее время в стандартное пространство имен и очистки очереди.
2. После очередей и подписок в стандартное пространство имен пусты, выполните процедуру, описанную выше для выполнения миграции "стандартный" от к пространству имен уровня "премиум".
3. После завершения миграции вы можете перезапустить приложения отправителя.
4. Отправителями и получателями теперь автоматически подключится с пространством имен уровня "премиум".

    >[!NOTE]
    > Получатель не должны быть остановлена для миграции.
    >
    > По завершении миграции получатели отключиться от стандартного пространства имен и автоматически подключиться к пространству имен уровня "премиум".

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о [различия между "стандартный" и "премиум" обмена сообщениями](./service-bus-premium-messaging.md)
* Дополнительные сведения о аспекты восстановления высокая доступность и географическая Diaster для служебную шину Premium [здесь](service-bus-outages-disasters.md#protecting-against-outages-and-disasters---service-bus-premium)

[Целевая страница миграции]: ./media/service-bus-standard-premium-migration/1.png
[Настройка пространства имен]: ./media/service-bus-standard-premium-migration/2.png
[Настройка пространства имен - создание пространства имен уровня "премиум"]: ./media/service-bus-standard-premium-migration/3.png
[Настройка пространства имен — выбрать имя миграции post]: ./media/service-bus-standard-premium-migration/4.png
[Настройка пространства имен – синхронизации сущности - start]: ./media/service-bus-standard-premium-migration/5.png
[Пространство имен – синхронизации сущности - ход установки]: ./media/service-bus-standard-premium-migration/8.png
[Пространство имен switch - меню коммутатора]: ./media/service-bus-standard-premium-migration/9.png
[Пространство имен switch - успех]: ./media/service-bus-standard-premium-migration/12.png

[Прервать поток - abort синхронизации]: ./media/service-bus-standard-premium-migration/abort1.png
[Прервать поток - abort завершения]: ./media/service-bus-standard-premium-migration/abort3.png
