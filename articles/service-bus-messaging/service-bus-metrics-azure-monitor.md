---
title: Метрики служебной шины Azure в Azure Monitor (предварительная версия) | Документация Майкрософт
description: Мониторинг сущностей служебной шины с помощью Azure Monitor.
services: service-bus-messaging
documentationcenter: .NET
author: sethmanheim
manager: timlt
ms.service: service-bus-messaging
ms.topic: article
ms.date: 05/31/2018
ms.author: sethm
ms.openlocfilehash: 517c1376415466f5ce0e3c854f6c91f60cdab9f8
ms.sourcegitcommit: 156364c3363f651509a17d1d61cf8480aaf72d1a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/25/2018
ms.locfileid: "39247629"
---
# <a name="azure-service-bus-metrics-in-azure-monitor-preview"></a>Метрики служебной шины Azure в Azure Monitor (предварительная версия)

Метрики служебной шины предоставляют состояние ресурсов в подписке Azure. Используя обширный набор данных метрик, можно оценить общую работоспособность ресурсов служебной шины не только на уровне пространства имен, но также и на уровне сущности. Эти статистические данные могут быть важны, так как они позволяют отслеживать состояние служебной шины. Кроме того, метрики могут помочь в устранении первопричин проблем без необходимости обращения в службу поддержки Azure.

Azure Monitor предоставляет унифицированный пользовательский интерфейс для мониторинга различных служб Azure. Дополнительные сведения см. в разделе [Обзор мониторинга в Microsoft Azure](../monitoring-and-diagnostics/monitoring-overview.md). Ознакомьтесь также с примером [получения данных метрик Azure Monitor с помощью .NET](https://github.com/Azure-Samples/monitor-dotnet-metrics-api) на сайте GitHub.

## <a name="access-metrics"></a>Доступ к метрикам

Azure Monitor предоставляет несколько способов доступа к метрикам. Вы можете использовать [портал Azure](https://portal.azure.com), интерфейсы API Azure Monitor (REST и .NET), а также решения для анализа, например Log Analytics и концентраторы событий. Дополнительные сведения см. в статье [Обзор метрик в Microsoft Azure](../monitoring-and-diagnostics/monitoring-overview-metrics.md#access-metrics-via-the-rest-api).

Метрики включены по умолчанию, и вы можете получить доступ к данным за последние 30 дней. Если необходимо хранить данные метрик в течение длительного периода времени, вы можете архивировать их в учетную запись хранения Azure. Для настройки используйте [параметры диагностики](../monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs.md#diagnostic-settings) в Azure Monitor.

## <a name="access-metrics-in-the-portal"></a>Доступ к метрикам на портале

На [портале Azure](https://portal.azure.com) можно отслеживать метрики в течение продолжительного периода времени. В приведенном ниже примере показано, как просмотреть успешные запросы и входящие запросы на уровне учетной записи.

![][1]

Можно также открыть метрики непосредственно с помощью пространства имен. Для этого выберите нужное пространство имен и щелкните **Metrics (Peview)** (Метрики (предварительная версия)). Чтобы отобразить метрики, отфильтрованные по сущности, выберите сущность и щелкните **Metrics (Peview)** (Метрики (предварительная версия)).

![][2]

Для метрик с поддержкой измерений необходимо выполнить фильтрацию по нужному значению измерения.

## <a name="billing"></a>Выставление счетов

Использование метрик в Azure Monitor осуществляется бесплатно и находится на этапе предварительной версии. Тем не менее, если вы используете дополнительные решения для приема данных метрик, за использование этих решений может взиматься плата. Например, при архивации данных метрик в учетную запись хранения Azure плата будет взиматься службой хранилища Azure, а при потоковой передаче данных метрик в Log Analytics для расширенного анализа плата будет взиматься за использование Log Analytics.

Приведенные ниже метрики позволяют получить общие сведения о работоспособности службы. 

> [!NOTE]
> Несколько метрик стали неподдерживаемыми, так как теперь они доступны под другим именем. Это может потребовать обновления ссылок. Метрики, помеченные ключевым словом "нерекомендуемая", больше не будут поддерживаться.

Все значения метрик ежеминутно отправляются в Azure Monitor. Степень детализации определяет интервал времени, за который представлены значения метрик. Поддерживаемый интервал времени для всех метрик служебной шины составляет 1 минуту.

## <a name="request-metrics"></a>Метрики запросов

Подсчитывают объем данных и количество запросов операций управления.

| Имя метрики | ОПИСАНИЕ |
| ------------------- | ----------------- |
| Incoming Requests (preview) | Число запросов к службе служебной шины за указанный период. <br/><br/> Единица измерения: число <br/> Тип агрегирования: итог <br/> Измерение: EntityName.|
|Successful Requests (preview)|Число успешных запросов к службе служебной шины за указанный период.<br/><br/> Единица измерения: число <br/> Тип агрегирования: итог <br/> Измерение: EntityName.|
|Server Errors (preview)|Число запросов, которые не были обработаны из-за ошибки в службе служебной шины, за указанный период.<br/><br/> Единица измерения: число <br/> Тип агрегирования: итог <br/> Измерение: EntityName.|
|Ошибки пользователей (ознакомьтесь с предварительной версией в следующем подразделе)|Количество запросов, не обработанных из-за ошибки пользователя, за указанный период.<br/><br/> Единица измерения: число <br/> Тип агрегирования: итог <br/> Измерение: EntityName.|
|Throttled Requests (preview)|Число запросов, которые были отрегулированы из-за превышения квоты использования.<br/><br/> Единица измерения: число <br/> Тип агрегирования: итог <br/> Измерение: EntityName.|

### <a name="user-errors"></a>Ошибки пользователей

К ошибкам пользователей относятся следующие два типа ошибок:

1. Ошибки на стороне клиента (в HTTP это ошибки с кодом 400).
2. Ошибки, возникающие при обработке сообщений (например, [MessageLockLostException](/dotnet/api/microsoft.azure.servicebus.messagelocklostexception)).


## <a name="message-metrics"></a>Метрики использования

| Имя метрики | ОПИСАНИЕ |
| ------------------- | ----------------- |
|Incoming Messages (preview)|Количество событий или сообщений, отправленных в служебную шину, за указанный период.<br/><br/> Единица измерения: число <br/> Тип агрегирования: итог <br/> Измерение: EntityName.|
|Outgoing Messages (preview)|Количество событий или сообщений, полученных из служебной шины, за указанный период.<br/><br/> Единица измерения: число <br/> Тип агрегирования: итог <br/> Измерение: EntityName.|

## <a name="connection-metrics"></a>Метрики подключения

| Имя метрики | ОПИСАНИЕ |
| ------------------- | ----------------- |
|ActiveConnections (preview)|Число активных подключений для пространства имен, а также для сущности.<br/><br/> Единица измерения: число <br/> Тип агрегирования: итог <br/> Измерение: EntityName.|
|Connections Opened (preview)|Число открытых подключений.<br/><br/> Единица измерения: число <br/> Тип агрегирования: итог <br/> Измерение: EntityName.|
|Connections Closed (preview)|Число закрытых подключений.<br/><br/> Единица измерения: число <br/> Тип агрегирования: итог <br/> Измерение: EntityName. |

## <a name="resource-usage-metrics"></a>Метрики использования ресурсов

| Имя метрики | ОПИСАНИЕ |
| ------------------- | ----------------- |
|CPU usage per namespace (preview)|Процент использования ЦП для пространства имен.<br/><br/> Единица измерения: % <br/> Тип агрегирования: максимальное значение. <br/> Измерение: EntityName.|
|Memory size usage per namespace (preview)|Процент использования памяти для пространства имен.<br/><br/> Единица измерения: % <br/> Тип агрегирования: максимальное значение. <br/> Измерение: EntityName.|

## <a name="metrics-dimensions"></a>Измерения метрик

Служебная шина Azure поддерживает следующие измерения метрик в Azure Monitor. Добавление измерений для метрик является необязательным. Если не добавить измерения, то метрики указываются на уровне пространства имен. 

|Имя измерения|ОПИСАНИЕ|
| ------------------- | ----------------- |
|EntityName| Служебная шина поддерживает сущности обмена сообщениями в пространстве имен.|

## <a name="next-steps"></a>Дополнительная информация

Ознакомьтесь с разделом [Обзор мониторинга в Microsoft Azure](../monitoring-and-diagnostics/monitoring-overview.md).

[1]: ./media/service-bus-metrics-azure-monitor/service-bus-monitor1.png
[2]: ./media/service-bus-metrics-azure-monitor/service-bus-monitor2.png


