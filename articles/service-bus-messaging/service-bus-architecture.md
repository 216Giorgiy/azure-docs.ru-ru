---
title: "Обзор архитектуры обработки сообщений служебной шины Azure | Документация Майкрософт"
description: "Здесь описывается архитектура обработки сообщений и запросов на ретрансляцию, которая используется служебной шиной Azure."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: baf94c2d-0e58-4d5d-a588-767f996ccf7f
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/18/2017
ms.author: sethm
ms.translationtype: Human Translation
ms.sourcegitcommit: 8f987d079b8658d591994ce678f4a09239270181
ms.openlocfilehash: ced46c64c1c105aa987759e05ab3680bc399f9a0
ms.contentlocale: ru-ru
ms.lasthandoff: 05/18/2017


---
# <a name="service-bus-architecture"></a>Архитектура служебной шины
В этой статье описывается архитектура обработки сообщений, которая используется служебной шиной Azure.

## <a name="service-bus-scale-units"></a>Единицы масштабирования служебной шины
Содержимое служебной шины упорядочено по *единицам масштабирования*. Единица масштабирования — это единица развертывания, которая содержит все компоненты, необходимые для запуска службы. Для каждой области развертывается одна или несколько единиц масштабирования служебной шины.

С единицей масштабирования сопоставляется пространство имен служебной шины. Единица масштабирования обрабатывает все типы сущностей служебной шины: ретрансляторы и элементы обмена сообщениями через брокер (очереди, разделы, подписки). Единица масштабирования служебной шины состоит из следующих компонентов.

* **Набор узлов шлюза.** Узлы шлюза проверяют подлинность входящих запросов и обрабатывают запросы на ретрансляцию. У каждого узла шлюза есть общедоступный IP-адрес.
* **Набор узлов брокера сообщений.** Узлы брокера сообщений обрабатывают запросы к сущностям обмена сообщениями.
* **Единое хранилище шлюза.** Хранилище шлюза содержит данные по каждой сущности, определенной в соответствующей единице масштабирования. Хранилище шлюза реализуется на основе базы данных SQL Azure.
* **Несколько хранилищ сообщений.** Хранилища сообщений содержат сообщения из всех очередей, разделов и подписок, определенных в соответствующей единице масштабирования. Здесь же хранятся все данные подписки. Если не включить [секционированные сущности обмена сообщениями](service-bus-partitioning.md), очередь или раздел будут сопоставлены с одним хранилищем сообщений. Подписки хранятся в том же хранилище сообщений, что и соответствующий родительский раздел. Хранилища сообщений реализуются поверх баз данных SQL Azure (это не касается [обмена сообщениями через служебную шину категории "Премиум"](service-bus-premium-messaging.md)).

## <a name="containers"></a>Контейнеры
Каждой сущности обмена сообщениями назначается определенный контейнер. Контейнер — это логическая конструкция, которая использует одно единственное хранилище сообщений для хранения всех соответствующих данных в этом контейнере. Каждый контейнер назначается узлу брокера сообщений. Обычно контейнеров больше, чем узлов брокера сообщений. Таким образом, каждый узел брокера сообщений загружает несколько контейнеров. Контейнеры назначаются узлу брокера сообщений таким образом, чтобы все узлы брокера сообщений были загружены в равной мере. Если шаблон нагрузки меняется (например, один из контейнеров загружается слишком сильно) или узел брокера сообщений становится временно недоступным, контейнеры перераспределяются между узлами брокера сообщений.

## <a name="processing-of-incoming-messaging-requests"></a>Обработка входящих запросов обмена сообщениями
Когда клиент отправляет запрос на служебную шину, подсистема балансировки нагрузки Azure передает его в один из узлов шлюза. Узел шлюза авторизует запрос. Если запрос относится к сущности обмена сообщениями (очереди, разделу или подписке), узел шлюза выполняет поиск этой сущности в хранилище шлюза и определяет, в каком хранилище сообщений она находится. Затем он определяет, какой узел брокера сообщений обслуживает данный контейнер в настоящий момент, и отправляет запрос на этот узел брокера сообщений. Узел брокера сообщений обрабатывает запрос и обновляет состояние сущности в хранилище контейнера. Узел брокера сообщений отправляет ответ обратно на узел шлюза, который пересылает соответствующий ответ клиенту, отправившему исходный запрос.

![Обработка входящих запросов обмена сообщениями](./media/service-bus-architecture/ic690644.png)

## <a name="processing-of-incoming-relay-requests"></a>Обработка входящих запросов на ретрансляцию
Когда клиент отправляет запрос [ретранслятору Azure](/azure/service-bus-relay/), подсистема балансировки нагрузки Azure передает его в один из узлов шлюза. Если запрос связан с прослушиванием, узел шлюза создает новую ретрансляцию. Если запрос связан с подключением к определенной ретрансляции, узел шлюза переадресовывает его на узел шлюза, которому принадлежит ретрансляция. Узел шлюза, которому принадлежит ретрансляция, отправляет запрос о подключении клиенту прослушивания, чтобы прослушиватель создал временный канал к узлу шлюза, получившему запрос на подключение.

Как только подключение ретрансляции будет установлено, клиенты смогут обмениваться сообщениями через узел шлюза, используемый для связи.

![Обработка входящих запросов ретранслятора WCF](./media/service-bus-architecture/ic690645.png)

## <a name="next-steps"></a>Дальнейшие действия
Теперь, когда вы прочитали общие сведения об архитектуре служебной шины, воспользуйтесь следующими ссылками, чтобы получить дополнительные сведения:

* [Основные сведения об обмене сообщениями через служебную шину](service-bus-messaging-overview.md)
* [Что такое ретранслятор Azure?](../service-bus-relay/relay-what-is-it.md)
* [Базовая информация о служебной шине](service-bus-fundamentals-hybrid-solutions.md)
* [Решение для обмена сообщениями в очередях с помощью очередей служебной шины](service-bus-dotnet-multi-tier-app-using-service-bus-queues.md)



