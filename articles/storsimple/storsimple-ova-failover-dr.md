---
title: "Аварийное восстановление и отработка отказа устройства для виртуального массива StorSimple"
description: "Дополнительные сведения об отработке отказа виртуального массива StorSimple."
services: storsimple
documentationcenter: NA
author: alkohli
manager: carmonm
editor: 
ms.assetid: 94a8c3db-8e47-4e9a-917a-29b14a9263aa
ms.service: storsimple
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/07/2016
ms.author: alkohli
translationtype: Human Translation
ms.sourcegitcommit: 219dcbfdca145bedb570eb9ef747ee00cc0342eb
ms.openlocfilehash: 67cdf4e3d8e81d2ea419603918a3204dc6860ae7


---
# <a name="disaster-recovery-and-device-failover-for-your-storsimple-virtual-array"></a>Аварийное восстановление и отработка отказа устройства для виртуального массива StorSimple
## <a name="overview"></a>Обзор
В этой статье описывается аварийное восстановление виртуального массива Microsoft Azure StorSimple (который также называется локальным виртуальным устройством StorSimple) и приведены подробные инструкции по отработке отказа с переносом на другое виртуальное устройство при аварии. Отработка отказа позволяет перенести данные c *исходного* устройства в центре обработки данных на *целевое* устройство, которое находится в том же или другом географическом расположении. Отработка отказа выполняется для всего устройства. При отработке отказа изменяется владелец облачных данных. После переноса они будут принадлежать владельцу целевого устройства.

Управление отработкой отказа устройства осуществляется с помощью функции аварийного восстановления и инициируется на странице **Устройства** . На этой странице показаны все устройства StorSimple, подключенные к службе диспетчера StorSimple. Для каждого устройства отображается понятное имя, состояние, выделенная и максимальная емкость, а также тип и модель.

![](./media/storsimple-ova-failover-dr/image15.png)

Эта статья относится только к виртуальным массивам StorSimple. Чтобы выполнить отработку отказа для устройств серии 8000, см. сведения в статье [Отработка отказа и аварийное восстановление для устройства StorSimple](storsimple-device-failover-disaster-recovery.md).

## <a name="what-is-disaster-recovery"></a>Что такое аварийное восстановление?
В сценарии аварийного восстановления основное устройство прекращает функционировать. В этой ситуации можно переместить облачные данные, связанные с вышедшим из строя устройством, на другое устройство, используя основное устройство в качестве *источника* и указав другое устройство в качестве *целевого объекта*. Этот процесс называется *отработка отказа*. Во время отработки отказа меняется владелец томов или общих папок с исходного устройства, а сами они перемещаются на целевое устройство. Фильтрация данных запрещена.

Аварийное восстановление моделируется как полное восстановление устройства с распределением по уровням и отслеживанием на основе тепловой карты. Тепловая карта определяется путем присвоения данным значения уровня активности на основе шаблонов чтения и записи. Затем эта тепловая карта распределяет блоки данных нижнего уровня активности в облаке, сохраняя блоки данных высокого уровня активности (самые используемые) на локальном уровне. Во время аварийного восстановления тепловая карта используется для восстановления данных из облака и их повторного заполнения. Устройство извлекает все тома или общие папки из последней резервной копии (согласно внутреннему определению) и использует ее для восстановления. Управление всем процессом аварийного восстановления лежит на самом устройстве.

## <a name="prerequisites-for-device-failover"></a>Предварительные требования для отработки отказа устройства
### <a name="prerequisites"></a>Предварительные требования
При любой отработке отказа устройства должны быть выполнены следующие предварительные требования:

* Исходное устройство должно находиться в состоянии **Отключено** .
* На классическом портале Azure для целевого устройства должно отображаться состояние **Активное** . Понадобится подготовить целевое виртуальное устройство такой же или более высокой емкости. Затем следует использовать локальный пользовательский веб-интерфейс для настройки и успешной регистрации виртуального устройства.
  
  > [!IMPORTANT]
  > Не пытайтесь настроить зарегистрированное виртуальное устройство в службе, щелкнув **Завершить настройку устройства**. Не следует выполнять конфигурацию устройства в службе.
  > 
  > 
* Исходное и целевое устройство должны быть одного типа. Отработку отказа виртуального устройства, настроенного в качестве файлового сервера, можно выполнить только с переносом на другой файловый сервер. То же самое касается и сервера iSCSI.
* При аварийном восстановлении файлового сервера рекомендуется присоединить целевое устройство к тому же домену, на котором находится исходное устройство. Это предотвратит конфликт разрешений общих папок. В этом выпуске поддерживается отработка отказа с переносом только в целевое устройство в том же домене.

### <a name="other-considerations"></a>Дополнительные рекомендации
* Рекомендуется перевести все тома или общие папки на исходном устройстве в автономный режим.
* При выполнении плановой отработки отказа рекомендуется выполнить резервное копирование устройства и продолжить отработку отказа. Это позволит свести потерю данных к минимуму. При выполнении внеплановой отработки отказа для восстановления устройства будет использована последняя резервная копия.
* Целевыми устройствами, доступными для аварийного восстановления, считаются устройства с такой же емкостью как у исходного устройства или более высокой. подключенные к службе устройства, на которых недостаточно пространства, не будут доступны в качестве целевых устройств.

### <a name="dr-prechecks"></a>Предварительные проверки при аварийном восстановлении
До начала аварийного восстановления на устройстве выполняются предварительные проверки. Они позволяют предотвратить ошибки после начала аварийного восстановления. Выполняются следующие предварительные проверки:

* проверка учетной записи хранения;
* проверка подключения облака к Azure;
* проверка доступного места на целевом устройстве;
* проверка наличия допустимых имен ACR, IQN (не более 220 символов в длину) и пароля CHAP (12–16 символов в длину), связанных с томами, на исходном устройстве сервера iSCSI.

Если одна из этих проверок завершится сбоем, продолжить аварийное восстановление нельзя. Необходимо устранить эти проблемы, а затем выполнить аварийное восстановление повторно.

После успешного завершения аварийного восстановления права владения облачными данными на исходном устройстве переходят к целевому устройству. С этого момента исходное устройство становится недоступным на портале. Доступ ко всем томам и общим папкам на исходном устройстве блокируется, а целевое устройство становится активным.

> [!IMPORTANT]
> Хотя устройство больше недоступно, виртуальная машина, подготовленная в главной системе, по-прежнему потребляет ресурсы. После успешного завершения аварийного восстановления ее можно удалить из главной системы.
> 
> 

## <a name="fail-over-to-a-virtual-array"></a>Отработка отказа на виртуальный массив
Перед выполнением этой процедуры рекомендуется подготовить виртуальный массив StorSimple, настроить его с помощью локального пользовательского веб-интерфейса и зарегистрировать в службе диспетчера StorSimple.

> [!IMPORTANT]
> * Запрещено выполнять отработку отказа устройства серии StorSimple 8000 с переносом на виртуальное устройство серии 1200.
> * Можно выполнить отработку отказа из виртуального устройства с поддержкой FIPS (федеральный стандарт обработки информации), развернутого на портале для государственных организаций, в виртуальное устройство на классическом портале Azure. Или наоборот.
> 
> 

Вот как можно восстановить устройство на целевом виртуальном устройстве StorSimple.

1. Переведите тома и общие папки на узле в автономный режим. Для этого см. инструкции для конкретной операционной системы на узле. Если все тома и общие папки на устройстве не переведены в автономный режим, сделайте это, выбрав **Устройства > Общие папки** (или **Устройства > Тома**). Выберите общую папку или том и щелкните **Отключить** в нижней части страницы. При появлении запроса на подтверждение нажмите кнопку **Да**. Повторите эту процедуру для всех общих папок или томов на устройстве.
2. На странице **Устройства** выберите исходное устройство для отработки отказа и щелкните **Отключить**. 
    ![](./media/storsimple-ova-failover-dr/image16.png)
3. После этого введите подтверждение для применения этих исправлений. Операция отключения необратимая. Кроме того, отобразится напоминание о том, что нужно перевести общие папки или тома на узле в автономный режим.
   
    ![](./media/storsimple-ova-failover-dr/image18.png)
4. После подтверждения начнется процесс отключения. После успешного отключения отобразится соответствующее уведомление.
   
    ![](./media/storsimple-ova-failover-dr/image19.png)
5. На странице **Устройства** состояние устройства изменится на **Отключено**.
   
    ![](./media/storsimple-ova-failover-dr/image20.png)
6. Выберите отключенное устройство и в нижней части страницы щелкните **Отработка отказа**.
7. В открывшемся мастере подтверждения отработки отказа выполните следующее:
   
   1. В раскрывающемся списке доступных устройств выберите **Целевое устройство**. В этом списке отображаются только устройства с достаточной емкостью.
   2. Просмотрите сведения, связанные с исходным устройством, такие как имя устройства, общая емкость и имена общих папок, для которых будет выполнена отработка отказа.
      
       ![](./media/storsimple-ova-failover-dr/image21.png)
8. Установите флажок **Мне известно, что отработка отказа — это необратимая операция и после ее успешного выполнения исходное устройство будет удалено**.
9. Щелкните значок галочки ![](./media/storsimple-ova-failover-dr/image1.png).
10. Запустится задание отработки отказа и отобразится соответствующее уведомление. Щелкните **Просмотреть задание** , чтобы следить за ходом выполнения отработки отказа.
    
     ![](./media/storsimple-ova-failover-dr/image22.png)
11. На странице **Задания** будет создано задание отработки отказа для исходного устройства. Это задание выполняет предварительные проверки при аварийном восстановлении.
    
    ![](./media/storsimple-ova-failover-dr/image23.png)
    
     После успешного выполнения предварительных проверок при аварийном восстановлении задание отработки отказа запустит задания восстановления для каждой общей папки или каждого тома на исходном устройстве.
    
    ![](./media/storsimple-ova-failover-dr/image24.png)
12. После завершения отработки отказа, перейдите на страницу **Устройства** .
    
    а. Выберите виртуальное устройство StorSimple, используемое в качестве целевого устройства для отработки отказа.
    
    b. Перейдите на страницу **Общие папки** (или **Тома** для сервера iSCSI). Теперь должны отображаться все общие папки (тома) старого устройства.
    
    ![](./media/storsimple-ova-failover-dr/image25.png)

![](./media/storsimple-ova-failover-dr/video_icon.png) **Доступно видео**

В этом видео показано, как можно выполнить отработку отказа локального виртуального устройства StorSimple с переносом на другое виртуальное устройство.

> [!ВИДЕО https://channel9.msdn.com/Blogs/Windows-Azure/StorSimple-Virtual-Array-Disaster-Recovery/player]
> 
> 

## <a name="business-continuity-disaster-recovery-bcdr"></a>Аварийное восстановление непрерывности бизнеса (BCDR)
Сценарий аварийного восстановления непрерывности бизнеса (BCDR) реализуется, когда весь центр обработки данных Azure прекращает работу. Это может повлиять на службу диспетчера StorSimple и связанные устройства StorSimple.

Если есть устройства StorSimple, зарегистрированные непосредственно перед сбоем, возможно, их потребуется удалить. После аварии можно повторно создать и настроить эти устройства.

## <a name="errors-during-dr"></a>Ошибки во время аварийного восстановления
**Сбой подключения к облаку во время аварийного восстановления**

Если после запуска аварийного восстановления и до завершения восстановления устройства будет прервано подключение к облаку, произойдет сбой и отобразится соответствующее уведомление. После этого целевое устройство, использованное для аварийного восстановления, будет помечено как *непригодное для использования*. Его нельзя будет использовать для аварийного восстановления в дальнейшем.

**Нет совместимых целевых устройств**

Если на доступных целевых устройствах недостаточно места, появится ошибка, указывающая на отсутствие совместимых целевых устройств.

**Сбои предварительных проверок**

Если одна из предварительных проверок не выполнена, произойдет сбой предварительной проверки.

## <a name="next-steps"></a>Дальнейшие действия
Узнайте, как осуществлять [администрирование виртуального массива StorSimple, используя локальный пользовательский веб-интерфейс](storsimple-ova-web-ui-admin.md).




<!--HONumber=Nov16_HO3-->


