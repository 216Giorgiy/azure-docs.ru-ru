---
title: "Настройка StorSimple с помощью Veritas NetBackup | Документация Майкрософт"
description: "Описание настройки целевого объекта архивации StorSimple с помощью Veritas NetBackup."
services: storsimple
documentationcenter: 
author: hkanna
manager: matd
editor: 
ms.assetid: 
ms.service: storsimple
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/05/2016
ms.author: hkanna
translationtype: Human Translation
ms.sourcegitcommit: 45fc96674d52a1e1273eed390195c59889b86a38
ms.openlocfilehash: 50c4be545f3b852d99968548784ffdff048d5355

---

# <a name="configure-storsimple-with-veritas-netbackup8482"></a>Настройка StorSimple с помощью Veritas NetBackup

## <a name="overview"></a>Обзор

Microsoft Azure StorSimple — это решение гибридного облачного хранилища, позволяющее устранить проблемы, связанные с экспоненциальным увеличением объема данных. Для этого учетная запись хранения Azure используется в качестве расширения локального решения, а данные автоматически распределяются по уровням в локальном и облачном хранилище.

В этой статье представлены сведения об интеграции StorSimple с Veritas NetBackup и рекомендации по интеграции этих решений. Вы также найдете здесь рекомендации по настройке Veritas NetBackup для эффективной интеграции со StorSimple. Мы воспользовались рекомендациями специалистов по архивации и администраторов Veritas о том, как лучше всего настроить Veritas NetBackup в соответствии с вашими требованиями к архивации и Соглашениями об уровне обслуживания.


В этой статье представлена процедура настройки и основные понятия. Однако она отнюдь не является пошаговым руководством по настройке или установке. Здесь предполагается, что основные компоненты и инфраструктура работоспособны и подготовлены для поддержки описываемых компонентов.

## <a name="why-storsimple-as-a-backup-target"></a>Причины использования StorSimple в качестве целевого объекта архивации

StorSimple — это отличный целевой объект архивации. И вот почему:

-   Это решение предоставляет стандартное локальное хранилище для приложений архивации, которое можно использовать, ничего не изменяя. Таким образом, вы быстро получаете расположение для резервных копий. StorSimple также обеспечивает быстрое восстановление последних резервных копий.

-   Возможность распределения по уровням облака без проблем интегрируется с учетной записью облачного хранилища, благодаря чему вы можете воспользоваться экономичной службой хранилища Microsoft Azure.

-   Это решение автоматически предоставляет автономное хранилище для аварийного восстановления.


## <a name="target-audience"></a>Целевая аудитория

Эта статья предназначена для администраторов архивации, администраторов и архитекторов хранилища с опытом работы с хранилищами, Windows Server 2012 R2, Ethernet, облачных служб и NetBackup.

## <a name="supported-versions"></a>Поддерживаемые версии

-   NetBackup 7.7.x и более поздних версий.

-   [StorSimple с обновлением 3 и более поздние версии](storsimple-overview.md#storsimple-workload-summary).

## <a name="key-concepts"></a>Основные понятия

Для успешной работы этого решения, как и для любого другого решения хранилища, крайне важно провести тщательный анализ производительности решения хранилища, Соглашения об уровне обслуживания, скорости изменений и потребности относительно увеличения емкости. Основная мысль состоит в том, что при реализации облачного уровня важную роль в работе StorSimple играют время доступа и пропускная способность облака.

Решение StorSimple предназначено для предоставления хранилища для приложений, работающих с четко определенным набором рабочих данных ("горячие данные"). В этой модели набор рабочих данных хранится на локальном уровне, а остальные наборы нерабочих, "холодных" и архивированных данных распределяются по уровням в облаке. Эта модель показана на рисунке ниже. Практически плоская зеленая линия представляет собой данные, хранящиеся на локальных уровнях устройства StorSimple. Красная линия представляет собой общий объем данных, хранящихся на всех уровнях в решении StorSimple. Расстояние между плоский зеленой линией и экспоненциальной красной кривой представляет собой общий объем данных, хранящихся в облаке.

**Распределение по уровням в StorSimple**
![Схема распределения по уровням в StorSimple](./media/storsimple-configure-backup-target-using-netbackup/image1.jpg)


Благодаря такой архитектуре StorSimple идеально подходит для использования в качестве целевого объекта архивации. StorSimple позволяет:

-   часто восстанавливать локальный рабочий набор данных;

-   использовать облако для автономного хранения и аварийного восстановления старых данных, которое выполняется не так часто.

## <a name="storsimple-benefits"></a>Преимущества StorSimple

StorSimple предоставляет локальное решение, без проблем интегрирующееся с Microsoft Azure за счет простого доступа к локальному и облачному хранилищу.

StorSimple использует автоматическое распределение по уровням между локальным устройством, содержащим устройство с твердотельными накопителями (SSD) и хранилище с последовательным подключением SCSI (SAS), и службой хранилища Azure. Благодаря автоматическому распределению по уровням часто используемые данные хранятся локально, на уровнях SSD и SAS, а редко используемые данные перемещаются в службу хранилища Azure.

StorSimple предоставляет следующие преимущества:

-   Уникальные алгоритмы дедупликации и сжатия, использующие облако для обеспечения беспрецедентного уровня дедупликации.

-   высокую доступность;

-   Георепликация на основе технологий Azure.

-   Интеграция Azure.

-   Шифрование данных в облаке.

-   Усовершенствованное аварийное восстановление и соответствие

Хотя StorSimple представляет два основных сценария развертывания (основной и дополнительный целевой объект архивации), имейте в виду, что это просто обычное устройство блочного хранилища. StorSimple выполняет сжатие и дедупликацию, а также получает данные из облака и отправляет их в приложение и файловую систему.

Дополнительные сведения о StorSimple см. в статье [Серия StorSimple 8000: решение гибридного облачного хранилища](storsimple-overview.md) и в статье с [техническими характеристиками StorSimple 8000](storsimple-technical-specifications-and-compliance.md).


> [!IMPORTANT] 
> Устройство StorSimple, используемое в качестве целевого объекта архивации, поддерживает только StorSimple 8000 с обновлением 3 или более поздней версии.


## <a name="architecture-overview"></a>Общие сведения об архитектуре

В следующих таблицах представлены основные рекомендации по моделям и архитектуре устройства.

#### <a name="storsimple-capacities-for-local-and-cloud-storage"></a>Емкость StorSimple для локального и облачного хранилища


| Емкость хранилища       | 8100          | 8600            |
|------------------------|---------------|-----------------|
| Емкость локального хранилища | &lt;10 ТиБ\*  | &lt;20 ТиБ\*  |
| Емкость облачного хранилища | &gt;200 ТиБ\* | &gt;500 ТиБ\* |

\* В размере хранилища предполагается, что дедупликация и сжатие не используются.

#### <a name="storsimple-capacities-for-primary-and-secondary-backups"></a>Емкость StorSimple для основных и дополнительных резервных копий


| Сценарий архивации  | Емкость локального хранилища                                         | Емкость облачного хранилища                      |
|------------------|----------------------------------------------------------------|---------------------------------------------|
| Основная резервная копия   | Последние резервные копии хранятся в локальном хранилище для быстрого восстановления (RPO). | Журнал архивации (RPO) помещается в облаке. |
| Дополнительная резервная копия | Дополнительную копию резервных данных можно хранить в облаке.  |

## <a name="storsimple-as-a-primary-backup-target"></a>Использование StorSimple в качестве основного целевого объекта архивации

В этом случае тома StorSimple предоставляются приложению архивации в качестве единственного хранилища резервных копий. На этом рисунке показана архитектура решения, где все резервные копии используют многоуровневые тома StorSimple для архивации и восстановления.

![Логическая схема использования StorSimple в качестве основного целевого объекта архивации](./media/storsimple-configure-backup-target-using-netbackup/primarybackuptargetlogicaldiagram.png)

### <a name="primary-target-backup-logical-steps"></a>Логическая процедура архивации основного целевого объекта

1.  Сервер архивации обращается к целевому агенту архивации, который передает ему данные.

2.  Сервер архивации записывает данные на многоуровневые тома StorSimple.

3.  Сервер архивации обновляет базу данных каталога и завершает задание архивации.

4.  Скрипт создания моментальных снимков активирует управление облачными моментальными снимками StorSimple (запуск и удаление).

5.  В зависимости от политики периода удержания сервер архивации удаляет недействительные резервные копии.

###  <a name="primary-target-restore-logical-steps"></a>Логическая процедура восстановления основного целевого объекта

1.  Сервер архивации начинает восстанавливать соответствующие данные из репозитория хранилища.

2.  Агент архивации получает данные с сервера архивации.

3.  Сервер архивации завершает задание восстановления.

## <a name="storsimple-as-a-secondary-backup-target"></a>Использование StorSimple в качестве дополнительного целевого объекта архивации

В этом случае тома StorSimple в основном используются для долгосрочного хранения и архивирования.

На следующем рисунке показана архитектура, где исходные резервные копии и восстанавливаемые данные сохраняются в высокопроизводительном томе. Эти резервные копии по заданному расписанию копируются и архивируются в многоуровневый том StorSimple.

Очень важно выделить достаточно свободного места и производительности в высокопроизводительном томе в соответствии с требованиями политики периода удержания к емкости и производительности.

![Логическая схема использования StorSimple в качестве дополнительного целевого объекта архивации](./media/storsimple-configure-backup-target-using-netbackup/secondarybackuptargetlogicaldiagram.png)

### <a name="secondary-target-backup-logical-steps"></a>Логическая процедура архивации дополнительного целевого объекта

1.  Сервер архивации обращается к целевому агенту архивации, который передает ему данные.

2.  Сервер архивации записывает данные в высокопроизводительное хранилище.

3.  Сервер архивации обновляет базу данных каталога и завершает задание архивации.

4.  В зависимости от политики периода удержания сервер архивации копирует резервные копии в StorSimple.

5.  Скрипт создания моментальных снимков активирует управление облачными моментальными снимками StorSimple (запуск и удаление).

6.  В зависимости от политики периода удержания сервер архивации удаляет недействительные резервные копии.

### <a name="secondary-target-restore-logical-steps"></a>Логическая процедура восстановления дополнительного целевого объекта

1.  Сервер архивации начинает восстанавливать соответствующие данные из репозитория хранилища.

2.  Агент архивации получает данные с сервера архивации.

3.  Сервер архивации завершает задание восстановления.

## <a name="deploy-the-solution"></a>Развертывание решения

Развертывание этого решения состоит из трех этапов: подготовка сетевой инфраструктуры, развертывание устройства StorSimple в качестве целевого объекта архивации и развертывание Veritas NetBackup. В следующих разделах каждый этап рассматривается более подробно.

### <a name="configure-the-network"></a>настроить сеть.

StorSimple является решением, интегрированным с облаком Azure, и поэтому ему требуется активное действующее подключение к этому облаку. Это подключение используется для создания облачных моментальных снимков, управления, передачи метаданных и распределения старых, редко используемых данных по уровням в облачном хранилище Azure.

Для оптимальной работы решения мы рекомендуем придерживаться следующих рекомендаций по сетям.

-   Канал связи между распределением по уровням StorSimple и Azure должен соответствовать требованиям к пропускной способности. Для этого необходимо, чтобы качество обслуживания параметров инфраструктуры было таким, как указано в Соглашениях об уровне обслуживания для RPO и RTO.

-   Максимальная задержка доступа к хранилищу BLOB-объектов Azure должна находиться в пределах 80 мс.

### <a name="deploy-storsimple"></a>Развертывание StorSimple

Пошаговое руководство по развертыванию StorSimple см. в статье [Развертывание локального устройства StorSimple (с обновлением 2)](storsimple-deployment-walkthrough-u2.md).

### <a name="deploy-netbackup"></a>Развертывание NetBackup

Пошаговое руководство по развертыванию NetBackup 7.7.x см. в [документации NetBackup 7.7.x](https://www.veritas.com/support/article.000094423)

## <a name="configure-the-solution"></a>Настройка решения

В этом разделе представлены некоторые примеры настройки. В следующих рекомендациях и примерах продемонстрирована простейшая базовая реализация. Эта реализация может не соответствовать конкретным требованиям к архивации.

### <a name="configure-storsimple"></a>Настройка StorSimple

| Задачи развертывания StorSimple                                                                                                                 | Дополнительные комментарии                                                                                                                                                                                                                                                                                      |
|---------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Разверните локальное устройство StorSimple.                                                                                                 | Поддерживаемая версия: обновление 3 и более поздняя версия.                                                                                                                                                                                                                                                                 |
| Включите режим целевого объекта архивации.                                                                                                                   | Используйте следующие команды для включения и отключения, а также для получения сведений о состоянии. Дополнительные сведения см. в статье [Удаленное подключение к устройству StorSimple](storsimple-remote-connect.md).</br> Включение режима архивации: `Set-HCSBackupApplianceMode -enable`</br>  Отключение режима архивации: `Set-HCSBackupApplianceMode -disable`</br> Текущее состояние параметров режима архивации: `Get-HCSBackupApplianceMode` |
| Создайте общий контейнер томов для тома, на котором хранятся резервные данные.   Все данные в контейнере томов дедуплицируются. | Контейнеры томов StorSimple определяют домены дедупликации.                                                                                                                                                                                                                                             |
| Создание томов StorSimple                                                                                                                 | Создайте тома с размерами, максимально соответствующими тому, который предположительно будет использоваться, так как от размера тома зависит время создания облачных моментальных снимков. Дополнительные сведения об определении размера тома см. в разделе [Политики периода удержания](#retention-policies).</br> </br> Используйте многоуровневые тома StorSimple и установите флажок **Используйте этот том для архивных данных, доступ к которым осуществляется нечасто**. </br> Локально закрепленные тома не поддерживаются.|
| Создайте уникальную политику архивации StorSimple для всех целевых томов архивации.                                                               | Политика архивации StorSimple определяет группу согласованности томов.                                                                                                                                                                                                                                       |
| Отключите расписание при истечении срока действия моментальных снимков.                                                                                                    | Моментальные снимки активируются в качестве операции постобработки.                                                                                                                                                                                                                                                         |
|                                                                                                     |                                             |



### <a name="configure-host-backup-server-storage"></a>Настройка хранилища сервера архивации узла

Убедитесь, что хранилище архивации сервера узла настроено в соответствии с приведенными ниже рекомендациями.  

- Составные тома (созданные с помощью диспетчера дисков Windows) не поддерживаются.
- Отформатируйте тома с помощью NTFS с размером кластера 64 КБ.
- Сопоставьте тома StorSimple с сервером NetBackup. 
    - Используйте iSCSI для физических серверов.
    - Используйте транзитные диски для виртуальных серверов.


## <a name="best-practices-for-storsimple-and-netbackup"></a>Рекомендации для StorSimple и NetBackup

Настройте решение в соответствии с приведенными ниже рекомендациями.

### <a name="operating-system"></a>операционная система

-   Отключите шифрование и дедупликацию Windows Server для файловой системы NTFS.

-   Отключите дефрагментацию Windows Server для томов StorSimple.

-   Отключите индексацию Windows Server для томов StorSimple.

-   Выполните антивирусное сканирование исходного узла (не для томов StorSimple).

-   [Обслуживание Windows Server](https://msdn.microsoft.com/library/windows/desktop/hh848037.aspx) отключено по умолчанию в диспетчере задач.

    - Отключите средство настройки обслуживания в планировщике заданий Windows.

        или

    - Скачайте [PSEXEC из Microsoft Sysinternals](https://technet.microsoft.com/sysinternals/bb897553.aspx).

      - После этого запустите Windows PowerShell от имени администратора и введите следующее:

            `psexec \\%computername% -s schtasks /change /tn “MicrosoftWindowsTaskSchedulerMaintenance Configurator" /disable`

### <a name="storsimple"></a>StorSimple

-   Убедитесь, что для устройства StorSimple установлено [обновление 3 или более поздняя версия](storsimple-install-update-3.md).

-   Изолируйте трафик iSCSI и облака. Используйте выделенное подключение iSCSI для трафика между StorSimple и сервером архивации.

-   Убедитесь, что устройство StorSimple является выделенным целевым объектом архивации. Смешанные рабочие нагрузки не поддерживаются, так как они влияют на RTO и RPO.

### <a name="netbackup"></a>NetBackup

-   База данных NetBackup должна быть локальной на сервере и не располагаться на томе StorSimple.

-   Для аварийного восстановления создайте резервную копию базы данных NetBackup на томе StorSimple.

-   Для этого решения мы поддерживаем полные и добавочные резервные копии NetBackup. Мы не рекомендуем использовать синтетические и разностные резервные копии.

-   Файлы резервных данных должны содержать только данные для конкретного задания. Например, запрещено добавлять носители для разных заданий.

Дополнительные сведения о последних параметрах NetBackup, а также рекомендации по реализации этих требований см. в [документации NetBackup](https://www.veritas.com).


## <a name="retention-policies"></a>Политики хранения

Чаще всего используется такая политика хранения резервных копий, как "дед-отец-сын" (GFS). В соответствии с этой политикой добавочная архивация выполняется ежедневно. Полная архивация выполняется еженедельно и ежемесячно. В результате вы получаете 6 многоуровневых томов StorSimple.

-   Один том содержит полные еженедельные, ежемесячные и ежегодные резервные копии.

-   На 5 других томах хранятся ежедневные добавочные резервные копии.

В следующем примере мы используем схему архивации GFS. В нем предполагается следующее:

-   Используются не дедуплицированные или не сжатые данные.

-   Размер полных резервных копий — 1 ТиБ.

-   Размер ежедневных добавочных резервных копий — 500 ГиБ.

-   4 еженедельные резервные копии хранятся в течение месяца.

-   12 ежемесячных резервных копий хранятся в течение года.

-   1 ежегодная резервная копия хранится в течение 10 лет.

С учетом предыдущих предположений создайте многоуровневый том StorSimple на 26 ТиБ для полных ежемесячных и ежегодных резервных копий. Создайте многоуровневый том StorSimple на 5 ТиБ для каждой из добавочных ежедневных резервных копий.

| Период удержания и тип резервной копии | Размер (ТиБ) | Множитель GFS\*                                       | Общая емкость (ТиБ)          |
|-----------------------|----------|--------------------------------------------------------|-----------------------------|
| Еженедельная полная           | 1        | 4                                                      | 4                           |
| Ежедневная добавочная     | 0,5      | 20 (число циклов соответствует числу недель в месяце) | 12 (2 для дополнительной квоты) |
| Полная ежемесячная          | 1        | 12                                                     | 12                          |
| Полная ежегодная           | 1        | 10                                                     | 10                          |
| Требование GFS       |          |                                                        | 38                          |
| Дополнительная квота      | 4        |                                                        | Всего: 42 (в соответствии с требованиями GFS)   |

\*Коэффициент GFS — это количество копий, которые требуется защитить и сохранить в соответствии с политиками архивации.

## <a name="configure-netbackup-storage"></a>Настройка хранилища NetBackup


1.  В консоли управления NetBackup выберите Устройства\>. Запустите мастер конфигурации пула\> дисков. Выберите\> AdvancedDisk\> и нажмите кнопку "Далее".

    ![Настройка пула диска в консоли управления NetBackup](./media/storsimple-configure-backup-target-using-netbackup/nbimage1.png)

1.  Выберите свой сервер.

    ![Консоль управления NetBackup, выбор сервера](./media/storsimple-configure-backup-target-using-netbackup/nbimage2.png)

1.  Нажмите кнопку "Далее" и выберите свой том StorSimple.

    ![Консоль управления NetBackup, выбор диска StorSimple](./media/storsimple-configure-backup-target-using-netbackup/nbimage3.png)

1.  Затем присвойте ему имя и нажмите кнопку "Далее" дважды, чтобы завершить работу.

    ![Экран с именем и описанием консоли управления NetBackup](./media/storsimple-configure-backup-target-using-netbackup/nbimage4.png)

    После проверки параметров нажмите кнопку "Готово".

    1.  После каждого назначения изменяйте параметры устройства хранения в соответствии со списком рекомендаций.

    2.  Повторите шаги 1–4, пока не назначите все тома StorSimple.

    ![Настройка дисков в консоли управления NetBackup](./media/storsimple-configure-backup-target-using-netbackup/nbimage5.png)

## <a name="storsimple-as-a-primary-backup-target"></a>Использование StorSimple в качестве основного целевого объекта архивации

> [!NOTE]
> Имейте в виду, что если вам нужно восстановить данные из резервной копии, распределенной по уровням в облако, восстановление происходит со скоростью облака.

На следующем рисунке представлено сопоставление типичного тома с заданием архивации. В этом случае все еженедельные резервные копии сопоставляются с диском "Полное копирование, суббота", а добавочные резервные копии — с дисками "Понедельник–пятница". Архивация и восстановление выполняются на многоуровневом томе StorSimple.

![Логическая схема конфигурации основного целевого объекта архивации ](./media/storsimple-configure-backup-target-using-netbackup/primarybackuptargetdiagram.png)

#### <a name="storsimple-as-a-primary-backup-target-grandfather-father-and-son-gfs-schedule-example"></a>Пример расписания с использованием схемы "дед-отец-сын" (GFS) для StorSimple в качестве основного целевого объекта архивации

| Схема архивации GFS на 4 недели, месяц и год |               |             |
|--------------------------------------------------------------------------|---------------|-------------|
| Периодичность и тип архивации   | Полное          | Добавочная (день 1–5)  |
| Еженедельная (неделя 1–4)    | Суббота | Понедельник–пятница |
| Ежемесячная     | Суббота  |             |
| Ежегодная      | Суббота  |             |


### <a name="assigning-storsimple-volumes-to-a-netbackup-backup-job"></a>Назначение томов StorSimple заданию архивации NetBackup

В следующей последовательности предполагается, что целевой узел настроен в соответствии с рекомендациями агента NetBackup.

1.  В консоли управления NetBackup выберите политику. \>Щелкните правой кнопкой мыши\> New Policy (Создать политику).

    ![Экран консоли управления NetBackup](./media/storsimple-configure-backup-target-using-netbackup/nbimage6.png)

1.  Выберите имя политики и используйте мастер политики.

    ![Консоль управления NetBackup, создание политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage7.png)

1.  Выберите соответствующий тип архивации (в нашем случае File Systems (Файловые системы)), а затем нажмите кнопку "Далее".

    ![Консоль управления NetBackup, создание политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage8.png)

1.  Затем выберите пункт Standard (Стандартная).

    ![Консоль управления NetBackup, создание политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage9.png)

1.  Выберите свой узел, установите флажок Detect client operating system (Определять клиентскую операционную систему) и нажмите кнопку "Добавить".

    ![Консоль управления NetBackup, создание политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage10.png)

1.  Нажмите кнопку "Далее".

2.  Выберите диски, для которых следует выполнить архивацию, в нашем случае G:\\DataChange3\\.

    ![Консоль управления NetBackup, создание политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage11.png)

1.  Выберите схему в соответствии со своими требованиями.

    ![Консоль управления NetBackup, создание политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage12.png)

1.  Нажмите кнопку "Далее" дважды, а затем — кнопку "Готово". Расписание изменится после создания политики.

2.  Разверните созданную политику и выберите расписания.

    ![Консоль управления NetBackup, создание политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage13.png)

1.  Щелкните Differential-Inc правой кнопкой мыши, выберите пункт Copy to new (Скопировать в новый) (в нашем случае Mon-Inc) и нажмите кнопку "ОК".

    ![Консоль управления NetBackup, расписание новой политики](./media/storsimple-configure-backup-target-using-netbackup/nbimage14.png)

1.  Щелкните созданное расписание правой кнопкой мыши и выберите пункт "Изменить".

2.  На вкладке "Атрибуты" установите флажок Override policy storage selection (Переопределять выбранное хранилище для политики) и выберите том, на котором сохраняются добавочные резервные копии за понедельник. В нашем случае это SS1.

    ![Консоль управления NetBackup, изменение расписания](./media/storsimple-configure-backup-target-using-netbackup/nbimage15.png)

1.  На вкладке Start Window (Окно запуска) выберите окно для резервных копий. В нашем случае каждый понедельник с 20:00 по 21:00.

    ![Консоль управления NetBackup, изменение расписания](./media/storsimple-configure-backup-target-using-netbackup/nbimage16.png)

1.  Нажмите кнопку "ОК".

2.  Повторите шаги 11–15 для каждой из добавочных резервных копий и выберите нужный том и расписание.

3.  Затем щелкните расписание Differential-Inc правой кнопкой мыши и удалите его.

4.  Удалив расписание Differential-Inc, измените расписание полной архивации в соответствии с требованиями.

    ![Консоль управления NetBackup, изменение расписания](./media/storsimple-configure-backup-target-using-netbackup/nbimage17.png)

1.  Изменить окно запуска (в нашем случае суббота 6:00).

    ![Консоль управления NetBackup, изменение расписания](./media/storsimple-configure-backup-target-using-netbackup/nbimage18.png)

1.  В окончательном виде расписание должно выглядеть следующим образом:

    ![Консоль управления NetBackup, изменение расписания](./media/storsimple-configure-backup-target-using-netbackup/nbimage19.png)

## <a name="storsimple-as-a-secondary-backup-target"></a>Использование StorSimple в качестве дополнительного целевого объекта архивации

> [!NOTE]
> Имейте в виду, что если вам нужно восстановить данные из резервной копии, распределенной по уровням в облако, восстановление происходит со скоростью облака.

В этой модели необходим носитель для хранения (кроме StorSimple), который будет использоваться в качестве временного кэша. Например, том RAID может обеспечивать место, операции ввода-вывода и пропускную способность. Мы рекомендуем использовать RAID 5, 50 и 10.

На следующем рисунке представлены типичные локальные тома (на сервере) с кратким периодом удержания и архивные тома с длительным периодом удержания. В этом случае все резервные копии создаются на локальном томе RAID (на сервере). Эти резервные копии периодически копируются и архивируются на архивный том. Очень важно определить размер локального тома RAID (на сервере) в соответствии с требованиями к емкости и производительности для короткого периода удержания.

#### <a name="storsimple-as-a-secondary-backup-target-gfs-example"></a>Пример использования схемы GFS для StorSimple в качестве дополнительного целевого объекта архивации

![Логическая схема использования StorSimple в качестве дополнительного целевого объекта архивации ](./media/storsimple-configure-backup-target-using-netbackup/secondarybackuptargetdiagram.png)

В следующей таблице показано, как настроить резервные копии для запуска на локальных дисках и дисках StorSimple в соответствии с требованиями к емкости отдельного диска и общей емкости.

#### <a name="backup-configuration-and-capacity-requirements"></a>Требования к конфигурации и емкости резервных копий

| Период удержания и тип резервной копии                    |Настроенное хранилище| Размер (ТиБ) | Множитель GFS | Общая емкость (ТиБ)        |
|----------------------------------------------|-----|----------|----------------|------------------------|
| 1-я неделя (полная и добавочная) |Локальный диск (с коротким периодом удержания)| 1        | 1              | 1           |
| StorSimple, со 2-ой по 4-ю неделю           |Диск StorSimple (с длительным периодом удержания) | 1        | 4.              | 4                   |
| Полная ежемесячная                                 |Диск StorSimple (с длительным периодом удержания) | 1        | 12             | 12                   |
| Полная ежегодная                               |Диск StorSimple (с длительным периодом удержания) | 1        | 1              | 1                   |
|Размер тома в соответствии с GFS | |          |                | 18*|

\* Общая емкость включает 17 ТиБ для дисков StorSimple и 1 ТиБ для локального тома RAID


#### <a name="gfs-example-schedule"></a>Примеры расписания GFS

|Еженедельное, ежемесячное и ежегодное расписание по схеме GFS|                    |                   |                   |                   |                   |                   |
|--------------------------------------------------------------------------|--------------------|-------------------|-------------------|-------------------|-------------------|-------------------|
| Неделя                                                                     | Полное               | Добавочная, день 1        | Добавочная, день 2        | Добавочная, день 3        | Добавочная, день 4        | Добавочная, день 5        |
| 1-я неделя                                                                   | Локальный том RAID  | Локальный том RAID | Локальный том RAID | Локальный том RAID | Локальный том RAID | Локальный том RAID |
| 2-я неделя                                                                   | StorSimple, со 2-ой по 4-ю неделю |                   |                   |                   |                   |                   |
| 3-я неделя                                                                   | StorSimple, со 2-ой по 4-ю неделю |                   |                   |                   |                   |                   |
| 4-я неделя                                                                   | StorSimple, со 2-ой по 4-ю неделю |                   |                   |                   |                   |                   |
| Ежемесячная                                                                  | StorSimple, ежемесячная |                   |                   |                   |                   |                   |
| Ежегодная                                                                   | StorSimple, ежегодная  |                   |                   |                   |                   |                   |


### <a name="assign-storsimple-volumes-to-netbackup-archiveduplication-job"></a>Назначьте тома StorSimple заданию архивации или дупликации NetBackup.

Так как NetBackup предлагает множество возможностей для управления хранилищем и носителями, проконсультируйтесь со специалистами Veritas или архитектором NetBackup, чтобы оценить требования SLP соответствующим образом.

1.  После определения исходных пулов дисков определите 3 политики жизненного цикла хранилища:

    1.  LocalRAIDVolume;

    2.  StorSimpleWeek2-4;

    3.  StorSimpleMonthlyFulls;

    4.  StorSimpleYearlyFulls.

    В консоли управления в разделе "Хранилище" выберите пункт Storage Lifecycle Policies (Политики жизненного цикла хранилища) и New Storage Lifecycle Policy (Новая политика жизненного цикла хранилища).

    [Консоль управления NetBackup, политика жизненного цикла хранилища](./media/storsimple-configure-backup-target-using-netbackup/nbimage20.png)

1.  Выберите имя и нажмите кнопку "Добавить".

    ![Консоль управления NetBackup, политика жизненного цикла хранилища](./media/storsimple-configure-backup-target-using-netbackup/nbimage21.png)

1.  На вкладке "Свойства" выберите "Архивация" и Destination Storage (Целевое хранилище). Затем выберите соответствующий период удержания и нажмите кнопку "ОК". В нашем случае LocalRAIDVolume и период удержания в течение одной недели.

    ![Консоль управления NetBackup, политика жизненного цикла хранилища](./media/storsimple-configure-backup-target-using-netbackup/nbimage22.png)

1.  Вы определили первую операцию архивации и репозиторий.

2.  Выделите предыдущую операцию, нажмите кнопку "Добавить", выберите Destination Storage (Целевое хранилище) и соответствующий период удержания. В нашем случае от LocalRAIDVolume до StorSimpleWeek2-4 и период удержания в течение месяца.

    ![Консоль управления NetBackup, новая политика жизненного цикла хранилища](./media/storsimple-configure-backup-target-using-netbackup/nbimage23.png)

1.  Выделите предыдущую операцию и нажмите кнопку "Добавить". Теперь вы добавите ежемесячные резервные копии за год.

    ![Консоль управления NetBackup, изменение политики жизненного цикла хранилища](./media/storsimple-configure-backup-target-using-netbackup/nbimage24.png)

1.  Повторяйте шаги 5–6, пока не создадите соответствующую политику периода удержания SLP.

    ![Консоль управления NetBackup, политика жизненного цикла хранилища](./media/storsimple-configure-backup-target-using-netbackup/nbimage25.png)

1.  Определив соответствующую политику периода удержания SLP, в разделе "Политика" определите политику архивации в соответствии с указаниями в разделе "Использование StorSimple в качестве основного целевого объекта архивации".

1.  В разделе "Расписания" щелкните "Полная" правой кнопкой мыши и выберите пункт "Изменить".

    ![Консоль управления NetBackup, изменение расписания](./media/storsimple-configure-backup-target-using-netbackup/nbimage26.png)

1.  Установите флажок Override policy storage selection (Переопределять выбранное хранилище для политики) и выберите SLP, созданную на этапах 1–8.

    ![Консоль управления NetBackup, изменение расписания](./media/storsimple-configure-backup-target-using-netbackup/nbimage27.png)

1.  Нажмите кнопку "ОК" и повторите действия для расписания добавочной архивации.

    ![Консоль управления NetBackup, изменение расписания](./media/storsimple-configure-backup-target-using-netbackup/nbimage28.png)

1.  Нажмите кнопку "ОК" и повторите действия для расписания добавочной архивации.

| Период удержания и тип резервной копии | Размер (ТиБ) | Множитель GFS\*                                       | Общая емкость (ТиБ)          |
|-----------------------|----------|--------------------------------------------------------|-----------------------------|
| Еженедельная полная           | 1        | 4                                                      | 4                           |
| Ежедневная добавочная     | 0,5      | 20 (число циклов соответствует числу недель в месяце) | 12 (2 для дополнительной квоты) |
| Полная ежемесячная          | 1        | 12                                                     | 12                          |
| Полная ежегодная           | 1        | 10                                                     | 10                          |
| Требование GFS       |          |                                                        | 38                          |
| Дополнительная квота      | 4.        |                                                        | Всего: 42 (в соответствии с требованиями GFS)   |
\*Коэффициент GFS — это количество копий, которые требуется защитить и сохранить в соответствии с политиками архивации.

### <a name="storsimple-cloud-snapshots"></a>Облачные моментальные снимки StorSimple

Облачные моментальные снимки StorSimple обеспечивают защиту данных на устройстве StorSimple. Это то же самое, что и доставлять ленты в удаленное помещение и, при использовании геоизбыточного хранилища Azure (GRS), доставлять ленты на несколько сайтов. Если при сбое понадобилось восстановить устройство, можно запустить другое устройство StorSimple и выполнить отработку отказа. После отработки отказа вы сможете получить доступ к данным (со скоростью облака) из последнего облачного моментального снимка.

В разделе ниже показано, как создать короткий скрипт для активации и удаления облачных моментальных снимков StorSimple во время постобработки резервной копии.

> [!NOTE]
> На созданные вручную или с помощью программных средств моментальные снимки не распространяется политика истечения срока действия моментальных снимков StorSimple. Их нужно удалять вручную или программным способом.

### <a name="start-delete-cloud-snapshots-with-a-script"></a>Запуск и удаление облачных моментальных снимков с помощью скрипта

> [!NOTE]
> Перед удалением моментального снимка StorSimple тщательно оцените последствия для соответствия требованиям и хранения данных. Дополнительные сведения о выполнении скрипта после архивации см. в [документации NetBackup](https://www.veritas.com/support/article.000094423).

#### <a name="backup-lifecycle"></a>Жизненный цикл резервной копии

![Схема жизненного цикла резервной копии](./media/storsimple-configure-backup-target-using-netbackup/backuplifecycle.png)

#### <a name="requirements"></a>Требования:

-   Сервер, на котором выполняется скрипт, должен иметь доступ к облаку Azure.

-   У учетной записи пользователя должны быть необходимые разрешения.

-   Для политики архивации StorSimple должны быть настроены, но не включены связанные тома StorSimple.

-   Вам понадобится имя ресурса, регистрационный ключ, имя устройства и идентификатор политики архивации StorSimple.

#### <a name="steps"></a>Шаги:

1.  [Установите Azure PowerShell](/powershell-install-configure/).

2.  [Скачайте и импортируйте параметры публикации и информацию о подписке](https://msdn.microsoft.com/library/dn385850.aspx).

3.  На классическом портале Azure получите имя ресурса и [ключ регистрации для службы диспетчера StorSimple](storsimple-deployment-walkthrough-u2.md#step-2-get-the-service-registration-key).

4.  На сервере, на котором запускается скрипт, запустите Windows PowerShell от имени администратора. Тип:

    -   `Get-AzureStorSimpleDeviceBackupPolicy –DeviceName <device name>`

    Запишите идентификатор политики архивации.

5.  В Блокноте создайте скрипт Windows PowerShell и сохраните его там же, где были сохранены параметры публикации Azure. Например, `C:\CloudSnapshot\StorSimpleCloudSnapshot.ps1`.

    Скопируйте и вставьте следующий фрагмент кода:

    ```powershell
    Import-AzurePublishSettingsFile "c:\\CloudSnapshot Snapshot\\myAzureSettings.publishsettings"
    Disable-AzureDataCollection
    $ApplianceName = <myStorSimpleApplianceName>
    $RetentionInDays = 20
    $RetentionInDays = -$RetentionInDays
    $Today = Get-Date
    $ExpirationDate = $Today.AddDays($RetentionInDays)
    Select-AzureStorSimpleResource -ResourceName "myResource" –RegistrationKey
    Start-AzureStorSimpleDeviceBackupJob –DeviceName $ApplianceName -BackupType CloudSnapshot -BackupPolicyId <BackupId> -Verbose
    $CompletedSnapshots =@()
    $CompletedSnapshots = Get-AzureStorSimpleDeviceBackup -DeviceName $ApplianceName
    Write-Host "The Expiration date is " $ExpirationDate
    Write-Host

    ForEach ($SnapShot in $CompletedSnapshots)
    {
        $SnapshotStartTimeStamp = $Snapshot.CreatedOn
        if ($SnapshotStartTimeStamp -lt $ExpirationDate)

        {
            $SnapShotInstanceID = $SnapShot.InstanceId
            Write-Host "This snpashotdate was created on " $SnapshotStartTimeStamp.Date.ToShortDateString()
            Write-Host "Instance ID " $SnapShotInstanceID
            Write-Host "This snpashotdate is older and needs to be deleted"
            Write-host "\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#"
            Remove-AzureStorSimpleDeviceBackup -DeviceName $ApplianceName -BackupId $SnapShotInstanceID -Force -Verbose
        }
    }
    ```

6.  Добавьте скрипт к заданию архивации в NetBackup, изменив команды предварительной публикации параметров задания NetBackup.

> [!NOTE]
> Мы рекомендуем запустить политику архивации облачных моментальных снимков StorSimple по завершении задания ежедневной архивации в качестве скрипта постобработки. Дополнительные сведения об архивации и восстановлении среды приложения архивации в соответствии с RPO и RTO можно получить у архитектора по архивации.

## <a name="storsimple-as-a-restore-source"></a>Использование StorSimple в качестве источника восстановления


Восстановление из StorSimple действует аналогично восстановлению из любого устройства блочного хранилища. Восстановление данных, распределенных по уровням в облаке, выполняется со скоростью облака. Восстановление локальных данных выполняется со скоростью локального диска устройства. Сведения о выполнении восстановления см. в [документации NetBackup](https://www.veritas.com/support/article.000094423) и рекомендациях по восстановлению NetBackup.

## <a name="storsimple-failover-and-disaster-recovery"></a>Отработка отказа и аварийное восстановление для устройства StorSimple

> [!NOTE]
> Для сценариев с использованием целевого объекта архивации облачное устройство StorSimple не поддерживается в качестве целевого объекта восстановления.

Сбой может произойти из-за различных факторов. В следующей таблице перечислены распространенные сценарии аварийного восстановления.

| Сценарий                                                                    | Влияние                                             | Восстановление                                                                                                                                                                               | Примечания                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|-----------------------------------------------------------------------------|----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Сбой устройства StorSimple                                                | Операции архивации и восстановления будут прерваны. | Замените неисправное устройство и выполните [отработку отказа и аварийное восстановление StorSimple](storsimple-device-failover-disaster-recovery.md) | Если после восстановления устройства требуется выполнить восстановление, все рабочие наборы данных извлекаются из облака на новое устройство. В результате все операции будут выполняться со скоростью облака. При повторном сканировании во время индексации и каталогизации все наборы резервных копий будут отсканированы и извлечены из облачного уровня на уровень локального устройства, что может занять много времени.                                                 |
| Сбой сервера NetBackup                                              | Операции архивации и восстановления будут прерваны. | Создайте сервер архивации повторно и восстановите базу данных.                                                                                                                                       | Сервер NetBackup потребуется перестроить или восстановить на сайте аварийного восстановления. Базу данных требуется восстановить до последней точки. Если восстановленная база данных NetBackup не синхронизирована с последним заданием архивации, требуется индексирование и каталогизация. При повторном сканировании во время индексации и каталогизации все наборы резервных копий будут отсканированы и извлечены из облачного уровня на уровень локального устройства. Поэтому следует учитывать ограничения по времени. |
| Сбой узла, который приводит к потере сервера архивации и StorSimple. | Операции архивации и восстановления будут прерваны. | Сначала восстановите StorSimple, а затем — NetBackup.                                                                                                                                          | Сначала восстановите StorSimple, а затем — NetBackup.                                                                 Если после восстановления устройства требуется выполнить восстановление, все рабочие наборы данных извлекаются из облака на новое устройство. В результате все операции будут выполняться со скоростью облака.|

## <a name="references"></a>Ссылки

В этой статье содержатся ссылки на следующие документы:

- [Настройка функции Multipath I/O для устройства StorSimple](storsimple-configure-mpio-windows-server.md)

- [Storage scenarios: Thin provisioning](http://msdn.microsoft.com/library/windows/hardware/dn265487.aspx) (Сценарии хранилища: тонкая подготовка)

- [Using GPT drives](http://msdn.microsoft.com/windows/hardware/gg463524.aspx#EHD) (Использование дисков GPT)

- [Включение и настройка теневых копий общих папок](http://technet.microsoft.com/library/cc771893.aspx)

## <a name="next-steps"></a>Дальнейшие действия

Подробнее.

- Узнайте, как выполнить [восстановление из набора резервных данных](storsimple-restore-from-backup-set-u2.md).
- Узнайте, как выполнить [отработку отказа и аварийное восстановление устройства](storsimple-device-failover-disaster-recovery.md).



<!--HONumber=Dec16_HO2-->


