<properties 
   pageTitle="Управление контроллерами устройства StorSimple | Microsoft Azure"
   description="Узнайте, как остановить, перезапустить и выключить контроллеры устройства StorSimple или восстановить их заводские настройки."
   services="storsimple"
   documentationCenter=""
   authors="alkohli"
   manager="carmonm"
   editor="" />
<tags 
   ms.service="storsimple"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="02/18/2016"
   ms.author="alkohli" />

# Управление контроллерами устройства StorSimple

## Обзор

В этом учебнике описываются различные операции, которые могут быть выполнены на контроллерах устройства StorSimple. Контроллеры устройства StorSimple являются избыточными (узловыми) контроллерами в конфигурации активный/пассивный. В один момент времени только один контроллер активен и обрабатывает все операции с диском и сетевые операции. Другой контроллер находится в пассивном режиме. При сбое активного контроллера пассивный подключается автоматически.

Этот учебник содержит пошаговые инструкции для управления контроллерами устройства с помощью:

- раздела **Контроллеры** страницы **Обслуживание** в службе диспетчера StorSimple;
- Windows PowerShell для StorSimple. 

Рекомендуется управлять контроллерами устройств через службу диспетчера StorSimple. Если действие можно выполнить только с помощью Windows PowerShell для StorSimple, в учебном курсе будет соответствующая пометка.

После изучения этого учебника вы сможете сделать следующее.

- Перезагрузить или завершить работу контроллера устройства StorSimple.
- Завершить работу устройства StorSimple.
- Восстановить параметры по умолчанию устройства StorSimple.


## Перезагрузка или завершение работы отдельного контроллера

Перезагрузка контроллера или завершение работы не являются обязательными в ходе нормальной работы системы. Операции завершения работы для отдельного контроллера устройства являются стандартными только в случаях, когда необходимо заменить отказавший аппаратный компонент устройства. Необходимость в перезагрузке контроллера может также возникнуть в ситуации, когда на производительность влияет избыточное использование памяти или неработающий контроллер. Перезагрузка контроллера может потребоваться после успешной замены контроллера, если вы хотите включить и протестировать замененный контроллер.

Перезагрузка устройства не нарушает работу подключенных инициаторов при условии, что доступен пассивный контроллер. Если пассивный контроллер недоступен или выключен, то перезагрузка активного контроллера может привести к нарушению работы службы и простою.

> [AZURE.IMPORTANT] 

> - **Работающий контроллер никогда нельзя удалять физически, так как это приведет к потере избыточности и повысит риск простоя.**

> - Следующая процедура относится только к физическому устройству StorSimple. Сведения о том, как запустить, остановить и перезагрузить виртуальное устройство, см. в разделе [Работа с виртуальным устройством](storsimple-virtual-device-u1.md#work-with-the-storsimple-virtual-device).

Перезапустить или выключить отдельный контроллер устройства можно с помощью классического портала Azure службы StorSimple Manager или Windows PowerShell для StorSimple.

Чтобы управлять контроллерами устройства на классическом портале Azure, выполните следующие действия.

#### Перезагрузка или выключение контроллера на классическом портале

1. Перейдите в раздел **Устройства > Обслуживание**.

1. Перейдите в раздел **Состояние оборудования** и убедитесь, что состояние контроллеров на вашем устройстве — **Исправен**.

	![Проверка работоспособности контроллеров устройства StorSimple](./media/storsimple-manage-device-controller/IC766017.png)

1. В нижней части страницы **Обслуживание** щелкните **Управление контроллерами**.

	![Управление контроллерами устройства StorSimple](./media/storsimple-manage-device-controller/IC766018.png)</br>

	>[AZURE.NOTE] Если вы не видите кнопку **Управление контроллерами**, необходимо установить обновления. Дополнительные сведения см. в разделе [Обновление устройства StorSimple](storsimple-update-device.md).

1. В диалоговом окне **Изменение параметров контроллера** выполните следующие действия.


	- В раскрывающемся списке **Выбрать контроллер** выберите контроллер, которым требуется управлять. Возможные варианты: контроллер 0 и контроллер 1. Эти контроллеры также определены как активные или пассивные.

		>[AZURE.NOTE] Нельзя управлять контроллером, если он недоступен или выключен. При этом он не будет отображаться в раскрывающемся списке.
	


	- В раскрывающемся списке **Выбрать действие** выберите **Перезагрузить контроллер** или **Выключить контроллер**.
	
		![Перезагрузка пассивного контроллера устройства StorSimple](./media/storsimple-manage-device-controller/IC766020.png)
 

	- Щелкните значок галочки ![Значок галочки](./media/storsimple-manage-device-controller/IC740895.png).

При этом контроллер будет перезагружен или выключен. В таблице ниже приведены сведения о том, что происходит в зависимости от выбора, сделанного в диалоговом окне **Изменение параметров контроллера**.
													

|Выбор #|Если вы выбрали...|Произойдет следующее.|
|---|---|---|
|1\.|Перезагрузка пассивного контроллера.|Будет создано задание для перезагрузки контроллера, и вы получите уведомление после успешного создания задания. Будет выполнена перезагрузка контроллера. Можно отслеживать процесс перезагрузки, обратившись к разделу **Служба > Панель мониторинга > Просмотреть журналы операций** и отфильтровав данные на основе параметров, относящихся к службе.|
|2\.|Перезагрузка активного контроллера.|Появится следующее предупреждение: "При перезагрузке активного контроллера устройство выполнит отработку отказа на пассивный контроллер. Вы действительно хотите продолжить?" </br>Если вы решите продолжить эту операцию, дальнейшие действия будут идентичны используемым для перезагрузки пассивного контроллера (см. раздел 1).|
|3\.|Завершение работы пассивного контроллера.|Вы увидите следующее сообщение: "После завершения работы потребуется нажать кнопку питания на контроллере, чтобы включить его. Вы хотите выключить этот контроллер?" </br>Если вы решите продолжить эту операцию, дальнейшие действия будут идентичны используемым для перезагрузки пассивного контроллера (см. раздел 1).|
|4\.|Завершение работы активного контроллера.|Вы увидите следующее сообщение: "После завершения работы потребуется нажать кнопку питания на контроллере, чтобы включить его. Вы хотите выключить этот контроллер?" </br>Если вы решите продолжить эту операцию, дальнейшие действия будут идентичны используемым для перезагрузки пассивного контроллера (см. раздел 1).|


#### Перезагрузка или завершение работы контроллера в Windows PowerShell для StorSimple
Выполните следующие действия, чтобы выключить или перезагрузить отдельный контроллер устройства StorSimple с классического портала Azure.


1. Получите доступ к устройству с помощью последовательной консоли или сеанса telnet с удаленного компьютера. Подключитесь к контроллеру 0 или 1, выполнив действия, описанные в разделе [Использование PuTTY для подключения к последовательной консоли устройства](storsimple-deployment-walkthrough.md#use-putty-to-connect-to-the-device-serial-console).

1. В меню последовательной консоли выберите вариант 1 **Войти с полным доступом**.

1. В сообщении заголовка проверьте, к какому контроллеру вы подключены (контроллер 0 или контроллер 1), а также является ли этот контроллер активным или пассивным (резервным).
	

	- Чтобы завершить работу отдельного контроллера, в командной строке введите следующую команду:

		`Stop-HcsController`

		При этом будет завершена работа контроллера, к которому вы подключены. Если остановить активный контроллер, он выполнит отработку отказа на пассивный контроллер перед выключением.


	- Чтобы перезагрузить контроллер, в командной строке введите следующую команду:

		`Restart-HcsController`

		При этом будет перезагружен контроллер, к которому вы подключены. Если перезагрузить активный контроллер, он выполнит отработку отказа на пассивный контроллер перед перезагрузкой.


## Завершение работы устройства StorSimple

В этом разделе объясняется, как завершить работу работающего или отказавшего устройства StorSimple с удаленного компьютера. Устройство отключается после завершения работы обоих контроллеров устройства. Завершение работы устройства выполняется при физическом перемещении устройства или извлечении из службы.

> [AZURE.IMPORTANT] Перед завершением работы устройства проверьте работоспособность компонентов устройства. Перейдите в раздел **Устройства > Обслуживание > Состояние оборудования** и убедитесь, что индикаторы состояния всех компонентов зеленого цвета. Только работоспособное устройство будет иметь зеленый индикатор. Если работа устройства завершается, чтобы заменить неработающий компонент, появится состояние сбоя (красный) или ухудшения (желтый) для соответствующих компонентов.

#### Завершение работы устройства StorSimple

1. Используйте процедуру [перезагрузки или завершения работы контроллера](#restart-or-shut-down-a-single-controller) для идентификации и завершения работы пассивного контроллера на устройстве. Эту операцию можно выполнить на классическом портале Azure или в Windows PowerShell для StorSimple.
2. Повторите предыдущее действие для выключения активного контроллера.
3. Теперь необходимо взглянуть на заднюю панель устройства. После полного выключения двух контроллеров индикаторы состояния на обоих контроллерах должны мигать красным. Если в данный момент необходимо отключить устройство полностью, переместите переключатели модуля питания и охлаждения (PCM) в положение ВЫКЛ. При этом устройство будет отключено.


<!--#### To shut down a StorSimple device in Windows PowerShell for StorSimple

1. Connect to the serial console of the StorSimple device by following the steps in [Use PuTTY to connect to the device serial console](storsimple-deployment-walkthrough.md#use-putty-to-connect-to-the-serial-console).

1. In the serial console menu, verify from the banner message that the controller you are connected to is the passive controller. If you are connected to the active controller, disconnect from this controller and connect to the other controller.

1. In the serial console menu, choose option 1, **log in with full access**.

1. At the prompt, type:

	`Stop-HCSController`

	This should shut down the current controller. To verify whether the shutdown has finished, check the back of the device. The controller status LED should be solid red.

1. Repeat steps 1 through 4 to connect to the active controller and then shut it down.

1. After both the controllers are completely shut down, the status LEDs on both should be blinking red. If you need to turn off the device completely at this time, flip the power switches on both Power and Cooling Modules (PCMs) to the OFF position.-->

## Восстановление на устройстве заводских настроек

Эта процедура содержит подробные инструкции, необходимые для восстановления заводских настроек по умолчанию на устройстве Microsoft Azure StorSimple с помощью Windows PowerShell для StorSimple.

Выполните следующие действия, чтобы восстановить заводские настройки устройства Microsoft Azure StorSimple.

### Восстановление параметров устройства по умолчанию в Windows PowerShell для StorSimple

1. Получите доступ к устройству через его последовательную консоль. Проверьте сообщение заголовка, чтобы убедиться, что вы подключены к активному контроллеру.

1. В меню последовательной консоли выберите вариант 1 **Войти с полным доступом**.

1. При появлении запроса введите следующую команду:

	`Reset-HcsFactoryDefault`

	Система перезагрузится несколько раз. После успешного восстановления заводских настроек вы получите уведомление. В зависимости от модели системы завершение этого процесса может занять 45–60 минут для устройства 8100 и 60–90 минут для устройства 8600.

	> [AZURE.TIP] 
	
	> - Используйте команду `Reset-HcsFactoryDefault –SkipFirmwareVersionCheck`, чтобы пропустить проверку версии встроенного ПО, если командлет восстановления заводских настроек (указанный выше) сообщает об ошибке несоответствия встроенного ПО: "Не удается продолжить восстановление заводских настроек из-за несоответствия в версии встроенного ПО". Необходимо пропустить проверку встроенного ПО (с помощью параметра `–SkipFirmwareCheck`) при выполнении восстановления заводских настроек устройства, которое ранее было обновлено с помощью центра обновления Майкрософт или механизма исправления.
	
	> - Сбой восстановления заводских настроек может произойти для устройств StorSimple, которые используют обновление 1 или 1.1 на портале для государственных организаций и в которых успешно заменен один или два контроллера (на запасные контроллеры, которые поставлялись с ПО до обновления 1). Это происходит, когда образ для восстановления заводских настроек проверяется на наличие файла SHA1 на контроллере, который отсутствует в ПО до обновления 1. В случае такого сбоя восстановления заводских настроек обратитесь в службу поддержки Майкрософт, чтобы получить соответствующие инструкции. Эта проблема не обнаружена при использовании запасных контроллеров, которые поставлялись с завода с ПО с обновлением 1 или более поздней версии.

	> - Дополнительные сведения об использовании этого командлета см. в [справочнике по командлетам Windows PowerShell для StorSimple](https://technet.microsoft.com/library/dn688168.aspx).


## Часто задаваемые вопросы об управлении контроллерами устройства

В этом разделе мы собрали некоторые часто задаваемые вопросы об управлении контроллерами устройства StorSimple.

**Вопрос.** Что произойдет, если оба контроллера на устройстве включены и работоспособны, а я перезагружу или выключу активный контроллер?

**Ответ.** Если контроллеры на устройстве работоспособны и включены, отобразится запрос подтверждения. Можно выбрать следующие варианты.

- **Перезагрузить активный контроллер** — вы получите уведомление о том, что перезагрузка активного контроллера приведет к отработке устройством отказа на пассивный контроллер. Контроллер будет перезагружен.

- **Завершить работу активного контроллера** — вы получите уведомление о том, что завершение работы активного контроллера приведет к простою. Также необходимо будет нажать кнопку питания на устройстве, чтобы включить контроллер.

**Вопрос.** Что произойдет, если пассивный контроллер на устройстве недоступен или выключен, а я перезагружу или завершу работу активного контроллера?

**Ответ.** Если пассивный контроллер на устройстве недоступен или выключен, и вы выбираете:

- **Перезагрузить активный контроллер** — вы получите уведомление о том, что продолжение операции приведет к временному нарушению работы службы, отобразится запрос подтверждения.

- **Завершить работу активного контроллера** — вы получите уведомление о том, что продолжение операции приведет к простою и потребуется нажать кнопку питания на одном или обоих контроллерах, чтобы включить устройство. После этого введите подтверждение для применения этих исправлений.

**Вопрос.** В каком случае возникнет сбой перезагрузки или завершения работы контроллера?

**Ответ.** Сбой перезагрузки или завершения работы контроллера может произойти, если:

- идет обновление устройства;

- перезагрузка контроллера уже выполняется;

- завершение работы контроллера уже выполняется.

**Вопрос.** Как можно выяснить факт перезагрузки или завершения работы контроллера?

**Ответ.** Можно проверить состояние контроллера на странице обслуживания. Состояние контроллера покажет, был ли контроллер перезагружен или выключен. Кроме того, на странице оповещений появится информационное оповещение о перезагрузке или завершении работы контроллера. Операции перезагрузки и завершения работы контроллера также записываются в журналы операций. Дополнительные сведения о журналах операций см. в статье [Просмотр журналов операций](storsimple-service-dashboard.md#view-the-operations-logs).

**Вопрос.** Оказывает ли отработка отказа контроллера влияние на операции ввода-вывода?

**Ответ.** TCP-подключения между инициаторами и активным контроллером будут сброшены в результате отработки отказа контроллера, однако они будут восстановлены, когда пассивный контроллер примет операции. В ходе этой операции может быть временная (менее 30 секунд) приостановка операций ввода-вывода между инициаторами и устройством.

**Вопрос.** Как вернуть контроллер в службу после завершения работы и удаления?

**Ответ.** Чтобы вернуть контроллер в службу, нужно вставить его в корпус согласно инструкциям в разделе [Замена модуля контроллера в устройстве StorSimple](storsimple-controller-replacement.md).

## Дальнейшие действия

- Если возникли затруднения с контроллерами устройства StorSimple, которые не удается разрешить с помощью процедур, описанных в этом учебнике, [обратитесь в службу поддержки Майкрософт](storsimple-contact-microsoft-support.md).

- Дополнительные сведения об управлении устройством с помощью службы StorSimple Manager см. в статье [Использование службы StorSimple Manager для администрирования устройства StorSimple](storsimple-manager-service-administration.md).

<!---HONumber=AcomDC_0224_2016-->