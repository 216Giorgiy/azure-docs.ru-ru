<properties 
   pageTitle="Настройка веб-прокси для устройства StorSimple | Microsoft Azure"
   description="Узнайте, как использовать Windows PowerShell для StorSimple для настройки параметров веб-прокси для устройства StorSimple."
   services="storsimple"
   documentationCenter=""
   authors="alkohli"
   manager="carolz"
   editor="" />
<tags 
   ms.service="storsimple"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="12/02/2015"
   ms.author="alkohli" />

# Настройка веб-прокси для устройства StorSimple

## Обзор

В этом учебнике описывается, как использовать Windows PowerShell для StorSimple для настройки и просмотра параметров веб-прокси для устройства StorSimple. Параметры веб-прокси используются устройством StorSimple при взаимодействии с облаком. Сервер веб-прокси используется в качестве еще одного уровня защиты, для фильтрации содержимого, для кэширования с целью уменьшения требований к пропускной способности, а также в аналитике.

Веб-прокси представляет собой вариант конфигурации устройства StorSimple. Настроить веб-прокси можно только через Windows PowerShell для StorSimple. Конфигурация выполняется в два этапа следующим образом.

1. Сначала с помощью мастера установки или командлетов Windows PowerShell для StorSimple настраиваются параметры веб-прокси.

2. Затем с помощью командлетов Windows PowerShell для StorSimple заданные параметры веб-прокси активируются.

После завершения конфигурации веб-прокси параметры настроенного веб-прокси можно просмотреть как в службе диспетчера Microsoft Azure StorSimple, так и в Windows PowerShell для StorSimple.

После изучения этого учебника вы сможете сделать следующее.

- настраивать веб-прокси с помощью мастера установки и командлетов;
- включать веб-прокси с помощью командлетов;
- просматривать параметры веб-прокси на классическом портале Azure;
- устранять ошибки во время конфигурации веб-прокси;


## настраивать веб-прокси с помощью Windows PowerShell для StorSimple.

Для настройки параметров веб-прокси можно использовать любой из следующих вариантов.

- Мастер установки, который проведет вас по этапам конфигурации.

- Командлеты Windows PowerShell для StorSimple.

Каждый из этих методов обсуждается в следующих разделах.

## Настройка веб-прокси с помощью мастера установки

Для настройки веб-прокси можно воспользоваться мастером установки, который проведет вас по этапам конфигурации веб-прокси. Для настройки веб-прокси на своем устройстве выполните следующие действия.

#### Чтобы настроить веб-прокси с помощью мастера установки, сделайте следующее:

1. В меню последовательной консоли выберите вариант 1 **Войти с полным доступом** и укажите **пароль администратора устройства**. Введите следующую команду, чтобы запустить мастер установки сеанса:

    `Invoke-HcsSetupWizard`

2. Если мастер установки впервые используется для регистрации устройства, то перед настройкой веб-прокси будет необходимо задать все необходимые параметры сети. Если устройство уже зарегистрировано, можно принять все заданные параметры сети, после чего вы перейдете к настройке веб-прокси. В мастере установки, когда будет предложено настроить параметры веб-прокси, введите **Да**.

3. В поле **URL-адрес прокси-сервера** укажите IP-адрес или полное доменное имя (FQDN) сервера веб-прокси и номер порта TCP, который должен использоваться устройством при взаимодействии с облаком. Используйте следующий формат:

	`http://<IP address or FQDN of the web proxy server>:<TCP port number>`

	По умолчанию указан номер TCP-порта 8080.

4. Выберите тип проверки подлинности: **NTLM**, **Базовая** или **Нет**. Базовая аутентификация — наименее безопасный тип проверки подлинности для конфигурации прокси-сервера. NTLM (NT LAN Manager) — сложный протокол проверки подлинности с высокой степенью защиты, в котором для проверки подлинности пользователя используется трехсторонняя система обмена сообщениями (иногда четырехсторонняя для обеспечения дополнительной целостности). По умолчанию используется проверка подлинности NTLM. Дополнительную информацию см. в разделах [Базовая проверка подлинности](http://hc.apache.org/httpclient-3.x/authentication.html) и [Проверка подлинности NTLM](http://hc.apache.org/httpclient-3.x/authentication.html).

	> [AZURE.IMPORTANT]** Если в настройках прокси-сервера для устройства выбрана базовая проверка подлинности или проверка подлинности NTLM, то в службе диспетчера StorSimple не будут работать диаграммы мониторинга устройства. Для работы диаграмм мониторинга устройства необходимо установить тип проверки подлинности в "Нет".**

5. При использовании проверки подлинности укажите **имя пользователя веб-прокси** и **пароль веб-прокси**. Также потребуется подтвердить пароль.

	![Настройка веб-прокси на устройстве StorSimple 1](./media/storsimple-configure-web-proxy/IC751830.png)

При регистрации устройства в первый раз продолжите регистрацию с помощью мастера. Если устройство уже зарегистрировано, мастер завершит работу. Заданные параметры будут сохранены.

Веб-прокси также будет включен. Вы можете пропустить шаг [Включить веб-прокси](#enable-web-proxy) и перейти непосредственно к [просмотру параметров веб-прокси на классическом портале Azure](#view-web-proxy-settings-in-the-azure-classic-portal).


## Настройка веб-прокси с помощью Windows PowerShell для StorSimple

Альтернативный способ настройки параметров веб-прокси — с помощью командлетов Windows PowerShell для StorSimple. Чтобы настроить веб-прокси, выполните следующие действия.

#### Для настройки веб-прокси с помощью командлетов выполните следующие действия.

1. В меню последовательной консоли выберите вариант 1 **Войти с полным доступом**. При появлении запроса введите **пароль администратора устройства**. Пароль по умолчанию: `Password1`.

2. В командной строке выполните следующую команду:

	`Set-HcsWebProxy -Authentication NTLM -ConnectionURI "<http://<IP address or FQDN of web proxy server>:<TCP port number>" -Username "<Username for web proxy server>"`

	Укажите и подтвердите пароль в ответ на запрос, как показано ниже.

	![Настройка веб-прокси на устройстве StorSimple 3](./media/storsimple-configure-web-proxy/IC751831.png)

Теперь веб-прокси настроен, и его необходимо включить.

## Включение веб-прокси

По умолчанию веб-прокси отключен. После настройки параметров веб-прокси на устройстве StorSimple необходимо активировать параметры веб-прокси с помощью Windows PowerShell для StorSimple.

> [AZURE.NOTE]**Этот шаг не требуется, если для настройки веб-прокси использовался мастер установки. По умолчанию веб-прокси автоматически включается после завершения работы мастера.**

Для включения веб-прокси на своем устройстве выполните следующие действия в Windows PowerShell для StorSimple.

#### Для включения веб-прокси выполните следующие действия.

1. В меню последовательной консоли выберите вариант 1 **Войти с полным доступом**. При появлении запроса введите **пароль администратора устройства**. Пароль по умолчанию: `Password1`.

2. В командной строке выполните следующую команду:

	`Enable-HcsWebProxy`

	Теперь конфигурация веб-прокси на устройстве StorSimple активирована.

	![Настройка веб-прокси на устройстве StorSimple 4](./media/storsimple-configure-web-proxy/IC751832.png)

## Просмотр параметров веб-прокси на классическом портале Azure

Параметры веб-прокси настраиваются через интерфейс Windows PowerShell, и изменить их на классическом портале Azure нельзя. Однако там их можно просматривать. Чтобы просмотреть параметры веб-прокси, выполните следующие действия.

#### Просмотр параметров веб-прокси
1. Выберите **Служба диспетчера StorSimple > Устройства**. Выберите и щелкните устройство, затем выберите **Настройка**.
1. Прокрутите страницу **Настройка** вниз до раздела **Параметры веб-прокси**. Параметры настроенного веб-прокси на устройстве StorSimple можно просматривать так, как показано ниже.

	![Просмотр веб-прокси на портале управления](./media/storsimple-configure-web-proxy/ViewWebProxyPortal_M.png)
 
## Ошибки во время конфигурации веб-прокси

Если параметры веб-прокси заданы неправильно, пользователь увидит сообщения об ошибках в Windows PowerShell для StorSimple. В следующей таблице описаны некоторые из этих сообщений об ошибках, возможные причины ошибок и рекомендуемые действия для их устранения.

|Номер|Код ошибки HRESULT|Возможная основная причина|Рекомендуемое действие|
|:---|:---|:---|:---|
|1\.|0x80070001|Команда запускается из пассивного контроллера и не может взаимодействовать с активным контроллером.|Выполните эту команду на активном контроллере. Для выполнения команды с пассивного контроллера необходимо изменить подключение с пассивного на активный контроллер. Если установить соединение не удается, необходимо обратиться в службу поддержки Майкрософт.|
|2\.|0x800710dd — недопустимый идентификатор операции|Параметры прокси не поддерживаются на виртуальном устройстве StorSimple.|Параметры прокси не поддерживаются на виртуальном устройстве StorSimple. Их можно задать только на физическом устройстве StorSimple.|
|3\.|0x80070057 — неверный параметр|Один из параметров, указанных для настройки прокси-сервера, является недопустимым.|URI указан в неверном формате. Используйте следующий формат: `http://<IP address or FQDN of the web proxy server>:<TCP port number>`|
|4\.|0x800706ba — сервер RPC недоступен|Ниже перечислены основные возможные причины. </br></br>Кластер не функционирует.</br></br>Служба пути к данным не запущена.</br></br>Пассивный контроллер не может взаимодействовать с активным контроллером, а команда выполняется из пассивного контроллера.|Обратитесь в службу поддержки Майкрософт, чтобы убедиться, что кластер функционирует, а служба пути к данным запущена.</br></br>Выполните команду из активного контроллера. Если требуется выполнить команду из пассивного контроллера, необходимо убедиться, что он может взаимодействовать с активным контроллером. Если установить соединение не удается, необходимо обратиться в службу поддержки Майкрософт.|
|5\.|0x800706be — не удалось выполнить вызов RPC|Кластер не работает.|Обратитесь в службу поддержки Майкрософт, чтобы убедиться, что кластер работает.|
|6\.|0x8007138f — ресурс кластера не найден.|Ресурс кластера службы платформы не найден. Это может произойти при неправильной установке.|Может потребоваться выполнить сброс до заводских настроек на устройстве. Может потребоваться создание ресурса платформы. Обратитесь в службу поддержки Майкрософт, чтобы узнать, что делать дальше.|
|7\.|0x8007138c — ресурс кластера отключен от сети.|Ресурсы платформы или кластера пути данных отключены от сети.|Обратитесь в службу поддержки Майкрософт, чтобы убедиться, что служба пути к данным и служба платформы активны.|

> [AZURE.NOTE]
> 
> -  Приведенный выше список сообщений об ошибках не является исчерпывающим. 
> - Ошибки, связанные с параметрами веб-прокси, не будут отображаться на классическом портале Azure в службе диспетчера StorSimple. Если после завершения настройки возникнет проблема с веб-прокси, состояние устройства на классическом портале Azure изменится на **Не в сети**.|

## Дальнейшие действия

- Если возникают проблемы при развертывании устройства или настройке параметров веб-прокси, см. статью [Устранение неполадок в развертывании устройства StorSimple](storsimple-troubleshoot-deployment.md).

- Сведения об использовании службы диспетчера StorSimple см. в статье [Использование службы диспетчера StorSimple для администрирования устройства StorSimple](storsimple-manager-service-administration.md).

<!---HONumber=AcomDC_1203_2015-->