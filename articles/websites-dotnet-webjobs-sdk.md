<properties pageTitle="Информация о пакете SDK веб-заданий" metaKeywords="Azure Azure WebJobs SDK, Azure storage, Azure queues, Azure tables" description="Общие сведения о пакете SDK веб-заданий. В данном материале объясняется, что из себя представляет пакет инструментов SDK и в каких ситуациях он может оказаться полезным, а также приводятся примеры программного кода." metaCanonical="" services="web-sites,storage" documentationCenter=".NET" title="Информация о пакете SDK веб-заданий" authors="tdykstra" solutions="" manager="wpickett" editor="jimbe" />

<tags ms.service="web-sites" ms.workload="web" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="10/12/2014" ms.author="tdykstra" />

# Информация о пакете SDK веб-заданий

В настоящей статье объясняется, что из себя представляет пакет инструментов SDK веб-заданий, выполняется разбор нескольких наиболее характерных ситуаций, в которых он может применяться, а также приводится краткий обзор его возможного использования при разработке собственного программного кода.

## Оглавление

-   [Обзор][Обзор]
-   [Сценарии][Сценарии]
-   [Примеры кода][Примеры кода]
-   [Использование пакета SDK веб-заданий вне сферы применения веб-заданий][Использование пакета SDK веб-заданий вне сферы применения веб-заданий]
-   [Использование пакета инструментов SDK веб-заданий для вызова произвольной функции][Использование пакета инструментов SDK веб-заданий для вызова произвольной функции]
-   [Дальнейшие действия][Дальнейшие действия]

## <span id="overview"></span></a>Обзор

[WebJobs][WebJobs] — функция веб-сайтов Azure, которая позволяет запускать программу или скрипт в том же контексте, что и веб-сайт. Цель пакета SDK веб-заданий — упростить задачу написания кода, который используется в качестве веб-задания, работает с очередями, большими двоичными объектами и таблицами хранилища Azure, а также очередями служебной шины.

Пакет SDK веб-заданий содержит следующие компоненты.

-   **Пакеты NuGet**. Пакеты NuGet, которые добавляются в проект консольного приложения Visual Studio, предоставляют платформу, которую код использует для работы со службой хранилища Azure или с очередями служебной шины.

-   **Панель мониторинга**. Часть пакета SDK веб-заданий включена в веб-сайты Azure и предоставляет обширные возможности мониторинга и диагностики для программ, которые создаются с помощью пакетов NuGet. Чтобы использовать эти функции мониторинга и диагностики, не нужно писать код.

## <span id="scenarios"></span></a>Сценарии

Ниже представлены стандартные сценарии, которые можно проще обработать с помощью пакета SDK веб-заданий Azure:

-   Обработка изображений или другая нагружающая ЦП задача. Стандартной функцией веб-сайтов является возможность отправлять изображения или видео. Часто требуется изменить контент после его отправки, но вы не хотите, чтобы пользователь при этом ждал.

-   Обработка очередей. Обычно для взаимодействия внешнего сервера с внутренним используются очереди. Когда веб-сайту требуется выполнить задание, он отправляет сообщение в очередь. Служба внутреннего сервера извлекает сообщения из очереди и выполняет задание. Для обработки изображений можно использовать очереди. Когда пользователь передаст несколько файлов, поместите имена файлов в сообщение очереди, чтобы внутренний сервер мог выбрать их для обработки. Также можно использовать очереди для ускорения отклика сайта. Например, вместо записи непосредственно в базу данных SQL выполните запись в очередь, сообщите пользователю о готовности и позвольте службе внутреннего сервера обработать задание реляционной базы данных с высокой задержкой. Пример обработки очереди с процессом, работающим с изображениями, приводится в [учебнике "Начало работы с пакетом SDK веб-заданий"][учебнике "Начало работы с пакетом SDK веб-заданий"].

-   Объединение RSS-каналов. Если ваш сайт обрабатывает список RSS-каналов, можно получить все статьи из веб-каналов в фоновом процессе.

-   Обработка файлов, например, объединение или очистка файлов журнала. Файлы журнала могут быть созданы несколькими сайтами или в течение отдельных интервалов времени, которые следует совместить для запуска в них заданий анализа. Также можно запланировать еженедельную задачу для очистки старых файлов журнала.

-   Ввод данных в таблицы Azure. В системе могут находится некоторые файлы и BLOB-объекты, и может возникнуть необходимость их обработать и сохранить данные в таблицах. Функции ввода данных могут выполнять запись огромного количества строк (в некоторых случаях этот показатель может исчисляться миллионами), и пакет SDK для веб-заданий позволяет очень просто реализовать подобные функциональные возможности. Помимо этого, пакет SDK предоставляет индикаторы для отслеживания в реальном времени показателей, характеризующих ход выполнения каких-либо операций, среди которых, например, показатель количества строк, записанных в таблицу.

-   Другие долгосрочные задачи, которые необходимо запустить в фоновом потоке, например [отправка электронной почты][отправка электронной почты].

## <span id="code"></span></a> Примеры кода

Код для обработки стандартных задач, которые работают с хранилищем Azure, прост. В приложении консоли запишите методы для фоновых задач, которые следует выполнить, и добавьте в них атрибуты из пакета SDK веб-заданий. Метод `Main` создает объект `JobHost`, который координирует вызовы записываемых методов. Платформа SDK веб-заданий знает, когда следует вызывать используемые методы на основе атрибутов пакета SDK веб-заданий.

Здесь приводится пример программы, которая опрашивает очередь и для каждого полученного от очереди сообщения создает BLOB-объект.

        public static void Main()
        {
            JobHost host = new JobHost();
            host.RunAndBlock();
        }

        public static void ProcessQueueMessage([QueueTrigger("webjobsqueue")] string inputText, 
            [Blob("containername/blobname")]TextWriter writer)
        {
            writer.WriteLine(inputText);
        }

Объект `JobHost` является контейнером для набора фоновых функций. Объект `JobHost` отслеживает функции, просматривает события, которые активируют их и выполняет функции при возникновении событий активации. Метод `JobHost` вызывается, чтобы указать, следует ли запускать обработку контейнера в текущем потоке или в фоновом потоке. В этом примере метод `RunAndBlock` запускает постоянную обработку в текущем потоке.

Поскольку метод `ProcessQueueMessage` в этом примере имеет атрибут `QueueTrigger`, триггер для этой функции — получение нового сообщения очереди. Объект `JobHost` ищет новые сообщения очереди в указанной очереди ("webjobsqueue" в этом примере) и при нахождении вызывает `ProcessQueueMessage`. Атрибут `QueueTrigger` также уведомляет платформу о привязке параметра `inputText` к значению сообщения очереди:

<pre class="prettyprint">
public static void ProcessQueueMessage([QueueTrigger(&quot;webjobsqueue&quot;)]] string inputText, 
    [Blob(&quot;containername/blobname&quot;)]TextWriter writer)
</pre>

Платформа также привязывает объект `TextWriter` к большому двоичному объекту с именем "blobname" в контейнере с именем "containername":

<pre class="prettyprint">
public static void ProcessQueueMessage([QueueTrigger(&quot;webjobsqueue&quot;)]] string inputText, 
    [Blob(&quot;containername/blobname&quot;)]TextWriter writer)
</pre>

Затем функция использует эти параметры для записи значения сообщения очереди в большой двоичный объект:

        writer.WriteLine(inputText);

Функции триггера и модуля привязки пакета SDK веб-заданий значительно упрощают написание программного кода, предназначенного для работы с объектами хранилища Azure. Код низкого уровня, необходимый для обработки очередей и больших двоичных объектов, создается платформой пакета SDK веб-заданий — платформа создает очереди, которые еще не существуют, открывает очередь, читает сообщения очереди, удаляет сообщения очереди по завершении обработки, создает контейнеры больших двоичных объектов, которые еще не существуют, выполняет запись в большие двоичные объекты и т. д.

Пакет SDK веб-заданий предоставляет множество способов работы с хранилищем Azure. Например, если параметр с добавленным атрибутом `QueueTrigger` является массивом байтов или пользовательским типом, выполняется его автоматическая десериализация из JSON. Атрибут `BlobTrigger` можно также использовать для активации обработки при создании нового BLOB- объекта в учетной записи службы хранилища Azure. (Обратите внимание, что в то время как `QueueTrigger` ищет новые сообщения очереди в течение нескольких секунд, для `BlobTrigger` может потребоваться до 20 минут, чтобы обнаружить новый большой двоичный объект. `BlobTrigger` сканирует большие двоичные объекты при каждом запуске `JobHost`, а затем периодически проверяет журналы хранилища Azure для поиска новых больших двоичных объектов.)

## <span id="workerrole"></span></a>Использование пакета SDK веб-заданий вне сферы применения веб-заданий

Программа, использующая пакет SDK веб-заданий, представляет из себя стандартное консольное приложение и поэтому может работать в любой среде, при этом не обязательно в качестве веб-задания. Протестировать такую программу можно локально на компьютере разработчика, а в производственной среде ее можно запустить в рабочей роли облачной службы или службе Windows, в соответствии с предпочтениями в отношении какой-либо из этих сред.

Однако панель мониторинга доступна только как расширение сайта для веб-сайта Azure. Если необходимо запустить программу вне веб-заданий и использовать тем не менее панель мониторинга, можно настроить веб-сайт Azure Website на использование той же самой учетной записи хранения, которая указана в строке подключения панели мониторинга из пакета SDK веб-заданий. В таком случае в панели мониторинга этого сайта будет отображаться информация о ходе выполнения функций программы, которая работает в иной среде. Перейти в панель мониторинга можно по следующему URL-адресу: https://*{websitename}*.scm.azurewebsites.net/azurejobs/\#/functions. Дополнительные сведения см. в разделе [Получение панели мониторинга для локальной разработки с помощью пакета SDK веб-заданий][Получение панели мониторинга для локальной разработки с помощью пакета SDK веб-заданий], однако следует обратить внимание, что в ней приводится имя старой строки подключения.

## <span id="nostorage"></span></a>Использование пакета инструментов SDK веб-заданий для вызова произвольной функции

Пакет SDK веб-заданий может предоставить ряд преимуществ даже при отсутствии необходимости напрямую работать с очередями хранилища Azure, таблицами, BLOB-объектами или очередями сервисной шины:

-   Можно вызывать необходимые функции из панели мониторинга.
-   Можно осуществлять повторное выполнение функций из панели мониторинга.
-   Можно просматривать в панели мониторинга журналы событий, привязанные как к определенному веб-заданию (журналы приложений), так и к вызову определенных функций, которые выполняют вывод информационных сообщений в такие журналы (`TextWriter` журналы параметров).

-   С более подробной информацией можно ознакомиться в разделах: [Как вызывать функции в ручном режиме][Как вызывать функции в ручном режиме] и [Как вести журналы событий][Как вести журналы событий]

## <span id="nextsteps"></span></a>Дальнейшие действия

Дополнительные сведения о пакете SDK веб-заданий приводятся в разделе [Веб-задания Azure — рекомендуемые ресурсы][Веб-задания Azure — рекомендуемые ресурсы].

  [Обзор]: #overview
  [Сценарии]: #scenarios
  [Примеры кода]: #code
  [Использование пакета SDK веб-заданий вне сферы применения веб-заданий]: #workerrole
  [Использование пакета инструментов SDK веб-заданий для вызова произвольной функции]: #nostorage
  [Дальнейшие действия]: #nextsteps
  [WebJobs]: /ru-ru/documentation/articles/web-sites-create-web-jobs/
  [учебнике "Начало работы с пакетом SDK веб-заданий"]: ../websites-dotnet-webjobs-sdk-get-started/
  [отправка электронной почты]: https://github.com/victorhurdugaci/AzureWebJobsSamples/tree/master/SendEmailOnFailure
  [Получение панели мониторинга для локальной разработки с помощью пакета SDK веб-заданий]: http://blogs.msdn.com/b/jmstall/archive/2014/01/27/getting-a-dashboard-for-local-development-with-the-webjobs-sdk.aspx
  [Как вызывать функции в ручном режиме]: ../websites-dotnet-webjobs-sdk-storage-queues-how-to/#manual
  [Как вести журналы событий]: ../websites-dotnet-webjobs-sdk-storage-queues-how-to/#logs
  [Веб-задания Azure — рекомендуемые ресурсы]: http://go.microsoft.com/fwlink/?linkid=390226
