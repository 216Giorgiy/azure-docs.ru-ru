<properties 
	pageTitle="Подписанные URL-адреса: общие сведения о модели SAS | Microsoft Azure" 
	description="Узнайте том, как делегировать доступ к ресурсам больших двоичных объектов, очереди и таблиц с помощью подписанных URL-адресов" 
	services="storage" 
	documentationCenter="" 
	authors="tamram" 
	manager="adinah" 
	editor=""/>

<tags 
	ms.service="storage" 
	ms.workload="storage" 
	ms.tgt_pltfrm="na" 
	ms.devlang="dotnet" 
	ms.topic="article" 
	ms.date="11/10/2014" 
	ms.author="tamram"/>



# Подписанные URL-адреса, часть 1: Общие сведения о модели SAS

Подписанный URL-адрес (SAS) - это эффективное средство для предоставления другим клиентам ограниченного доступа к большим двоичным объектам, таблицам и очередям в вашей учетной записи хранения без предоставления ключа вашей учетной записи. Первая часть этого учебника по подписям общего доступа содержит обзор модели SAS и рекомендации по использованию SAS. [Часть 2](../storage-dotnet-shared-access-signature-part-2/) этого учебника содержит пошаговое описание создания подписанных URL-адресов с помощью службы BLOB-объектов.

## Что такое подпись общего доступа? ##

Подпись общего доступа обеспечивает делегированный доступ к ресурсам в вашей учетной записи хранения. Это означает, что клиенту можно предоставить ограниченное право на работу с вашими BLOB-объектами, очередями или таблицами на определенный период времени и с определенным набором разрешений, не сообщая ему ключи доступа к своей учетной записи. Подписанный URL-адрес - это универсальный код ресурса, который в своих параметрах запроса содержит всю информацию, необходимую для доступа к ресурсу хранилища с прохождением аутентификации. Для доступа к ресурсам хранилища с помощью SAS клиенту достаточно передать SAS в соответствующий конструктор или метод.

## Когда следует использовать подпись общего доступа? ##

Подпись общего доступа можно использовать, когда доступ к ресурсам в вашей учетной записи хранения требуется предоставить клиенту, которому нельзя доверить ключ учетной записи. Ключи вашей учетной записи хранения включают в себя как первичный, так и вторичный ключ, и оба этих ключа предоставляют административный доступ к вашей учетной записи и всем ее ресурсам. Предоставление любого из ключей учетной записи делает ее уязвимой вредоносного или небрежного использования. Подписанные URL-адреса обеспечивают безопасную альтернативу, позволяющую другим клиентам считывать, записывать и удалять данные в вашей учетной записи хранения в соответствии с выданными вами разрешениями и без потребности в ключе учетной записи.

Распространенным сценарием использования подписей общего доступа является служба, где пользователи считывают и записывают собственные данные в вашей учетной записи хранения. В сценарии, где в учетной записи хранения хранятся пользовательские данные, существует два направления разработки:


1\. Клиенты отправляют и загружают данные с помощью службы интерфейсного прокси-сервера, выполняющей проверку подлинности. Эта служба интерфейсного прокси-сервера позволяет проверять бизнес-правила, однако для больших объемов данных или крупных транзакций создание службы, поддерживающей масштабирование в соответствии с потребностями, может оказаться дорогостоящей или сложной задачей.

![sas-storage-fe-proxy-service][sas-storage-fe-proxy-service]

2\.	Облегченная служба проверяет подлинность клиента по мере необходимости и затем создает подпись общего доступа. Клиент, получив эту подпись общего доступа, может осуществлять прямой доступ к ресурсам учетной записи хранения с разрешениями, определенными в подписи, и в течение разрешенного подписью периода времени. Подпись общего доступа уменьшает потребность в маршрутизации всех данных через службу интерфейсного прокси-сервера.

![sas-storage-provider-service][sas-storage-provider-service]

Многие реальные службы могут совмещать эти два подхода в зависимости от ситуации: некоторые данные обрабатываются и проверяются через интерфейсный прокси-сервер, а другие данные сохраняются и/или считываются непосредственно с помощью подписи общего доступа.

## Принцип работы подписи общего доступа ##

Подпись общего доступа представляет собой URI, который указывает на ресурс хранилища и включает в себя специальный набор параметров запроса, которые указывают, как именно клиент может осуществлять доступ к ресурсу. Один из этих параметров - подпись - состоит из параметров SAS и подписывается с помощью ключа учетной записи. Эта подпись используется хранилищем Azure для проверки подлинности подписи общего доступа.

Подпись общего доступа имеет следующие определяющие ограничения, каждое из которых представлено в виде параметра URI:

- **Ресурс хранилища.** Ресурсы хранилища, для которых можно делегировать доступ, включают в себя контейнеры, большие двоичные объекты, очереди, таблицы и диапазоны сущностей таблицы.
- **Время начала действия.** Это время, начиная с которого действителен SAS. Время начала для подписанного URL-адреса указывать не обязательно. Если оно не указано, действие SAS начинается немедленно. 
- **Время окончания действия.** Это время, после которого SAS больше не действителен. Рекомендуется либо указать время окончания действия для SAS, либо связать его с хранимой политикой доступа (см. подробности ниже).
- **Разрешения.** Разрешения, заданные для подписанного URL-адреса, указывают операции, которые клиент может выполнять с ресурсами хранилища с помощью этого подписанного URL-адреса.

Вот пример URI подписи общего доступа, который предоставляет разрешения на чтение и запись в BLOB-объект. В таблице описана каждая из частей URI, чтобы можно было понять ее роль в работе подписи общего доступа:

https://myaccount.blob.core.windows.net/sascontainer/sasblob.txt?sv=2012-02-12&st=2013-04-29T22%3A18%3A26Z&se=2013-04-30T02%3A23%3A26Z&sr=b&sp=rw&sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D

<table border="1" cellpadding="0" cellspacing="0">
    <tbody>
        <tr>
            <td valign="top" width="213">
                <p>
                    URI BLOB-объекта
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    https://myaccount.blob.core.windows.net/sascontainer/sasblob.txt
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Адрес BLOB-объекта. Обратите внимание, что настоятельно рекомендуется использовать HTTPS.
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Версия служб хранилища
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    sv=2012-02-12
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Для служб хранилища версии 2012-02-12 и более поздней этот параметр указывает используемую версию.
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Время начала
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    st=2013-04-29T22%3A18%3A26Z
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Указывается в формате ISO 8061. Чтобы подпись общего доступа вступала в силу сразу же, не указывайте время начала действия.
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Время окончания срока действия
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    se=2013-04-30T02%3A23%3A26Z
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Указывается в формате ISO 8061.
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Ресурс
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    sr=b
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Ресурс является BLOB-объектом.
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Разрешения
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    sp=rw
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Разрешения, предоставляемые подписью общего доступа, включают в себя чтение (r) и запись (w).
                </p>
            </td>
        </tr>
        <tr>
            <td valign="top" width="213">
                <p>
                    Подпись
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D
                </p>
            </td>
            <td valign="top" width="213">
                <p>
                    Используется для проверки подлинности доступа к BLOB-объекту. Подпись представляет собой код HMAC, рассчитанный по алгоритму SHA256 с использованием ключа и преобразования строки в символы. Полученное значение преобразуется в кодировку Base64.
                </p>
            </td>
        </tr>
    </tbody>
</table>


## Управление подписями общего доступа с помощью хранимой политики доступа ##

Подпись общего доступа может принимать одну из двух форм:

- **Одноранговый SAS.** При создании однорангового SAS его время начала действия, время окончания действия и разрешения указываются в универсальном коде ресурса (URI) SAS (или подразумеваются в случае, когда время начала опускается).
- **SAS с хранимой политикой доступа.** Хранимая политика доступа определяется для контейнера ресурсов (контейнера больших двоичных объектов, таблицы или очереди) и может использоваться для управления ограничениями для одного или нескольких подписанных URL-адресов. Когда вы связываете SAS с хранимой политикой доступа, SAS наследует ограничения - время начала действия, время окончания действия и разрешения, которые определены для этой политики.

Различие между этими двумя формами важно для одного ключевого сценария - отзыва. Подписанный URL-адрес - это URL-адрес, которым может воспользоваться любой получивший его человек, независимо от того, кто изначально запрашивал такую подпись. Если подпись общего доступа обнародуется, ее может использовать любой человек в мире. Распространяемая подпись общего доступа действительна до тех пор, пока не произойдет одно из четырех возможных событий:

1.	Наступает время истечения срока действия, указанное для данной подписи общего доступа.
2.	Наступает время истечения срока действия, указанное в хранимой политике доступа, на которую ссылается подпись общего доступа (если имеется ссылка на хранимую политику доступа, в которой задано время окончания срока действия). Это может произойти либо из-за истечения заданного времени, либо из-за изменения хранимой политики доступа и переноса времени окончания срока действия в прошлое, что является одним из способов отозвать подпись общего доступа.
3.	Удаляется хранимая политика доступа, на которую ссылается подпись, что является другим способом отозвать подпись общего доступа. Заметьте, что при повторном создании хранимой политики доступа с таким же именем все существующие маркеры подписи общего доступа снова станут действительными в соответствии с разрешениями, связанными с этой хранимой политикой доступа (предполагается, что время окончания срока действия для подписи общего доступа еще не истекло). Если планируется отозвать подпись общего доступа, следует использовать другое имя при повторном создании политики доступа, у которой время окончания срока действия относится к будущему.
4.	Повторно создается ключ учетной записи, который был использован для создания подписи общего доступа.  Обратите внимание, что это приведет к неспособности всех компонентов приложения, которые используют этот ключ учетной записи, пройти проверку подлинности до тех пор, пока они не будут обновлены для использования другого действительного ключа учетной записи или вновь созданного ключа учетной записи.
 
## Рекомендации по использованию подписей общего доступа ##

При использовании подписей общего доступа в приложениях необходимо иметь в виду две потенциальные проблемы:

- В случае утечки подписи ей сможет пользоваться любой человек, что потенциально может нарушить безопасность вашей учетной записи хранения.
- Если срок действия подписи, предоставленной клиентскому приложению, истекает и приложение не может получить новую подпись из вашей службы, это может нарушить работу приложения.  

Следующие рекомендации по использованию подписи общего доступа помогут нейтрализовать эти риски:

1. **Всегда используйте HTTPS** для создания SAS или его распространения.  Если подпись передается по протоколу HTTP и перехватывается, посредством атак " злоумышленник в середине" злоумышленник сможет считать подпись и затем использовать ее вместо предполагаемого пользователя, что может привести к раскрытию конфиденциальных данных или к повреждению данных злоумышленником.
2. **Используйте ссылки на хранимые политики доступа, где возможно.** Хранимые политики доступа дают возможность отзывать разрешения, не создавая ключи учетных записей хранения заново. Задайте для них очень большой (или бесконечный) срок действия и убедитесь, что он регулярно обновляется, чтобы сдвигать его в будущее.
3. **Используйте краткосрочные одноранговые SAS.** Таким образом, даже если SAS был невольно скопрометирован, он будет действовать короткое время. Такая методика особенно важна, если вы не можете использовать ссылку на хранимую политику доступа. Также этот подход помогает ограничить объем данных, которые можно записать в большой двоичный объект, так как ограничивает время, доступное для передачи в него данных.
4. **Пусть клиенты автоматически обновлять SAS, когда это необходимо.** Клиентам следует обновлять SAS задолго до ожидаемого окончания его действия, чтобы иметь время на повторные попытки на случай, если служба, предоставляющая SAS, будет недоступна. Если ваш SAS предназначен для небольшого числа мгновенных, краткосрочных операций, которые должны быть выполнены в течение указанного срока действия, то этого можно и не делать, так как SAS не должен успеть обновиться. Тем не менее, если у вас есть клиенты, которые регулярно делают запросы через SAS, то становится актуальной вероятность, что срока его действия истечет. Основная идея - сбалансировать потребность в краткосрочности SAS (как описано выше) и потребность в том, чтобы клиент запрашивал обновление достаточно рано, чтобы избежать прерывания работы из-за того, срок действия SAS истечет до успешного обновления.
5. **Внимательно используйте время начала действия SAS.** Если вы зададите для SAS время начала действия **сейчас**, то из-за расфазировки синхронизирующих импульсов (разницы текущего времени на разных компьютерах) первые несколько минут могут наблюдаться сбои. Обычно следует задать время начала на 15 минут раньше текущего времени или вообще не задавать его. Тогда в любом случае SAS станет действителен сразу же. То же самое обычно относится и ко времени окончания действия: помните, что в течение 15 минут для любого запроса может наблюдаться расфазировка синхронизирующих импульсов в любом направлении. Обратите внимание, что для клиентов, использующих REST версии ниже 2012-02-12, максимальная длительность действия SAS, который не ссылается на хранимую политику доступа, равна 1 часу, и любые политики, задающие большую длительность, не сработают.
6.	**Точно определяйте ресурсы, которым предоставляется доступ.** Обычная рекомендация для системы безопасности - предоставлять пользователю минимальные необходимые привилегии. Если пользователю нужен только доступ для чтения одной сущности, то предоставьте ему доступ для чтения этой сущности, а не доступ для чтения, записи и удаления всех сущностей. Это также помогает снизить риск компрометирования SAS, так как SAS имеет меньше силы в руках хакера.
7.	**Поймите, что счета для вашей учетной записи будут выставляться за любое использование, в том числе с применением SAS.** Если вы предоставляете доступ для записи к большому двоичному объекту, пользователь может решить передать большой двоичный объект размером 200 ГБ. Если вы предоставили ему еще и доступ для чтения, он может скачать этот объект 10 раз, что означает расходы на 2 ТБ входных данных. Опять же, предоставляйте ограниченные ограничения, чтобы уменьшить риск от потенциальных атак хакеров. Используйте краткосрочные SAS, чтобы снизить эту угрозу (но помните о расфазировке синхронизирующих импульсов для времени окончания действия).
8.	**Проверяйте записанные данные с помощью SAS.** Когда клиентское приложение записывает данные в вашу учетную запись хранения, помните, что с этими данными могут возникнуть проблемы. Если для вашего приложения требуется, чтобы эти данные были проверены или авторизованы, прежде чем будут готовы к использованию, вам следует выполнять эту проверку после записи данных и до того, как они будут использованы приложением. Такая методика также защищает от записи поврежденных или вредоносных данных в вашу учетную запись - как пользователем, который правомерно получил SAS, так и пользователем, использующим полученный из-за утечки данных SAS.
9. **Не нужно везде использовать SAS.** Иногда риски, связанные с определенной операцией с вашей учетной записью хранения, перевешивают преимущества SAS. Для таких операций создайте службу среднего уровня, которая записывает данные в вашу учетную запись хранения после прохождения проверки бизнес-правил, аутентификации и аудита. Кроме того, иногда проще управлять доступом иными способами. Например, если вы хотите сделать все большие двоичные объекты в контейнере общедоступными для чтения, то можете сделать контейнер общедоступным, а не предоставлять каждому клиенту SAS для доступа.
10.	**Используйте аналитику хранилища для мониторинга своего приложения.** Вы можете вести журнал и использовать метрики, чтобы наблюдать любые пики сбоев аутентификации, происходящих из-за недоступности службы поставщика SAS или неумышленного удаления хранимой политики доступа. Дополнительную информацию см. в [блоге рабочей группы службы хранилища Azure](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/08/03/windows-azure-storage-logging-using-logs-to-track-storage-requests.aspx).

## Заключение ##

Подписанные URL-адреса удобно применять в целях предоставления ограниченных разрешений для вашей учетной записи хранения тем клиентам, которые нельзя передавать ключ учетной записи.  Таким образом, они являются важной частью модели обеспечения безопасности для любого приложения, использующего хранилище Azure.  Если следовать указанным здесь рекомендациям, подписи общего доступа позволяют повысить гибкость доступа к ресурсам в вашей учетной записи хранения без ущерба для безопасности приложения.

## Дальнейшие действия ##

[Подписи общего доступа. Часть 2: создание и использование подписи общего доступа с помощью службы BLOB-объектов](../storage-dotnet-shared-access-signature-part-2/)

[Управление доступом к ресурсам хранилища Azure](http://msdn.microsoft.com/ru-ru/library/windowsazure/ee393343.aspx)

[Делегирование доступа с помощью подписи общего доступа (REST API)](http://msdn.microsoft.com/ru-ru/library/windowsazure/ee395415.aspx)

[Знакомство с подписью общего доступа для таблиц и очередей](http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas.aspx)
[sas-storage-fe-proxy-service]: ./media/storage-dotnet-shared-access-signature-part-1/sas-storage-fe-proxy-service.png
[sas-storage-provider-service]: ./media/storage-dotnet-shared-access-signature-part-1/sas-storage-provider-service.png



<!--HONumber=42-->
