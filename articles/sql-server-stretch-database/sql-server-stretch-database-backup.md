<properties
	pageTitle="Архивация баз данных с поддержкой переноса | Microsoft Azure"
	description="Узнайте, как архивировать базы данных с поддержкой переноса."
	services="sql-server-stretch-database"
	documentationCenter=""
	authors="douglaslMS"
	manager=""
	editor=""/>

<tags
	ms.service="sql-server-stretch-database"
	ms.workload="data-management"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="06/14/2016"
	ms.author="douglasl"/>

# Архивация баз данных с поддержкой переноса

Резервные копии баз данных позволяют восстановить данные после различного рода сбоев, ошибок и аварий.

-   Необходимо архивировать базы данных SQL Server с поддержкой переноса.  

-   Microsoft Azure автоматически архивирует удаленные данные, которые база данных Stretch перенесла из SQL Server в Azure.

>    [AZURE.NOTE] Архивация — лишь часть полноценного решения, обеспечивающего высокий уровень доступности и непрерывность бизнес-процессов. Дополнительные сведения о высоком уровне доступности см. в разделе [Решения высокого уровня доступности (SQL Server)](https://msdn.microsoft.com/library/ms190202.aspx).

## Архивация данных SQL Server  

Для архивации баз данных с поддержкой переноса можно продолжать использовать методы архивации SQL Server, которые вы используете. Дополнительные сведения см. в разделе [Резервное копирование и восстановление баз данных SQL Server](https://msdn.microsoft.com/library/ms187048.aspx).

Резервные копии базы данных SQL Server с поддержкой переноса содержат только локальные и пригодные для переноса на момент архивации данные. (Пригодные данные — это данные, которые не были перенесены, но будут перенесены в Azure в соответствии с параметрами переноса таблиц.) Это **неполная** резервная копия, которая не включает в себя данные, уже перенесенные в Azure.

## Архивация удаленных данных Azure   

Microsoft Azure автоматически архивирует удаленные данные, которые база данных Stretch перенесла из SQL Server в Azure.

### Azure уменьшает риск потери данных с помощью автоматической архивации  
Служба базы данных SQL Server Stretch в Azure защищает удаленные базы данных с помощью автоматического создания моментальных снимков хранилища по крайней мере каждые 8 часов. Каждый моментальный снимок хранится в течение 7 дней, что обеспечивает ряд возможных точек восстановления.

### Azure уменьшает риск потери данных с помощью геоизбыточности  
Резервные копии баз данных Azure хранятся в геоизбыточной службе хранилища Azure (RA-GRS) и, следовательно, геоизбыточны по умолчанию. Геоизбыточное хранилище реплицирует данные во вторичный регион, который находится в сотнях километров от первичного региона. В основном и дополнительном регионах данные реплицируются трижды на разных доменах сбоя и доменах обновления. Это гарантирует, что данные будут доступны даже при полном региональном сбое или аварии, когда один из регионов Azure станет недоступен.

### <a name="stretchRPO"></a>База данных Stretch снижает риск потери данных Azure за счет временного хранения перенесенных строк
После того, как база данных Stretch перенесет пригодные строки из SQL Server в Azure, она хранит их в промежуточной таблице не менее 8 часов. В случае восстановления резервной копии базы данных Azure база данных Stretch использует строки, сохраненные в промежуточной таблице, для согласования баз данных SQL Server и Azure.

После восстановления резервной копии данных Azure необходимо выполнить хранимую процедуру [sys.sp\_rda\_reauthorize\_db](https://msdn.microsoft.com/library/mt131016.aspx) для повторного подключения базы данных SQL Server с поддержкой переноса к удаленной базе данных Azure. При выполнении **sys.sp\_rda\_reauthorize\_db** база данных Stretch автоматически согласовывает базы данных SQL Server и Azure.

Чтобы увеличить период временного хранения в промежуточной таблице данных, перенесенных базой данных Stretch, выполните хранимую процедуру [sys.sp\_rda\_set\_rpo\_duration](https://msdn.microsoft.com/library/mt707766.aspx) и укажите число часов больше 8. Чтобы решить, как долго следует хранить данные, учтите следующие факторы:
-   частота автоматической архивации Azure (по крайней мере каждые 8 часов);
-   время, необходимое для распознавания возникшей проблемы и принятия решения о восстановлении резервной копии;
-   длительность операции восстановления Azure.

> [AZURE.NOTE] Увеличение объема данных, которые база данных Stretch временно хранит в промежуточной таблице, увеличивает требуемый объем пространства SQL Server.

Чтобы узнать, сколько часов данные, перенесенные базой данных Stretch, хранятся в промежуточной таблице в настоящее время, выполните хранимую процедуру [sys.sp\_rda\_get\_rpo\_duration](https://msdn.microsoft.com/library/mt707767.aspx).

## См. также

[Управляйте растяжением баз данных и устраняйте неполадки](sql-server-stretch-database-manage.md)

[sys.sp\_rda\_reauthorize\_db (Transact-SQL)](https://msdn.microsoft.com/library/mt131016.aspx)

[Архивация и восстановление баз данных SQL Server](https://msdn.microsoft.com/library/ms187048.aspx)

<!---HONumber=AcomDC_0615_2016-->