<properties
	pageTitle="Включение растяжения базы данных для базы данных | Microsoft Azure"
	description="Узнайте, как настроить базу данных для растяжения базы данных."
	services="sql-server-stretch-database"
	documentationCenter=""
	authors="douglaslMS"
	manager=""
	editor=""/>

<tags
	ms.service="sql-server-stretch-database"
	ms.workload="data-management"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="06/27/2016"
	ms.author="douglasl"/>

# Включение растяжения базы данных для базы данных

Чтобы настроить существующую базу данных для использования базы данных Stretch, выберите **Задачи | Stretch | Включить** для базы данных в SQL Server Management Studio. После этого откроется мастер **включения переноса для базы данных**. Для включения растяжения базы данных для базы данных также можно использовать Transact-SQL.

Если при выборе **Задачи > Перенос > Включить** для отдельной таблицы база данных Stretch для базы данных еще не включена, то мастер сначала настроит базу данных для использования базы данных Stretch и позволит выбрать таблицы в ходе этого процесса. В этом случае следуйте указаниям в этом разделе вместо действий, описанных в разделе [Включение растяжения базы данных для таблицы](sql-server-stretch-database-enable-database.md).

Для включения растяжения базы данных для базы данных или таблицы требуются разрешения db\_owner. Для включения растяжения базы данных для базы данных также требуются разрешения CONTROL DATABASE.

## Необходимые условия

-   Перед настройкой базы данных для растяжения рекомендуется запустить Помощник по растяжению базы данных для определения баз данных и таблиц, к которым можно применить растяжение. Помощник по растяжению баз данных также определит критические препятствия. Дополнительные сведения см. в разделе [Определение баз данных и таблиц для растяжения базы данных](sql-server-stretch-database-identify-databases.md).

-   Ознакомьтесь с [ограничениями базы данных Stretch](sql-server-stretch-database-limitations.md).

-   При растяжении баз данных выполняется перенос данных в Azure. Поэтому необходимо иметь учетную запись Azure и подписку для выставления счетов. Для получения учетной записи Azure щелкните [здесь](http://azure.microsoft.com/pricing/free-trial/).

-   Подготовьте данные подключения и имени для входа, необходимые для создания нового сервера Azure, или выберите существующий сервер Azure.

## <a name="EnableTSQLServer"></a>Необходимое условие: включение базы данных Stretch на сервере
Перед включением растяжения базы данных для базы данных или таблицы необходимо включить его на локальном сервере. Эта операция требует разрешений sysadmin или serveradmin.

-   При наличии необходимых разрешений администратора мастер **Включение базы данных для растяжения** настроит сервер для растяжения.

-   Если у вас нет необходимых разрешений, администратор должен вручную включить эту возможность, выполнив **sp\_configure** перед запуском мастера, или должен запустить мастер самостоятельно.

Чтобы включить растяжение базы данных на сервере вручную, выполните **sp\_configure** и включите возможность **Архив удаленных данных**. В следующем примере включается возможность **Архив удаленных данных** путем изменения значения соответствующего параметра на 1.

```
EXEC sp_configure 'remote data archive' , '1';
GO
RECONFIGURE;
GO
```
Дополнительные сведения см. в разделе [Настройка параметра конфигурации сервера "Архива удаленных данных"](https://msdn.microsoft.com/library/mt143175.aspx) и [Команда sp\_configure (Transact-SQL)](https://msdn.microsoft.com/library/ms188787.aspx).

## <a name="Wizard"></a>Включение растяжения базы данных для базы данных с помощью мастера
Сведения о мастере включения переноса для базы данных, включая информацию, которую необходимо ввести, и варианты, которые нужно выбрать, приведены в разделе [Начало работы с запуска мастера "Включение базы данных Stretch"](sql-server-stretch-database-wizard.md).

## <a name="EnableTSQLDatabase"></a>Включение растяжения базы данных для базы данных с помощью Transact-SQL
Перед включением растяжения базы данных для отдельных таблиц необходимо включить его для базы данных.

Для включения растяжения базы данных для базы данных или таблицы требуются разрешения db\_owner. Для включения растяжения базы данных для базы данных также требуются разрешения CONTROL DATABASE.

1.  Прежде чем начать, выберите существующий или создайте новый сервер Azure для данных, которые будут перенесены базой данных Stretch.

2.  На сервере Azure создайте правило брандмауэра с диапазоном IP-адресов сервера SQL Server. Это правило позволит SQL Server обмениваться данными с удаленным сервером.

3.  Для настройки растяжения базы данных сервера SQL Server у базы данных должен быть главный ключ базы данных. Главный ключ базы данных защищает учетные данные, используемые для подключения к удаленной базе данных, использующей растяжение базы данных. Ниже приведен пример, который создает новый главный ключ базы данных.

    ```tsql
    USE <database>;
    GO

    CREATE MASTER KEY ENCRYPTION BY PASSWORD ='<password>';
	GO
    ```

    Дополнительные сведения о главном ключе базы данных см. в статьях [CREATE MASTER KEY (Transact-SQL)](https://msdn.microsoft.com/library/ms174382.aspx) и [Создание главного ключа базы данных](https://msdn.microsoft.com/library/aa337551.aspx).

4.  При настройке базы данных для растяжения необходимо предоставить учетные данные, которые будут использоваться для обмена данными между локальным SQL Server и удаленным сервером Azure. Это можно сделать двумя способами.

    -   Можно указать учетные данные администратора.

        -   Если вы включаете растяжение с помощью мастера, можно указать учетные данные с помощью мастера.

        -   Если вы собираетесь включить базу данных Stretch с помощью инструкции **ALTER DATABASE**, то перед этим необходимо создать учетные данные вручную.

		Ниже приведен пример, который создает новые учетные данные.

        ```tsql
        CREATE DATABASE SCOPED CREDENTIAL <db_scoped_credential_name>
            WITH IDENTITY = '<identity>' , SECRET = '<secret>';
        GO
        ```

		Дополнительные сведения об учетных данных см. в статье [CREATE DATABASE SCOPED CREDENTIAL (Transact-SQL)](https://msdn.microsoft.com/library/mt270260.aspx). Для создания учетных данных необходимы разрешения ALTER ANY CREDENTIAL.

    -   Для взаимодействия сервера SQL Server с удаленным сервером Azure можно использовать учетную запись службы федерации при выполнении всех условий, перечисленных ниже.

        -   Учетная запись службы, под которой выполняется экземпляр SQL Server, является учетной записью домена.

        -   Учетная запись домена принадлежит к тому домену, каталог Active Directory которого включен в федерацию с Azure Active Directory.

        -   Удаленный сервер Azure настроен для поддержки проверки подлинности Azure Active Directory.

        -   Учетная запись службы, под которой выполняется экземпляр SQL Server, должна быть настроена как dbmanager или sysadmin на удаленном сервере Azure.

5.  Для настройки растяжения базы данных для базы данных выполните инструкцию ALTER DATABASE.

    1.  В качестве аргумента SERVER укажите имя существующего сервера Azure, включая часть имени `.database.windows.net`, например `MyStretchDatabaseServer.database.windows.net`.

    2.  Укажите существующие учетные данные администратора в аргументе CREDENTIAL или укажите FEDERATED\_SERVICE\_ACCOUNT = ON. В примере ниже приведены существующие учетные данные.

    ```tsql
    ALTER DATABASE <database name>
        SET REMOTE_DATA_ARCHIVE = ON
            (
                SERVER = '<server_name>',
                CREDENTIAL = <db_scoped_credential_name>
            ) ;
    GO
    ```

## Дальнейшие действия
-   Выполните инструкции из статьи [Включение растяжения базы данных для таблицы](sql-server-stretch-database-enable-table.md), чтобы включить перенос для дополнительных таблиц.

-   Выполните инструкции из раздела [Мониторинг базы данных Stretch](sql-server-stretch-database-monitor.md) для просмотра состояния переноса данных.

-   [Приостановите и возобновите растяжение баз данных](sql-server-stretch-database-pause.md)

-   [Управляйте растяжением баз данных и устраняйте неполадки](sql-server-stretch-database-manage.md)

-   [Архивация баз данных с поддержкой переноса](sql-server-stretch-database-backup.md)

## См. также

[Identify databases and tables for Stretch Database](sql-server-stretch-database-identify-databases.md)

[Параметры ALTER DATABASE SET (Transact-SQL)](https://msdn.microsoft.com/library/bb522682.aspx)

<!---HONumber=AcomDC_0629_2016-->