<properties
	pageTitle="Хранение кода проекта серверной части JavaScript в системе управления версиями | Мобильные службы Azure"
	description="Узнайте, как сохранить файлы серверных сценариев и модулей в локальном репозитории Git на компьютере."
	services="mobile-services"
	documentationCenter=""
	authors="ggailey777"
	manager="dwrede"
	editor=""/>

<tags
	ms.service="mobile-services"
	ms.workload="mobile"
	ms.tgt_pltfrm="na"
	ms.devlang="multiple"
	ms.topic="article"
	ms.date="09/15/2015" 
	ms.author="ggailey777"/>

# Хранение кода проекта мобильной службы в системе управления версиями

> [AZURE.SELECTOR]
- [.NET backend](mobile-services-dotnet-backend-store-code-source-control.md)
- [Javascript backend](mobile-services-store-scripts-source-control.md)

В этом разделе показано, как использовать систему управления версиями, предоставляемую мобильными службами Azure, для хранения серверных сценариев. Сценарии и другие фоновые файлы кода JavaScript могут назначаться из локального репозитория вашей рабочей мобильной службе. В нем также показано, как определить общий код, который может потребоваться нескольким сценариям, и как использовать файл package.json для добавления модулей Node.js в мобильную службу.

Мобильную службу для работы с этим учебником вы должны были создать при изучении учебника [Приступая к работе с мобильными службами].

##<a name="enable-source-control"></a>Включение системы управления версиями в вашей мобильной службе

[AZURE.INCLUDE [mobile-services-enable-source-control](../../includes/mobile-services-enable-source-control.md)]

##<a name="clone-repo"></a>Установка Git и создание локального репозитория

1. Установите Git на локальном компьютере.

	Действия, необходимые для установки Git, отличаются в разных операционных системах. Сведения о дистрибутивах для разных операционных систем и руководство по установке см. в разделе [Установка Git].

	> [AZURE.NOTE]В некоторых операционных системах доступны обе версии Git — для командной строки и с графическим интерфейсом. В инструкциях, приведенных в данной статье, используется версия для командной строки.

2. Откройте окно командной строки, например **GitBash** (Windows) или **Bash** (оболочка Unix). На компьютерах с OS X доступ к командной строке можно получить через приложение **Terminal**.

3. В командной строке перейдите в каталог, где будут храниться сценарии. Пример: `cd SourceControl`.

4. Используйте следующую команду для создания локальной копии нового репозитория Git, заменив `<your_git_URL>` на URL-адрес репозитория Git для своей мобильной службы:

		git clone <your_git_URL>

5. При отображении запроса введите имя пользователя и пароль, заданные при включении системы управления версиями в вашей мобильной службе. После успешной проверки подлинности должна отобразиться последовательность ответов:

		remote: Counting objects: 8, done.
		remote: Compressing objects: 100% (4/4), done.
		remote: Total 8 (delta 1), reused 0 (delta 0)
		Unpacking objects: 100% (8/8), done.

6. Перейдите в каталог, из которого вы выполнили команду `git clone`, и обратите внимание на следующую структуру каталогов:

	![4\.][4]

	В этом случае новый каталог создается с именем мобильной службы, которая является локальным репозиторием для службы данных.

7. Откройте вложенную папку .\\service\\table и обратите внимание на то, что она содержит файл TodoItem.json, который является представлением JSON разрешений операции в таблице TodoItem.

	Если в этой таблице определены серверные скрипты, будет присутствовать один или несколько файлов с именем <code>TodoItem._&lt;operation&gt;_.js</code>, содержащих скрипты для данной операции таблицы. Планировщик и скрипты настраиваемого интерфейса API сохраняются в отдельных папках с соответствующими именами. Дополнительные сведения см. в разделе [Управление версиями].

После создания локального репозитория можно внести изменения в серверные скрипты и доставлять изменения обратно в мобильную службу.

##<a name="deploy-scripts"></a>Развертывание обновленных файлов скриптов в вашей мобильной службе

1. Перейдите во вложенную папку .\\service\\table и, если файл todoitem.insert.js не существует, создайте его.

2. Откройте в текстовом редакторе новый файл todoitem.insert.js, вставьте следующий код и сохраните изменения:

		function insert(item, user, request) {
		    request.execute();
		    console.log(JSON.stringify(item, null, 4));
		}

	Этот код просто записывает вставленный элемент в журнал. Если этот файл уже содержит код, просто добавьте в файл допустимый код JavaScript, например вызов `console.log()`, и сохраните изменения.

3. В командной строке Git введите следующую команду, чтобы запустить отслеживание нового файла сценария:

		$ git add .


4. Введите следующую команду, чтобы сохранить изменения:

		$ git commit -m "updated the insert script"

5. Введите следующую команду, чтобы передать изменения в удаленный репозиторий:

		$ git push origin master

	Вы увидите ряд команд, который указывает, что фиксация развертывается в мобильной службе.

6. На портале управления откройте вкладку **Данные**, щелкните таблицу **TodoItem**, затем — элемент **Скрипт** и выберите операцию **Вставить**. Обратите внимание на то, что отображаемый скрипт операции вставки совпадает с кодом JavaScript, отправленным в репозиторий.

##<a name="use-npm"></a>Использование общего кода и модулей Node.js в серверных скриптах

Мобильные службы предоставляют доступ к полному набору основных модулей Node.js, которые можно использовать в коде с помощью функции **require**. Мобильная служба может также использовать модули Node.js, которые не являются частью основного пакета Node.js, кроме того, вы даже можете определить свой общий код как модули Node.js. Дополнительные сведения о создании модулей см. в разделе [Модули] в справочной документации по Node.js API.

Советуем добавлять модули Node.js в мобильную службу, добавляя ссылки в ее файл package.json. После этого нужно будет добавить модуль Node.js [node-uuid] в свою мобильную службу, обновив файл package.json. Когда в Azure будет передано push-уведомление об обновлении, мобильная служба будет перезапущена, после чего будет установлен модуль. Этот модуль используется для создания нового значения GUID для свойства **uuid** вставленных элементов.

2. Перейдите к папке `.\service` в локальном репозитории Git и откройте файл package.json в текстовом редакторе. Затем добавьте следующее поле в объект **dependencies**:

		"node-uuid": "~1.4.3"

	>[AZURE.NOTE]Это обновление файла package.json перезапустит мобильную службу после выполнения фиксации.

4. Теперь перейдите к вложенной папке .\\service\\table, откройте файл todoitem.insert.js и внесите следующие изменения:

		function insert(item, user, request) {
		    var uuid = require('node-uuid');
		    item.uuid = uuid.v1();
		    request.execute();
		    console.log(item);
		}

	Этот код добавляет в таблицу столбец uuid, заполняя его уникальными идентификаторами GUID.

5. Как и в предыдущем разделе, введите следующую команду в командной строке Git:

		$ git add .
		$ git commit -m "added node-uuid module"
		$ git push origin master

	Это добавляет новый файл, фиксирует изменения, а также отправляет новый модуль node-uuid и изменения скрипта todoitem.insert.js в вашу мобильную службу.

## <a name="next-steps"> </a>Дальнейшие действия

Теперь, когда вы завершили этот учебник, вы знаете, как сохранять скрипты в системе управления версиями. Рекомендуем получить дополнительные сведения о работе с серверными скриптами и настраиваемыми интерфейсами API:

+ [Работа с серверными сценариями в мобильных службах] <br/>Узнайте, как работать с серверными сценариями, планировщиком заданий и настраиваемыми интерфейсами API.

<!-- Anchors. -->
[Enable source control in your mobile service]: #enable-source-control
[Install Git and create the local repository]: #clone-repo
[Deploy updated script files to your mobile service]: #deploy-scripts
[Leverage shared code and Node.js modules in your server scripts]: #use-npm

<!-- Images. -->
[4]: ./media/mobile-services-store-scripts-source-control/mobile-source-local-repo.png
[5]: ./media/mobile-services-store-scripts-source-control/mobile-portal-data-tables.png
[6]: ./media/mobile-services-store-scripts-source-control/mobile-insert-script-source-control.png

<!-- URLs. -->
[Git website]: http://git-scm.com
[Управление версиями]: http://msdn.microsoft.com/library/windowsazure/c25aaede-c1f0-4004-8b78-113708761643
[Установка Git]: http://git-scm.com/book/en/Getting-Started-Installing-Git
[Приступая к работе с мобильными службами]: mobile-services-ios-get-started.md
[Работа с серверными сценариями в мобильных службах]: mobile-services-how-to-use-server-scripts.md
[Azure Management Portal]: https://manage.windowsazure.com/
[Модули]: http://nodejs.org/api/modules.html
[node-uuid]: https://npmjs.org/package/node-uuid

<!---HONumber=Oct15_HO3-->