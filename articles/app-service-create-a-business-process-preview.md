<properties 
	pageTitle="Создание бизнес-процесса" 
	description="Создание бизнес-процесса" 
	authors="stepsic-microsoft-com" 
	manager="dwrede" 
	editor="" 
	services="app-service-logic" 
	documentationCenter=""/>



<tags
	ms.service="app-service-logic"
	ms.workload="web"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="02/24/2015"
	ms.author="stepsic"/>

# Разработка бизнес-процесса с помощью потоковых приложений и приложений API

Вы создали простой поток, но теперь хотите сделать бизнес-процесс с помощью потоковых приложений. В этой статье будут охвачены несколько основных тем.

- Добавление условной логики (например, выполнение действий только при определенном условии) и циклов
- Приложения API BizTalk
- Использование представления кода для изменения потока
- Разные типы триггеров

Чтобы начать работу, щелкните здесь и создайте в подписке элемент с уже заполненным потоком. После создания этого потока щелкните триггеры и действия, чтобы изменить его.

## Добавление условной логики и циклов

Хотя простой поток работает нормально, вы могли заметить пару проблем. Для начала, он отправляет только самый популярный твит, а не все твиты по ключевому слову. Чтобы повторить действие для списка элементов, можно использовать свойство repeat.

### Использование repeat

Свойство repeat получает список элементов и выполняет действие для каждого элемента в этом списке. Чтобы использовать repeat, щелкните значок круговой стрелки в верхней части действия. Откроется текстовое поле, в котором нужно ввести:

    @triggers().outputs.body

Как и в простом потоке, будет выведен список твитов. Затем, чтобы действительно использовать твит в действии, замените сообщение следующим:

    @repeatItem().message

repeatItem() - это функция, которая выведет все элементы в списке. Щелкните значок галочки.

### Условная логика

Тем не менее этот поток может все еще быть неудобным, так как он приведет к большому количеству писем. Вы можете добавить дополнительную логику, чтобы получать письма, только если автор твита имеет определенное количество подписчиков. Для этого щелкните значок ромба в верхней части действия. 

В текстовом поле введите:

    @greaterThan(repeatItem().person.followers, 1000)

Отобразится функция repeatItem(), а также новая функция greaterThan(). Эта функция сравнивает два значения и разрешит выполнение действия, только если первое значение больше второго. Обратите внимание на синтаксис для получения подписчиков: добавьте в каждое интересующее вас свойство имя свойства с предшествующей точкой. Установите флажок, чтобы сохранить условие.

## Приложения API BizTalk

Существует несколько разных категорий приложений API, доступных в Azure. Twitter и Office 365 - отличные соединители для этого сценария, но BizTalk также предоставляет ряд приложений API, которые можно использовать в потоке.

Щелкните службу XXXXXX в правой области. Служба на платформе BizTalk будет добавлена в конструктор.

### Передача данных между действиями

Чтобы использовать больше одного действия в потоке, потребуется передать данные между действиями. Это можно сделать с помощью функции actions(). 

После добавления действия XXXXXX введите:

    @actions('SendMail').outputs.YYYYYY

Свойство YYYYYY будет передано из выходных данных действия SendMail. Вы всегда можете просмотреть имя действия под значком этого действия. Аналогично можно просмотреть все выходные данные для этого действия в нижней части поля.

## Использование представления кода для изменения потока

Кроме конструктора можно вручную и напрямую изменить определение потока. Для этого нажмите кнопку "Представление кода" в панели команд. Откроется полный редактор с определением только что измененного потока.

Текстовый редактор может упростить некоторые операции, например, вы можете скопировать и вставить любое количество действий в одном потоке (или даже между потоками). Вы можете также легко добавить или удалить все разделы из потока.

### Параметры

Некоторые возможности доступны только в представлении кода, например параметры. Параметры упрощают повторное использование значений в потоке. Например, если вы хотите включить адрес электронной почты в несколько действий, его можно превратить в параметр.

Чтобы задать параметры, перейдите к строке "parameters {} object" и добавьте в нее:
    "emailAddress" : {
	    "type" : "string",
	    "defaultValue" : "me@example.com"
    }

Теперь прокрутите экран к действию отправки электронной почты. Здесь будут отображаться входные данные для электронной почты. Замените адрес электронной почты на:

    @parameters('emailAddress')

Параметры - это хороший способ извлечения значений, которые вы планируете часто изменять.

## Разные типы триггеров

Существует несколько разных способов запуска потоков, поведение каждого из которых несколько отличается, поэтому будьте внимательны при их выборе для сценариев.

### Опрос триггеров

Некоторые триггеры проверяют приложение API на основе определенного интервала. Вы можете определить этот интервал, но необходимо также передать поле с именем "triggerState". Состояние триггера - это информация, которая передается в вызов триггера, о том, что было возвращено во время предыдущей проверки. Состояние триггера обычно является строкой:

    @triggers().outputs.body.triggerState

### Обратный вызов триггеров

Другие триггеры выполняют обратный вызов потока при получении нового запроса. В этом случае необходимо предоставить триггеру URI обратного вызова потока. Чтобы получить его, скопируйте конечную точку доступа из колонки "Свойства" экрана "Параметры" при переходе к потоку. 

### Вызов вручную

Кроме того, вы можете запустить поток вручную. На портале нажмите кнопку "Запустить", чтобы запустить поток. 

<!--HONumber=49-->