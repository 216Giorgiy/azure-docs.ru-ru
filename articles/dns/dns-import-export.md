<properties
   pageTitle="Импорт и экспорт файла зоны домена с помощью Azure DNS | Microsoft Azure"
   description="Узнайте, как импортировать файл зоны DNS в Azure DNS и экспортировать его оттуда с помощью интерфейса командной строки Azure."
   services="dns"
   documentationCenter="na"
   authors="joaoma"
   manager="carmonm"
   editor=""/>

<tags
   ms.service="dns"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="01/11/2016"
   ms.author="jonatul"/>

# Импорт и экспорт файла зоны DNS


В этом руководстве показано, как импортировать файлы зоны DNS в Azure DNS и экспортировать их оттуда.

## Общие сведения о миграции зоны DNS

Файл зоны DNS — текстовый файл, содержащий сведения о каждой записи DNS в зоне. Он соответствует стандартному формату и позволяет передавать записи DNS в разные системы DNS. Использование файла зоны — это быстрый, надежный и удобный способ передачи зоны DNS в Azure DNS или в обратном направлении.

Azure DNS поддерживает импорт и экспорт файла зоны с помощью интерфейса командной строки Azure. В статье описывается использование этой функции.

Интерфейс командной строки Azure — это кроссплатформенное средство для управления службами Azure. Для платформ Windows, Mac и Linux средство можно скачать на [странице загрузок Azure](https://azure.microsoft.com/downloads/). Поддержка разных платформ особенно важна при экспорте и импорте файла зоны, так как наиболее распространенное программное обеспечение сервера доменных имен ([BIND](https://www.isc.org/downloads/bind/)) обычно выполняется в системе Linux.

## Получение существующего файла зоны DNS

Прежде чем импортировать файл зоны DNS в Azure DNS, необходимо получить копию файла зоны. Источник этого файла будет зависеть от текущего размещения зоны DNS. Например:

- Если для размещения зоны DNS используется сторонняя служба (например, регистратор доменных имен, поставщик услуг размещения DNS или альтернативный поставщик облачных служб), такая служба должна поддерживать загрузку файла зоны DNS.
-	Если для размещения зоны DNS используется DNS-сервер Windows, по умолчанию файлы зоны можно найти в папке **%systemroot%\\system32\\dns**. Полный путь к каждому файлу зоны также отображается на вкладке "Общие" консоли управления службы DNS.
-	Если для размещения зоны DNS используется BIND, расположение файла зоны для каждой зоны задается в файле **named.conf** конфигурации BIND. 

>[AZURE.NOTE]Файлы зоны, загруженные из GoDaddy, отличаются нестандартным форматом. Это нужно исправить перед импортом таких файлов в Azure DNS. В частности, имена DNS в формате RDATA для каждой записи DNS указываются как полные имена, но без точки в конце. Это означает, что они интерпретируются другими системами DNS как относительные имена. Необходимо изменить файл зоны, добавив точку в конце каждого имени перед их импортом в Azure DNS.

## Импорт файла зоны DNS в Azure DNS

Команда Azure CLI для импорта зоны DNS имеет формат `azure network dns zone import [options] <resource group> <zone name> <zone file name>`, где:

- **resource group** — имя группы ресурсов для зоны в Azure DNS;
- **zone name** — имя зоны;
- **zone file name** — путь/имя импортируемого файла зоны.

Если зона с таким именем не существует в группе ресурсов, она будет создана автоматически. Если зона существует, импортированные наборы записей будут объединены с существующими наборами. Чтобы перезаписать существующие наборы записей, используйте параметр --force. Подробные сведения об [объединении наборов записей](#merging-with-existing-data) см. ниже.

Чтобы проверить формат файла зоны, не импортируя его, используйте параметр --parse-only.

## Пошаговый процесс импорта файла зоны в Azure DNS

Рассмотрим пример. Предположим, вам нужно импортировать файл зоны в зону contoso.com.

### Шаг 1
Вход в подписку Azure с помощью интерфейса командной строки Azure.

	azure login

### Шаг 2
Выбор подписки, в рамках которой будет создана зона DNS.

	azure account set <subscription name>

### Шаг 3.
Azure DNS — это служба, управляемая диспетчером ресурсов Azure (ARM), поэтому Azure CLI необходимо переключить в режим ARM.

	azure config mode arm

### Шаг 4.
Прежде чем использовать службу Azure DNS, необходимо зарегистрировать подписку для использования поставщика ресурсов Microsoft.Network (эта операция выполняется только один раз для каждой подписки).

	azure provider register Microsoft.Network

### Шаг 5 
Если у вас еще нет группы ресурсов ARM, создайте ее.
	
	azure group create myresourcegroup westeurope

### Шаг 6	
Чтобы импортировать зону contoso.com из файла contoso.com.txt в зону DNS в группе ресурсов myresourcegroup, выполните команду `azure network dns zone import`.

	azure network dns zone import myresourcegroup contoso.com contoso.com.txt

Эта команда загрузит файл зоны, проанализирует его, а затем выполнит в службе Azure DNS ряд команд, чтобы создать зону и все наборы записей в ней.

Команда будет сообщать о ходе выполнения в окне консоли, а также отображать все ошибки и предупреждения. Так как наборы записей создаются в серии, при импорте большого файла зоны этот процесс может занять несколько минут.

## Проверка зоны DNS после импорта

Вы можете получить список записей, используя следующую команду командной строки Azure (это также можно сделать с помощью PowerShell: `Get-AzureRmDnsRecordSet`).

	azure network dns record-set list myresourcegroup contoso.com

А команда nlookup поможет вам проверить разрешение имен для записей. Так как зоны еще не делегированы, вам нужно явно указать правильные серверы имен Azure DNS. В примере ниже показано, как получить имена серверов, назначенных зоне, и запросить запись www с помощью команды nslookup:

	C:\>azure network dns record-set show myresourcegroup contoso.com @ NS
	info:    Executing command network dns record-set show
	+ Looking up the DNS Record Set "@" of type "NS"
	data:    Id: /subscriptions/…/resourceGroups/myresourcegroup/providers/Microsoft.Network/dnszones/contoso.com/NS/@
	data:    Name                            : @
	data:    Type                            : Microsoft.Network/dnszones/NS
	data:    Location                        : global
	data:    TTL                             : 3600
	data:    NS records
	data:        Name server domain name     : ns1-01.azure-dns.com
	data:        Name server domain name     : ns2-01.azure-dns.net
	data:        Name server domain name     : ns3-01.azure-dns.org
	data:        Name server domain name     : ns4-01.azure-dns.info
	data:
	info:    network dns record-set show command OK

	C:\> nslookup www.contoso.com ns1-01.azure-dns.com

	Server: ns1-01.azure-dns.com
	Address:  40.90.4.1

	Name:    www.contoso.com
	Addresses:  134.170.185.46
            134.170.188.221

После проверки правильности импорта зоны требуется [обновить делегирование DNS](dns-domain-delegation.md), чтобы указать серверы имен Azure DNS.

## Объединение с существующими данными

Импорт файла зоны создает зону в Azure DNS, если таковая не существует. Если зона существует, наборы записей в файле зоны нужно объединить с существующими наборами. Поведение при объединении выглядит так.

1.	По умолчанию объединяются существующие и новые наборы записей. Одинаковые записи в рамках объединенного набора записей дедуплицируются.
2.	Если вы укажете параметр --force, процесс импорта будет заменять существующие наборы записей новыми. Существующие наборы записей, у которых нет соответствующих наборов записей в импортированном файле зоны, удаляться не будут.
3.	В объединенных наборах записей используется значение TTL существующих наборов записей. При использовании параметра --force задается значение TTL нового набора записей.
4.	Параметры SOA (кроме параметра host) всегда берутся из импортированного файла зоны (независимо от использования параметра --force). Аналогичным образом для набора записей сервера имен на вершине зоны значение TTL всегда извлекается из импортированного файла зоны.
5.	Импортированная запись CNAME не заменяет существующую запись CNAME с тем же именем, если только не указан параметр --force.
6.	Когда возникает конфликт между записью CNAME и другой записью с таким же именем, но другим типом (независимо от того, новая она или существующая), сохраняется существующая запись. Это определяется параметром --force.

## Дополнительные технические сведения
Ниже приведены дополнительные технические сведения о процессе импорта зоны.

1.	Директива $TTL является необязательной; она поддерживается. Если директива $TTL не указывается, записи без явного значения TTL будут импортированы со стандартным значением TTL (3600 секунд). Если в одном наборе записей есть две записи с разными значениями TTL, используется меньшее значение.
2.	Директива $ORIGIN является необязательной; она поддерживается. Если директива $ORIGIN не указывается, используется стандартное значение — имя зоны, указанное в командной строке (с точкой в конце).
3.	Директивы $INCLUDE и $GENERATE не поддерживаются.
4.	Поддерживаются следующие типы записей: A, AAAA, CNAME, MX, NS, SOA, SRV, TXT.  
5.	Запись типа SOA автоматически создается в Azure DNS во время создания зоны. При импорте файла зоны из него извлекаются все параметры SOA, КРОМЕ параметра host, который использует значение, предоставляемое Azure DNS. Это происходит, потому что данный параметр должен ссылаться на первичный сервер имен, предоставляемый Azure DNS.
6.	Набор записей серверных имен в вершине зоны также создается службой Azure DNS автоматически во время создания зоны. Импортируется только значение TTL этого набора записей. Эти записи содержат серверные имена, предоставляемые службой Azure DNS. Следовательно, значения записей не перезаписываются значениями, содержащимися в импортированном файле зоны.
7.	Так как в режиме общедоступной предварительной версии Azure DNS поддерживает только одностроковые записи TXT, многостроковые записи TXT будут объединены и обрезаны до 255 знаков.

## Экспорт файла зоны DNS из Azure DNS

Команда Azure CLI для экспорта зоны DNS имеет формат `azure network dns zone export [options] <resource group> <zone name> <zone file name>`, где:

- **resource group** — имя группы ресурсов для зоны в Azure DNS;
- **zone name** — имя зоны;
- **zone file name** — путь и имя экспортируемого файла зоны.

## Пошаговые инструкции по экспорту файла Azure DNS
 
Как и при импорте зоны, сначала нам нужно выполнить вход, выбрать подписку и настроить Azure CLI для использования в режиме ARM.

### Шаг 1
Вход в подписку Azure с помощью интерфейса командной строки Azure.

	azure login

### Шаг 2
Выбор подписки, в рамках которой будет создана зона DNS.

	azure account set <subscription name>

### Шаг 3.
Azure DNS — это служба, управляемая диспетчером ресурсов Azure (ARM), поэтому Azure CLI необходимо переключить в режим ARM.

	azure config mode arm
### Шаг 4.
Чтобы экспортировать существующую зону Azure DNS contoso.com (в группе ресурсов myresourcegroup) в файл contoso.com.txt (в текущей папке), выполните команду `azure network dns zone export`.

	azure network dns zone export myresourcegroup contoso.com contoso.com.txt

Эта команда вызывает службу Azure DNS для перечисления наборов записей в зоне и экспорта результатов в файл зоны, совместимый с форматом BIND.

<!---HONumber=AcomDC_0114_2016-->