<properties
   pageTitle="Делегирование домена в Azure DNS | Microsoft Azure"
   description="Узнайте, как изменить делегирование домена и использовать серверы имен Azure DNS для размещения домена"
   services="dns"
   documentationCenter="na"
   authors="joaoma"
   manager="Adinah"
   editor=""/>

<tags
   ms.service="dns"
   ms.devlang="na"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="04/28/2015"
   ms.author="joaoma"/>


# Делегирование домена в Azure DNS

Azure DNS — это служба размещения для доменов DNS. Чтобы запросы DNS для домена достигали Azure DNS, домен должен быть делегирован в Azure DNS из родительского домена. На этой странице объясняется, как работает делегирование домена, и показано, как это делается в Azure DNS.


## Принципы делегирования DNS

### Домены и зоны

Домен — это уникальное имя в службе доменных имен, например "contoso.com". Регистратор доменных имен — это организация, которая может предоставлять доменные имена в Интернете. Она проверяет, доступен ли интернет-домен, который вы хотите использовать, и позволяет приобрести его. После регистрации имени домена вы станете законным владельцем доменного имени. Если у вас уже есть интернет-домен, вы будете использовать текущего регистратора доменных имен для делегирования в Azure DNS.

>[AZURE.NOTE]Подробные сведения об определении владельца доменного имени и о том, как приобрести домен, см. в разделе [Управление доменами Интернета в Azure AD](https://msdn.microsoft.com/library/azure/hh969248.aspx).

Зона DNS используется для размещения DNS-записей определенного домена. Например, домен contoso.com может содержать несколько записей DNS, таких как mail.contoso.com (для почтового сервера) и www.contoso.com (для веб-сайта).

Azure DNS позволяет размещать зону DNS и тем самым управлять записями DNS для домена в Azure. Помните, что Azure DNS — это не регистратор доменных имен.

Система доменных имен — это иерархия доменов. Иерархия начинается с "корневого" домена, имя которого — просто ".". Ниже находятся домены верхнего уровня, такие как com, net, org, uk и jp. Под ними расположены домены второго уровня, например org.uk и co.jp. И т. д.

Домены в иерархии DNS размещаются с помощью отдельных зон DNS. Эти зоны глобально распределены на DNS-серверах по всему миру.

### Разрешение и делегирование

Существует два типа DNS-серверов:

- _Полномочный_ DNS-сервер содержит зоны DNS. Он отвечает на запросы DNS для записей только в этих зонах.
- _Рекурсивный_ DNS-сервер не содержит зоны DNS. Он отвечает на все запросы DNS, вызывая полномочные DNS-серверы для сбора необходимых данных.

DNS-клиенты на ПК или мобильных устройствах обычно вызывают рекурсивный DNS-сервер для выполнения любых запросов DNS, необходимых клиентским приложениям.

Когда рекурсивный DNS-сервер получает запрос записи DNS, например www.contoso.com, сначала ему необходимо найти имя сервера, на котором размещается зона для домена contoso.com. Для этого он начинает с серверов корневых имен и находит серверы имен, на которых размещается зона com. Затем он запрашивает серверы имен com, чтобы найти серверы имен с зоной contoso.com. Наконец, он может запросить у этих серверов имен домен www.contoso.com.

Это называется разрешение DNS-имени (строго говоря, разрешение DNS-имен включает в себя дополнительные действия, такие как отслеживание записей CNAME, но это неважно для понимания того, как работает делегирование DNS).

Как родительская зона "указывает" на серверы имен для дочерней зоны? Это делается с помощью специального типа записи DNS, которая называется записью NS (NS — это сервер имен). Например, корневая зона содержит записи NS для com, предоставляя сервера имен для зоны com. В свою очередь, зона com содержит записи NS для contoso.com, предоставляя сервера имен для зоны contoso.com. Настройку записей NS для дочерней зоны в родительской зоне называется делегирование домена.

См. рисунок ниже:

![Сервер имен DNS](./media/dns-domain-delegation/image1.png)

У каждого делегирования на самом деле две копии записи NS: одна в родительской зоне, указывающая на дочернюю зону, а другая в самой дочерней зоне. То есть зона contoso.com содержит записи NS для contoso.com (в дополнение к записям NS в зоне com). Они называются полномочными записями NS и располагаются на вершине дочерней зоны.


## Делегирование домена службе Azure DNS

После создания зоны в DNS в службе Azure DNS вам необходимо настроить записи NS в родительской зоне, чтобы сделать Azure DNS полномочным источником для разрешения имен вашей зоны. Для доменов, приобретенных у регистратора доменных имен, эти записи может настроить сам регистратор.

>[AZURE.NOTE]Для создания зоны DNS с таким именем домена в Azure DNS необязательно быть владельцем домена. Однако вам необходимо быть владельцем домена, чтобы настроить делегирование в Azure DNS у регистратора доменных имен.

Предположим, например, что вы приобретаете домен contoso.com и создаете зону с именем contoso.com в Azure DNS. Регистратор предоставляет вам как владельцу домена возможность настройки адресов серверов имен (т. е. записи NS) для домена. Регистратор будет хранить эти записи NS в родительском домене, в данном случае это ".com". Клиенты по всему миру будут направляться в ваш домен в зоне Azure DNS при попытке разрешить DNS-записей в contoso.com.

Чтобы настроить делегирование, вам необходимо знать имена серверов имен для зоны. Служба Azure DNS выделяет серверы имен из пула при каждом создании зоны и сохраняет их в полномочным записях NS, которые автоматически создаются в вашей зоне. Таким образом, чтобы увидеть серверы имен, необходимо просто получить эти записи.

С помощью Azure PowerShell полномочные записи NS можно получить следующим образом (имя записи "@" используется для указания на записи на вершине зоны):

	PS C:> $zone = New-AzureDnsZone –Name contoso.com –ResourceGroupName MyAzureResourceGroup
	PS C:> Get-AzureDnsRecordSet –Name “@” –RecordType NS –Zone $zone

	Name              : @
	ZoneName          : contoso.com
	ResourceGroupName : MyResourceGroup
	Ttl               : 3600
	Etag              : 5fe92e48-cc76-4912-a78c-7652d362ca18
	RecordType        : NS
	Records           : {ns1-04.azure-dns.com, ns2-04.azure-dns.net, ns3-04.azure-dns.org,
                     ns4-04.azure-dns.info}
	Tags              : {}

В этом примере зоне contoso.com назначены сервера имен ns1-04.azure-dns.com, ns2 04.azure DNS-сервера .net, ns3-04.azure-dns.org, и ns4-04.azure-dns.info.

У каждого регистратора есть собственные средства управления DNS для изменения записей серверов имен домена. На странице управления DNS регистратора замените записи NS на созданные службой Azure DNS.

После завершения делегирования вы можете проверить, работает ли разрешение имен, с помощью средства, например nslookup, запросив запись SOA для вашей зоны (которая также создается автоматически при создании зоны).

Обратите внимание, что вам не требуется указывать серверы имен Azure DNS, так стандартный процесс разрешения DNS находит их автоматически, если делегирование настроено правильно.

	PS C:> nslookup –type=SOA contoso.com

	Server: ns1-04.azure-dns.com
	Address: 208.76.47.4

	contoso.com
	primary name server = ns1-04.azure-dns.com
	responsible mail addr = msnhst.microsoft.com
	serial = 1
	refresh = 900 (15 mins)
	retry = 300 (5 mins)
	expire = 604800 (7 days)
	default TTL = 300 (5 mins)

## Делегирование поддоменов в Azure DNS

Предположим, что, настроив и делегировав «contoso.com» в Azure DNS, вы хотите настроить отдельную дочернюю зону «partners.contoso.com». Процесс делегирования при этом похож на обычное делегирование.

1. Создайте в Azure DNS дочернюю зону «partners.contoso.com».
2. Поищите заслуживающие доверия записи сервера имен в дочерней зоне, чтобы получить список серверов имен, в которых в Azure DNS размещена дочерняя зона.
3. Выполните делегирование дочерней зоны. Для этого настройте записи сервера имен в родительской зоне, указывающей на дочернюю.

Единственное отличие появляется на третьем этапе. Записи сервера имен на этом этапе нужно создать в родительской зоне «contoso.com» в Azure DNS, а не настраивать в регистраторе доменных имен.

Этот процесс продемонстрирован в приведенном ниже примере PowerShell. Сначала нужно создать родительскую и дочернюю зоны, при этом они могут находиться в одной и той же группе ресурсов или в разных группах.

	PS C:> $parent = New-AzureDnsZone -Name contoso.com -ResourceGroupName RG1
	PS C:> $child = New-AzureDnsZone -Name partners.contoso.com -ResourceGroupName RG1

После этого нужно получить заслуживающие доверия записи сервера имен из дочерней зоны.

	PS C:> $child_ns_recordset = Get-AzureDnsRecordSet -Zone $child -Name "@" -RecordType NS

Наконец, чтобы завершить делегирование, в родительской зоне нужно создать соответствующий набор записей сервера имен (обратите внимание, что имя набора записей в родительской зоне совпадает с именем дочерней зоны, которая в этом случае названа «partners»).

	PS C:> $parent_ns_recordset = New-AzureDnsRecordSet -Zone $parent -Name "partners" -RecordType NS -Ttl 3600
	PS C:> $parent_ns_recordset.Records = $child_ns_recordset.Records
	PS C:> Set-AzureDnsRecordSet -RecordSet $parent_ns_recordset 

Чтобы убедиться в корректности настройки зоны, нужно, как и при делегировании с помощью регистратора доменных имен, найти начальную запись дочерней зоны.

	PS C:> nslookup –type=SOA partners.contoso.com
	
	Server: ns1-08.azure-dns.com
	Address: 208.76.47.8
	
	partners.contoso.com
		primary name server = ns1-08.azure-dns.com
		responsible mail addr = msnhst.microsoft.com
		serial = 1
		refresh = 900 (15 mins)
		retry = 300 (5 mins)
		expire = 604800 (7 days)
		default TTL = 300 (5 mins)

## Дальнейшие действия

[Управление зонами DNS](../dns-operations-dnszones)

[Управление зонами DNS](../dns-operations-recordsets)

[Обзор диспетчера трафика](../traffic-manager-overview)

[Автоматизация операций Azure с помощью пакета SDK для .NET](../dns-sdk)

[Справочник по REST API службы Azure DNS](https://msdn.microsoft.com/library/azure/mt163862.aspx)
 

<!---HONumber=July15_HO3-->