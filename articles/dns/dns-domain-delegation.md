<properties
   pageTitle="Делегирование домена в Azure DNS | Microsoft Azure"
   description="Узнайте, как изменить делегирование домена и использовать серверы имен Azure DNS для размещения домена."
   services="dns"
   documentationCenter="na"
   authors="cherylmc"
   manager="carmonm"
   editor=""/>

<tags
   ms.service="dns"
   ms.devlang="na"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="06/30/2016"
   ms.author="cherylmc"/>


# Делегирование домена в Azure DNS

Azure DNS позволяет размещать зону DNS и управлять записями DNS для домена в Azure. Чтобы запросы DNS для домена достигали Azure DNS, домен должен быть делегирован в Azure DNS из родительского домена. Помните, что Azure DNS — это не регистратор доменных имен. В этой статье объясняется принцип работы делегирования домена и показано, как делегировать домены в Azure DNS.




## Принципы делегирования DNS

### Домены и зоны

Система доменных имен — это иерархия доменов. Иерархия начинается с "корневого" домена с именем **.***. Ниже находятся домены верхнего уровня, такие как com, net, org, uk и jp. Под ними расположены домены второго уровня, например org.uk и co.jp. И т. д. Домены в иерархии DNS размещаются с помощью отдельных зон DNS. Эти зоны глобально распределены на DNS-серверах по всему миру.

**Зона DNS**

Домен — это уникальное имя в службе доменных имен, например "contoso.com". Зона DNS используется для размещения DNS-записей определенного домена. Например, домен contoso.com может содержать несколько записей DNS, таких как mail.contoso.com (для почтового сервера) и www.contoso.com (для веб-сайта).

**Регистратор домена**

Регистратор доменных имен — это организация, которая может предоставлять доменные имена в Интернете. Она проверяет, доступен ли интернет-домен, который вы хотите использовать, и позволяет приобрести его. После регистрации имени домена вы станете законным владельцем доменного имени. Если у вас уже есть интернет-домен, вы будете использовать текущего регистратора доменных имен для делегирования в Azure DNS.

>[AZURE.NOTE] Подробные сведения об определении владельца доменного имени и о том, как приобрести домен, см. в разделе [Управление доменами Интернета в Azure AD](https://msdn.microsoft.com/library/azure/hh969248.aspx).

### Разрешение и делегирование

Существует два следующих типа DNS-серверов.

- _Полномочный_ DNS-сервер содержит зоны DNS. Он отвечает на запросы DNS для записей только в этих зонах.
- _Рекурсивный_ DNS-сервер не содержит зоны DNS. Он отвечает на все запросы DNS, вызывая полномочные DNS-серверы для сбора необходимых данных.

DNS-клиенты на ПК или мобильных устройствах обычно вызывают рекурсивный DNS-сервер для выполнения любых запросов DNS, необходимых клиентским приложениям.

Когда рекурсивный DNS-сервер получает запрос записи DNS, например www.contoso.com, сначала ему необходимо найти имя сервера, на котором размещается зона для домена contoso.com. Для этого он начинает с серверов корневых имен и находит серверы имен, на которых размещается зона com. Затем он запрашивает серверы имен com, чтобы найти серверы имен с зоной contoso.com. Наконец, он может запросить у этих серверов имен домен www.contoso.com.

Это называется разрешением DNS-имени. Строго говоря, разрешение DNS-имен включает в себя дополнительные действия, такие как отслеживание записей CNAME, но это неважно для понимания того, как работает делегирование DNS.

Как родительская зона "указывает" на серверы имен для дочерней зоны? Это делается с помощью специального типа записи DNS, которая называется записью NS (NS — это сервер имен). Например, корневая зона содержит записи NS для com и предоставляет сервера имен для зоны com. В свою очередь, зона com содержит записи NS для contoso.com, предоставляя серверы имен для зоны contoso.com. Настройку записей NS для дочерней зоны в родительской зоне называется делегирование домена.


![Сервер имен DNS](./media/dns-domain-delegation/image1.png)

У каждого делегирования на самом деле две копии записи NS: одна в родительской зоне, указывающая на дочернюю зону, а другая в самой дочерней зоне. Зона contoso.com содержит записи NS для contoso.com (в дополнение к записям NS в зоне com). Они называются полномочными записями NS и располагаются на вершине дочерней зоны.


## Делегирование домена службе Azure DNS

После создания зоны в DNS в службе Azure DNS вам необходимо настроить записи NS в родительской зоне, чтобы сделать Azure DNS полномочным источником для разрешения имен вашей зоны. Для доменов, приобретенных у регистратора доменных имен, эти записи может настроить сам регистратор.

>[AZURE.NOTE] Для создания зоны DNS с таким именем домена в Azure DNS необязательно быть владельцем домена. Однако вам необходимо быть владельцем домена, чтобы настроить делегирование в Azure DNS у регистратора доменных имен.

Предположим, например, что вы приобретаете домен contoso.com и создаете зону с именем contoso.com в Azure DNS. Регистратор предоставляет вам как владельцу домена возможность настройки адресов серверов имен (то есть записи NS) для домена. Регистратор будет хранить эти записи NS в родительском домене, в данном случае это ".com". Клиенты по всему миру будут направляться в ваш домен в зоне Azure DNS при попытке разрешить DNS-записей в contoso.com.

### Поиск имен сервера имен

Прежде чем делегировать зоны DNS в службу DNS Azure, сначала необходимо знать имена серверов имен зоны. Когда создается зона, служба DNS Azure выделяет серверы имен из пула.

Узнать, какие серверы имен выделены для зоны, проще всего при помощи портала Azure. В этом примере зоне contoso.com назначены серверы имен ns1-01.azure-dns.com, ns2-01.azure-dns.net, ns3-01.azure-dns.org и ns4-01.azure-dns.info.

 ![Сервер имен DNS](./media/dns-domain-delegation/viewzonens500.png)

Служба DNS Azure автоматически создает в вашей зоне заслуживающие доверия NS-записи, в которых указаны выделенные серверы имен. Чтобы увидеть серверы имен через Azure PowerShell или интерфейс командной строки Azure, необходимо просто получить эти записи.

С помощью Azure PowerShell полномочные записи NS можно получить следующим образом. Обратите внимание, что имя записи @ используется для указания записей на вершине зоны.

	PS> $zone = Get-AzureRmDnsZone –Name contoso.net –ResourceGroupName MyResourceGroup
	PS> Get-AzureRmDnsRecordSet –Name “@” –RecordType NS –Zone $zone

	Name              : @
	ZoneName          : contoso.net
	ResourceGroupName : MyResourceGroup
	Ttl               : 3600
	Etag              : 5fe92e48-cc76-4912-a78c-7652d362ca18
	RecordType        : NS
	Records           : {ns1-01.azure-dns.com, ns2-01.azure-dns.net, ns3-01.azure-dns.org,
                        ns4-01.azure-dns.info}
	Tags              : {}

NS-записи, из которых можно узнать, какие серверы имен назначены вашей зоне, вы можете получить также при помощи кроссплатформенного интерфейса командной строки Azure.

	C:\> azure network dns record-set show MyResourceGroup contoso.net @ NS
	info:    Executing command network dns record-set show
		+ Looking up the DNS Record Set "@" of type "NS"
	data:    Id                              : /subscriptions/.../resourceGroups/MyResourceGroup/providers/Microsoft.Network/dnszones/contoso.net/NS/@
	data:    Name                            : @
	data:    Type                            : Microsoft.Network/dnszones/NS
	data:    Location                        : global
	data:    TTL                             : 172800
	data:    NS records
	data:        Name server domain name     : ns1-01.azure-dns.com.
	data:        Name server domain name     : ns2-01.azure-dns.net.
	data:        Name server domain name     : ns3-01.azure-dns.org.
	data:        Name server domain name     : ns4-01.azure-dns.info.
	data:
	info:    network dns record-set show command OK

### Настройка делегирования

У каждого регистратора есть собственные средства управления DNS для изменения записей серверов имен домена. На странице управления DNS регистратора замените записи NS на созданные службой Azure DNS.

При делегировании домена службе Azure DNS вам необходимо использовать имена серверов доменных имен, предоставленные службой Azure DNS. Рекомендуется всегда использовать все 4 имени серверов доменных имен независимо от имени домена. Для делегирования домена не требуется, чтобы в имени сервера доменных имен и вашем домене содержался один и тот же домен верхнего уровня.

Не используйте "связующие записи" для указания IP-адресов сервера доменных имен Azure DNS, поскольку эти IP-адреса в будущем могут измениться. Делегирование с использованием имен серверов доменных имен в собственной зоне (также известны как серверы личных имен) в настоящее время не поддерживается в Azure DNS.

### Проверка работы разрешения имен

После завершения делегирования можно проверить, работает ли разрешение имен. Это можно сделать с помощью средства, например nslookup, запросив запись типа SOA для вашей зоны (которая также создается автоматически при создании зоны).

Обратите внимание, что вам не требуется указывать серверы имен Azure DNS, так стандартный процесс разрешения DNS находит их автоматически, если делегирование настроено правильно.

	nslookup –type=SOA contoso.com

	Server: ns1-04.azure-dns.com
	Address: 208.76.47.4

	contoso.com
	primary name server = ns1-04.azure-dns.com
	responsible mail addr = msnhst.microsoft.com
	serial = 1
	refresh = 900 (15 mins)
	retry = 300 (5 mins)
	expire = 604800 (7 days)
	default TTL = 300 (5 mins)

## Делегирование поддоменов в Azure DNS

Если нужно настроить отдельную дочернюю зону, можно делегировать поддомен в Azure DNS. Предположим, что, настроив и делегировав contoso.com в Azure DNS, требуется настроить отдельную дочернюю зону partners.contoso.com.

Настройка поддомена похожа на обычное делегирование. Единственное отличие появляется на третьем этапе. Записи сервера имен на этом этапе нужно создать в родительской зоне "contoso.com" в Azure DNS, а не настраивать в регистраторе доменных имен.


1. Создайте в Azure DNS дочернюю зону "partners.contoso.com".
2. Поищите заслуживающие доверия записи сервера имен в дочерней зоне, чтобы получить список серверов имен, в которых в Azure DNS размещена дочерняя зона.
3. Выполните делегирование дочерней зоны. Для этого настройте записи сервера имен в родительской зоне, указывающей на дочернюю.


### Делегирование поддомена

Этот процесс продемонстрирован в приведенном ниже примере PowerShell. Эти же действия можно выполнить с помощью портала Azure или кроссплатформенного интерфейса командной строки Azure.

#### Шаг 1. Создание родительской и дочерней зон

Сначала мы создаем родительскую и дочернюю зоны. Их можно создать в одной или в разных группах ресурсов.

	$parent = New-AzureRmDnsZone -Name contoso.com -ResourceGroupName RG1
	$child = New-AzureRmDnsZone -Name partners.contoso.com -ResourceGroupName RG1

#### Шаг 2. Получение записей NS

После этого нужно получить заслуживающие доверия записи NS из дочерней зоны, как показано в следующем примере. В этих записях указаны серверы имен, выделенные дочерней зоне.

	$child_ns_recordset = Get-AzureRmDnsRecordSet -Zone $child -Name "@" -RecordType NS

#### Шаг 3. Делегирование дочерней зоны

Создайте набор записей NS в родительской зоне, чтобы завершить делегирование. Обратите внимание, что имя набора записей в родительской зоне соответствует имени дочерней зоны (в этом случае partners).

	$parent_ns_recordset = New-AzureRmDnsRecordSet -Zone $parent -Name "partners" -RecordType NS -Ttl 3600
	$parent_ns_recordset.Records = $child_ns_recordset.Records
	Set-AzureRmDnsRecordSet -RecordSet $parent_ns_recordset

### Проверка работы разрешения имен

Чтобы убедиться в правильности настройки зоны, нужно найти запись типа SOA дочерней зоны.

	nslookup –type=SOA partners.contoso.com

	Server: ns1-08.azure-dns.com
	Address: 208.76.47.8

	partners.contoso.com
		primary name server = ns1-08.azure-dns.com
		responsible mail addr = msnhst.microsoft.com
		serial = 1
		refresh = 900 (15 mins)
		retry = 300 (5 mins)
		expire = 604800 (7 days)
		default TTL = 300 (5 mins)

## Дальнейшие действия

[Управление зонами DNS](dns-operations-dnszones.md)

[Управление зонами DNS](dns-operations-recordsets.md)

<!---HONumber=AcomDC_0706_2016-->