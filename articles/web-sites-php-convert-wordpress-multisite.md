<properties 
	pageTitle="Преобразование WordPress в Мультисайт в службе приложений Azure" 
	description="Узнайте, как преобразовать существующее веб-приложение WordPress, созданное с помощью коллекции в Azure, в Мультисайт WordPress" 
	services="app-service\web" 
	documentationCenter="php" 
	authors="tfitzmac" 
	manager="wpickett" 
	editor="jimbe"/>

<tags 
	ms.service="app-service-web" 
	ms.workload="web" 
	ms.tgt_pltfrm="na" 
	ms.devlang="PHP" 
	ms.topic="article" 
	ms.date="03/24/2015" 
	ms.author="tomfitz"/>



# Преобразование WordPress в Мультисайт в службе приложений Azure

## Обзор

*Автор: [Бен Лобаф (Ben Lobaugh)][ben-lobaugh], [Microsoft Open Technologies Inc.][ms-open-tech]*

В этом учебнике описано, как преобразовать существующее веб-приложение WordPress, созданное с помощью коллекции в Azure, в Мультисайт WordPress. Кроме того вы узнаете, как назначить пользовательский домен каждому из дочерних сайтов в установке.

Предполагается наличие существующей установки WordPress. Если платформа WordPress не установлена, следуйте инструкциям в статье [Создание веб-сайта WordPress из коллекции в Azure][website-from-gallery].

Преобразование существующего отдельного сайта WordPress в Мультисайт - достаточно простая процедура. И многие из перечисленных здесь начальных действий взяты непосредственно со страницы [Создание сети][wordpress-codex-create-a-network] в [WordPress Codex](http://codex.wordpress.org)

Давайте приступим.

## Включение функциональности мультисайта

Сначала вам необходимо включить Мультисайт в файле `wp-config.php` с помощью константы **WP\_ALLOW\_MULTISITE**. Существует два способа изменить файлы веб-приложения: по протоколу FTP и через Git. Если вы не знаете, как настроить хотя бы один из этих способов, вы можете обратиться к одному из следующих учебных курсов:

* [веб-сайт PHP с MySQL и FTP][website-w-mysql-and-ftp-ftp-setup];

* [ веб-сайтPHP с MySQL и Git][website-w-mysql-and-git-git-setup].

Откройте файл `wp-config.php` в любом текстовом редакторе и добавьте следующий код над строкой "/* That's all, stop editing! Happy blogging. */".

	/* Multisite */

	define( 'WP_ALLOW_MULTISITE', true );

Не забудьте сохранить файл и загрузить его на сервер!

## Настройка сети

Войдите в область *wp-admin* своего веб-приложения, где вы увидите новый элемент в разделе меню **Средства** с именем **Настройка сети**. Нажмите кнопку **Настройка сети** и введите сведения о своей сети.

![Экран настройки сети][настройка-сети-wordpress]

В этом учебнике используется схема сайта *Sub-directories*, так как она должна работать всегда. Позже мы установим в этом руководстве личные домены для каждого дочернего сайта. Однако должна быть возможность настроить поддомен, если вы сопоставляете домен через [портал Azure](http://go.microsoft.com/fwlink/?LinkId=529715) и правильно настраиваете DNS с подстановочными знаками.

Дополнительные сведения о сравнении процессов настройки поддоменов с подкаталогами см. в статье [Типы сетей с Мультисайтом][wordpress-codex-types-of-networks] в WordPress Codex.

## Включение сети

Теперь сеть настроена в базе данных, но для включения функций сети осталось выполнить еще один шаг. Завершите настройку параметров `wp-config.php` и убедитесь, что файл `web.config` правильно маршрутизирует все веб-сайты.


После нажатия кнопки **Установить** на странице *Network Setup* WordPress попытается обновить файлы `wp-config.php` и `web.config`. Тем не менее, всегда следует выполнять проверку файлов, чтобы убедиться, что обновление выполнено успешно. В противном случае на этом экране будут отображаться необходимые обновления. Измените и сохраните файлы.


После выполнения этих обновлений вам необходимо выйти из панели мониторинга wp-admin и войти в нее снова.

На панели администратора должно появиться дополнительное меню с именем **Мои сайты**. Это меню позволяет управлять новой сетью на панели мониторинга **Администратор сети**.

# Добавление пользовательских доменов

Подключаемый модуль [Сопоставление доменов WordPress MU][wordpress-plugin-wordpress-mu-domain-mapping] значительно упрощает добавление личных доменов для любого сайта в вашей сети. Для обеспечения правильной работы этого подключаемого модуля необходимо выполнить дополнительную настройку на портале, а также в регистраторе доменов.

## Включение сопоставления доменов с веб-приложением

В плане обслуживания **Бесплатный** [службы приложений](http://go.microsoft.com/fwlink/?LinkId=529714) не поддерживается добавление в веб-приложение личных доменов. Вам потребуется переключиться на **Общий** или **Стандартный** режим. Для этого:

* Войдите на портал Azure и найдите свое веб-приложение. 
* Перейдите на вкладку **Шкала** в основной области содержимого
* В разделе **Общие** выберите *SHARED* или *STANDARD*
* Щелкните **Сохранить**

Может появиться сообщение с просьбой проверить изменения и подтвердить, что за это веб-приложение начнет взиматься плата в зависимости от использования и других настроек.

Обработка новых параметров займет несколько минут, поэтому сейчас самое время приступить к настройке домена.

## Проверка домена

Чтобы веб-приложения Azure позволили сопоставить домен с сайтом, вам необходима авторизация для сопоставления домена. Для этого необходимо добавить в запись DNS новую запись CNAME.

* Выполните вход в диспетчер DNS домена.
* Создание новой записи CNAME *awverify*
* Задайте для *awverify* значение *awverify.YOUR_DOMAIN.azurewebsites.net*

Для полного вступления в силу внесенных изменений DNS может потребоваться некоторое время, так что если перечисленные ниже действия не получается выполнить сразу, выпейте чашку кофе, а затем повторите попытку.

## Добавление домена в веб-приложение

Вернитесь в свое веб-приложение через портал Azure, откройте меню **Параметры** и щелкните **Личные домены и SSL**.

Когда отобразятся  *Параметры SSL settings*, вы увидите поля для ввода всех доменов, которые вы хотите назначить своему веб-приложению. Если домен отсутствует в списке, он будет недоступен для сопоставления в WordPress независимо от настроек DNS домена.

![Диалоговое окно управления личными доменами][wordpress-manage-domains]

После ввода домена в текстовое поле Azure проверит созданную ранее запись CNAME. Если распространение DNS не завершено, будет отображаться красный индикатор. Если все успешно выполнено, появится зеленый флажок. 

Запишите IP-адреса, перечисленные в нижней части диалогового окна. Они потребуются для установки A-записи для домена.

## Настройка A-записи домена

Если предыдущие шаги выполнены успешно, теперь вы можете назначить домен веб-приложению Azure через запись A DNS. 

Важно отметить, что веб-приложения Azure принимают как CNAME, так и записи A, но для правильного сопоставления домена *необходимо* использовать запись A. CNAME нельзя передать в другую CNAME, созданную в Azure с использованием ссылки "ВАШ_ДОМЕН.azurewebsites.net".

При помощи IP-адреса из предыдущего шага вернитесь в диспетчер DNS и настройте A-запись таким образом, чтобы она указывала на данный IP.


## Установка и настройка подключаемого модуля

В функциональности мультисайтов WordPress в настоящее время отсутствует встроенный метод сопоставления пользовательских доменов. Но есть подключаемый модуль с именем [Сопоставление доменов WordPress MU][wordpress-plugin-wordpress-mu-domain-mapping], который добавляет эти функциональные возможности. Войдите в среду администрирования сайта и установите подключаемый модуль **Сопоставление доменов WordPress MU**.

После установки и активации подключаемого модуля выберите команды **Параметры** > **Сопоставление доменов**, чтобы настроить этот подключаемый модуль. В первом текстовом поле *IP-адрес сервера* введите IP-адрес, который вы использовали при настройке записи A для домена. Задайте *Параметры домена* (значения по умолчанию часто оптимальные) и нажмите кнопку **Сохранить**.

## Сопоставление домена

Перейдите на **Панель мониторинга** сайта, с которым требуется сопоставить домен. Выберите команды **Средства** > **Сопоставление домена**, введите новый домен в текстовом поле и нажмите кнопку **Добавить**.

По умолчанию автоматически созданный домен сайта будет перезаписан новым доменом. Если необходимо, чтобы весь трафик отправлялся в новый домен, перед сохранением установите флажок  *Основной домен для этого блога*. Для сайта можно добавить неограниченное количество доменов, но только один будет основным.

## Повторение процедуры

Веб-приложения Azure позволяют добавить для веб-приложения неограниченное число доменов. Чтобы добавить другой домен, необходимо будет выполнить разделы **Проверка домена** и **Настройка A-записи домена** для каждого домена.	

>[AZURE.NOTE] Если вы хотите начать работу со службой приложений Azure еще до создания учетной записи Azure, перейдите на страницу [ознакомительной версии службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751). Там вы сможете сразу создать свое первое веб-приложение, правда срок его службы будет ограничен. Никаких кредитных карт и обязательств.

## Изменения
* Сведения об изменении веб-сайтов на службу приложений см. в статье [Служба приложений Azure и ее влияние на существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714)
* Сведения о переходе со старого портала на новый см. в статье [Справочная информация о навигации по предварительной версии портала](http://go.microsoft.com/fwlink/?LinkId=529715).

[ben-lobaugh]: http://ben.lobaugh.net
[ms-open-tech]: http://msopentech.com
[website-from-gallery]: https://www.windowsazure.com/develop/php/tutorials/website-from-gallery/
[wordpress-codex-create-a-network]: http://codex.wordpress.org/Create_A_Network
[website-w-mysql-and-ftp-ftp-setup]: https://www.windowsazure.com/develop/php/tutorials/website-w-mysql-and-ftp/#header-0
[website-w-mysql-and-git-git-setup]: https://www.windowsazure.com/develop/php/tutorials/website-w-mysql-and-git/#header-1
[wordpress-network-setup]: ./media/web-sites-php-convert-wordpress-multisite/wordpress-network-setup.png
[wordpress-codex-types-of-networks]: http://codex.wordpress.org/Before_You_Create_A_Network#Types_of_multisite_network
[wordpress-plugin-wordpress-mu-domain-mapping]: http://wordpress.org/extend/plugins/wordpress-mu-domain-mapping/

[wordpress-manage-domains]: ./media/web-sites-php-convert-wordpress-multisite/wordpress-manage-domains.png


<!--HONumber=49-->