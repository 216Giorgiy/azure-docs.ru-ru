<properties urlDisplayName="Convert a WordPress Site to a Multisite" pageTitle="Преобразование сайта WordPress в мультисайт" metaKeywords="WordPress, мультисайт" description="Learn how to take an existing WordPress website created through the gallery in Azure and convert it to WordPress Multisite" metaCanonical="" services="web-sites" documentationCenter="PHP" title="Convert a WordPress Site to a Multisite" authors="tomfitz" solutions="" manager="wpickett" editor="" />

<tags ms.service="web-sites" ms.workload="web" ms.tgt_pltfrm="na" ms.devlang="PHP" ms.topic="article" ms.date="10/28/2014" ms.author="tomfitz" />





# Преобразование сайта WordPress в мультисайт

*Автор [Бен Лобо (Ben Lobaugh)][ben-lobaugh], [Microsoft Open Technologies Inc.][ms-open-tech]*

В рамках данного учебного курса вы узнаете, как преобразовать существующий веб-сайт WordPress, созданный из коллекции в Azure, в мультисайт WordPress. Кроме того, вы узнаете, как назначить пользовательский домен каждому из дочерних сайтов в установке.

Предполагается наличие существующей установки WordPress. В противном случае следуйте инструкциям раздела [Создание веб-сайта WordPress из коллекции в Azure][website-from-gallery].

Преобразование существующего отдельного сайта WordPress выполнить достаточно просто, и многие из перечисленных здесь начальных действий взяты непосредственно со страницы [Создание сети][wordpress-codex-create-a-network] на [WordPress Codex](http://codex.wordpress.org).

Давайте приступим.

## Включение функциональности мультисайта

Сначала необходимо активировать мультисайт через файл "wp-config.php" с константой **WP\_ALLOW\_MULTISITE**. Существует два метода редактирования файлов веб-сайта: первый - с помощью FTP-сервера, второй - посредством Git. Если вы не знаете, как настроить хотя бы один из этих способов, обратитесь к одному из следующих учебных курсов:

* [Веб-сайт PHP с MySQL и FTP][website-w-mysql-and-ftp-ftp-setup]

* [Веб-сайт PHP с MySQL и Git][website-w-mysql-and-git-git-setup]

Откройте файл "wp-config.php" в любом текстовом редакторе и добавьте следующий код над строкой "/* That's all, stop editing! Happy blogging. */".

	/* Multisite */

	define( 'WP_ALLOW_MULTISITE', true );

Не забудьте сохранить файл и загрузить его на сервер!

## Настройка сети

Войдите в область веб-сайта *wp-admin*, где вы увидите новый элемент в разделе меню **Средства** с именем **Настройка сети**. Нажмите кнопку **Настройка сети** и введите сведения о своей сети.

![Network Setup Screen][wordpress-network-setup]

В данном учебном курсе используется схема сайта *Подкаталоги*, так как она должна работать всегда. Позже в данном руководстве мы зададим пользовательские домены для каждого дочернего сайта. Однако должна быть возможность настроить поддомен, если домен сопоставлен через портал и правильно настроен DNS с подстановочными знаками.

Дополнительные сведения о сравнении поддоменов с подкаталогами см. в статье [Типы сети с мультисайтом][wordpress-codex-types-of-networks] в WordPress Codex.

## Включение сети

Теперь сеть настроена в базе данных, но для включения функций сети осталось выполнить еще один шаг. Завершите настройку параметров "wp-config.php" и убедитесь, что файл "web.config" правильно перенаправляет все веб-сайты.


После нажатия кнопки **Установить** на странице *Сетевая установка* WordPress предпримет попытку обновления файлов "wp-config.php" и "web.config". Тем не менее, всегда следует выполнять проверку файлов, чтобы убедиться, что обновление выполнено успешно. В противном случае на этом экране будут отображаться необходимые обновления. Внесите изменения в файлы и сохраните их.


После внесения этих обновлений потребуется выйти из системы и повторно войти в панель мониторинга wp-admin.

На панели администратора должно появиться дополнительное меню с именем **Мои сайты**. Это меню позволяет управлять новой сетью на панели мониторинга **Администратор сети**.

# Добавление пользовательских доменов

Подключаемый модуль [Сопоставление доменов WordPress MU][wordpress-plugin-wordpress-mu-domain-mapping] делает добавление пользовательских доменов для любого сайта в сети очень простым. Для обеспечения правильной работы этого подключаемого модуля необходимо выполнить дополнительную настройку на портале, а также в регистраторе доменов.

## Включение сопоставления доменов веб-сайту

Режим бесплатного веб-сайта по умолчанию не поддерживает добавление пользовательских доменов на веб-сайты Azure. Потребуется переключиться на общий или стандартный режим. Для этого выполните следующие действия.

* Войдите на портал Azure и найдите свой веб-сайт. 
* Перейдите на вкладку **Шкала** в основной области содержимого
* В разделе **Общие** выберите *ОБЩИЙ* или *СТАНДАРТНЫЙ*
*  Щелкните **Сохранить**

Может быть выведено сообщение с приглашением проверить изменения и подтвердить, что для данного веб-сайта могут начать действовать определенные затраты в зависимости от уровня использования и других настроек.

Обработка новых параметров займет несколько минут, поэтому сейчас самое время приступить к настройке домена.

## Проверка домена

Чтобы веб-сайты Azure позволили сопоставить домен с сайтом, необходимо наличие авторизации для сопоставления домена. Для этого необходимо добавить новую запись CNAME в свою запись DNS.

* Выполните вход в диспетчер DNS домена.
* Создайте новую запись CNAME *awverify*
* Укажите *awverify* на *awverify.YOUR_DOMAIN.azurewebsites.net*

Для полного вступления в силу внесенных изменений DNS может потребоваться некоторое время, так что если перечисленные ниже действия не получается выполнить сразу, выпейте чашку кофе, а затем повторите попытку.

## Добавление домена на веб-сайт

Вернитесь на веб-сайт через портал Azure и откройте вкладку **НАСТРОЙКА**. Должна быть доступна кнопка **УПРАВЛЕНИЕ ДОМЕНАМИ**. Нажмите ее.

Откроется диалоговое окно *Управление пользовательскими доменами*. Здесь вводятся все домены, которые планируется назначить вашему веб-сайту. Если домен отсутствует в списке, то он будет недоступен для сопоставления в WordPress независимо от настроек DNS домена.

![Manage custom domains dialog][wordpress-manage-domains]

После ввода своего домена в текстовом поле в Azure будет проверена созданная ранее запись CNAME *awverify*. Если распространение DNS не завершено, будет отображаться красный индикатор. Если все успешно выполнено, появится зеленый флажок. 

Запишите IP-адреса, перечисленные в нижней части диалогового окна. Они потребуются для установки A-записи домена.

## Настройка A-записи домена

Если предыдущие шаги выполнены успешно, теперь можно назначить домен веб-сайту Azure через A-запись DNS. 

Важно отметить, что веб-сайты Azure принимают как CNAME, так и A-записи, однако для обеспечения правильного сопоставления домена *обязательно* должна использоваться A-запись. CNAME нельзя переадресовать в другую CNAME, созданную в Azure с использованием ссылки YOUR_DOMAIN.azurewebsites.net.

При помощи IP-адреса из предыдущего шага вернитесь в диспетчер DNS и настройте A-запись таким образом, чтобы она указывала на данный IP.


## Установка и настройка подключаемого модуля

В функциональности мультисайтов WordPress в настоящее время отсутствует встроенный метод сопоставления пользовательских доменов. Однако есть подключаемый модуль с именем [Сопоставление доменов WordPress MU][wordpress-plugin-wordpress-mu-domain-mapping], который добавляет эти функциональные возможности. Войдите в среду администрирования сайта и установите подключаемый модуль **Сопоставление доменов WordPress MU**.

После установки и активации подключаемого модуля выберите команды **Параметры** > **Сопоставление доменов**, чтобы настроить этот подключаемый модуль. В первом текстовом поле *IP-адрес сервера* введите IP-адрес, который использовался при настройке A-записи для домена. Задайте нужные *Параметры домена* (значения по умолчанию часто являются оптимальными) и нажмите кнопку **Сохранить**.

## Сопоставление домена

Перейдите на **Панель мониторинга** сайта, с которым требуется сопоставить домен. Выберите команды **Средства** > **Сопоставление домена**, введите новый домен в текстовом поле и нажмите кнопку **Добавить**.

По умолчанию автоматически созданный домен сайта будет перезаписан новым доменом. Если необходимо, чтобы весь трафик отправлялся на новый домен, то перед сохранением установите флажок *Основной домен для этого блога*. Для сайта можно добавить неограниченное количество доменов, но только один будет основным.

## Повторение процедуры

Веб-сайты Azure позволяют добавить для веб-сайта неограниченное число доменов. Чтобы добавить другой домен, необходимо будет выполнить разделы **Проверка домена** и **Настройка A-записи домена** для каждого домена.	

[ben-lobaugh]: http://ben.lobaugh.net
[ms-open-tech]: http://msopentech.com
[website-from-gallery]: https://www.windowsazure.com/ru-ru/develop/php/tutorials/website-from-gallery/
[wordpress-codex-create-a-network]: http://codex.wordpress.org/Create_A_Network
[website-w-mysql-and-ftp-ftp-setup]: https://www.windowsazure.com/ru-ru/develop/php/tutorials/website-w-mysql-and-ftp/#header-0
[website-w-mysql-and-git-git-setup]: https://www.windowsazure.com/ru-ru/develop/php/tutorials/website-w-mysql-and-git/#header-1
[wordpress-network-setup]: ./media/web-sites-php-convert-wordpress-multisite/wordpress-network-setup.png
[wordpress-codex-types-of-networks]: http://codex.wordpress.org/Before_You_Create_A_Network#Types_of_multisite_network
[wordpress-plugin-wordpress-mu-domain-mapping]: http://wordpress.org/extend/plugins/wordpress-mu-domain-mapping/

[wordpress-manage-domains]: ./media/web-sites-php-convert-wordpress-multisite/wordpress-manage-domains.png

