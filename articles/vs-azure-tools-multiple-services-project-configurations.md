<properties
   pageTitle="Настройка проекта Azure с помощью нескольких конфигураций службы"
   description="Узнайте, как настроить проект облачной службы Azure, изменяя файлы ServiceDefinition.csdef и ServiceConfiguration.cscfg."
   services="visual-studio-online"
   documentationCenter="na"
   authors="kempb"
   manager="douge"
   editor="tlee" />
<tags
   ms.service="multiple"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/29/2015"
   ms.author="kempb" />

# Настройка проекта Azure с помощью нескольких конфигураций службы

Проект облачной службы Azure включает два файла конфигурации: ServiceDefinition.csdef и ServiceConfiguration.cscfg. Эти файлы упаковываются вместе с приложением облачной службы Azure и развертываются в Azure.

- Файл **ServiceDefinition.csdef** содержит метаданные и роли, которые требуются для среды Azure и используются в приложении облачной службы. Этот файл также содержит параметры конфигурации, которые применяются ко всем экземплярам. Эти параметры конфигурации могут считываться в среде выполнения с помощью API среды выполнения размещения службы Azure. Этот файл нельзя обновить, пока служба работает в Azure.

- Файл **ServiceConfiguration.cscfg** задает значения для параметров конфигурации, указанных в файле определения службы, а также количество экземпляров для запуска для каждой роли. Этот файл нельзя обновить, пока облачная служба работает в Azure.

Инструменты Azure для Microsoft Visual Studio включают страницы свойств, на которых можно задавать параметры конфигурации, хранимые в этих файлах. Чтобы открыть страницы свойств, дважды щелкните ссылку на роль под проектом облачной службы Azure в обозревателе решений или щелкните ссылку на роль правой кнопкой мыши и выберите **Свойства**, как показано на следующем рисунке.

![VS\_Solution\_Explorer\_Roles\_Properties](./media/vs-azure-tools-multiple-services-project-configurations/IC784076.png)

Сведения о базовых схемах для файлов определения службы и конфигурации службы см. в статье [Справка по схемам](https://msdn.microsoft.com/library/azure/dd179398.aspx). Дополнительные сведения о конфигурации службы см. в статье [Настройка облачных служб](cloud-services-how-to-configure.md).

## Настройка свойств роли

Страницы свойств веб-роли и рабочей роли похожи, хотя между ними существует несколько отличий, которые описаны в следующих разделах.

На странице **Кэширование** можно настроить службы кэша Azure.

### Страница «Конфигурация»

На странице **Конфигурация** можно задать следующие свойства.

**Экземпляры**

Укажите для свойства **Число экземпляров** количество экземпляров, которые служба должна запустить для этой роли.

Укажите для свойства **Размер виртуальной машины** значение **Очень мелкий**, **Мелкий**, **Средний**, **Большой** или **Очень крупный**. Дополнительные сведения см. в статье [Размеры для облачных служб](cloud-services-sizes-specs.md).

**Действие при запуске** (только веб-роли)

Задайте это свойство, чтобы указать, что при запуске отладки программа Visual Studio должна запускать веб-браузер для конечных точек HTTP, HTTPS или конечных точек обоих типов.

Параметр конечной точки HTTPS доступен, только если конечная точка HTTPS уже определена для вашей роли. Вы можете определить конечную точку HTTPS на странице свойств **Конечные точки**.

Если вы уже добавили конечную точку HTTPS, параметр конечной точки HTTPS включен по умолчанию. Теперь после того, как вы начнете отладку, Visual Studio запустит браузер для этой конечной точки, как и браузер для конечной точки HTTP. При этом предполагается, что включены оба параметра запуска.

**Диагностика**

По умолчанию для веб-роли включена диагностика. Облачная служба проекта Azure и учетная запись хранения настраиваются для использования локального эмулятора хранения. Когда все будет готово для развертывания в Azure, нажмите кнопку построителя (**...**), чтобы обновить учетную запись хранения для использования хранилища Azure в облаке. Данные диагностики можно перенести в учетную запись хранения по требованию или по автоматически заданному расписанию. Дополнительные сведения о диагностике Azure см. в статье [Включение диагностики в облачных службах и виртуальных машинах Azure](cloud-services-dotnet-diagnostics.md).

## Страница «Параметры»

На странице **Параметры** можно добавить параметры конфигурации для службы. Параметры конфигурации — это пары «имя —значение». Код, выполняемый в роли, может считывать значения параметров конфигурации в среде выполнения с помощью классов из [управляемой библиотеки Azure](http://go.microsoft.com/fwlink?LinkID=171026). В частности, метод [GetConfigurationSettingValue](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.getconfigurationsettingvalue.aspx) возвращает значение именованного параметра конфигурации в среде выполнения.

### Настройка строки подключения к учетной записи хранения

Строка подключения — параметр конфигурации, который предоставляет сведения о подключении и проверке подлинности для эмулятора хранения или учетной записи хранения Azure. Чтобы ваш код мог получать доступ к данным служб хранилища Azure (т. е. BLOB-объектам, очередям или данным таблицы) из кода, выполняемого в роли, вам необходимо определить строку подключения к этой учетной записи хранения.

Строка подключения, которая указывает на учетную запись хранения Azure, должна быть представлена в определенном формате. Сведения о создании строк подключения см. в статье [Настройка строк подключения службы хранилища Azure](storage-configure-connection-string.md).

Когда вы будете готовы протестировать работу службы со службами хранилища Azure или развернуть облачную службу в Azure, вы можете изменить значение любой строки подключения таким образом, чтобы она указывала на учетную запись хранения Azure. Щелкните (**…**), затем выберите **Ввод учетных данных хранилища**. Введите данные учетной записи, в том числе имя и ключ учетной записи. В диалоговом окне **Строка подключения к учетной записи хранилища** вы можете указать, следует ли использовать стандартные конечные точки HTTPS (параметр по умолчанию), стандартные конечные точки HTTP или пользовательские конечные точки. Вы можете использовать пользовательские конечные точки, если вы зарегистрировали личное доменное имя для службы, как описано в статье [Настройка имени домена для BLOB-данных в учетной записи хранения Azure](storage-custom-domain-name.md).

>[AZURE.IMPORTANT]Прежде чем развертывать службу, необходимо изменить строки подключения, которые должны указывать на учетную запись хранения Azure. Если этого не сделать, ваша роль может не запуститься или зациклиться на состояниях инициализации, занятости и остановки.

## Страница «Конечные точки»

Рабочая роль может иметь любое количество конечных точек HTTP, HTTPS или TCP. Конечные точки могут быть входными конечными точками, доступными для внешних клиентов, или внутренними конечными точками, доступными для других ролей, которые выполняются в службе.

- Чтобы предоставить доступ к конечной точке HTTP внешним клиентам и веб-браузерам, измените тип конечной точки на «входная» и укажите имя и номер общего порта.

- Чтобы предоставить доступ к конечной точке HTTPS внешним клиентам и веб-браузерам, измените тип конечной точки на **входная** и укажите имя, номер общего порта, а также имя сертификата управления.

    Обратите внимание: прежде чем указывать сертификат управления, необходимо определить сертификат на странице свойств **Сертификаты**.

- Чтобы предоставить другим ролям в облачной службе внутренний доступ к конечной точке, измените тип конечной точки на «внутренняя» и укажите имя и возможные частные порты для этой конечной точки.

## Страница «Локальное хранилище»

На странице свойств **Локальное хранилище** вы можете зарезервировать для роли один или несколько локальных ресурсов хранилища. Локальный ресурс хранилища — это зарезервированный каталог в файловой системе виртуальной машины Azure, на которой выполняется экземпляр роли. Дополнительные сведения о работе с локальными ресурсами хранилища см. в статье [Настройка локальных ресурсов хранилища](cloud-services-configure-local-storage-resources.md).

## Страница «Сертификаты»

На странице **Сертификаты** можно связать сертификаты с ролью. Сертификаты, которые вы добавите, можно использовать для настройки конечных точек HTTPS на странице свойств **Конечные точки**.

Страница свойств **Сертификаты** добавляет сведения о сертификатах в конфигурацию службы. Обратите внимание, что сертификаты не упакованы с вашей службой. Необходимо отдельно передать сертификаты в Azure с помощью [портала управления Azure](http://go.microsoft.com/fwlink/?LinkID=213885).

Чтобы связать сертификат с ролью, укажите имя сертификата. Это имя используется для ссылки на сертификат при настройке конечной точки HTTPS на странице свойств **Конечные точки**. Затем выберите тип хранилища сертификатов (**хранилище на локальном компьютере** или **хранилище текущего пользователя**) и укажите имя хранилища. Наконец, введите отпечаток сертификата. Если сертификат находится в хранилище текущего пользователя или в личном хранилище, вы можете ввести отпечаток сертификата, выбрав сертификат из заполненного списка. Если он находится в другом месте, введите значение отпечатка вручную.

Когда вы добавляете сертификат из хранилища сертификатов, любые промежуточные сертификаты автоматически добавляются в параметры конфигурации. Эти промежуточные сертификаты также следует передать в Azure, чтобы правильно настроить службу для использования протокола SSL.

Все сертификаты управления, связанные со службой, применяются к службе только в том случае, если она работает в облаке. Если служба работает в локальной среде разработки, используется стандартный сертификат, управляемый с помощью эмулятора вычислений.

## Настройка проекта облачной службы Azure

Чтобы настроить параметры, которые будут применяться ко всему проекту облачной службы Azure, сначала откройте контекстное меню для узла проекта и выберите «Свойства», чтобы открыть страницы его свойств. В следующей таблице показаны эти страницы свойств.

|Страница свойств|Описание|
|---|---|
|Приложение|На этой странице можно отобразить сведения о версии инструментов Azure, которые использует проект облачной службы, и обновить ее до текущей версии.|
|События построения|На этой странице можно задать события перед сборкой и после сборки.|
|Разработка|На этой странице можно указать инструкции конфигурации сборки и условия, при которых будут выполняться любые события после сборки.|
|Веб-приложения|На этой странице можно настроить параметры, связанные с веб-сервером.|

<!---HONumber=Oct15_HO1-->