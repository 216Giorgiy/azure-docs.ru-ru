---
title: Развертывание Azure Digital Twins | Документация Майкрософт
description: В этом руководстве вы узнаете, как развернуть свой экземпляр Azure Digital Twins и настроить пространственные ресурсы.
services: digital-twins
author: dsk-2015
ms.service: digital-twins
ms.topic: tutorial
ms.date: 10/15/2018
ms.author: dkshir
ms.openlocfilehash: 7e51513e5cc17b18b6822925051b207f61e20ea1
ms.sourcegitcommit: ba4570d778187a975645a45920d1d631139ac36e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2018
ms.locfileid: "51283858"
---
# <a name="tutorial-deploy-azure-digital-twins-and-configure-a-spatial-graph"></a>Руководство по развертыванию Azure Digital Twins и настройке пространственного графа

Служба Azure Digital Twins позволяет объединять людей, места и устройства в связанной пространственной системе. В руководствах этой серии показано, как с помощью Azure Digital Twins определять степень заполненности помещения, а также оптимальные условия температуры и качества воздуха. В этих руководствах рассматривается консольное приложение .NET, которое позволяет реализовать сценарий с многоэтажным офисным зданием с комнатами на каждом этаже. В комнатах есть устройства с прикрепленными датчиками, которые фиксируют движение, температуру окружающей среды и качество воздуха. Вы узнаете, как копировать физические области и объекты в здании в виде цифровых объектов, используя службу Digital Twins. Вы будете имитировать события устройства, используя другое консольное приложение. Затем вы узнаете, как отслеживать события, происходящие в этих физических областях и объектах, практически в реальном времени. Полагаясь на эту информацию, администратор офиса может помочь сотруднику, работающему в этом здании, забронировать конференц-залы с оптимальными условиями. Менеджер офисных помещений может использовать ваш экземпляр настройки для определения тенденций использования помещений, а также для контроля условий работы в целях технического обслуживания.

В первом руководстве этой серии вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * развертывание Azure Digital Twins;
> * предоставление разрешений приложению;
> * изменение примера приложения Digital Twins;
> * подготовка сборки.


В этих руководствах для более детального и глубокого освещения концепций используются и изменяются те же примеры, что и [в руководстве по обнаружению свободных комнат](quickstart-view-occupancy-dotnet.md).


## <a name="prerequisites"></a>Предварительные требования

- Подписка Azure. Если у вас нет учетной записи, вы можете создать [бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

- Примеры Digital Twins, используемые в этих руководствах, написаны на C#. Установите [пакет SDK для .NET Core версии 2.1.403 или более поздней](https://www.microsoft.com/net/download) на компьютере разработки. Он нужен для создания и запуска примера. Проверьте, установлена ​​ли на вашем компьютере правильная версия, запустив `dotnet --version` в окне команд.

- [Visual Studio Code](https://code.visualstudio.com/) для изучения примера кода. 

<a id="deploy" />

## <a name="deploy-digital-twins"></a>Развертывание Azure Digital Twins

Используйте шаги в этом разделе, чтобы создать экземпляр службы Digital Twins. Можно создать только один экземпляр на подписку. Перейдите к следующему разделу, если вы его уже создали. 

[!INCLUDE [create-digital-twins-portal](../../includes/digital-twins-create-portal.md)]


<a id="permissions" />

## <a name="grant-permissions-to-your-app"></a>Предоставление разрешений приложению

Служба Digital Twins использует [Azure Active Directory](../active-directory/fundamentals/active-directory-whatis.md) для управления [доступом для чтения и записи](../active-directory/develop/v1-permissions-and-consent.md) к службе. Любое приложение, которое будет подключаться к вашему экземпляру Digital Twins, должно быть зарегистрировано в Azure Active Directory. В этом разделе показано, как зарегистрировать пример приложения.

Если у вас уже есть *зарегистрированное приложение*, вы можете повторно использовать его для своего примера. Однако просмотрите этот раздел, чтобы убедиться, что регистрация вашего приложения настроена правильно.

[!INCLUDE [digital-twins-permissions](../../includes/digital-twins-permissions.md)]


## <a name="configure-digital-twins-sample"></a>Настройка примера Digital Twins

В этом разделе рассматривается приложение Digital Twins, которое обменивается данными с [интерфейсами REST API Digital Twins](https://docs.westcentralus.azuresmartspaces.net/management/swagger/ui/index). 

### <a name="download-the-sample"></a>Скачивание примера приложения
Если вы уже скачали примеры для руководства [по обнаружению свободных комнат](quickstart-view-occupancy-dotnet.md), то можете пропустить эти шаги.

1. Скачайте [примеры Digital Twins на .Net](https://github.com/Azure-Samples/digital-twins-samples-csharp/archive/master.zip). 
2. Извлеките содержимое папки ZIP на свой компьютер. 

### <a name="explore-the-sample"></a>Анализ примера
В извлеченной папке с примерами откройте файл **_digital-twins-samples-csharp\digital-twins-samples.code-workspace_** в Visual Studio Code. Этот файл содержит два проекта: 

1. Пример **_occupancy-quickstart_** позволяет настроить и подготовить [пространственный интеллектуальный граф](concepts-objectmodel-spatialgraph.md#graph). Это цифровое изображение физического пространства и находящихся в нем ресурсов. В этом примере используется [объектная модель](concepts-objectmodel-spatialgraph.md#model), которая определяет объекты для интеллектуального здания. Полный список объектов Digital Twins и интерфейсы REST API см. в [этой документации по REST API](https://docs.westcentralus.azuresmartspaces.net/management/swagger) или по URL-адресу **API управления**, который был создан для [вашего экземпляра](#deploy).

   Чтобы изучить пример и увидеть, как он связывается с имеющимся экземпляром Digital Twins, можно начать с папки **_src\actions_**. Файлы в этой папке реализуют команды, которые вы будете использовать в этих руководствах:
    - Файл *provisionSample.cs* показывает, как подготовить пространственный граф.
    - Файл *getSpaces.cs* получает информацию о подготовленных помещениях.
    - Файл *getAvailableAndFreshSpaces.cs* получает результаты пользовательской функции.
    - Файл *createEndpoints.cs* создает конечные точки для взаимодействия с другими службами.

1. Пример моделирования **_device-connectivity_** имитирует данные датчиков и отправляет их в центр Интернета вещей, подготовленный для вашего экземпляра Digital Twin. Вы будете использовать этот пример в [следующем руководстве после подготовки пространственного графа](tutorial-facilities-udf.md#simulate). Идентификаторы датчиков и устройств, используемые для настройки этого примера, должны быть такими же, как и для вашего графа.

### <a name="configure-the-provisioning-sample"></a>Настройка подготовленного примера
1. Откройте окно команд и перейдите к скачанному примеру. Выполните следующую команду:

    ```cmd/sh
    cd occupancy-quickstart/src
    ```

1. Восстановите зависимости в примере проекта, выполнив эту команду:

    ```cmd/sh
    dotnet restore
    ```

1. В Visual Studio Code откройте файл **_appSettings.json_**, который относится к проекту **occupancy-quickstart**, а затем обновите следующие значения:
    1. *ClientId*: введите **идентификатор приложения** из регистрации приложения AAD, который вы записали при работе с разделом [Предоставление разрешений приложению](#permissions).
    1. *Tenant*: введите **идентификатор каталога** из [клиента AAD](https://docs.microsoft.com/azure/active-directory/develop/quickstart-create-new-tenant), также записанный при работе с разделом [Предоставление разрешений приложению](#permissions).
    1. *BaseUrl*: введите URL-адрес экземпляра Digital Twins. Чтобы получить этот URL-адрес, замените заполнители в этом URL-адресе значениями для вашего экземпляра: **https://yourDigitalTwinsName.yourLocation.azuresmartspaces.net/management/api/v1.0/**. Вы также можете получить этот URL-адрес, изменив **URL-адрес API управления**, указанный в [разделе развертывания](#deploy), заменив **swagger/** на **api/v1.0/**.

1. Просмотрите список функций Digital Twins, которые вы можете исследовать с помощью примера, выполнив следующую команду.

    ```cmd/sh
    dotnet run
    ```

<a id="provision-spaces" />

## <a name="understand-provisioning-process"></a>Сведения о процессе подготовки
В этом разделе показано, как пример положения подготавливает пространственный граф здания. 

В Visual Studio Code перейдите в папку **_occupancy-quickstart\src\actions_** и откройте файл *provisionSample.cs*. Обратите внимание на следующую функцию:

```csharp
public static async Task<IEnumerable<ProvisionResults.Space>> ProvisionSample(HttpClient httpClient, ILogger logger)
{
    IEnumerable<SpaceDescription> spaceCreateDescriptions;
    using (var r = new StreamReader("actions/provisionSample.yaml"))
    {
        spaceCreateDescriptions = await GetProvisionSampleTopology(r);
    }

    var results = await CreateSpaces(httpClient, logger, spaceCreateDescriptions, Guid.Empty);

    Console.WriteLine($"Completed Provisioning: {JsonConvert.SerializeObject(results, Formatting.Indented)}");

    return results;
}

```

Эта функция использует файл *provisionSample.yaml* в той же папке. Откройте этот файл и обратите внимание на иерархию офисного здания: *место проведения*, *этаж*, *область* и *комнаты*. В любой из этих физических областей могут быть *устройства* и *датчики*. Каждая запись содержит предопределенный тип (`type`), например *Floor* (Этаж) или *Room* (Комната). 

В файле *yaml* показан пространственный граф с использованием объектной модели Digital Twins `Default`. Эта модель предоставляет универсальные имена для большинства типов (например, Temperature для SensorDataType, Map для SpaceBlobType) и типов пространства (например, Room с подтипами FocusRoom, ConferenceRoom и т. д.), чего вполне достаточно для здания. Если вам нужно создать пространственный граф для другого типа помещения, например фабрики, вам может потребоваться другая объектная модель. Можно выяснить, какие модели доступны для использования, выполнив команду `dotnet run GetOntologies` в командной строке в примере подготовки. Дополнительные сведения о пространственных графах и объектных моделях Digital Twins см. в [этой статье](concepts-objectmodel-spatialgraph.md). 

### <a name="modify-sample-spatial-graph"></a>Изменение примера пространственного графа
Файл *provisionSample.yaml* содержит следующие узлы:

- **resources**: узел `resources` создает ресурс Центра Интернета вещей для взаимодействия с устройствами в вашем экземпляре настройки. Центр Интернета вещей в корневом узле графа может взаимодействовать со всеми устройствами и датчиками в графе.  

- **spaces**: в объектной модели Digital Twins объект `spaces` представляет физические расположения. Каждое пространство имеет тип (`Type`), например *Region* (Регион), *Venue* (Место проведения) или *Customer* (Клиент) и понятное имя (`Name`). Пространства могут принадлежать другим пространствам, в связи с чем формируется иерархическая структура. Файл *provisionSample.yaml* имеет пространственный граф воображаемого здания. Обратите внимание на логические вложения пространств типа `Floor` в `Venue`, `Area` на этаже и узлы `Room` в области. 

- **devices**: пространства могут содержать объекты `devices` (устройства), которые являются физическими или виртуальными сущностями, управляющими рядом датчиков. Например, устройством может быть телефон пользователя, датчик Raspberry Pi, шлюз и т. д. В воображаемом здании в вашем примере комната с названием *Focus Room* содержит *устройство Raspberry Pi 3 A1*. Каждый узел устройства определяется уникальным идентификатором `hardwareId`, который жестко задан в примере. Чтобы настроить этот пример для фактической рабочей среды, замените их на значения из вашего экземпляра настройки.  

- **sensors**: устройство может содержать несколько объектов `sensors` (датчики), позволяющих обнаруживать и записывать изменения физических показателей, таких как температура, движение, уровень заряда батареи и т. д. Каждый узел датчика определяется уникальным идентификатором `hardwareId`, который жестко задан в примере. Для реального приложения замените их уникальными идентификаторами датчиков в вашем экземпляре настройки. Файл *provisionSample.yaml* содержит два датчика для записи: *Motion* и *CarbonDioxide*. Добавьте еще один датчик для регистрации *Temperature*, добавив следующие строки под строками для датчика CarbonDioxide. Обратите внимание, что эти строки также присутствуют в файле *provisionSample.yaml* в закомментированном виде. Чтобы раскомментировать их, просто удалите символ # в начале каждой строки. 

    ```yaml
            - dataType: Temperature
              hardwareId: SAMPLE_SENSOR_TEMPERATURE
    ```
    > [!NOTE]
    > Убедитесь, что заданные ключи `dataType` и `hardwareId` совпадают с инструкциями над этим фрагментом кода. Кроме того, проверьте, что ваш редактор не заменяет пространства символами табуляции. 

Сохраните и закройте файл *provisionSample.yaml*. В следующем руководстве вы добавите дополнительную информацию в этот файл, а затем подготовите пример здания Azure Digital Twins.


## <a name="clean-up-resources"></a>Очистка ресурсов

Если на этом этапе вы хотите прекратить изучение Azure Digital Twins, можно удалить ресурсы, созданные в этом руководстве:

1. На [портале Azure](http://portal.azure.com) в меню слева щелкните **Все ресурсы**, выберите группу ресурсов Digital Twins и **удалите** ее.
2. Если необходимо, можно также удалить пример приложения на рабочем компьютере. 


## <a name="next-steps"></a>Дополнительная информация

Перейдите к следующему руководству в серии, чтобы узнать, как реализовать пользовательскую логику для мониторинга условий в вашем примере здания. 
> [!div class="nextstepaction"]
> [Руководство по подготовке примера здания и мониторинге условий работы с помощью Azure Digital Twins](tutorial-facilities-udf.md)

