---
title: Поиск свободных помещений с помощью Azure Digital Twins (C#) | Документация Майкрософт
description: В этом кратком руководстве вы запустите два примера приложения .NET Core для отправки смоделированных данных телеметрии движения и уровня углекислого газа в пространство Digital Twins. Цель — найти свободные помещения со свежим воздухом с помощью API управления после выполнения вычислительных процессов в облаке.
author: alinamstanciu
manager: bertvanhoof
ms.service: digital-twins
services: digital-twins
ms.devlang: csharp
ms.topic: quickstart
ms.custom: mvc
ms.date: 11/7/2018
ms.author: alinast
ms.openlocfilehash: 6e83ca543937948ad8028969cceca0f8787972c9
ms.sourcegitcommit: ba4570d778187a975645a45920d1d631139ac36e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2018
ms.locfileid: "51281224"
---
# <a name="quickstart-find-available-rooms-using-azure-digital-twins"></a>Краткое руководство. Поиск свободных помещений с помощью Azure Digital Twins

Служба Digital Twins позволяет воссоздать цифровой образ вашей физической среды. В результате вы сможете получать уведомления о событиях в своей среде и настраивать ответы на эти события. 

В этом кратком руководстве используется [пара примеров .NET](https://github.com/Azure-Samples/digital-twins-samples-csharp) для оцифровки смоделированного офисного здания, а также приводятся сведения о том, как найти свободные помещения в таком здании. С помощью Digital Twins можно связать несколько датчиков со своей средой. Кроме обнаружения свободных помещений, с помощью смоделированного датчика углекислого газа можно также выяснить, оптимальный ли в помещении воздух. Один из примеров приложений будет генерировать случайные данные датчиков для визуализации этого сценария.

В следующем видео дана краткая инструкция по настройке.

> [!VIDEO https://www.youtube.com/embed/1izK266tbMI]

## <a name="prerequisites"></a>Предварительные требования

1. Если у вас нет учетной записи Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

1. Два консольных приложения, запускаемые в рамках этого краткого руководства, написаны на языке C#. Вам нужно будет установить [пакет SDK для .NET Core версии 2.1.403 или более поздней](https://www.microsoft.com/net/download) на компьютере разработки. Если у вас установлен пакет SDK для .NET Core, можно проверить текущую версию C# на компьютере разработки, запустив `dotnet --version` в командной строке.

1. Скачайте [пример проекта C#](https://github.com/Azure-Samples/digital-twins-samples-csharp/archive/master.zip) и извлеките архив digital-twins-samples-csharp-master.zip. 


## <a name="create-a-digital-twins-instance"></a>Создание экземпляра Digital Twins

Создайте экземпляр службы Digital Twins на [портале](https://portal.azure.com) с помощью шагов, описанных в этом разделе.

[!INCLUDE [create-digital-twins-portal](../../includes/digital-twins-create-portal.md)]

## <a name="set-permissions-for-your-app"></a>Настройка разрешений для приложения

В этом разделе пример приложения регистрируется в Azure Active Directory (AAD), благодаря чему у него есть доступ к экземпляру Digital Twins. Если у вас уже есть регистрация приложения в AAD, вы можете повторно использовать ее для своего примера, настроив ее в соответствии с шагами, указанными в этом разделе. 

[!INCLUDE [digital-twins-permissions](../../includes/digital-twins-permissions.md)]


## <a name="build-application"></a>Сборка приложения

Запустите сборку приложения помещения с помощью следующих шагов:

1. Откройте командную строку и перейдите в папку, в которую были извлечены файлы digital-twins-samples-csharp-master.zip.
1. Запустите `cd occupancy-quickstart/src`.
1. Запустите `dotnet restore`.
1. Измените файл *appSettings.json*, чтобы обновить следующие переменные:
    - *ClientId*: введите *идентификатор приложения* из регистрации приложения AAD, записанный при работе с предыдущим разделом.
    - *Tenant*: введите *идентификатор каталога* клиента AAD, записанный при работе с предыдущим разделом.
    - *BaseUrl*: URL-адрес *API управления* экземпляра Digital Twins в следующем формате: `https://yourDigitalTwinsName.yourLocation.azuresmartspaces.net/management/api/v1.0/`. Замените заполнители в этом URL-адресе значениями для своего экземпляра из предыдущего раздела.

## <a name="provision-graph"></a>Подготовка графа

На этом шаге подготавливается пространственный граф Digital Twins с несколькими пространствами, одним устройством, двумя датчиками, пользовательской функцией и одним назначением роли. Пространственный граф будет подготовлен с помощью файла [*provisionSample.yaml*](https://github.com/Azure-Samples/digital-twins-samples-csharp/blob/master/occupancy-quickstart/src/actions/provisionSample.yaml).

1. Запустите `dotnet run ProvisionSample`.
    >[!NOTE]
    >Для проверки подлинности пользователя в Azure AD используется средство Azure CLI и имя для входа устройства. Пользователь должен ввести предоставленный код для проверки подлинности на странице [входа Майкрософт](https://microsoft.com/devicelogin). После этого выполните шаги, чтобы пройти проверку подлинности. Пользователю нужно проходить проверку подлинности каждый раз, когда средство запускается.
    
    >[!TIP]
    > Если при выполнении этого шага возникает следующая ошибка, проверьте, правильно ли скопированы переменные. 
    > `EXIT: Unexpected error: The input is not a valid Base-64 string ...`


1. Шаг по подготовке может занять несколько минут. В экземпляре Digital Twins будет также подготовлен Центр Интернета вещей. Он будет проходить цикл до появления состояния IoTHub `Running`.

    ![Пример подготовки][4]

1. В конце выполнения скопируйте строку устройства `ConnectionString`, чтобы использовать ее в примере симулятора устройства. Скопируйте только ту строку, которая выделена на рисунке ниже:

    ![Пример подготовки][1]

## <a name="send-sensor-data"></a>Отправка данных датчиков

Вы можете создать и запустить приложение симулятора датчика, используя следующие шаги:

1. Откройте новую командную строку и перейдите в проект, который вы скачали, в папке digital-twins-samples-csharp-master.
1. Запустите `cd device-connectivity`.
1. Запустите `dotnet restore`.
1. Измените файл *appsettings.json*, чтобы обновить строку *DeviceConnectionString* строкой `ConnectionString`, приведенной выше.
1. Запустите `dotnet run`, чтобы начать отправку данных датчиков. Отправка в службу Digital Twins должна выполняться, как показано ниже:

     ![Взаимодействие устройств][2]

1. Пусть этот симулятор работает, чтобы вы могли просматривать результаты параллельно с окном, где выполняются дальнейшие действия. В этом окне появятся данные смоделированных датчиков, отправленные в службу Digital Twins, а на следующем шаге будет выполнен запрос в режиме реального времени для поиска свободных помещений со свежим воздухом.

    >[!TIP]
    > Если при выполнении этого шага возникает следующая ошибка, проверьте, правильно ли скопирована строка `DeviceConnectionString`.  
    > `EXIT: Unexpected error: The input is not a valid Base-64 string ...`

## <a name="find-available-spaces-with-fresh-air"></a>Поиск свободного пространства со свежим воздухом

Пример с датчиками имитирует значения случайных данных для двух датчиков — движения и углекислого газа. Свободные пространства со свежим воздухом определяются в нашем примере отсутствием людей в помещении и уровнем углекислого газа ниже 1000 ppm. Если условие не выполняется, то пространство недоступно или качество воздуха плохое.

1. Откройте командную строку, которая использовалась на предыдущем этапе подготовки.
1. Запустите `dotnet run GetAvailableAndFreshSpaces`.
1. Разместите эту командную строку и командную строку данных датчиков рядом, как показано ниже. 
1. В одной командной строке отправляются смоделированные данные о движении и углекислом газе в Digital Twins каждые 5 секунд. В другой командной строке в режиме реального времени считывается граф для поиска свободных помещений со свежим воздухом на основе случайных смоделированных данных. В зависимости от того, какие данные датчиков были отправлены последними, в этой строке в режиме реального времени отобразится одно из следующих условий:
    - свободные помещения со свежим воздухом;
    - занятая комната или комната с плохим качеством воздуха.

     ![Получение свободного пространства со свежим воздухом][3]

Чтобы понять, что описано в этом кратком руководстве и какие API-интерфейсы были вызваны, откройте [Visual Studio Code](https://code.visualstudio.com/Download) с проектом рабочей области кода, доступным в digital-twins-samples-csharp (см. команду ниже). В руководствах подробно изучается код, а также приводятся сведения о том, какие API можно вызвать и как изменить данные конфигурации. Чтобы лучше ознакомиться с API-интерфейсами управления, перейдите на страницу Digital Twins Swagger `https://yourDigitalTwinsName.yourLocation.azuresmartspaces.net//management/swagger` или для удобства щелкните ссылку [Digital Twins Swagger](https://docs.westcentralus.azuresmartspaces.net/management/swagger). 

```
<path>\occupancy-quickstart\src>code ..\..\digital-twins-samples.code-workspace
```

## <a name="clean-up-resources"></a>Очистка ресурсов

В руководствах этой серии подробно рассказывается о том, как создать приложение для менеджеров объектов, чтобы повысить эффективность работы сотрудников и более эффективно эксплуатировать здание.

Если вы намерены перейти к их изучению, не удаляйте ресурсы, которые создали при работе с этим кратким руководством. Если вы не планируете продолжать работу, следуйте инструкциям ниже, чтобы удалить все созданные ресурсы.

1. Удалите папку, созданную при загрузке примера репозитория.
1. На [портале Azure](http://portal.azure.com) в меню слева щелкните **Все ресурсы** и выберите свой ресурс Digital Twins. В верхней части области **Все ресурсы** щелкните **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

В этом кратком руководстве приводится обзор простого сценария поиска помещений с оптимальными эксплуатационными условиями. Для более глубокого анализа этого сценария перейдите к этому руководству:

> [!div class="nextstepaction"]
> [Руководство по развертыванию Azure Digital Twins и настройке пространственного графа](tutorial-facilities-setup.md)

<!-- Images -->
[1]: media/quickstart-view-occupancy-dotnet/digital-twins-provision-sample.png
[2]: media/quickstart-view-occupancy-dotnet/digital-twins-device-connectivity.png
[3]: media/quickstart-view-occupancy-dotnet/digital-twins-get-available.png
[4]: media/quickstart-view-occupancy-dotnet/digital-twins-provision-sample1.png
