---
title: "Создание бессерверной панели мониторинга социальных сетей в Azure | Документация Майкрософт"
description: "Создание бессерверной панели мониторинга социальных сетей в Azure."
services: functions, logic-apps, cognitive-services
keywords: "рабочий процесс, облачные приложения, облачные службы, бизнес-процессы, системная интеграция, интеграция приложений, EAI"
documentationcenter: 
author: rick-anderson
manager: wpickett
editor: 
ms.assetid: 60495cc5-1638-4bf0-8174-52786d227734
ms.service: functions
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2017
ms.author: riande
ms.translationtype: Human Translation
ms.sourcegitcommit: 71fea4a41b2e3a60f2f610609a14372e678b7ec4
ms.openlocfilehash: 0d3eb2af197e9923d8e4a86bf1a0033f61e3c568
ms.contentlocale: ru-ru
ms.lasthandoff: 05/10/2017

---

# <a name="building-a-serverless-social-media-dashboard-in-azure"></a>Создание бессерверной панели мониторинга социальных сетей в Azure

[Функции Azure](functions-overview.md) интегрируются с [Azure Logic Apps](../logic-apps/logic-apps-what-are-logic-apps.md) для создания сложных оркестраций с другими службами Azure и сторонними службами. В этой статье показано, как запустить приложение логики из канала в социальных сетях и анализировать текст с помощью [Azure Cognitive Services](../cognitive-services/Welcome.md).

Здесь приведены сведения о создании на портале Azure приложения логики, которое:

> [!div class="checklist"]
> * Проверяет на наличие новых твитов по предоставленному ключевому слову или хэштегу.
> * Использует соединитель **определения тональности** для оценки мнений, выраженных в твитах (от отрицательных до положительных).
> * Обрабатывает мнения, выраженные в твитах, с помощью функции Azure, разделяя их на три категории (RED, YELLOW или GREEN — отрицательные, нейтральные и положительные соответственно).
> * Проверяет, является ли мнение RED (отрицательным) с помощью условия.
> * Отправляет сообщения электронной почты, если выполняется условие для отрицательного мнения.

На следующем рисунке показана часть приложения логики в конструкторе:

![Изображение первых двух действий приложения в конструкторе приложений логики](media/functions-twitter-email/designer1.png)

## <a name="prerequisites"></a>Предварительные требования

* Учетная запись Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/) , прежде чем начинать работу.
* Учетная запись Twitter.

## <a name="create-a-function-app"></a>Создание приложения-функции
 
[!INCLUDE [functions-create-function-app-portal](../../includes/functions-create-function-app-portal2.md)]

### <a name="create-a-categorize-function"></a>Создание функций классификации

После завершения развертывания приложения-функции откройте его. В этом разделе описано, как создать функцию для классификации мнений, выраженных в твитах, на три категории (RED, YELLOW или GREEN — отрицательные, нейтральные и положительные соответственно).

![Колонка приложения-функции, добавление функции](media/functions-twitter-email/add_fun.png)

Оставьте значения **Webhook + API**, **CSharp** по умолчанию и нажмите кнопку **Создайте эту функцию**.

![Колонка приложения-функции, добавление функции](media/functions-twitter-email/add_fun2.png)

Вы создали функцию типа "Webhook + API" (также известную как триггер HTTP), которую впоследствии сможет вызвать по запросу созданное вами приложение. Если требуется создать функцию, которая запускается по расписанию, создайте функцию таймера.

Замените содержимое файла *run.csx* следующим кодом:

```c#
using System.Net;

public static async Task<HttpResponseMessage> Run(HttpRequestMessage req, TraceWriter log)
{
    log.Info("C# HTTP trigger function processed a request.");
    string category = "GREEN";

    // Get request body.
    double score = await req.Content.ReadAsAsync<double>();

    if (score < .3)
    {
        category = "RED";
    }
    else if (score < .6)
    {
        category = "YELLOW";
    }

    return req.CreateResponse(HttpStatusCode.OK, category);
}
```

Сохраните изменения.

### <a name="test-the-function"></a>Проверка функции

Выберите **Тест** (в правой части поля кода).  Введите 0.2 в текстовом поле **Текст запроса**, а затем нажмите кнопку **Запустить**. В выходных данных отображается результат RED и состояние HTTP — 200 OK.

 ![test ](media/functions-twitter-email/test.png)

## <a name="cognitive-services"></a>Cognitive Services

Создайте учетную запись Cognitive Services. Учетная запись Cognitive Services необходима, чтобы определить мнения, выраженные в твитах, которые мы отслеживаем.

Последовательно выберите **Создать > Аналитика > Cognitive Services**. Заполните все необходимые поля:

![Колонка создания учетной записи Cognitive Services](media/functions-twitter-email/cog_svcs_account.png)

| Поле               | Образец значения | Комментарий |
| ----------------- | ------------ | ------------- |
| Имя учетной записи | MyCognitiveServicesAccnt | Укажите уникальное имя. |
| Тип API | API анализа текста | Выберите "Текстовая аналитика". |
| Расположение | Запад США | Сейчас доступен только регион **западная часть США**. |
| Ценовой уровень | F0 | Если вы превысили количество вызовов, перейдите на более высокий уровень.|
| Группа ресурсов | rg1 | Используйте группу ресурсов, указанную ранее.|

### <a name="copy-the-cognitive-services-key"></a>Копирование ключа Cognitive Services

Выберите **Ключи**. Вам потребуется ключ в дальнейшем.

 ![ключей](media/functions-twitter-email/keys.png)

## <a name="create-a-logic-app"></a>Создайте приложение логики

На портале Azure щелкните **Создать > Интеграция с предприятием > Приложение логики**.

![Предварительный шаг перед созданием приложения логики](media/functions-twitter-email/new_logicApp.png)

В колонке **Создание приложения логики** заполните все поля и нажмите кнопку **Создать**.

![Предварительный шаг перед созданием приложения логики](media/functions-twitter-email/new_logicApp2.png)

Сразу после создания приложение логики откроется в конструкторе. Выберите шаблон **Пустое приложение логики**.

![Пустое приложение логики](media/functions-twitter-email/blank.png)

## <a name="add-a-trigger-to-twitter"></a>Добавление триггера в Twitter

**Конструктор приложения логики** отображает множество служб и триггеров, к которым можно подключиться.

Выберите службу **Twitter**.

![Соединитель Twitter](media/functions-twitter-email/twitter_connector.png)

Выберите триггер **When a new tweet is posted** (При публикации нового твита).

![Триггер When a new tweet is posted (При публикации нового твита)](media/functions-twitter-email/tw_trig.png)

Войдите в учетную запись Twitter.

![Вход в учетную запись Twitter](media/functions-twitter-email/signin_twit.png)

Введите пароль и нажмите кнопку **Authorize app** (Авторизация приложения).

![Проверка подлинности Twitter в упомянутом выше окне создания](media/functions-twitter-email/auth_twit.png)

Введите текст запроса, частоту и интервал. Если указать популярный хэштег (например, #football, #soccer или #futbol), вы сможете быстро использовать выделенные вызовы службы в учетной записи Cognitive Services. Если вы превысили количество вызовов, перейдите на более высокую ценовую категорию. 

Выполняйте поиск по запросу #Azure с интервалом в 15 минут:

![Поиск по запросу #Azure с интервалом в 15 минут](media/functions-twitter-email/azure_tweet.png)

Сохраните приложение.

### <a name="add-a-text-analytics-connector"></a>Добавление соединителя **анализа текста**

Соединитель анализа текста позволяет определять мнения, выраженные в твитах.

Выберите **Новый шаг**, а затем — **Добавить действие**.

![Выбор действий "Новый шаг" и "Добавить действие"](media/functions-twitter-email/new_step.png)

Добавьте соединитель **Текстовая аналитика**.

![Окно "Выберите действие"](media/functions-twitter-email/choose_action.png)

Выберите действие **Detect Sentiment** (Определение тональности). В большинстве случаев оценка мнений правильна, но в некоторых случаях текст может быть неправильно интерпретирован.

![Определение мнений](media/functions-twitter-email/detect_sent.png)

### <a name="create-the-detect-sentiment-action"></a>Создание действия определения тональности

  * Введите имя подключения, например **MyKey**.
  * Скопируйте и вставьте ключ, созданный на этапе [создания учетной записи Cognitive Services](#cognitive-services).
  * Нажмите кнопку **Создать**.
  * Сохраните приложение.

![Определение мнений](media/functions-twitter-email/ta_detect_sent.png)

Выберите значок **Текст твита** в качестве **текста для анализа**.

![Определение мнений](media/functions-twitter-email/ds_tta.png)

![Определение мнений](media/functions-twitter-email/ds_tta2.png)

Сохраните приложение.

## <a name="connect-to-the-azure-function"></a>Подключение к функции Azure

В этом разделе описано, как добавить созданную ранее функцию, которая классифицирует мнения, выраженные в твитах, на категории на RED, YELLOW и GREEN.

* В конструкторе приложений логики выберите **Новый шаг**, а затем выберите **Добавить действие**.
* Выберите **Функции Azure**.
* Щелкните **Выберите функцию Azure**.

![Окно с функцией Azure и параметром "Выберите функцию Azure"](media/functions-twitter-email/choose_fun.png)

* Выберите созданную ранее функцию Azure.
* Выберите **Оценка**, чтобы заполнить **текст запроса**.

![Оценка](media/functions-twitter-email/trigger_score.png)

Сохраните приложение.

## <a name="add-email-notification"></a>Настройка отправки уведомления по электронной почте

В этом разделе мы добавим условную проверку на отрицательные мнения, выраженные в твитах (условие RED).

* Выберите **Новый шаг**.
* Выберите **Добавить условие**.
* Выберите **Текст** в первом текстовом поле **Выберите значение**.
* Во втором текстовом поле **Выберите значение** введите RED.
* Сохраните приложение.

![Поле условия](media/functions-twitter-email/condition.png)

* В разделе **IF YES, DO NOTHING** (Если да, ничего не предпринимать) выберите **Добавить действие**.
* Введите Outlook или Gmail в поле **Поиск по всем службам и действиям**. В этом руководстве используется Outlook. Инструкции по Gmail см. в разделе "Добавление действия, которое будет реагировать на триггер" (../logic-apps/logic-apps-create-a-logic-app.md#add-an-action-that-responds-to-your-trigger). Примечание. Если у вас есть личная [учетная запись Майкрософт](https://account.microsoft.com/account), ее можно использовать для учетной записи Outlook.com.

![Поле "Выберите действие"](media/functions-twitter-email/outlook.png)

Выберите **Outlook.com, Отправить сообщение**.

![Поле Outlook.com](media/functions-twitter-email/sendEmail.png)

Войдите в Outlook.com.

![Окно входа](media/functions-twitter-email/signin_outlook.png)

Задайте следующие параметры:

   * **Кому.** Электронный адрес, на который должно отправляться сообщение.
   * **Тема.** "Оценка".
   * **Текст.** Расположение и текст твита.

![Окно "Отправить сообщение"](media/functions-twitter-email/sendEmail2.png)

Сохраните приложение.
Выберите **Запустить**, чтобы запустить приложение.

### <a name="check-the-status"></a>Проверка состояния

В колонке приложения логики выберите **Обзор**, а затем выберите строку в столбце **журнала запусков**:

![Колонка "Обзор"](media/functions-twitter-email/over1.png)

На следующем рисунке показаны сведения о запуске, когда условие не выполнялось и сообщение электронной почты не было отправлено.

![Колонка "Обзор"](media/functions-twitter-email/skipped.png)

Если вы хотите проверить функцию **Отправить электронное письмо**, сделайте следующее:

* Измените **входные данные**, указанные на первом шаге (**При публикации нового твита**), на более распространенный термин, например #football, #soccer или #futbol.

Обработка популярных терминов потребляет больше ресурсов, чем обработка менее популярных. Когда вы проверите, что сообщение электронной почты отправляется, можно изменить поисковый запрос.

На следующем рисунке показаны сведения о запуске, когда условие выполнялось и было отправлено сообщение электронной почты.

![Колонка "Обзор"](media/functions-twitter-email/sent.png)

Выберите любое поле службы, чтобы вывести дополнительные сведения о данных, которые использовались для запуска. Выберите **When a new tweet is posted** (При публикации нового твита), чтобы просмотреть текст запроса и все выходные данные, в том числе выходные данные, которые не использовались.

## <a name="next-steps"></a>Дальнейшие действия

*  [Общие сведения о Функциях Azure](functions-overview.md)
*  [Azure Logic Apps](../logic-apps/logic-apps-what-are-logic-apps.md)
*  [Добавление условий и запуск рабочих процессов](../logic-apps/logic-apps-use-logic-app-features.md)
*  [Настройка рабочего процесса с помощью встроенного шаблона или схемы для быстрого начала работы](../logic-apps/logic-apps-use-logic-app-templates.md)
*  [Создание приложения логики с помощью шаблона](../logic-apps/logic-apps-arm-provision.md)

## <a name="get-help"></a>Получение справки

Чтобы задать вопросы, помочь другим пользователям и узнать, что делают другие пользователи, посетите [форум по Azure Logic Apps](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurelogicapps).

Чтобы улучшить Azure Logic Apps и соединители, голосуйте за идеи или предлагайте собственные на [сайте обратной связи Azure Logic Apps](http://aka.ms/logicapps-wish).

