---
title: Интеграция Функций Azure с виртуальной сетью Azure
description: Пошаговое руководство по подключению Функции к виртуальной сети Azure
services: functions
author: alexkarcher-msft
manager: jehollan
ms.service: azure-functions
ms.topic: article
ms.date: 12/03/2018
ms.author: alkarche
ms.openlocfilehash: 4f27bbeb43bbf373b621d151d68583f0041378b3
ms.sourcegitcommit: 0a3efe5dcf56498010f4733a1600c8fe51eb7701
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2019
ms.locfileid: "58894212"
---
# <a name="integrate-a-function-app-with-an-azure-virtual-network"></a>Интеграция приложения-функции с виртуальной сетью Azure

В этом пошаговом руководстве показано, как подключиться из Функций Azure к ресурсам в виртуальной сети Azure.

В этом руководстве мы Развернем веб-сайта WordPress на виртуальной Машине в частной, недоступные из Интернета доступны, виртуальной сети. Затем мы развернем Функцию, у которой будет доступ как к Интернету, так и к виртуальной сети. Мы будем использовать эту функцию для доступа к ресурсам из сайта WordPress, развертываются в виртуальной сети.

Дополнительные сведения о работе системы, об устранении неполадок и расширенных возможностях конфигурации см. в руководстве по [интеграции приложения с виртуальной сетью Azure](https://docs.microsoft.com/azure/app-service/web-sites-integrate-with-vnet). Функции Azure в план "премиум" имеют те же возможности размещения веб-приложений, поэтому все функциональные возможности и ограничения в этом документе применимы к функциям.

## <a name="topology"></a>Топология

 ![Пользовательский интерфейс интеграции с виртуальной сетью][1]

## <a name="creating-a-vm-inside-of-a-vnet"></a>Создание виртуальной машины в пределах виртуальной сети

Для начала мы создадим предварительно настроенную виртуальную со службой WordPress в пределах виртуальной сети. 

Мы выбрали именно WordPress на виртуальной машине, так как это один из самых недорогих ресурсов, которые можно развернуть в виртуальной сети. Обратите внимание, что этот сценарий также можно использовать с любым ресурсом в виртуальной сети, например API-интерфейсы REST, среды службы приложений и других служб Azure.

1. Перейдите на портал Azure.
2. Добавьте новый ресурс, открыв колонку "Создание ресурса".
3. Поиск "[производительности Max LEMP7 WordPress на виртуальной машине CentOS](https://jetware.io/appliances/jetware/wordpress4_lemp7-170526/profile?us=azure)" и откройте ее колонку "Создание" 
4. В колонке создания настройте виртуальную машину, указав следующую информацию:
    1. Создайте для этой виртуальной машины группу ресурсов, чтобы упростить удаление ресурсов в конце этого руководства. В этом примере для группы ресурсов используется имя Function-VNET-Tutorial.
    1. Введите уникальное имя виртуальной машины. В этом примере используется VNET-Wordpress.
    1. Выберите ближайший к вам регион.
    1. Выберите размер B1s (1 виртуальный ЦП и 1 ГБ памяти)
    1. Для учетной записи администратора включите аутентификацию на основе пароля и введите уникальное имя пользователя и пароль. Для целей этого руководства входить в виртуальную машину не нужно, если только не возникнут проблемы.
    
        ![Создать вкладку на основ виртуальной Машины](./media/functions-create-vnet/create-vm-1.png)

1. Перейдите на вкладку "Сети" и введите следующие сведения:
    1.  Создание виртуальной сети
    1.  Введите нужный диапазон частных IP-адресов и выберите подсеть в этом диапазоне адресов. Размер этой подсети определяет, сколько виртуальных машин можно использовать в плане службы приложений. Если вы плохо ориентируетесь в IP-адресах и подсетях, изучите [общие сведения](https://support.microsoft.com/en-us/help/164015/understanding-tcp-ip-addressing-and-subnetting-basics). IP-адреса и подсети очень важны в этом сценарии, поэтому мы рекомендуем прочитать несколько статей и просмотреть видео, чтобы разобраться в этом вопросе. 
        1. В этом примере мы используем сеть 10.10.0.0/16 с подсетью 10.10.1.0/24. Конечно же, столько адресов нам не нужно, но в подсети 10.10.0.0/16 очень легко вычислить доступные подсети.
        
        <img src="./media/functions-create-vnet/create-vm-2.png" width="700">

1. Вернитесь на вкладку "Сети" и укажите для параметра "Общедоступный IP-адрес" значение "Нет". Это означает, что у развернутой виртуальной машины будет доступ только к виртуальной сети.
       
    <img src="./media/functions-create-vnet/create-vm-2-1.png" width="700">

7. Создайте виртуальную машину. Весь процесс займет около 5 минут.
8. Когда создание виртуальной машины завершится, перейдите на вкладку "Сети" и запишите частный IP-адрес, который нам понадобится позже. Не выделяйте для виртуальной машины общедоступный IP-адрес.

    ![14]

Теперь вам нужно развернуть веб-сайт WordPress в пределах этой виртуальной сети. Этот сайт не будет доступен из Интернета.

## <a name="create-a-premium-plan-function-app"></a>Создание приложения-функции плана "премиум"

Следующим шагом является создание приложения-функции в плане "премиум". План "премиум" представляет собой новое предложение, которая объединяет бессерверной масштабирования со всеми преимуществами выделенного плана службы приложений. Приложения-функции плана потребления не поддерживают интеграцию с виртуальной сетью.

[!INCLUDE [functions-premium-create](../../includes/functions-premium-create.md)]  

## <a name="connect-your-function-app-to-your-vnet"></a>Подключение приложения-функции к виртуальной сети

С помощью веб-сайта WordPress обмануть файлы в виртуальной сети теперь можно подключиться к виртуальной сети приложения-функции.

1.  На портале приложения-функции из предыдущего шага выберите **Функции платформы**, а затем **Сети**

    <img src="./media/functions-create-vnet/networking-0.png" width="850">

1.  Выберите **Щелкните, чтобы настроить** в разделе интеграции с виртуальной сетью.

    ![Настройка состояния сетевых компонентов](./media/functions-create-vnet/Networking-1.png)

1. На странице интеграции с виртуальной сетью выберите **Добавить виртуальную сеть (предварительная версия)**.

    <img src="./media/functions-create-vnet/networking-2.png" width="600"> 
    
1.  Создайте для функции подсеть и план службы приложений. Обратите внимание на то, что размер подсети ограничивает общее число виртуальных машин, которое вы можете добавить в план службы приложений. Виртуальная сеть автоматически направит трафик между подсетями в виртуальной сети. При этом не имеет значения, что сама функция и виртуальная машина находятся в разных подсетях. 
    
    <img src="./media/functions-create-vnet/networking-3.png" width="600">

## <a name="create-a-function-that-accesses-a-resource-in-your-vnet"></a>Создание функции, которая обращается к ресурсу в виртуальной сети

Теперь приложение-функция может обращаться к виртуальной сети, где расположен сайт WordPress, и мы применим эту функцию для доступа к нужному файлу и передачи его пользователю. В этом примере мы применим сайт WordPress в качестве API-интерфейса, а прокси функции — для вызова функций, так как их очень легко настроить и визуализировать. Вы можете также использовать другие API, развернутые в виртуальной сети, и любую другую функцию, код которой обращается к API, развернутому в пределах виртуальной сети. Отличным примером будет сервер SQL, развернутый в виртуальной сети.

1. Войдите на портал и откройте приложение-функцию, созданное на предыдущем шаге
1. Создайте прокси-сервер, выбрав раздел **Прокси-серверы** > **+**.

    <img src="./media/functions-create-vnet/new-proxy.png" width="250">

1. Настройте имя и маршруты для прокси-сервера. В этом примере используется маршрут /plant.
1. Введите IP-адрес сайта wordpress из более ранней версии и задайте URL-адреса серверной части `http://{YOUR VM IP}/wp-content/themes/twentyseventeen/assets/images/header.jpg`
    
    <img src="./media/functions-create-vnet/create-proxy.png" width="900">

Теперь при попытке перейти по URL-адресу серверной части, введя его в новой вкладке браузера, вы получите ошибку превышения времени ожидания. Это ожидаемое поведение, так как сайт WordPress подключен только к виртуальной сети и не доступен через Интернет. Скопировав в браузер URL-адрес прокси-сервера, вы увидите красивую фотографию растения, полученную с сайта WordPress, размещенного в пределах виртуальной сети. 

Приложение-функция подключено одновременно к Интернету и виртуальной сети. Прокси-сервер получает запрос из общедоступного сегмента Интернета и выполняет роль простого HTTP-прокси, пересылая этот запрос в виртуальную сеть. Затем прокси-сервер передает ответ обратно через общедоступный сегмент Интернета. 

<img src="./media/functions-create-vnet/plant.png" width="900">

## <a name="next-steps"></a>Следующие шаги

Функций, выполняемых в план "премиум" совместное использование одной базовой инфраструктуре службы приложений как веб-приложения. Это означает, что вся документация для веб-приложений применяется к функции плана "премиум".

1. [Дополнительные сведения об интеграции виртуальной сети с помощью службы приложений и функций здесь](https://docs.microsoft.com/azure/app-service/web-sites-integrate-with-vnet)
1. [Дополнительные сведения о виртуальных сетях в Azure](https://azure.microsoft.com/documentation/articles/virtual-networks-overview/)
1. [Включите для сетевые компоненты и управления со средами службы приложений](https://docs.microsoft.com/azure/app-service/environment/intro)
1. [Подключиться к отдельным локальным ресурсам без изменений брандмауэра с помощью гибридных подключений](https://docs.microsoft.com/azure/app-service/app-service-hybrid-connections)
1. [Дополнительные сведения о прокси-серверы функций](https://review.docs.microsoft.com/azure/azure-functions/functions-proxies)

<!--Image references-->
[1]: ./media/functions-create-vnet/topology.png
[2]: ./media/functions-create-vnet/create-function-app.png
[3]: ./media/functions-create-vnet/create-app-service-plan.png
[4]: ./media/functions-create-vnet/configure-vnet.png
[5]: ./media/functions-create-vnet/create-vm-1.png
[6]: ./media/functions-create-vnet/create-vm-2.png
[7]: ./media/functions-create-vnet/create-vm-2-1.png
[8]: ./media/functions-create-vnet/networking-1.png
[9]: ./media/functions-create-vnet/networking-2.png
[10]: ./media/functions-create-vnet/networking-3.png
[11]: ./media/functions-create-vnet/new-proxy.png
[12]: ./media/functions-create-vnet/create-proxy.png
[14]: ./media/functions-create-vnet/vm-networking.png
