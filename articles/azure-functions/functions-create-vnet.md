---
title: Интеграция Функций Azure с виртуальной сетью Azure
description: Пошаговое руководство по подключению Функции к виртуальной сети Azure
services: functions
author: alexkarcher-msft
manager: jehollan
ms.service: azure-functions
ms.topic: article
ms.date: 12/03/2018
ms.author: alkarche
ms.openlocfilehash: 1140c23a0aa5344119c35434316ec73cc3918f90
ms.sourcegitcommit: d4f728095cf52b109b3117be9059809c12b69e32
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/10/2019
ms.locfileid: "54198377"
---
# <a name="integrate-a-function-app-with-an-azure-virtual-network"></a>Интеграция приложения-функции с виртуальной сетью Azure
В этом пошаговом руководстве показано, как подключиться из Функций Azure к ресурсам в виртуальной сети Azure. 

В этом руководстве мы развернем веб-сайт WordPress на виртуальной машине в частной виртуальной сети, недоступной из Интернета. Затем мы развернем Функцию, у которой будет доступ как к Интернету, так и к виртуальной сети. С помощью этой Функции можно будет получить доступ к ресурсам с сайта WordPress, развернутого в виртуальной сети.

Дополнительные сведения о работе системы, об устранении неполадок и расширенных возможностях конфигурации см. в руководстве по [интеграции приложения с виртуальной сетью Azure](https://docs.microsoft.com/azure/app-service/web-sites-integrate-with-vnet). Функции Azure предоставляют выделенный план обслуживания с теми же возможностями размещения, что у веб-приложений. Это означает, что все возможности и ограничения, описанные в этой статье, применимы к Функциям Azure.

## <a name="topology"></a>Топология
 ![Пользовательский интерфейс интеграции с виртуальной сетью][1]

## <a name="creating-a-vm-inside-of-a-vnet"></a>Создание виртуальной машины в пределах виртуальной сети

Для начала мы создадим предварительно настроенную виртуальную со службой WordPress в пределах виртуальной сети. 

Мы выбрали именно WordPress на виртуальной машине, так как это один из самых недорогих ресурсов, которые можно развернуть в виртуальной сети. Но мы хотим подчеркнуть, что этот сценарий можно применить к любому ресурсу в виртуальной сети, включая REST API, другие службы Azure, среды службы приложений и т. д.

1.  Перейдите на портал Azure.
2.  Добавьте новый ресурс, открыв колонку "Создание ресурса".
3.  Выполните поиск по строке [Wordpress LEMP7 Max Performance on CentOS](https://jetware.io/appliances/jetware/wordpress4_lemp7-170526/profile?us=azure) и откройте колонку создания ресурса. 
4.  В колонке создания настройте виртуальную машину, указав следующую информацию:
    1.  Создайте для этой виртуальной машины группу ресурсов, чтобы упростить удаление ресурсов в конце этого руководства. В этом примере для группы ресурсов используется имя Function-VNET-Tutorial.
    1.  Введите уникальное имя виртуальной машины. В этом примере используется VNET-Wordpress.
    1.  Выберите ближайший к вам регион.
    1.  Выберите размер B1s (1 виртуальный ЦП и 1 ГБ памяти)
    1.  Для учетной записи администратора включите аутентификацию на основе пароля и введите уникальное имя пользователя и пароль. Для целей этого руководства входить в виртуальную машину не нужно, если только не возникнут проблемы.
    
        <img src="./media/functions-create-vnet/create-VM-1.png" width="700">

1. Перейдите на вкладку "Сети" и введите следующие сведения:
    1.  Создание виртуальной сети
    1.  Введите нужный диапазон частных IP-адресов и выберите подсеть в этом диапазоне адресов. Размер этой подсети определяет, сколько виртуальных машин можно использовать в плане службы приложений. Если вы плохо ориентируетесь в IP-адресах и подсетях, изучите [общие сведения](https://support.microsoft.com/en-us/help/164015/understanding-tcp-ip-addressing-and-subnetting-basics). IP-адреса и подсети очень важны в этом сценарии, поэтому мы рекомендуем прочитать несколько статей и просмотреть видео, чтобы разобраться в этом вопросе. 
        1. В этом примере мы используем сеть 10.10.0.0/16 с подсетью 10.10.1.0/24. Конечно же, столько адресов нам не нужно, но в подсети 10.10.0.0/16 очень легко вычислить доступные подсети.
        
        <img src="./media/functions-create-vnet/create-VM-2.png" width="700">

1. Вернитесь на вкладку "Сети" и укажите для параметра "Общедоступный IP-адрес" значение "Нет". Это означает, что у развернутой виртуальной машины будет доступ только к виртуальной сети.
       
    <img src="./media/functions-create-vnet/create-VM-2.1.png" width="700">

7. Создайте виртуальную машину. Весь процесс займет около 5 минут.
8. Когда создание виртуальной машины завершится, перейдите на вкладку "Сети" и запишите частный IP-адрес, который нам понадобится позже. Не выделяйте для виртуальной машины общедоступный IP-адрес.

    ![14]

Теперь вам нужно развернуть веб-сайт WordPress в пределах этой виртуальной сети. Этот сайт не будет доступен из Интернета.

## <a name="create-a-dedicated-function-app"></a>Создание выделенного приложения-функции

Следующим шагом будет создание приложения-функции в плане службы приложений уровня "Стандартный" или выше. Обратите внимание, что этот план потребления для приложения-функции не поддерживает интеграцию с виртуальной сетью.

1. Перейдите на портал Azure.
2. Добавьте новый ресурс, открыв колонку "Создание ресурса".
3. Выберите "Бессерверное приложение-функция".
4. Введите в колонке создания все обычные параметры за одним исключением:
    1. Выберите план службы приложений уровня "Стандартный" или выше.

        <img src="./media/functions-create-vnet/Create-App-Service-Plan.PNG" width="300">
    
1. Вот как выглядит колонка для создания ресурса.

    <img src="./media/functions-create-vnet/Create-Function-App.png" width="300">


## <a name="connect-your-function-app-to-your-vnet"></a>Подключение приложения-функции к виртуальной сети

Теперь у нас есть сайт WordPress, размещающий файлы из виртуальной сети, и нам нужно подключить приложение-функцию к этой виртуальной сети.

1.  На портале приложения-функции из предыдущего шага выберите **Функции платформы**, а затем **Сети**
1.  Выберите **Щелкните, чтобы настроить** в разделе интеграции с виртуальной сетью.

    <img src="./media/functions-create-vnet/Networking-1.png" width="450">

1. На странице интеграции с виртуальной сетью выберите **Добавить виртуальную сеть (предварительная версия)**.

    <img src="./media/functions-create-vnet/Networking-2.png" width="600"> 
    
1.  Создайте для функции подсеть и план службы приложений. Обратите внимание на то, что размер подсети ограничивает общее число виртуальных машин, которое вы можете добавить в план службы приложений. Виртуальная сеть автоматически направит трафик между подсетями в виртуальной сети. При этом не имеет значения, что сама функция и виртуальная машина находятся в разных подсетях. 
    
    <img src="./media/functions-create-vnet/Networking-3.png" width="600">

## <a name="create-a-function-that-accesses-a-resource-in-your-vnet"></a>Создание функции, которая обращается к ресурсу в виртуальной сети

Теперь приложение-функция может обращаться к виртуальной сети, где расположен сайт WordPress, и мы применим эту функцию для доступа к нужному файлу и передачи его пользователю. В этом примере мы применим сайт WordPress в качестве API-интерфейса, а прокси функции — для вызова функций, так как их очень легко настроить и визуализировать. Вы можете также использовать другие API, развернутые в виртуальной сети, и любую другую функцию, код которой обращается к API, развернутому в пределах виртуальной сети. Отличным примером будет сервер SQL, развернутый в виртуальной сети.

1. Войдите на портал и откройте приложение-функцию, созданное на предыдущем шаге
1. Создайте прокси-сервер, выбрав раздел **Прокси-серверы** > **+**.

    <img src="./media/functions-create-vnet/New-Proxy.png" width="250">

1. Настройте имя и маршруты для прокси-сервера. В этом примере используется маршрут /plant.
1. Введите IP-адрес сайта WordPress, который мы записали ранее, и задайте для серверной части URL-адрес `http://{YOUR VM IP}/wp-content/themes/twentyseventeen/assets/images/header.jpg`.
    
    <img src="./media/functions-create-vnet/Create-Proxy.png" width="900">

Теперь при попытке перейти по URL-адресу серверной части, введя его в новой вкладке браузера, вы получите ошибку превышения времени ожидания. Это ожидаемое поведение, так как сайт WordPress подключен только к виртуальной сети и не доступен через Интернет. Скопировав в браузер URL-адрес прокси-сервера, вы увидите красивую фотографию растения, полученную с сайта WordPress, размещенного в пределах виртуальной сети. 

Приложение-функция подключено одновременно к Интернету и виртуальной сети. Прокси-сервер получает запрос из общедоступного сегмента Интернета и выполняет роль простого HTTP-прокси, пересылая этот запрос в виртуальную сеть. Затем прокси-сервер передает ответ обратно через общедоступный сегмент Интернета. 

<img src="./media/functions-create-vnet/Plant.png" width="900">

## <a name="next-steps"></a>Дальнейшие действия

Функции Azure, запущенные в планах службы приложений, выполняются в той же службе, что и веб-приложения, а значит вся документация по веб-приложениям будет применима к выделенным Функциям Azure.

1. [Интеграция приложения с виртуальной сетью Azure](https://docs.microsoft.com/azure/app-service/web-sites-integrate-with-vnet)
1. [Что такое виртуальная сеть Azure?](https://azure.microsoft.com/documentation/articles/virtual-networks-overview/)
1. [Общие сведения о средах службы приложений](https://docs.microsoft.com/azure/app-service/environment/intro)
1. [Гибридные подключения к службе приложений Azure](https://docs.microsoft.com/azure/app-service/app-service-hybrid-connections)
1. [Сведения о прокси функций](https://review.docs.microsoft.com/azure/azure-functions/functions-proxies)

<!--Image references-->
[1]: ./media/functions-create-vnet/topology.png
[2]: ./media/functions-create-vnet/Create-Function-App.png
[3]: ./media/functions-create-vnet/Create-App-Service-Plan.PNG
[4]: ./media/functions-create-vnet/configure-VNET.png
[5]: ./media/functions-create-vnet/create-VM-1.png
[6]: ./media/functions-create-vnet/create-VM-2.png
[7]: ./media/functions-create-vnet/create-VM-2.1.png
[8]: ./media/functions-create-vnet/Networking-1.png
[9]: ./media/functions-create-vnet/Networking-2.png
[10]: ./media/functions-create-vnet/Networking-3.png
[11]: ./media/functions-create-vnet/New-Proxy.png
[12]: ./media/functions-create-vnet/Create-Proxy.png
[14]: ./media/functions-create-vnet/VM-Networking.png
