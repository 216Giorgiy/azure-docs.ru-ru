<properties
	pageTitle="Привязки мобильных приложений в функциях Azure | Microsoft Azure"
	description="Узнайте, как использовать привязки мобильных приложений Azure в функциях Azure."
	services="functions"
	documentationCenter="na"
	authors="ggailey777"
	manager="erikre"
	editor=""
	tags=""
	keywords="функции azure, функции, обработка событий, динамические вычисления, независимая архитектура"/>

<tags
	ms.service="functions"
	ms.devlang="multiple"
	ms.topic="reference"
	ms.tgt_pltfrm="multiple"
	ms.workload="na"
	ms.date="06/02/2016"
	ms.author="glenga"/>

# Привязки мобильных приложений в функциях Azure

[AZURE.INCLUDE [functions-selector-bindings](../../includes/functions-selector-bindings.md)]

Эта статья объясняет, как настроить и запрограммировать привязки мобильных приложений Azure в функциях Azure.

[AZURE.INCLUDE [общие сведения](../../includes/functions-bindings-intro.md)]

Мобильные приложения службы приложений Azure позволяют предоставлять данные конечных точек таблиц мобильным клиентам. Эти же табличные данные можно использовать во входных и выходных привязках в Функциях Azure. Мобильное приложение серверной части Node.js идеально подходит для предоставления табличных данных, которые можно использовать с функциями, так как оно поддерживает динамическую схему. Динамическая схема включена по умолчанию и должна быть отключена в рабочем мобильном приложении. Дополнительные сведения о конечных точках таблицы в серверной части на основе Node.js. см. в разделе [Операции с таблицами](../app-service-mobile/app-service-mobile-node-backend-how-to-use-server-sdk.md#TableOperations). В мобильных приложениях серверная часть Node.js поддерживает возможность просмотра и изменения таблиц на портале. Дополнительные сведения см. в разделе [Практическое руководство. Работа с простыми таблицами на портале Azure](../app-service-mobile/app-service-mobile-node-backend-how-to-use-server-sdk.md#in-portal-editing) в статье "Использование пакета SDK Node.js для мобильных приложений Azure". При использовании мобильного приложения серверной части .NET с Функциями Azure необходимо вручную обновить модель данных, как требуется для вашей функции. Дополнительные сведения о конечных точках таблицы в мобильном приложении серверной части .NET см. в разделе [Практическое руководство. Определение контроллера таблицы](../app-service-mobile/app-service-mobile-dotnet-backend-how-to-use-server-sdk.md#define-table-controller) в статье "Работа с пакетом SDK для внутреннего сервера .NET для мобильных приложений Azure".

## Создание переменной среды для URL-адреса внутреннего сервера мобильных приложений

В настоящее время для привязок мобильных приложений требуется создание переменной среды, которая возвращает URL-адрес внутреннего сервера мобильных приложений. Этот URL-адрес можно найти на [портале Azure](https://portal.azure.com), выполнив поиск мобильного приложения и открыв его колонку.

![Колонка мобильных приложений на портале Azure](./media/functions-bindings-mobile-apps/mobile-app-blade.png)

Чтобы задать этот URL-адрес в качестве переменной среды в приложении-функции, выполните следующие действия.

1. В приложении-функции на [портале функций Azure](https://functions.azure.com/signin) щелкните **Function app settings** (Параметры приложения-функции) > **Go to App Service settings** (Перейти к параметрам службы приложений).

	![Колонка параметров приложения-функции](./media/functions-bindings-mobile-apps/functions-app-service-settings.png)

2. В приложении-функции выберите **Все параметры**, прокрутите вниз до пункта **Параметры приложения**, а затем в разделе **Параметры приложения** введите новое **имя** для переменной среды, вставьте URL-адрес в поле **Значение**, при этом обязательно применив схему HTTPS, а затем нажмите кнопку **Сохранить** и закройте колонку приложения-функции, чтобы вернуться на портал функций.

	![Добавление переменной среды параметра приложения](./media/functions-bindings-mobile-apps/functions-app-add-app-setting.png)

Теперь можно установить эту новую переменную среды в качестве поля *подключения* в привязках.

## <a id="mobiletablesapikey"></a> Использование ключа API для защиты доступа к конечным точкам таблиц в мобильных приложениях Azure

В Функциях Azure привязка таблиц мобильных приложений позволяет указать ключ API — общий секрет, который можно использовать для предотвращения нежелательного доступа из приложений, отличных от функций. Служба мобильных приложений не включает встроенную поддержку аутентификации с помощью ключа API. Но его можно реализовать в мобильном приложении серверной части Node.js, используя примеры из статьи [Azure App Service Mobile Apps backend implementing an API key](https://github.com/Azure/azure-mobile-apps-node/tree/master/samples/api-key) (Серверная часть мобильных приложений службы приложений Azure, реализующая ключ API). Аналогичным образом можно реализовать ключ API в [мобильном приложении серверной части .NET](https://github.com/Azure/azure-mobile-apps-net-server/wiki/Implementing-Application-Key).

>[AZURE.IMPORTANT] Этот ключ API не следует предоставлять клиентам мобильных приложений. Его нужно безопасно предоставлять клиентам на стороне службы, например Функциям Azure.

## <a id="mobiletablesinput"></a> Входная привязка мобильных приложений Azure

Входные привязки могут загрузить запись из конечной точки таблицы мобильных приложений и передать ее непосредственно вашей привязке. Идентификатор записи определяется по триггеру, который вызвал функцию. В функции C# любые изменения, внесенные в запись, автоматически отправляются обратно в таблицу после успешного выхода из функции.

#### Файл function.json для входной привязки мобильных приложений

Файл *function.json* поддерживает следующие свойства.

- `name` — имя переменной, используемой в коде функции для новой записи.
- `type` — тип привязки, для которого необходимо задать значение *mobileTable*.
- `tableName` — таблица, в которой будет создана запись.
- `id` — идентификатор записи, которую необходимо получить. Это свойство поддерживает привязки, аналогичные `{queueTrigger}`, в которых в качестве идентификатора записи используется значение строки сообщения очереди.
- `apiKey` — строка параметра приложения, содержащая необязательный ключ API для мобильного приложения. Наличие этой строки обязательно, если мобильное приложение использует ключ API для ограничения клиентского доступа.
- `connection` — строка, являющаяся именем переменной среды в параметрах приложения, которая указывает URL-адрес серверной части мобильного приложения.
- `direction` — направление привязки. Для этого свойства следует задать значение *in*.

Пример файла *function.json*:

	{
	  "bindings": [
	    {
	      "name": "record",
	      "type": "mobileTable",
	      "tableName": "MyTable",
	      "id" : "{queueTrigger}",
	      "connection": "My_MobileApp_Url",
	      "apiKey": "My_MobileApp_Key",
	      "direction": "in"
	    }
	  ],
	  "disabled": false
	}

#### Пример кода мобильных приложений Azure для триггера очереди C#

Если использовать приведенный выше файл function.json, входная привязка извлечет из конечной точки таблицы в мобильных приложениях запись с идентификатором, который соответствует строке сообщения очереди, и передаст ее в параметр *record*. Если запись не найдена, параметр имеет значение null. При выходе из функции в запись сохраняется новое значение параметра *Text*.

	#r "Newtonsoft.Json"	
	using Newtonsoft.Json.Linq;
	
	public static void Run(string myQueueItem, JObject record)
	{
	    if (record != null)
	    {
	        record["Text"] = "This has changed.";
	    }    
	}

#### Пример кода мобильных приложений Azure для триггера очереди Node.js

Если использовать приведенный выше файл function.json, входная привязка извлечет из конечной точки таблицы в мобильных приложениях запись с идентификатором, который соответствует строке сообщения очереди, и передаст ее в параметр *record*. В функциях Node.js обновленные записи не отправляются обратно в таблицу. В этом примере кода полученная запись записывается в журнал.

	module.exports = function (context, input) {    
	    context.log(context.bindings.record);
	    context.done();
	};


## <a id="mobiletablesoutput"></a>Выходная привязка мобильных приложений Azure

Функция может сделать запись в конечную точку таблицы мобильных приложений, используя выходную привязку.

#### Файл function.json для выходной привязки мобильных приложений

Файл function.json поддерживает следующие свойства:

- `name` — имя переменной, используемой в коде функции для новой записи.
- `type` — тип привязки, для которого необходимо задать значение *mobileTable*.
- `tableName` — таблица, в которой создается запись.
- `apiKey` — строка параметра приложения, содержащая необязательный ключ API для мобильного приложения. Наличие этой строки обязательно, если мобильное приложение использует ключ API для ограничения клиентского доступа.
- `connection` — строка, являющаяся именем переменной среды в параметрах приложения, которая указывает URL-адрес серверной части мобильного приложения.
- `direction` — направление привязки. Для этого свойства необходимо задать значение *out*.

Пример файла function.json:

	{
	  "bindings": [
	    {
	      "name": "record",
	      "type": "mobileTable",
	      "tableName": "MyTable",
	      "connection": "My_MobileApp_Url",
	      "apiKey": "My_MobileApp_Key",
	      "direction": "out"
	    }
	  ],
	  "disabled": false
	}

#### Пример кода мобильных приложений Azure для триггера очереди C#

Этот пример кода C# вставляет новую запись со значением из свойства *Text* в таблицу мобильных приложений, указанную в приведенной выше привязке.

	public static void Run(string myQueueItem, out object record)
	{
	    record = new {
	        Text = $"I'm running in a C# function! {myQueueItem}"
	    };
	}

#### Пример кода мобильных приложений Azure для триггера очереди Node.js

В этом примере кода Node.js новая запись в конечной точке таблицы мобильных приложений со свойством *Text* вставляется в таблицу, указанную в приведенной выше привязке.

	module.exports = function (context, input) {
	
	    context.bindings.record = {
	        text : "I'm running in a Node function! Data: '" + input + "'"
	    }   
	
	    context.done();
	};

## Дальнейшие действия

[AZURE.INCLUDE [дальнейшие действия](../../includes/functions-bindings-next-steps.md)]

<!---HONumber=AcomDC_0824_2016-->