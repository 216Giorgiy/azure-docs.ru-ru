---
title: "Выбор плана размещения для решения \"Функции Azure\" | Документация Майкрософт"
description: "Дополнительные сведения о выборе между планом потребления для решения \"Функции Azure\" и планом службы приложений."
services: functions
documentationcenter: na
author: lindydonna
manager: cfowler
editor: 
tags: 
keywords: azure functions, functions, consumption plan, app service plan, event processing, webhooks, dynamic compute, serverless architecture
ms.assetid: 5b63649c-ec7f-4564-b168-e0a74cb7e0f3
ms.service: functions
ms.devlang: multiple
ms.topic: reference
ms.tgt_pltfrm: multiple
ms.workload: na
ms.date: 06/12/2017
ms.author: glenga
ms.custom: H1Hack27Feb2017
ms.translationtype: HT
ms.sourcegitcommit: 8f9234fe1f33625685b66e1d0e0024469f54f95c
ms.openlocfilehash: 41ebbe944213373c028b7410baa86e6c55db0d8c
ms.contentlocale: ru-ru
ms.lasthandoff: 09/20/2017

---
# <a name="azure-functions-hosting-plans-comparison"></a>Сравнение планов размещения для решения "Функции Azure"

## <a name="introduction"></a>Введение

Службу "Функции Azure" можно запускать в двух разных режимах: план потребления и план службы приложений Azure. План потребления автоматически выделяет вычислительные ресурсы в процессе выполнения кода, масштабируя их в соответствии с нагрузкой и уменьшая, когда код не выполняется. Таким образом, нет необходимости платить за бездействующие виртуальные машины и заранее резервировать ресурсы. Эта статья посвящена плану потребления. Дополнительную информацию о том, как действует план службы приложений, см. в статье [Подробный обзор планов службы приложений Azure](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md). 

Если вы не знакомы с Функциями Azure, см. [эту статью](functions-overview.md).

При создании приложения-функции необходимо настроить план размещения для функций приложения. В обоих режимах функции выполняет экземпляр *узла службы "Функции Azure"*. Тип плана определяет следующее:

* Способ развертывания экземпляров узла.
* Ресурсы, доступные для каждого узла.

Сейчас тип плана нужно выбирать во время создания приложения-функции. После этого вы не сможете его изменить. 

Вы можете масштабировать между уровнями в плане службы приложений. В плане потребления для Функций Azure автоматически обрабатывается все распределение ресурсов.

## <a name="consumption-plan"></a>План потребления

При использовании плана потребления экземпляры узла Azure Functions динамически добавляются и удаляются в зависимости от количества входящих событий. Этот план автоматически масштабируется, и вы платите за вычислительные ресурсы только тогда, когда ваши функции запущены. В плане потребления функция может выполняться не более 10 минут. 

> [!NOTE]
> Время ожидания по умолчанию для функций по плану потребления равно 5 минутам. Для приложения-функции значение можно увеличить до 10 минут, изменив свойство `functionTimeout` в файле [host.json](https://github.com/Azure/azure-webjobs-sdk-script/wiki/host.json).

Счет выставляется на основе времени выполнения и использованной памяти и вычисляется по всем функциям в приложении-функции. Дополнительные сведения см. на [странице цен на Функции Azure].

План потребления является планом по умолчанию. Он предлагает следующие преимущества:
- Оплата насчитывается только при выполнении функций.
- Масштабирование выполняется автоматически, даже во время периодов высокой нагрузки.

## <a name="app-service-plan"></a>План службы приложений

Если используется план службы приложений, приложения-функции, как и веб-приложения, выполняются на выделенных виртуальных машинах со следующими номерами SKU: "Базовый", "Стандартный", "Премиум" и "Изолированный". Виртуальные машины выделяются для приложений службы приложений. Это означает, что узел функций всегда работает.

План службы приложений стоит использовать в следующих случаях:
- У вас есть неиспользуемые виртуальные машины, в которых уже запущены другие экземпляры служб приложений.
- Предполагается, что функции-приложения будут выполняться непрерывно или почти непрерывно. В этом случае план службы приложений может быть более экономичным.
- Вам требуется больше ресурсов ЦП или памяти, чем доступно в плане потребления.
- Вам необходимо выполнять функции дольше максимального времени выполнения, разрешенного в плане потребления.
- Вам требуются функции, доступные только в плане службы приложений, например поддержка среды службы приложений, подключение к виртуальной сети или VPN и виртуальные машины больших размеров. 

При использовании виртуальной машины затраты не зависят от времени выполнения и размера памяти. В результате вы не будете платить больше, чем стоит выделенный экземпляр виртуальной машины. Дополнительную информацию о том, как действует план службы приложений, см. в статье [Подробный обзор планов службы приложений Azure](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md). 

С помощью плана службы приложений вы можете выполнить развертывание вручную, добавив дополнительные экземпляры виртуальных машин, или же включить автоматическое масштабирование. Дополнительные сведения см. в статье [Масштабирование числа экземпляров вручную или автоматически](../monitoring-and-diagnostics/insights-how-to-scale.md?toc=%2fazure%2fapp-service-web%2ftoc.json). Вы можете также увеличивать масштаб, используя разные планы службы приложений. Дополнительные сведения см. в статье [Увеличение масштаба приложения в Azure](../app-service/web-sites-scale.md). Если вы планируете запускать функции JavaScript в плане службы приложений, вам следует выбрать план с меньшим количеством ядер. Дополнительные сведения см. в разделе [обзора функций для JavaScript](functions-reference-node.md#choose-single-core-app-service-plans).  

<!-- Note: the portal links to this section via fwlink https://go.microsoft.com/fwlink/?linkid=830855 --> 
<a name="always-on"></a>
###Всегда включено

При использовании плана службы приложений следует включить параметр **Всегда включено**, чтобы ваше приложение-функция выполнялось правильно. В плане службы приложений среда выполнения функции перейдет в состояние бездействия через несколько минут отсутствия активности, поэтому только триггеры HTTP могут на самом деле "пробудить" ваши функции. Точно так же параметр "Всегда включено" должен быть включен для веб-заданий. 

Параметр "Всегда включено" доступен только для плана службы приложений. В плане потребления платформа активирует приложения-функции автоматически.

## <a name="storage-account-requirements"></a>Требования к учетной записи хранения

И для плана потребления, и для плана службы приложений для приложения-функции требуется учетная запись хранения Azure, которая поддерживает хранилища BLOB-объектов, очередей и таблиц Azure. Для внутренних операций, таких как управление триггерами и ведение журнала выполнения функций, Функции Azure используют службу хранилища Azure. Некоторые учетные записи хранения не поддерживают очереди и таблицы. Например, это относится к учетным записям хранения только для больших двоичных объектов (включая хранилище уровня "Премиум") и учетным записям хранения общего назначения с репликацией ZRS. Эти учетные записи будут отфильтрованы из колонки **Учетная запись хранения** при создании приложения-функции.

Дополнительные сведения о типах учетных записей хранилища см. в разделе [Введение в службы хранилища Azure](../storage/common/storage-introduction.md#introducing-the-azure-storage-services).

## <a name="how-the-consumption-plan-works"></a>Как работает план потребления

План потребления автоматически масштабирует ресурсы ЦП и памяти, добавляя дополнительные экземпляры узлов Функций в зависимости от количества событий, которые активируют функции. Каждый экземпляр узла Функций ограничен 1,5 ГБ памяти.

При использовании плана потребления файлы кода функции хранятся в файловых ресурсах Azure в основной учетной записи хранения. При удалении основной учетной записи хранения это содержимое удаляется без возможности восстановления.

> [!NOTE]
> При использовании триггера большого двоичного объекта в плане потребления обработка новых больших двоичных объектов может осуществляться с задержкой до 10 минут, если приложение-функция стало неактивным. После запуска приложения-функции большие двоичные объекты обрабатываются немедленно. Во избежание этой начальной задержки рассмотрите один из следующих вариантов:
> - Используйте план службы приложений с включенной функцией AlwaysOn.
> - Используйте другой механизм для активации обработки большого двоичного объекта, например сообщение очереди, содержащее имя большого двоичного объекта. Пример см. в разделе [Пример входной привязки](functions-bindings-storage-blob.md#input-sample).

### <a name="runtime-scaling"></a>Масштабирование среды выполнения

Решение "Функции Azure" использует компонент, называемый *контроллером масштабирования*, чтобы отслеживать скорость событий и определять, необходимо ли выполнять масштабирование. Контроллер масштабирования использует эвристику для каждого типа триггеров. Например, при использовании триггера хранилища очередей Azure масштабирование выполняется в зависимости от длины запроса и возраста самого старого сообщения в очереди.

Единицей масштаба является приложение-функция. При развертывании приложения-функции выделяются дополнительные ресурсы для выполнения нескольких экземпляров узла Функций Azure. И наоборот, когда потребность в вычислительных ресурсах уменьшается, контроллер масштабирования удаляет экземпляры узла функции. Если никакие функции не выполняются, то число экземпляров в приложении-функции в конечном итоге сократится до нуля.

![Мониторинг событий и создание экземпляров с помощью контроллера масштабирования](./media/functions-scale/central-listener.png)

### <a name="billing-model"></a>Модель выставления счетов

Выставление счетов для плана потребления подробно описано на [странице цен на Функции Azure]. Использование вычисляется на уровне приложения-функции. При этом учитывается только время выполнения кода функции. Счета выставляются по следующим единицам: 
* **Потребление ресурсов в гигабайтах в секунду (ГБ/с)**. Вычисляется как сочетание объема памяти и времени выполнения для всех функций, выполняемых в приложении-функции. 
* **Выполнения**. Вычисляются при каждом выполнении функции в ответ на событие, активированное привязкой.

[Страница с ценами на Функции Azure]: https://azure.microsoft.com/pricing/details/functions

