---
title: "Потребление Функций Azure и планы службы приложений | Документация Майкрософт"
description: "Узнайте, как Функции Azure масштабируются в соответствии с потребностями непостоянных рабочих нагрузок."
services: functions
documentationcenter: na
author: lindydonna
manager: erikre
editor: 
tags: 
keywords: "функции azure, функции, обработка событий, веб-перехватчики, динамические вычисления, независимая архитектура"
ms.assetid: 5b63649c-ec7f-4564-b168-e0a74cb7e0f3
ms.service: functions
ms.devlang: multiple
ms.topic: reference
ms.tgt_pltfrm: multiple
ms.workload: na
ms.date: 05/15/2017
ms.author: donnam, glenga
ms.custom: H1Hack27Feb2017
ms.translationtype: Human Translation
ms.sourcegitcommit: 95b8c100246815f72570d898b4a5555e6196a1a0
ms.openlocfilehash: 25df99203ccb194d75985fca42d3d05609dc7d7c
ms.contentlocale: ru-ru
ms.lasthandoff: 05/18/2017


---
# <a name="azure-functions-consumption-and-app-service-plans"></a>Потребление Функций Azure и планы службы приложений 

## <a name="introduction"></a>Введение

Функции Azure могут выполняться в двух различных режимах: план потребления и план службы приложений. План потребления автоматически выделяет вычислительные ресурсы в процессе выполнения кода, масштабируя их в соответствии с нагрузкой и уменьшая, когда код не выполняется. Таким образом, нет необходимости платить за бездействующие виртуальные машины и заранее резервировать ресурсы. Эта статья посвящена плану потребления. Дополнительную информацию о том, как действует план службы приложений, см. в статье [Подробный обзор планов службы приложений Azure](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md). 

Если вы еще не знакомы с Функциями Azure, см. статью [Обзор функций Azure](functions-overview.md).

При создании приложения-функции необходимо настроить план размещения для функций, содержащихся в приложении. Доступные планы размещения: **план потребления** и [**план службы приложений**](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md). В любом из режимов функции выполняются экземпляром *узла Функций Azure*. От типа плана зависит способ масштабирования экземпляров узла и объем ресурсов, доступных каждому узлу.

В настоящее время тип нужно выбрать во время создания приложения-функции. Его нельзя изменить позже. В [плане службы приложений](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md) можно выполнять масштабирование между уровнями. В плане потребления для Функций Azure автоматически обрабатывается все распределение ресурсов.

## <a name="consumption-plan"></a>План потребления

При использовании **плана потребления** экземпляры узла Функций Azure динамически добавляются и удаляются в зависимости от числа входящих событий. Этот план масштабируется автоматически, и плата взимается за вычислительные ресурсы только при выполнении функций. В рамках плана потребления функция может выполняться не более пяти минут. 

Счет выставляется на основе времени выполнения и использованной памяти и вычисляется по всем функциям в приложении-функции. Дополнительные сведения см. на [странице цен на Функции Azure].

План потребления является планом по умолчанию. Он предлагает следующие преимущества:
- вы платите, только если функции выполняются;
- масштабирование выполняется автоматически, даже во время периодов высокой нагрузки.

## <a name="app-service-plan"></a>План службы приложений

Если используется **план службы приложений**, то приложения-функции выполняются на выделенных виртуальных машинах уровня SKU "Базовый", "Стандартный" или "Премиум", подобно веб-приложениям. Виртуальные машины выделяются для приложений службы приложений. Это означает, что узел функций всегда работает.

План службы приложений стоит использовать в следующих случаях:
- У вас есть существующая, мало используемая виртуальная машина, которая уже выполняет другие экземпляры службы приложения.
- Предполагается, что функции-приложения будут выполняться непрерывно или почти непрерывно.
- Вам требуется больше ресурсов ЦП или памяти, чем доступно в плане потребления.
- Вам необходимо выполнять функции дольше максимального времени выполнения, разрешенного в плане потребления.

При использовании виртуальной машины затраты не зависят от времени выполнения и размера памяти. В результате вы не будете платить больше, чем стоит выделенный экземпляр виртуальной машины. Дополнительную информацию о том, как действует план службы приложений, см. в статье [Подробный обзор планов службы приложений Azure](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md). 

С помощью плана службы приложений вы можете выполнить развертывание вручную, добавив дополнительные экземпляры виртуальных машин, или же включить автоматическое масштабирование. Дополнительные сведения см. в статье [Масштабирование числа экземпляров вручную или автоматически](../monitoring-and-diagnostics/insights-how-to-scale.md?toc=%2fazure%2fapp-service-web%2ftoc.json). Вы можете также увеличивать масштаб, используя разные планы службы приложений. Дополнительные сведения см. в статье [Увеличение масштаба приложения в Azure](../app-service-web/web-sites-scale.md). Если вы планируете выполнить функции JavaScript в плане службы приложений, следует выбрать план с использованием меньшего числа ядер. Дополнительные сведения см. в разделе [обзора функций для JavaScript](functions-reference-node.md#choose-single-core-app-service-plans).  

<!-- Note: the portal links to this section via fwlink https://go.microsoft.com/fwlink/?linkid=830855 --> 
<a name="always-on"></a>
###Всегда включено

При использовании плана службы приложений следует включить параметр **Всегда включено**, чтобы ваше приложение-функция выполнялось правильно. В плане службы приложений среда выполнения функции перейдет в состояние бездействия через несколько минут отсутствия активности, поэтому только триггеры HTTP могут на самом деле "пробудить" ваши функции. Точно так же параметр "Всегда включено" должен быть включен для веб-заданий. 

Параметр "Всегда включено" доступен только для плана службы приложений. В плане потребления платформа активирует приложения-функции автоматически.

## <a name="storage-account-requirements"></a>Требования к учетной записи хранения

И для плана потребления, и для плана службы приложений для приложения-функции требуется учетная запись хранения Azure, которая поддерживает хранилища BLOB-объектов, очередей и таблиц. Для внутренних операций, таких как управление триггерами и ведение журнала выполнения функций, Функции Azure используют службу хранилища Azure. Некоторые учетные записи хранения не поддерживают очереди и таблицы. Например, это относится к учетным записям хранения только для больших двоичных объектов (включая хранилище уровня "Премиум") и учетным записям хранения общего назначения с репликацией ZRS. Эти учетные записи будут отфильтрованы из колонки "Учетная запись хранения" при создании приложения-функции.

Чтобы узнать больше о типах учетных записей хранения, ознакомьтесь с разделом [Введение в службы хранилища Azure] (../storage/storage-introduction.md#introducing-the-azure-storage-services).

## <a name="how-the-consumption-plan-works"></a>Как работает план потребления

План потребления автоматически масштабирует ресурсы ЦП и памяти, добавляя дополнительные экземпляры узлов Функций в зависимости от количества событий, которые активируют функции. Каждый экземпляр узла Функций ограничен 1,5 ГБ памяти.

При использовании плана потребления файлы кода функции хранятся в файловых ресурсах Azure в основной учетной записи хранения. При удалении основной учетной записи хранения это содержимое удаляется без возможности восстановления.

> [!NOTE]
> При использовании триггера большого двоичного объекта в плане потребления обработка новых больших двоичных объектов может осуществляться с задержкой до 10 минут, если приложение-функция стало неактивным. После запуска приложения-функции большие двоичные объекты обрабатываются немедленно. Во избежание этой начальной задержки рассмотрите один из следующих вариантов:
> - Используйте план службы приложений с включенным параметром "Всегда включено".
> - Используйте другой механизм для активации обработки большого двоичного объекта, например сообщение очереди, содержащее имя большого двоичного объекта. Пример см. в разделе "Пример входной привязки" статьи [Привязки хранилища BLOB-объектов для Функций Azure](functions-bindings-storage-blob.md#input-sample).

### <a name="runtime-scaling"></a>Масштабирование среды выполнения

Функции Azure используют компонент, называемый *контроллером масштабирования*, чтобы отслеживать скорость событий и определять, необходимо ли выполнять масштабирование. Контроллер масштабирования использует эвристику для каждого типа триггеров. Например, при использовании триггера хранилища очередей Azure масштабирование выполняется в зависимости от длины запроса и возраста самого старого сообщения в очереди.

Единицей масштаба является приложение-функция. При увеличении масштаба выделяются дополнительные ресурсы для выполнения нескольких экземпляров узла Функций Azure. И наоборот, когда потребность в вычислительных ресурсах уменьшается, экземпляры узлов функции удаляются. Если никакие функции не выполняются, то число экземпляров в приложении-функции в конечном итоге сократится до нуля.

![](./media/functions-scale/central-listener.png)

### <a name="billing-model"></a>Модель выставления счетов

Выставление счетов для плана потребления подробно описано на [странице цен на Функции Azure]. Использование вычисляется на уровне приложения-функции, и учитывается только время выполнения кода функции. Счета выставляются по следующим единицам: 
* **Потребление ресурсов в ГБ/с (гигабайт в секунду)**. Вычисляется как сочетание объема памяти и времени выполнения для всех функций, выполняемых в приложении-функции. 
* **Выполнения**. Вычисляются при каждом выполнении функции в ответ на событие, активированное привязкой.

[странице цен на Функции Azure]: https://azure.microsoft.com/pricing/details/functions
