---
title: "Рекомендации по Функциям Azure | Документация Майкрософт"
description: "Ознакомьтесь с рекомендациями и шаблонами для Функций Azure."
services: functions
documentationcenter: na
author: wesmc7777
manager: cfowler
editor: 
tags: 
keywords: "Функции Azure, шаблоны, рекомендация, функции, обработка событий, объекты webhook, динамические вычисления, бессерверная архитектура"
ms.assetid: 9058fb2f-8a93-4036-a921-97a0772f503c
ms.service: functions
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: multiple
ms.workload: na
ms.date: 06/13/2017
ms.author: glenga
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 1e0d4a29f59e48cac675e567fd84384b1b60d35f
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="optimize-the-performance-and-reliability-of-azure-functions"></a>Оптимизация производительности и надежности Функций Azure

В этой статье описано, как повысить производительность и надежность приложений-функций. 


## <a name="avoid-long-running-functions"></a>Избегайте длительных функций

Крупные длительные функции могут вызывать непредвиденные проблемы времени ожидания. Функция может стать крупной, если она содержит множество зависимостей Node.js. Импорт зависимостей может также привести к замедлению загрузки, что, в свою очередь, приводит к непредвиденным проблемам времени ожидания. Зависимости можно загрузить явно и неявно. Один модуль, загруженный в коде, может загрузить собственные дополнительные модули.  

По возможности выполняйте рефакторинг крупных функций и перерабатывайте их на более мелкие совместимые наборы функций, которые работают сообща и быстро возвращают ответ. Например, для функции веб-перехватчика или триггера HTTP может потребоваться подтверждение в течение ограниченного промежутка времени. Чаще всего для веб-перехватчиков требуется немедленный ответ. Полезные данные триггера HTTP можно передать в очередь для обработки с помощью функции триггера очереди. Такой подход позволяет отложить фактическую работу и сразу возвратить ответ.


## <a name="cross-function-communication"></a>Взаимодействие функций

При интеграции нескольких функций лучше всего для взаимодействия между ними использовать очереди хранилища,  так как они дешевле и их гораздо проще подготовить к работе. 

Размер отдельных сообщений в очереди хранилища ограничен до 64 КБ. Если между функциями нужно передать сообщения большего размера, можно использовать очередь служебной шины Azure, которая поддерживает сообщения размером до 256 КБ.

Если перед обработкой сообщений их нужно отфильтровать, ознакомьтесь со статьями о служебной шине.

Для поддержки обмена крупными сообщениями используются концентраторы событий.


## <a name="write-functions-to-be-stateless"></a>Создавайте функции без отслеживания состояния 

По возможности функции должны быть без отслеживания состояния и идемпотентными. Свяжите любые необходимые сведения о состоянии со своими данными. Например, с обрабатываемым заказом скорее всего будет связан элемент `state`. Функция может обработать заказ, основываясь на этом состоянии, но в ней самой при этом не отслеживается состояние. 

Идемпотентные функции рекомендуется использовать с триггерами таймера. Например, если какой-либо компонент нужно выполнять раз в день, пропишите его таким образом, чтобы он выполнялся в любое время в течение дня с тем же результатом. Функцию можно закрыть, если в определенный день ничего не нужно делать. Кроме того, если предыдущее выполнение завершилось ошибкой, следующее выполнение должно начаться с прерванного момента.


## <a name="write-defensive-functions"></a>Создавайте защищенные функции

Предположим, что в любое время в функции может возникнуть исключение. Реализуйте в функции возможность продолжения с предыдущей точки сбоя во время следующего выполнения. Давайте рассмотрим сценарий, в котором необходимо сделать следующее:

1. Запросить 10 000 строк в базе данных.
2. Создать сообщение очереди для каждой из этих строк для дальнейшей обработки.
 
В зависимости от сложности системы, подчиненные службы могут работать неправильно, могут происходить сбои в работе сети или нарушения лимитов квоты и т. д. Все это может в любое время повлиять на функцию. Функции необходимо подготавливать к таким проблемам.

Как отреагирует ваш код при сбое после вставки 5000 элементов в очередь для обработки? Отслеживайте элементы в наборе, работа с которым завершена. В противном случае их можно вставить позже. Это может серьезно повлиять на рабочий процесс. 

Если элемент очереди уже обработан, разрешите холостой цикл выполнения функции.

Воспользуйтесь предоставленными возможностями защиты для компонентов, используемых на платформе Функций Azure. Например, ознакомьтесь с разделом **Обработка подозрительных сообщений очереди** в документации по [триггерам очереди службы хранилища Azure](functions-bindings-storage-queue.md#trigger).
 

## <a name="dont-mix-test-and-production-code-in-the-same-function-app"></a>Не используйте тестовый и рабочий код в одном приложении-функции

Функции в приложении-функции совместно используют ресурсы. Например, память. Если приложение-функция используется в рабочей среде, не добавляйте в нее тестовые функции и ресурсы. Это может вызвать непредвиденные затраты во время выполнения кода в рабочей среде.

Следите за тем, что вы загружаете в рабочие приложения-функции. Память усредняется для каждой функции в приложении.

При наличии общей сборки, указанной в нескольких функциях .Net, поместите ее в общую папку. Создайте ссылку на сборку с помощью оператора, аналогичного следующему: 

    #r "..\Shared\MyAssembly.dll". 

В противном случае очень просто случайно развернуть несколько тестовых версий одного двоичного файла, которые действуют по-разному в разных функциях.

Не используйте подробное ведение журнала в рабочем коде. Это отрицательно сказывается на производительности.



## <a name="use-async-code-but-avoid-blocking-calls"></a>Использование асинхронного кода без блокирующих вызовов

Рекомендуется применять метод асинхронного программирования. Но никогда не используйте ссылки на свойство `Result` и не вызывайте метод `Wait` для экземпляра `Task`. Применение этого подхода может привести к нехватке потоков.


[!INCLUDE [HTTP client best practices](../../includes/functions-http-client-best-practices.md)]

## <a name="next-steps"></a>Дальнейшие действия
Для получения дополнительных сведений см. следующие ресурсы:

Так как Функции Azure используют службу приложений Azure, необходимо также ознакомиться с рекомендациями для нее.
* [Шаблоны и методики оптимизации производительности HTTP](https://docs.microsoft.com/azure/architecture/antipatterns/improper-instantiation/)

