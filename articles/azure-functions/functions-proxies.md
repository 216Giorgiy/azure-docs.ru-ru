---
title: "Работа с прокси в Функциях Azure | Документация Майкрософт"
description: "Общие сведения об использовании прокси Функций Azure"
services: functions
documentationcenter: 
author: mattchenderson
manager: erikre
editor: 
ms.assetid: 
ms.service: functions
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 02/19/2017
ms.author: mahender
translationtype: Human Translation
ms.sourcegitcommit: facdd2abbb90a85535b8936ea655a824134c4c8b
ms.openlocfilehash: 3e8b8f9908cf24baf7a5d70521c79dbd470001f8
ms.lasthandoff: 02/22/2017


---
# <a name="working-with-azure-functions-proxies-preview"></a>Работа с прокси Функций Azure (предварительная версия)

> [!Note] 
> Сейчас доступна предварительная версия прокси Функций Azure. Предварительная версия предоставляется бесплатно, но на выполнение прокси распространяется стандартная тарификация Функций. Дополнительные сведения см. на странице [цен на Функции Azure](https://azure.microsoft.com/pricing/details/functions/).

В этой статье описано, как настроить прокси Функций Azure и работать с ними. Эта функция позволяет указать конечные точки в приложении-функции, реализуемые другим ресурсом. Эти прокси можно использовать для разбиения большого API-интерфейса на несколько приложений-функций (как в архитектуре микрослужб), сохраняя при этом единую область API для клиентов.

[!INCLUDE [intro](../../includes/functions-bindings-intro.md)]


## <a name="a-nameenableaenabling-azure-functions-proxies"></a><a name="enable"></a>Включение прокси Функций Azure

По умолчанию прокси не включены. Вы можете создавать прокси, когда функция отключена, но они не будут выполняться. Ниже показано, как включить прокси.

1. Откройте [портал Azure] и перейдите к своему приложению-функции.
2. Выберите **Параметры приложения-функции**.
3. Включите параметр **Использовать прокси-серверы для API-интерфейсов**.

Вы можете также возвращаться сюда для обновления среды выполнения прокси по мере появления новых функций.


## <a name="creating-a-proxy"></a>Создание прокси

В этом разделе показано, как создать прокси на портале Функций.

1. Откройте [портал Azure] и перейдите к своему приложению-функции.
2. На панели навигации слева выберите **Создать прокси-сервер для API-интерфейсов**.
3. Задайте имя прокси.
4. Настройте конечную точку в этом приложении-функции, указав **шаблон маршрута** и **методы HTTP**. Поведение этих параметров соответствует правилам для [триггеров HTTP]
5. Задайте **URL-адрес внутреннего сервера** для другой конечной точки. Ею может быть функция в другом приложении-функции или другой API.
6. Щелкните Создать.

Прокси теперь существует в виде новой конечной точки в приложении-функции. С точки зрения клиента это аналогично HttpTrigger в Функциях Azure. Можно испытать новый прокси, скопировав URL-адрес прокси и протестировав его с помощью избранного клиента HTTP.


## <a name="a-namemodify-requestsamodifying-backend-requests"></a><a name="modify-requests"></a>Изменение запросов внутреннего сервера

Параметр URL-адреса внутреннего сервера не обязательно должен быть статическим. Его состояние может быть задано во входных данных запроса или в параметрах приложения.


### <a name="using-request-parameters"></a>Работа с параметрами запроса

Параметры, используемые в шаблоне маршрута, могут использоваться в качестве входных данных для свойства URL-адреса внутреннего сервера. Значения указываются по именам, которые заключаются в фигурные скобки — {}.

Например, если прокси использует шаблон маршрута, подобный `/pets/{petId}`, URL-адрес внутреннего сервера может содержать значение `{petId}`, как в `https://<AnotherApp>.azurewebsites.net/api/pets/{petId}`. Если шаблон маршрута заканчивается подстановочным знаком, например `/api/{*restOfPath}`, значение `{restOfPath}` будет строковым представлением остальных сегментов пути входящего запроса.


### <a name="using-application-settings"></a>Работа с параметрами приложения

Можно также ссылаться на [параметры приложения](https://docs.microsoft.com/azure/azure-functions/functions-how-to-use-azure-function-app-settings#develop), заключив имя параметра в знаки процента — %.

Например, в URL-адресе внутреннего сервера `https://%ORDER_PROCESSING_HOST%/api/orders` %ORDER_PROCESSING_HOST% будет заменено значением параметра ORDER_PROCESSING_HOST.

> [!TIP] 
> Используйте параметры приложения для внутренних узлов при наличии нескольких развертываний или тестовых сред. Таким образом, вы будете всегда обращаться к правильному внутреннему серверу в этой среде.



## <a name="deployment-methods"></a>Методы развертывания

Настроенные прокси хранятся в файле proxies.json, расположенном в корневом каталоге приложения-функции. Можно вручную изменить этот файл и развернуть его как часть приложения, используя любой из [методов развертывания](https://docs.microsoft.com/azure/azure-functions/functions-continuous-deployment), поддерживаемых Функциями.

Для обработки файла функция должна быть включена. Это можно сделать, следуя инструкциям в разделе [Включение прокси Функций Azure](#enable).

Файл proxies.json определяется объектом прокси, который состоит из именованных прокси и их определений. Например, файл может выглядеть следующим образом:

```json
{
    "proxies": {
        "proxy1": {
            "matchCondition": {
                "methods": [ "GET" ],
                "route": "/api/{test}"
            },
            "backendUri": "https://<AnotherApp>.azurewebsites.net/api/<FunctionName>"
        }
    }
}
```

Каждый прокси имеет понятное имя, как, например proxy1 в приведенном выше примере. Соответствующий объект определения прокси определяется следующими свойствами:

* **matchCondition** (обязательное) — объект, который определяет запросы, активирующие выполнение этого прокси. Он содержит два свойства, используемые совместно с [триггеров HTTP]:
    * _methods_ — массив методов HTTP, на которые будет отвечать прокси. Если свойство не указано, прокси будет отвечать на все методы HTTP в маршруте.
    * _route_ (обязательное) — шаблон маршрута, определяющий URL-адреса запросов, на которые будет отвечать прокси. В отличие от триггеров HTTP значение по умолчанию отсутствует.
* **backendUri** — URL-адрес внутреннего ресурса, к которому должен быть отправлен запрос. Это значение может быть создано по шаблону, как описано в разделе [Изменение запросов внутреннего сервера](#modify-requests). Если это свойство не включено, Функции Azure вернут ответ "HTTP 200 OK".

> [!Note] 
> Свойство route прокси Функций Azure не учитывает свойство routePrefix конфигурации узла Функций. Если вы хотите включить префикс, например /api, он должен быть включен в свойство route.



[портал Azure]: https://portal.azure.com
[триггеров HTTP]: https://docs.microsoft.com/azure/azure-functions/functions-bindings-http-webhook#http-trigger
