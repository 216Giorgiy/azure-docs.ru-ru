<properties title="Azure Machine Learning Sample: Flight delay prediction" pageTitle="Пример машинного обучения: прогнозирование задержек рейсов | Azure" description="A sample Azure Machine Learning experiment to develop a model that predicts whether a scheduled passenger flight will be delayed by more than 15 minutes." metaKeywords="" services="machine-learning" solutions="" documentationCenter="" authors="garye" manager="paulettm" editor="cgronlun"  videoId="" scriptId="" />

<tags ms.service="machine-learning" ms.workload="data-services" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="10/23/2014" ms.author="garye" />


# Пример машинного обучения Azure: прогнозирование задержек рейсов

>[AZURE.NOTE]
>[Пример эксперимента] и [образцы наборов данных], связанные с этой моделью, доступны в ML Studio. См. дополнительные сведения ниже.
[Пример эксперимента]: #sample-experiment
[Образцы наборов данных]: #sample-datasets


## Описание проблемы  ##

Прогнозирование задержки прибытия пассажирского рейса более чем на 15 минут с помощью хронологических данных о соблюдении графиков рейсов и погодных данных. 

## Данные ##

**Данные о соблюдении графиков пассажирских рейсов из массива данных TranStats Министерства транспорта США:**  [http://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236&DB_Short_Name=On-Time](http://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236&DB_Short_Name=On-Time)  

Набор данных охватывает период с апреля по октябрь 2013 г. Перед загрузкой в Azure ML Studio:  

- Набор данных был отфильтрован, чтобы охватывать 70 самых загруженных аэропортов в континентальной части США.  
- Были выбраны следующие столбцы: Year, Month, DayofMonth, DayOfWeek, Carrier, OriginAirportID, DestAirportID, CRSDepTime, DepDelay, DepDel15, CRSArrTime, ArrDelay, ArrDel15, Cancelled.  
- Отмененные рейсы были отмечены как задержанные более чем на 15 минут.  
- Рейсы с отклонением были удалены.  

**Результаты ежечасных наземных наблюдений погоды из NOAA:** http://cdo.ncdc.noaa.gov/qclcd_ascii/  

Погодные данные охватывают результаты наблюдений с метеорологических станций, связанных с каждым аэропортом, в период с апреля по октябрь 2013 г. Перед загрузкой в ML Studio: 

- Идентификаторы метеорологических станций были сопоставлены с соответствующими идентификаторами аэропортов. 
- Метеорологические станции, не связанные с 70 самыми загруженными аэропортами, были удалены.  
- Столбец "Дата" был разделен на отдельные столбцы: "Год", "Месяц" и "День".  
- Были выбраны следующие столбцы: AirportID, Year, Month, Day, Time, TimeZone, SkyCondition, Visibility, WeatherType, DryBulbFarenheit, DryBulbCelsius,  WetBulbFarenheit, WetBulbCelsius,  DewPointFarenheit, DewPointCelsius, RelativeHumidity, WindSpeed,  WindDirection, ValueForWindCharacter, StationPressure,  PressureTendency, PressureChange, SeaLevelPressure,  RecordType, HourlyPrecip, Altimeter.  

## Модель ##

**Предварительная обработка полетных данных**  

Прежде всего столбцы, являющиеся возможными целевыми источниками утечки данных (DepDelay, DepDel15, ArrDelay, Cancelled), были исключены из набора данных.  

Столбцы DayOfWeek, OriginAirportID и DestAirportID представляют категориальные атрибуты. Однако, поскольку они являются целочисленными, данные столбцы первоначально анализируются как непрерывные числовые и должны быть преобразованы в категориальные с помощью редактора метаданных.  

Наша цель - соединение записей о рейсах с почасовыми погодными записями с помощью запланированного времени вылета в качестве одного из ключей объединения. Для этого столбец CSRDepTime округляется в меньшую сторону до ближайшего наименьшего часа.  

**Предварительная обработка погодных данных**  

Прежде всего исключаются столбцы, имеющие значительную долю отсутствующих значений. К ним относятся:  

- Все столбцы со строковыми значениями  
- ValueForWindCharacter, WetBulbFarenheit, WetBulbCelsius, PressureTendency, PressureChange, SeaLevelPressure, StationPressure  

Затем к оставшимся столбцам применяется модуль очистки отсутствующих значений.  

Время наблюдения за погодой округляется до ближайшего последующего полного часа, чтобы его можно было эквивалентно соединить с запланированным временем вылета. Следует отметить, что запланированное время рейса и время погодного наблюдения округляются в обратных направлениях. Это необходимо сделать, чтобы убедиться, что модель использует только те погодные наблюдения, которые выполнялись до рейса.  

**Соединение наборов данных**

Записи рейсов соединяются с погодными данными в месте отправления рейса и в месте назначения.  

Обратите внимание, что погодные данные сообщаются по местному времени, но места отправления и назначения могут находиться в разных часовых поясах. Следовательно, для корректировки разницы в часовых поясах выполняется вычитание столбцов часового пояса из запланированного времени вылета и времени наблюдения за погодой.  

**Подготовка выборок для обучения и проверки достоверности**  

Выборки для обучения и проверки достоверности создаются путем разделения данных на записи за период с апреля по сентябрь для обучения и записи за октябрь для проверки достоверности. Затем столбцы "Год" и "Месяц" удаляются из набора данных. 

Кроме того, данные обучения квантуются равновысотным биннингом (к данным проверки достоверности применяется тот же биннинг).  

**Обучение и проверка достоверности модели** 

Модель двухклассового увеличивающегося дерева решений обучается на примере обучения. Модель оптимизируется для наилучшего значения AUC с помощью произвольного перебора параметров с 10-кратной сверткой. Для сравнения модель двухклассовой логистической регрессии оптимизируется аналогичным образом.  

Обученные модели затем сравниваются с набором для проверки достоверности, и для анализа качества моделей по сравнению друг с другом используется модуль анализа модели. 

**Постобработка** 

Идентификаторы аэропортов соединяются с удобочитаемыми названиями и местоположениями аэропортов, что позволяет упростить анализ результатов. 

## Результаты ##

Модель увеличивающегося дерева решений имеет AUC = 0,697 для набора для проверки достоверности, что немного лучше, чем модель логистической регрессии с AUC = 0,675. 



## Пример эксперимента

Следующий пример эксперимента, связанный с этой моделью, доступен в ML Studio в разделе **ЭКСПЕРИМЕНТЫ** на вкладке **ПРИМЕРЫ**.

> **Пример эксперимента - Прогнозирование задержек рейсов - Разработка**

## Образцы наборов данных

Следующие образцы наборов данных, используемые для этого эксперимента, доступны в ML Studio в палитре модулей в разделе **Сохраненные наборы данных**.

###Набор данных кодов аэропортов
[AZURE.INCLUDE [machine-learning-sample-dataset-airport-codes](../includes/machine-learning-sample-dataset-airport-codes.md)]

###Данные о задержках рейсов
[AZURE.INCLUDE [machine-learning-sample-dataset-flight-delays-data](../includes/machine-learning-sample-dataset-flight-delays-data.md)]

###Набор погодных данных
[AZURE.INCLUDE [machine-learning-sample-dataset-weather-dataset](../includes/machine-learning-sample-dataset-weather-dataset.md)]

