<properties title="Azure Machine Learning Sample: Flight delay prediction" pageTitle="Machine Learning Sample: Flight delay prediction | Azure" description="A sample Azure Machine Learning experiment to develop a model that predicts whether a scheduled passenger flight will be delayed by more than 15 minutes." metaKeywords="" services="" solutions="" documentationCenter="" authors="garye" videoId="" scriptId="" />

<tags ms.service="machine-learning" ms.workload="tbd" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="garye" />

# Пример машинного обучения Azure: Прогнозирование задержек рейсов

*Пример эксперимента, связанный с этой моделью в ML Studio, можно найти в разделе **ЭКСПЕРИМЕНТЫ** на вкладке **ПРИМЕРЫ**. Имя эксперимента:*

    Sample Experiment - Flight Delay Prediction - Development

## Описание проблемы

Прогнозирование задержки прибытия пассажирского рейса более, чем на 15 минут, с помощью хронологических данных о соблюдении графиков рейсов и погодных данных.

## Данные

**Данные о соблюдении графиков пассажирских рейсов из массива данных TranStats из Министерства транспорта США:** [][]<http://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236&DB_Short_Name=On-Time></a>

Набор данных охватывает период с апреля по октябрь 2013 г. Перед загрузкой в Azure ML Studio:

-   Набор данных был отфильтрован, чтобы охватывать 70 самых загруженных аэропортов в континентальной части США.
-   Были выбраны следующие столбцы: 'Year', 'Month', 'DayofMonth', 'DayOfWeek','Carrier', 'OriginAirportID','DestAirportID','CRSDepTime','DepDelay','DepDel15', 'CRSArrTime','ArrDelay','ArrDel15','Cancelled'
-   Отмененные рейсы были отмечены как задержанные более, чем на 15 минут.
-   Рейсы с отклонением были удалены.

**Результаты ежечасных наземных наблюдений погоды из NOAA:** <http://cdo.ncdc.noaa.gov/qclcd_ascii/>

Погодные данные охватывают результаты наблюдений из метеорологических станций, связанных с каждым аэропортов, апрель-октябрь 2013 г. Перед загрузкой в ML Studio:

-   Идентификаторы метеорологических станций были сопоставлены с соответствующими идентификаторами аэропортов.
-   Метеорологические станции, не связанные с 70 самыми загруженными аэропортами, были удалены
-   Столбец «Дата» был разделен на отдельные столбцы "Год", "Месяц" и "День"
-   Были выбраны следующие столбцы: 'AirportID', 'Year','Month','Day', 'Time', 'TimeZone', 'SkyCondition', 'Visibility','WeatherType','DryBulbFarenheit', 'DryBulbCelsius', 'WetBulbFarenheit', 'WetBulbCelsius', 'DewPointFarenheit','DewPointCelsius', 'RelativeHumidity', 'WindSpeed', 'WindDirection', 'ValueForWindCharacter','StationPressure', 'PressureTendency', 'PressureChange', 'SeaLevelPressure', 'RecordType', 'HourlyPrecip', 'Altimeter'

## Модель

**Предварительная обработка полетных данных**

Во первых, столбцы, которые являются возможными целевыми источниками утечки данных ( DepDelay, DepDel15, ArrDelay, Cancelled) были исключены из набора данных.

Столбцы 'DayOfWeek', 'OriginAirportID' и 'DestAirportID' представляют категориальные атрибуты. Однако, так как они являются целочисленными, данные столбцы первоначально анализируются как непрерывно численные и должны быть преобразованы в категориальные с помощью редактора метаданных.

Наша цель — соединение записей о рейсах с ежечасными погодными записями с помощью запланированного времени вылета в качестве одного из ключей объединения. Для этого столбец «CSRDepTime» округляется в меньшую сторону до ближайшего наименьшего часа.

**Предварительная обработка погодных данных**

Во первых, столбцы, которые имеют значительную долю отсутствующих значений, исключены. К ним относятся:

-   Все столбцы со строковыми значениями
-   ValueForWindCharacter,WetBulbFarenheit,WetBulbCelsius,PressureTendency,PressureChange,SeaLevelPressure,StationPressure

Затем, к оставшимся столбцам применяется модуль очистки отсутствующих значений.

Время наблюдения за погодой округляется до ближайшего последующего полного часа, чтобы его можно было эквивалентно соединить с запланированным временем вылета. Следует отметить, что запланированное время рейса и время погодного наблюдения округляются в обратных направлениях. Это необходимо сделать, чтобы убедиться, что модель использует только те погодные наблюдения, которые выполнялись до рейса.

**Соединение наборов данных**

Записи рейсов соединяются с погодными данными в месте отправления рейса и в месте назначения.

Следует отметить, что погодные данные сообщаются по местному времени, но места отправления и назначения могут находиться в разных часовых поясах. Следовательно, для корректировки разницы в часовых поясах выполняется вычитание столбцов часового пояса из запланированного времени вылета и времени наблюдения за погодой.

**Подготовка выборок для обучения и проверки достоверности**

Выборки для обучения и проверки достоверности создаются путем разделения данных на записи в период с апреля по сентябрь для обучения, а также записи в октябре для проверки достоверности. Затем столбцы "Год" и "Месяц" удаляются из набора данных.

Кроме того, данные об обучении квантуются равно-высотным биннингом (к данным для проверки достоверности применяется тот же биннинг).

**Обучение и проверка достоверности модели**

Увеличивающаяся модель дерева решений с двумя классами обучается для примера обучения. Модель оптимизируется для наилучшего значения AUC с помощью произвольного перебора параметров с 10-кратной сверткой. Для сравнения логистическая регрессивная модель с двумя классами оптимизируется аналогичным образом.

Обученные модели затем сравниваются с набором для проверки достоверности, и для анализа качества моделей по сравнению друг с другом используется модуль анализа модели.

**Постобработка**

Идентификаторы аэропортов соединяются с удобочитаемыми названиями и местоположениями аэропортов, что позволяет упростить анализ результатов.

## Результат

Увеличивающаяся модель дерева решений имеет AUC=0,697 для набора для проверки достоверности, что немного лучше, чем логистическая регрессивная модель с AUC=0,675.

  []: http://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236&DB_Short_Name=On-Time
