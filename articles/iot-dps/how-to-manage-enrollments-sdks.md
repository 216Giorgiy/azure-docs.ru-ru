---
title: "Управление регистрациями устройств с помощью пакетов SDK службы подготовки устройств Azure | Документация Майкрософт"
description: "Как управлять регистрацией устройств в службе подготовки устройств для Центра Интернета вещей с помощью пакетов SDK для служб."
services: iot-dps
keywords: 
author: yzhong94
ms.author: yizhon
ms.date: 12/01/2017
ms.topic: article
ms.service: iot-dps
documentationcenter: 
manager: arjmands
ms.devlang: na
ms.custom: mvc
ms.openlocfilehash: a3d763009c7a7f45ddce96732977a79567f7ef44
ms.sourcegitcommit: 48fce90a4ec357d2fb89183141610789003993d2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2018
---
# <a name="how-to-manage-device-enrollments-with-azure-device-provisioning-service-sdks"></a>Как управлять регистрациями устройств с помощью пакетов SDK службы подготовки устройств Azure
При *регистрации устройства* создается запись одного устройства или группы устройств, которые можно в будущем зарегистрировать с помощью службы подготовки устройств. Запись регистрации содержит необходимую начальную конфигурацию устройств как часть регистрации, включая нужный Центр Интернета вещей. В этой статье показано, как управлять регистрацией устройств для подготовки службы программным способом с помощью пакетов SDK службы подготовки Интернета вещей Azure.  Пакеты SDK доступны в GitHub в том же хранилище, что и пакет SDK Интернета вещей Azure.

## <a name="samples"></a>Примеры
В этой статье рассматриваются основные понятия верхнего уровня управления регистрацией устройств программным способом для службы подготовки с помощью пакетов SDK службы подготовки Интернета вещей Azure.  Точные вызовы API могут отличаться из-за различия языков.  Ознакомьтесь с примерами, которые мы представили на GitHub, чтобы получить подробные сведения:
* [Samples for the Azure Provisioning Clients SDK for Java](https://github.com/Azure/azure-iot-sdk-java/tree/master/provisioning/provisioning-samples) (Примеры для пакета SDK клиента службы подготовки Azure для Java).
* [Samples for the Azure IoT Device Provisioning Service SDK for Node.js](https://github.com/Azure/azure-iot-sdk-node/tree/master/provisioning/service/samples) (Примеры для пакета SDK службы подготовки Интернета вещей Azure для Node.js).

## <a name="prerequisites"></a>Необходимые компоненты
* Строка подключения экземпляра службы подготовки устройств
* Артефакты безопасности устройств:
    * [**TPM**](https://docs.microsoft.com/azure/iot-dps/concepts-security):
        * Отдельная регистрация. Идентификатор регистрации и ключ подтверждения доверенного платформенного модуля (TPM) физического устройства или симулятора TPM.
        * Группа регистрации не применяется к аттестации TPM.
    * [**X.509**](https://docs.microsoft.com/azure/iot-dps/concepts-security):
        * Отдельная регистрация. [Конечный сертификат](https://docs.microsoft.com/azure/iot-dps/concepts-security#leaf-certificate) с физического устройства или эмулятора DICE.
        * Группа регистрации. [Корневой сертификат](https://docs.microsoft.com/azure/iot-dps/concepts-security#root-certificate) или [промежуточный сертификат](https://docs.microsoft.com/azure/iot-dps/concepts-security#intermediate-certificate), используемый для создания сертификата устройства на физическом устройстве.  Он также может быть создан с помощью эмулятора DICE.

## <a name="create-a-device-enrollment"></a>Создание регистрации устройств

Зарегистрировать устройства с помощью службы подготовки можно двумя способами.

* **Группа регистраций** — это запись для группы устройств, которые используют общий механизм аттестации сертификатов X.509, подписанный [корневым сертификатом](https://docs.microsoft.com/azure/iot-dps/concepts-security#root-certificate) или [промежуточным сертификатом](https://docs.microsoft.com/azure/iot-dps/concepts-security#intermediate-certificate). Мы советуем использовать группу регистраций для большого количества устройств, имеющих необходимую начальную конфигурацию, или для устройств, предназначенных для одного и того же клиента. Обратите внимание, что как *группы регистраций* можно регистрировать только устройства, использующие механизм аттестации X.509. 

    Следуя этому рабочему процессу, можно создать группу регистрации с пакетами SDK:

    1. В группе регистрации механизм аттестации использует корневой сертификат X.509.  Вызовите API пакета SDK службы ```X509Attestation.createFromRootCertificate``` с корневым сертификатом, чтобы создать аттестацию регистрации.  Корневой сертификат X.509 предоставляется как PEM-файл или в виде строки.
    1. Создайте переменную ```EnrollmentGroup``` с помощью созданного свойства ```attestation``` и уникального свойства ```enrollmentGroupId```.  При необходимости можно задать такие параметры, как ```Device ID```, ```IoTHubHostName```, ```ProvisioningStatus```.
    2. Вызовите API пакета SDK службы ```createOrUpdateEnrollmentGroup``` в своем серверном приложении с помощью ```EnrollmentGroup```, чтобы создать группу регистрации.

* **Отдельная регистрация** — это запись одного устройства, которое можно зарегистрировать. В качестве механизмов аттестации отдельные регистрации могут использовать сертификаты X.509 или токены SAS (в реальном или виртуальном доверенном платформенном модуле). Мы советуем использовать отдельные регистрации для устройств, которым требуются уникальные начальные конфигурации, или для устройств, которые могут использовать только маркеры SAS через TPM или виртуальный TPM в качестве механизма аттестации. Для отдельных регистраций можно указать нужный идентификатор устройства Центра Интернета вещей.

    Следуя этому рабочему процессу, можно создать отдельную группу регистрации с пакетами SDK:
    
    1. Выберите механизм ```attestation``` (TPM или X.509).
        1. **TPM**. Используя ключ подтверждения с физического устройства или из симулятора TPM в качестве входных данных, можно вызвать API пакета SDK службы ```TpmAttestation```, чтобы создать аттестацию для регистрации. 
        2. **X.509**. Используя сертификат клиента в качестве входных данных, можно вызвать API пакета SDK службы ```X509Attestation.createFromClientCertificate```, чтобы создать аттестацию для регистрации.
    2. Создайте переменную ```IndividualEnrollment``` с помощью созданного свойства ```attestation``` и уникального свойства ```registrationId``` в качестве входных данных, которые находятся на устройстве или созданы в симуляторе TPM.  При необходимости можно задать такие параметры, как ```Device ID```, ```IoTHubHostName```, ```ProvisioningStatus```.
    3. Вызовите API пакета SDK службы ```createOrUpdateIndividualEnrollment``` в своем серверном приложении с помощью ```IndividualEnrollment```, чтобы создать отдельную регистрацию.

После успешного создания регистрации служба подготовки устройств вернет результат регистрации.

Этот рабочий процесс показан в [примерах](#samples).

## <a name="update-an-enrollment-entry"></a>Обновление записи регистрации

После создания записи регистрации может потребоваться обновить регистрацию.  Возможные сценарии включают обновление требуемого свойства, обновление метода аттестации или отзыв доступа к устройству.  Есть различные API для отдельной и групповой регистрации, но нет различий для механизма аттестации.

Запись регистрации можно обновить, следуя этому рабочему процессу:
* **Индивидуальная регистрация**.
    1. Сначала получите последнюю регистрацию из службы подготовки с помощью API пакета SDK службы ```getIndividualEnrollment```.
    2. При необходимости измените параметр последней регистрации. 
    3. С помощью последней регистрации вызовите API пакета SDK службы ```createOrUpdateIndividualEnrollment```, чтобы обновить запись регистрации.
* **Группа регистрации**:
    1. Сначала получите последнюю регистрацию из службы подготовки с помощью API пакета SDK службы ```getEnrollmentGroup```.
    2. При необходимости измените параметр последней регистрации.
    3. С помощью последней регистрации вызовите API пакета SDK службы ```createOrUpdateEnrollmentGroup```, чтобы обновить запись регистрации.

Этот рабочий процесс показан в [примерах](#samples).

## <a name="remove-an-enrollment-entry"></a>Удаление записи регистрации

* **Отдельную регистрацию** можно удалить, вызвав API пакета SDK службы ```deleteIndividualEnrollment``` с помощью ```registrationId```.
* **Групповую регистрацию** можно удалить, вызвав API пакета SDK службы ```deleteEnrollmentGroup``` с помощью ```enrollmentGroupId```.

Этот рабочий процесс показан в [примерах](#samples).

## <a name="bulk-operation-on-individual-enrollments"></a>Массовые операции по отдельным регистрациям

Массовые операции можно выполнять, чтобы создавать, обновлять или удалять различные отдельные регистрации, следуя этому рабочему процессу:

1. Создайте переменную, которая содержит несколько ```IndividualEnrollment```.  Реализация этой переменной отличается для каждого языка.  Просмотрите пример массовой операции на GitHub, чтобы узнать больше.
2. Вызовите API пакета SDK службы ```runBulkOperation``` с помощью ```BulkOperationMode``` для требуемой операции и своей переменной для отдельных регистраций. Поддерживаются четыре режима: создание, обновление, updateIfMatchEtag и удаление.

После успешного выполнения операции служба подготовки устройств вернет результат массовой операции.

Этот рабочий процесс показан в [примерах](#samples).
