---
title: "Управление регистрации устройств с пакетами SDK службы подготовки устройства Azure | Документы Microsoft"
description: "Способ регистрации устройств в IoT Hub устройства службы контроля с SDK службы управления"
services: iot-dps
keywords: 
author: yzhong94
ms.author: yizhon
ms.date: 12/01/2017
ms.topic: article
ms.service: iot-dps
documentationcenter: 
manager: arjmands
ms.devlang: na
ms.custom: mvc
ms.openlocfilehash: 82da49924e71a38ca557f244f2830e1da45826b1
ms.sourcegitcommit: b5c6197f997aa6858f420302d375896360dd7ceb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/21/2017
---
# <a name="how-to-manage-device-enrollments-with-azure-device-provisioning-service-sdks"></a>Управление регистрации устройств с пакетами SDK службы подготовки устройства Azure
Объект *регистрации устройств* создает запись одно устройство или группу устройств, в определенный момент может зарегистрировать в службе подготовки устройства. Запись регистрации содержит необходимую начальную конфигурацию устройств как часть регистрации, включая нужный Центр Интернета вещей. В этой статье показано, как управлять регистрации устройств для подготовки службы программным способом с помощью пакетов SDK службы подготовки IoT Azure.  Пакеты SDK доступны на сайте GitHub в одном репозитории IoT Azure (SDK).

## <a name="samples"></a>Примеры
В этой статье рассматриваются основные понятия верхнего уровня для управления регистрации устройств для подготовки службы программным способом с помощью пакетов SDK службы подготовки IoT Azure.  Точное вызовов API может отличаться из-за различия языков.  Просмотрите образцы предоставляются подробные сведения на GitHub:
* [Клиент службы подготовки Java образцы](https://github.com/Azure/azure-iot-sdk-java/tree/master/provisioning/provisioning-samples)
* [Примеры подготовки клиента службы node.js](https://github.com/Azure/azure-iot-sdk-node/tree/master/provisioning/service/samples)

## <a name="prerequisites"></a>Технические условия
* Строка подключения из экземпляра службы подготовки устройств
* Артефакты безопасности устройств:
    * [**ДОВЕРЕННЫЙ ПЛАТФОРМЕННЫЙ МОДУЛЬ**](https://docs.microsoft.com/en-us/azure/iot-dps/concepts-security):
        * Отдельные регистрации: идентификатор регистрации и ключ подтверждения доверенного платформенного МОДУЛЯ из физического устройства или симулятора доверенного платформенного МОДУЛЯ.
        * Группа регистрации не применяется к аттестации доверенного платформенного МОДУЛЯ.
    * [**X.509**](https://docs.microsoft.com/en-us/azure/iot-dps/concepts-security):
        * Отдельные регистрации: [конечного сертификата](https://docs.microsoft.com/en-us/azure/iot-dps/concepts-security#leaf-certificate) из физического устройства или эмулятора поперечные срезы данных.
        * Группа регистрации: [корневой сертификат](https://docs.microsoft.com/en-us/azure/iot-dps/concepts-security#root-certificate) или [промежуточный сертификат](https://docs.microsoft.com/en-us/azure/iot-dps/concepts-security#intermediate-certificate), используемый для создания сертификата устройства на физическом устройстве.  Он также может возникать из эмулятора поперечные срезы данных.

## <a name="create-a-device-enrollment"></a>Создание регистрации устройств

Зарегистрировать устройства с помощью службы подготовки можно двумя способами.

* **Группа регистрации** запись для группы устройств, которые совместно используют общий механизм аттестации сертификатов X.509, подписанные [корневой сертификат](https://docs.microsoft.com/en-us/azure/iot-dps/concepts-security#root-certificate) или [промежуточный сертификат ](https://docs.microsoft.com/en-us/azure/iot-dps/concepts-security#intermediate-certificate). Мы советуем использовать группу регистраций для большого количества устройств, имеющих необходимую начальную конфигурацию, или для устройств, предназначенных для одного и того же клиента. Обратите внимание, что как *группы регистраций* можно регистрировать только устройства, использующие механизм аттестации X.509. 

    Можно создать группу регистрации с пакетами SDK, которые после этого рабочего процесса:

    1. Аттестация механизм использует для регистрации группы корневого сертификата X.509.  Вызвать API пакета SDK службы ```X509Attestation.createFromRootCertificate``` с корневым сертификатом для создания аттестации для регистрации.  Корневой сертификат X.509 предоставляется в PEM-файле или в виде строки.
    1. Создайте новый ```EnrollmentGroup``` переменной с помощью ```attestation``` создана и уникальный ```enrollmentGroupId```.  При необходимости можно задать параметры, как ```Device ID```, ```IoTHubHostName```, ```ProvisioningStatus```.
    2. Вызвать API пакета SDK службы ```createOrUpdateEnrollmentGroup``` в приложении базы данных с ```EnrollmentGroup``` для создания группы регистрации.

* **Отдельная регистрация** — это запись одного устройства, которое можно зарегистрировать. В качестве механизмов аттестации отдельные регистрации могут использовать сертификаты X.509 или токены SAS (в реальном или виртуальном доверенном платформенном модуле). Мы советуем использовать отдельные регистрации для устройств, которым требуются уникальные начальные конфигурации, или для устройств, которые могут использовать только маркеры SAS через TPM или виртуальный TPM в качестве механизма аттестации. Для отдельных регистраций можно указать нужный идентификатор устройства Центра Интернета вещей.

    Можно создать отдельные регистрацию с пакетами SDK, которые после этого рабочего процесса:
    
    1. Выберите ваш ```attestation``` механизм, который может быть доверенного платформенного МОДУЛЯ или X.509.
        1. **Доверенный платформенный модуль**: как входные данные с помощью ключа подтверждения от физического устройства или симуляторе доверенного платформенного МОДУЛЯ, можно вызвать API пакета SDK службы ```TpmAttestation``` Создание аттестации для регистрации. 
        2. **X.509**: как входные данные с помощью сертификата клиента, можно вызвать API пакета SDK службы ```X509Attestation.createFromClientCertificate``` Создание аттестации для регистрации.
    2. Создайте новый ```IndividualEnrollment``` переменной с помощью ```attestation``` создана и уникальный ```registrationId``` в качестве выходных данных на устройстве или созданная в симуляторе доверенного платформенного МОДУЛЯ.  При необходимости можно задать параметры, как ```Device ID```, ```IoTHubHostName```, ```ProvisioningStatus```.
    3. Вызвать API пакета SDK службы ```createOrUpdateIndividualEnrollment``` в приложении базы данных с ```IndividualEnrollment``` для создания отдельных регистрации.

После успешного создания регистрации службы подготовки устройств будет возвращать результат регистрации.

Этот рабочий процесс, представленный в [образцы](#samples).

## <a name="update-an-enrollment-entry"></a>Обновление записи регистрации

После создания записи регистрации может потребоваться обновить регистрацию.  Возможные сценарии включают обновление нужное свойство, обновление метод аттестации или Отмена доступа к устройству.  Существуют различные интерфейсы API для отдельных регистрации и регистрации группы, но никакой разницы для механизма аттестации.

Можно обновить запись регистрации после этого рабочего процесса.
* **Отдельные регистрации**:
    1. Получение последней регистрации из службы подготовки первых с API пакета SDK службы ```getIndividualEnrollment```.
    2. Измените параметр последней регистрации при необходимости. 
    3. С помощью последней регистрации, вызовите API пакета SDK службы ```createOrUpdateIndividualEnrollment``` обновить запись регистрации.
* **Группа регистрации**:
    1. Получение последней регистрации из службы подготовки первых с API пакета SDK службы ```getEnrollmentGroup```.
    2. Измените параметр последней регистрации при необходимости.
    3. С помощью последней регистрации, вызовите API пакета SDK службы ```createOrUpdateEnrollmentGroup``` обновить запись регистрации.

Этот рабочий процесс, представленный в [образцы](#samples).

## <a name="remove-an-enrollment-entry"></a>Удалить запись регистрации

* **Отдельные регистрации** можно удалить путем вызова API пакета SDK службы ```deleteIndividualEnrollment``` с помощью ```registrationId```.
* **Группа регистрации** можно удалить путем вызова API пакета SDK службы ```deleteEnrollmentGroup``` с помощью ```enrollmentGroupId```.

Этот рабочий процесс, представленный в [образцы](#samples).

## <a name="bulk-operation-on-individual-enrollments"></a>Операция массового на отдельных регистраций

Можно выполнять операции массового создания, обновления или удаления несколько отдельных регистраций после этого рабочего процесса.

1. Создайте переменную, которая содержит несколько ```IndividualEnrollment```.  Реализация этой переменной отличается для каждого языка.  Просмотрите пример массовой операции на GitHub подробные сведения.
2. Вызвать API пакета SDK службы ```runBulkOperation``` с ```BulkOperationMode``` для требуемой операции и переменную для отдельных регистраций. Поддерживаются четыре режима: создание, обновление, updateIfMatchEtag и удаление.

После успешного выполнения операции, служба подготовки устройств вернет результат массовой операции.

Этот рабочий процесс, представленный в [образцы](#samples).
