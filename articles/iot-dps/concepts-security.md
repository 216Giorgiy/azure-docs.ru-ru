---
title: "Понятия безопасности в службе подготовки устройств для Центра Интернета вещей Azure | Документация Майкрософт"
description: "В этой статье описываются понятия безопасности подготовки устройств при использовании службы подготовки устройств и Центра Интернета вещей."
services: iot-dps
keywords: 
author: nberdy
ms.author: nberdy
ms.date: 09/05/2017
ms.topic: article
ms.service: iot-dps
documentationcenter: 
manager: timlt
ms.devlang: na
ms.custom: mvc
ms.openlocfilehash: f004e4763106c25d94f585f644560cf3a72d3f1b
ms.sourcegitcommit: 4256ebfe683b08fedd1a63937328931a5d35b157
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/23/2017
---
# <a name="iot-hub-device-provisioning-service-security-concepts"></a>Понятия безопасности службы подготовки устройств для Центра Интернета вещей 

Служба подготовки устройств для Центра Интернета вещей — это вспомогательная служба, позволяющая настроить полностью автоматическую подготовку устройства в указанном Центре Интернета вещей. Она дает возможность подготавливать миллионы устройств с высоким уровнем безопасности и масштабируемости. В этой статье приводятся общие сведения о понятиях *безопасности*, связанных с подготовкой устройства. Сведения в этой статье касаются пользователей, участвующих в подготовке устройства для развертывания.

## <a name="attestation-mechanism"></a>Механизм аттестации

Механизм аттестации — это способ подтверждения удостоверения устройства. Он также имеет отношение к списку регистрации, указывающему службе подготовки, какой метод аттестации следует использовать с данным устройством.

> [!NOTE]
> Для применения аналогичной концепции Центр Интернета вещей использует схему проверки подлинности.

Служба подготовки устройств поддерживает две формы аттестации:
* **Сертификаты X.509** на основе стандартного потока проверки подлинности сертификата X.509.
* **Токены SAS** на основе запроса nonce с использованием стандарта доверенного платформенного модуля ключей. На устройстве не должен присутствовать физический доверенный платформенный модуль (TPM), но для каждой [спецификации TPM](https://trustedcomputinggroup.org/work-groups/trusted-platform-module/) требуется подтверждение с помощью ключа подтверждения.

## <a name="hardware-security-module"></a>Аппаратный модуль безопасности

Аппаратный модуль безопасности (HSM) используется для безопасного аппаратного хранения секретов устройств. Это самая безопасная форма хранилища секретов. В HSM могут храниться как сертификаты X.509, так и токены SAS. HSM можно использовать с обоими механизмами аттестации, которые поддерживает процесс подготовки.

> [!TIP]
> Мы настоятельно рекомендуем использовать HSM для безопасного хранения секретов на устройствах.

Секреты устройств также можно хранить в программном обеспечении (памяти). Но, по сравнению с HSM, это менее безопасный способ хранения.

## <a name="trusted-platform-module-tpm"></a>Доверенный платформенный модуль (TPM)

TPM может ссылаться на стандарт безопасного хранения ключей, используемых для проверки подлинности платформы, или относиться к интерфейсу ввода-вывода, используемого для взаимодействия с модулями реализации стандарта. Модули TPM могут существовать как дискретные аппаратные средства, интегрированные аппаратные средства, микропрограммные или программные средства. Узнайте больше об [аттестации доверенного платформенного модуля](/windows-server/identity/ad-ds/manage/component-updates/tpm-key-attestation). Служба подготовки устройств поддерживает только TPM 2.0.

### <a name="endorsement-key"></a>Ключ подтверждения

Ключ подтверждения — асимметричный ключ содержится в доверенный платформенный модуль, который внутренне был создан или вставлен при производстве и является уникальным для каждого TPM. Ключ подтверждения невозможно изменить или удалить. Закрытая часть ключа подтверждения недоступна вне TPM, в то время как по открытой части ключа подтверждения можно определить подлинность TPM. Узнайте больше о [ключе подтверждения](https://technet.microsoft.com/library/cc770443(v=ws.11).aspx).

### <a name="storage-root-key"></a>Корневой ключ хранилища

Корневой ключ хранилища хранится в TPM и используется для защиты созданных приложениями ключей TPM, чтобы их нельзя было использовать без TPM. Корневой ключ хранилища создается при назначении владельца TPM. При очистке TPM для нового владельца также создается корневой ключ хранилища. Узнайте больше о [корневом ключе хранилища](https://technet.microsoft.com/library/cc753560(v=ws.11).aspx).

## <a name="x509-certificates"></a>Сертификаты X.509

С использованием сертификатов X.509, как механизм аттестации является отличным способом масштабировать производства и упрощают подготовку устройства к работе. Сертификаты X.509, обычно упорядочиваются доверия, в которой каждый сертификат в цепочке подписывается закрытым ключом сертификата Далее выше, и т.д., завершающуюся самозаверяющий корневой сертификат цепочки сертификатов. При этом создается делегированного цепочку сертификатов из корневого сертификата, созданный доверенным корневым сертификации (ЦС) работы через каждый промежуточного ЦС для конечного субъекта сертификата, установленного на устройстве. Дополнительные сведения см. в разделе [устройства проверки подлинности с использованием сертификатов X.509 ЦС](https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-x509ca-overview). 

Часто цепочку сертификатов представляет некоторые логические или физические иерархия, связанная с устройства. Например производитель может выдачи самозаверяющего корневого сертификата ЦС, используется для создания уникальный сертификат промежуточного ЦС для каждой фабрики, используйте сертификат каждой фабрики для создания уникальный сертификат промежуточного ЦС для каждого производственного Строка в фабрики и наконец, используйте сертификат рабочей строки для создания сертификата уникальный устройства (конечных) для каждого устройства, произведенные в строке. Дополнительные сведения см. в разделе [знания о сертификатах X.509 ЦС в отрасли IoT](https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-x509ca-concept). 

### <a name="root-certificate"></a>Корневой сертификат

Корневой сертификат является самозаверяющий сертификат X.509, представляющий центр сертификации (ЦС). Это terminus или якоря доверия, цепочки сертификатов. Корневые сертификаты можно самостоятельно выданным организацией или приобретенные у корневого центра сертификации. Дополнительные сведения см. в разделе [получить сертификаты X.509](https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-security-x509-get-started#get-x509-ca-certificates). Корневой сертификат может также называться сертификат корневого ЦС.

### <a name="intermediate-certificate"></a>Промежуточный сертификат

Промежуточный сертификат является сертификатом X.509 которого подписана путем корневой сертификат (или другой промежуточный сертификат с корневым сертификатом в цепочке). Последний промежуточный сертификат в цепочке используется для подписи конечного сертификата. Промежуточный сертификат может также называться промежуточный сертификат ЦС.

### <a name="leaf-certificate"></a>Конечный сертификат

Конечного сертификата или сертификатов конечных субъектов, определяющим владельца сертификата. Он имеет корневой сертификат в цепочке сертификатов, а также ноль или несколько промежуточных сертификатов. Конечный сертификат не используется для подписи каких-либо других сертификатов. Уникально идентифицирует устройства для подготовки службы и иногда называют сертификата устройства. Во время проверки подлинности устройство использует закрытый ключ, связанный с этим сертификатом реагировать на доказательством владения запрос от службы. Дополнительные сведения см. в разделе [проверки подлинности устройств подписаны сертификаты X.509](https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-x509ca-overview#authenticating-devices-signed-with-x509-ca-certificates).

## <a name="controlling-device-access-to-the-provisioning-service-with-x509-certificates"></a>Управление доступом к устройства для подготовки службы с использованием сертификатов X.509

Служба обеспечения предоставляет два типа запись регистрации, можно использовать для управления доступом для устройств, использующих механизм аттестации X.509:  

- [Отдельные регистрации](./concepts-service.md#individual-enrollment) настраиваются с помощью сертификата устройства, связанные с определенным устройством. Эти элементы управления регистрации для конкретных устройств.
- [Группа регистрации](./concepts-service.md#enrollment-group) операций связаны с определенной промежуточного или сертификат корневого ЦС. Эти элементы управления регистрации для всех устройств, имеющих, промежуточного или корневой сертификат в цепочке их сертификатов. 

Когда устройство подключается к службе подготовки, служба устанавливает приоритеты подробные записи регистрации через более обобщенным записей регистрации. То есть если существует отдельных регистрации устройства, подготовки службы применяет эту запись. Если нет отдельных регистрации устройства и группу регистрации для первого промежуточный сертификат в цепочке сертификатов устройства существует, службы применяется этот элемент, и так далее вверх по цепочке к корню. Служба применяется первая запись применим, он находит, таким образом, что:

- Если первый найденный элемент регистрации включен, служба предоставляет устройству.
- Если первый найденный элемент регистрации отключена, служба не подготовьте устройства.  
- Если запись регистрации, не будет найдена для сертификатов в цепочке сертификатов устройств, службы не подготовьте устройства. 

Этот механизм и иерархическую структуру цепочек сертификатов предоставляет мощные гибкость в управлении доступом для отдельных устройств, а также как и для групп устройств. Например представьте пяти устройств с помощью следующих цепочек сертификатов: 

- *Устройства 1*: корневой сертификат -> сертификата, A -> сертификата устройства (1)
- *Устройство 2*: корневой сертификат -> сертификата, A -> сертификата устройства 2
- *Устройства 3*: корневой сертификат -> сертификата, A -> сертификата устройства 3
- *Устройство 4*: корневой сертификат -> B -> сертификата устройства 4 сертификата
- *Устройство 5*: корневой сертификат -> B -> сертификата устройства 5 сертификата

Изначально можно создать запись регистрации одной группы включена для корневого сертификата включить доступ для всех пяти устройств. В случае компрометации сертификата B позже становится можно создать запись группу отключено регистрации для сертификата B предотвратить *4 устройства* и *5 устройства* регистрации. Если по-прежнему более поздней версии *устройства 3* становится скомпрометирована, можно создать запись отключенные отдельные регистрации на сертификат. Это отменяет доступ *устройства 3*, но по-прежнему допускает *устройство 1* и *2 устройства* для регистрации.