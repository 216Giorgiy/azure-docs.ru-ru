<properties linkid="web-sites-create-web-jobs" urlDisplayName="Создание веб-заданий в Microsoft Azure" pageTitle="Создание веб-заданий на веб-сайтах Microsoft Azure" metaKeywords="Веб-сайты Microsoft Azure, веб-задания" description="Сведения о создании веб-заданий на веб-сайтах Microsoft Azure." metaCanonical="" services="web-sites" documentationCenter="" title="Создание веб-заданий на веб-сайтах Microsoft Azure" authors="timamm"  solutions="" writer="timamm" manager="paulettm" editor="mollybos"  />

#Использование функции веб-заданий на веб-сайтах Microsoft Azure#

Веб-сайты Microsoft Azure позволяют запускать программы или скрипты на веб-сайте одним из трех способов: по требованию, непрерывно или по расписанию. Дополнительные затраты для использования веб-заданий Microsoft Azure отсутствуют, если только вы не хотите включить возможность "Всегда включено", описанную далее в этой статье.


## Оглавление ##
- [Применимые типы файлов для скриптов](#acceptablefiles)
- [Создание задачи по требованию](#CreateOnDemand)
- [Создание непрерывно выполняющейся задачи](#CreateContinuous)
- [Создание запланированной задачи](#CreateScheduled)
	- [Запланированные задания и планировщик Azure](#Scheduler)
- [Просмотр журнала заданий](#ViewJobHistory)
- [Примечания](#WHPNotes)
- [Дальнейшие действия](#NextSteps)
	- [Расширенные возможности Microsoft Azure SDK для веб-заданий](#WebJobsSDK)
	- [Альтернативные методы развертывания](#AlternateDeployments)
	- [Дополнительные ресурсы](#AdditionalResources)

<a name="acceptablefiles"></a>
##Применимые типы файлов для скриптов##
В качестве запускаемых скриптов принимаются следующие типы файлов:

.cmd, .bat, .exe (с использованием командной строки windows)

.ps1 (с использованием powershell)

.sh (с использованием bash)

.PHP (с использованием php)

.py (с использованием python)

.js (с использованием node)

<a name="CreateOnDemand"></a>
##Создание задачи по требованию##

1. В командной строке на странице **Веб-задания** щелкните **Добавить**. Появится диалоговое окно **Новое задание**.
	
	![Задача по требованию][OnDemandWebJob]
	
2. В поле **Имя** укажите имя задачи. Имя должно начинаться с буквы или цифры и не может содержать специальные символы, отличные от "-" и "_".
	
3. В поле **Содержимое (ZIP-файлы - максимум 100 МБ)** перейдите к ZIP-файлу, в котором содержится скрипт. ZIP-файл должен содержать исполняемый файл (.exe .cmd .bat .sh .php .py .js), а также все вспомогательные файлы, необходимые для запуска программы или скрипта.
	
4. В поле **Как выполнить** выберите пункт **Выполнять по требованию**.
	
5. Установите флажок в правой нижней части диалогового окна для передачи скрипта на веб-сайт. В списке отображается имя, указанное для задачи:
	
	![Список задач][WebJobsList]
	
6. Чтобы запустить скрипт, выберите его имя в списке и щелкните **Запустить один раз** на панели команд в нижней части страницы портала.
	
	![Запустить один раз][RunOnce]

<a name="CreateContinuous"></a>
##Создание непрерывно выполняющейся задачи##

1. Чтобы создать непрерывно выполняемую задачу, выполните действия по созданию задачи, которая запускается один раз, однако в поле **Как выполнить** выберите значение **Выполнять непрерывно**.
	
	![Новая непрерывная задача][NewContinuousJob]
	
2. Чтобы запустить или остановить непрерывно выполняемую задачу, выберите задачу в списке и щелкните на панели команд **Запустить** или **Остановить**.

> [WACOM.NOTE] Если веб-сайт работает на нескольких экземплярах, непрерывно выполняемая задача будет работать на всех экземплярах. Задачи по требованию и запланированные задачи запускаются на отдельном экземпляре, выбранном Microsoft Azure для балансировки нагрузки.

> [WACOM.NOTE]
> Для непрерывно выполняемых задач рекомендуется включить параметр **Всегда включено** на странице "Настройки" для данного веб-сайта. Функция "Всегда включено", доступная только в базовом и стандартном режимах, препятствует выгрузке веб-сайтов, даже если они были неактивны в течение некоторого времени. Если веб-сайт всегда загружен, непрерывно выполняемая задача может работать более стабильно. 

<a name="CreateScheduled"></a>
##Создание запланированной задачи##
1. Чтобы создать запланированную задачу, выполните те же действия, что и раньше, но в поле **Как выполнить** выберите **Выполнять по расписанию**.
	
	![Новое запланированное задание][NewScheduledJob]
	
2. Выберите **Регион планировщика** для задания и нажмите кнопку со стрелкой в правом нижнем углу диалогового окна, чтобы перейти к следующему экрану.

3. В диалоговом окне **Создать задание** выберите нужный тип в разделе **Повторение**: **Разовое задание** или **Повторяющееся задание**.
	
	![Запланированное повторение][SchdRecurrence]
	
4. Кроме того, выберите время запуска в разделе **Запуск**: **Сейчас** или **В определенное время**.
	
	![Время начала по расписанию][SchdStart]
	
5. Если необходимо начать в определенное время, выберите значения времени запуска в поле **Начало в**.
	
	![Расписание запуска в определенное время][SchdStartOn]
	
6. Если выбрано повторяющееся задание, с помощью параметра **Повторять каждые** можно указать частоту повторения, а с помощью параметра **Заканчивается** — время завершения.
	
	![Запланированное повторение][SchdRecurEvery]
	
7. При выборе значения **Недели** можно выбрать поле **В определенном расписании** и указать дни недели, в которые должно запускаться это задание.
	
	![Запланированные дни недели][SchdWeeksOnParticular]
	
8. При выборе значения **Месяцы** и поля **В определенном расписании** можно определить запуск задания в определенные, пронумерованные **дни** месяца. 
	
	![Планирование определенных дат месяца][SchdMonthsOnPartDays]
	
9. При выборе значения **Дни недели** можно выбрать, в какие дни недели месяца необходимо запускать задание.
	
	![Планирование определенных дней недели в месяце][SchdMonthsOnPartWeekDays]
	
10. Наконец, можно также использовать параметр **Вхождения** для выбора недели месяца (первая, вторая, третья и т. д.), во время которой задание должно выполняться в указанные дни недели.
	
	![Планирование определенных дней недели в определенные недели месяца][SchdMonthsOnPartWeekDaysOccurences]
	
11. Имена созданных заданий будут отображаться на вкладке "Веб-задания" вместе со сведениями об их состоянии, типе расписания и прочей информацией. Сохраняются журнальные данные для последних 30 выполненных задач.
	
	![Список заданий][WebJobsListWithSeveralJobs]
	
<a name="Scheduler"></a>
###Запланированные задания и планировщик Azure
На портале планировщика Azure можно выполнить дополнительную настройку запланированных заданий.

1.	Чтобы перейти на страницу портала планировщика Azure, щелкните **расписание** задания на странице "Веб-задания". 
	
	![Ссылка на планировщик Azure][LinkToScheduler]
	
2. Выберите задание на странице планировщика.
	
	![Задание на странице портала планировщика][SchedulerPortal]
	
3. Откроется страница **Действие задания**, на которой можно выполнить дополнительную настройку задания. 
	
	![Страница "Действие задания" в планировщике][JobActionPageInScheduler]
	

<!-- ================ ViewJobHistory ================= -->

<a name="ViewJobHistory"></a>
##Просмотр журнала заданий##
1. Чтобы просмотреть журнал выполнения задания, включая задания, созданные с помощью SDK веб-заданий, щелкните соответствующую ссылку в столбце **Журналы**. Можно также использовать значок буфера обмена для копирования URL-адреса страницы файла журнала в буфер обмена.
	
	![Ссылка на журналы][WebJobLogs]
		
2. При щелчке ссылки открывается страница сведений о веб-заданиях для задачи. На этой странице отображаются имя выполненной команды, время ее последнего выполнения, а также сведения об успешности выполнения. Укажите время в разделе **Недавно выполненные задания**, чтобы просмотреть дополнительные сведения.
	
	![Сведения о веб-задании][WebJobDetails]
	
3. Откроется страница **Сведения о выполнении веб-задания**. Щелкните **Переключить вывод**, чтобы просмотреть текст журнала. Журнал выводится в текстовом формате. 
	
	![Сведения о выполнении веб-задания][WebJobRunDetails]
	
4. Чтобы просмотреть текст вывода в отдельном окне браузера, щелкните ссылку **загрузить**. Чтобы загрузить текст, щелкните ссылку правой кнопкой мыши и выберите команду для сохранения содержимого файла в контекстном меню браузера.
	
	![Загрузка выходных данных журнала][DownloadLogOutput]
	
5. Чтобы получить список веб-заданий на панели мониторинга журнала, вы можете воспользоваться ссылкой **Веб-задания** вверху страницы.
	
	![Ссылка на список веб-заданий][WebJobsLinkToDashboardList]
	
	![Список заданий в панели мониторинга журнала][WebJobsListInJobsDashboard]
	
	При щелчке одной из этих ссылок открывается страница "Сведения о веб-задании" для выбранного задания.

<a name="WHPNotes"></a>
##Примечания
	
- По состоянию на март 2014 г. в бесплатном режиме веб-сайтов время ожидания может истекать, если в течение 20 минут не поступали запросы к сайту SCM (развертывание), а в Azure не был открыт портал веб-сайта. При этом такое поведение наблюдается даже при наличии запросов к фактическому сайту.

- Код непрерывно выполняющегося задания должен выполняться в бесконечном цикле.

- Задания выполняются непрерывно только во время работы сайта.

- В базовом и стандартном режимах реализована функция "Всегда включено", которая позволяет предотвратить переход сайта в неактивное состояние.

<a name="NextSteps"></a>
##Дальнейшие действия##
 
<a name="WebJobsSDK"></a>
###Расширенные возможности Microsoft Azure SDK для веб-заданий###
Microsoft Azure SDK для веб-заданий упрощает добавление фоновой обработки для веб-сайтов Microsoft Azure. Этот пакет SDK обеспечивает интеграцию хранилища Microsoft Azure, активируя функции в программе при добавлении элементов в очереди, BLOB-объекты или таблицы. Благодаря интеграции панели мониторинга с порталом Azure реализуются эффективные функции мониторинга и диагностики программ, написанных с помощью этого пакета SDK. Компоненты мониторинга и диагностики встроены в пакет SDK и не требуют добавления в программу какого-либо специального кода.
 
Дополнительные сведения см. в учебнике [Приступая к работе с Microsoft Azure SDK для веб-заданий](http://asp.net/aspnet/overview/developing-apps-with-windows-azure/getting-started-with-windows-azure-webjobs). В этом руководстве представлен обзор компонентов пакета SDK для веб-заданий, а также предоставляются пошаговые руководства по созданию и запуску простого фонового процесса Hello World. 

Чтобы просмотреть пошаговое руководство по примеру приложения командной строки, созданного с помощью пакета Microsoft Azure SDK для веб-заданий, изучите раздел [Введение в веб-задания Windows Azure][HanselIntro].

<a name="AlternateDeployments"></a>
###Альтернативные методы развертывания###
Если не нужно использовать страницу портала веб-заданий для загрузки скриптов, можно воспользоваться FTP, git или веб-развертыванием. Дополнительные сведения содержатся в разделе  [Способы развертывания веб-заданий Windows Azure][AmitDeploy] и [Развертывание приложения консоли .NET в Azure через Git с помощью веб-заданий][AmitConsole].

<a name="AdditionalResources"></a>
###Дополнительные ресурсы###
- Дополнительные ресурсы см. в списке аннотированных ссылок по функции веб-заданий [Использование компонента веб-заданий для веб-сайтов Windows Azure][RickWebJobsCurah]. 
	
- Видео, посвященные веб-заданиям:

	[Веб-задания Azure 101 - стандартные веб-задания, Джейми Эспиноза (Jamie Espinosa)](http://www.windowsazure.com/ru-ru/documentation/videos/azure-webjobs-basics/)
	
	[Веб-задания Azure 102 - запланированные веб-задания и панель мониторинга веб-заданий, Джейми Эспиноза (Jamie Espinosa)](http://www.windowsazure.com/ru-ru/documentation/videos/azure-webjobs-schedule-and-dashboard/)
	
	[Планировщик Azure 101 - планирование ресурсов, Кевин Лам (Kevin Lam)](http://www.windowsazure.com/ru-ru/documentation/videos/azure-scheduler-how-to/)


<!-- LINKS -->
[PSonWebJobs]:http://blogs.msdn.com/b/nicktrog/archive/2014/01/22/running-powershell-web-jobs-on-azure-websites.aspx

[HanselIntro]:http://www.hanselman.com/blog/IntroducingWindowsAzureWebJobs.aspx

[AmitDeploy]:http://blog.amitapple.com/post/74215124623/deploy-azure-webjobs

[AmitConsole]:http://blog.amitapple.com/post/73574681678/git-deploy-console-app

[RickWebJobsCurah]:http://go.microsoft.com/fwlink/?LinkId=390226

<!-- IMAGES -->
[OnDemandWebJob]: ./media/web-sites-create-web-jobs/01aOnDemandWebJob.png
[WebJobsList]: ./media/web-sites-create-web-jobs/02aWebJobsList.png
[NewContinuousJob]: ./media/web-sites-create-web-jobs/03aNewContinuousJob.png
[NewScheduledJob]: ./media/web-sites-create-web-jobs/04aNewScheduledJob.png
[SchdRecurrence]: ./media/web-sites-create-web-jobs/05SchdRecurrence.png
[SchdStart]: ./media/web-sites-create-web-jobs/06SchdStart.png
[SchdStartOn]: ./media/web-sites-create-web-jobs/07SchdStartOn.png
[SchdRecurEvery]: ./media/web-sites-create-web-jobs/08SchdRecurEvery.png
[SchdWeeksOnParticular]: ./media/web-sites-create-web-jobs/09SchdWeeksOnParticular.png
[SchdMonthsOnPartDays]: ./media/web-sites-create-web-jobs/10SchdMonthsOnPartDays.png
[SchdMonthsOnPartWeekDays]: ./media/web-sites-create-web-jobs/11SchdMonthsOnPartWeekDays.png
[SchdMonthsOnPartWeekDaysOccurences]: ./media/web-sites-create-web-jobs/12SchdMonthsOnPartWeekDaysOccurences.png
[RunOnce]: ./media/web-sites-create-web-jobs/13RunOnce.png
[WebJobsListWithSeveralJobs]: ./media/web-sites-create-web-jobs/13WebJobsListWithSeveralJobs.png
[WebJobLogs]: ./media/web-sites-create-web-jobs/14WebJobLogs.png
[WebJobDetails]: ./media/web-sites-create-web-jobs/15WebJobDetails.png
[WebJobRunDetails]: ./media/web-sites-create-web-jobs/16WebJobRunDetails.png
[DownloadLogOutput]: ./media/web-sites-create-web-jobs/17DownloadLogOutput.png
[WebJobsLinkToDashboardList]: ./media/web-sites-create-web-jobs/18WebJobsLinkToDashboardList.png
[WebJobsListInJobsDashboard]: ./media/web-sites-create-web-jobs/19WebJobsListInJobsDashboard.png
[LinkToScheduler]: ./media/web-sites-create-web-jobs/31LinkToScheduler.png
[SchedulerPortal]: ./media/web-sites-create-web-jobs/32SchedulerPortal.png
[JobActionPageInScheduler]: ./media/web-sites-create-web-jobs/33JobActionPageInScheduler.png


