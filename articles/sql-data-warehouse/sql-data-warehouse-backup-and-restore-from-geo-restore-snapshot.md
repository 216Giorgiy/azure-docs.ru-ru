<properties
   pageTitle="Восстановление базы данных после сбоя в хранилище данных SQL | Microsoft Azure"
   description="Процедура восстановления базы данных после сбоя в хранилище данных SQL."
   services="sql-data-warehouse"
   documentationCenter="NA"
   authors="sahaj08"
   manager="barbkess"
   editor=""/>

<tags
   ms.service="sql-data-warehouse"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services"
   ms.date="03/23/2016"
   ms.author="sahajs;barbkess"/>

# Восстановление базы данных после сбоя в хранилище данных SQL

Геовосстановление позволяет восстанавливать базу данных из геоизбыточной резервной копии для создания новой базы данных. Базу данных можно создать на любом сервере в любом регионе Azure. Так как она в качестве источника использует геоизбыточную резервную копию, ее можно применять для восстановления базы данных, даже если база данных недоступна из-за сбоя. Помимо восстановления после сбоя геовосстановление можно использовать в других случаях, таких как перемещение или копирование базы данных в другой сервер или регион.


## Время начала восстановления
Для выполнения операции восстановления необходимо изменить строку подключения SQL после восстановления. Операция может привести к безвозвратной потере данных. Поэтому ее следует выполнять, только если сбой будет длиться дольше, чем целевое время восстановления (RTO) приложения. Для подтверждения гарантированного восстановления используйте указанные далее точки данных.

- Постоянная ошибка подключения к базе данных.
- На портале Azure отображается предупреждение об инциденте в регионе с широким диапазоном влияния.


## Восстановление с использованием геовосстановления
При восстановлении базы данных происходит создание новой базы данных из последней геоизбыточной резервной копии. Важно убедиться, что на сервере, куда выполняется восстановление, имеется достаточный объем DTU для новой базы данных. Можно [обратиться в службу поддержки][] с просьбой увеличить квоту.


### Портал Azure
1. Войдите на [портал Azure][].
2. В левой части экрана последовательно выберите **СОЗДАТЬ**, **Данные и хранилище**, **Хранилище данных SQL**.
3. Выберите **РЕЗЕРВНАЯ КОПИЯ** в качестве источника, затем избыточную резервную копию геообъекта, из которой вы хотите восстановить базу данных.
4. Укажите остальные свойства базы данных и нажмите кнопку **Создать**.
5. Начнется процесс восстановления базы данных, который можно отслеживать с помощью **УВЕДОМЛЕНИЙ**.


### PowerShell
Используйте Azure PowerShell для программного восстановления базы данных. Чтобы загрузить модуль Azure PowerShell, запустите [установщик веб-платформы Майкрософт](http://go.microsoft.com/fwlink/p/?linkid=320376&clcid=0x409). Чтобы узнать версию, выполните командлет Get-Module -ListAvailable -Name Azure. В этой статье используются командлеты, выполняемые в Azure PowerShell версии 1.0.4.

Для восстановления базы данных используйте командлет [Start-AzureSqlDatabaseRecovery][].

1. Откройте Windows PowerShell.
2. Подключитесь к своей учетной записи Azure и выведите список всех подписок, связанных с ней.
3. Выберите подписку, содержащую базу данных, которую надо восстановить.
4. Получите базу данных, которую требуется восстановить.
5. Создайте запрос на восстановление базы данных.
6. Отслеживайте ход восстановления.

```Powershell

Login-AzureRmAccount
Get-AzureRmSubscription
Select-AzureRmSubscription -SubscriptionName "<Subscription_name>"

# Get the database you want to recover
$Database = Get-AzureRmSqlRecoverableDatabase -ServerName "<YourServerName>" –DatabaseName "<YourDatabaseName>"

# Recover database
$RecoveryRequest = Start-AzureSqlDatabaseRestore -SourceServerName "<YourSourceServerName>" -SourceDatabase $Database -TargetDatabaseName "<NewDatabaseName>" -TargetServerName "<YourTargetServerName>"

# Monitor progress of recovery operation
Get-AzureSqlDatabaseOperation -ServerName "<YourTargetServerName>" –OperationGuid $RecoveryRequest.RequestID

```

Обратите внимание, что если вашим сервером является foo.database.windows.net, в приведенных выше командлетах PowerShell в качестве -ServerName используйте значение foo.

### Интерфейс REST API
Используйте REST для программного восстановления базы данных.

1. Получите список баз данных, доступных для восстановления, используя операцию [List Recoverable Databases][]
2. Получите базу данных, которую необходимо восстановить, используя операцию [Get Recoverable Database][].
3. Создайте запрос на восстановление, используя операцию [Create Database Recovery Request][].
4. Отслеживайте состояние восстановления, используя операцию [Database Operation Status][].



## Настройка базы данных после восстановления
Далее приведен контрольный список задач, который можно использовать для подготовки восстановленной базы данных к использованию в рабочей среде.

1. **Обновление строк подключения**. Убедитесь, что строки подключения ваших клиентских средств указывают на только что восстановленную базу данных.
2. **Изменение правил брандмауэра**. Проверьте правила брандмауэра на целевом сервере и убедитесь в том, что в них разрешены подключения от клиентских компьютеров или Azure к серверу и только что восстановленной базе данных.
3. **Проверка имен для входа на сервер и пользователей базы данных**. Проверьте существование всех имен для входа, используемых вашим приложением, на сервере, на котором находится восстановленная база данных. Повторно создайте отсутствующие имена для входа и предоставьте им соответствующие разрешения на работу с восстановленной базой данных. 
4. **Включение аудита**. Если для доступа к базе данных требуется аудит, то после восстановления базы данных необходимо включить аудит.

Восстановленная база данных будет поддерживать прозрачное шифрование данных, если исходная база данных поддерживает прозрачное шифрование данных.


## Дальнейшие действия
Дополнительные сведения о функциях обеспечения непрерывности бизнес-процессов в других выпусках базы данных Azure SQL см. в статье [Обзор непрерывности бизнес-процессов базы данных Azure SQL][].


<!--Image references-->

<!--Article references-->
[Обзор непрерывности бизнес-процессов базы данных Azure SQL]: sql-database/sql-database-business-continuity.md
[Finalize a recovered database]: sql-database/sql-database-recovered-finalize.md

<!--MSDN references-->
[Start-AzureSqlDatabaseRecovery]: https://msdn.microsoft.com/library/azure/dn720224.aspx
[List Recoverable Databases]: http://msdn.microsoft.com/library/azure/dn800984.aspx
[Get Recoverable Database]: http://msdn.microsoft.com/library/azure/dn800985.aspx
[Create Database Recovery Request]: http://msdn.microsoft.com/library/azure/dn800986.aspx
[Database Operation Status]: http://msdn.microsoft.com/library/azure/dn720371.aspx

<!--Other Web references-->
[портал Azure]: https://portal.azure.com/
[обратиться в службу поддержки]: https://azure.microsoft.com/blog/azure-limits-quotas-increase-requests/

<!---HONumber=AcomDC_0330_2016-->