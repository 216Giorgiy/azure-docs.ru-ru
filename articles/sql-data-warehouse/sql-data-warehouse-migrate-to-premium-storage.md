---
title: "Перенос существующего хранилища данных SQL Azure в хранилище класса Premium | Документация Майкрософт"
description: "Инструкции по переносу существующего хранилища данных SQL в хранилище уровня &quot;Премиум&quot;."
services: sql-data-warehouse
documentationcenter: NA
author: happynicolle
manager: barbkess
editor: 
ms.assetid: 04b05dea-c066-44a0-9751-0774eb84c689
ms.service: sql-data-warehouse
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-services
ms.date: 11/29/2016
ms.author: rortloff;barbkess
translationtype: Human Translation
ms.sourcegitcommit: b676630e44c49c2ab4006f04408b01cc90c4dc28
ms.openlocfilehash: ef20cf90b54c9b28c70341d7545bb55474feb39f


---
# <a name="migration-to-premium-storage-details"></a>Сведения о миграции в хранилище класса Premium
В хранилище данных SQL недавно введена возможность использования [хранилища класса Premium, обеспечивающего более предсказуемую производительность][Premium Storage for greater performance predictability].  Теперь мы можем переместить хранилища данных, расположенные в стандартном хранилище, в хранилище класса Premium.  В этой статье содержатся сведения о том, как и когда происходит автоматический перенос и как выполнить перенос самостоятельно, если вы предпочитаете управлять простоем.

Если у вас есть несколько хранилищ данных, используйте приведенное ниже [расписание автоматического переноса][automatic migration schedule], чтобы определить время их переноса.

## <a name="determine-storage-type"></a>Определение типа хранилища
Если вы создали хранилище данных ранее приведенных ниже дат, то в настоящий момент вы используете стандартное хранилище.

| **Регион** | **Хранилище данных, созданное до указанной даты** |
|:--- |:--- |
| Восточная часть Австралии |Хранилище класса Premium пока недоступно |
| Восток Китая |1 ноября 2016 г. |
| Север Китая |1 ноября 2016 г. |
| Центральная Германия |1 ноября 2016 г. |
| Северо-восточная Германия |1 ноября 2016 г. |
| Западная Индия |Хранилище класса Premium пока недоступно |
| Западная часть Японии |Хранилище класса Premium пока недоступно |
| Северо-центральный регион США |10 ноября 2016 г. |

## <a name="automatic-migration-details"></a>Сведения об автоматической миграции
По умолчанию база данных будет перенесена автоматически в период с 18:00 до 06:00 по местному времени соответствующего региона в рамках [расписания автоматического переноса][automatic migration schedule], приведенного ниже.  Во время переноса имеющееся хранилище данных использовать нельзя.  По нашим оценкам, для миграции 1 ТБ емкости хранилища данных требуется около 1 часа.  Мы также гарантируем, что в процессе автоматического переноса независимо от этапа плата не взимается.

> [!NOTE]
> Вы не сможете использовать имеющееся хранилище данных во время миграции.  По завершении миграции оно снова переходит в оперативный режим.
>
>

Ниже приведены шаги, которые корпорация Майкрософт выполняет от вашего имени, чтобы осуществить миграцию без вашего вмешательства.  В данном примере имеющемуся хранилищу данных в хранилище уровня "Стандартный" присвоено имя MyDW.

1. Корпорация Майкрософт переименовывает MyDW в MyDW_DO_NOT_USE_[метка_времени].
2. Корпорация Майкрософт приостанавливает MyDW_DO_NOT_USE_[метка_времени].  В это время создается резервная копия.  Этот процесс может быть несколько раз приостановлен и возобновлен, если во время него возникнут проблемы.
3. Корпорация Майкрософт создает новое хранилище данных MyDW в хранилище уровня "Премиум", используя резервную копию, созданную на шаге 2.  Хранилище MyDW не будет отображаться до завершения восстановления.
4. По завершении восстановления хранилище MyDW вернется к прежнему уровню единиц DWU и состоянию (приостановлено или активно), в котором оно пребывало до переноса.
5. По завершении миграции корпорация Майкрософт удалит MyDW_DO_NOT_USE_[метка_времени].

> [!NOTE]
> Не переносятся следующие параметры:
>
> * Необходимо снова включить аудит на уровне базы данных.
> * Необходимо снова добавить правила брандмауэра на уровне **базы данных**.  Это не повлияет на правила брандмауэра на уровне **сервера**.
>
>

### <a name="automatic-migration-schedule"></a>расписание автоматического переноса
Автоматический перенос осуществляется в период с 18:00 до 06:00 по местному времени соответствующего региона согласно приведенному ниже расписанию простоев.

| **Регион** | **Предполагаемая дата начала** | **Предполагаемая дата окончания** |
|:--- |:--- |:--- |
| Восточная часть Австралии |Еще не определено |Еще не определено |
| Восток Китая |9 января 2017 г. |13 января 2017 г. |
| Север Китая |9 января 2017 г. |13 января 2017 г. |
| Центральная Германия |9 января 2017 г. |13 января 2017 г. |
| Северо-восточная Германия |9 января 2017 г. |13 января 2017 г. |
| Западная Индия |Еще не определено |Еще не определено |
| Западная часть Японии |Еще не определено |Еще не определено |
| Северо-центральный регион США |9 января 2017 г. |13 января 2017 г. |

## <a name="self-migration-to-premium-storage"></a>Самостоятельная миграция в хранилище класса Premium
Если вы хотите управлять временем простоя, то можно выполнить приведенные ниже шаги, чтобы перенести существующее хранилище данных из хранилища уровня "Стандартный" в хранилище уровня "Премиум".  Если вы решили выполнить миграцию самостоятельно, то это необходимо сделать до начала автоматической миграции в соответствующем регионе. Так вы избежите риска конфликтов (см. раздел [Расписание автоматической миграции][automatic migration schedule]).

### <a name="self-migration-instructions"></a>Инструкции по самостоятельной миграции
Если вы хотите управлять простоем, то самостоятельно перенести хранилище данных можно с помощью резервного копирования и восстановления.  Предполагается, что для этапа восстановления при переносе требуется около 1 часа на 1 ТБ емкости хранилища данных.  Если вы хотите сохранить то же имя по завершении переноса, следуйте описанным ниже указаниям, чтобы [выполнить переименование во время переноса][steps to rename during migration].

1. [Приостановите работу][Pause] хранилища данных для автоматической архивации.
2. [Восстановите][Restore] данные из последнего моментального снимка.
3. Удалите имеющееся хранилище данных в стандартном хранилище. **Если не выполнить этот шаг, с вас будет взиматься плата за оба хранилища данных.**

> [!NOTE]
> Не переносятся следующие параметры:
>
> * Необходимо снова включить аудит на уровне базы данных.
> * Необходимо снова добавить правила брандмауэра на уровне **базы данных**.  Это не повлияет на правила брандмауэра на уровне **сервера**.
>
>

#### <a name="optional-steps-to-rename-during-migration"></a>Необязательно: действия для переименования во время миграции
У двух баз данных на одном логическом сервере не может быть одинаковое имя. В настоящее время в хранилище данных SQL поддерживается возможность переименования хранилища данных.

В данном примере имеющемуся хранилищу данных в хранилище уровня "Стандартный" присвоено имя MyDW.

1. С помощью приведенной ниже команды ALTER DATABASE переименуйте MyDW, например, в MyDW_BeforeMigration.  Эта команда завершит все существующие транзакции, и она должна быть выполнена в базе данных master.
   ```
   ALTER DATABASE CurrentDatabasename MODIFY NAME = NewDatabaseName;
   ```
2. [Приостановите работу][Pause] MyDW_BeforeMigration для автоматической архивации.
3. [Восстановите][Restore] новую базу данных с прежним именем (например, MyDW) из последнего моментального снимка.
4. Удалите хранилище данных MyDW_BeforeMigration.  **Если не выполнить этот шаг, с вас будет взиматься плата за оба хранилища данных.**

> [!NOTE]
> Не переносятся следующие параметры:
>
> * Необходимо снова включить аудит на уровне базы данных.
> * Необходимо снова добавить правила брандмауэра на уровне **базы данных**.  Это не повлияет на правила брандмауэра на уровне **сервера**.
>
>

## <a name="next-steps"></a>Дальнейшие действия
Это изменение в хранилище класса Premium также увеличивает количество файлов больших двоичных объектов базы данных в базовой архитектуре хранилища данных.  Чтобы получить максимальный прирост производительности от этого преимущества, рекомендуется перестроить кластеризованные индексы columnstore с помощью приведенного ниже сценария.  Этот сценарий принудительно переносит некоторые данные в дополнительные большие двоичные объекты.  Если не предпринимать никаких действий, данные со временем будут естественным образом перераспределены по мере загрузки данных в таблицы хранилища данных.

**Предварительные требования**

1. Хранилище данных должно располагать 1000 DWU или больше (см. раздел [Масштабирование вычислительных ресурсов][scale compute power]).
2. Пользователь, выполняющий скрипт, должен быть участником [роли mediumrc][mediumrc role] или роли более высокого уровня.
   1. Чтобы добавить пользователя в эту роль, выполните следующую команду:
      1. ````EXEC sp_addrolemember 'xlargerc', 'MyUser'````

````sql
-------------------------------------------------------------------------------
-- Step 1: Create Table to control Index Rebuild
-- Run as user in mediumrc or higher
--------------------------------------------------------------------------------
create table sql_statements
WITH (distribution = round_robin)
as select
    'alter index all on ' + s.name + '.' + t.NAME + ' rebuild;' as statement,
    row_number() over (order by s.name, t.name) as sequence
from
    sys.schemas s
    inner join sys.tables t
        on s.schema_id = t.schema_id
where
    is_external = 0
;
go

--------------------------------------------------------------------------------
-- Step 2: Execute Index Rebuilds.  If script fails, the below can be rerun to restart where last left off
-- Run as user in mediumrc or higher
--------------------------------------------------------------------------------

declare @nbr_statements int = (select count(*) from sql_statements)
declare @i int = 1
while(@i <= @nbr_statements)
begin
      declare @statement nvarchar(1000)= (select statement from sql_statements where sequence = @i)
      print cast(getdate() as nvarchar(1000)) + ' Executing... ' + @statement
      exec (@statement)
      delete from sql_statements where sequence = @i
      set @i += 1
end;
go
-------------------------------------------------------------------------------
-- Step 3: Cleanup Table Created in Step 1
--------------------------------------------------------------------------------
drop table sql_statements;
go
````

Если возникнут проблемы с хранилищем данных, [создайте запрос в службу поддержки][create a support ticket] и укажите "Перенос в хранилище класса Premium" в качестве возможной причины.

<!--Image references-->

<!--Article references-->
[automatic migration schedule]: #automatic-migration-schedule
[self-migration to Premium Storage]: #self-migration-to-premium-storage
[create a support ticket]: sql-data-warehouse-get-started-create-support-ticket.md
[Azure paired region]: best-practices-availability-paired-regions.md
[main documentation site]: services/sql-data-warehouse.md
[Pause]: sql-data-warehouse-manage-compute-portal.md#pause-compute
[Restore]: sql-data-warehouse-restore-database-portal.md
[steps to rename during migration]: #optional-steps-to-rename-during-migration
[scale compute power]: sql-data-warehouse-manage-compute-portal.md#scale-compute-power
[mediumrc role]: sql-data-warehouse-develop-concurrency.md

<!--MSDN references-->


<!--Other Web references-->
[Premium Storage for greater performance predictability]: https://azure.microsoft.com/en-us/blog/azure-sql-data-warehouse-introduces-premium-storage-for-greater-performance/
[Azure Portal]: https://portal.azure.com



<!--HONumber=Nov16_HO5-->


