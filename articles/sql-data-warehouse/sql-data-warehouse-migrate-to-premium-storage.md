<properties
   pageTitle="Перенос существующего хранилища данных SQL Azure в хранилище уровня ";Премиум"; | Microsoft Azure"
   description="Инструкции по переносу существующего хранилища данных SQL в хранилище уровня ";Премиум";."
   services="sql-data-warehouse"
   documentationCenter="NA"
   authors="happynicolle"
   manager="barbkess"
   editor=""/>

<tags
   ms.service="sql-data-warehouse"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services"
   ms.date="08/19/2016"
   ms.author="nicw;barbkess;sonyama"/>

# Сведения о миграции в хранилище класса Premium
В хранилище данных SQL недавно введена возможность использования [хранилища класса Premium, обеспечивающего более предсказуемую производительность][]. Теперь мы можем переместить хранилища данных, расположенные в стандартном хранилище, в хранилище класса Premium. В этой статье содержатся сведения о том, как и когда происходит автоматический перенос и как выполнить перенос самостоятельно, если вы предпочитаете управлять простоем.

Если у вас есть несколько хранилищ данных, используйте приведенное ниже [расписание автоматического переноса][], чтобы определить время их переноса.

## Определение типа хранилища
Если вы создали хранилище данных ранее приведенных ниже дат, то в настоящий момент вы используете стандартное хранилище. Для каждого хранилища данных в хранилище уровня "Стандартный", которое будет автоматически перенесено, на [портале Azure][] в верхней части колонки "Хранилище данных" отображается извещение "* Предстоящее обновление хранилища до класса премиум приведет к простою. Дополнительные сведения ->*".

| **Регион** | **Хранилище данных, созданное до указанной даты** |
| :------------------ | :-------------------------------- |
| Восточная часть Австралии | Хранилище класса Premium пока недоступно |
| Юго-Восточная часть Австралии | 5 августа 2016 г. |
| Южная часть Бразилии | 5 августа 2016 г. |
| Центральная Канада | 25 мая 2016 г. |
| Восточная Канада | 26 мая 2016 г. |
| Центральный регион США | 26 мая 2016 г. |
| Восток Китая | Хранилище класса Premium пока недоступно |
| Север Китая | Хранилище класса Premium пока недоступно |
| Восточная Азия | 25 мая 2016 г. |
| Восток США | 26 мая 2016 г. |
| Восток США 2 | 27 мая 2016 г. |
| Центральная Индия | 27 мая 2016 г. |
| Южная Индия | 26 мая 2016 г. |
| Западная Индия | Хранилище класса Premium пока недоступно |
| Восточная часть Японии | 5 августа 2016 г. |
| Западная часть Японии | Хранилище класса Premium пока недоступно |
| Северо-центральный регион США | Хранилище класса Premium пока недоступно |
| Северная Европа | 5 августа 2016 г. |
| Южно-центральный регион США | 27 мая 2016 г. |
| Юго-Восточная Азия | 24 мая 2016 г. |
| Западная Европа | 25 мая 2016 г. |
| Западно-центральная часть США | Хранилище класса Premium пока недоступно |
| Запад США | 26 мая 2016 г. |
| Западная часть США 2 | Хранилище класса Premium пока недоступно |

## Сведения об автоматической миграции
По умолчанию база данных будет перенесена автоматически в период с 18:00 до 06:00 по местному времени соответствующего региона в рамках [расписания автоматического переноса][], приведенного ниже. Во время переноса имеющееся хранилище данных использовать нельзя. По нашим оценкам, для миграции 1 ТБ емкости хранилища данных требуется около 1 часа. Мы также гарантируем, что в процессе автоматического переноса независимо от этапа плата не взимается.

> [AZURE.NOTE] Вы не сможете использовать имеющееся хранилище данных во время миграции. По завершении миграции оно снова переходит в оперативный режим.

Ниже приведены шаги, которые корпорация Майкрософт выполняет от вашего имени, чтобы осуществить миграцию без вашего вмешательства. В данном примере имеющемуся хранилищу данных в хранилище уровня "Стандартный" присвоено имя MyDW.

1.	Корпорация Майкрософт переименовывает MyDW в MyDW\_DO\_NOT\_USE\_[метка\_времени].
2.	Корпорация Майкрософт приостанавливает MyDW\_DO\_NOT\_USE\_[метка\_времени]. В это время создается резервная копия. Этот процесс может быть несколько раз приостановлен и возобновлен, если во время него возникнут проблемы.
3.	Корпорация Майкрософт создает новое хранилище данных MyDW в хранилище уровня "Премиум", используя резервную копию, созданную на шаге 2. Хранилище MyDW не будет отображаться до завершения восстановления.
4.	По завершении восстановления хранилище MyDW вернется к прежнему уровню единиц DWU и состоянию (приостановлено или активно), в котором оно пребывало до переноса.
5.	По завершении миграции корпорация Майкрософт удалит MyDW\_DO\_NOT\_USE\_[метка\_времени].
	
> [AZURE.NOTE] Не переносятся следующие параметры:
> 
>	-  Auditing at the Database level needs to be re-enabled
>	-  Firewall rules at the **Database** level need to be readded.  Firewall rules at the **Server** level are not be impacted.

### Расписание автоматической миграции
Автоматический перенос осуществляется в период с 18:00 до 06:00 по местному времени соответствующего региона согласно приведенному ниже расписанию простоев.

| **Регион** | **Предполагаемая дата начала** | **Предполагаемая дата окончания** |
| :------------------ | :--------------------------- | :--------------------------- |
| Восточная часть Австралии | Еще не определено | Еще не определено |
| Юго-Восточная часть Австралии | 10 августа 2016 г. | 24 августа 2016 г. |
| Южная часть Бразилии | 10 августа 2016 г. | 24 августа 2016 г. |
| Центральная Канада | 23 июня 2016 г. | 1 июля 2016 г. |
| Восточная Канада | 23 июня 2016 г. | 1 июля 2016 г. |
| Центральный регион США | 23 июня 2016 г. | 4 июля 2016 г. |
| Восток Китая | Еще не определено | Еще не определено |
| Север Китая | Еще не определено | Еще не определено |
| Восточная Азия | 23 июня 2016 г. | 1 июля 2016 г. |
| Восток США | 23 июня 2016 г. | 11 июля 2016 г. |
| Восток США 2 | 23 июня 2016 г. | 8 июля 2016 г. |
| Центральная Индия | 23 июня 2016 г. | 1 июля 2016 г. |
| Южная Индия | 23 июня 2016 г. | 1 июля 2016 г. |
| Западная Индия | Еще не определено | Еще не определено |
| Восточная часть Японии | 10 августа 2016 г. | 24 августа 2016 г. |
| Западная часть Японии | Еще не определено | Еще не определено |
| Северо-центральный регион США | Еще не определено | Еще не определено |
| Северная Европа | 10 августа 2016 г. | 31 августа 2016 г. |
| Южно-центральный регион США | 23 июня 2016 г. | 2 июля 2016 г. |
| Юго-Восточная Азия | 23 июня 2016 г. | 1 июля 2016 г. |
| Западная Европа | 23 июня 2016 г. | 8 июля 2016 г. |
| Западно-центральная часть США | 14 августа 2016 г. | 31 августа 2016 г. |
| Запад США | 23 июня 2016 г. | 7 июля 2016 г. |
| Западная часть США 2 | 14 августа 2016 г. | 31 августа 2016 г. |

## Самостоятельная миграция в хранилище класса Premium
Если вы хотите управлять временем простоя, то можно выполнить приведенные ниже шаги, чтобы перенести существующее хранилище данных из хранилища уровня "Стандартный" в хранилище уровня "Премиум". Если вы решили выполнить миграцию самостоятельно, то это необходимо сделать до начала автоматической миграции в соответствующем регионе. Так вы избежите риска конфликтов (см. раздел [Расписание автоматической миграции][]).

### Инструкции по самостоятельной миграции
Если вы хотите управлять простоем, то самостоятельно перенести хранилище данных можно с помощью резервного копирования и восстановления. Предполагается, что для этапа восстановления при переносе требуется около 1 часа на 1 ТБ емкости хранилища данных. Если вы хотите сохранить то же имя по завершении переноса, следуйте описанным ниже указаниям, чтобы [выполнить переименование во время перенося][].

1.	[Приостановите работу][] хранилища данных для автоматической архивации.
2.	[Восстановите][] данные из последнего моментального снимка.
3.	Удалите имеющееся хранилище данных в стандартном хранилище. **Если не выполнить этот шаг, с вас будет взиматься плата за оба хранилища данных.**

> [AZURE.NOTE] Не переносятся следующие параметры:
> 
>	-  Auditing at the Database level needs to be re-enabled
>	-  Firewall rules at the **Database** level need to be readded.  Firewall rules at the **Server** level are not be impacted.

#### Необязательно: действия для переименования во время миграции 
У двух баз данных на одном логическом сервере не может быть одинаковое имя. В настоящее время в хранилище данных SQL поддерживается возможность переименования хранилища данных.

В данном примере имеющемуся хранилищу данных в хранилище уровня "Стандартный" присвоено имя MyDW.

1.	С помощью приведенной ниже команды ALTER DATABASE переименуйте MyDW, например, в MyDW\_BeforeMigration. Эта команда завершит все существующие транзакции, и она должна быть выполнена в базе данных master.
```
ALTER DATABASE CurrentDatabasename MODIFY NAME = NewDatabaseName;
```
2.	[Приостановите работу][] MyDW\_BeforeMigration для автоматической архивации.
3.	[Восстановите][] новую базу данных с прежним именем (например, MyDW) из последнего моментального снимка.
4.	Удалите хранилище данных MyDW\_BeforeMigration. **Если не выполнить этот шаг, с вас будет взиматься плата за оба хранилища данных.**

> [AZURE.NOTE] Не переносятся следующие параметры:
> 
>	-  Auditing at the Database level needs to be re-enabled
>	-  Firewall rules at the **Database** level need to be readded.  Firewall rules at the **Server** level are not be impacted.

## Дальнейшие действия
Это изменение в хранилище класса Premium также увеличивает количество файлов больших двоичных объектов базы данных в базовой архитектуре хранилища данных. При появлении проблем с производительностью рекомендуется перестроить кластеризованные индексы columnstore с помощью приведенного ниже сценария. Этот сценарий принудительно переносит некоторые данные в дополнительные большие двоичные объекты. Если не предпринимать никаких действий, данные со временем будут естественным образом перераспределены по мере загрузки данных в таблицы хранилища данных.

**Предварительные требования**

1.	Хранилище данных должно располагать 1000 DWU или больше (см. информацию о [масштабировании вычислительной мощности][]).
2.	Пользователь, выполняющий сценарий, должен быть участником [роли mediumrc][] или выше.
	1.	Чтобы добавить пользователя в эту роль, выполните следующую команду:
		1.	.````EXEC sp_addrolemember 'xlargerc', 'MyUser'````

````sql
-------------------------------------------------------------------------------
Шаг 1. Создание таблицы для управления перестроением индекса
Выполните сценарий ниже от имени пользователя в роли mediumrc или выше.
--------------------------------------------------------------------------------
create table sql\_statements WITH (distribution = round\_robin) as select 'alter index all on ' + s.name + '.' + t.NAME + ' rebuild;' as statement, row\_number() over (order by s.name, t.name) as sequence from sys.schemas s inner join sys.tables t on s.schema\_id = t.schema\_id where is\_external = 0 ; go
 
--------------------------------------------------------------------------------
Шаг 2. Перестроение индекса В случае сбоя сценария код ниже может быть повторно запущен с места остановки.
Выполните сценарий ниже от имени пользователя в роли mediumrc или выше.
--------------------------------------------------------------------------------

declare @nbr\_statements int = (select count(*) from sql\_statements) declare @i int = 1 while(@i <= @nbr\_statements) begin declare @statement nvarchar(1000)= (select statement from sql\_statements where sequence = @i) print cast(getdate() as nvarchar(1000)) + ' Executing... ' + @statement exec (@statement) delete from sql\_statements where sequence = @i set @i += 1 end;
go
-------------------------------------------------------------------------------
Шаг 3. Очистка таблицы, созданной на шаге 1
--------------------------------------------------------------------------------
drop table sql\_statements; go ````

Если возникнут проблемы с хранилищем данных, [создайте запрос в службу поддержки][] и укажите "Перенос в хранилище уровня "Премиум"" в качестве возможной причины.

.<!--Image references-->

.<!--Article references-->
[Расписание автоматической миграции]: #automatic-migration-schedule
[расписание автоматического переноса]: #automatic-migration-schedule
[расписания автоматического переноса]: #automatic-migration-schedule
[self-migration to Premium Storage]: #self-migration-to-premium-storage
[создайте запрос в службу поддержки]: sql-data-warehouse-get-started-create-support-ticket.md
[Azure paired region]: best-practices-availability-paired-regions.md
[main documentation site]: services/sql-data-warehouse.md
[Приостановите работу]: sql-data-warehouse-manage-compute-portal.md/#pause-compute
[Восстановите]: sql-data-warehouse-restore-database-portal.md
[выполнить переименование во время перенося]: #optional-steps-to-rename-during-migration
[масштабировании вычислительной мощности]: sql-data-warehouse-manage-compute-portal/#scale-compute-power
[роли mediumrc]: sql-data-warehouse-develop-concurrency/#workload-management

.<!--MSDN references-->


<!--Other Web references-->
[хранилища класса Premium, обеспечивающего более предсказуемую производительность]: https://azure.microsoft.com/blog/azure-sql-data-warehouse-introduces-premium-storage-for-greater-performance/
[портале Azure]: https://portal.azure.com

<!---HONumber=AcomDC_0824_2016-->