<properties
   pageTitle="Загрузка данных из SQL Server в хранилище данных SQL Azure (PolyBase) | Microsoft Azure"
   description="Экспорт данных из SQL Server в неструктурированные файлы, AZCopy, а также импорт данных в хранилище BLOB-объектов Azure и PolyBase для приема данных в хранилище данных SQL Azure с помощью программы bcp."
   services="sql-data-warehouse"
   documentationCenter="NA"
   authors="lodipalm"
   manager="barbkess"
   editor=""/>

<tags
   ms.service="sql-data-warehouse"
   ms.devlang="NA"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services"
   ms.date="06/30/2016"
   ms.author="lodipalm;barbkess;sonyama"/>


# Загрузка данных из SQL Server в хранилище данных SQL Azure (AZCopy)

Для загрузки данных из SQL Server в хранилище BLOB-объектов Azure следует использовать служебные программы командной строки bcp и AZCopy. Затем для загрузки данных в хранилище данных SQL Azure используйте PolyBase или фабрику данных Azure.


## Предварительные требования

Для выполнения этих действий необходимо иметь следующее:

- База данных хранилища данных SQL
- Установленная служебная программа командной строки bcp
- Установленная служебная программа командной строки SQLCMD.

>[AZURE.NOTE] Вы можете загрузить служебные программы bcp и sqlcmd в [Центре загрузки Майкрософт][].

## Импорт данных в хранилище данных SQL

Работая с этим учебником, вы создадите таблицу в хранилище данных SQL Azure и импортируете в нее данные.

### Шаг 1. Создание таблицы в хранилище данных SQL Azure

В командной строке выполните следующий запрос, чтобы создать таблицу для экземпляра с помощью sqlcmd:

```sql
sqlcmd.exe -S <server name> -d <database name> -U <username> -P <password> -I -Q "
    CREATE TABLE DimDate2
    (
        DateId INT NOT NULL,
        CalendarQuarter TINYINT NOT NULL,
        FiscalQuarter TINYINT NOT NULL
    )
    WITH
    (
        CLUSTERED COLUMNSTORE INDEX,
        DISTRIBUTION = ROUND_ROBIN
    );
"
```

>[AZURE.NOTE] Дополнительные сведения о создании таблицы в хранилище данных SQL и параметрах, доступных в предложении WITH, см. в статьях, посвященных [таблицам в хранилище данных SQL][] и [синтаксису инструкции CREATE TABLE][].

### Шаг 2. Создание файла источника данных

Откройте блокнот и скопируйте следующие строки данных в новый текстовый файл, а затем сохраните этот файл в локальный временный каталог (C:\\Temp\\DimDate2.txt).

```
20150301,1,3
20150501,2,4
20151001,4,2
20150201,1,3
20151201,4,2
20150801,3,1
20150601,2,4
20151101,4,2
20150401,2,4
20150701,3,1
20150901,3,1
20150101,1,3
```

> [AZURE.NOTE] Важно помнить, что bcp.exe не поддерживает кодировку UTF-8. Используйте файлы в кодировке ASCII или UTF-16 для файлов при работе со средством bcp.exe.

### Шаг 3. Подключение и импорт данных
С помощью программы bcp подключитесь и импортируйте данные, для чего замените в следующей команде значения соответствующим образом.

```sql
bcp DimDate2 in C:\Temp\DimDate2.txt -S <Server Name> -d <Database Name> -U <Username> -P <password> -q -c -t  ','
```

Вы можете убедиться, что данные загружены, выполнив следующий запрос с помощью sqlcmd:

```sql
sqlcmd.exe -S <server name> -d <database name> -U <username> -P <password> -I -Q "SELECT * FROM DimDate2 ORDER BY 1;"
```

Вы получите следующие результаты:

DateId |CalendarQuarter |FiscalQuarter
----------- |--------------- |-------------
20150101 |1 |3
20150201 |1 |3
20150301 |1 |3
20150401 |2 |4\.
20150501 |2 |4\.
20150601 |2 |4\.
20150701 |3 |1
20150801 |3 |1
20150801 |3 |1
20151001 |4\. |2
20151101 |4\. |2
20151201 |4\. |2

### Шаг 4. Создание статистики для вновь загруженных данных

Хранилище данных SQL Azure пока не поддерживает автоматическое создание или автоматическое обновление статистики. Чтобы добиться максимально высокой производительности запросов, крайне важно сформировать статистические данные для всех столбцов всех таблиц после первой загрузки или после любых значительных изменений в данных. Подробные сведения о работе со статистикой см. в разделе [Статистика][] из группы разделов по разработке. Ниже приведен краткий пример создания статистики по табличным данным, загруженным в этом примере.

Выполните следующие операторы CREATE STATISTICS из командной строки sqlcmd:

```sql
sqlcmd.exe -S <server name> -d <database name> -U <username> -P <password> -I -Q "
    create statistics [DateId] on [DimDate2] ([DateId]);
    create statistics [CalendarQuarter] on [DimDate2] ([CalendarQuarter]);
    create statistics [FiscalQuarter] on [DimDate2] ([FiscalQuarter]);
"
```

## Экспорт данных из хранилища данных SQL
Работая с этим учебником, вы создадите файл данных из таблицы, находящейся в хранилище данных SQL. Созданные данные будут экспортированы в новый файл данных DimDate2\_export.txt.

### Шаг 1. Экспорт данных

С помощью программы bcp подключитесь и экспортируйте данные, для чего замените в следующей команде значения соответствующим образом.

```sql
bcp DimDate2 out C:\Temp\DimDate2_export.txt -S <Server Name> -d <Database Name> -U <Username> -P <password> -q -c -t ','
```
Убедитесь, что данные экспортированы, открыв новый файл. Данные в файле должны совпадать с приведенным далее текстом:

```
20150301,1,3
20150501,2,4
20151001,4,2
20150201,1,3
20151201,4,2
20150801,3,1
20150601,2,4
20151101,4,2
20150401,2,4
20150701,3,1
20150901,3,1
20150101,1,3
```

>[AZURE.NOTE] Из-за особенностей распределенных систем порядок данных, взятых из разных баз данных хранилища данных SQL, может не совпадать. Другой вариант — вместо того чтобы экспортировать всю таблицу, вы можете использовать в bcp функцию **queryout**, чтобы создать запрос на извлечение.

## Дальнейшие действия
Общие сведения о загрузке см. в разделе [Загрузка данных в хранилище данных SQL][]. Дополнительные советы по разработке см. в разделе [Общие сведения о разработке для хранилища данных SQL][].

<!--Image references-->

<!--Article references-->

[Загрузка данных в хранилище данных SQL]: ./sql-data-warehouse-overview-load.md
[Общие сведения о разработке для хранилища данных SQL]: ./sql-data-warehouse-overview-develop.md
[таблицам в хранилище данных SQL]: ./sql-data-warehouse-tables-overview.md
[Статистика]: ./sql-data-warehouse-tables-statistics.md

<!--MSDN references-->
[bcp]: https://msdn.microsoft.com/library/ms162802.aspx
[синтаксису инструкции CREATE TABLE]: https://msdn.microsoft.com/library/mt203953.aspx

<!--Other Web references-->
[Центре загрузки Майкрософт]: https://www.microsoft.com/download/details.aspx?id=36433

<!---HONumber=AcomDC_0706_2016-->