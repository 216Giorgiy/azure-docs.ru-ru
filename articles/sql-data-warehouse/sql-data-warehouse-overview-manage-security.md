<properties
   pageTitle="Защита базы данных в хранилище данных SQL | Microsoft Azure"
   description="Советы по защите базы данных в хранилище данных SQL для разработки решений."
   services="sql-data-warehouse"
   documentationCenter="NA"
   authors="ronortloff"
   manager="barbkess"
   editor=""/>

<tags
   ms.service="sql-data-warehouse"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services"
   ms.date="05/18/2016"
   ms.author="rortloff;barbkess;sonyama"/>

# Защита базы данных в хранилище данных SQL

В этой статье рассматриваются основы защиты базы данных в хранилище данных SQL. В частности, эта статья содержит инструкции по началу работы с ресурсами для ограничения доступа, защиты данных и мониторинга действий с базой данных.

## Безопасность подключения

Под безопасностью подключения подразумеваются способы ограничения и защиты подключений к базе данных с помощью правил брандмауэра и шифрования подключения.

Правила брандмауэра используются как сервером, так и базой данных для отклонения попыток подключиться с IP-адресов, которые не были явно включены в белый список. Чтобы разрешить подключение из вашего приложения или с клиентского компьютера с общедоступным IP-адресом, сначала необходимо создать правило брандмауэра уровня сервера. Для этого воспользуйтесь классическим порталом Azure, API REST или PowerShell. В брандмауэре сервера рекомендуется максимально ограничить диапазоны разрешенных IP-адресов. Для доступа к хранилищу данных SQL Azure с локального компьютера убедитесь, что брандмауэр сети и локального компьютера разрешает исходящие подключения по TCP-порту 1433. Дополнительные сведения см. в статье [Брандмауэр Базы данных SQL Azure][].

Подключения к хранилищу данных SQL могут шифроваться. Для этого нужно задать режим шифрования в строке подключения. Синтаксис включения шифрования для подключения зависит от протокола. Чтобы настроить строку подключения, перейдите к своей базе данных на портале Azure. В разделе *Основные компоненты* щелкните *Показать строки подключения к базе данных*.


## Аутентификация

В процессе аутентификации предлагается подтвердить личность пользователя при подключении к базе данных. Сейчас хранилище данных SQL поддерживает проверку подлинности SQL с использованием имени пользователя и пароля, а также предварительную версию Azure Active Directory.

При создании логического сервера для базы данных вы указали имя для входа "Администратор сервера" и пароль. Используя эти учетные данные, можно выполнить проверку подлинности SQL Server для любой базы данных на этом сервере в качестве владельца базы данных (или dbo).

Но рекомендуется, чтобы пользователи вашей организации использовали для проверки подлинности другую учетную запись. Это позволит ограничить разрешения, предоставляемые приложению, и снизить риски вредоносных действий в случае, если приложение уязвимо для атак путем внедрения кода SQL.

Чтобы создать пользователя, прошедшего проверку SQL Server, подключитесь к базе данных **master** на сервере с именем администратора сервера и создайте новое имя входа на сервер.

```sql
-- Connect to master database and create a login
CREATE LOGIN ApplicationLogin WITH PASSWORD = 'strong_password';

```

Затем подключитесь к **БД хранилища данных SQL** с именем администратора сервера и создайте пользователя БД на основании только что созданного имени входа на сервер.

```sql
-- Connect to SQL DW database and create a database user
CREATE USER ApplicationUser FOR LOGIN ApplicationLogin;

```

Дополнительные сведения о проверке подлинности в Базе данных SQL см. в статье [Управление базами данных и именами пользователей в базе данных SQL Azure][]. Дополнительные сведения об использовании предварительной версии Azure AD для хранилища данных SQL см. в статье [Connecting to SQL Data Warehouse By Using Azure Active Directory Authentication][] (Подключение к хранилищу данных SQL с использованием проверки подлинности Azure Active Directory).


## Авторизация

Авторизация подразумевает набор действий, которые можно выполнять в базе данных хранилища SQL Azure. Этот набор действий определяют разрешения учетной записи пользователя и присвоенные ей роли. Обычно пользователям рекомендуется предоставлять наименьшие необходимые привилегии. Хранилищем данных SQL Azure можно легко управлять с использованием ролей в T-SQL.

```sql
EXEC sp_addrolemember 'db_datareader', 'ApplicationUser'; -- allows ApplicationUser to read data
EXEC sp_addrolemember 'db_datawriter', 'ApplicationUser'; -- allows ApplicationUser to write data
```

Учетной записи администратора сервера, которая используется для подключения, присвоена роль db\_owner, обладатель которой может выполнять любые действия в базе данных. Сохраните эту учетную запись для развертывания обновлений схемы и выполнения других действий по управлению. Для подключения к базе данных из приложения с использованием наименьших привилегий, необходимых приложению, используйте учетную запись "ApplicationUser" с более ограниченными разрешениями.

Существуют способы еще больше ограничить действия пользователя с Базой данных SQL Azure.

- Детальная настройка [разрешений][] позволяет указать операции, которые можно выполнять с отдельными столбцами, таблицами, представлениями, процедурами и другими объектами в базе данных. Используйте детализированные разрешения для обеспечения наивысшего уровня контроля и предоставления минимальных необходимых разрешений. Система детализированных разрешений является довольно сложной, поэтому для ее эффективного использования потребуется пройти дополнительное обучение.
- Для создания учетных записей пользователей приложения с более широкими возможностями или учетных записей для управления с меньшим набором возможностей можно использовать [роли базы данных][], отличные от db\_datareader и db\_datawriter. С помощью встроенных фиксированных ролей базы данных можно легко присваивать разрешения, однако это может привести к предоставлению лишних разрешений.
- Чтобы ограничить действия, которые можно выполнять в базе данных, можно использовать [хранимые процедуры][].

Управление базами данных и логическими серверами на классическом портале Azure или с помощью API-интерфейса диспетчера ресурсов Azure контролируется путем назначения ролей для учетной записи пользователя портала. Дополнительные сведения об этом см. в разделе [Контроль доступа на основе ролей на портале Azure][].

## Шифрование

Хранилище данных SQL Azure поможет защитить ваши данные путем их шифрования, когда они находятся в неактивном состоянии или хранятся в файлах базы данных и ее резервных копиях, используя [прозрачное шифрование данных][]. Включить прозрачное шифрование данных может администратор или член роли dbmanager в базе данных master. Чтобы зашифровать базу данных, подключитесь к главной базе данных на сервере и выполните следующий код:


```sql

ALTER DATABASE [AdventureWorks] SET ENCRYPTION ON;

```

Прозрачное шифрование данных также можно включить из параметров базы данных на [портале Azure][]. Дополнительные сведения см. в статье [Начало работы с прозрачным шифрованием данных (TDE)][].

## Аудит

Аудит и отслеживание событий базы данных может помочь в постоянном обеспечении соответствия нормативным требованиям и обнаружении подозрительных действий. Аудит хранилища данных SQL позволяет фиксировать события, происходящие в базе данных, в журнале аудита в вашей учетной записи хранения Azure. Кроме того, благодаря интеграции аудита хранилища данных SQL с Microsoft Power BI обеспечиваются упрощенное создание подробных отчетов и проведение детализированного анализа. Дополнительные сведения см. в статье [Приступая к работе с аудитом Базы данных SQL][].

## Дальнейшие действия
Дополнительные сведения и примеры подключения к хранилищу данных SQL с различными протоколами см. в статье [Подключение к хранилищу данных SQL][].

<!--Image references-->

<!--Article references-->
[Подключение к хранилищу данных SQL]: ./sql-data-warehouse-develop-connections.md
[Приступая к работе с аудитом Базы данных SQL]: ./sql-data-warehouse-overview-auditing.md
[Начало работы с прозрачным шифрованием данных (TDE)]: ./sql-data-warehouse-encryption-tde.md
[Connecting to SQL Data Warehouse By Using Azure Active Directory Authentication]: ./sql-data-warehouse-aad-authentication.md

<!--MSDN references-->
[Брандмауэр Базы данных SQL Azure]: https://msdn.microsoft.com/library/ee621782.aspx
[роли базы данных]: https://msdn.microsoft.com/library/ms189121.aspx
[Управление базами данных и именами пользователей в базе данных SQL Azure]: https://msdn.microsoft.com/library/ee336235.aspx
[разрешений]: https://msdn.microsoft.com/library/ms191291.aspx
[хранимые процедуры]: https://msdn.microsoft.com/library/ms190782.aspx
[прозрачное шифрование данных]: https://go.microsoft.com/fwlink/?LinkId=526242
[портале Azure]: https://portal.azure.com/

<!--Other Web references-->
[Контроль доступа на основе ролей на портале Azure]: https://azure.microsoft.com/documentation/articles/role-based-access-control-configure

<!---HONumber=AcomDC_0525_2016-->