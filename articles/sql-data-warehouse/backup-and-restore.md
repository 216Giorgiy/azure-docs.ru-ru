---
title: 'Резервное копирование и восстановление в хранилище данных SQL Azure: моментальные снимки, геоизбыточные резервные копии | Документация Майкрософт'
description: Сведения о том, как работает резервное копирование и восстановление в хранилище данных SQL Azure. Резервные копии хранилища данных используются для восстановления хранилища данных до точки восстановления в основном регионе. Геоизбыточные резервные копии можно использовать для восстановления в другом географическом регионе.
services: sql-data-warehouse
author: kevinvngo
manager: craigg-msft
ms.service: sql-data-warehouse
ms.topic: conceptual
ms.component: manage
ms.date: 04/17/2018
ms.author: kevin
ms.reviewer: igorstan
ms.openlocfilehash: a4f24aad95f13315eaeac790c9006ca00f61af69
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
ms.locfileid: "32187605"
---
# <a name="backup-and-restore-in-azure-sql-data-warehouse"></a>Резервное копирование и восстановление в хранилище данных SQL Azure
Сведения о том, как работает резервное копирование и восстановление в хранилище данных SQL Azure. Резервные копии хранилища данных используются для восстановления хранилища данных до точки восстановления в основном регионе. Геоизбыточные резервные копии можно использовать для восстановления в другом географическом регионе. 

## <a name="what-is-backup-and-restore"></a>Что такое резервное копирование и восстановление?
*Резервная копия хранилища данных* — это копия базы данных, которую можно использовать для восстановления хранилища данных.  Так как хранилище данных SQL является распределенной системой, резервная копия хранилища данных состоит из множества файлов, которые размещаются в службе хранилища Azure. Резервная копия хранилища данных включает локальные моментальные снимки базы данных и геоархивы всех баз данных и файлов, связанных с хранилищем данных. 

*Восстановление хранилища данных* означает создание хранилища данных из резервной копии существующего или удаленного хранилища данных. Восстановленное хранилище данных воссоздает архивное хранилище данных на определенный момент времени. Восстановление хранилища данных является важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления, так как позволяет воссоздать данные после случайного повреждения или удаления.

В набор средств аварийного восстановления хранилища данных SQL входят как локальное восстановление, так и геовосстановление. 

## <a name="local-snapshot-backups"></a>Резервные копии локальных моментальных снимков
Резервные копии локальных моментальных снимков являются встроенной функцией службы.  Их не нужно специально включать. 

С помощью хранилища данных SQL в течение дня создаются моментальные снимки хранилища данных. Эти моментальные снимки доступны в течение семи дней. Хранилище данных SQL поддерживает восьмичасовую целевую точку восстановления (RPO). Вы можете восстановить хранилище данных в основном регионе до любого из моментальных снимков, доступных за последние семь дней.

Чтобы узнать, когда был создан последний моментальный снимок, выполните этот запрос к хранилищу данных SQL, подключенному к сети. 

```sql
select   top 1 *
from     sys.pdw_loader_backup_runs 
order by run_id desc
;
```

### <a name="snapshot-retention-when-a-data-warehouse-is-paused"></a>Срок хранения моментальных снимков, если приостановлена работа хранилища данных
Хранилище данных SQL не создает и не удаляет моментальные снимки по истечении периода хранения, пока работа хранилища данных приостановлена. Срок жизни моментальных снимков не изменяется, пока работа хранилища данных приостановлена. Срок хранения моментальных снимков соответствует количеству дней, в течение которых хранилище данных находится в оперативном режиме, а не количеству календарных дней.

Например, если моментальный снимок был сделан 1 октября в 16:00, а работа хранилища данных приостановлена 3 октября в 16:00, длительность хранения этого моментального снимка составляет не более двух дней. Когда хранилище данных снова перейдет в оперативный режим, длительность хранения моментального снимка на этот момент будет составлять два дня. Если хранилище данных возобновит работу 5 октября в 16:00, двухдневный моментальный снимок будет храниться еще пять дней.

Когда хранилище данных снова перейдет в оперативный режим, хранилище данных SQL возобновит создание новых моментальных снимков и удаление снимков со сроком хранения более семи дней.

### <a name="snapshot-retention-when-a-data-warehouse-is-dropped"></a>Срок хранения моментальных снимков при удалении хранилища данных
При удалении хранилища данных с помощью хранилища данных SQL создается конечный моментальный снимок, который хранится в течение семи дней. Вы можете восстановить хранилище данных до последней точки восстановления, созданной при удалении. 

> [!IMPORTANT]
> Когда вы удаляете экземпляр логического сервера SQL Server, все относящиеся к этому экземпляру базы данных также удаляются без возможности восстановления. Удаленный сервер восстановить невозможно.
> 

## <a name="geo-backups"></a>Геоархивы
Хранилище данных SQL выполняет геоархивацию один раз в день в [сопряженный центр обработки данных](../best-practices-availability-paired-regions.md). Целевая точка восстановления для геовосстановления составляет 24 часа. Можно восстановить геоархив на сервер в любом другом регионе, в котором поддерживается хранилище данных SQL. Геоархивация гарантирует, что вы сможете восстановить хранилище данных даже при отсутствии доступа к моментальным снимкам, размещенным в основном регионе.

Выполнение геоархивации задано по умолчанию. Если хранилище данных относится к поколению 1, при необходимости вы можете [отказаться](/powershell/module/azurerm.sql/set-azurermsqldatabasegeobackuppolicy) этой функции. Вы не можете отказаться от создания геоархивов для поколения 2, так как защита данных является его неотъемлемой гарантией.

## <a name="backup-costs"></a>Оплата резервного копирования
Можно заметить, что в счете на оплату Azure содержится строка для хранилища Azure класса Premium и геоизбыточного хранилища. Плата за использование хранилища класса Premium представляет собой общую стоимость хранения данных в основном регионе, в котором также хранятся моментальные снимки.  Плата за использование геоизбыточного хранилища охватывает стоимость хранения геоархивов.  

Общая стоимость основного хранилища данных и моментальных снимков больших двоичных объектов Azure за последние семь дней округляется до ближайшего терабайта. Например, если объем хранилища данных составляет 1,5 ТБ, а под моментальные снимки задействовано 100 ГБ, плата взимается за 2 ТБ данных по тарифам хранилища Azure класса Premium. 

> [!NOTE]
> Все моментальные снимки изначально пустые, их размер увеличивается по мере внесения изменений в основное хранилище данных. Размер всех моментальных снимков увеличивается по мере внесения изменений в хранилище данных. Таким образом, стоимость хранения моментальных снимков увеличивается пропорционально внесенным изменениям.
> 
> 

При использовании геоизбыточного хранилища плата за хранилище взимается отдельно. Геоизбыточное хранилище оплачивается по стандартному тарифу для географически избыточного хранилища с доступом на чтение (RA-GRS).

Ознакомиться с ценами на хранилище данных SQL можно [здесь](https://azure.microsoft.com/pricing/details/sql-data-warehouse/).

## <a name="restoring-from-restore-points"></a>Восстановление из точек восстановления
У каждого моментального снимка есть точка восстановления, которая представляет время начала создания моментального снимка. Для восстановления хранилища данных следует выбрать точку восстановления и выполнить команду restore.  

При восстановлении в хранилище данных SQL всегда создается новое хранилище данных из резервной копии. Можно сохранить восстановленное и текущее хранилища данных либо удалить один из них. Если необходимо заменить текущее хранилище данных восстанавливаемым, его можно переименовать с помощью инструкции [ALTER DATABASE (хранилище данных SQL Azure)](/sql/t-sql/statements/alter-database-azure-sql-data-warehouse) с параметром MODIFY NAME. 

Чтобы восстановить хранилище данных, см. статьи [Восстановления хранилища данных с помощью портала Azure](sql-data-warehouse-restore-database-portal.md), [Восстановление хранилища данных с помощью PowerShell](sql-data-warehouse-restore-database-powershell.md) или [Восстановление хранилища данных с помощью T-SQL](sql-data-warehouse-restore-database-rest-api.md).

Чтобы восстановить удаленное или приостановленное хранилище данных, вы можете [создать запрос в службу поддержки](sql-data-warehouse-get-started-create-support-ticket.md). 


## <a name="geo-redundant-restore"></a>Геоизбыточное восстановление
Хранилище данных можно восстановить в любой регион, поддерживающий хранилище данных SQL Azure выбранного вами уровня производительности. 

> [!NOTE]
> Чтобы выполнить географически избыточное восстановление, необходимо отказаться от этой функции.
> 
> 

## <a name="restore-timeline"></a>Временная шкала восстановления
Вы можете восстановить базу данных до любой точки восстановления за последние семь дней. Моментальные снимки создаются каждые 4–8 часов и доступны в течение 7 дней. Если моментальный снимок старше семи дней, то срок его действия истекает и его точка восстановления перестает быть доступной. 

Резервное копирование не выполняется для приостановленного хранилища данных. Если хранилище данных приостановлено на более чем 7 дней, в нем не будет ни одной точки восстановления. 

## <a name="restore-costs"></a>Затраты на восстановление
Плата за хранилище для восстановленного хранилища данных взимается по расценкам службы хранилища Azure уровня "Премиум". 

Если хранилище данных приостанавливается, плата за хранилище взимается по расценкам хранилища Azure класса Premium. Преимущество приостановки заключается в том, что за вычислительные ресурсы плата не взимается.

Ознакомиться с ценами на хранилище данных SQL можно [здесь](https://azure.microsoft.com/pricing/details/sql-data-warehouse/).

## <a name="restore-use-cases"></a>Варианты использования восстановления
Основное назначение восстановления хранилища данных — восстановление данных после случайной потери или повреждения. Восстановление хранилища данных может также использоваться для хранения резервных копий дольше семи дней. После восстановления из резервной копии вы получаете хранилище данных в сети и можете приостановить его на неограниченное время для экономии вычислительных ресурсов. Хранение приостановленной базы данных оплачивается по расценкам службы хранилища Azure уровня "Премиум". 

## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения о планировании на случай аварий см. в [обзоре обеспечения непрерывности бизнес-процессов](../sql-database/sql-database-business-continuity.md)
