<properties
   pageTitle="Загрузка данных с помощью SQL Server Integration Services (SSIS) | Microsoft Azure"
   description="Здесь показано, как создать пакет служб SQL Server Integration Services (SSIS) для перемещения данных из разнообразных источников данных в хранилище данных SQL."
   services="sql-data-warehouse"
   documentationCenter="NA"
   authors="barbkess"
   manager="barbkess"
   editor=""/>

<tags
   ms.service="sql-data-warehouse"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services"
   ms.date="04/28/2016"
   ms.author="sonyama;barbkess"/>

# Загрузка данных с помощью SQL Server Integration Services (SSIS)

В этом руководстве показано, как создать пакет служб SQL Server Integration Services (SSIS) для перемещения данных из разнообразных источников данных в хранилище данных SQL. При желании вы можете изменить структуру данных, преобразовать и очистить их при прохождении через поток данных служб SSIS.

После изучения этого руководства вы будете знать, как выполнить следующие действия:

- создание нового проекта служб Integration Services в Visual Studio;
- подключение к источникам данных, в том числе SQL Server (в качестве источника) и хранилищу данных SQL (в качестве назначения);
- создание пакета служб SSIS, который загружает данные из источника в место назначения;
- запуск пакета служб SSIS для загрузки данных.

В этом руководстве в качестве источника данных используется SQL Server. SQL Server может выполняться на локальном компьютере или на виртуальной машине Azure.

## Основные понятия

Пакет — это единица работы в службах SSIS. Связанные пакеты группируются в проекты. Вы можете создавать проекты и разрабатывать пакеты с помощью SQL Server Data Tools для Visual Studio. Разработка выполняется в графическом интерфейсе, где вы перетаскиваете компоненты из области элементов в область конструктора, затем соединяете их и задаете их свойства. Когда пакет будет готов, вы можете развернуть его на SQL Server, который предоставляет широкие возможности для управления, мониторинга и защиты.

## Параметры для загрузки данных с помощью служб SSIS

SQL Server Integration Services (SSIS) — это гибкий набор средств, предоставляющий различные возможности для подключения к хранилищу данных SQL и загрузки данных в это хранилище.

1. Подключение к хранилищу данных SQL с использованием назначения ADO NET. В этом руководстве используется именно назначение ADO NET, так как у него меньше всего параметров конфигурации.
2. Подключение к хранилищу данных SQL с использованием назначения OLE DB. Этот вариант позволит немного повысить производительность по сравнению с назначением ADO NET.
3. Временное размещение данных в хранилище BLOB-объектов Azure с использованием задачи загрузки в большой двоичный объект Azure. После этого следует запустить задание SSIS Execute SQL, которое запускает сценарий Polybase для загрузки данных в хранилище данных SQL. Этот вариант обеспечивает наивысшую производительность из трех перечисленных вариантов. Чтобы использовать задачу загрузки BLOB-объекта Azure, необходимо загрузить [пакет дополнительных компонентов для служб Microsoft SQL Server 2016 Integration Services для Azure][]. Дополнительные сведения о Polybase см. в [руководстве по PolyBase][].

## Перед началом работы

Чтобы выполнить все этапы, описанные в этом руководстве, вам потребуется следующее.

1. **SQL Server Integration Services (SSIS)**. Службы SSIS — это компонент SQL Server. Для его использования требуется ознакомительная или лицензированная версия SQL Server. Получить ознакомительную версию SQL Server 2016 вы можете в разделе [ознакомительных версий SQL Server][].
2. **Visual Studio** Для получения бесплатного выпуска Visual Studio 2015 Community Edition перейдите на страницу [Visual Studio Community][].
3. **SQL Server Data Tools для Visual Studio (SSDT)**. SQL Server Data Tools для Visual Studio 2015 можно получить [на странице загрузки SQL Server Data Tools (SSDT)][].
4. **Образец данных**. В этом руководстве источником данных для загрузки в хранилище данных SQL является образец базы данных AdventureWorks на SQL Server. Получить образец базы данных AdventureWorks можно [здесь][].
5. **База данных хранилища данных SQL и разрешения на ее использование**. В этом руководстве мы будем подключаться к экземпляру хранилища данных SQL и загружать в него данные. Вам потребуются разрешения на создание таблицы и загрузку данных.
6. **Правило брандмауэра**. Вам следует создать правило брандмауэра в хранилище данных SQL, разрешающее обращения с IP-адреса локального компьютера. Без этого вы не сможете загрузить данные в хранилище данных SQL.

## Шаг 1. Создание нового проекта служб Integration Services

1. Запустите Visual Studio 2015.
2. В меню **Файл** выберите **Создать| Проект**.
3. Перейдите к типу проекта **Установленные | Шаблоны | Бизнес-аналитика | Службы Integration Services**.
4. Выберите **Проект служб Integration Services**. Введите значения для параметров **Имя** и **Расположение**, а затем нажмите кнопку **ОК**.

Visual Studio откроется и создаст новый проект служб Integration Services (SSIS). Затем Visual Studio откроет конструктор для одного нового пакета служб SSIS (Package.dtsx) в этом проекте. Вы увидите на экране следующие области.

- В левой части — область **Инструменты**, где представлены компоненты служб SSIS.
- В центре — область конструктора с несколькими вкладками. Из них вам потребуются по меньшей мере вкладки **Поток управления** и **Поток данных**.
- С правой стороны расположены области **Обозреватель решений** и **Свойства**.

    ![][01]

## Шаг 2: Создание простого потока данных

1. Перетащите задачу потока данных с панели инструментов в середину области конструктора (на вкладку **Поток управления**).

    ![][02]

2. Дважды щелкните задачу потока данных, чтобы перейти на вкладку "Поток данных".
3. Из списка других источников на панели инструментов перетащите в область конструктора источник ADO.NET. Пока еще выбран адаптер источника, измените его имя на **Источник SQL Server** в области **Свойства**.
4. Из списка других источников на панели инструментов перетащите в область конструктора назначение ADO.NET и поместите его под источником ADO.NET. Пока еще выбран адаптер назначения, измените его имя на **Назначение SQL DW** в области **Свойства**.

    ![][09]

## Шаг 3: Настройка адаптера источника

1. Дважды щелкните адаптер источника, чтобы открыть **редактор источника ADO.NET**.

    ![][03]

2. На вкладке **Диспетчер подключений** в **редакторе источника ADO.NET** нажмите кнопку **Создать** рядом со списком **Диспетчер подключений ADO.NET**. Откроется диалоговое окно **Настройка диспетчера подключений ADO.NET**, где нужно создать параметры подключения к базе данных SQL Server, из которой мы будем загружать данные в этом руководстве.

    ![][04]

3. В диалоговом окне **Настройка диспетчера подключений ADO.NET** нажмите кнопку **Создать**, чтобы открыть диалоговое окно **Диспетчер подключений** и создать новое подключение к данным.

    ![][05]

4. В диалоговом окне **Диспетчер подключений** выполните следующие действия.

    1. Для параметра **Поставщик** выберите поставщик данных SqlClient.
    2. В поле **Имя сервера** введите имя сервера SQL Server.
    3. В разделе **Вход на сервер** выберите или введите сведения для проверки подлинности.
    4. В разделе **Подключение к базе данных** выберите образец базы данных AdventureWorks.
    5. Нажмите кнопку **Проверить подключение**.
    
        ![][06]
    
    6. В диалоговом окне с результатами проверки подключения нажмите кнопку **ОК**, чтобы вернуться в диалоговое окно **Диспетчер подключений**.
    7. В диалоговом окне **Диспетчер подключений** нажмите кнопку **ОК**, чтобы вернуться в диалоговое окно **Настройка диспетчера подключений ADO.NET**.
 
5. В диалоговом окне **Настройка диспетчера подключений ADO.NET** нажмите кнопку **ОК**, чтобы вернуться в **редактор источника ADO.NET**.
6. В **редакторе источника ADO.NET** выберите в списке **Имя таблицы или представления** таблицу **Sales.SalesOrderDetail**.

    ![][07]

7. Щелкните **Предварительный просмотр**, чтобы открыть первые 200 строк данных из исходной таблицы в диалоговом окне **Предварительный просмотр результатов запроса**.

    ![][08]

8. В диалоговом окне **Предварительный просмотр результатов запроса** нажмите кнопку **Закрыть**, чтобы вернуться в **редактор источника ADO.NET**.
9. В **редакторе источника ADO.NET** нажмите кнопку **ОК**, чтобы завершить настройку источника данных.

## Шаг 4. Подключение адаптера источника к адаптеру назначения

1. Выберите адаптер источника в области конструктора.
2. Выделите синюю стрелку, которая выходит из адаптера источника, и перетащите ее к адаптеру назначения, чтобы она зафиксировалась на нем.

    ![][10]

    В типичном пакете служб SSIS вы будете использовать и другие компоненты из панели инструментов SSIS. Их вы разместите между источником и назначением, чтобы выполнять изменение структуры, преобразование и очистку данных при прохождении через поток данных служб SSIS. Но в этом примере для простоты мы подключаем источник напрямую к месту назначения.

## Шаг 5. Настройка адаптера назначения

1. Дважды щелкните адаптер назначения, чтобы открыть **редактор назначения ADO.NET**.

    ![][11]

2. На вкладке **Диспетчер подключений** в **редакторе назначения ADO.NET** нажмите кнопку **Создать** рядом со списком **Диспетчер подключений**. Откроется диалоговое окно **Настройка диспетчера подключений ADO.NET**, где нужно создать параметры подключения к базе данных хранилища данных SQL Azure, в которую мы будем загружать данные в этом руководстве.
3. В диалоговом окне **Настройка диспетчера подключений ADO.NET** нажмите кнопку **Создать**, чтобы открыть диалоговое окно **Диспетчер подключений** и создать новое подключение к данным.
4. В диалоговом окне **Диспетчер подключений** выполните следующие действия.
    1. Для параметра **Поставщик** выберите поставщик данных SqlClient.
    2. В поле **Имя сервера** введите имя хранилища данных SQL.
    3. В разделе **Вход на сервер** выберите вариант **Использование проверки подлинности SQL Server** и введите сведения для проверки подлинности.
    4. В разделе **Подключение к базе данных** выберите существующую базу данных хранилища данных SQL.
    5. Нажмите кнопку **Проверить подключение**.
    6. В диалоговом окне с результатами проверки подключения нажмите кнопку **ОК**, чтобы вернуться в диалоговое окно **Диспетчер подключений**.
    7. В диалоговом окне **Диспетчер подключений** нажмите кнопку **ОК**, чтобы вернуться в диалоговое окно **Настройка диспетчера подключений ADO.NET**.
5. В диалоговом окне **Настройка диспетчера подключений ADO.NET** нажмите кнопку **ОК**, чтобы вернуться в **редактор назначения ADO.NET**.
6. В **редакторе назначения ADO.NET** нажмите кнопку **Создать** рядом со списком **Использовать таблицу или представление**, чтобы открыть диалоговое окно **Создание таблицы**. Здесь следует создать новую целевую таблицу, столбцы которой должны совпадать со столбцами исходной таблицы.

    ![][12a]

7. В диалоговом окне **Создание таблицы** выполните указанные ниже действия.

    1. Измените имя целевой таблицы на **SalesOrderDetail**.
    2. Удалите столбец **rowguid**. Тип данных **uniqueidentifier** не поддерживается в хранилище данных SQL.
    3. Измените для столбца **LineTotal** тип данных на **money**. Тип данных **decimal** не поддерживается в хранилище данных SQL. Сведения о поддерживаемых типах данных см. в статье [CREATE TABLE (Azure SQL Data Warehouse, Parallel Data Warehouse)][] (CREATE TABLE (хранилище данных SQL Azure, параллельное хранилище данных)).
    
        ![][12b]
    
    4. Щелкните **ОК**, чтобы завершить создание таблицы и вернуться в **редактор назначения ADO.NET**.

8. В **редакторе назначения ADO.NET** выберите вкладку **Сопоставления**. Здесь вы увидите, как столбцы источника сопоставлены со столбцами назначения.

    ![][13]

9. Щелкните **ОК**, чтобы завершить настройку источника данных.

## Шаг 6. Запуск пакета для загрузки данных

Запустите пакет, нажав кнопку **Запустить** на панели инструментов или выбрав один из вариантов **запуска** в меню **отладки**.

Когда пакет начнет выполняться, вы увидите желтые вращающиеся колесики, которые обозначают выполнение действия, а также количество уже обработанных строк.

![][14]

Когда завершится выполнение пакета, вы увидите зеленые галочки, подтверждающие успешное выполнение, а также общее количество рядов данных, загруженных из источника в место назначения.

![][15]

Поздравляем! Вы успешно загрузили данные в хранилище данных SQL Azure с помощью служб SQL Server Integration Services.

## Дальнейшие действия

- Узнайте больше о потоке данных служб SSIS. Для начала изучите статью [Поток данных][].
- Ознакомьтесь со способами отладки и устранения неполадок в работе пакетов, доступными в среде разработки. Начните со статьи [Инструменты устранения неполадок при разработке пакета][].
- Узнайте, как развернуть проекты и пакеты служб SSIS на сервер служб Integration Services или в другое хранилище. Вам поможет статья [Развертывание проектов и пакетов][].

<!-- Image references -->
[01]: ./media/sql-data-warehouse-load-with-ssis/ssis-designer-01.png
[02]: ./media/sql-data-warehouse-load-with-ssis/ssis-data-flow-task-02.png
[03]: ./media/sql-data-warehouse-load-with-ssis/ado-net-source-03.png
[04]: ./media/sql-data-warehouse-load-with-ssis/ado-net-connection-manager-04.png
[05]: ./media/sql-data-warehouse-load-with-ssis/ado-net-connection-05.png
[06]: ./media/sql-data-warehouse-load-with-ssis/test-connection-06.png
[07]: ./media/sql-data-warehouse-load-with-ssis/ado-net-source-07.png
[08]: ./media/sql-data-warehouse-load-with-ssis/preview-data-08.png
[09]: ./media/sql-data-warehouse-load-with-ssis/source-destination-09.png
[10]: ./media/sql-data-warehouse-load-with-ssis/connect-source-destination-10.png
[11]: ./media/sql-data-warehouse-load-with-ssis/ado-net-destination-11.png
[12a]: ./media/sql-data-warehouse-load-with-ssis/destination-query-before-12a.png
[12b]: ./media/sql-data-warehouse-load-with-ssis/destination-query-after-12b.png
[13]: ./media/sql-data-warehouse-load-with-ssis/column-mapping-13.png
[14]: ./media/sql-data-warehouse-load-with-ssis/package-running-14.png
[15]: ./media/sql-data-warehouse-load-with-ssis/package-success-15.png

<!-- Article references -->

<!-- MSDN references -->
[руководстве по PolyBase]: https://msdn.microsoft.com/library/mt143171.aspx
[на странице загрузки SQL Server Data Tools (SSDT)]: https://msdn.microsoft.com/library/mt204009.aspx
[CREATE TABLE (Azure SQL Data Warehouse, Parallel Data Warehouse)]: https://msdn.microsoft.com/library/mt203953.aspx
[Поток данных]: https://msdn.microsoft.com/library/ms140080.aspx
[Инструменты устранения неполадок при разработке пакета]: https://msdn.microsoft.com/library/ms137625.aspx
[Развертывание проектов и пакетов]: https://msdn.microsoft.com/library/hh213290.aspx

<!--Other Web references-->
[пакет дополнительных компонентов для служб Microsoft SQL Server 2016 Integration Services для Azure]: http://go.microsoft.com/fwlink/?LinkID=626967
[ознакомительных версий SQL Server]: https://www.microsoft.com/ru-RU/evalcenter/evaluate-sql-server-2016
[Visual Studio Community]: https://www.visualstudio.com/ru-RU/products/visual-studio-community-vs.aspx
[здесь]: https://msftdbprodsamples.codeplex.com/releases/view/125550

<!---HONumber=AcomDC_0504_2016-->