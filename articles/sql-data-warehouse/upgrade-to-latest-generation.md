---
title: Обновление до последнего поколения хранилища данных SQL Azure | Документация Майкрософт
description: Обновление хранилища данных SQL Azure до последнего поколения аппаратного обеспечения и архитектуры службы хранилища Azure.
services: sql-data-warehouse
author: kevinvngo
manager: craigg-msft
ms.service: sql-data-warehouse
ms.topic: conceptual
ms.component: manage
ms.date: 08/22/2018
ms.author: kevin
ms.reviewer: igorstan
ms.openlocfilehash: 1e2993e1f4d28fd5d281ea510121686d3bc37a8c
ms.sourcegitcommit: b5ac31eeb7c4f9be584bb0f7d55c5654b74404ff
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2018
ms.locfileid: "42746968"
---
# <a name="optimize-performance-by-upgrading-sql-data-warehouse"></a>Оптимизация производительности путем обновления хранилища данных SQL
Обновление хранилища данных SQL Azure до последнего поколения аппаратного обеспечения и архитектуры службы хранилища Azure.

## <a name="why-upgrade"></a>Причины, по которым стоит установить обновление
Сейчас вы можете легко перейти на уровень хранилища данных SQL 2-го поколения "Оптимизировано для вычислений" на портале Azure. При наличии хранилища данных 1-го поколения уровня "Оптимизировано для вычислений" рекомендуется обновление. После обновления можно будет использовать последнее поколение оборудования Azure и улучшенную архитектуру службы хранилища Azure. Это дает возможность получить повышенную производительность, простую масштабируемость и неограниченное хранение данных в столбцах. 

## <a name="applies-to"></a>Применяется к
Это обновление применяется к хранилищам данных 1-го поколения уровня "Оптимизировано для вычислений".

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портале Azure](https://portal.azure.com/).

## <a name="before-you-begin"></a>Перед началом работы
> [!NOTE]
> Если имеющееся у вас хранилище данных уровня 1-го поколения "Оптимизировано для вычислений" находится не в том регионе, где доступен уровень 2-го поколения "Оптимизировано для вычислений", с помощью PowerShell вы можете [выполнить георепликацию](https://docs.microsoft.com/en-us/azure/sql-data-warehouse/sql-data-warehouse-restore-database-powershell#restore-from-an-azure-geographical-region) в регион с поддержкой этого уровня.
> 
>

1. Если работа хранилища данных при обновлении с уровня 1-го поколения "Оптимизировано для вычислений" приостановлена, [возобновите ее](pause-and-resume-compute-portal.md).
2. Будьте готовы к непродолжительному простою. 



## <a name="start-the-upgrade"></a>Начало обновления

1. На портале Azure перейдите к хранилищу данных 1-го поколения "Оптимизировано для вычислений", а затем щелкните **Upgrade to Gen2**: ![Upgrade_1](./media/sql-data-warehouse-upgrade-to-latest-generation/Upgrade_to_Gen2_1.png) (Обновить до поколения 2: обновить 1).

2. На уровне 1-го поколения "Оптимизировано для вычислений" **выберите предлагаемый по умолчанию уровень производительности** для хранилища данных на основе текущего уровня производительности, используя представленное ниже сопоставление.
    
   | Уровень 1-го поколения "Оптимизировано для вычислений" | Уровень 2-го поколения "Оптимизировано для вычислений" |
   | :----------------------: | :-------------------: |
   |      DW100–DW1000      |        DW1000c        |
   |          DW1200          |        DW1500c        |
   |          DW1500          |        DW1500c        |
   |          DW2000          |        DW2000c        |
   |          DW3000          |        DW3000c        |
   |          DW6000          |        DW6000c        |

3. Перед обновлением убедитесь, что рабочая нагрузка завершена и приостановлена. Несколько минут ресурсы будут недоступны, прежде чем хранилище данных опять подключится в качестве хранилища данных уровня 2-го поколения "Оптимизировано для вычислений". Выберите **Обновить**. Сейчас при использовании предварительной версии уровень производительности 2-го поколения "Оптимизировано для вычислений" стоит в половину меньше.
    
   ![Upgrade_2](./media/sql-data-warehouse-upgrade-to-latest-generation/Upgrade_to_Gen2_2.png)

4. **Наблюдайте за процессом обновления**, проверяя состояние на портале Azure.

   ![Upgrade3](./media/sql-data-warehouse-upgrade-to-latest-generation/Upgrade_to_Gen2_3.png)
   
   Первым шагом процесса обновления является масштабирование ("Обновление — автономный режим"), при котором все сеансы будут прерваны, а соединение разорвано. 
   
   Второй шаг процесса обновления — перенос данных ("Обновление — в сети"). Перенос данных является малозаметным фоновым сетевым процессом, который медленно перемещает данные столбцов из старой архитектуры службы хранилища в новую архитектуру службы хранилища, использующую локальный кэш SSD. В течение этого периода хранилище данных будет подключено к сети и доступно для запросов и загрузки данных. При этом все данные будут доступны для запросов, вне зависимости от того, были ли они перенесены. Перенос данных происходит с разной скоростью в зависимости от их размера, уровня производительности и количества сегментов columnstore. 

5. **Дополнительная рекомендация.** Для ускорения фонового процесса миграции данных вы можете сразу инициировать передачу данных, выполнив инструкцию [Alter Index rebuild](https://docs.microsoft.com/azure/sql-data-warehouse/sql-data-warehouse-tables-index) для всех основных таблиц columnstore, которые вы сможете запрашивать при наличии широких возможностей единого выхода и оптимального класса ресурсов. Эта операция проводится **в автономном режиме** в отличие от малозаметного фонового процесса, выполнение которого может длиться несколько часов в зависимости от количества и размера таблиц. Но перенос данных будет происходить намного быстрее, после чего вы сможете использовать все преимущества новой улучшенной архитектуры службы хранилища после завершения работы с группами строк высокого качества. 

Следующий запрос формирует необходимые команды Alter Index Rebuild для ускорения процесса переноса данных.

```sql
SELECT 'ALTER INDEX [' + idx.NAME + '] ON [' 
       + Schema_name(tbl.schema_id) + '].[' 
       + Object_name(idx.object_id) + '] REBUILD ' + ( CASE 
                                                         WHEN ( 
                                                     (SELECT Count(*) 
                                                      FROM   sys.partitions 
                                                             part2 
                                                      WHERE  part2.index_id 
                                                             = idx.index_id 
                                                             AND 
                                                     idx.object_id = 
                                                     part2.object_id) 
                                                     > 1 ) THEN 
              ' PARTITION = ' 
              + Cast(part.partition_number AS NVARCHAR(256)) 
              ELSE '' 
                                                       END ) + '; SELECT ''[' + 
              idx.NAME + '] ON [' + Schema_name(tbl.schema_id) + '].[' + 
              Object_name(idx.object_id) + '] ' + ( 
              CASE 
                WHEN ( (SELECT Count(*) 
                        FROM   sys.partitions 
                               part2 
                        WHERE 
                     part2.index_id = 
                     idx.index_id 
                     AND idx.object_id 
                         = part2.object_id) > 1 ) THEN 
              ' PARTITION = ' 
              + Cast(part.partition_number AS NVARCHAR(256)) 
              + ' completed'';' 
              ELSE ' completed'';' 
                                                    END ) 
FROM   sys.indexes idx 
       INNER JOIN sys.tables tbl 
               ON idx.object_id = tbl.object_id 
       LEFT OUTER JOIN sys.partitions part 
                    ON idx.index_id = part.index_id 
                       AND idx.object_id = part.object_id 
WHERE  idx.type_desc = 'CLUSTERED COLUMNSTORE'; 
```



## <a name="next-steps"></a>Дополнительная информация
Ваше хранилище данных подключено к сети. Чтобы воспользоваться преимуществами новой, усовершенствованной архитектуры, см. [Классы ресурсов для управления рабочей нагрузкой](resource-classes-for-workload-management.md).
 
