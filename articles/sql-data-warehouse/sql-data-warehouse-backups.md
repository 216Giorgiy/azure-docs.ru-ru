---
title: "Резервные копии в хранилище данных SQL Azure: моментальные снимки, геоизбыточные резервные копии | Документация Майкрософт"
description: "Ознакомьтесь с дополнительными сведениями о встроенной архивации хранилища данных SQL, которая позволяет восстановить хранилище данных SQL Azure до точки восстановления или в другом географическом регионе."
services: sql-data-warehouse
documentationcenter: 
author: Lakshmi1812
manager: jhubbard
editor: 
ms.assetid: b5aff094-05b2-4578-acf3-ec456656febd
ms.service: sql-data-warehouse
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.custom: backup-restore
ms.date: 10/31/2016
ms.author: lakshmir;barbkess
ms.openlocfilehash: 54c0149a769e654139bbdf709802d49127f041ac
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="sql-data-warehouse-backups"></a>Резервные копии хранилища данных SQL
Хранилище данных SQL предоставляет услуги резервного копирования хранилища данных с созданием как локальных, так и географических резервных копий. Резервное копирование включает в себя создание мгновенных снимков BLOB-объектов службы хранилища Azure и геоизбыточное хранилище. Резервные копии хранилища данных используются для восстановления хранилища данных до точки восстановления в основном регионе или для его восстановления в другом географическом регионе. В этой статье рассматриваются особенности резервных копий хранилища данных SQL.

## <a name="what-is-a-data-warehouse-backup"></a>Что такое резервная копия хранилища?
Резервная копия хранилища данных — это данные, которые можно использовать для восстановления хранилища данных до определенного момента времени.  Так как хранилище данных SQL является распределенной системой, резервная копия хранилища данных состоит из множества файлов, которые хранятся в BLOB-объектах Azure. 

Резервные копии базы данных являются важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления, так как они защищают данные от случайного повреждения или удаления. Дополнительные сведения см. в [обзоре обеспечения непрерывности бизнес-процессов](../sql-database/sql-database-business-continuity.md).

## <a name="data-redundancy"></a>Избыточность данных
Хранилище данных SQL обеспечивает защиту данных путем хранения данных в локально избыточном хранилище (LRS) Azure класса Premium. Благодаря этой функции службы хранилища Azure в локальном центре обработки данных сохраняются несколько синхронных копий данных для обеспечения прозрачной защиты данных в случае локальных сбоев. Избыточность данных гарантирует их целостность при неисправностях на уровне инфраструктуры, например при сбоях дисков. Кроме того, избыточность данных обеспечивает непрерывность бизнес-процессов в отказоустойчивой инфраструктуре с высокой доступностью.

Дополнительная информация:

* Хранилище Azure класса Premium рассматривается [в этой статье](../storage/common/storage-premium-storage.md).
* Локально избыточное хранилище описано в статье [Репликация службы хранилища Azure](../storage/common/storage-redundancy.md#locally-redundant-storage).

## <a name="azure-storage-blob-snapshots"></a>Моментальные снимки BLOB-объектов службы хранилища Azure
Пользователи хранилища данных SQL Azure класса Premium имеют возможность использовать моментальные снимки больших двоичных объектов службы хранилища Azure для создания локальных резервных копий хранилища данных. Хранилище данных можно восстановить до точки восстановления по моментальному снимку. Моментальные снимки создаются как минимум каждые восемь часов и доступны в течение семи дней.  

Дополнительная информация:

* Подробные сведения о моментальных снимках больших двоичных объектов Azure см. в статье [Создание моментального снимка BLOB-объекта](../storage/blobs/storage-blob-snapshots.md).

## <a name="geo-redundant-backups"></a>Геоизбыточные резервные копии
Каждые 24 часа хранилище данных SQL сохраняет все данные хранилища данных в стандартном хранилище. Создается полная копия хранилища данных, соответствующая времени последнего моментального снимка. Стандартное хранилище принадлежит к учетной записи геоизбыточного хранилища с доступом на чтение (RA-GRS). Компонент RA-GRS службы хранилища Azure реплицирует файлы резервных копий в [сопряженный центр обработки данных](../best-practices-availability-paired-regions.md). Георепликация гарантирует, что вы сможете восстановить хранилище данных даже при отсутствии доступа к моментальным снимкам, размещенным в основном регионе. 

Эта функция включена по умолчанию. Если вы не хотите использовать географически избыточные резервные копии, можно [отказаться от их использования] (https://docs.microsoft.com/powershell/resourcemanager/Azurerm.sql/v2.1.0/Set-AzureRmSqlDatabaseGeoBackupPolicy?redirectedfrom=msdn). 

> [!NOTE]
> В службе хранилища Azure термин *репликация* обозначает копирование файлов из одного расположения в другое. *Репликация базы данных SQL* означает хранение нескольких баз данных-получателей, синхронизированных с основной базой данных. 
> 
> 

> [!NOTE]
> В случае с DWU 9000 и DWU 18000 вы не можете отказаться от геоизбыточных резервных копий. 
>
> 

Дополнительная информация:

* геоизбыточное хранилище описано в статье [Репликация службы хранилища Azure](../storage/common/storage-redundancy.md);
* хранилище RA-GRS описано в разделе [Геоизбыточное хранилище с доступом для чтения](../storage/common/storage-redundancy.md#read-access-geo-redundant-storage).

## <a name="data-warehouse-backup-schedule-and-retention-period"></a>Расписание резервного копирования и срок хранения хранилища данных
Хранилище данных SQL создает моментальные снимки оперативных хранилищ данных каждые 4–8 часов и хранит каждый моментальный снимок в течение семи дней. Восстановить оперативную базу данных можно до одной из точек восстановления, созданных за последние семь дней. 

Чтобы узнать, когда был создан последний моментальный снимок, выполните этот запрос к хранилищу данных SQL, подключенному к сети. 

```sql
select top 1 *
from sys.pdw_loader_backup_runs 
order by run_id desc;
```

Чтобы сохранить моментальный снимок на более длительный срок, можно восстановить точку восстановления в новом хранилище данных. После завершения восстановления данных хранилище данных SQL начинает создавать моментальные снимки нового хранилища данных. Если в новое хранилище данных не были внесены изменения, моментальные снимки остаются пустыми. Таким образом, стоимость моментальных снимков будет минимальной. Кроме того, можно приостановить создание моментальных снимков базы данных в хранилище данных SQL.

### <a name="what-happens-to-my-backup-retention-while-my-data-warehouse-is-paused"></a>Сохраняются ли резервные копии, если приостановить работу хранилища данных?
Хранилище данных SQL не создает и не удаляет моментальные снимки по истечении периода хранения, пока работа хранилища данных приостановлена. Срок жизни моментальных снимков не изменяется, пока работа хранилища данных приостановлена. Срок хранения моментальных снимков соответствует количеству дней, в течение которых хранилище данных находится в оперативном режиме, а не количеству календарных дней.

Например, если моментальный снимок был сделан 1 октября в 16:00, а работа хранилища данных была приостановлена 3 октября в 16:00, длительность хранения этого моментального снимка составляет два дня. Независимо от того, когда хранилище данных снова перейдет в оперативный режим, длительность хранения моментального снимка на этот момент будет составлять два дня. Если хранилище данных возобновит работу 5 октября в 16:00, двухдневный моментальный снимок будет храниться еще пять дней.

Когда хранилище данных снова перейдет в оперативный режим, хранилище данных SQL возобновит создание новых моментальных снимков и удаление снимков со сроком хранения более семи дней.

### <a name="how-long-is-the-retention-period-for-a-dropped-data-warehouse"></a>Каков период хранения удаленных хранилищ данных?
При удалении хранилище данных и моментальные снимки сохраняются в течение семи дней, а затем удаляются окончательно. Хранилище данных можно восстановить до любой из сохраненных точек восстановления.

> [!IMPORTANT]
> Когда вы удаляете экземпляр логического сервера SQL Server, все относящиеся к этому экземпляру базы данных также удаляются без возможности восстановления. Удаленный сервер восстановить невозможно.
> 
> 

## <a name="data-warehouse-backup-costs"></a>Стоимость резервного копирования хранилища данных
Общая стоимость основного хранилища данных и моментальных снимков больших двоичных объектов Azure за последние семь дней округляется до ближайшего терабайта. Например, если объем хранилища данных составляет 1,5 ТБ, а под моментальные снимки задействовано 100 ГБ, плата взимается за 2 ТБ данных по тарифам хранилища Azure класса Premium. 

> [!NOTE]
> Все моментальные снимки изначально пустые, их размер увеличивается по мере внесения изменений в основное хранилище данных. Размер всех моментальных снимков увеличивается по мере внесения изменений в хранилище данных. Таким образом, стоимость хранения моментальных снимков увеличивается пропорционально внесенным изменениям.
> 
> 

При использовании геоизбыточного хранилища плата за хранилище взимается отдельно. Геоизбыточное хранилище оплачивается по стандартному тарифу для географически избыточного хранилища с доступом на чтение (RA-GRS).

Ознакомиться с ценами на хранилище данных SQL можно [здесь](https://azure.microsoft.com/pricing/details/sql-data-warehouse/).

## <a name="using-database-backups"></a>Использование резервных копий базы данных
Резервные копии хранилища данных SQL используются в первую очередь для восстановления хранилища данных до одной из точек восстановления в течение периода хранения.  

* Подробные сведения о восстановлении хранилища данных SQL см. в статье [Восстановление хранилища данных SQL Azure (обзор)](sql-data-warehouse-restore-database-overview.md).

## <a name="related-topics"></a>Связанные разделы
### <a name="scenarios"></a>Сценарии
* Сведения об обеспечении непрерывности бизнес-процессов см. в [этом обзоре](../sql-database/sql-database-business-continuity.md).

<!-- ### Tasks -->

* Восстановление хранилища данных описано в статье [Восстановление хранилища данных SQL Azure (обзор)](sql-data-warehouse-restore-database-overview.md).

<!-- ### Tutorials -->

