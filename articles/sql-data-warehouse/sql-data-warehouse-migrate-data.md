<properties
   pageTitle="Перенос данных в хранилище данных SQL | Microsoft Azure"
   description="Советы по переносу данных в хранилище данных SQL Azure для разработки решений."
   services="sql-data-warehouse"
   documentationCenter="NA"
   authors="jrowlandjones"
   manager="barbkess"
   editor=""/>

<tags
   ms.service="sql-data-warehouse"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services"
   ms.date="06/25/2015"
   ms.author="JRJ@BigBangData.co.uk;barbkess"/>

# Перенос данных
Основная цель переноса данных — заполнить базу данных SQLDW. Этот процесс можно выполнить несколькими способами. Для достижения этой цели можно использовать ADF Copy, службы SSIS и bcp. Тем не менее по мере увеличения объема данных есть смысл подумать о разделении процесса переноса на несколько этапов. Это позволит оптимизировать каждый этап как в плане производительности, так и в плане гибкости, обеспечивая плавный перенос данных.

В этой статье сначала будут рассмотрены простые сценарии переноса данных с помощью ADF Copy, служб SSIS и bcp. Затем мы поговорим об аспектах оптимизации переноса данных.

## Копирование с помощью фабрики данных Azure (ADF)
[ADF Copy][] входит в [фабрику данных Azure][]. ADF Copy позволяет перенести данные в неструктурированные файлы на локальном диске, в удаленные неструктурированные файлы в хранилище больших двоичных объектов Azure или напрямую в хранилище данных SQL.

Если данные хранятся в неструктурированных файлах, сначала их нужно перенести в большой двоичный объект хранилища Azure и затем загрузить в хранилище данных SQL. После переноса данных в хранилище больших двоичных объектов Azure можно еще раз воспользоваться [ADF Copy][], чтобы перенести данные в хранилище данных SQL.

PolyBase также обеспечивает возможность загрузки данных. Однако в этом случае придется использовать два средства вместо одного. Если требуется более высокая степень производительности, воспользуйтесь PolyBase. Если необходимо использовать одно средство (и объем данных небольшой), ADF вполне подойдет.

> [AZURE.NOTE]Для PolyBase файлы данных должны иметь кодировку UTF-8. Это кодировка по умолчанию для ADF, поэтому менять ничего не нужно. То есть изменять поведение ADF Copy по умолчанию не нужно.

[Примеры использования ADF Copy] см. в следующей статье.

## Службы интеграции ##
Службы Integration Services (SSIS) — это мощное и гибкое средство загрузки данных, которое поддерживает сложные рабочие потоки, преобразование данных и разные параметры загрузки. Службы SSIS позволяют упростить перенос данных в Azure; службы также можно использовать как часть более сложного переноса данных.

> [AZURE.NOTE]Службы SSIS могут экспортировать данные в UTF-8 без маркера последовательности байтов в файле. Чтобы настроить это, сначала нужно преобразовать символьные данные в поток данных с помощью компонента производного столбца и подготовить их для использования кодовой страницы 65001 UTF-8. После преобразования столбцов запишите данные в целевой адаптер неструктурированного файла, выбрав 65001 в качестве кодовой страницы для файла.

Службы SSIS подключаются к хранилищу данных SQL так же, как и к SQL Server. Однако для подключения потребуется диспетчер соединений ADO.NET. Также нужно не забыть настроить параметр "Использовать массовую вставку, когда она доступна", чтобы довести пропускную способность до максимума. См. статью [Адаптер загрузки данных ADO.NET][], чтобы узнать подробнее об этом свойстве.

> [AZURE.NOTE]Подключение к хранилищу данных SQL Azure с помощью OLE DB не поддерживается.

Кроме того, всегда существует возможность того, что пакет будет поврежден из-за регулирования или проблем с сетью. Создавайте пакеты таким образом, чтобы можно было возобновить работу с точки сбоя без необходимости повторять уже выполненную работу.

Дополнительные сведения см. в [документации по службам SSIS][].

## bcp
Программа bcp — средство командной строки, предназначенное для импорта и экспорта данных неструктурированных файлов. Во время экспорта можно выполнять преобразование. Для выполнения простого преобразования воспользуйтесь запросом, который выбирает и преобразует данные. После выполнения экспорта неструктурированные файлы можно загрузить напрямую в целевую базу данных хранилища данных SQL.

> [AZURE.NOTE]Рекомендуется включать преобразования, используемые во время экспорта данных, в представления в исходной системе. В этом случае логика будет сохранена и процесс можно будет повторить.

Программа bcp обладает следующими преимуществами.

- Простота. Команды bcp просты для построения и выполнения.
- Процесс загрузки можно повторять. После выполнения экспорта загрузку можно выполнять любое количество раз.

Программа bcp имеет следующие ограничения.

- Программа bcp работает только с табличными неструктурированными файлами. Программа bcp не работает с такими файлами, как XML или JSON.
- Программа bcp не поддерживает экспорт в UTF-8. Из-за этого использовать PolyBase с данными, экспортированными программой bcp, может быть проблематично.
- Возможности преобразования данных ограничены этапом экспорта и простые по своей природе.
- Программа bcp не является надежным средством для загрузки данных через Интернет. Любой сетевой сбой приводит к ошибке загрузки.
- Программа bcp зависит от схемы, которая присутствует в целевой базе данных до загрузки.

Дополнительные сведения см. в разделе [Использование программы bcp для загрузки данных в хранилище данных SQL][].

## Оптимизация переноса данных
Процесс переноса данных с помощью SQLDW можно эффективно разделить на три этапа:

1. Экспорт исходных данных
2. Передача данных в Azure
3. Загрузка в целевую базу данных SQLDW

Каждый этап можно оптимизировать для создания надежного, повторяемого и гибкого процесса переноса данных, который обеспечивает максимальную производительность на каждом отдельном этапе.

## Оптимизация загрузки данных
Если посмотреть на этапы в обратном порядке, самый быстрый способ загрузки данных — использовать PolyBase. Оптимизация для процесса загрузки с помощью PolyBase накладывает ряд требований к предыдущим этапам, поэтому лучше сразу их рассмотреть. К ним относятся:

1. Кодирование файлов данных
2. Форматирование файлов данных
3. Размещение файлов данных

### Кодирование
Для PolyBase файлы данных должны иметь кодировку UTF-8. Это означает, что при экспорте данных они должны отвечать этому требованию. Если данные содержат только основные символы ASCII (нет дополнительных символов ASCII), они могут быть напрямую связаны со стандартом UTF-8 и нет смысла переживать по поводу кодировки. Однако если данные содержат много разных специальных символов, таких как точки над гласными, ударения или другие символы, либо данные содержат буквы, не входящие в латиницу, то необходимо сначала преобразовать данные в кодировку UTF-8.

> [AZURE.NOTE]Программа bcp не поддерживает экспорт в UTF-8. Поэтому лучше использовать службы Integration Services или ADF Copy для экспорта данных. Стоит отметить, что метка порядка байтов BOM в файле данных UTF-8 не требуется.

Файлы в кодировке UTF-16 должны быть перезаписаны, ***прежде чем*** выполнять перенос данных.

### Форматирование файлов данных
PolyBase требует наличия признака конца строки \\n или новой строки. Файлы данных должны соответствовать этому стандарту. Нет ограничений для признаков конца строки или столбца.

В PolyBase необходимо определить каждый столбец в файле как часть внешней таблицы. Убедитесь, что все экспортируемые столбцы обязательные и что типы соответствуют требуемым стандартам.

Сведения о поддерживаемых типах данных см. в предыдущей статье "Перенос схемы".

### Размещение файлов данных
Хранилище данных SQL использует PolyBase для загрузки данных только из хранилища больших двоичных объектов Azure. Следовательно, данные должны быть перенесены в хранилище больших двоичных объектов.

## Оптимизация переноса данных
Один из самых медленных процессов переноса данных — это перенос данных в Azure. Проблемой может стать не только пропускная способность сети, но и ее стабильная работа. По умолчанию перенос данных в Azure выполняется через Интернет, поэтому риск ошибок во время переноса довольно высокий. Тем не менее из-за этих ошибок может потребоваться переслать повторно все данные или их часть.

К счастью, существует несколько вариантов для повышения быстродействия и устойчивости этого процесса.

### [ExpressRoute][]
Чтобы ускорить перенос данных, вы можете воспользоваться [ExpressRoute][]. [ExpressRoute][] предоставляет закрытое установленное соединение с Azure, и подключение не будет проходить через Интернет. Это отнюдь не является обязательным этапом. Тем не менее это улучшит пропускную способность при передаче данных в Azure с локальных или совместно используемых серверов.

[ExpressRoute][] обладает следующими преимуществами.

1. Повышенная надежность
2. Более высокая скорость сети
3. Низкая задержка сети
4. Более высокая степень сетевой безопасности

[ExpressRoute][] целесообразно использовать в целом ряде сценариев, а не только для переноса данных.

Заинтересовались? Дополнительные сведения и цены см. в [документации по ExpressRoute][].

### Служба импорта и экспорта Azure
Служба импорта и экспорта Azure — это процесс переноса данных, предназначенный для больших (гигабайты данных) и очень больших (терабайты данных) объемов данных. Процесс предполагает запись данных на диски с последующей пересылкой в центр обработки данных Azure. Содержимое дисков затем загружают в большие двоичные объекты хранилища Azure от вашего имени.

Общая схема процесса импорта и экспорта выглядит следующим образом.

1. Настройка контейнера хранилища больших двоичных объектов Azure для получения данных
2. Экспорт данных в локальное хранилище
2. Копирование данных на жесткие диски формата 3,5 дюйма SATA II/III с помощью средства импорта и экспорта Azure
3. Создание задания импорта с помощью службы импорта и экспорта Azure с предоставлением файлов журналов, созданных средством импорта и экспорта Azure
4. Пересылка дисков в указанный центр обработки данных Azure
5. Данные перемещаются в контейнер хранилища больших двоичных объектов Azure
6. Загрузка данных в SQLDW с помощью PolyBase

### Программа [AZCopy][]
Программа [AZCopy][] прекрасно подходит для переноса данных в большие двоичные объекты хранилища Azure. Средство предназначено для небольших (мегабайты данных) и очень больших (гигабайты данных) объемов данных. [AZCopy] также обеспечивает гибкую пропускную способность во время переноса данных в Azure, поэтому подходит для этапа переноса данных. После выполнения переноса данные можно загрузить с помощью PolyBase в хранилище данных SQL. Средство AZCopy можно также добавить в пакеты служб SSIS с помощью задания "Выполнить процесс".

Чтобы использовать AZCopy, сначала необходимо загрузить это средство и установить его. Существует [рабочая версия][] и [пробная версия][].

Для загрузки файла из файловой системы потребуется командная строка, как та, что представлена ниже.

```
AzCopy /Source:C:\myfolder /Dest:https://myaccount.blob.core.windows.net/mycontainer /DestKey:key /Pattern:abc.txt
```

В целом процесс может выглядеть следующим образом.

1. Настройка контейнера большого двоичного объекта хранилища Azure для получения данных
2. Экспорт данных в локальное хранилище
3. Копирование данных с помощью AZCopy в контейнер хранилища больших двоичных объектов Azure
4. Загрузка данных в хранилище данных SQL с помощью PolyBase

См. полную документацию по [AZCopy][].

## Оптимизация экспорта данных
Помимо соблюдения требований PolyBase к экспорту данных, рекомендуется оптимизировать экспорт данных, чтобы еще больше улучшить процесс.

> [AZURE.NOTE]Для PolyBase данные должны быть в формате UTF-8, поэтому вряд вы будете использовать bcp для экспорта данных. Программа bcp не поддерживает перевод файлов данных в UTF-8. Службы SSIS или ADF Copy гораздо лучше подходят для выполнения такого рода экспорта данных.

### Сжатие данных
PolyBase может читать данные, сжатые с помощью gzip. Если есть возможность сжать файлы с помощью gzip, это позволит минимизировать объем данных, пересылаемый по сети.

### Разделение на несколько файлов
Разделение больших таблиц на несколько файлов не только повышает скорость экспорта, но и обеспечивает возможность повторного запуска и общую управляемость данных после переноса в хранилище больших двоичных объектов Azure. Одно из преимуществ PolyBase заключается в том, что средство позволяет читать все файлы внутри папки и обрабатывать их в виде одной таблицы. Поэтому рекомендуется разложить файлы для каждой таблицы в разные папки.

PolyBase также поддерживает так называемую функцию рекурсивного перебора папок. Функция позволяет улучшить организацию экспортируемых данных и управление данными.

Дополнительные сведения о загрузке данных с помощью PolyBase см. в разделе [Использование PolyBase для загрузки данных в хранилище данных SQL][].


## Дальнейшие действия
Дополнительные сведения о переносе данных см. в разделе [Перенос решения в хранилище данных SQL][]. Дополнительные советы по разработке см. в статье [Общие сведения о разработке][].

<!--Image references-->

<!--Article references-->
[AZCopy]: ../storage/storage-use-azcopy.md
[ADF Copy]: ../data-factory/data-factory-copy-activity.md
[Примеры использования ADF Copy]: ../data-factory/data-factory-copy-activity-examples.md
[Общие сведения о разработке]: sql-data-warehouse-develop-overview.md
[Перенос решения в хранилище данных SQL]: sql-data-warehouse-overview-migrate.md
[SQL Data Warehouse development overview]: sql-data-warehouse-overview-develop.md
[Использование программы bcp для загрузки данных в хранилище данных SQL]: sql-data-warehouse-load-with-bcp.md
[Использование PolyBase для загрузки данных в хранилище данных SQL]: sql-data-warehouse-load-with-polybase.md


<!--MSDN references-->

<!--Other Web references-->
[фабрику данных Azure]: http://azure.microsoft.com/services/data-factory/
[ExpressRoute]: http://azure.microsoft.com/services/expressroute/
[документации по ExpressRoute]: http://azure.microsoft.com/documentation/services/expressroute/

[рабочая версия]: http://aka.ms/downloadazcopy/
[пробная версия]: http://aka.ms/downloadazcopypr/
[Адаптер загрузки данных ADO.NET]: https://msdn.microsoft.com/ru-ru/library/bb934041.aspx
[документации по службам SSIS]: https://msdn.microsoft.com/ru-ru/library/ms141026.aspx

<!---HONumber=August15_HO8-->