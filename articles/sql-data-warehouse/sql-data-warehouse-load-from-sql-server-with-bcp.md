---
title: Загрузка данных из SQL Server в хранилище данных SQL Azure (с использованием bcp) | Microsoft Docs
description: Описывается использование программы bcp, чтобы экспортировать небольшие наборы данных из SQL Server, а потом импортировать их непосредственно в хранилище данных SQL.
services: sql-data-warehouse
documentationcenter: NA
author: lodipalm
manager: barbkess
editor: ''

ms.service: sql-data-warehouse
ms.devlang: NA
ms.topic: get-started-article
ms.tgt_pltfrm: NA
ms.workload: data-services
ms.date: 06/30/2016
ms.author: lodipalm;barbkess;sonyama

---
# Загрузка данных из SQL Server в хранилище данных SQL Azure (неструктурированные файлы)
> [!div class="op_single_selector"]
> * [SSIS](sql-data-warehouse-load-from-sql-server-with-integration-services.md)
> * [PolyBase;](sql-data-warehouse-load-from-sql-server-with-polybase.md)
> * [bcp](sql-data-warehouse-load-from-sql-server-with-bcp.md)
> 
> 

Служебную программу командной строки bcp можно использовать, чтобы экспортировать небольшие наборы данных из SQL Server, а потом загрузить их непосредственно в хранилище данных SQL.

В этом руководстве описывается, как с помощью bcp выполнять следующие действия:

* экспортировать таблицу из SQL Server с помощью команды bcp out (или создавать простой пример файла);
* импортировать таблицу из неструктурированного файла в хранилище данных SQL;
* создавать статистику для загруженных данных.

> [!VIDEO https://channel9.msdn.com/Blogs/Windows-Azure/Loading-data-into-Azure-SQL-Data-Warehouse-with-BCP/player]
> 
> 

## Перед началом работы
### Предварительные требования
Для выполнения этих действий необходимо иметь следующее:

* База данных хранилища данных SQL
* установленная служебная программа командной строки bcp;
* установленная служебная программа командной строки sqlcmd.

Вы можете загрузить служебные программы bcp и sqlcmd в [Центре загрузки Майкрософт][Центре загрузки Майкрософт].

### Данные в формате ASCII или UTF-16
Чтобы выполнить действия, описанные в этом руководстве, необходимо использовать данные в формате ASCII или UTF-16, так как bcp не поддерживает кодировку UTF-8.

PolyBase поддерживает UTF-8, но еще не поддерживает UTF-16. Чтобы совместно использовать bcp и PolyBase, необходимо преобразовать данные, загруженные из SQL Server, в формат UTF-8.

## 1\. Создание целевой таблицы
Определите в хранилище данных SQL таблицу, которая станет целевой таблицей для загрузки данных. Столбцы в таблице должны соответствовать данным в каждой строке файла данных.

Чтобы создать таблицу, откройте окно командной строки и используйте sqlcmd.exe для выполнения следующей команды:

```sql
sqlcmd.exe -S <server name> -d <database name> -U <username> -P <password> -I -Q "
    CREATE TABLE DimDate2
    (
        DateId INT NOT NULL,
        CalendarQuarter TINYINT NOT NULL,
        FiscalQuarter TINYINT NOT NULL
    )
    WITH
    (
        CLUSTERED COLUMNSTORE INDEX,
        DISTRIBUTION = ROUND_ROBIN
    );
"
```


## 2\. Создание файла источника данных
Откройте блокнот и скопируйте следующие строки данных в новый текстовый файл, а затем сохраните этот файл в локальный временный каталог (C:\\Temp\\DimDate2.txt). Эти данные имеют формат ASCII.

```
20150301,1,3
20150501,2,4
20151001,4,2
20150201,1,3
20151201,4,2
20150801,3,1
20150601,2,4
20151101,4,2
20150401,2,4
20150701,3,1
20150901,3,1
20150101,1,3
```

Чтобы экспортировать данные из базы данных SQL Server, откройте окно командной строки и выполните команду ниже (необязательно). Замените значения TableName, ServerName, DatabaseName, Username и Password на собственные.

```sql
bcp <TableName> out C:\Temp\DimDate2_export.txt -S <ServerName> -d <DatabaseName> -U <Username> -P <Password> -q -c -t ','
```



## 3\. Загрузка данных
Чтобы загрузить данные, откройте окно командной строки и выполните следующую команду, подставив собственные значения имени сервера, базы данных, пользователя и пароль.

```sql
bcp DimDate2 in C:\Temp\DimDate2.txt -S <ServerName> -d <DatabaseName> -U <Username> -P <password> -q -c -t  ','
```

Используйте команду ниже, чтобы убедиться, что данные загружены правильно.

```sql
sqlcmd.exe -S <server name> -d <database name> -U <username> -P <password> -I -Q "SELECT * FROM DimDate2 ORDER BY 1;"
```

Результат должен выглядеть следующим образом:

| DateId | CalendarQuarter | FiscalQuarter |
| --- | --- | --- |
| 20150101 |1 |3 |
| 20150201 |1 |3 |
| 20150301 |1 |3 |
| 20150401 |2 |4\. |
| 20150501 |2 |4\. |
| 20150601 |2 |4\. |
| 20150701 |3 |1 |
| 20150801 |3 |1 |
| 20150801 |3 |1 |
| 20151001 |4\. |2 |
| 20151101 |4\. |2 |
| 20151201 |4\. |2 |

## 4\. Создание статистики
Хранилище данных SQL пока не поддерживает автоматическое создание или автоматическое обновление статистики. Чтобы добиться максимально высокой производительности запросов, крайне важно сформировать статистические данные для всех столбцов всех таблиц после первой загрузки или после любых значительных изменений в данных. Дополнительные сведения см. в статье об [управлении статистикой][управлении статистикой].

Выполните следующую команду, чтобы создать статистику для загруженной таблицы.

```sql
sqlcmd.exe -S <server name> -d <database name> -U <username> -P <password> -I -Q "
    create statistics [DateId] on [DimDate2] ([DateId]);
    create statistics [CalendarQuarter] on [DimDate2] ([CalendarQuarter]);
    create statistics [FiscalQuarter] on [DimDate2] ([FiscalQuarter]);
"
```

## 5\. Экспорт данных из хранилища данных SQL
Вы можете экспортировать данные, загруженные из хранилища данных SQL, обратно в хранилище. Для этого используется та же команда.

Однако результаты ее выполнения отличаются. Так как данные в хранилище данных SQL распределены, при их экспорте каждый вычислительный узел записывает хранящиеся на нем данные в выходной файл. Порядок данных в выходном файле может отличаться от порядка данных во входном файле.

### Экспорт таблицы и сравнение результатов экспорта
Чтобы просмотреть экспортированные данные, откройте окно командной строки и выполните следующую команду, используя свои собственные параметры. Параметр ServerName — это имя логического сервера SQL Azure.

```sql
bcp DimDate2 out C:\Temp\DimDate2_export.txt -S <Server Name> -d <Database Name> -U <Username> -P <password> -q -c -t ','
```
Убедитесь, что данные экспортированы, открыв новый файл. Данные в файле должны соответствовать приведенным ниже, но могут размещаться в другом порядке.

```
20150301,1,3
20150501,2,4
20151001,4,2
20150201,1,3
20151201,4,2
20150801,3,1
20150601,2,4
20151101,4,2
20150401,2,4
20150701,3,1
20150901,3,1
20150101,1,3
```

### Экспорт результатов запроса
Используйте функцию **queryout** командной строки bcp, чтобы экспортировать результаты запроса, а не всю таблицу.

## Дальнейшие действия
Общие сведения о загрузке см. в разделе [Загрузка данных в хранилище данных SQL][Загрузка данных в хранилище данных SQL]. Дополнительные советы по разработке см. в разделе [Общие сведения о разработке для хранилища данных SQL][Общие сведения о разработке для хранилища данных SQL]. Дополнительные сведения о создании таблицы в хранилище данных SQL см. в статьях, посвященных [таблицам в хранилище данных SQL][таблицам в хранилище данных SQL] и [синтаксису инструкции CREATE TABLE][синтаксису инструкции CREATE TABLE].

<!--Image references-->

<!--Article references-->

[Загрузка данных в хранилище данных SQL]: ./sql-data-warehouse-overview-load.md
[Общие сведения о разработке для хранилища данных SQL]: ./sql-data-warehouse-overview-develop.md
[таблицам в хранилище данных SQL]: ./sql-data-warehouse-tables-overview.md
[управлении статистикой]: ./sql-data-warehouse-tables-statistics.md

<!--MSDN references-->
[bcp]: https://msdn.microsoft.com/library/ms162802.aspx
[синтаксису инструкции CREATE TABLE]: https://msdn.microsoft.com/library/mt203953.aspx

<!--Other Web references-->
[Центре загрузки Майкрософт]: https://www.microsoft.com/download/details.aspx?id=36433

<!---HONumber=AcomDC_0706_2016-->