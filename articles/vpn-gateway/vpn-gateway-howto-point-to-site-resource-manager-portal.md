---
title: "Подключение компьютера к виртуальной сети Azure с помощью соединения типа &quot;точка — сеть&quot; и портала | Документация Майкрософт"
description: "Безопасно подключайтесь к своей виртуальной сети Azure, создав VPN-подключение шлюза типа &quot;точка — сеть&quot; с помощью портала Azure и Resource Manager."
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: a15ad327-e236-461f-a18e-6dbedbf74943
ms.service: vpn-gateway
ms.devlang: na
ms.topic: hero-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/02/2017
ms.author: cherylmc
translationtype: Human Translation
ms.sourcegitcommit: cea53acc33347b9e6178645f225770936788f807
ms.openlocfilehash: bc3d0252b3aef6a62c863b79839557e165d9f121
ms.lasthandoff: 03/03/2017


---
# <a name="configure-a-point-to-site-connection-to-a-vnet-using-the-azure-portal"></a>Настройка подключения типа "точка — сеть" к виртуальной сети с помощью портала Azure
> [!div class="op_single_selector"]
> * [Resource Manager — портал Azure](vpn-gateway-howto-point-to-site-resource-manager-portal.md)
> * [Resource Manager — PowerShell](vpn-gateway-howto-point-to-site-rm-ps.md)
> * [Классическая модель — портал Azure](vpn-gateway-howto-point-to-site-classic-azure-portal.md)
> 
> 

Конфигурация типа "точка — сеть" позволяет создать безопасное подключение к виртуальной сети с отдельного клиентского компьютера. Это эффективное решение для подключения к виртуальной сети из удаленного расположения, например, если вы находитесь дома или на конференции либо если подключение к виртуальной сети требуется всего нескольким клиентам. 

Для подключения типа "точка–сеть" не требуется VPN-устройство или общедоступный IP-адрес. VPN-подключение сначала устанавливается с локального клиентского компьютера. Дополнительные сведения о подключениях типа "точка — сеть" см. в разделе [Часто задаваемые вопросы о подключениях типа "точка — сеть"](#faq) в конце этой статьи.

В этой статье рассматривается создание виртуальной сети с подключением типа "точка — сеть" с помощью портала Azure. Приведенные инструкции относятся к модели развертывания с помощью Resource Manager.

### <a name="deployment-models-and-methods-for-p2s-connections"></a>Модели и методы развертывания для подключений типа "точка — сеть"
[!INCLUDE [deployment models](../../includes/vpn-gateway-deployment-models-include.md)]

В следующей таблице представлены две модели развертывания и доступные методы развертывания для конфигурации "точка — сеть". Когда появится статья с руководством по конфигурации, мы разместим прямую ссылку на нее в этой таблице.

[!INCLUDE [vpn-gateway-clasic-rm](../../includes/vpn-gateway-table-point-to-site-include.md)]

## <a name="basic-workflow"></a>Базовый рабочий процесс
![Схема подключения типа "точка — сеть"](./media/vpn-gateway-howto-point-to-site-resource-manager-portal/point-to-site-connection-diagram.png)

### <a name="example"></a>Примеры значений
* **Имя: VNet1**.
* **Адресное пространство: 192.168.0.0/16**.<br>В этом примере мы используем только одно адресное пространство, но для виртуальной сети можно настроить несколько.
* **Имя подсети: FrontEnd**.
* **Диапазон адресов подсети: 192.168.1.0/24**.
* **Подписка**. Если у вас есть несколько подписок, убедитесь, что используется правильная.
* **Группа ресурсов: TestRG**.
* **Расположение: восточная часть США**.
* **Подсеть шлюза: 192.168.200.0/24**.
* **Имя шлюза виртуальной сети: VNet1GW**.
* **Тип шлюза: VPN**.
* **Тип VPN: на основе маршрутов**.
* **Общедоступный IP-адрес: VNet1GWpip**.
* **Тип подключения: "точка — сеть"**.
* **Пул адресов клиента: 172.16.201.0/24**.<br>VPN-клиенты, подключающиеся к виртуальной сети с помощью этого подключения типа "точка — сеть", получают IP-адреса из пула адресов клиента.

## <a name="before-beginning"></a>Подготовка
* Убедитесь в том, что у вас уже есть подписка Azure. Если у вас нет подписки Azure, вы можете [активировать преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details) или [зарегистрировать бесплатную учетную запись](https://azure.microsoft.com/pricing/free-trial).

## <a name="createvnet"></a>Часть 1. Создание виртуальной сети
Если вы создаете эту конфигурацию в качестве упражнения, можно использовать [примеры значений](#example).

[!INCLUDE [vpn-gateway-basic-vnet-rm-portal](../../includes/vpn-gateway-basic-vnet-rm-portal-include.md)]

## <a name="address"></a>Часть 2. Выбор адресного пространства и подсетей
После создания виртуальной сети в нее можно добавить дополнительное адресное пространство и подсети.

[!INCLUDE [vpn-gateway-additional-address-space](../../includes/vpn-gateway-additional-address-space-include.md)]

## <a name="gatewaysubnet"></a>Часть 3. Добавление подсети шлюза

Прежде чем подключать шлюз к виртуальной сети, нужно создать подсеть шлюза для виртуальной сети, к которой необходимо подключиться. Службы шлюза используют IP-адреса, указанные в подсети шлюза. По возможности создайте подсеть шлюза с использованием блока CIDR с маской /28 или /27, чтобы обеспечить достаточно IP-адресов для удовлетворения будущих дополнительных требований к конфигурации.

Снимки экрана в этом разделе предоставляются в качестве справочного примера. Используйте диапазон адресов подсети шлюза, соответствующий необходимым значениям для вашей конфигурации.

###<a name="to-create-a-gateway-subnet"></a>Создание подсети шлюза

[!INCLUDE [vpn-gateway-add-gwsubnet-rm-portal](../../includes/vpn-gateway-add-gwsubnet-rm-portal-include.md)]

## <a name="dns"></a>Часть 4. Выбор DNS-сервера (необязательно)
[!INCLUDE [vpn-gateway-add-dns-rm-portal](../../includes/vpn-gateway-add-dns-rm-portal-include.md)]

## <a name="creategw"></a>Часть 5. Создание шлюза виртуальной сети
Для подключений типа "точка — сеть" требуются следующие параметры.

* Тип шлюза: VPN.
* Тип VPN: на основе маршрутов.

### <a name="to-create-a-virtual-network-gateway"></a>Создание шлюза виртуальной сети
[!INCLUDE [vpn-gateway-add-gw-rm-portal](../../includes/vpn-gateway-add-gw-rm-portal-include.md)]

## <a name="generatecert"></a>Часть 6. Создание сертификатов
Сертификаты используются в Azure для проверки подлинности VPN-клиентов в VPN-подключениях типа "точка — сеть". Данные общедоступного сертификата (а не закрытый ключ) экспортируются в виде CER-файла X.509 в кодировке Base-64 из корневого сертификата, созданного с помощью корпоративного решения, или самозаверяющего корневого сертификата. Затем данные общедоступного сертификата импортируются из корневого сертификата в Azure. Кроме того, нужно создать сертификат клиента из корневого сертификата для клиентов. Для каждого клиента, которому нужно подключаться к виртуальной сети с помощью подключения типа "точка — сеть", требуется установить сертификат клиента, созданный из корневого сертификата.

### <a name="getcer"></a>Шаг 1. Получение CER-файла для корневого сертификата

Если вы пользуетесь корпоративным решением центра сертификации, можно использовать существующую цепочку сертификатов. Получите CER-файл для корневого сертификата, который нужно использовать.

Если вы не планируете использовать корпоративное решение для создания сертификатов, нужно создать самозаверяющий корневой сертификат. Чтобы создать самозаверяющий сертификат, содержащий поля, необходимые для проверки подлинности подключения типа "точка — сеть", используйте средство makecert. Дополнительные сведения о создании самозаверяющего корневого сертификата см. [здесь](vpn-gateway-certificates-point-to-site.md). Нам известно, что средство makecert является устаревшим, но в настоящее время это поддерживаемое решение.

>[!NOTE]
>Самозаверяющие сертификаты можно создавать с помощью PowerShell, но такие сертификаты не содержат поля, необходимые для проверки подлинности подключения типа "точка — сеть".
>


#### <a name="to-obtain-the-cer-file-from-a-self-signed-root-certificate"></a>Получение CER-файла из самозаверяющего корневого сертификата

1. Чтобы получить CER-файл из самозаверяющего корневого сертификата, откройте файл **certmgr.msc** и найдите созданный корневой сертификат. Обычно он находится в папке Certificates-Current User/Personal/Certificates и называется так, как его назвали при создании. Щелкните самозаверяющий корневой сертификат правой кнопкой мыши, выберите пункт **Все задачи**, а затем — **Экспорт**. Откроется **мастера экспорта сертификатов**.
2. В мастере нажмите кнопку **Далее**, выберите **Нет, не экспортировать закрытый ключ** и снова нажмите кнопку **Далее**.
3. На странице **Формат экспортируемого файла** выберите **Файлы X.509 (.CER) в кодировке Base-64**. Затем щелкните **Далее**.
4. На странице **Имя экспортируемого файла** нажмите кнопку **Обзор**, чтобы перейти в расположение для экспорта сертификата. В поле **Имя файла**введите имя для файла сертификата. Нажмите кнопку **Далее**.
5. Нажмите кнопку **Готово** , чтобы экспортировать сертификат.

### <a name="generateclientcert"></a>Шаг 2. Создание сертификата клиента
Можно создать уникальный сертификат для каждого клиента, который будет подключаться к виртуальной сети, или использовать один сертификат для нескольких клиентов. Преимущество уникальных клиентских сертификатов заключается в том, что при необходимости можно отозвать один сертификат. В противном случае, если все используют один и тот же сертификат клиента и нужно отозвать сертификат для одного клиента, потребуется создать и установить новые сертификаты для всех клиентов, которые используют этот сертификат для аутентификации.

####<a name="enterprise-certificate"></a>Корпоративный сертификат
- При использовании корпоративного решения для создания сертификатов создайте сертификат клиента с общим именем в формате name@yourdomain.com, а не в формате "доменное_имя\имя_пользователя".
- Убедитесь, что выдаваемый сертификат клиента основан на шаблоне сертификата User, в котором первым указан пункт "Проверка подлинности клиента", а не "Вход со смарт-картой" и т. д. Проверить сертификат можно, дважды щелкнув сертификат клиента и выбрав **Сведения > Улучшенный ключ**.

####<a name="self-signed-certificate"></a>Самозаверяющий сертификат 
Дополнительные сведения об использовании самозаверяющего сертификата для создания сертификата клиента см. в статье [Работа с самозаверяющими сертификатами для подключений типа "точка — сеть"](vpn-gateway-certificates-point-to-site.md).

### <a name="exportclientcert"></a>Шаг 3. Экспорт сертификата клиента
Этот сертификат требуется для проверки подлинности. После создания сертификата клиента его нужно экспортировать. Позже этот сертификат устанавливается на каждый клиентский компьютер.

1. Для экспорта сертификата клиента можно использовать команду *certmgr.msc*. Щелкните правой кнопкой мыши сертификат, который нужно экспортировать, щелкните **Все задачи** и выберите **Экспорт**.
2. Экспортируйте сертификат клиента с закрытым ключом. Это *PFX* -файл. Обязательно запишите или запомните пароль (ключ), который задали для этого сертификата.

## <a name="addresspool"></a>Часть 7. Добавление пула адресов клиента
1. После создания шлюза виртуальной сети перейдите к разделу **Параметры** в колонке шлюза виртуальной сети. В разделе **Параметры** щелкните **Конфигурация "точка — сеть"**, чтобы открыть колонку **Конфигурация**.
   
    ![Колонка подключения типа "точка — сеть"](./media/vpn-gateway-howto-point-to-site-resource-manager-portal/configuration.png)
2. **Пул адресов** — это пул IP-адресов, из которого клиенты, осуществляющие подключение, получают IP-адрес. Добавьте пул адресов и щелкните **Сохранить**.
   
    ![Пул адресов клиента](./media/vpn-gateway-howto-point-to-site-resource-manager-portal/ipaddresspool.png)

## <a name="uploadfile"></a>Часть 8. Отправка CER-файла корневого сертификата
После создания шлюза CER-файл для доверенного корневого сертификата можно отправить в Azure. Вы можете отправить файлы для 20 корневых сертификатов. Не отправляйте закрытый ключ для корневого сертификата в Azure. После отправки CER-файла он используется в Azure для проверки подлинности клиентов, подключающихся к виртуальной сети.

1. Сертификаты добавляются в раздел **Корневой сертификат** колонки **Конфигурация "точка-сеть"**.  
2. Корневой сертификат необходимо экспортировать в виде CER-файла X.509 в кодировке Base64. Это позволит открыть сертификат в текстовом редакторе.
3. Откройте сертификат в текстовом редакторе, например в блокноте. Скопируйте только указанный ниже раздел как одну непрерывную строку.
   
    ![Данные сертификата](./media/vpn-gateway-howto-point-to-site-resource-manager-portal/copycert.png)

    > [!NOTE]
    > При копировании данных сертификата обязательно скопируйте текст как одну непрерывную строку без символов возврата каретки и перевода строки. Может потребоваться изменить параметры представления в текстовом редакторе, чтобы показать символы или показать все знаки и просмотреть символы возврата каретки и перевода строки.                                                                                                                                                                            
    >
    >

4. Вставьте данные сертификата в поле **Данные общедоступного сертификата**. Введите имя сертификата в поле **Имя**, затем нажмите кнопку **Сохранить**. Вы можете добавить до 20 доверенных корневых сертификатов.
   
    ![Отправка сертификата](./media/vpn-gateway-howto-point-to-site-resource-manager-portal/rootcertupload.png)

## <a name="clientconfig"></a>Часть 9. Скачивание и установка пакета конфигурации VPN-клиента
На клиентах с подключением к Azure типа "точка — сеть" должны быть установлены сертификат клиента и пакет конфигурации VPN-клиента. Для клиентов Windows доступны пакеты конфигурации VPN-клиента. 

Пакет VPN-клиента содержит данные для настройки программного обеспечения VPN-клиента, встроенного в Windows. Конфигурация зависит от сети VPN, к которой необходимо подключиться. Пакет не устанавливает никакого дополнительного программного обеспечения.

На каждом клиентском компьютере можно использовать один и тот же пакет конфигурации VPN-клиента при условии, что его версия соответствует архитектуре для клиента.

### <a name="step-1---download-the-client-configuration-package"></a>Шаг 1. Скачивание пакета конфигурации клиента

1. В колонке **Конфигурация "точка — сеть"** щелкните **Download VPN client** (Скачать VPN-клиент), чтобы открыть колонку **Download VPN client** (Скачивание VPN-клиента). Создание пакета занимает пару минут.
   
    ![Скачивание VPN-клиента, ч. 1](./media/vpn-gateway-howto-point-to-site-resource-manager-portal/downloadvpnclient1.png)
2. Выберите соответствующий для клиента пакет, а затем щелкните **Скачать**. Сохраните файл пакета конфигурации. Его нужно установить на каждом клиентском компьютере, который будет подключаться к виртуальной сети.

    ![Скачивание VPN-клиента, ч. 2](./media/vpn-gateway-howto-point-to-site-resource-manager-portal/client.png)

   * Для 64-разрядных клиентов выберите **AMD64**,
   * а для 32-разрядных — **x86**.

### <a name="step-2---install-the-client-configuration-package"></a>Шаг 2. Установка пакета конфигурации клиента

1. Скопируйте файл конфигурации на локальный компьютер, который необходимо подключить к виртуальной сети. 
2. Дважды щелкните EXE-файл, чтобы установить пакет на клиентском компьютере. Так как пакет конфигурации создали вы, он не подписан. Это означает, что может появиться предупреждение. При появлении всплывающего окна Windows SmartScreen щелкните **Дополнительно** (в левой части окна), а затем выберите **Выполнить в любом случае**, чтобы установить пакет.
3. На клиентском компьютере перейдите в раздел **Параметры сети** и щелкните **VPN**. Вы увидите подключение в списке. Оно содержит имя виртуальной сети, подключение к которой будет установлено, и будет выглядеть примерно так:
3. Установите пакет на клиентском компьютере. При появлении всплывающего окна Windows SmartScreen щелкните **Дополнительно** (в левой части окна), а затем выберите **Выполнить в любом случае**, чтобы установить пакет.
4. На клиентском компьютере перейдите в раздел **Параметры сети** и щелкните **VPN**. Вы увидите подключение в списке. Оно будет содержать имя виртуальной сети, подключение к которой будет установлено, и выглядеть примерно так: 
   
    ![VPN-клиент](./media/vpn-gateway-howto-point-to-site-resource-manager-portal/vpn.png)


## <a name="installclientcert"></a>Часть 10. Установка сертификата клиента
Для прохождения аутентификации каждому клиентскому компьютеру требуется сертификат клиента. При установке сертификата клиента потребуется пароль, созданный при экспорте сертификата клиента.

1. Скопируйте PFX-файл на клиентский компьютер.
2. Дважды щелкните PFX-файл, чтобы установить его. Не меняйте место установки.

## <a name="connect"></a>Часть 11. Подключение к Azure
1. Чтобы подключиться к виртуальной сети, откройте VPN-подключения на клиентском компьютере и найдите созданное VPN-подключение. Его имя совпадает с названием вашей виртуальной сети. Щелкните **Подключить**. Может появиться всплывающее сообщение об использовании сертификата. В таком случае щелкните **Продолжить** , чтобы использовать более высокий уровень привилегий. 
2. На странице состояния **подключения** щелкните **Подключить**. Если появится окно **Выбор сертификата** , убедитесь в том, что отображается сертификат клиента, с помощью которого вы хотите подключиться к сети. Если окно не появится, выберите нужный сертификат в раскрывающемся списке и нажмите кнопку **ОК**.
   
    ![Подключение VPN-клиента к Azure](./media/vpn-gateway-howto-point-to-site-resource-manager-portal/clientconnect.png)

    
3. Теперь следует установить подключение.
   
    ![VPN-клиент, подключенный к Azure](./media/vpn-gateway-howto-point-to-site-resource-manager-portal/connected.png)
                                                                                                                                                                           

> [!NOTE]
> Если используется сертификат, который был выдан с помощью корпоративного ЦС, и при аутентификации возникли проблемы, проверьте порядок прохождения аутентификации в сертификате клиента. Проверить список этапов аутентификации можно, дважды щелкнув сертификат клиента и выбрав **Сведения > Улучшенный ключ**. Убедитесь, что первым в списке отображается пункт "Проверка подлинности клиента" . В противном случае потребуется выдать сертификат клиента на основе шаблона User, в котором пункт "Проверка подлинности клиента" указан первым в списке. 
>
>

## <a name="verify"></a>Часть 12. Проверка подключения
1. Чтобы проверить, активно ли VPN-подключение, откройте окно командной строки от имени администратора и выполните команду *ipconfig/all*.
2. Просмотрите результаты. Обратите внимание, что полученный вами IP-адрес — это один из адресов в пуле адресов VPN-клиента подключения "точка–cеть", указанном в конфигурации. Результаты должны выглядеть примерно так:
   
        PPP adapter VNet1:
            Connection-specific DNS Suffix .:
            Description.....................: VNet1
            Physical Address................:
            DHCP Enabled....................: No
            Autoconfiguration Enabled.......: Yes
            IPv4 Address....................: 172.16.201.3(Preferred)
            Subnet Mask.....................: 255.255.255.255
            Default Gateway.................:
            NetBIOS over Tcpip..............: Enabled

## <a name="add"></a>Добавление и удаление доверенного корневого сертификата
Вы можете добавлять доверенные корневые сертификаты в Azure, а также удалять их из Azure. При удалении доверенного сертификата сертификаты клиента, созданные на его основе, не смогут подключаться к Azure с использованием подключения типа "точка — сеть". Чтобы клиенты снова смогли подключаться, необходимо установить новый сертификат клиента, созданный на основе доверенного сертификата в Azure.

### <a name="to-add-a-trusted-root-certificate"></a>Добавление доверенного корневого сертификата

В Azure можно добавить до 20 CER-файлов доверенных корневых сертификатов. Дополнительные сведения см. в разделе [Отправка доверенного корневого сертификата](#uploadfile) в этой статье.

### <a name="to-remove-a-trusted-root-certificate"></a>Удаление доверенного корневого сертификата

1. Чтобы удалить доверенный корневой сертификат, перейдите к колонке **Конфигурация "точка — сеть"** шлюза виртуальной сети.
2. В разделе колонки **Root certificate** (Корневой сертификат) найдите сертификат, который требуется удалить.
3. Нажмите кнопку с многоточием рядом с сертификатом, а затем щелкните "Удалить".

## <a name="revokeclient"></a>Отзыв сертификата клиента
Можно отозвать сертификаты клиента. Список отзыва сертификатов позволяет выборочно запрещать подключение типа "точка-сеть" на основе отдельных сертификатов клиента. Эта процедура отличается от удаления доверенного корневого сертификата. При удалении доверенного корневого сертификата (CER-файл) из Azure будет запрещен доступ для всех сертификатов клиента, созданных на основе отозванного корневого сертификата или подписанных им. Отзыв сертификата клиента, а не корневого сертификата, позволяет по-прежнему использовать другие сертификаты, созданные на основе корневого сертификата, для проверки подлинности подключения типа "точка — сеть".

Обычно корневой сертификат используется для управления доступом на уровнях группы или организации, а отозванный сертификат клиента — для точного контроля доступа для отдельных пользователей.

### <a name="to-revoke-a-client-certificate"></a>Отзыв сертификата клиента

Вы можете отозвать сертификат клиента, добавив отпечаток в список отзыва.

1. Получите отпечаток сертификата клиента. Дополнительные сведения см. в статье [Практическое руководство. Извлечение отпечатка сертификата](https://msdn.microsoft.com/library/ms734695.aspx).
2. Скопируйте данные в текстовый редактор и удалите все пробелы, чтобы предоставить отпечаток в виде непрерывной строки.
3. Перейдите к колонке **Конфигурация "точка — сеть"** шлюза виртуальной сети. Это колонка, которая использовалась для [передачи доверенного корневого сертификата](#uploadfile).
4. В разделе **Отозванные сертификаты** введите понятное имя сертификата (это не должно быть общее имя).
5. Скопируйте и вставьте строку отпечатка в поле **Отпечаток**.
6. Отпечаток будет проверен и автоматически добавлен в список отзыва. На экране появится сообщение о том, что список обновляется. 
7. После применения изменений сертификат больше не будет использоваться для подключения. Клиенты, пытающиеся подключиться с помощью этого сертификата, получат сообщение, что он недействителен.

## <a name="faq"></a>Часто задаваемые вопросы о подключениях типа "точка — сеть"

[!INCLUDE [Point-to-Site FAQ](../../includes/vpn-gateway-point-to-site-faq-include.md)]

## <a name="next-steps"></a>Дальнейшие действия
Установив подключение, можно добавить виртуальные машины в виртуальные сети. Дополнительные сведения о виртуальных машинах см. [здесь](https://docs.microsoft.com/azure/#pivot=services&panel=Compute).


