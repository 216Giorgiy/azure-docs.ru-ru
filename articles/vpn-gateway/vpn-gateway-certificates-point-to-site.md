---
title: "Создание самозаверяющих сертификатов для подключений типа &quot;точка — сеть&quot; в Azure | Документация Майкрософт"
description: "Эта статья содержит инструкции по использованию makecert для создания самозаверяющих сертификатов в Windows 10."
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 27b99f7c-50dc-4f88-8a6e-d60080819a43
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/15/2017
ms.author: cherylmc
translationtype: Human Translation
ms.sourcegitcommit: 4c8fc5b20416d59eccdf34aaea95ed158d9c04fa
ms.openlocfilehash: a3965a149fa62e5630d2b9940d4940308991aed1
ms.lasthandoff: 02/16/2017


---
# <a name="working-with-self-signed-certificates-for-point-to-site-connections"></a>Работа с самозаверяющими сертификатами для подключений типа "точка — сеть"
Эта статья поможет создать самозаверяющий сертификат с помощью **makecert**, а затем на его основе создать сертификаты клиента. Для подключений типа "точка — сеть" предпочтительнее всего использовать собственное корпоративное решение для управления сертификатами. Обязательно создавайте сертификаты клиента с общим именем в формате 'name@yourdomain.com',, а не в формате "имя домена NetBIOS\имя пользователя".

Если у вас нет корпоративного решения, то чтобы разрешить клиентам P2S подключаться к виртуальной сети, потребуется самозаверяющий сертификат. Самозаверяющие сертификаты можно создавать с помощью PowerShell, но такие сертификаты не содержат поля, необходимые Azure для аутентификации подключений типа "точка — сеть". Было проверено создание сертификатов, которые совместимы с подключениями типа "точка — сеть", с помощью makeсert. Makecert вполне подходит для использования с конфигурациями подключений типа "точка — сеть".

## <a name="create-a-self-signed-certificate"></a>Создание самозаверяющего сертификата
Ниже приведены инструкции по созданию самозаверяющего сертификата с помощью makeсert. Они не зависят от модели развертывания. Они подходят как для модели с использованием диспетчера ресурсов, так и для классической модели.

### <a name="to-create-a-self-signed-certificate"></a>Создание самозаверяющего сертификата
1. На компьютере под управлением Windows 10 скачайте и установите [пакет средств разработки программного обеспечения (SDK) для Windows для Windows 10](https://dev.windows.com/en-us/downloads/windows-10-sdk).
2. После установки служебную программу makecert.exe можно найти по такому пути: C:\Program Files (x86)\Windows Kits\10\bin\<arch>. Откройте командную строку от имени администратора и перейдите в расположение служебной программы makecert. Можно использовать приведенный ниже пример.

        cd C:\Program Files (x86)\Windows Kits\10\bin\x64

3. Создайте и установите сертификат в личном хранилище сертификатов на компьютере. В следующем примере создается соответствующий *CER-файл* , передаваемый в Azure при настройке подключений типа "точка — сеть". Замените ARMP2SRootCert и ARMP2SRootCert.cer именем, которое необходимо использовать для сертификата.<br><br>Сертификат будет расположен в хранилище сертификатов: Certificates - <текущий_пользователь>\Personal\Certificates.
   
        makecert -sky exchange -r -n "CN=ARMP2SRootCert" -pe -a sha1 -len 2048 -ss My "ARMP2SRootCert.cer"

### <a name="a-namerootpublickeyato-obtain-the-public-key"></a><a name="rootpublickey"></a>Получение открытого ключа
Открытый ключ для корневого сертификата является частью конфигурации VPN-шлюза для подключений типа "точка — сеть" и передается в Azure. 

1. Для получения из сертификата файла в формате CER откройте **certmgr.msc**. Найдите корневой самозаверяющий сертификат (обычно он находится в папке Certificates - <текущий_пользователь>\Personal\Certificates) и щелкните его правой кнопкой мыши. Щелкните **Все задачи** > **Экспорт**. Откроется **мастера экспорта сертификатов**.
2. В мастере нажмите кнопку **Далее**. Выберите **Нет, не экспортировать закрытый ключ** и снова нажмите кнопку **Далее**.
3. На странице **Формат экспортируемого файла** выберите **Файлы X.509 (.CER) в кодировке Base-64** и нажмите кнопку **Далее**. 
4. На странице **Имя экспортируемого файла** нажмите кнопку **Обзор**, чтобы перейти в расположение для экспорта сертификата. В поле **Имя файла**введите имя для файла сертификата. Нажмите кнопку **Далее**.
5. Нажмите кнопку **Готово** , чтобы экспортировать сертификат. Вы увидите сообщение **Экспорт выполнен успешно**. Нажмите кнопку **ОК**, чтобы закрыть мастер.

### <a name="export-the-self-signed-certificate-optional"></a>Экспорт самозаверяющего сертификата (необязательно)
Может возникнуть необходимость экспортировать самозаверяющий сертификат и сохранить его в надежном месте. При необходимости позднее можно будет установить его на другом компьютере и создать дополнительные сертификаты клиента или экспортировать другой CER-файл. Любой компьютер, на котором установлен сертификат клиента и настроены соответствующие параметры клиента VPN, может подключиться к виртуальной сети через подключение типа "точка — сеть". По этой причине необходимо, чтобы сертификаты клиента создавались и устанавливались только тогда, когда требуется, и чтобы этот самозаверяющий сертификат был сохранен в надежном месте.

Чтобы экспортировать самозаверяющий сертификат в формате PFX, выберите корневой сертификат и выполните те же действия, что описаны в разделе [Экспорт сертификата клиента](#clientkey) .

## <a name="create-and-install-client-certificates"></a>Создание и установка сертификатов клиента
Не устанавливайте самозаверяющий сертификат непосредственно на клиентский компьютер. Нужно создать сертификат клиента из самозаверяющего сертификата. Затем его следует экспортировать и установить на клиентском компьютере. Приведенные ниже инструкции не зависят от модели развертывания. Они подходят как для модели с использованием диспетчера ресурсов, так и для классической модели.

### <a name="part-1---generate-a-client-certificate-from-a-self-signed-certificate"></a>Часть 1. Создание сертификата клиента из самозаверяющего сертификата
Ниже описан один из способов создания сертификата клиента из самозаверяющего сертификата. Из одного сертификата можно создать несколько сертификатов клиента. Затем каждый сертификат клиента можно экспортировать и установить на клиентском компьютере. 

1. На компьютере, на котором вы создали самозаверяющий сертификат, откройте командную строку от имени администратора.
2. Измените и запустите пример, чтобы создать сертификат клиента.
    * Замените *ARMP2SRootCert* именем самозаверяющего корня, из которого создается сертификат клиента. Убедитесь, что вы используете имя корневого сертификата. Это значение "CN =", которое было указано при создании самозаверяющего корневого сертификата.
    * Замените *ClientCertificateName* именем, которое следует использовать для создаваемого сертификата клиента.<br><br>Если выполнить приведенную ниже команду без изменений, в ваше хранилище личных сертификатов будет добавлен сертификат клиента с именем ClientCertificateName, созданный из корневого сертификата ARMP2SRootCert.

            makecert.exe -n "CN=ClientCertificateName" -pe -sky exchange -m 96 -ss My -in "ARMP2SRootCert" -is my -a sha1


### <a name="a-nameclientkeyapart-2---export-a-client-certificate"></a><a name="clientkey"></a>Часть 2. Экспорт сертификата клиента                                                                                                                        

1. Для экспорта сертификата клиента запустите **certmgr.msc**. Щелкните правой кнопкой мыши сертификат, который нужно экспортировать, щелкните **Все задачи** и выберите **Экспорт**. Откроется **мастера экспорта сертификатов**.
2. В мастере экспорта сертификатов нажмите кнопку **Далее**, выберите **Да, экспортировать закрытый ключ** и снова нажмите кнопку **Далее**.
3. На странице **Формат экспортируемого файла** оставьте настройки по умолчанию. Нажмите кнопку **Далее**. 
4. На странице **Безопасность** следует защитить закрытый ключ. Если вы решите использовать пароль, обязательно запишите или запомните пароль, заданный для этого сертификата. Нажмите кнопку **Далее**.
5. На странице **Имя экспортируемого файла** нажмите кнопку **Обзор**, чтобы перейти в расположение для экспорта сертификата. В поле **Имя файла**введите имя для файла сертификата. Нажмите кнопку **Далее**.
6. Нажмите кнопку **Готово** , чтобы экспортировать сертификат.    

### <a name="part-3---install-a-client-certificate"></a>Часть 3. Установка сертификата клиента
Каждый клиент, который вы хотите подключить к виртуальной сети с использованием подключения типа "точка-сеть", должен иметь установленный сертификат клиента. Этот сертификат является дополнением к обязательному пакету конфигурации VPN. Описанные ниже шаги помогут вам установить сертификат клиента вручную.

1. Найдите *PFX* -файл и скопируйте его на клиентский компьютер. На клиентском компьютере дважды щелкните *PFX* -файл, чтобы установить его. Для параметра **Расположение хранилища** оставьте значение **Текущий пользователь**, а затем нажмите кнопку **Далее**.
2. На странице **Файл для импорта** не вносите никаких изменений. Нажмите кнопку **Далее**.
3. На странице **Защита с помощью закрытого ключа** введите пароль для сертификата (если он используется) или проверьте, правильно ли выбран субъект безопасности, который устанавливает сертификат. Затем нажмите кнопку **Далее**.
4. На странице **Хранилище сертификатов** оставьте расположение по умолчанию и нажмите кнопку **Далее**.
5. Нажмите кнопку **Готово** На странице **Предупреждение системы безопасности** для установки сертификата щелкните **Да**. Можно спокойно нажать кнопку "Да", так как сертификат создали вы. Сертификат успешно импортирован.

## <a name="next-steps"></a>Дальнейшие действия
Продолжайте настраивать параметры конфигурации типа "точка-сеть". 

* Действия для модели развертывания с помощью **Resource Manager** см. в статье [Настройка подключения типа "точка — сеть" к виртуальной сети с помощью PowerShell](vpn-gateway-howto-point-to-site-rm-ps.md). 
* Действия для **классической** модели развертывания см. в статье [Настройка VPN-подключения типа "точка — сеть" к виртуальной сети с помощью классического портала](vpn-gateway-point-to-site-create.md).


