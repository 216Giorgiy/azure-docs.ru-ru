<properties 
   pageTitle="Создание самозаверяющих сертификатов для распределенных конфигураций подключения типа ";точка-сеть"; через VPN-шлюз с помощью makecert | Microsoft Azure"
   description="Эта статья содержит сведения об использовании makecert для создания самозаверяющих корневых сертификатов в Windows 10."
   services="vpn-gateway"
   documentationCenter="na"
   authors="cherylmc"
   manager="carmonm"
   editor=""
   tags="azure-resource-manager"/>
<tags 
   ms.service="vpn-gateway"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="01/15/2016"
   ms.author="cherylmc" />

# Работа с самозаверяющими корневыми сертификатами для конфигураций типа "точка-сеть"

Задачи, описанные в этой статье, помогут создать корневой сертификат с помощью makeсert и создать на его основе сертификаты клиента. Здесь предполагается использование makeсert в операционной системе Windows 10.

## Создание самозаверяющего корневого сертификата

Makecert — один из способов создания самозаверяющего корневого сертификата. Шаги ниже помогут вам создать самозаверяющий корневой сертификат с помощью makeсert. Они не зависят от модели развертывания. Они подходят как для модели с использованием диспетчера ресурсов, так и для классической модели.

### Создание самозаверяющего корневого сертификата

1. На компьютере под управлением Windows 10 скачайте и установите [пакет средств разработки программного обеспечения (SDK) для Windows для Windows 10](https://dev.windows.com/ru-RU/downloads/windows-10-sdk).

2. После установки служебную программу makecert.exe можно найти по такому пути: C:\\Program Files (x86)\\Windows Kits\\10\\bin<arch>.
		
	Пример:
	
		C:\Program Files (x86)\Windows Kits\10\bin\x64\makecert.exe

3. Затем создайте и установите корневой сертификат в личном хранилище сертификатов на компьютере. В приведенном ниже примере создается соответствующий *CER*-файл, который вам потребуется отправить позднее. Выполните от имени администратора следующую команду, где *RootCertificateName* — имя, которое вы хотите использовать для сертификата.

	Примечание. Если выполнить команду без изменений, будет создан корневой сертификат и соответствующий файл *RootCertificateName.cer*. CER-файл можно найти в каталоге, из которого была выполнена команда. Сертификат будет расположен в хранилище сертификатов: Текущий пользователь\\Personal\\Certificates.

    	makecert -sky exchange -r -n "CN=RootCertificateName" -pe -a sha1 -len 2048 -ss My "RootCertificateName.cer"

	>[AZURE.NOTE]Поскольку был создан корневой сертификат, из которого будут создаваться клиентские сертификаты, вы можете экспортировать этот сертификат вместе с его закрытым ключом и сохранить в безопасном месте, где его можно будет восстановить.

## Создание, экспорт и установка сертификатов клиента

Вы можете создать сертификат клиента из самозаверяющего корневого сертификата, а затем экспортировать и установить его. Приведенные ниже действия не зависят от модели развертывания. Они подходят как для модели с использованием диспетчера ресурсов, так и для классической модели.

### Создание сертификата клиента из самозаверяющего корневого сертификата

Ниже описан один из способов создания сертификата клиента из самозаверяющего корневого сертификата. Из одного корневого сертификата можно создать несколько сертификатов клиента. Затем каждый сертификат клиента можно экспортировать и установить на клиентском компьютере.

1. На компьютере, на котором вы создали самозаверяющий корневой сертификат, откройте командную строку от имени администратора.

2. Смените каталог, выбрав папку, в которую хотите сохранить файл сертификата клиента. Имя *RootCertificateName* обозначает созданный вами самозаверяющий корневой сертификат. Если выполнить приведенную ниже команду (заменив строку RootCertificateName именем вашего корневого сертификата), в ваше хранилище личных сертификатов будет добавлен сертификат клиента ClientCertificateName.

3. Введите следующую команду:

    	makecert.exe -n "CN=ClientCertificateName" -pe -sky exchange -m 96 -ss My -in "RootCertificateName" -is my -a sha1

4. Все сертификаты находятся в хранилище сертификатов на вашем компьютере в папке Текущий пользователь\\Personal\\Certificates. С помощью этой процедуры можно создать любое количество сертификатов.

### Экспорт сертификата клиента

1. Для экспорта сертификата клиента используйте команду *certmgr.msc*. Щелкните правой кнопкой мыши сертификат, который надо экспортировать, выберите элемент **Все задачи** и нажмите кнопку **Экспорт**. Откроется мастер экспорта сертификатов.

2. В мастере экспорта сертификатов нажмите кнопку **Далее**, выберите **Да, экспортировать закрытый ключ** и снова нажмите кнопку **Далее**.

3. На странице **Формат экспортируемого файла** оставьте настройки по умолчанию. Нажмите кнопку **Далее**.
 
4. На странице **Безопасность** следует защитить закрытый ключ. Если вы решите использовать пароль, обязательно запишите или запомните пароль, заданный для этого сертификата. Затем нажмите кнопку **Далее**.

5. На странице **Файл для экспорта** нажмите кнопку **Обзор**, чтобы перейти в расположение, куда нужно экспортировать сертификат. В поле **Имя файла** введите имя для файла сертификата. Нажмите кнопку **Далее**.

6. Нажмите кнопку **Готово**, чтобы экспортировать сертификат.

### Установка сертификата клиента

Каждый клиент, который вы хотите подключить к виртуальной сети с использованием подключения типа "точка-сеть", должен иметь установленный сертификат клиента. Этот сертификат является дополнением к обязательному пакету конфигурации VPN. Описанные ниже шаги помогут вам установить сертификат клиента вручную.

1. Найдите *PFX*-файл и скопируйте его на клиентский компьютер. На клиентском компьютере дважды щелкните *PFX*-файл, чтобы установить его. Для параметра **Расположение хранилища** оставьте значение **Текущий пользователь**, а затем нажмите кнопку **Далее**.

2. На странице **Файл для импорта** не вносите никаких изменений. Нажмите кнопку **Далее**.

3. На странице **Защита с помощью закрытого ключа** введите пароль для сертификата (если он используется) или проверьте, правильно ли выбран субъект безопасности, который устанавливает сертификат. Затем нажмите кнопку **Далее**.

4. На странице **Хранилище сертификатов** оставьте расположение по умолчанию и нажмите кнопку **Далее**.

5. Нажмите кнопку **Готово** На странице **Предупреждение системы безопасности** для установки сертификата щелкните **Да**. Сертификат успешно импортирован.

## Дальнейшие действия

Продолжайте настраивать параметры конфигурации типа "точка-сеть".

- Действия для модели развертывания с использованием **диспетчера задач** см. в статье [Configure a Point-to-Site connection to a virtual network using PowerShell](vpn-gateway-howto-point-to-site-rm-ps.md) (Настройка подключения типа "точка-сеть" к виртуальной сети с помощью PowerShell). 
- Действия для **классической** модели развертывания см. в статье [Настройка VPN-подключения типа "точка–сеть" к виртуальной сети](vpn-gateway-point-to-site-create.md).

<!---HONumber=AcomDC_0121_2016-->