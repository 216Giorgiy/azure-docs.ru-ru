<properties 
	pageTitle="Эффективные запросы списка" 
	description="Узнайте, как уменьшить количество элементов, возвращаемых в списке, а также количество сведений, возвращаемых для каждого элемента." 
	services="batch" 
	documentationCenter="" 
	authors="davidmu1" 
	manager="timlt" 
	editor="tysonn"/>

<tags 
	ms.service="multiple" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.tgt_pltfrm="vm-windows" 
	ms.workload="multiple"
	ms.date="05/09/2015" 
	ms.author="davidmu"/>

# Эффективные запросы списка

Следующие методы являются примерами операций, которые приходится выполнять практически всем приложениям, использующим пакетную службу Azure, и обычно им приходится выполнять эти операции часто.

- [ListTasks](https://msdn.microsoft.com/library/azure/microsoft.azure.batch.iworkitemmanager.listtasks.aspx);
- [ListJobs](https://msdn.microsoft.com/library/azure/microsoft.azure.batch.iworkitemmanager.listjobs.aspx);
- [ListWorkitems](https://msdn.microsoft.com/library/azure/microsoft.azure.batch.iworkitemmanager.listworkitems.aspx);
- [ListPools](https://msdn.microsoft.com/library/azure/microsoft.azure.batch.ipoolmanager.listpools.aspx);
- [ListCertificates](https://msdn.microsoft.com/library/azure/microsoft.azure.batch.icertificatemanager.listcertificates.aspx).

Распространенным вариантом использования является отслеживание. Например, чтобы определить емкость и состояние пула, нужно опросить все его виртуальные машины. Другим примером служит запрос задач задания для выявления задач в очереди. В некоторых случаях необходим широкий набор данных, а в других — только общее количество элементов или объектов в определенном состоянии.

Важно понимать, что количество элементов, которые могут быть возвращены, бывает очень большим, и объем данных, необходимый для представления списка элементов, также может быть очень большим. Простое опрашивание большого количества элементов, возвращающее множество результатов, может привести к ряду проблем.

- Время ответа API пакетной службы может стать слишком большим. Чем большее количество элементов, тем больше пакетной службе нужно времени на обработку запроса. Большие количества элементов нужно разбивать на фрагменты, поэтому, чтобы получить все элементы для одного списка, может потребоваться несколько вызовов API службы от клиентской библиотеки к службе.
- Обработка API приложением, которое вызывает пакетную службу, займет тем больше времени, чем больше элементов нужно обработать.
- С ростом количества и размера элементов приложение, вызывающее пакетную службу, будет потреблять больше памяти.
- Большее количество или размер элементов приводит к увеличению сетевого трафика. Передача займет больше времени и, в зависимости от архитектуры приложения, может привести к увеличению расходов на Интернет для данных, передаваемых за пределы области учетной записи пакетной службы.

API пакетной службы предоставляет возможность сократить число элементов, возвращаемых в списке, а также уменьшить объем сведений, возвращаемых для каждого элемента. Для операций списка можно указать параметр типа [DetailLevel](https://msdn.microsoft.com/library/azure/microsoft.azure.batch.detaillevel.aspx). DetailLevel — это абстрактный базовый класс. Фактически вам нужно создать и передать в качестве параметра объект [ODATADetailLevel](https://msdn.microsoft.com/library/azure/microsoft.azure.batch.odatadetaillevel.aspx).

Ниже приведена информация, которая касается всех API.

- Имя каждого свойства — это строка, соответствующая свойству объекта.
- Имена всех свойств чувствительны к регистру, но для значений свойств регистр значения не имеет.
- Строки даты и времени могут иметь один из двух форматов и должны начинаться с DateTime.
	- W3CDTF (например, creationTime gt DateTime’2011-05-08T08:49:37Z’).
	- RFC1123 (например, creationTime gt DateTime’Sun, 08 May 2011 08:49:37 GMT).
- Строки с логическими выражениями должны иметь значение True или False.
- Если указано недопустимое свойство или оператор, будет создано исключение с внутренним исключением «400 (неправильный запрос)».
- Параметр DetailLevel с предложениями Select и Expand может также передаваться в соответствующие методы Get. Например, IPoolManager.GetPool().

Объект ODataDetailLevel имеет три открытых свойства, которые можно указать в конструкторе или напрямую. Эти три свойства представляют собой строки:

- [FilterClause](#filter). Фильтрация и потенциальное уменьшение числа возвращаемых элементов.
- [SelectClause](#select). Указание конкретных возвращаемых значений свойств для уменьшения размера элемента и ответа.
- [ExpandClause](#expand). Возвращение всех необходимых данных за один, а не несколько вызовов.

### <a id="filter"></a> FilterClause

Количество возвращаемых элементов можно уменьшить с помощью строки фильтра. Чтобы получить только необходимые элементы, можно указать одно или несколько значений свойств. Например, включить только активные рабочие элементы, включить только выполняемые задачи для задания, включить только виртуальные машины, готовые к выполнению задач.

[FilterClause](https://msdn.microsoft.com/library/azure/microsoft.azure.batch.odatadetaillevel.filterclause.aspx) — это строка, состоящая из одного или нескольких выражений, а каждое выражение состоит из имени свойства, оператора и значения. Для каждого вызова API можно указать только определенные свойства, равно как и операторы, поддерживаемые каждым свойством. Несколько выражений можно объединить с помощью логических операторов And и Or.

Например, фильтр для получения списка задач, может быть таким:

	startswith(name, 'MyTask') and (state eq 'Running')

### <a id="select"></a> SelectClause

Значения свойств, которые возвращаются для каждого элемента, можно ограничить с помощью строки выбора. Для элемента можно указать список свойств, после чего будут возвращаться только значения этих свойств.

[SelectClause](https://msdn.microsoft.com/library/azure/microsoft.azure.batch.odatadetaillevel.selectclause.aspx) — это строка, содержащая список имен свойств, разделенных запятыми. Можно указать все свойства элемента, возвращаемого операцией списка.

	"name, state, stateTransitionTime"

### <a id="expand"></a> ExpandClause

Количество вызовов API можно уменьшить с помощью строки развертывания. Более подробные сведения для каждого элемента списка можно получить с помощью вызова одного списка API (вместо получения списка и последующего вызова для каждого элемента в списке).

Предложение [ExpandClause](https://msdn.microsoft.com/library/azure/microsoft.azure.batch.odatadetaillevel.expandclause.aspx) похоже на предложение Select — оно управляет возвратом определенных данных в результатах. Предложение развертывания поддерживается только для списка рабочих элементов, списка задач, списка пулов и списка заданий. В настоящее время оно поддерживает только статистические данные. Если необходимы все свойства и предложение выбора не указано, для получения статистических сведений следует использовать предложение развертывания. Если предложение выбора используется для получения подмножества свойств, то в предложении выбора можно указать статистику, а для предложения развертывания можно оставить значение null.

> [AZURE.NOTE]Для вызовов API списка мы советуем всегда использовать предложения фильтрации и выбора. Это обеспечит максимальную эффективность и лучшую производительность приложения.

<!---HONumber=58_postMigration-->