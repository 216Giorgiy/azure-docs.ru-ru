<properties
	pageTitle="Обзор функций пакетной службы Azure для разработчиков | Microsoft Azure"
	description="Ознакомьтесь с функциями пакетной службы и ее API-интерфейсов с точки зрения разработки."
	services="batch"
	documentationCenter=".net"
	authors="mmacy"
	manager="timlt"
	editor=""/>

<tags
	ms.service="batch"
	ms.devlang="multiple"
	ms.topic="get-started-article"
	ms.tgt_pltfrm="na"
	ms.workload="big-compute"
	ms.date="06/17/2016"
	ms.author="marsma"/>

# Обзор функций пакетной службы для разработчиков

В этом обзоре рассматриваются основные компоненты и функции пакетной службы Azure, которые могут использовать разработчики для создания решений для крупномасштабных параллельных вычислительных нагрузок.

Как при разработке распределенного вычислительного приложения или службы, которая отправляет прямые вызовы [REST API пакетной службы][batch_rest_api], так и при использовании одного из [пакетов SDK для пакетной службы](batch-technical-overview.md#batch-development-apis) вам понадобятся многие ресурсы и функции, описанные в этой статье.

> [AZURE.TIP] Общие сведения о пакетной службе Azure см. в [этой статье](batch-technical-overview.md).

## Рабочий процесс пакетной службы

Далее приводится обобщенная схема рабочего процесса практически для всех приложений и служб, использующих пакетную службу для обработки параллельных рабочих нагрузок.

1. Отправьте **файлы данных**, которые необходимо обработать, в учетную запись [службы хранилища Azure][azure_storage]. В пакетную службу встроена поддержка доступа к хранилищу BLOB-объектов Azure, и эти файлы могут быть скачаны на [вычислительные узлы](#compute-node) в ходе выполнения задач.

2. Отправьте **файлы приложения**, которые будут выполнять задачи. Это могут быть двоичные файлы или сценарии и их зависимости. Они выполняются с помощью задач в заданиях. Эти файлы можно получить из учетной записи службы хранилища и скачать на вычислительные узлы с помощью задач. Либо можно использовать [пакеты приложений](#application-packages) пакетной службы для развертывания приложений и управления ими.

3. Создайте [пул](#pool) вычислительных узлов. При создании пула указывается количество вычислительных узлов, их размер и операционная система. Каждая задача в задании выполняется на одном из узлов в пуле.

4. Создайте [задание](#job). Задание — это набор задач. Каждое задание назначается конкретному пулу, в котором будут выполняться задачи этого задания.

5. Добавьте [задачи](#task) в задание. Каждая задача выполняет приложение или сценарий, загруженные для обработки файлов данных, скачанных из учетной записи службы хранилища. Выходные данные каждой задачи после ее завершения могут быть отправлены в службу хранилища Azure.

6. Отслеживайте ход выполнения заданий и получайте выходные данные задач из службы хранилища Azure.

В следующих разделах вы узнаете о каждом из ресурсов, перечисленных выше в схеме рабочего процесса, а также о многих других возможностях пакетной службы, которые вы сможете использовать в сценариях распределенных вычислений.

> [AZURE.NOTE] Для использования пакетной службы вам потребуется [учетная запись пакетной службы](batch-account-create-portal.md). Также почти любое решение предполагает наличие учетной записи [службы хранилища Azure][azure_storage] для хранения и извлечения файлов. В настоящее время пакетная служба поддерживает только учетные записи хранения **общего назначения**, как описано в шаге 5 раздела [Создайте учетную запись хранения](../storage/storage-create-storage-account.md#create-a-storage-account) в статье [Об учетных записях хранения Azure](../storage/storage-create-storage-account.md).

## Компоненты пакетной службы

Для всех решений, использующих пакетную службу, требуются такие ресурсы, как учетная запись, вычислительный узел, пул, задания и задачи. Другие, например расписания заданий и пакеты приложений, являются полезными дополнительными функциями.

- [Учетная запись.](#account)
- [Вычислительный узел.](#compute-node)
- [Пул.](#pool)
- [Задание.](#job)

  - [Расписания заданий](#scheduled-jobs)

- [Задача.](#task)

  - [Задача запуска](#start-task)
  - [Задача диспетчера заданий](#job-manager-task)
  - [Задачи подготовки и завершения заданий.](#job-preparation-and-release-tasks)
  - [Задачи с несколькими экземплярами](#multi-instance-tasks)
  - [Зависимости задачи](#task-dependencies)

- [Пакеты приложений](#application-packages)

## Учетная запись

Учетная запись Пакетной службы — это уникально идентифицируемая сущность в Пакетной службе. Вся обработка данных привязана к учетной записи пакетной службы. Для выполнения операций пакетной службы нужно имя и один из ключей учетной записи. [Создать учетную запись пакетной службы Azure и управлять ею можно на портале Azure](batch-account-create-portal.md).

## Вычислительный узел.

Вычислительный узел — это виртуальная машина Azure, назначенная для обработки определенной рабочей нагрузки вашего приложения. Размер узла определяет количество ядер ЦП, объем памяти и размер локальной файловой системы, которые выделяются узлу. Вы можете создать пулы узлов Windows или Linux с помощью облачных служб или образов из магазина виртуальных машин Marketplace (дополнительные сведения см. в разделе [Пул](#pool) ниже).

На узлах может выполняться любой исполняемый файл или сценарий, поддерживаемый его операционной системой: сценарии EXE, CMD, BAT и PowerShell для Windows и двоичные файлы, сценарии оболочки и Python для Linux.

Для всех вычислительных узлов в пакетной службе характерно следующее:

- Стандартная [структура папок](#files-and-directories) и связанные [переменные среды](#environment-settings-for-tasks), на которые могут ссылаться задачи.
- Параметры **брандмауэра**, настроенные для управления доступом.
- [Удаленный доступ](#connecting-to-compute-nodes) к узлам Windows (по протоколу RDP) и Linux (по протоколу SSH).

> [AZURE.NOTE] Поддержка Linux в пакетной службе в настоящее время находится в статусе предварительной версии. Дополнительные сведения см. в статье [Подготовка вычислительных узлов Linux в пулах пакетной службы Azure](batch-linux-nodes.md).

## Пул

Пул — это коллекция узлов, на которых выполняется приложение. Пул может быть создан как вами (вручную), так и пакетной службой (автоматически) при указании выполняемых работ. Вы можете создавать и изменять пулы в соответствии с потребностями ресурсов своего приложения. Пул может использоваться только той учетной записью пакетной службы, в которой он был создан. Учетная запись Пакетной службы может содержать более одного пула.

Пулы пакетной службы Azure основаны на базовой вычислительной платформе Azure. Они удобны для крупномасштабных операций выделения ресурсов, установки приложений, распространения данных и мониторинга работоспособности. Кроме того, пулы обеспечивают [масштабирование](#scaling-compute-resources), то есть гибкое изменение количества вычислительных узлов в пуле.

Каждому узлу, который добавляется в пул, присваивается уникальное имя и IP-адрес. При удалении узла из пула будут потеряны любые изменения, внесенные в операционную систему или файлы. Имя и IP-адрес удаленного узла освобождаются для использования в других целях. Когда узел покидает пул, он перестает существовать.

При создании пула можно указать следующие атрибуты:

- **Операционная система** и **версия** вычислительного узла.

	При выборе операционной системы узлов в пуле предоставляется два варианта: **конфигурация виртуальной машины** и **конфигурация облачных служб**.

	Параметр **Конфигурация виртуальной машины** предоставляет образы Linux и Windows для вычислительных узлов из [магазина виртуальных машин Azure Marketplace][vm_marketplace]. При создании пула, содержащего узлы конфигурации виртуальных машин, необходимо указать не только размер узлов, но и **ссылку на образ виртуальной машины** и **номер SKU агента узла** пакетной службы для установки на узлах. Дополнительные сведения об указании этих свойств пула см. в статье [Подготовка вычислительных узлов Linux в пулах пакетной службы Azure](batch-linux-nodes.md).

	Параметр **Cloud Services Configuration** (Конфигурация облачных служб) предоставляет *только* вычислительные узлы Windows. Доступные операционные системы пулов с конфигурацией облачных служб перечислены в статье [Таблица совместимости выпусков гостевых ОС Azure и пакетов SDK](../cloud-services/cloud-services-guestos-update-matrix.md). При создании пула, содержащего узлы облачных служб, необходимо указать только размер узла и соответствующее *семейство ОС*. При создании пулов вычислительных узлов Windows чаще всего используются облачные службы.

    - *Семейство ОС* также определяет, какие версии .NET устанавливаются вместе с операционной системой.
	- Вы можете выбрать для узлов *версию ОС* так же, как и для рабочих ролей в облачных службах (сведения о рабочих ролях см. в разделе [Информация об облачных службах](../cloud-services/cloud-services-choose-me.md#tell-me-about-cloud-services) в статье [с общими сведениями об облачных службах](../cloud-services/cloud-services-choose-me.md)).
    - Как и для рабочих ролей, мы рекомендуем указывать значение `*` в качестве *версии ОС*. Тогда узлы будут обновляться автоматически, и вам не нужно будет выполнять дополнительные действия при выходе новых версий. Выбор конкретной версии ОС обычно нужен только для гарантии совместимости приложений. Это позволит протестировать обратную совместимость перед установкой обновлений. После успешной проверки вам нужно будет обновить *версию ОС* для пула и установить новый образ ОС. Все выполняемые задачи будут при этом прерваны и повторно поставлены в очередь.

- **Размер узлов**.

	Размеры вычислительных узлов, доступные в **конфигурации облачных служб**, приведены в статье [Размеры для облачных служб](../cloud-services/cloud-services-sizes-specs.md). Пакетная служба поддерживает все размеры облачных служб, кроме `ExtraSmall`.

	Размеры вычислительных узлов, доступные в **конфигурации виртуальной машины**, перечислены в статьях [Размеры виртуальных машин в Azure](../virtual-machines/virtual-machines-linux-sizes.md) для Linux и [Размеры виртуальных машин в Azure](../virtual-machines/virtual-machines-windows-sizes.md) для Windows. Пакетная служба поддерживает все размеры виртуальных машин Azure, кроме `STANDARD_A0`. Для хранилища класса Premium также не поддерживаются размеры таких серий: `STANDARD_GS`, `STANDARD_DS` и `STANDARD_DSV2`.

	При выборе размера узла следует учитывать характеристики и требования приложений, которые будут выполняться на вычислительных узлах. Обычно при выборе размера узла предполагается, что единовременно на узле будет выполняться одна задача. Для выбора правильного размера узла, позволяющего снизить затраты, также следует учитывать такие аспекты, как многопоточность приложений и требуемый объем памяти. Вы можете настроить [параллельное выполнение](batch-parallel-node-tasks.md) нескольких задач, а значит и нескольких экземпляров приложения. В таком случае обычно выбирается более крупный узел. Дополнительные сведения см. в описании атрибута "Политика планирования задач" ниже.

	Все узлы в пуле имеют одинаковый размер. Если вы планируете выполнять приложения с разными требованиями к системе и/или с разной нагрузкой, вам следует использовать отдельные пулы.

- **Целевое количество узлов**.

	Это количество вычислительных узлов, которые нужно развернуть в пуле. Оно называется *целевым*, так как в некоторых случаях пул не может достигнуть требуемого числа узлов. Это может произойти из-за достижения [квоты на ядра](batch-quota-limit.md#batch-account-quotas) для учетной записи пакетной службы или если примененная к пулу формула автоматического масштабирования ограничивает максимальное количество узлов (см. описание атрибута *Политика масштабирования* ниже).

- **Политика масштабирования**.

	Вместо указания статического количества узлов можно написать [формулу автоматического масштабирования](#scaling-compute-resources) и применить ее к пулу. По этой формуле пакетная служба будет периодически вычислять и изменять количество узлов в пуле в зависимости от выбранных вами параметров пула, заданий и задач.

- **Политика планирования задач**.

	Параметр конфигурации [Максимальное число заданий на узел](batch-parallel-node-tasks.md) определяет максимальное число задач, которые могут параллельно выполняться на каждом вычислительном узле пула. По умолчанию устанавливается выполнение только одной задачи на узле в любое время. Но в некоторых ситуациях выполнение нескольких задач на одном узле будет более правильным выбором. Сведения о преимуществах выполнения нескольких задач на узле см. в разделе [Пример сценария](batch-parallel-node-tasks.md#example-scenario) в [этой статье](batch-parallel-node-tasks.md).

	Вы также можете выбрать *тип заполнения*. Пакетная служба может равномерно распределять задачи между всеми узлами в пуле или назначать каждому узлу максимально возможное число задач, прежде чем переходить к загрузке следующего узла пула.

- **Состояние взаимодействия** между вычислительными узлами.

	В большинстве случаев задачи работают независимо друг от друга и взаимодействие между ними не требуется. Но в некоторых приложениях задачи должны взаимодействовать (например, при использовании [задач с несколькими экземплярами](batch-mpi.md)).

	Вы можете разрешить **обмен данными между узлами**, входящими в один пул. При включении обмена данными между узлами узлы в пулах с конфигурацией облачных служб могут взаимодействовать друг с другом через порты с номерами выше 1100. При этом пулы с конфигурацией виртуальной машины не ограничивают трафик через какой-либо порт.

	Обратите внимание, что включение обмена данными между узлами также влияет на размещение узлов в кластерах и из-за ограничений развертывания может ограничить максимальное количество узлов в пуле. Если приложению не требуется обмен данными между узлами, пакетная служба может выделить для пула большое количество узлов из разных кластеров и центров обработки данных. Это позволяет увеличить производительность параллельной обработки.

- **Задача запуска** для вычислительных узлов.

	*Задача запуска* (необязательный параметр) будет выполняться на каждом узле по мере его присоединения к пулу, а также при каждом перезапуске или пересоздании образа узла. Она особенно полезна для подготовки вычислительных узлов к выполнению таких операций, как установка приложений, которые будут использовать задачи.

> [AZURE.IMPORTANT] Для всех учетных записей пакетной службы установлена **квота** по умолчанию, которая ограничивает количество **ядер** (и, следовательно, вычислительных узлов) в учетной записи. Дополнительные сведения о квотах по умолчанию и указания по [увеличению квоты](batch-quota-limit.md#increase-a-quota) (например, максимального количества ядер в учетной записи пакетной службы) см. в статье [Квоты и ограничения пакетной службы Azure](batch-quota-limit.md). Если возник вопрос о том, почему пул не использует больше определенного количества узлов, причиной может быть квота на ядра.

## Job

Задание представляет собой набор задач. Оно управляет порядком выполнения вычислений каждой задачей на вычислительных узлах в пуле.

- Задание указывает **пул**, в котором будет выполняться работа. Вы можете создавать отдельный пул для каждого задания или использовать один пул для множества заданий. Кроме того, вы можете создавать пул для каждого задания, включенного в расписание, или единый пул для всех заданий в одном расписании.
- Вы можете указать **приоритет задания**, но это необязательный параметр. Если вы создаете задание с более высоким приоритетом, чем у других выполняющихся заданий, его задачи добавляются в очередь перед задачами из заданий с низким приоритетом. Задачи с более низким приоритетом, которые уже выполняются, прерываться не будут.
- Вы можете задать некоторые **ограничения** для заданий.

	Можно указывать **максимальное время выполнения**. Таким образом, если задание выполняется дольше этого времени, оно будет завершено вместе со всеми задачами.

	Пакетная служба может обнаруживать и повторно выполнять незавершенные задачи. В качестве ограничения можно указать **максимальное число повторных попыток задачи**, а также, следует ли пытаться повторно выполнить задачу (*всегда* или *никогда*). Повторное выполнение задачи означает, что она повторно помещается в очередь и будет снова запущена.

- Задачи к заданию может добавлять клиентское приложение или [задачи диспетчера заданий](#job-manager-task). Задача диспетчера заданий содержит всю информацию для создания необходимых задач в рамках задания. Эту задачу выполняет один из вычислительных узлов пула. Задача диспетчера заданий обрабатывается пакетной службой особым образом: она помещается в очередь сразу при создании задания и перезапускается, если происходит сбой. Задача диспетчера заданий *необходима* для заданий, создаваемых согласно [расписанию заданий](#scheduled-jobs), так как это единственный способ определить задачи перед созданием экземпляра задания.

### Приоритет задания

При создании задания в пакетной службе ему можно назначить приоритет. Пакетная служба использует значения приоритетов заданий, чтобы определять порядок выполнения разных заданий в одной учетной записи (не путайте с [запланированным заданием](#scheduled-jobs)). Приоритет может иметь значение в диапазоне от -1000 до 1000, где -1000 означает наименьший приоритет, а 1000 — наивысший. Вы можете изменить приоритет задания с помощью операции [обновления свойств задания][rest_update_job] в REST API пакетной службы или изменив свойство [CloudJob.Priority][net_cloudjob_priority] в .NET API пакетной службы.

В рамках одной учетной записи задания с высоким приоритетом имеют приоритет при планировании относительно заданий с низким приоритетом. Задания с более высоким приоритетом, относящиеся к одной учетной записи, не имеют приоритета при планировании относительно других заданий с более низким приоритетом, относящихся к другой учетной записи.

Задания распределяются по пулам независимо друг от друга. Если используется несколько пулов, задание с более высоким приоритетом не обязательно будет выполняться первым. Задание задерживается, если в связанном с ним пуле недостаточно свободных узлов. Если задания выполняются в одном пуле и имеют одинаковый приоритет, они имеют равные шансы на распределение.

### Запланированные задания

[Расписания заданий][rest_job_schedules] позволяют создавать в пакетной службе повторяющиеся задания. Расписание заданий определяет время запуска заданий и параметры для запуска этих заданий. В расписании заданий можно указать период его действия, то есть с какого момента и в течение какого времени служба будет применять это расписание, а также частоту выполнения периодических заданий в этот период.

## Задача

Задача представляет собой единицу вычисления, которая связана с заданием и выполняется на узле. Задачи назначаются узлу для выполнения или ставятся в очередь, пока не освободится какой-либо узел. Говоря простыми словами, задача запускает одну или несколько программ или сценариев на вычислительном узле, чтобы выполнить необходимую работу.

При создании задачи можно указать следующее:

- **Командную строку** задачи. Это командная строка, которая запускает приложение или сценарий на вычислительном узле.

	Следует отметить, что командная строка не выполняется на базе оболочки и поэтому не может автоматически использовать функции оболочки, например расширение [переменных среды](#environment-settings-for-tasks) (в том числе `PATH`). Чтобы воспользоваться этими функциями, необходимо **вызвать оболочку в командной строке**. Это можно сделать путем запуска `cmd.exe` на узлах Windows или `/bin/sh` на узлах Linux:

	`cmd /c MyTaskApplication.exe %MY_ENV_VAR%`

	`/bin/sh -c MyTaskApplication $MY_ENV_VAR`

	Если требуется, чтобы задачи выполняли приложение или сценарий без использования переменной `PATH` или переменных среды узла, на которые содержится ссылка, необходимо явным образом вызвать оболочку в командной строке задачи.

- **Файлы ресурсов**, которые содержат данные для обработки. Эти файлы автоматически копируются на узел из хранилища BLOB-объектов в учетной записи службы хранилища Azure **общего назначения** перед выполнением командной строки задачи. Дополнительные сведения см. в разделах [Задача запуска](#start-task) и [Файлы и каталоги](#files-and-directories) ниже.

- **Переменные среды**, необходимые для приложения. Дополнительную информацию см. в разделе [Параметры среды для задач](#environment-settings-for-tasks) ниже.

- **Ограничения**, в рамках которых должна выполняться задача. Например, может быть задано максимальное время на выполнение задачи, максимальное количество повторных попыток выполнить задачу, завершенную сбоем, и максимальное время хранения файлов в рабочем каталоге.

Помимо задач, которые можно определить для вычислений на узле, пакетная служба выполняет следующие специальные задачи.

- [Задача запуска](#start-task)
- [Задача диспетчера заданий](#job-manager-task)
- [Задачи подготовки и завершения заданий.](#job-preparation-and-release-tasks)
- [Задачи с несколькими экземплярами](#multi-instance-tasks)
- [Зависимости задачи](#task-dependencies)

#### Задача запуска.

Связав **задачу запуска** с пулом, можно подготовить среду выполнения на его узлах. Эта задача может выполнять установку приложений, которые будут использовать задачи, или запуск фоновых процессов. Задача запуска выполняется при каждом запуске узла, пока узел остается в пуле, в том числе при первом добавлении узла к пулу и при перезапуске или пересоздании образа узла.

Задача запуска особенно полезна тем, что она может содержать все сведения для настройки вычислительных узлов и установки приложений, которые нужны для выполнения задач. Таким образом, для увеличения числа узлов в пуле достаточно указать новое количество узлов. Пакетная служба уже имеет необходимую информацию для настройки новых узлов и подготовки их к выполнению задач.

Для этой задачи, как для любой задачи пакетной службы Azure, кроме исполняемой **командной строки** можно указать список **файлов ресурсов**, которые хранятся в [службе хранилища Azure][azure_storage]. Пакетная служба сначала скопирует эти файлы на узел из службы хранилища Azure, а затем запустит командную строку. Список файлов для задачи запуска пула обычно содержит приложение задач или его зависимости. В нем также могут содержаться справочные данные, которые будут использоваться всеми задачами, выполняемыми на вычислительном узле. Например, командная строка задачи запуска может выполнять операцию `robocopy`, чтобы скопировать файлы приложения, указанные в качестве файлов ресурсов и скачанные на узел, из [рабочего каталога](#files-and-directories) задачи запуска в [общую папку](#files-and-directories), а затем запустить MSI-файл или `setup.exe`.

> [AZURE.IMPORTANT] Сейчас пакетная служба поддерживает *только* тип учетной записи хранения **общего назначения**, как описано в шаге 5 раздела [Создайте учетную запись хранения](../storage/storage-create-storage-account.md#create-a-storage-account) в статье [Об учетных записях хранения Azure](../storage/storage-create-storage-account.md). В задачах пакетной службы (включая стандартные задачи, задачи запуска, задачи подготовки и завершения заданий) необходимо указывать файлы ресурсов, которые находятся *только* в учетных записях хранения **общего назначения**.

Обычно желательно, чтобы пакетная служба дождалась завершения задачи запуска, прежде чем считать узел готовым к назначению задач, но это поведение можно изменить.

Если задача запуска на узле пула завершится сбоем, этот сбой отобразится в параметре состояния узла. При этом узел будет недоступным для назначения задач. Задача запуска может завершиться сбоем, если не удастся скопировать файлы ресурсов из хранилища или если процесс, запущенный командной строкой задачи запуска, вернет ненулевой код завершения.

#### Задача диспетчера заданий

**Задача диспетчера заданий** обычно используется для управления заданием или его отслеживания. Например, она создает и отправляет задачи для задания, определяет необходимые дополнительные задачи и определяет завершение задания. Но задача диспетчера заданий не ограничивается такими действиями. Это полнофункциональная задача, которая может выполнять любые действия в рамках задания. Например, задача диспетчера заданий может загрузить файл, указанный в качестве параметра, проанализировать содержимое этого файла и в зависимости от содержимого отправить на выполнение дополнительные задачи.

Задача диспетчера заданий запускается перед выполнением других задач и предоставляет следующие возможности.

- Пакетная служба автоматически создает эту задачу при создании задания.

- Эта задача выполняется раньше любых других задач в задании.

- Узел, на котором выполняется задача, удаляется из пула последним при уменьшении размера пула.

- Такое завершение задачи может привести к завершению всех задач данного задания.

- При перезапуске задачи диспетчера заданий она получает наивысший приоритет. При этом, если нет свободных узлов, пакетная служба может освободить ресурсы для этой задачи, прервав выполнение одной из других задач, запущенных в пуле.

- Задача диспетчера заданий не имеет приоритета над задачами других заданий. Приоритеты между заданиями определяются только на уровне заданий.

#### Задачи подготовки и завершения заданий.

Для настройки среды выполнения задания пакетная служба предоставляет задачу подготовки задания, а для очистки или обслуживания по окончании задания — задачу завершения задания.

- **Задача подготовки задания**. Эта задача выполняется на всех вычислительных узлах, на которых запланировано выполнение задач, до выполнения какой-либо другой задачи задания. Например, вы можете применить задачу подготовки задания для копирования данных, которые используются всеми задачами, но только в рамках одного задания.
- **Задача завершения задания**. Когда задание завершается, эта задача выполняется на каждом узле в пуле, на котором была выполнена хотя бы одна задача. Задачу завершения задания можно использовать для удаления данных, скопированных задачей подготовки задания, или для сжатия и передачи диагностических данных журналов.

Задачи подготовки и завершения задания позволяют указать командную строку, которая будет выполняться при вызове задачи, а также предлагают такие возможности, как загрузка файлов, выполнение с повышенными правами, пользовательские переменные среды, максимальная длительность выполнения, число повторных попыток и время хранения файла.

Дополнительные сведения о задачах подготовки и завершения заданий см. в статье [Выполнение задач подготовки и завершения заданий на вычислительных узлах пакетной службы Azure](batch-job-prep-release.md).

#### Задачи с несколькими экземплярами

[Задача с несколькими экземплярами](batch-mpi.md) — это задача, которая может выполняться на нескольких вычислительных узлах одновременно. С помощью задач с несколькими экземплярами можно включать высокопроизводительные вычислительные сценарии, такие как интерфейс передачи сообщений (MPI), которым необходимо несколько совместно выделенных вычислительных узлов для обработки одной рабочей нагрузки.

Дополнительные сведения о выполнении заданий задач с несколькими экземплярами в пакетной службе с использованием библиотеки .NET для пакетной службы см. в статье [Использование задач с несколькими экземплярами для запуска приложений с интерфейсом передачи сообщений в пакетной службе Azure](batch-mpi.md).

#### Зависимости задачи

Зависимости задач, как можно понять из названия, позволяют настроить выполнение задачи в зависимости от предварительного завершения других задач. Эта функция обеспечивает поддержку в ситуациях, когда "подчиненная" задача использует выходные данные "вышестоящей" задачи или когда вышестоящая задача выполняет инициализацию, необходимую для подчиненных задач. Чтобы использовать эту функцию, необходимо сначала включить зависимости задач для задания пакетной службы. Затем для каждой задачи, зависящей от другой (или нескольких других), укажите задачи, от которых она зависит.

С помощью зависимостей задач можно настраивать различные сценарии, например:

* *Задача Б* зависит от *задачи А* (выполнение *задачи Б* не начнется, пока не завершится выполнение *задачи А*).
* *Задача В* зависит от *задачи А* и *задачи Б*.
* *Задача Г* зависит от ряда задач — от *задачи 1* до *задачи 10*.

Ознакомьтесь с примером кода [TaskDependencies][github_sample_taskdeps] в репозитории [azure-batch-samples][github_samples] на портале GitHub. В нем показано, как настроить задачи, зависящие от других задач, с помощью библиотеки [.NET для пакетной службы][batch_net_api].

## Параметры среды для задач

Каждая задача, выполняемая в рамках пакетного задания, имеет доступ к переменным среды, которые устанавливаются самой пакетной службой (служебные переменные, см. таблицу ниже) или пользователем. Приложения и сценарии, запускаемые на узлах с помощью задач, получают доступ к переменным среды во время выполнения.

Пользовательские переменные среды можно задать на уровне задачи или задания, задав свойство *параметров среды* для этих объектов. Для примера см. раздел об операции [добавления задачи к заданию][rest_add_task] для REST API пакетной службы или о свойствах [CloudTask.EnvironmentSettings][net_cloudtask_env] и [CloudJob.CommonEnvironmentSettings][net_job_env] для .NET API пакетной службы.

Чтобы получить значения служебных и пользовательских переменных среды задачи для клиентского приложения или службы, можно использовать операцию [получения сведений о задаче][rest_get_task_info] в REST API пакетной службы или свойство [CloudTask.EnvironmentSettings][net_cloudtask_env] в .NET API пакетной службы. Процессы, которые выполняются на вычислительном узле, могут обращаться к этим и другим переменным среды узла, например, с помощью привычного синтаксиса `%VARIABLE_NAME%` в Windows или `$VARIABLE_NAME` в Linux.

Ниже приведен список переменных среды, которые задает пакетная служба и к которым могут получать доступ задачи.

| Имя переменной среды | Описание |
|---------------------------------|--------------------------------------------------------------------------|
| `AZ_BATCH_ACCOUNT_NAME` | Имя учетной записи, которой принадлежит задача. |
| `AZ_BATCH_JOB_ID` | Идентификатор задания, к которому относится задача. |
| `AZ_BATCH_JOB_PREP_DIR` | Полный путь к каталогу задачи подготовки задания на узле. |
| `AZ_BATCH_JOB_PREP_WORKING_DIR` | Полный путь к рабочему каталогу задачи подготовки задания на узле. |
| `AZ_BATCH_NODE_ID` | Идентификатор узла, на котором выполняется задача. |
| `AZ_BATCH_NODE_ROOT_DIR` | Полный путь к корневому каталогу на узле. |
| `AZ_BATCH_NODE_SHARED_DIR` | Полный путь к общему каталогу на узле. |
| `AZ_BATCH_NODE_STARTUP_DIR` | Полный путь к каталогу задачи запуска на вычислительном узле. |
| `AZ_BATCH_POOL_ID` | Идентификатор пула, в котором выполняется задача. |
| `AZ_BATCH_TASK_DIR` | Полный путь к каталогу задачи на узле. |
| `AZ_BATCH_TASK_ID` | Идентификатор текущей задачи. |
| `AZ_BATCH_TASK_WORKING_DIR` | Полный путь к рабочему каталогу задачи на узле. |

>[AZURE.IMPORTANT] Эти переменные среды доступны только для **пользователя задачи**, то есть в рамках учетной записи пользователя, с помощью которой выполнен вход на узел, где выполняется задача. Эти переменные среды **не** будут отображаться в списке при [удаленном подключении](#connecting-to-compute-nodes) к вычислительному узлу через протокол RDP или SSH.

## Файлы и каталоги

У каждой задачи есть рабочий каталог, в котором она может создавать дополнительные файлы и каталоги для хранения выполняемой программы, обрабатываемых данных и результатов обработки. Эти файлы и каталоги будут доступны для других задач, пока выполняется это задание. Все задачи, файлы и каталоги на узле принадлежат одной учетной записи пользователя.

Пакетная служба предоставляет часть файловой системы на узле в качестве корневого каталога. Задача может обратиться к корневому каталогу по пути, который хранится в переменной среды `AZ_BATCH_NODE_ROOT_DIR`. Дополнительную информацию об использовании переменных среды см. в разделе [Параметры среды для задач](#environment-settings-for-tasks).

Корневой каталог имеет следующую структуру каталогов.

![Структура каталогов вычислительного узла][1]

- **shared** — в этом каталоге *все* задачи, выполняемые на узле, имеют права чтения и записи. Любая задача, выполняемая на узле, может создавать, читать, обновлять и удалять файлы в этом каталоге. Задачи могут получить доступ к этому каталогу с помощью ссылки на переменную среды `AZ_BATCH_NODE_SHARED_DIR`.

- **startup** — этот каталог используется задачей запуска в качестве рабочего каталога. Здесь хранятся все файлы, скачанные на узел с помощью задачи запуска. Задача запуска может создавать, читать, обновлять и удалять файлы в данном каталоге. Задачи могут получить доступ к этому каталогу с помощью ссылки на переменную среды `AZ_BATCH_NODE_STARTUP_DIR`.

- **Tasks** — такой каталог создается отдельно для каждой задачи, которая выполняется на узле. К нему можно получить доступ с помощью ссылки на переменную среды `AZ_BATCH_TASK_DIR`.

	В каждом каталоге задачи пакетная служба создает рабочий каталог (`wd`), который имеет уникальный путь, указанный в переменной среды `AZ_BATCH_TASK_WORKING_DIR`. Этот каталог предоставляет задаче доступ на чтение и запись. Задача может создавать, читать, обновлять и удалять файлы в этом каталоге. Время существования каталога определяется указанным для задачи ограничением *RetentionTime*.

	`stdout.txt` и `stderr.txt` — эти файлы сохраняются в папку задачи во время ее выполнения.

>[AZURE.IMPORTANT] При удалении узла из пула *все* файлы, хранящиеся на этом узле, удаляются.

## Пакеты приложений

Использование [пакетов приложений](batch-application-packages.md) обеспечивает простое управление приложениями и их развертывание на вычислительных узлах в пулах. С помощью этой функции вы можете легко отправлять несколько версий приложений, выполняемых задачами, включая двоичные файлы и файлы поддержки (а также управлять ими), а затем автоматически развертывать одно или несколько таких приложений на вычислительных узлах в пуле.

Пакетная служба обрабатывает сведения о работе со службой хранилища Azure в фоновом режиме для безопасного хранения и развертывания пакетов приложений на вычислительных узлах. При этом упрощается код и сокращаются издержки, связанные с управлением.

Дополнительные сведения об использовании пакетов приложений см. в статье [Развертывание приложения с помощью пакетов приложений пакетной службы Azure](batch-application-packages.md).

## Время существования пула и вычислительного узла

При проектировании решения на базе пакетной службы Azure следует принять решение о том, когда и как будут создаваться пулы и как долго будут доступны вычислительные узлы в этих пулах.

Одной из крайностей является создание отдельного пула для каждого задания при его отправке с удалением узлов сразу по завершении задач. Такой вариант позволит максимально эффективно использовать ресурсы, так как узлы выделяются в строго необходимом количестве и завершают работу, как только переходят в состояние простоя. Но при этом задание должно ожидать выделения узлов. Важно отметить, что распределение задач по узлам происходит по мере доступности и выделения каждого отдельного узла, сразу после выполнения на нем задачи запуска. Иными словами, пакетная служба *не* дожидается перед назначением задач, пока все узлы в пуле станут доступными, что обеспечивает максимально эффективное использование ресурсов.

Другим крайним вариантом является заблаговременное создание пула и подготовка его узлов до запуска заданий. Этот вариант применим для тех ситуаций, когда немедленный запуск задания имеет наивысший приоритет. В нашем случае задачи, создаваемые заданием, будут запускаться немедленно, но при этом узлы могут некоторое время простаивать в ожидании назначения задач.

Возможен и смешанный подход, когда создается пул для нескольких заданий, количество узлов в котором изменяется в зависимости от текущей нагрузки (см. раздел [Масштабирование вычислительных ресурсов](#scaling-compute-resources) ниже). Обычно такой вариант используется для обработки постоянной нагрузки, интенсивность которой изменяется. Масштабирование можно выполнять по мере изменения интенсивности нагрузки или с упреждением, если нагрузка является прогнозируемой.

## Масштабирование вычислительных ресурсов

[Автоматическое масштабирование](batch-automatic-scaling.md) позволяет использовать пакетную службу для динамической настройки количества вычислительных узлов в пуле в соответствии с текущей рабочей нагрузкой и использованием ресурсов в рамках вашего сценария вычислений. Это позволит снизить общую стоимость работы приложения за счет использования только необходимых ресурсов и освобождения остальных.

Чтобы включить автоматическое масштабирование, необходимо написать [соответствующую формулу](batch-automatic-scaling.md#automatic-scaling-formulas) и связать ее с пулом. Пакетная служба использует эту формулу для определения целевого количества узлов в пуле для следующего интервала масштабирования (интервал, который можно настроить). Вы можете указать параметры автоматического масштабирования для пула при его создании или включить масштабирование позже. Вы также можете обновить параметры масштабирования в пуле с включенным масштабированием.

Рассмотрим для примера задание, которое требует отправки большого количества задач для выполнения. Вы можете назначить для пула формулу масштабирования, которая изменяет количество узлов пула в зависимости от текущего числа задач в очереди и скорости выполнения этих задач, входящих в задание. По этой формуле пакетная служба периодически вычисляет и изменяет размер пула в зависимости от рабочей нагрузки (много задач в очереди, операция добавления узлов; отсутствие задач в очереди или выполняемых задач, операция удаления узлов) и других параметров формулы.

Формула масштабирования может использовать следующие метрики.

- **Метрики времени** — основываются на статистических данных, которые собираются каждые 5 минут за указанное число часов.

- **Метрики ресурсов** — зависят от показателей загрузки ЦП, использования пропускной способности и памяти, а также количества узлов.

- **Метрики задач** — зависят от состояния задачи: *Активная* (в очереди), *Выполняется* или *Завершена*.

Если при автоматическом масштабировании уменьшается количество вычислительных узлов в пуле, необходимо учитывать способ обработки текущих выполняемых задач. Чтобы решить эту проблему, пакетная служба предоставляет *параметр отмены выделения узла*, который можно добавить в формулу. Например, можно указать, чтобы выполняемые задачи сразу останавливались, останавливались, а затем помещались в очередь на выполнение на другом узле или завершались до удаления узла из пула.

Подробные сведения об автоматическом масштабировании приложения см. в статье [Автоматическое масштабирование вычислительных узлов в пуле пакетной службы Azure](batch-automatic-scaling.md).

> [AZURE.TIP] Для максимально эффективного использования ресурсов укажите значение "ноль" для целевого количества узлов на момент завершения задания, но позвольте текущим задачам завершиться нормально.

## Безопасность с использованием сертификатов

Обычно сертификаты используются для шифрования и расшифровки конфиденциальных сведений, используемых задачами, например ключей [учетной записи службы хранилища Azure][azure_storage]. Для использования этой возможности на узлах можно установить сертификаты. Зашифрованные данные передаются задачам через параметры командной строки или через ресурсы задачи, а установленные сертификаты позволяют расшифровать их.

Для добавления сертификата к учетной записи пакетной службы используйте операцию [добавления сертификата][rest_add_cert] в REST API пакетной службы или метод [CertificateOperations.CreateCertificate][net_create_cert] в .NET API пакетной службы. Затем можно будет связать сертификат с новым или существующим пулом. Если к пулу привязан сертификат, пакетная служба устанавливает этот сертификат на каждом узле пула. Пакетная служба устанавливает нужные сертификаты при запуске узла до начала выполнения каких-либо задач (в том числе задач запуска и задач диспетчера заданий).

## Обработка ошибок

Возможно, вы захотите обрабатывать ошибки задач и приложений в своем решении пакетной службы.

### Обработка сбоев задач
Сбои задач делятся на следующие категории.

- **Ошибки планирования**

	Если по какой-либо причине происходит сбой передачи файлов, указанных для задачи, для нее устанавливается состояние «ошибка планирования».

	Ошибки планирования могут возникать, если файлы ресурсов задачи были перемещены, если прекращено действие учетной записи службы хранилища или копирование файлов на узел не удалось выполнить из-за другой проблемы.

- **Ошибки приложений**

	Процесс, указанный в командной строке задачи, также может завершиться ошибкой. Если процесс, выполняемый задачей, возвращает ненулевой код завершения, считается, что такой процесс завершился ошибкой (см. подраздел *Код завершения задач* ниже).

	Вы можете настроить пакетную службу так, чтобы в случае ошибки приложения она автоматически повторяла задачу, а также указать максимальное количество таких попыток.

- **Ошибки ограничения**

	Вы можете установить ограничение на максимальное время выполнения задания или задачи с помощью параметра *maxWallClockTime*. Это полезно для завершения задач, переставших отвечать на запросы.

	В случае превышения максимального времени выполнения задача отмечается как *завершенная*, но с кодом выхода `0xC000013A`. При этом поле *schedulingError* будет иметь значение `{ category:"ServerError", code="TaskEnded"}`.

### Отладка ошибок приложений

- `stderr` и `stdout`

	Во время выполнения приложение может создавать диагностические данные, которые помогут устранить неполадки. Как упоминалось выше в разделе [Файлы и каталоги](#files-and-directories), пакетная служба записывает стандартные потоки вывода и ошибок в файлы `stdout.txt` и `stderr.txt`, расположенные в каталоге задачи на вычислительном узле. Чтобы получить эти файлы, можно использовать портал Azure или один из пакетов SDK пакетной службы. Например, вы можете получить эти и другие файлы для устранения неполадок, используя методы [ComputeNode.GetNodeFile][net_getfile_node] и [CloudTask.GetNodeFile][net_getfile_task] библиотеки .NET для пакетной службы.

- **Код завершения задач**

	Как упоминалось выше, пакетная служба помечает задачу как завершившуюся сбоем, если процесс, выполняемый задачей, возвращает ненулевой код завершения. Когда задача выполняет процесс, пакетная служба заполняет свойство кода завершения задачи *кодом возврата процесса*. Следует отметить, что код завершения задачи определяется **не** пакетной службой, а самим процессом или операционной системой, в которой выполняется процесс.

### Работа со сбоями и прерываниями задач

Задачи могут иногда завершаться ошибками или прерываться. Например, может завершиться ошибкой приложение задачи или узел, на котором выполняется задача, может быть перезапущен. Кроме того, узел может быть удален из пула при изменении размера, если установленная политика отмены выделения предусматривает немедленное удаление узла без ожидания завершения задачи. Во всех случаях пакетная служба может автоматически поставить задачу в очередь на повторное выполнение на другом узле.

Задача может также зависнуть или выполняться слишком долго из-за кратковременного сбоя. Для задачи можно установить максимальное время выполнения, при превышении которого пакетная служба прервет выполнение приложения задачи.

### Подключение к вычислительным узлам

Дополнительные возможности для отладки и устранения неполадок можно получить, выполнив вход на вычислительный узел удаленно. Вы можете использовать портал Azure, чтобы скачать файл удаленного рабочего стола (RDP) для узлов Windows и получить сведения о подключении SSH для узлов Linux. Это также можно сделать с помощью API пакетной службы (например, в экземплярах [.NET][net_rdpfile] или [Python](batch-linux-nodes.md#connect-to-linux-nodes)).

>[AZURE.IMPORTANT] Чтобы подключиться к узлу по протоколу RDP или SSH, на узле нужно создать пользователя. Для этого можно использовать портал Azure, [добавить учетную запись пользователя на узел][rest_create_user] с помощью REST API пакетной службы, вызвать метод [ComputeNode.CreateComputeNodeUser][net_create_user] в .NET API пакетной службы или вызвать метод [add\_user][py_add_user] в модуле Python пакетной службы.

### Устранение неполадок на "плохих" вычислительных узлах

В ситуациях, когда при выполнении некоторых задач происходит сбой, пакетное клиентское приложение или служба может проверить метаданные неудачных задач для определения узла, который плохо работает. Каждому узлу в пуле присваивается уникальный идентификатор, а сведения об узле, на котором выполняется задача, включены в метаданные задачи. Определив проблемный узел, вы можете предпринять некоторые действия:

- **Перезапустить узел** ([REST][rest_reboot] | [.NET][net_reboot]).

	В некоторых случаях перезапуск узла может устранить некоторые скрытые проблемы, например задержки и сбои при выполнении процессов. Обратите внимание, что если пул использует начальную задачу или задание использует задачу подготовки задания, они будут выполнены при перезапуске узла.

- **Пересоздать образ узла** ([REST][rest_reimage] | [.NET][net_reimage]).

	Это обеспечит переустановку операционной системы на узле. Как и в случае перезагрузки узла, задачи запуска и задачи подготовки заданий будут повторно выполнены после повторного создания образа узла.

- **Удалить узел из пула** ([REST][rest_remove] | [.NET][net_remove]).

	Иногда бывает необходимо полностью удалить узел из пула.

- **Отключить планирование задач на узле** ([REST][rest_offline] | [.NET][net_offline]).

	Это эффективно переключит узел в "автономный режим", чтобы ему не назначались дальнейшие задачи, но позволяет узлу продолжать выполнение текущих задач, оставаясь в пуле. Благодаря этому вы сможете продолжить поиск причины сбоев без потери данных невыполненной задачи и без сбоев при выполнении дополнительных задач на узле. Например, можно отключить планирование задач на узле, а затем выполнить [удаленный вход](#connecting-to-compute-nodes) на узел для анализа журналов событий или устранения других неполадок. Проанализировав проблемы, вы сможете снова подключить узел к сети, включив планирование задач ([REST][rest_online] | [.NET][net_online]) или выполнив одно из перечисленных выше действий.

> [AZURE.IMPORTANT] С помощью каждого из перечисленных выше действий (перезагрузки, пересоздания образа, удаления, отключения планирования задач) вы можете указать вариант обработки текущих задач на узле при выполнении действия. Например, при отключении планирования задач на узле с помощью клиентской библиотеки .NET для пакетной службы вы можете указать значение перечисления [DisableComputeNodeSchedulingOption][net_offline_option], чтобы определить, что нужно сделать до выполнения действия (**TaskCompletion**): **прекратить** выполнение текущих задач, **повторно поставить их в очередь** для планирования выполнения на других узлах или разрешить завершение текущих задач.

## Дальнейшие действия

- Ознакомьтесь с пошаговой инструкцией по созданию примера приложения пакетной службы в статье [Начало работы с библиотекой пакетной службы Azure для .NET](batch-dotnet-get-started.md). Существует также [версия Python](batch-python-tutorial.md) этого руководства. В ней рассматривается выполнение рабочих нагрузок на вычислительных узлах Linux.

- Узнайте, как [создавать пулы вычислительных узлов Linux](batch-linux-nodes.md).

- Посетите [форум по пакетной службе Azure][batch_forum] на сайте MSDN. Здесь могут задавать вопросы как начинающие, так и опытные пользователи пакетной службы.

[1]: ./media/batch-api-basics/node-folder-structure.png

[azure_storage]: https://azure.microsoft.com/services/storage/
[batch_forum]: https://social.msdn.microsoft.com/Forums/ru-RU/home?forum=azurebatch
[cloud_service_sizes]: ../cloud-services/cloud-services-sizes-specs.md
[msmpi]: https://msdn.microsoft.com/library/bb524831.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[github_sample_taskdeps]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/TaskDependencies

[batch_net_api]: https://msdn.microsoft.com/library/azure/mt348682.aspx
[net_cloudjob_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.jobmanagertask.aspx
[net_cloudjob_priority]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.priority.aspx
[net_cloudpool_starttask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudpool.starttask.aspx
[net_cloudtask_env]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudtask.environmentsettings.aspx
[net_create_cert]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.certificateoperations.createcertificate.aspx
[net_create_user]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.createcomputenodeuser.aspx
[net_getfile_node]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.getnodefile.aspx
[net_getfile_task]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudtask.getnodefile.aspx
[net_job_env]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.cloudjob.commonenvironmentsettings.aspx
[net_multiinstancesettings]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.multiinstancesettings.aspx
[net_rdp]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.getrdpfile.aspx
[net_reboot]: https://msdn.microsoft.com/library/azure/mt631495.aspx
[net_reimage]: https://msdn.microsoft.com/library/azure/mt631496.aspx
[net_remove]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.pooloperations.removefrompoolasync.aspx
[net_offline]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.disableschedulingasync.aspx
[net_online]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.computenode.enableschedulingasync.aspx
[net_offline_option]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.common.disablecomputenodeschedulingoption.aspx
[net_rdpfile]: https://msdn.microsoft.com/library/azure/Mt272127.aspx

[py_add_user]: http://azure-sdk-for-python.readthedocs.io/en/latest/ref/azure.batch.operations.html#azure.batch.operations.ComputeNodeOperations.add_user

[batch_rest_api]: https://msdn.microsoft.com/library/azure/Dn820158.aspx
[rest_add_job]: https://msdn.microsoft.com/library/azure/mt282178.aspx
[rest_add_pool]: https://msdn.microsoft.com/library/azure/dn820174.aspx
[rest_add_cert]: https://msdn.microsoft.com/library/azure/dn820169.aspx
[rest_add_task]: https://msdn.microsoft.com/library/azure/dn820105.aspx
[rest_create_user]: https://msdn.microsoft.com/library/azure/dn820137.aspx
[rest_get_task_info]: https://msdn.microsoft.com/library/azure/dn820133.aspx
[rest_job_schedules]: https://msdn.microsoft.com/library/azure/mt282179.aspx
[rest_multiinstance]: https://msdn.microsoft.com/library/azure/mt637905.aspx
[rest_multiinstancesettings]: https://msdn.microsoft.com/library/azure/dn820105.aspx#multiInstanceSettings
[rest_update_job]: https://msdn.microsoft.com/library/azure/dn820162.aspx
[rest_rdp]: https://msdn.microsoft.com/library/azure/dn820120.aspx
[rest_reboot]: https://msdn.microsoft.com/library/azure/dn820171.aspx
[rest_reimage]: https://msdn.microsoft.com/library/azure/dn820157.aspx
[rest_remove]: https://msdn.microsoft.com/library/azure/dn820194.aspx
[rest_offline]: https://msdn.microsoft.com/library/azure/mt637904.aspx
[rest_online]: https://msdn.microsoft.com/library/azure/mt637907.aspx

[vm_marketplace]: https://azure.microsoft.com/marketplace/virtual-machines/

<!---HONumber=AcomDC_0622_2016-->