<properties
   pageTitle="Приступая к работе с командлетами PowerShell Пакетной службы Azure | Microsoft Azure"
   description="Предоставляет командлеты Azure PowerShell, используемые для управления Пакетной службой Azure"
   services="batch"
   documentationCenter=""
   authors="dlepow"
   manager="timlt"
   editor=""/>

<tags
   ms.service="batch"
   ms.devlang="NA"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="powershell"
   ms.workload="big-compute"
   ms.date="08/07/2015"
   ms.author="danlep"/>

# Приступая к работе с командлетами Azure PowerShell
В этой статье представлено краткое введение в командлеты Azure PowerShell, которые можно использовать для управления учетными записями Пакетной службы и получения сведений о заданиях, задачах Пакетной службы и других сведений.

Для получения подробных сведений о синтаксисе командлета введите `get-help <Cmdlet_name>` или см. [справку по командлету Пакетной службы Azure](https://msdn.microsoft.com/library/azure/mt125957.aspx).

## Предварительные требования

* **Azure PowerShell** – см. раздел [Как установить и настроить Azure PowerShell](../powershell-install-configure.md), чтобы узнать предварительные требования, и получить инструкции по скачиванию и установке. Командлеты Пакетной службы появились в версии 0.8.10 и более поздних версиях. Командлеты пакетной службы были обновлены для использования API общей доступности в версии 0.9.6.

## Использование командлетов Пакетной службы

Чтобы запустить Azure PowerShell и [подключиться к подпискам Azure](../powershell-install-configure.md#Connect), выполните стандартные действия. Кроме этого:

* **Выбрать подписку Azure**. Если у вас несколько подписок, выберите нужную:

    ```
    Select-AzureSubscription -SubscriptionName <SubscriptionName>
    ```

* **Переключиться в режим AzureResourceManage** – командлеты Пакетной службы поставляются в модуле диспетчера ресурсов Azure. Подробнее об этом см. [Использование Windows PowerShell с диспетчером ресурсов](../powershell-azure-resource-manager.md). Чтобы использовать этот модуль, запустите командлет [Switch-AzureMode](https://msdn.microsoft.com/library/dn722470.aspx):

    ```
    Switch-AzureMode -Name AzureResourceManager
    ```

## Управление учетными записями пакетной службы и ключами

Чтобы создавать и управлять учетными записями пакетной службы и ключами, можно использовать командлеты Azure PowerShell.

### Создание учетной записи Пакетной службы

Командлет **New-AzureBatchAccount** создает новую учетную запись Пакетной службы в группе указанного ресурса. Если у вас еще нет группы ресурсов, создайте ее. Для этого выполните командлет [New-AzureResourceGroup](https://msdn.microsoft.com/library/dn654594.aspx), указав один из регионов Azure в параметре **Расположение**. (Регионы, в которых доступны различные ресурсы Azure, можно найти, выполнив командлет [Get-AzureLocation](https://msdn.microsoft.com/library/dn654582.aspx).) Например:

```
New-AzureResourceGroup –Name MyBatchResourceGroup –location "Central US"
```

Затем создайте новую учетную запись пакетной службы в группе ресурсов, указав имя учетной записи в < *account\_name*> и расположение, где доступна пакетная служба. Создание учен=тной записи может занять несколько минут. Например:

```
New-AzureBatchAccount –AccountName <account_name> –Location "Central US" –ResourceGroupName MyBatchResourceGroup
```

> [AZURE.NOTE]Имя учетной записи Пакетной службы в Azure должно быть уникальным, содержать от 3 до 24 символов и состоять только из строчных букв и цифр.

### Получение ключей доступа к учетной записи
**Get-AzureBatchAccountKeys** выводит клавиши доступа, связанные с учетной записью Пакетной службы Azure. Например, выполните следующую команду, чтобы получить первичные и вторичные ключи созданной учетной записи.

```
$Account = Get-AzureBatchAccountKeys –AccountName <accountname>
$Account.PrimaryAccountKey
$Account.SecondaryAccountKey
```

### Создание нового ключа доступа
**New-AzureBatchAccountKey** создает новый первичный или вторичный ключ учетной записи Пакетной службы Azure. Например, чтобы создать новый первичный ключ для учетной записи Пакетной службы, введите:

```
New-AzureBatchAccountKey -AccountName <account_name> -KeyType Primary
```

> [AZURE.NOTE]Чтобы создать новый вторичный ключ, введите "Вторичный" в параметре **KeyType**. Повторно создавать первичный и вторичный ключи нужно отдельно.

### Удаление учетной записи Пакетной службы
**Remove-AzureBatchAccount** удаляет учетную запись Пакетной службы. Например:

```
Remove-AzureBatchAccount -AccountName <account_name>
```

При появлении запроса на удаление учетной записи подтвердите удаление. Удаление учетной записи может занять некоторое время.

## Запрос для получения сведений о заданиях, задачах и других сведений

Для отправки запроса о сущностях, созданных в данной учетной записи, воспользуйтесь командлетами **Get-AzureBatchJob**, **Get-AzureBatchTask** и **Get-AzureBatchPool**.

Чтобы использовать эти командлеты, сначала нужно создать объект AzureBatchContext для хранения имени учетной записи и ключей:

```
$context = Get-AzureBatchAccountKeys "<account_name>"
```

Передайте этот контекст в командлеты, которые взаимодействуют с Пакетной службой, через параметр **BatchContext**.

> [AZURE.NOTE]По умолчанию первичный ключ учетной записи используется для проверки подлинности, но вы можете явно выбрать ключ, который нужно использовать, изменив свойство **KeyInUse** объекта BatchAccountContext: `$context.KeyInUse = "Secondary"`.


### Запрос данных

Например, для поиска пулов используйте **Get AzureBatchPools**. По умолчанию этот командлет опрашивает все рабочие элементы вашей учетной записи при условии, что вы уже сохранили объект BatchAccountContext в *$context*.

```
Get-AzureBatchPool -BatchContext $context
```
### Использование фильтра OData

Чтобы найти объекты, которые вас интересуют, установите фильтр OData в параметре **Фильтр**. Например, можно найти все пулы с идентификаторами, начинающимися с myPool:

```
$filter = "startswith(id,'myPool')"
Get-AzureBatchPool -Filter $filter -BatchContext $context
```

Этот способ не такой гибкий, как использование "Where-Object" в локальном конвейере. Но запрос отправляется непосредственно Пакетной службе, чтобы вся фильтрация выполнялась на стороне сервера, сохраняя пропускную способность Интернета.

### Используйте параметр Id

Альтернативой использования фильтра OData является использование параметра **Id**. Для запроса конкретного пула с идентификатором myPool сделайте следующее.

```
Get-AzureBatchPool -Id "myPool" -BatchContext $context

```
Параметр **Id** поддерживает поиск только полного идентификатора без подстановочных знаков или фильтров в стиле OData.

### Использование конвейера

Командлеты Пакетной службы могут использовать конвейер PowerShell для передачи данных между командлетами. Это имеет тот же эффект, что и указание параметра, но упрощает вывод нескольких сущностей. Например, вы можете найти все задачи в своей учетной записи:

```
Get-AzureBatchJob -BatchContext $context | Get-AzureBatchTask -BatchContext $context
```

### Использование параметра MaxCount

По умолчанию каждый командлет возвращает максимум 1000 объектов. Если этот предел достигнут, вы можете сузить свой фильтр для возврата меньшего количества объектов или явно задать максимальное использование параметра **MaxCount**. Например:

```
Get-AzureBatchTask -MaxCount 2500 -BatchContext $context

```

Чтобы удалить верхнюю границу, задайте **MaxCount** значение "0" или меньше.

## Связанные разделы
* [Технический обзор Пакетной службы Azure](batch-technical-overview.md)
* [Скачать Azure PowerShell](http://go.microsoft.com/p/?linkid=9811175)
* [Справка по командлету Пакетной службы Azure](https://msdn.microsoft.com/library/azure/mt125957.aspx)
* [Эффективные запросы списков](batch-efficient-list-queries.md)

<!---HONumber=August15_HO7-->