---
title: "Начало работы с интерфейсом командной строки пакетной службы Azure | Документация Майкрософт"
description: "Ознакомьтесь с командами интерфейса командной строки пакетной службы Azure для управления ресурсами пакетной службы Azure."
services: batch
documentationcenter: 
author: tamram
manager: timlt
editor: 
ms.assetid: fcd76587-1827-4bc8-a84d-bba1cd980d85
ms.service: batch
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: multiple
ms.workload: big-compute
ms.date: 01/23/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
translationtype: Human Translation
ms.sourcegitcommit: 6b6c548ca1001587e2b40bbe9ee2fcb298f40d72
ms.openlocfilehash: e4a3f3f3bca06e66f39f5acd8b4571b4a498ed83
ms.lasthandoff: 02/28/2017


---
# <a name="manage-batch-resources-with-azure-cli"></a>Управление ресурсами пакетной службы с помощью Azure CLI

Кроссплатформенный интерфейс командной строки Azure позволяет управлять учетными записями пакетной службы и такими ресурсами, как пулы, задания и задачи в командных оболочках Linux, Mac и Windows. С помощью интерфейса командной строки Azure можно создавать и выполнять сценарии для многих однотипных задач, выполняемых с помощью API-интерфейсов пакетной службы, портала Azure и командлетов PowerShell пакетной службы.

В этой статье рассматривается интерфейс командной строки Azure версии 0.10.5.

## <a name="prerequisites"></a>Предварительные требования
* [Установка Azure CLI](../xplat-cli-install.md)
* [Подключите интерфейс командной строки Azure к своей подписке Azure](../xplat-cli-connect.md)
* Переключение в режим **Resource Manager**: `azure config mode arm`

> [!TIP]
> Рекомендуем регулярно обновлять интерфейс командной строки Azure, чтобы использовать все преимущества обновлений и улучшений службы.
> 
> 

## <a name="command-help"></a>Справка по командам
Текст справки для каждой команды в интерфейсе командной строки Azure можно просмотреть, добавив `-h` в качестве единственного параметра после команды. Например:

* Чтобы получить справку по команде `azure`, введите: `azure -h`
* Чтобы получить список всех команд пакетной службы в интерфейсе командной строки, используйте: `azure batch -h`
* Чтобы получить справку по созданию учетной записи пакетной службы, введите: `azure batch account create -h`

Если у вас возникнут сомнения, с помощью параметра командной строки `-h` вы сможете получить справку по любой из команд интерфейса командной строки Azure.

## <a name="create-a-batch-account"></a>Создание учетной записи Пакетной службы
Использование:

    azure batch account create [options] <name>

Пример:

    azure batch account create --location "West US"  --resource-group "resgroup001" "batchaccount001"

Команда создает новую учетную запись пакетной службы с указанными параметрами. Обязательно укажите расположение, группу ресурсов и имя учетной записи. Если у вас еще нет группы ресурсов, создайте ее с помощью команды `azure group create` и укажите один из регионов Azure (например, West US) для параметра `--location`. Например:

    azure group create --name "resgroup001" --location "West US"

> [!NOTE]
> Имя учетной записи пакетной службы должно быть уникальным в пределах региона Azure, в котором создается эта учетная запись. Имя может содержать только строчные буквы и цифры, а его длина должна быть не меньше 3 и не больше 24 символов. В именах учетных записей пакетной службы нельзя использовать специальные символы, такие как `-` или `_`.
> 
> 

### <a name="linked-storage-account-autostorage"></a>Связанная учетная запись хранения (автоматическое хранение)
При необходимости вы можете связать свою учетную запись хранения **общего назначения** с учетной записью пакетной службы при ее создании. Функция [пакетов приложений](batch-application-packages.md) в пакетной службе, а также библиотека [Batch File Conventions для .NET](batch-task-output.md) используют хранилище BLOB-объектов в связанной учетной записи хранения общего назначения. Эти дополнительные функции помогут вам развертывать приложения, которые запускаются с помощью задач пакетной службы, и сохранять данные, которые они создают.

Чтобы связать существующую учетную запись хранения Azure с новой учетной записью пакетной службы при ее создании, укажите параметр `--autostorage-account-id` . В этом параметре необходимо указать полный идентификатор ресурса учетной записи хранения.

В первую очередь следует отобразить сведения о вашей учетной записи хранения:

    azure storage account show --resource-group "resgroup001" "storageaccount001"

Затем задайте **URL-адрес** для параметра `--autostorage-account-id`. Значение URL-адреса начинается с "/subscriptions/" и содержит идентификатор подписки, а также путь к ресурсу учетной записи хранения:

    azure batch account create --location "West US"  --resource-group "resgroup001" --autostorage-account-id "/subscriptions/8ffffff8-4444-4444-bfbf-8ffffff84444/resourceGroups/resgroup001/providers/Microsoft.Storage/storageAccounts/storageaccount001" "batchaccount001"

## <a name="delete-a-batch-account"></a>Удаление учетной записи Пакетной службы
Использование:

    azure batch account delete [options] <name>

Пример:

    azure batch account delete --resource-group "resgroup001" "batchaccount001"

Команда удаляет указанную учетную запись пакетной службы. При появлении запроса подтвердите свое намерение удалить учетную запись (для выполнения операции может потребоваться некоторое время).

## <a name="manage-account-access-keys"></a>Управление ключами доступа к учетной записи
Чтобы [создать или изменить ресурсы](#create-and-modify-batch-resources) в учетной записи пакетной службы, вам потребуется ключ доступа.

### <a name="list-access-keys"></a>Получение списка ключей доступа
Использование:

    azure batch account keys list [options] <name>

Пример:

    azure batch account keys list --resource-group "resgroup001" "batchaccount001"

Команда выводит на экран список ключей для заданной учетной записи пакетной службы.

### <a name="generate-a-new-access-key"></a>Создание нового ключа доступа
Использование:

    azure batch account keys renew [options] --<primary|secondary> <name>

Пример:

    azure batch account keys renew --resource-group "resgroup001" --primary "batchaccount001"

Команда повторно создает ключ к заданной учетной записи пакетной службы.

## <a name="create-and-modify-batch-resources"></a>Создание и изменение ресурсов пакетной службы
Интерфейс командной строки Azure можно использовать для операций CRUD (создание, чтение, обновление и удаление) с ресурсами пакетной службы, такими как пулы, вычислительные узлы, задания и задачи. Для выполнения указанных операций необходимо задать имя учетной записи пакетной службы, ключ доступа и конечную точку. Вы можете указать эти данные с помощью параметров `-a`, `-k` и `-u` либо задать [переменные среды](#credential-environment-variables), которые интерфейс командной строки использует автоматически (если они указаны).

### <a name="credential-environment-variables"></a>Учетные данные в переменных среды
Вы можете задать переменные среды `AZURE_BATCH_ACCOUNT`, `AZURE_BATCH_ACCESS_KEY` и `AZURE_BATCH_ENDPOINT` вместо указания параметров `-a`, `-k` и `-u` в командной строке для каждой выполняемой команды. Интерфейс командной строки пакетной службы будет использовать эти переменные (если они заданы), поэтому вы можете не указывать параметры `-a`, `-k` и `-u`. В оставшейся части статьи мы будем исходить из того, что в командах используются эти переменные среды.

> [!TIP]
> Список ключей можно вывести на экран с помощью команды `azure batch account keys list`, а конечную точку учетной записи — с помощью команды `azure batch account show`.
> 
> 

### <a name="json-files"></a>файлы JSON;
После создания ресурсов пакетной службы, таких как пулы и задания, вы можете указать JSON-файл, содержащий конфигурацию нового ресурса, вместо того чтобы передавать его параметры в виде параметров командной строки. Например:

`azure batch pool create my_batch_pool.json`

Хотя многие операции по созданию ресурсов можно выполнять только с помощью параметров командной строки, для некоторых функций требуется файл формата JSON, содержащий сведения о ресурсе. Например, JSON-файл следует использовать, если нужно указать файлы ресурсов для задачи запуска.

Чтобы найти JSON-файл, необходимый для создания ресурса, см. [справочник по REST API пакетной службы][rest_api] на сайте MSDN. В каждой из статей "Добавление *тип ресурса*" содержится пример JSON для создания ресурса, который можно использовать в качестве шаблона для создания собственных JSON-файлов. Например, JSON для создания пула можно найти в статье [Добавление учетной записи пула][rest_add_pool].

> [!NOTE]
> Если при создании ресурса вы указываете JSON-файл, все остальные параметры, которые указываются в командной строке для этого ресурса, можно пропустить.
> 
> 

## <a name="create-a-pool"></a>Создание пула
Использование:

    azure batch pool create [options] [json-file]

Пример (конфигурация виртуальной машины):

    azure batch pool create --id "pool001" --target-dedicated 1 --vm-size "STANDARD_A1" --image-publisher "Canonical" --image-offer "UbuntuServer" --image-sku "14.04.2-LTS" --node-agent-id "batch.node.ubuntu 14.04"

Пример (конфигурация облачных служб):

    azure batch pool create --id "pool002" --target-dedicated 1 --vm-size "small" --os-family "4"

Команда создает пул вычислительных узлов в пакетной службе.

Как отмечалось в [обзоре функций пакетной службы](batch-api-basics.md#pool), при выборе операционной системы для вычислительных узлов в вашем пуле предоставляется два варианта: **конфигурация виртуальной машины** и **конфигурация облачных служб**. Параметр используется `--image-*` для создания пулов с конфигурацией виртуальной машины, а параметр `--os-family` — для создания пулов с конфигурацией облачных служб. Параметры `--os-family` и `--image-*` нельзя указать одновременно.

Вы можете указать [пакеты приложений](batch-application-packages.md) для пула и командную строку для [задачи запуска](batch-api-basics.md#start-task). Однако чтобы указать файлы ресурсов для задачи запуска, следует использовать [JSON-файл](#json-files).

Чтобы удалить пул, используйте такую команду:

    azure batch pool delete [pool-id]

> [!TIP]
> Найдите в [списке образов виртуальных машин](batch-linux-nodes.md#list-of-virtual-machine-images) значения, соответствующие параметрам `--image-*`.
> 
> 

## <a name="create-a-job"></a>Создание задания
Использование:

    azure batch job create [options] [json-file]

Пример:

    azure batch job create --id "job001" --pool-id "pool001"

Эта команда добавляет задание к учетной записи пакетной службы и определяет пул для выполнения задач этого задания.

Чтобы удалить задание, используйте такую команду:

    azure batch job delete [job-id]

## <a name="list-pools-jobs-tasks-and-other-resources"></a>Получение списка пулов, заданий, задач и других ресурсов
Каждый тип ресурса пакетной службы поддерживает команду `list` , которая запрашивает учетную запись пакетной службы и предоставляет списки ресурсов заданного типа. Например, вы можете получить список пулов в учетной записи и задач, входящих в задание, следующим образом:

    azure batch pool list
    azure batch task list --job-id "job001"

### <a name="listing-resources-efficiently"></a>Составление эффективных списков ресурсов
Чтобы ускорить создание запросов, вы можете задать предложения **select**, **filter** и **expand** для операций `list`. Используйте эти параметры для того, чтобы ограничить объем данных, возвращаемых пакетной службой. Так как фильтрация выполняется на стороне сервера, передаются только интересующие вас данные. Используйте эти предложения для экономии пропускной способности (а значит, и времени) при выполнении операций со списками.

Например, эта команда вернет только те пулы, идентификаторы которых начинаются с renderTask:

    azure batch task list --job-id "job001" --filter-clause "startswith(id, 'renderTask')"

Интерфейс командной строки пакетной службы поддерживает все три предложения, которые, в свою очередь, поддерживаются пакетной службой:

* `--select-clause [select-clause]` возвращает подмножество свойств для каждой сущности.
* `--filter-clause [filter-clause]` возвращает только те сущности, которые соответствуют указанному выражению OData.
* `--expand-clause [expand-clause]` получает сведения о сущности за один базовый вызов REST. В настоящее время предложение expand поддерживает только свойство `stats` .

Дополнительные сведения об этих трех предложениях, а также о создании с их помощью запросов к спискам, см. в статье [Эффективные запросы к пакетной службе Azure](batch-efficient-list-queries.md).

## <a name="application-package-management"></a>Управление пакетами приложений
Пакеты приложений упрощают развертывание приложений на вычислительных узлах пулов. С помощью интерфейса командной строки Azure можно отправлять и удалять пакеты приложений, а также управлять версиями пакетов.

Чтобы создать новое приложение и добавить версию пакета, сделайте следующее.

**Создайте** приложение:

    azure batch application create "resgroup001" "batchaccount001" "MyTaskApplication"

**Добавьте** пакет приложения:

    azure batch application package create "resgroup001" "batchaccount001" "MyTaskApplication" "1.10-beta3" package001.zip

**Активируйте** пакет:

    azure batch application package activate "resgroup001" "batchaccount001" "MyTaskApplication" "1.10-beta3" zip

Задайте для приложения **версию по умолчанию**:

    azure batch application set "resgroup001" "batchaccount001" "MyTaskApplication" --default-version "1.10-beta3"

### <a name="deploy-an-application-package"></a>Развертывание пакета приложения
Вы можете указать один или несколько пакетов приложений для развертывания при создании нового пула. Когда вы указываете пакет во время создания пула, он развертывается на каждом из узлов, присоединяющихся к пулу. Кроме того, развертывание пакетов выполняется при перезагрузке узла или пересоздании образа узла.

При создании пула укажите параметр `--app-package-ref`, чтобы развернуть пакет приложения для узлов во время их присоединения к пулу. `--app-package-ref` принимает разделенный точками с запятыми список идентификаторов приложений, которые будут развернуты на вычислительных узлах.

    azure batch pool create --pool-id "pool001" --target-dedicated 1 --vm-size "small" --os-family "4" --app-package-ref "MyTaskApplication"

Сейчас при создании пула с помощью параметров командной строки нельзя указать, *какую* версию пакета приложения нужно развернуть на вычислительных узлах, например&1;.10-beta3. Таким образом, перед созданием пула для приложения необходимо указать версию по умолчанию с помощью команды `azure batch application set [options] --default-version <version-id>` (см. предыдущий раздел). Вы также можете задать версию пакета для пула, если для создания пула вместо параметров командной строки используется [JSON-файл](#json-files).

Дополнительные сведения о пакетах приложений см. в статье [Развертывание приложения с помощью пакетов приложений пакетной службы Azure](batch-application-packages.md).

> [!IMPORTANT]
> Чтобы использовать пакеты приложений, вам сначала нужно [связать учетную запись хранения Azure](#linked-storage-account-autostorage) со своей учетной записью пакетной службы.
> 
> 

### <a name="update-a-pools-application-packages"></a>Обновление пакетов приложений пула
Чтобы обновить приложения, назначенные имеющемуся пулу, выполните команду `azure batch pool set` с параметром `--app-package-ref`:

    azure batch pool set --pool-id "pool001" --app-package-ref "MyTaskApplication2"

Чтобы развернуть новый пакет приложения на вычислительных узлах в имеющемся пуле, необходимо перезапустить эти узлы или пересоздать образы для них:

    azure batch node reboot --pool-id "pool001" --node-id "tvm-3105992504_1-20160930t164509z"

> [!TIP]
> Список узлов в пуле вместе с их идентификаторами можно получить, используя команду `azure batch node list`.
> 
> 

Следует помнить, что перед развертыванием необходимо настроить для приложения версию по умолчанию (`azure batch application set [options] --default-version <version-id>`).

## <a name="troubleshooting-tips"></a>Советы по устранению неполадок
В этом разделе содержатся полезные ресурсы, которые следует использовать при возникновении неполадок интерфейса командной строки Azure. Это не значит, что они помогут устранить все проблемы, но с их помощью можно выявить причину неполадки и найти нужные справочные ресурсы.

* Используйте параметр `-h` , чтобы вывести на экран **текст справки** по любой из команд интерфейса командной строки.
* Используйте параметры `-v` и `-vv`, чтобы вывести на экран **подробные`-vv` выходные данные команды. Параметр ** применяется для максимально подробного представления с текущими REST-запросами и откликами. Эти параметры удобно использовать для просмотра полного вывода ошибок.
* Вы можете просмотреть **выходные данные команды в виде JSON** с помощью параметра `--json`. Например, параметр `azure batch pool show "pool001" --json` отображает свойства элемента pool001 в формате JSON. Затем вы можете скопировать и изменить эти выходные данные для использования в параметре `--json-file` (см. выше раздел, посвященный [JSON-файлам](#json-files)).
* [Форум пакетной службы на сайте MSDN][batch_forum] — это отличный справочный ресурс, который тщательно отслеживают специалисты пакетной службы Azure. Задавайте вопросы на форуме, если у вас возникнут проблемы или вам потребуется справочная информация по какой-либо операции.
* В настоящее время интерфейс командной строки Azure поддерживает не все операции с ресурсами пакетной службы. Например, вы можете указать только идентификатор пакета приложения для пула, но не *версию* пакета. В таких случаях для выполнения команды можно использовать `--json-file` вместо параметров командной строки. Следите за обновлениями интерфейса командной строки, чтобы пользоваться преимуществами будущих улучшений и обновлений.

## <a name="next-steps"></a>Дальнейшие действия
* См. статью [Развертывание приложения с помощью пакетов приложений пакетной службы Azure](batch-application-packages.md), чтобы узнать, как использовать эту функцию для развертывания приложений, работающих на вычислительных узлах пакетной службы, и управления ими.
* См. статью [Эффективные запросы к пакетной службе Azure](batch-efficient-list-queries.md), чтобы узнать больше о сокращении количества элементов и типов данных, возвращаемых с помощью запросов к пакетной службе.

[batch_forum]: https://social.msdn.microsoft.com/forums/azure/en-US/home?forum=azurebatch
[github_readme]: https://github.com/Azure/azure-xplat-cli/blob/dev/README.md
[rest_api]: https://msdn.microsoft.com/library/azure/dn820158.aspx
[rest_add_pool]: https://msdn.microsoft.com/library/azure/dn820174.aspx

