---
title: "Подготовка пулов пакетной службы Azure на основе пользовательских образов | Документация Майкрософт"
description: "Пул пакетной службы можно создать на основе пользовательского образа для подготовки вычислительных узлов, которые содержат программное обеспечение и данные, необходимые для приложения. Пользовательские образы представляют собой эффективный способ настройки вычислительных узлов для выполнения рабочих нагрузок пакетной службы."
services: batch
author: tamram
manager: timlt
ms.service: batch
ms.topic: article
ms.date: 08/07/2017
ms.author: tamram
ms.translationtype: HT
ms.sourcegitcommit: f9003c65d1818952c6a019f81080d595791f63bf
ms.openlocfilehash: 1248aeeaa159789b008eb003c2cd7babe0432919
ms.contentlocale: ru-ru
ms.lasthandoff: 08/09/2017

---

# <a name="use-a-custom-image-to-create-a-pool"></a>Использование пользовательского образа для создания пула

При создании пула в пакетной службе Azure необходимо указать образ виртуальной машины, предоставляющий конфигурацию операционной системы для каждого вычислительного узла в пуле. Пул можно создать с помощью образа Azure Marketplace или подготовленного пользовательского образа. Предоставив пользовательский образ, вы можете контролировать настройку операционной системы во время подготовки каждого вычислительного узла. Пользовательский образ может также содержать данные о приложении и справочные данные, которые становятся доступными на вычислительном узле сразу после его подготовки.

Пользовательский образ позволяет сэкономить время за счет подготовки вычислительных узлов пула к выполнению рабочей нагрузки пакетной службы. Вы всегда можете использовать образ Azure Marketplace и установить программное обеспечение на каждом вычислительном узле после его подготовки. Однако этот подход менее эффективен, чем использование пользовательского образа. Если вам нужно установить крупные приложения, скопируйте значительный объем данных или перезагрузите виртуальную машину во время установки, а затем используйте пользовательский образ, соответствующий вашим требованиям.  

## <a name="prerequisites"></a>Предварительные требования

- **Учетная запись пакетной службы, созданная в режиме распределения пула "Пользовательская подписка".** Чтобы использовать пользовательский образ для подготовки пулов виртуальных машин, создайте учетную запись пакетной службы в [режиме распределения пула](batch-api-basics.md#pool-allocation-mode) "Пользовательская подписка". В этом режиме пулы пакетной службы выделяются для подписки, в которой находится учетная запись. Сведения об установке режима распределения пула при создании учетной записи пакетной службы см. в разделе [Учетная запись](batch-api-basics.md#account) статьи [Разработка решений для крупномасштабных параллельных вычислений с использованием пакетной службы](batch-api-basics.md).

- **Учетная запись хранения Azure.** Чтобы создать пул конфигурации виртуальной машины с помощью пользовательского образа, потребуется одна или несколько стандартных учетных записей хранения Azure для хранения пользовательских образов VHD. Пользовательские образы хранятся в виде больших двоичных объектов. Чтобы сослаться на свои пользовательские образы при создании пула, укажите URI больших двоичных объектов VHD-файлов пользовательских образов для свойства [osDisk](https://docs.microsoft.com/rest/api/batchservice/add-a-pool-to-an-account#bk_osdisk) свойства [virtualMachineConfiguration](https://docs.microsoft.com/rest/api/batchservice/add-a-pool-to-an-account#bk_vmconf).

    Убедитесь, что учетные записи хранения соответствуют следующим критериям:   
    
    - Учетные записи хранения, содержащие большие двоичные объекты VHD-файлов пользовательских образов, должны находиться в той же подписке, что и учетная запись пакетной службы (подписка пользователя).
    - Указанная учетная запись хранения должна быть в том же регионе, что и учетная запись пакетной службы.
    - Сейчас поддерживаются только стандартные учетные записи хранения общего назначения. В дальнейшем будет поддерживаться хранилище Azure класса Premium.
    - Вы можете указать одну учетную запись хранения с несколькими большими двоичными объектами пользовательских VHD-файлов или несколькими учетными записями хранения, каждая из которых имеет один большой двоичный объект. Мы советуем использовать несколько учетных записей хранения, чтобы получить лучшую производительность.
    - Один уникальный большой двоичный объект VHD пользовательского образа может поддерживать до 40 экземпляров виртуальных машин Linux или до 20 экземпляров виртуальных машин Windows. Вы можете создать копии большого двоичного объекта VHD для создания пулов с большим количеством виртуальных машин. Например, пулу с 200 виртуальными машинами Windows необходимо указать 10 уникальных больших двоичных объектов VHD для свойства **osDisk**.
    
## <a name="prepare-a-custom-image"></a>Подготовка пользовательского образа

Для подготовки пользовательского образа к использованию с пакетной службой необходимо подготовить имеющуюся установку Windows или Linux. При подготовке операционной системы удаляются сведения о компьютере. В результате вы получаете образ, который можно установить на других компьютерах или виртуальных машинах.  

Образ Azure Marketplace можно использовать в качестве базового для пользовательского образа. Чтобы настроить базовый образ, создайте виртуальную машину Azure и добавьте в нее приложения или данные. Затем подготовьте виртуальную машину, которая будет использоваться в качестве пользовательского образа.   

Сведения о подготовке пользовательских образов под управлением Linux на основе виртуальных машин Azure см. в статье [Создание образа виртуальной машины или виртуального жесткого диска](../virtual-machines/linux/capture-image.md). 

Сведения о подготовке пользовательских образов под управлением Windows на основе виртуальных машин Azure см. в статье [Создание пользовательского образа виртуальной машины Azure с помощью PowerShell](../virtual-machines/windows/tutorial-custom-images.md) и [Sysprep (System Preparation) Overview](https://docs.microsoft.com/windows-hardware/manufacture/desktop/sysprep--system-preparation--overview) (Обзор Sysprep (подготовка системы)). 

> [!IMPORTANT]
> При подготовке пользовательского образа учитывайте следующие факторы:
> - Убедитесь, что в базовом образе операционной системы, который используется для подготовки пулов пакетной службы, нет предварительно установленных расширений Azure, например расширения "Настраиваемый скрипт". Если образ содержит предварительно установленное расширение, могут возникнуть проблемы при развертывании виртуальной машины в Azure.
> - Убедитесь, что для базового образа операционной системы, предоставленного вами, по умолчанию используется временный диск, так как на текущем этапе для агента узла пакетной службы требуется этот временный диск.
>
>
    
## <a name="create-a-pool-from-a-custom-image-in-the-portal"></a>Создание пула на основе пользовательского образа на портале

Чтобы создать пул из пользовательского образа, используя портал Azure:

1. Войдите в свою учетную запись пакетной службы на портале Azure.
2. В колонке **Параметры** выберите пункт меню **Пулы**.
3. В колонке **Пулы** выберите команду **Добавить**, после чего отобразится колонка **Добавить пул**.
4. В раскрывающемся списке **Тип образа** выберите **Пользовательский образ (Linux или Windows)**. На портале отобразится средство выбора **пользовательского образа**. Выберите один или несколько VHD из одного контейнера и нажмите кнопку **Выбрать**. 
   Поддержка возможности выбора виртуальных жестких дисков из разных учетных записей хранения и других контейнеров будет доступна в будущих выпусках.
5. Выберите правильные значения **издателя, предложения, SKU** для пользовательских VHD, выберите желаемый режим **кэширования**, а затем заполните все остальные параметры для пула.
6. Чтобы проверить, основан ли пул на пользовательском образе, найдите свойство **Операционная система** в разделе сводки по ресурсу колонки **Пул**. Это свойство должно иметь значение **Пользовательский образ виртуальной машины**.
7. Все пользовательские VHD, связанные с пулом, отображаются в колонке **Свойства** пула.
 
## <a name="next-steps"></a>Дальнейшие действия

- Исчерпывающий обзор пакетной службы см. в статье [Разработка решений для крупномасштабных параллельных вычислений с использованием пакетной службы](batch-api-basics.md).
- Сведения о создании учетной записи пакетной службы см. в статье [Создание учетной записи пакетной службы на портале Azure](batch-account-create-portal.md).
