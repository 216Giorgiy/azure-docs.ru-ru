<properties 
	pageTitle="IPython Notebook - учебник по Azure" 
	description="В этом учебнике показано, как развернуть IPython Notebook в Azure с использованием виртуальных машин Linux или Windows." 
	services="virtual-machines" 
	documentationCenter="python" 
	authors="huguesv" 
	manager="wpickett" 
	editor=""/>

<tags 
	ms.service="virtual-machines" 
	ms.workload="infrastructure-services" 
	ms.tgt_pltfrm="vm-multiple" 
	ms.devlang="python" 
	ms.topic="article" 
	ms.date="02/05/2015" 
	ms.author="huvalo"/>





# IPython Notebook в Azure

<div class="dev-onpage-video-clear clearfix">
<div class="dev-onpage-left-content">
<p>Проект <a href="http://ipython.org">IPython</a> предоставляет набор средств для научных вычислений, включая мощные интерактивные оболочки, высокопроизводительные и простые в использовании параллельные библиотеки, а также веб-среду под названием IPython Notebook. Notebook содержит рабочую среду для интерактивных вычислений, которая сочетает в себе выполнение кода с созданием документа вычислений в реальном времени. Эти файлы записной книжки могут содержать произвольный текст, математические формулы, код ввода, результаты, графику, видео и любые другие виды носителей, которые может отображать современный веб-браузер.</p>
</div>
<div class="dev-onpage-video-wrapper"><a href="http://go.microsoft.com/fwlink/?LinkID=254535&amp;clcid=0x409" target="_blank" class="label">Просмотр учебника</a> <a style="background-image: url('/media/devcenter/python/ipy-youtube2.png') !important;" href="http://go.microsoft.com/fwlink/?LinkID=254535&amp;clcid=0x409" target="_blank" class="dev-onpage-video"><span class="icon">Воспроизведение видео</span></a> <span class="time">5:22</span></div>
</div>

Если вы абсолютный новичок в языке Python и хотите  выучить его в непринужденной
интерактивной среде, или занимаетесь серьезными параллельными/ техническими вычислениями, то
IPython Notebook просто отличный выбор. Для иллюстрации его возможностей на
следующем снимке экрана показано использование IPython Notebook в комбинации с
пакетами SciPy и matplotlib для анализа структуры звука
записи.

![Screenshot](./media/virtual-machines-python-ipython-notebook/ipy-notebook-spectral.png)

В этом документе показано как развернуть IPython Notebook в Microsoft
Azure с использованием виртуальных машин Linux или Windows.  Благодаря использованию IPython
Notebook в Azure можно легко предоставить веб-интерфейс для
масштабируемых вычислительных ресурсов со всеми возможностями Python и его многочисленных
библиотек.  Поскольку вся установка выполняется в облаке, пользователи могут получить к ним доступ
без необходимости выполнять локальную настройку вне современного
веб-браузера.

[AZURE.INCLUDE [create-account-and-vms-note](../includes/create-account-and-vms-note.md)]

## Создание и настройка виртуальной машины в Azure

Первым шагом является создание виртуальной машины (VM) в Azure.
Эта виртуальная машина является полноценной операционной системой в облаке и будет использоваться для
запуска IPython Notebook. Azure может запустить виртуальные машины Linux и Windows,
и мы рассмотрим установку ipython на обоих типах виртуальных машин.

### Виртуальная машина Linux

Следуйте инструкциям, приведенным [здесь][portal-vm-linux], чтобы создать виртуальную машину дистрибутива *OpenSUSE* или *Ubuntu*. В этом учебнике используются OpenSUSE 13.1 и Ubuntu Server 14.04 LTS. Предположим, что имя пользователя по умолчанию - *azureuser*.

### Виртуальная машина Windows

Следуйте инструкциям, приведенным [здесь][portal-vm-windows], чтобы создать виртуальную машину дистрибутива *Windows Server 2012 R2 Datacenter*. В этом учебнике предполагается, что имя пользователя - *azureuser*.

## Создание конечной точки для IPython Notebook

Этот шаг применяется для виртуальной машины Windows и Linux. Позднее мы настроим
IPython для запуска его сервера notebook в порте 9999. Чтобы сделать этот порт открытым,
необходимо создать конечную точку на портале управления Azure. Эта
конечная точка открывает порт в брандмауэре Azure и сопоставляет общий порт (HTTPS
443) с частным портом на виртуальной машине (9999).

Чтобы создать конечную точку, перейдите к панели мониторинга виртуальной машины, щелкните "Конечные  точки", затем "Добавить
конечную точку" и создайте новую конечную точку (с именем `ipython_nb` в этом примере). Выберите
протокол TCP, 443 для общего порта и 9999 для частного порта.

![Screenshot](./media/virtual-machines-python-ipython-notebook/ipy-azure-linux-005.png)

После этого действия вкладка панели мониторинга "Конечные точки" будет иметь следующий вид:

![Screenshot](./media/virtual-machines-python-ipython-notebook/ipy-azure-linux-006.png)

## Установка необходимого программного обеспечения в виртуальной машине

Чтобы запустить IPython Notebook на виртуальной машине, необходимо сначала установить IPython и
его зависимости.

### Linux (OpenSUSE)

Чтобы установить IPython и его зависимости, а также SSH в виртуальную машину Linux, выполните 
следующие действия.

Установите [NumPy][numpy], [Matplotlib][matplotlib], [Tornado][tornado] и другие зависимости IPython, выполнив следующее:

    sudo zypper install python-matplotlib
    sudo zypper install python-tornado
    sudo zypper install python-jinja2
    sudo zypper install ipython

### Linux (Ubuntu)

Чтобы установить IPython и его зависимости, а также SSH в виртуальную машину Linux, выполните 
следующие действия.

Сначала получите новые списки пакетов.

    sudo apt-get update

Установите [NumPy][numpy], [Matplotlib][matplotlib], [Tornado][tornado] и другие зависимости IPython, выполнив следующее:

    sudo apt-get install python-matplotlib
    sudo apt-get install python-tornado
    sudo apt-get install ipython
    sudo apt-get install ipython-notebook

### Windows

Чтобы установить IPython и его зависимости на виртуальной машине Windows подключитесь к этой ВМ с использованием удаленного рабочего стола. Затем выполните следующие действия 
с использованием Windows PowerShell для выполнения всех действий командной строки.

**Примечание**. Для загрузки данных с помощью Internet Explorer необходимо изменить некоторые параметры безопасности.  В **Диспетчере серверов** щелкните **Локальный сервер**, а затем - **Расширенная настройка безопасности IE** и отключите ее для администраторов.  Можно включить ее снова после завершения установки IPython.

1.  Загрузите и установите последнюю 32-разрядную версию [Python 2.7][].  Будет необходимо добавить `C:\Python27` and `C:\Python27\Scripts` к переменной среды `PATH`.

1.  Установите [Tornado][tornado] и [PyZMQ][pyzmq], а также другие зависимости IPython, выполнив следующие действия.

        easy_install tornado
        easy_install pyzmq
        easy_install jinja2
        easy_install six
        easy_install python-dateutil
        easy_install pyparsing

1.  Загрузите и установите [NumPy][numpy] с помощью установщика двоичных файлов `.exe`, доступного на веб-сайте.  На момент написания этой статьи последняя версия - **numpy-1.9.1-win32-superpack-python2.7.exe**.

1.  Установите [Matplotlib][matplotlib], выполнив следующее.

        pip install matplotlib==1.4.2

1.  Загрузите и установите [OpenSSL][].

	* Можно найти необходимый **Visual C++ 2008 Redistributable** на той же странице загрузки.

	* Будет необходимо добавить `C:\OpenSSL-Win32\bin` к переменной среды `PATH`.

	> [AZURE.NOTE] При установке OpenSSL используйте версию 1.0.1g или более позднюю, так как они включают в себя исправление для уязвимости безопасности Heartbleed.

1.  Установите IPython с помощью команды:

        pip install ipython==2.4

1.  Откройте порт в брандмауэре Windows.  В Windows Server 2012 брандмауэр по умолчанию блокирует входящие подключения.  Чтобы открыть порт 9999, выполните следующие действия:

    - Запустите **брандмауэр Windows в режиме повышенной безопасности** на начальном экране.

    - На левой панели щелкните **Правила для входящих подключений**.

	- На панели "Действия" щелкните **Создать правило...**.

	- В мастере создания правил для входящих подключений выберите **Порт**.

	- На следующем экране выберите **TCP** и введите **9999** в поле **Определенные локальные порты**.

	- Примите значения по умолчанию, присвойте правилу имя и нажмите кнопку "Готово".

### Настройка IPython Notebook

Затем следует настроить IPython Notebook. Первый шаг - это создать пользовательский
профиль конфигурации IPython для инкапсуляции информации о конфигурации:

    ipython profile create nbserver

Далее добавим `cd` к папке профиля для создания сертификата SSL и изменения
файла конфигурации профилей.

В Linux:

    cd ~/.ipython/profile_nbserver/

В Windows:

    cd \users\azureuser\.ipython\profile_nbserver

Создайте сертификат SSL следующим образом (Linux и Windows):

    openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout mycert.pem -out mycert.pem

Обратите внимание, что поскольку создается самозаверяющий сертификат SSL, при подключении
к записной книжке браузер выводит сообщение безопасности.  Для долгосрочного
использования в рабочей среде, необходимо использовать должным образом подписанный сертификат, связанный
с вашей организацией.  Поскольку управление сертификатами выходит за пределы области
этой демонстрации, мы пока ограничимся рассмотрением самозаверяюшегоо сертификата.

Помимо использования сертификата необходимо указать пароль для защиты
записной книжки от несанкционированного использования.  По соображениям безопасности IPython использует
зашифрованные пароли в своем файле конфигурации, поэтому необходимо сначала зашифровать
пароль.  IPython предоставляет для этого соответствующую утилиту; в командной строке выполните следующую команду:

    python -c "import IPython;print IPython.lib.passwd()"

В результате будет запрашиваться пароль и подтверждение, а затем
печатается пароль следующим образом:

    Enter password: 
    Verify password: 
    sha1:b86e933199ad:a02e9592e59723da722.. (elided the rest for security)
    
Далее предстоит отредактировать файл конфигурации профиля, то есть файл
`ipython_notebook_config.py` в папке профиля, в которой вы находитесь. Обратите внимание, что этого файла может не быть и тогда нужно просто его создать.  В этом
файле содержится несколько полей и по умолчанию они все закомментированы.  Можно открыть
этот файл в любом предпочитаемом вами текстовом редакторе. При этом необходимо убедиться в том, что
в нем находится, как минимум, следующее содержимое:

    c = get_config()
    
    # This starts plotting support always with matplotlib
    c.IPKernelApp.pylab = 'inline'
    
    # You must give the path to the certificate file.
    
    # If using a Linux VM:
    c.NotebookApp.certfile = u'/home/azureuser/.ipython/profile_nbserver/mycert.pem'
    
    # And if using a Windows VM:
    c.NotebookApp.certfile = r'C:\Users\azureuser\.ipython\profile_nbserver\mycert.pem'
    
    # Create your own password as indicated above
    c.NotebookApp.password = u'sha1:b86e933199ad:a02e9592e5 etc... '
    
    # Network and browser details. We use a fixed port (9999) so it matches
    # our Azure setup, where we've allowed traffic on that port
    
    c.NotebookApp.ip = '*'
    c.NotebookApp.port = 9999
    c.NotebookApp.open_browser = False

### Запуск IPython Notebook

Теперь можно запустить IPython Notebook. Чтобы сделать это,
перейдите в каталог, в котором необходимо хранить записные книжки, и запустите
сервер IPython Notebook:

    ipython notebook --profile=nbserver

Теперь можно получить доступ к IPython Notebook по адресу:
`https://[ваше выбранное имя].cloudapp.net`.

При первом обращении к записной книжке, на странице входа будет запрошен пароль:

![Screenshot](./media/virtual-machines-python-ipython-notebook/ipy-notebook-001.png)

После входа, вы увидите "Панель мониторинга IPython Notebook", которая представляет собой
центр управления для всех операция в записной книжке.  На этой странице можно создать
новые записные книжки, открыть существующие и т. д:

![Screenshot](./media/virtual-machines-python-ipython-notebook/ipy-notebook-002.png)

При нажатии на кнопку "Создать записную книжку" появится стартовая страница как
показано ниже:

![Screenshot](./media/virtual-machines-python-ipython-notebook/ipy-notebook-003.png)

Область, отмеченная запросом `In []:`, является областью ввода. Здесь можно
ввести любой допустимый код Python, который будет выполняться при нажатии клавиш `Shift-Enter` или
при щелчке по значку "Воспроизведение" (направленный вправо треугольник на панели инструментов).

Так как записная книжка настроена с автоматической поддержкой NumPy и matplotlib,
можно даже создавать рисунки, например:

![Screenshot](./media/virtual-machines-python-ipython-notebook/ipy-notebook-004.png)

## Мощная парадигма: документы с вычислениями в режиме реального времени и богатыми возможностями мультимедиа

Записная книжка воспринимается исключительно естественно всеми, кто использовал Python и
текстовый процессор, поскольку она представляет собой в некотором смысле сочетание и того, и другого. Вы можете
выполнять блоки кода Python, но при этом можно также сохранять заметки и другой текст, изменив
стиль ячейки с "Код" на "Разметка" с помощью раскрывающегося меню в
панели инструментов:

![Screenshot](./media/virtual-machines-python-ipython-notebook/ipy-notebook-005.png)


Но это гораздо больше, чем текстовый процессор, так как IPython Notebook позволяет
смешивать вычисления и широкие возможности мультимедиа (текст, графика, видео и практически
все, что может отображать современный веб-браузер). Например, можно одновременно
поместить пояснительные видео с расчетами для использования в образовательных целях:

![Screenshot](./media/virtual-machines-python-ipython-notebook/ipy-notebook-006.png)

или встраивать внешние веб-сайты (которые остаются рабочими и могут использоваться) в
файл записной книжки:

![Screenshot](./media/virtual-machines-python-ipython-notebook/ipy-notebook-007.png)

Благодаря мощным возможностям многочисленных великолепных библиотек Python для научных и
технических вычислений простые вычисления могут выполняться с такой же легкостью,
как и анализ сложных сетей. И все это делается в одной среде:

![Screenshot](./media/virtual-machines-python-ipython-notebook/ipy-notebook-008.png)

Эта парадигма сочетания мощи современного веб-браузера с динамическими вычислениями
предлагает множество возможностей и идеально подходит для облака. Notebook
можно использовать:

* как вычислительный электронный блокнот для регистрации исследовательской работы над проблемой;

* для совместного использования результатов с коллегами либо в форме вычислений в режиме реального времени,
  либо в формате печатной копии (HTML, PDF);

* для распространения и представления материалов интерактивного обучения, включающих вычисления,
  что позволит слушателям сразу же приступить к экспериментам с реальным кодом, изменять его
  и повторно выполнять в интерактивном режиме;

* для предоставления "исполняемых документов", в которых представлены результаты исследования таким образом,
  что оно может быть немедленно воспроизведено, проверено и дополнено другими;

* как платформа для совместной работы: несколько пользователей могут войти на один
  сервер Notebook для совместной работы в интерактивном сеансе вычислений;

* и многое другое...

При переходе к исходному коду IPython [репозиторий][] можно познакомиться с целым
каталогом с примерами записной книжки, которые можно загрузить и затем проверить на виртуальной машине Azure IPython.  Просто загрузите файлы `.ipynb`  с сайта и отправьте их на панель мониторинга виртуальной машины Azure для записной книжки (или загрузите их прямо в виртуальную машину).

## Заключение

IPython Notebook предоставляет богатый возможностями интерфейс для доступа в интерактивном режиме к
мощной экосистеме Python в Azure.  Он охватывает широкий диапазон
вариантов использования, в том числе простой просмотр и изучение Python, анализ данных, а также
визуализацию, моделирование и параллельные вычисления. Полученные в Notebook
документы содержат полную запись выполняемых вычислений, которыми
можно поделиться с другими пользователями IPython.  IPython Notebook можно использовать в качестве
локального приложения, но он идеально подходит для облачных развертываний в Azure

Основные функции IPython также доступны в Visual Studio в 
[инструментах Python для Visual Studio][] (PTVS). PTVS - бесплатный и открытый подключаемый модуль 
корпорации Майкрософт, который превращает Visual Studio в расширенную среду разработки Python. 
Эта среда содержит расширенный редактор с поддержкой технологии IntelliSense, средства отладки, 
профилирования и интеграции параллельных вычислений.



[tornado]:      http://www.tornadoweb.org/          "Tornado"
[PyZMQ]:        https://github.com/zeromq/pyzmq     "PyZMQ"
[NumPy]:        http://www.numpy.org/               "NumPy"
[Matplotlib]:   http://matplotlib.sourceforge.net/  "Matplotlib"

[portal-vm-windows]: /ru-ru/manage/windows/tutorials/virtual-machine-from-gallery/
[portal-vm-linux]: /ru-ru/manage/linux/tutorials/virtual-machine-from-gallery/

[репозиторий]: https://github.com/ipython/ipython
[Инструменты Python для Visual Studio]: http://aka.ms/ptvs

[Python 2.7]: http://www.python.org/download
[OpenSSL]: http://slproweb.com/products/Win32OpenSSL.html

<!--HONumber=45--> 
