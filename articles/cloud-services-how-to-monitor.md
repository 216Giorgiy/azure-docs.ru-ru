<properties linkid="manage-services-how-to-monitor-a-cloud-service" urlDisplayName="How to monitor" pageTitle="How to monitor a cloud service - Azure" metaKeywords="Azure monitoring cloud services, Azure Management Portal cloud services" description="Learn how to monitor cloud services by using the Azure Management Portal." metaCanonical="" services="cloud-services" documentationCenter="" title="How to Monitor Cloud Services" authors="ryanwi" solutions="" manager="timlt" editor="" />

<tags ms.service="cloud-services" ms.workload="tbd" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="ryanwi" />

# Мониторинг облачных служб

[WACOM.INCLUDE [отказ от ответственности](../includes/disclaimer.md)]

Вы можете отслеживать ключевые метрики производительности облачных служб на портале управления Azure. Для каждой роли службы можно задать минимальный или подробный уровень, а также настроить отображение данных мониторинга. Подробные данные мониторинга размещаются в учетной записи хранения, которая доступна вне портала.

Портал управления предоставляет широкие возможности для настройки отображения данных мониторинга. Метрики для мониторинга можно выбрать в соответствующем списке на странице **Мониторинг**. Также можно указать метрики, которые будут строиться на диаграмме на странице **Мониторинг** или панели мониторинга.

## Оглавление

-   [Основные понятия][Основные понятия]
-   [Практическое руководство. Настройка мониторинга для облачных служб][Практическое руководство. Настройка мониторинга для облачных служб]
-   [Практическое руководство. Получение оповещений для метрик облачных служб][Практическое руководство. Получение оповещений для метрик облачных служб]
-   [Практическое руководство. Добавление метрик в таблицу метрик][Практическое руководство. Добавление метрик в таблицу метрик]
-   [Практическое руководство. Настройка диаграммы метрик][Практическое руководство. Настройка диаграммы метрик]
-   [Практическое руководство. Доступ к данным подробного мониторинга вне портала управления][Практическое руководство. Доступ к данным подробного мониторинга вне портала управления]

## <span id="concepts"></span></a>Основные понятия

По умолчанию в новой облачной службе настроен минимальный уровень мониторинга, основанный на данных счетчиков производительности из основной операционной системы для экземпляров роли (виртуальные машины). В этом режиме отслеживаются следующие метрики: «Процент ЦП», «Входящие данные», «Исходящие данные», «Скорость чтения с диска» и «Скорость записи на диск». Для просмотра дополнительных метрик на основе данных о производительности виртуальных машин (экземпляры роли) необходимо настроить подробный мониторинг. В этом режиме обеспечивается более тщательный анализ проблем, возникающих во время работы приложений.

> [WACOM.NOTE]
> Для подробного мониторинга вы можете добавить дополнительные счетчики производительности при запуске экземпляра роли с помощью файла конфигурации диагностики, а также удаленно через API системы диагностики Azure. Чтобы отслеживать эти метрики на портале управления, перед настройкой подробного мониторинга необходимо добавить соответствующие счетчики производительности. Дополнительную информацию см. в разделе [Сбор данных журналов с помощью средств диагностики Azure][Сбор данных журналов с помощью средств диагностики Azure] и [Создание и использование счетчиков производительности в приложении Azure][Создание и использование счетчиков производительности в приложении Azure].

По умолчанию выборка и передача данных счетчиков производительности из экземпляра роли осуществляется с интервалом в 3 минуты. Если включен подробный мониторинг, для каждого отдельного экземпляра роли и всех экземпляров каждой роли необработанные данные счетчиков собираются с интервалами 5 минут, 1 час и 12 часов. Сводные данные хранятся 10 дней, после чего удаляются.

После включения подробного мониторинга сводные данные размещаются в таблицах учетной записи хранения. Чтобы включить подробный мониторинг, необходимо настроить строку подключения диагностики для связи с учетной записью хранения. Для каждой роли можно использовать собственную учетную запись хранения.

Обратите внимание, что при включенном подробном мониторинге возрастают затраты, связанные с хранением, передачей данных и выполнением транзакций хранилища. При минимальном уровне мониторинга учетная запись хранения не требуется. Данные метрик, доступных на этом уровне, не добавляются в учетную запись хранения, даже если включен подробный мониторинг.

## <span id="verbose"></span></a>Практическое руководство. Настройка мониторинга для облачных служб

Чтобы настроить минимальный или подробный уровень мониторинга на портале управления, выполните следующие действия. Прежде чем настраивать подробный мониторинг, необходимо включить систему диагностики Azure и настроить строки подключения системы диагностики, чтобы обеспечить доступ к учетным записям хранения, где будут размещаться данные мониторинга.

### Перед началом работы

-   Создайте учетную запись хранения, в которой будут размещаться данные мониторинга. Для каждой роли можно использовать собственную учетную запись хранения. Дополнительные сведения см. в справке для компонента **Учетные записи хранения** или в разделе [Создание учетной записи хранения][Создание учетной записи хранения].

-   Включите систему диагностики Azure для ролей облачной службы.<br />
    При этом необходимо обновить файлы определения (CSDEF) и конфигурации (CSCFG) службы. Дополнительную информацию см. в разделе [Настройка системы диагностики Azure][Настройка системы диагностики Azure].

На портале управления вы можете добавить или изменить строки подключения системы диагностики, которые используются Azure для доступа к учетной записи хранения, где размещаются данные подробного мониторинга, а также выбрать необходимый уровень мониторинга. Поскольку данные подробного мониторинга размещаются в учетной записи хранения, перед настройкой этого уровня необходимо определить строки подключения диагностики.

### Настройка строк подключения диагностики для подробного мониторинга

1.  Скопируйте ключ доступа к хранилищу для учетной записи, в которой будут размещаться данные подробного мониторинга. Для этого войдите на [Портал управления Azure][Портал управления Azure] и выберите **Управление ключами** на странице **Учетные записи хранения**. Дополнительные сведения см. в разделе [Управление облачными службами][Управление облачными службами] или в справке для страницы **Учетные записи хранения**.

2.  Откройте страницу **Облачные службы**. Щелкните имя настраиваемой облачной службы, чтобы открыть панель мониторинга.

3.  Выберите **Рабочая среда** или **Промежуточная среда**, чтобы показать соответствующее развертывание для настройки.

4.  Нажмите **Настроить**.

    Параметры **мониторинга** представлены в верхней части страницы **Настройка** (см. ниже). Если для облачной службы не включена система диагностики Azure, параметр **Уровень** будет недоступен. Изменить политику хранения данных нельзя. Данные подробного мониторинга для облачной службы хранятся в течение 10 дней.

    ![Параметры мониторинга][Параметры мониторинга]

5.  В разделе **Строки подключения диагностики** определите строки для каждой роли, для которой требуется настроить подробный мониторинг.

    Формат строк подключения показан ниже. В этом примере приводится облачная служба с заданными по умолчанию конечными точками. Чтобы обновить строку подключения, введите допустимое имя учетной записи хранения и соответствующий ключ доступа к хранилищу.

    DefaultEndpointsProtocol=https;AccountName=StorageAccountName;AccountKey=StorageAccountKey

6.  Щелкните **Сохранить**.

Чтобы включить подробный мониторинг, выполните следующие действия после настройки строк подключения диагностики для ролей службы.

### Изменение уровня мониторинга на подробный или минимальный

1.  Войдите на [Портал управления][Портал управления Azure] и откройте страницу **Настройка** для развертывания облачной службы.

2.  В поле **Уровень** выберите **Подробно** или **Минимальный**.

3.  Щелкните **Сохранить**.

После включения подробного мониторинга соответствующие данные появляются на портале управления в течение часа.

Необработанные данные счетчиков производительности и сводные данные мониторинга размещаются в таблицах учетной записи хранения, определяемых идентификатором развертывания для ролей.

## <span id="receivealerts"></span></a>Практическое руководство. Получение оповещений для метрик облачной службы

Вы можете настроить получение оповещений на основе метрик мониторинга облачной службы. На странице **Службы управления** портала управления Azure можно создать правило, которое инициирует оповещение при достижении заданного значения выбранной метрики. Кроме того, вы можете настроить отправку сообщения электронной почты с оповещением. Дополнительные сведения см. в разделе [Практическое руководство. Получение уведомлений об оповещениях и управление правилами оповещения в Azure][Практическое руководство. Получение уведомлений об оповещениях и управление правилами оповещения в Azure].

## <span id="addmetrics"></span></a>Практическое руководство. Добавление метрик в таблицу метрик

1.  Войдите на [Портал управления][Портал управления] и откройте страницу **Мониторинг** для облачной службы.

    По умолчанию в таблице отображается лишь часть доступных метрик. На этом рисунке показаны метрики подробного мониторинга, устанавливаемые по умолчанию для облачной службы. К ним относятся сводные данные сведения о свободной памяти и доступном хранилище (в мегабайтах) на уровне роли. Чтобы выбрать дополнительные сводные метрики и метрики на уровне роли для мониторинга на портале управления, используйте команду **Добавить метрики**.

    ![Подробные данные мониторинга][Подробные данные мониторинга]

2.  Добавление метрик в таблицу метрик:

    а) Щелкните **Добавить метрики**. Откроется представленное ниже окно **Выберите метрики**.
    Первая доступная метрика будет представлена в развернутом виде со всеми доступными параметрами. Верхний параметр для каждой метрики позволяет отобразить сводные данные мониторинга по всем ролям. Также вы можете выбрать отдельные роли, для которых требуется отображать данные.

    ![Добавление метрик][Добавление метрик]

    б) Выберите отображаемые метрики. Для этого выполните следующие действия:

    -   Щелкните стрелку вниз рядом с метрикой, чтобы развернуть параметры мониторинга.
    -   Установите флажки рядом с параметрами, которые требуется отображать.

    В таблице метрик может отображаться до 50 метрик.

    <div class="dev-callout"> 
<b>Совет.</b> 
<p>При подробном мониторинге в списке может отображаться несколько десятков метрик. Чтобы отобразить полосу прокрутки, наведите указатель мыши на правый край диалогового окна. Чтобы отфильтровать список, щелкните значок поиска и введите необходимый текст (см. ниже).</p> 
</div>

    ![Настройка поиска по метрикам][Настройка поиска по метрикам]

3.  Выбрав все нужные метрики, нажмите кнопку «ОК» (флажок).

    Выбранные метрики добавляются в таблицу метрик (см. ниже).

    ![Метрики мониторинга][Метрики мониторинга]

4.  Чтобы удалить метрику из таблицы, выберите ее и щелкните **Удалить метрики**. (Команда **Удалить метрики** доступна только в том случае, если выбрана хотя бы одна метрика.)

## <span id="customizechart"></span></a>Практическое руководство. Настройка диаграммы метрик

1.  В таблице метрик можно выбрать до 6 метрик, на основе которых будет построена диаграмма. Чтобы выбрать метрику, установите флажок слева от нее. Чтобы удалить метрику с диаграммы, снимите соответствующий флажок в таблице метрик.

    Метрики, выбранные в таблице, добавляются на диаграмму. При ограниченном размере окна отображается раскрывающийся список **Еще n**, в котором представлены заголовки метрик, не умещающихся на экране.

2.  Для переключения между относительными (только итоговые значения) и абсолютными (значения по оси Y) значениями метрики щелкните «Относительные» или «Абсолютные» вверху диаграммы.

    ![Относительные или абсолютные][Относительные или абсолютные]

3.  Чтобы изменить временной диапазон для отображения метрик на диаграмме, щелкните «1 час», «24 часа» или «7 дней» вверху диаграммы.

    ![Период отображения данных мониторинга][Период отображения данных мониторинга]

    На диаграмме метрик в панели мониторинга применяется другой способ построения метрик. Вы можете использовать метрики из стандартного набора, а также добавлять и удалять метрики, выбирая их заголовки.

### Настройка диаграммы метрик на панели мониторинга

1.  Откройте панель мониторинга облачной службы.

2.  Добавьте или удалите метрики для диаграммы:

    -   Чтобы построить новую метрику, установите соответствующий ей флажок в заголовках диаграммы. При ограниченном размере окна щелкните стрелку вниз в раскрывающемся списке ***Еще* n**, чтобы построить метрику, которая не отображается в области заголовка диаграммы.

    -   Чтобы удалить построенную на диаграмме метрику, снимите флажок рядом с ее заголовком.

3.  Выберите режим отображения значений: **Относительные** или **Абсолютные**.

4.  Выберите период отображения данных: «1 час», «24 часа» или «7 дней».

## <span id="accessverbose"></span></a>Практическое руководство. Доступ к данным подробного мониторинга вне портала управления

Подробные данные мониторинга размещаются в таблицах учетных записей хранения, определенных для каждой роли. В каждом развертывании облачной службы для роли создается шесть таблиц: по две для каждого интервала (5 минут, 1 час и 12 часов). В одной из них хранятся сводные данные на уровне роли, а в другой — сводные данные для экземпляров роли.

Имена таблиц имеют следующий формат:

    WAD*deploymentID*PT*aggregation_interval*[R|RI]Table

где:

-   *deploymentID* — это GUID развертывания облачной службы;

-   *aggregation\_interval* = 5M (5 мин), 1H (1 ч) или 12H (12 ч);

-   сводные данные на уровне роли = R;

-   сводные данные для экземпляров роли = RI.

Например, в следующих таблицах размещаются сводные данные подробного мониторинга, собираемые с интервалом в 1 час:

    WAD8b7c4233802442b494d0cc9eb9d8dd9fPT1HRTable (hourly aggregations for the role)
    WAD8b7c4233802442b494d0cc9eb9d8dd9fPT1HRITable (hourly aggregations for role instances)

  [отказ от ответственности]: ../includes/disclaimer.md
  [Основные понятия]: #concepts
  [Практическое руководство. Настройка мониторинга для облачных служб]: #verbose
  [Практическое руководство. Получение оповещений для метрик облачных служб]: #receivealerts
  [Практическое руководство. Добавление метрик в таблицу метрик]: #addmetrics
  [Практическое руководство. Настройка диаграммы метрик]: #customizechart
  [Практическое руководство. Доступ к данным подробного мониторинга вне портала управления]: #accessverbose
  [Сбор данных журналов с помощью средств диагностики Azure]: http://msdn.microsoft.com/ru-ru/library/gg433048.aspx
  [Создание и использование счетчиков производительности в приложении Azure]: http://msdn.microsoft.com/ru-ru/library/hh411542.aspx
  [Создание учетной записи хранения]: /ru-ru/manage/services/storage/how-to-create-a-storage-account/
  [Настройка системы диагностики Azure]: http://msdn.microsoft.com/ru-ru/library/windowsazure/dn186185.aspx
  [Портал управления Azure]: https://manage.windowsazure.com/
  [Управление облачными службами]: http://www.windowsazure.com/ru-ru/manage/services/cloud-services/how-to-manage-a-cloud-service/
  [Параметры мониторинга]: ./media/cloud-services-how-to-monitor/CloudServices_MonitoringOptions.png
  [Практическое руководство. Получение уведомлений об оповещениях и управление правилами оповещения в Azure]: http://go.microsoft.com/fwlink/?LinkId=309356
  [Портал управления]: http://manage.windowsazure.com/
  [Подробные данные мониторинга]: ./media/cloud-services-how-to-monitor/CloudServices_DefaultVerboseDisplay.png
  [Добавление метрик]: ./media/cloud-services-how-to-monitor/CloudServices_AddMetrics.png
  [Настройка поиска по метрикам]: ./media/cloud-services-how-to-monitor/CloudServices_AddMetrics_Search.png
  [Метрики мониторинга]: ./media/cloud-services-how-to-monitor/CloudServices_Monitor_UpdatedMetrics.png
  [Относительные или абсолютные]: ./media/cloud-services-how-to-monitor/CloudServices_Monitor_RelativeAbsolute.png
  [Период отображения данных мониторинга]: ./media/cloud-services-how-to-monitor/CloudServices_Monitor_DisplayPeriod.png
