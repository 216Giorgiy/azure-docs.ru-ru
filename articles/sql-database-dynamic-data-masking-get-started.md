<properties 
   pageTitle="Приступая к работе с динамической маскировкой данных в базе данных SQL" 
   description="Как приступить к работе с динамической маскировкой данных в базе данных SQL" 
   services="sql-database" 
   documentationCenter="" 
   authors="nadavhelfman" 
   manager="jeffreyg" 
   editor="v-romcal"/>

<tags
   ms.service="sql-database"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services" 
   ms.date="02/24/2015"
   ms.author="nadavh; ronmat; v-romcal; v-stste"/>

# Приступая к работе с динамической маскировкой данных в базе данных SQL 

## Обзор

Динамическая маскировка данных в базе данных SQL ограничивает возможность раскрытия конфиденциальных данных, маскируя их для обычных пользователей. Динамическая маскировка данных используется в предварительной версии для уровней обслуживания Basic, Standard и Premium в версии 12 базы данных SQL Azure.

Динамическая маскировка данных помогает предотвратить несанкционированный доступ к конфиденциальным данным, позволяя заказчикам самим определять, сколько конфиденциальных данных следует отображать, при минимальном влиянии на уровень приложения. Эта функция работает на основе политики безопасности, скрывая конфиденциальные данные в результирующем наборе запроса по заданным полям базы данных, не меняя сами данные в базе данных.

Например, специалист службы поддержки в центре обработки вызовов может идентифицировать абонентов по нескольким цифрам номера социального страхования или номера кредитной карты, но эти элементы данных не должны предоставляться ему полностью. Разработчик может определить правило маскировки, которое будет применяться для каждого результата запроса маскировать все цифры номера социального страхования или номер кредитной карты, кроме последних четырех, в результирующем наборе. Еще один пример - защита персональных данных с помощью соответствующей маски. Разработчик может отправлять запросы в рабочие среды для устранения неполадок, не нарушая при этом нормативные правила.

## Основы динамической маскировки данных в базе данных SQL

Настройте политику динамической маскировки данных на портале управления Azure, а затем воспользуйтесь строкой безопасного подключения, используемой приложением или другими клиентами, получающими доступ к базе данных, чтобы завершить настройку.

### Разрешения для динамической маскировки данных

Динамическую маскировку данных может настраивать администратор базы данных Azure, администратор сервера или сотрудник службы безопасности.

### Политика динамической маскировки данных

* **Имена для входа в привилегированном режиме** - набор имен пользователей, при использовании которых с данных, полученных в результатах SQL-запросов, снимается маска.
  
* **Правила маскировки** - набор правил, определяющих поля, подлежащие маскировке, и используемая функция маскирования. Задать такие поля можно с помощью имени таблицы базы данных и имени соответствующего столбца или с помощью имени псевдонима.

* **Маскировка по** - может выполняться в источнике или месте назначения. Маскировку можно настроить на уровне источника, определив имя **таблицы** и имя **столбца**, или на уровне результатов, определив **псевдоним**, который используется в запросе. Если вам известна архитектура данных базы данных и вы хотите ограничить отображение всех результатов запросов, то можете предпочесть правило маски источников. Вы можете добавить правило маски результатов, если нужно ограничить отображение результатов запросов без анализа архитектуры данных базы данных или ограничить отображение результатов запросов для поля, которое может поступать из различных источников.  
  
* **Расширенное ограничение** - ограничивает раскрытие конфиденциальных данных, но может отрицательно сказаться на работе некоторых приложений.

>[AZURE.TIP] С помощью параметра **Расширенное ограничение** можно ограничить доступ для разработчиков, использующих прямой доступ к базе данных и выполняющих SQL-запросы для устранения неполадок.

* **Функции маскировки** - набор методов, управляющих доступностью данных для различных сценариев.

| Функция маскировки | Логика маскировки |
|----------|---------------|
| **По умолчанию**  |**Полная маскировка в соответствии с типами данных предопределенных полей.**<br/><br/>• Для строковых типов данных (nchar, ntext, nvarchar) используется XXXXXXXX или меньшее количество символов "X", если размер поля меньше 8 символов.<br/>• Для числовых типов данных (bigint, bit, decimal, int, money, numeric, smallint, smallmoney, tinyint, float, real) используется нулевое значение.<br/>• Для типов данных даты и времени (date, datetime2, datetime, datetimeoffset, smalldatetime, time) используется текущее времени.<br/>• Для варианта SQL используется значение по умолчанию текущего типа.<br/>• Для XML-документа используется <masked/>.<br/>• Для специальных типов данных (таблица меток времени, hierarchyid, GUID, binary, image, пространственные типы varbinary) используется пустое значение.
| **Кредитная карта** |**Метод маскировки, который предоставляет последние четыре цифры предопределенных полей** и добавляет строковую константу в качестве префикса в формате номера кредитной карты.<br/><br/>XXXX-XXXX-XXXX-1234|
| **Номер социального страхования** |**Метод маскировки, который предоставляет две последние цифры предопределенных полей** и добавляет строковую константу в качестве префикса в формате номера социального страхования в США.<br/><br/>XXX-XX-XX12 |
| **Электронная почта** | **Метод маскировки, который предоставляет первую букву и домен**, используя строковую константу в качестве префикса в формате электронного адреса.<br/><br/>aXX@XXXX.com |
| **Случайное число** | **Метод маскировки, который формирует случайное число** в соответствии с выбранными границами и типами фактических данных. Если установленные границы равны, функция маскировки будет постоянным числом.<br/><br/>![Navigation pane][Image1] |
| **Пользовательский текст** | **Метод маскировки, который предоставляет первые и последние буквы** и добавляет пользовательскую строку заполнения в середине.<br/>префикс[заполнение]суффикс<br/><br/>![Navigation pane][Image2] |

  
<a name="Anchor1"></a>
### Строка безопасного подключения

В ходе настройки динамического выделения данных по маске Azure предоставит строку для безопасного подключения к базе данных. В соответствии с политикой динамической маскировки данных данные маскируются только для клиентов, которые используют эту строку подключения. Также необходимо обновить существующие клиенты (например, приложения), чтобы в них использовался новый формат строки подключения.

* Исходный формат строки подключения: <*имя_сервера*>.database.windows.net
* Новая строка для безопасного подключения: <*имя_сервера*>.database.**secure**.windows.net

Можно также изменить значение параметра **БЕЗОПАСНЫЙ ДОСТУП** с **НЕОБЯЗАТЕЛЬНО** на **ОБЯЗАТЕЛЬНО**. При этом будет исключена возможность доступа к базе данных с исходной строкой подключения, а политика динамической маскировки данных будет игнорироваться. Если собираетесь экспериментировать с динамической маскировкой данных в определенных клиентах (например, в приложении на этапе разработки или SSMS), выберите **НЕОБЯЗАТЕЛЬНО**. В рабочих средах выбирайте **ОБЯЗАТЕЛЬНО**.<br/><br/>

![Navigation pane][Image3]<br/><br/>

## Настройка динамической маскировки данных для базы данных с помощью портала управления Azure

1. Запустите портал управления Azure ([https://portal.azure.com](https://portal.azure.com)).
	 
2. Перейдите к колонке настройки базы данных, которая содержит конфиденциальные данные, подлежащие маскировке.
	
3. Щелкните плитку **Динамическая маскировка данных**. Запустится колонка настройки **Динамическая маскировка данных**.

	* Можно также прокрутить вниз до раздела **Операции** и нажать кнопку **Динамическая маскировка данных**.
	 
	![Navigation pane][Image4]<br/><br/>

4. В колонке настройки **Динамическая маскировка данных** щелкните **ВКЛЮЧЕНО**, чтобы включить функцию динамической маскировки данных.

	![Navigation pane][Image5]<br/><br/>

5. Введите привилегированные имена для входа, у которых должен быть доступ к немаскированным конфиденциальным данным.
 
	![Navigation pane][Image6]

	>[AZURE.TIP] Чтобы на уровне приложений для привилегированных пользователей могли отображаться конфиденциальные данные, добавьте имя для входа SQL приложения, которое используется для обращения к базе данных и отправки запросов. Настоятельно рекомендуется, чтобы этот список должен содержал минимально необходимое количество имен для входа. Это сведет к минимуму риск раскрытия конфиденциальных данных.

6. Щелкните **Добавить маску**, чтобы открыть колонку настройки **Добавление правила маскировки**.
	
7. Выберите **Маска по**, чтобы указать, как выполняется маскировка: по источнику или по назначению. Маскировку можно настроить на уровне источника, определив имя **таблицы** и имя **столбца**, или на уровне результатов, определив **псевдоним**, который используется в запросе. Если вам известна архитектура данных базы данных и вы хотите ограничить отображение всех результатов запросов, то можете предпочесть правило маски источников. Вы можете добавить правило маски результатов, если нужно ограничить отображение результатов запросов без анализа архитектуры данных базы данных или ограничить отображение результатов запросов для поля, которое может поступать из различных источников.

8. Введите имя **таблицы** и имя **столбца** или **псевдоним**, чтобы определить целевые поля, которые будут замаскированы.

9. Выберите **формат поля маскировки** в списке категорий маскировки конфиденциальных данных.

	![Navigation pane][Image7]<br/><br/>		

10. Щелкните **Сохранить** в колонке правил маскировки данных, чтобы обновить набор правил маскировки в политике динамической маскировки.

11. Рассмотрите возможность выбора параметра **ИСПОЛЬЗОВАТЬ РАСШИРЕННЫЕ ОГРАНИЧЕНИЯ**, который ограничивает отображение конфиденциальных данных с помощью нерегламентированных запросов.

12. Щелкните **Сохранить** в колонке настройки маскировки данных, чтобы сохранить новое или обновленное правило маскировки.

13. В разделе **Безопасный доступ** щелкните **НЕОБЯЗАТЕЛЬНО** или **ОБЯЗАТЕЛЬНО**. Дополнительную информацию см. в разделе [Строка безопасного подключения](#Anchor1).

	![Navigation pane][Image8]
	
## Настройка динамической маскировки данных для базы данных с помощью классического портала управления Azure

1. Запустите классический портал управления Azure ([https://manage.windowsazure.com](https://manage.windowsazure.com)).

2. Щелкните базу данных для применения маски, а затем выберите вкладку **АУДИТ И БЕЗОПАСНОСТЬ**.

3. В разделе **динамической маскировки данных** щелкните **ВКЛЮЧЕНО**, чтобы включить функцию динамической маскировки данных.  

4. Введите привилегированные имена для входа, у которых должен быть доступ к немаскированным конфиденциальным данным.

	>[AZURE.TIP] Чтобы на уровне приложений для привилегированных пользователей могли отображаться конфиденциальные данные, добавьте имя для входа в приложение, которое используется для обращения к базе данных и отправки запросов. Настоятельно рекомендуется, чтобы этот список должен содержал минимально необходимое количество имен для входа. Это сведет к минимуму риск раскрытия конфиденциальных данных.

	![Navigation pane][Image9]

5. В нижней части страницы в строке меню щелкните **ДОБАВИТЬ МАСКУ**, чтобы открыть окно настройки правил.

6. Выберите **Маска по**, чтобы указать, как выполняется маскировка: по источнику или по назначению. Маскировку можно настроить на уровне источника, определив имя **таблицы** и имя **столбца**, или на уровне результатов, определив **псевдоним**, который используется в запросе. Если вам известна архитектура данных базы данных и вы хотите ограничить отображение всех результатов запросов, то можете предпочесть правило маски источников. Вы можете добавить правило маски результатов, если нужно ограничить отображение результатов запросов без анализа архитектуры данных базы данных или ограничить отображение результатов запросов для поля, которое может поступать из различных источников.

7. Введите имя **таблицы** и имя **столбца** или **псевдоним**, чтобы определить целевые поля, которые будут замаскированы.

8. Выберите **ФУНКЦИЯ МАСКИРОВКИ** в списке категорий маскировки конфиденциальных данных.

	![Navigation pane][Image10] 
 	
9. Щелкните **Обновить** в окне правил маскировки данных, чтобы обновить набор правил маскировки в политике динамической маскировки данных.

10. Рассмотрите возможность выбора параметра **ИСПОЛЬЗОВАТЬ РАСШИРЕННЫЕ ОГРАНИЧЕНИЯ**, который ограничивает отображение конфиденциальных данных с помощью нерегламентированных запросов.

11. Щелкните **СОХРАНИТЬ**, чтобы сохранить новое или обновленное правило маскировки.

## Настройка динамической маскировки данных для базы данных с помощью REST API

См. статью [Операции для баз данных Azure SQL](https://msdn.microsoft.com/library/dn505719.aspx).

[Image1]: ./media/sql-database-dynamic-data-masking-get-started/1_DDM_Random_number.png
[Image2]: ./media/sql-database-dynamic-data-masking-get-started/2_DDM_Custom_text.png
[Image3]: ./media/sql-database-dynamic-data-masking-get-started/3_DDM_Current_Preview.png
[Image4]: ./media/sql-database-dynamic-data-masking-get-started/4_DDM_Activation.png
[Image5]: ./media/sql-database-dynamic-data-masking-get-started/5_DMM_Policy_Tile.png
[Image6]: ./media/sql-database-dynamic-data-masking-get-started/6_DDM_Privileged_Logins.png
[Image7]: ./media/sql-database-dynamic-data-masking-get-started/7_DDM_Add_Masking_Rule.png
[Image8]: ./media/sql-database-dynamic-data-masking-get-started/8_DDM_Security_Enabled_Access.png
[Image9]: ./media/sql-database-dynamic-data-masking-get-started/9_DMM_Policy_Classic_Portal.png
[Image10]: ./media/sql-database-dynamic-data-masking-get-started/10_DDM_Add_Masking_Rule_Classic_Portal.png
<!--HONumber=47-->
