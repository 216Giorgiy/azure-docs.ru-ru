<properties
   pageTitle="Журналы IIS в службе Log Analytics | Microsoft Azure"
   description="Службы IIS (Internet Information Services) хранят данные об активности пользователей в файлах журналов, собираемых службой Log Analytics. В этой статье описано, как настроить коллекцию журналов IIS и сведения о записях, созданных ими в репозитории OMS."
   services="log-analytics"
   documentationCenter=""
   authors="bwren"
   manager="jwhit"
   editor="tysonn" />
<tags
   ms.service="log-analytics"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="05/11/2016"
   ms.author="bwren" />

# Журналы IIS в службе Log Analytics
Службы IIS (Internet Information Services) хранят данные об активности пользователей в файлах журналов, собираемых службой Log Analytics.

![Журналы IIS](media/log-analytics-data-sources-iis-logs/overview.png)

## Настройка журналов IIS
Служба Log Analytics собирает записи из файлов журналов, созданных IIS, поэтому вам необходимо [настроить IIS для ведения журнала](https://technet.microsoft.com/library/hh831775.aspx) и указать, из каких полей служба Log Analytics должна собирать данные. По умолчанию IIS не записывает все поля; дополнительные поля можно выбрать вручную.

Служба Log Analytics поддерживает только файлы журналов IIS, которые хранятся в формате W3C. Она не собирает журналы в формате NCSA или в собственном формате IIS.

Журналы IIS настраиваются в меню [Данные раздела "Параметры" Log Analytics](log-analytics-data-sources.md/configuring-data-sources). Никакие настройки, кроме выбора параметра **Сбор файлов журналов IIS в формате W3C**, не требуются.

Если вы включаете сбор данных журналов IIS, рекомендуем настроить на каждом сервере переход на журналы IIS.


## Сбор данных

Log Analytics собирает записи в журналах IIS из каждого подключенного источника примерно раз в 15 минут. Агент фиксирует место сбора в каждом журнале событий, который используется для сбора данных. Если агент на некоторое время перейдет в автономный режим, Log Analytics будет собирать события, начиная с места остановки, даже если эти события были созданы, пока агент был отключен.


## Свойства записей в журналах IIS

Записи в журналах IIS имеют тип **W3CIISLog** и свойства, описанные в приведенной ниже таблице.

| Свойство | Описание |
|:--|:--|
| Компьютер | Имя компьютера, с которого было получено событие. |
| cIP | IP-адрес клиента. |
| csMethod | Метод запроса, такой как GET или POST. |
| csReferer | Сайт, с которого пользователь перешел на текущий сайт. |
| csUserAgent | Тип браузера клиента. |
| csUserName | Имя прошедшего проверку пользователя, который подключился к серверу. Анонимные пользователи обозначаются дефисом. |
| csUriStem | Целевой объект запроса, такой как веб-страница. |
| csUriQuery | Запрос, который пытался выполнить клиент (если есть). |
| ManagementGroupName | Имя группы управления для агентов SCOM. Для других агентов это AOI-<идентификатор\_рабочей\_области>. |
| RemoteIPCountry | Страна IP-адреса клиента. |
| RemoteIPLatitude | Широта IP-адреса клиента. |
| RemoteIPLongitude | Долгота IP-адреса клиента. |
| scStatus | Код состояния HTTP. |
| scSubStatus | Код ошибки подсостояния . |
| scWin32Status | Код состояния Windows. |
| sIP | IP-адрес веб-сервера. |
| SourceSystem | OpsMgr |
| sPort | Порт на сервере, к которому подключен клиент. |
| sSiteName | Имя сайта IIS. |
| TimeGenerated | Дата и время регистрации записи. |
| TimeTaken | Время обработки запроса в миллисекундах. |

## Поиск по журналами с помощью журналов IIS

В следующей таблице представлены различные примеры запросов к журналу, извлекающих записи из журналов IIS.

| Запрос | Описание |
|:--|:--|
| Type=IISLog | Все записи в журнале IIS. |
| Type=IISLog EventLevelName=error | Все события Windows с указанием серьезности ошибки. |
| Type=W3CIISLog | Measure count() by cIP | Число записей в журнале IIS по IP-адресу клиента. |
| Type=W3CIISLog csHost="www.contoso.com" | Measure count() by csUriStem | Число записей в журнале IIS по URL-адресу для узла www.contoso.com. |
| Type=W3CIISLog | Measure Sum(csBytes) by Computer | top 500000| Общее количество байтов, полученных каждым компьютером IIS. |

## Дальнейшие действия

- Настройте службу Log Analytics для сбора других [источников данных](log-analytics-data-sources.md) для анализа.
- Узнайте больше об [операциях поиска по журналу](log-analytics-log-searches.md), которые можно применять для анализа данных, собираемых из источников данных и решений.
- Настройте оповещения в службе Log Analytics для получения заблаговременных уведомлений о важных условиях, обнаруженных в журналах IIS.

<!---HONumber=AcomDC_0518_2016-->