---
title: "Монитор производительности сети в Azure Log Analytics | Документация Майкрософт"
description: "Возможность мониторинга конечной точки службы в Мониторе производительности сети позволяет отслеживать сетевые подключения к любой конечной точке с открытым TCP-портом."
services: log-analytics
documentationcenter: 
author: abshamsft
manager: carmonm
editor: 
ms.assetid: 5b9c9c83-3435-488c-b4f6-7653003ae18a
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/20/2018
ms.author: abshamsft
ms.openlocfilehash: ba19a4fc24668bff27c961b5b415f840d1132a34
ms.sourcegitcommit: fbba5027fa76674b64294f47baef85b669de04b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/24/2018
---
# <a name="service-endpoint-monitor"></a>Мониторинг конечной точки службы

Функция мониторинга конечной точки службы в [Мониторе производительности сети](log-analytics-network-performance-monitor.md) позволяет отслеживать сетевые подключения к любой конечной точке с открытым TCP-портом. К таким конечным точкам относятся веб-сайты, приложения SaaS, приложения PaaS и базы данных SQL. 

С помощью **мониторинга конечной точки службы** можно выполнять следующие функции: 

- Мониторинг сетевых подключений к приложениям и сетевым службам (например, Office 365, Dynamics CRM, внутренние бизнес-приложения, база данных SQL и т. д.) из нескольких филиалов или расположений. 
- Встроенные тесты для отслеживания сетевых подключений к конечным точкам Office 365 и Dynamics 365. 
- Определение времени отклика, задержки сети, потери пакетов, возникших при подключении к конечной точке. 
- Определение причины ухудшения производительности приложения (сеть или проблема в конечной точке поставщика приложения). 
- Определение активных точек в сети, которые могут быть причиной ухудшения производительности приложения, путем просмотра задержек, вызываемых каждым прыжком на карте топологии. 


![Мониторинг конечной точки службы](media/log-analytics-network-performance-monitor/service-endpoint-intro.png)


## <a name="configuration"></a>Параметр Configuration 
Чтобы открыть конфигурацию Монитора производительности сети, откройте решение [Монитор производительности сети](log-analytics-network-performance-monitor.md) и нажмите кнопку **Настройка**.

![Настройка Монитора производительности сети](media/log-analytics-network-performance-monitor/npm-configure-button.png)


### <a name="configure-oms-agents-for-the-monitoring"></a>Настройка агентов OMS для мониторинга  
Включите следующие правила брандмауэра на узлах, используемых для мониторинга, чтобы решение могло определить топологию подключения от узлов к конечной точке службы: 

```
netsh advfirewall firewall add rule name="NPMDICMPV4Echo" protocol="icmpv4:8,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV6Echo" protocol="icmpv6:128,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV4DestinationUnreachable" protocol="icmpv4:3,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV6DestinationUnreachable" protocol="icmpv6:1,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV4TimeExceeded" protocol="icmpv4:11,any" dir=in action=allow 
netsh advfirewall firewall add rule name="NPMDICMPV6TimeExceeded" protocol="icmpv6:3,any" dir=in action 
```

### <a name="create-service-endpoint-monitor-tests"></a>Создание тестов мониторинга конечной точки службы 

Начало создания тестов для отслеживания сетевых подключений к конечным точкам службы 

1. Щелкните вкладку **Монитор конечной точки службы**.
2. Нажмите кнопку **Добавить тест** и введите имя теста и описание. 
3. Выберите тип теста.<br>Выберите **Веб-тест**, если отслеживается подключение к службе, которая отвечает на запросы HTTP(S), например outlook.office365.com, bing.com.<br>Выберите **Network test** (Тестирование сети), если отслеживается подключение к службе, которая отвечает на запрос TCP, но не отвечает на запросы HTTP(S), например SQL Server, FTP-сервер, SSH-порт и т. д. 
4. Если не нужно выполнять измерения производительности сети (задержка сети, потеря пакетов, обнаружение топологии), снимите флажок для текстового поля. Мы рекомендуем оставить этот флажок установленным, чтобы получить максимальные преимущества от возможности. 
5. Введите целевой URL-адрес, полное доменное имя или IP-адрес, сетевое подключение к которому необходимо отслеживать.  
6. Введите номер порта целевой службы. 
7. Укажите частоту выполнения тестов. 
8. Выберите узлы, из которых требуется отслеживать сетевые подключения к службе. 

    >[!NOTE]
    > Для узлов под управлением сервера Windows эта возможность подразумевает выполнение измерений производительности сети с помощью запросов по протоколу TCP. Для узлов под управлением клиента Windows эта возможность подразумевает выполнение измерений производительности сети с помощью запросов по протоколу ICMP. Если узлы находятся под управлением клиента Windows, в некоторых случаях целевое приложение блокирует входящий запрос по протоколу ICMP, из-за чего решение не может выполнить измерения производительности сети. Поэтому в таких случаях рекомендуется использовать узлы под управлением сервера Windows. 

9. Если не нужно создавать события работоспособности для выбранных элементов, снимите флажок **Включить мониторинг работоспособности в целевых объектах, на которые распространяется этот тест**. 
10. Выберите условия мониторинга. Вы можете задать настраиваемые пороговые значения для создания событий работоспособности. Каждый раз, когда значение условия превышает выбранное пороговое значение для выбранной пары сетей или подсетей, создается событие работоспособности. 
11. Чтобы сохранить конфигурацию, нажмите кнопку **Сохранить**. 

 ![Настройка мониторинга конечной точки службы](media/log-analytics-network-performance-monitor/service-endpoint-configuration.png)



## <a name="walkthrough"></a>Пошаговое руководство 

Перейдите в представление панели мониторинга "Монитор производительности сети" и просмотрите страницу **Монитор конечной точки службы**, чтобы получить сводку о работоспособности разных тестов, которые вы создали.  

![Страница "Монитор конечной точки службы"](media/log-analytics-network-performance-monitor/service-endpoint-blade.png)

На странице **Тесты** щелкните плитку для дополнительной детализации и просмотра сведений о тестах. В таблице LHS можно просмотреть сведения о состоянии работоспособности на определенный момент времени и значения времени отклика службы, задержки сети и потери пакетов для всех тестов. Чтобы просмотреть моментальный снимок о состоянии сети на другой момент времени в прошлом, выберите элемент управления "Network State Recorder" (Запись состояния сети). Щелкните тест в таблице, которую необходимо изучить. В области RHS на диаграммах можно просмотреть исторические тенденции изменения значений потери, задержки и времени отклика. Щелкните ссылку "Подробности теста", чтобы просмотреть сведения о производительности на каждом узле. 

![Тесты мониторинга конечной точки службы](media/log-analytics-network-performance-monitor/service-endpoint-tests.png)

В представлении **Тестирование узлов** можно отслеживать сетевые подключения из каждого узла. Щелкните узел со сниженной производительностью.  Это узел, на котором приложение работает слишком медленно. 

Определите причину ухудшения производительности приложения (из-за сети или из-за некоторых проблем в конечной точке поставщика приложения), наблюдая за корреляцией между временем отклика приложения и задержкой сети. 

**Проблема в приложении.** Если происходит резкое увеличение времени отклика, но задержка сети остается постоянной, то можно предположить, что сеть работает нормально и проблема возникла в конечной точке приложения.  

![Проблема приложения, обнаруженная монитором конечной точки службы](media/log-analytics-network-performance-monitor/service-endpoint-application-issue.png)

**Неполадки в сети.** Если резкое увеличение времени отклика сопровождается соответствующим увеличением задержки сети, то можно предположить, что увеличение времени отклика происходит из-за увеличения задержки сети.  

![Неполадки сети, обнаруженные монитором конечной точки службы](media/log-analytics-network-performance-monitor/service-endpoint-network-issue.png)

Если проблема кроется в сети, щелкните ссылку на представление **Топология**, чтобы определить нежелательный прыжок на карте топологии. Например, на рисунке ниже показано, что общая задержка между узлом и конечной точкой приложения составляет 105 мс, а снижение до 96 мс произошло из-за прыжка, помеченного красным цветом. После определения нежелательного прыжка можно предпринять корректирующее действие.  

![Тесты мониторинга конечной точки службы](media/log-analytics-network-performance-monitor/service-endpoint-topology.png)

## <a name="diagnostics"></a>Диагностика 

Если вы заметили неисправность, сделайте следующее.

Если для времени отклика службы, потери пакетов в сети и задержки отображается значение "Недоступно", это может быть вызвано одной или несколькими из следующих причин:
- Приложение не работает.
- Узел, используемый для проверки сетевого подключения к службе, не работает.
- Неверный целевой объект, введенный в конфигурации теста.
- На узле нет сетевых подключений.

Если для времени отклика службы отображается допустимое значение, а для потери пакетов в сети и задержки отображается значение "Недоступно", это может быть вызвано одной или несколькими из следующих причин:
- Если узел, используемый для проверки сетевых подключений к службе, является клиентским компьютером Windows, целевая служба блокирует запросы ICMP или сетевой брандмауэр блокирует запросы ICMP, исходящие из узла.
- Флажок **Проведите измерения сети** снят в конфигурации теста. 

Если для времени отклика службы указано значение "Недоступно", а для потери пакетов в сети и задержки указаны допустимые значения, можно предположить, что целевая служба не является веб-приложением. Измените конфигурацию теста и выберите для типа теста значение Network test (Тестирование сети) вместо "Веб-тест". 

Если приложение работает медленно, необходимо определить причину ухудшения производительности приложения (сеть или проблема в конечной точке поставщика приложения).


## <a name="next-steps"></a>Дополнительная информация
* [Выполните поиск по журналам](log-analytics-log-searches.md), чтобы просмотреть подробные записи данных о производительности сети.
