---
title: Управление затратами на данные в Azure Log Analytics | Документация Майкрософт
description: Узнайте, как изменить ценовой план, а также управлять объемом данных и политикой хранения для рабочей области Log Analytics в Azure.
services: log-analytics
documentationcenter: log-analytics
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 08/27/2018
ms.author: magoedte
ms.component: na
ms.openlocfilehash: 179d5c71a309fd79c23519544d1da6bcc07cda0c
ms.sourcegitcommit: 161d268ae63c7ace3082fc4fad732af61c55c949
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2018
ms.locfileid: "43045006"
---
# <a name="manage-cost-by-controlling-data-volume-and-retention-in-log-analytics"></a>Управление затратами на хранение путем регулирования объема и срока хранения данных в Log Analytics

> [!NOTE]
> В этой статье описывается, как контролировать затраты в Log Analytics путем установки срока хранения данных.  Дополнительные сведения приведены в статьях ниже.
> - В статье [Анализ использования данных в службе Log Analytics](log-analytics-manage-cost-storage.md) описано, как анализировать и оповещать об использовании данных.
> - В статье [Мониторинг использования и ожидаемых затрат](../monitoring-and-diagnostics/monitoring-usage-and-estimated-costs.md) описано, как можно просмотреть сведения об использовании и оценить затраты по нескольким функциям мониторинга Azure для разных моделей ценообразования. Там также описано, как можно изменить модель ценообразования.

Служба Log Analytics предназначена для масштабирования и поддержки сбора, индексирования и хранения больших объемов данных в день из любого источника в вашей организации или в развертывании в Azure.  Хотя это может быть определяющим фактором для вашей организации, в конечном счете основной является экономическая эффективность. Поэтому важно понять, что стоимость рабочей области Log Analytics зависит не только от объема собранных данных, но также от выбранного плана и от того, как долго будут храниться данные из ваших подключенных источников.  

В этой статье мы рассмотрим, как можно в упреждающем режиме отслеживать увеличение объема хранимых данных и определять ограничения для контроля этих связанных затрат. 

Стоимость данных может быть значительной в зависимости от следующих факторов: 

- количество систем, компонентов инфраструктуры, облачных ресурсов, т. д., из которых собираются данные; 
- тип данных, создаваемых в источнике, таких как очереди сообщений, журналы, события, связанные с безопасностью данные или метрики производительности; 
- объем данных, создаваемых этими источниками и попадающих в рабочую область; 
- период хранения данных в рабочей области;  
- количество включенных решений по управлению и источников данных, а также частота сбора данных. 

> [!NOTE]
> Обратитесь к документации по каждому решению. В ней должна быть приведена оценка объема данных, которые оно собирает.   

Клиенты, которые подписали Соглашение Enterprise до 1 июля 2018 года или которые уже создали в подписке рабочую область Log Analytics, по-прежнему имеют доступ к плану *Бесплатный*. Если подписка не связана с имеющимся Соглашением Enterprise, при создании рабочей области в новой подписке после 2 апреля 2018 года уровень *Бесплатный* недоступен.  Если вы используете уровень *Бесплатный*, данные хранятся в течение 7 дней.  Для уровня *Автономный* или *Платный* доступны собранные данные за последние 31 день. При использовании уровня *Бесплатный* у вас будет ежедневное ограничение в 500 МБ. Если вы обнаружите, что постоянно превышаете допустимые объемы, то сможете изменить рабочую область и выбрать платный план, чтобы собирать данные свыше этого ограничения. 

> [!NOTE]
> Если выбрать более длительный срок хранения для платного уровня, это приведет к увеличению затрат. Вы можете изменить тип плана в любое время. Дополнительные сведения о ценах см. в разделе [Цены на Log Analytics](https://azure.microsoft.com/pricing/details/log-analytics/). 

Существует два способа ограничить объем данных и контролировать затраты: ежедневное ограничение и период хранения данных.  

## <a name="review-estimated-cost"></a>Проверка расчетной стоимости
В Log Analytics легко разобраться с расчетной стоимостью на основе последних шаблонов использования.  Для этого сделайте следующее.  

1. Войдите на [портал Azure](http://portal.azure.com). 
2. На портале Azure щелкните **Все службы**. В списке ресурсов введите **Log Analytics**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Выберите **Log Analytics**.<br><br> ![портала Azure](media/log-analytics-quick-collect-azurevm/azure-portal-01.png)<br><br>  
3. В области подписки Log Analytics выберите рабочую область и на панели слева щелкните **Usage and estimated costs** (Использование и ожидаемые затраты).<br><br> ![Страница "Usage and estimated costs" (Использование и ожидаемые затраты)](media/log-analytics-manage-cost-storage/usage-estimated-cost-dashboard-01.png)<br>

Здесь можно просмотреть сведения об объеме данных на месяц. Сюда входят все данные, полученные и сохраненные в рабочей области Log Analytics.  Щелкните **Сведения об использовании** в верхней части страницы, чтобы просмотреть панель управления со сведениями о тенденциях объема данных по источникам, компьютерам и предложениям. Чтобы просмотреть и установить ежедневное ограничение или изменить срок хранения, щелкните **Управление объемом данных**.
 
Оплата за использование Log Analytics добавляется в счет Azure. Дополнительную информацию о счете за подписку на Azure можно просмотреть в разделе выставления счетов портала Azure или на [Портале управления счетами и подписками Azure](https://account.windowsazure.com/Subscriptions).  

## <a name="daily-cap"></a>Ежедневное ограничение
При создании рабочей области Log Analytics с портала Azure и выборе плана *Бесплатный* ограничение установлено на уровне 500 МБ в день. Для других планов ценообразования нет никаких ограничений. Вы можете настроить ежедневное ограничение и ограничить ежедневный прием данных для своей рабочей области, но будьте осторожны, так как ваша цель не должна превышать дневной лимит.  В противном случае в этот момент вы потеряете данные за оставшуюся часть дня, что может повлиять на доступность в рабочей области служб и решений Azure, функциональные возможности которых зависят от актуальных данных.  В результате вы не сможете наблюдать за условиями работоспособности ресурсов, поддерживающих ИТ-службы, и получать соответствующие уведомления.  Ежедневное ограничение выступает в качестве способа управления неожиданным увеличением объема данных, собираемых из управляемых ресурсов. Оно помогает не превышать предел сбора данных. Кроме того, его можно использовать для ограничения незапланированных платежей за рабочую область.  

По достижении ежедневного ограничения сбор платных типов данных прекращается до конца дня. В верхней части страницы для выбранной рабочей области Log Analytics появится предупреждающий баннер и событие операции будет отправлено в таблицу *Операция* в категории **LogManagement**. Сбор данных возобновится по наступлении времени сброса, определенного в разделе *Daily limit will be set at* (Ежедневное ограничение будет установлено в). Рекомендуем определить правило генерации оповещений на основе этого события операции, настроенного для уведомления о достижении ежедневного ограничения по сбору данных. 

### <a name="identify-what-daily-data-limit-to-define"></a>Определение ежедневного ограничения по сбору данных 
Сведения о тенденциях приема данных и определении ежедневного ограничения для объема см. в статье [Анализ использования данных в службе Log Analytics](log-analytics-usage.md). Их необходимо тщательно рассмотреть, так как вы не сможете контролировать свои ресурсы после достижения предела. 

### <a name="manage-the-maximum-daily-data-volume"></a>Управление максимальным ежедневным объемом данных 
В следующих шагах показано, как настроить ограничения для управления объемом данных, которые Log Analytics будет принимать в день.  

1. В рабочей области на панели слева выберите пункт **Usage and estimated costs** (Использование и ожидаемые затраты).
2. В верхней части страницы **Usage and estimated costs** (Использование и ожидаемые затраты) для выбранной рабочей области щелкните **Управление объемом данных**. 
5. По умолчанию для ежедневного ограничения установлено значение **Выкл**. Щелкните **Вкл.**, чтобы включить его, а затем настройте лимит для объема данных (ГБ/день).<br><br> ![Настройка ограничения сбора данных в Log Analytics](media/log-analytics-manage-cost-storage/set-daily-volume-cap-01.png)

### <a name="alert-when-limit-reached"></a>Оповещение о достижении лимита
Когда достигнуто ограничение сбора данных, на портале Azure отображается соответствующее сообщение. Однако, возможно, вы управляете операционными проблемами, требующими немедленного внимания, иным образом.  Чтобы получать оповещение, вы можете создать новое правило генерации оповещений в Azure Monitor.  Дополнительные сведения см. в статье [Создание и просмотр оповещений, а также управление ими с помощью Azure Monitor — интерфейс оповещений (предварительная версия)](../monitoring-and-diagnostics/monitor-alerts-unified-usage.md).      

Перед началом работы просмотрите рекомендуемые настройки для оповещения:

* Цель: выберите рабочую область Log Analytics.
* Критерии: 
   * Название сигнала: "Пользовательский поиск по журналам".
   * Поисковый запрос: Operation | где в Detail указано OverQuota.
   * Основа: число результатов.
   * Условие: "больше чем".
   * Пороговое значение: 0.
   * Период: 5 (в минутах).
   * Периодичность: 5 (в минутах).
* Название правила генерации оповещений: "Достигнуто ежедневное ограничение сбора данных".
* Серьезность: предупреждение (серьезность 1).

Как только будет определено оповещение и достигнут предел, активируется предупреждение и будет выполнен ответ, определенный в группе действий. Ваша команда может получать сообщение по электронной почте и текстовое сообщение, могут быть автоматизированы действия с помощью веб-перехватчиков, модулей Runbook службы автоматизации или же выполнена [интеграция с внешним решением ITSM](log-analytics-itsmc-overview.md#create-itsm-work-items-from-azure-alerts). 

## <a name="change-the-data-retention-period"></a>Изменение срока хранения данных 
В следующих шагах описана настройка периода хранения данных журнала в рабочей области.
 
1. В рабочей области на панели слева выберите пункт **Usage and estimated costs** (Использование и ожидаемые затраты).
2. В верхней части страницы **Usage and estimated costs** (Использование и ожидаемые затраты) щелкните **Управление объемом данных**.
5. В области воспользуйтесь ползунком, чтобы увеличить или уменьшить количество дней, а затем нажмите кнопку **ОК**.  Если вы используете уровень *Бесплатный*, то вы не сможете изменить срок хранения данных. Необходимо перейти на платный уровень, чтобы управлять этим параметром.<br><br> ![Изменение параметра хранения данных рабочей области](media/log-analytics-manage-cost-storage/manage-cost-change-retention-01.png)

## <a name="troubleshooting"></a>Устранение неполадок
**Вопрос.** Как можно понять, что Log Analytics больше не собирает данные? 
**Ответ.** Если вы используете бесплатную ценовую категорию и отправили более 500 МБ данных в день, сбор данных останавливается до конца дня. Достижение ежедневного ограничения является распространенной причиной, по которой Log Analytics прекращает сбор данных или по которой данные отсутствуют.  
Log Analytics создает событие типа "Операция", когда сбор данных начинается и останавливается.  
Выполните следующий запрос в поле поиска, чтобы проверить, был ли достигнут лимит и отсутствуют ли данные: Operation | где OperationCategory == состояние сбора данных.   
При остановке сбора данных параметр OperationStatus принимает значение Warning. При начале сбора данных параметр OperationStatus принимает значение Succeeded.  
В следующей таблице описаны причины, по которым сбор данных останавливается, и приведены рекомендуемые действия, чтобы его возобновить:  

|Причина прекращения сбора| Решение| 
|-----------------------|---------|
|Достигнут предел ежедневного сбора данных, предоставляемый бесплатно<sup>1</sup>|Дождитесь следующего дня для автоматического перезапуска сбора или перейдите на платную ценовую категорию.|
|Достигнут предел ежедневного сбора данных, определенный в управлении объемом данными|Дождитесь следующего дня для автоматического перезапуска сбора или увеличьте предел ежедневного сбора объема данных, как описано в разделе [Управление максимальным ежедневным объемом данных](#manage-the-maximum-daily-volume).|
|Подписка Azure находится в состоянии "Приостановлено" по причине:<br> Период бесплатной пробной версии завершен<br> Истек срок действия Azure Pass<br> Достигнут лимит ежемесячной суммы расходов (например, на подписку MSDN или Visual Studio)|Измените подписку на платную<br> Удалите ограничение или подождите, пока оно сбросится|

<sup>1</sup> Если ваша рабочая область находится в бесплатной ценовой категории, вы можете отправлять в службу не более 500 МБ данных в день. По достижении ежедневного лимита сбор данных останавливается до следующего дня. Данные, передаваемые во время остановки сбора данных, не индексируется и не доступны для поиска. Когда сбор данных возобновляется, обработка выполняется только для новых передаваемых данных. 

В службе Log Analytics используется время в формате UTC. Время сброса варьируется между рабочими областями, чтобы предотвратить одновременный прием данных рабочими областями с ограничениями. Если рабочая область достигает предела ежедневного сбора, процесс возобновится по наступлении времени сброса, определенного в разделе **Daily limit will be set at** (Ежедневное ограничение будет установлено в).<br><br> ![Часовой пояс в формате UTC для ограничения в Log Analytics](media/log-analytics-manage-cost-storage/data-volume-mgmt-limit-utc.png)

**Вопрос.** Как получить уведомление о прекращении сбора данных? 
**Ответ.** Выполните шаги, описанные в разделе *Создание ограничения ежедневного сбора данных*, чтобы получать оповещение об остановке сбора данных. Выполните шаги, описанные в действиях добавления, чтобы настроить сообщения электронной почты, веб-перехватчик или действие Runbook для правила генерации оповещений. 

## <a name="next-steps"></a>Дополнительная информация  

Чтобы определить, сколько данных собирается, какие источники их отправляют, а также определить различные типы передаваемых данных, чтобы упростить управление затратами и потреблением ресурсов, ознакомьтесь с разделом [Анализ использования данных в службе Log Analytics](log-analytics-usage.md).