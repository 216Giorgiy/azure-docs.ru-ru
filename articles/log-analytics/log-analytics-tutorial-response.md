---
title: Реагирование на события с помощью оповещений Azure Log Analytics | Документы Майкрософт
description: В этом руководстве вы ознакомитесь с основными принципами оповещений в Log Analytics, которые позволяют обнаружить важную информацию в рабочей области и уведомлять о возникших проблемах или вызывать автоматические действия для их устранения.
services: log-analytics
documentationcenter: log-analytics
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: abb07f6c-b356-4f15-85f5-60e4415d0ba2
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: tutorial
ms.date: 07/30/2018
ms.author: magoedte
ms.custom: mvc
ms.component: na
ms.openlocfilehash: c6c7b3f897e38fbd67098c9f881380bc073f13da
ms.sourcegitcommit: 1d850f6cae47261eacdb7604a9f17edc6626ae4b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/02/2018
ms.locfileid: "39432656"
---
# <a name="respond-to-events-with-azure-monitor-alerts"></a>Реагирование на события с помощью оповещений Azure Monitor
Правила поиска по журналам создаются в интерфейсе оповещений Azure, чтобы указанные запросы к журналу автоматически выполнялись с регулярными интервалами.  Если результаты запроса к журналу отвечают определенным условиям, создается запись оповещения. Затем правило может автоматически выполнять одно или несколько действий с помощью [групп действий](../monitoring-and-diagnostics/monitoring-action-groups.md).  Эта статья является продолжением руководства по [созданию и совместному использованию панелей мониторинга данных Log Analytics](log-analytics-tutorial-dashboards.md).   

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание правила оповещения
> * Настройка группы действий для отправки уведомлений по электронной почте

Для выполнения примера в этом руководстве требуется виртуальная машина [, подключенная к рабочей области Log Analytics](log-analytics-quick-collect-azurevm.md).

## <a name="sign-in-to-azure-portal"></a>Вход на портал Azure
Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).

## <a name="create-alerts"></a>Создание оповещений
Оповещения создаются в Azure Monitor с помощью правил генерации оповещений и позволяют автоматически через регулярные интервалы выполнять сохраненные запросы или настраиваемые поиски по журналам.  Можно создать оповещения, основанные на конкретных метках производительности, создании конкретных событий, отсутствии события или создании ряда событий за определенный период.  Например, оповещения могут содержать информацию о том, что средняя загрузка ЦП превышает определенный порог, существует неустановленное обновление или создано событие, свидетельствующее об отсутствии запущенной службы Windows или управляющей программы Linux.  Если результаты поиска по журналам соответствуют определенным условиям, создается оповещение. После этого правило может автоматически запустить одно или несколько действий, например уведомить вас об оповещении либо вызвать другой процесс.

В следующем примере создается правило генерации оповещений по измерению метрик, основанное на запросе *Виртуальные машины Azure — загрузка процессора*, который вы сохранили при работе с [руководством по визуализации данных](log-analytics-tutorial-dashboards.md). Оповещение создается для каждой виртуальной машины, на которой превышено пороговое значение 90 %.

1. На портале Azure щелкните **Все службы**. В списке ресурсов введите **Монитор**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Щелкните **Монитор**.
1. На панели слева выберите **Оповещения** и щелкните **Новое правило генерации оповещений** в верхней части страницы, чтобы создать оповещение.

    ![Создание правила генерации оповещений](./media/log-analytics-tutorial-response/alert-rule-02.png)

1. Сначала выберите в разделе **Создать оповещение** рабочую область Log Analytics в качестве ресурса, так как мы создаем сигнал оповещения на основе журналов.  Если у вас несколько подписок, отфильтруйте результаты, выбрав из раскрывающегося списка конкретную **подписку**, содержащую виртуальную машину и рабочую область Log Analytics, которые вы создали ранее.  Отфильтруйте по **типу ресурса**, выбрав **Log Analytics** из раскрывающегося списка.  Наконец, выберите **Ресурс** **DefaultLAWorkspace** и щелкните **Готово**.

    ![Создание оповещения, шаг 1](./media/log-analytics-tutorial-response/alert-rule-03.png)

1. В разделе **Критерии оповещения** щелкните **Добавить критерии**, чтобы определить запрос, а затем настройте логику для этого правила генерации оповещений. На панели **Настройка логики сигнала** выберите **Пользовательский поиск по журналам** как имя сигнала и введите запрос в поле **Поисковый запрос**.

    Например: 
    ```
    Perf
    | where CounterName == "% Processor Time" and ObjectName == "Processor" and InstanceName == "_Total"
    | summarize AggregatedValue=avg(CounterValue) by bin(TimeGenerated, 1m)
    ```

    Панель обновится и на ней появятся параметры конфигурации для оповещения.  В верхней части отображаются результаты за последние 30 минут для выбранного сигнала.

1. Настройте оповещение, указав следующие сведения:  
   a. Из раскрывающегося списка **На основе* выберите **Измерение метрик**.  Измерение метрик позволяет создать оповещение для каждого объекта в запросе, для которого значение превышает указанное пороговое значение.  
   b. В поле **Условие** выберите **Больше чем** и введите **90** в поле **Пороговое значение**.  
   c. В поле "Условие срабатывания предупреждения" выберите **Последовательные бреши**, в раскрывающемся списке выберите **Больше чем** и введите значение 3.  
   d. В разделе Evaluation based on (Оценка на основе) оставьте значения по умолчанию для параметров. Это правило будет запускаться каждые пять минут и возвращать все записи, созданные в течение этого периода.  
1. Щелкните **Готово**, чтобы завершить создание правила генерации оповещений.

    ![Настройка сигнала оповещения](./media/log-analytics-tutorial-response/alert-signal-logic-02.png)

1. Теперь переходите ко второму шагу, на котором следует предоставить имя для оповещения в поле **Имя правила генерации оповещений**, например **Загрузка ЦП выше 90 процентов**.  Укажите подробное **описание** для оповещения и выберите уровень **Критический (уровень серьезности 0)** из представленных в поле **Серьезность** вариантов.

    ![Указание подробных сведений об оповещении](./media/log-analytics-tutorial-response/alert-signal-logic-04.png)

1. Чтобы правило генерации оповещений начало работать сразу после создания, сохраните установленный по умолчанию флажок **Включить правило при создании**.  
1. На последнем, третьем, шаге укажите **группу действий**, которая позволит гарантировать выполнение одинаковых действий всякий раз, когда активируется это оповещение. Эту функцию можно использовать для каждого созданного правила.  Настройте новую группу действий со следующими параметрами:  
   a. Выберите **Новая группа действий**, чтобы открыть панель **Добавить группу действий**.  
   b. В поле **Имя группы действий** укажите имя, например **Уведомление ИТ-отдела**, и **короткое имя**, например **itops-n**.  
   c. Убедитесь, что в полях **Подписка** и **Группа ресурсов** заданы правильные значения по умолчанию. Если нет, выберите правильные варианты из раскрывающегося списка.  
   d. В разделе "Действия" укажите имя для этого действия, например **Отправить электронное письмо**, а в поле **Тип действия** выберите **Email/SMS/Push/Voice** (Электронная почта, SMS, push-уведомление, голосовой вызов) из раскрывающегося списка. Справа откроется панель свойств **Email/SMS/Push/Voice** (Электронная почта, SMS, push-уведомление, голосовой вызов) для дополнительных сведений.  
   д. На панели **Email/SMS/Push/Voice** (Электронная почта, SMS, push-уведомление, голосовой вызов) включите **Электронная почта** и укажите допустимый адрес электронной почты для доставки сообщения.  
   Е. Нажмите кнопку **ОК** , чтобы сохранить изменения.  
       ![Создание группы действий](./media/log-analytics-tutorial-response/action-group-properties-01.png)

1. Нажмите кнопку **ОК**, чтобы завершить создание группы действий.
1. Щелкните **Создать правило генерации оповещений**, чтобы завершить создание этого правила. Оно начнет выполняться немедленно.

    ![Завершение создания правила генерации оповещений](./media/log-analytics-tutorial-response/alert-rule-01.png)

## <a name="view-your-alerts-in-azure-portal"></a>Просмотр оповещений на портале Azure
Теперь, когда оповещение создано, вы можете просматривать все оповещения Azure в единой области и управлять правилами генерации оповещений для всех подписок Azure. На этой странице перечислены все правила генерации оповещений (включенные или отключенные), и на ней доступна фильтрация по целевым ресурсам, группам ресурсов, имени правила или состоянию. Здесь содержатся статистические сводки обо всех сработавших оповещениях, а также общее количество настроенных и включенных правил генерации оповещений.

![Страница состояния оповещений Azure](./media/log-analytics-tutorial-response/azure-alerts-02.png)

Когда активируется оповещение, в эту таблицу заносятся сведения об условии и количестве зарегистрированных срабатываний в течение определенного диапазона времени (по умолчанию — за последние шесть часов).  В вашу папку входящих писем должно поступить сообщение, как в примере ниже, в котором указана проблемная виртуальная машина и результаты, которые были обнаружены по поисковому запросу в конкретном случае.

![Пример действия. Оповещение по электронной почте](./media/log-analytics-tutorial-response/azure-alert-email-notification-01.png)

## <a name="next-steps"></a>Дополнительная информация
В этом руководстве вы узнали, как правила генерации оповещений позволяют своевременно выявлять проблемы и реагировать на них путем выполнения поиска по журналам через запланированные интервалы и обнаружения соответствия определенным условиям.

Чтобы увидеть готовые примеры сценариев Log Analytics, перейдите по ссылке ниже.

> [!div class="nextstepaction"]
> [Примеры сценариев Log Analytics](powershell-samples.md)
