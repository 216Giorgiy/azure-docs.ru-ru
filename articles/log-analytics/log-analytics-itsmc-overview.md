---
title: "Соединитель управления ИТ-службами в Azure Log Analytics | Документация Майкрософт"
description: "В этой статье представлен обзор соединителя управления ИТ-услугами (ITSMC) и сведения о том, как использовать это решение для централизованного мониторинга рабочих элементов ITSM и управления ими в OMS Log Analytics, а также для быстрого устранения каких-либо проблем."
services: log-analytics
documentationcenter: 
author: JYOTHIRMAISURI
manager: riyazp
editor: 
ms.assetid: 0b1414d9-b0a7-4e4e-a652-d3a6ff1118c4
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/19/2017
ms.author: v-jysur
ms.openlocfilehash: bd384255b3c46b3ae88b1269ab26e0ddaa6f6e77
ms.sourcegitcommit: 7d107bb9768b7f32ec5d93ae6ede40899cbaa894
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/16/2017
---
# <a name="centrally-manage-itsm-work-items-using-it-service-management-connector-preview"></a>Централизованное управление рабочими элементами ITSM с помощью соединителя управления ИТ-службами (предварительная версия)

![Символ соединителя управления ИТ-службами](./media/log-analytics-itsmc/itsmc-symbol.png)

Соединитель управления ИТ-службами (ITSMC) обеспечивает двунаправленную интеграцию между поддерживающими соединитель управления ИТ-службами (ITSM) продуктами или службами и Log Analytics.  Через это подключение можно создавать инциденты, оповещения или события в продукте ITSM на основе оповещений Log Analytics, записей в журнале или оповещений Azure. Соединитель также импортирует данные (например, инциденты и запросы на изменения) из продуктов ITSM в OMS Log Analytics.

С помощью ITSMC можно:

  - Интегрировать оперативные оповещения с помощью методик управления инцидентами в выбранном инструменте ITSM.
    - Создавать рабочие элементы (например, оповещения, события и инциденты) в ITSM из оповещений OMS или с помощью поиска по журналам.
    - Создавать рабочие элементы на основе оповещений журнала действий Azure через действия ITSM в группах действий.

  - Объединять мониторинг, журналы и службу управления данными, используемые по всей организации.
    - Сопоставлять данные инцидентов и запросов на изменение из инструментария ITSM с соответствующими данными журнала в рабочей области Log Analytics.   
    - Просматривать панели мониторинга верхнего уровня для обзора инцидентов, запросов на изменение и затронутых систем.
    - Записывать запросы Log Analytics для анализа данных управления служб.

## <a name="adding-the-it-service-management-connector-solution"></a>Добавление решения "Соединитель управления ИТ-службами"

Решение "Соединитель управления ИТ-службами" необходимо добавить в рабочую область Log Analytics, как описано в статье [Добавление решений для управления Azure Log Analytics в рабочую область](log-analytics-add-solutions.md).

Вот плитка ITSMC из коллекции решений:

![Плитка соединителя](./media/log-analytics-itsmc/itsmc-solutions-tile.png)

После успешного добавления в разделе **OMS** > **Параметры** > **Подключенные источники** отобразится соединитель управления ИТ-службами.

![ITSMC подключен](./media/log-analytics-itsmc/itsmc-overview-solution-in-connected-sources.png)

> [!NOTE]

> По умолчанию ITSMC обновляет данные подключения каждые 24 часа. Чтобы обновить данные подключения после любого изменения или обновления шаблона, нажмите кнопку "Обновить" рядом с подключением.

 ![Обновление ITSMC](./media/log-analytics-itsmc/itsmc-connection-refresh.png)


## <a name="configuring-the-itsmc-connection-with-your-itsm-productsservices"></a>Настройка подключения ITSMC с использованием продуктов и служб ITSM

ITSMC поддерживает подключения к **System Center Service Manager**, **ServiceNow**, **Provance** и **Cherwell**.

В зависимости от используемого решения используйте следующие процедуры:

- [System Center Service Manager](log-analytics-itsmc-connections.md#connect-system-center-service-manager-to-it-service-management-connector-in-oms);

- [ServiceNow](log-analytics-itsmc-connections.md#connect-servicenow-to-it-service-management-connector-in-oms)

- [Provance](log-analytics-itsmc-connections.md#connect-provance-to-it-service-management-connector-in-oms);  

- [Cherwell](log-analytics-itsmc-connections.md#connect-cherwell-to-it-service-management-connector-in-oms)

## <a name="using-the-solution"></a>Использование решения

После настройки соединитель начинает собирать данные от подключенных продуктов и служб ITSM. В зависимости от числа инцидентов и запросов на изменение в продуктах или службах ITSM первоначальная синхронизация должна завершиться за несколько минут.

> [!NOTE]
> - Данные, импортированные решением ITSMC из продукта ITSM, отображаются в Log Analytics в записях журнала типа **ServiceDesk_CL**.
> - Запись журнала содержит поле **ServiceDeskWorkItemType_s**, которое содержит данные инцидента или запроса на изменение. Из продукта ITSM импортируется два вида данных.

## <a name="data-synced-from-itsm-product"></a>Данные, синхронизированные из продукта ITSM
Инциденты и запросы на изменение синхронизируются из продукта ITSM с рабочей областью Log Analytics.
Ниже приведены примеры данных, собранных соединителем ITSMC.

> [!NOTE]

> В зависимости от типа рабочего элемента, импортированного в Log Analytics, **ServiceDesk_CL** содержит указанные ниже поля.

**Рабочий элемент:** **инциденты**  
ServiceDeskWorkItemType_s="Incident"

**Поля**

- ServiceDeskConnectionName;
- "Идентификатор службы поддержки";
- Состояние
- "Срочность";
- Влияние
- Приоритет
- Escalation (Эскалация);
- "Кем создано";
- "Кем разрешено";
- Closed By (Кем закрыто);
- Источник
- Кому назначено
- Категория
- Название
- Описание
- "Дата создания";
- Closed Date (Дата закрытия);
- Resolved Date (Дата разрешения);
- "Дата последнего изменения";
- Компьютер


**Рабочий элемент:** **запросы на изменение**

ServiceDeskWorkItemType_s="ChangeRequest"

**Поля**
- ServiceDeskConnectionName;
- "Идентификатор службы поддержки";
- "Кем создано";
- Closed By (Кем закрыто);
- Источник
- Кому назначено
- Название
- Тип
- Категория
- Состояние
- Escalation (Эскалация);
- Conflict Status (Состояние конфликта);
- "Срочность";
- Приоритет
- "Риск";
- Влияние
- Кому назначено
- "Дата создания";
- Closed Date (Дата закрытия);
- "Дата последнего изменения";
- Requested Date (Запрошенная дата);
- Planned Start Date (Планируемая дата начала);
- Planned End Date (Планируемая дата окончания);
- Work Start Date (Дата начала работы);
- Work End Date (Дата окончания работы);
- Описание
- Компьютер

## <a name="output-data-for-a-servicenow-incident"></a>Выходные данные инцидента ServiceNow

| Поле OMS | Поле ITSM |
|:--- |:--- |
| ServiceDeskId_s| Number |
| IncidentState_s | Состояние |
| Urgency_s |"Срочность"; |
| Impact_s |Влияние|
| Priority_s | Приоритет |
| CreatedBy_s | Opened by (Кем открыто) |
| ResolvedBy_s | "Кем разрешено"|
| ClosedBy_s  | Closed By (Кем закрыто) |
| Source_s| Contact type (Тип контакта) |
| AssignedTo_s | Кому назначено  |
| Category_s | Категория |
| Title_s|  Краткое описание |
| Description_s|  Примечания |
| CreatedDate_t|  Opened (Открыто) |
| ClosedDate_t| closed|
| ResolvedDate_t|"Разрешено"|
| Компьютер  | Элемент конфигурации |

## <a name="output-data-for-a-servicenow-change-request"></a>Выходные данные запроса на изменение ServiceNow

| Поле OMS | Поле ITSM |
|:--- |:--- |
| ServiceDeskId_s| Number |
| CreatedBy_s | "Кем запрошено" |
| ClosedBy_s | Closed By (Кем закрыто) |
| AssignedTo_s | Кому назначено  |
| Title_s|  Краткое описание |
| Type_s|  Тип |
| Category_s|  Категория |
| CRState_s|  Состояние|
| Urgency_s|  "Срочность"; |
| Priority_s| Приоритет|
| Risk_s| "Риск";|
| Impact_s| Влияние|
| RequestedDate_t  | Requested by date |
| ClosedDate_t | Closed Date (Дата закрытия) |
| PlannedStartDate_t  |     Planned Start Date (Планируемая дата начала) |
| PlannedEndDate_t  |   Planned End Date (Планируемая дата окончания) |
| WorkStartDate_t  | Actual start date (Фактическая дата начала) |
| WorkEndDate_t | Actual end date (Фактическая дата окончания)|
| Description_s | Описание |
| Компьютер  | Элемент конфигурации |

**Снимок экрана с примером Log Analytics для данных ITSM:**

![Снимок экрана с Log Analytics](./media/log-analytics-itsmc/itsmc-overview-sample-log-analytics.png)

## <a name="itsmc-integration-with-other-oms-solutions"></a>Интеграция ITSMC с другими решениями OMS

Сейчас соединитель ITSM поддерживает интеграцию с решением "Сопоставление служб".

Служба схемы услуги автоматически обнаруживает компоненты приложений в системах Windows и Linux и сопоставляет взаимодействие между службами. Это решение позволяет рассматривать серверы как взаимосвязанные системы, предоставляющие важные службы. Схема услуги отображает сведения о подключениях между серверами, процессами и портами в любой подключенной по протоколу TCP архитектуре без дополнительной настройки. Пользователям требуется только установить агент.

Дополнительные сведения см. в статье [Использование решения схемы услуги в Operations Management Suite (OMS)](../operations-management-suite/operations-management-suite-service-map.md).

При использовании решения сопоставления служб вы можете просматривать элементы службы поддержки, созданные в решениях ITSM, как показано ниже:

![Интеграция решения "Сопоставление служб"](./media/log-analytics-itsmc/itsmc-overview-integrated-solutions.png)
## <a name="create-itsm-work-items-for-oms-alerts"></a>Создание рабочих элементов ITSM для оповещений OMS

В рамках решения ITSMC можно настроить оповещения OMS для запуска создания рабочих элементов в подключенном инструменте ITSM. Выполните перечисленные ниже действия.

1. Запустите запрос поиска по журналам в окне **Поиск по журналу**, чтобы просмотреть данные. Результаты запроса служат источником для рабочих элементов.
2. В разделе **Поиск по журналу** щелкните **Оповещение**, чтобы открыть страницу **Добавить правило оповещения**.

    ![Снимок экрана с Log Analytics](./media/log-analytics-itsmc/itsmc-work-items-for-oms-alerts.png)

3. В окне **Добавить правило оповещения** предоставьте необходимые сведения в полях **Имя**, **Серьезность**, **Поисковый запрос**, а также укажите **критерии оповещения** (временное окно и единицы измерения).
4. Для **Действия: ITSM** выберите значение **Да**.
5. Выберите подключение ITSM из списка **Выбрать подключение**.
6. Предоставьте необходимые сведения.
7. Чтобы создать отдельный рабочий элемент для каждой записи журнала для этого оповещения, установите флажок **Создать отдельные рабочие элементы для каждой записи журнала**.

    Или

    Не устанавливайте этот флажок, если вы хотите создать только один рабочий элемент для любого количества записей журнала для этого оповещения.

7. Щелкните **Сохранить**.

Созданное оповещение OMS можно увидеть в разделе **Параметры**>**Оповещения**. Соответствующие рабочие элементы подключения ITSM создаются, когда выполняются указанные условия оповещений.

## <a name="create-itsm-work-items-from-oms-logs"></a>Создание рабочих элементов ITSM из журналов OMS

Кроме того, можно создать рабочие элементы в подключенных источниках ITSM непосредственно из записи журнала. Выполните перечисленные ниже действия.

1. Выполните поиск необходимых данных в разделе **Поиск по журналу**, выберите данные и щелкните **Create work item** (Создать рабочий элемент).

    Отобразится окно **Создать рабочий элемент ITSM**:

    ![Снимок экрана с Log Analytics](media/log-analytics-itsmc/itsmc-work-items-from-oms-logs.png)

2.   Добавьте следующие сведения:

  - **Название рабочего элемента.** Имя рабочего элемента.
  - **Описание рабочего элемента.** Описание нового рабочего элемента.
  - **Задействованный компьютер.** Имя компьютера, на котором находятся данные журналов.
  - **Выбрать подключение.** Подключение ITSM, в котором требуется создать рабочий элемент.
  - **Рабочий элемент.** Тип рабочего элемента.

3. Чтобы использовать существующий шаблон рабочего элемента для инцидента, задайте для параметра **Создать рабочий элемент на основе шаблона** значение **Да** и нажмите кнопку **Создать**.

    или

    Если вы хотите предоставить собственные настраиваемые значения, щелкните **Нет**.

4. Предоставьте соответствующие значения в текстовых полях **Тип контакта**, **Воздействие**, **Срочность**, **Категория** и **Подкатегория**, а затем нажмите кнопку **Создать**.

## <a name="create-itsm-work-items-from-azure-alerts"></a>Создание рабочих элементов ITSM из оповещений Azure

Решение ITSMC интегрировано с группами действий.

[Группы действий](../monitoring-and-diagnostics/monitoring-action-groups.md) предоставляют модульный и многократно используемый способ активации действий для оповещений Azure. Используя действие ITSM в группах действий, можно создавать рабочие элементы в продукте ITSM, у которого уже имеется подключение к решению соединителя ITSM.

Выполните перечисленные ниже действия.

1. На портале Azure выберите **Монитор**.
2. В левой области щелкните **Группы действий**. Откроется окно **Добавить группу действий**.

    ![Группы действий](media/log-analytics-itsmc/action-groups.png)

3. Предоставьте **Имя** и **ShortName** (Короткое имя) для группы действия. Выберите **группу ресурсов** и **подписку**, в которых необходимо создать группу действий.

    ![Сведения о группах действий](media/log-analytics-itsmc/action-groups-details.png)

4. В списке действий выберите **ITSM** из раскрывающегося меню **Тип действия**. Укажите **имя** действия и щелкните **Изменить сведения**.
5. Выберите **подписку**, в которой расположена рабочая область Log Analytics. Выберите имя **подключения** (имя соединителя ITSM), за которым следует имя рабочей области. Например, MyITSMMConnector(MyWorkspace).

    ![Сведения о действиях ITSM](./media/log-analytics-itsmc/itsm-action-details.png)

6. Выберите тип **рабочего элемента** из раскрывающегося меню.
   Выберите имеющийся шаблон или заполните поля, требуемые для продукта ITSM.
7. Нажмите кнопку **ОК**.

При создании или изменении правила генерации оповещений Azure используйте группу действий, в которой есть действие ITSM. При активации оповещения в инструменте ITSM будет создан рабочий элемент.

>[!NOTE]

> В настоящее время только оповещения журнала действий поддерживают действие ITSM, другие оповещения Azure предупреждения не поддерживают такую возможность.


## <a name="troubleshoot-itsm-connections-in-oms"></a>Устранение неполадок с подключением ITSM в OMS
1.  Если сбой подключения происходит из пользовательского интерфейса подключенного источника с сообщением **Ошибка при сохранении подключения**, сделайте следующее:
 - Для подключений ServiceNow, Cherwell и Provance проверьте, правильно ли введены имя пользователя и пароль, а также идентификатор и секрет клиента каждого подключения.
        Проверьте наличие необходимых прав в соответствующем продукте ITSM, чтобы установить подключение.
 - Для подключений Service Manager убедитесь, что веб-приложение успешно развернуто и создано гибридное подключение. Чтобы проверить подключение к локальному компьютеру Service Manager, перейдите по URL-адресу веб-приложения, как описано в документации по установке [гибридного подключения](log-analytics-itsmc-connections.md#configure-the-hybrid-connection).

2.  Если данные из ServiceNow не синхронизируются с Log Analytics, убедитесь, что экземпляр ServiceNow не находится в спящем режиме. Иногда экземпляры разработки ServiceNow переходят в спящий режим при длительном периоде простоя. В противном случае сообщите о проблеме.
3.  Если поступают оповещения OMS, но рабочие элементы не создаются в продукте ITSM или элементы конфигурации не создаются или не связываются с рабочими элементами, просмотрите следующие компоненты:
 -  ITSMC: решение показывает сводные данные о подключениях, рабочих элементах, компьютерах и т. д. Щелкните плитку **Состояние соединителя**, чтобы с помощью соответствующего запроса перейти на страницу **Поиск по журналу**. Чтобы получить дополнительные сведения, просмотрите записи журнала, где для параметра ERROR задано значение LogType_S.
 - Страница **Поиск по журналу**: просмотрите сведения об ошибках и другие связанные сведения непосредственно с помощью запроса *Type=ServiceDeskLog_CL*.

## <a name="troubleshoot-service-manager-web-app-deployment"></a>Устранение неполадок развертывания веб-приложения Service Manager
1.  При наличии неполадок с развертыванием веб-приложения проверьте наличие всех необходимых разрешений в подписке, используемой для создания или развертывания ресурсов.
2.  Если во время выполнения [сценария](log-analytics-itsmc-service-manager-script.md) отображается ошибка **Ссылка на объект не указывает на экземпляр объекта**, проверьте значения в разделе **Конфигурация пользователя**.
3.  Если вам не удается создать пространство имен ретранслятора шины обслуживания, убедитесь, в подписке зарегистрирован требуемый поставщик ресурсов. Если он не зарегистрирован, создайте пространство имен ретранслятора служебной шины на портале Azure вручную. Его также можно создать на портале Azure во время создания [гибридного подключения](log-analytics-itsmc-connections.md#configure-the-hybrid-connection).


## <a name="contact-us"></a>Свяжитесь с нами

Свяжитесь с нами по адресу [omsitsmfeedback@microsoft.com](mailto:omsitsmfeedback@microsoft.com), чтобы оставить отзывы или запросы касательно соединителя управления ИТ-службами.

## <a name="next-steps"></a>Дальнейшие действия
[Подключение продуктов и служб ITSM с помощью соединителя управления ИТ-службами (предварительная версия)](log-analytics-itsmc-connections.md)
