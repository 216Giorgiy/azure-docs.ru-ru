<properties
    pageTitle="Справочник по поиску в Log Analytics | Microsoft Azure"
    description="В этом справочнике по поиску в Log Analytics описывается язык запросов и общие возможности синтаксиса запросов, которые можно использовать при поиске данных и фильтрации выражений для сужения области поиска."
    services="log-analytics"
    documentationCenter=""
    authors="bandersmsft"
    manager="jwhit"
    editor=""/>

<tags
    ms.service="log-analytics"
    ms.workload="na"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="08/11/2016"
    ms.author="banders"/>



# <a name="log-analytics-search-reference"></a>Справочник по поиску в Log Analytics

В следующем справочном разделе о языке поиска описываются общие варианты синтаксиса запросов, которые можно использовать при поиске данных и фильтрации выражений для сужения области поиска. В нем также описываются команды, которые можно использовать для выполнения действий с полученными данными.

Сведения о полях, возвращаемых при поиске, и аспектах, которые помогают детализировать подобные категории данных, см. в разделе [Справочник по полю и аспекту поиска](#search-field-and-facet-reference).

## <a name="general-query-syntax"></a>Общий синтаксис запросов

Синтаксис:

```
filterExpression | command1 | command2 …
```

Выражение фильтра (`filterExpression`) определяет условие where для запроса. Команды применяются к результатам, возвращаемым запросом. Несколько команд следует разделить символом вертикальной черты (|).

### <a name="general-syntax-examples"></a>Примеры общего синтаксиса

Примеры:

```
system
```

Этот запрос возвращает результаты, содержащие слово "system" в любом поле, которое было проиндексировано для полнотекстового поиска или поиска терминов.

>[AZURE.NOTE] Подобным образом индексируются не все поля, однако наиболее распространенные текстовые поля (например, описания и имена) в общем случае проиндексированы именно так.

```
system error
```

Этот запрос возвращает результаты, содержащие слова *system* и *error*.

```
system error | sort ManagementGroupName, TimeGenerated desc | top 10
```

Этот запрос возвращает результаты, содержащие слова *system* и *error*. Затем он сортирует результаты по полю *ManagementGroupName* (в порядке возрастания), а затем по полю *TimeGenerated* (в порядке убывания). Он принимает только первые 10 результатов.

>[AZURE.IMPORTANT] Все имена полей и значения для строковых и текстовых полей указываются с учетом регистра.

## <a name="filter-expression"></a>Выражения фильтра

Следующие подразделы содержат пояснения по выражениям фильтра.

### <a name="string-literals"></a>Строковые литералы

Строковый литерал — это любая строка, которая не распознается средством синтаксического анализа как ключевое слово или предопределенный тип данных (например, число или дата).

Примеры:

```
These all are string literals
```

Этот запрос выполняет поиск результатов, содержащих вхождения всех пяти слов. Для выполнения поиска сложных строк заключите строковый литерал в кавычки, например:

```
" Windows Server"
```

Этот запрос возвращает только результаты с точным совпадением по строке "Windows Server".

### <a name="numbers"></a>Числа

Средство синтаксического анализа поддерживает для числовых полей синтаксис на базе десятичных целых чисел и чисел с плавающей запятой.

Примеры:

```
Type:Perf 0.5
```

```
HTTP 500
```

### <a name="date/time"></a>Дата и время

Каждый фрагмент данных в системе имеет свойство *TimeGenerated* , которое представляет исходные значения даты и времени записи. Некоторые типы данных могут также иметь дополнительные поля даты и времени (например, *LastModified*).

Селектор диаграммы/времени временной шкалы в Log Analytics показывает распределение результатов во времени (в соответствии с выполняемым в данный момент запросом) на основе поля *TimeGenerated* . Поля даты и времени имеют определенный строковый формат, который можно использовать в запросах для ограничения запроса определенным периодом времени. Синтаксис также можно использовать, чтобы сослаться на относительные интервалы времени (например, "между 3 днями назад и 2 часами назад").

Синтаксис:

```
yyyy-mm-ddThh:mm:ss.dddZ
```

```
yyyy-mm-ddThh:mm:ss.ddd
```

```
yyyy-mm-ddThh:mm:ss
```

```
yyyy-mm-ddThh:mm:ss
```

```
yyyy-mm-ddThh:mm
```

```
yyyy-mm-dd
```


Пример:

```
TimeGenerated:2013-10-01T12:20
```

Предыдущая команда возвращает только записи, у которых значение *TimeGenerated* в точности соответствует 12:20 1 октября 2013 г. Маловероятно, что она даст какой-либо результат, однако это позволяет понять саму идею.

Средство синтаксического анализа также поддерживает мнемоническое значение даты и времени — NOW (Сейчас).


Опять же маловероятно, что это даст какой-либо результат, так как данные не проходят через систему с такой скоростью.

Эти примеры являются шаблонами для относительных и абсолютных дат. В трех следующих подразделах объясняется, как использовать их в более сложных фильтрах, с примерами, где применяются относительные временные диапазоны.

### <a name="date/time-math"></a>Математические операторы даты и времени

Используйте математические операторы даты и времени для смещения или округления значения даты и времени с помощью простых вычислений даты и времени.

Синтаксис:

```
datetime/unit
```

```
datetime[+|-]count unit
```

|Оператор|Описание|
|---|---|
|/|Округляет значение даты и времени до заданной единицы измерения. Пример: NOW/DAY округляет текущее значение даты и времени до полуночи текущего дня.|
|+ или -|Смещает дату и время на указанное число единиц измерения. Примеры: NOW+1HOUR смещает текущую дату и время на 1 час вперед. 2013-10-01T12:00-10DAYS смещает значение даты на 10 дней назад.|



Математические операторы даты и времени можно объединить в цепочку, например:

```
NOW+1HOUR-10MONTHS/MINUTE
```

В следующей таблице перечислены поддерживаемые единицы измерения даты и времени.

Единица измерения даты и времени|Описание
---|---
YEAR, YEARS|Округляет значение до текущего года или смещает значение на указанное число лет.
MONTH, MONTHS|Округляет значение до текущего месяца или смещает значение на указанное число месяцев.
DAY, DAYS, DATE|Округляет значение до текущего дня месяца или смещает значение на указанное число дней.
HOUR, HOURS|Округляет значение до текущего часа или смещает значение на указанное число часов.
MINUTE, MINUTES|Округляет значение до текущей минуты или смещает значение на указанное число минут.
SECOND, SECONDS|Округляет значение до текущей секунды или смещает значение на указанное число секунд.
MILLISECOND, MILLISECONDS, MILLI, MILLIS|Округляет значение до текущей миллисекунды или смещает значение на указанное число миллисекунд.


### <a name="field-facets"></a>Аспекты поля

С помощью аспектов поля можно указать условие поиска для конкретных полей и их точные значения, а не составлять запросы в развернутой форме для различных терминов по всему индексу. Мы уже использовали этот синтаксис в нескольких примерах выше. Здесь мы предлагаем более сложные примеры.

**Синтаксис**

```
field:value
```

```
field=value
```

**Описание**

Выполняет поиск конкретного значения в поле. Значение может быть строковым литералом, числом либо датой и временем.

Пример:

```
TimeGenerated:NOW
```

```
ObjectDisplayName:"server01.contoso.com"
```

```
SampleValue:0.3
```

**Синтаксис**

*поле>значение*

*поле<значение*

*поле>=значение*

*поле<=значение*

*поле!=значение*

**Описание**

Предоставляет сравнения.

Пример:

```
TimeGenerated>NOW+2HOURS
```

**Синтаксис**

```
field:[from..to]
```

**Описание**

Предоставляет аспекты диапазона.

Пример:

```
TimeGenerated:[NOW..NOW+1DAY]
```

```
SampleValue:[0..2]
```

### <a name="logical-operators"></a>Логические операторы

Языки запросов поддерживают логические операторы (*AND*, *OR* и *NOT*) и их псевдонимы в стиле C (*&&*, *||* и *!*) соответственно. Для группировки этих операторов можно использовать круглые скобки.

Примеры:

```
system OR error

```

```
Type:Alert AND NOT(Severity:1 OR ObjectId:"8066bbc0-9ec8-ca83-1edc-6f30d4779bcb8066bbc0-9ec8-ca83-1edc-6f30d4779bcb")
```

Для аргументов фильтра верхнего уровня логический оператор можно опустить. В этом случае подразумевается использование оператора И.


Выражения фильтра|Эквивалент
---|---
system error|system AND error
system "Windows Server" OR Severity:1|system AND ("Windows Server" OR Severity:1)

### <a name="wildcarding"></a>Подстановочные знаки

Язык запросов поддерживает использование символа (*\*) для представления одного или нескольких символов для значения в запросе.

Примеры:

 Найти все компьютеры, содержащие в имени элемент "SQL", например "Redmond-SQL".

```
Type=Event Computer=*SQL*
```

>[AZURE.NOTE] Подстановочные знаки пока нельзя использовать в кавычках. В строке `"*This text*"` все символы (\*) будут трактоваться как символ звездочки (\*).
## <a name="commands"></a>Команды

Эти команды применяются к результатам, возвращаемым запросом. Используйте знак вертикальной черты (|), чтобы применить команду к полученным результатам. Несколько команд следует разделить символом вертикальной черты.

>[AZURE.NOTE] Имена команд, в отличие от имен полей и данных, можно вводить в верхнем или нижнем регистре.

### <a name="sort"></a>Сортировать

Синтаксис:

    sort field1 asc|desc, field2 asc|desc, …

Сортирует результаты по определенным полям. Префикс asc/desc является необязательным. Если префикс не указан, по умолчанию используется порядок сортировки *asc* . Если в запросе не используется команда *Sort* , по умолчанию сортировка выполняется по времени создания ( **TimeGenerated** ), а первыми всегда возвращаются самые новые результаты.

### <a name="top/limit"></a>Top/Limit

Синтаксис:

    top number


    limit number
Ограничивает ответ N лучшими результатами.

Пример:

    Type:Alert errors detected | top 10

Возвращает 10 лучших соответствующих результатов.

### <a name="skip"></a>Skip

Синтаксис:

    skip number

Пропускает указанное число результатов.

Пример:

    Type:Alert errors detected | top 10 | skip 200

Возвращает 10 лучших соответствующих результатов, начиная с результата под номером 200.

### <a name="select"></a>Выберите пункт

Синтаксис:

    select field1, field2, ...

Ограничивает результаты выбранными полями.

Пример:

    Type:Alert errors detected | select Name, Severity

Ограничивает возвращаемые результаты полями *Имя* и *Severity*.

### <a name="measure"></a>Measure

Команда *measure* используется для применения статистических функций к необработанным результатам поиска. Иногда данные нужно представить в *сгруппированном* виде. При использовании команды *measure* поиск в Log Analytics отобразит таблицу с агрегированными результатами.

Синтаксис:

    measure aggregateFunction1([aggregatedField]) [as fieldAlias1] [, aggregateFunction2([aggregatedField2]) [as fieldAlias2] [, ...]] by groupField1 [, groupField2 [, groupField3]]  [interval interval]
    

    measure aggregateFunction1([aggregatedField]) [as fieldAlias1] [, aggregateFunction2([aggregatedField2]) [as fieldAlias2] [, ...]]  interval interval



Выполняет статистическую обработку результатов с помощью параметра *groupField* и вычисляет совокупные значения с помощью параметра *aggregatedField*.


|Статистическая функция для measure|Описание|
|---|---|
|*aggregateFunction*|Имя статистической функции (без учета регистра). Поддерживаются следующие статистические функции: COUNT MAX MIN SUM AVG STDDEV COUNTDISTINCT PERCENTILE## или PCT## (где ## — любое число от 1 до 99).|
|*aggregatedField*|Поле, по которому выполняется агрегирование. Это поле является необязательным для статистической функции COUNT, но для функций SUM, MAX, MIN, AVG, STDDEV, PERCENTILE## или PCT## (где ## — любое число от 1 до 99) оно должно представлять собой существующее числовое поле.|
|*fieldAlias*|Псевдоним (необязательный) для вычисляемого агрегированного значения. Если псевдоним не указан, будет использовано имя AggregatedValue.|
|*groupField*|Имя поля, по которому группируется результирующий набор.|
|*Интервал*|Интервал времени в формате **nnnNAME**, где nnn — положительное целое число, а **NAME** — имя интервала. Поддерживаемые имена интервалов (без учета регистра): MILLISECOND[S] SECOND[S] MINUTE[S] HOUR[S] DAY[S] MONTH[S] YEAR[S].|


Параметр интервала можно использовать только в полях групп даты и времени (например, *TimeGenerated* и *TimeCreated*). В настоящее время служба не применяет данное правило принудительно, однако передача поля без даты и времени в серверную часть приведет к ошибке времени выполнения. При реализации проверки схемы API службы отклоняет запросы, использующие поля без даты и времени для статистической обработки по интервалу. Текущая реализация команды *measure* поддерживает группировку по интервалу для любых статистических функций.

Если предложение BY опущено, однако интервал задан (в качестве второго синтаксиса), по умолчанию подразумевается, что используется поле *TimeGenerated* .

Примеры:

**Пример 1**

    Type:Alert | measure count() as Count by ObjectId

*Пояснение*

Группирует оповещения по *ObjectID* и вычисляет количество оповещений для каждой группы. Агрегированное значение возвращается в виде поля *Count* (псевдоним).

**Пример 2**

    Type:Alert | measure count() interval 1HOUR

*Пояснение*

Группирует оповещения с интервалами в 1 час, используя поле *TimeGenerated* , и возвращает количество оповещений в каждом интервале.

**Пример 3**

    Type:Alert | measure count() as AlertsPerHour interval 1HOUR

*Пояснение*

Аналогичен предыдущему примеру, только с псевдонимом агрегированного поля (*AlertsPerHour*).

**Пример 4**

    * | measure count() by TimeCreated interval 5DAYS

*Пояснение*

Группирует результаты с интервалами в 5 дней, используя поле *TimeCreated* , и возвращает количество результатов в каждом интервале.

**Пример 5**

    Type:Alert | measure max(Severity) by WorkflowName

*Пояснение*

Группирует оповещения по имени рабочей нагрузки и возвращает значение максимального уровня серьезности оповещений для каждого рабочего процесса.

**Пример 6**

    Type:Alert | measure min(Severity) by WorkflowName

*Пояснение*

Аналогичен предыдущему примеру, только с агрегированной функцией *Min* .

**Пример 7**

    Type:Perf | measure avg(CounterValue) by Computer

*Пояснение*

Группирует Perf по полю Computer и вычисляет среднее значение (avg).

**Пример 8**

    Type:Perf | measure sum(CounterValue) by Computer

*Пояснение*

Аналогичен предыдущему примеру, только использует *Sum*.

**Пример 9**

    Type:Perf | measure stddev(CounterValue) by Computer

*Пояснение*

Аналогичен предыдущему примеру, только использует *STDDEV*.

**Пример 10**

    Type:Perf | measure percentile70(CounterValue) by Computer

*Пояснение*

Аналогичен предыдущему примеру, только использует *PERCENTILE70*.

**Пример 11**

    Type:Perf | measure pct70(CounterValue) by Computer

*Пояснение*

Аналогичен предыдущему примеру, только использует *PCT70*. Обратите внимание, что *PCT##* — это только псевдоним для функции *PERCENTILE##*.

**Пример 12**

    Type:Perf | measure avg(CounterValue) by Computer, CounterName

*Пояснение*

Группирует Perf сначала по полю Computer, а затем по CounterName и вычисляет среднее значение (avg).

**Пример 13**

    Type:Alert | measure count() as Count by WorkflowName | sort Count desc | top 5

*Пояснение*

Получает пять первых рабочих процессов с максимальным числом оповещений.

**Пример 14**

    * | measure countdistinct(Computer) by Type

*Пояснение*

Подсчитывает количество уникальных компьютеров, создающих отчеты каждого типа.

**Пример 15**

    * | measure countdistinct(Computer) Interval 1HOUR

*Пояснение*

Подсчитывает количество уникальных компьютеров, создающих отчеты за каждый час.

**Пример 16**

```
Type:Perf CounterName=”% Processor Time” InstanceName=”_Total” | measure avg(CounterValue) by Computer Interval 1HOUR
```

*Пояснение*

Группирует значения загруженности процессора в % по компьютерам и возвращает среднее значение за каждый час.

**Пример 17**

    Type:W3CIISLog | measure max(TimeTaken) by csMethod Interval 5MINUTES

*Пояснение*

Группирует W3CIISLog по методам и возвращает максимальное значение за каждые 5 минут.

**Пример 18**

```
Type:Perf CounterName=”% Processor Time” InstanceName=”_Total”  | measure min(CounterValue) as MIN, avg(CounterValue) as AVG, percentile75(CounterValue) as PCT75, max(CounterValue) as MAX by Computer Interval 1HOUR
```

*Пояснение*

Группирует значения загруженности процессора в % по компьютерам и возвращает минимум, среднее значение, 75-й процентиль и максимум за каждый час.

**Пример 19**

```
Type:Perf CounterName=”% Processor Time”  | measure min(CounterValue) as MIN, avg(CounterValue) as AVG, percentile75(CounterValue) as PCT75, max(CounterValue) as MAX by Computer, InstanceName Interval 1HOUR
```

*Пояснение*

Группирует значения загруженности процессора в % сначала по компьютерам, а затем по именам экземпляра и возвращает минимум, среднее значение, 75-й процентиль и максимум за каждый час.


### <a name="where"></a>Where

Синтаксис:

```
**where** AggregatedValue>20
```

Можно использовать только после команды *Measure* для дальнейшей фильтрации объединенных результатов, созданных статистической функцией *Measure*.

Примеры:

    Type:Perf CounterName:"% Total Run Time" | Measure max(CounterValue) as MAXCPU by Computer

    Type:Perf CounterName:"% Total Run Time" | Measure max(CounterValue) by Computer | where (AggregatedValue>50 and AggregatedValue<90)

### <a name="in"></a>IN

Синтаксис:

```
(Outer Query) (Field to use with inner query results) IN {Inner query | measure count() by (Field to send to outer query)} (rest  of outer query)  
```

Описание. Этот синтаксис позволяет создать агрегированную выборку и передать список из ее значений в другой (основной) внешний поиск для поиска событий со значениями из этого списка. Для этого внутренний поиск заключается в фигурные скобки, а его результаты передаются во внешний поиск в качестве допустимых значений определенного поля с помощью оператора IN.

Пример внутреннего запроса: список *компьютеров, на которых не установлены обновления безопасности* , можно получить с помощью следующего статистического запроса:

```
Type:Update Classification="Security Updates"  UpdateState=needed TimeGenerated>NOW-25HOURS | measure count() by Computer
```    

Заключительный запрос, который найдет *все события Windows для компьютеров, на которых не установлены обновления безопасности* , будет выглядеть примерно так:

```
Type=Event Computer IN {Type:Update Classification="Security Updates"  UpdateState=needed TimeGenerated>NOW-25HOURS | measure count() by Computer}
```

### <a name="dedup"></a>Dedup

**Синтаксис**

    Dedup FieldName

**Описание.** Возвращает первый документ, найденный для каждого уникального значения заданного поля.

**Пример**

    Type=Event | sort TimeGenerated DESC | Dedup EventID

Приведенный выше пример возвращает одно событие (последнее событие, так как указан порядок DESC (по убыванию) для поля TimeGenerated) для каждого значения EventID.


### <a name="extend"></a>Extend

**Описание.** Позволяет создавать поля на время выполнения запросов.

**Пример 1**

    Type=SQLAssessmentRecommendation | Extend product(RecommendationScore, RecommendationWeight) AS RecommendationWeightedScore
Показать взвешенный балл рекомендаций для рекомендаций оценки SQL.

**Пример 2**

    Type=Perf CounterName="Private Bytes" | EXTEND div(CounterValue,1024) AS KBs | Select CounterValue,Computer,KBs
Показать значение счетчика в килобайтах, а не в байтах.

**Пример 3**

    Type=WireData | EXTEND scale(TotalBytes,0,100) AS ScaledTotalBytes | Select ScaledTotalBytes,TotalBytes | SORT TotalBytes DESC
Масштабировать значение TotalBytes для WireData так, чтобы все значения находились в диапазоне от 0 до 100.

**Пример 4**

```
Type=Perf CounterName="% Processor Time" | EXTEND if(map(CounterValue,0,50,0,1),"HIGH","LOW") as UTILIZATION
Tag Perf Counter Values less than 50% las LOW and others as HIGH
```

**Поддерживаемые функции**


| Функция | Описание | Примеры синтаксиса |
|---------|---------|---------|
| abs | Возвращает абсолютное значение заданного поля или функции. | `abs(x)` <br> `abs(-5)` |
| acos | Возвращает арккосинус значения или функции. | `acos(x)` |
| и | Возвращает значение true только в том случае, если все аргументы имеют значение true. | `and(not(exists(popularity)),exists(price))` |
| asin | Возвращает арксинус значения или функции. | `asin(x)` |
| atan | Возвращает арктангенс значения или функции. | `atan(x)` |
| atan2 |  Возвращает угол, полученный в результате преобразования прямоугольных координат x, y в полярные координаты. | `atan2(x,y)` |
| cbrt | Кубический корень. |  `cbrt(x)` | 
| ceil | Округляет до целого числа. | `ceil(x)`  <br> `ceil(5.6)` — возвращает 6 |
| cos | Возвращает косинус угла. | `cos(x)` |
| cosh | Возвращает гиперболический косинус угла. | `cosh(x)` |
| def | def — сокращение от default. Возвращает значение поля field, а если такое поле не существует, возвращает указанное значение по умолчанию или первое по порядку значение, для которого справедливо выражение `exists()==true`. | `def(rating,5)` — эта функция def() возвращает оценку или, если в документе не указана оценка, возвращает 5. <br> `def(myfield, 1.0)` — эквивалент `if(exists(myfield),myfield,1.0)` |
| deg | Преобразует радианы в градусы. |  `deg(x)` | 
| div | `div(x,y)` делит x на y. | `div(1,y)` <br> `div(sum(x,100),max(y,1))` |
| dist | Возвращает расстояние между двумя векторами (точками) в многомерном пространстве. Принимает в качестве аргументов степень, а также два или несколько экземпляров ValueSource и вычисляет расстояния между двумя векторами. Каждый экземпляр ValueSource должен иметь числовое значение. Количество экземпляров ValueSource должно быть четным. Метод предполагает, что первая половина этих экземпляров представляет первый вектор, а вторая — второй вектор.  | `dist(2, x, y, 0, 0)` — вычисляет евклидово расстояние между (0,0) и (x,y) для каждого документа. <br> `dist(1, x, y, 0, 0)` — вычисляет манхэттенское расстояние (расстояние городских кварталов) между (0,0) и (x,y) для каждого документа. <br> `dist(2,,x,y,z,0,0,0)` — евклидово расстояние между (0,0,0) и (x,y,z) для каждого документа.<br>`dist(1,x,y,z,e,f,g)` — манхэттенское расстояние между (x,y,z) и (e,f,g), где каждая буква обозначает имя поля. |
| exists (существует) | Возвращает TRUE, если существует хотя бы один элемент поля. | `exists(author)` — возвращает значение true для любого документа, который имеет значение в поле author.<br>`exists(query(price:5.00))` — возвращает значение true, если поле price имеет значение 5,00. |
| exp | Возвращает число Эйлера, возведенное в степень x. | `exp(x)` |
| floor | Округляет в меньшую сторону до целого числа. | `floor(x)`  <br> `floor(5.6)` — возвращает 5. |
| hypo | Возвращает значение sqrt(sum(pow(x,2),pow(y,2))) без промежуточного переполнения или потери значимости. | `hypo(x,y)`  <br> ` |
| if | Позволяет выполнять запросы с условиями. В выражении `if(test,value1,value2)` : аргумент test представляет собой логическое значение или выражение либо ссылается на него, то есть возвращает логическое значение (TRUE или FALSE).  `value1` определяет значение, которое будет возвращено, если test имеет значение TRUE. `value2` определяет значение, которое будет возвращено, если test имеет значение FALSE. В качестве выражения принимается любая функция, которая возвращает логические значения или даже числовые значения (тогда 0 будет интерпретироваться как false) либо строки (в этом случае пустая строка будет интерпретироваться как false). | `if(termfreq(cat,'electronics'),popularity,42)` : эта функция проверяет каждый документ на наличие термина electronics в поле cat. Если этот термин есть, возвращается значение из поля popularity, а в противном случае — число 42. |
| linear | Выполняет расчет `m*x+c` , где m и c — константы, а x — произвольная функция. Функция полностью эквивалентна выражению `sum(product(m,x),c)`, но вычисляется более эффективно, так как реализована в виде одной функции. | `linear(x,m,c) linear(x,2,4)` возвращает `2*x+4` |
| ln| Возвращает натуральный логарифм от указанной функции. |  `ln(x)` | 
| log | Возвращает логарифм по основанию 10 от указанной функции. | `log(x)   log(sum(x,100))` |
| map | Преобразует все значения входной функции x, попадающие в диапазон от min до max включительно, в значения, определяемые аргументом target. Аргументы функции min и max должны быть константами. Аргументы target и default могут быть константами или функциями. Если значение x не попадает в диапазон от min до max, возвращается значение x или значение по умолчанию, если указан 5-й аргумент default. |  `map(x,min,max,target) map(x,0,0,1)` — изменяет все значения 0 на 1. Может использоваться для обработки значений 0 по умолчанию.<br> `map(x,min,max,target,default)    map(x,0,100,1,-1)` — изменяет все значения между 0 и 100 на 1, а все остальные значения — на -1.<br>  `map(x,0,100,sum(x,599),docfreq(text,solr))` — изменяет все значения между 0 и 100 на x+599, а все остальные значения — на частоту термина solr в текстовом поле. |
| max | Возвращает максимальное числовое значение нескольких вложенных функций или констант, которые переданы в качестве аргументов: `max(x,y,...)`. Функция max может быть полезна для "подтягивания" низких значений другой функции или поля до определенной константы.  (Чтобы выбрать максимальное значение из одного поля, содержащего различные значения, используйте синтаксис `field(myfield,max)` .)  | `max(myfield,myotherfield,0)` |
| Min | Возвращает минимальное числовое значение нескольких вложенных функций констант, которые переданы в качестве аргументов: `min(x,y,...)`. Функция max может быть полезна для "обрезания" высоких значений другой функции или поля до определенной константы. (Чтобы выбрать минимальное значение из одного поля, содержащего различные значения, используйте синтаксис `field(myfield,min)` .) | `min(myfield,myotherfield,0)` |
| mod (модуль) | Вычисляет модуль функции x по функции y. |`mod(1,x)` <br> `mod(sum(x,100), max(y,1))`   | 
| ms | Возвращает разницу в миллисекундах между заданными аргументами. Даты указываются в формате эпохи времени Unix или POSIX, то есть от полуночи 1 января 1970 г. в формате UTC. Аргументы могут быть именем индексированного поля TrieDateField или математической датой на основе константы даты или значения NOW. `ms()` эквивалентно `ms(NOW)` (количество миллисекунд с начала отсчета времени). `ms(a)` возвращает количество миллисекунд с начала отсчета времени, представляемого аргументом. `ms(a,b)` возвращает количество миллисекунд, когда событие b предшествует событию a, т. е. `a - b`.| `ms(NOW/DAY)`<br>`ms(2000-01-01T00:00:00Z)`<br>`ms(mydatefield)`<br>`ms(NOW,mydatefield)`<br>`ms(mydatefield,2000-01-01T00:00:00Z)`<br>`ms(datefield1,datefield2)` |
| not | Логическое отрицание значения функции, указанной в качестве аргумента. | `not(exists(author))` равно true, только если `exists(author)` имеет значение false. |
| или | Логическая дизъюнкция. | `or(value1,value2)` : возвращает TRUE, если хотя бы одно из значений value1 и value2 равно TRUE. |
| pow | Возводит указанное основание в указанную степень. `pow(x,y)` : возвращает значение x в степени y. |  `pow(x,y)`<br>`pow(x,log(y))`<br>`pow(x,0.5)` : то же самое, что sqrt. |
| product | Возвращает произведение нескольких значений или функций, которые указываются в виде списка, разделенного запятыми. `mul(...)` . | `product(x,y,...)`<br>`product(x,2)`<br>`product(x,y)`<br>`mul(x,y)` |
| recip | Выполняет обратную функцию, то есть `recip(x,m,a,b)` соответствует `a/(m*x+b)`, где m, a и b — константы, а x — функция любого уровня сложности. Если a = b и x >= 0, эта функция имеет максимальное значение 1, которое уменьшается по мере увеличения x. Увеличение значений a и b позволяет сместить график функции в более плоскую часть кривой. Эти свойства позволяют использовать функцию для повышения рейтинга более свежих документов, указав в качестве x функцию `rord(datefield)`. | `recip(myfield,m,a,b)`<br>`recip(rord(creationDate),1,1000,1000)` |
| rad | Преобразует градусы в радианы. | `rad(x)` |
| rint| Округляет число до ближайшего целого числа. | `rint(x)`  <br> `rint(5.6)` — возвращает 6 |
| sin | Возвращает синус угла. | `sin(x)` |
| sinh | Возвращает гиперболический синус угла. | `sinh(x)` |
| scale | Масштабирует значения функции x таким образом, чтобы они располагались в диапазоне от minTarget до maxTarget включительно. Текущая реализация функции перебирает все значения функции, чтобы определить минимальное и максимальное значение для выбора правильного масштаба. Текущая реализация не различает удаленные документы или документы, для которых не указано значение. Для обоих этих случаев используется значение 0,0. Таким образом, даже если все нормальные значения аргумента больше 0,0, минимальным значением для функции масштабирования все равно может оказаться 0,0. Чтобы обойти эту проблему, мы рекомендуем использовать соответствующую функцию `map()` для замены значения 0,0 значением из диапазона осмысленных значений, например так: `scale(map(x,0,0,5),1,2)`. | `scale(x,minTarget,maxTarget)`<br>`scale(x,1,2)` : масштабирует значения x таким образом, чтобы все они оказались между 1 и 2 включительно. | 
| sqrt | Возвращает квадратный корень из указанного значения или функции. | `sqrt(x)`<br>`sqrt(100)`<br>`sqrt(sum(x,100))` |
| strdist | Вычисления расстояние между двумя строками. Использует интерфейс StringDistance средства проверки орфографии Lucene и поддерживает все доступные в этом пакете реализации. Кроме того, позволяет приложениям подключать свои пакеты через возможности загрузки ресурсов Solr. strdist принимает аргументы `(string1, string2, distance measure)`. Возможные значения для меры расстояния: <br>jw: расстояние Джаро — Винклера;<br>edit: расстояние Левенштейна или редакторское расстояние;<br>ngram: NGramDistance, если указано, также принимает необязательный аргумент размера ngram. По умолчанию используется значение 2.<br>FQN: Полное имя класса для реализации интерфейса StringDistance. Должен использоваться конструктор без аргументов.|`strdist("SOLR",id,edit)` |
| sub | Возвращает разность значений x-y из `sub(x,y)`. | `sub(myfield,myfield2)`<br>`sub(100,sqrt(myfield))` |
| Sum | Возвращает сумму нескольких значений или функций, которые передаются в виде списка, разделенного запятыми. `add(...)` . | `sum(x,y,...)`<br>`sum(x,1)`<br>`sum(x,y)`<br>`sum(sqrt(x),log(y),z,0.5)`<br>`add(x,y)`|
|termfreq | Возвращает количество появлений термина в поле для этого документа. | termfreq(text,'memory')|
| tan | Возвращает тангенс угла. | `tan(x)` |
| tanh | Возвращает гиперболический тангенс угла. | `tanh(x)` |




## <a name="search-field-and-facet-reference"></a>Справочник по полю и аспекту поиска

Когда вы используете Log Search для поиска данных, в результатах отображаются различные поля и аспекты. Тем не менее некоторые из отображаемых сведений могут показаться непонятными. Вы можете воспользоваться приведенной ниже информацией, чтобы интерпретировать результаты.



|Поле|Тип поиска|Описание|
|---|---|---|
|TenantId|Все|Используется для секционирования данных.|
|TimeGenerated|Все|Используется для управления временной шкалой и селекторами времени (в поиске и на других экранах). Оно представляет, когда фрагмент данных был создан (обычно в агенте). Время обозначается по стандарту ISO и всегда является временем в формате UTC. В случае с "типами", основанными на существующем инструментировании (т. е. событиях в журнале), обычно это реальное время регистрации строки (записи) журнала; для некоторых других типов, которые создаются через пакеты управления или в облаке, например рекомендации, оповещения, агенты обновления и т. п., это время, когда был получен этот новый фрагмент данных вместе с каким-либо моментальным снимком конфигурации или на основе его была создана рекомендация (оповещение).|
|EventID|Событие|Код события в журнале событий Windows.|
|EventLog|Событие|Журнал событий, в котором событие было зарегистрировано операционной системой Windows.|
|EventLevelName|Событие|Уровни критический/ предупреждение/информационный/успешное выполнение|
|EventLevel|Событие|Числовое значение для уровня критический/ предупреждение/информационный/успешное выполнение (используйте вместо него EventLevelName, чтобы получить более простые и удобные для чтения запросы)|
|SourceSystem|Все|Источник поступления данных с точки зрения режима подключения к службе, например Operations Manager, OMS (если данные создаются в облаке), служба хранилища Azure (если данные поступают из системы диагностики Microsoft Azure) и т. д.|
|ObjectName|PerfHourly|Имя объекта производительности Windows.|
|InstanceName|PerfHourly|Имя экземпляра счетчика производительности Windows.|
|CounteName|PerfHourly|Имя счетчика производительности Windows.|
|ObjectDisplayName|PerfHourly, ConfigurationAlert, ConfigurationObject, ConfigurationObjectProperty|Отображаемое имя объекта, который является мишенью для правила сбора данных о производительности в Operations Manager, объекта, обнаруженного компонентом оперативной аналитики, либо объекта, для которого было выдано оповещение.|
|RootObjectName|PerfHourly, ConfigurationAlert, ConfigurationObject, ConfigurationObjectProperty|Отображаемое имя родительского элемента родительского элемента (в отношении двойного размещения, например SqlDatabase, размещаемый SqlInstance, который размещается на компьютере Windows) объекта, который является мишенью для правила сбора данных о производительности в Operations Manager, объекта, обнаруженного компонентом оперативной аналитики, либо объекта, для которого было выдано оповещение.|
|Компьютер|Большинство типов|Имя компьютера, к которому относятся данные.|
|DeviceName|ProtectionStatus|Имя компьютера, к которому относятся данные (то же, что и Computer)|
|DetectionId|ProtectionStatus| |
|ThreatStatusRank|ProtectionStatus|Ранг состояния угрозы является числовым представлением состояния угрозы, и, как и в случае с кодами HTTP-ответов, мы оставили промежутки между числами (поэтому число угроз составляет 150, а не 100 или 0), чтобы получить возможность добавлять новые состояния. При выполнении свертки для состояния угрозы и состояния защиты мы хотим показать наихудшее состояние, в котором компьютер находился за выбранный период времени. Мы используем номера для ранжирования различных состояний, чтобы можно было просмотреть запись с наибольшим номером.|
|ThreatStatus|ProtectionStatus|Описание для ThreatStatus полностью соответствует описанию для ThreatStatusRank|
|TypeofProtection|ProtectionStatus|Продукт защиты от вредоносных программ, обнаруженный на компьютере: отсутствует, средство удаления вредоносных программ (Майкрософт), Forefront и т. д.|
|ScanDate|ProtectionStatus| |
|SourceHealthServiceId|ProtectionStatus, RequiredUpdate|Идентификатор службы работоспособности для агента этого компьютера.|
|HealthServiceId|Большинство типов|Идентификатор службы работоспособности для агента этого компьютера.|
|ManagementGroupName|Большинство типов|Имя группы управления для подключенных к Operations Manager агентов; в противном случае имеет пустое значение или значение NULL.|
|ObjectType|ConfigurationObject|Тип (как в типе/классе пакета управления Operations Manager) для этого объекта, обнаруженный функцией оценки конфигурации Log Analytics.|
|UpdateTitle|RequiredUpdate|Имя обновления, которое было определено как неустановленное.|
|PublishDate|RequiredUpdate|Когда обновление было опубликовано в Центре обновления Майкрософт?|
|сервер;|RequiredUpdate|Имя компьютера, к которому относятся данные (то же, что и Computer)|
|product|RequiredUpdate|Продукт, к которому применяется обновление.|
|UpdateClassification|RequiredUpdate|Тип обновления (накопительный пакет обновления, пакет обновления и т. д.).|
|KBID|RequiredUpdate|Идентификатор статьи в базе знаний с описанием этой рекомендации или этого обновления.|
|WorkflowName|ConfigurationAlert|Имя правила или монитора, которые вызвали оповещение.|
|Severity|ConfigurationAlert|Серьезность оповещения.|
|Приоритет|ConfigurationAlert|Приоритет оповещения.|
|IsMonitorAlert|ConfigurationAlert|Это предупреждение создается монитором (true) или правилом (false)?|
|AlertParameters|ConfigurationAlert|Документ XML с параметрами оповещения Log Analytics.|
|Context|ConfigurationAlert|Документ XML с контекстом оповещения Log Analytics.|
|Рабочая нагрузка|ConfigurationAlert|Технология или рабочая нагрузка, к которой относится оповещение.|
|AdvisorWorkload|Рекомендации|Технология или рабочая нагрузка, к которой относится рекомендация.|
|Описание|ConfigurationAlert|Описание оповещения (краткое).|
|DaysSinceLastUpdate|UpdateAgent|Сколько дней назад (относительно значения TimeGenerated этой записи) этот агент устанавливал любое обновление из служб WSUS или Центра обновления Майкрософт?|
|DaysSinceLastUpdateBucket|UpdateAgent|Основанная на значении DaysSinceLastUpdate классификация того, как давно на компьютере в последний раз было установлено обновление из служб WSUS или Центра обновления Майкрософт, по заданным периодам.|
|AutomaticUpdateEnabled|UpdateAgent|Включена ли в данном агенте автоматическая проверка обновления?
|AutomaticUpdateValue|UpdateAgent|Настроена ли автоматическая проверка обновления на автоматическое скачивание и установку, только на скачивание или только на проверку?|
|WindowsUpdateAgentVersion|UpdateAgent|Номер версии агента Центра обновления Майкрософт.|
|WSUSServer|UpdateAgent|На какой сервер WSUS нацелен этот агент обновления?|
|OSVersion|UpdateAgent|Версия операционной системы, в которой выполняется этот агент обновления.|
|Имя|Recommendation, ConfigurationObjectProperty|Имя (заголовок) рекомендации или имя свойства из функции оценки конфигурации Log Analytics.|
|Значение|ConfigurationObjectProperty|Значение свойства из функции оценки конфигурации Log Analytics.|
|KBLink|Рекомендации|URL-адрес статьи в базе знаний с описанием этой рекомендации или этого обновления.|
|RecommendationStatus|Рекомендации|Рекомендации относятся к тем немногим типам, записи которых обновляются, а не просто добавляются в индекс поиска. Это состояние определяет, является ли рекомендация активной (открытой) или инструмент Log Analytics обнаружил, что она была разрешена.|
|RenderedDescription|Событие|Готовое для просмотра описание события Windows (повторно используемый текст с заполненными параметрами).|
|ParameterXml|Событие|XML-код с параметрами из раздела данных события Windows (как показано в средстве просмотра событий).|
|EventData|Событие|XML-код со всем разделом данных события Windows (как показано в средстве просмотра событий).|
|Источник|Событие|Источник журнала событий, который создал событие.|
|EventCategory|Событие|Категория события, полученная непосредственно из журнала событий Windows.|
|UserName|Событие|Имя пользователя события Windows (обычно это NT AUTHORITY\LOCALSYSTEM)|
|SampleValue|PerfHourly|Среднее значение для почасовой статистической обработки счетчика производительности.|
|Min|PerfHourly|Минимальное значение в почасовом интервале для почасовой статистической обработки счетчика производительности.|
|max|PerfHourly|Максимальное значение в почасовом интервале для почасовой статистической обработки счетчика производительности.|
|Percentile95|PerfHourly|Значение 95-го процентиля для почасового интервала почасовой статистической обработки счетчика производительности.|
|SampleCount|PerfHourly|Количество необработанных выборок счетчиков производительности, использованных для создания этой записи почасовой статистической обработки.|
|Threat|ProtectionStatus|Имя обнаруженной вредоносной программы.|
|StorageAccount|W3CIISLog|Учетная записи хранения Azure, из которой был считан журнал.|
|AzureDeploymentID|W3CIISLog|Идентификатор развертывания Azure для облачной службы, к которой относится журнал.|
|Роль|W3CIISLog|Роль облачной службы Azure, к которой относится журнал.|
|RoleInstance|W3CIISLog|Значение RoleInstance роли Azure, к которой относится журнал.|
|sSiteName|W3CIISLog|Веб-сайт IIS, к которому относится журнал (нотация метабазы); поле s-sitename в исходном журнале.|
|sComputerName|W3CIISLog|Поле s-computername в исходном журнале.|
|sIP|W3CIISLog|IP-адрес сервера, на который был направлен HTTP-запрос. Поле s-ip в исходном журнале.|
|csMethod|W3CIISLog|Метод HTTP (GET/POST и т. д.), используемый клиентом в HTTP-запросе. Поле cs-method в исходном журнале.|
|cIP|W3CIISLog|IP-адрес клиента, откуда был выдан HTTP-запрос. Поле c-ip в исходном журнале.|
|csUserAgent|W3CIISLog|Агент пользователя HTTP, объявленный клиентом (в браузере или иным способом). Поле cs-user-agent в исходном журнале.|
|scStatus|W3CIISLog|Код состояния HTTP (200/403/500 и т. д.), который сервер возвращает клиенту. Поле cs-status в исходном журнале.|
|TimeTaken|W3CIISLog|Время (в миллисекундах), потребовавшееся для выполнения запроса. Поле timetaken в исходном журнале.|
|csUriStem|W3CIISLog|Относительный URI (без адреса узла, например "/search"), который был запрошен. Поле cs-uristem в исходном журнале.|
|csUriQuery|W3CIISLog|Запрос URI. Запросы URI необходимы только для динамических страниц, например ASP-страниц, поэтому для статических страниц это поле обычно содержит дефис.|
|sPort|W3CIISLog|Порт сервера, на который был отправлен HTTP-запрос (и который после принятия запроса прослушивают службы IIS).|
|csUserName|W3CIISLog|Имя пользователя, прошедшего проверку, если запрос подлежит проверке подлинности и не является анонимным.|
|csVersion|W3CIISLog|Версия протокола HTTP, используемого в запросе (например, "HTTP/1.1").|
|csCookie|W3CIISLog|Сведения о файле cookie.|
|csReferer|W3CIISLog|Сайт, который пользователь посетил последним. Этот сайт предоставил ссылку на текущий сайт.|
|csHost|W3CIISLog|Заголовок узла (например, "www.mysite.com"), который был запрошен.|
|scSubStatus|W3CIISLog|Код подсостояния ошибки.|
|scWin32Status|W3CIISLog|Код состояния Windows.|
|csBytes|W3CIISLog|Количество байт, отправленных из клиента на сервер в рамках запроса.|
|scBytes|W3CIISLog|Количество байт, возвращенных клиенту с сервера в рамках ответа.|
|ConfigChangeType|ConfigurationChange|Тип изменения (службы Windows, программное обеспечение и т. п.).|
|ChangeCategory|ConfigurationChange|Категория изменения (изменено, добавлено, удалено).|
|SoftwareType|ConfigurationChange|Тип программного обеспечения (обновление, приложение).|
|SoftwareName|ConfigurationChange|Название программного обеспечения (применимо только к изменениям программного обеспечения).|
|Издатель|ConfigurationChange|Поставщик, опубликовавший программное обеспечение (применимо только к изменениям программного обеспечения).|
|SvcChangeType|ConfigurationChange|Тип изменения, примененного к службе Windows (состояние, тип запуска, путь, учетная запись службы) — распространяется только на изменения служб Windows.|
|SvcDisplayName|ConfigurationChange|Отображаемое имя измененной службы.|
|SvcName|ConfigurationChange|Имя измененной службы.|
|SvcState|ConfigurationChange|Новое (текущее) состояние службы.|
|SvcPreviousState|ConfigurationChange|Предыдущее известное состояние службы (применимо только в случае изменения состояния службы).|
|SvcStartupType|ConfigurationChange|Тип запуска службы.|
|SvcPreviousStartupType|ConfigurationChange|Предыдущий тип запуска службы (применимо только в случае изменения типа запуска службы).|
|SvcAccount|ConfigurationChange|Учетная запись службы.|
|SvcPreviousAccount|ConfigurationChange|Предыдущая учетная запись службы (применимо только в случае изменения учетной записи службы).|
|SvcPath|ConfigurationChange|Путь к исполняемому файлу службы Windows.|
|SvcPreviousPath|ConfigurationChange|Предыдущий путь к исполняемому файлу службы Windows (применимо только в случае изменения этого пути).|
|SvcDescription|ConfigurationChange|Описание службы.|
|Предыдущий|ConfigurationChange|Предыдущее состояние данного программного обеспечения (установлено, не установлено, предыдущая версия).|
|Текущее значение|ConfigurationChange|Последнее состояние данного программного обеспечения (установлено, не установлено, текущая версия).|

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о расширенных базах данных.

- Подробные сведения, собираемые решениями, описаны в статье [о поиске по журналам](log-analytics-log-searches.md) .
- Чтобы расширить возможности поиска по журналам, см. статью [Настраиваемые поля в службе Log Analytics](log-analytics-custom-fields.md).



<!--HONumber=Oct16_HO2-->


