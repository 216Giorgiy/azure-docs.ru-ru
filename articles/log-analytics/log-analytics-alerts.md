---
title: "Обзор оповещений в OMS Log Analytics | Документация Майкрософт"
description: "Оповещения в Log Analytics идентифицируют важную информацию в репозитории OMS и могут заранее уведомлять вас о возникших проблемах или выполнять действия в попытке устранить их.  Эта статья описывает создание правила генерации оповещений и сведения о различных действиях, которые оно может выполнить."
services: log-analytics
documentationcenter: 
author: bwren
manager: jwhit
editor: tysonn
ms.assetid: 6cfd2a46-b6a2-4f79-a67b-08ce488f9a91
ms.service: log-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/28/2017
ms.author: bwren
ms.custom: H1Hack27Feb2017
translationtype: Human Translation
ms.sourcegitcommit: ec7167fb36e54219957629699f33dfce950f86d5
ms.openlocfilehash: 48d921650dbbf3f9cc2a8a0e265e0c7deaebdafd
ms.lasthandoff: 03/01/2017


---
# <a name="respond-to-issues-in-log-analytics-using-alerts"></a>Реагирование на проблемы в Log Analytics с использованием оповещений

Оповещения в Log Analytics содержат важную информацию о вашем репозитории Log Analytics.  Их можно использовать для получения заблаговременных уведомлений о проблемах или для выполнения автоматических ответных действий на проблему.  В этой статье представлены общие сведения о создании и использовании оповещений.  


>[!NOTE]
> Сведения о правилах генерации оповещений об измерениях метрик, которые в настоящее время находятся на этапе общедоступной предварительной версии, см. в разделе [New metric measurement alert rule type in Public Preview!](https://blogs.technet.microsoft.com/msoms/2016/11/22/new-metric-measurement-alert-rule-type-in-public-preview/) (Новый тип правила генерации оповещений об измерении метрики в общедоступной предварительной версии!).

## <a name="alert-rules"></a>Правила оповещения

Оповещения создаются с помощью правил оповещения, которые автоматически выполняют поиск по журналам через регулярные интервалы.  Если результаты поиска по журналам соответствуют определенным условиям, создается запись оповещения.  Правило также может автоматически запустить одно или несколько действий, чтобы заблаговременно уведомить вас об оповещении либо вызвать другой процесс.  

![Оповещения Log Analytics](media/log-analytics-alerts/overview.png)


Правила оповещения определяются следующими сведениями.

- **Поиск по журналам**.  Это запрос, который будет запускаться каждый раз при выполнении правила оповещения.  Чтобы определить, создается ли оповещение, будут использоваться записи, возвращаемые этим запросом.
- **Временное окно**.  Указывает диапазон времени для запроса.  Запрос возвращает только те записи, которые были созданы в течение этого периода, предшествующего настоящему времени.  Это значение может составлять от 5 минут до 24 часов. Например, если временное окно равно 60 минутам, а запрос выполняется в 13:15, возвращаются только записи, созданные между 12:15 и 13:15.
- **Частота**.  Указывает, как часто должен выполняться запрос. Это значение может составлять от 5 минут до 24 часов. Оно должно быть меньше или равно временному окну.  Если значение больше, чем временное окно, появляется риск пропуска записей.<br>Например, рассмотрим временное окно в 30 минут и частоту в 60 минут.  Если запрос выполняется в 13:00, он возвращает записи между 12:30 и 13:00.  В следующий раз этот запрос будет выполнен в 14:00, а записи возвратятся между 13:30 и 14:00.  Записи, созданные между 13:00 и 13:30, не будут учитываться.
- **Пороговое значение**.  Если число записей, возвращаемых при поиске по журналам, превышает пороговое значение, создается оповещение.

## <a name="creating-alert-rules"></a>Создание правил оповещения
Вы можете создать и изменить правила оповещения несколькими способами.  Чтобы получить подробные инструкции, ознакомьтесь со следующими статьями.  

- Создание правил оповещения с помощью [портала OMS](log-analytics-alerts-creating.md).
- Создание правил оповещения с помощью [шаблона Resource Manager](log-analytics-template-workspace-configuration.md).
- Создание правил оповещения с помощью [REST API](log-analytics-api-alerts.md).

## <a name="alert-actions"></a>Действия оповещений

Помимо создания записи оповещения правило оповещения может инициировать выполнение одного или нескольких действий при создании оповещения.  Действия можно использовать для отправки сообщения в ответ на оповещение или для запуска процесса, пытающегося выполнить корректирующие действия.  

Их можно также использовать для расширения функций Log Analytics с другими службами.  Например, сейчас действие не предоставляет возможность уведомлений с помощью SMS-сообщений или по телефону.  Вы можете использовать действие webhook в правиле оповещения для вызова службы, например [PagerDuty](https://www.pagerduty.com/), которая предоставляет эти возможности.  Пример создания webhook для отправки сообщения с использованием [Slack](https://slack.com/) см. в статье [Действия webhook в оповещениях Log Analytics](log-analytics-alerts-webhooks.md).

В следующей таблице перечислены действия, которые можно выполнять.  Сведения о каждом из них см. в статье [Adding actions to alert rules in Log Analytics](log-analytics-alerts-actions.md) (Добавление действий в правила оповещения в Log Analytics). 

| Действие | Описание |
|:--|:--|
| Email  |     Отправка сообщения электронной почты с описанием оповещения одному или нескольким получателям. |
| Webhook | Вызов внешнего процесса с помощью одного запроса HTTP POST. |
| Модуль Runbook | Запуск модуля Runbook в службе автоматизации Azure. |


## <a name="alerting-scenarios"></a>Сценарии оповещений

### <a name="events"></a>События
Для оповещения об одном событии создайте правило оповещения с количеством результатов **больше 0**, а частоту и временное окно установите равными **5 минутам**.  При этом запрос запускается каждые 5 минут и проверяет наличие одного события, созданного с момента последнего выполнения запроса.  Уменьшение частоты может привести к увеличению интервала между сбором данных о событии и созданием оповещения.  Запрос, аналогичный приведенному ниже, используется для указания интересующего вас события.

    Type=Event Source=MyApplication EventID=7019 

Некоторые приложения могут вносить в журнал нерегулярную ошибку, которая не обязательно должна вызывать оповещение.  Например, приложение может повторно запустить процесс, который создал событие ошибки и затем успешно завершил работу при следующем выполнении.  В этом случае вам может потребоваться создавать оповещение только в случае возникновения нескольких событий за определенное временное окно.  Для этого используйте тот же запрос, но увеличьте пороговое значение.  Например, чтобы оповестить о 5 событиях в течение 30 минут, следует установить частоту в **5 минут**, временное окно в **30 минут** и количество результатов **больше 4**.    

В некоторых случаях может потребоваться создать оповещение в случае отсутствия события.  Например, процесс может регистрировать регулярные события, чтобы указать, что он работает правильно.  Если он не регистрирует одно из таких событий в пределах определенного временного окна, следует создать оповещение.  В этом случае задайте количество результатов **меньше 1**.

### <a name="performance-alerts"></a>Оповещения производительности
Так же как и события, [данные о производительности](log-analytics-data-sources-performance-counters.md) хранятся в виде записей в репозитории Log Analytics.  Если вы хотите создать оповещение, когда значение счетчика производительности превышает определенный порог, это пороговое значение следует включить в запрос.

Например, если бы вам было нужно получить оповещение, когда процессор нагружен более чем на 90 %, то вы могли бы использовать запрос с количеством результатов для правила оповещения **больше 0**. Пример такого запроса приведен ниже.

    Type=Perf ObjectName=Processor CounterName="% Processor Time" CounterValue>90

Если бы вам было нужно получить оповещение, когда средняя нагрузка процессора превышает 90 % в определенном временном окне, то вы могли бы использовать запрос с [командой measure](log-analytics-search-reference.md#commands) и пороговым значением для правила оповещения **Больше 0**. Ниже приведен пример такого запроса. 

    Type=Perf ObjectName=Processor CounterName="% Processor Time" | measure avg(CounterValue) by Computer | where AggregatedValue>90


## <a name="alert-records"></a>Записи оповещений
Записи оповещений, созданные правилами генерации оповещений в Log Analytics, имеют значение **Alert** для **Type** и значение **OMS** для **SourceSystem**.  У них есть свойства, приведенные в таблице ниже.

| Свойство | Описание |
|:--- |:--- |
| Тип |*Предупреждение* |
| SourceSystem |*OMS* |
| AlertName |Имя оповещения. |
| AlertSeverity |Серьезность оповещения. |
| LinkToSearchResults |Ссылки на поиск журналов Log Analytics, возвращающая записи из запроса, создавшего оповещение. |
| Запрос |Текст запроса, который был запущен. |
| QueryExecutionEndTime |Конец диапазона времени для запроса. |
| QueryExecutionStartTime |Начало диапазона времени для запроса. |
| ThresholdOperator | Оператор, используемый правилом оповещения. |
| ThresholdValue | Значение, используемое правилом оповещения. |
| TimeGenerated |Дата и время создания оповещения. |

Существуют и другие виды записей оповещений, создаваемые [решением для управления оповещениями](log-analytics-solution-alert-management.md) и [экспортами Power BI](log-analytics-powerbi.md).  Все они имеют значение **Alert** для **Type**, но различаются по **SourceSystem**.


## <a name="next-steps"></a>Дальнейшие действия
* Создайте правило оповещения с помощью [портала OMS](log-analytics-alerts-creating.md).
* Установите [решение для управления оповещениями](log-analytics-solution-alert-management.md) , чтобы анализировать предупреждения, созданные Log Analytics, вместе с оповещениями, данные о которых собраны из System Center Operations Manager (SCOM).
* Вы можете ознакомиться с дополнительными сведениями о [поисках журналов](log-analytics-log-searches.md) , которые могут создавать оповещения.
* Вы можете выполнить пошаговое руководство по [настройке webook](log-analytics-alerts-webhooks.md) с использованием правила генерации оповещений.  
* Вы можете научиться писать [модули Runbook в службе автоматизации Azure](https://azure.microsoft.com/documentation/services/automation) для устранения проблем, обозначенных в оповещениях.


