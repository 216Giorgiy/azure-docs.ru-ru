<properties 
   pageTitle="Счетчики производительности Windows и Linux в службе Log Analytics | Microsoft Azure"
   description="Счетчики производительности собираются службой Log Analytics для анализа производительности в агентах Windows и Linux.  В этой статье описывается настройка коллекции счетчиков производительности для агентов Windows и Linux, сведения об этих счетчиках, которые хранятся в репозитории OMS, и их анализ на портале OMS."
   services="log-analytics"
   documentationCenter=""
   authors="bwren"
   manager="jwhit"
   editor="tysonn" />
<tags 
   ms.service="log-analytics"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="10/27/2016"
   ms.author="bwren" />


# <a name="windows-and-linux-performance-data-sources-in-log-analytics"></a>Источники данных о производительности Windows и Linux в Log Analytics 

Счетчики производительности в Windows и Linux позволяют получить представление о производительности компонентов оборудования, операционных систем и приложений.  Log Analytics может собирать счетчики производительности с высокой частотой для анализа данных практически в режиме реального времени, а также данные о производительности для более долгосрочного анализа и формирования отчетов.

![Счетчики производительности](media/log-analytics-data-sources-performance-counters/overview.png)

## <a name="configuring-performance-counters"></a>Настройка счетчиков производительности

Счетчики производительности настраиваются в [меню "Данные" раздела "Параметры" Log Analytics](log-analytics-data-sources.md#configuring-data-sources).

При первой настройке счетчиков производительности Windows или Linux для новой рабочей области OMS вы можете быстро создать несколько распространенных счетчиков.  Рядом с каждым счетчиком в списке есть флажок.  Отметьте все счетчики, которые нужно создать изначально, и щелкните ссылку **Добавить выбранные счетчики производительности**.

![Настройка счетчиков производительности Windows](media/log-analytics-data-sources-performance-counters/configure-windows.png)

Чтобы добавить новый счетчик производительности Windows для сбора данных, выполните описанные ниже действия.

1. Введите в текстовое поле имя счетчика в формате *объект(экземпляр)\счетчик*.  По мере ввода вы увидите соответствующий список распространенных счетчиков.  Выберите счетчик из списка или введите собственный.  Кроме того, вы можете получить все экземпляры определенного счетчика, указав *объект\счетчик*. 
2. Щелкните **+** или нажмите клавишу **ВВОД**, чтобы добавить счетчик в список.
3. При добавлении счетчика по умолчанию устанавливается **интервал выборки** 10 секунд.  Вы можете увеличить это значение до 1800 секунд (30 минут), уменьшив таким образом объем собираемых данных по производительности.
4. Закончив добавление счетчиков, нажмите кнопку **Сохранить** в верхней части экрана, чтобы сохранить конфигурацию.

![Настройка счетчиков производительности Linux](media/log-analytics-data-sources-performance-counters/configure-linux.png)

Чтобы добавить новый счетчик производительности Linux для сбора данных, выполните описанные ниже действия.

1. По умолчанию все изменения конфигурации автоматически отправляются во все агенты.  Файл конфигурации агентов Linux отправляется в сборщик данных Fluentd.  Если вы хотите изменить этот файл вручную в каждом агенте Linux, снимите флажок *Apply below configuration to my Linux machines*(Применить конфигурацию ниже к моим компьютерам Linux).
2. Введите в текстовое поле имя счетчика в формате *объект(экземпляр)\счетчик*.  По мере ввода вы увидите соответствующий список распространенных счетчиков.  Выберите счетчик из списка или введите собственный.  
2. Щелкните **+** или нажмите клавишу **ВВОД**, чтобы добавить счетчик к списку других счетчиков для объекта.
3. Для всех счетчиков объекта используется один и тот же **интервал выборки**.  По умолчанию это 10 секунд.  Вы можете увеличить значение интервала вплоть до 1800 секунд (30 минут), что позволит снизить для хранилища требования к собираемым данным о производительности.
4. Закончив добавление счетчиков, нажмите кнопку **Сохранить** в верхней части экрана, чтобы сохранить конфигурацию.

## <a name="data-collection"></a>Сбор данных

Служба Log Analytics будет собирать данные со всех указанных счетчиков производительности с заданным для них интервалом выборки во всех агентах, в которых установлен счетчик.  Данные не агрегируются. Необработанные данные доступны во всех представлениях поиска по журналам в течение времени, определенного подпиской OMS.


## <a name="performance-record-properties"></a>Свойства записи о производительности

Записи о производительности имеют тип **Perf** и свойства, описанные в приведенной ниже таблице.

| Свойство | Описание |
|:--|:--|
| Компьютер         | Компьютер, с которого было получено событие. |
| CounterName      | Имя счетчика производительности. |
| CounterPath      | Полный путь к счетчику в формате \\\\\<компьютер>\\объект(экземпляр)\\счетчик. |
| CounterValue     | Числовое значение счетчика.  |
| InstanceName     | Имя экземпляра события.  Если экземпляра нет, используется пустое значение. |
| ObjectName       | Имя объекта производительности. |
| SourceSystem  | Тип агента, из которого были получены данные. <br> OpsManager — агент Windows, подключенный напрямую или через SCOM <br> Linux — все агенты Linux  <br>  AzureStorage – диагностика Azure |
| TimeGenerated       | Дата и время выборки данных. |


## <a name="sizing-estimates"></a>Оценки размера

 Сбор данных для одного счетчика с 10-секундным интервалом генерирует около 1 МБ данных в день на каждый экземпляр.  Оценить требования конкретного счетчика к объему памяти можно по указанной ниже формуле.

    1 MB x (number of counters) x (number of agents) x (number of instances)

## <a name="log-searches-with-performance-records"></a>Поиск по журналам с записями о производительности

Ниже приведены различные примеры запросов поиска по журналу, которые извлекают записи о производительности.

| Запрос | Описание |
|:--|:--|
| Type=Perf | Все данные о производительности. |
| Type=Perf Computer="MyComputer" | Все данные о производительности с определенного компьютера |
| Type=Perf CounterName="Current Disk Queue Length" | Все данные о производительности с определенного счетчика |
| Type=Perf (ObjectName=Processor) CounterName="% Processor Time" InstanceName=_Total &#124; measure Avg(Average) as AVGCPU by Computer | Средний объем использования ЦП на всех компьютерах |
| Type=Perf (CounterName="% Processor Time") &#124; measure max(Max) by Computer | Максимальный объем использования ЦП на всех компьютерах |
| Type=Perf ObjectName=LogicalDisk CounterName="Current Disk Queue Length" Computer="MyComputerName" &#124; measure Avg(Average) by InstanceName | Средняя длина текущей дисковой очереди по всем экземплярам заданного компьютера |
| Type=Perf CounterName="DiskTransfers/sec" &#124; measure percentile95(Average) by Computer | 95-й процентиль для обращений к диску/с на всех компьютерах |
| Type=Perf CounterName="% Processor Time" InstanceName="_Total" &#124; measure avg(CounterValue) by Computer Interval 1HOUR | Средняя почасовая нагрузка на ЦП по всем компьютерам |
| Type=Perf Computer="MyComputer" CounterName=%* InstanceName=_Total &#124; measure percentile70(CounterValue) by CounterName Interval 1HOUR | Почасовые 70-е процентили по каждому процентному счетчику для конкретного компьютера |
| Type=Perf CounterName="% Processor Time" InstanceName="_Total" (Computer="MyComputer") &#124; measure min(CounterValue), avg(CounterValue), percentile75(CounterValue), max(CounterValue) by Computer Interval 1HOUR | Почасовые средние, минимальные, максимальные значения и 75-е процентили по загрузке ЦП для конкретного компьютера |

## <a name="viewing-performance-data"></a>Просмотр данных о производительности

При выполнении поиска данных о производительности по журналам, по умолчанию отображается представление **Журнал** .  Чтобы представить данные в графической форме, щелкните **Метрики**.  Чтобы получить подробное графическое представление, щелкните **+** рядом со счетчиком.  

![Свернутое представление метрик](media/log-analytics-data-sources-performance-counters/metricscollapsed.png)

Если выбранный диапазон времени составляет шесть часов или меньше, диаграмма обновляется каждые несколько секунд.  Данные на текущий момент отображаются в правой части диаграммы светло-синим цветом.

![Развернутое представление метрик с динамическими данными](media/log-analytics-data-sources-performance-counters/metricsexpanded.png)

Статистическая обработка данных производительности при поиске по журналам описана в записи блога [On-demand metric aggregation and visualization in OMS](http://blogs.technet.microsoft.com/msoms/2016/02/26/on-demand-metric-aggregation-and-visualization-in-oms/) (Статистическая обработка и визуализация по запросу для метрик в OMS).

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте больше об [операциях поиска по журналу](log-analytics-log-searches.md) , которые можно применять для анализа данных, собираемых из источников данных и решений.  
- Экспортируйте собранные данные в [Power BI](log-analytics-powerbi.md) для дополнительной визуализации и анализа.


<!--HONumber=Oct16_HO2-->


