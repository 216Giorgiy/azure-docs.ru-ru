<properties 
   pageTitle="Счетчики производительности Windows и Linux в службе Log Analytics | Microsoft Azure"
   description="Счетчики производительности собираются службой Log Analytics для анализа производительности в агентах Windows и Linux. В этой статье описывается настройка коллекции счетчиков производительности для агентов Windows и Linux, сведения об этих счетчиках, которые хранятся в репозитории OMS, и их анализ на портале OMS."
   services="log-analytics"
   documentationCenter=""
   authors="bwren"
   manager="jwhit"
   editor="tysonn" />
<tags 
   ms.service="log-analytics"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="04/28/2016"
   ms.author="bwren" />

# Источники данных о производительности Windows и Linux в Log Analytics 

Счетчики производительности в Windows и Linux позволяют получить представление о производительности компонентов оборудования, операционных систем и приложений. Log Analytics может собирать счетчики производительности с высокой частотой для анализа данных практически в режиме реального времени, а также данные о производительности для более долгосрочного анализа и формирования отчетов.

![Счетчики производительности](media/log-analytics-data-sources-performance-counters/overview.png)

## Настройка счетчиков производительности

Счетчики производительности настраиваются в меню ["Данные" раздела "Параметры" Log Analytics](log-analytics-data-sources.md/configuring-data-sources).

При первой настройке счетчиков производительности Windows или Linux для новой рабочей области OMS пользователь может быстро создавать сразу несколько распространенных счетчиков. В списке счетчиков рядом с каждым будет флажок. Отметьте все счетчики, которые нужно создать изначально, и щелкните ссылку **Добавить выбранные счетчики производительности**.

![Настройка счетчиков производительности Windows](media/log-analytics-data-sources-performance-counters/configure-windows.png)

Чтобы добавить новый счетчик производительности Windows для сбора данных, выполните описанные ниже действия.

1. Введите имя счетчика в текстовое поле в формате *объект(экземпляра)/счетчик*. По мере ввода система предложит вам соответствующий список распространенных счетчиков. Выберите счетчик из списка или введите собственный. Кроме того, вы можете получить все экземпляры определенного счетчика, указав *объект/счетчик*. 
2. Щелкните **+** или нажмите клавишу **ВВОД**, чтобы добавить счетчик в список.
3. При добавлении счетчика **интервал выборки** по умолчанию составит 10 секунд. Вы можете увеличить это значение до 1800 секунд (30 минут), уменьшив таким образом объем собираемых данных по производительности.
4. Закончив добавление счетчиков, нажмите кнопку **Сохранить** в верхней части экрана, чтобы сохранить конфигурацию.

![Настройка счетчиков производительности Linux](media/log-analytics-data-sources-performance-counters/configure-linux.png)

Чтобы добавить новый счетчик производительности Linux для сбора данных, выполните описанные ниже действия.

1. По умолчанию все изменения конфигурации автоматически отправляются во все агенты. Файл конфигурации агентов Linux отправляется в сборщик данных Fluentd. Если вы хотите изменить этот файл вручную в каждом агенте Linux, снимите флажок *Apply below configuration to my Linux machines* (Применить конфигурацию ниже к моим компьютерам Linux).
2. Введите имя счетчика в текстовое поле в формате *объект(экземпляра)/счетчик*. По мере ввода система предложит вам соответствующий список распространенных счетчиков. Выберите счетчик из списка или введите собственный.  
2. Щелкните **+** или нажмите клавишу **ВВОД**, чтобы добавить счетчик к списку других счетчиков для объекта.
3. Во всех счетчиках объекта будет использовать один и тот же **интервал выборки**. По умолчанию он составляет 10 секунд, но это значение можно увеличить до 1800 секунд (30 минут), уменьшив таким образом объем собираемых данных по производительности.
4. Закончив добавление счетчиков, нажмите кнопку **Сохранить** в верхней части экрана, чтобы сохранить конфигурацию.

## Сбор данных

Служба Log Analytics будет собирать данные со всех указанных счетчиков производительности с заданным для них интервалом выборки во всех агентах, в которых установлен счетчик. Необработанные данные будут доступны в развернутом графическом представлении в консоли OMS в течение 14 дней.

Все собранные данные о производительности суммируются каждые 30 минут. Агрегированные данные доступны во всех представлениях поиска по журналам в течение времени, указанного в подписке OMS.


## Свойства записи о производительности

Записи о производительности создаются на основе данных о производительности, которые суммируются каждые 30 минут. Записывается среднее значение счетчика за предыдущие 30 минут. Для необработанных данных, записываемых практически в режиме реального времени, записи не создаются. Необработанные данные доступны только в представлении **Метрики** консоли OMS.

Записи о производительности имеют тип **Perf** и свойства, описанные в приведенной ниже таблице.

| Свойство | Описание |
|:--|:--|
| Компьютер | Компьютер, с которого было получено событие. |
| CounterName | Имя счетчика производительности. |
| CounterPath | Полный путь к счетчику в формате \\\<компьютер>\\объект(экземпляр)\\счетчик. |
| CounterValue | Числовое значение счетчика за период более 30 минут. |
| InstanceName | Имя экземпляра события. Если экземпляра нет, используется пустое значение. |
| ObjectName | Имя объекта производительности. |
| SourceSystem | Тип агента, из которого были получены данные. <br> OpsManager — агент Windows, подключенный напрямую или через SCOM <br> Linux — все агенты Linux <br> AzureStorage — диагностика Azure |
| TimeGenerated | Дата и время выборки данных. |


## Оценки размера

 Коллекция определенного счетчика с 10-секундным интервалом занимает около 1 МБ в день на экземпляр. Оценить требования конкретного счетчика к объему памяти можно по указанной ниже формуле.

	1 MB x (number of counters) x (number of agents) x (number of instances)

## Поиск по журналам с записями о производительности

Ниже приведены различные примеры запросов поиска по журналу, которые извлекают записи о производительности.

| Запрос | Описание |
|:--|:--|
| Type=Perf | Все данные о производительности. |
| Type=Perf Computer="MyComputer" | Все данные о производительности с определенного компьютера |
| Type=Perf CounterName="Current Disk Queue Length" | Все данные о производительности с определенного счетчика |
| Type=Perf (ObjectName=Processor) CounterName="% Processor Time" InstanceName=\_Total | measure Avg(Average) as AVGCPU by Computer | Средний объем использования ЦП на всех компьютерах |
| Type=Perf (CounterName="% Processor Time") | measure max(Max) by Computer | Максимальный объем использования ЦП на всех компьютерах |
| Type=Perf ObjectName=LogicalDisk CounterName="Current Disk Queue Length" Computer="MyComputerName" | measure Avg(Average) by InstanceName | Средняя длина текущей дисковой очереди по всем экземплярам заданного компьютера |
| Type=Perf CounterName="DiskTransfers/sec" | measure percentile95(Average) by Computer | 95-й процентиль для обращений к диску/с на всех компьютерах |
| Type=Perf CounterName="% Processor Time" InstanceName="\_Total" | measure avg(CounterValue) by Computer Interval 1HOUR | Средний почасовой объем использования ЦП на всех компьютерах |
| Type=Perf Computer="MyComputer" CounterName=%* InstanceName=\_Total | measure percentile70(CounterValue) by CounterName Interval 1HOUR | Почасовой 70-й процентиль процентного счетчика на заданном компьютере |
| Type=Perf CounterName="% Processor Time" InstanceName="\_Total" (Computer="MyComputer") | measure min(CounterValue), avg(CounterValue), percentile75(CounterValue), max(CounterValue) by Computer Interval 1HOUR | Средний почасовой, минимальный, максимальный и 75-процентильный объем использования ЦП на заданном компьютере |

## Просмотр данных о производительности

При выполнении поиска данных о производительности по журналам, по умолчанию отображается представление **Журнал**. Оно содержит сводные записи о производительности. Чтобы представить данные в графической форме, щелкните **Метрики**. Щелкните **+** рядом со счетчиком, который нужно просмотреть.

![Свернутое представление метрик](media/log-analytics-data-sources-performance-counters/metricscollapsed.png)


Если выбранный диапазон времени составляет шесть часов или меньше, диаграмма демонстрирует данные практически в режиме реального времени и обновляется каждые несколько секунд. Реальные данные будут отображаться в правой части диаграммы светло-синим цветом. Если период времени превышает шесть часов, в диаграмме используются совокупные данные.

![Развернутое представление метрик с динамическими данными](media/log-analytics-data-sources-performance-counters/metricsexpanded.png)

## Дальнейшие действия

- Узнайте больше об [операциях поиска по журналу](log-analytics-log-searches.md), которые можно применять для анализа данных, собираемых из источников данных и решений.  
- Экспортируйте собранные данные в [Power BI](log-analytics-powerbi.md) для дополнительной визуализации и анализа.

<!----HONumber=AcomDC_0504_2016-->