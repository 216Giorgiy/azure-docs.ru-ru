---
title: Руководство по хранению персональных данных в Azure Log Analytics | Документация Майкрософт
description: В этой статье описывается управление персональными данными, которые хранятся в Azure Log Analytics, и методы обнаружения и удаления таких данных.
services: log-analytics
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 05/18/2018
ms.author: magoedte
ms.component: na
ms.openlocfilehash: 3692c83a4991fc67ec176687bd076ab14e4c640d
ms.sourcegitcommit: 5892c4e1fe65282929230abadf617c0be8953fd9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/29/2018
ms.locfileid: "37129376"
---
# <a name="guidance-for-personal-data-stored-in-log-analytics"></a>Руководство по хранению персональных данных в Log Analytics

Хранилище данных Log Analytics может содержать персональные данные. В этой статье описано, где в Log Analytics такие данные встречаются чаще всего, а также перечислены доступные возможности для обработки этих данных.

[!INCLUDE [gdpr-dsr-and-stp-note](../../includes/gdpr-dsr-and-stp-note.md)]

## <a name="strategy-for-personal-data-handling"></a>Стратегия обработки персональных данных

В конечном счете стратегия обработки персональных данных определяется вами и вашей компанией (если она нужна). Мы здесь лишь предлагаем некоторые из возможных подходов. Варианты перечислены в порядке убывания предпочтительности с технической точки зрения.

* Везде, где возможно, старайтесь не собирать данные, маскируйте их, анонимизируйте или изменяйте другим способом так, чтобы они перестали считаться "персональными". _На данный момент_ этот метод является наиболее предпочтительным, и он позволит вам обойтись без разработки дорогостоящей и влияющей на всю работу стратегии обработки данных.
* Если это совершенно невозможно, попробуйте нормализовать данные, чтобы снизить нагрузку на платформу данных и производительность. Например, можно не сохранять идентификатор пользователя в явном виде, а создать уточняющий запрос к данным, который будет сопоставлять имя пользователя и сведения о нем с внутренним идентификатором, который сохраняется в другом месте. При такой схеме вам будет достаточно удалить одну строку в таблице сопоставления, если пользователь потребует удалить его персональные данные. 
* И наконец, если совершенно необходимо собирать личные данные, основывайте этот процесс на API для очистки и существующем пути через API запросов, чтобы соблюдать любые требования к экспорту и удалению персональных данных, связанных с пользователем. 

## <a name="where-to-look-for-private-data-in-log-analytics"></a>Где искать персональные данные в Log Analytics?

Log Analytics — это масштабируемое хранилище, описывающее схему для ваших данных и позволяющее переопределить каждое поле пользовательскими значениями. Кроме того, может быть принята любая пользовательская схема. Таким образом, невозможно точно определить, где размещаются персональные данные в конкретном рабочем пространстве. Но есть несколько типичных расположений, с которых есть смысл начинать поиск.

* *IP-адреса*. Служба Log Analytics собирает разнообразные сведения об IP по большому числу таблиц. Например, следующий запрос показывает все таблицы, в которых адреса IPv4 были собраны за последние 24 часа:
    ```
    search * 
    | where * matches regex @'\b((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}\b' //RegEx originally provided on https://stackoverflow.com/questions/5284147/validating-ipv4-addresses-with-regexp
    | summarize count() by $table
    ```
* *Идентификаторы пользователей*. Идентификаторы пользователей находятся в большом количестве решений и таблиц. Вы можете найти конкретное имя пользователя по всему набору данных, используя команду поиска:
    ```
    search "[username goes here]"
    ```
Не забудьте взглянуть не только на понятные имена пользователей, но и на идентификаторы GUID, по которым можно напрямую отследить конкретного пользователя.
* *Идентификаторы устройств*. Как и идентификаторы пользователей, идентификаторы устройств иногда считаются "частными". Используйте тот же подход, который указан выше, для идентификаторов пользователей, чтобы идентифицировать таблицы, там где это может потребоваться. 
* *Пользовательские данные*. Log Analytics позволяет собирать данные различным образом: пользовательские журналы и настраиваемые поля, [API-интерфейс сборщика данных HTTP](log-analytics-data-collector-api.md) и пользовательские данные, собранные как часть журналов системных событий. Все они восприимчивы к содержанию частных данных и должны быть просмотрены, чтобы проверить, существуют ли такие данные.
* *Данные, взятые из решения*. Поскольку механизм решения является открытым, мы рекомендуем просмотреть все таблицы, созданные решениями, чтобы обеспечить соответствие.

## <a name="how-to-export-and-delete-private-data"></a>Экспорт и удаление персональных данных

Как уже упоминалось в стратегии [сбора и обработки персональных данных](#strategy-for-personal-data-handling) ранее, __настоятельно рекомендуется__ пересмотреть политику сбора данных таким образом, чтобы сбор персональных данных не выполнялся, а также маскировать, анонимизировать или иным образом изменять собираемые данные, чтобы они перестали считаться персональными. Обработка данных прежде всего потребует от вас и ваших сотрудников дополнительных затрат на создание и автоматизацию стратегии, на создание клиентского интерфейса для взаимодействия с персональными данными, а также на текущее обслуживание. Кроме того, такие вычисления существенно увеличат нагрузку на Log Analytics, а большое количество одновременных запросов и (или) вызовов API очистки может отрицательно повлиять на работу со всеми остальными функциями Log Analytics. Но при этом мы понимаем, что в некоторых сценариях сбора персональных данных избежать невозможно. В таких случаях следует обрабатывать эти данные так, как описано в этом разделе.

[!INCLUDE [gdpr-intro-sentence](../../includes/gdpr-intro-sentence.md)]

### <a name="view-and-export"></a>Просмотр и экспорт

Для всех запросов просмотра и экспорта данных следует использовать [API запросов](https://dev.loganalytics.io/). Вам необходимо самостоятельно создать логику преобразования данных в требуемый вид для предоставления пользователям. [Функции Azure](https://azure.microsoft.com/services/functions/) отлично подходят для размещения такой логики.

### <a name="delete"></a>Delete

> [!WARNING]
> Операции удаления в Log Analytics являются разрушительными и необратимыми! Соблюдайте особую осторожность при их выполнении.

Для сценариев обработки конфиденциальных данных мы включили в API путь *очистки*. Этот путь следует применять ограниченно, поскольку с ним связаны определенные риски, потенциальное влияние на производительность и результаты обобщающих вычислений и измерений, а также на другие аспекты использования Log Analytics. Выше в разделе [Стратегия обработки персональных данных](#strategy-for-personal-data-handling) представлены другие подходы к обработке персональных данных.

Операция очистки имеет настолько высокий уровень привилегий, что ни одно приложение или пользователь Azure (даже владелец ресурса) не смогут ее выполнять без явно предоставленной роли в Azure Resource Manager. Соответствующая роль именуется _Data Purger_ (Очистка данных). Ее следует назначать осторожно в силу возможных потерь данных. 

Назначение роли в Azure Resource Manager открывает два новых пути API. 

* [POST purge] (https://docs.microsoft.com/rest/api/loganalytics/workspaces%202015-03-20/purge) — принимает объект с параметрами удаляемых данных и возвращает идентификатор GUID. 
* GET purge status — вызов POST purge возвращает заголовок x-ms-status-location со значением URL-адреса, вызов которого позволяет определить состояние API очистки. Например: 

    ```
    x-ms-status-location: https://management.azure.com/subscriptions/[SubscriptionId]/resourceGroups/[ResourceGroupName]/providers/Microsoft.OperatonalInsights/workspaces/[WorkspaceName]/operations/purge-[PurgeOperationId]?api-version=2015-03-20
    ```

Хотя ожидается, что большинство операций очистки будут выполняться намного быстрее, чем указано в соглашениях об уровне обслуживания, из-за грандиозного влияния таких операций на платформу данных Log Analytics в соглашения об уровне обслуживания включается период 30 дней на завершение операций очистки. 

## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения о сборе, обработке и защите данных можно найти в статье [о безопасности данных в Log Analytics](log-analytics-data-security.md).