---
title: "Отслеживание изменений с помощью Azure Log Analytics | Документация Майкрософт"
description: "Решение для отслеживания изменений в Log Analytics помогает выявлять изменения программного обеспечения и служб Windows в среде."
services: log-analytics
documentationcenter: 
author: bandersmsft
manager: carmonm
editor: 
ms.assetid: f8040d5d-3c89-4f0c-8520-751c00251cb7
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/11/2017
ms.author: banders
ms.custom: H1Hack27Feb2017
translationtype: Human Translation
ms.sourcegitcommit: 785d3a8920d48e11e80048665e9866f16c514cf7
ms.openlocfilehash: a3d958e1a37ddf6821d41afe7427faec1b8259b2
ms.lasthandoff: 04/12/2017


---
# <a name="track-software-changes-in-your-environment-with-the-change-tracking-solution"></a>Отслеживание изменений программного обеспечения в среде с помощью решения для отслеживания изменений

В этой статье приведены сведения о настройке в Log Analytics решения Change Tracking, позволяющего легко обнаруживать изменения в своей среде. Это решение отслеживает изменения в программном обеспечении Windows и Linux, файлах Windows и разделах реестра, службах Windows и управляющих программах Linux, что, в свою очередь, позволяет точно определять проблемы с работоспособностью.

Решение устанавливается для обновления установленного типа агента. На наблюдаемых серверах выполняется считывание информации об изменениях установленного ПО, служб Windows и управляющих программ Linux, после чего данные отправляются в службу Log Analytics в облаке для обработки. К полученным данным применяется логика и облачная служба записывает данные. С помощью сведений на панели мониторинга «Отслеживание изменений» можно без труда обнаружить изменения, внесенные в инфраструктуру серверов.

## <a name="installing-and-configuring-the-solution"></a>Установка и настройка решения
Для установки и настройки решений используйте указанные ниже данные.

* Агент [Windows](log-analytics-windows-agents.md) [Operations Manager](log-analytics-om-agents.md) или [Linux](log-analytics-linux-agents.md) должен быть установлен на каждом компьютере, для которого требуется выполнять отслеживание изменений.
* Решение для отслеживания изменений необходимо добавить в рабочую область OMS из [Azure Мarketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.ChangeTrackingOMS?tab=Overview) или в соответствии с инструкциями по [добавлению решений Log Analytics из коллекции решений](log-analytics-add-solutions.md).  Дополнительная настройка не требуется.

### <a name="configure-windows-files-to-track"></a>Настройка отслеживания файлов Windows
Чтобы настроить отслеживание изменений в файлах на компьютере Windows, сделайте следующее:

1. На портале OMS щелкните **Параметры** (значок с шестеренкой).
2. На странице **Параметры** щелкните **Данные**, а затем выберите **Отслеживание файлов Windows**.
3. В поле "Отслеживание изменений в файлах Windows" введите полный путь, в том числе имя файла, который необходимо отслеживать, а затем щелкните символ **Добавить**. Например, C:\Program Files (x86)\Internet Explorer\iexplore.exe или C:\Windows\System32\drivers\etc\hosts.
4. Щелкните **Сохранить**.  
   ![Отслеживание изменений в файлах Windows](./media/log-analytics-change-tracking/windows-file-change-tracking.png)

### <a name="configure-windows-registry-keys-to-track"></a>Настройка отслеживания разделов реестра Windows
Чтобы настроить разделы реестра для отслеживания на компьютерах с Windows, сделайте следующее:

1. На портале OMS щелкните **Параметры** (значок с шестеренкой).
2. На странице **Параметры** щелкните **Данные**, а затем выберите **Отслеживание реестра Windows**.
3. В поле отслеживания изменений в реестре Windows введите полный раздел, который вы хотите отследить, а затем щелкните знак **добавления**.
4. Щелкните **Сохранить**.  
   ![Отслеживание изменений в реестре Windows](./media/log-analytics-change-tracking/windows-registry-change-tracking.png)

### <a name="limitations"></a>Ограничения
В настоящее время решение для отслеживания изменений не поддерживает следующее:

* папки (каталоги);
* рекурсию;
* подстановочные знаки;
* переменные пути;
* сетевые файловые системы.

Другие ограничения:

* в текущей версии столбец и значения **Максимальный размер файла** не используются;
* при сборе более 2500 файлов в течение тридцатиминутного цикла производительность решения может снизиться;
* при интенсивном сетевом трафике изменение записей может занять до 6 часов;
* если изменение конфигурации выполняется на отключенном компьютере, в файлы могут быть внесены изменения, относящиеся к предыдущей конфигурации.

## <a name="change-tracking-data-collection-details"></a>Сведения о сборе данных отслеживания изменений.
Отслеживание изменений собирает данные инвентаризации программного обеспечения и метаданные службы Windows с помощью включенных агентов.

В следующей таблице приведены методы сбора данных и другие сведения о сборе данных для решения "Отслеживание изменений".

| платформа | Direct Agent | Агент SCOM | Агент Linux | Хранилище Azure | Нужен ли SCOM? | Отправка данных агента SCOM через группу управления | частота сбора |
| --- | --- | --- | --- | --- | --- | --- | --- |
| Windows и Linux |![Да](./media/log-analytics-change-tracking/oms-bullet-green.png) |![Да](./media/log-analytics-change-tracking/oms-bullet-green.png) |![Да](./media/log-analytics-change-tracking/oms-bullet-green.png) |![Нет](./media/log-analytics-change-tracking/oms-bullet-red.png) |![Нет](./media/log-analytics-change-tracking/oms-bullet-red.png) |![Да](./media/log-analytics-change-tracking/oms-bullet-green.png) | От 5 до 50 минут с учетом типа изменения. Дополнительную информацию см. ниже. |


В следующей таблице указана частота сбора данных для типов изменений.

| **тип изменения** | **frequency** | **Отправляет** **ли** **агент сведения об обнаруженных изменениях?** |
| --- | --- | --- |
| Реестр Windows | 50 минут | Нет |
| Файловый ресурс Windows | 30 минут | Да. Если изменения не происходят в течение 24 часов, отправляется моментальный снимок. |
| Файловый ресурс Linux | 15 минут | Да. Если изменения не происходят в течение 24 часов, отправляется моментальный снимок. |
| Службы Windows | 30 минут | Да, каждые 30 минут, при обнаружении изменений. Каждые 24 часа отправляется моментальный снимок независимо от изменений. Следовательно, моментальный снимок отправляется даже при отсутствии изменений. |
| Управляющие программы Linux | 5 мин | Да. Если изменения не происходят в течение 24 часов, отправляется моментальный снимок. |
| Программное обеспечение Windows | 30 минут | Да, каждые 30 минут, при обнаружении изменений. Каждые 24 часа отправляется моментальный снимок независимо от изменений. Следовательно, моментальный снимок отправляется даже при отсутствии изменений. |
| Программное обеспечение Linux | 5 мин | Да. Если изменения не происходят в течение 24 часов, отправляется моментальный снимок. |

### <a name="registry-key-change-tracking"></a>Отслеживание изменений в разделах реестра

Log Analytics выполняет отслеживание реестра Windows и отслеживание с помощью решения для отслеживания изменений. Целью отслеживания изменений в разделах реестра является точное определение точек расширения, в которых может быть активирован сторонний код или вредоносная программа. В списке ниже приведены разделы реестра по умолчанию, отслеживаемые решением, и причины их отслеживания.

- HKEY\_LOCAL\_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup
    - Отслеживаются сценарии, выполняемые при запуске.
- HKEY\_LOCAL\_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown
    - Отслеживаются сценарии, выполняемые при завершении работы.
- HKEY\_LOCAL\_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Run
    - Отслеживаются разделы, загружаемые перед входом пользователя в учетную запись Windows, для 32-битных программ, выполняющихся на 64-разрядных компьютерах.
- HKEY\_LOCAL\_MACHINE\SOFTWARE\Microsoft\Active Setup\Installed Components
    - Отслеживаются изменения параметров приложения.
- HKEY\_LOCAL\_MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers
    - Отслеживаются общие записи автозапуска, привязывающиеся непосредственно к проводнику Windows и выполняющиеся с внутрипроцессным файлом Explorer.exe.
- HKEY\_LOCAL\_MACHINE\Software\Classes\Directory\Shellex\CopyHookHandlers
    - Отслеживаются общие записи автозапуска, привязывающиеся непосредственно к проводнику Windows и выполняющиеся с внутрипроцессным файлом Explorer.exe.
- HKEY\_LOCAL\_MACHINE\Software\Classes\Directory\Background\ShellEx\ContextMenuHandlers
    - Отслеживаются общие записи автозапуска, привязывающиеся непосредственно к проводнику Windows и выполняющиеся с внутрипроцессным файлом Explorer.exe.
- HKEY\_LOCAL\_MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers
    - Отслеживается регистрация обработчика дополнительных значков.
- HKEY\_LOCAL\_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers
    - Отслеживается регистрация обработчика дополнительных значков для 32-битных программ, работающих на 64-разрядных компьютерах.
- HKEY\_LOCAL\_MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects
    - Отслеживаются новые подключаемые модули вспомогательных объектов браузера для Internet Explorer, которые могут использоваться для получения доступа к модели DOM текущей страницы и управления навигацией.
- HKEY\_LOCAL\_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects
    - Отслеживаются новые подключаемые модули вспомогательных объектов браузера для Internet Explorer, которые могут использоваться для получения доступа к модели DOM текущей страницы и управления навигацией для 32-битных программ, работающих на 64-разрядных компьютерах.
- HKEY\_LOCAL\_MACHINE\Software\Microsoft\Internet Explorer\Extensions
    - Отслеживаются новые расширения Internet Explorer, например пользовательские меню инструментов и пользовательские кнопки панели инструментов.
- HKEY\_LOCAL\_MACHINE\Software\Wow6432Node\Microsoft\Internet Explorer\Extensions
    - Отслеживаются новые расширения Internet Explorer, например пользовательские меню инструментов и пользовательские кнопки панели инструментов для 32-битных программ, работающих на 64-разрядных компьютерах.
- HKEY\_LOCAL\_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Drivers32
    - Отслеживаются 32-битные драйверы, связанные с устройствами wavemapper — wave1 и wave2, msacm.imaadpcm, .msadpcm, .msgsm610 и vidc. Ознакомьтесь с разделом о [драйверах] в файле SYSTEM.INI.
- HKEY\_LOCAL\_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Drivers32
    - Отслеживаются 32-битные драйверы, связанные с устройствами wavemapper — wave1 и wave2, msacm.imaadpcm, .msadpcm, .msgsm610 и vidc для 32-битных программ, работающих на 64-разрядных компьютерах. Ознакомьтесь с разделом о [драйверах] в файле SYSTEM.INI.
- HKEY\_LOCAL\_MACHINE\System\CurrentControlSet\Control\Session Manager\KnownDlls
    - Отслеживается список известных или часто используемых системных библиотек DLL. Эта система предотвращает использование ненадежных разрешений каталога приложений за счет удаления версий вредоносной программы типа "Троянский конь" системных библиотек DLL.
- HKEY\_LOCAL\_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify
    - Отслеживается список пакетов, получающих уведомления о событиях из Winlogon — интерактивной модели поддержки входа в систему для операционной системы Windows.


## <a name="use-change-tracking"></a>Использование функции отслеживания изменений
После установки решения сводку изменений для отслеживаемых серверов можно просмотреть в OMS на странице **Обзор** с помощью плитки **Отслеживание изменений**.

![image of Change Tracking tile](./media/log-analytics-change-tracking/change-tracking-tile.png)

Можно просмотреть изменения инфраструктуры, а затем более подробно рассмотреть следующие категории:

* изменения по типу конфигурации для ПО и служб Windows;
* изменения ПО для приложений и обновлений для отдельных серверов;
* общее количество изменений ПО для каждого приложения;
* Пакеты Linux
* изменения служб Windows для отдельных серверов.
* Изменения в управляющих программах Linux

![image of Change Tracking dashboard](./media/log-analytics-change-tracking/change-tracking-dash01.png)

![image of Change Tracking dashboard](./media/log-analytics-change-tracking/change-tracking-dash02.png)

### <a name="to-view-changes-for-any-change-type"></a>Просмотр изменений для любого типа изменений
1. На странице **Обзор** щелкните плитку **Отслеживание изменений**.
2. На панели мониторинга **Отслеживание изменений** просмотрите сводные данные в одной из колонок типов изменений, а затем щелкните одну из них, чтобы просмотреть подробные сведения на странице **поиска журналов**.
3. На любой из страниц поиска журналов можно просмотреть результаты по времени, подробные результаты и историю поиска журналов. Для сужения области результатов выполните фильтрацию по аспектам.

## <a name="next-steps"></a>Дальнейшие действия
* Используйте [Поиск по журналам в Log Analytics](log-analytics-log-searches.md) для просмотра подробных данных по отслеживанию изменений.

