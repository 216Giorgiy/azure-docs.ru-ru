<properties title="Operating System Functionality Available to Applications on Azure Websites" pageTitle="Функциональные возможности операционной системы, доступные приложениям на веб-сайтах Azure" description="Learn about the OS functionality available to web applications on Azure Websites" metaKeywords="Azure,Web Sites,web applications,operating system functionality" services="web-sites" solutions="web" documentationCenter="" authors="cephalin" manager="wpickett" editor="mollybos" videoId="" scriptId="" />

<tags ms.service="web-sites" ms.workload="web" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="11/11/2014" ms.author="cephalin" />

# Функциональные возможности операционной системы, доступные для приложений на веб-сайтах Azure #

В данной статье описаны общие базовые функции операционной системы, доступные всем приложениям, выполняющимся на веб-сайтах Azure. Данные функциональные возможности включают в себя доступ к файлам, сети и реестру, а также диагностику и журналы событий. 

##Оглавление

* [Режимы веб-сайта](#websitemodes)
* [Платформы разработки](#developmentframeworks)
* [Доступ к файлам](#FileAccess)
	* [Локальные диски](#LocalDrives)
	* [Сетевые диски (общие UNC-ресурсы)](#NetworkDrives)
	* [Доступ к файлам в нескольких экземплярах](#multipleinstances)
	* [Типы доступа к файлам для веб-приложения](#TypesOfFileAccess)
* [Доступ к сети](#NetworkAccess)
* [Выполнение кода, процессы и память](#Code)
* [Журналы диагностики и события](#Diagnostics)
* [Доступ к реестру](#RegistryAccess)

<a id="websitemodes"></a>
<h2>Режимы веб-сайта</h2>
Веб-сайты Azure запускают веб-сайты клиента в мультитенантной среде размещения. Веб-сайты, развернутые в режимах бесплатного (Free) и общего (Shared) масштабирования, запущены в рабочих процессах на общих виртуальных машинах. Веб-сайты, развернутые в стандартном (Standard) режиме масштабирования, запущены на виртуальных машинах, которые выделены специально для веб-сайтов, связанных с одним клиентом.

Поскольку веб-сайты Azure поддерживают беспрепятственное масштабирование между различными режимами, конфигурация безопасности для веб-сайтов остается неизменной. Это позволяет обеспечить отсутствие внезапного изменения режима работы веб-приложений и неожиданных сбоев при переключении веб-сайта с одного режима на другой.

<a id="developmentframeworks"></a>
<h2>Платформы разработки</h2>

Режимы веб-сайта управляют объемом доступных веб-сайтам вычислительных ресурсов (ЦП, место на диске, память и исходящий сетевой трафик). При этом спектр доступных приложениям функциональных возможностей платформы остается неизменным в любом режиме веб-сайта.

Веб-сайты Azure поддерживают широкий спектр платформ разработки, включая ASP.NET, классический ASP, node.js, PHP и python, выполняемых в виде расширений в службах IIS. Чтобы упростить и нормализовать конфигурацию безопасности, веб-сайты Azure обычно используют различные платформы разработки с параметрами по умолчанию. Один из подходов к настройке веб-сайтов Azure мог бы заключаться в настройке контактной зоны API и функциональных возможностей для каждой отдельной платформы разработки. Вместо этого веб-сайты Azure используют более общий подход, реализуя общий базовый уровень функциональных возможностей операционной системы вне зависимости от среды разработки приложений веб-сайта.

В следующих разделах приведены общие виды функциональных возможностей операционной системы, доступных веб-сайтам в Azure.


<a id="FileAccess"></a>
<h2>Доступ к файлам</h2>

На веб-сайтах Azure используются разные диски, включая локальные и сетевые диски.

<a id="LocalDrives"></a>
<h3>Локальные диски</h3>

По своей сути веб-сайты Azure являются службой, выполняемой поверх инфраструктуры Azure PaaS (платформа как услуга). В результате локальные диски, "подключенные" к виртуальной машине, - это те же типы дисков, которые доступны любой рабочей роли в Azure. Сюда входит диск операционной системы (диск D:\), диск приложений, содержащий файлы пакета CSPKG Azure, которые используются исключительно веб-сайтами Azure (и недоступны для клиентов), и "пользовательский" диск (диск C:\), размер которого зависит от размера виртуальной машины.

<a id="NetworkDrives"></a>
<h3>Сетевые диски (общие UNC-ресурсы)</h3>

Одно из уникальных свойств веб-сайтов Azure, позволяющее упростить обслуживание и развертывание веб-приложений, - это возможность хранения всего пользовательского содержимого на наборе общих UNC-ресурсов. Эта модель очень хорошо согласуется с распространенным шаблоном хранилища содержимого, который используется локальными средами размещения веб-сайтов, имеющими несколько серверов с балансировкой нагрузки. 

Внутри веб-сайтов Azure присутствует определенное число общих UNC-ресурсов, созданных в каждом центре обработки данных. Процент пользовательского содержимого для всех клиентов в каждом центре обработки данных выделяется для каждого общего UNC-ресурса. Кроме того, все файловое содержимое для одной клиентской подписки всегда размещается в одном общем UNC-ресурсе. 

Обратите внимание, что из-за особенностей работы облачных служб виртуальная машина, отвечающая за размещение общего UNC-ресурса, будет периодически меняться. Гарантируется, что общие UNC-ресурсы будут подключаться к различным виртуальным машинам во время их включения и отключения в рамках выполнения обычных облачных операций. По этой причине в веб-приложениях никогда не следует жестко программировать предположение о том, что информация о машине в пути UNC со временем будет оставаться неизменной. Вместо этого они должны использовать удобный *ложный* абсолютный путь **D:\home\site**, предоставляемый веб-сайтами Azure. Ложный абсолютный путь предоставляет портативный и независимый от сайтов и пользователей метод указания ссылки на свой сайт. С помощью пути **D:\home\site** можно переносить общие файлы с сайта на сайт без необходимости настраивать новый абсолютный путь для каждой передачи.

<a id="TypesOfFileAccess"></a>
<h3>Типы доступа к файлам для веб-приложения</h3>

В состав подписки каждого клиента входит зарезервированная структура каталогов на определенном общем UNC-ресурсе в центре обработки данных. У клиента может быть несколько веб-сайтов, созданных в определенном центре обработки данных, поэтому все каталоги, относящиеся к одной клиентской подписке, создаются на одном общем UNC-ресурсе. Общий ресурс может содержать каталоги, например для содержимого, журналов ошибок и диагностики, а также более ранних версий веб-сайта, созданных системой управления версиями. Соответственно, каталоги веб-сайта клиента доступны для чтения и записи во время выполнения для кода приложения веб-сайта.

На локальных дисках, подключенных к виртуальной машине, где выполняется веб-сайт, служба веб-сайтов Azure резервирует часть места на диске C:\ под временное локальное хранилище для конкретного веб-сайта. Хотя веб-сайт имеет полный доступ на чтение и запись к собственному временному локальному хранилищу, оно не предназначено для непосредственного использования из кода приложения. Наоборот, цель состоит в том, чтобы предоставить временное хранилище файлов для служб IIS и платформ веб-приложений. Служба веб-сайтов Azure также ограничивает объем временного локального хранилища для каждого веб-сайта, чтобы предотвратить использование чрезмерных объемов памяти отдельными веб-сайтами.

Двумя примерами того, как веб-сайты Azure используют временное локальное хранилище, являются каталог для временных файлов ASP.NET и каталог для сжатых файлов IIS. Система компиляции ASP.NET использует каталог "Temporary ASP.NET Files" в качестве временного расположения кэша компиляции. Службы IIS используют каталог "IIS Temporary Compressed Files" для хранения сжатых выходных данных ответа. Оба эти типа использования файлов (а также и другие) в службе веб-сайтов Azure переназначаются временному локальному хранилищу для конкретных веб-сайтов. Результатом такого переназначения является неизменная работа функциональных возможностей.

Каждый веб-сайт в службе веб-сайтов Azure выполняется как случайное уникальное удостоверение рабочего процесса с низкими привилегиями, называемое удостоверением пула приложений. Подробнее такое удостоверение описано здесь: [http://www.iis.net/learn/manage/configuring-security/application-pool-identities](http://www.iis.net/learn/manage/configuring-security/application-pool-identities). Код приложения использует это удостоверение в целях базового доступа только для чтения к диску операционной системы (диск D:\). Это означает, что код приложения может перечислять стандартные структуры каталогов и считывать стандартные файлы на диске операционной системы. Хотя такой уровень доступа может показаться довольно обширным, те же каталоги и файлы доступны при подготовке рабочей роли в размещенной службе Azure и считывании содержимого диска. 

<a name="multipleinstances"></a>
### Доступ к файлам в нескольких экземплярах

Содержимое сайта находится в домашнем каталоге, и веб-приложения могут осуществлять запись в него. Если веб-сайт выполняется в нескольких экземплярах, домашний каталог используется совместно всеми этими экземплярами, чтобы все они могли просматривать один и тот же каталог. Например, если веб-сайт сохраняет отправленные файлы в домашний каталог, эти файлы сразу же становятся доступны всем экземплярам. 

<a id="NetworkAccess"></a>
<h2>Доступ к сети</h2>
Код приложения может использовать протоколы на базе TCP/IP и UDP для установки исходящих сетевых подключений к доступным из Интернета конечным точкам, предоставляющим внешние службы. Приложения могут использовать эти же протоколы для подключения к службам в Azure, например путем установки HTTPS-подключений к SQL Azure.

Также у приложений есть ограниченная возможность установить одно локальное подключение с замыканием на себя и заставить приложение прослушивать этот локальный сокет замыкания на себя. Эта возможность предназначена главным образом для того, чтобы использовать приложения, прослушивающие локальные сокеты замыкания на себя. Обратите внимание, что приложение каждого клиента обращается к "частному" подключению с замыканием на себя. Приложение "А" не может прослушивать локальный сокет замыкания на себя, созданный приложением "Б".

Именованные каналы также поддерживаются в качестве механизма межпроцессного взаимодействия (IPC) между различными процессами, которые совместно обеспечивают работу веб-сайта. Например, модуль FastCGI IIS использует именованные каналы для координации отдельных процессов, обеспечивающих работу страниц PHP.


<a id="Code"></a>
<h2>Выполнение кода, процессы и память</h2>
Как отмечалось ранее, веб-сайты выполняются внутри рабочих процессов с низкими привилегиями, используя случайное удостоверение пула приложений. Код приложения имеет доступ к области памяти, связанной с рабочим процессом, а также любыми дочерними процессами, которые могут порождаться процессами CGI или другими приложениями. Однако приложения с одного веб-сайта не могут получать доступ к памяти или данным веб-сайта другого клиента, даже если он находится на той же виртуальной машине.

Приложения могут выполнять скрипты или страницы, созданные на базе поддерживаемых платформ разработки веб-приложений. Веб-сайты Azure не настраивают параметры платформ веб-приложений для получения более ограниченных режимов. Например, веб-сайты ASP.NET, выполняемые в службе веб-сайтов Azure, имеют полное доверие в отличие от режима более ограниченного доверия. Платформы приложений, в том числе классические ASP и ASP.NET, могут вызвать внутрипроцессные COM-компоненты (но не внепроцессные COM-компоненты), например ADO (объекты данных ActiveX), зарегистрированные по умолчанию в операционной системе Windows.

Веб-приложения могут создавать и запускать произвольный код. Веб-приложение может создать командную оболочку или запустить скрипт PowerShell. Тем не менее, хотя веб-приложением могут порождаться процессы и произвольный код, исполняемые программы и скрипты по-прежнему требуют прав доступа, назначаемых родительскому пулу приложений. Например, веб-сайт может породить исполняемый файл, который выполняет исходящий вызов HTTP, но тот же самый исполняемый файл не может попытаться отменить привязку IP-адреса виртуальной машины к его сетевой карте. Коду с низким уровнем привилегий разрешено выполнять исходящий сетевой вызов, но для перенастройки параметров сети на виртуальной машине требуются права администратора.


<a id="Diagnostics"></a>
<h2>Журналы диагностики и события</h2>
Сведения журнала являются другим набором данных, к которому пытаются получить доступ некоторые веб-приложения. Типы данных журнала, которые доступны коду, выполняемому в службе веб-сайтов Azure, включают в себя диагностическую информацию и сведения журналов, создаваемые веб-сайтом и легко доступные с веб-сайта. 

Например, журналы HTTP W3C, созданные активным веб-сайтом, доступны либо в каталоге журнала в сетевой папке, созданной для данного веб-сайта, либо в хранилище BLOB-объектов, если клиент настроил ведение журналов W3C в этом хранилище. Последний вариант позволяет собирать больше журналов без риска превышения лимитов хранилища файлов, связанных с сетевой папкой.

Аналогичным образом можно регистрировать диагностическую информацию реального времени из приложений .NET с помощью инфраструктуры трассировки и диагностики .NET, при этом имеется возможность записывать данные трассировки в сетевую папку веб-сайта или в хранилище BLOB-объектов.

Веб-приложениям в Azure недоступны следующие области ведения журналов диагностики и трассировки: события трассировки событий Windows и общие журналы событий Windows (например, журналы событий системы, приложений и безопасности). Поскольку данные трассировки событий Windows могут стать видимыми в рамках всей машины (при использовании подходящих ACL), доступ на чтение и запись к событиям трассировки событий Windows блокируется. Разработчики могут заметить, что вызовы API для чтения и записи событий трассировки событий Windows и общих журналов событий Windows работают, но это вызвано тем, что служба веб-сайтов Azure "подделывает" такие вызовы, чтобы они выглядели успешными. На самом деле код приложения веб-сайта не имеет доступа к этим данным событий.

<a id="RegistryAccess"></a>
<h2>Доступ к реестру</h2>
Приложения имеют доступ только для чтения к большей части реестра на виртуальной машине, где они выполняются. На практике это означает, что разделы реестра, которые предоставляют локальным группам "Пользователи" доступ только для чтения, доступны веб-приложениям. Одной областью реестра, в настоящее время не поддерживающей доступ для чтения или записи, является HKEY\_CURRENT\_USER.

Запись в реестр заблокирована, в том числе доступ к разделам реестра для отдельных пользователей. С точки зрения приложения в облачных средах никогда не следует полагаться на возможность записи в реестр, так как приложения перемещаются между разными виртуальными машинами. Единственным постоянным хранилищем для записи, на которое может полагаться веб-приложение, является структура каталогов содержимого для отдельных веб-сайтов, хранящаяся в общих UNC-ресурсах службы веб-сайтов Azure. 
