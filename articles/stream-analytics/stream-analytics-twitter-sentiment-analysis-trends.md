---
title: "Анализ тональности данных Twitter в режиме реального времени с помощью Stream Analytics | Документация Майкрософт"
description: "Информация об использовании Stream Analytics для анализа тональности данных Twitter в режиме реального времени. Пошаговое руководство с шагами от создания событий до отображения данных на динамической панели мониторинга."
keywords: "анализ тенденций twitter в режиме реального времени, анализ тональности, анализ социальных сетей, пример анализа тенденций"
services: stream-analytics
documentationcenter: 
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 42068691-074b-4c3b-a527-acafa484fda2
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 03/09/2017
ms.author: jeffstok
translationtype: Human Translation
ms.sourcegitcommit: 8a531f70f0d9e173d6ea9fb72b9c997f73c23244
ms.openlocfilehash: 09860b34bf4b1664e8d82af0e049cfd1a2d8defa
ms.lasthandoff: 03/10/2017

---

# <a name="real-time-twitter-sentiment-analysis-in-azure-stream-analytics"></a>Анализ тональности в Twitter в режиме реального времени в Azure Stream Analytics

Узнайте, как обеспечить анализ тональности для аналитики социальных сетей путем переноса событий Twitter в концентратор событий Azure в режиме реального времени. Сначала мы создадим запрос Azure Stream Analytics для анализа данных. Затем мы сохраним результаты для последующего внимательного изучения или воспользуемся панелью мониторинга и [Power BI](https://powerbi.com/) для получения ценной аналитической информации в режиме реального времени.

Инструменты аналитики для социальных сетей помогают организациям определить популярные темы, то есть темы и отношения с большим количеством записей в социальных сетях. Анализ тональности, также называемый *интеллектуальным анализом мнений*, использует инструменты аналитики для социальных сетей, чтобы определить отношение к продукции, идеям и т. д. Хороший пример — анализ тенденций Twitter в режиме реального времени. Модель подписки с использованием хэштегов позволяет ожидать передачи определенных ключевых слов и выполнять анализ тональности веб-канала.

## <a name="scenario-social-media-sentiment-analysis-in-real-time"></a>Сценарий: анализ тональности в социальной сети в режиме реального времени

У организации есть новостной веб-сайт. Она хочет получить конкурентное преимущество, мгновенно предлагая читателям содержимое, которое будет им интересно. Организация выполняет анализ социальных сетей по темам, которые интересуют их читателей, анализируя тональность данных Twitter в режиме реального времени. В частности, чтобы определять наиболее популярные темы в Twitter в режиме реального времени, организации необходимо анализировать количество твитов и тональность по ключевым темам. Поэтому по существу ей необходим модуль анализа тональности для канала в социальных сетях.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure
* Учетная запись Twitter и [маркер доступа OAuth](https://dev.twitter.com/oauth/overview/application-owner-access-tokens)
* Файл [TwitterWPFClient.zip](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TwitterClient/TwitterWPFClient.zip) с сайта GitHub.
* Необязательно: исходный код клиента Twitter с сайта [GitHub](https://aka.ms/azure-stream-analytics-twitterclient)

## <a name="create-an-event-hub-input"></a>Создание входных данных концентратора событий

Пример приложения создает события и передает их в экземпляр концентратора событий (для краткости — в концентратор событий). Для получения данных событий в Stream Analytics рекомендуется использовать концентраторы событий служебной шины. Чтобы узнать больше, ознакомьтесь с документацией по концентратору событий, доступной среди [документации по служебной шине](/azure/service-bus/).

### <a name="use-the-following-steps-to-create-an-event-hub"></a>Чтобы создать концентратор событий, выполните следующие действия.

1. На [портале Azure](https://portal.azure.com) щелкните **Создать** и введите *Event Hubs*, а затем выберите **Event Hubs** в результатах поиска. Затем щелкните **Создать**.
2. Укажите имя концентратора событий и создайте группу ресурсов. Мной указаны `socialtwitter-eh` и `socialtwitter-rg` соответственно. Установите флажок, чтобы закрепить учетную запись на панели мониторинга, и нажмите кнопку **Создать**.
3. После завершения развертывания щелкните концентратор событий и щелкните **Концентраторы событий** в разделе **Сущности**.
4. Нажмите кнопку **+ Event Hub** (+ Концентратор событий), чтобы создать концентратор событий. Еще раз введите имя пользователя (мое — `socialtwitter-eh`) и нажмите кнопку **Создать**.
5. Чтобы предоставить доступ к концентратору событий, необходимо создать политику общего доступа. Выберите концентратор событий и щелкните **Политики общего доступа** в разделе **Параметры**.
6. В разделе **Политики общего доступа** создайте политику с разрешениями **Управление**, щелкнув **+ Добавить**. Введите имя политики, установите флажок **Управление** и нажмите кнопку **Создать**.
7. Щелкните новую политику после ее создания, затем нажмите кнопку "Копировать" для сущности **CONNECTION STRING - PRIMARY KEY**. Данное значение понадобится позже в этом упражнении. Затем вернитесь к панели мониторинга.

![Конечные точки политики общего доступа](./media/stream-analytics-twitter-sentiment-analysis-trends/keysandendpoints.png)

## <a name="configure-and-start-the-twitter-client-application"></a>Настройка и запуск клиентского приложения Twitter

Мы разработали клиентское приложение, которое будет подключаться к Twitter с помощью [API потоковой передачи Twitter](https://dev.twitter.com/streaming/overview) и собирать события Twitter в темах из параметризованного набора. Для присвоения значения тональности каждому твиту используется средство [Sentiment140](http://help.sentiment140.com/) с открытым исходным кодом.

* 0 = негативная тональность
* 2 = нейтральная тональность
* 4 = позитивная тональность

После этого события Twitter отправляются в концентратор событий.  

### <a name="follow-these-steps-to-set-up-the-application"></a>Вот как можно настроить приложение.

1. [Скачайте файл TwitterWPFClient.zip](https://github.com/Azure/azure-stream-analytics/blob/master/Samples/TwitterClient/TwitterWPFClient.zip) и распакуйте его.
2. Запустите приложение `TwitterWPFClient.exe` и введите свои значения ключа и секрета API Twitter, маркера доступа и секрета Twitter, а также укажите сведения о концентраторе событий Azure. Наконец, определите, по каким ключевым словам следует определять тональность. Обратите внимание: если вы указываете несколько слов (через запятую) и хотите, чтобы учитывалось ЛЮБОЕ из них, необходимо переключить элемент управления в положение "Match ANY" (Совпадение с любым словом).

   [Выполните процедуру создания маркера доступа OAuth.](https://dev.twitter.com/oauth/overview/application-owner-access-tokens)  

   Для создания маркера необходимо создать пустое приложение.  

3. Замените значения EventHubConnectionString и EventHubName в файле TwitterWpfClient.exe.config своими строкой подключения и именем концентратора событий. Строка подключения, скопированная ранее, содержит строку подключения и имя концентратора событий, поэтому обязательно разделите их и поместите в соответствующие поля. Например, рассмотрим следующую строку подключения:  
   
   `Endpoint=sb://your.servicebus.windows.net/;SharedAccessKeyName=yourpolicy;SharedAccessKey=yoursharedaccesskey;EntityPath=yourhub`
   
   Файл конфигурации TwitterWpfClient.exe.config должен содержать параметры, как в приведенном ниже примере.
   
   ```
     add key="EventHubConnectionString" value="Endpoint=sb://your.servicebus.windows.net/;SharedAccessKeyName=yourpolicy;SharedAccessKey=yoursharedaccesskey"
     add key="EventHubName" value="yourhub"
   ```
   
   Обратите внимание, что текст "EntityPath=" **отсутствует** в значении EventHubName.
   
   Можно также ввести значения для подключения Twitter к Azure непосредственно в клиенте. Эта же логика применяется в случае, когда не используется текст "EntityPath=".
   
   ![WpfClient](./media/stream-analytics-twitter-sentiment-analysis-trends/wpfclientlines.png)

4. *Необязательно:* измените ключевые слова для поиска.  По умолчанию это приложение выполняет поиск некоторых ключевых слов из игр.  При необходимости можно настроить значения для **twitter_keywords** в файле TwitterWpfClient.exe.config.
5. Запустите TwitterWpfClient.exe и нажмите зеленую кнопку для сбора общественных мнений. Вы увидите события-твиты, значения **CreatedAt**, **Topic** и **SentimentScore** для которых будут отправляться в концентратор событий.

## <a name="create-a-stream-analytics-job"></a>Создание задания Stream Analytics

Теперь, когда у нас есть поток событий твитов из Twitter в режиме реального времени, можно настроить задание Stream Analytics, чтобы анализировать эти события в режиме реального времени.

### <a name="provision-a-stream-analytics-job"></a>Подготовка задания Stream Analytics

На [портале Azure](https://portal.azure.com/) щелкните **Создать**, введите **Stream Analytics** и щелкните отображенный элемент "Stream Analytics". Укажите приведенные ниже значения, после чего щелкните **Создать**.

   * **ИМЯ ЗАДАНИЯ**— введите имя задания.
   * **Группа ресурсов**: выберите созданную ранее в этом упражнении группу ресурсов из списка "Использовать существующую".
   * **Учетная запись хранения**: выберите учетную запись хранения Azure, которую вы хотите использовать для хранения данных отслеживания всех заданий Stream Analytics, запущенных в этом регионе. Можно создать учетную запись хранения или выбрать уже существующую.   

![Новое задание](./media/stream-analytics-twitter-sentiment-analysis-trends/newjob.png)

После создания задания оно откроется на портале Azure.

## <a name="specify-the-job-input"></a>Указание входных данных для задания

В задании Stream Analytics щелкните **Входные данные** в центре области задания в колонке "Топология задания", а затем щелкните **Добавить**. Портал запросит перечисленные ниже сведения. Большая часть значений по умолчанию подойдет, но они определены ниже для справки.
  
   * **Входной псевдоним**: введите понятное имя для входных данных задания, например `TwitterStream`. В дальнейшем это имя будет использоваться в запросе.
   * **Имя концентратора событий**: выберите имя концентратора событий.
   * **Имя политики концентратора событий**: выберите политику для концентратора событий, созданную ранее в этом учебнике.

Нажмите кнопку **Создать** .

## <a name="specify-job-query"></a>Укажите запрос задания

Stream Analytics поддерживает простую декларативную модель запроса для описания преобразований. Дополнительные сведения о языке см. в разделе [Справочник по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx).  Этот учебник поможет создать и проверить несколько запросов по данным Twitter.

Чтобы сравнить количество упоминаний по разным темам, воспользуемся [TumblingWindow](https://msdn.microsoft.com/library/azure/dn835055.aspx). Это позволит получать количество упоминаний по теме каждые&5; секунд.

Откройте запрос в редакторе кода и замените его приведенным ниже кодом, затем нажмите кнопку **Сохранить**.

```
SELECT System.Timestamp as Time, Topic, COUNT(*)
FROM TwitterStream TIMESTAMP BY CreatedAt
GROUP BY TUMBLINGWINDOW(s, 5), Topic
```   

В этом запросе используется ключевое слово **Timestamp By**, позволяющее задать поле метки времени в полезных данных, используемых при вычислении временных распределений. Если это поле не указано, при выполнении операций с окнами будет использоваться время поступления каждого события в концентратор событий.  Дополнительные сведения см. в разделе "Arrival Time Vs Application Time" (Время прибытия и время приложения) [справочника по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx).

Запрос также обращается к временной отметке конца каждого окна с помощью свойства **System.Timestamp**.

![Поле запроса](./media/stream-analytics-twitter-sentiment-analysis-trends/querybox.png)

## <a name="create-output-sink"></a>Создание приемника выходных данных 

Теперь, когда мы определили поток событий, входные данные концентратора событий для приема событий и запрос для выполнения преобразования потока, остался последний этап — определить приемник выходных данных задания.  Мы запишем агрегированные события-твиты из нашего запроса задания в хранилище BLOB-объектов Azure.  Кроме того, в зависимости от потребностей приложения можно передать результаты в базу данных SQL Azure, хранилище таблиц Azure или концентраторы событий.

## <a name="specify-job-output"></a>Укажите выходные данные задания

В задании Stream Analytics щелкните **Выходные данные** в колонке **Топология задания**, а затем щелкните **Добавить**. Затем в области введите или выберите следующие значения.
   
   * **Выходной псевдоним**: введите понятное имя для этих выходных данных задания. В этой демонстрации будет использоваться `Output`.
   * **Приемник**: выберите хранилище BLOB-объектов.
   * **Учетная запись хранения**: выберите "Создать новую учетную запись хранения".
    * **Учетная запись хранения**: введите имя учетной записи хранения (в этом примере — `socialtwitter`).
    * **Контейнер**: введите имя нового контейнера (в этом примере — `socialtwitter`).

Для остальных параметров оставьте значения по умолчанию. Наконец, нажмите кнопку **Создать**.

## <a name="start-the-job"></a>Запустите задание

Входные данные, запрос и выходные данные заданы, и теперь можно запустить задание Stream Analytics.

В области обзора задания просто щелкните **Запуск** в верхней части страницы.

В открывшемся диалоговом окне выберите **Время запуска задания** и нажмите кнопку **Проверить** в нижней части диалогового окна. Состояние задания изменится на **Запуск**, а затем — на **Выполняется**.

![Выполнение задания](./media/stream-analytics-twitter-sentiment-analysis-trends/jobrunning.png)

## <a name="view-output-for-sentiment-analysis"></a>Просмотр выходных данных для анализа тональности

После запуска задания и обработки потока Twitter в режиме реального времени выберите способ просмотра выходных данных для анализа тональности. Чтобы просматривать выходные данные задания в реальном времени, воспользуйтесь такими инструментами, как [Azure Storage Explorer](https://http://storageexplorer.com/) или [Azure Explorer](http://www.cerebrata.com/products/azure-explorer/introduction). Теперь можно расширить ваше приложение, включив в него настраиваемую панель мониторинга с помощью [Power BI](https://powerbi.com/), как показано на следующем снимке экрана.

![Power BI](./media/stream-analytics-twitter-sentiment-analysis-trends/power-bi.png)

## <a name="another-query-of-interest-in-this-scenario"></a>Другой запрос в этом сценарии

Для этого сценария мы создали еще один пример запроса с использованием [скользящего окна](https://msdn.microsoft.com/library/azure/dn835051.aspx). Для определения популярных тем мы будем искать темы, упоминания по которым превышают пороговое значение за определенный промежуток времени. Для целей данного руководства мы проверим темы, упомянутые более 20 раз за последние 5 секунд.

```
SELECT System.Timestamp as Time, Topic, COUNT(*) as Mentions
FROM TwitterStream TIMESTAMP BY CreatedAt
GROUP BY SLIDINGWINDOW(s, 5), topic
HAVING COUNT(*) > 20
```

## <a name="table-of-the-field-headers"></a>Таблица заголовков полей

Для полноты информации метки полей, которые можно использовать в этом упражнении, перечислены в следующей таблице. Так что вы можете поэкспериментировать в редакторе запросов.

Свойство JSON | Определение
--- | ---
CreatedAt | Время создания твита.
Раздел | Раздел, соответствующий указанному ключевому слову.
SentimentScore | Оценка тональности из Sentiment140.
Автор | Дескриптор Twitter, отправивший твит.
текст | Полный текст твита.


## <a name="get-support"></a>Получение поддержки
За дополнительной помощью обращайтесь на наш [форум Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).

## <a name="next-steps"></a>Дальнейшие действия
* [Введение в Azure Stream Analytics](stream-analytics-introduction.md)
* [Приступая к работе с Azure Stream Analytics](stream-analytics-get-started.md)
* [Масштабирование заданий в службе Azure Stream Analytics](stream-analytics-scale-jobs.md)
* [Справочник по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [Справочник по API-интерфейсу REST управления Stream Analytics](https://msdn.microsoft.com/library/azure/dn835031.aspx)


