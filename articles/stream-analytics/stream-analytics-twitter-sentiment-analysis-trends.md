---
title: "Анализ тональности данных Twitter в режиме реального времени с помощью Stream Analytics | Документация Майкрософт"
description: "Информация об использовании Stream Analytics для анализа тональности данных Twitter в режиме реального времени. Пошаговое руководство с шагами от создания событий до отображения данных на динамической панели мониторинга."
keywords: "анализ тенденций twitter в режиме реального времени, анализ тональности, анализ социальных сетей, пример анализа тенденций"
services: stream-analytics
documentationcenter: 
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 42068691-074b-4c3b-a527-acafa484fda2
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 02/03/2017
ms.author: jeffstok
translationtype: Human Translation
ms.sourcegitcommit: 110bf7df8753ec83a5a8b4219891700b462d4eb1
ms.openlocfilehash: 339301772b1ee3bf22e543d4d4183adda5b54c2e

---

# <a name="social-media-analysis-real-time-twitter-sentiment-analysis-in-azure-stream-analytics"></a>Аналитика социальных сетей: анализ тональности в Twitter в режиме реального времени в Azure Stream Analytics
Узнайте, как обеспечить анализ тональности для аналитики социальных сетей путем переноса событий Twitter в концентратор событий Azure в режиме реального времени. Сначала мы напишем запрос Azure Stream Analytics для анализа данных. Затем мы сохраним результаты для последующего внимательного изучения или воспользуемся панелью мониторинга и [Power BI](https://powerbi.com/) для получения ценной аналитической информации в режиме реального времени.

Инструменты аналитики для социальных сетей помогают организациям определить популярные темы, то есть темы и отношения с большим количеством записей в социальных сетях. Анализ тональности, также называемый *интеллектуальным анализом мнений*, использует инструменты аналитики для социальных сетей, чтобы определить отношение к продукции, идеям и т. д. Хороший пример — анализ тенденций Twitter в режиме реального времени. Модель подписки с использованием хэштегов позволяет прослушивать определенные ключевые слова и выполнять анализ тональности канала.

## <a name="scenario-sentiment-analysis-in-real-time"></a>Сценарий: анализ тональности в режиме реального времени
У организации есть новостной веб-сайт. Она хочет получить конкурентное преимущество, мгновенно предлагая читателям содержимое, которое будет им интересно. Организация выполняет анализ социальных сетей по темам, которые интересуют их читателей, анализируя тональность данных Twitter в режиме реального времени. В частности, чтобы определять наиболее популярные темы в Twitter в режиме реального времени, организации необходимо анализировать количество твитов и тональность по ключевым темам. Поэтому по существу ей необходим модуль анализа тональности для канала в социальных сетях.

## <a name="prerequisites"></a>Предварительные требования
* Учетная запись Twitter и [маркер доступа OAuth](https://dev.twitter.com/oauth/overview/application-owner-access-tokens)
* [TwitterClient.zip](http://download.microsoft.com/download/1/7/4/1744EE47-63D0-4B9D-9ECF-E379D15F4586/TwitterClient.zip) из Центра загрузки Майкрософт.
* Необязательно: исходный код клиента Twitter с сайта [GitHub](https://aka.ms/azure-stream-analytics-twitterclient)

## <a name="create-an-event-hub-input-and-a-consumer-group"></a>Создание входного концентратора событий и группы потребителей
В примере приложения будут создаваться события, которые затем будут передаваться экземпляру концентратора событий (для краткости — концентратору событий). Для получения данных событий в Stream Analytics рекомендуется использовать концентраторы событий служебной шины. См. документацию по концентраторам событий в [документации служебной шины Azure](/azure/service-bus/).

Чтобы создать концентратор событий, выполните следующие действия.

1. На портале Azure последовательно выберите пункты **Создать** > **Службы приложений** > **Служебная шина** > **Концентратор событий** > **Быстрое создание**, а затем укажите имя, регион и новое или существующее пространство имен.  
2. Рекомендуется, чтобы каждое задание Stream Analytics считывалось из отдельной группы потребителей концентраторов событий. Позже мы проведем вас по процессу создания группы потребителей. Дополнительные сведения о группах потребителей см. в [Обзоре концентраторов событий Azure](https://msdn.microsoft.com/library/azure/dn836025.aspx). Для создания группы потребителей перейдите к только что созданному концентратору событий и нажмите кнопку **Группы потребителей**, затем щелкните **Создать** в нижней части страницы и укажите имя группы потребителей.
3. Чтобы предоставить доступ к концентратору событий, необходимо создать политику общего доступа. Перейдите на вкладку **Настройка** в окне концентратора событий.
4. В разделе **Политики общего доступа** создайте новую политику с разрешениями на **Управление**.

   ![Политики общего доступа, в которых можно создать политику с разрешениями на управление.](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-ananlytics-shared-access-policies.png)

5. В нижней части страницы нажмите кнопку **СОХРАНИТЬ** .
6. Перейдите на **панель мониторинга** и нажмите внизу страницы кнопку **Сведения о подключении**. Затем скопируйте и сохраните сведения о подключении. (Используйте значок копирования, который отображается под значком поиска).

## <a name="configure-and-start-the-twitter-client-application"></a>Настройка и запуск клиентского приложения Twitter
Мы разработали клиентское приложение, которое будет подключаться к Twitter с помощью [API потоковой передачи Twitter](https://dev.twitter.com/streaming/overview) и собирать события Twitter в темах из параметризованного набора. Для присвоения значения тональности каждому твиту используется средство [Sentiment140](http://help.sentiment140.com/) с открытым исходным кодом.

* 0 = негативная тональность
* 2 = нейтральная тональность
* 4 = позитивная тональность

После этого события Twitter отправляются в концентратор событий.  

Вот как можно настроить приложение.

1. [Скачайте решение TwitterClient](http://download.microsoft.com/download/1/7/4/1744EE47-63D0-4B9D-9ECF-E379D15F4586/TwitterClient.zip).
2. Откройте файл TwitterClient.exe.config и замените oauth_consumer_key, oauth_consumer_secret, oauth_token, oauth_token_secret значениями для своих маркеров Twitter.  

   [Выполните процедуру создания маркера доступа OAuth.](https://dev.twitter.com/oauth/overview/application-owner-access-tokens)  

   Обратите внимание, что для создания маркера необходимо создать пустое приложение.  

3. Замените значения EventHubConnectionString и EventHubName в файле TwitterClient.exe.config своей строкой подключения и именем концентратора событий. Строка подключения, скопированная ранее, содержит строку подключения и имя концентратора событий, поэтому обязательно разделите их и поместите в соответствующие поля. Например, рассмотрим следующую строку подключения:  
   
   `Endpoint=sb://your.servicebus.windows.net/;SharedAccessKeyName=yourpolicy;SharedAccessKey=yoursharedaccesskey;EntityPath=yourhub`
   
   Файл конфигурации TwitterClient.exe. должен содержать параметры, как в приведенном ниже примере:
   
   ```
     add key="EventHubConnectionString" value="Endpoint=sb://your.servicebus.windows.net/;SharedAccessKeyName=yourpolicy;SharedAccessKey=yoursharedaccesskey"
     add key="EventHubName" value="yourhub"
   ```
   
   Обратите внимание, что текст "EntityPath=" **отсутствует** в значении EventHubName.
   
4. *Необязательно:* измените ключевые слова для поиска.  По умолчанию это приложение выполняет поиск по ключевым словам «Azure,Skype,XBox,Microsoft,Seattle».  При необходимости можно настроить значения для **twitter_keywords** в файле TwitterClient.exe.config.
5. Запустите файл TwitterClient.exe, чтобы запустить свое приложение. Вы увидите события-твиты, значения **CreatedAt**, **Topic** и **SentimentScore** для которых будут отправляться в концентратор событий.
   
   ![Анализ тональности: значения SentimentScore, переданные в концентратор событий.](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-analytics-twitter-sentiment-output-to-event-hub.png)

## <a name="create-a-stream-analytics-job"></a>Создание задания Stream Analytics
Теперь, когда у нас есть поток событий-твитов из Twitter в режиме реального времени, можно настроить задание Stream Analytics, чтобы анализировать эти события в режиме реального времени.

### <a name="provision-a-stream-analytics-job"></a>Подготовка задания Stream Analytics
1. На [портале Azure](https://manage.windowsazure.com/) щелкните **Создать** > **Службы данных** > **Stream Analytics** > **Быстрое создание**.
2. Укажите следующие значения и щелкните **СОЗДАТЬ ЗАДАНИЕ АНАЛИТИКИ ПОТОКА**:

   * **ИМЯ ЗАДАНИЯ**— введите имя задания.
   * **РЕГИОН**— выберите регион, в котором должно выполняться задание. Рекомендуем поместить задание в концентратор событий в том же регионе, чтобы улучшить производительность и избежать лишних затрат на передачу данных между регионами.
   * **Учетная запись хранения**: выберите учетную запись хранения Azure, которую вы хотите использовать для хранения данных отслеживания всех заданий Stream Analytics, запущенных в этом регионе. Можно создать учетную запись хранения или выбрать уже существующую.   

3. Щелкните **АНАЛИТИКА ПОТОКА** в области слева, чтобы открыть список заданий Stream Analytics.  
   
   ![Значок службы Stream Analytics](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-analytics-service-icon.png)
   
   Новое задание будет отображаться с состоянием **СОЗДАНО**. Обратите внимание, что кнопка **НАЧАЛО** в нижней части страницы отключена. Прежде чем запустить задание, необходимо настроить для него запрос, входные и выходные данные.


### <a name="specify-job-input"></a>Укажите вход данных для задания

1. В задании Stream Analytics щелкните **Входные данные** в верхней части страницы, а затем щелкните **Добавить входные данные**. В открывшемся диалоговом окне вы сможете выполнить ряд действий по настройке входных данных.
2. Щелкните **Поток данных** и нажмите кнопку со стрелкой вправо.
3. Щелкните **Концентратор событий**и нажмите кнопку со стрелкой вправо.
4. На третьей странице введите или выберите следующие значения:  
   
   * **Псевдоним входных данных**: введите понятное имя для входных данных этого задания, например *TwitterStream*. В дальнейшем это имя будет использоваться в запросе.
   * **Концентратор событий**: если созданный концентратор событий находится в той же подписке, что и задание Stream Analytics, выберите пространство имен, которому принадлежит концентратор.
      * Если концентратор событий находится в другой подписке, выберите пункт **Использовать концентратор событий из другой подписки** и введите вручную информацию в полях **Пространство имен служебной шины**, **Имя концентратора событий**, **Имя политики концентратора событий**, **Ключ политики концентратора событий** и **Количество секций концентратора событий**.
   * **Имя концентратора событий**: выберите имя концентратора событий.
   * **Имя политики концентратора событий**: выберите политику для концентратора событий, созданную ранее в этом учебнике.
   * **Группа потребителей концентратора событий**: введите группу пользователей, созданную ранее в соответствии с инструкциями этого руководства.
   
5. Щелкните стрелку вправо.
6. Укажите следующие значения:  
   
   * **ФОРМАТ СЕРИАЛИЗАТОРА СОБЫТИЙ**: JSON;
   * **КОДИРОВКА**— UTF8.
  
7. Нажмите кнопку **Проверить**, чтобы добавить этот источник и убедиться, что Stream Analytics может успешно подключаться к концентратору событий.

### <a name="specify-job-query"></a>Укажите запрос задания
Stream Analytics поддерживает простую декларативную модель запроса для описания преобразований. Дополнительные сведения о языке см. в разделе [Справочник по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx).  Этот учебник поможет создать и проверить несколько запросов по данным Twitter.

#### <a name="sample-data-input"></a>Ввод примера данных
Чтобы проверить запрос на фактических данных задания, можно использовать функцию **Пример данных** для извлечения событий из потока и создания JSON-файла событий для тестирования.

1. Выберите входные данные концентратора событий и нажмите кнопку **Пример данных** в нижней части страницы.
2. В появившемся окне укажите **Время начала** сбора данных и **Продолжительность** сбора дополнительных данных.
3. Щелкните **Сведения**, а затем — ссылку **Щелкните здесь**, чтобы загрузить и сохранить созданный JSON-файл.

#### <a name="pass-through-query"></a>Запрос к серверу
Прежде всего мы отправим простой запрос к серверу, чтобы заполнить все поля события.

1. Щелкните **Запрос** в верхней части страницы задания Stream Analytics.
2. В редакторе кода замените начальный шаблон запроса следующим кодом:  
   
   `SELECT * FROM TwitterStream`
   
   Убедитесь, что имя входного источника соответствует имени входных данных, указанному ранее.
   
3. В редакторе запросов щелкните **Тест** .
4. Найдите образец JSON-файла.
5. Нажмите кнопку **Проверить** и просмотрите результаты, которые отображаются под определением запроса.
   
   ![Результаты отображаются под определением запроса](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-analytics-sentiment-by-topic.png)
   
#### <a name="count-of-tweets-by-topic-tumbling-window-with-aggregation"></a>Количество твитов по теме: "переворачивающееся" окно с агрегированием
Чтобы сравнить количество упоминаний по разным темам, воспользуемся [TumblingWindow](https://msdn.microsoft.com/library/azure/dn835055.aspx). Это позволит получать количество упоминаний по теме каждые&5; секунд.

1. Измените запрос в редакторе кода на:  
   
   ```
     SELECT System.Timestamp as Time, Topic, COUNT(*)
     FROM TwitterStream TIMESTAMP BY CreatedAt
     GROUP BY TUMBLINGWINDOW(s, 5), Topic
   ```
   
   В этом запросе используется ключевое слово **Timestamp By**, позволяющее задать поле метки времени в полезных данных, используемых при вычислении временных распределений. Если это поле не указано, при выполнении операций с окнами будет использоваться время поступления каждого события в концентратор событий.  Дополнительные сведения см. в разделе "Время прибытия и время приложения" [Справочника по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx).
   
   Запрос также обращается к временной отметке конца каждого окна с помощью свойства **System.Timestamp**.
   
2. Щелкните **Повтор** в редакторе запросов, чтобы просмотреть результаты запроса.

#### <a name="identify-trending-topics-sliding-window"></a>Определение популярных тем: скользящее окно
Для определения популярных тем мы будем искать темы, упоминания по которым превышают пороговое значение за определенный промежуток времени. Для целей данного учебника мы проверим темы, упомянутые более 20 раз за последние 5 с, используя [SlidingWindow](https://msdn.microsoft.com/library/azure/dn835051.aspx).

1. Измените запрос в редакторе кода на:  
   
   ```
     SELECT System.Timestamp as Time, Topic, COUNT(*) as Mentions
     FROM TwitterStream TIMESTAMP BY CreatedAt
     GROUP BY SLIDINGWINDOW(s, 5), topic
     HAVING COUNT(*) > 20
   ```
   
2. Щелкните **Повтор** в редакторе запросов, чтобы просмотреть результаты запроса.  
   
   ![Скользящее окно выходных данных запроса](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-analytics-query-output.png)
   
#### <a name="count-of-mentions-and-sentiment-tumbling-window-with-aggregation"></a>Количество упоминаний и их тональность: «переворачивающееся» окно с агрегацией
Последний запрос, который мы будем тестировать, использует **TumblingWindow**, чтобы получить количество упоминаний, среднее, минимальное, максимальное значение и стандартное отклонение оценки тональности для каждой темы за каждые&5; секунд.

1. Измените запрос в редакторе кода на:  
   
   ```
     SELECT System.Timestamp as Time, Topic, COUNT(*), AVG(SentimentScore), MIN(SentimentScore),
     Max(SentimentScore), STDEV(SentimentScore)
     FROM TwitterStream TIMESTAMP BY CreatedAt
     GROUP BY TUMBLINGWINDOW(s, 5), Topic
   ```     

2. Щелкните **Повтор** в редакторе запросов, чтобы просмотреть результаты запроса.
3. Это запрос, который будет использоваться для нашей панели мониторинга.  В нижней части страницы нажмите кнопку **СОХРАНИТЬ** .

## <a name="create-output-sink"></a>Создание приемника выходных данных 
Теперь, когда мы определили поток событий, входные данные концентратора событий для приема событий и запрос для выполнения преобразования потока, остался последний этап — определить приемник выходных данных задания.  Мы запишем агрегированные события-твиты из нашего запроса задания в хранилище BLOB-объектов Azure.  Кроме того, в зависимости от потребностей приложения можно передать результаты в базу данных SQL Azure, хранилище таблиц Azure или концентраторы событий.

Выполните следующие действия, чтобы создать контейнер для хранилища BLOB-объектов, если он еще не создан:

1. Используйте существующую учетную запись хранения или создайте новую, щелкнув **Создать** > **Службы данных** > **Хранилище** > **Быстрое создание**, и следуйте указаниям на экране.
2. Выберите учетную запись хранения, щелкните **Контейнеры** в верхней части страницы, а затем нажмите кнопку **Добавить**.
3. В поле **Имя** укажите имя контейнера, а в поле **Доступ** задайте **Разрешение на доступ к общедоступному большому двоичному объекту**.

## <a name="specify-job-output"></a>Укажите выходные данные задания
1. В задании Stream Analytics щелкните **Выходные данные** в верхней части страницы, а затем — **Добавить выходные данные**. В открывшемся диалоговом окне вы сможете выполнить ряд действий по настройке выходных данных.
2. Выберите **Хранилище BLOB-объектов**, а затем нажмите кнопку справа.
3. На третьей странице введите или выберите следующие значения:   
   
   * **Выходной псевдоним**: введите понятное имя для этих выходных данных задания.
   * **Подписка**: если хранилище BLOB-объектов создано в той же подписке, что и задание Stream Analytics, щелкните **Использовать учетную запись хранения из текущей подписки**. Если хранилище связано с другой подпиской, выберите **Использовать учетную запись хранения из другой подписки** и вручную заполните поля **Учетная запись хранения**, **Ключ учетной записи хранения** и **Контейнер**.
   * **УЧЕТНАЯ ЗАПИСЬ ХРАНЕНИЯ**: выберите имя учетной записи хранения.
   * **КОНТЕЙНЕР**: выберите имя контейнера.
   * **Префикс имени файла**: введите префикс файла, который следует использовать при записи выходных данных в BLOB-объект.
  
4. Щелкните стрелку вправо.
5. Укажите следующие значения:  
   * **ФОРМАТ СЕРИАЛИЗАТОРА СОБЫТИЙ**: JSON;
   * **КОДИРОВКА**— UTF8.
6. Нажмите кнопку **Проверить**, чтобы добавить этот источник и убедиться, что служба Stream Analytics может подключиться к учетной записи хранения.

## <a name="start-job"></a>Запуск задания
Входные данные, запрос и выходные данные заданы, и теперь можно запустить задание Stream Analytics.

1. На **панели мониторинга** задания щелкните **Запустить** в нижней части страницы.
2. В открывшемся диалоговом окне выберите **Время запуска задания** и нажмите кнопку **Проверить** в нижней части диалогового окна. Состояние задания изменится на **Запуск**, а затем — на **Выполняется**.

## <a name="view-output-for-sentiment-analysis"></a>Просмотр выходных данных для анализа тональности
После запуска задания и обработки потока Twitter в режиме реального времени выберите способ просмотра выходных данных для анализа тональности. Чтобы просматривать выходные данные задания в реальном времени, воспользуйтесь такими инструментами, как [Обозреватель хранилищ Azure](https://azurestorageexplorer.codeplex.com/) или [Обозреватель Azure](http://www.cerebrata.com/products/azure-explorer/introduction). Теперь можно расширить ваше приложение, включив в него настраиваемую панель мониторинга с помощью [Power BI](https://powerbi.com/), как показано на следующем снимке экрана.

![Анализ социальных сетей: вывод данных об анализе тональности (интеллектуальный анализ данных) Stream Analytics на панель мониторинга Power BI.](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-analytics-output-power-bi.png)

## <a name="get-support"></a>Получение поддержки
За дополнительной помощью обращайтесь на наш [форум Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).

## <a name="next-steps"></a>Дальнейшие действия
* [Введение в Azure Stream Analytics](stream-analytics-introduction.md)
* [Приступая к работе с Azure Stream Analytics](stream-analytics-get-started.md)
* [Масштабирование заданий в службе Azure Stream Analytics](stream-analytics-scale-jobs.md)
* [Справочник по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [Справочник по API-интерфейсу REST управления Stream Analytics](https://msdn.microsoft.com/library/azure/dn835031.aspx)




<!--HONumber=Feb17_HO1-->


