<properties
	pageTitle="Начало работы с Azure Stream Analytics для обработки данных, полученных с устройств IoT |Stream Analytics"
	description="Теги и потоки данных датчиков IoT: обработка данных с использованием Stream Analytics в режиме реального времени"
	services="stream-analytics"
	documentationCenter=""
	authors="jeffstokes72"
	manager="paulettm"
	editor="cgronlun"
/>

<tags 
	ms.service="stream-analytics" 
	ms.devlang="na" 
	ms.topic="hero-article" 
	ms.tgt_pltfrm="na" 
	ms.workload="data-services" 
	ms.date="02/11/2016"
	ms.author="jeffstok"
/>

# Начало работы с Azure Stream Analytics для обработки данных с устройств IoT

В этом руководстве вы узнаете, как создать логическую схему обработки потоков для сбора данных с устройств "Интернета вещей" (IoT). Мы рассмотрим сценарии использования IoT из реальной жизни, чтобы продемонстрировать, как быстро создать решение без лишних затрат.

## Предварительные требования

-   [Подписка Azure](https://azure.microsoft.com/pricing/free-trial/)
-   пример запроса и файлов данных, который можно скачать на сайте [GitHub](https://github.com/Azure/azure-stream-analytics/tree/master/Samples/GettingStarted).

## Сценарий

Contoso — это производственная компания, специализирующаяся на промышленной автоматизации, которая полностью автоматизировала свой производственный процесс. Оборудование этой компании оснащено датчиками, которые передают потоки данных в режиме реального времени. В этом сценарии руководителю производственного участка необходимо в реальном времени получать аналитические данные с датчиков, чтобы определять шаблоны и предпринимать соответствующие действия. Для поиска интересных шаблонов во входящем потоке данных мы будем использовать для передаваемых датчиками данных язык запросов Stream Analytics (SAQL).

В этой статье описываются данные, созданные с помощью устройства Texas Instruments SensorTag.

![Texas Instruments SensorTag](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-01.jpg)

Полезные данные хранятся в формате JSON и выглядят следующим образом:

    
	{
    	"time": "2016-01-26T20:47:53.0000000",  
	    "dspl": "sensorE",  
    	"temp": 123,  
	    "hmdt": 34  
	}  
    
В реальном сценарии у вас будет 100 таких датчиков, создающих события в виде потока. В идеале необходимо устройство шлюза, выполняющее код для отправки этих событий в [концентраторы событий Azure](https://azure.microsoft.com/services/event-hubs/). Задание Stream Analytics будет извлекать эти события из концентраторов событий, выполнять аналитику в режиме реального времени с помощью запросов и отправлять результаты в необходимые места назначения выходных данных.

В этом руководстве по началу работы приведен пример файла данных, полученных с реальных устройств SensorTag. На основе этих данных можно выполнять различные запросы и просматривать их результаты. В последующих руководствах вы узнаете, как подключить задание к источникам входных данных и местам назначения выходных данных, а также развернуть его в службе Azure.

## Создание задания Stream Analytics

На [портале Azure](http://manage.windowsazure.com) откройте Stream Analytics и нажмите кнопку **Создать** в левом нижнем углу страницы, чтобы создать задание аналитики.

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-02.png)

Щелкните **Быстрое создание**.

Для параметра **Учетная запись хранения регионального мониторинга** выберите **Создать учетную запись хранения** и присвойте ей любое уникальное имя. С помощью этой учетной записи Azure Stream Analytics будет хранить сведения о наблюдении за всеми последующими заданиями.

> [AZURE.NOTE] Для каждого региона необходимо создать только одну учетную запись хранения. Она будет совместно использоваться для всех заданий Stream Analytics, созданных в этом регионе.

В нижней части страницы щелкните **Создать задание Stream Analytics**.

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-03.jpg)

## Запрос Azure Stream Analytics

Чтобы перейти к редактору запросов, щелкните вкладку "Запрос". Вкладка "Запрос" содержит запрос SQL, который выполняет преобразование входящих данных.

## Архивация необработанных данных

Сквозной запрос — это самая простая форма запроса, который архивирует все входные данные в место назначения выходных данных.

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-04.png)

Скачайте пример файла данных на сайте [GitHub](https://github.com/Azure/azure-stream-analytics/tree/master/Samples/GettingStarted) в расположение на компьютере. Скопируйте и вставьте запрос из файла **PassThrough.txt**. Нажмите кнопку "Проверить" и выберите файл данных с именем **HelloWorldASA-InputStream.json** в расположении, где находится скачанный файл.

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-05.png)

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-06.png)

Просмотреть результаты запроса можно в браузере, как показано ниже.

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-07.png)

## Очистка данных с учетом условий

Давайте попробуем отфильтровать результаты по условию. Нам требуется отобразить результаты только тех событий, которые получены из датчика SensorA. Запрос находится в файле **Filtering.txt**.

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-08.png)

Обратите внимание, что здесь сравнивается строковое значение, чувствительное к регистру. Нажмите кнопку **Выполнить снова**, чтобы выполнить запрос. Из 1860 строк событий запрос должен вернуть только 389 строк.

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-09.png)

## Оповещение для активации рабочего бизнес-процесса

Теперь выполним более сложный запрос. Если требуется отслеживать среднее значение температуры за 30-секундный промежуток времени и отображать результаты только в том случае, если это значение превышает 100 градусов, для каждого типа датчиков нужно написать запрос, как ниже, и нажать кнопку "Выполнить снова", чтобы просмотреть результаты. Запрос находится в файле **ThresholdAlerting.txt**.

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-10.png)

Теперь результаты содержат всего 245 строк согласно числу датчиков, в передаваемых данных которых среднее значение температуры превышает 100. В этом запросе поток событий сгруппирован по свойству DSPL, представляющем собой имя датчика, в **переворачивающемся окне** длительностью 30 секунд. Во время создания таких временных запросов важно задать способ учета отметок времени. С помощью предложения **TIMESTAMP BY** мы настроили использование столбца time для всех временных вычислений. Дополнительные сведения см. в разделах MSDN [Управление временем](https://msdn.microsoft.com/library/azure/mt582045.aspx) и [Над окнами (аналитики Azure потока)](https://msdn.microsoft.com/library/azure/dn835019.aspx).

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-11.png)

## Поиск отсутствия шаблонов

Как написать запрос, чтобы найти отсутствие шаблонов? К примеру, давайте выясним время, когда последний раз отправка данных с датчика была приостановлена на минуту. Запрос находится в файле **AbsenseOfEvent.txt**.

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-12.png)

Здесь используется **LEFT OUTER JOIN** (левое внешнее соединение) для одного и того же потока данных (самосоединение). При внутреннем соединении результат возвращается, только если обнаружено совпадение. Но если событие с левой стороны соединения не сопоставлено при использовании **LEFT OUTER JOIN**, для всех столбцов правой строки возвращается строка со значением NULL. Этот метод очень удобно использовать для поиска отсутствия событий. Дополнительные сведения об условии [JOIN](https://msdn.microsoft.com/library/azure/dn835026.aspx) см. в документации MSDN.

![](./media/stream-analytics-get-started-with-iot-devices/stream-analytics-get-started-with-iot-devices-13.png)

## Заключение

В этом руководстве содержатся вводные сведения о том, как писать разные запросы SAQL и просматривать результаты в браузере, используя различные шаблоны с данными. Тем не менее, это только начало работы. С помощью Stream Analytics можно сделать множество других действий. Далее вы узнаете о подключении задания Stream Analytics к источникам входных данных и местам назначения выходных данных, а также его развертывании в Azure. Чтобы узнать дополнительные возможности Stream Analytics, см. [схему обучения](https://azure.microsoft.com/documentation/learning-paths/stream-analytics/). Дополнительные сведения о написании запросов см. в статье [Примеры запросов для распространенных шаблонов использования Stream Analytics](./stream-analytics-stream-analytics-query-patterns.md#query-example-detect-the-absence-of-events).

<!---HONumber=AcomDC_0224_2016-->