<properties
	pageTitle="Выходные данные JSON для Stream Analytics | Microsoft Azure"
	description="Узнайте, каким образом Stream Analytics направляет данные из Azure DocumentDB в формат JSON и позволяет архивировать данные и уменьшать задержки запросов в отношении неструктурированных данных JSON."
	keywords="Выходные данные JSON"
	documentationCenter=""
	services="stream-analytics,documentdb"
	authors="jeffstokes72"
	manager="paulettm"
	editor="cgronlun"/>

<tags
	ms.service="stream-analytics"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="data-services"
	ms.date="05/03/2016"
	ms.author="jeffstok"/>

# Направление Azure DocumentDB из Stream Analytics в формат JSON

Stream Analytics позволяет направлять данные из [Azure DocumentDB](https://azure.microsoft.com/services/documentdb/) в формат JSON, позволяя архивировать данные и уменьшать задержки запросов в отношении неструктурированных данных JSON. Узнайте оптимальный способ осуществления данной интеграции.

Тем, кто не знаком с DocumentDB, мы рекомендуем просмотреть статью [Схема обучения работе с DocumentDB](https://azure.microsoft.com/documentation/learning-paths/documentdb/).

## Основные сведения о DocumentDB как объекте вывода данных
Использование выходных данных Azure DocumentDB в Stream Analytics позволяет записывать результаты обработки потока данных в коллекцию DocumentDB в формате JSON. Stream Analytics не создает коллекции в базе данных. Их требуется создавать заранее. Благодаря этому выставление счетов за использование коллекций DocumentDB является прозрачным для вас. Кроме того, вы можете регулировать производительность, согласованность и емкость своих коллекций напрямую с помощью [API-интерфейсов DocumentDB](https://msdn.microsoft.com/library/azure/dn781481.aspx). Мы рекомендуем использовать одну базу данных DocumentDB для одного потокового задания, чтобы обеспечить логическое разделение ваших коллекций для потокового задания.

Ниже приведены некоторые параметры коллекций DocumentDB.

## Настройка согласованности, доступности и задержки

Для соответствия требованиям вашего приложения служба DocumentDB позволяет настроить базу данных и коллекции и отрегулировать уровень согласованности, доступности и задержки. В зависимости от того, какие уровни согласованности чтения потребуются вашему сценарию для чтения и записи задержки, вы можете выбирать уровень согласованности в своей учетной записи базы данных. Кроме того, DocumentDB по умолчанию активирует синхронное индексирование для каждой операции CRUD в вашей коллекции. Это еще один полезный параметр для контроля производительности чтения и записи в DocumentDB. Более подробные сведения на эту тему см. в статье [Изменение уровней согласованности базы данных и запросов](../documentdb/documentdb-consistency-levels.md).

## Выбор уровня производительности

Коллекции DocumentDB можно создавать на трех разных уровнях производительности (S1, S2 или S3), определяющих доступную пропускную способность для операций CRUD в соответствующей коллекции. Кроме того, производительность зависит также от уровней индексирования и согласованности в коллекции. Чтобы получить более подробные сведения об уровнях производительности и разобраться в них, см. [эту статью](../documentdb/documentdb-performance-levels.md).

## Вставка и обновление Upsert в Stream Analytics

Благодаря интеграции Stream Analytics с DocumentDB разрешается вставлять или обновлять записи в коллекции DocumentDB с помощью заданного столбца идентификаторов документов. Этот процесс называется также *Upsert*.

Stream Analytics использует оптимистичный подход Upsert, при котором обновления выполняются только тогда, когда операция вставки завершается ошибкой из-за конфликта с идентификатором документа. Это обновление выполняется службой Stream Analytics как исправление, поэтому оно допускает частичное обновление документа. Другими словами, добавление новых свойств или замена существующего свойства выполняется последовательно. Обратите внимание: изменение значений свойств массива в документе JSON приводит к перезаписи всего массива, т. е. массивы не объединяются.

## Секционирование данных в DocumentDB

Коллекции DocumentDB позволяют секционировать данные на основе шаблонов запросов и с учетом требований производительности приложения. Каждая коллекция может содержать до 10 ГБ данных (максимальный объем); в настоящее время увеличить ее размер (или выполнить ее переполнение) нельзя. При масштабировании Stream Analytics позволяет осуществлять запись в несколько коллекций с заданным префиксом (см. сведения об использовании ниже). Stream Analytics использует согласованную стратегию [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) (распознавателя разделов хэша), в основе которой лежит заданный пользователем столбец PartitionKey, для распределения записей выходных данных. Количество коллекций с заданным префиксом во время запуска потокового задания используется в качестве выходного количества разделов, в которые задание осуществляет запись параллельно (коллекции DocumentDB = разделы выходных данных). Можно предположить, что для одной коллекции S3 с отложенным индексированием, в которой выполняются только операции вставки, пропускная способность записи составит приблизительно 0,4 МБ/с. Использование нескольких коллекций может обеспечить более высокую пропускную способность и повысить емкость.

Если вы хотите увеличить количество разделов в будущем, возможно, вам потребуется остановить выполнение задания, перераспределить данные из существующих коллекций в новые коллекции, а затем перезапустить задание Stream Analytics. В следующую публикацию будут включены дополнительные сведения об использовании PartitionResolver и перераспределении, а также образец программного кода. Подробные сведения об этом есть также в разделе о [распределении в DocumentDB](../articles/documentdb-partition-data.md#developing-a-partitioned-application).

## Параметры DocumentDB для выходных данных JSON

При создании DocumentDB как средства обработки выходных данных в Stream Analytics создается запрос информации, показанный ниже. В этом разделе объясняются определения свойств.

![экран выходных данных documentdb stream analytics](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output.png)

-   **Псевдоним выходных данных** — псевдоним для ссылки на эти выходные данные в запросе ASA.  
-   **Имя учетной записи** — имя или универсальный код ресурса (URI) конечной точки учетной записи DocumentDB.  
-   **Ключ учетной записи** — общедоступный ключ доступа к учетной записи DocumentDB.  
-   **База данных** — имя базы данных DocumentDB.  
-   **Шаблон имени коллекции** — шаблон имени для используемых коллекций. Формат имени коллекции можно составить с помощью необязательного маркера {partition}, где разделы начинаются с 0. Далее указываются примеры допустимых входных данных: 1) MyCollection — должна существовать одна коллекция с именем MyCollection; 2) MyCollection{partition} — должны существовать такие коллекции: MyCollection0, MyCollection1, MyCollection2 и т. д.  
-   **Ключ раздела** — имя поля в выходных событиях, указывающее ключ для разделения выходных данных между коллекциями. Для выходных данных одной коллекции можно использовать любой столбец произвольных выходных данных, например PartitionId.  
-   **Document ID** — необязательно. Имя поля в выходных событиях, используемое для указания первичного ключа, на котором основываются операции вставки или обновления.  

<!---HONumber=AcomDC_0504_2016-->