<properties 
	pageTitle="Руководство: общие сведения о Stream Analytics и интеграции машинного обучения | Microsoft Azure" 
	description="Использование определяемой пользователем функции и машинного обучения в заданиях Stream Analytics"
	keywords=""
	documentationCenter=""
	services="stream-analytics"
	authors="jeffstokes72" 
	manager="paulettm" 
	editor="cgronlun"
/>

<tags 
	ms.service="stream-analytics" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.workload="data-services" 
	ms.date="07/06/2016" 
	ms.author="jeffstok"
/>

# Руководство: общие сведения о Stream Analytics и интеграции машинного обучения #

С помощью этого руководства можно быстро создать простое задание Stream Analytics, интегрированное с машинным обучением. Мы будем использовать модель машинного обучения Sentiment Analytics из коллекции Cortana Intelligence для анализа потоковой передачи текстовых данных, а также определения оценки мнений в реальном времени. Это полезное руководство поможет вам разобраться в следующих сценариях: анализ мнений в реальном времени при потоковой передаче данных в Твиттере, анализ записей разговоров клиента со специалистами службы поддержки, комментарии на форумах, в блогах и видеозаписях. Кроме этого вы получите представление о многих других сценариях прогнозной оценки в реальном времени.
  
В этом руководстве образец CSV-файла с текстом (см. рисунок 1 ниже) является элементом ввода для хранилища BLOB-объектов Azure. Задание будет применять модель Sentiment Analytics как определяемую пользователем функцию к образцу текстовых данных из хранилища BLOB-объектов. Конечный результат будет помещен в то же хранилище BLOB-объектов Azure в другой CSV-файл. Схема конфигурации приведена на рисунке 2 ниже. Для более реалистичного сценария этот элемент ввода для хранилища BLOB-объектов можно заменить потоковыми данными Твиттера из входных данных концентратора событий Azure. Кроме того, можно создать визуализацию совокупного мнения [Power BI](https://powerbi.microsoft.com/) в реальном времени. Далее в этой статье будут рассмотрены следующие шаги.

Рис. 1.

![stream analytics машинное обучение руководство рисунок 1](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-figure-2.png)

Рис. 2.

![stream analytics машинное обучение руководство рисунок 2](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-figure-1.png)

## Предварительные требования

Ниже приведены компоненты, необходимые для работы с этой статьей.

1.	Активная подписка Azure.
2.	CSV-файл с данными. Файл, приведенный на рисунке 2, можно скачать с сайта [GitHub](https://github.com/jeffstokes72/azure-stream-analytics-repository/blob/master/sampleinputs.csv). Либо вы можете создать собственный файл. В этом руководстве предполагается, что будет использоваться скачанный файл.

В общих чертах, будут выполнены следующие действия.

1.	Отправка входного CSV-файла в хранилище BLOB-объектов.
2.	Добавление модели Sentiment Analytics из коллекции Cortana Intelligence в рабочую область машинного обучения.
3.	Развертывание этой модели в качестве веб-службы в рамках рабочей области машинного обучения Azure.
4.	Создание задания Stream Analytics, которое вызывает эту веб-службу как функцию для определения тональности входного текста.
5.	Запуск задания Stream Analytics и просмотр вывода.


## Отправка входного CSV-файла в хранилище BLOB-объектов

Для этого шага можно использовать любой CSV-файл, в том числе указанный в начале этой статьи. Передать файл можно с помощью [обозревателя хранилища Azure](http://storageexplorer.com/), Visual Studio или пользовательского кода. В этом руководстве приведены примеры для Visual Studio.

1.	Разверните Azure и щелкните правой кнопкой мыши **Хранилище**. Выберите **Присоединить внешнее хранилище** и укажите **имя учетной записи** и **ключ учетной записи**.

    ![stream analytics машинное обучение руководство обозреватель сервера](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-server-explorer.png)

2.	Разверните только что подключенное хранилище, выберите **Создать контейнер BLOB-объектов** и укажите логическое имя. После создания дважды щелкните контейнер, чтобы просмотреть содержимое (на этом этапе он будет пустым).

    ![stream analytics машинное обучение руководство создание blob-объекта](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-create-blob.png)

3.	Отправьте CSV-файл, щелкнув значок **Отправить BLOB-объект**, и выберите **файл с локального диска**.

## Добавление модели анализа мнений Sentiment Analytics из коллекции Cortana Intelligence

1.	Скачайте [модель прогнозной аналитики](https://gallery.cortanaintelligence.com/Experiment/Predictive-Mini-Twitter-sentiment-analysis-Experiment-1) из коллекции Cortana Intelligence.
2.	В Студии щелкните **Открыть**.

    ![stream analytics машинное обучение руководство открыть студию машинного обучения](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-open-ml-studio.png)

3.	Войдите, чтобы перейти в рабочую область. Выберите расположение, соответствующее вашему расположению.
4.	Теперь в нижней части Студии щелкните **Запустить**.
5.	После успешного запуска щелкните **Развернуть веб-службу**.
6.	Теперь модель анализа мнений готова к использованию. Чтобы убедиться в этом, нажмите кнопку **Проверить** и введите текст (например, «Мне нравится Майкрософт»). Вы должны получить приведенный ниже результат.

`'Predictive Mini Twitter sentiment analysis Experiment' test returned ["4","0.715057671070099"]...`

![stream analytics машинное обучение руководство данные анализа](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-analysis-data.png)

Щелкните ссылку на книгу **Excel 2010 или более ранней версии**, чтобы получить ключ API и URL-адрес, которые потребуются позднее для настройки задания Stream Analytics. (Этот шаг необходим только при использовании модели машинного обучения из рабочей области другой учетной записи Azure. В приведенном в этом учебнике сценарии рассматривается именно такой случай.)

![stream analytics машинное обучение руководство анализ эксперимент](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-analysis-experiement.png)

Обратите внимание на URL-адрес веб-службы и ключ доступа в скачанном EXCEL-файле на рисунке ниже.

![stream analytics машинное обучение руководство создание быстрый взгляд](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-quick-glance.png)

## Создание задания Stream Analytics, использующего модель машинного обучения

1.	Перейдите на [портал управления Azure](https://manage.windowsazure.com).
2.	Щелкните **Создать**, **Службы данных**, **Stream Analytics**, **Быстрое создание**. Укажите **имя задания** и соответствующий **регион**, а затем выберите **Учетная запись хранения регионального мониторинга**.
3.	После создания задания перейдите в раздел **Входные данные** и нажмите кнопку **Добавить входные данные**.

    ![stream analytics машинное обучение руководство добавление данных ввод машинного обучения](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-add-input-screen.png)

4.	На первой странице мастера **Добавление входных данных** выберите **Поток данных** и нажмите кнопку «Далее». На второй странице в качестве входных данных выберите **Хранилище BLOB-объектов** и нажмите кнопку **Далее**.
5.	На странице **Настройки хранилища BLOB-объектов** мастера укажите имя контейнера BLOB-объектов учетной записи хранения, заданное ранее во время отправки данных. Нажмите кнопку **Далее**. Выберите **CSV** в качестве **формата сериализации событий**. Примите значения по умолчанию для остальных **параметров сериализации**. Нажмите кнопку **ОК**.
6.	Перейдите на вкладку **Выходные данные** и нажмите кнопку **Добавить выходные данные**.

    ![stream analytics машинное обучение руководство добавление вывода](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-add-output-screen.png)

7.	Выберите **Хранилище BLOB-объектов** и введите те же параметры, за исключением контейнера. **Входные данные** настроены для чтения из контейнера с именем test, в который отправлен **CSV**-файл. Для параметра **Выходные данные** укажите testoutput. Имена контейнеров не должны повторяться. Кроме этого, убедитесь в наличии контейнеров.
8.	Щелкните **Далее**, чтобы настроить **Параметры сериализации** вывода. Как и в случае с вводом, выберите **CSV** и нажмите кнопку **ОК**.
9.	Перейдите на вкладку **Функции** и нажмите кнопку **Добавить функцию машинного обучения**.

    ![stream analytics машинное обучение руководство добавление функции машинного обучения](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-add-ml-function.png)

10.	На странице **Параметры веб-службы машинного обучения** найдите рабочую область машинного обучения, веб-службу и конечную точку по умолчанию. Для этого руководства примените параметры вручную. Так, при наличии URL-адреса и ключа, вы сможете ознакомиться с настройкой веб-службы для любой рабочей области. Укажите **URL-адрес** и **ключ API** конечной точки. Нажмите кнопку **ОК**.

    ![stream analytics машинное обучение руководство веб-служба машинного обучения](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-ml-web-service.png)

11.	Перейдите на вкладку **Запрос** и измените запрос, как показано ниже.

```
	WITH subquery AS (  
		SELECT text, sentiment(text) as result from input  
	)  
	  
	Select text, result.[Score]  
	Into output  
	From subquery  
```    

Щелкните **Сохранить**, чтобы сохранить запрос.

## Запуск задания Stream Analytics и просмотр вывода

1.	Щелкните **Запуск** в нижней части задания.
2.	В диалоговом окне **Запуск запроса** выберите **Настраиваемое время** и укажите время до отправки CSV-файла в хранилище BLOB-объектов. Нажмите кнопку **ОК**.

    ![stream analytics машинное обучение руководство настраиваемое время](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-custom-time.png)

3.	Перейдите в хранилище BLOB-объектов с помощью того же средства, которое использовалось при отправке CSV-файла. В этом руководстве используется Visual Studio.
4.	Через несколько минут после запуска задания создается выходной контейнер, в который отправляется CSV-файл.
5.	Дважды щелкните файл, чтобы открыть стандартный редактор CSV. Он должен выглядеть, как показано на рисунке ниже.

    ![stream analytics машинное обучение руководство просмотр csv](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-csv-view.png)

## Заключение

С помощью этого руководства мы создали задание Stream Analytics, которое читает потоковые текстовые данные и применяет к ним анализ мнений в реальном времени. При этом нам не требовалось вникать в особенности построения модели Sentiment Analytics. Это одно из преимуществ набора Cortana Intelligence.

Также можно отслеживать метрики, связанные с функцией машинного обучения Azure. Щелкните вкладку **Монитор**. Здесь находятся три метрики, относящиеся к функции.
  
- «Запросы функции» — показывает количество запросов к веб-службе машинного обучения.
- «События функции» — указывает количество событий в запросе. По умолчанию каждый запрос к веб-службе машинного обучения содержит до 1000 событий.
- «Неудачные запросы функции» — отображает количество неудачных запросов к веб-службе машинного обучения.

    ![stream analytics машинное обучение руководство отслеживание машинного обучения просмотр](./media/stream-analytics-machine-learning-integration-tutorial/stream-analytics-machine-learning-integration-tutorial-ml-monitor-view.png)

<!---HONumber=AcomDC_0706_2016-->