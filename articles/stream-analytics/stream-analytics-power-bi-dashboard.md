<properties 
	pageTitle="Панель мониторинга Power BI в Stream Analytics | Microsoft Azure" 
	description="Используйте панель мониторинга Power BI для потоковой передачи, чтобы собирать данные бизнес-аналитики и анализировать большие объемы данных из задания Stream Analytics." 
	services="stream-analytics" 
	documentationCenter="" 
	authors="jeffstokes72" 
	manager="paulettm" 
	editor="cgronlun"/>

<tags 
	ms.service="stream-analytics" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.workload="data-services" 
	ms.date="08/03/2015" 
	ms.author="jeffstok"/>
	
# Azure Stream Analytics и Power BI: динамические панели мониторинга для аналитики потоковых данных в режиме реального времени

Azure Stream Analytics позволяет воспользоваться одним из лучших инструментов бизнес-аналитики, Microsoft Power BI. Узнайте, как использовать Azure Stream Analytics для анализа больших объемов потоковых данных и получения подробных аналитических данных на панели мониторинга Power BI в режиме реального времени.

Используйте [Microsoft Power BI](https://powerbi.com/) для быстрого создания динамической панели мониторинга. [Видео, иллюстрирующее этот сценарий](https://www.youtube.com/watch?v=SGUpT-a99MA).

В этой статье рассматривается создание пользовательских инструментов бизнес-аналитики с помощью Power BI в качестве места для вывода выходных данных заданий Azure Stream Analytics.

> [AZURE.NOTE]Вывод выходных данных в Power BI — это функция предварительной версии Azure Stream Analytics.

## Предварительные требования ##

* Учетная запись Microsoft Azure
* Входные данные для задания Stream Analytics, из которого будут извлекаться потоковые данные. Stream Analytics принимает входные данные из концентраторов событий Azure или хранилища больших двоичных объектов Azure.  
* Рабочая или учебная учетная запись для Power BI

## Создание задания Azure Stream Analytics ##

На [портале Azure](https://manage.windowsazure.com) щелкните **Создать, Службы данных, Stream Analytics, Быстро создать**.

Укажите следующие значения и щелкните **Создать задание Stream Analytics**:

* **Имя задания** — введите имя задания. Например, **DeviceTemperatures**.
* **Регион** — выберите регион, в котором должно находится задание. Рекомендуем поместить задание в концентратор событий в том же регионе, чтобы обеспечить оптимальную производительность и избежать лишних издержек на передачу данных между регионами.
* **Учетная запись хранения** — выберите учетную запись хранения, которую вы хотите использовать для отслеживания данных всех заданий Stream Analytics, запущенных в этом регионе. Можно выбрать существующую учетную запись хранения или создать новую.

Щелкните **Stream Analytics** в области слева, чтобы открыть список заданий Stream Analytics.

![рисунок1][graphic1]

> [AZURE.TIP]Появится новое задание с состоянием **Не запущено**. Обратите внимание, что кнопка **Начало** в нижней части страницы отключена. Этого и следовало ожидать, так как перед запуском задания, необходимо настроить ввод, вывод, запрос и другие параметры задания.

## Укажите вход данных для задания ##

В этом учебнике предполагается, что в качестве входной сериализации JSON используется концентратор событий и применяется кодировка UTF-8.

* Щелкните имя задания.
* Щелкните **Входные данные** в верхней части страницы, затем щелкните **Добавить входные данные**. Открывшееся диалоговое окно поможет выполнить ряд действий для настройки входных данных.
*	Выберите **Поток данных** и нажмите кнопку со стрелкой вправо.
*	Выберите пункт **Концентратор событий** и нажмите расположенную справа кнопку.
*	На третьей странице введите или выберите следующие значения:
  *	**Входной псевдоним** — введите понятное имя для этих входных данных задания. Впоследствии это имя будет использоваться в запросе.
  * **Концентратор событий** — если созданный концентратор событий находится в той же подписке, что и задание Stream Analytics, выберите пространство имен, к которому принадлежит концентратор.
*	Если концентратор событий находится в другой подписке, выберите **Использовать концентратор событий из другой подписки** и введите вручную информацию в полях **Пространство имен Service Bus**, **Имя концентратора событий**, **Имя политики концентратора событий**, **Ключ политики концентратора событий** и **Количество секций концентратора событий**.

> [AZURE.NOTE]В этом примере используется 16 секций (это количество секций по умолчанию).

* **Имя концентратора событий** — выберите имя имеющегося концентратора событий Azure.
* **Имя политики концентратора событий** — выберите политику для используемого концентратора событий. Убедитесь, что эта политика обеспечивает разрешения на управление.
*	**Группа получателей концентратора событий** — это поле можно оставить пустым или указать имеющуюся группу получателей в концентраторе событий. Обратите внимание, что в каждую группу получателей концентратора событий может входить не более 5 модулей чтения одновременно. Поэтому нужно тщательно подбирать группу получателя в соответствии с заданием. Если оставить это поле пустым, будет использоваться группа получателей по умолчанию.

*	Щелкните стрелку вправо.
*	Укажите следующие значения:
  *	**Формат сериализатора событий** — JSON.
  *	**Кодировка** — UTF8.
*	Нажмите кнопку "Проверить", чтобы добавить этот источник и убедится, что Stream Analytics может успешно подключаться к концентратору событий.

## Добавление Power BI в качестве места назначения выходных данных ##

1.  Щелкните **Выходные данные** в верхней части страницы, затем щелкните **Добавить выходные данные**. Power BI отобразится в списке возможных мест назначения выходных данных.

    ![рисунок2][graphic2]

2.  Выберите **Power BI** и щелкните кнопку со стрелкой вправо.
3.  Должен отобразиться следующий экран.

    ![рисунок3][graphic3]

4.  На этом шаге укажите рабочую или учебную учетную запись для выходных данных задания Stream Analytics. При наличии учетной записи Power BI выберите **Авторизовать сейчас**. Если она отсутствует, выберите **Зарегистрироваться сейчас**. [Вот хороший блог, в котором подробно описываются этапы регистрации в Power BI](http://blogs.technet.com/b/powerbisupport/archive/2015/02/06/power-bi-sign-up-walkthrough.aspx).

    ![рисунок11][graphic11]

5.  Затем отобразится следующий экран:

    ![рисунок4][graphic4]

Укажите значения, показанные ниже:

* **Псевдоним выхода** — здесь можно указать любой запоминающийся псевдоним выхода. Его особенно удобно использовать, если у задания должно быть несколько выходов. В этом случае такой выход необходимо указывать в запросе. Можно, например, использовать псевдоним выхода OutPbi.
* **Имя набора данных** — укажите имя набора данных, которое необходимо назначить выходным данным для Power BI. Можно, например, использовать имя pbidemo.
*	**Имя таблицы** — задайте имя таблицы в наборе выходных данных Power BI. Можно, например, назвать ее pbidemo. В настоящее время для вывода выходных данных из заданий Stream Analytics в Power BI можно использовать только одну таблицу в наборе данных.

>	[AZURE.NOTE] Не следует напрямую создавать этот набор данных и таблицу в вашей учетной записи Power BI. Они будут автоматически созданы при запуске задания в Stream Analytics, когда задание начнет вносить выходные данные в Power BI. Если запрос задания не возвращает никаких результатов, набор данных и таблица не будут созданы.

*	Нажмите кнопку **ОК** и щелкните **Проверить подключение**. Настройка выхода завершена.

>	[AZURE.WARNING] Кроме того, учтите, что, если в Power BI уже есть набор данных и таблица с именем, аналогичным указанному вами в этом задании Stream Analytics, существующие данные будут перезаписаны.


## Составление запросов ##

Откройте в задании вкладку **Запрос**. Составьте запрос, выходные данные которого нужно вывести в Power BI. Например, можно создать запрос SQL такого рода:

    SELECT
    	MAX(hmdt) AS hmdt,
    	MAX(temp) AS temp,
    	System.TimeStamp AS time,
    	dspl
    INTO
        OutPBI
    FROM
    	Input TIMESTAMP BY time
    GROUP BY
    	TUMBLINGWINDOW(ss,1),
    	dspl

    
    
Запустите задание. Убедитесь, что концентратор событий получает события, а запрос выдает ожидаемые результаты. Если запрос возвращает 0 строк, набор данных и таблицы Power BI не создаются автоматически.

## Создание панели мониторинга в Power BI ##

Перейдите на сайт [Powerbi.com](https://powerbi.com) и войдите, используя свою рабочую или учебную учетную запись. Если результаты запроса задания Stream Analytics были выведены, вы увидите уже созданный набор данных:

![рисунок5][graphic5]

Для создания панели мониторинга необходимо выбрать параметр «Панели мониторинга» и создать новую панель.

![рисунок6][graphic6]

В этом примере она будет называться «демонстрационной панелью управления».

Теперь щелкните набор данных, созданный заданием Stream Analytics (в данном примере это pbidemo). Откроется страница для создания диаграммы на основе этого набора данных. Ниже приведен пример одного из отчетов, которые можно создать.

Выберите поля Σ temp и time. При создании диаграммы они будут автоматически помещены в разделы «Значение» и «Ось»:

![рисунок7][graphic7]

В результате будет автоматически создана диаграмма, показанная ниже:

![рисунок8][graphic8]

В разделе «Значение» щелкните раскрывающийся список для поля temp и выберите **среднее** для температуры на диаграмме. Затем щелкните **зрительный образ** и выберите **график**:

![рисунок9][graphic9]

В результате получится график изменения среднего значения со временем. С помощью параметра закрепления можно прикрепить эту диаграмму к панели мониторинга, как показано ниже:

![рисунок10][graphic10]

Теперь на панели мониторинга будет отображаться прикрепленный отчет, обновляющийся в режиме реального времени. Попробуйте изменить данные в событиях, например пиковую температуру или другую характеристику, и соответствующие изменения отразятся на панели мониторинга в режиме реального времени.

Обратите внимание, что в этом учебнике показано, как создать только один из возможных видов диаграмм для набора данных. Power BI позволяет создавать другие клиентские инструменты бизнес-аналитики для вашей организации. С еще одним примером панели мониторинга Power BI можно ознакомиться в видео [Приступая к работе с Power BI](https://youtu.be/L-Z_6P56aas?t=1m58s) .

См. также дополнительную информацию о создании панели мониторинга в Power BI в статье [Панели мониторинга в предварительной версии Power BI](http://support.powerbi.com/knowledgebase/articles/424868-dashboards-in-power-bi-preview).

## Ограничения и рекомендации ##
В Power BI используются как ограничения параллелизма, так и ограничения пропускной способности, как описано на странице по этому адресу: [https://powerbi.microsoft.com/pricing](https://powerbi.microsoft.com/pricing "Цены на использование Power BI").

Из-за этих ограничений Power BI лучше всего подходит для случаев, когда Azure Stream Analytics значительно уменьшает объем загружаемых данных. Мы советуем использовать TumblingWindow или HoppingWindow, чтобы отправка данных выполнялась не чаще 1 раза в секунду и чтобы ваш запрос удовлетворял требования к пропускной способности. Для вычисления значения периода в секундах можно использовать следующую формулу: ![equation1](./media/stream-analytics-power-bi-dashboard/equation1.png).

Пример. Если у вас есть 1000 устройств, отправляющих данные каждую секунду (это означает, что вы используете SKU Power BI Pro, поддерживающий 1 000 000 строк в час), и вам необходимо рассчитать средний объем передаваемых данных на одно устройство в Power BI при максимальной периодичности отправки данных раз в 4 с (как показано ниже):
![equation2](./media/stream-analytics-power-bi-dashboard/equation2.png)

Это означает, что нам необходимо изменить исходный запрос указанным ниже образом.

    SELECT
    	MAX(hmdt) AS hmdt,
    	MAX(temp) AS temp,
    	System.TimeStamp AS time,
    	dspl
    INTO
    	OutPBI
    FROM
    	Input TIMESTAMP BY time
    GROUP BY
    	TUMBLINGWINDOW(ss,4),
    	dspl



## Получение справки ##
Дополнительную помощь и поддержку вы можете получить на нашем [форуме Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/ru-ru/home?forum=AzureStreamAnalytics).

## Дальнейшие действия ##

- [Введение в Azure Stream Analytics](stream-analytics-introduction.md)
- [Приступая к работе с Azure Stream Analytics](stream-analytics-get-started.md)
- [Масштабирование заданий в службе Azure Stream Analytics](stream-analytics-scale-jobs.md)
- [Справочник по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx)
- [Справочник по API-интерфейсу REST управления Stream Analytics](https://msdn.microsoft.com/library/azure/dn835031.aspx)


[graphic1]: ./media/stream-analytics-power-bi-dashboard/1-stream-analytics-power-bi-dashboard.png
[graphic2]: ./media/stream-analytics-power-bi-dashboard/2-stream-analytics-power-bi-dashboard.png
[graphic3]: ./media/stream-analytics-power-bi-dashboard/3-stream-analytics-power-bi-dashboard.png
[graphic4]: ./media/stream-analytics-power-bi-dashboard/4-stream-analytics-power-bi-dashboard.png
[graphic5]: ./media/stream-analytics-power-bi-dashboard/5-stream-analytics-power-bi-dashboard.png
[graphic6]: ./media/stream-analytics-power-bi-dashboard/6-stream-analytics-power-bi-dashboard.png
[graphic7]: ./media/stream-analytics-power-bi-dashboard/7-stream-analytics-power-bi-dashboard.png
[graphic8]: ./media/stream-analytics-power-bi-dashboard/8-stream-analytics-power-bi-dashboard.png
[graphic9]: ./media/stream-analytics-power-bi-dashboard/9-stream-analytics-power-bi-dashboard.png
[graphic10]: ./media/stream-analytics-power-bi-dashboard/10-stream-analytics-power-bi-dashboard.png
[graphic11]: ./media/stream-analytics-power-bi-dashboard/11-stream-analytics-power-bi-dashboard.png

<!---HONumber=August15_HO6-->