---
title: "Обработка порядка событий и просрочки с помощью Azure Stream Analytics | Документация Майкрософт"
description: "Узнайте об обработке неупорядоченных или поздних событий в потоках данных Stream Analytics."
keywords: "не по порядку, поздний, события"
documentationcenter: 
services: stream-analytics
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 04/20/2017
ms.author: samacha
ms.openlocfilehash: cf57bd12a62b3de8ac49b26ce7cdc40aec0b6738
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="azure-stream-analytics-event-order-handling"></a>Обработка порядка событий Azure Stream Analytics

В потоке временных данных событий каждому событию присваивается метка времени. Azure Stream Analytics присваивает каждому событию метку времени, используя время получения или время приложения. В столбце System.Timestamp указана метка времени, присвоенная событию. Время получения присваивается в источнике входных данных, когда событие достигает источника. Время получения — это значение свойства EventEnqueuedTime для входных данных концентратора событий и [время последнего изменения большого двоичного объекта](https://docs.microsoft.com/en-us/dotnet/api/microsoft.windowsazure.storage.blob.blobproperties.lastmodified?view=azurestorage-8.1.3) для входных данных большого двоичного объекта. Время приложения присваивается при создании события и является частью полезных данных. Для обработки событий по времени приложения используйте предложение "Timestamp by" в запросе SELECT. Если предложение "Timestamp by" отсутствует, то события обрабатываются по времени получения. Доступ ко времени получения можно получить с помощью свойства EventEnqueuedTime для концентратора событий и свойства BlobLastModified для входных данных большого двоичного объекта. Azure Stream Analytics создает выходные данные в порядке меток времени и предоставляет несколько параметров для работы с неупорядоченными данными.

![Обработка событий Stream Analytics](media/stream-analytics-event-handling/stream-analytics-event-handling.png)

С неупорядоченными входными потоками происходит одно из следующих событий:
* сортировка (и, следовательно, **удаление**);
* корректировка системой с учетом пользовательской политики.

При обработке по времени приложения Stream Analytics допускает неупорядоченные события и события, поступившие с задержкой.

**Допустимый интервал поступления с задержкой**

* Эта настройка применяется только при обработке по времени приложения. В ином случае она игнорируется.
* Это максимальная разница между временем получения и временем приложения. Если время приложения предшествует значению (время получения – интервал поступления с задержкой), то ему присваивается значение (время получения – интервал поступления с задержкой).
* Если одновременно используется несколько секций из одного входного потока или нескольких входных потоков, то допустимый интервал поступления с задержкой является максимальным временем, которое каждая секция ожидает поступления новых данных. 

Если коротко, то интервал поступления с задержкой — это максимальная задержка между созданием события и его получением в источнике входных данных.
Сначала выполняется корректировка на основе допустимого интервала поступления с задержкой, а затем корректируются события, полученные в неправильном порядке. В столбце **System.Timestamp** будет указана конечная метка времени, присвоенная событию.

**Интервал для событий, полученных в неправильном порядке**

* Последовательность событий, полученных в неправильном порядке, но в пределах заданного "интервала для событий, полученных в неправильном порядке", **корректируется по метке времени**. 
* События, поступающие позже допустимого, **удаляются или корректируются**.
    * **Корректировка** предполагает изменение значения времени к крайнему допустимому. 
    * **Удаление** предполагает удаление.

Чтобы изменить последовательность событий, полученных в пределах "интервала для событий, полученных в неправильном порядке", выходные данные запроса **задерживаются на такой же интервал**.

**Пример**

Допустимый интервал поступления с задержкой = 10 минут.<br/>
Интервал для событий, полученных в неправильном порядке = 3 минуты<br/>
Обработка по времени приложения<br/>

События:

Событие 1. _Время приложения_ = 00:00:00, _время получения_ = 00:10:01, _System.Timestamp_ = 00:00:01, корректируется, так как значение (_время прибытия_ - _время приложения_) больше, чем допустимый интервал поступления с задержкой.

Событие 2. _Время приложения_ = 00:00:01, _время получения_ = 00:10:01, _System.Timestamp_ = 00:00:01, не корректируется, так как время приложения входит в интервал поступления с задержкой.

Событие 3. _Время приложения_ = 00:10:00, _время получения_ = 00:10:02, _System.Timestamp_ = 00:10:00, не корректируется, так как время приложения входит в интервал поступления с задержкой.

Событие 4. _Время приложения_ = 00:09:00, _время получения_ = 00:10:03, _System.Timestamp_ = 00:09:00, принимается с исходной меткой времени, так как время приложения входит в допустимый интервал для событий, полученных в неправильном порядке.

Событие 5. _Время приложения_ = 00:06:00, _время получения_ = 00:10:04, _System.Timestamp_ = 00:07:00, корректируется, так как время приложения раньше интервала для событий, полученных в неправильном порядке.



## <a name="get-help"></a>Получение справки
Дополнительную помощь вы можете получить на нашем [форуме Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).

## <a name="next-steps"></a>Дальнейшие действия
* [Что такое Stream Analytics?](stream-analytics-introduction.md)
* [Приступая к работе с Azure Stream Analytics: выявление мошенничества в режиме реального времени](stream-analytics-real-time-fraud-detection.md)
* [Масштабирование заданий Azure Stream Analytics для повышения пропускной способности базы данных](stream-analytics-scale-jobs.md)
* [Stream Analytics Query Language Reference](https://msdn.microsoft.com/library/azure/dn834998.aspx) (Справочник по языку запросов Stream Analytics)
* [Stream Analytics management REST API reference](https://msdn.microsoft.com/library/azure/dn835031.aspx) (Справочник по API-интерфейсу REST для управления Stream Analytics)
