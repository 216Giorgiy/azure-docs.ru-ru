---
title: "Обработка порядка событий и просрочки с помощью Azure Stream Analytics | Документация Майкрософт"
description: "Узнайте об обработке неупорядоченных или поздних событий в потоках данных Stream Analytics."
keywords: "не по порядку, поздний, события"
documentationcenter: 
services: stream-analytics
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 04/20/2017
ms.author: jeffstok
ms.translationtype: Human Translation
ms.sourcegitcommit: 6dbb88577733d5ec0dc17acf7243b2ba7b829b38
ms.openlocfilehash: d7a5620aef1f28ea065ec10ce095f7f3904a8060
ms.contentlocale: ru-ru
ms.lasthandoff: 07/04/2017


---
# <a name="azure-stream-analytics-event-order-handling"></a>Обработка порядка событий Azure Stream Analytics

В потоке временных данных событий каждое событие записывается со временем получения. При некоторых условиях события могут передаваться в поток событий в порядке, отличном от того, в котором они были отправлены. Это может произойти из-за ретрансляции TCP или рассинхронизации часов между отправляющим устройством и принимающим концентратором событий. События пунктуации также добавляются в полученные потоки событий, чтобы ускорить выполнение при отсутствии событий. Это нужно в сценариях типа "Уведомить меня, если операция входа не выполняется в течение 3 минут".

С неупорядоченными входными потоками происходит одно из следующих событий:
* сортировка (и, следовательно, **удаление**);
* корректировка системой с учетом пользовательской политики.


## <a name="lateness-tolerance"></a>Допуск по просрочке
Stream Analytics допускает такие типы сценариев. В этой службе предусмотрены механизмы обработки неупорядоченных и поздних событий. Она обрабатывает эти события следующими способами:

* События, поступающие в неверном порядке, но в пределах значения допуска, **переупорядочиваются по метке времени**.
* События, поступающие позже допустимого, **удаляются или корректируются**.
    * **Корректировка** предполагает изменение значения времени к крайнему допустимому.
    * **Удаление** предполагает удаление.

![Обработка событий Stream Analytics](media/stream-analytics-event-handling/stream-analytics-event-handling.png)

## <a name="reduce-the-number-of-out-of-order-events"></a>Сокращение числа неупорядоченных событий

Так как при обработке входящих событий Stream Analytics применяет временное преобразование (например, агрегаты данных на основе периодов времени или временные соединения), они сортируются в порядке метки времени.

Если ключевое слово "метка времени" **НЕ** используется, по умолчанию используется время постановки в очередь событий концентраторов событий. Концентраторы событий гарантируют монотонность метки времени для каждого раздела концентратора событий, а также объединение событий из всех разделов в порядке метки времени. Благодаря этому обеспечивается отсутствие неупорядоченных событий.

Иногда необходимо использовать метку времени отправителя. В этом случае метка времени выбирается из полезных данных событий по ключевому слову "метка времени". В этих сценариях может появиться несколько источников неупорядоченных событий:

* Часы поставщиков событий рассинхронизированы. Обычно это происходит, если используются поставщики с разных компьютеров с разными часами.
* Существует задержка сети при передаче из источника событий в целевой концентратор событий.
* Часы разделов концентратора событий рассинхронизированы. Сначала Stream Analytics сортирует события из всех разделов концентратора событий по времени постановки события в очередь. Затем служба проверяет поток данных на наличие неупорядоченных событий.

На вкладке конфигурации содержатся следующие значения по умолчанию:

![Обработка неупорядоченных событий в Stream Analytics](media/stream-analytics-event-handling/stream-analytics-out-of-order-handling.png)

Если задать 0 секунд в качестве допустимого окна для неупорядоченных событий, вы утверждаете, что все события все время упорядочены. С учетом трех источников неупорядоченных событий маловероятно, что это условие выполняется. 

Чтобы разрешить Stream Analytics исправить порядок неупорядоченного события, можно указать ненулевое значение допустимого окна для неупорядоченных событий. Stream Analytics буферизует события до этого окна и переупорядочивает их по выбранной метке времени, а затем применяет временное преобразование. Начните с 3-секундного окна и настраивайте значение, чтобы сократить число событий, корректируемых по времени. 

Побочный эффект буферизации заключается в том, что выходные данные **задерживаются на то же количество времени**. Значения можно настроить таким образом, чтобы сократить число неупорядоченных событий и обеспечить низкую задержку задания.

## <a name="get-help"></a>Получение справки
Дополнительную помощь вы можете получить на нашем [форуме Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/home?forum=AzureStreamAnalytics).

## <a name="next-steps"></a>Дальнейшие действия
* [Что такое Stream Analytics?](stream-analytics-introduction.md)
* [Приступая к работе с Azure Stream Analytics: выявление мошенничества в режиме реального времени](stream-analytics-real-time-fraud-detection.md)
* [Масштабирование заданий Azure Stream Analytics для повышения пропускной способности базы данных](stream-analytics-scale-jobs.md)
* [Stream Analytics Query Language Reference](https://msdn.microsoft.com/library/azure/dn834998.aspx) (Справочник по языку запросов Stream Analytics)
* [Stream Analytics management REST API reference](https://msdn.microsoft.com/library/azure/dn835031.aspx) (Справочник по API-интерфейсу REST для управления Stream Analytics)
