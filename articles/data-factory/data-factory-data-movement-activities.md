<properties
	pageTitle="Перемещение данных с помощью действия копирования | Microsoft Azure"
	description="Дополнительные сведения о перемещении данных в конвейерах фабрики данных: перенос данных между облачными хранилищами, а также между локальным и облачным хранилищами. Использование действия копирования."
	keywords="перемещение данных, перенос данных, копирование данных, передача данных"
	services="data-factory"
	documentationCenter=""
	authors="linda33wj"
	manager="jhubbard"
	editor="monicar"/>

<tags
	ms.service="data-factory"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="09/22/2016"
	ms.author="jingwang"/>

# Перемещение данных с помощью действия копирования

## Обзор
Фабрика данных Azure позволяет с помощью действия копирования копировать различные данные с разных локальных и облачных источников данных в Azure. После копирования данные можно подвергнуть дальнейшему преобразованию и анализу. С помощью действия копирования можно также публиковать результаты преобразования и анализа для бизнес-аналитики и использования приложения.

![Роль действия копирования](media/data-factory-data-movement-activities/copy-activity.png)

Действием копирования управляет защищенная, надежная, масштабируемая и [глобально доступная служба](#global). Эта статья содержит сведения о перемещении данных в фабрике данных и в рамках действия копирования.

Сначала давайте рассмотрим, как происходит перенос данных между двумя облачными хранилищами данных, а также между локальным и облачным хранилищами.

> [AZURE.NOTE] Общие сведения об определении действий см. в статье [Конвейеры и действия в фабрике данных Azure: создание конвейеров, цепочки действий и расписаний для них](data-factory-create-pipelines.md).

### Копирование данных из одного облачного хранилища в другое
Если источник и приемник данных расположены в облаке, то действие копирования (когда оно копирует данные из источника в приемник) проходит этапы, описанные ниже. Служба, на основе которой реализовано действие копирования, выполняет следующее:

1. Считывает данные из источника данных.
2. Выполняет сериализацию или десериализацию, сжатие или распаковку, сопоставление столбцов и преобразование данных из одного типа в другой. Она выполняет эти операции в соответствии с конфигурациями наборов входных данных, наборов выходных данных и действия копирования.
3.	Записывает данные в целевое хранилище данных.

Служба автоматически выбирает оптимальный регион для перемещения данных. Как правило, таким регионом является тот, который расположен ближе всего к приемнику данных.

![Копирование из облака в облако](./media/data-factory-data-movement-activities/cloud-to-cloud.png)


### Копирование данных из локального хранилища данных в облачное и наоборот
Для безопасного переноса данных между локальным хранилищем и облачным хранилищем данных, необходимо установить на локальный компьютер шлюз управления данными. Шлюз управления данными — это агент, обеспечивающий гибридное перемещение и обработку данных. Его можно установить на тот же компьютер, где находится хранилище данных, или на отдельную машину с доступом к этому хранилищу.

В этом случае сериализацию и десериализацию данных, сжатие и распаковку, сопоставление столбцов и преобразование типов выполняет шлюз управления данными. При этом данные не передаются через службу фабрики данных Azure. Наоборот, шлюз управления данными напрямую записывает данные в целевое хранилище.

![Копировать из локального хранилища в облако](./media/data-factory-data-movement-activities/onprem-to-cloud.png)

Общие сведения и пошаговые инструкции см. в статье [Перемещение данных между локальными источниками и облаком с помощью шлюза управления данными](data-factory-move-data-between-onprem-and-cloud.md). В статье [Шлюз управления данными](data-factory-data-management-gateway.md) содержатся подробные сведения об этом агенте.

Используя шлюз управления данными, можно также перемещать данные в поддерживаемые хранилища данных, расположенные на виртуальных машинах IaaS Azure, и из таких хранилищ. В этом случае шлюз управления данными можно установить на ту же виртуальную машину, где находится хранилище данных, или на отдельную виртуальную машину с доступом к этому хранилищу.

## Поддерживаемые хранилища данных и форматы
[AZURE.INCLUDE [data-factory-supported-data-stores](../../includes/data-factory-supported-data-stores.md)]

Если необходимо переместить данные в хранилище или из хранилища данных, которое не поддерживается действием копирования, вы можете использовать в фабрике данных **настраиваемое действие**. В нем для копирования и перемещения данных используется логика, которую задаете вы. Сведения о создании и использовании настраиваемого действия см. в статье [Использование настраиваемых действий в конвейере фабрики данных Azure](data-factory-use-custom-activities.md).

### Поддерживаемые форматы файлов
С помощью действия копирования можно копировать файлы "как есть" из одного файлового хранилища данных в другое (это такие хранилища, как большой двоичный объект Azure, файловая система и система HDFS). Для этого нужно пропустить [раздел формата](data-factory-create-datasets.md) в определениях наборов входных и выходных данных. Это позволяет эффективно копировать данные без какой-либо сериализации или десериализации.

Кроме того, действие копирования позволяет читать и записывать файлы таких форматов: текстовый формат, Avro, ORC, Parquet и JSON. Вы можете выполнять следующие действия копирования:

-	копирование данных в текстовом формате (CSV) из большого двоичного объекта Azure и запись в базу данных SQL Azure;
-	копирование файлов в текстовом формате (CSV) из локальной файловой системы и запись в большой двоичный объект Azure в формате AVRO;
-	копирование данных в базе данных SQL Azure и запись в локальную систему HDFS в формате ORC.



## <a name="global"></a>Глобально доступное перемещение данных
Фабрика данных Azure доступна только в западной части США, восточной части США и Северной Европе. А в регионах, приведенных ниже, служба, управляющая действием копирования, является общедоступной. Глобально доступная топология обеспечивает эффективное перемещение данных, обычно позволяя избежать "прыжков" по разным регионам. Чтобы узнать, доступны ли в регионе фабрика данных и перемещение данных, см. раздел [Службы по региону](https://azure.microsoft.com/regions/#services).

### Копирование данных из одного облачного хранилища данных в другое
Если источник и приемник данных расположены в облаке, для перемещения данных фабрика данных Azure использует развертывание службы в регионе, который наиболее приближен к расположению приемника. Сопоставления см. в следующей таблице.

Регион целевого хранилища данных | Регион, используемый для перемещения данных
:----------------------------------- | :----------------------------
Восток США | Восток США
Восток США 2 | Восток США 2
Запад США | Запад США
Западный регион США 2 | Запад США
Центральный регион США | Центральный регион США
Западно-центральная часть США | Центральный регион США
Северо-центральный регион США | Северо-центральный регион США
Южно-центральный регион США | Южно-центральный регион США
Северная Европа | Северная Европа
Западная Европа | Западная Европа
Юго-Восточная Азия | Юго-Восточная Азия
Восточная Азия | Юго-Восточная Азия
Восточная часть Японии | Восточная часть Японии
Западная часть Японии | Восточная часть Японии
Южная часть Бразилии | Южная часть Бразилии
Восточная часть Австралии | Восточная часть Австралии
Юго-Восточная часть Австралии | Юго-Восточная часть Австралии
Центральная Индия | Центральная Индия
Южная Индия | Центральная Индия
Западная Индия | Центральная Индия


> [AZURE.NOTE] Если регион целевого хранилища данных не указан в приведенном выше списке, то действие копирования не будет выполнено через другой регион и завершится ошибкой.

### Копирование данных из локального хранилища данных в облачное и наоборот
Когда данные копируются между локальным (виртуальные машины Azure/IaaS) и облачным хранилищами, [шлюз управления данными](data-factory-data-management-gateway.md) выполняет перемещение данных на локальном компьютере или виртуальной машине. Данные не проходят через службу в облако, если вы не используете функцию [промежуточного копирования](data-factory-copy-activity-performance.md#staged-copy). В таком случае данные проходят через промежуточное хранилище BLOB-объектов Azure и только потом записываются в хранилище-приемник данных.

## Создание конвейера с действием копирования
Создать конвейер с действием копирования можно несколькими способами, описанными ниже.

### С помощью мастера копирования
Мастер копирования фабрики данных помогает в создании конвейера с действием копирования. Этот конвейер позволяет копировать данные из поддерживаемых источников в места назначения *без создания определений JSON* для связанных служб, наборов данных и конвейеров. Сведения о мастере см. в статье [Мастер копирования фабрики данных](data-factory-copy-wizard.md).

### С помощью сценариев JSON
Вы можете использовать редактор фабрики данных на портале Azure, в Visual Studio или в Azure PowerShell, чтобы создать определение JSON для конвейера (используя действие копирования). Затем его можно развернуть с целью создания конвейера в фабрике данных. Пошаговые инструкции см. в учебнике [Копирование данных из хранилища BLOB-объектов Azure в базу данных SQL с помощью фабрики данных](data-factory-copy-data-from-azure-blob-storage-to-sql-database.md).

Свойства JSON (такие как имя, описание, входные и выходные таблицы, политики и т. д.) доступны для всех типов действий. Свойства, доступные в разделе `typeProperties` действия, зависят от конкретного типа действия.

Если используется действие копирования, свойства в разделе `typeProperties` зависят от типов источников и приемников. Щелкните источник или приемник в разделе [Поддерживаемые хранилища данных и форматы](#supported-data-stores), чтобы получить сведения о свойствах типа, поддерживаемых действием копирования для этого хранилища данных.

Ниже приведен пример определения JSON.

	{
	  "name": "ADFTutorialPipeline",
	  "properties": {
	    "description": "Copy data from Azure blob to Azure SQL table",
	    "activities": [
	      {
	        "name": "CopyFromBlobToSQL",
	        "type": "Copy",
	        "inputs": [
	          {
	            "name": "InputBlobTable"
	          }
	        ],
	        "outputs": [
	          {
	            "name": "OutputSQLTable"
	          }
	        ],
	        "typeProperties": {
	          "source": {
	            "type": "BlobSource"
	          },
	          "sink": {
	            "type": "SqlSink",
	            "writeBatchSize": 10000,
	            "writeBatchTimeout": "60:00:00"
	          }
	        },
	        "Policy": {
	          "concurrency": 1,
	          "executionPriorityOrder": "NewestFirst",
	          "retry": 0,
	          "timeout": "01:00:00"
	        }
	      }
	    ],
	    "start": "2016-07-12T00:00:00Z",
	    "end": "2016-07-13T00:00:00Z"
	  }
	}

Действия выполняются согласно расписанию, заданному в наборе выходных данных (например, **ежедневно**: частота — **день**, интервал — **1**). Действие копирует данные из входного набора данных (**источника**) в выходной набор данных (**приемник**).

Для действия копирования можно указать несколько входных наборов данных. Они используются для проверки зависимостей перед выполнением действия. Однако в целевой набор данных копируются только данные из первого набора данных. Дополнительные сведения см. в статье [Планирование и исполнение с использованием фабрики данных](data-factory-scheduling-and-execution.md).

## Производительность и настройка
См. статью [Руководство по настройке производительности действия копирования](data-factory-copy-activity-performance.md), в которой описываются ключевые факторы, влияющие на производительность перемещения данных (действие копирования) в фабрике данных Azure. В ней также приведены сведения о производительности, наблюдаемой во время внутреннего тестирования, и рассматриваются различные способы оптимизировать производительность действия копирования.

## Планирование и последовательное копирование
Подробные сведения о планировании и выполнении в фабрике данных см. в статье [Планирование и исполнение с использованием фабрики данных](data-factory-scheduling-and-execution.md). Несколько операций копирования можно выполнить друг за другом последовательно или упорядоченно. Сведения об упорядоченном копировании см. в соответствующем разделе [этой статьи](data-factory-scheduling-and-execution.md#ordered-copy).

## Преобразование типов
Различные хранилища данных используют разные собственные системы типов. Во время копирования типы источников автоматически преобразуются в типы приемников. Такое преобразование выполняется в два этапа.

1. Преобразование собственных типов источников в тип .NET.
2. Преобразование типа .NET в собственный тип приемника.

Сведения о сопоставлении собственных систем типов с типами .NET см. в статьях, посвященных соответствующим хранилищам данных. (Щелкните соответствующую ссылку в таблице [Поддерживаемые хранилища данных и форматы](#supported-data-stores)). Эти сопоставления позволяют выбрать подходящие типы при создании таблиц и обеспечить правильность преобразований в процессе копирования.


## Дальнейшие действия
- Дополнительные сведения о действии копирования см. в статье [Копирование данных из хранилища BLOB-объектов Azure в базу данных SQL с помощью фабрики данных](data-factory-copy-data-from-azure-blob-storage-to-sql-database.md).
- Чтобы узнать о перемещении данных из локального хранилища данных в облачное хранилище данных, ознакомьтесь со статьей [Перемещение данных между локальными источниками и облаком с помощью шлюза управления данными](data-factory-move-data-between-onprem-and-cloud.md).

<!---HONumber=AcomDC_0928_2016-->