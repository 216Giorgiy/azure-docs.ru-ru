---
title: Создание конвейера фабрики данных с помощью портала Azure | Документация Майкрософт
description: В этом руководстве описано, как с помощью портала Azure создать фабрику данных с конвейером. Этот конвейер использует действие копирования для копирования данных из хранилища BLOB-объектов Azure в базу данных SQL.
services: data-factory
documentationcenter: ''
author: linda33wj
manager: craigg
ms.reviewer: douglasl
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/21/2018
ms.author: jingwang
ms.openlocfilehash: d8e2d6f18ea1c66404ceed475d1522bd631961fb
ms.sourcegitcommit: 1d850f6cae47261eacdb7604a9f17edc6626ae4b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/02/2018
ms.locfileid: "39444561"
---
# <a name="copy-data-from-azure-blob-storage-to-a-sql-database-by-using-azure-data-factory"></a>Копирование данных из хранилища BLOB-объектов Azure в базу данных SQL Azure с помощью фабрики данных Azure
В этом руководстве вы создадите фабрику данных с помощью пользовательского интерфейса фабрики данных Azure. Конвейер этой фабрики данных копирует данные из хранилища BLOB-объектов Azure в базу данных SQL. Шаблон конфигурации в этом руководстве применяется к копированию из файлового в реляционное хранилище данных. Список хранилищ данных, которые поддерживаются в качестве источников и приемников, см. в таблице [Поддерживаемые хранилища данных и форматы](copy-activity-overview.md#supported-data-stores-and-formats).

> [!NOTE]
> - Если вы еще не работали с фабрикой данных, ознакомьтесь со статьей [Введение в фабрику данных Azure](introduction.md).

Вот какие шаги выполняются в этом учебнике:

> [!div class="checklist"]
> * Создали фабрику данных.
> * создание конвейера с действием копирования;
> * тестовый запуск конвейера;
> * активация конвейера вручную;
> * запуск конвейера по расписанию;
> * Мониторинг конвейера и выполнения действий.

## <a name="prerequisites"></a>Предварительные требования
* **Подписка Azure**. Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.
* **Учетная запись хранения Azure**. В этом руководстве в качестве *источника* будет использоваться хранилище BLOB-объектов. Если у вас нет учетной записи хранения, создайте ее, следуя действиям в [этом разделе](../storage/common/storage-create-storage-account.md#create-a-storage-account).
* **База данных SQL Azure**. Используйте базу данных как хранилище данных-*приемник*. Если у вас нет базы данных SQL, создайте ее, следуя указаниям в [этой статье](../sql-database/sql-database-get-started-portal.md).

### <a name="create-a-blob-and-a-sql-table"></a>Создание большого двоичного объекта и таблицы SQL

Теперь подготовьте хранилище больших двоичных объектов и базу данных SQL к изучению этого руководства, выполнив следующие действия.

#### <a name="create-a-source-blob"></a>Создание исходного большого двоичного объекта

1. Запустите Блокнот. Скопируйте следующий текст и сохраните его в файл **emp.txt** на диске.

    ```
    John,Doe
    Jane,Doe
    ```

1. Создайте контейнер с именем **adftutorial** в хранилище BLOB-объектов. Создайте папку **input** в этом контейнере. Затем отправьте файл **emp.txt** в папку **input**. Эти задачи можно выполнить с помощью портала Azure или специальных средств, таких как [Обозреватель службы хранилища Azure](http://storageexplorer.com/).

#### <a name="create-a-sink-sql-table"></a>Создание таблицы-приемника SQL

1. Используйте следующий скрипт SQL, чтобы создать таблицу **dbo.emp** в базе данных SQL.

    ```sql
    CREATE TABLE dbo.emp
    (
        ID int IDENTITY(1,1) NOT NULL,
        FirstName varchar(50),
        LastName varchar(50)
    )
    GO

    CREATE CLUSTERED INDEX IX_emp_ID ON dbo.emp (ID);
    ```

1. Предоставьте службам Azure доступ к серверу SQL Server. Убедитесь, что параметр **Разрешить доступ к службам Azure** имеет состояние **Вкл.** для вашего сервера SQL Server, чтобы фабрика данных могла записывать данные на него. Чтобы проверить и при необходимости включить этот параметр, сделайте следующее.

    a. Слева выберите **Больше служб** > **Серверы SQL**.

    b. Выберите сервер и щелкните **Брандмауэр** в разделе **Параметры**.

    c. На странице **Параметры брандмауэра** выберите **Вкл.** для параметра **Разрешить доступ к службам Azure**.

## <a name="create-a-data-factory"></a>Создание фабрики данных
На этом этапе вы создадите фабрику данных и запустите пользовательский интерфейс службы "Фабрика данных" для создания конвейера в фабрике данных. 

1. Откройте веб-браузер **Microsoft Edge** или **Google Chrome**. Сейчас только эти браузеры поддерживают пользовательский интерфейс фабрики данных.
1. В меню слева выберите **Создать** > **Данные и аналитика** > **Фабрика данных**. 
  
   ![Создание фабрики данных](./media/tutorial-copy-data-portal/new-azure-data-factory-menu.png)
1. На странице **Новая фабрика данных** в поле **Имя** введите **ADFTutorialDataFactory**. 
      
     ![Новая фабрика данных](./media/tutorial-copy-data-portal/new-azure-data-factory.png)
 
   Имя фабрики данных Azure должно быть *глобально уникальным*. Если вы увидите следующее сообщение об ошибке для поля имени, введите другое имя фабрики данных (например, ваше_имя_ADFTutorialBulkCopyDF). Дополнительные сведения о правилах именования артефактов фабрики данных см. в статье [Фабрика данных Azure — правила именования](naming-rules.md).
  
   ![Сообщение об ошибке](./media/tutorial-copy-data-portal/name-not-available-error.png)
1. Выберите **подписку** Azure, в рамках которой вы хотите создать фабрику данных. 
1. Для **группы ресурсов** выполните одно из следующих действий:
     
    a. Выберите **Использовать существующую**и укажите существующую группу ресурсов в раскрывающемся списке.

    b. Выберите **Создать новую**и укажите имя группы ресурсов. 
         
    Сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../azure-resource-manager/resource-group-overview.md). 
1. В качестве **версии** выберите **V2**.
1. В поле **Расположение** выберите расположение фабрики данных. В раскрывающемся списке отображаются только поддерживаемые расположения. Хранилища данных (например, служба хранилища Azure и база данных SQL) и вычислительные ресурсы (например, Azure HDInsight), используемые фабрикой данных, могут располагаться в других регионах.
1. Кроме того, установите флажок **Закрепить на панели мониторинга**. 
1. Нажмите кнопку **Создать**. 
1. На панели мониторинга вы увидите приведенный ниже элемент с состоянием **Deploying data factory** (Развертывание фабрики данных). 

    ![Плитка Deploying data factory (Развертывание фабрики данных)](media/tutorial-copy-data-portal/deploying-data-factory.png)
1. Когда завершится создание, откроется страница **Фабрика данных**, как показано на рисунке ниже.
   
    ![Домашняя страница фабрики данных](./media/tutorial-copy-data-portal/data-factory-home-page.png)
1. Выберите **Создание и мониторинг**, чтобы запустить на отдельной вкладке пользовательский интерфейс фабрики данных.

## <a name="create-a-pipeline"></a>Создание конвейера
На этом шаге вы создадите в фабрике данных конвейер с действием копирования. Это действие копирования копирует данные из хранилища BLOB-объектов в базу данных SQL. В предыдущем [руководстве](quickstart-create-data-factory-portal.md) вы создали конвейер, выполнив следующие действия:

1. Создание связанной службы. 
1. Создание входных и выходных наборов данных.
1. Создали конвейер.

В этом руководстве вы сразу приступите к созданию конвейера, а связанные службы и наборы данных будете создавать по мере необходимости для настройки конвейера. 

1. На странице **Начало работы** выберите **Create pipeline** (Создать конвейер). 

   ![Создание конвейера](./media/tutorial-copy-data-portal/create-pipeline-tile.png)
1. На вкладке **Общие** для конвейера введите **CopyPipeline** в качестве **имени** конвейера.

1. На панели элементов **Действия** разверните категорию **Поток данных** и перетащите действие **Копирование** из панели элементов в область конструктора конвейера. Введите **CopyFromBlobToSql** в поле **Имя**.

    ![Действие копирования](./media/tutorial-copy-data-portal/drag-drop-copy-activity.png)

### <a name="configure-source"></a>Настройка источника

1. Перейдите на вкладку **Источник**. Выберите **+ Создать**, чтобы создать исходный набор данных. 

1. В окне **Новый набор данных** выберите **Хранилище BLOB-объектов Azure** и щелкните **Готово**. Выберите **Хранилище BLOB-объектов** для исходного набора данных, потому что именно там находится источник данных. 

    ![Выбор хранилища](./media/tutorial-copy-data-portal/select-azure-blob-dataset.png)

1. Откроется новая вкладка для набора данных из большого двоичного объекта. На вкладке **Общие** в нижней части окна **Свойства** в поле **Имя** введите **SourceBlobDataset**.

    ![Имя набора данных](./media/tutorial-copy-data-portal/dataset-name.png)

1. Перейдите на вкладку **Подключение** в окне **Свойства**. Рядом с текстовым полем **Связанная служба** нажмите кнопку **+ Создать**. 

    ![Кнопка создания связанной службы](./media/tutorial-copy-data-portal/source-dataset-new-linked-service-button.png)

1. В окне**новая связанная служба** в качестве имени введите **AzureStorageLinkedService**, выберите учетную запись хранилища в списке **Имя учетной записи хранения**, а затем нажмите кнопку **Сохранить**, чтобы развернуть связанную службу.

    ![Новая связанная служба](./media/tutorial-copy-data-portal/new-azure-storage-linked-service.png)

1. После создания связанной службы снова откроются параметры набора данных. Рядом с полем **Путь к файлу** выберите **Обзор**.

    ![Кнопка обзора файлов](./media/tutorial-copy-data-portal/file-browse-button.png)

1. Перейдите к папке **adftutorial/input**, выберите файл **emp.txt** и нажмите кнопку **Готово**. 

    ![Выбор исходного файла](./media/tutorial-copy-data-portal/select-input-file.png)

1. Убедитесь, что для параметра **Формат файла** задано значение **Текстовый формат**, а в качестве **разделителя столбцов** указана **запятая (`,`)**. Если в исходном файле используются другие символы для разделения строк и столбцов, выберите **Detect Text Format** (Определить формат текста) в поле **Формат файла**. Средство копирования данных автоматически определит формат файла и символы разделителей. Но вы можете переопределить эти значения. Чтобы просмотреть данные на этой странице, выберите **Просмотр данных**.

    ![Определение формата текста](./media/tutorial-copy-data-portal/detect-text-format.png)

1. Перейдите на вкладку **Схема** в окне **Свойства** и нажмите кнопку **Импорт схемы**. Обратите внимание, что приложение обнаружило в исходном файле два столбца. Импорт схемы здесь нужен для того, чтобы сопоставить столбцы из исходного хранилища данных с целевым хранилищем данных. Если сопоставление столбцов вам не требуется, можете пропустить этот шаг. Для целей этого руководства импорт схемы нужен.

    ![Определение схемы источника](./media/tutorial-copy-data-portal/detect-source-schema.png)  

1. Теперь вернитесь в конвейер, откройте вкладку **Источник** и убедитесь, что выбран вариант **SourceBlobDataset**. Чтобы просмотреть данные на этой странице, выберите **Просмотр данных**. 
    
    ![Исходный набор данных](./media/tutorial-copy-data-portal/source-dataset-selected.png)

### <a name="configure-sink"></a>Настройка приемника

1. Перейдите на вкладку **Приемник** и выберите **+ Создать**, чтобы создать целевой набор данных. 

    ![Целевой набор данных](./media/tutorial-copy-data-portal/new-sink-dataset-button.png)
1. В окне **Новый набор данных** введите SQL в окне поиска, чтобы отфильтровать соединители, а затем выберите **База данных SQL Azure** и нажмите кнопку **Готово**. В этом руководстве вы будете копировать данные в базу данных SQL. 

    ![Выбор базы данных SQL](./media/tutorial-copy-data-portal/select-azure-sql-dataset.png)
1. Перейдите на вкладку **Общие** в окне **свойств** и введите **OutputSqlDataset** в поле **Имя**. 
    
    ![Имя целевого набора данных](./media/tutorial-copy-data-portal/output-dataset-name.png)
1. Перейдите на вкладку **Подключение** и рядом с полем **Связанная служба** выберите **+ Создать**. Связанную службу нужно сопоставить с набором данных. Связанная служба содержит строку подключения, которая потребуется фабрике данных для подключения к базе данных SQL в среде выполнения. Набор данных определяет контейнер, папку и (необязательно) файл, куда копируются данные. 
    
    ![Связанные службы](./media/tutorial-copy-data-portal/new-azure-sql-database-linked-service-button.png)       
1. В окне **New Linked Service** (Новая связанная служба) выполните следующие действия: 

    a. В поле **Имя** введите **AzureSqlDatabaseLinkedService**.

    b. В списке **Имя сервера** выберите необходимый экземпляр SQL Server.

    c. В списке **Имя базы данных** выберите базу данных SQL.

    d. В поле **Имя пользователя** введите имя пользователя.

    д. В поле **Пароль** введите пароль для этого пользователя.

    Е. Выберите **Проверить подключение**, чтобы проверить подключение.

    ж. Нажмите кнопку **Сохранить**, чтобы сохранить связанную службу. 
    
    ![Сохранение связанной службы](./media/tutorial-copy-data-portal/new-azure-sql-linked-service-window.png)

1. В поле **Таблица** выберите **[dbo].[emp]**. 

    ![Таблица](./media/tutorial-copy-data-portal/select-emp-table.png)
1. Перейдите на вкладку **Схема** и нажмите кнопку **Импорт схемы**. 

    ![Выбор импорта схемы](./media/tutorial-copy-data-portal/import-destination-schema.png)
1. Выберите столбец **Идентификатор**, а затем нажмите кнопку **Удалить**. Столбец **идентификатора** служит для идентификации данных в базе данных SQL, поэтому действие копирования не должно вставлять данные в этот столбец.

    ![Удаление столбца идентификатора](./media/tutorial-copy-data-portal/delete-id-column.png)
1. Перейдите на вкладку с конвейером и убедитесь, что в поле **Sink Dataset** (Целевой набор данных) выбрано значение **OutputSqlDataset**.

    ![Вкладка конвейера](./media/tutorial-copy-data-portal/pipeline-tab-2.png)        

### <a name="confugure-mapping"></a>Настройка сопоставления

Перейдите на вкладку **Сопоставление** в нижней части окна **свойств** и нажмите кнопку **Импорт схем**. Обратите внимание, что первый и второй столбцы в исходном файле сопоставляются с полями **FirstName** и **LastName** в базе данных SQL.

![Сопоставление схем](./media/tutorial-copy-data-portal/map-schemas.png)

## <a name="validate-the-pipeline"></a>Проверка конвейера
Чтобы проверить параметры конвейера, на панели инструментов выберите **Проверить**.
 
Чтобы отобразить код JSON, соответствующий конвейеру, щелкните **Код** в правом верхнем углу.

## <a name="debug-and-publish-the-pipeline"></a>Отладка и публикация конвейера
Вы можете отладить работу конвейера, прежде чем публиковать артефакты (связанные службы, наборы данных и конвейер) в фабрике данных или вашем собственном репозитории GIT Visual Studio Team Services. 

1. Чтобы выполнить отладку конвейера, на панели инструментов щелкните **Отладка**. Состояние выполнения конвейера вы можете найти на вкладке **Выходные данные** в нижней части окна. 

1. После успешного запуска конвейера в верхней панели инструментов выберите **Опубликовать все**. Это действие опубликует созданные сущности (наборы данных и конвейеры) в фабрике данных.

    ![Опубликовать](./media/tutorial-copy-data-portal/publish-button.png)

1. Дождитесь сообщения **Successfully published** (Публикация выполнена). Чтобы отобразить уведомления, щелкните **Показать уведомления** в правом верхнем углу (кнопка в виде колокольчика). 

## <a name="trigger-the-pipeline-manually"></a>Aктивация конвейера вручную
На этом шаге вы вручную запустите конвейер, опубликованный ранее. 

1. Выберите **Trigger** (Запустить) на панели инструментов, а затем **Trigger Now** (Запустить сейчас). На странице **Pipeline Run** (Запуск конвейера) нажмите кнопку **Готово**.  

1. Перейдите на вкладку **Мониторинг** слева. Вы увидите выполнение конвейера, которое вы только что активировали вручную. Ссылки в столбце **действий** позволят вам просмотреть подробные сведения о действиях и (или) повторно выполнить конвейер.

    ![Мониторинг выполнений конвейера](./media/tutorial-copy-data-portal/monitor-pipeline.png)
1. Чтобы просмотреть запуски действий, связанные с этим запуском конвейера, щелкните ссылку **View Activity Runs** (Просмотр запусков действий) в столбце **Действия**. В нашем примере определено только одно действие, поэтому в списке вы увидите только одну запись. Чтобы увидеть сведения об операции копирования, щелкните ссылку **Сведения** (значок очков) в столбце **Действия**. Выберите **Конвейеры** в верхней части окна, чтобы вернуться к представлению **Pipeline Runs** (Запуски конвейера). Чтобы обновить список, нажмите кнопку **Обновить**.

    ![Мониторинг выполнений действий](./media/tutorial-copy-data-portal/view-activity-runs.png)
1. Убедитесь, что в таблицу **emp** в базе данных SQL добавлены две новые строки. 

## <a name="trigger-the-pipeline-on-a-schedule"></a>запуск конвейера по расписанию;
В этом разделе вы создадите триггер планировщика для выполнения конвейера. Этот триггер запускает конвейер по определенному расписанию (каждый час или каждый день). В этом примере вы настроите триггер, который выполняется каждую минуту до указанного времени окончания. 

1. Перейдите на вкладку **Автор** слева над вкладкой монитора. 

1. Перейдите в конвейер, щелкните **Триггер** на панели инструментов и выберите **Создать/изменить**. 

1. В окне **Add Triggers** (Добавление триггеров) нажмите кнопку **Choose trigger** (Выбрать триггер), а затем — **+ Создать**. 

    ![Кнопка «Создать»](./media/tutorial-copy-data-portal/add-trigger-new-button.png)
1. В окне **New Trigger** (Создание триггера) выполните следующие действия. 

    a. В поле **Имя** введите **RunEveryMinute**.

    b. В разделе **Окончание** выберите **Дата**.

    c. Разверните раскрывающийся список в поле **End On** (Время окончания).

    d. Выберите параметр **текущей даты**. По умолчанию здесь устанавливается следующий день.

    д. Измените часть, обозначающую **минуты**, чтобы время окончания всего на несколько минут отличалось от текущих значений даты и времени. Триггер начнет работу только после публикации изменений. Если вы настроите разницу всего в одну-две минуты и не успеете за это время опубликовать триггер, он не будет выполнен.

    Е. Нажмите кнопку **Применить**. 

    ![Свойства триггера](./media/tutorial-copy-data-portal/set-trigger-properties.png)

    ж. Выберите элемент **Активировано**. С помощью этого флажка вы можете в любой момент отключить и включить триггер.

    h. Щелкните **Далее**.

    ![Кнопка "Активировано"](./media/tutorial-copy-data-portal/trigger-activiated-next.png)

    > [!IMPORTANT]
    > Каждое выполнение конвейера оплачивается. Поэтому здесь важно правильно указать дату окончания. 
1. Прочитайте предупреждение на странице **Trigger Run Parameters** (Параметры запуска триггера) и выберите **Готово**. Конвейер в этом примере не принимает параметры. 

    ![Параметры запуска триггера](./media/tutorial-copy-data-portal/trigger-pipeline-parameters.png)

1. Щелкните **Опубликовать все**, чтобы опубликовать изменения. 

1. Перейдите на вкладку **Мониторинг** слева, чтобы увидеть активированные выполнения конвейера. 

    ![Активированные выполнения конвейера](./media/tutorial-copy-data-portal/triggered-pipeline-runs.png)    
1. Чтобы перейти от представления **запусков конвейера** к представлению **запусков триггера**, выберите **Pipeline Runs** (Запуски конвейеров), а затем — **Trigger Runs** (Запуски триггеров).
    
    ![Выполнения триггеров](./media/tutorial-copy-data-portal/trigger-runs-menu.png)
1. Вы увидите в списке выполнения своего триггера. 

    ![Список выполнений триггеров](./media/tutorial-copy-data-portal/trigger-runs-list.png)
1. Проследите, как в таблицу **emp** добавляются по две строки в минуту (для каждого выполнения конвейера) вплоть до указанного времени окончания. 

## <a name="next-steps"></a>Дополнительная информация
В этом примере конвейер копирует данные из одного расположения в другое в хранилище BLOB-объектов. Вы научились выполнять следующие задачи: 

> [!div class="checklist"]
> * Создали фабрику данных.
> * создание конвейера с действием копирования;
> * тестовый запуск конвейера;
> * активация конвейера вручную;
> * запуск конвейера по расписанию;
> * Мониторинг конвейера и выполнения действий.


Перейдите к следующему руководству, чтобы узнать о копировании данных из локальной среды в облако: 

> [!div class="nextstepaction"]
>[Копирование данных из локальной базы данных SQL Server в хранилище BLOB-объектов Azure с помощью средства копирования данных](tutorial-hybrid-copy-portal.md)
