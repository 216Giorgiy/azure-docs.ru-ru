---
title: Загрузка данных из SAP Business Warehouse с помощью фабрики данных Azure | Документация Майкрософт
description: С помощью фабрики данных Azure копировать данные из SAP Business Warehouse (BW)
services: data-factory
documentationcenter: ''
author: linda33wj
manager: craigg
ms.reviewer: ''
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.date: 03/19/2019
ms.author: jingwang
ms.openlocfilehash: 9458903378576a50db9be92b9377987829e1ba41
ms.sourcegitcommit: dec7947393fc25c7a8247a35e562362e3600552f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2019
ms.locfileid: "58200163"
---
# <a name="load-data-from-sap-business-warehouse-bw-by-using-azure-data-factory"></a>Загрузка данных из SAP Business Warehouse (BW) с помощью фабрики данных Azure

В этой статье показано Пошаговое руководство по использованию фабрики данных _загрузка данных из SAP Business Warehouse (BW) с помощью Open вещей Gen2 хранилища Озера данных Azure_. Можно выполнить аналогичные действия для копирования данных в другом [поддерживаемые приемники хранилища данных](copy-activity-overview.md#supported-data-stores-and-formats). 

> [!TIP]
> Ссылаться на [статье соединителя SAP BW, откройте Центр](connector-sap-business-warehouse-open-hub.md) на копирование данных из SAP BW, как правило, в том числе Общие сведения о SAP BW, откройте Центр интеграции и разностных извлечения потока.

## <a name="prerequisites"></a>Технические условия

- **Фабрика данных Azure (ADF):** Если у вас нет фабрики данных, выполните "[создать фабрику данных](quickstart-create-data-factory-portal.md#create-a-data-factory)" раздела, чтобы создать его. 

- **SAP BW откройте концентратор назначения (OHD) с целевой тип в виде «Таблица базы данных».** Выполните [конфигураций SAP BW открыть назначение концентратора](#sap-bw-open-hub-destination-configurations) разделе для создания или для подтверждения, если ваш существующий OHD настроен правильно для интеграции с помощью ADF.

- **SAP BW пользователю, используемому необходимо иметь следующие разрешения:**

  - Авторизация в RFC и SAP BW.
  - Разрешения для "**выполнение**«Действие авторизации объекта»**S_SDSAUTH**«.

- **[Резидентное размещение среды выполнения интеграции](concepts-integration-runtime.md#self-hosted-integration-runtime) с помощью соединителя SAP .NET 3.0 являются обязательными**. Ниже приведены подробные подготовительные действия, которые необходимо выполнить.

  1. Установка и регистрация локальной IR с помощью версии > = 3.13 (как описано в следующем пошаговом руководстве). 

  2. Скачайте [соединитель .NET 3.0 для 64-разрядных SAP](https://support.sap.com/en/product/connectors/msnet.html) с веб-сайта компании SAP и установите его на компьютере, где выполняется локальная среда выполнения Интеграции.  При установке, в окне «этапы установки» убедитесь, что выбран «**Установка сборок в глобальный кэш СБОРОК**"как показано на следующем рисунке.

     ![Настройка соединителя SAP .NET](media/connector-sap-business-warehouse-open-hub/install-sap-dotnet-connector.png)

## <a name="full-copy-from-sap-bw-open-hub"></a>Полная копия из SAP BW, откройте Центр

На портале Azure выберите свою фабрику данных -> выберите **Создание и мониторинг** для запуска на отдельной вкладке пользовательский Интерфейс фабрики данных AZURE. 

1. Чтобы запустить средство копирования данных, на странице **Let's get started** (Начало работы) выберите **Копирование данных**. 

2. На **свойства** , определите имя **имя задачи** и выберите **Далее**.

3. На **исходного хранилища данных** щелкните **+ создать новое соединение** -> выберите **SAP BW, откройте Центр** из коллекции соединитель -> выберите **Продолжить**. «SAP» можно ввести в поле поиска для фильтрации соединители.

4. На **укажите SAP BW откройте концентратора** странице 

   ![Создание службы SAP BW откройте Центр связанный](media/load-sap-bw-data/create-sap-bw-open-hub-linked-service.png)

   1. Выберите **подключиться через среду выполнения интеграции**: щелкните стрелку раскрывающегося списка для выбора имеющейся среды выполнения Интеграции локальную среду или создайте его, если у вас нет локальной IR, еще не настроена. 

      Для создания новых, нажмите кнопку **+ создать** в раскрывающемся списке "->" Выбор типа **резидентным** "->" укажите **имя** и нажмите кнопку **Далее** -> выберите **Экспресс-установка** для установки на текущем компьютере, или выполните **установку вручную** там шаги.

      Как упоминалось в [предварительные требования](#prerequisites), убедитесь, что у вас также есть **соединителя SAP .NET 3.0** установлен на том же компьютере, где выполняется локальная среда выполнения Интеграции.

   2. Укажите SAP BW **имя_сервера**, **номер системы**, **идентификатор клиента,** **языка** (если отличные от EN), **имя пользователя**, и **пароль**.

   3. Щелкните **Проверить подключение**, чтобы проверить настройки, а затем нажмите кнопку **Готово**.

   4. Появится новое соединение. Щелкните **Далее**.

5. На **назначения выберите Открыть центр** странице Обзор откройте назначения концентратора, доступные на вашей SAP BW и выберите тот, который вы хотите скопировать данные из, а затем нажмите кнопку **Далее**.

   ![Выберите таблицу, откройте Центр SAP BW](media/load-sap-bw-data/select-sap-bw-open-hub-table.png)

6. При необходимости задайте фильтр. Если ваш открыть назначение концентратора содержит только данные из одного выполнения процесса передачи данных (DTP) с Идентификатором одного запроса или действительно завершения вашей DTP и хотите скопировать все данные, снимите флажок **исключить последнего запроса**. Вы узнаете, более на том, как эти параметры относятся к конфигурации SAP BW в [конфигураций SAP BW открыть назначение концентратора](#sap-bw-open-hub-destination-configurations) раздел. Нажмите кнопку **Validate** внимательно проверьте данные возвращаются, затем выберите **Далее**.

   ![Настройка фильтра откройте Центр SAP BW](media/load-sap-bw-data/configure-sap-bw-open-hub-filter.png)

7. В **целевое хранилище данных** щелкните **+ создать новое соединение**, а затем выберите **Gen2 хранилища Озера данных Azure**и выберите **Продолжить**.

8. В **подключения укажите хранилище Azure Data Lake** странице 

   ![Создайте ADLS Gen2 связанной службы](media/load-sap-bw-data/create-adls-gen2-linked-service.png)

   1. Выберите учетную запись может Gen2 хранилища Озера данных из раскрывающегося списка «Имя учетной записи хранения».
   2. Выберите **Готово**, чтобы создать подключение. Затем нажмите кнопку **Далее**.

9. В **Выбор выходного файла или папки** странице, введите «copyfromopenhub» в качестве имени папки выходных данных и выберите **Далее**.

   ![Выберите папку выходных данных](media/load-sap-bw-data/choose-output-folder.png)

10. В **параметр формата файла** выберите **Далее** использовать параметры по умолчанию.

    ![Укажите формат в качестве приемника](media/load-sap-bw-data/specify-sink-format.png)

11. В **параметры** странице, разверните узел **параметры производительности**и задайте **степень параллелизма копирования** например 5, чтобы загрузить из SAP BW в параллельном режиме. Нажмите кнопку **Далее**.

    ![Настройте параметры копирования](media/load-sap-bw-data/configure-copy-settings.png)

12. В **Сводка** странице просмотрите параметры и выберите **Далее**.

13. В **развертывания** выберите **монитор** для мониторинга конвейера.

    ![Страница развертывания](media/load-sap-bw-data/deployment.png)

14. Обратите внимание, что слева автоматически выбирается вкладка **Мониторинг**. В столбце **Actions** (Действия) содержатся ссылки на сведения о выполнении действий или повторный запуск конвейера:

    ![Мониторинг конвейера](media/load-sap-bw-data/pipeline-monitoring.png)

15. Щелкните ссылку **View Activity Runs** (Просмотр выполнений действий) в столбце **Actions** (Действия), чтобы просмотреть выполнения действий, связанные с этим запуском конвейера. В этом конвейере определено только одно действие (действие копирования), поэтому вы увидите только одну запись. Чтобы вернуться к представлению запусков конвейера, щелкните ссылку **Конвейеры** в верхней части окна. Щелкните **Обновить**, чтобы обновить список.

    ![Мониторинг активности](media/load-sap-bw-data/activity-monitoring.png)

16. Чтобы отслеживать сведения о выполнении каждого действия копирования, щелкните ссылку **Сведения** (изображение очков) в разделе **Действия** в представлении мониторинга действия. Вы можете отслеживать такие сведения, как объем данных, копируемых из источника в приемник, пропускная способность данных, шаги выполнения с длительностью и используемые параметры:

    ![Сведения о наблюдении за действие](media/load-sap-bw-data/activity-monitoring-details.png)

17. Просмотрите **максимальный идентификатор запроса** , копируется. Вернитесь в представлении мониторинга действия, нажмите кнопку **вывода** под **действия**.

    ![Выходные данные действия](media/load-sap-bw-data/activity-output.png)

    ![Сведения о выходных данных действия](media/load-sap-bw-data/activity-output-details.png)

## <a name="incremental-copy-from-sap-bw-open-hub"></a>Добавочное копирование из SAP BW, откройте Центр

> [!TIP]
>
> Ссылаться на [поток извлечения разностных соединителя SAP BW, откройте Центр](connector-sap-business-warehouse-open-hub.md#delta-extraction-flow) Дополнительные сведения о работе соединителя откройте Центр ADF SAP BW для копирования добавочных данных из SAP BW и прочтите эту статью с самого начала, чтобы разобраться в основах разъемами конфигурации.

Теперь давайте продолжить настройку добавочного копирования из SAP BW откройте концентратора. 

Добавочная копия использует механизм верхнего предела на основе **идентификатор запроса** автоматически созданный в SAP BW открыть назначение концентратора DTP. Рабочий процесс для этого подхода показан на следующей схеме:

![Добавочное копирование рабочего процесса](media/load-sap-bw-data/incremental-copy-workflow.png)

В пользовательском Интерфейсе фабрики данных AZURE **приступим к работе** выберите **Создание конвейера с помощью шаблона** использовать встроенный шаблон. 

1. Выполните поиск «SAP BW», чтобы найти и выбрать шаблон, с именем **добавочное копирование из SAP BW в Gen2 хранилища Озера данных Azure**. Этот шаблон копирует данные в ADLS Gen2, позже можно выполнить аналогичные поток будет копировать в другие типы в качестве приемника.

2. На главной странице шаблона, выберите или создайте следующие три подключения, а затем выберите **этот шаблон используется** внизу справа.

   - **BLOB-объектов Azure**: в этом пошаговом руководстве мы используем BLOB-объектов Azure для хранения верхнего предела, который является идентификатором max скопированный запроса.
   - **Откройте центр SAP BW**: Копировать данные из источника. Обратитесь к предыдущему пошаговому руководству полную копию на Подробная конфигурация.
   - **2-го поколения ADLS**: приемника для копирования данных. Обратитесь к предыдущему пошаговому руководству полную копию на Подробная конфигурация.

   ![Добавочное копирование из шаблона SAP BW](media/load-sap-bw-data/incremental-copy-from-sap-bw-template.png)

3. Этот шаблон создает конвейер с действиями три - **просмотра, копирования данных и веб-** - и делает их по цепочке при успешном выполнении. Перейдите в конвейер **параметры** отображается все конфигурации, необходимо предоставить.

   ![Добавочное копирование из файла конфигурации SAP BW](media/load-sap-bw-data/incremental-copy-from-sap-bw-pipeline-config.png)

   - **SAPOpenHubDestinationName**: укажите имя таблицы откройте центр, чтобы скопировать данные из.

   - **ADLSGen2SinkPath**: укажите путь ADLS 2-го поколения, чтобы скопировать данные. Если путь не существует, действие копирования ADF будет создан во время выполнения.

   - **HighWatermarkBlobPath**: укажите путь для хранения значения верхнего предела, например `container/path`. 

   - **HighWatermarkBlobName**: укажите имя большого двоичного объекта для хранения значения верхнего предела, например `requestIdCache.txt`. В хранилище больших двоичных объектов в соответствующие пути HighWatermarkBlobPath + HighWatermarkBlobName например "*container/path/requestIdCache.txt*«, создайте большой двоичный объект с содержимым 0. 

      ![Содержимое BLOB-объекта](media/load-sap-bw-data/blob.png)

   - **LogicAppURL**: в этом шаблоне мы используем веб-действие для вызова приложения логики, чтобы задать значения верхнего предела в хранилище BLOB-объектов. В качестве альтернативы можно также использовать базы данных SQL хранить его и использовать действия хранимой процедуры для обновления значения. 

      Здесь, необходимо сначала создать приложение логики, как показано ниже, затем скопируйте **URL-адрес HTTP POST** в это поле. 

      ![Конфигурация приложения логики](media/load-sap-bw-data/logic-app-config.png)

      1. Перейти на портал Azure -> создать **Logic Apps** службы, а затем щелкните **+ пустое приложение логики** к **конструктор Logic Apps**.

      2. Создать триггер для **получено при HTTP-запроса**. Укажите HTTP-запроса следующим образом:

         ```json
         {
            "properties": {
               "sapOpenHubMaxRequestId": {
                  "type": "string"
               },
               "type": "object"
            }
         }
         ```

      3. Добавьте действие **создать BLOB-объект**. «Путь к папке» и «Имя BLOB-объектов» используйте то же значение, настроенные в выше HighWatermarkBlobPath и HighWatermarkBlobName.

      4. Нажмите кнопку **Сохранить**, а затем скопируйте значение **URL-адрес HTTP POST** для использования в конвейере фабрики данных AZURE.

4. После ввода всех значений для параметров конвейера ADF, можно щелкнуть **Отладка** -> **Готово** вызвать выполнение, чтобы проверить конфигурацию. Или можно выбрать **опубликовать все** опубликовать все изменения, а затем **триггера** для выполнения запуска.

## <a name="sap-bw-open-hub-destination-configurations"></a>Конфигурации SAP BW открыть назначение концентратора

Для использования соединителя SAP BW, откройте центр в ADF, чтобы скопировать данные в этом разделе представлены необходимые настройки на стороне SAP BW.

### <a name="configure-delta-extraction-in-sap-bw"></a>Настройка дельта извлечения в SAP BW

Если требуется исторические копии и добавочного копирования или только добавочное копирование, настройте разностных извлечения в SAP BW.

1. Создайте открытое назначение концентратора (OHD)

   Можно создать OHD в транзакции RSA1 SAP, который автоматически создает необходимые преобразования и процесс передачи данных (DTP). Используйте следующие параметры:

   - Тип объекта может быть любым. Здесь в качестве примера мы используем InfoCube.
   - **Тип назначения:** *Таблицы базы данных*
   - **Ключ таблицы:** *Технические ключ*
   - **Извлечения:** *Сохранить данные и вставить записи в таблицу*

   ![Создание разностных извлечения SAP BW OHD](media/load-sap-bw-data/create-sap-bw-ohd-delta.png)

   ![create-sap-bw-ohd-delta2](media/load-sap-bw-data/create-sap-bw-ohd-delta2.png)

   Можно увеличить число одновременно выполняющихся SAP рабочих процессов для DTP:

   ![Создание sap-bw-ohd-delta3](media/load-sap-bw-data/create-sap-bw-ohd-delta3.png)

2. Расписание DTP в цепочек процессов

   Дельта DTP для куба работает, только если требуется строк не сжаты еще. Таким образом необходимо убедиться в том, сжатие кубов BW недоступность перед DTP таблицу откройте Центр. Самым простым способом для этого является интеграция этого DTP в вашей существующей цепочек процессов. В приведенном ниже примере DTP (чтобы OHD) вставляется в цепочку процессов между шагом Adjust (составного сводного) и Collapse (куба сжатия).

   ![Создание sap-bw--цепочки процессов](media/load-sap-bw-data/create-sap-bw-process-chain.png)

### <a name="configure-full-extraction-in-sap-bw"></a>Настройка полного извлечения в SAP BW

Помимо извлечения разностных может потребоваться полное извлечение из же InfoProvider. Обычно применяется, если вы хотите осуществлять полное копирование без необходимости добавочное или вы хотите [повторную синхронизацию изменений извлечения](#re-sync-delta-extraction).

Для одной OHD не должны более одного DTP. Таким образом необходимо создать дополнительные OHD, а затем разностный извлечения.

![Создание sap-bw-ohd-full](media/load-sap-bw-data/create-sap-bw-ohd-full.png)

Для полной загрузки OHD выберите различных параметров, чем извлечение изменений:

- В OHD: задать параметр «Извлечение» как "*удаление данных и вставить записи*«. В противном случае данные распаковки многократно при повторяющихся DTP в цепочку процесса BW.

- В DTP: режим «извлечение» как "*полный*«. Сразу после создания OHD, необходимо изменить автоматически созданный DTP результате изменений в состояние Full:

   ![create-sap-bw-ohd-full2](media/load-sap-bw-data/create-sap-bw-ohd-full2.png)

- В соединителе откройте Центр ADF SAP BW: отключить параметр "*последнего запроса исключения*«. В противном случае ничего не будет извлекаться. 

Обычно выполняется полное DTP вручную. Или можно также создать цепочку процессов для полной DTP — обычно было бы цепочку отдельный процесс, независимо от вашей существующей цепочек процессов. В любом случае необходимо **убедитесь, что DTP завершено перед началом извлечения с помощью ADF copy**, в противном случае будут скопированы часть данных.

### <a name="run-delta-extraction-the-first-time"></a>Выполните извлечение разностных первый раз

С технической точки зрения является первой извлечения разностных **полного извлечения**. С помощью соединителя ADF SAP BW откройте концентратора по умолчанию исключает последнего запроса, при копировании данных. В случае извлечения дельта в первый раз, в действии копирования фабрики данных AZURE, данные не будут извлечены до последующих DTP создает разностные данные в таблице с идентификатором отдельный запрос. Хотя существует два возможных способа избежать этого сценария:

1. Отключите параметр «Исключить последнего запроса» для первого разностных извлечения в данном случае вам необходимо убедиться, что завершение первый DTP изменений перед запуском извлечения дельта в первый раз
2. Используйте процедуру повторно синхронизации изменений извлечения, как описано ниже.

### <a name="re-sync-delta-extraction"></a>Извлечение повторной синхронизации изменений

Существует несколько сценариев, в которых изменения данных в кубах SAP BW, но не учитываются DTP разностных:

- SAP BW выборочного удаления (с помощью любое условие фильтра строк)
- SAP BW запрос на удаление (неисправного запрос)

Открыть назначение концентратора SAP не управлением данных киоска данных является целевым (во все версии SAP BW поддержки с момента 2015 г.). Таким образом можно удалить данные из куба без изменения данных в OHD. В этом случае необходимо повторно синхронизировать данные куба с данными в ADF, выполнив следующие действия:

1. Выполнить полное извлечение в ADF (с помощью полного DTP в SAP)
2. Удалите все строки в таблице откройте центр для разностных DTP
3. Установка статуса DTP разностных выбрано

После этого всех последующих разностных DTPs и извлечения разностных ADF работать должным образом.

Состояние разностной DTP можно присвоить выбрано, выполнив DTP разностных, вручную, используя следующий параметр: "*Без передачи данных; Состояние изменений в источнике: Извлечь*«.

## <a name="next-steps"></a>Дальнейшие действия

Перейдите к следующей статье о поддержке соединителя SAP BW, откройте центр: 

> [!div class="nextstepaction"]
>[Соединитель SAP Business хранилище Open Hub](connector-sap-business-warehouse-open-hub.md)
