---
title: Загрузка данных из SAP Business Warehouse с помощью фабрики данных Azure | Документация Майкрософт
description: С помощью фабрики данных Azure копировать данные из SAP Business Warehouse (BW)
services: data-factory
documentationcenter: ''
author: linda33wj
manager: craigg
ms.reviewer: ''
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.date: 03/08/2019
ms.author: jingwang
ms.openlocfilehash: 63ce3587a2c48e7e03503e50a548ed372f511e37
ms.sourcegitcommit: 2d0fb4f3fc8086d61e2d8e506d5c2b930ba525a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/18/2019
ms.locfileid: "58082064"
---
# <a name="load-data-from-sap-business-warehouse-bw-by-using-azure-data-factory"></a>Загрузка данных из SAP Business Warehouse (BW) с помощью фабрики данных Azure

В этой статье показано Пошаговое руководство по использованию фабрики данных _загрузка данных из SAP Business Warehouse (BW) с помощью Open вещей Gen2 хранилища Озера данных Azure_. Можно выполнить аналогичные действия для копирования данных в другом [поддерживаемые приемники хранилища данных](copy-activity-overview.md#supported-data-stores-and-formats). 

> [!TIP]
> Ссылаться на [статье соединителя SAP BW, откройте Центр](connector-sap-business-warehouse-open-hub.md) на копирование данных из SAP BW, как правило, в том числе Общие сведения о SAP BW, откройте Центр интеграции и разностных извлечения потока.

## <a name="prerequisites"></a>Технические условия

- **Фабрика данных Azure (ADF):** Если у вас нет фабрики данных, выполните "[создать фабрику данных](quickstart-create-data-factory-portal.md#create-a-data-factory)" раздела, чтобы создать его. 

- **SAP BW откройте концентратор назначения (OHD) с целевой тип в виде «Таблица базы данных».** Выполните [конфигураций SAP BW открыть назначение концентратора](#sap-bw-open-hub-destination-configurations) разделе для создания или для подтверждения, если ваш существующий OHD настроен правильно для интеграции с помощью ADF.

- **SAP BW пользователю, используемому необходимо иметь следующие разрешения:**

  - Авторизация в RFC и SAP BW.
  - Разрешения для "**выполнение**«Действие авторизации объекта»**S_SDSAUTH**«.

- **[Резидентное размещение среды выполнения интеграции](concepts-integration-runtime.md#self-hosted-integration-runtime) с помощью соединителя SAP .NET 3.0 являются обязательными**. Ниже приведены подробные подготовительные действия, которые необходимо выполнить.

  1. Установка и регистрация локальной IR с помощью версии > = 3.13 (как описано в следующем пошаговом руководстве). 

  2. Скачайте [соединитель .NET 3.0 для 64-разрядных SAP](https://support.sap.com/en/product/connectors/msnet.html) с веб-сайта компании SAP и установите его на компьютере, где выполняется локальная среда выполнения Интеграции.  При установке, в окне «этапы установки» убедитесь, что выбран «**Установка сборок в глобальный кэш СБОРОК**"как показано на следующем рисунке.

     ![Настройка соединителя SAP .NET](media/connector-sap-business-warehouse-open-hub/install-sap-dotnet-connector.png)

## <a name="full-copy-from-sap-bw-open-hub"></a>Полная копия из SAP BW, откройте Центр

На портале Azure выберите свою фабрику данных -> выберите **Создание и мониторинг** для запуска на отдельной вкладке пользовательский Интерфейс фабрики данных AZURE. 

1. Чтобы запустить средство копирования данных, на странице **Let's get started** (Начало работы) выберите **Копирование данных**. 

2. На **свойства** , определите имя **имя задачи** и выберите **Далее**.

3. На **исходного хранилища данных** щелкните **+ создать новое соединение** -> выберите **SAP BW, откройте Центр** из коллекции соединитель -> выберите **Продолжить**. «SAP» можно ввести в поле поиска для фильтрации соединители.

4. На **укажите SAP BW откройте концентратора** странице 

   ![Создание службы SAP BW откройте Центр связанный](media/load-sap-bw-data/create-sap-bw-open-hub-linked-service.png)

   1. Выберите **подключиться через среду выполнения интеграции**: щелкните стрелку раскрывающегося списка для выбора имеющейся среды выполнения Интеграции локальную среду или создайте его, если у вас нет локальной IR, еще не настроена. 

      Для создания новых, нажмите кнопку **+ создать** в раскрывающемся списке "->" Выбор типа **резидентным** "->" укажите **имя** и нажмите кнопку **Далее** -> выберите **Экспресс-установка** для установки на текущем компьютере, или выполните **установку вручную** там шаги.

      Как упоминалось в [предварительные требования](#prerequisites), убедитесь, что у вас также есть **соединителя SAP .NET 3.0** установлен на том же компьютере, где выполняется локальная среда выполнения Интеграции.

   2. Укажите SAP BW **имя_сервера**, **номер системы**, **идентификатор клиента,** **языка** (если отличные от EN), **имя пользователя**, и **пароль**.

   3. Щелкните **Проверить подключение**, чтобы проверить настройки, а затем нажмите кнопку **Готово**.

   4. Появится новое соединение. Щелкните **Далее**.

5. На **назначения выберите Открыть центр** странице Обзор откройте назначения концентратора, доступные на вашей SAP BW и выберите тот, который вы хотите скопировать данные из, а затем нажмите кнопку **Далее**.

   ![Выберите таблицу, откройте Центр SAP BW](media/load-sap-bw-data/select-sap-bw-open-hub-table.png)

6. При необходимости задайте фильтр. Если ваш открыть назначение концентратора содержит только данные из одного выполнения процесса передачи данных (DTP) с Идентификатором одного запроса или действительно завершения вашей DTP и хотите скопировать все данные, снимите флажок **исключить последнего запроса**. Вы узнаете, более на том, как эти параметры относятся к конфигурации SAP BW в [конфигураций SAP BW открыть назначение концентратора](#sap-bw-open-hub-destination-configurations) раздел. Нажмите кнопку **Validate** внимательно проверьте данные возвращаются, затем выберите **Далее**.

   ![Настройка фильтра откройте Центр SAP BW](media/load-sap-bw-data/configure-sap-bw-open-hub-filter.png)

7. В **целевое хранилище данных** щелкните **+ создать новое соединение**, а затем выберите **Gen2 хранилища Озера данных Azure**и выберите **Продолжить**.

8. В **подключения укажите хранилище Azure Data Lake** странице 

   ![Создайте ADLS Gen2 связанной службы](media/load-sap-bw-data/create-adls-gen2-linked-service.png)

   1. Из раскрывающегося списка "Имя учетной записи хранения" выберите соответствующую учетную запись Data Lake Storage Gen2.
   2. Выберите **Готово**, чтобы создать подключение. Затем нажмите кнопку **Далее**.

9. В **Выбор выходного файла или папки** странице, введите «copyfromopenhub» в качестве имени папки выходных данных и выберите **Далее**.

   ![Выберите папку выходных данных](media/load-sap-bw-data/choose-output-folder.png)

10. В **параметр формата файла** выберите **Далее** использовать параметры по умолчанию.

    ![Укажите формат в качестве приемника](media/load-sap-bw-data/specify-sink-format.png)

11. В **параметры** странице, разверните узел **параметры производительности**и задайте **степень параллелизма копирования** например 5, чтобы загрузить из SAP BW в параллельном режиме. Нажмите кнопку **Далее**.

    ![Настройте параметры копирования](media/load-sap-bw-data/configure-copy-settings.png)

12. В **Сводка** странице просмотрите параметры и выберите **Далее**.

13. В **развертывания** выберите **монитор** для мониторинга конвейера.

    ![Страница развертывания](media/load-sap-bw-data/deployment.png)

14. Обратите внимание, что слева автоматически выбирается вкладка **Мониторинг**. В столбце **Actions** (Действия) содержатся ссылки на сведения о выполнении действий или повторный запуск конвейера:

    ![Мониторинг конвейера](media/load-sap-bw-data/pipeline-monitoring.png)

15. Щелкните ссылку **View Activity Runs** (Просмотр выполнений действий) в столбце **Actions** (Действия), чтобы просмотреть выполнения действий, связанные с этим запуском конвейера. В этом конвейере определено только одно действие (действие копирования), поэтому вы увидите только одну запись. Чтобы вернуться к представлению запусков конвейера, щелкните ссылку **Конвейеры** в верхней части окна. Щелкните **Обновить**, чтобы обновить список.

    ![Мониторинг активности](media/load-sap-bw-data/activity-monitoring.png)

16. Чтобы отслеживать сведения о выполнении каждого действия копирования, щелкните ссылку **Сведения** (изображение очков) в разделе **Действия** в представлении мониторинга действия. Вы можете отслеживать такие сведения, как объем данных, копируемых из источника в приемник, пропускная способность данных, шаги выполнения с длительностью и используемые параметры:

    ![Сведения о наблюдении за действие](media/load-sap-bw-data/activity-monitoring-details.png)

17. Просмотрите **максимальный идентификатор запроса** , копируется. Вернитесь в представлении мониторинга действия, нажмите кнопку **вывода** под **действия**.

    ![Выходные данные действия](media/load-sap-bw-data/activity-output.png)

    ![Сведения о выходных данных действия](media/load-sap-bw-data/activity-output-details.png)

## <a name="incremental-copy-from-sap-bw-open-hub"></a>Добавочное копирование из SAP BW, откройте Центр

> [!TIP]
> 
> Ссылаться на [поток извлечения разностных соединителя SAP BW, откройте Центр](connector-sap-business-warehouse-open-hub.md#delta-extraction-flow) Дополнительные сведения о работе действие копирования ADF Копировать добавочные данные из SAP BW.

Теперь давайте продолжить настройку добавочного копирования из SAP BW откройте концентратора. 

Добавочная копия использует механизм верхнего предела, основанный на запросе, идентификатор создается автоматически в SAP BW открыть назначение концентратора с DTP. Рабочий процесс для этого подхода показан на следующей схеме:

![Добавочное копирование рабочего процесса](media/load-sap-bw-data/incremental-copy-workflow.png)

В пользовательском Интерфейсе фабрики данных AZURE **приступим к работе** выберите **Создание конвейера**. 

1. Перетащите три действия - **просмотра, копирования данных и веб-** — на холст и сделать их по цепочке при успешном выполнении. В этом пошаговом руководстве мы будем использовать BLOB-объектов Azure для хранения верхнего предела - идентификатор max скопированный запроса. Также можно использовать базу данных SQL для хранения его и использовать действия хранимой процедуры вместо веб-действие для его обновления.

   ![Конвейера добавочного копирования](media/load-sap-bw-data/incremental-copy-pipeline.png)

2. Настройте действие поиска:

   1. В действие поиска **параметры** вкладке **первая строка только** параметр.

      ![Параметры поиска](media/load-sap-bw-data/lookup-settings.png)

   2. Настройка **исходный набор данных** как набор данных BLOB-объектов, в **путь к файлу**точку в большой двоичный объект, где будет сохранять max скопированный идентификатор в качестве верхнего предела и сохранить формат в текстовом формате.

      ![Параметры набора данных BLOB-объектов](media/load-sap-bw-data/blob-dataset.png)

   3. В соответствующий путь BLOB-объектов создайте большой двоичный объект с содержимым 0.

      ![Содержимое BLOB-объекта](media/load-sap-bw-data/blob.png)

3. Настройка действия копирования: 

   1. В **источника** вкладке, настройте **исходный набор данных** как набор данных SAP BW, откройте Центр. 

   2. Изменить **набора данных SAP BW, откройте Центр**:

      1. В **параметры** вкладку, задайте параметр с именем «ИД запроса»
      2. В **подключения** вкладке, укажите имя таблицы откройте центр, сохранить, «Исключить последний идентификатор запроса» выбран и задайте идентификатор базового запроса использовать выражение (добавить динамическое содержимое) `@dataset().requestId`.

   3. Перейдите обратно к действию копирования **источника** вкладке, настройте значение «ИД запроса», используемое выражение (добавить динамическое содержимое) `@{activity('<look up activity name>').output.firstRow.Prop_0}`. Соответствующим образом измените «подстановки имя действия» в этом выражении.

      ![Параметры источника копирования](media/load-sap-bw-data/copy-source.png)

4. Настройка веб-действие: этот веб-действие будет вызывать приложения логики для хранения идентификатор запроса max копируются в большой двоичный объект.

   1. Перейти на портал Azure -> создать **приложение логики** с одним **HTTP-запроса** и один **создать BLOB-объект** следующим образом. Используйте тот же файл большого двоичного объекта, настроенного в источнике действия выше подстановки. И скопируйте **URL-адрес HTTP POST** которое будет использоваться в веб-действие.

      ![Конфигурация приложения логики](media/load-sap-bw-data/logic-app-config.png)

   2. Вернуться к изменению ADF **веб-действие** параметры, как показано ниже. Настройте текст как выражение (добавить динамическое содержимое) `{"sapOpenHubMaxRequestId":"@{activity('CopyFromSap').output.sapOpenHubMaxRequestId}"}`.

      ![Действие веб-параметров](media/load-sap-bw-data/web-activity-settings.png)

5. Затем можно щелкнуть **Отладка** для проверки конфигурации или выберите **опубликовать все** следует опубликовать все изменения, а затем щелкните **триггера** Чтобы выполнить задачу.

## <a name="sap-bw-open-hub-destination-configurations"></a>Конфигурации SAP BW открыть назначение концентратора

Для использования соединителя SAP BW, откройте центр в ADF, чтобы скопировать данные в этом разделе представлены необходимые настройки на стороне SAP BW.

### <a name="configure-delta-extraction-in-sap-bw"></a>Настройка дельта извлечения в SAP BW

Если требуется исторические копии и добавочного копирования или только добавочное копирование, настройте разностных извлечения в SAP BW.

1. Создайте открытое назначение концентратора (OHD)

   Можно создать OHD в транзакции RSA1 SAP. Это автоматически создает необходимые преобразования и процесс передачи данных (DTP). Используйте следующие параметры:

   - Тип объекта может быть любым. Здесь в качестве примера мы используем InfoCube.
   - **Тип назначения:** *Таблицы базы данных*
   - **Ключ таблицы:** *Технические ключ*
   - **Извлечения:** *Сохранить данные и вставить записи в таблицу*

   ![Создание разностных извлечения SAP BW OHD](media/load-sap-bw-data/create-sap-bw-ohd-delta.png)

   ![create-sap-bw-ohd-delta2](media/load-sap-bw-data/create-sap-bw-ohd-delta2.png)

   Можно увеличить число одновременно выполняющихся SAP рабочих процессов для DTP:

   ![Создание sap-bw-ohd-delta3](media/load-sap-bw-data/create-sap-bw-ohd-delta3.png)

2. Расписание DTP в цепочек процессов

   Дельта DTP для куба работает, только если требуется строк не сжаты еще. Таким образом необходимо убедиться в том, сжатие кубов BW недоступность перед DTP таблицу откройте Центр. Самым простым способом для этого является интеграция этого DTP в вашей существующей цепочек процессов. В приведенном ниже примере DTP (чтобы OHD) вставляется в цепочку процессов между шагом Adjust (составного сводного) и Collapse (куба сжатия).

   ![Создание sap-bw--цепочки процессов](media/load-sap-bw-data/create-sap-bw-process-chain.png)

### <a name="configure-full-extraction-in-sap-bw"></a>Настройка полного извлечения в SAP BW

Помимо извлечения разностных может потребоваться полное извлечение из же InfoProvider. Это обычно происходит, если вы хотите осуществлять полное копирование без необходимости добавочное или вы хотите [повторную синхронизацию изменений извлечения](#re-sync-delta-extraction).

Для одной OHD не должны более одного DTP. Таким образом необходимо создать дополнительные OHD, чем извлечение изменений.

![Создание sap-bw-ohd-full](media/load-sap-bw-data/create-sap-bw-ohd-full.png)

Для полной загрузки OHD выберите различных параметров, чем извлечение изменений:

- В OHD: задать параметр «Извлечение» как "*удаление данных и вставить записи*«. В противном случае данные распаковки многократно при повторяющихся DTP в цепочку процесса BW.

- В DTP: режим «извлечение» как "*полный*«. Сразу после создания OHD, необходимо изменить автоматически созданный DTP результате изменений в состояние Full:

   ![create-sap-bw-ohd-full2](media/load-sap-bw-data/create-sap-bw-ohd-full2.png)

- В соединителе откройте Центр ADF SAP BW: отключить параметр "*последнего запроса исключения*«. В противном случае ничего не будет извлекаться. 

Обычно выполняется полное DTP вручную. Или можно также создать цепочку процессов для полной DTP — обычно это будет отдельный процесс цепочки, независимо от вашей существующей цепочек процессов. В любом случае необходимо **убедитесь, что DTP завершено перед началом извлечения с помощью ADF copy**, в противном случае будут скопированы часть данных.

### <a name="run-delta-extraction-the-first-time"></a>Выполните извлечение разностных первый раз

С технической точки зрения является первой извлечения разностных **полного извлечения**. С помощью соединителя ADF SAP BW откройте концентратора по умолчанию исключает последнего запроса, при копировании данных. В случае извлечения дельта в первый раз, в activtiy копирования ADF, данные не будут извлечены до последующих DTP создает разностные данные в таблице с идентификатором отдельный запрос. Несмотря на то что существует два возможных способа избежать этого сценария:

1. Отключите параметр «Исключить последнего запроса» для первого разностных извлечения в данном случае вам необходимо убедиться, что завершение первый DTP изменений перед запуском извлечения дельта в первый раз
2. Используйте процедуру повторно синхронизации изменений извлечения, как описано ниже.

### <a name="re-sync-delta-extraction"></a>Извлечение повторной синхронизации изменений

Существует несколько сценариев, в которых изменения данных в кубах SAP BW, но не учитываются DTP разностных:

- SAP BW выборочного удаления (с помощью любое условие фильтра строк)
- SAP BW запрос на удаление (неисправного запрос)

Открыть назначение концентратора SAP не управлением данных киоска данных является целевым (во все версии SAP BW поддержки с момента 2015 г.). Таким образом можно удалить данные из куба без изменения данных в OHD. В этом случае необходимо повторно синхронизировать данные куба с данными в ADF, выполнив следующие действия:

1. Выполнить полное извлечение в ADF (с помощью полного DTP в SAP)
2. Удалите все строки в таблице откройте центр для разностных DTP
3. Установка статуса DTP разностных выбрано

После этого всех последующих разностных DTPs и извлечения разностных ADF работать должным образом.

Состояние разностной DTP можно присвоить выбрано, выполнив DTP разностных, вручную, используя следующий параметр: "*Без передачи данных; Состояние изменений в источнике: Извлечь*«.

## <a name="next-steps"></a>Дальнейшие действия

Перейдите к следующей статье о поддержке соединителя SAP BW, откройте центр: 

> [!div class="nextstepaction"]
>[Соединитель SAP Business хранилище Open Hub](connector-sap-business-warehouse-open-hub.md)
