---
title: "Устранение неполадок шлюза управления данными | Документация Майкрософт"
description: "Содержит советы по устранению неполадок, связанных с шлюзом управления данными."
services: data-factory
documentationcenter: 
author: linda33wj
manager: jhubbard
editor: monicar
ms.assetid: c6756c37-4e5a-4d1e-ab52-365f149b4128
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 11/01/2016
ms.author: jingwang
translationtype: Human Translation
ms.sourcegitcommit: 219dcbfdca145bedb570eb9ef747ee00cc0342eb
ms.openlocfilehash: 4619716238d77caf494c116266c60e7e0c86ca92


---
# <a name="troubleshoot-issues-with-using-data-management-gateway"></a>Устранение неполадок в работе шлюза управления данными
В этой статье приводятся сведения об устранении неполадок в работе шлюза управления данными. 

> [!NOTE]
> Дополнительные сведения о шлюзе см. в статье [Шлюз управления данными](data-factory-data-management-gateway.md). Сведения о пошаговом перемещении данных из локальной базы данных SQL Server в хранилище BLOB-объектов Azure с помощью шлюза см. в статье [Перемещение данных между локальными источниками и облаком с помощью шлюза управления данными](data-factory-move-data-between-onprem-and-cloud.md). 
> 
> 

## <a name="failed-to-install-or-register-gateway"></a>Не удалось установить и зарегистрировать шлюз
### <a name="1-problem"></a>1. Проблема
Это сообщение об ошибке отображается при установке или регистрации шлюза, а именно при скачивании файла установки шлюза. 

`Unable to connect to the remote server". Please check your local settings (Error Code: 10003).`

### <a name="cause"></a>Причина:
Компьютеру, на который вы пытаетесь установить шлюз, не удалось скачать последний файл установки шлюза из центра скачивания из-за проблемы в сети.

### <a name="resolution"></a>Способы устранения:
Проверьте параметры брандмауэра и прокси-сервера, чтобы определить, блокируют ли они подключение компьютера к [центру скачивания](https://download.microsoft.com/) по сети, и измените их соответствующим образом. 

Кроме того, можно скачать последний файл установки шлюза из [центра скачивания](https://www.microsoft.com/en-US/download/details.aspx?id=39717) на другие компьютеры, которые могут получить доступ к центру скачивания, скопировать файл установщика на хост-компьютер шлюза и запустить его вручную, чтобы установить или обновить шлюз.

### <a name="2-problem"></a>2. Проблема
Эта ошибка возникает при попытке установить шлюз, щелкнув "Установка непосредственно на этот компьютер" на портале Azure. 

`Error:  Abort installing a new gateway on this computer because this computer has an existing installed gateway and a computer without any installed gateway is required for installing a new gateway.`  

### <a name="cause"></a>Причина:
Шлюз уже установлен на компьютере. 

### <a name="resolution"></a>Способы устранения:
Удалите существующий шлюз на компьютере и снова щелкните ссылку "Установка непосредственно на этот компьютер".

### <a name="3-problem"></a>3. Проблема
Эта ошибка может возникнуть при регистрации нового шлюза.

`Error: The gateway has encountered an error during registration.`

### <a name="cause"></a>Причина:
Это сообщение может отображаться по одной из следующих причин:

* недопустимый формат ключа шлюза;
* ключ шлюза стал недействительным;
* ключ шлюза создан повторно на портале.  

### <a name="resolution"></a>Способы устранения:
На портале Azure убедитесь, что используется правильный ключ шлюза. При необходимости повторно создайте ключ и зарегистрируйте шлюз с его помощью.

### <a name="4-problem"></a>4. Проблема
При регистрации шлюза может появиться следующее сообщение об ошибке: 

`Error: The content or format of the gateway key "{gatewayKey}" is invalid, please go to azure portal to create one new gateway or regenerate the gateway key.`

как показано на следующем снимке экрана:

![недопустимое содержимое или формат ключа](media/data-factory-troubleshoot-gateway-issues/invalid-format-gateway-key.png)

### <a name="cause"></a>Причина:
Содержимое или формат входного ключа шлюза неправильные. Одной из причин может быть копирование части копии на портале (или) использование недопустимого ключа.

### <a name="resolution"></a>Способы устранения:
Создайте ключ шлюза на портале Azure, скопируйте весь ключ, нажав кнопку "Копировать", и вставьте его в это окно, чтобы зарегистрировать шлюз.

### <a name="5-problem"></a>5. Проблема
При регистрации шлюза может появиться следующее сообщение об ошибке:

`Error: The gateway key is invalid or empty. Specify a valid gateway key from the portal.`

![ключ шлюза является недопустимым или он пустой](media/data-factory-troubleshoot-gateway-issues/gateway-key-is-invalid-or-empty.png)

### <a name="cause"></a>Причина:
Ключ шлюза создан повторно или шлюз удален на портале Azure.

### <a name="resolution"></a>Способы устранения:
Если шлюз существует, создайте ключ шлюза на портале Azure, скопируйте весь ключ, нажав кнопку "Копировать", и вставьте его в это окно, чтобы зарегистрировать шлюз. В противном случае повторно создайте шлюз и начните заново.

### <a name="6-problem"></a>6. Проблема
При регистрации шлюза может появиться следующее сообщение об ошибке:

`Error: Gateway has been online for a while, then shows “Gateway is not registered” with the status “Gateway key is invalid”`

![ключ шлюза является недопустимым или он пустой](media/data-factory-troubleshoot-gateway-issues/gateway-not-registered-key-invalid.png)

### <a name="cause"></a>Причина:
Эта ошибка может возникать из-за удаления шлюза или повторного создания ключа соответствующего шлюза.

### <a name="resolution"></a>Способы устранения:
Если шлюз был удален, заново создайте его на портале, нажмите копку "Зарегистрировать", скопируйте ключ с портала, вставьте его и попытайтесь зарегистрировать шлюз.

Если шлюз существует, но его ключ был создан повторно, зарегистрируйте шлюз, используя новый ключ. Если у вас нет ключа, повторно создайте его на портале. 

### <a name="7-problem"></a>7. Проблема
При регистрации шлюза может потребоваться ввести путь и пароль к сертификату. 

![выбор сертификата](media/data-factory-troubleshoot-gateway-issues/specify-certificate.png)

### <a name="cause"></a>Причина:
Этот шлюз ранее зарегистрирован на других компьютерах. Во время первоначальной регистрации шлюза с ним связывается сертификат шифрования. Сертификат может быть создан шлюзом или предоставлен пользователем.  Этот сертификат используется для шифрования учетных данных хранилища данных (связанные службы).  

![экспорт сертификата](media/data-factory-troubleshoot-gateway-issues/export-certificate.png)

При восстановлении шлюза на другом хост-компьютере мастер регистрации запрашивает этот сертификат для расшифровки учетных данных, зашифрованных с его помощью.  Без этого сертификата новому шлюзу не удастся расшифровать учетные данные, а последующие действия копирования, связанные с этим новым шлюзом, будут завершаться ошибкой.  

### <a name="resolution"></a>Способы устранения:
Если сертификат учетных данных экспортирован с исходного компьютера шлюза с помощью кнопки "Экспорт" на вкладке **Параметры** **диспетчера конфигурации шлюза**, используйте сертификат отсюда.

Нельзя пропускать этот шаг при восстановлении шлюза. Если сертификат отсутствует, необходимо удалить шлюз на портале и заново создать его.  Кроме того, все связанные службы шлюза требуется обновить. Для этого следует повторно ввести их учетные данные. 

### <a name="8-problem"></a>8. Проблема
Вы можете получить следующее сообщение об ошибке: 

`Error: The remote server returned an error: (407) Proxy Authentication Required.`

### <a name="cause"></a>Причина:
Эта ошибка возникает, если шлюз находится в среде, которой для доступа к ресурсам Интернета требуется прокси-сервер HTTP, или если пароль для аутентификации прокси-сервера изменен, но он не обновился соответствующим образом в шлюзе. 

### <a name="resolution"></a>Способы устранения:
Следуйте инструкциям в разделе [Рекомендации для прокси-сервера](#proxy-server-considerations) в этом документе и настройте параметры прокси-сервера с помощью диспетчера конфигурации.

## <a name="gateway-is-online-with-limited-functionality"></a>Шлюз находится в сети с ограниченной функциональностью
### <a name="1-problem"></a>1. Проблема
Шлюз находится в состоянии **В сети с ограниченной функциональностью**. 

### <a name="cause"></a>Причина:
Шлюз может находиться в состоянии "В сети с ограниченной функциональностью" по одной из следующих причин:

* Шлюзу не удается подключиться к облачной службе через служебную шину.
* Облачной службе не удается подключиться к шлюзу через служебную шину

Если шлюз находится в сети с ограниченной функциональностью, то вы не сможете использовать мастер копирования фабрики данных, чтобы создавать конвейеры данных для копирования данных между локальными хранилищами данных. В качестве обхода проблемы можно использовать редактор фабрики данных на портале Azure, Visual Studio или Azure PowerShell.

### <a name="resolution"></a>Способы устранения:
Устранить эту проблему (состояние "В сети с ограниченной функциональностью") можно, определив ее причину (шлюзу не удается подключиться к облачной службе) или иным способом. В следующих разделах описываются эти методы устранения проблемы. 

### <a name="2-problem"></a>2. Проблема
Возникла следующая ошибка: 

`Error: Gateway cannot connect to cloud service through service bus`

![Шлюзу не удается подключиться к облачной службе](media/data-factory-troubleshoot-gateway-issues/gateway-cannot-connect-to-cloud-service.png)

### <a name="cause"></a>Причина:
Шлюзу не удается подключиться к облачной службе через служебную шину.

### <a name="resolution"></a>Способы устранения:
Выполните следующие действия, чтобы перевести шлюз в состояние "в сети".

* Разрешите правила для исходящих подключений по IP-адресам на компьютере шлюза и корпоративном брандмауэре. IP-адреса можно найти в журнале событий Windows (идентификатор 401): "Попытка доступа к сокету методом, запрещенным его разрешениями доступа XX. XX. XX. XX:9350".
* Настройте параметры прокси-сервера на шлюзе. Дополнительные сведения см. в разделе [Рекомендации для прокси-сервера](#proxy-server-considerations).
* Откройте исходящие порты 5671 и 9350–9354 в брандмауэре Windows на компьютере шлюза и в корпоративном брандмауэре. Дополнительные сведения см. в разделе [Порты и брандмауэр](#ports-and-firewall). Это делать не обязательно, но рекомендуется из соображений производительности.

### <a name="3-problem"></a>3. Проблема
Возникла следующая ошибка: 

`Error: Cloud service cannot connect to gateway through service bus.`

### <a name="cause"></a>Причина:
Временная ошибка подключения к сети.

### <a name="resolution"></a>Способы устранения:
Выполните следующие действия, чтобы перевести шлюз в состояние "в сети".

* Подождите несколько минут. Подключение восстановится автоматически после устранения ошибки.
* Если ошибка не исчезнет, перезапустите службу шлюза.

## <a name="failed-to-author-linked-service"></a>Не удалось создать связанную службу
### <a name="problem"></a>Проблема
Эта ошибка может возникнуть при попытке использовать диспетчер учетных данных на портале, чтобы ввести учетные данные для новой связанной службы или обновить учетные данные для существующей связанной службы.

`Error: The data store '<Server>/<Database>' cannot be reached. Check connection settings for the data source.`

При возникновении этой ошибки страница параметров диспетчера конфигурации может выглядеть так:

![Не удается получить доступ к базе данных](media/data-factory-troubleshoot-gateway-issues/database-cannot-be-reached.png)

### <a name="cause"></a>Причина:
Возможно, SSL-сертификат утерян на компьютере шлюза. Шлюзу не удалось загрузить сертификат, используемый для шифрования SSL. Кроме того, в журнале событий может появиться сообщение об ошибке, аналогичное следующему: "Не удалось получить параметры шлюза из облачной службы. Проверьте ключ шлюза и сетевое подключение. Не удалось загрузить сертификат с отпечатком".

### <a name="resolution"></a>Способы устранения:
Чтобы решить проблему, сделайте следующее:

1. Запустите **диспетчер конфигурации шлюза управления данными**.
2. Переключитесь на вкладку **Параметры** .  
3. Нажмите кнопку **Изменить**, чтобы изменить SSL-сертификат.
   
   ![кнопка "Изменить" для сертификата](media/data-factory-troubleshoot-gateway-issues/change-button-ssl-certificate.png) 
4. Выберите новый сертификат в качестве SSL-сертификата. Вы можете использовать собственный или корпоративный SSL-сертификат.
   
   ![выбор сертификата](media/data-factory-troubleshoot-gateway-issues/specify-http-end-point.png)

## <a name="copy-activity-fails"></a>Сбой действия копирования
### <a name="1-problem"></a>1. Проблема
После настройки конвейера на портале Azure может возникнуть следующая ошибка UserErrorFailedToConnectToSqlserver. 

`Error: Copy activity encountered a user error: ErrorCode=UserErrorFailedToConnectToSqlServer,'Type=Microsoft.DataTransfer.Common.Shared.HybridDeliveryException,Message=Cannot connect to SQL Server`

### <a name="cause"></a>Причина:
Она может возникнуть по разным причинам, от которых зависят и способы устранения. 

### <a name="resolution"></a>Способы устранения:
Разрешите исходящие TCP-подключения через порт TCP/1433 на стороне клиента шлюза управления данными перед подключением к Базе данных SQL. 

Если в качестве целевой базы данных используется База данных SQL Azure, проверьте также параметры брандмауэра Azure SQL Server.

Инструкции по проверке подключения к локальному хранилищу данных см. в следующих разделах. 

## <a name="data-store-connection-or-driver-related-errors"></a>Ошибки, связанные с подключением к хранилищу данных или с драйверами
Если возникают ошибки, связанные с подключением к хранилищу данных или с драйверами, выполните перечисленные ниже действия. 

1. На машине шлюза запустите **диспетчер конфигурации шлюза управления данными** .
2. Перейдите на вкладку **Диагностика** .
3. Выберите или введите соответствующие значения в полях раздела **Test connection to an on-premises data source** (Проверить подключение к локальному источнику), используя данные этой группы шлюза.
4. Щелкните **Проверка подключения** , чтобы проверить возможность подключения к локальному источнику данных с компьютера шлюза, используя сведения о подключении и учетные данные. Если после установки драйвера тестовое подключение по-прежнему не работает, перезапустите шлюз, чтобы получить последние изменения.

![Раздел "Проверить подключение" на вкладке "Диагностика"](media/data-factory-troubleshoot-gateway-issues/test-connection-in-diagnostics-tab.png)

## <a name="gateway-logs"></a>Журналы шлюза
### <a name="send-gateway-logs-to-microsoft"></a>Отправка журналов шлюза в корпорацию Майкрософт
Возможно, при обращении в службу поддержки Майкрософт с проблемами в работе шлюза вас попросят предоставить журналы шлюза. Выпуск шлюза позволяет легко предоставить требуемые журналы всего двумя щелчками в диспетчере конфигурации шлюза.    

1. Переключитесь на вкладку **Диагностика** диспетчера конфигурации шлюза.
   
    ![Шлюз управления данными — вкладка "Диагностика"](media/data-factory-troubleshoot-gateway-issues/data-management-gateway-diagnostics-tab.png)
2. Щелкните ссылку **Отправить журналы** , чтобы открыть приведенное ниже диалоговое окно. 
   
    ![Шлюз управления данными — отправка журналов](media/data-factory-troubleshoot-gateway-issues/data-management-gateway-send-logs-dialog.png)
3. (Необязательно.) Щелкните **Просмотреть журналы** , чтобы просмотреть журналы в средстве просмотра событий.
4. (Необязательно.) Щелкните **Конфиденциальность** , чтобы просмотреть заявление о конфиденциальности Microsoft Online Services. 
5. Выбрав все, что нужно передать, щелкните **Отправить журналы** , чтобы отправить журналы за последние семь дней в корпорацию Майкрософт для диагностики и устранения неполадок. Вы увидите состояние отправки журналов, как показано на изображении ниже.
   
    ![Шлюз управления данными — состояние отправки журналов](media/data-factory-troubleshoot-gateway-issues/data-management-gateway-send-logs-status.png)
6. После завершения отправки появится диалоговое окно, как показано на изображении ниже.
   
    ![Шлюз управления данными — состояние отправки журналов](media/data-factory-troubleshoot-gateway-issues/data-management-gateway-send-logs-result.png)
7. Запишите **идентификатор отчета** и передайте его в службу поддержки Майкрософт. Идентификатор отчета используется для поиска журналов шлюза, которые вы передали для устранения неполадок.  Кроме того, этот идентификатор сохраняется в средстве просмотра событий для справки.  Его можно найти, просмотрев идентификатор события "25" и проверив дату и время.
   
    ![Шлюз управления данными — идентификатор отчета об отправке журналов](media/data-factory-troubleshoot-gateway-issues/data-management-gateway-send-logs-report-id.png)    

### <a name="archive-gateway-logs-on-gateway-host-machine"></a>Архивация журналов шлюза на хост-компьютере шлюза
Существует несколько сценариев, в которых при наличии проблем в работе шлюза вы не можете передать журналы шлюза напрямую: 

* вы вручную устанавливаете и регистрируете шлюз;
* вы пытаетесь зарегистрировать шлюз с помощью повторно созданного ключа в диспетчере конфигурации; 
* вы пытаетесь отправить журналы, но к службе узла шлюза не удается подключиться.

В таких случаях можно сохранить журналы шлюза в ZIP-файл и позже предоставить их при обращении в службу поддержки Майкрософт. Например, произошла ошибка при регистрации шлюза, как показано на изображении ниже.   

![Шлюз управления данными — ошибка регистрации](media/data-factory-troubleshoot-gateway-issues/data-management-gateway-registration-error.png)

Щелкните ссылку **Архивировать журналы шлюза** , чтобы заархивировать и сохранить журналы, а затем передайте полученный ZIP-файл в службу поддержки Майкрософт. 

![Шлюз управления данными — архивация журналов](media/data-factory-troubleshoot-gateway-issues/data-management-gateway-archive-logs.png)

### <a name="locate-gateway-logs"></a>Поиск журналов шлюза
Более подробную информацию можно найти в журналах шлюза в журналах событий Windows. Их можно найти в **средстве просмотра событий** Windows в разделе **Журналы приложения и служб** > **Шлюз управления данными**. Устраняя связанные со шлюзом ошибки, обращайте внимание на события уровня ошибок.

![Шлюз управления данными — журналы в окне просмотра событий](media/data-factory-troubleshoot-gateway-issues/gateway-logs-event-viewer.png)




<!--HONumber=Nov16_HO3-->


