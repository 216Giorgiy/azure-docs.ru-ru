<properties 
	pageTitle="Учебник. Создание конвейера с действием копирования с помощью Visual Studio" 
	description="В этом учебнике вы создадите конвейер фабрики данных Azure с действием копирования с помощью Visual Studio." 
	services="data-factory" 
	documentationCenter="" 
	authors="spelluru" 
	manager="jhubbard" 
	editor="monicar"/>

<tags 
	ms.service="data-factory" 
	ms.workload="data-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="get-started-article" 
	ms.date="02/01/2016" 
	ms.author="spelluru"/>

# Учебник. Создание конвейера с действием копирования с помощью Visual Studio
> [AZURE.SELECTOR]
- [Обзор учебника](data-factory-get-started.md)
- [Редактор фабрики данных](data-factory-get-started-using-editor.md)
- [Visual Studio](data-factory-get-started-using-vs.md)
- [PowerShell](data-factory-monitor-manage-using-powershell.md)


##Вот какие темы рассматривает этот учебник:
В этом учебнике вы выполните следующие действия с помощью Visual Studio 2013.

1. Создание двух связанных служб: **AzureStorageLinkedService1** и **AzureSqlinkedService1**. Связанная служба AzureStorageLinkedService1 связывает хранилище Azure, а служба AzureSqlLinkedService1 связывает базу данных SQL Azure с фабрикой данных **ADFTutorialDataFactoryVS**. Входные данные для конвейера размещены в хранилище больших двоичных объектов Azure, а выходные данные будут сохраняться в таблице в базе данных Azure SQL. Таким образом, можно добавить эти два хранилища данных как связанные службы в фабрику данных.
2. Создание двух таблиц фабрики данных, **EmpTableFromBlob** и **EmpSQLTable**, которые являются представлением входных и выходных данных, которые хранятся в хранилищах данных. Для EmpTableFromBlob потребуется указать контейнер больших двоичных объектов, содержащий большой двоичный объект с исходными данными для таблицы EmpSQLTable, а также таблицу SQL, в которой будут сохраняться выходные данные. Вы также укажите другие свойства, такие как структура данных, доступность данных и т. п.
3. Создание конвейера с именем **ADFTutorialPipeline** в ADFTutorialDataFactoryVS. Для конвейера будет назначено **действие копирования**, которое будет копировать входные данные большого двоичного объекта Azure в выходную таблицу SQL Azure. Действие копирования означает перемещение данных в фабрику данных Azure. Это действие выполняется глобально доступной службой, обеспечивающей безопасное, надежное и масштабируемое копирование данных из одного хранилища в другое. Дополнительные сведения о действии копирования см. в статье [Действия перемещения данных](data-factory-data-movement-activities.md). 
4. Создание фабрики данных и развертывание связанных служб, таблиц и конвейера.    

## Создание и развертывание сущностей фабрики данных с помощью Visual Studio 

### Предварительные требования
Перед выполнением этого учебника, пожалуйста, перейдите к статье [Обзор учебника](data-factory-get-started.md) и выполните необходимые предварительные действия.

На вашем компьютере должны быть установлены следующие компоненты:
- Visual Studio 2013
- Скачайте пакет Azure SDK для Visual Studio 2013. Перейдите к [Странице загрузки Azure](https://azure.microsoft.com/downloads/) и нажмите **Установить VS 2013** в разделе **.NET**.

### Пошаговое руководство

#### Создание проекта Visual Studio 
1. Запустите **Visual Studio 2013**. Щелкните **Файл**, наведите указатель мыши на пункт **Создать** и щелкните **Проект**. Откроется диалоговое окно **Новый проект**.  
2. В диалоговом окне **Новый проект** выберите шаблон **DataFactory** и нажмите **Пустой проект фабрики данных**. Если вы не видите шаблон DataFactory, закройте Visual Studio, установите пакет SDK Azure для Visual Studio 2013 и снова откройте Visual Studio.  

	![Диалоговое окно "Новый проект"](./media/data-factory-get-started-using-vs/new-project-dialog.png)

3. Введите **имя** проекта, **расположение** и имя **решения**, а затем нажмите кнопку **ОК**.

	![Обозреватель решений](./media/data-factory-get-started-using-vs/solution-explorer.png)

#### Создание связанных служб
Связанные службы связывают хранилища данных или службы вычислений с фабрикой данных Azure. Данные могут храниться в хранилище Azure, в базе данных SQL Azure или в локальной базе данных SQL Server.

На этом шаге создаются две связанные службы: **AzureStorageLinkedService1** и **AzureSqlLinkedService1**. Связанная служба AzureStorageLinkedService1 связывает учетную запись хранения Azure, а служба AzureSqlLinkedService связывает базу данных SQL Azure с фабрикой данных **ADFTutorialDataFactory**.

##### Создание связанных служб хранилища Azure

4. Щелкните правой кнопкой мыши **Связанные службы** в обозревателе решений, наведите указатель мыши на команду **Добавить** и нажмите **Новый элемент**.      
5. В диалоговом окне **Добавление нового элемента** выберите в списке пункт **Связанные службы хранилища Azure** и нажмите кнопку **Добавить**. 

	![Новая связанная служба](./media/data-factory-get-started-using-vs/new-linked-service-dialog.png)
 
3. Замените **accountname** и **accountkey** на имя вашей учетной записи хранения Azure и ее ключ.

	![Связанная служба хранилища Azure](./media/data-factory-get-started-using-vs/azure-storage-linked-service.png)

4. Сохраните файл **AzureStorageLinkedService1.json**.

#### Создание связанной службы SQL Azure

5. Щелкните правой кнопкой мыши узел **Связанные службы** в **обозревателе решений**, выберите **Добавить** и нажмите **Новый элемент**. 
6. На этот раз выберите **Связанные службы SQL Azure** и нажмите кнопку **Добавить**. 
7. В **файле AzureSqlLinkedService1.json** замените **servername**, **databasename**, **username@servername** и **password** на имя вашего сервера Azure SQL Server, имя базы данных, имя учетной записи пользователя и пароль.
8.  Сохраните файл **AzureSqlLinkedService1.json**. 


### Создание входных и выходных таблиц
На предыдущем шаге вы создали связанные службы **AzureStorageLinkedService1** и **AzureSqlLinkedService1** для связи учетной записи хранения Azure и базы данных SQL Azure с фабрикой данных **ADFTutorialDataFactory**. На этом шаге будут определены две таблицы фабрики данных, **EmpTableFromBlob** и **EmpSQLTable**, представляющие входные и выходные данные, которые сохраняются в хранилищах данных, на которые ссылаются службы AzureStorageLinkedService1 и AzureSqlLinkedService1 соответственно. Для EmpTableFromBlob потребуется указать контейнер больших двоичных объектов, содержащий большой двоичный объект с исходными данными для таблицы EmpSQLTable, а также таблицу SQL, в которой будут сохраняться выходные данные.

#### Создание входной таблицы

9. Щелкните правой кнопкой мыши **Таблицы** в **обозревателе решений**, выберите **Добавить** и нажмите **Новый элемент**.
10. В диалоговом окне **Добавление нового элемента** выберите **большой двоичный объект Azure ** и нажмите кнопку **Добавить**.   
10. Замените текст JSON приведенным далее текстом и сохраните файл **AzureBlobLocation1.json**. 

		{
		  "name": "EmpTableFromBlob",
		  "properties": {
		    "structure": [
		      {
		        "name": "FirstName",
		        "type": "String"
		      },
		      {
		        "name": "LastName",
		        "type": "String"
		      }
		    ],
		    "type": "AzureBlob",
		    "linkedServiceName": "AzureStorageLinkedService1",
		    "typeProperties": {
		      "folderPath": "adftutorial/",
		      "format": {
		        "type": "TextFormat",
		        "columnDelimiter": ","
		      }
		    },
		    "external": true,
		    "availability": {
		      "frequency": "Hour",
		      "interval": 1
		    }
		  }
		}

#### Создание выходной таблицы

11. Снова щелкните правой кнопкой мыши **Таблицы** в **обозревателе решений**, выберите **Добавить** и нажмите **Новый элемент**.
12. В диалоговом окне **Добавление нового элемента** выберите **SQL Azure** и нажмите **Добавить**. 
13. Замените текст JSON приведенным далее кодом JSON и сохраните файл **AzureSqlTableLocation1.json**.

		{
		  "name": "EmpSQLTable",
		  "properties": {
		    "structure": [
		      {
		        "name": "FirstName",
		        "type": "String"
		      },
		      {
		        "name": "LastName",
		        "type": "String"
		      }
		    ],
		    "type": "AzureSqlTable",
		    "linkedServiceName": "AzureSqlLinkedService1",
		    "typeProperties": {
		      "tableName": "emp"
		    },
		    "availability": {
		      "frequency": "Hour",
		      "interval": 1
		    }
		  }
		}

#### Создание конвейера 
На данный момент мы создали связанные службы ввода и вывода, а также таблицы. Теперь вы создадите конвейер с **действием копирования** для копирования данных из большого двоичного объекта Azure в базу данных SQL Azure.


1. Щелкните правой кнопкой мыши **Конвейеры** в **обозревателе решений**, выберите **Добавить** и нажмите **Новый элемент**.  
15. Выберите **Конвейер копирования данных** в диалоговом окне **Добавление нового элемента** и нажмите **Добавить**. 
16. Замените JSON приведенным далее кодом JSON и сохраните файл **CopyActivity1.json**.
			
		{
		  "name": "ADFTutorialPipeline",
		  "properties": {
		    "description": "Copy data from a blob to Azure SQL table",
		    "activities": [
		      {
		        "name": "CopyFromBlobToSQL",
		        "description": "Push Regional Effectiveness Campaign data to Azure SQL database",
		        "type": "Copy",
		        "inputs": [
		          {
		            "name": "EmpTableFromBlob"
		          }
		        ],
		        "outputs": [
		          {
		            "name": "EmpSQLTable"
		          }
		        ],
		        "typeProperties": {
		          "source": {
		            "type": "BlobSource"
		          },
		          "sink": {
		            "type": "SqlSink",
		            "writeBatchSize": 10000,
		            "writeBatchTimeout": "60:00:00"
		          }
		        },
		        "Policy": {
		          "concurrency": 1,
		          "executionPriorityOrder": "NewestFirst",
		          "style": "StartOfInterval",
		          "retry": 0,
		          "timeout": "01:00:00"
		        }
		      }
		    ],
		    "start": "2015-07-12T00:00:00Z",
		    "end": "2015-07-13T00:00:00Z",
		    "isPaused": false
		  }
		}

#### Публикация и развертывание сущностей фабрики данных
  
18. В обозревателе решений щелкните проект правой кнопкой мыши и выберите **Опубликовать**. 
19. Если вы видите диалоговое окно **Войдите в учетную запись Майкрософт**, введите данные учетной записи с подпиской Azure и нажмите кнопку **Войти**.
20. Вы должны увидеть следующее диалоговое окно:

	![Диалоговое окно «Опубликовать»](./media/data-factory-get-started-using-vs/publish.png)

21. На странице "Настройка фабрики данных" выполните следующие действия.
	1. Выберите **Создать новую фабрику данных**.
	2. Введите **VSTutorialFactory** в качестве **имени** фабрики данных.  
	
		> [AZURE.NOTE]  
		Имя фабрики данных Azure должно быть глобально уникальным. При получении ошибки об имени фабрики данных при публикации измените имя фабрики данных (например, на ваше\_имяVSTutorialFactory) и повторите попытку публикации. Ознакомьтесь с разделом [Фабрика данных — правила именования](data-factory-naming-rules.md), чтобы узнать о правилах именования артефактов фабрики данных.
		> 
		> В будущем имя фабрики данных может быть зарегистрировано в качестве DNS-имени и, следовательно, стать отображаемым.
	3. Выберите соответствующую подписку в поле **Подписка**. 
	4. Выберите **группу ресурсов** для создаваемой фабрики данных. 
	5. Выберите **регион** для фабрики данных. 
	6. Нажмите **Далее** для перехода на страницу **Публикация элементов**. 
23. На странице **Публикация элементов** убедитесь, что выбраны все сущности фабрик данных, и нажмите кнопку **Далее** для перехода на страницу **Сводка**.     
24. Просмотрите сводку и нажмите кнопку **Далее** для запуска процесса развертывания и просмотра **Состояния развертывания**.
25. На странице **Состояние развертывания** вы увидите состояние процесса развертывания. После завершения развертывания нажмите кнопку «Готово». 


## Использование обозревателя серверов для просмотра сущностей фабрики данных

1. В **Visual Studio** щелкните **Вид** в меню и нажмите кнопку **Обозреватель серверов**.
2. В окне обозревателя серверов разверните элементы **Azure** и **Фабрика данных**. Когда отобразится окно **Вход в Visual Studio**, введите данные **учетной записи**, связанной с вашей подпиской Azure, и нажмите кнопку **Продолжить**. Введите **пароль** и нажмите кнопку **Войти**. Visual Studio пытается получить сведения обо всех фабриках данных Azure в подписке. Вы увидите состояние операции в окне **Список задач фабрики данных**.
![Обозреватель серверов](./media/data-factory-get-started-using-vs/server-explorer.png)
3. Чтобы создать проект Visual Studio на основе существующей фабрики данных, щелкните фабрику данных правой кнопкой мыши и выберите пункт «Экспорт фабрики данных в новый проект». 
![Экспорт фабрики данных для проекта VS](./media/data-factory-get-started-using-vs/export-data-factory-menu.png)  

## Обновление средств фабрик данных для Visual Studio
Чтобы обновить средства фабрики данных Azure для Visual Studio, выполните следующие действия.

1. Щелкните в меню пункт **Сервис** и выберите элемент **Расширения и обновления**. 
2. Выберите пункт **Обновления** слева, а затем — **Коллекция Visual Studio**.
4. Выберите **Средства фабрики данных Azure для Visual Studio** и нажмите кнопку **Обновить**. Если эта запись отсутствует, у вас уже установлена последняя версия средства. 

Инструкции по использованию портала Azure для мониторинга конвейера и наборов данных, созданных с помощью этого руководства, см. в разделе [Мониторинг конвейеров фабрики данных Azure и управление ими](data-factory-get-started-using-editor.md#MonitorDataSetsAndPipeline).

## См. также
Дополнительные сведения о **действии копирования** в фабрике данных Azure см. в статье [Действия перемещения данных](data-factory-data-movement-activities.md).

<!---HONumber=AcomDC_0302_2016-->