---
title: "Отказоустойчивость действия копирования в фабрике данных Azure — пропуск несовместимых строк | Документы Майкрософт"
description: "Дополнительные сведения об отказоустойчивости за счет пропуска несовместимых строк во время копирования в фабрике данных Azure"
services: data-factory
documentationcenter: 
author: linda33wj
manager: jhubbard
editor: monicar
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: jingwang
ms.translationtype: HT
ms.sourcegitcommit: 0425da20f3f0abcfa3ed5c04cec32184210546bb
ms.openlocfilehash: d613537657af3bbe379a53e92532bf6b184d762b
ms.contentlocale: ru-ru
ms.lasthandoff: 07/20/2017

---
# <a name="copy-activity-fault-tolerance---skip-incompatible-rows"></a>Отказоустойчивость действия копирования в фабрике данных Azure — пропуск несовместимых строк

Существуют различные варианты устранения несовместимых строк при копировании данных между хранилищами данных источника и приемника для [действия копирования](data-factory-data-movement-activities.md). Вы можете либо прервать действие копирования при обнаружении несовместимых данных (поведение по умолчанию), либо продолжить копирование всех данных, пропустив эти несовместимые строки. Кроме того, вы также можете записать несовместимые строки в BLOB-объект Azure, чтобы определить причину сбоя, исправить данные в источнике данных и повторить попытку.

## <a name="supported-scenarios"></a>Поддерживаемые сценарии использования.
Сейчас действие копирования поддерживает обнаружение, пропуск и запись в журнал для следующей несовместимой ситуации во время копирования:

- **Несовместимость собственных типов данных источника и приемника**

    Пример: копирование из CSV-файла в BLOB-объекте Azure в базу данных SQL Azure; в схеме, определенной в базе данных SQL Azure, есть три столбца типа *INT*. Строки с числовыми данными (например, `123,456,789`) в исходном CSV-файле копируются успешно, а строки, содержащие нечисловые значения (например, `123,456,abc`), пропускаются как несовместимые.

- **Число несоответствий столбцов между источником и приемником**

    Пример: копирование из CSV-файла в BLOB-объекте Azure в базу данных SQL Azure; в схеме, определенной в базе данных SQL Azure, есть шесть столбцов. Строки, содержащие шесть столбцов в исходном CSV-файле, копируются успешно, а строки с другим количеством столбцов пропускаются как несовместимые.

- **Нарушение первичного ключа при записи в реляционную базу данных**

    Пример: чтобы скопировать данные из сервера SQL Server в базу данных SQL Azure, в приемнике базы данных SQL Azure определен первичный ключ, но в сервере-источнике SQL Server такой первичный ключ не определен. Повторяющиеся строки, которые существуют в источнике, не допускаются в приемнике. Действие копирования копирует только первую строку в приемник и пропускает вторую и последующую строки с повторяющимся значением первичного ключа при копировании из источника в приемник.

## <a name="configuration"></a>Конфигурация
В следующем примере приведено определение JSON для пропуска несовместимых строк в действии копирования:

```json
"typeProperties": {
    "source": {
        "type": "BlobSource"
    },
    "sink": {
        "type": "SqlSink",
    },         
    "enableSkipIncompatibleRow": true,           
    "redirectIncompatibleRowSettings": {
        "linkedServiceName": "BlobStorage",
        "path": "redirectcontainer/erroroutput"
    }
}
```

| Свойство | Описание | Допустимые значения | Обязательно |
| --- | --- | --- | --- |
| enableSkipIncompatibleRow | Включить или отключить пропуск несовместимых строк во время копирования. | Да<br/>False (по умолчанию) | Нет |
| redirectIncompatibleRowSettings | Группа свойств, которые можно указать, если вы хотите записать несовместимые строки в журнал. | &nbsp; | Нет |
| linkedServiceName (имя связанной службы) | Связанная служба хранилища Azure, в которой будет храниться журнал, содержащий пропущенные строки. | Укажите имя связанной службы [AzureStorage](data-factory-azure-blob-connector.md#azure-storage-linked-service) или [AzureStorageSas](data-factory-azure-blob-connector.md#azure-storage-sas-linked-service), которая будет ссылаться на экземпляр хранилища, используемый для хранения файла журнала. | Нет |
| path | Путь к файлу журнала, содержащему пропущенные строки. | Укажите путь к хранилищу BLOB-объектов, в котором будут храниться несовместимые данные. Если путь не указан, служба создаст контейнер самостоятельно. | Нет |

## <a name="monitoring"></a>Мониторинг
После завершения действия копирования вы увидите количество пропущенных строк в разделе мониторинга:

![Мониторинг пропущенных несовместимых строк](./media/data-factory-copy-activity-fault-tolerance/skip-incompatible-rows-monitoring.png)

Если настроена запись несовместимых строк в журнал, вы сможете найти файл журнала по этому пути: `https://[your-blob-account].blob.core.windows.net/[path-if-configured]/[copy-activity-run-id]/[auto-generated-GUID].csv`. Проанализировав файл журнала, вы сможете понять, какие строки были пропущены и в чем первопричина несовместимости.

В файл журнала записываются как исходные данные, так и соответствующая ошибка. Ниже приведен пример содержимого файла журнала:
```
data1, data2, data3, UserErrorInvalidDataValue,Column 'Prop_2' contains an invalid value 'data3'. Cannot convert 'data3' to type 'DateTime'.,
data4, data5, data6, Violation of PRIMARY KEY constraint 'PK_tblintstrdatetimewithpk'. Cannot insert duplicate key in object 'dbo.tblintstrdatetimewithpk'. The duplicate key value is (data4).,
```

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о действии копирования фабрики данных Azure см. в разделе [Перемещение данных с помощью действия копирования](data-factory-data-movement-activities.md).
