---
title: "Наборы данных и связанные службы в фабрике данных Azure | Документация Майкрософт"
description: "Узнайте о наборах данных и связанных службах в фабрике данных. Связанные службы связывают хранилища данных и вычислений с фабрикой данных. Наборы данных представляют входные и выходные данные."
services: data-factory
documentationcenter: 
author: sharonlo101
manager: jhubbard
editor: spelluru
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: 
ms.date: 09/05/2017
ms.author: shlo
ms.openlocfilehash: e8572af6187a889067341bbebb254d701b39395a
ms.sourcegitcommit: d247d29b70bdb3044bff6a78443f275c4a943b11
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/13/2017
---
# <a name="datasets-and-linked-services-in-azure-data-factory"></a>Наборы данных и связанные службы в фабрике данных Azure 
> [!div class="op_single_selector" title1="Select the version of Data Factory service you are using:"]
> * [Версия 1 — общедоступная](v1/data-factory-create-datasets.md)
> * [Версия 2 — предварительная](concepts-datasets-linked-services.md)

В этой статье описывается, какие бывают наборы данных, каким образом они определяются в формате JSON, а также как они используются в конвейерах фабрики данных Azure версии 2. 

> [!NOTE]
> Эта статья относится к версии 2 фабрики данных, которая в настоящее время доступна в предварительной версии. Если вы используете общедоступную версию 1 службы фабрики данных, см. статью [Наборы данных в фабрике данных Azure](v1/data-factory-create-datasets.md).

Чтобы получить общие представления о фабрике данных, ознакомьтесь со статьей [Общие сведения о службе фабрики данных Azure, службе интеграции данных в облаке](introduction.md). 

## <a name="overview"></a>Обзор
Фабрика данных может иметь один или несколько конвейеров. **Конвейер** — это логическая группа **действий**, которые вместе выполняют задачу. Действия в конвейере определяют операции с данными. Например, вы можете использовать действие копирования, чтобы скопировать данные из локального сервера SQL Server в хранилище BLOB-объектов Azure. Затем можно использовать действие Hive для запуска сценария Hive в кластере HDInsight Azure, чтобы обработать данные из хранилища BLOB-объектов для получения выходных данных. Наконец, можно использовать второе действие копирования, чтобы скопировать выходные данные в хранилище данных SQL Azure, на основе которого созданы решения для создания отчетов бизнес-аналитики. Дополнительные сведения о конвейерах и действиях см. в статье [Конвейеры и действия в фабрике данных Azure](concepts-pipelines-activities.md).

Теперь **набор данных** — это именованное представление данных, которое указывает данные, необходимые для использования в **действиях**, разделяя их на входные и выходные. Наборы данных представляют данные в разных хранилищах, например в таблицах, файлах, папках и документах. Например, набор данных больших двоичных объектов Azure указывает контейнер больших двоичных объектов и папку в хранилище BLOB-объектов, из которой действие должно считывать данные.

Перед созданием набора данных необходимо создать **связанную службу**, чтобы связать хранилище данных с фабрикой данных. Связанные службы напоминают строки подключения, определяющие сведения о подключении, необходимые для подключения фабрики данных к внешним ресурсам. Таким образом, набор данных представляет структуру данных в связанных хранилищах данных, а связанная служба определяет подключение к источнику данных. Например, связанная служба хранилища Azure связывает учетную запись хранения с фабрикой данных. Набор данных больших двоичных объектов Azure представляет контейнер больших двоичных объектов и папку в учетной записи хранения Azure, содержащую входные большие двоичные объекты для обработки.

Ниже приведен пример сценария. Чтобы скопировать данные из хранилища BLOB-объектов в базу данных SQL, создайте две связанные службы: службу хранилища Azure и базу данных SQL Azure. Затем создайте два набора данных: набор данных больших двоичных объектов Azure (для связанной службы хранилища Azure) и набор данных таблицы SQL Azure (для связанной службы базы данных SQL Azure). Связанные службы хранилища Azure и базы данных SQL Azure содержат строки подключения, которые фабрика данных использует во время выполнения для подключения к службе хранилища Azure и базе данных Azure SQL соответственно. Набор данных больших двоичных объектов Azure указывает контейнер и папку больших двоичных объектов, содержащие входные большие двоичные объекты в хранилище BLOB-объектов. Набор данных таблицы SQL Azure указывает таблицу SQL в базе данных SQL, в которую будут копироваться данные.

На следующей схеме показана связь между конвейером, действием, набором данных и связанной службой в фабрике данных.

![Связь между конвейером, действием, набором данных и связанными службами](media/concepts-datasets-linked-services/relationship-between-data-factory-entities.png)

## <a name="linked-service-json"></a>Формат JSON связанной службы
Связанная служба в фабрике данных определяется в формате JSON следующим образом:

```json
{
    "name": "<Name of the linked service>",
    "properties": {
        "type": "<Type of the linked service>",
        "typeProperties": {
              "<data store or compute-specific type properties>"
        },
        "connectVia": {
            "referenceName": "<name of Integration Runtime>",
            "type": "IntegrationRuntimeReference"
        }
    }
}
```

В следующей таблице описаны свойства приведенного выше объекта JSON.

Свойство | ОПИСАНИЕ | Требуется |
-------- | ----------- | -------- |
name | Имя связанной службы. Дополнительные сведения см. в статье [Фабрика данных Azure — правила именования](naming-rules.md). |  Yes |
Тип | Тип связанной службы. Например: AzureStorage (хранилище данных) или AzureBatch (вычислительные ресурсы). См. в описании typeProperties. | Yes |
typeProperties | Тип свойства отличаются для каждого хранилища данных или вычислений. <br/><br/> Поддерживаемые данные можно хранить в типы и их свойств типа см. в разделе [тип набора данных](#dataset-type) таблицы в этой статье. Перейдите к статье соединителя хранилища данных содержатся сведения о свойствах типа, определенного в хранилище данных. <br/><br/> Типы поддерживаемых вычислений и их свойств типа см. [связанные службы вычислений](compute-linked-services.md). | Yes |
connectVia | [Среда выполнения интеграции](concepts-integration-runtime.md), используемая для подключения к хранилищу данных. Среда выполнения интеграции Azure или выполнения резидентных интеграции можно использовать (если хранилище данных находится в частной сети). Если не указано другое, по умолчанию используется интегрированная среда выполнения Azure. | Нет 

## <a name="linked-service-example"></a>Образец связанной службы
Следующие связанные службы является связанной службой хранилища Azure. Обратите внимание, что тип имеет значение AzureStorage. Тип свойства связанной службой хранилища Azure, включает строку подключения. Служба фабрики данных использует эту строку подключения для подключения к хранилищу данных во время выполнения. 

```json
{
    "name": "AzureStorageLinkedService",
    "properties": {
        "type": "AzureStorage",
        "typeProperties": {
            "connectionString": {
                "type": "SecureString",
                "value": "DefaultEndpointsProtocol=https;AccountName=<accountname>;AccountKey=<accountkey>"
            }
        },
        "connectVia": {
            "referenceName": "<name of Integration Runtime>",
            "type": "IntegrationRuntimeReference"
        }
    }
}
```

## <a name="dataset-json"></a>JSON набора данных
Набор данных в фабрике данных определяется в формате JSON, как показано ниже.

```json
{
    "name": "<name of dataset>",
    "properties": {
        "type": "<type of dataset: AzureBlob, AzureSql etc...>",
        "linkedServiceName": {
                "referenceName": "<name of linked service>",
                 "type": "LinkedServiceReference",
        },
        "structure": [
            {
                "name": "<Name of the column>",
                "type": "<Name of the type>"
            }
        ],
        "typeProperties": {
            "<type specific property>": "<value>",
            "<type specific property 2>": "<value 2>",
        }
    }
}

```
В следующей таблице описаны свойства приведенного выше объекта JSON.

Свойство | ОПИСАНИЕ | Требуется |
-------- | ----------- | -------- |
name | Имя набора данных. Дополнительные сведения см. в статье [Фабрика данных Azure — правила именования](naming-rules.md). |  Yes |
Тип | Тип набора данных. Укажите один из типов, которые поддерживает фабрика данных (например: AzureBlob, AzureSqlTable). <br/><br/>Дополнительные сведения см. в разделе [о типах наборов данных](#dataset-types). | Yes |
structure | Схема набора данных. Дополнительные сведения см. в разделе [Структура набора данных](#dataset-structure). | Нет  |
typeProperties | Свойства каждого типа отличаются (например, свойства большого двоичного объекта Azure и таблицы SQL Azure). Сведения о поддерживаемых типах и их свойствах см. в разделе [Тип набора данных](#dataset-type). | Yes |

## <a name="dataset-example"></a>Пример набора данных
В следующем примере набор данных представляет таблицу с именем MyTable в базе данных SQL.

```json
{
    "name": "DatasetSample",
    "properties": {
        "type": "AzureSqlTable",
        "linkedServiceName": {
                "referenceName": "MyAzureSqlLinkedService",
                 "type": "LinkedServiceReference",
        },
        "typeProperties":
        {
            "tableName": "MyTable"
        },
    }
}

```
Обратите внимание на следующие моменты.

- для параметра type задано значение AzureSqlTable;
- свойство типа tableName (используется только для типа AzureSqlTable) имеет значение MyTable;
- параметр linkedServiceName ссылается на связанную службу типа AzureSqlDatabase, определение которой указано во фрагменте кода JSON ниже;

## <a name="dataset-type"></a>Тип набора данных
Существует множество различных типов наборов данных в зависимости от используемого хранилища данных. В таблице ниже перечислены хранилища данных, поддерживаемые фабрикой данных. Щелкните хранилище данных, чтобы узнать, как для него создать связанную службу и набор данных.

[!INCLUDE [data-factory-v2-supported-data-stores](../../includes/data-factory-v2-supported-data-stores.md)]

В примере в предыдущем разделе задан тип набора данных **AzureSqlTable**. Аналогично для набора данных больших двоичных объектов Azure задается тип **AzureBlob**, как показано в следующем фрагменте JSON.

```json
{
    "name": "AzureBlobInput",
    "properties": {
        "type": "AzureBlob",
        "linkedServiceName": {
                "referenceName": "MyAzureStorageLinkedService",
                 "type": "LinkedServiceReference",
        }, 
 
        "typeProperties": {
            "fileName": "input.log",
            "folderPath": "adfgetstarted/inputdata",
            "format": {
                "type": "TextFormat",
                "columnDelimiter": ","
            }
        }
    }
}
```
## <a name="dataset-structure"></a>Структура набора данных
Раздел **structure** необязателен. Он определяет схему набора данных. В нем содержится коллекция имен и типов данных столбцов. Используйте этот раздел, чтобы указать сведения о типах, которые используются для преобразования типов и сопоставления столбцов из источника в приемник. В следующем примере набор данных имеет три столбца: timestamp, projectname и pageviews. Они имеют типы String, String и Decimal соответственно.

```json
[
    { "name": "timestamp", "type": "String"},
    { "name": "projectname", "type": "String"},
    { "name": "pageviews", "type": "Decimal"}
]
```

В каждом столбце раздела structure содержатся следующие свойства.

Свойство | ОПИСАНИЕ | Требуется
-------- | ----------- | --------
name | Имя столбца. | Yes
Тип | Тип данных столбца. | Нет 
culture | Язык и региональные параметры на основе .NET, используемые, если указан тип .NET `Datetime` или `Datetimeoffset`. Значение по умолчанию — `en-us`. | Нет 
свойства | Строка формата будет использоваться, если указан тип .NET `Datetime` или `Datetimeoffset`. | Нет 

Используйте приведенные ниже рекомендации и узнайте, когда следует включать сведения о структуре, а также что включать в раздел **structure**.

- **Для структурированных источников данных** укажите раздел structure только в том случае, если вы хотите сопоставить столбцы источника со столбцами приемника и если их имена отличаются. Этот тип структурированного источника данных хранит схему данных и сведения о типе, а также сами данные. Примерами структурированных источников данных являются SQL Server, Oracle и база данных SQL Azure.<br/><br/>Для структурированных источников данных информация о типах уже доступна, поэтому ее не следует включать при добавлении раздела structure.
- **Для схемы на основе считываемых источников данных (особенно хранилища BLOB-объектов)** вы можете выбрать хранение данных без сохранения какой-либо схемы или сведений о типах вместе с данными. Для этих типов источников данных вы можете добавить раздел structure, если хотите сопоставить столбцы источника со столбцами приемника. Вы также можете добавить этот раздел в случае, когда набор данных представляет собой входные данные для действия копирования и типы данных исходного набора данных должны быть преобразованы в собственные типы для приемника.<br/><br/> Фабрика данных поддерживает следующие значения для указания в разделе structure сведений о типах: `Int16, Int32, Int64, Single, Double, Decimal, Byte[], Boolean, String, Guid, Datetime, Datetimeoffset, and Timespan`. 

Ознакомьтесь со статьей [Сопоставление схем в действии копирования]( copy-activity-schema-and-type-mapping.md), чтобы узнать больше о том, как фабрика данных сопоставляет исходные данные с приемником и когда необходимо указывать сведения о структуре.

## <a name="create-datasets"></a>Создание наборов данных
Наборы данных можно создавать с помощью таких инструментов и пакетов SDK: [API .NET](quickstart-create-data-factory-dot-net.md), [PowerShell](quickstart-create-data-factory-powershell.md), [REST API](quickstart-create-data-factory-rest-api.md), шаблон Azure Resource Manager, портал Azure.

## <a name="v1-vs-v2-datasets"></a>Наборы данных версии 1 и 2

Ниже приведены некоторые различия между наборами данных фабрики данных версии 1 и 2. 

- Внешнее свойство не поддерживается в версии 2. Оно заменено [триггером](concepts-pipeline-execution-triggers.md).
- Политики и свойства доступности не поддерживаются в версии 2. Время начала конвейера зависит от [триггеров](concepts-pipeline-execution-triggers.md).
- Наборы данных с заданной областью (наборы данных, определенные в конвейере) не поддерживаются в версии 2. 

## <a name="next-steps"></a>Дальнейшие действия
Пошаговые инструкции по созданию конвейеров и наборов данных с помощью одного из указанных ниже инструментов или пакетов SDK приведены в указанных ниже руководствах. 

- [Создание фабрики данных и конвейера с помощью пакета SDK для .NET](quickstart-create-data-factory-dot-net.md)
- [Создание фабрики данных и конвейера с помощью пакета PowerShell](quickstart-create-data-factory-powershell.md)
- [Создание фабрики данных Azure и конвейера с помощью REST API](quickstart-create-data-factory-rest-api.md)
- Краткое руководство по созданию фабрики данных с помощью портала Azure
