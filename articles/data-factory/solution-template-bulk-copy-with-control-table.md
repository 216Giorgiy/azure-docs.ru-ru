---
title: Массовое копирование из базы данных с использованием контрольной таблицы в Фабрике данных Azure | Документация Майкрософт
description: Сведения о том, как с помощью шаблона решения выполнить полное массовое копирование данных из базы данных, используя внешнюю контрольную таблицу для хранения списка секций исходных таблиц в Фабрике данных Azure.
services: data-factory
documentationcenter: ''
author: dearandyxu
ms.author: yexu
ms.reviewer: douglasl
manager: craigg
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 12/14/2018
ms.openlocfilehash: b267da18f2537e462ecda0ac265eac07a069c293
ms.sourcegitcommit: d1c5b4d9a5ccfa2c9a9f4ae5f078ef8c1c04a3b4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2019
ms.locfileid: "55967010"
---
# <a name="bulk-copy-from-database-with-control-table"></a>Массовое копирование из базы данных с использованием контрольной таблицы

Чтобы скопировать данные из хранилища данных (например, сервер Oracle, Netezza, Teradata или SQL Server) в Azure, необходимо загрузить огромное количество данных из нескольких таблиц в источниках данных. В большинстве случаев данные должны быть дополнительно разделены в каждой таблице, чтобы можно было загружать строки из одной таблицы с использованием нескольких параллельных потоков. Рассматриваемый в этой статье шаблон предназначен для этого случая. 

Если вы хотите скопировать данные из небольшого числа таблиц с небольшим объемом данных, более эффективным методом будет использовать "средство копирования данных", чтобы выполнить в конвейере одно действие копирования или действие ForEach + действие копирования. Для такого простого сценария этот шаблон будет как раз кстати.

## <a name="about-this-solution-template"></a>Информация о шаблоне решения

Этот шаблон извлекает список секций базы данных-источника из внешней контрольной таблицы, которую необходимо скопировать в целевое хранилище, а затем копирует данные, выполняя итерацию по каждой секции в базе данных-источника.

Шаблон состоит из трех действий.
-   Действие **поиска** извлекает список секций базы данных-источника из внешней контрольной таблицы.
-   Действие **ForEach** получает список секций из действия поиска, а затем выполняет итерацию по каждой секции для действия копирования.
-   Действие **копирования** копирует каждую секцию из базы данных-источника в целевое хранилище.

Шаблон определяет пять параметров.
-   Параметр *Control_Table_Name* — это имя внешней контрольной таблицы. Контрольная таблица используется для хранения списка секций базы данных-источника.
-   Параметр *Control_Table_Schema_PartitionID* — имя столбца внешней контрольной таблицы, в котором хранятся идентификаторы всех секций. Убедитесь, что идентификатор секции уникален для каждой секции в базе данных-источнике.
-   Параметр *Control_Table_Schema_SourceTableName* — имя столбца внешней контрольной таблицы, в котором хранятся имена всех таблиц базы данных-источника.
-   Параметр *Control_Table_Schema_FilterQuery* — это имя столбца внешней контрольной таблицы, в котором хранятся запросы на фильтрацию. Они получают данные из каждой секции базы данных-источника. Например, если разделить данные по годам, запрос, хранимый в каждой строке, может быть похож на select * from datasource where LastModifytime >= ''2015-01-01 00:00:00'' and LastModifytime <= ''2015-12-31 23:59:59.999".
-   Параметр *Data_Destination_Folder_Path* — это путь к папке, в которой находится целевое хранилище, куда копируются данные.  Этот параметр отображается только в том случае, если выбранное целевое хранилище является файловым.  Если в качестве целевого хранилища выступает Хранилище данных SQL, сюда не требуется вводить параметры. Однако имена таблиц и схема Хранилища данных SQL должны совпадать с именами таблиц и схемой базы данных-источника.

## <a name="how-to-use-this-solution-template"></a>Использование шаблона решения

1. Создайте контрольную таблицу в SQL Server или SQL Azure, чтобы там хранить список секций базы данных-источника для массового копирования.  В приведенном ниже примере показаны пять секций базы данных-источника, три из которых для таблицы *datasource_table*, а другие две для таблицы *project_table*. Столбец *LastModifytime* используется для разделения данных в таблице *datasource_table* базы данных-источника. Запрос, который считывает первую секцию, выглядит следующим образом: select * from datasource_table where LastModifytime >= ''2015-01-01 00:00:00'' and LastModifytime <= ''2015-12-31 23:59:59.999".  В примере также показан аналогичный запрос для считывания данных из других секций. 

     ```sql
            Create table ControlTableForTemplate
            (
            PartitionID int,
            SourceTableName  varchar(255),
            FilterQuery varchar(255)
            );

            INSERT INTO ControlTableForTemplate
            (PartitionID, SourceTableName, FilterQuery)
            VALUES
            (1, 'datasource_table','select * from datasource_table where LastModifytime >= ''2015-01-01 00:00:00'' and LastModifytime <= ''2015-12-31 23:59:59.999'''),
            (2, 'datasource_table','select * from datasource_table where LastModifytime >= ''2016-01-01 00:00:00'' and LastModifytime <= ''2016-12-31 23:59:59.999'''),
            (3, 'datasource_table','select * from datasource_table where LastModifytime >= ''2017-01-01 00:00:00'' and LastModifytime <= ''2017-12-31 23:59:59.999'''),
            (4, 'project_table','select * from project_table where ID >= 0 and ID < 1000'),
            (5, 'project_table','select * from project_table where ID >= 1000 and ID < 2000');
    ```

2. Перейдите к шаблону **Bulk Copy from Database** (Массовое копирование из базы данных) и создайте **подключение** к внешней контрольной таблице.  Это подключение устанавливает соединение с базой данных, в которой создана контрольная таблица на шаге 1.

    ![Создание подключения к контрольной таблице](media/solution-template-bulk-copy-with-control-table/BulkCopyfromDB_with_ControlTable2.png)

3. Создайте **подключение** к базе данных-источнику, из которой будут копироваться данные.

     ![Создание подключения к базе данных-источнику](media/solution-template-bulk-copy-with-control-table/BulkCopyfromDB_with_ControlTable3.png)
    
4. Создайте **подключение** к целевому хранилищу данных, в которое будут копироваться данные.

    ![Создание подключения к целевому хранилищу](media/solution-template-bulk-copy-with-control-table/BulkCopyfromDB_with_ControlTable4.png)

5. Щелкните **Использовать этот шаблон**.

    ![Использовать этот шаблон](media/solution-template-bulk-copy-with-control-table/BulkCopyfromDB_with_ControlTable5.png)
    
6. На панели откроется доступный конвейер, как показано в следующем примере:

    ![Проверка конвейера](media/solution-template-bulk-copy-with-control-table/BulkCopyfromDB_with_ControlTable6.png)

7. Щелкните **Отладка**, введите параметры, а затем нажмите кнопку **Готово**.

    ![Значок отладки](media/solution-template-bulk-copy-with-control-table/BulkCopyfromDB_with_ControlTable7.png)

8. На панели появятся результаты, как показано в следующем примере:

    ![Просмотр результатов](media/solution-template-bulk-copy-with-control-table/BulkCopyfromDB_with_ControlTable8.png)

9. (Необязательно.) При выборе Хранилища данных SQL в качестве целевого хранилища необходимо также установить (ввести) подключение к хранилищу BLOB-объектов Azure (расположение для промежуточного хранения), которое необходимо для использования Polybase с Хранилищем данных SQL.  Убедитесь, что контейнер в хранилище BLOB-объектов уже создан.  
    
    ![Настройка Polybase](media/solution-template-bulk-copy-with-control-table/BulkCopyfromDB_with_ControlTable9.png)
       
## <a name="next-steps"></a>Дополнительная информация

- [Общие сведения о службе фабрики данных Azure, службе интеграции данных в облаке](introduction.md)