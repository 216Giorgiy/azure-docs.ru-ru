<properties title="Масштабирование веб-сайта" pageTitle="Масштабирование веб-сайта" description="Узнайте, как масштабировать план размещения в Azure." authors="stepsic"  />

# Масштабирование веб-сайта

На портале Azure (предварительная версия) можно вручную задать число экземпляров для используемого плана размещения веб-сайтов либо можно задать параметры для его автоматического масштабирования. Перед настройкой масштабирования плана размещения веб-сайтов следует учитывать, что на масштабирование влияет размер экземпляра. Для больших размеров используется больше ядер и памяти, и таким образом они обладают более высокой производительностью для того же числа экземпляров.

Масштабирование влияет на весь план размещения веб-сайтов. При создании веб-сайта можно создать новый план размещения веб-сайтов или использовать существующий план. После определения плана размещения веб-сайтов все сайты будут совместно использовать одни и те же экземпляры, поэтому все они масштабируются совместно.

## Масштабирование плана размещения веб-сайтов

1. На [портале Azure (предварительная версия)](https://portal.azure.com/) выберите кнопку **Обзор**, затем **Веб-сайты**, а затем щелкните имя веб-сайта, чтобы открыть соответствующую выноску.

2. Часть **Масштаб** области **Операции** на выноске "Веб-сайт" содержит состояние плана размещения веб-сайтов: **Выключено** для ручного масштабирования, **Производительность** для масштабирования по одной или нескольким метрикам производительности и **Расписание**, если включено несколько профилей автомасштабирования.

    ![Часть "Масштаб"](./media/insights-how-to-scale/Insights_ScalePartOff.png)

3. Щелчок этой части открывает выноску **Масштаб**. В верхней части выноски масштаба находится журнал действий автомасштабирования для плана размещения веб-сайтов.

    ![Выноска "Масштаб"](./media/insights-how-to-scale/Insights_ScaleBladeDayZero.png)

4. Можно вручную настроить число виртуальных машин, используемых планом размещения веб-сайтов, с помощью ползунка **Экземпляр**. 

5. Если нужно, чтобы число экземпляров автоматически настраивалось в зависимости от нагрузки, выберите **Производительность** в списке **Режим автомасштабирования**. В данный момент нельзя выбрать **Расписание** на портале Azure (предварительная версия).

    ![Выноска "Масштаб" с метрикой "Процент ЦП"](./media/insights-how-to-scale/Insights_ScaleBladeCPU.png) 

6. Если выбран вариант "Производительность", доступны два изменения:
    - **Диапазон экземпляров** теперь позволяет выбрать максимальное и минимальное количество экземпляров. Автомасштабирование позволит всегда оставаться в этом диапазоне, независимо от нагрузки.
    - В разделе **Целевые метрики** можно определить показатели производительности

7. Раздел **Процент ЦП** позволяет задать в плане размещения веб-сайтов целевой объект для средней загрузки ЦП всех экземпляров. Когда среднее значение загрузки ЦП превышает заданный максимум, выполняется масштабирование вверх.

При включенном автоматическом масштабировании в части выноски "Веб-сайт" появится **Производительность**, а на диаграмме будет показан журнал масштабирования:

![Выноска "Масштаб" с метрикой "Процент ЦП"](./media/insights-how-to-scale/Insights_ScalePartBladeOn.png) 

Обратите внимание, что на портале Azure (предварительная версия) нельзя изменить количество экземпляров общего плана размещения веб-сайтов.

## Расширенное масштабирование

Теперь на портале Azure (предварительная версия) можно выполнять масштабирование на основе не только метрики "Процент ЦП", но и других метрик. Можно даже создать сложный набор правил для масштабирования верх и вниз.

### Масштабирование на основе других метрик производительности
Помимо ЦП, можно выполнять масштабирование на основе следующих метрик.

- Среднее значение памяти. - Если средний процент памяти, используемой экземплярами, становится выше или ниже заданных порогов, выполняется добавление или удаление экземпляров.
- Длина очереди диска или длина очереди HTTP. - Если число сообщений либо в очереди запросов HTTP, либо в очереди диска оказывается выше или ниже заданного порога, выполняется добавление или удаление экземпляров.

Существует два различных способа масштабирования по другой метрике. Для масштабирования только по одной метрике выберите значок шеврона рядом с ползунком **Процент ЦП**. Откроется выноска "Сведения о метрике":

   ![Точка входа для масштабирования по метрикам](./media/insights-how-to-scale/Insights_ScaleMetricChevron.png)

Чтобы выполнить масштабирование одновременно по нескольким метрикам, щелкните **Добавить метрику** на панели команд:

   ![Добавление метрик](./media/insights-how-to-scale/Insights_AddMetric.png)
   
Выноска "Сведения о метрике" содержит все элементы управления, необходимые для настройки оптимального профиля масштабирования. Вверху выберите новую метрику, по которой нужно выполнять масштабирование.

### Масштабирование в несколько шагов

Под графиком метрики находятся два раздела **Правила масштабирования вверх** и **Правила масштабирования вниз**. Служба будет масштабирована вверх в случае выполнения **любого** из правил масштабирования вверх. Напротив, служба будет масштабирована вниз в случае выполнения **всех** правил масштабирования вниз.

Для каждого правила можно выбрать:
- Условие - либо "Больше чем", либо "Меньше чем"
- Порог - число, которого должна достигнуть эта метрика, чтобы запустить действие
- За последние - количество минут, в течение которого усредняется эта метрика
- Увеличить или уменьшить масштаб по - размер действия масштабирования
- Охлаждение - время ожидания для этого правила после предыдущего действия масштабирования

   ![Несколько правил масштабирования](./media/insights-how-to-scale/Insights_MultipleScaleRules.png)

Использование нескольких правил масштабирования позволяет более агрессивно выполнять увеличение (или уменьшение) масштаба изменения производительности. Например, можно определить два правила масштабирования:

1. Масштабирование вверх на 1 экземпляр, если процент ЦП превышает 60 %

2. Масштабирование вверх на 3 экземпляра, если процент ЦП превышает 85 %

Благодаря этому дополнительному правилу, если нагрузка перед масштабированием превышает 85 %, вы получите два дополнительных экземпляра вместо одного. 

