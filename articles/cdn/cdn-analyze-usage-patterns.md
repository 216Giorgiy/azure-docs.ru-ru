<properties 
	pageTitle="Анализ вариантов использования CDN" 
	description="Вы можете просмотреть способы использования CDN, опираясь на следующие отчеты: ";Пропускная способность";, ";Переданные данные";, ";Попадания";, ";Состояния кэша";, ";Коэффициент попадания в кэш";, ";Данные, переданные по протоколам IPV4/IPV6";." 
	services="cdn" 
	documentationCenter=".NET" 
	authors="camsoper" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="cdn" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="12/02/2015" 
	ms.author="casoper"/>

# Анализ вариантов использования CDN 

Вы можете просмотреть способы использования CDN при помощи следующих отчетов:

- Пропускная способность
- Переданные данные
- Попадания
- Состояния кэша
- Коэффициент попаданий в кэш
- Переданные данные по протоколам IPV4/IPV6 

## Пропускная способность

Отчет о пропускной способности состоит из графика и таблицы данных, в которой указана задействованная пропускная способность для HTTP и HTTPS в течение определенного временного периода. Вы можете просматривать задействование пропускной способности по всем POP CDN или для конкретного POP. Это позволяет просматривать пики и распределение трафика через POP CDN в Мбит/с.

- Выберите "Все узлы Edge", чтобы увидеть трафик ото всех узлов или выберите конкретный регион/узел из раскрывающегося списка.
- Выберите "Диапазон дат", чтобы просмотреть данные за сегодня/эту неделю/этот месяц и т. п., или введите пользовательские даты, после чего щелкните "Далее", чтобы обновить выбранные даты.
- Можно экспортировать и загружать данные, щелкнув значок листа Excel рядом с кнопкой "Далее". 
 
Отчет обновляется каждые 5 минут.

![Отчет о пропускной способности](./media/cdn-reports/cdn-bandwidth.png)

## Переданные данные

Этот отчет состоит из графика и таблицы данных, в которой указан трафик HTTP и HTTPS в течение определенного временного периода. Вы можете просматривать использование трафика по всем POP CDN или для конкретного POP. Это позволяет просматривать пики и распределение трафика через POP CDN в гигабайтах.

- Выберите "Все узлы Edge", чтобы увидеть трафик ото всех узлов или выберите конкретный регион/узел из раскрывающегося списка.
- Выберите "Диапазон дат", чтобы просмотреть данные за сегодня/эту неделю/этот месяц и т. п., или введите пользовательские даты, после чего щелкните "Далее", чтобы обновить выбранные даты.
- Можно экспортировать и загружать данные, щелкнув значок листа Excel рядом с кнопкой "Далее".
 
Отчет обновляется каждые 5 минут.

![Отчет о переданных данных](./media/cdn-reports/cdn-data-transferred.png)

## Попадания (коды состояния)

В этом отчете описывается распределение кодов состояния запросов для вашего содержимого. Каждый запрос содержимого создает код состояния HTTP. Код состояния описывает то, как крайние POP обработали запрос. Например, коды состояния вида 2xx указывают на то, что запрос был успешно передан клиенту, в то время как код состояния вида 4xx указывает на наличие ошибки. Дополнительные сведения о коде состояния HTTP см. в разделе [Коды состояния](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes).
 
- Выберите "Диапазон дат", чтобы просмотреть данные за сегодня/эту неделю/этот месяц и т. п., или введите пользовательские даты, после чего щелкните "Далее", чтобы обновить выбранные даты.
- Можно экспортировать и загружать данные, щелкнув лист Excel рядом с кнопкой "Далее".

![Отчет о попаданиях](./media/cdn-reports/cdn-hits.png)

## Состояния кэша

В этом отчете описывается распределение попаданий и непопаданий в кэш для клиентского запроса. Поскольку наибольшая производительность возникает при наличии попаданий в кэш, вы можете оптимизировать скорость предоставления данных, сведя к минимуму непопадания и попадания, потерявшие актуальность. Количество непопаданий в кэш можно уменьшить, настроив сервер-источник так, чтобы он не назначал отклики "без кэша", не кэшируя строки запросов, за исключением тех случаев, когда это строго необходимо, и не используя коды ответов, которые не могут быть кэшированы. Просроченных попадания в кэш можно избежать за счет максимального возраста ресурс-контейнера, чтобы свести к минимуму количество запросов к серверу-источнику.

![Отчет о попаданиях в кэш](./media/cdn-reports/cdn-cache-statuses.png)

### Существуют следующие состояния кэша: 

- TCP\_HIT: подано с Edge. Объект находился в кэше и не превысил максимального возраста.
- TCP\_MISS: подано с сервера-источника. Объект не находился в кэше, и отклик был получен от сервера-источника. 
- TCP\_EXPIRED \_MISS: подано из источника после повторной проверки с сервером-источником. Объект находился в кэше, однако он превысил максимальный возраст, заданный для него. Повторная сверка с сервером-источником привела к тому, что объект кэша был замещен новым откликом от источника.
- TCP\_EXPIRED \_HIT: получено с Edge после повторной сверки с источником. Объект находился в кэше, однако он превысил максимальный возраст, заданный для него. Повторная сверка с сервером-источником привела к тому, что объект кэша остался неизменным.

- Выберите "Диапазон дат", чтобы просмотреть данные за сегодня/эту неделю/этот месяц и т. п., или введите пользовательские даты, после чего щелкните "Далее", чтобы обновить выбранные даты.
- Можно экспортировать и загружать данные, щелкнув значок листа Excel рядом с кнопкой "Далее".

### Полный список состояний кэша

- TCP\_HIT ― это состояние передается тогда, когда запрос напрямую обрабатывается на POP и передается в клиент. Ресурс немедленно отправляется с POP, если он кэширован на POP, который расположен наиболее близко к клиенту, и имеет допустимое значение срока жизни (TTL). TTL определяется следующими заголовками отклика:

	- Cache-Control: s-maxage
	- Cache-Control: max-age
	- Expires

- TCP\_MISS — это состояние указывает, что кэшированная версия запрошенного ресурс-контейнера не была найдена на ближайшем к клиенту POP. Ресурс-контейнер будет запрошен с сервера-источника или защитного сервера-источника. Если сервер-источник или защитный сервер-источник возвратит ресурс-контейнер, он будет передан клиенту и кэширован как на клиенте, так и на граничном сервере. В противном случае будет возвращен код состояния, отличный от 200 (например, 403 Forbidden, 404 Not Found и т. п.).

- TCP\_EXPIRED \_HIT — это состояние передается тогда, когда запрос к определенному ресурсу, срок жизни которого истек (превысил TTL), например в случае истечения срока, заданного параметром max-age, был напрямую обработан на POP и передан клиенту.

	Запрос, срок действия которого истек, обычно приводит к формированию запроса на повторную сверку с сервером-источником. Чтобы возникло событие TCP\_EXPIRED \_HIT, сервер-источник должен указать, что более новой версии не существует. В такой ситуации обычно выполняется обновление заголовков Cache-Control и Expires в ресурс-контейнере.

- TCP\_EXPIRED \_MISS — это состояние возникает в том случае, когда от POP клиенту передается новая версия просроченного ресурс-контейнера. Это происходит, когда TTL для кэшированного ресурс-контейнера истекает (например, истек срок, заданный в параметре max-age), а сервер-источник возвращает более новую версию этого ресурс-контейнера. Эта новая версия ресурс-контейнера будет передана в клиент вместо кэшированной версии. Кроме того, она будет кэширована на граничном сервере и на клиенте.

- CONFIG\_NOCACHE — это состояние указывает, что конфигурация, зависящая от клиента на нашем граничном POP, не позволила кэшировать ресурс-контейнер.

- NONE — это состояние указывает на то, что проверка актуальности содержимого кэша не была выполнена.

- TCP\_ CLIENT\_REFRESH \_MISS — это состояние передается тогда, когда клиент HTTP (например, браузер) принудительно заставляет граничный POP извлекать новую версию старого ресурс-контейнера с сервера-источника.

	По умолчанию наши серверы не позволяют выполнять принудительное извлечение новой версии ресурс-контейнера с сервера-источника, инициированное со стороны клиента HTTP.

- TCP\_ PARTIAL\_HIT — это состояние возникает, когда запрос по диапазону байтов приводит к нахождению совпадения с частично кэшированным ресурс-контейнером. Запрошенный диапазон байтов немедленно передается от POP клиенту.

- UNCACHEABLE — это состояние возникает тогда, когда заголовки Cache-Control и Expires ресурс-контейнера указывают, что он не должен кэшироваться на POP или в клиенте HTTP. Эти типы запросов обслуживаются на сервере-источнике

## Коэффициент попаданий в кэш

В этом отчете указывается процент кэшированных запросов, обработанных напрямую из кэша.

Он содержит указанные ниже сведения.

- Запрошенное содержимое было кэшировано на ближайшем к запрашивающему клиенту POP.
- Запрос был обработан непосредственно на уровне границы в нашей сети.
- Запрос не потребовал повторной сверки с сервером-источником. 

В отчете отсутствуют:

- Запросы, в обработке которых отказано из-за параметров фильтрации, зависящих от страны.
- Запросы ресурсов, заголовки которых указывают, что они не должны кэшироваться. Например, заголовки Cache-Control: private, Cache-Control: no-cache или Pragma: no-cache не позволяют кэшировать ресурс-контейнер. 
- Запросы диапазона байтов для частично кэшированного содержимого.

Формула: (TCP\_ HIT/(TCP\_ HIT+TCP\_MISS))*100

- Выберите "Диапазон дат", чтобы просмотреть данные за сегодня/эту неделю/этот месяц и т. п., или введите пользовательские даты, после чего щелкните "Далее", чтобы обновить выбранные даты.
- Можно экспортировать и загружать данные, щелкнув значок листа Excel рядом с кнопкой "Далее".


![Отчет о коэффициенте попадания в кэш](./media/cdn-reports/cdn-cache-hit-ratio.png)

## Переданные данные по протоколам IPV4/IPV6 

В этом отчете показано распределение использования трафика по протоколам IPV4 и IPV6.

![Переданные данные по протоколам IPV4/IPV6](./media/cdn-reports/cdn-ipv4-ipv6.png)

- Выберите "Диапазон дат", чтобы просмотреть данные за сегодня/эту неделю/этот месяц и т. п., или введите пользовательские даты.
- Нажмите кнопку "Далее", чтобы обновить выбранные даты.


## Рекомендации

Отчеты могут формироваться только за последние 18 месяцев.

<!---HONumber=AcomDC_1203_2015-->