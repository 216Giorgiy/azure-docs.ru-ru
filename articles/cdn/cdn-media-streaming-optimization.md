---
title: "Оптимизация потоковой передачи мультимедиа c помощью Azure CDN"
description: "Оптимизация потоковой передачи файлов мультимедиа для непрерывной трансляции"
services: cdn
documentationcenter: 
author: smcevoy
manager: erikre
editor: 
ms.assetid: 
ms.service: cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: v-semcev
ms.translationtype: Human Translation
ms.sourcegitcommit: 857267f46f6a2d545fc402ebf3a12f21c62ecd21
ms.openlocfilehash: 582eb69ccd2830643644760753cca1c96d72128d
ms.contentlocale: ru-ru
ms.lasthandoff: 06/28/2017

---
# <a name="media-streaming-optimization-via-azure-cdn"></a>Оптимизация потоковой передачи мультимедиа c помощью Azure CDN 
 
Видео высокого разрешения становится достаточно большой частью Интернета, что создает различные затруднения быстрой доставки файлов большего объема через Интернет. Пользователи ожидают плавного воспроизведения VOD или потокового видео в разных сетях и клиентах по всему миру. Для потребителей критически важно предоставлять более быстрый и эффективный механизм потоковой передачи файлов мультимедиа.  

Потоковую передачу мультимедиа особенно сложно реализовать, не только из-за больших размеров и количества одновременных зрителей, а также из-за задержки, с которой не хотят мирится пользователи. Потоковые трансляции в прямом эфире не могут кэшироваться заранее, а большие задержки не устраивают зрителей, поэтому фрагменты видео должны передаваться своевременно. 

Шаблоны запросов потоковой передачи также создают некоторые сложности. Во время популярных потоковых трансляций или выхода новых шоу для видео по запросу (VOD) от тысяч до миллионов зрителей запрашивают поток одновременно. В таких случаях правильная консолидация запросов является ключевой для исключения перегрузки серверов-источников, если ресурсы еще не кэшированы.
 
Azure CDN от Akamai предоставляет технологию, которая идеально подходит для эффективной потоковой передачи мультимедиа для конечных пользователей по всему миру с минимальными задержками при сниженной нагрузке на серверы-источники. Эта технология доступна с помощью функции "Оптимизировано для" в конечной точке Azure CDN, созданной в профиле Azure CDN ценовой категории Akamai уровня "Стандартный". Используйте оптимизацию "Потоковая передача видео по запросу" для ресурсов VOD, а тип оптимизации "Потоковая передача мультимедиа в общем режиме" при сочетании потоковой передачи в реальном времени и потоковой передачи VOD.

Azure CDN от Verizon может передавать потоковое мультимедиа непосредственно при оптимизации типа "Общая веб-доставка".
 
## <a name="configuring-cdn-endpoint-to-optimize-delivery-of-media-streaming-in-azure-cdn-from-akamai"></a>Настройка конечной точки CDN для оптимизации доставки потокового мультимедиа в Azure CDN от Akamai
 
Вы можете настроить конечную точку CDN, чтобы оптимизировать доставку больших файлов на портале Azure, выбрав параметр "Потоковая передача мультимедиа в общем режиме" или "Потоковая передача видео по запросу" в свойствах "Оптимизировано для" во время создания конечной точки. Для этого можно также использовать наши интерфейсы REST API или любые клиентские пакеты SDK. На снимке экрана ниже показан процесс на портале Azure. 
  
![Добавление новой конечной точки](./media/cdn-media-streaming-optimization/01_Adding.png)

*Рис. 1. Добавление новой конечной точки CDN из профиля CDN*

![Выбранная потоковая передача](./media/cdn-media-streaming-optimization/02_Creating.png) 
  
*Рис. 2. Создание конечной точки CDN с выбранной потоковой передачей мультимедиа VOD* 
 
После создания конечной точки CDN будет применена оптимизация для всех файлов, соответствующих определенным условиям. В следующем разделе это описано подробно. 
 
## <a name="media-streaming-optimizations-for-azure-cdn-from-akamai"></a>Оптимизация потоковой передачи мультимедиа для Azure CDN от Akamai
 
Оптимизация потоковой передачи мультимедиа от Akamai действует для VOD или потоковой передачи мультимедиа в реальном времени, при доставке которой используются отдельные фрагменты мультимедиа вместо одного большого файла, который передается путем поэтапной загрузки или с помощью запросов диапазона байтов. Дополнительные сведения о таком типе доставки мультимедиа см. в статье [Large file download optimization via the Azure Content Delivery Network](cdn-large-file-optimization.md) (Оптимизация скачивания файлов большого размера с помощью сети доставки содержимого Azure).

При передаче VOD-мультимедиа или доставки мультимедиа в общем режиме будет использоваться сеть CDN с серверной оптимизацией для ускорения доставки мультимедиа, а также конфигурации мультимедиа на основе лучших методов, которые появятся со временем.

### <a name="caching"></a>Caching

Если Azure CDN от Akamai определяет ресурс как манифест потоковой передачи или фрагмент (см. полный список ниже), CDN будет использовать разное время истечения срока кэширования из общего режима доставки. Как всегда, заголовки Cache-Control и Expires, отправленные из источника, будут соблюдаться, и если ресурс не является файлом мультимедиа, он будет кэширован с использованием срока действия для доставки в общем режиме.

Малое отрицательное время кэширования полезно для разгрузки источника, когда фрагмент, который запрашивает большое количество пользователей, еще не существует, например в случае потоковой передачи в реальном времени, если в данный момент пакеты от источника недоступны. Более долгий интервал кэширования также помогает разгрузить запросы от источника, так как видеоконтент обычно не изменяется.
 

|    | Общие сведения<br> web<br>доставки | Общие сведения<br> Схема<br> Потоковая передача | VOD<br>Схема<br> Потоковая передача  
--- | --- | --- | ---
Кэширование: положительное <br> HTTP 200, 203, 300, <br> 301, 302 и 410 | 7 дней |365 дней | 365 дней   
Кэширование: отрицательное <br> HTTP 204, 305, 404 <br> и 405 | Нет | 1 с | 1 с
 
### <a name="dealing-with-origin-failure"></a>Устранение сбоев источника  

Передача в общем режиме и доставка мультимедиа VOD также имеют журнал времени ожидания и повторов источника в соответствии с рекомендациями для шаблонов типичных запросов. Например, так как передача мультимедиа в общем режиме предназначена для динамической передачи и доставки мультимедиа VOD, ее время ожидания подключения значительно меньше из-за конфиденциального характера потоковой передачи.

После истечения времени ожидания подключения CDN повторит попытку подключения несколько раз, прежде чем отправить клиенту ошибку времени ожидания шлюза 504. 

Если файл соответствует типу файла и списку условий размеров, CDN определяет его как потоковую передачу, а в противном случае как передачу мультимедиа в общем режиме. 
   
### <a name="conditions-for-media-streaming-optimization"></a>Условия для оптимизации потоковой передачи мультимедиа 

В следующей таблице перечислен набор критериев, которые должны быть удовлетворены для этой оптимизации. 
 
Поддерживаемые типы потоковой передачи | Расширения файлов  
--- | ---  
Apple HLS | m3u8, m3u, m3ub, key, ts, aac
Adobe HDS | f4m, f4x, drmmeta, bootstrap, f4f,<br>Структура URL Seg-Frag <br> (сопоставления регулярного выражения: ^(/.*)Seq(\d+)-Frag(\d+)
DASH | mpd, тире, divx, ismv, m4s, m4v, mp4, mp4v, <br> sidx, webm, mp4a, m4a, isma
Smooth Streaming | /manifest/,/QualityLevels/Fragments/
  

 
## <a name="media-streaming-optimizations-for-azure-cdn-from-verizon"></a>Оптимизация потоковой передачи мультимедиа для Azure CDN от Verizon

Azure CDN от Verizon может доставлять потоковое мультимедиа непосредственно при использовании оптимизации "Общая веб-доставка". Существует несколько функций CDN по умолчанию, которые непосредственно способствуют доставке мультимедиа.

### <a name="partial-cache-sharing"></a>Совместное использование частичного кэширования

Эта функция позволяет обслуживать частично кэшированное содержимое из сети CDN для новых запросов. Например, это означает, что если первый запрос к результатам CDN завершился промахом кэша, то запрос отправляется к источнику. Хотя это содержимое по-прежнему загружается в кэш CDN (но еще не завершено), остальные запросы к CDN начнут получать эти данные. 

### <a name="cache-fill-wait-time"></a>Время ожидания заполнения кэша

Эта функция полезна в сочетании с совместным доступом к частичному кэшированию. Функция времени ожидания заполнения кэша вынуждает граничный сервер удерживать последующие запросы к тому же ресурсу, пока не вернутся заголовки HTTP-ответа с сервера-источника. Если заголовки HTTP-ответа с сервера-источника поступают до истечения времени ожидания, все запросы, которые удерживались в растущем кэше, не будут обслуживаться (в то же время, кэш будет заполняться данными из источника). Время ожидания заполнения кэша по умолчанию равно 3000 мс. 


