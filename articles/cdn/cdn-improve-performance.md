<properties
	pageTitle="CDN — увеличьте производительность путем сжатия файлов"
	description="Вы можете увеличить скорость передачи файлов и увеличить производительность загрузки страницы с помощью сжатия файлов."
	services="cdn"
	documentationCenter=".NET"
	authors="camsoper"
	manager="erikre"
	editor=""/>

<tags
	ms.service="cdn"
	ms.workload="tbd"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="04/26/2016" 
	ms.author="casoper"/>

# Увеличьте производительность путем сжатия файлов

В этом разделе обсуждается повышение скорости передачи файлов и производительности загрузки страниц с помощью сжатия файлов.

CDN поддерживает два способа сжатия.

- Можно включить сжатие на исходном сервере — в таком случае CDN будет по умолчанию поддерживать сжатие и доставлять сжатые файлы клиентам.
- Можно включить сжатие непосредственно на пограничных серверах CDN — в таком случае CDN будет сжимать файлы и доставлять их конечным пользователям.

## Включение сжатия

> [AZURE.NOTE] Уровни CDN «Стандартный» и «Премиум» предоставляют одинаковые возможности сжатия, но разные пользовательские интерфейсы. Подробнее о различиях между уровнями CDN «Стандартный» и «Премиум» см. в разделе [Обзор Azure CDN](cdn-overview.md).

### Уровень Standard

1. В колонке профиля CDN щелкните конечную точку CDN, которой хотите управлять.

	![Конечные точки в колонке профиля CDN](./media/cdn-file-compression/cdn-endpoints.png)

	Откроется колонка конечной точки CDN.

2. Нажмите кнопку **Настроить**.

	![Кнопка управления в колонке профиля CDN](./media/cdn-file-compression/cdn-config-btn.png)

	Откроется колонка настройки CDN.

3. Включите параметр **Сжатие**.

	![Параметры сжатия CDN](./media/cdn-file-compression/cdn-compress-standard.png)

4. Используйте типы по умолчанию либо измените список, удалив или добавив типы файлов.

5. Внеся необходимые изменения, нажмите кнопку **Сохранить**.

### Уровень Premium

1. В колонке профиля CDN нажмите кнопку **Управление**.

	![Кнопка управления в колонке профиля CDN](./media/cdn-file-compression/cdn-manage-btn.png)

	Откроется портал управления CDN.

2. Наведите указатель мыши на вкладку **HTTP Large** (Большая платформа HTTP), а затем — на всплывающий элемент **Параметры кэша**. Щелкните **Сжатие**.

	Отобразятся параметры сжатия.

	![Сжатие файлов](./media/cdn-file-compression/cdn-compress-files.png)

3. Включите сжатие, выбрав переключатель **Использовать сжатие**. Введите типы MIME для сжатия в виде списка с разделителями-запятыми (без пробелов) в текстовом поле **Типы файлов**.

4. Внеся необходимые изменения, нажмите кнопку **Обновить**.


## Процесс сжатия

### Обзор

1. Инициатор отправляет запрос содержимого.

2. Граничный сервер проверяет наличие заголовка **Accept-Encoding**.
	1. Если заголовок имеется, то в нем указан запрошенный метод сжатия.
		> [AZURE.NOTE] Поддерживаются методы сжатия **gzip**, **deflate** и **bzip2**.
	2. Если заголовок отсутствует, то запрос этого типа будет обслужен без сжатия.
	
3.	Ближайший граничный POP проверяет состояние кэша, метод сжатия и наличие допустимого значения срока жизни.
	1.	**Промах** кэша: если запрошенная версия не кэширована, запрос перенаправляется в источник.
	2.	**Попадание** в кэш: если запрошенная версия кэширована с использованием запрошенного метода сжатия, граничный сервер незамедлительно доставляет сжатое содержимое клиенту.
	3.	**Попадание**в кэш: если файл кэширован с использованием другого метода сжатия, граничный сервер перекодирует ресурс-контейнер с использованием запрашиваемого метода сжатия.
	4.	**Попадание** в кэш: если файл кэширован в несжатом формате, будет выполнена проверка, допустимо ли для запроса использовать сжатие на граничном сервере (см. примечание ниже). Если сжатие допустимо, граничный сервер произведет сжатие файла и доставит его клиенту. В противном случае он вернет несжатое содержимое.
		
> [AZURE.IMPORTANT] Сжатие допускается для следующих файлов:
>
> - более 128 байт;
> - менее 1 МБ;
> - с типом MIME, для которого [в настройках разрешено сжатие](#enabling-compression).

### Таблицы

В приведенных ниже таблицах описана работа сжатия CDN для всех сценариев.

#### Сжатие отключено или для файла сжатие недопустимо

|Запрошенный формат|Кэшированный файл|Ответ CDN|Примечания|
|----------------|-----------|------------|-----|
|сжатые;|сжатые;|сжатые;|CDN перекодирует из одного поддерживаемого формата в другой|
|сжатые;|Без сжатия|Без сжатия| |	
|сжатые;|Не кэширован|Сжатый или несжатый|Зависит от ответа источника|
|Без сжатия|сжатые;|Без сжатия|CDN обратится к источнику за несжатой версией|
|Без сжатия|Без сжатия|Без сжатия| |	
|Без сжатия|Не кэширован|Без сжатия| |

#### Сжатие включено и для файла допускается сжатие

|Запрошенный формат|Кэшированный файл|Ответ CDN|Примечания|
|----------------|-----------|------------|-----|
|сжатые;|сжатые;|сжатые;|CDN перекодирует из одного поддерживаемого формата в другой|
|сжатые;|Без сжатия|сжатые;|CDN выполняет сжатие|
|сжатые;|Не кэширован|сжатые;|CDN выполняет сжатие, если источник возвращает несжатый файл|
|Без сжатия|сжатые;|Без сжатия|CDN проводит распаковку|
|Без сжатия|Без сжатия|Без сжатия| |	
|Без сжатия|Не кэширован|Без сжатия| |	


## Примечания

1. Как и при развертывании новых конечных точек, требуется некоторое время для распространения изменений конфигурации CDN по сети. В большинстве случаев изменения вступают в силу в течение 90 минут. Если сжатие для конечной точки CDN задается впервые, перед устранением неполадок следует подождать 1–2 часа, чтобы настройки сжатия гарантированно распространились на серверы POP.
2. Только одна версия файла (сжатая или несжатая) будет кэширована на граничном сервере. Запрос другой версии приведет к перекодированию содержимого граничным сервером.
3. Для конечных точек потоковой передачи служб мультимедиа с CDN сжатие включено по умолчанию для следующих типов содержимого: application/vnd.ms-sstr+xml, application/dash+xml, application/vnd.apple.mpegurl, application/f4m+xml. Вы не может включить или отключить сжатие для упомянутых выше типов с помощью портала Azure.  
4. Хотя это и возможно, тем не менее не рекомендуется применять сжатие для сжатых форматов, таких как ZIP, MP3, MP4, JPG и т. д.

## См. также
- [Устранение неполадок со сжатием файлов CDN](cdn-troubleshoot-compression.md)    

<!---HONumber=AcomDC_0504_2016-->