<properties 
	pageTitle="CDN — увеличьте производительность путем сжатия файлов"
	description="Вы можете увеличить скорость передачи файлов и увеличить производительность загрузки страницы с помощью сжатия файлов."
	services="cdn"
	documentationCenter=".NET"
	authors="juliako"
	manager="dwrede"
	editor=""/>

<tags 
	ms.service="cdn"
	ms.workload="tbd"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="09/01/2015"
	ms.author="juliako"/>

#Увеличьте производительность путем сжатия файлов

В этом разделе обсуждается повышение скорости передачи файла и производительности загрузки страниц с помощью сжатия файлов.

CDN поддерживает два способа сжатия.

- Можно включить сжатие на исходном сервере — в таком случае CDN будет по умолчанию поддерживать сжатие и доставлять сжатые файлы клиентам. 
- Можно включить сжатие непосредственно на пограничных серверах CDN — в таком случае CDN будет сжимать файлы и доставлять их конечным пользователям.

##Определения

- Заголовок запроса **Accept-Encoding** ― этот заголовок указывает методы сжатия, поддерживаемые агентом пользователя. Он должен быть включен в заголовок запроса. Дополнительные сведения см. в разделе [Определения полей заголовков](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html).
- **Тип содержимого** — список типов содержимого должен быть добавлен для сжатия. Сжатие доступно только для текстовых файлов. Например, text/plain, text/html.
- **Метод сжатия** — поддерживаемыми методами сжатия являются gzip/deflate/bzip2, поддерживаемый метод должен быть указан в заголовке запроса Accept-Encoding. 
- **Состояние кэша** — состояние кэша определяет, кэшировано ли запрошенное содержимое на POP, ближайшем к инициатору.  
- **Размер файла** — по умолчанию сжатие поддерживает только файлы размером более 1 байта и менее 1 МБ.  

##Рабочий процесс

1. Инициатор отправляет запрос содержимого.
2. Пограничный сервер проверяет, имеется ли заголовок **Accept-Encoding**.
	1. Если заголовок имеется, то в нем указан запрошенный метод сжатия.
	1. Если заголовок отсутствует, то запрос этого типа будет обслужен без сжатия.
3.	Ближайший граничный POP проверяет состояние кэша, метод сжатия и наличие допустимого значения TTL.
	1.	Промах кэша: если запрошенная версия не кэширована, запрос перенаправляется на источник.
	2.	Попадание в кэш с тем же методом сжатия: граничный сервер незамедлительно доставит сжатое содержимое клиенту.
	3.	Попадание в кэш с другим методом сжатия: граничный сервер перекодирует ресурс запрашиваемым методом сжатия. 
	4.	Попадание в кэш и несжатые данные: если первоначальный запрос вызвал кэширование ресурса в несжатом формате, будет выполнена проверка допустимости запроса для сжатия граничным сервером (на основе критерия в вышеуказанном разделе определения/требования).
		1.	Если сжатие допустимо, граничный сервер произведет сжатие файла и доставит его клиенту.
		2.	Если недопустимо, граничный сервер незамедлительно доставит несжатое содержимое клиенту. 

![Сжатие файлов](./media/cdn-file-compression/cdn-compress-files.png)

##Рекомендации 

1. Для конечных точек потоковой передачи с CDN служб мультимедиа сжатие включено по умолчанию для следующих типов содержимого: application/vnd.ms-sstr+xml,application/dash+xml,application/vnd.apple.mpegurl,application/f4m+xml. Вы не может включить или отключить сжатие для упомянутых выше типов с помощью портала Azure.  
2. Только одна версия файла (сжатая или несжатая) будет кэширована на граничном сервере. Запрос другой версии приведет к перекодированию содержимого граничным сервером.  

<!---HONumber=September15_HO1-->