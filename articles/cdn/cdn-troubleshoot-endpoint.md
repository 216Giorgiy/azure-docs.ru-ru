<properties
	pageTitle="Устранение неполадок с конечными точками Azure CDN, которые возвращают состояние 404 | Microsoft Azure"
	description="Устранение неполадок с конечными точками Azure CDN, связанных с кодами ответа 404."
	services="cdn"
	documentationCenter=""
	authors="camsoper"
	manager="erikre"
	editor=""/>

<tags
	ms.service="cdn"
	ms.workload="tbd"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="07/28/2016"
	ms.author="casoper"/>
    
# Устранение неполадок конечных точек CDN, возвращающих состояние 404

Эта статья поможет вам устранить неполадки с [конечными точками CDN](cdn-create-new-endpoint.md), возвращающими ошибки 404.

Если вам потребуется дополнительная помощь по любому из вопросов, рассматриваемых в статье, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт службы поддержки Azure](https://azure.microsoft.com/support/options/) и щелкните **Поддержка**.

## Симптом

Вы создали профиль CDN и конечную точку, но содержимое недоступно в сети CDN. Пользователи, пытающиеся получить доступ к вашему содержимому через URL-адрес CDN, получают коды состояния HTTP 404.

## Причина:

Возможно несколько причин, включая указанные ниже.

- Источник файла недоступен для CDN.
- Конечная точка настроена неправильно, поэтому CDN выполняет поиск в неправильном месте.
- Узел отклоняет заголовок узла от CDN.
- У конечной точки не было времени для распространения в сети CDN.

## Действия по устранению неполадок

> [AZURE.IMPORTANT] После создания конечной точки CDN она не будет доступна сразу. Распространение регистрационных сведений по сети CDN может занять некоторое время. Для профилей <b>Azure CDN от Akamai</b> распространение обычно завершается в течение одной минуты. Для профилей <b>Azure CDN от Verizon</b> распространение обычно завершается в течение 90 минут, но в некоторых случаях может занимать больше времени. Если вы по-прежнему получаете ответы 404 после выполнения процедур, описанных в этом документе, подождите еще несколько часов, чтобы повторить проверку, прежде чем открыть запрос в службу поддержки.

### Проверка исходного файла

Во-первых, следует убедиться, что нужный кэшированный файл доступен в источнике в режиме общего доступа. Самый быстрый способ — открыть браузер в анонимном режиме или режиме InPrivate и перейти к файлу напрямую. Просто введите или вставьте URL-адрес в поле адреса и убедитесь, что выведен нужный вам файл. В этом примере я собираюсь использовать файл из своей учетной записи хранения Azure, доступный по адресу `https://cdndocdemo.blob.core.windows.net/publicblob/lorem.txt`. Как видим, проверка пройдена успешно.

![Готово!](./media/cdn-troubleshoot-endpoint/cdn-origin-file.png)

> [AZURE.WARNING] Хотя это и самый быстрый и простой способ проверки общего доступа к файлу, некоторые конфигурации сети в организации могут создавать впечатление, что этот файл является общедоступным, когда как на самом деле он доступен только для пользователей вашей корпоративной сети (даже если размещен в Azure). При наличии внешнего браузера, из которого можно выполнить проверку, например, на мобильном устройстве, не подключенном к сети вашей организации, или на виртуальной машине в Azure, проверка будет действительно эффективной.

### Проверка параметров источника

Когда мы убедились, что файл находится в открытом доступе в Интернете, необходимо проверить параметры источника. На [портале Azure](https://portal.azure.com) перейдите к профилю CDN и щелкните конечную точку, для которой вы устраняете неполадки. В открывшейся колонке **Конечная точка** щелкните источник.

![Колонка "Конечная точка" с выделенным источником](./media/cdn-troubleshoot-endpoint/cdn-endpoint.png)

Откроется колонка **Источник**.

![Колонка "Источник"](./media/cdn-troubleshoot-endpoint/cdn-origin-settings.png)

#### Тип и имя узла источника

Убедитесь, что **тип источника** указан правильно, и проверьте **имя узла источника**. В моем примере, `https://cdndocdemo.blob.core.windows.net/publicblob/lorem.txt`, часть имени узла URL-адреса — `cdndocdemo.blob.core.windows.net`. Как мы видим на снимке экрана, все указано правильно. Для источников "Служба хранилища Azure", "Веб-приложение" и "Облачная служба" поле **Имя узла источника** содержит раскрывающийся список, поэтому нам не нужно беспокоиться о правильности написания. Однако если вы используете настраиваемый источник, *очень важно* правильно указать имя вашего узла.

#### Порты HTTP и HTTPS

Необходимо также проверить порты **HTTP** и **HTTPS**. В большинстве случаев значения 80 и 443 правильны и изменять их не требуется. Тем не менее, если сервер-источник прослушивает другой порт, необходимо указать именно его. Если вам это неизвестно, взгляните на URL-адрес для исходного файла. Спецификации HTTP и HTTPS указывают порты 80 и 443 по умолчанию. В моем URL-адресе, `https://cdndocdemo.blob.core.windows.net/publicblob/lorem.txt`, порт не указан, поэтому предполагается значение по умолчанию 443 и параметры заданы правильно.

Тем не менее рассмотрим такой URL-адрес для ранее тестируемого исходного файла: `http://www.contoso.com:8080/file.txt`. Обратите внимание на часть `:8080` в конце сегмента имени узла. Она сообщает браузеру о необходимости использовать порт `8080` для подключения к веб-серверу по адресу `www.contoso.com`, поэтому вам потребуется ввести 8080 в поле **Порт HTTP**. Важно отметить, что эти параметры портов влияют только на определение порта, используемого конечной точкой для получения сведений из источника.

> [AZURE.NOTE] В конечных точках **Azure CDN от Akamai** запрещено использовать полный диапазон портов TCP для источников. Список запрещенных портов источников см. в статье [Azure CDN from Akamai Allowed Origin Ports](https://msdn.microsoft.com/library/mt757337.aspx) (Разрешенные порты источников Azure CDN от Akamai).
  
### Проверка параметров конечной точки

В колонке **Конечная точка** нажмите кнопку **Настройка**.

![Колонка "Конечная точка" с выделенной кнопкой "Настройка"](./media/cdn-troubleshoot-endpoint/cdn-endpoint-configure-button.png)

Откроется колонка **настройки** конечной точки.

![Колонка «Настройка»](./media/cdn-troubleshoot-endpoint/cdn-configure.png)

#### Протоколы

В разделе **Протоколы** убедитесь, что выбран протокол, используемый клиентами. Протокол, используемый клиентом, будет также использоваться для доступа к источнику, поэтому важно, чтобы порты источника были настроены правильно (см. предыдущий раздел). Конечная точка будет прослушивать только порты HTTP и HTTPS по умолчанию (80 и 443), независимо от портов источника.

Давайте вернемся к нашему гипотетическому примеру с `http://www.contoso.com:8080/file.txt`. Как вы помните, компания Contoso указала `8080` как HTTP-порт, однако также предположим, что она указала `44300` как HTTPS-порт. Если сотрудники компании создали конечную точку с именем `contoso`, именем узла их конечной точки CDN будет `contoso.azureedge.net`. Запрос файла `http://contoso.azureedge.net/file.txt` является HTTP-запросом, поэтому конечная точка будет использовать HTTP на порту 8080, чтобы получить его из источника. При использовании безопасного запроса по протоколу HTTPS, `https://contoso.azureedge.net/file.txt`, конечная точка будет использовать HTTPS на порту 44300 во время получения файла из источника.

#### Заголовок узла источника

**Заголовок узла источника** — это значение заголовка узла, отправляемое в источник с каждым запросом. В большинстве случаев оно должно совпадать со значением **имени узла источника**, которое мы проверяли ранее. Неверное значение в этом поле, как правило, не вызывает состояния 404, но может вызвать другие состояния 4xx, в зависимости от данных, ожидаемых источником.

#### Путь к источнику

Наконец, следует проверить **путь к источнику**. По умолчанию это пустое поле. Это поле следует использовать только в том случае, если требуется сузить область размещенных в источнике ресурсов, которые требуется сделать доступными в сети CDN.

Например, для моей конечной точки необходимо, чтобы все ресурсы в моей учетной записи хранения были доступными, поэтому я оставил поле **Путь к источнику** пустым. Это означает, что запрос файла `https://cdndocdemo.azureedge.net/publicblob/lorem.txt` вызовет подключение из конечной точки к узлу `cdndocdemo.core.windows.net`, который запросит файл `/publicblob/lorem.txt`. Аналогичным образом, запрос файла `https://cdndocdemo.azureedge.net/donotcache/status.png` приведет к запросу конечной точкой файла `/donotcache/status.png` из источника.

Но что делать, если я не хочу использовать CDN для каждого пути к источнику? Предположим, я хочу предоставить только путь `publicblob`. Если ввести */publicblob* в поле **Путь к источнику**, конечная точка будет вставлять */publicblob* перед каждым запросом к источнику. Это означает, что запрос файла `https://cdndocdemo.azureedge.net/publicblob/lorem.txt` теперь фактически будет использовать часть запроса URL-адреса, `/publicblob/lorem.txt`, добавляя в начало `/publicblob`. Это приводит к запросу файла `/publicblob/publicblob/lorem.txt` из источника. Если этот путь не разрешается в фактический файл, источник будет возвращать состояние 404. Правильный URL-адрес для получения файла lorem.txt в этом примере: `https://cdndocdemo.azureedge.net/lorem.txt`. Обратите внимание, что мы не включали путь */publicblob*, так как часть запроса URL-адреса — `/lorem.txt` и конечная точка добавляет `/publicblob`, в результате чего создается запрос `/publicblob/lorem.txt`, передаваемый источнику.

<!---HONumber=AcomDC_0803_2016-->