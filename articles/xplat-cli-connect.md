<properties
	pageTitle="Вход в Azure из CLI | Microsoft Azure"
	description="Подключение к подписке Azure из интерфейса командной строки Azure (Azure CLI) на компьютерах Mac, Linux и Windows"
	editor="tysonn"
	manager="timlt"
	documentationCenter=""
	authors="dlepow"
	services="virtual-machines-linux,virtual-network,storage,azure-resource-manager"
	tags="azure-resource-manager,azure-service-management"/>

<tags
	ms.service="multiple"
	ms.workload="multiple"
	ms.tgt_pltfrm="vm-multiple"
	ms.devlang="na"
	ms.topic="article"
	ms.date="04/08/2016"
	ms.author="danlep"/>

# Подключение к среде Azure с использованием интерфейса командной строки Azure (Azure CLI)

Azure CLI представляет собой набор межплатформенных команд с открытым кодом для работы с платформой Azure. В этой статье описываются способы ввода учетных данных учетной записи Azure для подключения Azure CLI к подписке Azure. Если вы еще не установили Azure CLI, см. раздел [Установка интерфейса командной строки Azure](xplat-cli-install.md). Если у вас нет подписки Azure, всего за несколько минут можно создать [бесплатную учетную запись](http://azure.microsoft.com/free/).

Существует два способа подключения к подписке из Azure CLI:

* **Вход в Azure с рабочей или учебной учетной записью или удостоверением учетной записи Майкрософт**. Для выполнения проверки подлинности любого типа удостоверений учетной записи с помощью Azure Active Directory используйте команду `azure login` в CLI версии 0.9.10 или выше. Начиная с версии 0.9.9, CLI поддерживает интерактивную аутентификацию через веб-портал для учетных записей с включенной многофакторной аутентификацией. Для проверки подлинности субъекта-службы для приложения Azure Active Directory, позволяющего выполнять автоматические службы, можно также использовать команду `azure login`. Выполнив вход в систему с поддерживаемым удостоверением учетной записи, вы сможете использовать команды для режима диспетчера ресурсов Azure или режима управления службами Azure.

* **Загрузка и использование файла параметров публикации**. При этом на локальный компьютер устанавливается сертификат, который позволяет выполнять различные задачи управления в течение всего срока действия подписки и сертификата. Этот метод позволяет использовать только команды режима управления службами Azure.

>[AZURE.NOTE] При использовании версии Azure CLI ниже 0.9.10 командой `azure login` можно воспользоваться только с рабочей или учебной учетной записью. Удостоверения учетных записей Майкрософт работать не будут. При желании вы можете [создать из идентификатора свой учетной записи Майкрософт идентификатор рабочей или учебной учетной записи](virtual-machines/virtual-machines-windows-create-aad-work-id.md).

Основные сведения о различных удостоверениях учетной записи и подписках Azure см. в статье [Связь между подписками Azure и Azure Active Directory](./active-directory/active-directory-how-subscriptions-associated-directory.md).

## Используйте azure login для интерактивной проверки подлинности

Используйте команду `azure login` (без каких-либо аргументов), чтобы выполнить интерактивную проверку подлинности с:

- удостоверением рабочей или учебной учетной записи (также называется *учетной записью организации*), требующим многофакторной проверки подлинности, или
- удостоверением учетной записи Microsoft, если требуется доступ к командам режима диспетчера ресурсов.

> [AZURE.NOTE]  В обоих случаях проверка подлинности и авторизация выполняются с помощью Azure Active Directory. При использовании удостоверения учетной записи Майкрософт в процессе входа осуществляется доступ в домен Azure Active Directory по умолчанию. (Если вы зарегистрировались для получения бесплатной учетной записи Azure, вы можете не знать, что в Azure Active Directory создан домен по умолчанию для вашей учетной записи.)

Выполнить интерактивный вход просто: введите `azure login` и следуйте подсказкам, как показано ниже.

	azure login                                                                                                                                                                                         
	info:    Executing command login
	info:    To sign in, use a web browser to open the page http://aka.ms/devicelogin. Enter the code XXXXXXXXX to authenticate. If you're signing in as an Azure AD application, use the --username and --password parameters.

Скопируйте предложенный код (см. выше) и откройте http://aka.ms/devicelogin в браузере. Введите код, и вам будет предложено ввести имя пользователя и пароль для удостоверения, которое нужно использовать. По завершении этого процесса командная оболочка завершит процедуру входа в систему. Это будет иметь следующий вид:

	info:    Added subscription Visual Studio Ultimate with MSDN
	info:    Added subscription Azure Free Trial
	info:    Setting subscription "Visual Studio Ultimate with MSDN" as default
	+
	info:    login command OK

## Используйте azure login с именем пользователя и паролем


Если вам нужна рабочая или учебная учетная запись, не требующая многофакторной проверки подлинности, используйте для проверки подлинности команду `azure login` с именем пользователя или с именем пользователя и паролем. В следующем примере передается имя пользователя учетной записи организации:

	azure login -u ahmet@contoso.onmicrosoft.com
	info:    Executing command login
	Password: *********
	|info:    Added subscription Visual Studio Ultimate with MSDN
	+
	info:    login command OK

В ответ на запрос введите свой пароль.

Если учетные данные используются для входа в систему впервые, вам предложат указать, нужно ли кэшировать маркер проверки подлинности. Аналогичный запрос появляется также в том случае, если ранее вы использовали команду `azure logout` (описана далее в этой статье). Чтобы пропустить этот запрос в сценариях автоматизации, добавьте к команде `azure login` параметр `-q`.

   

## Использование azure login с субъектом-службой

Если вы создали для приложения Active Directory субъект-службу и предоставили ему разрешения в отношении вашей подписки, для проверки подлинности этого субъекта-службы можно использовать команду `azure login`. В зависимости от сценария учетные данные субъекта-службы можно передавать как явные параметры команды `azure login` или сценария CLI либо кода приложения. Кроме того, для неинтерактивной проверки подлинности субъекта-службы в сценариях автоматизации можно использовать сертификат. Дополнительные сведения и примеры см. в статье [Проверка подлинности субъекта-службы в диспетчере ресурсов Azure](resource-group-authenticate-service-principal.md).

## Используйте файл параметров публикации

Если вам требуются только команды CLI в режиме управления службами Azure, можете подключиться с использованием файла параметров публикации.

* **Чтобы загрузить файл параметров публикации** для своей учетной записи, воспользуйтесь следующей командой (доступна только в режиме управления службами):

		azure account download

    После этого откроется браузер по умолчанию и появится запрос на вход в [классический портал Azure](https://manage.windowsazure.com). После входа в систему загрузится файл `.publishsettings`. Запишите место сохранения этого файла.

    > [AZURE.NOTE] Если ваша учетная запись связана с несколькими клиентами Azure Active Directory, может появиться запрос на выбор службы Active Directory, для которой следует загрузить файл параметров публикации.

    После выбора на странице загрузки или на классическом портале Azure соответствующая служба Active Directory становится службой каталогов по умолчанию, которая будет использоваться на классическом портале и странице загрузки. После определения службы каталогов по умолчанию в верхней части страницы загрузки появится текст "__щелкните здесь, чтобы вернуться на страницу выбора__". Используйте предоставленную ссылку, чтобы вернуться на страницу выбора.

* Чтобы **импортировать файл параметров публикации**, выполните следующую команду:

		azure account import <path to your .publishsettings file>

	>[AZURE.IMPORTANT]После импорта параметров публикации файл `.publishsettings` необходимо удалить. Он больше не требуется интерфейсу Azure CLI и создает угрозу безопасности, поскольку может быть использован для получения доступа к подписке.

## Несколько подписок

Если у вас есть несколько подписок Azure, при подключении вы получаете доступ ко всем подпискам, связанным с вашими учетными данными. При этом одна подписка выбирается по умолчанию и используется для выполнения операций в Azure CLI. Вы можете просмотреть подписки, а также узнать, какая из них используется по умолчанию, с помощью команды `azure account list`. Эта команда возвращает сведения следующего вида:

	info:    Executing command account list
	data:    Name              Id                                    Current
	data:    ----------------  ------------------------------------  -------
	data:    Azure-sub-1       ####################################  true
	data:    Azure-sub-2       ####################################  false

В приведенном выше списке **Current** означает текущую подписку по умолчанию Azure-sub-1. Для изменения подписки по умолчанию используйте команду `azure account set`, указав соответствующую подписку. Например:

	azure account set Azure-sub-2

Это приведет к изменению подписки по умолчанию на Azure-sub-2.

> [AZURE.NOTE] Изменение подписки по умолчанию вступает в силу сразу же и является глобальным. Новые команды Azure CLI (запускаемые как из того же, так и из другого экземпляра командной строки) будут использовать новую подписку по умолчанию.

Если вы хотите при работе с Azure CLI использовать подписку, которая не выбрана по умолчанию, но не хотите менять текущие настройки, вы можете использовать параметр `--subscription`, указав имя подписки, которую следует использовать для данной операции.

Подключившись к подписке Azure, можно приступать к использованию команд Azure CLI для работы с ресурсами Azure.

## Режимы команд CLI

Azure CLI предоставляет два режима команд для работы с ресурсами Azure, включающих разные наборы команд:

* **Режим Resource Manager** — для работы с ресурсами Azure в модели развертывания Resource Manager. Чтобы установить этот режим, выполните командлет `azure config mode arm`.

* **Режим управления службами** — для работы с ресурсами Azure в классической модели развертывания. Чтобы установить этот режим, выполните командлет `azure config mode asm`.

При первой установке CLI находится в режиме управления службами.

>[AZURE.NOTE]Режим Resource Manager и режим управления службами являются взаимоисключающими. То есть ресурсами, созданными в одном из режимов, нельзя управлять из другого режима.

## Хранение параметров CLI

Если для входа в систему используется команда `azure login` или импорт параметров публикации, профиль CLI и журналы сохраняются в каталог `.azure`, который находится в каталоге `user`. Каталог `user` защищен операционной системой, однако рекомендуется принять дополнительные меры для его шифрования. Это можно сделать одним из следующих способов:

* В ОС Windows измените свойства каталога или используйте BitLocker.
* В ОС Mac включите FileVault для этого каталога.
* В ОС Ubuntu используйте функцию каталога Encrypted Home. Другие дистрибутивы Linux включают аналогичные функции.

## Выход из системы

Чтобы выйти из системы, введите следующую команду:

	azure logout -u <username>

Если для проверки подлинности подписок, связанных с учетной записью, использовался только Active Directory, при выходе из системы данные о подписке удаляются из локального профиля. Однако если вы также импортировали файл параметров публикации для подписок, то при выходе из системы из локального профиля удаляются только данные, относящиеся к Active Directory.
## Дальнейшие действия

* Инструкции по работе с командами интерфейса командной строки Azure см. в статьях [Команды интерфейса командной строки Azure в режиме Resource Manager](./virtual-machines/azure-cli-arm-commands.md) и [Команды интерфейса командной строки Azure в режиме управления службами](virtual-machines-command-line-tools.md).

* Дополнительные сведения об Azure CLI, а также о том, как загрузить исходный код, сообщить о проблемах или принять участие в проекте, см. в [репозитории GitHub для Azure CLI](https://github.com/azure/azure-xplat-cli).

* Если у вас возникли проблемы с использованием Azure CLI или Azure, посетите [форумы Azure](http://social.msdn.microsoft.com/Forums/windowsazure/home).

<!---HONumber=AcomDC_0629_2016-->