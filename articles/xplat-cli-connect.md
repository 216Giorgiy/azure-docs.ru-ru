<properties
	pageTitle="Вход в Azure из CLI | Microsoft Azure"
	description="Подключение к подписке Azure из интерфейса командной строки Azure (Azure CLI) на компьютерах Mac, Linux и Windows"
	editor="tysonn"
	manager="timlt"
	documentationCenter=""
	authors="dlepow"
	services=""
	tags="azure-resource-manager,azure-service-management"/>

<tags
	ms.service="multiple"
	ms.workload="multiple"
	ms.tgt_pltfrm="command-line-interface"
	ms.devlang="na"
	ms.topic="article"
	ms.date="12/29/2015"
	ms.author="danlep"/>

# Подключение к среде Azure с использованием интерфейса командной строки Azure (Azure CLI)

Azure CLI представляет собой набор межплатформенных команд с открытым кодом для работы с платформой Azure. В этой статье описывается, как подключиться к подписке Azure из Azure CLI, чтобы использовать все команды этого интерфейса. Если вы еще не установили Azure CLI, см. раздел [Установка интерфейса командной строки Azure](xplat-cli-install.md).



Существует два способа подключения к подписке из Azure CLI:

* **Выполните вход в Azure, используя рабочую учетную запись или удостоверение учетной записи Microsoft** — в этом случае для аутентификации будет использоваться любой тип удостоверения учетной записи. Текущий CLI также поддерживает интерактивную проверку подлинности для учетных записей с включенной многофакторной проверкой подлинности. После интерактивного входа в систему можно использовать диспетчер ресурсов или классические команды (Service Management).

* **Загрузка и использование файла параметров публикации**. При этом на локальный компьютер устанавливается сертификат, который позволяет выполнять различные задачи управления в течение всего срока действия подписки и сертификата. Этот метод позволяет использовать только классические команды (Service Management).

Дополнительные сведения о проверке подлинности и управлении подписками см. в разделе [Различия между способами проверки подлинности на основе учетной записи и сертификата][authandsub].

Если у вас нет учетной записи Azure, вы можете создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в разделе [Бесплатная пробная версия Azure][free-trial].

>[AZURE.NOTE] При использовании версии Azure CLI ниже 0.9.10 командой `azure login` можно воспользоваться только с удостоверениями рабочей учетной записи. Удостоверения учетной записи Майкрософт работать не будут. Тем не менее при работе с версиями Azure CLI 0.9.10 и выше для входа в свою учетную запись с помощью интерактивной команды `azure login` можно использовать любое удостоверение.
>
CLI версии 0.9.9 и выше поддерживает многофакторную проверку подлинности.



## Использование метода интерактивного входа

Используйте команду `azure login` (без каких-либо аргументов), чтобы выполнить интерактивную проверку подлинности с:

- удостоверением рабочей учетной записи, требующим многофакторной аутентификации, или
- удостоверением учетной записи Microsoft, если требуется доступ к функциям режима развертывания диспетчера ресурсов.

> [AZURE.NOTE]  В обоих случаях проверка подлинности и авторизация выполняются с помощью Azure Active Directory. При использовании удостоверения учетной записи Майкрософт в процессе входа осуществляется доступ в домен Azure Active Directory по умолчанию. (Если вы зарегистрировались для получения бесплатной пробной версии, вы можете не знать, что в Azure Active Directory создан домен по умолчанию для вашей учетной записи).

Выполнить интерактивный вход просто: введите `azure login` и следуйте подсказкам, как показано ниже.

	azure login                                                                                                                                                                                         
	info:    Executing command login
	info:    To sign in, use a web browser to open the page http://aka.ms/devicelogin. Enter the code XXXXXXXXX to authenticate. If you're signing in as an Azure AD application, use the --username and --password parameters.

Скопируйте предложенный код (см. выше) и откройте http://aka.ms/devicelogin в браузере. Введите код, и вам будет предложено ввести имя пользователя и пароль для удостоверения, которое нужно использовать. По завершении этого процесса командная оболочка завершит процедуру входа в систему. Это будет иметь следующий вид:

	info:    Added subscription Visual Studio Ultimate with MSDN
	info:    Added subscription Azure Free Trial
	info:    Setting subscription "Visual Studio Ultimate with MSDN" as default
	+
	info:    login command OK

## Неинтерактивный вход в систему с рабочей учетной записью


Метод неинтерактивного входа работает только с рабочей учетной записью, которая также называется *учетная запись организации*. Это учетная запись, которая управляется организацией и определена в ее каталоге Azure Active Directory. Можно [создать учетную запись организации](#create-an-organizational-account), если таковая отсутствует, или [создать рабочий ИД на основе ИД своей учетной записи Майкрософт](./virtual-machines/resource-group-create-work-id-from-personal.md). При этом нужно указать имя пользователя или имя пользователя и пароль в команде `azure login`, например:

	azure login -u ahmet@contoso.onmicrosoft.com
	info:    Executing command login
	Password: *********
	|info:    Added subscription Visual Studio Ultimate with MSDN
	+
	info:    login command OK

В ответ на запрос введите свой пароль.

	If this is your first time logging in with these credentials, you are asked to verify that you wish to cache an authentication token. This prompt also occurs if you have previously used the `azure logout` command (described below). To bypass this prompt for automation scenarios, run `azure login` with the `-q` parameter.

* **Чтобы выйти из системы**, введите следующую команду.

		azure logout -u <username>

	Если для проверки подлинности подписок, связанных с учетной записью, использовался только Active Directory, при выходе из системы данные о подписке удаляются из локального профиля. Однако если вы также импортировали файл параметров публикации для подписок, то при выходе из системы из локального профиля удаляются только данные, относящиеся к Active Directory.

## Использование файла параметров публикации

Если вам нужно использовать только классические команды CLI (Service Management), можете подключиться с использованием файла параметров публикации.

* **Чтобы загрузить файл параметров публикации** для вашей учетной записи, воспользуйтесь следующей командой:

		azure account download

После этого откроется браузер по умолчанию и появится запрос на вход в [классический портал Azure][portal]. После входа в систему загрузится файл `.publishsettings`. Запишите место сохранения этого файла.

> [AZURE.NOTE] Если ваша учетная запись связана с несколькими клиентами Azure Active Directory, может появиться запрос на выбор службы Active Directory, для которой следует загрузить файл параметров публикации.
>
> После выбора на странице загрузки или на классическом портале Azure соответствующая служба Active Directory становится службой каталогов по умолчанию, которая будет использоваться на классическом портале и странице загрузки. После определения службы каталогов по умолчанию в верхней части страницы загрузки появится текст "__щелкните здесь, чтобы вернуться на страницу выбора__". Используйте предоставленную ссылку, чтобы вернуться на страницу выбора.

* Чтобы **импортировать файл параметров публикации**, выполните следующую команду:

		azure account import <path to your .publishsettings file>

	После импорта параметров публикации удалите файл `.publishsettings`, так как он больше не используется интерфейсом Azure CLI и представляет угрозу безопасности, поскольку может быть использован для получения доступа к подписке.


## Несколько подписок

Если у вас есть несколько подписок Azure, при подключении вы получаете доступ ко всем подпискам, связанным с вашими учетными данными. При этом одна подписка выбирается по умолчанию и используется для выполнения операций в Azure CLI. Вы можете просмотреть подписки, а также узнать, какая из них используется по умолчанию, с помощью команды `azure account list`. Эта команда возвращает сведения следующего вида:

	info:    Executing command account list
	data:    Name              Id                                    Current
	data:    ----------------  ------------------------------------  -------
	data:    Azure-sub-1       ####################################  true
	data:    Azure-sub-2       ####################################  false

В приведенном выше списке **Current** означает текущую подписку по умолчанию Azure-sub-1. Для изменения подписки по умолчанию используйте команду `azure account set`, указав соответствующую подписку. Например:

	azure account set Azure-sub-2

Это приведет к изменению подписки по умолчанию на Azure-sub-2.

> [AZURE.NOTE] Изменение подписки по умолчанию вступает в силу сразу же и является глобальным. Новые команды Azure CLI (запускаемые как из того же, так и из другого экземпляра командной строки) будут использовать новую подписку по умолчанию.

Если вы хотите при работе с Azure CLI использовать подписку, которая не выбрана по умолчанию, но не хотите менять текущие настройки, вы можете использовать параметр `--subscription`, указав имя подписки, которую следует использовать для данной операции.

Подключившись к подписке Azure, можно приступать к использованию команд Azure CLI.

## Хранение параметров CLI

Если для входа в систему используется рабочая учетная запись или импорт параметров публикации, профиль CLI и журналы сохраняются в каталог `.azure`, который находится в каталоге `user`. Каталог `user` защищен операционной системой, однако рекомендуется принять дополнительные меры для его шифрования. Это можно сделать одним из следующих способов:

* В ОС Windows измените свойства каталога или используйте BitLocker.
* В ОС Mac включите FileVault для этого каталога.
* В ОС Ubuntu используйте функцию каталога Encrypted Home. Другие дистрибутивы Linux включают аналогичные функции.

## Дополнительные ресурсы

* [Использование Azure CLI с классическими командами (Service Management)][cliasm]

* [Использование Azure CLI с командами диспетчера ресурсов][cliarm]

* Дополнительные сведения об Azure CLI, а также о том, как загрузить исходный код, сообщить о проблемах или принять участие в проекте, см. в [репозитории GitHub для Azure CLI](https://github.com/azure/azure-xplat-cli).

* Если у вас возникли проблемы с использованием Azure CLI или Azure, посетите [форумы Azure](http://social.msdn.microsoft.com/Forums/windowsazure/home).





[authandsub]: http://msdn.microsoft.com/library/windowsazure/hh531793.aspx#BKMK_AccountVCert
[free-trial]: http://azure.microsoft.com/pricing/free-trial/
[portal]: https://manage.windowsazure.com
[signuporg]: http://azure.microsoft.com/documentation/articles/sign-up-organization/
[cliasm]: virtual-machines/virtual-machines-command-line-tools.md
[cliarm]: xplat-cli-azure-resource-manager.md

<!---HONumber=AcomDC_0204_2016-->