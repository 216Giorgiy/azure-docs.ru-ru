<properties
	pageTitle="Обзор автомасштабирования в виртуальных машинах, облачных службах и веб-приложениях Microsoft Azure | Microsoft Azure"
	description="Обзор автомасштабирования в Microsoft Azure. Применяется к виртуальным машинам, облачным службам и веб-приложениям."
	authors="rboucher"
	manager=""
	editor=""
	services="monitoring-and-diagnostics"
	documentationCenter="monitoring-and-diagnostics"/>

<tags
	ms.service="monitoring-and-diagnostics"
	ms.workload="na"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="08/30/2016"
	ms.author="robb"/>

# Обзор автомасштабирования в виртуальных машинах, облачных службах и веб-приложениях Microsoft Azure

В этой статье описывается принцип автомасштабирования Microsoft Azure и его преимущества. Кроме того, здесь приведены сведения по началу работы с этой функцией.

Автомасштабирование Azure Insights применяется только к

* [Наборы для масштабирования виртуальных машин](https://azure.microsoft.com/services/virtual-machine-scale-sets/)
* [Облачные службы](https://azure.microsoft.com/services/cloud-services/)
* [службе приложений (веб-приложения)](https://azure.microsoft.com/services/app-service/web/).
  
   
>[AZURE.NOTE] В Azure доступно два способа автомасштабирования. Более старая версия автомасштабирования применяется к виртуальным машинам (группы доступности). Для этой функции предлагается ограниченная поддержка. Поэтому мы советуем перейти к наборам масштабирования виртуальных машин, обеспечивающим поддержку более быстрого и надежного автомасштабирования. В этой статье есть ссылка на сведения об использовании более старой технологии.


## Что такое автомасштабирование? 

Благодаря автомасштабированию вы получаете нужный объем используемых ресурсов для обработки нагрузки в приложении, не тратя дополнительные средства из-за простоя ресурсов. Оно позволяет добавлять или удалять вычислительные ресурсы автоматически на основе набора правил. Этот принцип показан на рис. 1.

![Объяснение принципа автомасштабирования](./media/monitoring-autoscale-overview/AutoscaleConcept.png)

**Рис. 1. Объяснение принципа автомасштабирования**

При автомасштабировании ресурсы масштабируются только горизонтально, то есть происходит увеличение (развертывание) или уменьшение (свертывание) количества экземпляров виртуальной машины. Горизонтальное масштабирование в облаке более гибкое, так как при этом можно потенциально запускать тысячи виртуальных машин для обработки нагрузки. Другой тип масштабирования — вертикальное масштабирование. При вертикальном масштабировании сохраняется количество виртуальных машин, но увеличивается (увеличение масштаба) или уменьшается (уменьшение масштаба) их мощность. Мощность измеряется по объему памяти, скорости ЦП, дисковому пространству и т. д. Вертикальное масштабирование связано с дополнительными ограничениями. Оно зависит от доступности оборудования большего размера, что, в свою очередь, зависит от региона. К тому же при таком масштабировании быстро достигается верхнее ограничение. Обычно при вертикальном масштабировании требуется запускать и останавливать виртуальную машину. Дополнительные сведения см. в статье [Вертикальное масштабирование виртуальной машины Azure c помощью службы автоматизации Azure](../virtual-machines/virtual-machines-linux-vertical-scaling-automation.md).


Автомасштабирование требует создания правил о развертывании и свертывании ресурсов. Для управления действиями масштабирования можно задать следующие критерии:

* **Минимальное** и **максимальное** количество используемых экземпляров. Минимальное количество обеспечивает непрерывную работу приложения, а максимальное позволяет следить за затратами.
* **Правило или условие** автомасштабирования. Это может быть масштабирование на основе метрики или расписания.
* **Время ожидания** — время ожидания после события автомасштабирования, по прошествии которого представляется разрешение на другое событие автомасштабирования. Этот период времени предусмотрен для предотвращения неустойчивости при быстром добавлении и удалении виртуальных машин. Запуск или остановка виртуальной машины имеет свою цену. При неустойчивости средства не экономятся, а при остановке и запуске виртуальная машина не выполняет полезные действия по обработке. Это хуже, чем оставить виртуальную машину работать.

   
Полный список настраиваемых значений см. в статье [Autoscale REST API](https://msdn.microsoft.com/library/dn931928.aspx) (REST API автомасштабирования).


## Концептуальная схема  
На рис. 2 показан концептуальный обзор автомасштабирования, после которого представлено объяснение частей схемы.

![Добавление оповещения](./media/monitoring-autoscale-overview/AutoscaleOverview3.png)

**Рис. 2. Обзор процесса автомасштабирования**

## Метрики ресурсов 
Ресурсы выдают метрики, которые позже обрабатываются с помощью правил. Метрики можно получить различными способами. Наборы масштабирования виртуальных машин используют данные телеметрии из агентов диагностики Azure, а телеметрия для веб-приложений и облачных служб поступает непосредственно из инфраструктуры Azure. К некоторым часто используемым статистическим сведениям относятся загрузка ЦП, использование памяти, число потоков, длина очереди и использование диска. Список данных телеметрии, которые можно использовать, см. в статье [Общие метрики автомасштабирования Azure Insights](insights-autoscale-common-metrics.md).

 
## Время
В правилах на основе расписания используется формат UTC. При настройке правил необходимо правильно задать свой часовой пояс.

## Правила автомасштабирования
На схеме показано только одно правило автомасштабирования. Однако можно использовать и сразу несколько. При необходимости для конкретной ситуации можно создать сложные перекрывающиеся правила. Правила бывают следующих типов:
 
 - **на основе метрики**, например выполнение определенного действия при загрузке ЦП более чем на 50 %;
 - **на основе времени**, например активация webhook каждую субботу в 8:00 в заданном часовом поясе.

 
## Действия автомасштабирования и автоматизация

Правила могут вызвать одно или несколько типов действий:

- **Масштабирование** — свертывание или развертывание виртуальных машин.
- **Электронная почта** — отправка письма по электронной почте администраторам и соадминистраторам подписки, а также на указанные дополнительные адреса электронной почты.
- **Автоматизация с помощью объектов webhook** — вызов объектов webhook, с помощью которых можно активировать несколько сложных действий в среде Azure и за ее пределами. В Azure можно запустить Runbook службы автоматизации Azure, функции Azure или приложения Azure Logic. К примерам сторонних служб можно отнести Slack и Twilio.


## Сведения о правилах Resource Manager

В шаблоне Azure Resource Manager правила автомасштабирования обладают следующей структурой.

![Структура правил автомасштабирования Azure Resource Manager](./media/monitoring-autoscale-overview/AzureResourceManagerRuleStructure2.png)

Можно указать несколько профилей. Для каждого профиля можно настроить несколько правил. Методы уведомления и расположения указываются после профилей. К примерам уведомлений относятся webhook с URI или сообщения с адресами электронной почты.

Примеры кода см. в следующих статьях:

* [Расширенная настройка автомасштабирования с помощью шаблонов Resource Manager для набора масштабирования виртуальных машин](insights-advanced-autoscale-virtual-machine-scale-sets.md)
* [Autoscaling REST API](https://msdn.microsoft.com/library/dn931953.aspx) (REST API автомасштабирования)

## Способы получения доступа 
Правила автомасштабирования можно настроить с помощью следующих компонентов:

- Портал Azure
- PowerShell
- Common Library Interface (CLI)
- REST API Insights;

## Пошаговые руководства по автомасштабированию

- [Автомасштабирование облачной службы](../cloud-services/cloud-services-how-to-scale-portal.md)
- [Scaling Web Apps](insights-how-to-scale.md) (Масштабирование веб-приложения)
- [Scaling Classic Virtual Machine Availability Sets](https://blogs.msdn.microsoft.com/kaevans/2015/02/20/autoscaling-azurevirtual-machines/) (Масштабирование групп доступности классических виртуальных машин)
- [Scaling VM Scale Sets in Windows](../virtual-machine-scale-sets/virtual-machine-scale-sets-windows-autoscale.md) (Масштабирование наборов масштабирования виртуальных машин в Windows)
- [Scaling VM Scale Sets in Windows](../virtual-machine-scale-sets/virtual-machine-scale-sets-linux-autoscale.md) (Масштабирование наборов масштабирования виртуальных машин в Linux)
- [Расширенная настройка автомасштабирования с помощью шаблонов Resource Manager для набора масштабирования виртуальных машин](insights-advanced-autoscale-virtual-machine-scale-sets.md)

## Дальнейшие действия

Дополнительные сведения об автомасштабировании см. в пошаговых руководствах по автомасштабированию выше или в следующих ресурсах:

- [Общие метрики автомасштабирования Azure Insights](insights-autoscale-common-metrics.md)
- [Рекомендации по автомасштабированию Azure Insights](insights-autoscale-best-practices.md)
- [Использование действий автомасштабирования для отправки электронной почты и уведомлений об оповещениях веб-перехватчика в Azure Insights](insights-autoscale-to-webhook-email.md)
- [Autoscaling REST API](https://msdn.microsoft.com/library/dn931953.aspx) (REST API автомасштабирования) — описание API, каждого поля и значения
- [Устранение неполадок при автомасштабировании масштабируемых наборов виртуальных машин](../virtual-machine-scale-sets/virtual-machine-scale-sets-troubleshoot.md)

<!---HONumber=AcomDC_0907_2016-->