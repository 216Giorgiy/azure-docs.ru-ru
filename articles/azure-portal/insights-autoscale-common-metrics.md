.<properties
	pageTitle="Общие метрики автомасштабирования Azure Insights | Microsoft Azure"
	description="Узнайте, какие метрики обычно используются для автоматического масштабирования облачных служб, виртуальных машин и веб-приложений."
	authors="kamathashwin"
	manager=""
	editor=""
	services="monitoring-and-diagnostics"
	documentationCenter="monitoring-and-diagnostics"/>

<tags
	ms.service="monitoring-and-diagnostics"
	ms.workload="na"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="08/02/2016"
	ms.author="ashwink"/>

# Общие метрики автомасштабирования Azure Insights

Автомасштабирование Azure Insights позволяет увеличивать или уменьшать количество запущенных экземпляров на основе данных телеметрии (метрик). В этой статье рассматриваются общие метрики, которые вы можете использовать. На портале Azure для облачных служб и ферм серверов можно выбрать метрики ресурсов, по которым будет выполняться масштабирование. Однако вы также можете выбрать любую метрику из другого ресурса.

В следующих разделах описано, как найти и перечислить метрики, которые будут использоваться для масштабирования. Приведенные ниже рекомендации также применяются к наборам масштабирования виртуальных машин.

## Расчет метрик
По умолчанию в виртуальной машине Azure v2 настроено расширение системы диагностики и включены следующие метрики:

- [метрики гостевой виртуальной машины Windows v2](#compute-metrics-for-windows-vm-v2-as-a-guest-os);
- [метрики гостевой виртуальной машины Linux v2](#compute-metrics-for-linux-vm-v2-as-a-guest-os).

Чтобы просмотреть метрики, доступные для ресурса VMSS, в API, PoSH и интерфейсе командной строки можно выполнить команду `Get MetricDefinitions`.

Если вы используете наборы масштабирования виртуальных машин и не находите определенной метрики в списке, скорее всего, она *отключена* в расширении системы диагностики.

Если выборка или передача определенной метрики осуществляется с частотой, которая не соответствует вашим требованиям, можно обновить конфигурацию системы диагностики.

Если это так, см. сведения о настройке и обновлении расширения системы диагностики виртуальной машины Azure для включения метрики с использованием PowerShell в статье [Use PowerShell to enable Azure Diagnostics in a virtual machine running Windows](../virtual-machines/virtual-machines-windows-ps-extensions-diagnostics.md)(Включение системы диагностики Azure на виртуальной машине под управлением Windows с помощью PowerShell). В этой статье также содержится пример файла конфигурации системы диагностики.

### Расчет метрик для виртуальной машины Windows v2 в качестве гостевой ОС

При создании новой виртуальной машины (v2) в Azure система диагностики включается с помощью расширения диагностики.

Вы можете создать список метрик с помощью следующей команды PowerShell:


```
Get-AzureRmMetricDefinition -ResourceId <resource_id> | Format-Table -Property Name,Unit
```

Вы можете создать оповещение для метрик в таблице ниже.

|Имя метрики|	Единица измерения|
|---|---|
|\\Процессор (\_общий объем ресурсов)\\% загруженности процессора |Процент|
|\\Процессор(\_общий объем ресурсов)\\% времени в привилегированном режиме |Процент|
|\\Процессор(\_общий объем ресурсов)\\% времени в пользовательском режиме |Процент|
|\\Процессор(\_общий объем ресурсов)\\частота процессора |Count|
|\\Система\\процессы|	Count|
|\\Процессор (\_общий объем ресурсов)\\число потоков|	Count|
|\\Процессор (\_общий объем ресурсов)\\число обработанных элементов |Count|
|\\Память\\% использования выделенной памяти (в байтах) |Процент|
|\\Память\\доступные байты|	Байты|
|\\Память\\выделенная память (в байтах) |Байты|
|\\Память\\предел выделенной памяти|	Байты|
|\\Память\\выгружаемый пул (в байтах)|	Байты|
|\\Память\\невыгружаемый пул (в байтах)|	Байты|
|\\Физический диск(\_общий объем ресурсов)\\% времени работы диска|	Процент|
|\\Физический диск(\_общий объем ресурсов)\\% времени чтения с диска|	Процент|
|\\Физический диск(\_общий объем ресурсов)\\% времени записи на диск|	Процент|
|\\Диск\\Физический диск(\_общий объем ресурсов) в секунду |Число/с|
|\\Физический диск(\_общий объем ресурсов)\\скорость чтения с диска/с |Число/с|
|\\Физический диск(\_общий объем ресурсов)\\скорость записи на диск/с |Число/с|
|\\Физический диск(\_общий объем ресурсов)\\скорость передачи данных (в байтах)/с |Байт/с|
|\\Физический диск(\_общий объем ресурсов)\\скорость чтения с диска (в байтах)/с|	Байт/с|
|\\Физический диск(\_общий объем ресурсов)\\скорость записи на диск (в байтах)/с |Байт/с|
|\\Физический диск(\_общий объем ресурсов)\\среднее значение Длина дисковой очереди|	Count|
|\\Физический диск(\_общий объем ресурсов)\\среднее значение Длина очереди чтения с диска|	Count|
|\\Физический диск(\_общий объем ресурсов)\\среднее значение Длина очереди записи на диск |Count|
|\\Физический диск(\_общий объем ресурсов)\\% свободного места|	Процент|
|\\Логический диск(\_общий объем ресурсов)\\свободная память (в мегабайтах)|	Count|



### Расчет метрик для виртуальной машины Linux v2 в качестве гостевой ОС

При создании новой виртуальной машины (v2) в Azure система диагностики включается по умолчанию с помощью расширения диагностики.

Вы можете создать список метрик с помощью следующей команды PowerShell:

```
Get-AzureRmMetricDefinition -ResourceId <resource_id> | Format-Table -Property Name,Unit
```

 Вы можете создать оповещение для метрик в таблице ниже.

|Имя метрики|	Единица измерения|
|---|---|
|\\Память\\Доступная память |Байты|
|\\Память\\Процент доступной памяти|	Процент|
|\\Память\\Используемая память|	Байты|
|\\Память\\Процент используемой памяти|	Процент|
|\\Память\\Процент памяти, используемой кэшем |Процент|
|\\Память\\Страниц в с|	Число/с|
|\\Память\\Прочитано страниц в с|	Число/с|
|\\Память\\Записано страниц в с |Число/с|
|\\Память\\Доступное пространство файла подкачки |Байты|
|\\Память\\Процент доступного пространства файла подкачки|	Процент|
|\\Память\\Используемое пространство файла подкачки |Байты|
|\\Память\\Процент использованного пространства файла подкачки|	Процент|
|\\Процессор\\Процент времени простоя|	Процент|
|\\Процессор\\Процент работы в пользовательском режиме|	Процент|
|\\Процессор\\Процент времени оптимальной работы |Процент|
|\\Процессор\\Процент работы в привилегированном режиме |Процент|
|\\Процессор\\Процент времени прерываний|	Процент|
|\\Процессор\\Процент времени DPC|	Процент|
|\\Процессор\\Процент загруженности процессора |Процент|
|\\Процессор\\Процент времени ожидания ввода/вывода |Процент|
|\\Физический диск\\Байт/с|	Байт/с|
|\\Физический диск\\Прочитано байт/с|	Байт/с|
|\\Физический диск\\Записано байт/с|	Байт/с|
|\\Физический диск\\Передач/с |Число/с|
|\\Физический диск\\Операций чтения/с |Число/с|
|\\Физический диск\\Операций записи/с |Число/с|
|\\Физический диск\\Среднее время чтения|	Секунды|
|\\Физический диск\\Среднее время записи |Секунды|
|\\Физический диск\\Среднее время передачи|	Секунды|
|\\Физический диск\\Средняя длина очереди диска|	Count|
|\\Сетевой интерфейс\\Передано байт |Байты|
|\\Сетевой интерфейс\\Получено байт |Байты|
|\\Сетевой интерфейс\\Передано пакетов |Count|
|\\Сетевой интерфейс\\ Получено пакетов |Count|
|\\Сетевой интерфейс\\Всего байт |Байты|
|\\Сетевой интерфейс\\Всего ошибок RX|	Count|
|\\Сетевой интерфейс\\Всего ошибок TX|	Count|
|\\Сетевой интерфейс\\Всего конфликтов|	Count|




## Часто используемые метрики веб-приложений (фермы серверов)

Можно также выполнить автомасштабирование на основе общих метрик веб-сервера, таких как длина очереди HTTP. Имя метрики — **HttpQueueLength**. В следующем разделе перечислены доступные метрики фермы серверов (веб-приложений).

### Метрики веб-приложений

Список метрик веб-приложений можно создать с помощью следующей команды PowerShell:

```
Get-AzureRmMetricDefinition -ResourceId <resource_id> | Format-Table -Property Name,Unit
```

Можно создавать оповещения и выполнять масштабирование на основе метрик в таблице ниже.

|Имя метрики|	Единица измерения|
|---|---|
|Процент загруженности ЦП|	Процент|
|Процент использования памяти |Процент|
|Длина очереди диска|	Count|
|Длина очереди HTTP|	Count|
|Получено байт|	Байты|
|Передано байт|	Байты|


## Часто используемые метрики хранилища
Можно масштабировать по длине очереди хранилища, которая представляет собой количество сообщений в очереди хранилища. Пороговым значением для этой специальной метрики будет число сообщений на один экземпляр. Это означает, что если есть два экземпляра и если пороговое значение — 100, масштабирование будет выполнено, когда общее число сообщений в очереди достигнет 200. Например, 100 сообщений на один экземпляр.

Эти значения можно настроить на портале Azure в колонке **Параметры**. Для наборов масштабирования виртуальных машин можно настроить параметр автоматического масштабирования в шаблоне ARM так, чтобы для параметра *metricName* использовалось значение *ApproximateMessageCount*, а идентификатор очереди хранилища передавался в параметре *metricResourceUri*.


```
"metricName": "ApproximateMessageCount",
 "metricNamespace": "",
 "metricResourceUri": "/subscriptions/s1/resourceGroups/rg1/providers/Microsoft.ClassicStorage/storageAccounts/mystorage/services/queue/queues/mystoragequeue"
 ```

## Часто используемые метрики служебной шины

Масштабирование возможно по длине очереди служебной шины. Длина очереди представляет собой количество сообщений в очереди. Пороговым значением для этой специальной метрики будет число сообщений на один экземпляр. Это означает, что если есть два экземпляра и если пороговое значение — 100, масштабирование будет выполнено, когда общее число сообщений в очереди достигнет 200. Например, 100 сообщений на один экземпляр.

Для наборов масштабирования виртуальных машин можно настроить параметр автоматического масштабирования в шаблоне ARM так, чтобы для параметра *metricName* использовалось значение *ApproximateMessageCount*, а идентификатор очереди хранилища передавался в параметре *metricResourceUri*.

```
"metricName": "MessageCount",
 "metricNamespace": "",
"metricResourceUri": "/subscriptions/s1/resourceGroups/rg1/providers/Microsoft.ServiceBus/namespaces/mySB/queues/myqueue"
```

>[AZURE.NOTE] Для служебной шины концепции группы ресурсов не существует, но Azure Resource Manager создает группу ресурсов по умолчанию на регион. Группа ресурсов обычно имеет формат Default-ServiceBus-[region]. Например, Default-ServiceBus-EastUS, Default-ServiceBus-WestUS, Default-ServiceBus-AustraliaEast и т. д.

<!---HONumber=AcomDC_0810_2016-->