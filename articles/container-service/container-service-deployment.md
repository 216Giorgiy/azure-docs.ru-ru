<properties
   pageTitle="Развертывание кластера службы контейнеров Azure | Microsoft Azure"
   description="Развертывание кластера службы контейнеров Azure с помощью портала Azure, интерфейса командной строки Azure или PowerShell."
   services="container-service"
   documentationCenter=""
   authors="rgardler"
   manager="timlt"
   editor=""
   tags="acs, azure-container-service"
   keywords="Docker, контейнеры, микрослужбы, Mesos, Azure"/>

<tags
   ms.service="container-service"
   ms.devlang="na"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="02/16/2016"
   ms.author="rogardle"/>

# Развертывание кластера службы контейнеров Azure

Служба контейнеров Azure предусматривает быстрое развертывание популярных решений с открытым кодом для кластеризации и оркестрации контейнеров. Служба контейнеров Azure позволяет вам развернуть кластеры Marathon Mesos и Docker Swarm, используя шаблоны Azure Resource Manager или портал Azure. Эти кластеры развертываются с помощью наборов масштабирования виртуальных машин Azure. Они также могут использовать возможности сети и хранилища Azure. Для доступа к службе контейнеров Azure нужна подписка Azure. Если у вас ее нет, зарегистрируйтесь, чтобы воспользоваться [бесплатной пробной версией](http://azure.microsoft.com/pricing/free-trial/?WT.mc_id=AA4C1C935).

В этом документе описано развертывание кластера службы контейнеров Azure с использованием [портала Azure](#creating-a-service-using-the-azure-portal), [интерфейса командной строки Azure](#creating-a-service-using-the-azure-cli) и [модуля Azure PowerShell](#creating-a-service-using-powershell).

## Создание службы с помощью портала Azure

Чтобы развернуть кластер Mesos или Docker Swarm, выберите один из следующих шаблонов GitHub (обратите внимание, что эти шаблоны отличаются только выбором оркестратора по умолчанию):

* [шаблон Mesos](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-mesos);
* [шаблон Swarm](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-swarm).

После нажатия кнопки **Развернуть в Azure** на любой странице шаблона запускается портал Azure с формой, которая выглядит примерно так: <br />

![Создание развертывания с использованием формы](media/create-mesos-params.png) <br />

Заполните форму в соответствии с рекомендациями, приведенными в этом руководстве, а затем нажмите кнопку **ОК**. <br />

Поле | Описание
----------------|-----------
DNSNAMEPREFIX | Это значение должно быть уникальным. Оно будет использоваться для создания DNS-имен для каждого компонента службы. Дополнительные сведения см. ниже.
AGENTCOUNT | Поле количества виртуальных машин, которые будут созданы в наборе масштабирования агента службы контейнеров Azure.
AGENTVMSIZE | Поле размера виртуальных машин агента. Будьте внимательны при выборе размера, который обеспечит достаточно ресурсов для размещения самых крупных контейнеров.
ADMINUSERNAME | Поле имени пользователя, которое будет использоваться для учетной записи на каждой виртуальной машине, а также в наборах масштабирования виртуальных машин в кластере службы контейнеров Azure.
ORCHESTRATORTYPE| Поле типа оркестратора, который будет использоваться в кластере службы контейнеров Azure.
MASTERCOUNT | Поле количества виртуальных машин, которые будут настроены в качестве образцов для кластера. Можно выбрать 1, но при таком количестве нельзя обеспечить отказоустойчивость кластера (это количество рекомендуется использовать только для тестирования). Рекомендуемое количество для рабочего кластера — 3 или 5.
SSHRSAPUBLICKEY | Для проверки подлинности виртуальных машин необходимо использовать протокол Secure Shell (SSH), что предполагает добавление открытого ключа. Вставляйте значение ключа в это поле очень внимательно. Некоторые редакторы добавляют в содержимое разрывы строки, что разбивает значение ключа. Проследите, чтобы ключ не был разбит разрывами строки. У него должен быть префикс ssh-rsa и постфикс username@domain. Ключ должен выглядеть следующим образом: ssh-rsa AAAAB3Nz...SNIPPEDCONTENT...UcyupgH azureuser@linuxvm'. Если вам нужно создать ключ SSH, см. рекомендации для [Windows](../virtual-machines/virtual-machines-linux-ssh-from-windows.md) и [Linux](../virtual-machines/virtual-machines-linux-ssh-from-linux.md) на сайте документации по Azure.

Назначив соответствующие значения для параметров, нажмите кнопку **ОК**. Теперь укажите имя группы ресурсов, выберите регион, а также просмотрите и примите условия использования.

> [AZURE.NOTE] За использование предварительной версии службы контейнеров Azure плата не взимается. Вы платите только за стандартные вычислительные операции, в том числе за использование виртуальной машины, хранилища, сети и т. д.

![Выбор группы ресурсов](media/resourcegroup.png)

Наконец, нажмите кнопку **Создать**. Вы вернетесь к панели мониторинга. Если до этого в колонке развертывания вы не сняли флажок **Закрепить на панели мониторинга**, то увидите аналогичную анимированную плитку:

![Плитка шаблона развертывания](media/deploy.png)

Теперь устройтесь поудобнее и дождитесь завершения создания кластера. По завершении вы увидите несколько колонок с ресурсами, входящими в состав кластера службы контейнеров Azure.

![Выполнено](media/final.png)

## Создание службы с помощью интерфейса командной строки Azure

Чтобы создать экземпляр службы контейнеров Azure с помощью командной строки, вам нужна подписка Azure. Если у вас ее нет, зарегистрируйтесь, чтобы воспользоваться [бесплатной пробной версией](http://azure.microsoft.com/pricing/free-trial/?WT.mc_id=AA4C1C935). Вам также нужно установить и настроить интерфейс командной строки Azure.

Чтобы развернуть кластер Mesos или Docker Swarm, выберите один из следующих шаблонов GitHub (обратите внимание, что эти шаблоны отличаются только выбором оркестратора по умолчанию):

* [шаблон Mesos](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-mesos);
* [шаблон Swarm](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-swarm).

Затем убедитесь, что интерфейс командной строки Azure подключен к подписке Azure. Это можно сделать с помощью следующей команды:

```bash
Azure account show
```
Если она не вернет учетную запись Azure, войдите в интерфейс командной строки Azure с помощью следующей команды:

```bash
azure login -u user@domain.com
```

Затем настройте средства интерфейса командной строки Azure для использования Azure Resource Manager.

```bash
azure config mode arm
```

Если вы хотите создать кластер в новой группе ресурсов, сначала создайте эту группу. Используйте следующую команду, где `GROUP_NAME` — имя новой группы ресурсов, а `REGION` — регион, в котором эта группа будет создана:

```bash
azure group create GROUP_NAME REGION
```

После создания группы ресурсов можно приступить к созданию кластера с помощью команды ниже, где:

- **RESOURCE\_GROUP** — имя группы ресурсов, которая будет использоваться с этой службой;
- **DEPLOYMENT\_NAME** — имя этого развертывания;
- **TEMPLATE\_URI** — расположение файла развертывания. Это должен быть необработанный файл, который *не* указывает на пользовательский интерфейс GitHub. Чтобы найти этот URL-адрес, выберите в GitHub файл azuredeploy.json и нажмите кнопку **RAW**.

> [AZURE.NOTE] При выполнении этой команды оболочка запросит ввод значений параметров развертывания.

```bash
azure group deployment create RESOURCE_GROUP DEPLOYMENT_NAME --template-uri TEMPLATE_URI
```

### Выбор параметров шаблона

Эта версия команды предполагает определение параметров в интерактивном режиме. Если вы хотите указать параметры, например в виде строки в формате JSON, это можно сделать с помощью параметра `-p`. Например:

 ```bash
azure group deployment create RESOURCE_GROUP DEPLOYMENT_NAME --template-uri TEMPLATE_URI -p '{ "param1": "value1" … }'
 ```

Кроме того, вы можете указать файл параметров в формате JSON, используя параметр `-e`:

 ```bash
azure group deployment create RESOURCE_GROUP DEPLOYMENT_NAME --template-uri TEMPLATE_URI -e PATH/FILE.JSON
 ```

Пример файла параметров с именем `azuredeploy.parameters.json` и шаблоны службы контейнеров Azure можно найти в GitHub.

## Создание службы с помощью PowerShell

Кластер службы контейнеров Azure также можно развернуть с помощью PowerShell. В этом документе используется [модуль Azure PowerShell](https://azure.microsoft.com/blog/azps-1-0/) версии 1.0.

Выберите один из следующих шаблонов, чтобы развернуть кластер Mesos или Docker Swarm (обратите внимание, что эти шаблоны отличаются только выбором оркестратора по умолчанию):

* [шаблон Mesos](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-mesos);
* [шаблон Swarm](https://github.com/Azure/azure-quickstart-templates/tree/master/101-acs-swarm).

Прежде чем создать кластер в подписке Azure, убедитесь, что для сеанса PowerShell выполнен вход в Azure. Это можно сделать с помощью команды `Get-AzureRMSubscription`:

```powershell
Get-AzureRmSubscription
```

Войти в Azure можно с помощью команды `Login-AzureRMAccount`:

```powershell
Login-AzureRmAccount
```

Если вы хотите развернуть кластер в новой группе ресурсов, такую группу необходимо сначала создать. Чтобы создать группу ресурсов, используйте команду `New-AzureRmResourceGroup`, указав имя группы ресурсов и регион назначения.

```powershell
New-AzureRmResourceGroup -Name GROUP_NAME -Location REGION
```

После создания группы ресурсов можно создать кластер, используя следующую команду: Для параметра `-TemplateUri` будет определен универсальный код ресурса (URI) нужного шаблона. При выполнении этой команды в PowerShell отобразится запрос на ввод значений параметров развертывания.

```powershell
New-AzureRmResourceGroupDeployment -Name DEPLOYMENT_NAME -ResourceGroupName RESOURCE_GROUP_NAME -TemplateUri TEMPLATE_URI
 ```

### Выбор параметров шаблона

Если вы знакомы с PowerShell, вы знаете,что вы можете проходить по кругу все доступные параметры для командлета. Для этого введите знак минус (-) и нажмите клавишу TAB. Точно так же это работает с параметрами, которые вы определили в шаблоне. Сразу после ввода имени шаблона командлет выбирает шаблон, анализирует его параметры и динамически добавляет параметры шаблона в команду. Таким образом можно легко указать значения параметров шаблона. Если вы забыли значение обязательного параметра, PowerShell подскажет его вам.

Ниже показана полная версия команды, в которой указаны параметры. Вы можете указать собственные значения для имен ресурсов.

```
New-AzureRmResourceGroupDeployment -ResourceGroupName RESOURCE_GROUP_NAME-TemplateURI TEMPLATE_URI -adminuser value1 -adminpassword value2 ....
```

## Дальнейшие действия

Теперь, когда у вас есть работающий кластер, ознакомьтесь со следующими статьями, чтобы узнать о возможностях подключения и управления.

- [Подключение к кластеру службы контейнеров Azure](./container-service-connect.md)
- [Работа со службой контейнеров Azure и Mesos](./container-service-mesos-marathon-rest.md)

<!---HONumber=AcomDC_0413_2016-->