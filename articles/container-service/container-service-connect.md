---
title: "Подключение к кластеру службы контейнеров Azure | Документация Майкрософт"
description: "Сведения о подключении к кластеру службы контейнеров Azure с использованием туннеля SSH."
services: container-service
documentationcenter: 
author: rgardler
manager: timlt
editor: 
tags: acs, azure-container-service
keywords: "Docker, контейнеры, микрослужбы, DC/OS, Azure"
ms.assetid: ff8d9e32-20d2-4658-829f-590dec89603d
ms.service: container-service
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/13/2016
ms.author: rogardle
translationtype: Human Translation
ms.sourcegitcommit: a4882b6fcd75ecaa826cdda3e25ee690b85a0670
ms.openlocfilehash: 34450e25941e0be97b72c1ba30ee348d73f4bc67


---
# <a name="connect-to-an-azure-container-service-cluster"></a>Подключение к кластеру службы контейнеров Azure
Кластеры DC/OS, Kubernetes и Docker Swarm, развернутые с помощью службы контейнеров Azure, предоставляют конечные точки REST.  При использовании Kubernetes к этой конечной точке предоставляется безопасный доступ через Интернет, и к ней можно напрямую обратиться с любого компьютера, подключенного к Интернету. Для безопасного подключения к конечной точке REST кластеров DC/OS и Docker Swarm следует создать SSH-туннель. Все эти подключения описаны ниже.

## <a name="connecting-to-a-kubernetes-cluster"></a>Подключение к кластеру Kubernetes.
Чтобы подключиться к кластеру Kubernetes, вам потребуется установленное средство командной строки `kubectl`.  Чтобы установить его, проще всего использовать средство командной строки Azure `az` версии 2.0.

```console
az acs kubernetes install cli [--install-location=/some/directory]
```

Кроме того, клиент можно загрузить со страницы [списка выпусков](https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG.md#downloads-for-v146).

Когда средство `kubectl` будет установлено, скопируйте на локальный компьютер учетные данные кластера.  Это тоже можно легко сделать с помощью средства командной строки `az`.

```console
az acs kubernetes get-credentials --dns-prefix=<some-prefix> --location=<some-location>
```

Эта операция загрузит учетные данные кластера в папку `$HOME/.kube/config`, где `kubectl` ожидает их найти.

Кроме того, можно с помощью `scp` безопасно скопировать файл на локальный компьютер из папки `$HOME/.kube/config` на главной виртуальной машине.

```console
mkdir $HOME/.kube/config
scp azureuser@<master-dns-name>:.kube/config $HOME/.kube/config
```

При работе в Windows следует использовать Bash на Ubuntu в Windows или средство Putty "pscp".

Когда настройка `kubectl` завершится, проверьте ее с помощью следующей команды.

```console
kubectl get nodes
```

Должен отобразиться список узлов в кластере.

Дальнейшие инструкции см. в [кратком руководстве по началу работы с Kubernetes](http://kubernetes.io/docs/user-guide/quick-start/).

## <a name="connecting-to-a-dcos-or-swarm-cluster"></a>Подключение к кластеру DC/OS или Swarm

Кластеры DC/OS и Docker Swarm, развернутые с помощью службы контейнеров Azure, предоставляют конечные точки REST. Но эти конечные точки не открыты для внешнего использования. Чтобы управлять этими конечными точками, необходимо создать туннель Secure Shell (SSH). После создания туннеля SSH можно выполнить команды к конечным точкам кластера и просмотреть пользовательский интерфейс кластера через браузер на вашем компьютере. В этом документе приводятся инструкции по созданию туннеля SSH в ОС Linux, OS X и Windows.

> [!NOTE]
> Вы можете создать сеанс SSH, используя систему управления кластером, но это не рекомендуется. Работа напрямую в системе управления сопряжена с риском случайного изменения конфигурации.   
> 
> 

## <a name="create-an-ssh-tunnel-on-linux-or-os-x"></a>Создание туннеля SSH в Linux или OS X
Во-первых, чтобы создать туннель SSH в любой из этих операционных систем, вам нужно узнать общедоступное DNS-имя главного сервера с балансировкой нагрузки. Для этого разверните группу ресурсов, чтобы отображались все ресурсы. Найдите и выберите общедоступный IP-адрес образца. Откроется колонка со сведениями об общедоступном IP-адресе, в которой также будет DNS-имя. Сохраните это имя для последующего использования. <br />

![Общедоступное DNS-имя](media/pubdns.png)

Теперь откройте оболочку и выполните следующую команду, где:

**PORT** — это порт конечной точки, к которой требуется предоставить доступ. Для Swarm это порт 2375, а Для DC/OS используется порт 80.  
**USERNAME** — имя пользователя, указанное при развертывании кластера.  
**DNSPREFIX** — префикс DNS, указанный при развертывании кластера.  
**REGION** — регион, в котором расположена ваша группа ресурсов.  
**PATH_TO_PRIVATE_KEY** [необязательно] — это путь к закрытому ключу, который соответствует открытому ключу, указанному во время создания кластера службы контейнеров. Используйте этот параметр с флагом -i.

```bash
ssh -L PORT:localhost:PORT -f -N [USERNAME]@[DNSPREFIX]mgmt.[REGION].cloudapp.azure.com -p 2200
```
> Для SSH-подключения используется порт 2200, а не стандартный порт 22.
> 
> 

## <a name="dcos-tunnel"></a>Туннель DC/OS
Чтобы создать туннель к связанным с DC/OS конечным точкам, выполните следующую команду:

```bash
sudo ssh -L 80:localhost:80 -f -N azureuser@acsexamplemgmt.japaneast.cloudapp.azure.com -p 2200
```

Связанные с DC/OS конечные точки теперь доступны по такому адресу:

* DC/OS: `http://localhost/`
* Marathon: `http://localhost/marathon`
* Mesos: `http://localhost/mesos`

Аналогичным образом через этот туннель можно подключаться к интерфейсам REST API каждого приложения.

## <a name="swarm-tunnel"></a>Туннель Swarm
Чтобы открыть туннель для конечной точки Swarm, выполните следующую команду:

```bash
ssh -L 2375:localhost:2375 -f -N azureuser@acsexamplemgmt.japaneast.cloudapp.azure.com -p 2200
```

Теперь можно задать переменную среды DOCKER_HOST, как указано далее. Вы можете продолжить использовать интерфейс командной строки Docker в обычном режиме.

```bash
export DOCKER_HOST=:2375
```

## <a name="create-an-ssh-tunnel-on-windows"></a>Создание туннеля SSH в Windows
Создавать туннели SSH в Windows можно несколькими способами. В этом документе описывается вариант с использованием PuTTY.

Скачайте PuTTY в операционную систему Windows и запустите приложение.

Введите имя узла, которое состоит из имени администратора кластера и общедоступного DNS-имени первого главного сервера в кластере. **Имя узла** будет выглядеть так: `adminuser@PublicDNS`. В поле **Порт**введите значение 2200.

![Конфигурация PuTTY 1](media/putty1.png)

Выберите **SSH**, а затем — **Проверка подлинности**. Выберите файл закрытого ключа для проверки подлинности.

![Конфигурация PuTTY 2](media/putty2.png)

Выберите **Туннели** и настройте следующие порты для перенаправления:

* **исходный порт** — используйте порт 80 для DC/OS или 2375 для Swarm;
* **конечный порт** — используйте localhost:80 для DC/OS или localhost:2375 для Swarm.

В следующем примере выполняется настройка для DC/OS. Для Docker Swarm эта процедура аналогична.

> [!NOTE]
> При создании этого туннеля нужно, чтобы порт 80 больше нигде не использовался.
> 
> 

![Конфигурация PuTTY 3](media/putty3.png)

По завершении сохраните конфигурацию подключения и откройте сеанс подключения PuTTY. После подключения конфигурацию порта можно просмотреть в журнале событий PuTTY.

![Журнал событий PuTTY](media/putty4.png)

После настройки туннеля для DC/OS связанная конечная точка будет доступна по такому адресу:

* DC/OS: `http://localhost/`
* Marathon: `http://localhost/marathon`
* Mesos: `http://localhost/mesos`

После настройки туннеля для Docker Swarm доступ к кластеру Swarm можно получать через интерфейс командной строки Docker. Сначала вам нужно будет настроить переменную среды Windows с именем `DOCKER_HOST` (задайте для нее значение ` :2375`).

## <a name="next-steps"></a>Дальнейшие действия
Развертывание контейнеров и управление ими с помощью DC/OS или Swarm:

* [Работа со службой контейнеров Azure и DC/OS](container-service-mesos-marathon-rest.md)
* [Работа со службой контейнеров Azure и Docker Swarm](container-service-docker-swarm.md)




<!--HONumber=Nov16_HO4-->


