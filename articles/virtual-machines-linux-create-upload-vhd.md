<properties urlDisplayName="Upload a VHD" pageTitle="Создание и передача виртуального жесткого диска с операционной системой Linux в Azure" metaKeywords="Azure VHD, uploading Linux VHD" description="Узнайте, как создать и передать виртуальный жесткий диск (VHD-файл) Azure, содержащий операционную систему Linux." metaCanonical="" services="virtual-machines" documentationCenter="" title="Создание и передача виртуального жесткого диска с операционной системой Linux" authors="kathydav" solutions="" manager="timlt" editor="tysonn" />

<tags ms.service="virtual-machines" ms.workload="infrastructure-services" ms.tgt_pltfrm="vm-linux" ms.devlang="na" ms.topic="article" ms.date="06/05/2014" ms.author="kathydav, szarkos" />

# Создание и передача виртуального жесткого диска с операционной системой Linux

В этой статье показано, как создать и передать виртуальный жесткий диск (VHD-файл), чтобы использовать его в качестве образа для создания виртуальных машин в Azure. Вы узнаете, как подготовить операционную систему, чтобы использовать ее в качестве образа для создания нескольких виртуальных машин.

> [WACOM.NOTE] Вам не требуется опыт работы с виртуальными машинами Azure, чтобы выполнить приведенные в этой статье шаги. Однако необходимо иметь учетную запись Azure. Вы можете создать бесплатную пробную учетную запись всего за несколько минут. Подробную информацию см. в разделе [Создание учетной записи Azure][Создание учетной записи Azure].

Виртуальная машина в Azure работает под управлением операционной системы на основе образа, который вы выбрали при создании виртуальной машины. Образы хранятся в формате виртуальных жестких дисков (VHD-файлы) в учетной записи хранения. Дополнительные сведения о дисках и образах в Azure см. в разделе [Управление дисками и образами][Управление дисками и образами].

При создании виртуальной машины можно настроить некоторые параметры операционной системы, чтобы оптимизировать их под приложение, которое вы хотите запустить. Инструкции см. в разделе [Создание настраиваемой виртуальной машины][Создание настраиваемой виртуальной машины].

**Важно!** Соглашение об уровне обслуживания платформы Azure применяется к виртуальным машинам, работающим под управлением ОС Linux, только если один из встроенных дистрибутивов используется вместе с данными конфигурации, указанными в [этой статье][этой статье]. Все дистрибутивы Linux, представленные в коллекции образов Azure, — это рекомендованные дистрибутивы, уже имеющие необходимую конфигурацию.

## Предварительные требования

В данной статье предполагается, что у вас есть следующие элементы:

-   **Сертификат управления** — Создан (и экспортирован в файл .cer) сертификат управления для подписки, для которой требуется загрузить VHD. Дополнительные сведения о создании сертификатов см. в разделе [Создание сертификата управления в Azure][Создание сертификата управления в Azure].

-   **Операционная система Linux установлена в файле VHD**. Вы установили поддерживаемую операционную систему Linux на виртуальный жесткий диск. Существует несколько средств для создания файлов VHD. Например, для создания файла VHD и установки операционной системы можно использовать решения для виртуализации, такие как Hyper-V. Инструкции см. в разделе [Установка роли Hyper-V и настройка виртуальной машины][Установка роли Hyper-V и настройка виртуальной машины].

    **Важно!** Более новый формат VHDX не поддерживается в Azure. Можно преобразовать диск в формат VHD с помощью диспетчера Hyper-V или командлета convert-vhd.

    Список рекомендованных дистрибутивов см. в документе [Linux в рекомендованных дистрибутивах Azure][Linux в рекомендованных дистрибутивах Azure]. Кроме того, в разделе, приведенном в конце данной статьи, содержатся [сведения о нерекомендованных дистрибутивах][сведения о нерекомендованных дистрибутивах].

-   **Средство командной строки Azure для Linux**. При использовании операционной системы Linux для создания образа следует использовать [средства командной строки Azure для Linux и Mac][средства командной строки Azure для Linux и Mac] для передачи VHD-файла.

-   **Средства Azure Powershell**. Командлет `Add-AzureVhd` также можно использовать для передачи VHD-файла. Для загрузки командлетов Azure Powershell перейдите на страницу [Загрузки Azure][Загрузки Azure]. Справочные сведения см. в разделе [Add-AzureVhd][Add-AzureVhd].

Эта задача включает следующие шаги:

-   [Шаг 1: подготовка образа для передачи][Шаг 1: подготовка образа для передачи]
-   [Шаг 2: создание учетной записи хранения в Azure][Шаг 2: создание учетной записи хранения в Azure]
-   [Шаг 3: подготовка подключения к Azure][Шаг 3: подготовка подключения к Azure]
-   [Шаг 4: передача образа в Azure][Шаг 4: передача образа в Azure]

## <span id="prepimage"></span> </a>Шаг 1: подготовка образа для передачи

Microsoft Azure поддерживает различные дистрибутивы Linux (см. раздел [Рекомендованные дистрибутивы][Linux в рекомендованных дистрибутивах Azure]). В следующих статьях описывается подготовка различных дистрибутивов Linux, которые поддерживаются в Azure:

-   **[Дистрибутивы на основе CentOS][Дистрибутивы на основе CentOS]**
-   **[Oracle Linux][Oracle Linux]**
-   **[SLES и openSUSE][SLES и openSUSE]**
-   **[Ubuntu][Ubuntu]**
-   **[Прочее — нерекомендованные дистрибутивы][сведения о нерекомендованных дистрибутивах]**

После выполнения этапов, описанных в вышеуказанных руководствах, у вас должен быть VHD-файл, переданный в Azure.

## <span id="createstorage"></span> </a>Шаг 2: создание учетной записи хранения в Azure

Учетная запись хранения представляет собой высший уровень пространства имен для доступа к службам хранения; эта запись связана с вашей подпиской Azure. Для загрузки в Azure файла VHD, который можно использовать для создания виртуальной машины, потребуется учетная запись хранения в Azure. Можно создать учетную запись хранения с помощью портала управления Azure.

1.  Войдите на портал управления Azure.

2.  На панели команд нажмите **Создать**.

    ![Создание учетной записи хранения][Создание учетной записи хранения]

3.  Нажмите **Учетная запись хранения**, а затем **Быстрое создание**.

    ![Быстрое создание учетной записи хранения][Быстрое создание учетной записи хранения]

4.  Заполните поля, как показано ниже:

    ![Введите сведения об учетной записи хранения][Введите сведения об учетной записи хранения]

-   В поле **URL-адрес** введите имя поддомена, используемого в URL-адресе для учетной записи хранения. Записи могут содержать от 3 до 24 строчных букв и цифр. Это имя становится именем узла в URL, который используется для адресации ресурсов BLOB-объекта, очереди и таблицы для подписки.

-   Выберите расположение или территориальную группу для учетной записи хранения. Указав территориальную группу, можно выполнить совместное размещение облачных служб в одном центре обработки данных с хранилищем.

-   Укажите, следует ли использовать георепликацию для учетной записи хранения. По умолчанию георепликация включена. Этот параметр позволяет бесплатно выполнять репликацию данных в дополнительное местоположение; таким образом в случае аварийного отказа, который не может быть устранен в основном местоположении, хранилище переключится на дополнительное местоположение. Дополнительное местоположение назначается автоматически и не может быть изменено. Если в соответствии с законодательными требованиями или организационной политикой требуется более жесткий контроль местоположения облачного хранилища, то георепликацию можно отключить. Однако следует помнить, что если вы опять включите георепликацию, с вас будет взята однократная плата за репликацию существующих данных в дополнительное местоположение. Службы хранения без георепликации предлагаются со скидкой.

1.  Щелкните **Создать учетную запись хранения**.

    Учетная запись появится в списке **учетных записей хранения**.

    ![Учетная запись хранилища успешно создана][Учетная запись хранилища успешно создана]

## <span id="connect"></span> </a>Шаг 3: подготовка подключения к Azure

Перед загрузкой файла VHD необходимо установить безопасное соединение между компьютером и вашей подпиской в Azure.

1.  Откройте окно Azure PowerShell.

2.  Введите:

    `Get-AzurePublishSettingsFile`

    Эта команда открывает окно браузера и автоматически загружает файл .publishsettings, содержащий информацию и сертификат для подписки Azure.

3.  Сохраните файл .publishsettings.

4.  Введите:

    `Import-AzurePublishSettingsFile <PathToFile>`

    Где "`<PathToFile>`" — это полный путь к файлу .publishsettings.

    Дополнительные сведения см. в разделе [Начало работы с командлетами Azure][Начало работы с командлетами Azure]

## <span id="upload"></span> </a>Шаг 4: передача образа в Azure

При загрузке файла .vhd его можно поместить в любом месте внутри хранилища blob. В приведенных ниже примерах команд **BlobStorageURL** — это URL-адрес для учетной записи хранения, созданный при выполнении шага 2, **YourImagesFolder** — это контейнер внутри хранилища BLOB-данных, где будут храниться образы. **VHDName** — это метка, которая отображается в портале управления для идентификации виртуального жесткого диска. **PathToVHDFile** — это полный путь и имя файла .vhd.

Выполните одно из следующих действий.

-   В окне Azure PowerShell, использованном при выполнении предыдущего шага, введите:

        `Add-AzureVhd -Destination <BlobStorageURL>/<YourImagesFolder>/<VHDName> -LocalFilePath <PathToVHDFile>`

    Дополнительные сведения см. в разделе [Add-AzureVhd][1].

-   Используйте программу командной строки Linux для передачи образа. Можно передать образ, используя следующую команду:

        # azure vm image create <image-name> --location <location-of-the-data-center> --OS Linux <source-path-to the vhd>

  [Создание учетной записи Azure]: http://www.windowsazure.com/ru-ru/develop/php/tutorials/create-a-windows-azure-account/
  [Управление дисками и образами]: http://msdn.microsoft.com/ru-ru/library/windowsazure/jj672979.aspx
  [Создание настраиваемой виртуальной машины]: /ru-ru/manage/windows/how-to-guides/custom-create-a-vm/
  [этой статье]: http://support.microsoft.com/kb/2805216
  [Создание сертификата управления в Azure]: http://msdn.microsoft.com/library/windowsazure/gg551722.aspx
  [Установка роли Hyper-V и настройка виртуальной машины]: http://technet.microsoft.com/library/hh846766.aspx
  [Linux в рекомендованных дистрибутивах Azure]: ../linux-endorsed-distributions
  [сведения о нерекомендованных дистрибутивах]: ../virtual-machines-linux-create-upload-vhd-generic
  [средства командной строки Azure для Linux и Mac]: http://go.microsoft.com/fwlink/?LinkID=253691&clcid=0x409
  [Загрузки Azure]: http://azure.microsoft.com/ru-ru/downloads/
  [Add-AzureVhd]: http://msdn.microsoft.com/library/windowsazure/dn495173.aspx
  [Шаг 1: подготовка образа для передачи]: #prepimage
  [Шаг 2: создание учетной записи хранения в Azure]: #createstorage
  [Шаг 3: подготовка подключения к Azure]: #connect
  [Шаг 4: передача образа в Azure]: #upload
  [Дистрибутивы на основе CentOS]: ../virtual-machines-linux-create-upload-vhd-centos
  [Oracle Linux]: ../virtual-machines-linux-create-upload-vhd-oracle
  [SLES и openSUSE]: ../virtual-machines-linux-create-upload-vhd-suse
  [Ubuntu]: ../virtual-machines-linux-create-upload-vhd-ubuntu
  [Создание учетной записи хранения]: ./media/virtual-machines-linux-create-upload-vhd/create.png
  [Быстрое создание учетной записи хранения]: ./media/virtual-machines-linux-create-upload-vhd/storage-quick-create.png
  [Введите сведения об учетной записи хранения]: ./media/virtual-machines-linux-create-upload-vhd/storage-create-account.png
  [Учетная запись хранилища успешно создана]: ./media/virtual-machines-linux-create-upload-vhd/Storagenewaccount.png
  [Начало работы с командлетами Azure]: http://msdn.microsoft.com/ru-ru/library/windowsazure/jj554332.aspx
  [1]: http://msdn.microsoft.com/ru-ru/library/windowsazure/dn205185.aspx
