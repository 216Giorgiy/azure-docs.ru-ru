<properties pageTitle="Создание и передача виртуального жесткого диска с операционной системой Linux в Azure" description="Узнайте, как создать и передать виртуальный жесткий диск (VHD-файл) Azure, содержащий операционную систему Linux." services="virtual-machines" documentationCenter="" authors="KBDAzure" manager="timlt" editor="tysonn"/>

<tags ms.service="virtual-machines" ms.workload="infrastructure-services" ms.tgt_pltfrm="vm-linux" ms.devlang="na" ms.topic="article" ms.date="01/13/2015" ms.author="kathydav, szarkos"/>

# Создание и передача виртуального жесткого диска с операционной системой Linux

В этой статье показано, как создать и передать виртуальный жесткий диск (VHD-файл), чтобы использовать его в качестве образа для создания виртуальных машин в Azure. Вы узнаете, как подготовить операционную систему, чтобы использовать ее в качестве образа для создания нескольких виртуальных машин.  

> [AZURE.NOTE] Вам не требуется опыт работы с виртуальными машинами Azure, чтобы выполнить приведенные в этой статье шаги. Однако необходимо иметь учетную запись Azure. Вы можете создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в статье [Создание учетной записи Azure](http://www.windowsazure.com/ru-ru/develop/php/tutorials/create-a-windows-azure-account/). 

Виртуальная машина в Azure работает под управлением операционной системы на основе образа, который вы выбрали при создании виртуальной машины. Образы хранятся в формате виртуальных жестких дисков (VHD-файлы) в учетной записи хранения. Дополнительную информацию о дисках и образах в Azure см. в разделе [Управление дисками и образами](http://msdn.microsoft.com/ru-ru/library/windowsazure/jj672979.aspx).

При создании виртуальной машины можно настроить некоторые параметры операционной системы, чтобы оптимизировать их под приложение, которое вы хотите запустить. Указания см. в статье [Как создать настраиваемую виртуальную машину](/ru-ru/manage/windows/how-to-guides/custom-create-a-vm/).

**Внимание**! Соглашение об уровне обслуживания платформы Azure применяется к виртуальным машинам, работающим под управлением ОС Linux, только если один из встроенных дистрибутивов используется вместе с данными конфигурации, указанными в [этой статье](http://support.microsoft.com/kb/2805216). Все дистрибутивы Linux, представленные в коллекции образов Azure, - это рекомендованные дистрибутивы, уже имеющие необходимую конфигурацию.


##Предварительные требования##
В данной статье предполагается, что у вас есть следующие элементы:

- **Сертификат управления**. Вы создали (и экспортировали в CER-файл) сертификат управления для подписки, для которой требуется загрузить VHD. Дополнительную информацию о создании сертификатов см. в разделе [Создание сертификата управления в Azure](http://msdn.microsoft.com/library/windowsazure/gg551722.aspx). 

- **Операционная система Linux установлена в файле VHD**. Вы установили поддерживаемую операционную систему Linux на виртуальный жесткий диск. Существует несколько средств для создания файлов VHD. Например, для создания файла VHD и установки операционной системы можно использовать решения для виртуализации, такие как Hyper-V. Инструкции об этом см. в статье [Установка роли Hyper-V и настройка виртуальной машины](http://technet.microsoft.com/library/hh846766.aspx). 

	**Внимание**! Более новый формат VHDX не поддерживается в Azure. Можно преобразовать диск в формат VHD с помощью диспетчера Hyper-V или командлета convert-vhd.

	Список рекомендованных дистрибутивов см. в документе [Linux в рекомендованных дистрибутивах Azure](../linux-endorsed-distributions). Кроме того, в разделе, приведенном в конце данной статьи, содержится [информация о нерекомендованных дистрибутивах](../virtual-machines-linux-create-upload-vhd-generic).

- **Программа командной строки Azure для Linux**. При использовании операционной системы Linux для создания образа следует использовать [программы командной строки Azure для Linux и Mac](http://go.microsoft.com/fwlink/?LinkID=253691&clcid=0x409) для передачи VHD-файла.

- **Инструменты Azure Powershell**. Командлет `Add-AzureVhd` также можно использовать для передачи VHD-файла. Чтобы скачать командлеты Azure Powershell, перейдите на страницу [Загрузки Azure](http://azure.microsoft.com/ru-ru/downloads/). Справочную информацию см. в разделе [Add-AzureVhd](http://msdn.microsoft.com/library/windowsazure/dn495173.aspx).


Эта задача включает следующие шаги:

- [Шаг 1. Подготовка образа для передачи] []
- [Шаг 2. Создание учетной записи хранения в Azure] []
- [Шаг 3. Подготовка подключения к Azure] []
- [Шаг 4. передача образа в Azure] []

## <a id="prepimage"> </a>Шаг 1. подготовка образа для передачи ##

Microsoft Azure поддерживает различные дистрибутивы Linux (см. раздел [Рекомендованные дистрибутивы](../linux-endorsed-distributions)). В следующих статьях описывается подготовка различных дистрибутивов Linux, которые поддерживаются в Azure:

- **[Дистрибутивы на основе CentOS](../virtual-machines-linux-create-upload-vhd-centos)**
- **[Oracle Linux](../virtual-machines-linux-create-upload-vhd-oracle)**
- **[SLES и openSUSE](../virtual-machines-linux-create-upload-vhd-suse)**
- **[Ubuntu](../virtual-machines-linux-create-upload-vhd-ubuntu)**
- **[Прочее - нерекомендованные дистрибутивы](../virtual-machines-linux-create-upload-vhd-generic)**

Дополнительные советы по подготовке образов Linux для Azure см. в разделе **[Общие замечания по установке Linux](../virtual-machines-linux-create-upload-vhd-generic/#linuxinstall)**.

После выполнения этапов, описанных в вышеуказанных руководствах, у вас должен быть VHD-файл для передачи в Azure.


## <a id="createstorage"> </a>Шаг 2. создание учетной записи хранения в Azure ##

Учетная запись хранения представляет собой высший уровень пространства имен для доступа к службам хранения; эта запись связана с вашей подпиской Azure. Чтобы передать в Azure VHD-файл, который можно использовать для создания виртуальной машины, потребуется учетная запись хранения в Azure. Можно создать учетную запись хранения с помощью портала управления Azure.

1. Войдите на портал управления Azure.

2. На панели команд нажмите **Создать**.

	![Create storage account](./media/virtual-machines-linux-create-upload-vhd/create.png)

3. Щелкните **Учетная запись хранения**, а затем **Быстрое создание**.

	![Quick create a storage account](./media/virtual-machines-linux-create-upload-vhd/storage-quick-create.png)

4. Заполните поля, как показано ниже:

	![Enter storage account details](./media/virtual-machines-linux-create-upload-vhd/storage-create-account.png)

- В поле **URL-адрес** введите имя поддомена, которое нужно использовать в URL-адресе для учетной записи хранения. Записи могут содержать от 3 до 24 строчных букв и цифр. Это имя становится именем узла в URL, который используется для адресации ресурсов BLOB-объекта, очереди и таблицы для подписки.
	
- Выберите расположение или территориальную группу для учетной записи хранения. Указав территориальную группу, можно выполнить совместное размещение облачных служб в одном центре обработки данных с хранилищем.
 
- Укажите, следует ли использовать георепликацию для учетной записи хранения. По умолчанию георепликация включена. Этот параметр позволяет бесплатно выполнять репликацию данных в дополнительное местоположение; таким образом в случае аварийного отказа, который не может быть устранен в основном местоположении, хранилище переключится на дополнительное местоположение. Дополнительное местоположение назначается автоматически и не может быть изменено. Если в соответствии с законодательными требованиями или организационной политикой требуется более жесткий контроль местоположения облачного хранилища, то георепликацию можно отключить. Однако следует помнить, что если вы опять включите георепликацию, с вас будет взята однократная плата за репликацию существующих данных в дополнительное местоположение. Службы хранения без георепликации предлагаются со скидкой.

5. Щелкните **Создать учетную запись хранения**.

	Учетная запись появится в списке **учетных записей хранения**.

	![Storage account successfully created](./media/virtual-machines-linux-create-upload-vhd/Storagenewaccount.png)


## <a id="connect"></a>Шаг 3. подготовка подключения к Azure ##

Перед загрузкой файла VHD необходимо установить безопасное соединение между компьютером и вашей подпиской в Azure. 

1. Откройте окно Azure PowerShell.

2. Введите: 

	`Get-AzurePublishSettingsFile`

	Эта команда открывает окно браузера и автоматически загружает файл .publishsettings, содержащий информацию и сертификат для подписки Azure. 

3. Сохраните PUBLISHSETTINGS-файл. 

4. Введите:

	`Import-AzurePublishSettingsFile <PathToFile>`

	Где "`<PathToFile>`" - это полный путь к файлу .publishsettings. 

	Дополнительную информацию см. в разделе [Начало работы с командлетами Azure](http://msdn.microsoft.com/ru-ru/library/windowsazure/jj554332.aspx). 


## <a id="upload"></a>Шаг 4. передача образа в Azure ##

При загрузке VHD-файла его можно поместить в любом месте внутри хранилища больших двоичных объектов. В приведенных ниже примерах команд **BlobStorageURL** - это URL-адрес для учетной записи хранения, созданный при выполнении шага 2, **YourImagesFolder** - это контейнер внутри хранилища BLOB-объектов, где будут храниться образы. **VHDName** - метка, отображающаяся на портале управления для идентификации виртуального жесткого диска. **PathToVHDFile** - имя VHD-файла и полный путь к нему. 

Выполните одно из следующих действий.

- В окне Azure PowerShell, использованном при выполнении предыдущего шага, введите:

		`Add-AzureVhd -Destination <BlobStorageURL>/<YourImagesFolder>/<VHDName> -LocalFilePath <PathToVHDFile>`

	Дополнительную информацию см. в разделе [Add-AzureVhd](http://msdn.microsoft.com/ru-ru/library/windowsazure/dn205185.aspx).

- Используйте программу командной строки Linux для передачи образа. Можно передать образ, используя следующую команду:

		# azure vm image create <image-name> --location <location-of-the-data-center> --os Linux <source-path-to the vhd>



[Шаг 1. Подготовка образа для передачи]: #prepimage
[Шаг 2. Создание учетной записи хранения в Azure]: #createstorage
[Шаг 3. Подготовка подключения к Azure]: #connect
[Шаг 4. передача образа в Azure]: #upload



<!--HONumber=42-->
