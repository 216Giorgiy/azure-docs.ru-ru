<properties 
   pageTitle="Объекты Webhook в службе автоматизации Azure"
   description="Объект Webhook, который позволяет клиенту запустить модуль Runbook в службе автоматизации Azure с помощью HTTP-запроса. В статье рассматривается создание объекта Webhook и вызов такого объекта для запуска модуля Runbook."
   services="automation"
   documentationCenter=""
   authors="bwren"
   manager="stevenka"
   editor="tysonn" />
<tags 
   ms.service="automation"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="05/13/2015"
   ms.author="bwren" />

# Объекты Webhook в службе автоматизации Azure

*Webhook* позволяет запустить модуль Runbook в службе автоматизации Azure с помощью одного HTTP-запроса. Это позволяет внешним службам, таким как Visual Studio Online, GitHub, или пользовательским приложениям запускать модули Runbook без реализации полного решения с помощью API-интерфейса службы автоматизации Azure.

![Объекты Webhook](media/automation-webhooks/webhooks-overview.png)

Сравнение объектов Webhook с другими методами запуска модуля Runbook см. в разделе [Запуск модуля Runbook в службе автоматизации Azure](automation-starting-a-runbook.md).

## Подробные сведения о Webhook

В следующей таблице описаны свойства, которые необходимо настроить для объекта Webhook.

| Свойство | Описание |
|:---|:---|
|Имя | Для объекта Webhook можно указать любое имя, так как оно не раскрывается клиенту. Имя используется для идентификации модуля Runbook в службе автоматизации Azure. <br> Рекомендуется задать объекту Webhook имя, связанное с клиентом, который будет его использовать. |
|URL-адрес |URL-адрес Webhook — это уникальный адрес, который использует клиент для метода HTTP POST для запуска модуля Runbook, связанного с объектом Webhook. URL-адрес создается автоматически при создании объекта Webhook. Нельзя указать другой URL-адрес. <br> <br> URL-адрес содержит токен безопасности, который позволяет сторонней системе вызвать модуль Runbook без дополнительной проверки подлинности. По этой причине он должен рассматриваться как пароль. По соображениям безопасности просмотреть URL-адрес в предварительной версии портала Azure можно только в момент создания объекта Webhook. URL-адрес следует записать в надежном месте, чтобы использовать его в дальнейшем. |
|Срок действия | Как и сертификат, каждый объект Webhook имеет срок действия, после которого он больше не используется. Срок действия нельзя изменить после создания Webhook, а сам Webhook нельзя включить снова после истечения срока действия. Потребуется создать новый объект Webhook, чтобы заменить текущий объект, и обновить клиент для использования нового объекта. |
| Включено | По умолчанию модуль Runbook включен при создании. Если его отключить, клиенты не смогут его использовать. Свойство **Включен** можно задать при создании объекта Webhook или в любое время после его создания. |


### Параметры
Объект Webhook может определять значения для параметров модуля Runbook, которые используются при запуске модуля Runbook этим объектом Webhook. Объект Webhook должен содержать значения для всех обязательных параметров модуля Runbook и может также включать необязательные параметры. Несколько объектов Webhook, привязанных к одному модулю Runbook, могут использовать разные значения параметров.

>[AZURE.NOTE]В настоящее время значения параметров, заданные объектом Webhook, не могут быть изменены после его создания. Для использования других значений параметров потребуется создать другой объект Webhook.

Когда клиент запускает модуль Runbook с помощью объекта Webhook, клиент не может переопределить значения параметров, определяемые Webhook. Чтобы получать данные от клиента, модуль Runbook может принимать один параметр **$WebhookData** типа [объект], который содержит данные, включаемые клиентом в POST-запрос.

![Webhookdata](media/automation-webhooks/webhookdata.png)

Объект **$WebhookData** имеет следующие свойства.

| Свойство | Описание |
|:--- |:---|
| WebhookName | Имя объекта Webhook. |
| RequestHeader | Заголовки входящего запроса POST. |
| RequestBody | Текст входящего запроса POST. |

Нет настройки объекта Webhook, которая была бы обязательной для поддержки параметра **$WebhookData**, однако модуль Runbook не обязан принимать его. Если модуль Runbook не определяет параметр, любые сведения в запросе клиента пропускаются.

Если указать значение для параметра $WebhookData в момент создания объекта Webhook, это значение будет переопределено, когда объект Webhook запустит модуль Runbook с данными из клиентского POST-запроса, даже если клиент не включает какие-либо данные в текст запроса. При запуске модуля Runbook, у которого параметр $WebhookData использует метод, отличный от Webhook, можно указать значение для $Webhookdata, которое будет распознаваться модулем Runbook. Это значение должно быть объектом с теми же свойствами, что и $Webhookdata, чтобы модуль Runbook смог с ним работать.

>[AZURE.NOTE]Значения входных параметров вводятся вместе с заданием Runbook. Это означает, что значения, предоставленные клиентом, будут приняты $WebhookData и доступны всем, у кого есть доступ к заданию автоматизации. По этой причине необходимо соблюдать осторожность при указании критических данных в вызовах Webhook.

## Безопасность

Безопасность объекта Webhook зависит от безопасности URL-адреса, который содержит токен безопасности, позволяющий вызывать объект Webhook. Служба автоматизации Azure не выполняет проверку подлинности для запроса, если он выполняется с правильным URL-адресом. По этой причине объекты Webhook не следует применять для модулей Runbook, которые выполняют важные функции, без использования дополнительной проверки запроса.

Можно включить логику в модуль Runbook, которая будет определять вызов объектом Webhook путем проверки свойства **WebhookName** для параметра $WebhookData. Runbook может выполнять последующие проверки путем поиска определенной информации в свойствах **RequestHeader** или **RequestBody**.

Еще одна стратегия заключается в том, чтобы модуль Runbook выполнял проверку внешнего условия после получения запроса Webhook. Например, рассмотрим модуль Runbook, вызываемый из GitHub каждый раз, когда на GitHub появляется обновление репозитория. Модуль Runbook может подключаться к GitHub, чтобы проверить доступность обновления.

## Создание объекта Webhook

Для создания нового объекта Webhook, связанного с модулем Runbook в предварительной версии портала Azure, воспользуйтесь следующей процедурой.

1. В области **Модули Runbook** в предварительной версии портала Azure щелкните модуль Runbook, запускаемый объектом Webhook, чтобы просмотреть его подробные сведения. 
3. Щелкните **Webhook** в верхней части колонки, чтобы открыть колонку **Добавить объект Webhook**. <br> ![Кнопка Webhook](media/automation-webhooks/webhooks-button.png)
4. Щелкните **Создать объект Webhook**, чтобы открыть колонку **Создание объекта Webhook**.
5. Укажите **Имя**, **Срок действия** для объекта Webhook и необходимость его включения. Подробные сведения об этих свойствах см. в разделе [Сведения об объекте Webhook](#details-of-a-webhook).
6. Щелкните значок копирования и нажмите Ctrl+C, чтобы скопировать URL-адрес объекта Webhook. Сохраните URL-адрес в безопасном месте. **После создания объекта Webhook URL-адрес нельзя получить повторно.** <br> ![URL-адрес Webhook](media/automation-webhooks/copy-webhook-url.png)
1. Щелкните **Создать**, чтобы создать объект Webhook.
3. Щелкните **Параметры**, чтобы указать значения для параметров модуля Runbook. <br>
1. Щелкните **OK**, чтобы завершить настройки Webhook.


## Использование объекта Webhook

Чтобы использовать объект Webhook, клиентское приложение должно создать запрос HTTP POST с URL-адресом для объекта Webhook. Синтаксис объекта Webhook будет иметь следующий формат.

	http://<Webhook Server>/token?=<Token Value>


Клиент получит один из следующих кодов в ответ на запрос POST.

| Код | Текст | Описание |
|:---|:----|:---|
| 202 | Принято | Запрос был принят, и модуль Runbook успешно запущен. |
| 400 | Ошибка запроса | Запрос не был принят по одной из следующих причин. <ul> <li>Срок действия Webhook истек.</li> <li>Webhook отключен.</li> <li>Недопустимый токен в URL-адресе.</li> </ul>|
| 500 | Внутренняя ошибка сервера | URL-адрес допустимый, но произошла ошибка. Отправьте запрос повторно. |

Клиент не может определить время или состояние завершения задания Runbook из объекта Webhook, потому что Webhook не возвращает идентификатор задания Runbook. Можно только убедиться, что запрос был отправлен повторно.

### Пример

В следующем примере модуль Runbook запускается с помощью Webhook из Windows PowerShell. Пример содержит данные для заголовка и текста, которые могут быть использованы модулем Runbook. Обратите внимание, что любой язык, способный выполнить HTTP-запрос, может использовать Webhook.

	$uri = "https://oaaswebhookcurrent.cloudapp.net/webhooks?token=8ud0dSrSo%2fvHWpYbklW%3c8s0GrOKJZ9Nr7zqcS%2bIQr4c%3d"
	$headers = @{"header1"="headerval1";"header2"="headerval2"}
	$body = "some request body"

	Invoke-RestMethod -Method Post -Uri $uri -Headers $headers -Body $body

В следующем примере модуль Runbook принимает предыдущий запрос и получает данные из объекта Webhook.

	workflow Sample-Webhook
	{
		param (	
				[object]$WebhookData
		)
	
		$WebhookName 	= 	$WebhookData.WebhookName
		$WebhookHeaders = 	$WebhookData.RequestHeader
		$WebhookBody 	= 	$WebhookData.RequestBody
	} 

	

## Связанные статьи

- [Запуск модуля Runbook](automation-starting-a-runbook.md)
- [Просмотр состояния задания Runbook](automation-viewing-the-status-of-a-runbook-job.md)

<!---HONumber=58-->