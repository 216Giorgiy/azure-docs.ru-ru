---
title: Основные понятия сетевых взаимодействий в Службе Azure Kubernetes (AKS)
description: Дополнительные сведения о сетях в Службе Azure Kubernetes(AKS), включая базовые и расширенные сети, входящие контроллеры, подсистемы балансировки нагрузки и статические IP-адреса.
services: container-service
author: iainfoulds
ms.service: container-service
ms.topic: conceptual
ms.date: 10/16/2018
ms.author: iainfou
ms.openlocfilehash: 62ba98f221041d5bbf9bb095a02d052218eb0fd0
ms.sourcegitcommit: 3a7c1688d1f64ff7f1e68ec4bb799ba8a29a04a8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2018
ms.locfileid: "49380889"
---
# <a name="network-concepts-for-applications-in-azure-kubernetes-service-aks"></a>Основные понятия сети в Службе Azure Kubernetes (AKS)

В подходе микрослужб контейнерного формата к использованию разработки приложений компоненты приложения должны работать вместе. Kubernetes предоставляет различные ресурсы, которые позволяют приложениям взаимодействовать. К приложениям можно подключиться и предоставить внутренний или внешний доступ. Чтобы создать приложения с высоким уровнем доступности, можно распределить их нагрузку. Более сложные приложения требуют настройку входящего трафика для маршрутизации из нескольких компонентов и подключений SSL/TLS. По соображениям безопасности может потребоваться ограничение передачи трафика в или между модулями pod и узлами.

В этой статье приводится обзор ключевых понятий сети в приложениях в AKS.

- [Службы](#services)
- [Виртуальные сети Azure](#azure-virtual-networks)
- [Контроллеры входящего трафика](#ingress-controllers)
- [Политики сети](#network-policies)

## <a name="kubernetes-basics"></a>Базовые сведения о Kubernetes

Чтобы предоставить доступ к приложениям или разрешить компонентам приложений взаимодействовать друг с другом, Kubernetes предоставляет уровень абстракции для виртуальной сети. Узлы Kubernetes подключены к виртуальной сети, а также могут предоставлять входящее и исходящее подключение для модулей pod. Чтобы предоставить сетевые компоненты, компонент *прокси-сервера kube* выполняется на каждом узле.

В Kubernetes *Службы* логически группируют модули, чтобы разрешать прямой доступ с помощью IP-адреса или DNS-имени и через определенный порт. *Подсистема балансировки нагрузки* может распределять трафик. Более сложную маршрутизацию трафика приложения можно получить с помощью *контролеров входящего трафика*. Безопасность и фильтрацию сетевого трафика модулей pod можно совершить с помощью *политик сети* Kubernetes.

Платформа Azure также помогает упростить виртуальные сети для кластеров AKS. При создании подсистемы балансировки нагрузки Kubernetes создается и настраивается подсистема балансировки нагрузки Azure. При открытии сетевых портов для модулей pod настраиваются соответствующие правила группы безопасности сети Azure. Для маршрутизации приложений протокола HTTP Azure может настроить *внешний DNS-сервер* как новый входящий трафик.

## <a name="services"></a>Службы

Чтобы упростить конфигурацию сети для рабочих нагрузок приложений, Kubernetes использует *Службы*, чтобы логически сгруппировать набор модулей и установить сетевое подключение. Ниже приведены доступные типы служб.

- **IP-адрес кластера** — создает внутренний IP-адрес для использования в кластере AKS. Подходит только для внутренних приложений, которые поддерживают другие рабочие нагрузки в кластере.

    ![Схема, показывающая поток трафика IP-адреса кластера в кластере AKS][aks-clusterip]

- **NodePort** — создает сопоставление портов на основной узел, который позволяет получить приложение непосредственно с узла IP-адреса и порта.

    ![Схема, показывающая поток трафика NodePort в кластере AKS][aks-nodeport]

- **LoadBalancer** — создает ресурс подсистемы балансировки нагрузки Azure, настраивает внешний IP-адрес и подключает запрошенные модули pod, содержащиеся во внутреннем пуле подсистемы балансировки нагрузки. На необходимых портах создаются правила балансировки нагрузки, чтобы разрешить потоку клиентов охватывать приложение. 

    ![Схема, показывающая поток трафика Load Balancer в кластере AKS][aks-loadbalancer]

    Для дополнительного контроля и маршрутизации входящего трафика можно вместо этого использовать [контроллер входящего трафика](#ingress-controllers).

- **ExternalName** — создает определенную запись DNS для упрощения доступа к приложениям.

IP-адрес для подсистемы балансировки нагрузки и служб может назначаться динамически, или можно указать существующий статический IP-адрес для использования. Можно назначить внутренние и внешние статические IP-адреса. Часто этот существующий статический IP-адрес связан с записью DNS.

Можно создать *внутреннюю* и *внешнюю* подсистему балансировки нагрузки. Частный IP-адрес назначает внутреннюю подсистему балансировки нагрузки, поэтому она не доступна из Интернета.

## <a name="azure-virtual-networks"></a>Виртуальные сети Azure

В AKS можно развернуть кластер, использующий одну из двух следующих моделей сети.

- Сеть уровня *Базовый*— ресурсы создаются и настраиваются при развертывании кластера AKS.
- Сеть уровня *Расширенный*— кластер AKS подключен к существующим ресурсам виртуальной сети и конфигурациям.

### <a name="basic-networking"></a>Сетевое взаимодействие уровня "Базовый"

Параметр сети *Базовый* — это конфигурация по умолчанию для создания кластера AKS. Платформа Azure управляет конфигурацией сети кластера и модулей pod. Основные сети подходят для развертываний, которые не требуют настраиваемой виртуальной сети. С базовой сетью невозможно определить конфигурации сети, а именно имена подсети и диапазоны IP-адресов, назначенные кластеру AKS.

В кластере AKS узлы, для которых выбран параметр сети "Базовый", используют подключаемый модуль Kubernetes [kubenet][kubenet].

Сетевое взаимодействие уровня "Базовый" обеспечивает приведенные ниже преимущества.

- Предоставление службы Kubernetes на внешнем или внутреннем уровне через Azure Load Balancer.
- Контейнеры pod могут получать доступ к ресурсам в общедоступном Интернете.

### <a name="advanced-networking"></a>Сетевое взаимодействие уровня "Расширенный"

Сети уровня *Расширенный* помещает модули pod в настраиваемую виртуальную сеть Azure. Эта виртуальная сеть обеспечивает автоматическое подключение к другим ресурсам Azure и интеграцию с широким набором возможностей. Сетевое взаимодействие уровня "Расширенный" подходит для развертываний, требующих конфигурации конкретной виртуальной сети, например, использовать имеющуюся подсеть и подключения. С помощью сетевого взаимодействия уровня "Расширенный" можно определить эти имена подсетей и диапазоны IP-адресов.

Узлы в кластере AKS, настроенном для сетевого взаимодействия уровня "Расширенный", используют подключаемый модуль Kubernetes [сетевого интерфейса работы с контейнерами Azure (CNI)][cni-networking].

![Схема, демонстрирующая два узла с мостами, подключающими каждый из них к одной виртуальной сети Azure][advanced-networking-diagram]

Сетевое взаимодействие уровня "Базовый" обеспечивает приведенные ниже преимущества.

- Развертывание кластера AKS в имеющуюся виртуальную сеть, или создание новой виртуальной сети и подсети для кластера.
- Каждый метод pod в кластере назначается IP-адресом в виртуальной сети. Модули pod могут напрямую взаимодействовать с другими группами pod в кластере, а также другими узлами в виртуальной сети.
- Группа контейнеров pod может подключаться к другим службам одноранговой виртуальной сети, а также к локальным сетям через ExpressRoute и VPN типа "сеть — сеть" (S2S). Контейнеры pod также доступны локально.
- Контейнеры pod в подсети с включенными конечными точками службы могут безопасно подключаться к службам Azure (например, к службе хранилища или базе данных SQL).
- Можно создать определяемые пользователем маршруты, чтобы маршрутизировать трафик из контейнеров pod к виртуальным сетевым модулям.

Подробнее см. в статье [Настройка расширенных параметров сети в Службе Azure Kubernetes (AKS)][aks-configure-advanced-networking].

## <a name="ingress-controllers"></a>Контроллеры входящего трафика

При создании службы типа LoadBalancer создается базовый ресурс балансировщика нагрузки Azure. Подсистема балансировки нагрузки настраивается для распределения трафика к модулям pod, содержащихся в службе на данном порте. LoadBalancer работает только в подсистеме балансировки нагрузки уровня 4 — служба не знает о приложениях и не может вносить любые дополнительные рекомендации относительно маршрутизации.

*Входящие контроллеры* работают на уровне 7 и могут использовать более интеллектуальные правила для распределения трафика приложения. Контроллер входящего трафика обычно используется для передачи трафика HTTP для различных приложений, в зависимости от входящего URL-адреса.

![Схема, показывающая поток входящего трафика в кластере AKS][aks-ingress]

В AKS создайте входящий ресурс, например NGINX, или используйте функцию маршрутизации приложения AKS HTTP. При включении маршрутизации приложений HTTP для кластера AKS платформа Azure создает контроллер входящего трафика и контроллер *внешнего DNS*. Новые входящие ресурсы создаются в Kubernetes. В зоне DNS кластеров создаются необходимые записи DNS A. Дополнительные сведения см. в статье [Маршрутизация приложений HTTP][aks-http-routing].

Другой характерной входящего трафика является действие SSL/TLS. На больших веб-приложениях, доступных через HTTPS, терминация TLS может обрабатываться входящим ресурсом, а не самим приложением. Чтобы обеспечить автоматическое создание сертификации TLS и конфигурации, можно настроить входящий ресурс для использования поставщиком, например Let's Encrypt. Дополнительные сведения о настройке контроллера входящего трафика NGINX с помощью Let's Encrypt см. в статье [Создание контроллера входящего трафика HTTPS в Службе Azure Kubernetes (AKS)][aks-ingress-tls].

## <a name="network-security-groups"></a>Группы безопасности сети

Группа безопасности сети фильтрует трафик сети для виртуальных машин, например, узлы AKS. При создании служб (например, LoadBalancer) платформа Azure автоматически настраивает все необходимые правила группы безопасности сети. Чтобы фильтровать трафик для моделей pod в кластере AKS, не следует настраивать правила группы безопасности сети вручную. Определите все необходимые порты и пересылку как часть манифестов службы Kubernetes и позвольте платформе Azure создавать или обновлять соответствующие правила.

По умолчанию правила группы безопасности сети существуют для трафика, например, для SSH. Эти правила по умолчанию предназначены для управления кластером и устранения неполадок. Удаление этих правил по умолчанию может вызвать проблемы с управлением AKS и прервать цели уровня обслуживания (SLO).

## <a name="next-steps"></a>Дополнительная информация

Чтобы начать работу с сетью AKS, см. статью [Настройка расширенных параметров сети в Службе Azure Kubernetes (AKS)][aks-configure-advanced-networking].

Дополнительные сведения о ключевых понятиях Kubernetes и AKS см. в следующих статьях:

- [Кластеры и рабочие нагрузки Kubernetes и AKS][aks-concepts-clusters-workloads]
- [Доступ и идентификация в Kubernetes и AKS][aks-concepts-identity]
- [Безопасность Kubernetes и AKS][aks-concepts-security]
- [Хранилище Kubernetes и AKS][aks-concepts-storage]
- [Масштабирование Kubernetes и AKS][aks-concepts-scale]

<!-- IMAGES -->
[aks-clusterip]: ./media/concepts-network/aks-clusterip.png
[aks-nodeport]: ./media/concepts-network/aks-nodeport.png
[aks-loadbalancer]: ./media/concepts-network/aks-loadbalancer.png
[advanced-networking-diagram]: ./media/concepts-network/advanced-networking-diagram.png
[aks-ingress]: ./media/concepts-network/aks-ingress.png

<!-- LINKS - External -->
[cni-networking]: https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md
[kubenet]: https://kubernetes.io/docs/concepts/cluster-administration/network-plugins/#kubenet

<!-- LINKS - Internal -->
[aks-http-routing]: http-application-routing.md
[aks-ingress-tls]: ingress.md
[aks-configure-advanced-networking]: configure-advanced-networking.md
[aks-concepts-clusters-workloads]: concepts-clusters-workloads.md
[aks-concepts-security]: concepts-security.md
[aks-concepts-scale]: concepts-scale.md
[aks-concepts-storage]: concepts-storage.md
[aks-concepts-identity]: concepts-identity.md