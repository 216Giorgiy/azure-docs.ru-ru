<properties urlDisplayName="Get Started with Data (HTML5)" pageTitle="Приступая к работе с данными (HTML 5) | Центр мобильных разработок" metaKeywords="" description="Узнайте, как приступить к работе с мобильными службами, чтобы использовать данные в приложении HTML." metaCanonical="" services="mobile-services" documentationCenter="Mobile" title="Get started with data in Mobile Services" authors="glenga" solutions="" manager="dwrede" editor="" />

<tags ms.service="mobile-services" ms.workload="mobile" ms.tgt_pltfrm="mobile-html" ms.devlang="javascript" ms.topic="article" ms.date="09/24/2014" ms.author="glenga" />

# Добавление мобильных служб к существующему приложению

[WACOM.INCLUDE [mobile-services-selector-get-started-data](../includes/mobile-services-selector-get-started-data.md)]

В этом разделе показано, как с помощью мобильных служб Azure эффективно использовать данные в приложении на HTML. В этом учебнике предстоит загрузить проект для приложения, которое хранит данные в памяти, создать новые услуги мобильной связи, интегрировать мобильную службу с приложением, а затем выполнить вход на портал управления Azure для просмотра изменений, внесенных в данные в ходе выполнения приложения.

>[WACOM.NOTE]Этот учебник поможет вам лучше понять, как с помощью мобильных служб можно использовать Azure для хранения и извлечения данных из приложения на HTML. В этом разделе рассматриваются многие действия, которые выполняются в кратком руководстве по использованию мобильных служб. Если это ваш первый опыт работы с мобильными службами, сначала ознакомьтесь с учебником <a href="/ru-ru/develop/mobile/tutorials/get-started-html">Приступая к работе с мобильными службами</a>.

В этом учебнике рассматриваются следующие основные действия:

1. [Загрузка проекта приложения на HTML]
2. [Создание мобильной службы]
3. [Добавление таблицы для хранения данных]
4. [Обновление приложения для использования мобильных служб]
5. [Тестирование работы приложения с мобильными службами]

<div class="dev-callout"><strong>Примечание.</strong> <p>Для работы с этим учебником требуется учетная запись Azure. Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения можно найти на странице <a href="http://www.windowsazure.com/ru-ru/pricing/free-trial/?WT.mc_id=A756A2826&amp;returnurl=http%3A%2F%2Fwww.windowsazure.com%2Fru-ru%2Fdevelop%2Fmobile%2Ftutorials%2Fget-started-with-data-html%2F" target="_blank">Бесплатное пробное использование Azure</a>.</p></div> 

###Дополнительные требования

Приложение GetStartedWithData можно разместить на любом веб-сервере. Тем не менее, для вашего удобства предоставлены скрипты, которые позволяют запускать приложение по адресу http://localhost:8000.
 
+ Чтобы использовать localhost, в этом учебнике требуется наличие одного из следующих веб-серверов, запущенных на локальном компьютере:

	+  **В Windows** - IIS Express. IIS Express устанавливается [программой установки веб-платформы Майкрософт].   
	+  **В MacOS X** - Python, который уже должен быть установлен.
	+  **В Linux** - Python. Необходимо установить [последнюю версию Python]. 
	
	Можно использовать любой веб-сервер для размещения приложения, однако ниже приведены веб-серверы, которые поддерживаются доступными для загрузки сценариями.  

+ Браузер, который поддерживает HTML5.

<h2><a name="download-app"></a>Загрузка проекта GetStartedWithData</h2>

Этот учебник основан на [HTML5-приложении GetStartedWithData]. Пользовательский интерфейс для этого приложения совпадает с интерфейсом приложения, созданного в кратком руководстве по использованию мобильных служб. Отличие заключается в том, что добавленные элементы хранятся локально в памяти. 

1. [Загрузите файлы проекта приложения на HTML][GetStartedWithData app].

2. В редакторе HTML откройте скачанный проект и просмотрите файл app.js.

   	Обратите внимание, что элементы хранятся в памяти в объекте **Array** (**staticItems**). Обновите страницу, после чего данные исчезнут. Они не сохраняются.

3. Запустите один из этих командных файлов во вложенной папке **server**:

	+ **launch-windows** (на компьютере с Windows) 
	+ **launch-mac.command** (на компьютере с Mac OS X)
	+ **launch-linux.sh** (на компьютере с Linux)

	<div class="dev-callout"><b>Примечание.</b>
		<p>На компьютере с операционной системой Windows в ответ на запрос PowerShell на запуск сценария нажмите клавишу R. Веб-браузер может предупредить о том, что не следует запускать этот сценарий, так как он был загружен из Интернета. В этом случае необходимо указать, что браузеру следует продолжить загрузку сценария.</p>
	</div>
	
	Это приведет к запуску веб-сервера на локальном компьютере, где и будет размещено новое приложение.

4. Введите в браузере URL-адрес <a href="http://localhost:8000/" target="_blank">http://localhost:8000/</a> , чтобы запустить приложение.

5. В разделе **Введите новую задачу** введите содержательный текст в приложении, например _Завершить работу с учебником_ in и нажмите кнопку **Добавить**.

   	![][0]  

   	Обратите внимание, что сохраненный текст добавляется в массив **staticItems**, а страница обновляется для отображения нового элемента.

<h2><a name="create-service"></a>Создание мобильной службы на портале управления</h2>

[WACOM.INCLUDE [mobile-services-create-new-service-data](../includes/mobile-services-create-new-service-data.md)]

<h2><a name="add-table"></a>Добавление новой таблицы в мобильную службу</h2>

Чтобы иметь возможность сохранять данные приложения в новой мобильной службе, необходимо сначала создать новую таблицу в соответствующем экземпляре базы данных SQL.

1. В портале управления нажмите **Мобильные службы**, затем нажмите только что созданную мобильную службу.

2. Нажмите вкладку **Данные**, а затем нажмите **+Создать**.

   	![][5]

   	Откроется диалоговое окно **Создание новой таблицы**.

3. В поле **Имя таблицы** введите _TodoItem_, а затем нажмите кнопку "Проверить".

  	![][6]

  	Это создает новую таблицу хранения данных **TodoItem** с установленными по умолчанию разрешениями. Это означает, что любой пользователь, имеющий ключ приложения, который входит в состав приложения, имеет доступ и может изменять данные в таблице.

    <div class="dev-callout"> 
	<b>Примечание.</b> 
	<p>То же имя таблицы используется при быстром запуске мобильных служб. Однако каждая таблица создается в схеме, которая относится к данной мобильной службе. Это необходимо для предотвращения конфликтов данных, когда несколько мобильных служб используют одну и ту же базу данных.</p> 
	</div>

4. Нажмите новую таблицу **TodoItem** и убедитесь, что нет ни одной строки данных.

5. Нажмите вкладку **Столбцы**. Убедитесь, что следующие столбцы по умолчанию автоматически создаются: 
	
	<table border="1" cellpadding="10">
 	<tr>
 	<th>Имя столбца</th>
 	<th>Тип</th>
 	<th>Индекс</th>
 	</tr>
 	<tr>
 	<td>ид</td>
 	<td>string</td>
 	<td>Индексировано</td>
 	</tr>
 	<tr>
 	<td>__createdAt</td>
 	<td>дата</td>
 	<td>Индексировано</td>
 	</tr>
 	<tr>
 	<td>__updatedAt</td>
 	<td>дата</td>
 	<td><font color="transparent">-</font></td>
 	</tr>
 	<tr>
 	<td>__version</td>
 	<td>штамп времени (MSSQL)</td>
 	<td><font color="transparent">-</font></td>
 	</tr> 	
 	</table> 

  	Это минимальные требования для таблицы в мобильных службах. 

    <div class="dev-callout"><b>Примечание.</b>
	<p>Если в вашей мобильной службе появится динамическая схема, новые столбцы будут создаваться автоматически при отправлении объектов JSON в мобильную службу при операции вставки или обновления.</p>
    </div>

6. На вкладке **Настройка** убедитесь, что в списке **Разрешить запросы от имен узлов** в разделе **Общий доступ к ресурсам независимо от источника (CORS)** уже имеется значение localhost. В противном случае введите localhost в поле **Имя узла**, затем щелкните пункт **Сохранить**.

  	![][11]

	<div class="dev-callout"><b>Примечание.</b>
		<p>Если приложение быстрого запуска развертывается на веб-сервере, отличном от localhost, необходимо добавить имя узла веб-сервера в список <strong>Разрешить запросы от имен узлов</strong> . Дополнительные сведения можно найти в статье <a href="http://msdn.microsoft.com/ru-ru/library/windowsazure/dn155871.aspx" target="_blank">Общий доступ к ресурсам независимо от источника</a>.</p>
	</div>

Теперь вы готовы использовать новую мобильную службу как хранилище данных для приложения.

<h2><a name="update-app"></a>Обновление приложения для доступа к данным с помощью мобильной службы</h2>

После настройки мобильной службы вы можете обновить приложение, чтобы хранить элементы в мобильных службах, а не в локальной коллекции. 

3. На портале управления щелкните **Мобильные службы** и выберите только что созданную мобильную службу.

4. Щелкните вкладку **Панель мониторинга** и запишите **URL-адрес** сайта, затем щелкните **Управление ключами** и запишите **Ключ приложения**.

   	![][8]

  	Эти значения потребуются при обращении к мобильной службе из кода приложения.

1. В редакторе веб-страниц откройте файл проекта index.html и добавьте следующую строку в ссылки сценария для страницы:

        <script src='http://ajax.aspnetcdn.com/ajax/mobileservices/MobileServices.Web-1.1.2.min.js'></script>

5. В редакторе откройте файл app.js, раскомментируйте следующий код, который определяет переменную **MobileServiceClient**, и укажите URL-адрес и ключ приложения мобильной службы в конструкторе **MobileServiceClient** в таком порядке:

	    var MobileServiceClient = WindowsAzure.MobileServiceClient,
			client = new MobileServiceClient('AppUrl', 'AppKey'),   		    

  	Код создает экземпляр MobileServiceClient, используемый для доступа к мобильной службе.

6. Закомментируйте следующие строки кода:

		var itemCount = 0;
		var staticItems = [];

	Данные будут храниться в мобильной службе, а не в массиве в памяти.

6. Раскомментируйте следующую строку кода:

        todoItemTable = client.getTable('todoitem');

   	Этот код создает прокси-объект (**todoItemTable**) для базы данных SQL **TodoItem**. 

7. Замените обработчик событий **$('#add-item').submit** таким кодом:

		$('#add-item').submit(function(evt) {
			var textbox = $('#new-item-text'),
				itemText = textbox.val();
			if (itemText !== '') {
				todoItemTable.insert({ text: itemText, complete: false })
					.then(refreshTodoItems);
			}
			textbox.val('').focus();
			evt.preventDefault();
		});


  	Этот код вставляет новый элемент в таблицу.

8. Замените метод **refreshTodoItems** таким кодом:

		function refreshTodoItems() {

			var query = todoItemTable;

			query.read().then(function(todoItems) {
				listItems = $.map(todoItems, function(item) {
					return $('<li>')
						.attr('data-todoitem-id', item.id)
						.append($('<button class="item-delete">Delete</button>'))
						.append($('<input type="checkbox" class="item-complete">').prop('checked', item.complete))
						.append($('<div>').append($('<input class="item-text">').val(item.text)));
				});
					   
				$('#todo-items').empty().append(listItems).toggle(listItems.length > 0);
				$('#summary').html('<strong>' + todoItems.length + '</strong> item(s)');
			});
		}
	   

   Этот код отправляет запрос мобильной службе, который возвращает все элементы. Выполняется итерация по результатам, а данные отображаются на странице. 

9. Замените обработчики событий **$(document.body).on('change', '.item-text')** и **$(document.body).on('change', '.item-complete')** таким кодом:
        
		$(document.body).on('change', '.item-text', function() {
			var newText = $(this).val();
			todoItemTable.update({ id: getTodoItemId(this), text: newText });
		});

		$(document.body).on('change', '.item-complete', function() {
			var isComplete = $(this).prop('checked');
			todoItemTable.update({ id: getTodoItemId(this), complete: isComplete })
				.then(refreshTodoItems);
		});
 
   	Этот код отправляет обновление элемента мобильной службе при изменении текста или установке флажка.

10. Замените обработчик событий **$(document.body).on('click', '.item-delete')** таким кодом:

		$(document.body).on('click', '.item-delete', function () {
			todoItemTable.del({ id: getTodoItemId(this) }).then(refreshTodoItems);
		});

	Этот код отправляет мобильной службе запрос на удаление службы при нажатии кнопки **Delete**.

Теперь, когда приложение обновлено для хранения данных на сервере с использованием мобильных служб, настало время протестировать приложение на работу с мобильными службами.

<h2><a name="test-app"></a>Тестирование работы приложения с новой мобильной службой</h2>

4. Повторно введите в браузере URL-адрес <a href="http://localhost:8000/" target="_blank">http://localhost:8000/</a> , чтобы запустить приложение.

    <div class="dev-callout"><b>Примечание.</b>
	<p>Если требуется перезапустить веб-сервера, повторите действия, описанные в первом разделе.</p>
    </div>

2. Как и ранее, введите текст в поле **Введите новую задачу** и нажмите кнопку **Добавить**. 

   	В результате в мобильную службу будет отправлен новый элемент в качестве вставки.

3. На [Портале управления] щелкните **Мобильные службы**, затем щелкните свою мобильную службу.

4. Откройте вкладку **Данные**, а затем щелкните **Обзор**.

   	![][9]
  
   	Обратите внимание, что таблица **TodoItem** теперь содержит данные со значениями идентификаторов, которые созданы мобильными службами, и в таблицу были автоматически добавлены столбцы, соответствующие классу TodoItem в приложении.

5. В приложении отметьте один из элементов списка, а затем вернитесь на вкладку "Обзор" на портале и нажмите кнопку **Обновить** 

  	Обратите внимание, что значение выполнения изменилось с **false** на **true**.

6. В файле проекта app.js найдите метод **RefreshTodoItems** и замените строку кода, которая определяет переменную query, такой строкой:

   		var query = todoItemTable.where({ complete: false });

7. Снова загрузите страницу и проверьте другой элемент в списке.

   	Обратите внимание, что отмеченный элемент теперь исчез из списка. Каждое обновление ведет к обмену данными с мобильной службой, которая теперь будет возвращать отфильтрованные данные.

Это заключительный шаг учебника **Приступая к работе с данными**.

## <a name="next-steps"> </a>Дальнейшие действия

В этом учебнике показаны основы включения в HTML-приложении возможностей работы с данными в мобильных службах. Далее рассмотрите выполнение одного из следующих учебников, которые основаны на приложении GetStartedWithData, созданном в этом учебнике:

* [Проверка и изменение данных с помощью скриптов]
  <br/>Дополнительные сведения об использовании серверных скриптов в мобильных службах для проверки и изменения данных, отправляемых из приложения.

* [Уточнение запросов c разбиением по страницам]
  <br/>Сведения об использовании разбиения по страницам в запросах для управления объемом данных, обрабатываемым в одном запросе.
 
После ознакомления с работой с данными, узнайте, как проверять подлинность пользователей приложения, изучив один из следующих учебников и статью [Приступая к работе с проверкой подлинности].

<!-- Anchors. -->
[Загрузка проекта приложения на HTML]: #download-app
[Создание мобильной службы]: #create-service
[Добавление таблицы для хранения данных]: #add-table
[Обновление приложения для использования мобильных служб]: #update-app
[Тестирование работы приложения с мобильными службами]: #test-app
[Дальнейшие действия]:#next-steps

<!-- Images. -->
[0]: ./media/mobile-services-html-get-started-data/mobile-quickstart-startup-html.png




[5]: ./media/mobile-services-html-get-started-data/mobile-data-tab-empty.png
[6]: ./media/mobile-services-html-get-started-data/mobile-create-todoitem-table.png

[8]: ./media/mobile-services-html-get-started-data/mobile-dashboard-tab.png
[9]: ./media/mobile-services-html-get-started-data/mobile-todoitem-data-browse.png

[11]: ./media/mobile-services-html-get-started-data/mobile-services-set-cors-localhost.png

<!-- URLs. -->
[Проверка и изменение данных с помощью скриптов]: /ru-ru/develop/mobile/tutorials/validate-modify-and-augment-data-html
[Уточнение запросов c разбиением по страницам]: /ru-ru/develop/mobile/tutorials/add-paging-to-data-html
[Приступая к работе с мобильными службами]: /ru-ru/develop/mobile/tutorials/get-started
[Приступая к работе с проверкой подлинности]: /ru-ru/develop/mobile/tutorials/get-started-with-users-html

[Портал управления Azure]: https://manage.windowsazure.com/
[Портал управления]: https://manage.windowsazure.com/
[Приложение GetStartedWithData]:  http://go.microsoft.com/fwlink/?LinkID=286345

[Справочник принципов использования мобильных служб HTML/JavaScript]: /ru-ru/develop/mobile/how-to-guides/work-with-html-js-client

[Общий доступ к ресурсам независимо от источника]: http://msdn.microsoft.com/ru-ru/library/windowsazure/dn155871.aspx


<!--HONumber=35.2-->
