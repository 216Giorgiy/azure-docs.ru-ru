---
title: Подключение к серверу SFTP с помощью SSH в Azure Logic Apps | Документация Майкрософт
description: Автоматизация задач, которые отслеживают, создают, отправляют и получают файлы для SFTP-сервера, а также управляют ими с помощью SSH и Azure Logic Apps
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.reviewer: divswa, LADocs
ms.topic: article
tags: connectors
ms.date: 01/15/2019
ms.openlocfilehash: 807a99a8cac7326648ff4aa91b9fcdeb35de196a
ms.sourcegitcommit: 97d0dfb25ac23d07179b804719a454f25d1f0d46
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2019
ms.locfileid: "54910189"
---
# <a name="monitor-create-and-manage-sftp-files-by-using-ssh-and-azure-logic-apps"></a>Мониторинг и создание SFTP-файлов, а также управление ими с помощью SSH и Azure Logic Apps

Чтобы автоматизировать задачи мониторинга, создания, отправки и получения файлов на сервере [безопасного протокола передачи файлов (SFTP)](https://www.ssh.com/ssh/sftp/) с помощью протокола [SSH](https://www.ssh.com/ssh/protocol/), создайте и автоматизируйте рабочие процессы интеграции с помощью Azure Logic Apps и соединителя SFTP-SSH. SFTP является сетевым протоколом, которому предоставляется доступ к файлам, передаче файлов и управлению файлами на основе надежного потока данных. Ниже приведены некоторые примеры задач, которые можно автоматизировать: 

* мониторинг добавления или изменения файлов;
* получение, создание, копирование, переименование, перечисление, обновление и удаление файлов;
* создание папок;
* получение содержимого и метаданных файлов;
* извлечение архивов в папки.

По сравнению с [соединителем SFTP](../connectors/connectors-create-api-sftp.md), соединитель SFTP-SSH может считывать или записывать файлы размером до *1 ГБ*, обрабатывая данные по частям размером 50 МБ. Для файлов размером более 1 ГБ в действиях может использоваться [фрагментация сообщений](../logic-apps/logic-apps-handle-large-messages.md). С более существенными различиями можно ознакомиться в разделе [сравнения SFTP-SSH и SFTP](#comparison) далее в этой статье.

Вы можете использовать триггеры, которые отслеживают события сервера SFTP и делают выходные данные доступными для других действий. Вы можете использовать действия для выполнения различных задач на SFTP-сервере. Кроме того, в вашем приложении логики есть другие действия, которые могут использовать выходные данные действий SFTP. Например, если вы регулярно извлекаете файлы с сервера SFTP, то можете отправлять сообщения оповещений об этих файлах и их содержимое с помощью соединителя Outlook Office 365 или Outlook.com.
Если вы не знакомы с приложениями логики, ознакомьтесь со статьей [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md).

<a name="comparison"></a>

## <a name="compare-sftp-ssh-versus-sftp"></a>Сравнение SFTP-SSH и SFTP

Ниже приведены остальные ключевые различия между соединителями SFTP-SSH и SFTP. Соединитель SFTP-SSH имеет следующие возможности:

* Использует библиотеку <a href="https://github.com/sshnet/SSH.NET" target="_blank">**SSH.NET**</a>, которая представляет собой библиотеку Secure Shell (SSH) с открытым исходным кодом и поддерживает .NET. 

  > [!NOTE]
  >
  > Соединитель SFTP-SSH поддерживает *только* эти закрытые ключи, форматы, алгоритмы и отпечатки пальцев:
  > 
  > * **Закрытые форматы ключей**. Ключи RSA (Rivest Shamir Adleman), DSA (алгоритм цифровой подписи) в форматах OpenSSH и ssh.com.
  > * **Алгоритмы шифрования**. DES-EDE3-CBC, DES-EDE3-CFB, DES CBC, AES-128-CBC, AES-192-CBC и AES-256-CBC.
  > * **Отпечаток**. MD5

* Считывает или записывает файлы размером до *1 ГБ* по сравнению с соединителем SFTP, но обрабатывает данные в виде фрагментов по 50 МБ, а не по 1 ГБ. Для файлов размером более 1 ГБ в действиях может использоваться [фрагментация сообщений](../logic-apps/logic-apps-handle-large-messages.md). В настоящее время триггеры не поддерживают фрагментацию.

* Предоставляет действие **Создание папки**, которое создает папку по указанному пути на сервере SFTP.

* Предоставляет действие **Переименование файла**, которое переименовывает файл на сервере SFTP.

* Выполняет кэширование подключения к серверу SFTP *продолжительностью до 1 часа*, что повышает производительность и уменьшает количество попыток подключения к серверу. Чтобы указать длительность этого поведения кэширования, измените свойство <a href="http://man.openbsd.org/sshd_config#ClientAliveInterval" target="_blank">**ClientAliveInterval**</a> в конфигурации SSH на SFTP-сервере. 

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, <a href="https://azure.microsoft.com/free/" target="_blank">зарегистрируйтесь для получения бесплатной учетной записи Azure</a>. 

* Ваши адреса сервера SFTP и учетные данные учетной записи, которые позволяют приложению логики получать доступ к учетной записи SFTP. Вам также необходим доступ к закрытому ключу SSH и паролю закрытого ключа SSH. 

  > [!IMPORTANT]
  >
  > Соединитель SFTP-SSH поддерживает *только* эти закрытые ключи, форматы, алгоритмы и отпечатки пальцев:
  > 
  > * **Закрытые форматы ключей**. Ключи RSA (Rivest Shamir Adleman), DSA (алгоритм цифровой подписи) в форматах OpenSSH и ssh.com.
  > * **Алгоритмы шифрования**. DES-EDE3-CBC, DES-EDE3-CFB, DES CBC, AES-128-CBC, AES-192-CBC и AES-256-CBC.
  > * **Отпечаток**. MD5
  >
  > При создании приложения логики после добавления триггера SFTP-SSH или действия необходимо предоставить сведения о соединении для сервера SFTP. 
  > Если вы используете закрытый ключ SSH, убедитесь, что вы ***скопировали*** ключ из своего файла закрытого ключа SSH, и ***вставьте*** этот ключ в сведения о подключении. ***Не вводите или изменяйте ключ вручную***, это может вызвать сбой подключения. 
  > Дополнительные сведения см. в следующих шагах в этой статье.

* Базовые знания [создания приложений логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

* Приложение логики, из которого необходимо получить доступ к учетной записи SFTP. Чтобы начать работу с триггером SFTP-SSH, [создайте пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). Чтобы использовать действие SFTP-SSH, запустите приложение логики с другим триггером, например триггером **Периодичность**.

## <a name="connect-to-sftp-with-ssh"></a>Подключение к SFTP с помощью SSH

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

1. Войдите на [портал Azure](https://portal.azure.com) и откройте свое приложение логики в конструкторе приложений логики, если оно еще не открыто.

1. Для пустых приложений логики в поле поиска в качестве фильтра введите sftp ssh. В списке триггеров выберите нужный триггер. 

   -или-

   В имеющихся приложениях логики на последнем шаге, в котором необходимо добавить действие, выберите **Новый шаг**. 
   В поле поиска введите sftp ssh в качестве фильтра. 
   В списке действий выберите любое необходимое действие.

   Чтобы добавить действие между шагами, переместите указатель на стрелку между шагами. 
   Выберите появившийся знак "плюс" (**+**), а затем щелкните **Добавить действие**.

1. Укажите необходимые сведения для подключения.

   > [!IMPORTANT] 
   >
   > При вводе закрытого ключа SSH в свойстве **закрытого ключа SSH** выполните следующие дополнительные шаги, которые помогут убедиться, что вы предоставили полное и правильное значение для этого свойства. 
   > Недопустимый ключ вызывает сбой подключения.
   
   Несмотря на то, что можно использовать любой текстовый редактор, ниже приведены примеры шагов, которые показывают, как правильно копировать и вставлять в него ключ. Например, с помощью Notepad.exe.
    
   1. Откройте файл закрытого ключа SSH в текстовом редакторе. 
   В этих шагах Notepad используется в качестве примера.

   1. В меню **Правка** Notepad выберите **Выделить все**.

   1. Выберите **Правка** > **Копировать**.

   1. В триггере SFTP-SSH или действии, которое вы добавили, вставьте *полный* ключ, скопированный в свойство **закрытого ключа SSH**, которое поддерживает несколько строк. 
   ***Обязательно вставьте*** ключ. ***Не вводите и не изменяйте ключ вручную***.

1. Закончив вводить сведения о подключении, выберите **Создать**.

1. Теперь укажите необходимые сведения для выбранного триггера или действия и продолжайте создание рабочего процесса приложения логики.

## <a name="trigger-limits"></a>Ограничения триггера

Триггеры SFTP-SSH работают путем опроса файловой системы SFTP и поиска любого файла, который был изменен со времени последнего опроса. При изменении файлов некоторые средства позволяют сохранить метку времени. В этом случае необходимо отключить эту функцию, чтобы триггер мог работать. Ниже приведены некоторые распространенные параметры:

| Клиент SFTP | Действие | 
|-------------|--------| 
| Winscp | Выберите **Параметры** > **Настройки** > **Перенос** > **Изменить** > **Сохранение метки времени** > **Отключить** |
| FileZilla | Выберите **Перенос** > **Preserve timestamps of transferred files** (Сохранение метки времени перенесенных файлов)  > **Отключить**. | 
||| 

Найдя новый файл, триггер проверяет, записан ли файл полностью, а не частично. Например, во время проверки файлового сервера триггером в файл могут вноситься изменения. Чтобы избежать возврата частично записанного файла, триггер отмечает метку времени для файла с последними изменениями и не возвращает его сразу. Он возвращает его только при повторном опросе сервера. Иногда такое поведение может вызвать задержку, которая удваивает интервал опроса триггера. 

При запросе содержимого файлов триггер извлекает файлы размером не более 50 МБ. Чтобы получить файлы размером более 50 МБ, следуйте приведенному ниже шаблону: 

* Используйте триггер, который возвращает свойства файла, например **При добавлении или изменении файла (только свойства)**.

* Используйте триггер с действием, которое считывает полный файл, например **Получить содержимое файла по пути**, и применяет [фрагментацию сообщений](../logic-apps/logic-apps-handle-large-messages.md).

## <a name="examples"></a>Примеры

<a name="file-added-modified"></a>

### <a name="sftp---ssh-trigger-when-a-file-is-added-or-modified"></a>Триггер SFTP — SSH. When a file is added or modified (При добавлении или изменении файла)

Если на сервере SFTP добавлен или изменен файл, триггер запускает рабочий процесс приложения логики. Например, вы можете добавить условие, которое проверяет содержимое файла и получает его в зависимости от того, соответствует ли содержимое указанному условию. Затем вы можете добавить действие, которое получает содержимое файла и помещает его в папку на сервере SFTP. 

**Пример Enterprise**. Вы можете использовать этот триггер, чтобы отслеживать в папке SFTP новые файлы, представляющие заказы клиентов. Вы также можете использовать действие SFTP **Получить содержимое файла**, чтобы получить содержимое заказа для дальнейшей обработки и хранения в базе данных заказов.

При запросе содержимого файлов триггер извлекает файлы размером не более 50 МБ. Чтобы получить файлы размером более 50 МБ, следуйте приведенному ниже шаблону: 

* Используйте триггер, который возвращает свойства файла, например **При добавлении или изменении файла (только свойства)**.

* Используйте триггер с действием, которое считывает полный файл, например **Получить содержимое файла по пути**, и применяет [фрагментацию сообщений](../logic-apps/logic-apps-handle-large-messages.md).

<a name="get-content"></a>

### <a name="sftp---ssh-action-get-content-using-path"></a>Действие SFTP — SSH. Получение содержимого с помощью пути

Это действие получает содержимое из файла на сервере SFTP. Например, вы можете добавить триггер из предыдущего примера и условие, которому должно соответствовать содержимое файла. Если оно соответствует условию, действие, которое получает содержимое, может выполняться. 

При запросе содержимого файлов триггер извлекает файлы размером не более 50 МБ. Чтобы получить файлы размером более 50 МБ, следуйте приведенному ниже шаблону: 

* Используйте триггер, который возвращает свойства файла, например **При добавлении или изменении файла (только свойства)**.

* Используйте триггер с действием, которое считывает полный файл, например **Получить содержимое файла по пути**, и применяет [фрагментацию сообщений](../logic-apps/logic-apps-handle-large-messages.md).

## <a name="connector-reference"></a>Справочник по соединителям

Дополнительные технические сведения о триггерах, действиях и ограничениях, которые приведены в описании OpenAPI соединителя (прежнее название — Swagger), можно найти на [странице справки](/connectors/sftpconnector/) соединителя.

## <a name="get-support"></a>Получение поддержки

* Если у вас возникли вопросы, то посетите [форум Azure Logic Apps](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurelogicapps).
* Отправить идею по поводу возможности или проголосовать за нее вы можете на [сайте отзывов пользователей Logic Apps](https://aka.ms/logicapps-wish).

## <a name="next-steps"></a>Дополнительная информация

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).
