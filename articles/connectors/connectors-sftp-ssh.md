---
title: Подключение к учетной записи SFTP из Azure Logic Apps | Документация Майкрософт
description: Автоматизация задач и рабочих процессов, которые отслеживают, создают, отправляют и получают файлы для SFTP-сервера, а также управляют ими с помощью Azure Logic Apps
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.reviewer: klam, LADocs
ms.topic: article
tags: connectors
ms.date: 09/24/2018
ms.openlocfilehash: 2250c6952aeac7b10dcb1a1a35419941e5cad507
ms.sourcegitcommit: fbdfcac863385daa0c4377b92995ab547c51dd4f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2018
ms.locfileid: "50233214"
---
# <a name="monitor-create-and-manage-sftp-files-by-using-azure-logic-apps-and-sftp-ssh-connector"></a>Мониторинг и создание SFTP-файлов, а также управление ими с помощью Azure Logic Apps и соединителя SFTP-SSH

С помощью Azure Logic Apps и соединителя SFTP-SSH можно создать автоматизированные задачи и рабочие процессы, которые отслеживают, создают, отправляют и получают файлы, а также управляют ими в вашей учетной записи на сервере [SFTP](https://www.ssh.com/ssh/sftp/). Они также выполняют и другие действия, например:

* мониторинг добавления или изменения файлов;
* получение, создание, копирование, переименование, перечисление, обновление и удаление файлов;
* создание папки;
* получение содержимого и метаданных файлов;
* извлечение архивов в папки.

Вы можете использовать триггеры, которые получают ответы из сервера SFTP и делают выходные данные доступными для других действий. Вы можете использовать действия в своих приложениях логики для выполнения задач с файлами на сервере SFTP. Кроме того, выходные данные от действий SFTP могут использоваться другими действиями. Например, если вы регулярно извлекаете файлы с сервера SFTP, вы можете отправлять сообщения об этих файлах и их содержимое с помощью соединителя Outlook Office 365 или соединителя Outlook.com.
Если вы не знакомы с приложениями логики, ознакомьтесь со статьей [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md).

## <a name="sftp-ssh-versus-sftp"></a>Сравнение SFTP-SSH и SFTP

Ниже приведены несколько основных различий между соединителями SFTP-SSH и [SFTP](../connectors/connectors-create-api-sftp.md). Соединитель SFTP-SSH предоставляет следующие возможности:

* Использует библиотеку <a href="https://github.com/sshnet/SSH.NET" target="_blank">**SSH.NET**</a>, которая представляет собой библиотеку Secure Shell (SSH) с открытым исходным кодом для .NET.

* Обеспечивает поддержку больших файлов размером до **1 ГБ**. Соединитель может считывать или записывать файлы размером до 1 ГБ.

* Предоставляет действие **Создание папки**, которое создает папку по указанному пути на сервере SFTP.

* Предоставляет действие **Переименование файла**, которое переименовывает файл на сервере SFTP.

* Выполняет кэширование подключения к серверу SFTP, что повышает производительность и уменьшает количество попыток подключения на сервере. 

  Вы можете управлять продолжительностью кеширования подключения, настроив свойство <a href="http://man.openbsd.org/sshd_config#ClientAliveInterval" target="_blank">**ClientAliveInterval**</a> на сервере SFTP. 

## <a name="how-trigger-polling-works"></a>Выполнение опроса триггерами

Триггеры SFTP-SSH работают путем опроса файловой системы SFTP и поиска любого файла, который был изменен со времени последнего опроса. Некоторые инструменты позволяют сохранить метку времени при изменении файлов, поэтому для работы триггера в этих случаях вам необходимо отключить данную функцию. Ниже приведены некоторые распространенные параметры:

| Клиент SFTP | Действие | 
|-------------|--------| 
| Winscp | Options (Параметры) → Preferences… (Предпочтения…) → Transfer (Перенос) → Edit… (Изменить…) → Preserve timestamp (Сохранение метки времени) → Disable (Отключить) |
| FileZilla | Transfer (Перенос) → Preserve timestamps of transferred files (Сохранение метки времени перенесенных файлов) → Disable (Отключить) | 
||| 

Найдя новый файл, триггер проверяет, записан ли файл полностью, а не частично. Например, во время проверки файлового сервера триггером в файл могут вноситься изменения. Чтобы избежать возврата частично записанного файла, триггер отмечает метку времени для файла с последними изменениями и не возвращает его сразу. Он возвращает его только при повторном опросе сервера. Иногда такое поведение может вызвать задержку, которая удваивает интервал опроса триггера. 

При запросе содержимого файлов триггер извлекает файлы размером не более 50 МБ. Чтобы извлечь файлы размером более 50 МБ, следуйте приведенному ниже шаблону:

* Используйте триггер, который возвращает свойства файла, например **При добавлении или изменении файла (только свойства)**. 
* Используйте триггер с действием, которое считывает полный файл, например **Получить содержимое файла по пути**.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, <a href="https://azure.microsoft.com/free/" target="_blank">зарегистрируйтесь для получения бесплатной учетной записи Azure</a>. 

* Ваши адреса сервера узла SFTP и учетные данные учетной записи авторизуют приложения логики, чтобы оно могло создать подключение и получить доступ к вашей учетной записи SFTP.

  Скопируйте и вставьте полное содержимое закрытого ключа SSH в свойство **Закрытый ключ SSH** в многострочном формате. 
  Ниже приведены примеры шагов, в которых показано, как предоставить закрытый ключ SSH с помощью Notepad.exe:
    
  1. Откройте файл закрытого ключа SSH в Notepad.exe.
  2. В меню **Правка** выберите **Выделить все**.
  3. Выберите **Правка** > **Копировать**.
  4. При создании подключения в свойстве **Закрытый ключ SSH** вставьте ключ. Не изменяйте свойство **Закрытый ключ SSH** вручную.

     Соединитель использует библиотеку SSH.NET, которая поддерживает эти форматы закрытого ключа SSH и только отпечаток MD5:

     * RSA 
     * DSA

* Базовые знания [создания приложений логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

* Приложение логики, из которого необходимо получить доступ к учетной записи SFTP. Чтобы начать работу с триггером SFTP, [создайте пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). Чтобы использовать действие SFTP, запустите приложение логики с другим триггером, например триггером **Периодичность**.

## <a name="connect-to-sftp"></a>Подключение к SFTP

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

1. Войдите на [портал Azure](https://portal.azure.com) и откройте свое приложение логики в конструкторе приложений логики, если оно еще не открыто.

1. Для пустых приложений логики в поле поиска в качестве фильтра введите sftp. В списке триггеров выберите нужный триггер. 

   -или-

   В имеющихся приложениях логики на последнем шаге, в котором необходимо добавить действие, выберите **Новый шаг**. 
   В поле поиска введите слово sftp в качестве фильтра. 
   В списке действий выберите любое необходимое действие.

   Чтобы добавить действие между шагами, переместите указатель на стрелку между шагами. 
   Выберите появившийся знак "плюс" (**+**), а затем щелкните **Добавить действие**.

1. Укажите необходимые сведения для вашего подключения, а затем выберите **Создать**.

1. Укажите необходимые сведения для выбранного триггера или действия и продолжайте создание рабочего процесса приложения логики.

## <a name="examples"></a>Примеры

### <a name="sftp-trigger-when-a-file-is-added-or-modified"></a>Триггер SFTP: When a file is added or modified (При добавлении или изменении файла)

Если этот триггер обнаруживает, что на сервере SFTP добавлен или изменен файл, он запускает рабочий процесс приложения логики. Так, например, вы можете добавить условие, которое проверяет содержимое файла и решает, получать ли его, в зависимости от того, соответствует ли содержимое указанному условию. Наконец, вы можете добавить действие, которое получает содержимое файла и помещает его в папку на сервере SFTP. 

В **контексте предприятия** можно использовать этот триггер, чтобы отслеживать в папке SFTP новые файлы, представляющие заказы клиентов. Также вы можете использовать действие SFTP **Получить содержимое файла**, чтобы получить содержимое заказа для дальнейшей обработки и хранения этого заказа в базе данных заказов.

### <a name="sftp-action-get-content"></a>Действие SFTP: получить содержимое

Это действие получает содержимое из файла на сервере SFTP. Например, вы можете добавить триггер из предыдущего примера и условие, которому должно соответствовать содержимое файла. Если оно соответствует условию, действие, которое получает содержимое, может выполняться. 

## <a name="connector-reference"></a>Справочник по соединителям

Дополнительные технические сведения о триггерах, действиях и ограничениях, которые приведены в описании OpenAPI соединителя (прежнее название — Swagger), можно найти на [странице справки](/connectors/sftpconnector/) соединителя.

## <a name="get-support"></a>Получение поддержки

* Если у вас возникли вопросы, то посетите [форум Azure Logic Apps](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurelogicapps).
* Отправить идею по поводу возможности или проголосовать за нее вы можете на [сайте отзывов пользователей Logic Apps](https://aka.ms/logicapps-wish).

## <a name="next-steps"></a>Дополнительная информация

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).