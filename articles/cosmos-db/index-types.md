---
title: Типы индексов в Azure Cosmos DB
description: Обзор типов индексов в Azure Cosmos DB
author: rimman
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: rimman
ms.openlocfilehash: 5e7ee7c0bdfd0cff6be182e6d087cc264910e440
ms.sourcegitcommit: 62d3a040280e83946d1a9548f352da83ef852085
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2019
ms.locfileid: "59271566"
---
# <a name="index-types-in-azure-cosmos-db"></a>Типы индексов в Azure Cosmos DB

При настройке политики индексирования для пути можно несколькими способами. Можно указать одно или несколько определений индексирования для каждого пути.

- **Тип данных**: String, Number, Point, Polygon или LineString (может содержать только одну запись для каждого типа данных в пути).

- **Вид индекса**: Диапазон (для проверки равенства, диапазона или запросы ORDER BY) или пространственный индекс (для пространственных запросов).

- **Точность**: Для диапазонного индекса максимальная точность значение-1, являющимся также значением по умолчанию.

## <a name="index-kind"></a>Вид индекса

Azure Cosmos DB поддерживает диапазонного индекса для каждого пути, который можно настроить для типов данных String или Number или оба.

- **Индекс диапазона** поддерживает эффективные запросы равенства, запросы СОЕДИНЕНИЯ, запросы диапазона (с использованием >, <>, =, < =,! =) и запросы ORDER BY. Запросы ORDER BY по умолчанию также требуют максимальной точности индекса (-1). Тип данных может иметь значение String или Number.

- **Пространственный индекс** обеспечивает эффективность выполнения пространственных запросов (запросов нахождения в пределах и расстояния). Тип данных может иметь значение Point, Polygon или LineString. Azure Cosmos DB также поддерживает вид пространственного индекса для каждого пути, который может быть указан для типов данных Point, Polygon и LineString. Значение по указанному пути должно быть действительным фрагментом объекта GeoJSON, например {"type". "Point", "coordinates": [0.0, 10.0]} Azure Cosmos DB поддерживает автоматическое индексирование типов данных Point, Polygon и LineString.

Ниже приведены примеры запросов, которые могут меняться, и Пространственные индексы можно использовать для обслуживания:

| **Вид индекса** | **Описание/вариант использования** |
| ---------- | ---------------- |
| Диапазон      | Диапазонный индекс по /prop/? (или /) позволяет эффективно обрабатывать следующие запросы:<br><br>SELECT FROM collection c WHERE c.prop = "value"<br><br>SELECT FROM collection c WHERE c.prop > 5<br><br>SELECT FROM collection c ORDER BY c.prop<br><br>Диапазонный индекс по/props / [] /? (или / или /props/) позволяет эффективно обрабатывать следующие запросы:<br><br>SELECT tag FROM collection c JOIN tag IN c.props WHERE tag = 5  |
| Пространственный    | Диапазонный индекс по /prop/? (или /) позволяет эффективно обрабатывать следующие запросы:<br><br>ВЫБЕРИТЕ из коллекции c ГДЕ ST_DISTANCE(c.prop, {"type": "Point", "coordinates": [0.0, 10.0]}) < 40<br><br>SELECT FROM collection c WHERE ST_WITHIN(c.prop, {"type": "Point", ... }) --с индексированием точек<br><br>SELECT FROM collection c WHERE ST_WITHIN({"type": "Polygon", ... }, c.prop) --с индексированием многоугольников |

## <a name="default-behavior-of-index-kinds"></a>Стандартное поведение типов индексов

- Если отсутствует диапазонный индекс любой точности, чтобы указать, что для обслуживания запроса может потребоваться проверка, по умолчанию появляется сообщение об ошибке для запросов с операторами диапазона, например >=.

- Запросы диапазона можно выполнять без диапазонного индекса с помощью заголовка **x-ms-documentdb-enable-scans** в REST API или параметра запроса **EnableScanInQuery** с помощью пакета SDK для .NET. Если в запросе есть какие-либо другие фильтры, по которым Azure Cosmos DB может отфильтровать индекс, сообщение об ошибке не появится.

- По умолчанию ошибка возвращается для пространственных запросов в случае отсутствия пространственного индекса или отсутствия фильтров, которые могут быть получены из индекса. Такие запросы могут выполняться как сканирование с помощью **x-ms-documentdb-enable Scans** или **EnableScanInQuery**.

## <a name="index-precision"></a>Точность индекса

> [!NOTE]
> Контейнеры Azure Cosmos поддерживает новый макет индекса, которая больше не требует пользовательской точностью индекса значение максимальной точностью (-1), возникнет. Благодаря этому методу пути всегда индексируются с максимальной точностью. Если указать значение точности на политику индексирования, запросы CRUD в контейнерах, молча игнорирует значение точности и ответ из контейнера содержит только значение максимальной точностью (-1).  Все новые контейнеры Cosmos используют новый макет индекс, по умолчанию.

- Чтобы сделать это компромисс между дополнительными затратами на хранение индекса и производительность запросов можно использовать точность индекса. Для чисел рекомендуется использовать конфигурацию точности по умолчанию-1 (максимум). Так как числа включают 8 байт в JSON, это эквивалентно 8-байтовой конфигурации. Выбор меньшего значения точности, например 1–7, означает, что значения в некоторых диапазонах соответствуют той же записи индекса. Таким образом можно уменьшить место хранения индекса, но выполнение запроса может возникнуть необходимость обработки нескольких элементов. в результате чего потребуется более высокая пропускная способность, т. е. больше единиц запроса.

- Точность индекса практичнее использовать с диапазонами строки. Так как строки могут быть любой длины, выбор точности индекса может повлиять на производительность запросов диапазона строки Это также может повлиять на объем место хранения индекса, который является обязательным. Для индексов диапазона строки можно настроить значения точности 1–100 или -1 (максимум). Если вы хотите выполнить запросы ORDER BY к строковым свойствам, необходимо указать точность -1 для соответствующих путей.

- Пространственные индексы всегда используют точность индекса по умолчанию для всех типов данных (Point, LineString и Polygon), и переопределить ее нельзя.

Azure Cosmos DB возвращает ошибку, если запрос использует предложение ORDER BY, но не имеет диапазонного индекса для запрашиваемого пути с максимальной точностью.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об индексировании в Azure Cosmos DB см. в следующих статьях:

- [Индексирование](index-overview.md)
- [Политика индексации](indexing-policies.md)
- [Пути индекса](index-paths.md)

