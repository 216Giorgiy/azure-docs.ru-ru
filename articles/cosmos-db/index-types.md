---
title: Типы индексов в Azure Cosmos DB
description: Обзор типов индексов в Azure Cosmos DB
author: rimman
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 11/5/2018
ms.author: rimman
ms.openlocfilehash: 50e8e63c9508aa9e81222f242ca330637075e42d
ms.sourcegitcommit: d4f728095cf52b109b3117be9059809c12b69e32
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/10/2019
ms.locfileid: "54199074"
---
# <a name="index-types-in-azure-cosmos-db"></a>Типы индексов в Azure Cosmos DB

Существует несколько параметров настройки политики индексирования для пути. Можно указать одно или несколько определений индексирования для каждого пути.

- **Тип данных**: String, Number, Point, Polygon или LineString (может содержать только одну запись для каждого типа данных в пути).

- **Вид индекса**: хэш-индекс (запросы равенства), диапазонный (запросы равенства, диапазона или ORDER BY) или пространственный (пространственные запросы).

- **Точность**: в хэш-индексе это значение для строк и чисел находится в диапазоне от 1 до 8, а значение по умолчанию равно 3. Для диапазонного индекса значение максимальной точности равно -1. Для строковых или числовых значений оно может находиться в диапазоне от 1 до 100 (максимальная точность).

## <a name="index-kind"></a>Вид индекса

Azure Cosmos DB поддерживает хэш-индексы и диапазонные индексы для каждого пути, который можно настроить для типов данных String или Number либо для обоих типов данных.

- **Хэш-индекс** поддерживает эффективные запросы равенства и запросы JOIN. Для большинства случаев использования хэш-индексов не требуется более высокая точность, чем разрядность по умолчанию, т. е. 3 байта. Тип данных может иметь значение String или Number.

  > [!NOTE]
  > Контейнеры Azure Cosmos поддерживают новый макет индекса, который больше не использует тип хэш-индекс. Если в политике индексирования установить тип хэш-индекс, запросы CRUD в контейнере проигнорируют тип индекса, а ответ из контейнера будет содержать только тип индекса диапазона. Все новые контейнеры Cosmos используют по умолчанию новый макет индекса. 
  
- **Диапазонный индекс** поддерживает эффективные запросы равенства, диапазона (с использованием >, <, >=, <=, !=) и запросы ORDER BY. Запросы ORDER BY по умолчанию также требуют максимальной точности индекса (-1). Тип данных может иметь значение String или Number.

- **Пространственный индекс** обеспечивает эффективность выполнения пространственных запросов (запросов нахождения в пределах и расстояния). Тип данных может иметь значение Point, Polygon или LineString. Azure Cosmos DB также поддерживает вид пространственного индекса для каждого пути, который может быть указан для типов данных Point, Polygon и LineString. Значение по указанному пути должно быть действительным фрагментом объекта GeoJSON, например {"type". "Point", "coordinates": [0.0, 10.0]} Azure Cosmos DB поддерживает автоматическое индексирование типов данных Point, Polygon и LineString.

Ниже приведены примеры запросов, для обработки которых могут использоваться хэш-индексы, диапазонные и пространственные индексы:

| **Вид индекса** | **Описание/вариант использования** |
| ---------- | ---------------- |
| Хэш  | Хэш-индекс по over/prop/? (или /) позволяет эффективно обрабатывать следующие запросы:<br><br>SELECT FROM collection c WHERE c.prop = "value"<br><br>Хэш-индекс по over /props/[]/? (или / или /props/) позволяет эффективно обрабатывать следующие запросы:<br><br>SELECT tag FROM collection c JOIN tag IN c.props WHERE tag = 5  |
| Диапазонный индекс  | Диапазонный индекс по /prop/? (или /) позволяет эффективно обрабатывать следующие запросы:<br><br>SELECT FROM collection c WHERE c.prop = "value"<br><br>SELECT FROM collection c WHERE c.prop > 5<br><br>SELECT FROM collection c ORDER BY c.prop   |
| пространственный индекс     | Диапазонный индекс по /prop/? (или /) позволяет эффективно обрабатывать следующие запросы:<br><br>SELECT FROM collection c<br><br>WHERE ST_DISTANCE(c.prop, {"type": "Point", "coordinates": [0.0, 10.0]}) < 40<br><br>SELECT FROM collection c WHERE ST_WITHIN(c.prop, {"type": "Polygon", ... }) --с индексированием точек<br><br>SELECT FROM collection c WHERE ST_WITHIN({"type": "Point", ... }, c.prop) --с индексированием многоугольников.     |

## <a name="default-behavior-of-index-kinds"></a>Стандартное поведение типов индексов

- Если отсутствует диапазонный индекс любой точности, чтобы указать, что для обслуживания запроса может потребоваться проверка, по умолчанию появляется сообщение об ошибке для запросов с операторами диапазона, например >=.

- Запросы диапазона можно выполнять без диапазонного индекса с помощью заголовка x-ms-documentdb-enable-scan в REST API или параметра запроса EnableScanInQuery с помощью пакета SDK для .NET. Если в запросе есть какие-либо другие фильтры, по которым Azure Cosmos DB может отфильтровать индекс, сообщение об ошибке не появится.

- По умолчанию ошибка возвращается для пространственных запросов в случае отсутствия пространственного индекса или отсутствия фильтров, которые могут быть получены из индекса. Такие запросы могут выполняться как сканирование с помощью заголовка x-ms-documentdb-enable-scan или параметра EnableScanInQuery.

## <a name="index-precision"></a>Точность индекса

- Можно использовать точность индекса для обеспечения компромисса между дополнительными затратами на хранение индекса и производительностью запросов. Для чисел рекомендуется использовать конфигурацию точности по умолчанию (-1, максимальная точность). Так как числа включают 8 байт в JSON, это эквивалентно 8-байтовой конфигурации. Выбор меньшего значения точности, например 1–7, означает, что значения в некоторых диапазонах соответствуют той же записи индекса. Таким образом, можно уменьшить место хранения индекса, но при выполнении запроса может возникнуть необходимость обработки большего количества элементов, в результате чего потребуется более высокая пропускная способность, т. е. больше единиц запроса.

- Точность индекса практичнее использовать с диапазонами строки. Так как строки могут быть любой длины, выбор точности индекса может повлиять на производительность запросов диапазона строки и на объем требуемого для индекса хранилища. Для индексов диапазона строки можно настроить значения точности 1–100 или -1 (максимум). Если вы хотите выполнить запросы ORDER BY к строковым свойствам, необходимо указать точность -1 для соответствующих путей.

- Пространственные индексы всегда используют точность индекса по умолчанию для всех типов данных (Point, LineString и Polygon), и переопределить ее нельзя.

Azure Cosmos DB возвращает ошибку, если запрос использует предложение ORDER BY, но не имеет диапазонного индекса для запрашиваемого пути с максимальной точностью.

> [!NOTE]
> Контейнеры Azure Cosmos поддерживают новый макет индекса, для которого больше не требуется настраиваемая точность индекса, отличная от значения максимальной точности (–1). Благодаря этому методу пути всегда индексируются с максимальной точностью. Если в политике индексирования установить значение точности, запросы CRUD в контейнере проигнорируют это значение, и ответ из контейнера будет содержать только значение максимальной точности (–1).  Все новые контейнеры Cosmos используют по умолчанию новый макет индекса.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения об индексировании в Azure Cosmos DB см. в следующих статьях:

- [Индексирование в Azure Cosmos DB](index-overview.md)
- [Политика индексирования в Azure Cosmos DB](indexing-policies.md)
- [Пути индекса в Azure Cosmos DB](index-paths.md)

