---
title: Политики индексирования в Azure Cosmos DB
description: Сведения об осуществлении индексации в Azure Cosmos DB. Узнайте, как настроить и изменить политику индексирования для автоматического индексирования и повышения производительности.
author: rimman
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: rimman
ms.openlocfilehash: 6998db1679e67f8ac4bf7c81ea9373c66a9618ee
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59278570"
---
# <a name="index-policy-in-azure-cosmos-db"></a>Политика индексирования в Azure Cosmos DB

Вы можете переопределить политику индексирования, указанную по умолчанию для контейнера Azure Cosmos, настроив следующие параметры:

* **Включить или исключить элементы и пути для индексирования.** Можно исключить или включить конкретных элементов в индексе, при вставке или замените элементы в контейнере. Кроме того, можно включать или исключать конкретные пути и (или) свойства для индексирования в контейнерах. Пути можно указывать с подстановочными знаками, например, *.

* **Настройка типов индекса.** В дополнение к диапазон индексированных путей, можно добавить другие типы индексов, такие как пространственных.

* **Настройка режимов индекса.** С помощью политики индексирования для контейнера вы можете настроить различные режимы индексирования, например *Consistent* (Согласованный) или *None* (Нет).

## <a name="indexing-modes"></a>Режимы индексирования

Azure Cosmos DB поддерживает два режима индексирования, которые можно настроить для контейнера Azure Cosmos с помощью политики индексирования:

* **Consistent** (Согласованный). Если настроена политика контейнер Azure Cosmos *Consistent*, запросы в определенном контейнере соответствуют уровню согласованности, указанному для точечных операций чтения (например, высокий, с ограниченным устареванием, сеансовый или итоговую). 

  Индекс обновляется синхронно с обновлением самих элементов. Например, индекс обновляется при операциях insert, replace, update и delete для включенного в него элемента. Согласованное индексирование поддерживает согласованность запросов, воздействуя на производительность записи. Уменьшение пропускной способности записи зависит от «пути включены в индекс» и «уровня согласованности». Режим согласованного индексирования предназначен для обновления индекса со всеми обновлениями и сразу обрабатывать запросы.

* **Нет** — У контейнера с этим режимом индексирования нет связанного индекса. Обычно это применимо для тех случаев, когда база данных Azure Cosmos используется как хранилище пар "ключ-значение", а доступ к элементам осуществляется только по значению идентификатора.

  > [!NOTE]
  > Настройка режима индексирования как *None* имеет побочный эффект — удаляется все существующие индексы. Используйте этот вариант, если во всех режимах доступа вам нужен только идентификатор или ссылка на себя.

Уровни согласованности запросов поддерживаются так же, как для обычных операций чтения. База данных Cosmos Azure возвращает сообщение об ошибке при выполнении запроса контейнера, который содержит *None* режим индексирования. Можно выполнить запросы, как сканирование через явный **x-ms-documentdb-enable Scans** заголовка в REST API или **EnableScanInQuery** параметра запроса с помощью пакета SDK для .NET. Некоторые возможности запросов, например ORDER BY, сейчас не совместимы с **EnableScanInQuery**, так как требуют наличия соответствующего индекса.

## <a name="modifying-the-indexing-policy"></a>Изменение политики индексирования

В Azure Cosmos DB вы можете в любое время обновить политику индексирования для контейнера. Изменение политики индексирования для контейнера Azure Cosmos, может привести к изменению в формы индекса. Такое изменение затрагивает индексируемые пути, их точность, а также модель согласованности самого индекса. Изменение политики индексирования фактически требует преобразования старого индекса в новый.

### <a name="index-transformations"></a>Преобразования индексов

Все преобразования индексов выполняются в сети. Элементы, индексированные по старой политике, эффективно преобразуются согласно новой политике без ущерба доступности для записи или пропускная способность для контейнера. Согласованность чтения и записи операции, выполняемые с помощью REST API, пакетов SDK, или хранимые процедуры и триггеры не затрагивается во время преобразования индекса.

Изменение политики индексирования является асинхронной операцией, и время для завершения операции зависит от количества элементов, подготовленную пропускную способность и размер элементов. Повторная индексация во время выполнения, ваш может не возвращать все соответствующие результаты, если использовать индекс, который вы изменяете запросы и запросы не будут возвращать ошибки и сбои. Повторная индексация во время выполнения, запросы являются согласованными вне зависимости от конфигурации режима индексирования. Когда преобразование индекса завершится, согласованные результаты будут отображаться, как и прежде. Это относится к запросам, выполняемым с помощью любого интерфейса — REST API, пакетов SDK или из хранимых процедур и триггеров. Преобразование индекса выполняется асинхронно в фоновом режиме на репликах с помощью запасных ресурсов, доступных для конкретных реплик.

Все преобразования индексов выполняются на месте. Azure Cosmos DB не поддерживает вторую копию индекса. Это означает, что при преобразовании индекса не требуется дополнительное место на диске в контейнере.

При изменении политики индексирования, изменения применяются для перемещения из старого индекса в новый индекс и в основе конфигураций режима индексирования. чем от других параметров, таких как включенные или исключенные пути, типы индекса и точность.

Если в старой и новой политиках используется режим индексирования **Consistent** (Согласованный), то база данных Azure Cosmos выполняет преобразование индекса в сети. Во время выполнения преобразования нельзя применить другое изменение политики индексирования с согласованным режимом индексирования. При переходе в режим индексирования None (Нет) индекс немедленно удаляется. Переход в режим индексирования None (Нет) удобен, если необходимо отменить выполняемое преобразование и начать "с нуля" с другой политикой индексирования.

## <a name="modifying-the-indexing-policy---examples"></a>Изменение политики индексирования (примеры)

Ниже приведены наиболее распространенные варианты использования, если вы хотите обновить политику индексации.

* Если вы хотите иметь согласованные результаты во время обычной работы, но переход к **None** режим индексирования при массовом импорте данных.

* Если вы хотите применить новые функции индексирования для уже существующих контейнеров Azure Cosmos DB, например геопространственные запросы, для которых необходим пространственный индекс, или запросы ORDER BY и запросы диапазона строки, для которых необходим индекс диапазона строки.

* Если вы хотите вручную выбрать свойства для индексирования и постепенно изменять их в соответствии с характеристиками рабочих нагрузок.

* Если вы хотите настроить точность индексирования для повышения производительности запросов или уменьшения используемого объема хранилища.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об индексировании см. по следующим ссылкам:

* [Общие сведения об индексировании](index-overview.md)
* [Типы индексов](index-types.md)
* [Пути индексов](index-paths.md)
* [Управление политикой индексирования](how-to-manage-indexing-policy.md)
