---
title: Индексирование в Azure Cosmos DB
description: Сведения об осуществлении индексации в Azure Cosmos DB.
author: rimman
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: rimman
ms.openlocfilehash: ecf53251020ce1b639a5bf8da65f5d31ff699db9
ms.sourcegitcommit: c174d408a5522b58160e17a87d2b6ef4482a6694
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2019
ms.locfileid: "59265701"
---
# <a name="indexing-in-azure-cosmos-db---overview"></a>Индексирование в Azure Cosmos DB. Общие сведения

Azure Cosmos DB — это база данных без использования схем, которая позволяет выполнять итерацию приложения, не отвлекаясь на управление схемами или индексами. По умолчанию Azure Cosmos DB автоматически индексирует все элементы в контейнере. И разработчикам не нужно создавать схемы или вторичные индексы.

## <a name="items-as-trees"></a>Элементы в виде деревьев

Проецирование элементы в контейнере в виде документов JSON и представляя их в виде деревьев, Azure Cosmos DB нормализует структуру и значения экземпляров элементов в объединении понятие **динамически закодированный путь структуры** . В этом представлении каждая метка в документ JSON, включая имена свойств и их значения, становится узлом дерева. / / Концевые элементы дерева содержат фактические значения и промежуточные узлы содержат сведения о схеме. На следующем рисунке показано деревья, созданные для двух элементов (1 и 2) в контейнер Azure Cosmos:

![Древовидное представление двух разных элементов, размещенных в контейнере Azure Cosmos](./media/index-overview/indexing-as-tree.png)

Корневой узел псевдо создается в качестве родительской для реальных узлов, соответствующих меток в подчиненном документе JSON. Вложенные структуры данных определяют иерархию этого дерева. На среднем уровне создаются искусственные узлы с числовыми значениями (0, 1 и т. д.) для представления перечислений и индексов массивов.

## <a name="index-paths"></a>Пути индекса

Azure Cosmos DB проецирует элементы в контейнере Azure Cosmos как документов JSON и индекс как деревья. После этого можно настраивать политики для путей в дереве индекса. Для разных путей можно включать и отключать индексирование. Такой подход может обеспечить повышение производительности при записи и понижение требований к хранилищу индексов в тех случаях, когда шаблоны запросов известны заранее. Дополнительные сведения см. в разделе [пути индекса](index-paths.md).

## <a name="indexing-under-the-hood"></a>Индексирование. Как все устроено

База данных Azure Cosmos применяется *Автоматическое индексирование* к данным, где каждый путь в дереве индексируется, если не настроить исключать определенные пути.

База данных Azure Cosmos использует для индексов инвертированную структуру данных, сохраняя сведения о каждом элементе и повышая эффективность их представления для запросов. В дереве индексов — это документ, созданный с помощью объединения всех деревьев, представляющих отдельные элементы в контейнере. В дереве индексов растет со временем, добавляются новые элементы или обновления существующих элементов в контейнере. В отличие от реляционной базы данных индексирования, Azure Cosmos DB не перезапускается индексации с нуля, добавляются новые поля. Новые элементы добавляются в существующую структуру индекса. 

Каждый узел в дереве индексов — это запись индекс, содержащий метки и положение значения, называемые *термин*и идентификаторы элементов, вызывается *учета*. Учет в фигурные скобки (например {1,2}) на рисунке инвертированного индекса соответствующие элементам, такие как *Документ1* и *Document2* , величину указанной меткой. Важное следствие метки схемы и значения экземпляров равномерно является то, что все содержимое упаковывается в больших индексов. Значение экземпляра, которое сохраняется в концевых элементах, никогда не дублируется. Оно может выполнять разные роли в разных элементах с разными метками схемы, но это всегда одно и то же значение. На следующем рисунке показана инвертированный индексирование для двух различных элементов:

![Внутренние механизмы индексирования с использованием инвертированного индекса](./media/index-overview/inverted-index.png)

> [!NOTE]
> Инвертированный индекс очень похож на структуры индексирования, которые используются в поисковых системах в сфере сбора информации. Применение этого метода позволяет Azure Cosmos DB находить в базе данных любой элемент, независимо от структуры его схемы.

Чтобы получить нормализованный путь, индекс кодирует весь прямой путь (от корня к нужному значению) и сведения о типе значения. Путь и значение, кодируются для предоставления различных типов индексирования, такие как диапазон, пространственный и т. д. Кодирование значений выполняется так, чтобы получить уникальные значения или сочетания для набора путей.

## <a name="querying-with-indexes"></a>Выполнение запросов с использованием индексов

Инвертированный индекс позволяет посредством запроса быстро определять документы, соответствующие предикату запроса. Рассматривая схемы и значения экземпляров равномерно с точки зрения путей, Обращенный индекс также представляет собой дерево. Это позволяет сериализовать индекс и результаты в допустимый документ JSON и возвращать его вместе с нужными документами в представлении дерева. Такой метод поддерживает рекурсию по результатам для дополнительных запросов. На следующем рисунке показан пример индексирования для точечного запроса:  

![Пример точечного запроса](./media/index-overview/index-point-query.png)

Для запроса диапазона *GermanTax* — [определяемой пользователем функции](stored-procedures-triggers-udfs.md#udfs) выполняется как часть обработки запросов. Определяемой пользователем функции — функция любого зарегистрированного, JavaScript, которую может предоставить логику программирования, встроенные в запрос. На следующем рисунке показан пример индексирования для запроса в диапазоне:

![Пример запроса в диапазоне](./media/index-overview/index-range-query.png)

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об индексировании вы найдете в следующих статьях.

- [Политика индексирования](index-policy.md)
- [Типы индексов](index-types.md)
- [Пути индексов](index-paths.md)
- [Управление политикой индексирования](how-to-manage-indexing-policy.md)
