---
title: Высокий уровень доступности в Azure Cosmos DB
description: В этой статье описывается, как Azure Cosmos DB обеспечивает высокий уровень доступности
services: cosmos-db
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/15/2018
ms.author: mjbrown
ms.reviewer: sngun
ms.openlocfilehash: 5dc43aa5b98f097bd8bdf927f40b2d3efc878d48
ms.sourcegitcommit: ba4570d778187a975645a45920d1d631139ac36e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2018
ms.locfileid: "51283501"
---
# <a name="high-availability-in-azure-cosmos-db"></a>Высокий уровень доступности в Azure Cosmos DB

Azure Cosmos DB прозрачно реплицирует данные во всех регионах Azure, связанных с вашей учетной записью Cosmos. Cosmos DB реализует несколько уровней избыточности для данных, как показано на рисунке ниже.

![Секционирование ресурсов](./media/high-availability/figure1.png) 

- Данные внутри контейнеров Cosmos горизонтально секционируются.

- Каждая секция в каждом регионе защищена с помощью набора реплик. При этом все записи реплицируются и надежно фиксируются большей частью реплик. Реплики распределены между 10–20 доменами сбоя.

- Все секции реплицируются во всех регионах. Каждый регион содержит все секции данных контейнера Cosmos и может принимать записи и обслуживать операции чтения.  

Если ваша учетная запись Cosmos распределяется между N регионами Azure, будет существовать по крайней мере N x 4 копий всех ваших данных. Помимо обеспечения низкой задержки доступа к вашим данным и масштабирования пропускной способности операций записи и чтения в регионах, связанных с вашей учетной записью Cosmos, также повышает доступность наличие большего количества регионов (более чем N).  

## <a name="slas-for-availability"></a>Соглашения об уровне обслуживания для доступности   

Как глобально распределенная база данных Cosmos DB предоставляет исчерпывающие Соглашения об уровне обслуживания, включающие пропускную способность, задержки на уровне 99-го процентиля, согласованность и высокую доступность. В следующей таблице описаны гарантии в отношении высокой доступности, предоставляемые Cosmos DB для учетных записей в одном и нескольких регионах. Для обеспечения высокой доступности настройте наличие нескольких регионов для записи для учетной записи Cosmos.

|Operation type (Тип операции)  | Один регион |Несколько регионов (один регион записи)|Несколько регионов (несколько регионов записи) |
|---------|---------|---------|-------|
|Запись    | 99,99    |99,99   |99,999|
|Операции чтения     | 99,99    |99,999  |99,999|

> [!NOTE]
> На практике фактическая доступность записи для моделей ограниченного устаревания, сеансов, постоянного префикса и итоговой согласованности значительно выше, чем в опубликованных Соглашениях об уровне обслуживания. Фактическая доступность чтения для всех уровней согласованности значительно выше, чем в опубликованных Соглашениях об уровне обслуживания.

## <a name="regional-outages"></a>Региональные сбои

Региональные сбои случаются нечасто, и Azure Cosmos DB гарантирует, что ваша база данных доступна всегда. Ниже описывается реакция Cosmos DB во время сбоя, в зависимости от конфигурации учетной записи Cosmos. 

- Учетные записи, связанные с несколькими регионами, настроенные на использование нескольких регионов записи, будут сохранять высокую доступность как для операций записи, так и для операций чтения. Региональные отработки отказа происходят мгновенно и не требуют изменений приложения.

- Учетные записи, связанные с несколькими регионами, настроенные на использование одного региона записи, будут сохранять высокую доступность для операций чтения в случае сбоя. Тем не менее для операций записи нужно включить автоматическую отработку отказа в учетной записи Cosmos, чтобы выполнять отработку отказа затронутого региона в другом регионе. Отработка отказа будет выполняться в указанном порядке приоритетов регионов. В конечном счете, когда работа затронутого региона восстанавливается, нереплицированные данные, присутствующие в регионе записи во время сбоя, становятся доступными через веб-канал конфликтов. Приложения могут считать веб-канал конфликтов, устранить конфликты на основе логики приложения и записать обновленные данные обратно в контейнер Cosmos соответствующим образом. После восстановления ранее затронутый регион записи становится автоматически доступным как регион чтения. Вы можете вызвать отработку отказа вручную и вернуть затронутый регион в качестве региона записи. Отработку отказа можно выполнить вручную с помощью [Azure CLI или портала Azure](how-to-manage-database-account.md#enable-manual-failover-for-your-cosmos-account).  

- Учетные записи с несколькими регионами и одним регионом записи будут сохранять высокую доступность для операций чтения и записи при сбое региона чтения. Затронутый регион автоматически отсоединяется от региона записи и помечается как отключенный. Пакеты SDK для Cosmos DB будут перенаправлять вызовы чтения к следующему доступному региону в списке предпочтительных регионов. Если ни один из регионов в списке предпочтительных регионов недоступен, вызовы автоматически будут перенаправлены к текущему региону записи. Для обработки сбоя региона чтения изменения в коде приложения не требуются. В конечном счете, когда работа затронутого региона восстанавливается, ранее затронутый регион чтения автоматически синхронизируется с текущим регионом записи и снова становится доступным для обслуживания операций чтения. Последующие операции чтения перенаправляются в восстановленный регион без каких-либо изменений в коде приложения. Во время отработки отказа и повторного присоединения региона, в котором ранее был сбой, Cosmos DB продолжает соблюдать гарантии согласованности чтения.

- Учетные записи с одним регионом могут потерять доступность в случае регионального сбоя. Рекомендуется настроить по крайней мере два региона (желательно два региона записи) с помощью учетной записи Cosmos для обеспечения постоянной высокой доступности.

## <a name="building-highly-available-applications"></a>Создание высокодоступных приложений

- Чтобы обеспечить высокий уровень доступности операций записи и чтения, настройте учетную запись Cosmos на поддержку по крайней мере двух регионов с несколькими регионами записи. Эта конфигурация обеспечит лучшую доступность, минимальные задержки и масштабируемость для операций чтения и записи, поддерживаемых Соглашениями об уровне обслуживания. Дополнительные сведения см. в статье [Настройка глобального распределения Azure Cosmos DB с помощью API SQL](tutorial-global-distribution-sql-api.md).

- Для учетных записей Cosmos с несколькими регионами, для которых настроен один регион записи, см. раздел [Включение автоматического перехода на другой ресурс вручную для учетной записи Cosmos](how-to-manage-database-account.md#enable-automatic-failover-for-your-cosmos-account). При включенной автоматической отработке отказа в случае регионального сбоя Cosmos DB будет автоматически выполнять отработку отказа вашей учетной записи.  

- Даже если учетная запись Cosmos обеспечивает высокую доступность, из-за структуры приложение может не обеспечивать высокий уровень доступности. Чтобы ваше приложение было полностью высокодоступным, периодически [вызывайте отработку отказа вручную с помощью Azure CLI или портала Azure](how-to-manage-database-account.md#enable-manual-failover-for-your-cosmos-account) как часть тестирования приложений и аварийного восстановления. 

## <a name="next-steps"></a>Дополнительная информация

По следующим ссылкам вы узнаете о масштабировании пропускной способности.

* [Масштабирование пропускной способности](scaling-throughput.md)

* [Достижение компромисса между доступностью и быстродействием для разных уровней согласованности](consistency-levels-tradeoffs.md)

* [Масштабирование пропускной способности в Azure Cosmos DB](scaling-throughput.md)

* [Глобальное распределение (взгляд изнутри)](global-dist-under-the-hood.md)

* [Настраиваемые уровни согласованности данных в Azure Cosmos DB](consistency-levels.md)


