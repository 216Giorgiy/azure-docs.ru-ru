---
title: Типы разрешения конфликтов и политики разрешения в Azure Cosmos DB
description: В этой статье описаны категории конфликтов и политики их устранения в Azure Cosmos DB.
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/26/2018
ms.author: mjbrown
ms.reviewer: sngun
ms.openlocfilehash: 4af3f4c60f186c34d0f5522461ba70c68b59d1ab
ms.sourcegitcommit: 8330a262abaddaafd4acb04016b68486fba5835b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/04/2019
ms.locfileid: "54033899"
---
# <a name="conflict-types-and-resolution-policies"></a>Типы конфликтов и политики их устранения

Конфликты и политики их устранения целесообразно изучать, если ваша учетная запись Azure Cosmos DB настроена на несколько регионов записи.

Если это так, при одновременном обновлении одного и того же элемента средствами записи в разных регионах могут возникнуть конфликты. Конфликты обновления делятся на следующие три типа:

* **Конфликты вставки**. Этот тип конфликта возникает, когда приложение одновременно вставляет из двух или более регионов два или более элемента с одним и тем же уникальным индексом. Например, может возникнуть конфликт со свойством идентификатора. Все операции записи могут изначально успешно выполняться в соответствующих локальных регионах. Однако, исходя из выбранной политики устранения конфликтов, окончательно фиксируется только один элемент с оригинальным идентификатором.

* **Конфликты замены.** Эти конфликты возникают, когда приложение одновременно обновляет один и тот же элемент из двух или более регионов.

* **Конфликты удаления.** Этот тип конфликта может возникать, когда приложение одновременно удаляет элемент из одного региона и обновляет его в других.

## <a name="conflict-resolution-policies"></a>Политик разрешения конфликтов

Azure Cosmos DB предоставляет гибкий механизм на основе политики для устранения конфликтов обновления. Вы можете выбрать одну из политик устранения конфликтов в контейнере Azure Cosmos DB:

- **Приоритет последней записи (LWW)**. При применении этой политики по умолчанию используется свойство метки времени, назначенное системой (на основе протокола синхронизации времени). Если вы используете API SQL Azure Cosmos DB, можно указать любое другое пользовательское числовое свойство, которое будет использоваться для разрешения конфликтов. Пользовательское числовое свойство также называется путем разрешения конфликта. 

  Если во время вставки или замены двух или более элементов возникает конфликт, приоритет получает элемент с более высоким значением пути устранения конфликтов. Если несколько элементов имеют одинаковое числовое значение пути устранения конфликта, то приоритет определяется системой. Гарантируется, что во всех регионах используется та же версия единственного элемента, получившего приоритет. При наличии конфликтов удаления удаленная версия всегда имеет приоритет в конфликтах вставки или замены. Этот результат не зависит от значения пути разрешения конфликтов.

  > [!NOTE]
  > Приоритет последней записи — это политика разрешения конфликтов по умолчанию. Она доступна для учетных записей SQL, таблицы Azure Cosmos DB, MongoDB, Cassandra и Gremlin API.

  Дополнительные сведения см. в разделе с [примерами использования политик устранения конфликтов LWW](how-to-manage-conflicts.md#create-a-last-writer-wins-conflict-resolution-policy).

- **Настраиваемая**. Эта политика разрешения предназначена для определяемой приложением семантики для разрешения конфликтов. Если задать эту политику в контейнере Azure Cosmos DB, необходимо также зарегистрировать слияние хранимой процедуры. Эта процедура вызывается автоматически при обнаружении конфликтов в рамках транзакции базы данных на сервере. Система гарантирует только однократное выполнение слияния в рамках протокола обязательств.  

  Если вы настраиваете свой контейнер с параметром пользовательского разрешения, следует помнить два момента. Если вам не удалось зарегистрировать процедуру слияния в контейнере или процедура вызывает исключение во время выполнения, все конфликты записываются в веб-канал. Приложение должно затем устранить конфликты в веб-канале. Дополнительные сведения см. в разделе с [примерами использования веб-каналов и настраиваемой политики устранения конфликтов](how-to-manage-conflicts.md#create-a-last-writer-wins-conflict-resolution-policy).

  > [!NOTE]
  > Настраиваемая политика устранения конфликтов доступна только для учетных записей API SQL.

## <a name="next-steps"></a>Дополнительная информация

Узнайте, как настроить политики устранения конфликтов. Ознакомьтесь со следующими статьями:

* [Создание политики разрешения конфликтов, реализующей подход "Сохраняются изменения, внесенные последними"](how-to-manage-conflicts.md#create-a-last-writer-wins-conflict-resolution-policy)
* [Создание политики разрешения конфликтов, реализующей подход "Сохраняются изменения, внесенные последними"](how-to-manage-conflicts.md#create-a-last-writer-wins-conflict-resolution-policy)
* [Чтение из веб-канала конфликтов](how-to-manage-conflicts.md#read-from-conflict-feed)
