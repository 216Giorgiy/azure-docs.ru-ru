---
title: Типы разрешения конфликтов и политики разрешения в Azure Cosmos DB
description: В этой статье описаны категории конфликтов и политики их устранения в Azure Cosmos DB.
services: cosmos-db
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/26/2018
ms.author: mjbrown
ms.openlocfilehash: c682b61a39224f2c80db8fe5fa153ea5e5d82922
ms.sourcegitcommit: ada7419db9d03de550fbadf2f2bb2670c95cdb21
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/02/2018
ms.locfileid: "50958576"
---
# <a name="conflict-types-and-resolution-policies"></a>Типы конфликтов и политики их устранения

Конфликты и политики их устранения целесообразно изучать, если ваша учетная запись Cosmos настроена на несколько регионов записи.

Если это так, при одновременном обновлении одного и того же элемента несколькими средствами записи в разных регионах могут возникнуть конфликты. Конфликты обновления делятся на следующие три типа:

1. **Конфликты вставки.** Этот тип конфликта возникает, когда приложение одновременно вставляет из двух или нескольких регионов два или более элемента с одним и тем же уникальным индексом (например свойством ID). В этом случае все записи могут быть изначально выполнены успешно в соответствующих регионах, но на основе выбранной вами политики устранения конфликтов только один элемент будет иметь исходный идентификатор.

1. **Конфликты замены.** Этот тип возникает, когда приложение одновременно обновляет один и тот же элемент из двух или более регионов.

1. **Конфликты удаления.** Этот тип конфликта может возникать, когда приложение одновременно удаляет элемент из одного региона и обновляет его в других.

## <a name="conflict-resolution-policies"></a>Политик разрешения конфликтов

Cosmos DB предоставляет гибкий механизм на основе политики для устранения конфликтов обновления. Можно выбрать одну из описанных ниже политик устранения конфликтов в контейнере Cosmos.

- **Приоритет последней записи (LWW).** При применении этой политики разрешения по умолчанию используется свойство метки времени, назначенное системой (на основе протокола синхронизации времени). Кроме того, при использовании API SQL служба Cosmos DB позволяет задать любое другое пользовательское числовое свойство (путь устранения конфликтов), которое будет использоваться для устранения конфликтов.  

  Если во время вставки или замены двух или более элементов возникает конфликт, приоритет получает элемент с более высоким значением пути устранения конфликтов. Если несколько элементов имеют одинаковое числовое значение пути устранения конфликта, то приоритет определяется системой. Гарантируется, что во всех регионах используется идентичная версия единственного элемента, получившего приоритет. В случае конфликта удаления удаленная версия всегда имеет приоритет перед конфликтами замены или вставки, независимо от значения пути устранения конфликта.

  > [!NOTE]
  > Политика LWW выбрана по умолчанию. Она доступна для API-интерфейсов таблиц, SQL, MongoDB, Cassandra и учетных записей Gremlin API.

  Дополнительные сведения см. в разделе с [примерами использования политик устранения конфликтов LWW](how-to-manage-conflicts.md#create-a-last-writer-wins-conflict-resolution-policy).

- **Настраиваемая.** Эта политика разрешения предназначена для определяемой приложением семантики для разрешения конфликтов. Если вы настраиваете эту политику в контейнере Cosmos, также требуется зарегистрировать хранимую процедуру слияния. Эта процедура вызывается автоматически при обнаружении конфликтов обновления в рамках транзакции базы данных на сервер. Система гарантирует только однократное выполнение слияния в рамках протокола обязательств.  

  Тем не менее, если вы применяете настраиваемый параметр устранения в контейнере, но либо вам не удалось зарегистрировать процедуру слияния в контейнере, либо процедура вызывает исключение во время выполнения, все конфликты записываются в веб-канал. Приложение должно затем устранить конфликты в веб-канале. Дополнительные сведения см. в разделе с [примерами использования веб-каналов и настраиваемой политики устранения конфликтов](how-to-manage-conflicts.md#create-a-last-writer-wins-conflict-resolution-policy).

  > [!NOTE]
  > Настраиваемая политика устранения конфликтов доступна только для учетных записей API SQL.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о том, как настроить политики устранения конфликтов, см. в указанных ниже статьях.

* [Как использовать политику устранения конфликтов "Приоритет последней записи"](how-to-manage-conflicts.md#create-a-last-writer-wins-conflict-resolution-policy)
* [Как использовать настраиваемую политику устранения конфликтов](how-to-manage-conflicts.md#create-a-last-writer-wins-conflict-resolution-policy)
* [Как использовать веб-канал конфликтов](how-to-manage-conflicts.md#read-from-conflict-feed)
