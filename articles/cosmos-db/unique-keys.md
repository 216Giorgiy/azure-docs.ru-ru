---
title: Использование уникальных ключей в Azure Cosmos DB
description: Узнайте, как использовать уникальные ключи в базе данных Azure Cosmos.
author: aliuy
ms.author: andrl
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/30/2018
ms.reviewer: sngun
ms.openlocfilehash: 3a7133d9c092ab8ad8a4bc585e3b0df2b8ca1234
ms.sourcegitcommit: e69fc381852ce8615ee318b5f77ae7c6123a744c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2019
ms.locfileid: "55999272"
---
# <a name="unique-key-constraints-in-azure-cosmos-db"></a>Ограничения для уникальных ключей в Azure Cosmos DB

Уникальные ключи добавляют слой целостности данных в контейнер Azure Cosmos. Политика уникальных ключей создается одновременно с контейнером Azure Cosmos. Уникальные ключи гарантируют уникальность одного или нескольких значений в пределах логической секции. Вы также можете гарантировать уникальность для каждого [ключа секции](partition-data.md). 

После создания контейнера с политикой уникальных ключей в логической секции блокируется создание любых новых или обновленных элементов с дублирующимися значениями согласно ограничениям политики уникальных ключей. Ключ секции в сочетании с уникальным ключом гарантирует уникальность элемента в области контейнера.

Для примера рассмотрим контейнер Azure Cosmos, в котором настроен уникальный ключ с ограничением по адресу электронной почты и ключ секции `CompanyID`. Когда вы настроите уникальный ключ для адреса электронной почты пользователей, каждый элемент будет гарантированно содержать уникальный адрес электронной почты в пределах каждого `CompanyID`. Невозможно создать два элемента с дублирующимся адресом электронной почты и с тем же значением ключа секции. 

Чтобы записи могли содержать одинаковые адреса электронной почты, но не одинаковые сочетания имени, фамилии и адреса электронной почты, добавьте в политику уникальных ключей дополнительные пути. Вы также можете создать уникальный ключ не на основе адреса электронной почты, а на основе комбинации имени, фамилии и электронной почты. Такой ключ называется составным уникальным ключом. В этом случае разрешено каждое уникальное сочетание трех значений в пределах заданного `CompanyID`. 

Например, контейнер может содержать элементы со следующими значениями, в которых каждый элемент соблюдает ограничение уникального ключа.

|CompanyID|Имя|Фамилия|Адрес электронной почты|
|---|---|---|---|
|Contoso|Гэби|Дюперре|gaby@contoso.com |
|Contoso|Гэби|Дюперре|gaby@fabrikam.com|
|Fabrikam|Гэби|Дюперре|gaby@fabrikam.com|
|Fabrikam|Иван|Дюперре|gaby@fabrikam.com|
|Fabrkam|   |Дюперре|gaby@fabraikam.com|
|Fabrkam|   |   |gaby@fabraikam.com|

При попытке вставить новый элемент с сочетанием значений, которое указано в предыдущей таблице, вы получите ошибку. Такая ошибка означает, что ограничение уникального ключа не соблюдается. Вы получите ответное сообщение "Resource with specified ID or name already exists" (Ресурс с указанным идентификатором или именем уже существует) или "Resource with specified ID, name, or unique index already exists" (Ресурс с определенным идентификатором, именем или уникальным индексом уже существует). 

## <a name="define-a-unique-key"></a>Определение уникального ключа

Уникальные ключи можно определить только при создании контейнера Azure Cosmos. Уникальный ключ ограничивается логической секцией. В предыдущем примере, если контейнер секционируется по почтовому индексу, вы получите повторяющиеся элементы в каждой логической секции. При создании уникальных ключей учитывайте следующие аспекты.

* Вы не можете изменить уникальный ключ для имеющегося контейнера. Другими словами, после создания контейнера с политикой уникальных ключей эту политику невозможно изменить.

* Чтобы задать уникальный ключ для уже существующего контейнера, создайте новый контейнер с ограничением уникального ключа. Используйте соответствующее средство миграции данных, чтобы переместить все данные из старого контейнера в новый. Между контейнерами SQL данные следует перемещать с помощью [средства переноса данных](import-data.md). Для контейнеров MongoDB используйте [mongoimport.exe или mongorestore.exe](mongodb-migrate.md) для перемещения данных.

* Политика уникальных ключей может содержать не более 16значений путей. Например, можно указать значения /firstName, /lastName и /address/zipCode. Каждая политика уникальных ключей может иметь не более 10 ограничений уникальных ключей или сочетаний. Суммарная длина путей для каждого ограничения уникального индекса не может превышать 60 байт. В предыдущем примере имя, фамилия и адрес электронной почты в совокупности считаются одним ограничением. Это ограничение использует 3 из 16 допустимых путей.

* Если контейнер содержит политику уникальных ключей, для него немного повышаются затраты единиц запросов на создание, обновление и удаление элементов.

* Разреженные уникальные ключи не поддерживаются. Если для некоторых уникальных путей отсутствуют значения, для них в ограничении уникальности используется значение null. Это означает, что такое ограничение допускает наличие только одного элемента со значением null.

* В именах уникальных ключей учитывается регистр. Например, рассмотрим контейнер с ограничением уникального ключа равным /address/zipcode. Если в данных есть поле с именем ZipCode, Azure Cosmos DB вставляет "null" в качестве уникального ключа, так как "zipcode" не совпадает с "ZipCode". Учет регистра в этой ситуации приводит к тому, что другие записи со значением ZipCode добавлены не будут, ведь новое значение null нарушит требование уникальности ключа.

## <a name="next-steps"></a>Дополнительная информация

* Подробнее о [логических секциях](partition-data.md).
