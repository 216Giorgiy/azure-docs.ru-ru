---
title: Создание искусственного ключа секции в Azure Cosmos DB для равномерного распределения данных и рабочей нагрузки.
description: Сведения об использовании искусственных ключей секций в контейнерах Azure Cosmos
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/30/2018
ms.author: mjbrown
ms.openlocfilehash: 8becfe375f2e887348729cf1d76820fc41156d2a
ms.sourcegitcommit: e69fc381852ce8615ee318b5f77ae7c6123a744c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2019
ms.locfileid: "55997128"
---
# <a name="create-a-synthetic-partition-key"></a>Создание искусственного ключа секции

Мы рекомендуем применять ключи секций со множеством различных значений, таких как сотни или тысячи. Главное — это равномерное распределение данных и рабочей нагрузки по всем элементам, связанным с этими значениями ключа секции. Если такого свойства нет в ваших данных, вы можете создать искусственный ключ секции. В следующих разделах описано несколько основных методов создания искусственного ключа секции для вашего контейнера.

## <a name="concatenate-multiple-properties-of-an-item"></a>Сцепление нескольких свойств элемента

Вы можете создать ключ секции, объединив несколько значений свойств в одно искусственное свойство `partitionKey`. Эти ключи называются искусственными ключами. Рассмотрим следующий пример документа:

```JavaScript
{
"deviceId": "abc-123",
"date": 2018
}
```

Для предыдущего документа одним из вариантов является установка /deviceId или /date в качестве ключа секции. Используйте его, если вы хотите разбить свой контейнер на основе идентификатора устройства или даты. Другой вариант заключается в сцеплении этих двух значений в искусственное свойство `partitionKey`, которое используется в качестве ключа секции.

```JavaScript
{
"deviceId": "abc-123",
"date": 2018,
"partitionKey": "abc-123-2018"
}
```

В реальных условиях база данных может содержать тысячи документов. Поэтому не добавляйте искусственный ключ вручную, а определите логику на стороне клиента для сцепления значений и вставки искусственного ключа в документы.

## <a name="use-a-partition-key-with-a-random-suffix"></a>Использование ключа секции со случайным суффиксом

Другой возможной стратегией равномерного распределения рабочей нагрузки является добавление случайного числа в конце значения ключа секции. При таком распределении элементов вы можете выполнять параллельные операции записи по секциям.

Например, если ключ секции представляет собой дату, вы можете выбрать случайное число между 1 и 400 и добавить его к дате в качестве суффикса. При этом создаются такие значения ключей секции, как 2018-08-09.1, 2018-08-09.2 и так далее до 2018-08-09.400 включительно. Так как вы рандомизируете ключ секции, ежедневные операции записи в контейнере распределяются равномерно по нескольким секциям. Этот метод обеспечивает оптимальный параллелизм и высокую общую пропускную способность.

## <a name="use-a-partition-key-with-precalculated-suffixes"></a>Использование ключа секции с предварительно вычисленными суффиксами 

Стратегия рандомизации может значительно повысить пропускную способность операций записи, но она усложняет считывание определенного элемента. Это вызвано тем, что вам не известно значение суффикса, которое используется при записи элемента. Чтобы упростить считывание отдельных элементов, используйте стратегию предварительного вычисления суффикса. Вместо того чтобы использовать случайное число для распределения элементов между секциями, используйте число, которое вычисляется на основе того, что вы хотите запросить.

Рассмотрим предыдущий пример, где контейнер использует дату в ключе секции. Теперь предположим, что каждому элементу доступен атрибут номера ТС (регистрационный номер транспортного средства). Также предположим, что вы часто выполняете запросы на поиск элементов по номеру ТС (в дополнение к дате). Прежде чем приложение запишет элемент в контейнер, оно может вычислить суффикс хэша на основе номера ТС и добавить его к дате ключа секции. При вычислении может быть сгенерировано число от 1 до 400 с равномерным распределением. Эти результаты аналогичны результатам, полученным методом рандомизации. Значением ключа секции будет дата, сцепленная с вычисленным результатом.

С помощью этой стратегии записи равномерно распределяются по значениям ключа секции и по секциям. Вы можете легко считать определенный элемент и дату, потому что можете вычислить значение ключа секции для определенного регистрационного номера транспортного средства. Преимущество этого метода заключается в том, что вы можете избежать создания одного горячего ключа секции (ключа секции, который принимает всю рабочую нагрузку). 

## <a name="next-steps"></a>Дополнительная информация

Подробнее о концепции разделения вы можете узнать в следующих статьях:

* Подробнее о [логических секциях](partition-data.md).
* Подробнее о [подготовке пропускной способности в контейнерах и базах данных Azure Cosmos](set-throughput.md).
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).
