---
title: Искусственные ключи секций в Azure Cosmos DB
description: Сведения об использовании искусственных ключей секций в контейнерах Azure Cosmos DB
author: markjbrown
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/30/2018
ms.author: mjbrown
ms.openlocfilehash: 37d220a13aec99de94afa3357db1462d11f8662c
ms.sourcegitcommit: 8330a262abaddaafd4acb04016b68486fba5835b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/04/2019
ms.locfileid: "54043374"
---
# <a name="create-a-synthetic-partition-key"></a>Создание искусственного ключа секции

Лучше всего применять ключи секции с множеством различных значений, таких как сотни или тысячи. Главное — это равномерное распределение данных и рабочей нагрузки по всем элементам, связанным с этими значениями ключа секции. Если такое свойство в данных не существует, можно создать искусственный ключ секции. В следующих разделах описано несколько основных методов создания искусственного ключа секции для вашего контейнера.

## <a name="concatenating-multiple-properties-of-an-item"></a>Объединение нескольких свойств элемента

Вы можете создать ключ секции, объединив несколько значений свойств в одно искусственное свойство `partitionKey`. Эти ключи называются искусственными ключами. Рассмотрим следующий пример документа:

```JavaScript
{
"deviceId": "abc-123",
"date": 2018
}
```

Для предыдущего документа одним из вариантов является установка /deviceId или /date в качестве ключа секции, если вы хотите разбить свой контейнер на основе идентификатора устройства или даты. Другой вариант заключается в объединении этих двух значений в синтетическое свойство `partitionKey`, которое используется в качестве ключа секции.

```JavaScript
{
"deviceId": "abc-123",
"date": 2018,
"partitionKey": "abc-123-2018"
}
```

В реальных сценариях в базе данных могут быть тысячи документов, поэтому вместо добавления синтетического ключа вручную следует определить клиентскую логику, чтобы объединить значения и вставить синтетический ключ в документы.

## <a name="using-a-partition-key-with-random-suffix"></a>Использование ключа секции со случайным суффиксом

Другой возможной стратегией равномерного распределения рабочей нагрузки является добавление случайного числа в конце значения ключа секции. Такое распределение элементов позволяет выполнять параллельные операции записи по секциям.

Например, если ключ секции представляет собой дату, вы можете выбрать случайное число между 1 и 400 и добавить его к дате в качестве суффикса. При этом создаются такие значения ключей секции, как 2018-08-09.1, 2018-08-09.2 и так далее до 2018-08-09.400 включительно. Так как вы рандомизируете ключ секции, ежедневные операции записи в контейнере распределяются равномерно по нескольким секциям. Этот метод обеспечивает оптимальный параллелизм и высокую общую пропускную способность.

## <a name="using-a-partition-key-with-pre-calculated-suffixes"></a>Использование ключа секции с предварительно вычисленными суффиксами 

Хотя стратегия рандомизации может значительно повысить пропускную способность записи, трудно считать определенный элемент, так как вам не известно значение суффикса, которое используется при написании элемента. Чтобы упростить чтение отдельных элементов, вы можете использовать стратегию предварительного вычисления суффикса. Вместо того, чтобы использовать случайное число для распределения элементов между секциями, используйте число, которое вычисляется на основе того, что вы хотите запросить.

Рассмотрим предыдущий пример, где контейнер использует дату в ключе секции. Теперь предположим, что в дополнение к дате (если вы часто запускаете запросы на поиск элементов по номеру ТС) каждому элементу доступен атрибут номера ТС (регистрационный номер транспортного средства). Прежде чем приложение запишет элемент в контейнер, оно может вычислить суффикс хэша на основе номера ТС и добавить его к дате ключа секции. При вычислении может быть сгенерировано число от 1 до 400, которое равномерно распределено, как и результаты, полученные методом рандомизации. Значением ключа секции будет дата, объединенная с вычисленным результатом.

С помощью этой стратегии записи равномерно распределяются по значениям ключа секции и по секциям. Вы можете легко прочитать определенный элемент и дату, потому что можете вычислить значение ключа секции для определенного регистрационного номера транспортного средства. Преимущество этого метода заключается в том, что вы можете избежать создания одного горячего ключа секции (ключа секции, который принимает всю рабочую нагрузку). 

## <a name="next-steps"></a>Дополнительная информация

Подробнее о концепции разделения вы можете узнать в следующих статьях:

* Подробнее о [логических разделах](partition-data.md).
* Дополнительные сведения см. в статье [Настройка и получение пропускной способности контейнеров и базы данных Azure Cosmos DB](set-throughput.md).
* Сведения о том, [как подготовить пропускную способность для контейнера Cosmos](how-to-provision-container-throughput.md).
* Сведения о том, [как подготовить пропускную способность для базы данных Cosmos](how-to-provision-database-throughput.md).
