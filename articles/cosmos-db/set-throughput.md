---
title: Подготовка пропускной способности для Azure Cosmos DB
description: Сведения о настройке подготовленной пропускной способности для контейнеров и баз данных Azure Cosmos DB.
author: aliuy
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 10/25/2018
ms.author: andrl
ms.openlocfilehash: 3e992dd8ab24e4e60b81c6565ea4ec3971a9336b
ms.sourcegitcommit: 8330a262abaddaafd4acb04016b68486fba5835b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/04/2019
ms.locfileid: "54036440"
---
# <a name="provision-throughput-on-azure-cosmos-containers-and-databases"></a>Подготовка пропускной способности в контейнерах и базах данных Azure Cosmos

База данных Azure Cosmos представляет собой единицу управления для набора контейнеров. База данных состоит из набора схемонезависимых контейнеров. Контейнер Azure Cosmos — это единица масштабируемости как для пропускной способности, так и для хранения. Контейнер горизонтально разделяется между набором компьютеров в регионе Azure и распределяется по всем регионам Azure, связанным с учетной записью Azure Cosmos.

Azure Cosmos DB позволяет настроить пропускную способность на двух уровнях детализации — **контейнеры Azure Cosmos** и **базы данных Azure Cosmos**.

## <a name="setting-throughput-on-a-container"></a>Настройка пропускной способности в контейнере  

Пропускная способность, подготавливаемая в контейнере Azure Cosmos, резервируется исключительно для контейнера. Контейнер получает подготовленную пропускную способность постоянно. Финансовой гарантией подготовленной пропускной способности в контейнере являются соглашения об уровне обслуживания. Чтобы настроить пропускную способность для контейнера, см. статью о том, [как подготовить пропускную способность в контейнере Azure Cosmos](how-to-provision-container-throughput.md).

Настройка подготавливаемой пропускной способности для контейнера — широко используемый подход. Хотя пропускную способность для контейнера можно гибко масштабировать, подготавливая любой объем пропускной способности (в единицах запроса — RU), нельзя выборочно указать пропускную способность для логических разделов. Когда рабочая нагрузка, выполняемая в логическом разделе, потребляет больше выделенной ему пропускной способности, скорость выполнения операций будет ограничена. При ограничении скорости можно либо увеличить пропускную способность для всего контейнера, либо повторить операцию. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

Если нужно получить гарантированную производительность для определенного контейнера, рекомендуется настроить пропускную способность на уровне контейнера.

Пропускная способность в контейнере Azure Cosmos равномерно распределяется по всем его логическим разделам. Так как один логический раздел контейнера или несколько размещаются в физическом разделе, физические разделы относятся исключительно к данному контейнеру и поддерживают пропускную способность, подготовленную для контейнера. На следующем рисунке показано, как в физическом разделе размещаются один или несколько логических разделов контейнера.

![Физическая секция](./media/set-throughput/resource-partition.png)

## <a name="setting-throughput-on-a-database"></a>Настройка пропускной способности в базе данных

При подготовке пропускной способности в базе данных Azure Cosmos пропускная способность распределяется между всеми контейнерами в базе данных, если не указана подготовленная пропускная способность для определенных контейнеров. Совместное использование пропускной способности базы данных ее контейнерами аналогично размещению базы данных в кластере виртуальных машин. Так как все контейнеры в базе данных совместно используют ресурсы, доступные на компьютере, естественно, что для любого конкретного контейнера нельзя обеспечить прогнозируемую производительность. Чтобы настроить пропускную способность для базы данных, см. статью о [настройке подготовленной пропускной способности в базе данных Azure Cosmos](how-to-provision-database-throughput.md).

Настройка пропускной способности в базе данных Azure Cosmos гарантирует, что подготовленная пропускная способность будет постоянно доступна. Так как все контейнеры в базе данных совместно используют подготовленную пропускную способность, Azure Cosmos DB не предоставляет никаких гарантий относительно прогнозируемой пропускной способности для определенного контейнера в этой базе данных. Часть пропускной способности, которую может получить определенный контейнер, зависит от:

* числа контейнеров;
* выбора ключей разделов для различных контейнеров;
* распределения рабочей нагрузки между различными логическими разделами контейнеров. 

Рекомендуется настроить пропускную способность на уровне базе данных, когда требуется совместно использовать пропускную способность в нескольких контейнерах, но нежелательно выделять ее какому-либо определенному контейнеру. Ниже приведен ряд примеров, когда предпочтительнее подготовить пропускную способность на уровне базы данных.

* Совместное использование пропускной способности базы данных набором контейнеров полезно для мультитенантного приложения. Каждый пользователь может быть представлен отдельным контейнером Azure Cosmos.

* Совместное использование подготовленной пропускной способности базы данных набором контейнеров полезно, если выполняется перенос базы данных NoSQL (например, MongoDB, Cassandra), размещенной в кластере виртуальных машин или на локальных физических серверах, в Azure Cosmos DB. Подготовленную пропускную способность, настроенную в базе данных Azure Cosmos, можно представить как логический эквивалент (но более экономичный и эластичный) вычислительной мощности кластера MongoDB или Cassandra.  

Все контейнеры, создаваемые внутри базы данных с подготовленной пропускной способностью, должны создаваться с помощью ключа секции. В любой отдельно взятый момент времени пропускная способность, выделенная контейнеру в базе данных, распределяется по всем логическим разделам этого контейнера. При наличии контейнеров с общей подготовленной пропускной способностью на уровне базы данных нельзя выборочно применить пропускную способность к конкретному контейнеру или логическому разделу. Если рабочая нагрузка, выполняемая в логическом разделе, потребляет больше пропускной способности, чем выделено определенному логическому разделу, скорость выполнения операций будет ограничена. При ограничении скорости можно либо увеличить пропускную способность для всего контейнера, либо повторить операцию. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

В одном физическом разделе можно разместить несколько логических разделов, совместно использующих пропускную способность, подготовленную для базы данных. В то время как отдельный логический раздел контейнера всегда ограничен физическим разделом, логические разделы L в контейнерах C, совместно использующие подготовленную пропускную способность базы данных, можно сопоставить и разместить в физических разделах R. На следующем рисунке показано, как в физическом разделе можно разместить один логический раздел или несколько, которые относятся к разным контейнерам в базе данных.

![Физическая секция](./media/set-throughput/resource-partition2.png)

## <a name="setting-throughput-on-a-database-and-a-container"></a>Настройка пропускной способности для базы данных и контейнера

Можно объединить две модели, подготовив пропускную способность как для базы данных, так и для контейнера. В следующем примере показано, как подготовить пропускную способность для базы данных Azure Cosmos и контейнера.

* Вы можете создать базу данных Azure Cosmos с именем Z с подготовленной пропускной способностью, составляющей K единиц запросов. 
* Затем создайте в этой базе данных пять контейнеров с именами A, B, C, D и E.
* Можно явно настроить P единиц запросов подготовленной пропускной способности в контейнере B.
* Пропускная способность в объеме K единиц запросов совместно используется четырьмя контейнерами — A, C, D и E. Точный объем пропускной способности, доступный для A, C, D и E, различается, а соглашения об уровне обслуживания для каждого отдельного контейнера не предусмотрены.
* Контейнер B гарантированно будет постоянно получать пропускную способность в P единиц запросов и поддерживается соглашениями об уровне обслуживания.

## <a name="comparison-of-models"></a>Сравнение моделей

|**Квота**  |**Пропускная способность, подготовленная на уровне базы данных**  |**Пропускная способность, подготовленная на уровне контейнера**|
|---------|---------|---------|
|Минимум ЕЗ |400 (после первых четырех контейнеров для каждого дополнительного контейнера требуется не менее 100 ЕЗ/с). |400|
|Минимум ЕЗ на контейнер|100|400|
|Минимум ЕЗ, необходимый для потребления 1 ГБ хранилища|40|40|
|Максимум ЕЗ|Без ограничений, для базы данных|Без ограничений, для контейнера|
|ЕЗ, назначенные/доступные для определенного контейнера|Нет гарантий. Количество ЕЗ, назначаемых тому или иному контейнеру, зависит от таких свойств, как выбор ключей разделов контейнеров, которые совместно используют пропускную способность, распределение рабочей нагрузки, количество контейнеров. |Все ЕЗ, настроенные для контейнера, резервируются исключительно для него.|
|Максимальный размер хранилища для контейнера|Без ограничений|Без ограничений|
|Максимальная пропускная способность на логический раздел контейнера|10 000 ЕЗ|10 000 ЕЗ|
|Максимальная пропускная способность (данные + индекс) на логический раздел контейнера|10 ГБ|10 ГБ|

## <a name="next-steps"></a>Дополнительная информация

* Подробнее о [логических разделах](partition-data.md).
* Сведения о том, [как подготовить пропускную способность для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Сведения о том, [как подготовить пропускную способность для базы данных Azure Cosmos](how-to-provision-database-throughput.md).

