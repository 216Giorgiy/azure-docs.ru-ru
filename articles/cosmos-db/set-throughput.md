---
title: Подготовка пропускной способности в контейнерах и базах данных Azure Cosmos
description: Сведения о настройке подготовленной пропускной способности для контейнеров и баз данных Azure Cosmos.
author: aliuy
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 03/19/2019
ms.author: andrl
ms.openlocfilehash: 8335a235de708227136400f3af8fa7b4d0a52e29
ms.sourcegitcommit: 6da4959d3a1ffcd8a781b709578668471ec6bf1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2019
ms.locfileid: "58520910"
---
# <a name="provision-throughput-on-containers-and-databases"></a>Обеспечение необходимой пропускной способности для контейнеров и баз данных

База данных Azure Cosmos представляет собой единицу управления для набора контейнеров. База данных состоит из набора схемонезависимых контейнеров. Контейнер Azure Cosmos — это единица масштабируемости как для пропускной способности, так и для хранения. Контейнер горизонтально разделяется между набором компьютеров в регионе Azure и распределяется по всем регионам Azure, связанным с учетной записью Azure Cosmos.

В Azure Cosmos DB можно настроить пропускную способность на двух уровнях детализации:
 
- Контейнеры Azure Cosmos
- Базы данных Azure Cosmos

## <a name="set-throughput-on-a-container"></a>Настройка пропускной способности в контейнере  

Пропускная способность, подготавливаемая в контейнере Azure Cosmos, резервируется исключительно для контейнера. Контейнер получает подготовленную пропускную способность постоянно. Финансовой гарантией подготовленной пропускной способности в контейнере являются соглашения об уровне обслуживания. Чтобы настроить пропускную способность для контейнера, см. статью [Подготовка пропускной способности в контейнере Azure Cosmos](how-to-provision-container-throughput.md).

Настройка подготавливаемой пропускной способности для контейнера — широко используемый подход. Вы можете гибко масштабировать пропускную способность для контейнера, подготавливая любой объем пропускной способности с помощью единиц запросов (ЕЗ). Но вы не можете выборочно указать пропускную способность для логических разделов. 

Если рабочая нагрузка, выполняемая в логическом разделе, потребляет больше выделенной ему пропускной способности, скорость выполнения операций будет ограничена. При ограничении скорости можно либо увеличить пропускную способность для всего контейнера, либо повторить операцию. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

Если нужно получить гарантированную производительность для определенного контейнера, мы рекомендуем настроить пропускную способность на уровне контейнера.

Пропускная способность в контейнере Azure Cosmos равномерно распределяется по всем его логическим разделам. Так как один логический раздел контейнера или несколько размещаются в физическом разделе, физические разделы относятся исключительно к данному контейнеру и поддерживают пропускную способность, подготовленную для контейнера. 

На следующем рисунке показано, как в физическом разделе размещаются один или несколько логических разделов контейнера.

![Физическая секция](./media/set-throughput/resource-partition.png)

## <a name="set-throughput-on-a-database"></a>Настройка пропускной способности в базе данных

При подготовке пропускной способности в базе данных Azure Cosmos пропускная способность распределяется между всеми контейнерами в базе данных. Исключением является случай, если вы указали подготовленную пропускную способность в определенных контейнерах. Совместное использование пропускной способности базы данных ее контейнерами аналогично размещению базы данных в кластере виртуальных машин. Так как все контейнеры в базе данных совместно используют ресурсы, доступные на компьютере, естественно, что для любого конкретного контейнера невозможно обеспечить прогнозируемую производительность. Чтобы настроить пропускную способность для базы данных, ознакомьтесь со статьей [Подготовка пропускной способности для базы данных в Azure Cosmos DB](how-to-provision-database-throughput.md).

Настройка пропускной способности в базе данных Azure Cosmos гарантирует, что подготовленная пропускная способность будет постоянно доступна. Так как все контейнеры в базе данных совместно используют подготовленную пропускную способность, Azure Cosmos DB не предоставляет никаких гарантий относительно прогнозируемой пропускной способности для определенного контейнера в этой базе данных. Часть пропускной способности, которую может получить определенный контейнер, зависит от:

* числа контейнеров;
* выбора ключей разделов для различных контейнеров;
* распределения рабочей нагрузки между различными логическими разделами контейнеров. 

Мы рекомендуем настроить пропускную способность на уровне базы данных, когда требуется совместно использовать пропускную способность в нескольких контейнерах, но нежелательно выделять ее какому-либо определенному контейнеру. 

В следующих примерах показано, когда предпочтительнее подготовить пропускную способность на уровне базы данных:

* Совместное использование пропускной способности базы данных набором контейнеров полезно для мультитенантного приложения. Каждый пользователь может быть представлен отдельным контейнером Azure Cosmos.

* Совместное использование подготовленной пропускной способности базы данных набором контейнеров полезно, если выполняется перенос базы данных NoSQL, например MongoDB или Cassandra, размещенной в кластере виртуальных машин или на локальных физических серверах, в Azure Cosmos DB. Подготовленную пропускную способность, настроенную в базе данных Azure Cosmos, можно представить как логический эквивалент (но более экономичный и эластичный) вычислительной мощности кластера MongoDB или Cassandra.  

Все контейнеры, создаваемые внутри базы данных с подготовленной пропускной способностью, должны создаваться с помощью ключа секции. В любой отдельно взятый момент времени пропускная способность, выделенная контейнеру в базе данных, распределяется по всем логическим разделам этого контейнера. При наличии контейнеров с общей подготовленной пропускной способностью на уровне базы данных вы не можете выборочно применить пропускную способность к конкретному контейнеру или логическому разделу. 

Если рабочая нагрузка, выполняемая в логическом разделе, потребляет больше пропускной способности, чем выделено определенному логическому разделу, скорость выполнения операций будет ограничена. При ограничении скорости можно либо увеличить пропускную способность для всего контейнера, либо повторить операцию. Дополнительные сведения о секционировании см. в статье о [логических разделах](partition-data.md).

В одном физическом разделе можно разместить несколько логических разделов, совместно использующих пропускную способность, подготовленную для базы данных. В то время как отдельный логический раздел контейнера всегда ограничен физическим разделом, логические разделы "L" в контейнерах "C", совместно использующие подготовленную пропускную способность базы данных, можно сопоставить и разместить в физических разделах "R". 

На следующем рисунке показано, как в физическом разделе можно разместить один логический раздел или несколько, которые относятся к разным контейнерам в базе данных.

![Физическая секция](./media/set-throughput/resource-partition2.png)

## <a name="set-throughput-on-a-database-and-a-container"></a>Настройка пропускной способности для базы данных и контейнера

Вы можете объединить эти две модели. Допускается подготовка пропускной способности для базы данных и для контейнера. В следующем примере показано, как подготовить пропускную способность для базы данных Azure Cosmos и контейнера.

* Вы можете создать базу данных Azure Cosmos с именем Z с подготовленной пропускной способностью, составляющей K единиц запросов. 
* Затем создайте в этой базе данных пять контейнеров с именами A, B, C, D и E.
* Вы можете явно настроить "P" единиц запросов подготовленной пропускной способности в контейнере под названием B.
* Пропускная способность в объеме K единиц запросов совместно используется четырьмя контейнерами — A, C, D и E. Точный объем пропускной способности, доступный для A, C, D и E, различается. Не существует Соглашения об уровне обслуживания для пропускной способности каждого отдельного контейнера.
* Контейнер под названием B гарантированно будет постоянно получать пропускную способность в P единиц запросов. Он поддерживается Соглашением об уровне обслуживания.

## <a name="update-throughput-on-a-database-or-a-container"></a>Обновление пропускной способности для базы данных или контейнера

После создания контейнера Azure Cosmos или базу данных, можно обновить подготовленной пропускной способности. Нет ограничений на максимальный подготовленной пропускной способности, которые можно настроить для базы данных или контейнера. Минимальная Подготавливаемая пропускная способность зависит от следующих факторов: 

* Максимальный размер данных, которые постоянно хранятся в контейнере
* Максимальная пропускная способность, вы когда-либо подготовить к работе в контейнере
* Максимальное число контейнеров Azure Cosmos, которые нужно создавать в базе данных с использованием общей пропускной способности. 

Можно программно получить минимальное значение пропускной способности контейнера или базу данных с помощью пакетов SDK или просмотра значения на портале Azure. При использовании пакета SDK для .NET, [DocumentClient.ReplaceOfferAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.documents.client.documentclient.replaceofferasync?view=azure-dotnet) метод позволяет масштабировать значение подготовленной пропускной способности. При использовании пакета SDK для Java, [RequestOptions.setOfferThroughput](sql-api-java-samples.md#offer-examples) метод позволяет масштабировать значение подготовленной пропускной способности. 

При использовании пакета SDK для .NET, [DocumentClient.ReadOfferAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.documents.client.documentclient.readofferasync?view=azure-dotnet) метод позволяет получить минимальное значение пропускной способности контейнера или базу данных. 

Вы можете масштабировать подготовленной пропускной способности контейнера или базу данных в любое время. Можно выполнить операцию уменьшения масштаба, по истечении периода простоя 4 часа. Периода бездействия определяется как время периода, когда произошла нет предложений операции замены (в том числе увеличивать и уменьшать) для контейнера или базу данных. 

## <a name="comparison-of-models"></a>Сравнение моделей

|**Квота**  |**Пропускная способность, подготовленная на уровне базы данных**  |**Пропускная способность, подготовленная на уровне контейнера**|
|---------|---------|---------|
|Минимум ЕЗ |400 (после первых четырех контейнеров для каждого дополнительного контейнера требуется не менее 100 ЕЗ/с.) |400|
|Минимум ЕЗ на контейнер|100|400|
|Минимум ЕЗ, необходимый для потребления 1 ГБ хранилища|40|40|
|Максимум ЕЗ|Без ограничений, для базы данных.|Без ограничений, для контейнера.|
|ЕЗ, назначенные или доступные для определенного контейнера|Нет гарантий. ЕЗ, назначенные для заданного контейнера зависят от свойств. Свойствами могут быть выбор ключей разделов контейнеров, совместно использующих пропускную способность, распределение рабочей нагрузки и число контейнеров. |Все ЕЗ, настроенные для контейнера, резервируются исключительно для него.|
|Максимальный размер хранилища для контейнера|Без ограничений.|Без ограничений.|
|Максимальная пропускная способность на логический раздел контейнера|10 000 ЕЗ|10 000 ЕЗ|
|Максимальная пропускная способность (данные + индекс) на логический раздел контейнера|10 ГБ|10 ГБ|

## <a name="next-steps"></a>Дальнейшие действия

* Подробнее о [логических разделах](partition-data.md).
* Подробнее о [подготовке пропускной способности для контейнера Azure Cosmos](how-to-provision-container-throughput.md).
* Подробнее о [подготовке пропускной способности для базы данных Azure Cosmos](how-to-provision-database-throughput.md).

