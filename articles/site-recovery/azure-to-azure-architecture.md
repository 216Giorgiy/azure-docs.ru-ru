---
title: "Архитектура репликации из Azure в Azure с помощью Azure Site Recovery | Документация Майкрософт"
description: "В этой статье представлен обзор архитектуры и компонентов, используемых для репликации виртуальных машин Azure между регионами Azure с использованием службы Azure Site Recovery."
services: site-recovery
author: rayne-wiselman
manager: carmonm
ms.service: site-recovery
ms.topic: article
ms.date: 02/07/2018
ms.author: raynew
ms.custom: mvc
<<<<<<< HEAD
ms.openlocfilehash: 409dd26cc1dfcb1c562d175a43e842b213501d03
ms.sourcegitcommit: b32d6948033e7f85e3362e13347a664c0aaa04c1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/13/2018
=======
ms.openlocfilehash: 126f5c4db355af19a7151a267115127757b17599
ms.sourcegitcommit: fbba5027fa76674b64294f47baef85b669de04b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/24/2018
>>>>>>> a49d9936881e0cbe5bf47e3a75beb9f11929dd22
---
# <a name="azure-to-azure-replication-architecture"></a>Архитектура репликации из Azure в Azure


В этой статье описана архитектура, используемая при репликации, отработке отказа и восстановлении виртуальных машин (VM) Azure между регионами Azure с помощью службы [Azure Site Recovery](site-recovery-overview.md).

>[!NOTE]
>Сейчас репликация виртуальных машин Azure в службе Site Recovery находится на стадии предварительной версии.



## <a name="architectural-components"></a>Компоненты архитектуры

Следующий рисунок дает общее представление о среде виртуальных машин Azure в определенном регионе (в этом примере — в восточной части США). В среде виртуальных машин Azure:
- Приложения могут работать на виртуальных машинах с дисками, распределенными между учетными записями хранения.
- Виртуальные машины могут находится в одной или нескольких подсетях в виртуальной сети.


**Репликация из Azure в Azure**

![customer-environment](./media/concepts-azure-to-azure-architecture/source-environment.png)

## <a name="replication-process"></a>Процесс репликации

### <a name="step-1"></a>Шаг 1

Когда вы включаете репликацию виртуальной машины Azure, в целевом регионе автоматически создаются указанные ниже ресурсы согласно параметрам исходного региона. При необходимости можно настроить параметры целевых ресурсов.

![Включение процесса репликации, шаг 1](./media/concepts-azure-to-azure-architecture/enable-replication-step-1.png)

**Ресурс** | **Дополнительные сведения**
--- | ---
**Целевая группа ресурсов** | Группа ресурсов, в которой реплицированные виртуальные машины будут находится после отработки отказа.
**Целевая виртуальная сеть** | Виртуальная сеть, в которой реплицированные виртуальные машины будут находиться после отработки отказа. Сетевое сопоставление создается между исходными и целевыми виртуальными сетями и наоборот.
**Учетная запись хранения** | Прежде чем изменения в исходных виртуальных машинах будут реплицированы в целевую учетную запись хранения, они отслеживаются и отправляются в учетную запись хранения кэша в исходном расположении. Это сводит к минимуму влияние на рабочие приложения, запущенные на виртуальной машине.
**Целевые учетные записи хранения**  | Учетные записи хранения в целевом расположении, в которые реплицируются данные.
**Целевая группа доступности**  | Группы доступности, в которых реплицированные виртуальные машины будут находиться после отработки отказа.

### <a name="step-2"></a>Шаг 2

После включения репликации служба мобильности расширения Site Recovery автоматически устанавливается на виртуальной машине:

1. Виртуальная машина регистрируется с помощью Site Recovery.

2. Для виртуальной машины настраивается непрерывная репликация. Операции записи данных на дисках виртуальной машины постоянно передаются в учетную запись хранения кэша в исходном расположении.

   ![Включение процесса репликации, шаг 2](./media/concepts-azure-to-azure-architecture/enable-replication-step-2.png)


 Для Site Recovery никогда не требуется входящее подключение к виртуальной машине. Для следующих адресов требуется только исходящее подключение:

 - URL-адреса/IP-адреса службы Site Recovery;
 - URL-адреса/IP-адреса проверки подлинности Office 365;
 - IP-адреса учетных записей хранения кэша.

Если включить согласованность между виртуальными машинами, компьютеры в группе репликации будут обмениваться данными друг с другом через порт 20004. Убедитесь, что нет устройства брандмауэра, которое блокирует внутренний обмен данными между виртуальными машинами через порт 20004.

> [!IMPORTANT]
Если вы хотите, чтобы виртуальные машины Linux входили в группу репликации, нужно вручную открыть исходящий трафик через порт 20004 согласно указаниям для конкретной версии Linux.

### <a name="step-3"></a>Шаг 3.

После начала непрерывной репликации операции записи на диск сразу же переносятся в учетную запись хранения кэша. Site Recovery обрабатывает данные и отправляет их в целевую учетную запись хранения. После обработки данных каждые несколько минут в целевой учетной записи хранения создаются точки восстановления.

## <a name="failover-process"></a>Процесс отработки отказа

При запуске отработки отказа виртуальные машины создаются в целевой группе ресурсов, целевой виртуальной сети, целевой подсети и целевой группе доступности. Во время отработки отказа можно использовать любую точку восстановления.

![Процесс отработки отказа](./media/concepts-azure-to-azure-architecture/failover.png)

## <a name="next-steps"></a>Дополнительная информация

Ознакомьтесь с [кратким руководством по репликации](azure-to-azure-quickstart.md) виртуальных машин Azure в дополнительный регион.
