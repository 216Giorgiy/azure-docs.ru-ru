---
title: Автоматическое обновление службы мобильности в Azure при аварийном восстановлении Azure | Документы Майкрософт
description: Содержит общие сведения об автоматическом обновлении службы мобильности при репликации виртуальных машин Azure с помощью Azure Site Recovery.
services: site-recovery
author: rajani-janaki-ram
manager: rochakm
ms.service: site-recovery
ms.topic: article
ms.date: 11/27/2018
ms.author: rajanaki
ms.openlocfilehash: f31fccd2bf6d0daae03b025b53a41a0fad4ce2ef
ms.sourcegitcommit: 95822822bfe8da01ffb061fe229fbcc3ef7c2c19
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2019
ms.locfileid: "55210137"
---
# <a name="automatic-update-of-the-mobility-service-in-azure-to-azure-replication"></a>Автоматическое обновление службы мобильности в Azure при репликации Azure

Для Azure Site Recovery установлена ежемесячная периодичность выпусков, когда добавляются новые или усовершенствованные функции, а также устраняются известные проблемы. Это означает, что для поддержания службы в актуальном состоянии нужно спланировать развертывание этих исправлений на ежемесячной основе. Во избежание дополнительной нагрузки, связанной с обновлением, пользователи могут разрешить Site Recovery управлять обновлениями компонентов. Как описано в [справочнике по архитектуре](azure-to-azure-architecture.md) Azure для аварийного восстановления Azure, служба мобильности устанавливается на всех виртуальных машинах Azure, для которых включена репликация, при их репликации из одного региона Azure в другой. После включения функции автоматического обновления расширение службы мобильности будет обновляться с каждым новым выпуском. Содержание этого документа:

- Как работает автоматическое обновление?
- Включение автоматических обновлений
- Распространенные проблемы и устранение неполадок
 
## <a name="how-does-automatic-update-work"></a>Как работает автоматическое обновление

Когда вы разрешаете Site Recovery управлять обновлениями, с помощью учетной записи службы автоматизации, создаваемой в одной подписке с хранилищем, развертывается глобальный runbook (используемый службами Azure). Для конкретного хранилища используется одна учетная запись службы автоматизации. Этот runbook проверяет каждую виртуальную машину в хранилище, для которой включено автоматическое обновление, и инициирует обновление расширения службы мобильности при наличии новой версии. Расписание по умолчанию для runbook повторяется ежедневно в 00:00 согласно часовому поясу географического расположения для реплицированной виртуальной машины. При необходимости пользователь также может изменить расписание runbook с помощью учетной записи службы автоматизации. 

> [!NOTE]
> Чтобы включить функцию автоматического обновления, перезагружать виртуальные машины Azure не требуется. Это также не влияет на выполняющуюся репликацию.

> [!NOTE]
> Счет за задания, используемые учетной записью службы автоматизации, выставляется по времени выполнения задания в минутах за месяц. По умолчанию для учетной записи службы автоматизации 500 минут предоставляется бесплатно. Выполнение этого задания занимает от **нескольких секунд до минуты** в день и будет **оплачиваться бесплатными кредитами**.

ВКЛЮЧЕННЫЕ БЕСПЛАТНЫЕ ЕДИНИЦЫ (В МЕСЯЦ)**   ЦЕНА Время выполнения задания    500 минут ₹0,14/мин.

## <a name="enable-automatic-updates"></a>Включение автоматических обновлений

Вы можете разрешить Site Recovery управлять обновлениями одним из следующих способов:

- [В рамках шага включения репликации](#as-part-of-the-enable-replication-step)
- [Переключение параметров обновления для расширения внутри хранилища](#toggle-the-extension-update-settings-inside-the-vault)

### <a name="as-part-of-the-enable-replication-step"></a>В рамках шага включения репликации:

При включении репликации для виртуальной машины [из представления виртуальной машины](azure-to-azure-quickstart.md) или [из хранилища служб восстановления](azure-to-azure-how-to-enable-replication.md) вы можете разрешить Site Recovery управлять обновлениями для расширения Site Recovery или управлять ими вручную.

![enable-replication-auto-update](./media/azure-to-azure-autoupdate/enable-rep.png)

### <a name="toggle-the-extension-update-settings-inside-the-vault"></a>Переключение параметров обновления для расширения внутри хранилища

1. Внутри хранилища выберите **Управление**-> **Site Recovery Infrastructure** (Инфраструктура Site Recovery).
2. В разделе **For Azure virtual Machines**-> **Extension Update Settings** (Для виртуальных машин Azure > Параметры обновления для расширения) щелкните переключатель, чтобы разрешить *ASR управлять обновлениями* или *обновлять ими вручную*. Выберите команду **Сохранить**.

![vault-toggle-auto-update](./media/azure-to-azure-autoupdate/vault-toggle.png)

> [!Important] 
> Если выбрать значение *Allow ASR to manage* (Разрешить управление ASR), оно применяется ко всем виртуальным машинам в соответствующем хранилище.


> [!Note] 
> В обоих случаях вы получите уведомление об учетной записи службы автоматизации, используемой для управления обновлениями. При включении этой функции в первый раз в хранилище создается учетная запись службы автоматизации. При последующих включениях репликации в том же хранилище будет использоваться уже созданная учетная запись.

### <a name="manage-manually"></a>Управление вручную

1. Если доступны новые обновления для мобильной службы, установленной на виртуальных машинах Azure, вы увидите уведомление: "Доступно новое обновление агента репликации сайта восстановления. Щелкните, чтобы установить его."

     ![Окно "Реплицированные элементы"](./media/vmware-azure-install-mobility-service/replicated-item-notif.png)
3. Выберите уведомление, чтобы открыть страницу выбора виртуальной машины.
4. Выберите виртуальные машины, на которых нужно обновить службу Mobility Service, и нажмите кнопку **ОК**.

     ![Список виртуальных машин "Реплицированные элементы"](./media/vmware-azure-install-mobility-service/update-okpng.png)

Для каждой выбранной виртуальной машины будет запущено задание обновления службы Mobility Service.


## <a name="common-issues--troubleshooting"></a>Распространенные проблемы и устранение неполадок

При возникновении проблемы с автоматическими обновлениями вы получите уведомление в разделе "Configuration issues" (Проблемы с конфигурацией) на панели мониторинга хранилища. 

Если вы попытались включить автоматические обновления и произошел сбой, см. сведения об устранении неполадок ниже.

**Ошибка**: "У вас нет разрешений для создания учетной записи запуска от имени Azure (субъекта-службы) и предоставления роли участника субъекту-службе". 
- Рекомендуемое действие: убедитесь, что учетной записи, используемой для входа, назначена роль "Участник", и повторите операцию. Дополнительные сведения о назначении нужных разрешений см. в [этом](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-create-service-principal-portal#required-permissions) документе.
 
После включения автоматических обновлений большинство проблем может быть решено службой Site Recovery, для чего нужно нажать кнопку "**Исправить**".

![repair-button](./media/azure-to-azure-autoupdate/repair.png)

Если кнопка "Исправить" недоступна, ознакомьтесь с сообщением об ошибке, отображаемым под панелью параметров расширения.

 - **Ошибка**: "Учетная запись запуска от имени не имеет разрешений на доступ к ресурсу служб восстановления".

    **Рекомендуемое действие.** Удалите и [повторно создайте учетную запись запуска от имени](https://docs.microsoft.com/azure/automation/automation-create-runas-account) или убедитесь, что приложение Azure Active Directory, которое использует учетную запись запуска от имени службы автоматизации, имеет доступ к ресурсу служб восстановления.

- **Ошибка**: "Учетная запись запуска от имени не найдена". Не был создан или был удален один из следующих объектов: приложение Azure Active Directory, субъект-служба, роль, ресурс сертификата службы автоматизации, ресурс подключения службы автоматизации. Либо не совпадает отпечаток у сертификата и подключения. 

    **Рекомендуемое действие.** Удалите и [повторно создайте учетную запись запуска от имени](https://docs.microsoft.com/azure/automation/automation-create-runas-account).
