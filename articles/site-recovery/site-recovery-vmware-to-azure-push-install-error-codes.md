---
title: "Устранение неполадок при репликации из VMware в Azure с помощью Azure Site Recovery | Документация Майкрософт"
description: "Устранение ошибок при репликации виртуальных машин Azure"
services: site-recovery
documentationcenter: 
author: asgang
manager: srinathv
editor: 
ms.assetid: 
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 08/24/2017
ms.author: asgang
ms.translationtype: HT
ms.sourcegitcommit: 12c20264b14a477643a4bbc1469a8d1c0941c6e6
ms.openlocfilehash: d4d6d273001642ebb8c960333a1c01977e863dbc
ms.contentlocale: ru-ru
ms.lasthandoff: 09/07/2017

---
# <a name="troubleshoot-mobility-service-push-installation-issues"></a>Устранение неполадок с принудительной установкой службы Mobility Service

В этой статье описываются распространенные проблемы, которые могут возникнуть при попытке установить службу Mobility Service Azure Site Recovery на исходном сервере, чтобы включить защиту.

## <a name="error-code-95107-protection-could-not-be-enabled"></a>Не удалось включить защиту (код ошибки 95107)
**Код ошибки** | **Возможные причины** | **Рекомендации по устранению ошибки**
--- | --- | ---
95107 </br>**Сообщение.** При принудительной установке службы Mobility Service на исходный компьютер возникла ошибка с кодом **EP0858**. <br> Для установки службы Mobility Service указаны неверные учетные данные или учетная запись пользователя имеет недостаточно привилегий. | Для установки службы Mobility Service на исходном компьютере указаны неверные учетные данные пользователя. | Убедитесь, что на сервере конфигурации указаны верные учетные данные для исходного компьютера. <br> Чтобы добавить или изменить учетные данные пользователя, перейдите на сервер конфигурации, выберите **Cspsconfigtool** > **Управление учетной записью**. </br> Кроме того, выполните приведенные ниже предварительные требования для успешного выполнения принудительной установки.

## <a name="error-code-95015-protection-could-not-be-enabled"></a>Не удалось включить защиту (код ошибки 95015)
**Код ошибки** | **Возможные причины** | **Рекомендации по устранению ошибки**
--- | --- | ---
95105 </br>**Сообщение.** При принудительной установке службы Mobility Service на исходный компьютер произошла ошибка с кодом **EP0856**. <br> **Общий доступ к файлам и принтерам** запрещен на исходном компьютере, или возникли проблемы с сетевым подключением между сервером процесса и исходным компьютером.| **Общий доступ к файлам и принтерам** не включен. | Разрешите **общий доступ к файлам и принтерам** на исходном компьютере в брандмауэре Windows. На исходном компьютере в **брандмауэре Windows** >  выберите параметр **Разрешить запуск программы или компонента через брандмауэр Windows**, а затем **Общий доступ к файлам и принтерам** для всех профилей. </br> Кроме того, выполните приведенные ниже предварительные требования для успешного выполнения принудительной установки.

## <a name="error-code-95117-protection-could-not-be-enabled"></a>Не удалось включить защиту (код ошибки 95117)
**Код ошибки** | **Возможные причины** | **Рекомендации по устранению ошибки**
--- | --- | ---
95117 </br>**Сообщение.** При принудительной установке службы Mobility Service на исходный компьютер возникла ошибка с кодом **EP0865**. <br> Исходный компьютер не запущен, или возникли проблемы с сетевым подключением между сервером процесса и исходным компьютером. | Проблемы с сетевым подключением между сервером процесса и исходным компьютером. | Проверьте сетевое подключением между сервером процесса и исходным сервером. </br> Кроме того, выполните приведенные ниже предварительные требования для успешного выполнения принудительной установки.

## <a name="error-code-95103-protection-could-not-be-enabled"></a>Не удалось включить защиту (код ошибки 95103)
**Код ошибки** | **Возможные причины** | **Рекомендации по устранению ошибки**
--- | --- | ---
95103 </br>**Сообщение.** При принудительной установке службы Mobility Service на исходный компьютер произошла ошибка с кодом **EP0854**. <br> Использование инструментария управления Windows (WMI) запрещено на исходном компьютере, или возникли проблемы с сетевым подключением между сервером процесса и исходным компьютером.| WMI заблокирован в брандмауэре Windows. | Разрешите использование WMI в брандмауэре Windows. В **брандмауэре Windows**  > выберите параметр **Разрешить запуск программы или компонента через брандмауэр Windows**, а затем **WMI** для всех профилей. </br> Кроме того, выполните приведенные ниже предварительные требования для успешного выполнения принудительной установки.

## <a name="check-push-installation-logs-for-errors"></a>Проверка журналов принудительных установок на наличие ошибок

На сервере конфигурации или процесса перейдите к файлу PushinstallService, расположенному по адресу <Microsoft Azure Site Recovery Install Location>\home\svsystems\pushinstallsvc\, чтобы определить источник проблемы. Выполните указанные ниже действия по устранению неполадок, чтобы решить эту проблему.</br>

![Журналы принудительных установок](./media/site-recovery-protection-common-errors/pushinstalllogs.png)

## <a name="push-installation-prerequisites-for-windows"></a>Предварительные требования для принудительной установки в Windows
### <a name="ensure-that-file-and-printer-sharing-is-enabled"></a>Убедитесь, что включен **общий доступ к файлам и принтерам**
Предоставьте **общий доступ к файлам и принтерам** и **инструментарию управления Windows** на исходном компьютере в брандмауэре Windows. </br>
#### <a name="if-the-source-machine-is-domain-joined-br"></a>Если исходный компьютер присоединен к домену, сделайте следующее: </br>
Настройте параметры брандмауэра с помощью консоли управления групповыми политиками.

1. Войдите в систему компьютера домена Azure Active Directory с помощью учетной записи администратора. Откройте консоль управления групповыми политиками (для запуска GPMC. MSC выберите **Пуск** > **Выполнить**).</br>

2. Если консоль управления групповыми политиками не установлена, см. сведения в статье [Установка GPMC](https://technet.microsoft.com/library/cc725932.aspx). </br>

3. В дереве консоли управления групповыми политиками дважды щелкните **объекты групповой политики** в лесу и домене. Затем перейдите к **политике домена по умолчанию**. </br>

    ![Политика домена по умолчанию](./media/site-recovery-protection-common-errors/gpmc1.png) </br>
</br>
4. Щелкните правой кнопкой мыши **Default Domain Policy** >  (Политика домена по умолчанию), а затем выберите **Изменить**. Откроется окно **редактор "Управление групповыми политиками"**. </br>

    ![Редактор "Управление групповыми политиками"](./media/site-recovery-protection-common-errors/gpmc2.png) </br>
</br>
5. В **редакторе "Управление групповыми политиками"** выберите **Конфигурация компьютера** > **Политики** > **Административные шаблоны** > **Сеть** > **Сетевые подключения** > **Брандмауэр Windows**. </br>

    ![Брандмауэр Windows](./media/site-recovery-protection-common-errors/gpmc3.png) </br>
</br>
6. Для **профиля домена** и **стандартного профиля** включите следующие параметры: </br>

    а. Дважды щелкните **Брандмауэр Windows: разрешить исключение для входящего общего доступа к файлам и принтерам**. Выберите **Включено** и нажмите кнопку **ОК**. </br>

    b. Дважды щелкните исключение **Брандмауэр Windows: разрешить исключение для входящих сообщений удаленного администрирования**. Выберите **Включено** и нажмите кнопку **ОК**. </br>

    ![Профиль домена](./media/site-recovery-protection-common-errors/gpmc4.png) </br>
</br>

#### <a name="if-the-source-machine-isnt-domain-joined-and-part-of-a-workgroup-br"></a>Если исходный компьютер не присоединен к домену и не является частью рабочей группы, выполните указанные ниже действия. </br>
Настройте параметры брандмауэра на удаленном компьютере (для рабочей группы).

1. Перейдите к исходному компьютеру.</br>

2. В **брандмауэре Windows**  > выберите **Разрешить запуск программы или компонента через брандмауэр Windows** и **Общий доступ к файлам и принтерам** для всех профилей. </br>

3. В **брандмауэре Windows**  > выберите параметр **Разрешить запуск программы или компонента через брандмауэр Windows**, а затем **WMI** для всех профилей. </br>

#### <a name="disable-remote-user-account-control"></a>Отключение функции удаленного контроля учетных записей
Отключите функцию контроля учетных записей с помощью раздела реестра для принудительной отправки службы Mobility Service.

1. Выберите **Пуск** > **Выполнить**, введите *regedit*и нажмите клавишу **ВВОД**.

2. Найдите и выберите следующий подраздел реестра: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System

3. Если записи реестра LocalAccountTokenFilterPolicy не существует, сделайте следующее:

    а. В меню **Правка** выберите пункт **Создать**, а затем **значение DWORD**.

    b. Введите *LocalAccountTokenFilterPolicy* и нажмите клавишу **ВВОД**.

    c. Щелкните правой кнопкой мыши **LocalAccountTokenFilterPolicy** и выберите **Изменить**.

    d. В поле данных **Значение** введите *1* и нажмите кнопку **ОК**.

4. Закройте редактор реестра.


## <a name="push-installation-prerequisites-for-linux"></a>Предварительные требования для принудительной установки в Linux

1. Создайте привилегированного пользователя на исходном сервере Linux. (Используйте эту учетную запись только для принудительной установки и обновлений.)</br>

2. Убедитесь, что файл /etc/hosts на исходном сервере Linux содержит записи, которые связывают имя локального узла с IP-адресами всех сетевых адаптеров. </br>

3. Убедитесь, что установлены последние версии пакетов openSSH, сервера openssh и openSSL на исходном сервере Linux. Убедитесь, что SSH-порт 22 включен и работает. </br>

4. Проверьте наличие устаревших записей агентов на исходном сервере, удалите предыдущие версии агентов, а затем перезагрузите сервер. Переустановите агент. </br>

#### <a name="enable-sftp-subsystem-and-password-authentication-in-the-sshdconfig-file"></a>Включение подсистемы SFTP и проверки пароля в файле sshd_config
1. Выполните вход в качестве привилегированного пользователя на исходном сервере. </br>

2. В файле /etc/ssh/sshd_config найдите строку, начинающуюся с "PasswordAuthentication". </br>

3. Раскомментируйте ее и измените значение с No на Yes. </br>

    ![PasswordAuthentication](./media/site-recovery-protection-common-errors/linux1.png)

4. Найдите строку, которая начинается с Subsystem, и раскомментируйте ее. </br>

    ![Subsystem](./media/site-recovery-protection-common-errors/linux2.png)

5. Сохраните изменения и перезапустите службу SSHD. </br>


## <a name="push-installation-checks-on-the-configurationprocess-server"></a>Проверка принудительной установки на сервере конфигурации или сервере процесса
#### <a name="validate-credentials-for-discovery-and-installation"></a>Проверка учетных данных для обнаружения и установки

1. На сервере конфигурации запустите файл Cspsconfigtool.</br>

    ![WMItestConnect5](./media/site-recovery-protection-common-errors/wmitestconnect5.png) </br>

2. Убедитесь, что учетная запись, используемая для защиты, имеет права администратора на исходном компьютере. </br>

#### <a name="check-connectivity-between-the-process-server-and-the-source-server"></a>Проверьте подключение между сервером процесса и исходным сервером
1. Убедитесь, что сервер процесса имеет подключение к Интернету.

2. Проверьте подключение WMI с помощью wbemtest.exe. </br>

    а. На сервере процесса выберите **Пуск** > **Выполнить** >  и введите **wbemtest.exe**. Откроется окно **Тестер инструментария управления Windows**, как показано ниже:</br>

      ![Тестер инструментария WMI](./media/site-recovery-protection-common-errors/wmitestconnect1.png) </br>
   </br>
    b. Нажмите кнопку **Подключить**и введите IP-адрес исходного сервера в поле **Пространство имен**.

    c. Введите **имя пользователя** и **пароль**. (Если исходный компьютер присоединен к домену, укажите имя домена, а также имя пользователя, например *имя_домена\имя_пользователя*. Если исходный компьютер входит в рабочую группу, укажите только имя пользователя.)

    d. Выберите уровень **проверки подлинности** в качестве **конфиденциальности пакетов**. </br>

      ![Конфиденциальность пакетов](./media/site-recovery-protection-common-errors/wmitestconnect2.png) </br>
   </br>
    д. Нажмите кнопку **Подключиться**. Когда в подключении к WMI отображаются указанные данные, должно отобразиться окно **Тестер инструментария управления Windows**, как показано ниже. </br>

      ![Данные тестера инструментария WMI](./media/site-recovery-protection-common-errors/wmitestconnect3.png) </br>
   </br>
      Если подключение к WMI завершилось сбоем, появится сообщение об ошибке. На приведенном ниже снимке экрана показана неудачная попытка, когда **администрирование WMI или удаленное администрирование** не включено в приложении, разрешенном брандмауэром Windows. </br>

    ![Сообщение об ошибке "Тестер инструментария WMI"](./media/site-recovery-protection-common-errors/wmitestconnect4.png) </br>
   </br>

3. Проверьте состояние и подключение WMI.</br>

    а. На сервере конфигурации или обработки выберите **Пуск** > **Выполнить** > **wmimgmt.msc** > **Действия** > **Дополнительные действия** > **Подключение к другому компьютеру** (исходному компьютеру). </br>

    b. Введите учетные данные учетной записи, используемой для защиты и проверки работоспособности подключения. </br>

#### <a name="verify-that-network-shared-folders-of-the-source-machine-are-accessible-from-the-process-server-remotely-by-using-specified-credentials"></a>Убедитесь, что вы можете получить удаленный доступ к общим сетевым папкам исходного компьютера с сервера обработки с помощью указанных учетных данных.

  1. Войдите на компьютер сервера обработки и откройте проводник. В адресной строке введите *"\\\source-machine-ip\C$"*. Нажмите клавишу **ВВОД**. </br>

      ![Проводник](./media/site-recovery-protection-common-errors/fileshare1.png) </br>

  2. Проводник запросит учетные данные. Введите имя пользователя и пароль и нажмите кнопку **ОК**.</br>

      * Если исходный компьютер присоединен к домену, введите имя домена, а также имя пользователя, например *имя_домена\имя_пользователя*.</br>

      * Если исходный компьютер входит в рабочую группу, введите только имя пользователя. </br>

      ![Диалоговое окно "Учетные данные"](./media/site-recovery-protection-common-errors/fileshare2.png) </br>

  3. Если подключение установлено успешно, на сервере процесса можно удаленно просмотреть папки исходного компьютера. </br>

      ![Представление папок](./media/site-recovery-protection-common-errors/fileshare3.png) </br>

> [!NOTE] 
> Если подключение завершилось сбоем, проверьте, соблюдены ли все предварительные требования.
>

Если вы не хотите открывать окно **Инструментарий управления Windows**, можно также установить службу Mobility Service вручную на исходном компьютере.</br> 

Дополнительные сведения см. в разделе [Установка службы Mobility Service вручную с помощью графического пользовательского интерфейса](site-recovery-vmware-to-azure-install-mob-svc.md#install-mobility-service-manually-by-using-the-gui) и в статье [Автоматизация установки Mobility Service с использованием средств развертывания программного обеспечения](site-recovery-install-mobility-service-using-sccm.md). </br>

## <a name="next-steps"></a>Дальнейшие действия
- [Шаг 11. Включение репликации для виртуальных машин VMware, реплицируемых в Azure](vmware-walkthrough-enable-replication.md)

