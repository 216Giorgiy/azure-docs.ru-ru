---
title: "Тестовая отработка отказа в Azure в Site Recovery | Документация Майкрософт"
description: "Azure Site Recovery координирует репликацию, отработку отказа и восстановление виртуальных машин и физических серверов. Узнайте о функции отработки отказа с выполнением переноса в Azure или в дополнительный центр обработки данных."
services: site-recovery
documentationcenter: 
author: prateek9us
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 1/09/2017
ms.author: pratshar
translationtype: Human Translation
ms.sourcegitcommit: f430d81889ecf7f3210358556b99d7d88b0e7a76
ms.openlocfilehash: 8d848385863aeea43dbad3991e7776e399ac3994


---
# <a name="test--failover-to-azure-in-site-recovery"></a>Тестовая отработка отказа в Azure в Site Recovery

В данной статье содержатся сведения и инструкции по тестовой отработке отказа или тренировке аварийного восстановления виртуальных машин и физических серверов, защищенных с помощью Site Recovery, с использованием Azure в качестве сайта восстановления. 

Комментарии или вопросы можно добавить в конце этой статьи или на [форуме по службам восстановления Azure](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).

Тестовая отработка отказа выполняется для проверки стратегии репликации или анализа работы системы аварийного восстановления без потери данных или простоя. Выполнение тестовой отработки отказа никак не влияет на текущую репликацию или рабочую среду. Тестовую отработку отказа можно выполнить на виртуальной машине или в [плане восстановления](site-recovery-create-recovery-plans.md). При запуске тестовой отработки отказа необходимо указать сеть, к которой будут подключаться виртуальные машины. После запуска ход выполнения тестовой отработки отказа можно отслеживать на вкладке **Задания**.  


## <a name="supported-scenarios"></a>Поддерживаемые сценарии использования.
Тестовая отработка отказа поддерживается во всех сценариях развертывания, кроме развертывания [из устаревшего сайта VMware в Azure](site-recovery-vmware-to-azure-classic-legacy.md). Тестовая отработка отказа также не поддерживается, если на виртуальной машине проводилась отработка отказа в Azure.  


## <a name="run-a-test-failover"></a>Запуск тестовой отработки отказа
В этой процедуре описывается, как запустить тестовую отработку отказа для плана восстановления. Также можно выполнить тестовую отработку отказа для одной машины, используя на ней соответствующий вариант отработки. 

1. Выберите **Планы восстановления** > *имя_плана_восстановления*. Щелкните **Тестовая отработка отказа**.
1. Выберите **точку восстановления**, в которую будет выполнена отработка отказа. Можно выбрать один из следующих вариантов:
    1.  **Latest processed** (Последняя обработанная). При этом варианте отработка отказа всех виртуальных машин плана восстановления выполняется до последней точки восстановления, которая уже была обработана службой Site Recovery. При выполнении тестовой отработки отказа виртуальной машины также отображается метка времени последней обработанной точки восстановления. Если выполняется отработка отказа по плану восстановления, то можно перейти к отдельной виртуальной машине и просмотреть элемент **Последняя точка восстановления** для получения этих сведений. Так как на обработку необработанных данных время не тратится, то этот вариант обеспечивает низкий показатель RTO (целевое время восстановления). 
    1.    **Latest app-consistent** (Последняя с согласованием приложений). При этом варианте отработка отказа всех виртуальных машин плана восстановления выполняется до последней точки восстановления с согласованием приложений, которая уже была обработана службой Site Recovery. При выполнении тестовой отработки отказа виртуальной машины также отображается метка времени последней обработанной точки восстановления с согласованием приложений. Если выполняется отработка отказа по плану восстановления, то можно перейти к отдельной виртуальной машине и просмотреть элемент **Последняя точка восстановления** для получения этих сведений. 
    1.    **Latest** (Последняя). При этом варианте сначала обрабатываются все данные, отправленные в службу Site Recovery, чтобы создать точку восстановления для каждой виртуальной машины, прежде чем выполнять в нее отработку отказа. Этот вариант обеспечивает самый низкий показатель RPO (целевая точка восстановления), так как виртуальная машина, созданная после отработки отказа, будет иметь все данные, реплицированные в службу Site Recovery при активации отработки отказа. 
    1.  **Custom** (Настраиваемая). Если выполняется тестовая отработка отказа виртуальной машины, то можно использовать этот вариант для отработки отказа в определенную точку восстановления.
1. Выберите **виртуальную сеть Azure**: укажите виртуальную сеть Azure, в которой будут созданы тестовые виртуальные машины. Служба Site Recovery попытается создать тестовые виртуальные машины в подсети с таким же именем, используя тот же IP-адрес, который был указан в разделе параметров **Вычисления и сеть** виртуальной машины. Если подсеть с таким же именем недоступна в виртуальной сети Azure, предоставленной для тестовой отработки отказа, то тестовая виртуальная машина создается в первой подсети в алфавитном порядке. Если тот же IP-адрес в подсети недоступен, то виртуальная машина получит другой IP-адрес, доступный в подсети. Дополнительные сведения см. в [этом разделе](#creating-a-network-for-test-failover).
1. Если при отработке отказа с выполнением переноса в Azure включена функция шифрования данных, то в разделе **Ключ шифрования** выберите сертификат, который был выпущен, когда во время установки поставщика вы включили функцию шифрования данных. Этот шаг можно пропустить, если вы не включали функцию шифрования на виртуальной машине.
1. Ход выполнения отработки отказа можно отслеживать на вкладке **Задания** . Кроме того, вы можете просмотреть тестовую реплицированную машину на портале Azure.
1. Чтобы инициировать на виртуальной машине подключение по протоколу RDP, необходимо [добавить общедоступный IP-адрес](site-recovery-monitoring-and-troubleshooting.md#adding-a-public-ip-on-a-resource-manager-virtual-machine) в сетевом интерфейсе виртуальной машины, для которой выполнена отработка отказа. Если отработка отказа выполняется на классическую виртуальную машину, то на порте 3389 необходимо [добавить конечную точку](../virtual-machines/virtual-machines-windows-classic-setup-endpoints.md).
1. Когда все будет готово, нажмите кнопку **Cleanup test failover** (Очистить тестовую отработку отказа) в плане восстановления. При необходимости в разделе **примечаний** можно записать и сохранить ваши наблюдения касательно тестовой отработки отказа. Это приведет к удалению виртуальных машин, созданных при тестовой отработке отказа. 


> [!TIP]
> Служба Site Recovery попытается создать тестовые виртуальные машины в подсети с таким же именем, используя тот же IP-адрес, который был указан в разделе параметров **Вычисления и сеть** виртуальной машины. Если подсеть с таким же именем недоступна в виртуальной сети Azure, предоставленной для тестовой отработки отказа, то тестовая виртуальная машина создается в первой подсети в алфавитном порядке. Если тот же IP-адрес в подсети недоступен, то виртуальная машина получит другой IP-адрес, доступный в подсети. 
>
> 


## <a name="creating-a-network-for-test-failover"></a>Создание сети для тестовой отработки отказа 
При выполнении тестовой отработки отказа рекомендуется выбрать сеть, которая изолирована от рабочей сети сайта восстановления, указанной в разделе параметров **Вычисления и сеть** виртуальной машины. При создании виртуальной сети Azure она по умолчанию изолируется от других сетей. Эта сеть должна имитировать рабочую сеть:

1. Тестовая сеть должна иметь такое же число подсетей, как и рабочая сеть, и имена подсетей должны совпадать с аналогичными именами в рабочей сети.
1. В тестовой сети должен использоваться такой же диапазон IP-адресов, как и в рабочей сети.
1. Обновите службу DNS тестовой сети, используя IP-адрес, который был указан в качестве целевого IP-адреса для виртуальной машины DNS в разделе параметров **Вычисления и сеть**. Дополнительные сведения см. в разделе [Рекомендации по тестированию отработки отказа для Active Directory](site-recovery-active-directory.md#test-failover-considerations). 


## <a name="test-failover-to-a-production-network-on-recovery-site"></a>Тестовая отработка отказа в рабочую сеть на сайте восстановления 
При выполнении тестовой отработки отказа рекомендуется выбрать сеть, которая отличается от рабочей сети сайта восстановления, указанной в разделе параметров **Вычисления и сеть** виртуальной машины. Но если вы действительно хотите проверить сквозное сетевое подключение на виртуальной машине, для которой выполнена отработка отказа, то обратите внимание на следующие моменты:

1. При выполнении тестовой отработки отказа убедитесь, что работа основной виртуальной машины была завершена. Если этого не сделать, то в одной сети будут одновременно работать две виртуальные машины с одинаковыми идентификаторами, а это может привести к нежелательным последствиям. 
1. Любые изменения, внесенные на виртуальных машинах тестовой отработки отказа, будут потеряны при выполнении очистки этих машин. Эти изменения не будут реплицироваться обратно на основную виртуальную машину.
1. Такой способ тестирования приводит к простою рабочего приложения. Необходимо попросить пользователей не использовать приложение во время тренировки аварийного восстановления.  



## <a name="prepare-active-directory-and-dns"></a>Подготовка Active Directory и DNS
Чтобы выполнить тестовую отработку отказа для тестирования приложения, потребуется копия рабочей среды Active Directory в тестовой среде. Дополнительные сведения см. в разделе [Рекомендации по тестированию отработки отказа для Active Directory](site-recovery-active-directory.md#test-failover-considerations). 

## <a name="next-steps"></a>Дальнейшие действия
После успешной тестовой отработки отказа можно попробовать выполнить [отработку отказа](site-recovery-failover.md).




<!--HONumber=Jan17_HO4-->


