---
title: "Репликация многоуровневого развертывания Dynamics AX с помощью Azure Site Recovery | Документы Майкрософт"
description: "В этой статье описывается репликация и защита Dynamics AX с помощью Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: asgang
manager: rochakm
editor: 
ms.assetid: 9126f5e8-e9ed-4c31-b6b4-bf969c12c184
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 8/24/2017
ms.author: asgang
ms.translationtype: HT
ms.sourcegitcommit: 7456da29aa07372156f2b9c08ab83626dab7cc45
ms.openlocfilehash: 03127c8f4841b67436c4819628319705af0b2cd5
ms.contentlocale: ru-ru
ms.lasthandoff: 08/28/2017

---
# <a name="replicate-a-multi-tier-dynamics-ax-application-using-azure-site-recovery"></a>Репликация многоуровневого приложения Dynamics AX с помощью Azure Site Recovery

## <a name="overview"></a>Обзор


Microsoft Dynamics AX является одним из наиболее популярных ERP-решений, используемых предприятиями для стандартизации процессов в филиалах, управления ресурсами и упрощения соответствия требованиям. Учитывая тот факт, что приложение является критически важным для бизнеса, для организации большое значение имеет уверенность в том, что при любом сбое приложение будет приведено в рабочее состояние в кратчайшие сроки.

На данный момент Microsoft Dynamics AX не предоставляет какие-либо готовые функции аварийного восстановления. Microsoft Dynamics AX состоит из множества серверных компонентов, таких как сервер Application Object Server, Active Directory (AD), сервер базы данных SQL, SharePoint Server, сервер отчетов и т. д. Управление аварийным восстановлением каждого из этих компонентов вручную не только очень затратно, но и может приводить к ошибкам.

В этой статье подробно рассматривается создание решения аварийного восстановления для приложения Dynamics AX с помощью [Azure Site Recovery](site-recovery-overview.md). Кроме того, рассматривается плановая, незапланированная и тестовая отработка отказа с помощью плана восстановления одним щелчком, поддерживаемых конфигураций и необходимых компонентов.
Решение аварийного восстановления на основе Azure Site Recovery полностью протестировано, сертифицировано и рекомендовано рабочей группой Microsoft Dynamics AX.



## <a name="prerequisites"></a>Предварительные требования

Реализация аварийного восстановления для приложения Dynamics AX с помощью Azure Site Recovery требует выполнения следующих предварительных требований.

•   Локальное развертывание Dynamics AX настроено.

•   Хранилище служб Azure Site Recovery создано в подписке Microsoft Azure.

•   Если в качестве сайта аварийного восстановления используется Azure, запустите средство оценки готовности виртуальных машин Azure на виртуальных машинах, чтобы убедиться в их совместимости с виртуальными машинами Azure и службами Azure Site Recovery.


## <a name="site-recovery-support"></a>Поддержка Site Recovery

При написании этой статьи использовались виртуальные машины VMware с Dynamics AX 2012 R3 под управлением Windows Server 2012 R2 Enterprise. Так как репликация Site Recovery не зависит от приложения, описанные здесь рекомендации также подходят для сценариев, представленных ниже.

### <a name="source-and-target"></a>Исходный и целевой объект

**Сценарий** | **На дополнительный сайт** | **В Azure**
--- | --- | ---
**Hyper-V** | Да | Да
**VMware** | Да | Да
**Физический сервер** | Да | Да

## <a name="enable-dr-of-dynamics-ax-application-using-azure-site-recovery"></a>Реализация аварийного восстановления для приложений Dynamics AX с помощью Azure Site Recovery
### <a name="protect-your-dynamics-ax-application"></a>Защита приложения Dynamics AX
Чтобы можно было включить полные репликацию и восстановление приложения, должен быть защищен каждый компонент Dynamics AX. В этом разделе:

**1. Защита Active Directory**

**2. Защита уровня SQL**

**3. Защита уровня приложений и веб-уровня**

**4. Конфигурация сети**

**5. План восстановления**

### <a name="1-setup-ad-and-dns-replication"></a>1. Настройка AD и репликация DNS

Служба Active Directory должна быть развернута на сайте аварийного восстановления для работы приложения Dynamics AX. В зависимости от сложности локальной среды клиента рекомендуется два варианта защиты.

**Вариант 1**

Если у клиента немного приложений и один контроллер домена для всего локального сайта и отработка отказа будет выполняться для всего сайта одновременно, рекомендуем создать реплику виртуальной машины с контроллером домена на дополнительном сайте с помощью Azure Site Recovery (возможна репликация как с сайта на сайт, так и с сайта в Azure).

**Вариант 2**

Если у клиента много приложений, он использует лес Active Directory, а отработке отказа будет подвергнуто несколько приложений одновременно, рекомендуем настроить дополнительный контроллер домена на сайте аварийного восстановления (на дополнительном сайте или в Azure).

См. [вспомогательное руководство по обеспечению доступности контроллера домена на сайте аварийного восстановления](site-recovery-active-directory.md). Далее в этом документе подразумевается, что контроллер домена доступен на сайте аварийного восстановления.

### <a name="2-setup-sql-server-replication"></a>2) Настройка репликации SQL Server
Подробные технические рекомендации по выбору варианта защиты [уровня SQL](site-recovery-sql.md) см. во вспомогательном руководстве.

### <a name="3-enable-protection-for-dynamics-ax-client-and-aos-vms"></a>3. Включение защиты для клиента Dynamics AX и виртуальных машин AOS
Выполните соответствующие настройки Azure Site Recovery в зависимости от того, развертываются ли виртуальные машины на узле [Hyper-V](site-recovery-hyper-v-site-to-azure.md) или [VMware](site-recovery-vmware-to-azure.md).

> [!TIP]
> Рекомендуется задать значение "Частота отработки отказа" равным 15 минутам.
>

На снимке ниже показано состояние защиты виртуальных машин компонента Dynamics в сценарии защиты "Сайт VMware в Azure".
![Защищенные элементы](./media/site-recovery-dynamics-ax/protecteditems.png)

### <a name="4-configure-networking"></a>4. Настройка сети
Настройка параметров вычислений и сети для виртуальной машины

Для виртуальных машин AOS и AX настройте параметры сети в Azure Site Recovery таким образом, чтобы сети виртуальных машин подключались к нужной сети аварийного восстановления после отработки отказа. Убедитесь в возможности маршрутизации сети аварийного восстановления для этих уровней до уровня SQL.

Вы можете выбрать виртуальную машину в разделе реплицированных элементов, чтобы настроить параметры сети, как показано на снимке экрана ниже.

* Для серверов AOS выберите правильную группу доступности.

* Если вы используете статический IP-адрес, укажите нужный IP-адрес для виртуальной машины в поле **Целевой IP-адрес** ![Параметры сети ](./media/site-recovery-dynamics-ax/vmpropertiesaos1.png)



### <a name="5-creating-a-recovery-plan"></a>5. Создание плана восстановления

Вы можете создать план восстановления в Azure Site Recovery, чтобы автоматизировать процесс отработки отказа. Добавьте в план восстановления уровень приложений и веб-уровень. Распределите их по разным группам, чтобы интерфейсный уровень завершал работу до уровня приложений.

1)  Выберите хранилище Azure Site Recovery в подписке и щелкните плитку "Планы восстановления".

2)  Нажмите кнопку "Добавить план восстановления" и укажите имя.

3)  Выберите источник и цель. Целью может быть Azure или вторичный сайт. Если вы выбираете Azure, необходимо указать модель развертывания.

![Создание плана восстановления](./media/site-recovery-dynamics-ax/recoveryplancreation1.png)

4)  Выберите виртуальные машины AOS и клиента в плане восстановления и щелкните значок ✓.
![Создание плана восстановления](./media/site-recovery-dynamics-ax/selectvms.png)


![План восстановления](./media/site-recovery-dynamics-ax/recoveryplan.png)

Вы можете настроить план восстановления для приложения Dynamics AX, добавив различные действия, как описано ниже. На снимке выше показан полный план восстановления после добавления всех действий.

*Действия:*

*1. Действия по отработке отказа для SQL Server.*

Сведения о действиях восстановления, связанных с SQL Server, см. во вспомогательном руководстве [Решение аварийного восстановления SQL Server](site-recovery-sql.md).

*2. Группа отработки отказа 1: отработка отказа для виртуальных машин AOS.*

Убедитесь, что выбранная точка восстановления максимально близка к точке во времени базы данных, но не предшествует ей.

*3. Сценарий: добавление подсистемы балансировки нагрузки (только E-A)* Добавьте сценарий (с помощью службы автоматизации Azure) после группы виртуальных машин AOS, чтобы добавить в нее подсистему балансировки нагрузки. Для этого можно использовать сценарий. См. статью о [добавлении подсистемы балансировки нагрузки для аварийного восстановления многоуровневого приложения](https://azure.microsoft.com/blog/cloud-migration-and-disaster-recovery-of-load-balanced-multi-tier-applications-using-azure-site-recovery/).

*4. Группа отработки отказа 2: отработка отказа для виртуальных машин клиента AX.*
Выполните отработку отказа виртуальных машин веб-уровня в рамках плана восстановления.


### <a name="doing-a-test-failover"></a>Тестовая отработка отказа

Рекомендации для сред AD и SQL Server при тестовой отработке отказа см. во вспомогательных руководствах "Решения аварийного восстановления AD" и "Решения аварийного восстановления SQL Server", соответственно.

1.  Перейдите на портал Azure и выберите свое хранилище Site Recovery.
2.  Щелкните план восстановления, созданный для Dynamics AX.
3.  Щелкните "Тестовая отработка отказа".
4.  Выберите виртуальную сеть, чтобы запустить тестовую отработку отказа.
5.  Как только будет запущена вторичная среда, вы сможете выполнить проверку.
6.  После завершения проверки вы можете выбрать Validations complete (Проверка завершена), и среда тестовой отработки отказа будет удалена.

Чтобы выполнить тестовую отработку отказа, используйте [это руководство](site-recovery-test-failover-to-azure.md).

### <a name="doing-a-failover"></a>Отработка отказа

1.  Перейдите на портал Azure и выберите свое хранилище Site Recovery.
2.  Щелкните план восстановления, созданный для Dynamics AX.
3.  Щелкните "Отработка отказа" и выберите "Отработка отказа".
4.  Выберите целевую сеть, а затем щелкните значок ✓, чтобы запустить отработку отказа.

При выполнении отработки отказа используйте [это руководство](site-recovery-failover.md).

### <a name="perform-a-failback"></a>Восстановление размещения

Рекомендации для среды SQL Server при восстановлении размещения см. во вспомогательном руководстве "Решение аварийного восстановления SQL Server".

1.  Перейдите на портал Azure и выберите свое хранилище Site Recovery.
2.  Щелкните план восстановления, созданный для Dynamics AX.
3.  Щелкните "Отработка отказа" и выберите "Отработка отказа".
4.  Щелкните "Изменить направление".
5.  Настройте соответствующие параметры синхронизации данных и создания виртуальной машины.
6.  Чтобы запустить процесс восстановления размещения, щелкните значок ✓.


При восстановлении размещения используйте [это руководство](site-recovery-failback-azure-to-vmware.md).

##<a name="summary"></a>Сводка
С помощью Azure Site Recovery можно создать полностью автоматизированный план аварийного восстановления для приложения Dynamics AX. Отработку отказа можно запустить из любого места в течение нескольких секунд после сбоя и восстановить таким образом работоспособность приложения за считанные минуты.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о защите корпоративных приложений с помощью Azure Site Recovery см. в статье [Какие рабочие нагрузки можно защитить с помощью службы Azure Site Recovery?](site-recovery-workload.md)

