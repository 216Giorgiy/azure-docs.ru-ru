---
title: Часто задаваемые вопросы. Аварийное восстановление VMware в Azure с помощью Azure Site Recovery | Документация Майкрософт
description: В этой статье перечислены часто задаваемые вопросы о настройке аварийного восстановления локальных виртуальных машин VMware в Azure с помощью Azure Site Recovery.
author: rayne-wiselman
manager: carmonm
ms.service: site-recovery
services: site-recovery
ms.date: 12/31/2018
ms.topic: conceptual
ms.author: rayne
ms.openlocfilehash: 920ae8ff09cb8e936a1ba70b2c862bd9bc076046
ms.sourcegitcommit: 803e66de6de4a094c6ae9cde7b76f5f4b622a7bb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/02/2019
ms.locfileid: "53974698"
---
# <a name="common-questions---vmware-to-azure-replication"></a>Часто задаваемые вопросы о репликации из VMware в Azure

В этой статье приведены ответы на часто задаваемые вопросы, которые возникают при развертывании аварийного восстаовления локальных виртуальных машин VMware в Azure. Если после прочтения статьи у вас возникли какие-либо вопросы, вы можете задать их на [форуме, посвященном службам восстановления Azure](https://social.msdn.microsoft.com/Forums/azure/home?forum=hypervrecovmgr).


## <a name="general"></a>Общие сведения
### <a name="how-is-site-recovery-priced"></a>Как образуются цены на Site Recovery?
Ознакомьтесь со сведениями о [расценках на Azure Site Recovery](https://azure.microsoft.com/pricing/details/site-recovery/).

### <a name="how-do-i-pay-for-azure-vms"></a>Как оплачивается использование виртуальных машин Azure?
Во время репликации данные реплицируются в хранилище Azure, и вы не платите за любые изменения виртуальной машины. При выполнении отработки отказа в Azure служба Site Recovery автоматически создаст виртуальные машины IaaS Azure. После этого вам будет выставлен счет за вычислительные ресурсы, использованные в Azure.

### <a name="what-can-i-do-with-vmware-to-azure-replication"></a>Что можно сделать с помощью репликации VMware в Azure?
- **Аварийное восстановление.** Вы можете настроить полное аварийное восстановление. В этом сценарии можно реплицировать локальные виртуальные машины VMware в службу хранилища Azure. Затем, если ваша локальная инфраструктура недоступна, можно выполнить отработку отказа в Azure. При выполнении отработки отказа создаются виртуальные машины Azure с реплицируемыми данными. Вы можете получать доступ к приложениям и рабочим нагрузкам на виртуальных машинах Azure, пока ваш локальный центр обработки данных не станет снова доступен. Затем можно восстановить размещение в локальной среде из Azure.
- **Миграция.** Site Recovery можно использовать для миграции локальных виртуальных машин в Azure. В этом сценарии выполняется репликация локальных виртуальных машин в хранилище Azure. Затем выполняется отработка отказа из локальной среды в Azure. После отработки отказа приложения и рабочие нагрузки доступны и выполняются на виртуальных машинах Azure.



## <a name="azure"></a>Таблицы Azure
### <a name="what-do-i-need-in-azure"></a>Что нужно в Azure?
Требуется подписка Azure, хранилище служб восстановления, учетная запись хранения и виртуальная сеть. Хранилище, учетная запись хранения и сеть должны находиться в одном регионе.

### <a name="what-azure-storage-account-do-i-need"></a>Какая учетная запись хранения Azure требуется?
Требуется учетная запись хранения LRS или GRS. Рекомендуется использовать учетную запись хранения GRS, чтобы обеспечить устойчивость данных в случае отключения электричества в регионе или при отсутствии возможности восстановления основного региона. Поддерживается хранилище класса Premium.

### <a name="does-my-azure-account-need-permissions-to-create-vms"></a>Требуются ли учетной записи Azure разрешения на создание виртуальных машин?
Если вы являетесь администратором подписки, у вас есть необходимые разрешения на репликацию. Если нет, вам нужны разрешения на создание виртуальной машины Azure в группе ресурсов и виртуальной сети, которые указываются при настройке Site Recovery, и разрешения на запись в выбранную учетную запись хранения. [Узнайте больше](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines).



## <a name="on-premises"></a>Локальная система

### <a name="what-do-i-need-on-premises"></a>Что требуется в локальной среде?

В локальной среде вам потребуются:
- компоненты Site Recovery, установленные на одной виртуальной машине VMware;
- инфраструктура VMware с как минимум одним узлом ESXi и (рекомендуется) сервер vCenter;
- одна или более виртуальных машин VMware для репликации.

[Дополнительные сведения](vmware-azure-architecture.md) об репликации VMware в архитектуру Azure.

Развернуть локальный сервер конфигурации можно следующим образом:

- Рекомендуем развернуть сервер конфигурации как виртуальную машину VMware с помощью OVA-шаблона с предварительно установленным сервером конфигурации.
- Если по какой-либо причине вы не может использовать шаблон, сервер конфигурации можно настроить вручную. [Узнайте больше](physical-azure-disaster-recovery.md#set-up-the-source-environment).



### <a name="where-do-on-premises-vms-replicate-to"></a>Куда реплицируются локальные виртуальные машины?
Данные реплицируются в хранилище Azure. При выполнении отработки Site Recovery автоматически создаст виртуальные машины Azure из учетной записи хранения.

## <a name="replication"></a>Репликация

### <a name="what-apps-can-i-replicate"></a>Какие приложения можно реплицировать?
Можно реплицировать любые приложения или рабочие нагрузки, выполняемые в виртуальной машине VMware, которые соответствуют [требованиям к репликации](vmware-physical-azure-support-matrix.md##replicated-machines). Служба Site Recovery также поддерживает репликацию уровня приложения, позволяя выполнять отработку отказа приложений и восстанавливать их размещение до программируемого состояния. Site Recovery интегрируется с приложениями Майкрософт, включая SharePoint, Exchange, Dynamics, SQL Server и Active Directory, а также тесно взаимодействует с решениями ведущих производителей, в том числе Oracle, SAP, IBM и Red Hat. [Подробнее](site-recovery-workload.md) о защите рабочей нагрузки.

### <a name="can-i-replicate-to-azure-with-a-site-to-site-vpn"></a>Можно выполнить репликацию через VPN-подключение "сеть — сеть" в Azure?
Site Recovery реплицирует данные из локальной среды в хранилище Azure через общедоступную конечную точку или с помощью общедоступного пиринга ExpressRoute. Репликация через VPN-подключение "сеть — сеть" не поддерживается.

### <a name="can-i-replicate-to-azure-with-expressroute"></a>Можно ли реплицировать в Azure с помощью ExpressRoute?
Да, ExpressRoute можно использовать для репликации виртуальных машин в Azure. Site Recovery реплицирует данные в учетную запись хранения Azure через общедоступную конечную точку. Чтобы использовать ExpressRoute для репликации Site Recovery, необходимо настроить [общедоступный пиринг](../expressroute/expressroute-circuit-peerings.md#publicpeering) или [пиринг Майкрософт](../expressroute/expressroute-circuit-peerings.md#microsoftpeering). Пиринг Майкрософт является рекомендуемым доменом маршрутизации для репликации. Убедитесь, что [требования к сети](vmware-azure-configuration-server-requirements.md#network-requirements) также выполняются для репликации. После отработки отказа виртуальных машин в виртуальную сеть Azure к ним можно получить доступ с помощью [частного пиринга](../expressroute/expressroute-circuit-peerings.md#privatepeering).


### <a name="why-cant-i-replicate-over-vpn"></a>Почему я не могу выполнить репликацию через VPN?

При репликации в Azure трафик репликации достигает общедоступных конечных точек учетной записи хранения Azure. Таким образом, репликацию можно выполнять только через общедоступный Интернет с помощью ExpressRoute (общедоступный пиринг), а VPN не будет работать.


### <a name="what-are-the-replicated-vm-requirements"></a>Каковы требования к реплицируемой виртуальной машине?

Для репликации виртуальная машина VMware должна работать под управлением поддерживаемой операционной системы. Кроме того, она должна соответствовать требованиям к виртуальным машинам Azure. [Дополнительные сведения см. в матрице поддержки.](vmware-physical-azure-support-matrix.md##replicated-machines)

### <a name="how-often-can-i-replicate-to-azure"></a>Как часто можно выполнять репликацию в Azure?
Этот процесс является непрерывным при репликации виртуальных машин VMware в Azure.

### <a name="can-i-extend-replication"></a>Можно ли расширить репликацию?
Расширенная репликация и цепочка репликации не поддерживаются. Запросите эту функцию на [форуме отзывов и предложений](http://feedback.azure.com/forums/256299-site-recovery/suggestions/6097959-support-for-exisiting-extended-replication).

### <a name="can-i-do-an-offline-initial-replication"></a>Можно ли выполнить начальную репликацию в автономном режиме?
Эта возможность не поддерживается. Запросите эту функцию на [форуме отзывов и предложений](http://feedback.azure.com/forums/256299-site-recovery/suggestions/6227386-support-for-offline-replication-data-transfer-from).

### <a name="can-i-exclude-disks"></a>Можно ли исключать диски?
Да, из репликации можно исключать диски.

### <a name="can-i-replicate-vms-with-dynamic-disks"></a>Можно ли реплицировать виртуальные машины с динамическими дисками?
Динамические диски могут быть реплицированы. Диск операционной системы должен представлять собой базовый диск.

### <a name="if-i-use-replication-groups-for-multi-vm-consistency-can-i-add-a-new-vm-to-an-existing-replication-group"></a>Если я использую группы репликации для согласованности нескольких виртуальных машин, могу ли я добавить новую виртуальную машину в имеющуюся группу репликации?
Да, вы можете добавить новые виртуальные машины в имеющуюся группу репликации при включении для них репликации. Вы не можете добавить виртуальную машину в имеющуюся группу репликации после запуска репликации, и вы не можете создать группу репликации для имеющихся виртуальных машин.

### <a name="can-i-modify-vms-that-are-replicating-by-adding-or-resizing-disks"></a>Можно ли изменить виртуальные машины, которые реплицируются, путем добавления дисков или изменения их размера?

Для репликации VMware в Azure можно изменить размер диска. Если вы хотите добавить новые диски, вам необходимо добавить диск и повторно включить защиту для виртуальной машины.

## <a name="configuration-server"></a>Сервер конфигурации

### <a name="what-does-the-configuration-server-do"></a>Что делает сервер конфигурации?
На сервере конфигурации выполняются локальные компоненты Site Recovery, включая:
- Сервер конфигурации, используемый для управления обменом данными между локальным источником и Azure, а также репликацией данных.
- Сервер обработки, который действует как шлюз репликации. Он получает данные репликации, оптимизирует их с помощью кэширования, сжатия и шифрования, а потом отправляет в хранилище Azure. Сервер обработки также устанавливает службу Mobility Service на виртуальных машинах, которые требуется реплицировать, и выполняет автоматическое обнаружение виртуальных машин VMware.
- Главный целевой сервер, который обрабатывает данные репликации при восстановлении размещения с переносом из Azure.

См. дополнительные сведения о [компонентах и процессах сервера конфигурации](vmware-azure-architecture.md).

### <a name="where-do-i-set-up-the-configuration-server"></a>Где настраивается сервер конфигурации?
Для сервера конфигурации требуется одна высокодоступная локальная виртуальная машина VMware.

### <a name="what-are-the-requirements-for-the-configuration-server"></a>Каковы требования к серверу конфигурации?

Ознакомьтесь с [предварительными требованиями.](vmware-azure-deploy-configuration-server.md#prerequisites)

### <a name="can-i-manually-set-up-the-configuration-server-instead-of-using-a-template"></a>Можно ли вручную настроить сервер конфигурации, не используя шаблон?
Мы рекомендуем использовать последнюю версию шаблона OVF для [создания виртуальной машины сервера конфигурации.](vmware-azure-deploy-configuration-server.md) Если по какой-то причине вы не можете этого сделать, например, у вас нет доступа к серверу VMware, можно загрузить [файл единой установки](physical-azure-set-up-source.md) с портала и запустить его на виртуальной машине.

### <a name="can-a-configuration-server-replicate-to-more-than-one-region"></a>Может ли сервер конфигурации выполнять репликацию больше, чем в один регион?
 Нет. Чтобы сделать это, необходимо настроить сервер конфигурации в каждом регионе.

### <a name="can-i-host-a-configuration-server-in-azure"></a>Можно ли разместить сервер конфигурации в Azure?
Это возможно, однако на виртуальной машине Azure, где запущен сервер конфигурации, необходимо настроить обмен данными с локальными инфраструктурой и виртуальными машинами VMware. Это может вызвать задержки и повлиять на текущую репликацию.

### <a name="how-do-i-update-the-configuration-server"></a>Как обновить сервер конфигурации?
[Подробнее](vmware-azure-manage-configuration-server.md#upgrade-the-configuration-server) об обновлении сервера конфигурации. Последние сведения об обновлении можно найти на [странице обновлений Azure](https://azure.microsoft.com/updates/?product=site-recovery). Вы также можете напрямую скачать последнюю версию сервера конфигурации из [Центра загрузки Майкрософт](https://aka.ms/asrconfigurationserver).

### <a name="should-i-backup-the-deployed-configuration-server"></a>Необходимо ли делать резервную копию развернутого сервера конфигурации?
Мы рекомендуем создавать плановые резервные копии сервера конфигурации. Для успешного восстановления размещения виртуальная машина должна существовать в базе данных сервера конфигурации, а сам сервер должен быть запущен в подключенном состоянии. Дополнительные сведения о распространенных задачах управления сервером конфигурации см. [здесь](vmware-azure-manage-configuration-server.md).

### <a name="when-im-setting-up-the-configuration-server-can-i-download-and-install-mysql-manually"></a>Можно ли скачать и установить MySQL вручную при настройке сервера конфигурации?
Да. Скачайте среду MySQL и поместите ее в папку **C:\Temp\ASRSetup**. Затем установите ее вручную. После настройки виртуальной машины сервера конфигурации и принятия условий для MySQL в поле **Скачать и установить** будет показано значение **Уже установлено**.

### <a name="can-i-avoid-downloading-mysql-but-let-site-recovery-install-it"></a>Можно ли не скачивать MySQL и разрешить Site Recovery сделать это?
Да. Скачайте установщик MySQL и поместите его в папку **C:\Temp\ASRSetup**.  При настройке виртуальной машины сервера конфигурации примите условия и щелкните **Скачать и установить**. Портал использует установщик, который вы добавили для установки MySQL.
 
### <a name="can-i-use-the-configuration-server-vm-for-anything-else"></a>Можно ли использовать виртуальную машину сервера конфигурации для чего-либо еще?
Нет, виртуальную машину следует использовать только для сервера конфигурации. 

### <a name="can-i-clone-a-configuration-server-and-use-it-for-orchestration"></a>Можно ли клонировать сервер конфигурации и использовать его для оркестрации?
Нет, вы должны настроить новый сервер конфигурации, чтобы избежать проблем с регистрацией.

### <a name="can-i-change-the-vault-registered-in-the-configuration-server"></a>Можно ли изменить хранилище, зарегистрированное на сервере конфигурации?
 Нет. После регистрации хранилища на сервере конфигурации его нельзя изменить. Действия по повторной регистрации см. в [этой статье](vmware-azure-manage-configuration-server.md#register-a-configuration-server-with-a-different-vault).

### <a name="can-i-use-the-same-configuration-server-for-disaster-recovery-of-both-vmware-vms-and-physical-servers"></a>Можно ли использовать тот же сервер конфигурации для аварийного восстановления виртуальных машин и физических серверов VMware
Да, но обратите внимание, что для физического компьютера можно выполнить восстановление размещения только на виртуальную машину VMware.

### <a name="where-can-i-download-the-passphrase-for-the-configuration-server"></a>Где можно скачать парольную фразу для сервера конфигурации?
Чтобы узнать о скачивании парольной фразы, [просмотрите эту статью](vmware-azure-manage-configuration-server.md#generate-configuration-server-passphrase).

### <a name="where-can-i-download-vault-registration-keys"></a>Где можно загрузить ключи регистрации хранилища?

В **Хранилище служб восстановления** перейдите в раздел **Управление** > **Инфраструктура восстановления сайта** > **Серверы восстановления**. В списке **Серверы** выберите **Скачать ключ регистрации**, чтобы загрузить файл учетных данных хранилища.



## <a name="mobility-service"></a>Служба Mobility Service

### <a name="where-can-i-find-the-mobility-service-installers"></a>Где можно найти установщики Mobility Service?
Установщики хранятся в папке **%ProgramData%\ASR\home\svsystems\pushinstallsvc\repository** на сервере конфигурации.

## <a name="how-do-i-install-the-mobility-service"></a>Как установить службу Mobility Service?
Установите ее на каждой виртуальной машине, которую требуется реплицировать, используя [принудительную установку](vmware-azure-install-mobility-service.md) или установку вручную с помощью [пользовательского интерфейса](vmware-physical-mobility-service-install-manual.md) или PowerShell. Кроме того, можно выполнить развертывание с помощью средства развертывания, например [System Center Configuration Manager](vmware-azure-mobility-install-configuration-mgr.md).



## <a name="security"></a>Безопасность

### <a name="what-access-does-site-recovery-need-to-vmware-servers"></a>Какой доступ к серверам VMware требуется Site Recovery?
Site Recovery требуется доступ к серверам VMware, чтобы:

- настроить виртуальную машину VMware, выполняющуюся на сервере конфигурации, и другие локальные компоненты Site Recovery; [Подробнее](vmware-azure-deploy-configuration-server.md)
- автоматически обнаруживать виртуальные машины для репликации. Узнайте, как подготовить учетную запись для автоматического обнаружения. [Подробнее](vmware-azure-tutorial-prepare-on-premises.md#prepare-an-account-for-automatic-discovery)


### <a name="what-access-does-site-recovery-need-to-vmware-vms"></a>Какой доступ к виртуальным машинам VMware требуется Site Recovery?

- На реплицируемой виртуальной машине VMware должна быть установлена и запущена служба Site Recovery Mobility Service. Можно развернуть средство вручную или указать, что служба Site Recovery должна принудительно установить Mobility Service при включении репликации для виртуальной машины. Для принудительной установки Site Recovery требуется учетная запись, которую можно использовать для установки компонента службы. [Узнайте больше](vmware-azure-tutorial-prepare-on-premises.md#prepare-an-account-for-mobility-service-installation). Сервер обработки (по умолчанию запущен на сервере конфигурации) выполняет установку. [Дополнительные сведения об установке службы Mobility Service](vmware-azure-install-mobility-service.md).
- Во время репликации виртуальные машины обмениваются данными с Site Recovery следующим образом:
    - виртуальные машины обмениваются данными с сервером конфигурации через порт HTTPS 443, чтобы управлять репликацией;
    - виртуальные машины отправляют данные репликации на сервер обработки через порт HTTPS 9443 (можно изменить);
    - если включить согласованность между виртуальными машинами, они будут обмениваться данными друг с другом через порт 20004.


### <a name="is-replication-data-sent-to-site-recovery"></a>Отправляются ли данные репликации в Site Recovery?
Нет, служба Site Recovery не перехватывает реплицируемые данные и не получает сведения о компонентах, запущенных на ваших виртуальных машинах. Данные репликации передаются между гипервизорами VMware и хранилищем Azure. Служба Site Recovery не обладает способностью перехватывать эти данные. В службу Site Recovery передаются только метаданные, необходимые для управления репликацией и отработкой отказа.  

Site Recovery имеет сертификаты ISO 27001:2013, 27018, HIPAA, DPA и сейчас проходит проверки на соответствие SOC2 и FedRAMP JAB.

### <a name="can-we-keep-on-premises-metadata-within-a-geographic-regions"></a>Можно ли хранить локальные метаданные в пределах географических регионов?
Да. При создании хранилища в регионе мы гарантируем, что все метаданные, используемые Site Recovery, остаются в пределах географических границ региона.

### <a name="does-site-recovery-encrypt-replication"></a>Выполняет ли служба Site Recovery шифрование репликации?
Да, поддерживается и шифрование в процессе передачи, и [шифрование в Azure](https://docs.microsoft.com/azure/storage/storage-service-encryption).


## <a name="failover-and-failback"></a>Отработка отказа и восстановление размещения
### <a name="how-far-back-can-i-recover"></a>До какой точки во времени можно выполнить восстановление?
Для репликации VMware в Azure самая давняя точка восстановления — 72 часа.

### <a name="how-do-i-access-azure-vms-after-failover"></a>Как получить доступ к виртуальным машина Azure после отработки отказа?
После отработки отказа доступ к виртуальным машинам Azure можно получить через безопасное подключение к Интернету, VPN-подключение "сеть — сеть" или с помощью Azure ExpressRoute. Для подключения потребуется выполнить несколько подготовительных действий. [Подробнее](site-recovery-test-failover-to-azure.md#prepare-to-connect-to-azure-vms-after-failover)

### <a name="is-failed-over-data-resilient"></a>Устойчивы ли данные, для которых была выполнена отработка отказа?
Среда Azure разработана для обеспечения отказоустойчивости. Служба Site Recovery рассчитана на отработку отказа в дополнительный центр обработки данных Azure в соответствии с соглашением об уровне обслуживания Azure. Когда происходит отработка отказа, Azure обеспечивает хранение метаданных и хранилищ в географическом регионе, выбранном для хранилища.

### <a name="is-failover-automatic"></a>Отработка отказа выполняется автоматически?
[Отработка отказа](site-recovery-failover.md) не выполняется автоматически. Чтобы активировать ее, необходимо щелкнуть в соответствующем месте на портале или воспользоваться [PowerShell](/powershell/module/azurerm.siterecovery).

### <a name="can-i-fail-back-to-a-different-location"></a>Можно ли выполнить восстановление размещения в другое расположение?
Да, если отработка отказа выполнена в Azure, можно восстановить размещение в другом расположении, если изначальное расположение недоступно. [Узнайте больше](concepts-types-of-failback.md#alternate-location-recovery-alr).

### <a name="why-do-i-need-a-vpn-or-expressroute-to-fail-back"></a>Почему для восстановления размещения требуется VPN или ExpressRoute?

При восстановлении размещения из Azure данные из Azure копируются обратно на локальную виртуальную машину и требуется закрытый доступ.



## <a name="automation-and-scripting"></a>Автоматизация и использование скриптов

### <a name="can-i-set-up-replication-with-scripting"></a>Можно ли настроить репликацию с использованием скриптов?
Да. Рабочие процессы службы Site Recovery можно автоматизировать с помощью интерфейса REST API, PowerShell или пакета SDK для Azure. [Дополнительные сведения.](vmware-azure-disaster-recovery-powershell.md)

## <a name="performance-and-capacity"></a>Производительность и емкость
### <a name="can-i-throttle-replication-bandwidth"></a>Можно ли отрегулировать пропускную способность репликации?
Да. [Узнайте больше](site-recovery-plan-capacity-vmware.md).


## <a name="next-steps"></a>Дополнительная информация
* [Ознакомьтесь с требованиями к поддержке.](vmware-physical-azure-support-matrix.md)
* [Настройте репликацию из VMware в Azure.](vmware-azure-tutorial.md)
