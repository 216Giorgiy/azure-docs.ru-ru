---
title: "Планировщик ресурсов Azure Site Recovery для сценариев развертывания виртуальных машин VMware в Azure | Документация Майкрософт"
description: "Руководство по использованию планировщика ресурсов Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: nsoneji
manager: garavd
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: hero-article
ms.date: 2/21/2017
ms.author: nisoneji
translationtype: Human Translation
ms.sourcegitcommit: f438db1d0129dfb0e2eaa00146147084cd8c11b6
ms.openlocfilehash: 179e8cf928d83a3a66ed3489173e4c28a2bc9d4f
ms.lasthandoff: 03/01/2017


---
#<a name="azure-site-recovery-deployment-planner"></a>Планировщик ресурсов Azure Site Recovery
В этой статье приведены рекомендации по использованию планировщика ресурсов Azure Site Recovery в сценариях рабочих развертываний виртуальных машин VMware в Azure.


##<a name="overview"></a>Обзор

Перед установкой защиты виртуальных машин VMware с помощью Azure Site Recovery необходимо выделить достаточный объем пропускной способности в зависимости от частоты ежедневного изменения данных в соответствии с требуемой целевой точкой восстановления (RPO). В локальной среде необходимо развернуть нужное число серверов конфигурации и серверов обработки. Кроме того, необходимо также создать требуемое количество целевых учетных записей хранения Azure соответствующего типа (класса Standard или Premium), учитывая рост нагрузки на исходные рабочие серверы из-за более активного их использования в будущем. Тип хранилища определяется для каждой виртуальной машины на основе особенностей рабочей нагрузки (количества операций записи и чтения на диск в секунду, активности обработки данных) и ограничений Azure Site Recovery.  

Общедоступная предварительная версия планировщика ресурсов Azure Site Recovery — это программа командной строки, доступная сейчас только в сценариях развертывания виртуальных машин VMware в Azure. Эта программа позволяет выполнить удаленное профилирование виртуальных машин VMware (никоим образом не влияя на рабочий процесс), чтобы оценить требования к пропускной способности и службе хранилища Azure для успешной репликации и отработки отказа.  Вы можете запустить эту программу, не устанавливая в локальной среде каких-либо дополнительных компонентов Azure Site Recovery. Однако чтобы получить более точные сведения о пропускной способности, мы рекомендуем запустить планировщик ресурсов на виртуальной машине Windows Server, соответствующей минимальным требованиям сервера конфигурации Azure Site Recovery, который в конечном итоге потребуется развернуть в качестве одного из первых шагов рабочего развертывания.

Эта программа предоставляет указанные ниже сведения.

**Оценка совместимости**<br>
* Оценка совместимости виртуальной машины в зависимости от количества дисков, их размера, числа операций ввода-вывода в секунду и активности обработки данных.

**Оценка пропускной способности сети и целевой точки восстановления**<br>
* Расчетное значение пропускной способности, необходимой для разностной репликации.<br>
* Пропускная способность, которую может получить Azure Site Recovery при репликации данных из локальной среды в Azure.<br>
* Количество виртуальных машин, которое можно включить в пакет, на основе расчетного значения пропускной способности, для завершения начальной репликации в указанный промежуток времени.<br>

**Требования к инфраструктуре Microsoft Azure**<br>
* Требование к типу хранилища (хранилище класса Standard или Premium) каждой виртуальной машины.<br>
* Общее число учетных записей хранения класса Standard или Premium, которое необходимо подготовить для репликации.<br>
* Именование учетных записей хранения в соответствии с рекомендациями к службе хранилища Azure.<br>
* Размещение учетной записи хранения каждой виртуальной машины.<br>
* Число ядер Microsoft Azure, которое необходимо подготовить перед отработкой отказа или тестовой отработкой отказа, на подписку.<br>
* Рекомендуемый размер виртуальной машины Microsoft Azure для каждой локальной виртуальной машины.<br>

**Требования к локальной инфраструктуре**<br>
* Необходимое число серверов конфигурации и серверов обработки, которое необходимо развернуть в локальной среде.<br>

>[!IMPORTANT]
>
>При выполнении вычислений в программе использовался 30%-й коэффициент роста характеристик рабочей нагрузки (из-за возможного роста использования со временем) и 95-й процентиль всех метрик профилирования (число операций записи и чтения в секунду, активность обработки данных и т. д.). Оба эти параметра (коэффициент роста и используемый процентиль) можно изменить. Дополнительные сведения см. в разделе [Коэффициент роста](site-recovery-deployment-planner.md#growth-factor) и [Значение процентиля, используемое для вычисления](site-recovery-deployment-planner.md#percentile-value-used-for-the-calculation).
>


## <a name="requirements"></a>Требования
Программа выполняет два основных действия: выполняет профилирование и создает отчет. С ее помощью также можно оценить пропускную способность. Ниже приведены требования к серверу, на котором инициируется профилирование и измерение пропускной способности.

| Требование | Описание|
|---|---|
|Профилирование и измерение пропускной способности| <br>Операционная система: Microsoft Windows Server 2012 R2. <br>Рекомендации по размеру сервера конфигурации см. в [этой статье](https://aka.ms/asr-v2a-on-prem-components).<br>Конфигурация виртуальной машины: 8 виртуальных ЦП, 16 ГБ ОЗУ, жесткий диск емкостью 300 ГБ.<br [Microsoft .NET Framework 4.5](https://aka.ms/dotnet-framework-45)<br>[VMware vSphere PowerCLI 6.0 R3](https://developercenter.vmware.com/tool/vsphere_powercli/6.0).<br>[Распространяемый компонент Microsoft Visual C++ для Visual Studio 2012](https://aka.ms/vcplusplus-redistributable).<br> Интернет-доступ к Microsoft Azure из этого сервера.<br> Учетная запись хранения Microsoft Azure.<Br>Права администратора на доступ к серверу.<br>Минимальное свободное место на диске: 100 ГБ (предполагается, что профилирование 1000 виртуальных машин в среднем с 3 дисками каждая выполняется 30 дней).|
| Создание отчетов| Любой компьютер с Windows или Windows Server с Microsoft Excel 2013 или более поздней версии. |
| Разрешения пользователя | Разрешение только на чтение для учетной записи пользователя, используемой для доступа к VMware vCenter Server или серверу vSphere во время профилирования.|


> [!NOTE]
>
> Эта программа позволяет профилировать только виртуальные машины с дисками VMDK и RDM и не поддерживает диски iSCSI или NFS. Azure Site Recovery поддерживает диски iSCSI и NFS для серверов VMware. Если планировщик ресурсов запущен не в гостевой ОС и выполняет профилирование только на основе показателей счетчиков производительности vCenter, он не видит диски этого типа.
>


##<a name="download"></a>Загрузить
[Скачайте](https://aka.ms/asr-deployment-planner) последнюю версию общедоступной предварительной версии планировщика ресурсов Azure Site Recovery.  Эта программа упакована в формате ZIP.  Текущая ее версия поддерживает только сценарии развертывания виртуальных машин VMware в Azure.

Скопируйте ZIP-файл на сервер Windows Server, на котором необходимо запустить программу. Вы можете запустить планировщик на любом сервере Windows Server 2012 R2, имеющем сетевой доступ к VMware vCenter Server или узлу VMware vSphere ESXi, в котором содержатся виртуальные машины, профилирование которых необходимо выполнить. Но мы советуем запускать эту программу на сервере, конфигурация оборудования которого соответствует [рекомендациям по размеру сервера конфигурации](https://aka.ms/asr-v2a-on-prem-components).  Если вы уже развернули компоненты Azure Site Recovery в локальной среде, программу необходимо запустить на сервере конфигурации. При одинаковых конфигурациях оборудования сервера, рекомендуемого для запуска программы, и сервера конфигурации (со встроенным сервером обработки) пропускная способность, сведения о которой получены с помощью планировщика, будет соответствовать фактической пропускной способности, которую Azure Site Recovery может добиться во время репликации. Значение пропускной способности зависит от доступной пропускной способности сети и конфигурации оборудования сервера (ЦП, хранилище и т. д.). При запуске программы на другом сервере пропускная способность вычисляется при передаче из этого сервера в Microsoft Azure. Кроме того, конфигурация оборудования на этом сервере и на сервере конфигурации может отличаться. И поэтому значение достигаемой пропускной способности, полученное с помощью этой программы, будет неточным.

Распакуйте ZIP-папку. Вы увидите несколько файлов и вложенных папок. Исполняемый файл ASRDeploymentPlanner.exe находится в родительской папке.

Пример. Скопируйте ZIP-файл в папку E:\ drive и распакуйте его.
E:\ASR Deployment Planner-Preview_v1.0.zip

E:\ASR Deployment Planner-Preview_v1.0\ ASR Deployment Planner-Preview_v1.0\ ASRDeploymentPlanner.exe

##<a name="capabilities"></a>Возможности
Программу командной строки можно запустить в любом из следующих трех режимов:

1.    Профилирование.  
2.    Создание отчетов.
3.    Оценка пропускной способности.

Сначала планировщик необходимо запустить в режиме профилирования, чтобы получить сведения об активности обработки данных и числе операций ввода-вывода в секунду на виртуальной машине.  Затем запустите его в режиме создания отчетов, чтобы оценить требования к пропускной способности сети и хранилищу.

##<a name="profiling"></a>Профилирование
В режиме профилирования планировщик ресурсов подключается к vCenter Server или узлам vSphere ESXi, чтобы собрать данные о производительности виртуальной машины.

* Профилирование не влияет на производительность рабочих процессов виртуальных машин, так как программа напрямую не подключается к виртуальной машине. Все данные о производительности собираются на сервере vCenter Server или узле vSphere ESXi.
* Запросы к серверу vCenter Server или узлу vSphere ESXi отправляются каждые 15 минут. За счет этого влияние на сервер во время профилирования незначительное. Однако это не влияет на точность профилирования, так как программа сохраняет данные счетчика производительности, получаемые каждую минуту.

####<a name="create-a-list-of-virtual-machines-to-profile"></a>Создание списка виртуальных машин для профилирования
Сначала вы должны создать список виртуальных машин, профилирование которых нужно выполнить. Список всех имен виртуальных машин можно получить на сервере VMware vCenter или узле VMware vSphere ESXi, используя приведенные ниже команды VMware vSphere ESXi. Кроме того, вы можете выбрать знакомые имена или IP-адреса виртуальных машин вручную в файле.

1.    Войдите в систему виртуальной машины, на которой установлен VMware vSphere PowerCLI.
2.    Откройте консоль VMware vSphere PowerCLI.
3.    Проверьте, включена ли политика выполнения скрипта. Если отключена, запустите консоль VMware vSphere PowerCLI в режиме администратора и выполните следующую команду, чтобы включить ее:

            Set-ExecutionPolicy –ExecutionPolicy AllSigned

4.    Выполните приведенные ниже команды, чтобы получить список всех имен виртуальных машин на сервере VMware vCenter или узле VMware vSphere ESXi и сохранить их в TXT-файле.
Замените значения &lsaquo;имени сервера&rsaquo;, &lsaquo;имени пользователя&rsaquo;, &lsaquo;пароля&rsaquo; и &lsaquo;выходного TXT-файла&rsaquo; собственными.

            Connect-VIServer -Server <server name> -User <user name> -Password <password>

            Get-VM |  Select Name | Sort-Object -Property Name >  <outputfile.txt>


5.    Откройте выходной файл в Блокноте. Скопируйте имена виртуальных машин, профилирование которых необходимо выполнить, в другой файл (например, в файл ProfileVMList.txt) по одному на строку. Этот файл будет использоваться в качестве входного значения параметра -VMListFile в программе командной строки.

    ![Планировщик ресурсов](./media/site-recovery-deployment-planner/profile-vm-list.png)


####<a name="start-profiling"></a>Начало профилирования
После создания списка виртуальных машин можно запустить программу в режиме профилирования. Ниже приведен список обязательных и необязательных параметров для запуска планировщика в режиме профилирования. Параметры, заключенные в квадратные скобки ([]), являются необязательными.

ASRDeploymentPlanner.exe -Operation StartProfiling /?

| Имя параметра | Описание |
|---|---|
| -Operation |      StartProfiling |
| -Server | Полное доменное имя или IP-адрес сервера vCenter Server или узла ESXi, профилирование виртуальных машин которого необходимо выполнить.|
| -User | Имя пользователя для подключения к серверу vCenter Server или узлу ESXi. Пользователь должен иметь по крайней мере доступ с правами только для чтения.|
| -VMListFile |    Файл со списком виртуальных машин для профилирования. Путь к файлу может быть абсолютным или относительным. Этот файл должен содержать по одному имени или IP-адресу виртуальной машины в каждой строке. Имя виртуальной машины, указанное в файле, должно совпадать с именем виртуальной машины на сервере vCenter Server или узле ESXi. <br> Например, файл VMList.txt содержит следующие виртуальные машины:<br>virtual_machine_A <br>10.150.29.110<br>virtual_machine_B |
| -NoOfDaysToProfile | Число дней, в течение которого будет выполняться профилирование. Мы рекомендуем выполнять профилирование более 15 дней. Это позволит более детально определить шаблон рабочей нагрузки и предоставить более точные рекомендации. |
| [-Directory] |    UNC-путь или путь к локальному каталогу для хранения данных профилирования. Если он не задан, в качестве каталога по умолчанию используется каталог ProfiledData, расположенный по текущему пути. |
| [-Password ] | Пароль, используемый для подключения к серверу vCenter Server или узлу ESXi. Если не указать его сейчас, запрос на ввод пароля отобразится после выполнения команды.|
|  [-StorageAccountName]  | Имя учетной записи хранения Azure, используемой для определения объема пропускной способности, доступной для репликации данных из локальной среды в Azure. Программа отправляет тестовые данные в эту учетную запись хранения, чтобы рассчитать пропускную способность.|
| [-StorageAccountKey] | Ключ, используемый для доступа к учетной записи хранения Azure. Перейдите на портал Azure и выберите "Учетные записи хранения" > [Имя_учетной записи_хранения] > "Параметры" > "Ключи доступа" > Ключ 1 (или первичный ключ доступа для классической учетной записи хранения). |

Мы рекомендуем выполнять профилирование виртуальной машины от 15 до 30 дней. В течение этого периода программа ASRDeploymentPlanner.exe продолжает работать. Время профилирования необходимо указать в днях. Если вы хотите запустить профилирование в общедоступной предварительной версии на несколько часов или минут (например, чтобы быстро проверить эту программу), это время необходимо преобразовать в эквивалент в днях.  Например, чтобы выполнить профилирование в течение 30 минут, это значение необходимо преобразовать следующим образом: 30 / (60*24) = 0,021 дней.  Минимальное разрешенное время профилирования составляет 30 минут.

В процессе профилирования при необходимости можно передать имя и ключ учетной записи хранения Azure, чтобы определить пропускную способность, которой может достигнуть Azure Site Recovery во время репликации данных из сервера конфигурации и сервера обработки в Azure. Если их не передать, планировщик не будет рассчитывать достигаемую пропускную способность.


Вы можете запустить несколько экземпляров этой программы для разных наборов виртуальных машин. Убедитесь, что в этих наборах профилирования имена виртуальных машин не повторяются. Например, вы выполнили профилирование десяти виртуальных машин (VM1–VM10) и спустя несколько дней хотите повторить этот процесс для еще пяти (VM11–VM15). Для профилирования второго набора виртуальных машин (VM11–VM15) эту программу можно запустить в другой консоли командной строки. Но проверьте, не входят ли во второй набор виртуальные машины из первого экземпляра профилирования или не используется ли для второго запуска другой выходной каталог. Если два экземпляра планировщика выполняют профилирование тех же самых виртуальных машин и используется тот же выходной каталог, созданный отчет будет неправильным.

Конфигурация виртуальной машины записывается один раз при запуске профилирования и сохраняется в файле VMDetailList.xml. Эти сведения используются во время создания отчета. Изменения в конфигурации виртуальной машины (например, увеличение числа ядер, дисков, сетевых карт и т. д.), внесенные после запуска профилирования до завершения этого процесса, не записываются. Если конфигурация виртуальной машины изменилась во время профилирования в общедоступной предварительной версии планировщика, ниже приведены рекомендации для получения последних сведений о виртуальной машине, используемых при создании отчета.   

* Создайте резервную копию файла VMdetailList.xml и удалите его из текущего расположения.
* Передайте аргументы -User и -Password во время создания отчета.

Команда профилирования создает в каталоге профилирования несколько файлов. Не удаляйте их, так как это повлияет на создание отчета.

#####<a name="example-1-to-profile-virtual-machines-for-30-days-and-find-the-throughput-from-on-premises-to-azure"></a>Пример 1. Чтобы запустить профилирование виртуальных машин, выполняемое в течение 30 дней, и определить пропускную способность, достигаемую при репликации данных из локальной среды в Azure, выполните следующую команду:
ASRDeploymentPlanner.exe **-Operation** StartProfiling -Directory “E:\vCenter1_ProfiledData” **-Server** vCenter1.contoso.com **-VMListFile** “E:\vCenter1_ProfiledData\ProfileVMList1.txt”  **-NoOfDaysToProfile**  30  **-User** vCenterUser1 **-StorageAccountName**  asrspfarm1 **-StorageAccountKey** Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==

#####<a name="example-2-to-profile-virtual-machines-for-15-days"></a>Пример 2. Чтобы запустить профилирование виртуальных машин, выполняемое в течение 15 дней, выполните следующую команду:
ASRDeploymentPlanner.exe **-Operation** StartProfiling **-Directory** “E:\vCenter1_ProfiledData” **-Server** vCenter1.contoso.com **-VMListFile** “E:\vCenter1_ProfiledData\ProfileVMList1.txt”  **-NoOfDaysToProfile**  15  -User vCenterUser1

#####<a name="example-3-to-profile-virtual-machines-for-1-hour-for-a-quick-test-of-the-tool"></a>Пример 3. Чтобы запустить профилирование виртуальных машин, выполняемое в течение часа (например, чтобы быстро проверить программу), выполните следующую команду:
ASRDeploymentPlanner.exe **-Operation** StartProfiling **-Directory** “E:\vCenter1_ProfiledData” **-Server** vCenter1.contoso.com **-VMListFile** “E:\vCenter1_ProfiledData\ProfileVMList1.txt”  **-NoOfDaysToProfile**  0.04  **-User** vCenterUser1


>[!NOTE]
>
> * Если сервер, на котором выполняется программа, перезагрузился или на нем произошел сбой, а также если вы вышли из нее, нажав клавиши CTRL+C, данные профилирования сохраняются. Однако вы можете потерять данные за последние 15 минут. После перезагрузки сервера планировщик необходимо повторно запустить в режиме профилирования.
>
> * Получив имя и ключ учетной записи хранения Azure, программа измеряет пропускную способность на последнем этапе профилирования. Если она прерывает работу до завершения профилирования, пропускная способность не измеряется. Чтобы определить пропускную способность перед созданием отчета, вы можете в любое время выполнить операцию GetThroughput в консоли командной строки. В противном случае сведения о достигаемой пропускной способности не будут включены в отчет.
>

##<a name="generate-report"></a>Создание отчета
Планировщик создает отчет в формате XLSM. В нем содержатся все рекомендации по развертыванию. Этот отчет имеет имя DeploymentPlannerReport_<Unique Numeric Identifier>.xlsm и хранится в указанном каталоге.

После завершения профилирования планировщик можно запустить в режиме создания отчетов. Ниже приведен список обязательных и необязательных параметров для запуска программы в режиме создания отчетов. Параметры, заключенные в квадратные скобки ([]), являются необязательными.

ASRDeploymentPlanner.exe -Operation GenerateReport /?

|Имя параметра | Описание |
|-|-|
| -Operation | Создание отчета. |
| -Server |  Полное доменное имя или IP-адрес сервера vCenter Server или сервера vSphere (имя или IP-адрес должны полностью совпадать с используемыми во время профилирования), где расположены виртуальные машины, для которых необходимо создать отчет. Обратите внимание, если профилирование выполняется на сервере vCenter Server, вы не можете использовать для создания отчетов сервер vSphere (и наоборот).|
| -VMListFile | Файл со списком профилированных виртуальных машин, для которых необходимо создать отчет. Путь к файлу может быть абсолютным или относительным. Этот файл должен содержать по одному имени или IP-адресу виртуальной машины в каждой строке. Имена виртуальных машин, указанные в файле, должны совпадать с именами на сервере vCenter Server или узле ESXi, а также с именами, используемыми в процессе профилирования.|
| [-Directory] | UNC-путь или путь к локальному каталогу, в котором хранятся данные профилирования (файлы, созданные в процессе профилирования). Эти данные используются для создания отчета. Если путь не указан, используется каталог ProfiledData. |
| [-GoalToCompleteIR] |    Время (в часах), необходимое для завершения начальной репликации профилированных виртуальных машин. В созданном отчете содержатся сведения о количестве виртуальных машин, репликацию которых можно выполнить в течение указанного времени. По умолчанию — 72 часа. |
| [-User] | Имя пользователя, используемое для подключения к серверу vCenter Server или vSphere. Эти данные используются для получения последних сведений о конфигурации виртуальных машин, например о количестве дисков, ядер, сетевых карт и т. д., используемых в отчете. Если не указать это значение, используются сведения о конфигурации, полученные в начале профилирования. |
| [-Password] | Пароль, используемый для подключения к серверу vCenter Server или узлу ESXi. Если не указать его в качестве параметра, запрос на ввод пароля отобразится позже после выполнения команды. |
| [-DesiredRPO] | Требуемая целевая точка восстановления в минутах. По умолчанию — 15 минут.|
| [-Bandwidth] | Пропускная способность в Мбит/с. Это значение используется для вычисления значения целевой точки восстановления, которого можно достигнуть для указанной пропускной способности. |
| [-StartDate]  | Дата и время начала в формате ММ-ДД-ГГГГ:ЧЧ:ММ (24-часовой цикл). Дату начала необходимо указать вместе с датой окончания. Если указать это значение, отчет будет создан на основе данных, собранных в этот период. |
| [-EndDate] | Дата и время окончания в формате ММ-ДД-ГГГГ:ЧЧ:ММ (24-часовой цикл). Дату окончания необходимо указать вместе с датой начала. Если указать это значение, отчет будет создан на основе данных, собранных в этот период. |
| [-GrowthFactor] |Коэффициент роста в процентах. По умолчанию — 30 %.  |


##### <a name="example-1-to-generate-report-with-default-values-when-profiled-data-is-on-the-local-drive"></a>Пример 1. Чтобы создать отчет со значениями по умолчанию, когда данные профилирования находятся на локальном диске, выполните следующую команду:
ASRDeploymentPlanner.exe **-Operation** GenerateReport **-Server** vCenter1.contoso.com **-Directory** “E:\vCenter1_ProfiledData” **-VMListFile** “E:\vCenter1_ProfiledData\ProfileVMList1.txt”


##### <a name="example-2-to-generate-report-when-profiled-data-is-on-a-remote-server-user-should-have-readwrite-access-on-the-remote-directory"></a>Пример 2. Чтобы создать отчет, когда данные профилирования находятся на удаленном сервере, выполните приведенную ниже команду. Пользователь должен иметь доступ на чтение и запись к удаленному каталогу.
ASRDeploymentPlanner.exe **-Operation** GenerateReport **-Server** vCenter1.contoso.com **-Directory** “\\PS1-W2K12R2\vCenter1_ProfiledData” **-VMListFile** “\\PS1-W2K12R2\vCenter1_ProfiledData\ProfileVMList1.txt”

##### <a name="example-3-generate-report-with-specific-bandwidth-and-goal-to-complete-ir-within-specified-time"></a>Пример 3. Чтобы создать отчет с определенной пропускной способностью при необходимости выполнить начальную репликацию в указанный интервал времени, выполните следующую команду:
ASRDeploymentPlanner.exe **-Operation** GenerateReport **-Server** vCenter1.contoso.com **-Directory** “E:\vCenter1_ProfiledData” **-VMListFile** “E:\vCenter1_ProfiledData\ProfileVMList1.txt” **-Bandwidth** 100 **-GoalToCompleteIR** 24

##### <a name="example-4-generate-report-with-5-growth-factor-instead-of-the-default-30"></a>Пример 4. Чтобы создать отчет с коэффициентом роста 5 %, а не 30 % (значение по умолчанию), выполните следующую команду:
ASRDeploymentPlanner.exe **-Operation** GenerateReport **-Server** vCenter1.contoso.com **-Directory** “E:\vCenter1_ProfiledData” **-VMListFile** “E:\vCenter1_ProfiledData\ProfileVMList1.txt” **-GrowthFactor** 5

##### <a name="example-5-generate-report-with-a-subset-of-profiled-data-say-you-have-30-days-of-profiled-data-and-want-to-generate-the-report-for-only-20-days"></a>Пример 5. Чтобы создать отчет с подмножеством данных профилирования, выполните приведенную ниже команду. Предположим, что у вас есть данные профилирования за 30 дней, но вы хотите создать отчет только для 20 дней.
ASRDeploymentPlanner.exe **-Operation** GenerateReport **-Server** vCenter1.contoso.com **-Directory** “E:\vCenter1_ProfiledData” **-VMListFile** “E:\vCenter1_ProfiledData\ProfileVMList1.txt” **-StartDate**  01-10-2017:12:30 -**EndDate** 01-19-2017:12:30

##### <a name="example-6-generate-report-for-5-minutes-rpo"></a>Пример 6. Чтобы создать отчет для 5-минутной целевой точки восстановления, выполните следующую команду:
ASRDeploymentPlanner.exe **-Operation** GenerateReport **-Server** vCenter1.contoso.com **-Directory** “E:\vCenter1_ProfiledData” **-VMListFile** “E:\vCenter1_ProfiledData\ProfileVMList1.txt”  **-DesiredRPO** 5

### <a name="percentile-value-used-for-the-calculation"></a>Значение процентиля, используемое для вычисления
**Значение какого процентиля метрик производительности, собранных во время профилирования, по умолчанию использует планировщик при создании отчета?**

По умолчанию планировщик использует значения 95-го процентиля числа операций записи и чтения на диск в секунду, числа операций вода-вывода в секунду при записи и активности обработки данных, собранные во время профилирования всех виртуальных машин. Это гарантирует, что для определения требований к пропускной способности источника данных и целевой службы хранилища Azure не будут использоваться пиковые значения 100-ого процентиля, которые могут возникать на виртуальной машине из-за временных событий, например из-за выполнения задания архивации один раз в день, периодического индексирования базы данных, создания аналитического отчета или какого-либо другого кратковременного события, выполняющегося во время профилирования. При использовании значений 95-ого процентиля вы получите точные сведения об особенностях рабочей нагрузки, что, в свою очередь, позволяет обеспечить наилучшую производительность при выполнении этих рабочих нагрузок в Microsoft Azure. Мы не рекомендуем изменять это значение часто, но если вы решили сделать это, например изменить на 90-й процентиль, обновите эту конфигурацию в файле ASRDeploymentPlanner.exe.config, который находится в каталоге по умолчанию, а затем сохраните этот файл, чтобы создать отчет на основе имеющихся данных профилирования.

        &lsaquo;add key="WriteIOPSPercentile" value="95" /&rsaquo;>      
        &lsaquo;add key="ReadWriteIOPSPercentile" value="95" /&rsaquo;>      
        &lsaquo;add key="DataChurnPercentile" value="95" /&rsaquo;

### <a name="growth-factor"></a>Коэффициент роста
**Почему необходимо учитывать коэффициент роста при планировании развертывания?**

Крайне важно учитывать расширение характеристик рабочей нагрузки при увеличении шаблона использования с течением времени. Это связано с тем, что после установки защиты виртуальной машины изменяются характеристики рабочей нагрузки. Сейчас невозможно переключиться на другую учетную запись хранения Azure, не отключая защиту. Например:  Если сейчас виртуальная машина находится в учетной записи репликации хранилища класса Standard и, скажем, через&3; месяца из-за увеличения количества пользователей приложения, запущенного на этой виртуальной машине, объем данных на ней вырастет, вам потребуется перейти на хранилище класса Premium. Это позволит Azure Site Recovery обрабатывать еще больший объем данных во время репликации. Для этого вам потребуется отключить защиту, а затем повторно включить ее в учетной записи хранения класса Premium. Поэтому мы настоятельно рекомендуем спланировать рост во время планирования развертывания. По умолчанию коэффициент роста составляет 30 %. Вы знаете шаблон использования ваших приложений и можете оценить рост их использования. Измените этот коэффициент соответствующим образом при создании отчета. Кроме того, вы можете создать несколько отчетов с разными коэффициентами роста на основе тех же данных профилирования и оценить, какие рекомендации к пропускной способности источника данных и целевой службы хранилища Azure лучше всего соответствуют вашим требованиям.

Созданный отчет Microsoft Excel состоит из следующих страниц:

* [Входные данные](site-recovery-deployment-planner.md#input)
* [Рекомендации](site-recovery-deployment-planner.md#recommendations-with-desired-rpo-as-input)
* [Рекомендации по вводу значения пропускной способности](site-recovery-deployment-planner.md#recommendations-with-available-bandwidth-as-input)
* [Размещение хранилища виртуальной машины](site-recovery-deployment-planner.md#vm-storage-placement)
* [Совместимые виртуальные машины](site-recovery-deployment-planner.md#compatible-vms)
* [Несовместимые виртуальные машины](site-recovery-deployment-planner.md#incompatible-vms)

![Планировщик ресурсов](./media/site-recovery-deployment-planner/dp-report.png)


##<a name="get-throughput"></a>Оценка пропускной способности.
Чтобы оценить пропускную способность, которую Azure Site Recovery может достигнуть при репликации данных из локальной среды в Azure, запустите программу в режиме GetThroughput. Планировщик вычисляет пропускную способность на сервере, где он запущен (в идеале используется сервер, конфигурация оборудования которого соответствует рекомендациям по размеру сервера конфигурации).  Если вы уже развернули компоненты инфраструктуры Azure Site Recovery в локальной среде, запустите эту программу на сервере конфигурации.

Откройте консоль командной строки и перейдите в папку планировщика ресурсов ASR.  Запустите ASRDeploymentPlanner.exe с указанными ниже параметрами. Параметры, заключенные в квадратные скобки ([]), являются необязательными.

ASRDeploymentPlanner.exe -Operation GetThroughput /?

|Имя параметра | Описание |
|-|-|
| -operation | Оценка пропускной способности. |
| [-Directory] | UNC-путь или путь к локальному каталогу, в котором хранятся данные профилирования (файлы, созданные в процессе профилирования). Эти данные используются для создания отчета. Если путь не указан, используется каталог ProfiledData.  |
| -StorageAccountName | Имя учетной записи хранения Azure, используемой для определения пропускной способности, необходимой для репликации данных из локальной среды в Azure. Программа отправляет тестовые данные в эту учетную запись хранения, чтобы рассчитать используемую пропускную способность. |
| -StorageAccountKey | Ключ, используемый для доступа к учетной записи хранения Azure. Перейдите на портал Azure и выберите "Учетные записи хранения" > [Имя_учетной записи_хранения] > "Параметры" > "Ключи доступа" > Ключ 1 (или первичный ключ доступа для классической учетной записи хранения). |
| -VMListFile | Файл со списком виртуальных машин, профилирование которых необходимо выполнить, для расчета используемой пропускной способности. Путь к файлу может быть абсолютным или относительным. Этот файл должен содержать по одному имени или IP-адресу виртуальной машины в каждой строке. Имена виртуальных машин, указанные в файле, должны совпадать с именами на сервере vCenter Server или в узле ESXi.<br>Например:  файл VMList.txt содержит следующие виртуальные машины:<br>virtual machine_A <br>10.150.29.110<br>virtual machine_B|

Планировщик создает в указанном каталоге несколько файлов asrvhdfile<#>.vhd емкостью 64 МБ (# — число),  а затем передает их в учетную запись хранения Azure для определения пропускной способности. После измерения пропускной способности он удаляет эти файлы из учетной записи хранения Azure и локального сервера. Если программа по каким-либо причинам прерывает работу, не завершив оценку пропускной способности, она не удаляет файлы. Их необходимо удалить вручную.

Пропускная способность измеряется в определенный момент времени. Это максимальная пропускная способность, которой может достигнуть Azure Site Recovery во время репликации (при условии, что все остальные факторы не изменяются). Например, если любое приложение начинает использовать больший объем пропускной способности сети, тогда фактическая пропускная способность меняется во время репликации. При выполнении команды GetThroughput на сервере конфигурации планировщик не учитывает все защищенные виртуальные машины и непрерывную репликацию. Если выполнить команду GetThroughput на защищенных виртуальных машинах с активной обработкой данных, результаты измерения пропускной способности будут отличаться от результатов, полученных на виртуальных машинах с менее интенсивной обработкой данных.  Мы рекомендуем запустить программу несколько раз во время профилирования, чтобы оценить, какую пропускную способность можно достигнуть в разные моменты времени. В отчете планировщик отображает последнюю измеренную пропускную способность.


##### <a name="example"></a>Пример
ASRDeploymentPlanner.exe **-Operation** GetThroughput **-Directory**  E:\vCenter1_ProfiledData **-VMListFile** E:\vCenter1_ProfiledData\ProfileVMList1.txt  **-StorageAccountName**  asrspfarm1 **-StorageAccountKey** by8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==

>[!NOTE]
>
> * Запустите программу на сервере с такими же характеристиками хранилища и ЦП, что и на сервере конфигурации.
>
> * При выполнении репликации подготовьте объем пропускной способности, необходимый для соблюдения требований к RPO 100 % времени. Если после подготовки достаточной пропускной способности вы не видите улучшений в полученных в отчете результатах, выполните следующее:
>
> а. Проверьте наличие требований к качеству обслуживания сети, которые ограничивают пропускную способность Azure Site Recovery.
>
> b. Проверьте, находится ли хранилище Azure Site Recovery в ближайшем поддерживаемом физическом регионе Microsoft Azure, чтобы минимизировать сетевые задержки.
>
> c. Проверьте характеристики локального хранилища и улучшите оборудование (например, замените жесткие диски на твердотельные и т. д.).
>
> г) Измените параметры Azure Site Recovery на сервере обработки, чтобы [увеличить объем пропускной способности сети, необходимой для репликации](./site-recovery-plan-capacity-vmware.md#control-network-bandwidth).
>

##<a name="recommendations-with-desired-rpo-as-input"></a>Рекомендации относительно требуемого значения RPO

###<a name="profiled-data"></a>Данные профилирования

![Планировщик ресурсов](./media/site-recovery-deployment-planner/profiled-data-period.png)

**Profiled data period** (Период профилирования данных) — длительность выполнения профилирования. По умолчанию программа использует для вычисления все данные профилирования, за исключением случаев, когда отчет создается для определенного периода времени с использованием параметров StartDate и EndDate.

**Имя сервера** — имя или IP-адрес сервера VMware vCenter Server или узла ESXi, для виртуальных машин которого создается отчет.

**Desired RPO** (Требуемое значение RPO) — необходимое значение целевой точки восстановления для развертывания. По умолчанию необходимая пропускная способность рассчитывается для значений RPO, равных 15, 30 и 60 минутам. В зависимости от выбора в отчете обновляются затронутые значения. Если во время создания отчета вы использовали параметр DesiredRPOinMin, это значение отображается в раскрывающемся списке Desired RPO (Требуемое значение RPO).

###<a name="profiling-overview"></a>Общие сведения о профилировании

![Планировщик ресурсов](./media/site-recovery-deployment-planner/profiling-overview.png)

**Total Profiled Virtual Machines** (Общее число профилированных виртуальных машин) — общее количество виртуальных машин, данные профилирования которых доступны. Если в качестве значений параметра VMListFile заданы виртуальные машины, профилирование которых не выполнялось, они не учитываются при создании отчета и исключаются из общего числа профилированных виртуальных машин.

**Compatible Virtual Machines** (Совместимые виртуальные машины) — число виртуальных машин, которые можно защитить с помощью Azure Site Recovery. Это общее число совместимых виртуальных машин, использующих пропускную способность сети, а также необходимое число учетных записей хранения, ядер Microsoft Azure, серверов конфигурации и дополнительных серверов обработки. Сведения о каждой совместимой виртуальной машине можно просмотреть на соответствующей странице в отчете.

**Incompatible Virtual Machines** (Несовместимые виртуальные машины) — число виртуальных машин, которые нельзя защитить с помощью Azure Site Recovery. Причины несовместимости см. в разделе "Несовместимые виртуальные машины" ниже. Если в качестве значений параметра VMListFile заданы виртуальные машины, профилирование которых не выполнялось, они исключаются из общего числа несовместимых виртуальных машин. Эти виртуальные машины перечислены в списке Data not found (Данные не найдены) в нижней части страницы Incompatible Virtual Machines (Несовместимые виртуальные машины).

**Desired RPO** (Требуемое значение RPO) — необходимое значение целевой точки восстановления в минутах. Отчет создается на основе трех значений RPO: 15, 30 и 60 минут. По умолчанию используется значение 15 минут. Рекомендации относительно пропускной способности будут изменяться в отчете в зависимости от значения, выбранного в раскрывающемся списке Desired RPO (Требуемое значение RPO). Этот список расположен в верхнем правом углу страницы. Если при создании отчета вы использовали другое значение параметра DesiredRPO, оно будет отображаться в этом раскрывающемся списке в качестве значения по умолчанию.

###<a name="required-network-bandwidth-mbps"></a>Требуемая пропускная способность (Мбит/с)

![Планировщик ресурсов](./media/site-recovery-deployment-planner/required-network-bandwidth.png)

**To meet RPO 100% of the time** (Соблюдение требований к RPO 100 % времени). Рекомендуемая пропускная способность (в Мбит/с), необходимая для соблюдения требований к RPO в 100 % случаев. Это объем пропускной способности, необходимый для разностной репликации в устойчивом состоянии всех совместимых виртуальных машин, чтобы избежать каких-либо нарушений требований к RPO.

**To meet RPO 90% of the time** (Соблюдение требований к RPO 90 % времени). Из-за цены на высокоскоростное подключение или по какой-либо другой причине, когда вы не можете подготовить объем пропускной способности, необходимый для соблюдения требований к RPO 100 % времени, вы можете подготовить меньший объем пропускной способности, необходимый для соблюдения требований к RPO 90 % времени. Чтобы оценить влияние подготовки этого меньшего объема, в отчете можно просмотреть сведения о возможном количестве нарушений требований к RPO и их продолжительности.

**Achieved Throughput** (Достигнутая пропускная способность). Пропускная способность сервера, на котором вы выполнили команду GetThroughput, доступная для региона Microsoft Azure, где расположена учетная запись хранения Azure. Это значение указывает примерную пропускную способность, которой можно достичь при защите совместимых виртуальных машин с помощью Azure Site Recovery при условии, что характеристики хранилища и сети сервера конфигурации и сервера обработки такие же, как и на сервере, на котором вы запустили программу. Достигнутая пропускная способность — это пропускная способность сервера, на котором вы выполнили команду GetThroughput, доступная для региона Microsoft Azure, где расположена учетная запись хранения Azure. Это значение указывает примерную пропускную способность, которой можно достичь при защите совместимых виртуальных машин с помощью Azure Site Recovery при условии, что характеристики хранилища и сети сервера конфигурации и сервера обработки такие же, как и на сервере, на котором вы запустили программу.

При выполнении репликации подготовьте объем пропускной способности, необходимый для соблюдения требований к RPO 100 % времени. Если после подготовки достаточной пропускной способности вы не видите улучшений в полученных в отчете результатах, выполните следующее:

а.    Проверьте наличие требований к качеству обслуживания сети, которые ограничивают пропускную способность Azure Site Recovery.

b.    Проверьте, находится ли хранилище Azure Site Recovery в ближайшем поддерживаемом физическом регионе Microsoft Azure, чтобы минимизировать сетевые задержки.

c.    Проверьте характеристики локального хранилища и улучшите оборудование (например, замените жесткие диски на твердотельные и т. д.).

d. Измените параметры Azure Site Recovery на сервере обработки, чтобы [увеличить объем пропускной способности сети, необходимой для репликации](./site-recovery-plan-capacity-vmware.md#control-network-bandwidth).

Если вы запустили программу на сервере конфигурации или сервере обработки, на котором уже расположены защищенные виртуальные машины, запустите ее еще несколько раз, так как значение достигаемой пропускной способности будет изменяться в зависимости от активности обработки данных в определенный момент времени.

Для всех развертываний Azure Site Recovery в корпоративных средах мы рекомендуем использовать [ExpressRoute](https://aka.ms/expressroute).

###<a name="required-azure-storage-accounts"></a>Required Azure Storage Accounts (Требуемые учетные записи хранения Azure)
На этой диаграмме показано общее число учетных записей хранения Azure (класса Standard и Premium), необходимое для защиты всех совместимых виртуальных машин.  Чтобы узнать, какую учетную запись хранения необходимо использовать для каждой виртуальной машины, щелкните [Recommended VM placement plan](site-recovery-deployment-planner.md#vm-storage-placement) (Рекомендуемый план размещения виртуальной машины).  

![Планировщик ресурсов](./media/site-recovery-deployment-planner/required-azure-storage-accounts.png)

###<a name="required-number-of-azure-cores"></a>Required Number of Azure Cores (Необходимое число ядер Azure)
Это значение указывает на общее число ядер, которое необходимо подготовить перед отработкой отказа (или тестовой отработкой отказа) всех совместимых виртуальных машин. Если в подписке недоступно необходимое количество ядер, Azure Site Recovery не сможет создать виртуальные машины и этот процесс завершится сбоем во время отработки отказа (или тестовой отработки отказа).

![Планировщик ресурсов](./media/site-recovery-deployment-planner/required-number-of-azure-cores.png)

###<a name="required-on-premises-infrastructure"></a>Required On-premises Infrastructure (Необходимая локальная инфраструктура)
Это значение указывает на общее число серверов конфигурации и дополнительных серверов обработки, которые необходимо настроить для защиты всех совместимых виртуальных машин. В зависимости от поддерживаемых [ограничений](https://aka.ms/asr-v2a-on-prem-components) максимальной конфигурации, например ограничений на объем обработки данных в день или максимальное количество защищенных виртуальных машин (при условии, что к каждой виртуальной машине подключено три диска), на сервере конфигурации или дополнительном сервере планировщик рекомендует использовать дополнительные серверы. Сведения об общем числе данных, обработанных за день, и общем числе защищенных дисков можно просмотреть на странице [Входные данные](site-recovery-deployment-planner.md#input).

![Планировщик ресурсов](./media/site-recovery-deployment-planner/required-on-premises-infrastructure.png)

###<a name="what-if-analysis"></a>Анализ "что если"
В этом анализе отображаются сведения о возможном количестве нарушений, которые могут произойти в процессе профилирования при выделении меньшего объема пропускной способности, необходимой для соблюдения требований к RPO только 90 % времени. Это может быть одно или несколько нарушений, которые могут произойти в любой заданный день. На диаграмме показано максимальное значение RPO за день.
По результатам анализа вы можете определить, допустимо ли количество нарушений требований к RPO за все время и максимальное значение RPO за день для выделенного объема пропускной способности. В зависимости от результатов вы можете выделить меньший объем пропускной способности для репликации или повысить ее пределы для соблюдения требований к RPO 100 % времени.

![Планировщик ресурсов](./media/site-recovery-deployment-planner/what-if-analysis.png)

###<a name="recommended-vm-batch-size-for-initial-replication"></a>Recommended VM batch size for initial replication (Рекомендуемый размер пакета виртуальных машин для начальной репликации)
В этом разделе приведено рекомендуемое число виртуальных машин, которые можно защищать в параллельном режиме, чтобы завершить начальную репликацию в течение 72 часов (это значение можно изменить во время создания отчета с помощью параметра GoalToCompleteIR) с пропускной способностью, необходимой для соблюдения требований к RPO 100 % времени.  На диаграмме отображается диапазон значений пропускной способности и рекомендуемый размер пакета виртуальных машин, необходимые для завершения начальной репликации в течение 72 часов. Размер пакета определяется на основе среднего размера всех совместимых виртуальных машин.  

В общедоступной предварительной версии в отчет не входят сведения о том, какие виртуальные машины необходимо добавить в пакет. Вы можете просмотреть размер каждой виртуальной машины на странице Compatible Virtual Machines (Совместимые виртуальные машины), а затем на основе этих сведений или известных характеристиках рабочей нагрузки сформировать пакет.  Время выполнения начальной репликации изменяется пропорционально в зависимости от фактического размера диска виртуальной машины, используемого дискового пространства и доступной пропускной способности сети.

![Планировщик ресурсов](./media/site-recovery-deployment-planner/recommended-vm-batch-size.png)

###<a name="growth-factor-and-percentile-values-used"></a>Коэффициент роста и используемые значения процентилей
Этот раздел находится в нижней части страницы. В нем содержатся сведения о значении процентиля, используемом для всех счетчиков производительности профилированных виртуальных машин (по умолчанию 95-й процентиль), а также о коэффициенте роста (в процентах), используемом во всех вычислениях (по умолчанию 30 %).

![Планировщик ресурсов](./media/site-recovery-deployment-planner/max-iops-and-data-churn-setting.png)

##<a name="recommendations-with-available-bandwidth-as-input"></a>Рекомендации по вводу значения доступной пропускной способности

![Планировщик ресурсов](./media/site-recovery-deployment-planner/profiling-overview-bandwidth-input.png)

Возможны ситуации, когда вы не сможете подготовить для репликации Azure Site Recovery достаточный объем пропускной способности. Эта программа позволяет вам во время создания отчета ввести значение доступной пропускной способности (с помощью параметра -Bandwidth) и получить достигаемое значение RPO в минутах. На основе полученного значения вы можете определить, нужно ли подготавливать дополнительный объем пропускной способности или можно просто создать решение для аварийного восстановления.

![Планировщик ресурсов](./media/site-recovery-deployment-planner/achievable-rpos.png)

##<a name="input"></a>Входные данные
На странице "Входные данные" содержатся общие сведения о профилированной среде VMware.

![Планировщик ресурсов](./media/site-recovery-deployment-planner/Input.png)

**"Дата начала" и "Дата окончания"** — даты начала и окончания профилирования данных, используемых при создании отчета. По умолчанию"Дата начала" — дата начала профилирования, а "Дата окончания" — дата окончания.  При создании отчета с этими параметрами им соответствуют значения StartDate и EndDate. "Дата начала" и "Дата окончания" — даты начала и окончания профилирования данных, используемых при создании отчета. По умолчанию"Дата начала" — дата начала профилирования, а "Дата окончания" — дата окончания.  При создании отчета с этими параметрами им соответствуют значения StartDate и EndDate.

**Total number of profiling days** (Общее число дней профилирования) — общее число дней профилирования между датами начала и окончания, для которых создается отчет. Total number of profiling days (Общее число дней профилирования) — общее число дней профилирования между датами начала и окончания, для которых создается отчет.

**Number of compatible virtual machines** (Число совместимых виртуальных машин) — это общее число совместимых виртуальных машин, использующих пропускную способность сети, а также необходимое число учетных записей хранения, ядер Microsoft Azure, серверов конфигурации и дополнительных серверов обработки.
Total number of disks across all compatible virtual machines (Общее число дисков на всех совместимых виртуальных машинах) — общее число дисков на всех совместимых виртуальных машинах. Это значение используется в качестве одного из входных параметров при определении необходимого числа серверов конфигурации и дополнительных серверов обработки, используемых во время развертывания.

**Average number of disks per compatible virtual machine** (Среднее число дисков на каждой совместимой виртуальной машине) — среднее число дисков, вычисленное для всех совместимых виртуальных машин.

**Average disk size (GB)** (Средний размер диска (ГБ)) — средний размер диска, вычисленный для всех совместимых виртуальных машин.

**Desired RPO (minutes)** (Требуемое значение RPO (в минутах)) — значение RPO по умолчанию или значение, заданное для параметра DesiredRPO во время создания отчета для оценки необходимой пропускной способности.

**Desired bandwidth (Mbps)** (Необходимая пропускная способность (Мбит/с)) — значение, заданное для параметра Bandwidth во время создания отчета для оценки достигаемого значения RPO.

**Observed typical data churn per day (GB)** (Стандартная активность обработки данных в день (ГБ)) — среднее значение обработки данных в течение профилирования. Это значение используется в качестве одного из входных параметров при определении необходимого числа серверов конфигурации и дополнительных серверов обработки, используемых во время развертывания.


##<a name="vm-storage-placement"></a>Размещение хранилища виртуальной машины

![Планировщик ресурсов](./media/site-recovery-deployment-planner/vm-storage-placement.png)

**Disk Storage Type** (Тип хранилища дисков) — учетная запись хранения Azure класса Standard или Premium, используемая для репликации всех соответствующих виртуальных машин, указанных в столбце VMs to Place (Виртуальные машины для размещения).

**Suggested Prefix** (Рекомендуемый префикс) — префикс из трех знаков, который можно использовать для создания имени учетной записи хранения Azure. Вы всегда можете использовать собственный префикс, но для программы мы рекомендуем использовать префикс, соответствующий требованиям [соглашения об именовании секций учетных записей хранения Azure](https://aka.ms/storage-performance-checklist).

**Suggested Account Name** (Рекомендуемое имя учетной записи). Указывает, как должно выглядеть имя учетной записи хранения Azure после добавления рекомендуемого префикса. Замените имя в угловых скобках именем своей учетной записи.

**Log Storage Account** (Учетная запись хранения журналов). Все журналы репликации хранятся в учетной записи хранения Azure класса Standard. Если репликация виртуальных машин выполняется в учетную запись хранения Azure класса Premium, для хранения журналов необходимо подготовить дополнительную учетную запись класса Standard. Одна учетная запись хранения журналов класса Standard может использоваться несколькими учетными записями хранения репликации класса Premium. Виртуальные машины, реплицированные в учетные записи хранения класса Standard, используют ту же учетную запись хранения для журналов.

**Suggested Log Account Name** (Рекомендуемое имя учетной записи хранения журналов). Указывает, как должно выглядеть имя учетной записи хранения журналов Azure после добавления рекомендуемого префикса. Замените имя в угловых скобках именем своей учетной записи.

**Placement Summary** (Сводка размещения) — сводные данные об общем числе виртуальных машин, переданных в учетную запись хранения Azure во время репликации и отработки отказа (или тестовой отработки отказа). В этом столбце содержатся сведения об общем числе виртуальных машин, сопоставленных с учетной записью хранения Azure, общем количестве операций записи и чтения на диск в секунду на всех виртуальных машинах, размещенных в этой учетной записи, общем количестве операций ввода-вывода в секунду при записи (репликации), общем объеме подготовленного пространства на всех дисках и общем числе дисков.

В столбце **Virtual Machines to Place** (Виртуальные машины для размещения) перечислены все виртуальные машины, которые необходимо поместить в определенную учетную запись для обеспечения оптимальной производительности и эффективного использования.

##<a name="compatible-vms"></a>Совместимые виртуальные машины
![Планировщик ресурсов](./media/site-recovery-deployment-planner/compatible-vms.png)

**Имя виртуальной машины** — имя или IP-адрес виртуальной машины, заданные в качестве значения параметра VMListFile во время создания отчета. В этом столбце также перечислены диски (VMDK-файлы), присоединенные к виртуальным машинам.

Параметр **VM Compatibility** (Совместимость виртуальной машины) имеет два значения: "Да" и "Да*". Значение "Да*" используется в тех случаях, когда виртуальная машина подготавливается для [службы хранилища Azure класса Premium](https://aka.ms/premium-storage-workload). За счет высокой активности обработки данных и обработки большого числа операций ввода-вывода в секунду на диске она подходит для категории P20 или P30, но из-за размера диска она сопоставляется с категорией P10 или P20. Служба хранилища Azure определяет, с каким типом диска хранилища класса Premium сопоставить диск виртуальной машины на основе его размера, то есть если емкость диска составляет меньше 128 ГБ он сопоставляется с категорией P10, от 128 до 512 ГБ — с категорией P20 и от 512 до 1023 ГБ — с категорией P30. Поэтому, если из-за характеристик рабочей нагрузки диска виртуальная машина подпадает под категорию P20 или P30, но из-за своего размера этот диск сопоставляется с типом диска хранилища класса Premium более низкой категории, программа отмечает эту виртуальную машину значением "Да*" и рекомендует вам либо изменить размер исходного диска для соответствия рекомендуемому типу диска хранилища класса Premium, либо изменить тип целевого диска после отработки отказа.
Используйте хранилище класса Standard или Premium.

**Suggested Prefix** (Рекомендуемый префикс) — префикс имени учетной записи хранения Azure, состоящий из трех знаков.

**Учетная запись хранения** — имя, к которому добавляется рекомендуемый префикс.

**R/W IOPS (with Growth Factor)** (Количество операций записи и чтения на диск в секунду (с коэффициентом роста)) — пиковое значение числа операций ввода-вывода в секунду на диске (95-й процентиль), включая будущий коэффициент роста (по умолчанию 30 %). Обратите внимание, что общее число операций записи и чтения на диск в секунду не всегда вычисляется путем сложения операций записи и чтения каждого отдельного диска виртуальной машины, так как максимальное число операций записи и чтения в секунду виртуальной машины состоит из максимальных значений каждого отдельного диска в течение каждой минуты процесса профилирования.

**Data Churn in Mbps (with Growth Factor)** (Активность обработки данных на диске в Мбит/с (с коэффициентом роста)) — пиковая скорость обработки данных на диске (95-й процентиль), включая будущий коэффициент роста (по умолчанию 30 %). Обратите внимание, что общая скорость обработки данных виртуальной машины не всегда вычисляется путем сложения скорости обработки данных на каждом ее отдельном диске, так как максимальная скорость обработки данных виртуальной машины состоит из максимальных значений обработки на каждом отдельном диске в течение каждой минуты процесса профилирования.

**Azure VM Size** (Размер виртуальной машины Azure) — размер базовой виртуальной машины Azure, который лучше всего использовать для сопоставления с локальной виртуальной машиной. Это сопоставление выполняется на основе памяти, числа дисков, ядер, сетевых карт и операций записи и чтения на диск в секунду локальной виртуальной машины. Мы рекомендуем всегда использовать для сопоставления виртуальную машину Azure наименьшего размера, характеристики которой соответствуют всем этим характеристикам локальной виртуальной машины.

**Количество дисков** — общее количество дисков (VMDK-файлов) на виртуальной машине.

**Размер диска (ГБ)** — общий размер, выделенный на всех дисках виртуальной машины. Эта программа также показывает размер каждого отдельного диска виртуальной машины.

**Ядра** — количество ядер ЦП на виртуальной машине.

**Память (МБ)** — оперативная память виртуальной машины.

**Сетевые карты** — количество сетевых карт на виртуальной машине.

##<a name="incompatible-vms"></a>Несовместимые виртуальные машины

![Планировщик ресурсов](./media/site-recovery-deployment-planner/incompatible-vms.png)

**Имя виртуальной машины** — имя или IP-адрес виртуальной машины, заданные в качестве значения параметра VMListFile во время создания отчета. В этом столбце также перечислены диски (VMDK-файлы), присоединенные к виртуальным машинам.

Параметр **VM Compatibility** (Совместимость виртуальной машины) указывает, почему определенная виртуальная машина не поддерживает Azure Site Recovery. Причины приводятся для каждого несовместимого диска виртуальной машины, и в зависимости от опубликованных [ограничений](https://aka.ms/azure-storage-scalbility-performance) службы хранилища Azure эта проблема может быть вызвана следующим:

* Размер диска превышает 1023 ГБ. Сейчас служба хранилища Azure не поддерживает диски емкостью более 1 ТБ.
* Общий размер виртуальной машины (репликация и тестовая отработка отказа) превышает поддерживаемый размер учетной записи хранения (35 ТБ). Это обычно происходит на виртуальных машинах с одним диском, показатели производительности которого превышают максимально поддерживаемые ограничения Microsoft Azure или Azure Site Recovery для хранилища класса Standard, используемого для отправки виртуальной машины в зону хранилища класса Premium. Однако максимальный поддерживаемый размер учетной записи хранения класса Premium составляет 35 ТБ, и поэтому невозможно обеспечить защиту одной виртуальной машины в нескольких учетных записях хранения. Кроме того, обратите внимание, что если тестовая отработка отказа выполняется на защищенной виртуальной машине, этот процесс происходит в той же учетной записи хранения, где выполняется репликация. Поэтому на диске необходимо подготовить в 2 раза больше пространства для выполнения репликации и тестовой отработки отказа в параллельном режиме.
* Число операций ввода-вывода в секунду источника превышает поддерживаемое службой хранилища Azure ограничение в 5000 операций ввода-вывода в секунду на диск.
* Число операций ввода-вывода в секунду источника превышает поддерживаемое службой хранилища Azure ограничение в 80 000 операций ввода-вывода в секунду на виртуальную машину.
* Среднее значение скорости обработки данных превышает поддерживаемое Azure Site Recovery ограничение в 10 Мбит/с для среднего объема ввода-вывода на диск.
* Общая скорость обработки данных на всех дисках виртуальной машины превышает максимально поддерживаемое Azure Site Recovery ограничение в 54 Мбит/с на виртуальную машину.
* Среднее эффективное значение количества операций ввода-вывода в секунду при записи превышает поддерживаемое Azure Site Recovery ограничение в 840 операций на диск.
* Вычисленный объем хранилища моментальных снимков превышает поддерживаемое ограничение в 10 ТБ.

**R/W IOPS (with Growth Factor)** (Количество операций записи и чтения на диск в секунду (с коэффициентом роста)) — пиковое значение числа операций ввода-вывода в секунду на диске (95-й процентиль), включая будущий коэффициент роста (по умолчанию 30 %). Обратите внимание, что общее число операций записи и чтения на диск в секунду не всегда вычисляется путем сложения операций записи и чтения каждого отдельного диска виртуальной машины, так как максимальное число операций записи и чтения в секунду виртуальной машины состоит из максимальных значений каждого отдельного диска в течение каждой минуты процесса профилирования.

**Data Churn in Mbps (with Growth Factor)** (Активность обработки данных на диске в Мбит/с (с коэффициентом роста)) — пиковая скорость обработки данных на диске (95-й процентиль), включая будущий коэффициент роста (по умолчанию 30 %). Обратите внимание, что общая скорость обработки данных виртуальной машины не всегда вычисляется путем сложения скорости обработки данных на каждом ее отдельном диске, так как максимальная скорость обработки данных виртуальной машины состоит из максимальных значений обработки на каждом отдельном диске в течение каждой минуты процесса профилирования.

**Количество дисков** — общее количество дисков (VMDK-файлов) на виртуальной машине.

**Размер диска (ГБ)** — общий размер, выделенный на всех дисках виртуальной машины. Эта программа также показывает размер каждого отдельного диска виртуальной машины.

**Ядра** — количество ядер ЦП на виртуальной машине.

**Память (МБ)** — оперативная память виртуальной машины.

**Сетевые карты** — количество сетевых карт на виртуальной машине.


##<a name="azure-site-recovery-limits"></a>Ограничения Azure Site Recovery

**Целевое хранилище репликации** | **Средний размер ввода-вывода исходного диска** |**Средняя скорость обработки данных исходного диска** | **Общий размер обработанных данных на исходном диске за день**
---|---|---|---
Хранилище уровня "Стандартный" | 8 КБ    | 2 МБ/с | 168 ГБ на диск
Диск класса Premium категории P10 | 8 КБ    | 2 МБ/с | 168 ГБ на диск
Диск класса Premium категории P10 | 16 КБ | 4 МБ/с |    336 ГБ на диск
Диск класса Premium категории P10 | 32 КБ или выше | 8 МБ/с | 672 ГБ на диск
Диск класса Premium категории P20 или P30 | 8 КБ    | 5 МБ/с | 421 ГБ на диск
Диск класса Premium категории P20 или P30 | 16 КБ или выше |10 МБ/с    | 842 ГБ на диск


В указанных средних значениях предполагается 30%-е перекрытие операций ввода-вывода. В зависимости от коэффициента перекрытия, размера записи и фактической рабочей нагрузки ввода-вывода Azure Site Recovery может обрабатывать более высокую пропускную способность. В приведенных выше значениях предполагается, что длина очереди составляет примерно 5 минут (то есть после передачи выполняется обработка данных, а созданная точка восстановления составляет 5 минут).

Приведенные выше ограничения основаны на наших проверках, но они не охватывают все возможные сочетания операций ввода-вывода. Фактические результаты зависят от сочетания операций ввода-вывода приложения. Чтобы получить более точные сведения о производительности, мы рекомендуем всегда выполнять расширенное тестирование приложения с помощью тестовой отработки отказа.

##<a name="release-notes"></a>Заметки о выпуске
Общедоступная предварительная версия планировщика ресурсов Azure Site Recovery 1.0 имеет описанные ниже известные проблемы, которые будут устранены в предстоящих обновлениях.

* Эта программа поддерживает только сценарии развертывания виртуальных машин VMware в Azure. В сценариях развертывания виртуальных машин Hyper-V в Azure используйте [планировщик ресурсов Hyper-V](./site-recovery-capacity-planning-for-hyper-v-replication.md).
* Операция GetThroughput не поддерживается в регионах Microsoft Azure для государственных организаций США и в регионах Microsoft Azure в Китае.
* Программа не поддерживает профилирование виртуальных машин, если на сервере vCenter Server находится несколько виртуальных машин с одинаковым именем или IP-адресом, расположенных на разных узлах ESXi. В этой версии программа пропускает профилирование виртуальных машин, имена или IP-адреса которых заданы в качестве значения параметра VMListFile несколько раз. Обойти это можно, выполнив профилирование виртуальных машин на узле ESXi, а не на сервере vCenter Server. Необходимо запустить один экземпляр для каждого узла ESXi.

