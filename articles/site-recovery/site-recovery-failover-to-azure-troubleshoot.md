---
title: Устранение ошибок отработки отказа в Azure| Документация Майкрософт
description: В этой статье описываются способы устранения распространенных ошибок при отработке отказа в Azure.
services: site-recovery
documentationcenter: ''
author: ponatara
manager: abhemraj
editor: ''
ms.assetid: ''
ms.service: site-recovery
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 12/11/2018
ms.author: mayg
ms.openlocfilehash: 742e7891ec9c7151f23f1ad6eb57e728dd2a1ddd
ms.sourcegitcommit: 1c1f258c6f32d6280677f899c4bb90b73eac3f2e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2018
ms.locfileid: "53255097"
---
# <a name="troubleshoot-errors-when-failing-over-a-virtual-machine-to-azure"></a>Устранение ошибок при отработке отказа виртуальной машины в Azure

Во время выполнения отработки отказа виртуальной машины в Azure может появиться одна из следующих ошибок. Для устранения неполадок используйте описанные действия для каждого условия ошибки.

## <a name="failover-failed-with-error-id-28031"></a>Сбой отработки отказа (идентификатор ошибки 28031)

Службе Site Recovery не удалось создать в Azure виртуальную машину, для которой выполнена отработка отказа. Это может произойти по одной из следующих причин:

* Недостаточно квоты для создания виртуальной машины. Чтобы проверить доступную квоту, выберите "Подписка -> Usage + quotas" (Использование + квоты). Чтобы запросить увеличение квоты, отправьте [новый запрос на поддержку](http://aka.ms/getazuresupport).

* Вы пытаетесь совершить отработку отказа для виртуальных машин из разных семейств размеров в одной группе доступности. Убедитесь, что для всех виртуальных машин в одной группе доступности выбрано одно семейство размеров. Чтобы изменить размер, выберите параметры "Вычисления" и "Сеть" виртуальной машины, а затем повторите отработку отказа.

* Существует политика подписки, которая не допускает создания виртуальной машины. Измените политику таким образом, чтобы она разрешала создание виртуальных машин, а затем повторите отработку отказа.

## <a name="failover-failed-with-error-id-28092"></a>Сбой отработки отказа (идентификатор ошибки 28092)

Службе Site Recovery не удалось создать сетевой интерфейс для виртуальной машины, для которой была выполнена отработка отказа. Убедитесь, что у вас достаточно квоты для создания сетевых интерфейсов в подписке. Чтобы проверить доступную квоту, выберите "Подписка -> Usage + quotas" (Использование + квоты). Чтобы запросить увеличение квоты, отправьте [новый запрос на поддержку](http://aka.ms/getazuresupport). Если квоты достаточно, ошибка вызвана кратковременной проблемой. Повторите операцию. Если вам не удалось устранить проблему даже после нескольких попыток, оставьте комментарий в конце этого документа.  

## <a name="failover-failed-with-error-id-70038"></a>Сбой отработки отказа (идентификатор ошибки 70038)

Службе Site Recovery не удалось создать в Azure классическую виртуальную машину, для которой выполнена отработка отказа. Это могло произойти по таким причинам:

* Один из необходимых для виртуальной машины ресурсов, такой как виртуальная сеть, не существует. Создайте виртуальную сеть согласно требованиям параметров "Вычисления" и "Сеть" виртуальной машины или измените параметр на имеющуюся виртуальную сеть, а затем повторите отработку отказа.

## <a name="failover-failed-with-error-id-170010"></a>Сбой отработки отказа (идентификатор ошибки 170010)

Службе Site Recovery не удалось создать в Azure виртуальную машину, для которой выполнена отработка отказа. Это может произойти из-за сбоя внутреннего действия расконсервации для локальной виртуальной машины.

Чтобы открыть любой компьютер в Azure, необходимо, чтобы в среде Azure некоторые драйверы находились в состоянии запуска, а службы, такие как DHCP, — в состоянии автозапуска. Таким образом, действие расконсервации во время отработки отказа преобразует тип запуска  **драйверов atapi, intelide, storflt, vmbus и storvsc** в начало загрузки. Оно также преобразует тип запуска нескольких служб, таких как DHCP, в автозапуск. Это действие может завершиться ошибкой из-за проблем конкретной среды. Чтобы вручную изменить тип запуска драйверов, сделайте следующее:

1. [Скачайте](http://download.microsoft.com/download/5/D/6/5D60E67C-2B4F-4C51-B291-A97732F92369/Script-no-hydration.ps1) скрипт отсутствия расконсервации и запустите его следующим образом. Этот сценарий проверяет, требуется ли для виртуальной машины расконсервация.

    `.\Script-no-hydration.ps1`

    Если расконсервация требуется, появится следующий результат:

        REGISTRY::HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\services\storvsc           start =  3 expected value =  0

        This system doesn't meet no-hydration requirement.

    Если виртуальная машина соответствует требованиям отсутствия расконсервации, скрипт выдаст результат "Эта система соответствует требованиям отсутствия расконсервации". В этом случае все драйверы и службы находятся в состоянии, соответствующем требованиям Azure, и расконсервация на виртуальной машине не требуется.

2. Запустите скрипт no-hydration-set следующим образом, если виртуальная машина не отвечает требованиям отсутствия расконсервации.

    `.\Script-no-hydration.ps1 -set`
    
    Это преобразует тип загрузки драйверов, и будет получен результат, аналогичный следующему:
    
        REGISTRY::HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\services\storvsc           start =  3 expected value =  0 

        Updating registry:  REGISTRY::HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\services\storvsc   start =  0 

        This system is now no-hydration compatible. 

## <a name="unable-to-connectrdpssh-to-the-failed-over-virtual-machine-due-to-grayed-out-connect-button-on-the-virtual-machine"></a>Не удается подключиться по протоколу RDP или SSH к виртуальной машине, для которой выполнена отработка отказа, поскольку кнопка подключения неактивна на виртуальной машине

Если кнопка **Подключиться** на виртуальной машине, для которой выполнена отработка отказа, неактивна и вы не подключены к Azure через Express Route или VPN-подключение типа "сеть — сеть".

1. Перейдите в раздел **Виртуальная машина** > **Сеть** и нажмите на имя необходимого сетевого интерфейса.  ![сетевой интерфейс](media/site-recovery-failover-to-azure-troubleshoot/network-interface.PNG)
2. Откройте раздел **Конфигурации IP** и нажмите на поле имени необходимой конфигурации IP. ![Конфигурации IP](media/site-recovery-failover-to-azure-troubleshoot/IpConfigurations.png)
3. Чтобы включить общедоступный IP-адрес, нажмите **Включить**. ![Включить IP](media/site-recovery-failover-to-azure-troubleshoot/Enable-Public-IP.png)
4. Нажмите **Настроить обязательные параметры** > **Создать**. ![Создать](media/site-recovery-failover-to-azure-troubleshoot/Create-New-Public-IP.png)
5. Введите имя общедоступного адреса, выберите параметры по умолчанию для элементов **SKU** и **назначение** и нажмите **OK**.
6. Теперь нажмите **Сохранить**, чтобы сохранить изменения.
7. Закройте панели и перейдите в раздел **Обзор** виртуальной машины, чтобы подключиться по протоколу RDP.

## <a name="unable-to-connectrdpssh---vm-connect-button-available"></a>Невозможно подключиться по протоколу RDP или SSH. На виртуальной машине активна кнопка "Подключиться"

Если кнопка **Подключиться**на виртуальной машине, для которой выполнена отработка отказа, активна, тогда проведите **диагностику загрузки** на виртуальной машине и проверьте ее на наличие ошибок, как указано в [этой статье](../virtual-machines/windows/boot-diagnostics.md).

1. Если виртуальная машина не запустилась, попробуйте выполнить отработку отказа до предыдущей точки восстановления.
2. Если работа приложения на виртуальной машине не восстановится, попробуйте выполнить отработку отказа до согласованной с приложениями точки восстановления.
3. Если виртуальная машина присоединена к домену, убедитесь, что контроллер домена работает правильно. Следуйте приведенным инструкциям.

    a. Создайте виртуальную машину в той же сети.

    b.  Убедитесь, что ее можно присоединить к тому же домену, где должна находиться виртуальная машина, для которой выполнена отработка отказа.

    c. Если контроллер домена работает **неправильно**, попробуйте войти на виртуальную машину, для которой выполнена отработка отказа, используя учетную запись локального администратора.
4. Если вы работаете с пользовательским DNS-сервером, убедитесь, что он доступен. Следуйте приведенным инструкциям.

    a. Создайте виртуальную машину в той же сети.

    b. Убедитесь, что виртуальная машина может выполнить разрешение имен с помощью пользовательского DNS-сервера.

>[!Note]
>Для включения любого другого параметра, помимо диагностики загрузки, потребуется установить агент виртуальной машины Azure на виртуальную машину до отработки отказа.

## <a name="unexpected-shutdown-message-event-id-6008"></a>Сообщение о непредвиденном завершении работы (идентификатор события 6008)

Если при загрузке виртуальной машины Windows после отработки отказа появилось сообщение о непредвиденном завершении работы на восстановленной виртуальной машине, это указывает, что состояние завершения работы виртуальной машины не было записано в точке восстановления, используемой для отработки отказа. Это происходит, если выполняется восстановление до точки, когда виртуальная машина не завершила работу окончательно.

Обычно это не повод для беспокойства и сообщение можно игнорировать для внеплановых отработок отказа. В случае плановой отработки отказа убедитесь, что виртуальная машина правильно завершила работу до отработки отказа и обеспечьте достаточно времени для отправки локальных ожидающих репликации данных в Azure. Затем используйте параметр**Latest** на [экране отработки отказа](site-recovery-failover.md#run-a-failover) таким образом, чтобы все ожидающие данные в Azure обрабатывались в точке восстановления, которая затем будет использоваться для отработки отказа виртуальной машины.

## <a name="next-steps"></a>Дополнительная информация
- Устранение неполадок [с подключением к виртуальной машине Windows через удаленный рабочий стол](../virtual-machines/windows/troubleshoot-rdp-connection.md)
- Устранение неполадок [с SSH-подключением к виртуальной машине Linux](../virtual-machines/linux/detailed-troubleshoot-ssh-connection.md)

Если вам нужна дополнительная помощь, разместите свой запрос на [форуме Site Recovery](https://social.msdn.microsoft.com/Forums/azure/home?forum=hypervrecovmgr) или оставьте комментарий в конце этого документа. У нас есть активное сообщество, где вам смогут помочь.
