---
title: Миграция локальных компьютеров в Azure с помощью Azure Site Recovery | Документация Майкрософт
description: В этой статье описан процесс миграции локальных компьютеров в Azure с помощью Azure Site Recovery.
services: site-recovery
author: rayne-wiselman
ms.service: site-recovery
ms.topic: tutorial
ms.date: 02/27/2018
ms.author: raynew
ms.custom: MVC
ms.openlocfilehash: 3e82983ff171e638415d6e7cafe0cb034dd978af
ms.sourcegitcommit: d28bba5fd49049ec7492e88f2519d7f42184e3a8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2018
ms.locfileid: "34057161"
---
# <a name="migrate-on-premises-machines-to-azure"></a>Миграция локальных компьютеров в Azure

Службу [Azure Site Recovery](site-recovery-overview.md) можно использовать не только для того, чтобы администрировать и координировать аварийное восстановление локальных компьютеров и виртуальных машин Azure для обеспечения непрерывности бизнес-процессов и аварийного восстановления (BCDR), но и для управления миграцией локальных компьютеров в Azure.


В этом руководстве показано, как перенести локальные виртуальные машины и физические серверы в Azure. Из этого руководства вы узнаете, как выполнять такие задачи:

> [!div class="checklist"]
> * Выбор цели репликации
> * Настройка исходной и целевой среды.
> * Настройка политики репликации
> * Включение репликации
> * Запуск тестовой миграции, позволяющей убедиться в правильной работе всех компонентов.
> * Выполнение однократной отработки отказа в Azure.

Это третье руководство в серии. В этом руководстве предполагается, что вы уже выполнили задачи в предыдущих руководствах:

1. [Подготовка Azure](tutorial-prepare-azure.md).
2. Подготовка локальных серверов [VMware](vmware-azure-tutorial-prepare-on-premises.md) или [Hyper-V] (hyper-v-prepare-on-premises-tutorial.md).

Перед началом работы полезно изучить архитектуру [VMware](vmware-azure-architecture.md) или [Hyper-V](hyper-v-azure-architecture.md) для аварийного восстановления.


## <a name="prerequisites"></a>предварительным требованиям

Устройства, экспортированные с помощью паравиртуализированных драйверов, не поддерживаются.


## <a name="create-a-recovery-services-vault"></a>Создание хранилища служб восстановления

1. Войдите на [портал Azure](https://portal.azure.com) > **Службы восстановления**.
2. Последовательно выберите **Создать ресурс** > **Мониторинг и управление** > **Backup and Site Recovery**.
3. В поле **Имя** укажите понятное имя **ContosoVMVault**. Если у вас есть несколько подписок, выберите нужную.
4. Создайте группу ресурсов **ContosoRG**.
5. Укажите регион Azure. Сведения о поддерживаемых регионах см. в разделе "Географическая доступность" на странице [цен на службу Azure Site Recovery](https://azure.microsoft.com/pricing/details/site-recovery/).
6. Для быстрого доступа к хранилищу из панели мониторинга щелкните **Закрепить на панели мониторинга**, а затем — **Создать**.

   ![Новое хранилище](./media/migrate-tutorial-on-premises-azure/onprem-to-azure-vault.png)

Новое хранилище появится в колонке **Панель мониторинга** в разделе **Все ресурсы** и на основной странице **Хранилища служб восстановления**.



## <a name="select-a-replication-goal"></a>Выбор цели репликации

Выберите целевые объекты и место для репликации.
1. Щелкните **Хранилища служб восстановления** > хранилище.
2. В меню ресурсов щелкните **Site Recovery** > **Подготовка инфраструктуры** > **Цель защиты**.
3. На вкладке **Цель защиты** выберите объекты для миграции.
    - **VMware.** Выберите **To Azure** (В Azure) > **Yes, with VMWare vSphere Hypervisor** (Да, с использованием гипервизора VMware vSphere).
    - **Физический компьютер.** Выберите **To Azure** (В Azure) > **Not virtualized/Other** (Не виртуализированы/Другое).
    - **Hyper-V**. Выберите **To Azure** (В Azure) > **Yes, with Hyper-V** (Да, с помощью Hyper-V). Если управление виртуальными машинами Hyper-V осуществляется с помощью VMM, выберите **Да**.


## <a name="set-up-the-source-environment"></a>Настройка исходной среды

- [Настройте](vmware-azure-tutorial.md#set-up-the-source-environment) исходную среду для виртуальных машин VMware.
- [Настройте](physical-azure-disaster-recovery.md#set-up-the-source-environment) исходную среду для физических серверов.
- [Настройте](hyper-v-azure-tutorial.md#set-up-the-source-environment) исходную среду для виртуальных машин Hyper-V.

## <a name="set-up-the-target-environment"></a>Настройка целевой среды

Выберите и проверьте целевые ресурсы.

1. Щелкните **Подготовка инфраструктуры** > **Цель** и выберите требуемую подписку Azure.
2. Укажите модель развертывания с помощью Resource Manager.
3. Site Recovery проверяет наличие одной или нескольких совместимых учетных записей хранения и сетей Azure.

## <a name="set-up-a-replication-policy"></a>Настройка политики репликации

- [Настройте политику репликации](vmware-azure-tutorial.md#create-a-replication-policy) для виртуальных машин VMware.
- [Настройте политику репликации](physical-azure-disaster-recovery.md#create-a-replication-policy) для физических серверов.
- [Настройте политику репликации](hyper-v-azure-tutorial.md#set-up-a-replication-policy) для виртуальных машин Hyper-V.


## <a name="enable-replication"></a>Включение репликации

- [Включите репликацию](vmware-azure-tutorial.md#enable-replication) виртуальных машин VMware.
- [Включите репликацию](physical-azure-disaster-recovery.md#enable-replication) для физических серверов.
- Включите репликацию для виртуальных машин Hyper-V [с](hyper-v-vmm-azure-tutorial.md#enable-replication) или [без VMM](hyper-v-azure-tutorial.md#enable-replication).


## <a name="run-a-test-migration"></a>Выполнение тестовой миграции

Запустите [тестовую отработку отказа](tutorial-dr-drill-azure.md) в Azure, чтобы убедиться в надлежащей работе всех компонентов.


## <a name="migrate-to-azure"></a>Миграция в Azure

Запустите отработку отказа для компьютеров, которые необходимо перенести.

1. В разделе **Параметры** > **Реплицированные элементы** выберите компьютер и щелкните **Отработка отказа**.
2. В разделе **Отработка отказа** выберите **точку восстановления**, в которую будет выполнена отработка отказа. Выберите последнюю точку восстановления.
3. Параметр ключа шифрования не учитывается в этом сценарии.
4. Выберите **Завершение работы виртуальной машины перед началом отработки отказа**. Служба Site Recovery попытается завершить работу исходных виртуальных машин, прежде чем запускать отработку отказа. Отработка отказа продолжится, даже если их не удастся отключить. На странице **Задания** можно следить за ходом выполнения отработки отказа.
5. Убедитесь, что виртуальная машина Azure отображается в Azure должным образом.
6. В разделе **Реплицированные элементы** щелкните виртуальную машину правой кнопкой мыши и выберите **Завершение миграции**. Таким образом вы завершите миграцию, прекратите репликацию для виртуальной машины и остановите выставление счетов Site Recovery для виртуальной машины.

    ![Завершение миграции](./media/migrate-tutorial-on-premises-azure/complete-migration.png)


> [!WARNING]
> **Не отменяйте выполняющуюся отработку отказа**. Перед запуском отработки отказа останавливается репликация виртуальной машины. Если отменить выполняющуюся отработку отказа, она остановится, но виртуальная машина не будет реплицирована повторно.

В некоторых сценариях требуется дополнительная обработка отработки отказа, которая длится около 8–10 минут. Тестовая отработка отказа для физических серверов, компьютеров Linux VMware, виртуальных машин VMware без включенной службы DHCP и виртуальных машин VMware без загрузочных драйверов storvsc, vmbus, storflt, intelide, atapi может занимать больше времени.


## <a name="next-steps"></a>Дополнительная информация

В рамках работы с этим руководством вы перенесли локальные виртуальные машины в виртуальные машины Azure. Теперь можно настроить аварийное восстановление для виртуальных машин Azure.

> [!div class="nextstepaction"]
> [Настройка аварийного восстановления](azure-to-azure-replicate-after-migration.md) для виртуальных машин Azure после миграции из локального расположения.
