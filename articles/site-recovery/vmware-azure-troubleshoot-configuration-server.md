---
title: Устранение неполадок с сервером конфигурации при аварийном восстановлении виртуальных машин VMware и физических серверов в Azure с помощью Azure Site Recovery | Документация Майкрософт
description: В этой статье описано, как устранять неполадки при развертывании сервера конфигурации при аварийном восстановлении физических серверов и виртуальных машин VMware в Azure с помощью Azure Site Recovery.
author: Rajeswari-Mamilla
manager: rochakm
ms.service: site-recovery
ms.topic: article
ms.date: 12/17/2018
ms.author: ramamill
ms.openlocfilehash: 597b8f59ef6991f7868d3de481e98ed9a459077b
ms.sourcegitcommit: d61faf71620a6a55dda014a665155f2a5dcd3fa2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/04/2019
ms.locfileid: "54050801"
---
# <a name="troubleshoot-configuration-server-issues"></a>Устранение неполадок, связанных с сервером конфигурации

Эта статья поможет устранить неполадки при развертывании сервера конфигурации [Azure Site Recovery](site-recovery-overview.md) и управлении им. Сервер конфигурации выступает в роли сервера управления. Сервер конфигурации используется для настройки аварийного восстановления локальных виртуальных машин VMware и физических серверов в Azure с помощью Azure Site Recovery. В следующих разделах рассматриваются наиболее распространенные сбои, которые могут произойти при добавлении нового сервера конфигурации или при управлении сервером конфигурации.

## <a name="registration-failures"></a>Ошибки регистрации

Исходный компьютер регистрируется на сервере конфигурации во время установки агента мобильности. На этом этапе можно выполнить отладку ошибок, следуя приведенным ниже инструкциям.

1. Откройте файл C:\ProgramData\ASR\home\svsystems\var\configurator_register_host_static_info.log. (Папка ProgramData может быть скрытой. Если вы не видите папку ProgramData, в проводнике на вкладке **Вид** в разделе **Показать или скрыть** установите флажок **Скрытые элементы**.) Сбои могут быть вызваны разными проблемами.

2. Найдите строку **No Valid IP Address found** (Не найден допустимый IP-адрес). Если вы ее нашли, сделайте следующее.
    1. Убедитесь, что запрошенный идентификатор узла совпадает с идентификатором узла исходного компьютера.
    2. Убедитесь, что физическому сетевому адаптеру на исходном компьютере назначен по крайней мере один IP-адрес. Для успешной регистрации агента на сервере конфигурации физическому сетевому адаптеру на исходном компьютере должен быть назначен по крайней мере один действительный IPv4-адрес.
    3. Выполните одну из следующих команд на исходном компьютере, чтобы получить все его IP-адреса.
      - Для Windows: `> ipconfig /all`
      - Для Linux: `# ifconfig -a`

3. Если строка **No Valid IP Address found** не найдена, выполните поиск строки **Reason=>NULL**. Эта ошибка возникает, если исходный компьютер использует пустой узел для регистрации на сервере конфигурации. Если вы ее нашли, сделайте следующее.
    - После устранения проблем следуйте инструкциям в разделе [Регистрация исходного компьютера на сервере конфигурации](vmware-azure-troubleshoot-configuration-server.md#register-source-machine-with-configuration-server), чтобы вручную повторить попытку регистрации.

4. Если строка **Reason=>NULL** не найдена, на исходном компьютере откройте файл C:\ProgramData\ASRSetupLogs\UploadedLogs\ASRUnifiedAgentInstaller.log. (Папка ProgramData может быть скрытой. Если вы не видите папку ProgramData, в проводнике на вкладке **Вид** в разделе **Показать или скрыть** установите флажок **Скрытые элементы**.) Сбои могут быть вызваны разными проблемами. 

5. Найдите строку **post request: (7) - Couldn't connect to server** (Запрос post: (7) — не удалось подключиться к серверу). Если вы ее нашли, сделайте следующее.
    1. Устраните ошибки сети между исходным компьютером и сервером конфигурации. Убедитесь, что сервер конфигурации доступен с исходного компьютера, с помощью сетевых инструментов, например ping, traceroute или веб-браузера. Убедитесь, что исходный компьютер подключиться к серверу конфигурации через порт 443.
    2. Проверьте на исходном компьютере наличие правил брандмауэра, которые блокируют подключение между исходным компьютером и сервером конфигурации. Обратитесь к администраторам сети, чтобы устранить проблемы с подключением.
    3. Убедитесь, что папки, перечисленные в разделе [Исключение папок Azure Site Recovery из антивирусной программы](vmware-azure-set-up-source.md#azure-site-recovery-folder-exclusions-from-antivirus-program), исключены из области действия антивирусного программного обеспечения.
    4. После устранения проблем с сетью следуйте инструкциям в разделе [Регистрация исходного компьютера на сервере конфигурации](vmware-azure-troubleshoot-configuration-server.md#register-source-machine-with-configuration-server), чтобы повторить попытку регистрации.

6. Если строка **post request: (7) - Couldn't connect to server** не найдена, в том же файле журнала выполните поиск строки **request: (60) - Peer certificate cannot be authenticated with given CA certificates** (запрос: (60) — одноранговый сертификат не может пройти аутентификацию с помощью заданных сертификатов ЦС). Эта ошибка может возникнуть, так как истек срок действия сертификата сервера конфигурации или исходный компьютер не поддерживает протокол TLS 1.0 или более поздние версии протоколов SSL. Она также может возникнуть, если брандмауэр блокирует обмен данными через протокол SSL между исходным компьютером и сервером конфигурации. Если вы ее нашли, сделайте следующее. 
    1. Чтобы устранить проблему, подключитесь к IP-адресу сервера конфигурации через веб-браузер на исходном компьютере. Используйте универсальный код ресурса (URI) https:\/\/<IP-адрес сервера конфигурации\>:443/. Убедитесь, что исходный компьютер подключиться к серверу конфигурации через порт 443.
    2. На исходном компьютере проверьте, не нужно ли добавить или удалить правила брандмауэра, чтобы обеспечить взаимодействие между исходным компьютером и сервером конфигурации. Из-за разнообразия программного обеспечения брандмауэров, которое может использоваться, невозможно привести все необходимые настройки брандмауэра. Обратитесь к администраторам сети, чтобы устранить проблемы с подключением.
    3. Убедитесь, что папки, перечисленные в разделе [Исключение папок Azure Site Recovery из антивирусной программы](vmware-azure-set-up-source.md#azure-site-recovery-folder-exclusions-from-antivirus-program), исключены из области действия антивирусного программного обеспечения.  
    4. После устранения проблем следуйте инструкциям в разделе [Регистрация исходного компьютера на сервере конфигурации](vmware-azure-troubleshoot-configuration-server.md#register-source-machine-with-configuration-server), чтобы повторить попытку регистрации.

7. В среде Linux, если значение платформы в <INSTALLATION_DIR\>/etc/drscout.conf повреждено, регистрация завершается сбоем. Чтобы определить эту проблему, откройте файл /var/log/ua_install.log. Выполните поиск строки **Aborting configuration as VM_PLATFORM value is either null or it is not VmWare/Azure** (Прерывание конфигурации, так как значением VM_PLATFORM является NULL, не VmWare или не Azure). Платформа должна иметь значение **VmWare** или **Azure**. Если поврежден файл drscout.conf, мы рекомендуем [удалить агент мобильности](vmware-physical-mobility-service-overview.md#uninstall-the-mobility-service), а затем установить его заново. Если удалить агент не удается, выполните следующие действия.
    1. Откройте файл Installation_Directory/uninstall.sh и закомментируйте вызов функции **StopServices**.
    2. Откройте файл Installation_Directory/Vx/bin/uninstall.sh и закомментируйте вызов функции **stop_services**.
    3. Откройте файл Installation_Directory/Fx/uninstall и закомментируйте весь раздел, который пытается остановить службу Fx.
    4. [Удалите](vmware-physical-mobility-service-overview.md#uninstall-the-mobility-service) агент мобильности. После успешного удаления перезагрузите систему и попробуйте установить агент мобильности.

## <a name="installation-failure-failed-to-load-accounts"></a>"Не удалось выполнить установку. Не удалось загрузить учетные записи"

Эта ошибка возникает, если службе не удается прочитать данные из транспортного подключения во время установки агента мобильности и регистрации на сервере конфигурации. Чтобы устранить эту проблему, убедитесь, что на исходном компьютере включен протокол TLS 1.0.

## <a name="change-the-ip-address-of-the-configuration-server"></a>Изменение IP-адреса сервера конфигурации

Изменять IP-адрес сервера конфигурации настоятельно не рекомендуется. Убедитесь, что все IP-адреса, назначенные серверу конфигурации, являются статическими. Не используйте IP-адреса DHCP.

## <a name="acs50008-saml-token-is-invalid"></a>"ACS50008: недопустимый токен SAML

Чтобы эта ошибка не возникала, системные часы не должны опережать местное время или отставать от него более чем на 15 минут. Для завершения регистрации перезапустите установщик.

## <a name="failed-to-create-a-certificate"></a>Не удалось создать сертификат

Не удалось создать сертификат, необходимый для аутентификации Site Recovery. Программу установки следует повторно запустить от имени локального администратора.

## <a name="register-the-source-machine-with-the-configuration-server"></a>Регистрация исходного компьютера на сервере конфигурации

### <a name="if-the-source-machine-runs-windows"></a>Если исходный компьютер работает на платформе Windows

Выполните следующую команду на исходном компьютере.

```
  cd C:\Program Files (x86)\Microsoft Azure Site Recovery\agent
  UnifiedAgentConfigurator.exe  /CSEndPoint <configuration server IP address> /PassphraseFilePath <passphrase file path>
  ```

Параметр | Сведения
--- | ---
Использование | UnifiedAgentConfigurator.exe /CSEndPoint <IP-адрес сервера конфигурации\> /PassphraseFilePath <путь к файлу парольной фразы\>
Журналы конфигурации агента | Находятся в файле %ProgramData%\ASRSetupLogs\ASRUnifiedAgentConfigurator.log.
/CSEndPoint | Обязательный параметр. Указывает IP-адрес сервера конфигурации. Используйте любой допустимый IP-адрес.
/PassphraseFilePath |  (Обязательный параметр.) Расположение с парольной фразы. Используйте любой допустимый локальный путь к файлу или UNC.

### <a name="if-the-source-machine-runs-linux"></a>Если исходный компьютер работает на платформе Linux

Выполните следующую команду на исходном компьютере.

```
  /usr/local/ASR/Vx/bin/UnifiedAgentConfigurator.sh -i <configuration server IP address> -P /var/passphrase.txt
  ```

Параметр | Сведения
--- | ---
Использование | cd /usr/local/ASR/Vx/bin<br /><br /> UnifiedAgentConfigurator.sh -i < IP-адрес сервера конфигурации\> -P <путь к файлу парольной фразы\>
-i | Обязательный параметр. Указывает IP-адрес сервера конфигурации. Используйте любой допустимый IP-адрес.
-P |  (Обязательный параметр.) Полный путь к файлу, в котором хранится парольная фраза. Используйте любую допустимую папку.

