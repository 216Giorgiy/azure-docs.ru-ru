---
title: Устранение неполадок репликации при аварийном восстановлении виртуальных машин VMware и физических серверов в Azure с помощью Azure Site Recovery | Документация Майкрософт
description: В этой статье описано, как устранять распространенные неполадки репликации при аварийном восстановлении физических серверов и виртуальных машин VMware в Azure с помощью Azure Site Recovery.
author: Rajeswari-Mamilla
manager: rochakm
ms.service: site-recovery
ms.topic: article
ms.date: 12/17/2018
ms.author: ramamill
ms.openlocfilehash: c53dc81da9469c0628adbd3751dc818997fa4d05
ms.sourcegitcommit: 3ab534773c4decd755c1e433b89a15f7634e088a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2019
ms.locfileid: "54063684"
---
# <a name="troubleshoot-replication-issues-for-vmware-vms-and-physical-servers"></a>Устранение неполадок с репликацией виртуальных машин VMware и физических серверов

Вы можете получить определенные сообщения об ошибках при защите виртуальных машин VMware или физических серверов с помощью Azure Site Recovery. В этой статье описаны распространенные неполадки, которые могут возникнуть при репликации локальных физических серверов и виртуальных машин VMware в Azure с помощью [Azure Site Recovery](site-recovery-overview.md).

## <a name="initial-replication-issues"></a>Проблемы с начальной репликацией

Ошибки начальной репликации часто вызваны проблемами с подключением между исходным сервером и сервером обработки или между сервером обработки и Azure. В большинстве случаев вы можете устранить эти проблемы, выполнив инструкции, приведенные в разделах ниже.

### <a name="check-the-source-machine"></a>Проверка исходного компьютера

В списке ниже представлены способы проверки исходного компьютера.

*  В командной строке на исходном сервере используйте Telnet, чтобы проверить связь с сервером обработки через порт HTTPS (HTTPS-порт по умолчанию — 9443). Для этого выполните следующую команду. Эта команда позволяет проверить наличие проблем с сетевым подключением, а также проблем, которые блокируют порт в брандмауэре.


   `telnet <process server IP address> <port>`


   > [!NOTE]
   > Используйте Telnet для проверки подключения. Не используйте `ping`. Если Telnet не установлен, выполните действия, описанные в разделе [Install Telnet Client](https://technet.microsoft.com/library/cc771275(v=WS.10).aspx) (Установка клиента Telnet).

   Если не удается подключиться к серверу обработки, разрешите взаимодействие через входящий порт 9443 на сервере обработки. Например, может потребоваться разрешить взаимодействие через входящий порт 9443 на сервере обработки, если в вашей сети настроена сеть периметра или промежуточная подсеть. Затем проверьте, устранена ли проблема.

*  Проверьте состояние службы **InMage Scout VX Agent – Sentinel/OutpostStart**. Если эта служба не запущена, запустите ее и проверьте, устранена ли проблема.   

### <a name="check-the-process-server"></a>Проверка сервера обработки

В списке ниже представлены способы проверки сервера обработки.

*  **Проверьте, отправляет ли сервер обработки данные в Azure**.

   1. Откройте диспетчер задач на сервере обработки (нажмите клавиши CTRL+SHIFT+ESC).
   2. Перейдите на вкладку **Производительность** и щелкните ссылку **Открыть монитор ресурсов**. 
   3. На странице **Монитор ресурсов** выберите вкладку **Сети**. На вкладке **Processes with Network Activity** (Процессы с сетевой активностью) проверьте, передает ли файл **cbengine.exe** большие объемы данных.

        ![Снимок экрана, показывающий объем данных на вкладке "Processes with Network Activity" (Процессы с сетевой активностью)](./media/vmware-azure-troubleshoot-replication/cbengine.png)

   Если файл cbengine.exe не отправляет большие объемы данных, выполните действия, указанные в следующих разделах.

*  **Проверьте, может ли сервер обработки подключаться к хранилищу BLOB-объектов Azure**.

   Выберите файл **cbengine.exe**. В разделе **TCP-подключения** проверьте, подключен ли сервер обработки к URL-адресу хранилища BLOB-объектов Azure.

   ![Снимок экрана, показывающий подключение cbengine.exe по URL-адресу хранилища BLOB-объектов Azure](./media/vmware-azure-troubleshoot-replication/rmonitor.png)

   Если сервер обработки не подключен по URL-адресу хранилища BLOB-объектов Azure, в панели управления выберите **Службы**. Проверьте, выполняются ли следующие службы:

   *  cxprocessserver;
   *  InMage Scout VX Agent – Sentinel/Outpost;
   *  агент служб восстановления Microsoft Azure;
   *  служба Microsoft Azure Site Recovery;
   *  tmansvc.

   Запустите или перезапустите службы, которые не запущены. Проверьте, устранена ли проблема.

*  **Проверьте, может ли сервер обработки подключиться по общедоступному IP-адресу Azure через порт 443**.

   Перейдите в папку %ProgramFiles%\Microsoft Azure Recovery Services Agent\Temp и откройте файл CBEngineCurr.errlog с самой последней датой. В файле выполните поиск числа **443** или строки **connection attempt failed** (не удалось подключиться).

   ![Снимок экрана, показывающий журналы ошибок в папке Temp](./media/vmware-azure-troubleshoot-replication/logdetails1.png)

   При наличии проблем перейдите в командную строку на сервере обработки и используйте Telnet, чтобы проверить связь по общедоступному IP-адресу Azure (на предыдущем рисунке IP-адрес скрыт). Общедоступный IP-адрес Azure можно найти в файле CBEngineCurr.currLog с помощью порта 443.

   `telnet <your Azure Public IP address as seen in CBEngineCurr.errlog>  443`

   Если подключиться не удается, проверьте, произошли ли проблемы доступа из-за параметров брандмауэра или прокси-сервера, как описано в следующем шаге.

*  **Проверьте, блокирует ли доступ правило брандмауэра на основе IP-адресов на сервере обработки**.

   Если вы используете правила брандмауэра на основе IP-адресов на сервере, скачайте полный список [диапазонов IP-адресов центров обработки данных Microsoft Azure](https://www.microsoft.com/download/details.aspx?id=41653). Добавьте эти диапазоны IP-адресов в конфигурацию брандмауэра, чтобы он разрешал обмен данными с Azure (и через HTTPS-порт по умолчанию — 443). Необходимо разрешить доступ для диапазонов IP-адресов региона Azure, в котором располагается ваша подписка, и региона Azure "Западная часть США" (используется для контроля доступа и управления удостоверениями).

*  **Проверьте, блокирует ли доступ правило брандмауэра на основе URL-адресов на сервере обработки**.

   Если вы используете правило брандмауэра на основе URL-адресов на сервере, разрешите URL-адреса, перечисленные в следующей таблице, в конфигурации брандмауэра.

[!INCLUDE [site-recovery-URLS](../../includes/site-recovery-URLS.md)]  

*  **Проверьте, блокируют ли доступ параметры прокси-сервера на сервере обработки**.

   Если вы используете прокси-сервер, убедитесь, что его имя разрешается DNS-сервером. Чтобы проверить значение, которое вы указали при настройке сервера конфигурации, перейдите к разделу реестра **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Azure Site Recovery\ProxySettings**.

   Теперь убедитесь, что те же параметры используются агентом Azure Site Recovery для отправки данных. 
      
   1. Найдите значение **Microsoft Azure Backup**. 
   2. Откройте **Microsoft Azure Backup**, а затем выберите **Действие** > **Изменить свойства**. 
   3. На вкладке **Конфигурация прокси-сервера** вы увидите адрес прокси-сервера. Этот адрес должен совпадать с адресом прокси-сервера, который отображается в параметрах реестра. В противном случае измените его на тот адрес.

*  **Проверьте, не ограничено ли регулирование пропускной способности на сервере обработки**.

   Увеличьте пропускную способность и проверьте, не исчезла ли проблема.

## <a name="source-machine-isnt-listed-in-the-azure-portal"></a>Исходный компьютер отсутствует в списке на портале Azure

При попытке выбрать исходную машину для включения репликации с помощью Azure Site Recovery она может быть недоступна по одной из следующих причин.

*  Если на сервере vCenter есть две виртуальные машины с одинаковым значением UUID экземпляра, на портале Azure отображается первая виртуальная машина, обнаруженная сервером конфигурации. Для устранения этой проблемы убедитесь, что виртуальным машинам назначены уникальные UUID экземпляра.
*  Убедитесь, что вы добавили правильные учетные данные vCenter во время настройки конфигурации с помощью шаблона OVF или процедуры единой настройки. Чтобы проверить учетные данные, добавленные во время установки, обратитесь к разделу [Изменение учетных данных для автоматического обнаружения](vmware-azure-manage-configuration-server.md#modify-credentials-for-automatic-discovery).
*  Если разрешения, предоставленные для доступа к vCenter, недостаточны, может произойти сбой обнаружения виртуальных машин. Убедитесь, что разрешения, описанные в разделе [Подготовка учетной записи для автоматического обнаружения](vmware-azure-tutorial-prepare-on-premises.md#prepare-an-account-for-automatic-discovery), добавлены в учетную запись пользователя vCenter.
*  Если виртуальная машина уже защищена с помощью Site Recovery, она будет недоступна для включения защиты на портале. Убедитесь, что виртуальная машина, которую вы ищете на портале, не защищена другим пользователем или в рамках другой подписки.

## <a name="protected-virtual-machines-arent-available-in-the-portal"></a>Защищенные виртуальные машины недоступны на портале

Виртуальные машины, которые реплицируются Site Recovery, недоступны на портале Azure, если в системе существуют повторяющиеся записи. Чтобы узнать, как для удалить устаревшие записи и устранить проблему, обратитесь к разделу [ASR VMware-to-Azure: How To cleanup duplicate/stale entries](https://social.technet.microsoft.com/wiki/contents/articles/32026.asr-vmware-to-azure-how-to-cleanup-duplicatestale-entries.aspx) (Репликация VMware в Azure с помощью ASR: как удалить повторяющиеся или устаревшие записи).

## <a name="next-steps"></a>Дополнительная информация

Если вам нужна дополнительная помощь, задайте свой вопрос на [форуме Azure Site Recovery](https://social.msdn.microsoft.com/Forums/azure/home?forum=hypervrecovmgr). У нас активное сообщество, и один из наших инженеров сможет помочь вам.
