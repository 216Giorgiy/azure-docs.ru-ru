---
title: Часто задаваемые вопросы. Аварийное восстановление Azure в Azure с помощью Azure Site Recovery | Документация Майкрософт
description: В этой статье перечислены часто задаваемые вопросы о настройке аварийного восстановления виртуальных машин Azure в другом регионе Azure с помощью Azure Site Recovery
author: asgang
manager: rochakm
ms.service: site-recovery
ms.date: 12/12/2018
ms.topic: conceptual
ms.author: asgang
ms.openlocfilehash: 6fe7152e43640a809ab9f4de39b1c6b599975a20
ms.sourcegitcommit: 803e66de6de4a094c6ae9cde7b76f5f4b622a7bb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/02/2019
ms.locfileid: "53969953"
---
# <a name="common-questions---azure-to-azure-replication"></a>Часто задаваемые вопросы о репликации из Azure в Azure

В этой статье приведены ответы на часто задаваемые вопросы, которые возникают при развертывании аварийного восстановления виртуальных машин Azure в другом регионе Azure. Если после прочтения статьи у вас возникли какие-либо вопросы, вы можете задать их на [форуме, посвященном службам восстановления Azure](https://social.msdn.microsoft.com/Forums/azure/home?forum=hypervrecovmgr).


## <a name="general"></a>Общие сведения
### <a name="how-is-site-recovery-priced"></a>Как образуются цены на Site Recovery?
Ознакомьтесь со сведениями о [расценках на Azure Site Recovery](https://azure.microsoft.com/blog/know-exactly-how-much-it-will-cost-for-enabling-dr-to-your-azure-vm/).

### <a name="how-to-configure-site-recovery-on-azure-vms-what-are-the-best-practices"></a>Сведения о настройке Site Recovery на виртуальных машинах Azure. Каковы лучшие методики?
1. [Сведения об архитектуре репликации из Azure в Azure](azure-to-azure-architecture.md)
2. [Поддерживаемые и неподдерживаемые конфигурации](azure-to-azure-support-matrix.md)
3. [Настройка аварийного восстановления для виртуальных машин Azure](azure-to-azure-how-to-enable-replication.md)
4. [Запуск тестовой отработки отказа](azure-to-azure-tutorial-dr-drill.md)
5. [Отработка отказа и восстановление размещения в основном регионе](azure-to-azure-tutorial-failover-failback.md)

## <a name="replication"></a>Репликация

### <a name="can-i-replicate-azure-disk-encryption-enabled-vms"></a>Можно ли реплицировать виртуальные машины с включенным шифрованием дисков Azure?
Да, их можно реплицировать. См. эту [статью](azure-to-azure-how-to-enable-replication-ade-vms.md), чтобы включить репликацию виртуальных машин с включенным шифрованием дисков Azure. Azure Site Recovery в настоящее время поддерживает только виртуальные машины Azure под управлением ОС Windows, в которых включено шифрование с помощью приложения Azure AD.

### <a name="can-i-replicate-vms-to-another-subscription"></a>Можно ли реплицировать виртуальные машины в другую подписку?
Да, вы можете реплицировать виртуальные машины Azure в другую подписку в том же клиенте Azure Active Directory.
Настроить аварийное восстановление [между подписками](https://azure.microsoft.com/blog/cross-subscription-dr) просто. Вы можете выбрать другую подписку во время репликации.

### <a name="can-i-replicate-zone-pinned-azure-vms-to-another-region"></a>Можно ли реплицировать виртуальные машины Azure, прикрепленные к зонам, в другой регион?
Да, вы можете [реплицировать виртуальные машины, прикрепленные к зонам](https://azure.microsoft.com/blog/disaster-recovery-of-zone-pinned-azure-virtual-machines-to-another-region), в другой регион.

### <a name="can-i-exclude-disks"></a>Можно ли исключать диски?

Да, вы можете исключить диски во время защиты с помощью PowerShell. См. [руководство по PowerShell](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-powershell#replicate-azure-virtual-machine), чтобы исключить диск.

###<a name="how-often-can-i-replicate-to-azure"></a>Как часто можно выполнять репликацию в Azure?
Этот процесс является непрерывным при репликации виртуальных машин Azure в другой регион Azure. Ознакомьтесь с архитектурой репликации [Azure в Azure](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-architecture#replication-process), чтобы узнать больше.

### <a name="can-i-replicate-virtual-machines-within-a-same-region-i-need-this-to-migrate-vms"></a>Можно ли реплицировать виртуальные машины в одном регионе? Нужно ли мне это для переноса виртуальных машин?
Решение аварийного восстановления Azure в Azure нельзя использовать для репликации виртуальных машин в одном регионе.

### <a name="can-i-replicate-vms-to-any-azure-region"></a>Можно ли реплицировать виртуальные машины в любом регионе Azure?
С Site Recovery виртуальные машины можно реплицировать и восстанавливать между любыми двумя регионами в том же географическом кластере. Географические кластеры определены с учетом задержки и независимости данных. Дополнительные сведения см. в [таблице поддержки регионов Site Recovery](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-support-matrix#region-support).

### <a name="does-site-recovery-require-internet-connectivity"></a>Требуется ли подключение к Интернету для Site Recovery?

Нет, Site Recovery не требует подключения к Интернету. Доступ к URL-адресам и диапазонам IP-адресов Site Recovery описан в этой [статье](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-about-networking#outbound-connectivity-for-ip-address-ranges).

## <a name="replication-policy"></a>Политика репликации

### <a name="what-is-a-replication-policy"></a>Что такое политика репликации?
Определяет параметры для журнала хранения точки восстановления и периодичность создания моментальных снимков, совместимых на уровне приложений. По умолчанию Azure Site Recovery создает политику репликации с параметрами по умолчанию "24 часа" для хранения точки восстановления и "60 минут" — для периодичности создания моментальных снимков с согласованием приложений.

### <a name="what-is-crash-consistent-recovery-point"></a>Что такое отказоустойчивая точка восстановления?
Отказоустойчивая точка восстановления представляет данные на диске на момент, когда произошел сбой виртуальной машины или шнур питания был извлечен из сервера на момент создания моментального снимка. Она не включает ничего, что было в памяти при создании моментального снимка. В настоящее время большинство приложений может успешно восстанавливаться из отказоустойчивых моментальных снимков. Отказоустойчивой точки восстановления обычно достаточно для операционных систем (кроме баз данных), файловых серверов приложений, DHCP-серверов, серверов печати и т. д.

### <a name="what-is-application-consistent-recovery-point"></a>Что такое точка восстановления, согласованная с приложением? 
Точки восстановления, согласованные с приложением, создаются на основе моментальных снимков, согласованных с приложением, которые записывают те же данные, что и отказоустойчивые моментальные снимки, а также все данные в памяти и все выполняемые операции. Из-за дополнительного содержимого моментальные снимки, согласованные с приложением, создаются дольше других. Согласованные с приложениями точки восстановления рекомендуется использовать для операционных систем баз данных и таких приложений, как SQL.

### <a name="how-are-recovery-points-generated-and-saved"></a>Каким образом точки восстановления создаются и сохраняются?
Чтобы понять, как Site Recovery создает точки восстановления, давайте рассмотрим пример политики репликации, которая предусматривает период хранения точек восстановления 24 часа и периодичность создания моментальных снимков, согласованных с приложением, — 1 час.
Site Recovery создает отказоустойчивую точку восстановления каждые 5 минут, и пользователь не может изменить эту периодичность. Таким образом, за последний час у пользователя будет 12 отказоустойчивых точек и 1 точка, согласованная с приложением. Со временем Site Recovery урезает все точки восстановления старше 1 часа и сохраняет только одну точку восстановления в час.
Это видно на следующем снимке экрана.


1. Для периода меньше 1 часа существуют точки восстановления с частотой в 5 минут.
2. Для периода старше 1 часа мы видим только одну точку восстановления в час.

  ![Создание точек восстановления](./media/azure-to-azure-troubleshoot-errors/recoverypoints.png)


### <a name="how-far-back-can-i-recover"></a>До какой точки во времени можно выполнить восстановление?
Самая давняя доступная точка восстановления — 72 часа.

### <a name="what-will-happen-if-i-have-a-replication-policy-of-24-hours-and-there-is-no-recovery-points-generation-due-to-some-issue-for-more-than-24-hours-does-my-previous-recovery-points-will-be-pruned"></a>Что произойдет, если у меня есть политика репликации с периодом 24 часа, но из-за некоторых проблем точки восстановления не создавались более 24 часов? Мои предыдущие точки восстановления будут урезаны?
Нет. В этом случае Site Recovery будет хранить все предыдущие точки восстановления. 

### <a name="after-replication-is-enabled-on-a-vm-how-do-i-change-the-replication-policy"></a>Как изменить политику репликации после включения репликации на виртуальной машине? 
Перейдите в раздел "Хранилище Site Recovery" > "Инфраструктура Site Recovery" > "Политики репликации". Выберите политику, которую требуется изменить, и сохраните изменения. Изменения будут применяться и к существующим репликациям. 

### <a name="are-all-the-recovery-points-complete-copy-of-the-vm-or-differential"></a>Полной или разностной копией виртуальной машины являются все точки восстановления?
В случае начальной репликации первая создаваемая точка восстановления будет иметь полную копию, а все последующие точки восстановления будут содержать только изменения.

### <a name="does-increasing-recovery-points-retention-windows-increases-the-storage-cost"></a>Увеличивает ли возрастание периода хранения точки восстановления затраты на хранилище?
Да, при увеличении срока хранения с 24 до 72 часов Site Recovery будет хранить точки восстановления дополнительные 48 часов, так что плата за хранилище будет выше. Например, если одна точка восстановления содержит разностные изменения объемом 10 ГБ, а стоимость хранения за гигабайт составляет 0,16 долл. США в месяц, расходы увеличатся на 1,6 долл. США * 48 в месяц.

## <a name="failover"></a>Отработка отказа

### <a name="is-failover-automatic"></a>Отработка отказа выполняется автоматически?

Отработка отказа не выполняется автоматически. Чтобы активировать ее, необходимо щелкнуть в соответствующем месте на портале или воспользоваться Site Recovery [PowerShell](azure-to-azure-powershell.md). 

### <a name="can-i-retain-public-ip-address-after-failover"></a>Можно ли сохранить общедоступный IP-адрес после отработки отказа?

Общедоступный IP-адрес рабочего приложения **не может быть сохранен при отработке отказа**. Рабочим нагрузкам, возникающим в процессе отработки отказа, должен быть присвоен ресурс общедоступного IP-адреса Azure, доступный в целевом регионе. Этот шаг можно выполнить вручную или автоматически с помощью планов восстановления. См. эту [статью](https://docs.microsoft.com/azure/site-recovery/concepts-public-ip-address-with-site-recovery#public-ip-address-assignment-using-recovery-plan), чтобы назначить общедоступный IP-адрес с помощью плана восстановления.  

### <a name="can-i-retain-private-ip-address-during-failover"></a>Можно ли сохранить частный IP-адрес во время отработки отказа?
Да, вы можете сохранить частный IP-адрес. По умолчанию при включении аварийного восстановления для виртуальных машин Azure служба Site Recovery создает целевые ресурсы на основе параметров исходных ресурсов. Для виртуальных машин Azure, где настроены статические IP-адреса, служба Site Recovery пытается подготовить такой же IP-адрес для целевой виртуальной машины, если он не используется. См. эту [статью](site-recovery-retain-ip-azure-vm-failover.md), чтобы сохранить частный IP-адрес в различных условиях.

### <a name="after-failover-the-server-does-not-have-the-same-ip-address-as-the-source-vm-why-is-it-assigned-with-a-new-ip-address"></a>После отработки отказа сервер не имеет тот же IP-адрес, что и исходная виртуальная машина. Почему назначается новый IP-адрес?

Site Recovery пытается предоставить IP-адрес на лучших условиях во время отработки отказа. Если он уже занят другой виртуальной машиной, в качестве целевого назначается следующий доступный IP-адрес. Полное описание того, как Site Recovery обрабатывает адреса, см. в [этой статье](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-network-mapping#set-up-ip-addressing-for-target-vms).

### <a name="what-does-latestlowest-rpo-recovery-points-means"></a>Что такое точка восстановления с меткой "Последняя (наименьшее значение RPO)"?
Сначала обрабатываются все данные, отправленные в службу Site Recovery, чтобы создать точку восстановления для каждой виртуальной машины, прежде чем выполнять в нее отработку отказа. Этот вариант обеспечивает самое низкое значение RPO (целевая точка восстановления), так как виртуальная машина, созданная после отработки отказа, будет иметь все данные, реплицированные в службу Site Recovery до момента активации отработки отказа.

### <a name="does-latest-lowest-rpo-recovery-points-have-impact-on-failover-rto"></a>Влияет ли точка восстановления с меткой "Последняя (наименьшее значение RPO)" на RTO отработки отказа?
Да, так как Site Recovery будет обрабатывать все ожидающие данные перед отработкой отказа, этот параметр будет иметь более высокое значение RTO по сравнению с другими.

### <a name="what-does-latest-processed-option-in-recovery-points-mean"></a>Что означает вариант точки восстановления "Последняя обработанная"?
Отработка отказа выполняется для всех виртуальных машин в плане до последней точки восстановления, которая была обработана Site Recovery. Для просмотра последней точки восстановления конкретной виртуальной машины ознакомьтесь с разделом "Последние точки восстановления" в параметрах виртуальной машины. Этот вариант обеспечивает низкий показатель целевого времени восстановления, так как не требует времени на обработку данных.

### <a name="if-im-replicating-between-two-azure-regions-what-happens-if-my-primary-region-experiences-an-unexpected-outage"></a>Что произойдет, если при выполнении репликации между регионами Azure в основном регионе неожиданно возникнет сбой?
Вы можете активировать отработку отказа после сбоя. Для отработки отказа службе Site Recovery не требуется подключение из основного региона.

## <a name="recovery-plan"></a>План восстановления

### <a name="what-is-a-recovery-plan-"></a>Что такое план восстановления?
Планы восстановления в Site Recovery управляют восстановлением виртуальных машин после отработки отказа. Они помогают реализовать точное, воспроизводимое и автоматическое восстановление. План восстановления решает следующие задачи пользователя.

- Определение группы виртуальных машин, для которых выполняется единая отработка отказа.
- Определение зависимостей между виртуальными машинами для точного восстановления приложения.
- Автоматизация восстановления и пользовательских действий, выполняемых вручную, чтобы можно было выполнить на виртуальных машинах другие задачи, кроме отработки отказа.

[Узнайте подробнее](site-recovery-create-recovery-plans.md) о планах восстановления.

### <a name="how-does-sequencing-is-achieved-in-a-recovery-plan"></a>Каким образом в плане восстановления достигается виртуализация?

В плане восстановления можно создать несколько групп для достижения виртуализации. Отработка отказа каждой группы выполняется по очереди, то есть для виртуальных машин из одной группы отработка отказа выполняется одновременно, а затем следует другая группа. Узнайте, как [создать модель приложения с помощью плана восстановления.](https://review.docs.microsoft.com/azure/site-recovery/recovery-plan-overview?branch=pr-en-us-61681#model-apps) 

### <a name="how-can-i-find-the-rto-of-a-recovery-plan"></a>Как определить RTO плана восстановления?
Чтобы проверить RTO плана восстановления, протестируйте отработку отказа плана восстановления и перейдите к заданиям Site Recovery.
Например, как показано ниже, SAP-тест плана восстановления занял 8 минут 59 секунд. За это время выполнена отработка отказа всех виртуальных машин и все указанные действия.

  ![com-error](./media/azure-to-azure-troubleshoot-errors/recoveryplanrto.PNG)

### <a name="can-i-add-automation-runbooks-to-the-recovery-plan"></a>Можно ли добавлять модули runbook службы автоматизации в планы восстановления?
Да, вы можете интегрировать в план восстановления модули runbook службы автоматизации Azure. [Подробнее](site-recovery-runbook-automation.md)

## <a name="reprotect-and-failback"></a>Повторное включение защиты и восстановление размещения 

### <a name="after-doing-a-failover-from-primary-region-to-disaster-recovery-region-does-vms-in-a-dr-region-gets-protected-automatically"></a>После выполнения отработки отказа из основного региона в регион аварийного восстановления виртуальные машины в регионе аварийного восстановления защищаются автоматически?
Нет, при выполнении [отработки отказа](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-tutorial-failover-failback) виртуальных машин Azure из одного региона в другой их начальная загрузка в регионе аварийного восстановления не защищена. Чтобы восстановить размещение виртуальных машин в основном регионе, [повторно включите защиту](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-how-to-reprotect) виртуальных машин в дополнительном регионе.

### <a name="at-the-time-of-reprotection-does-site-recovery-replicate-complete-data-from-secondary-region-to-primary-region"></a>Реплицирует ли Site Recovery во время повторного включения защиты все данные из дополнительного региона в основной регион?
Это зависит от ситуации. Например, если исходный регион виртуальной машины существует, то синхронизируются только изменения между исходным и целевым диском. Разница в файлах определяется путем сравнения обоих дисков с последующей передачей. Для этого обычно необходимо несколько часов. См. эту [статью]( https://docs.microsoft.com/azure/site-recovery/azure-to-azure-how-to-reprotect#what-happens-during-reprotection) с дополнительными сведениями о том, что происходит во время повторного включения защиты.

### <a name="how-much-time-does-it-take-to-failback"></a>Сколько времени занимает восстановление размещения?
После повторного включения защиты обычно требуется столько же времени, сколько на отработку отказа из основного региона в дополнительный. 

## <a name="security"></a>Безопасность
### <a name="is-replication-data-sent-to-the-site-recovery-service"></a>Отправляются ли данные репликации в службу Site Recovery?
Нет, служба Site Recovery не перехватывает реплицируемые данные и не получает сведения о компонентах, запущенных на ваших виртуальных машинах. В службу Site Recovery передаются только метаданные, необходимые для управления репликацией и отработкой отказа.  
Site Recovery имеет сертификаты ISO 27001:2013, 27018, HIPAA, DPA и сейчас проходит проверки на соответствие SOC2 и FedRAMP JAB.

### <a name="does-site-recovery-encrypt-replication"></a>Выполняет ли служба Site Recovery шифрование репликации?
Да, поддерживается и шифрование в процессе передачи, и [шифрование в Azure](https://docs.microsoft.com/azure/storage/storage-service-encryption).

## <a name="next-steps"></a>Дополнительная информация
* [Ознакомьтесь с требованиями к поддержке.](azure-to-azure-support-matrix.md)
* [Настройка](azure-to-azure-tutorial-enable-replication.md) репликации из Azure в Azure.
