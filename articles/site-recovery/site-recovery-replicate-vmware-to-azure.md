---
title: "Репликация приложений (VMware в Azure) | Документация Майкрософт"
description: "В этой статье приведены сведения о настройке репликации виртуальных машин VMware в Azure."
services: site-recovery
documentationcenter: 
author: asgang
manager: rochakm
editor: 
ms.assetid: 
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 06/05/2017
ms.author: asgang
ms.translationtype: HT
ms.sourcegitcommit: 83f19cfdff37ce4bb03eae4d8d69ba3cbcdc42f3
ms.openlocfilehash: e0047a996c9bfd7d950b32f0871ddd7608924b42
ms.contentlocale: ru-ru
ms.lasthandoff: 08/21/2017

---


# <a name="replicate-applications-running-on-vmware-vms-to-azure"></a>Репликация приложений, выполняемых на виртуальных машинах VMware, в Azure



В этой статье приведены сведения о настройке репликации виртуальных машин VMware в Azure.
## <a name="prerequisites"></a>Предварительные требования

В этой статье предполагается, что вы:

1.  [Настроили локальную исходную среду](site-recovery-set-up-vmware-to-azure.md).
2.  [Настроили целевую среду в Azure](site-recovery-prepare-target-vmware-to-azure.md).


## <a name="enable-replication"></a>Включение репликации
#### <a name="before-you-start"></a>Перед началом работы
При репликации виртуальных машин VMware обратите внимание на следующее.

* Учетная запись пользователя Azure должна содержать определенные [разрешения](site-recovery-role-based-linked-access-control.md#permissions-required-to-enable-replication-for-new-virtual-machines) для включения репликации новой виртуальной машины в Azure.
* Виртуальные машины VMware обнаруживаются каждые 15 минут. Может пройти более 15 минут, прежде чем они будут обнаружены и отображены на портале. Обнаружение может также занять 15 минут или более при добавлении нового сервера vCenter или узла vSphere.
* Изменения среды на виртуальной машине (например, установка средств VMware) также могут отобразиться на портале через 15 и более минут.
* Время последнего обнаружения виртуальных машин VMware можно узнать в колонке **Серверы конфигурации** в поле **Последнее обнаружение** для сервера vCenter или узла vSphere.
* Чтобы добавить компьютеры для репликации, не дожидаясь запланированного обнаружения, выделите сервер конфигурации (не щелкая его) и нажмите кнопку **Обновить**.
* Если компьютер уже подготовлен, когда вы включаете репликацию, то сервер обработки автоматически устанавливает на него службу Mobility Service.


**Включите репликацию следующим образом**.

1. Последовательно выберите **Шаг 2. Репликация приложения** > **Источник**. Включив репликацию впервые, щелкните **+Replicate** (+ Реплицировать) в хранилище, чтобы включить репликацию для дополнительных машин.
2. В колонке **Источник** выберите **Источник** и нужный сервер конфигурации.
3. В поле **Тип компьютера** выберите параметр **Виртуальные машины** или **Физические компьютеры**.
4. В поле **vCenter/vSphere Hypervisor** (Гипервизор vCenter или vSphere) выберите сервер vCenter, который управляет узлом vSphere, или сам узел. Этот параметр не учитывается при репликации физических компьютеров.
5. Выберите сервер обработки. Если ни один дополнительный сервер обработки еще не создан, это будет имя сервера конфигурации. Нажмите кнопку **ОК**.

    ![Включение репликации](./media/site-recovery-vmware-to-azure/enable-replication2.png)

6. Для параметра **Цель** выберите подписку и группу ресурсов, в которых вы хотите создавать виртуальные машины при отработке отказа. Выберите модель развертывания, которая будет использоваться в Azure (классическая или Resource Manager) для виртуальных машин после отработки отказа.
7. Выберите учетную запись хранения Azure, которую вы хотите использовать для репликации данных. Обратите внимание на следующее.

   * Можно выбрать учетную запись хранения класса Standard или Premium. Если вы выберете учетную запись класса Premium, потребуется указать дополнительную учетную запись хранения класса Standard для журналов текущей репликации. Учетные записи должны находиться в том же регионе, что и хранилище служб восстановления.
   * Если вам нужна другая учетная запись хранения, создайте ее *ссылка на раздел о создании учетной записи хранения с помощью Resource Manager, который будет добавлен в руководстве по началу работы*. Чтобы создать учетную запись хранения с использованием Resource Manager, щелкните **Создать**. Если нужно создать учетную запись хранения, используя классическую модель, это можно сделать [на портале Azure](../storage/common/storage-create-storage-account.md).

8. Выберите сеть и подсеть Azure, к которой будут подключаться развернутые виртуальные машины Azure после отработки отказа. Сеть должна располагаться в том же регионе, что и хранилище служб восстановления. Выберите **Настроить сейчас для всех выбранных компьютеров**, чтобы применить параметр сети ко всем защищаемым машинам. Выберите **Отложить настройку**, чтобы выбрать сеть Azure для каждого компьютера. Если у вас нет сети, ее необходимо [создать](#set-up-an-azure-network). Чтобы создать сеть с помощью Resource Manager, щелкните **Создать**. Если нужно создать сеть, используя классическую модель, это можно сделать [на портале Azure](../virtual-network/virtual-networks-create-vnet-classic-pportal.md). Выберите подсеть (если это применимо). Нажмите кнопку **ОК**.

    ![Включение репликации](./media/site-recovery-vmware-to-azure/enable-rep3.png)
9. В разделе **Виртуальные машины** > **Выбор виртуальных машин**, выберите каждую машину, которую нужно реплицировать. Можно выбрать только те компьютеры, для которых можно включить репликацию. Нажмите кнопку **ОК**.

    ![Включение репликации](./media/site-recovery-vmware-to-azure/enable-replication5.png)
10. В поле **Свойства** > **Настройка свойств**и выберите учетную запись, которая будет использоваться сервером обработки для автоматической установки службы Mobility Service на компьютер.  
11. По умолчанию будут реплицироваться все диски. Чтобы исключить диски из репликации, щелкните **Все диски**, а затем снимите флажки напротив дисков, которые не нужно реплицировать.  Нажмите кнопку **ОК**. Позже можно задать дополнительные свойства. Дополнительные сведения об исключении дисков см.в [этой статье](site-recovery-exclude-disk.md).

    ![Включение репликации](./media/site-recovery-vmware-to-azure/enable-replication6.png)

12. Выберите **Параметры репликации** > **Настройка параметров репликации** и убедитесь, что выбрана правильная политика репликации. Параметры политики репликации можно изменить, последовательно выбрав **Параметры** > **Политики репликации** > имя политики > **Изменить параметры**. Изменения, примененные к политике, будут применены к репликации и новым компьютерам.
13. Включите параметр **Согласование с несколькими виртуальными машинами** , если хотите объединить компьютеры в группу репликации, и укажите имя этой группы. Нажмите кнопку **ОК**. Обратите внимание на следующее.

    * Компьютеры в группе репликации реплицируются вместе и имеют отказоустойчивые и согласованные точки восстановления после отработки отказа.
    * Виртуальные машины и физические серверы рекомендуется объединять для того, чтобы они могли зеркалировать рабочие нагрузки. Включение согласованности нескольких виртуальных машин может повлиять на производительность рабочей нагрузки, поэтому ее необходимо использовать, только если компьютеры выполняют одну и ту же рабочую нагрузку и должны действовать согласованно.

    ![Включение репликации](./media/site-recovery-vmware-to-azure/enable-replication7.png)
14. Щелкните **Включить репликацию**. Ход выполнения задания **включения защиты** можно отслеживать, выбрав **Параметры** > **Задания** > **Задания Site Recovery**. После выполнения задания **Завершить подготовку защиты** виртуальная машина будет готова к отработке отказа.

> [!NOTE]
> Если компьютер готов для принудительной установки, компонент службы Mobility будет установлен при включении защиты. После того как компонент будет установлен на компьютере, задание защиты будет запущено и завершится ошибкой. После сбоя каждый компьютер необходимо будет перезапустить вручную. После перезапуска задание защиты будет запущено снова и будет выполнена начальная репликация.
>
>

## <a name="view-and-manage-vm-properties"></a>Просмотр свойств виртуальной машины и управление ими

Рекомендуется проверить свойства исходного компьютера. Помните, что имя виртуальной машины Azure должно соответствовать [требованиям к виртуальным машинам Azure](site-recovery-support-matrix-to-azure.md#failed-over-azure-vm-requirements).

1. Щелкните **Параметры** > **Реплицированные элементы** и выберите нужный компьютер. В колонке **Основные компоненты** отображается информация о параметрах и состоянии компьютеров.
2. На разделе **Свойства** можно просмотреть сведения о репликации и отработке отказа для виртуальной машины.
3. В разделе **Вычисления и сеть** > **Свойства вычислений** можно указать имя и целевой размер виртуальной машины Azure. При необходимости измените имя в соответствии с требованиями Azure.
    ![Включение репликации](./media/site-recovery-vmware-to-azure/VMProperties_AVSET.png)
 
4.  Вы можете выбрать [группу ресурсов](https://docs.microsoft.com/azure/virtual-machines/windows/infrastructure-resource-groups-guidelines), в которую будет добавлена машина после отработки отказа. Этот параметр можно изменить в любое время перед отработкой отказа. Если после отработки отказа переместить машину в другую группу ресурсов, параметры защиты этой машины будут нарушены.
5. Вы также можете выбрать [группу доступности](https://docs.microsoft.com/azure/virtual-machines/windows/infrastructure-availability-sets-guidelines), в которую будет добавлена машина после отработки отказа. При выборе группы доступности учитывайте следующее:

    * Отображаются только группы доступности, принадлежащие к указанной группе ресурсов.  
    * Машины в разных виртуальных сетях не могут входить в одну группу доступности.
    * В одну группу доступности могут входить только виртуальные машины одинакового размера.
5. Кроме того, можно просмотреть и добавить сведения о целевой сети, подсети и целевом IP-адресе, который будет назначен виртуальной машине Azure.
6. На странице **Диски** отображаются сведения о дисках операционной системы и дисках данных на виртуальной машине, для которой будет выполняться репликация.

### <a name="network-adapters-and-ip-addressing"></a>Сетевые адаптеры и назначение IP-адресов 

- Вы можете задать целевой IP-адрес. Если не указать его, компьютер, для которого выполнена отработка отказа, будет использовать DHCP. Если задать адрес, недоступный при отработке отказа, произойдет сбой. Этот же целевой IP-адрес можно использовать для тестовой отработки отказа, если он доступен в сети тестовой отработки отказа.
- Количество сетевых адаптеров зависит от размера, указанного для целевой виртуальной машины:
    - Если число сетевых адаптеров на исходной машине меньше или равно числу адаптеров, разрешенному для целевой машины, то количество адаптеров на целевой машине будет таким же.
    - Если число адаптеров на исходной виртуальной машине превышает допустимое для целевого размера, то будет использовать максимальный размер целевой машины.
    - Например, если на исходной машине есть два сетевых адаптера, а размер целевой машины поддерживает четыре, то на целевой машине будет два адаптера. Если на исходной машине два адаптера, но целевой размер поддерживает только один, то на целевой машине будет только один адаптер.
    - Если для виртуальной машины настроено несколько сетевых адаптеров, все они будут подключены к одной сети.
    - Если виртуальная машина имеет несколько сетевых адаптеров, сетевым адаптером *по умолчанию* для этой виртуальной машины Azure станет тот из них, который расположен в списке первым.
   



## <a name="common-issues"></a>Распространенные проблемы

* Размер каждого диска не превышает 1 ТБ.
* Диск операционной системы представляет собой базовый, а не динамический диск.
* У виртуальных машин с поддержкой 2/UEFI операционная система должна быть из семейства Windows, а размер загрузочного диска не должен превышать 300 ГБ.

## <a name="next-steps"></a>Дальнейшие действия

Когда защита будет установлена, можно запустить [отработку отказа](site-recovery-failover.md), чтобы определить, появится ли ваше приложение в Azure.

Если вы захотите отключить защиту, см. сведения в статье [Удаление серверов и отключение защиты](site-recovery-manage-registration-and-protection.md).

