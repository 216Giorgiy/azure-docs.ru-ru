---
title: 'Сбор данных для обучения модели: интерфейс API рекомендаций для машинного обучения | Microsoft Docs'
description: Рекомендации для машинного обучения Azure — сбор данных для обучения модели
services: cognitive-services
documentationcenter: ''
author: luiscabrer
manager: jhubbard
editor: cgronlun

ms.service: cognitive-services
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/06/2016
ms.author: luisca

---
# Сбор данных для обучения модели
API-интерфейс рекомендаций узнает на основании предыдущих транзакций, что нужно рекомендовать тому или иному пользователю.

Создав модель, нужно, прежде чем начинать обучение, предоставить файл каталога и данные об использовании.

> Если вы еще это не сделали, рекомендуем ознакомиться с [кратким руководством по началу работы](cognitive-services-recommendations-quick-start.md).
> 
> 

## Данные каталога
### Формат файла каталога
Файл каталога содержит информацию об элементах, которые вы предлагаете клиентам. Данные каталога должны иметь следующий формат:

* Без характеристик: `<Item Id>,<Item Name>,<Item Category>[,<Description>]`
* С характеристиками: `<Item Id>,<Item Name>,<Item Category>,[<Description>],<Features list>`

#### Пример строки в файле каталога
Без характеристик:

    AAA04294,Office Language Pack Online DwnLd,Office
    AAA04303,Minecraft Download Game,Games
    C9F00168,Kiruna Flip Cover,Accessories

С характеристиками:

    AAA04294,Office Language Pack Online DwnLd,Office,, softwaretype=productivity, compatibility=Windows
    BAB04303,Minecraft DwnLd,Games, softwaretype=gaming,, compatibility=iOS, agegroup=all
    C9F00168,Kiruna Flip Cover,Accessories, compatibility=lumia,, hardwaretype=mobile

#### Сведения о формате
| Name (Имя) | Обязательно | Тип | Описание |
|:--- |:--- |:--- |:--- |
| Идентификатор элемента |Да |[A-z], [a-z], [0-9], [\_] &#40;символ подчеркивания&#41;, [-] &#40;дефис&#41;<br> Максимальная длина: 50 |Уникальный идентификатор элемента. |
| Имя элемента |Да |Любые алфавитно-цифровые символы<br> Максимальная длина: 255 |Имя элемента. |
| Категория элемента |Да |Любые алфавитно-цифровые символы<br> Максимальная длина: 255 |Категория, к которой относится этот элемент (например, кулинарные книги, драма и т. д.); не может быть пустой. |
| Описание |Нет, если только нет характеристик (но может быть пустым) |Любые алфавитно-цифровые символы<br> Максимальная длина: 4000 |Описание элемента. |
| Список характеристик |Нет |Любые буквенно-цифровые символы<br> Максимальная длина: 4000; максимальное число компонентов: 20 |Разделенный запятыми список компонентов (имя=значение), который позволяет расширить модель рекомендаций. |

#### Отправка файла каталога
Чтобы отправить файл каталога, см. [справочные материалы по интерфейсу API](https://westus.dev.cognitive.microsoft.com/docs/services/Recommendations.V4.0/operations/56f316efeda5650db055a3e1).

Обратите внимание, что содержимое файла каталога нужно передать в качестве тела запроса.

В случае передачи нескольких файлов каталога в одну модель несколькими вызовами мы вставим только новые элементы каталога. Существующие элементы останутся с исходными значениями. С помощью этого метода нельзя обновлять данные каталога.

> Примечание. Максимальный размер файла равен 200 МБ. В каталоге поддерживается не более 100 000 элементов.
> 
> 

## Зачем добавлять компоненты в каталог
Подсистема рекомендаций создает статистическую модель, которая сообщает, что может понравиться покупателю и что покупатель может купить. Если продукт новый и с ним еще не взаимодействовали, невозможно создать модель только на основании смежности. Представьте, что вы предлагаете клиентам новый товар, например детскую скрипку. Так как еще не продан ни один экземпляр, вы не знаете, какие сопутствующие товары можно рекомендовать.

С другой стороны, если в подсистеме есть информация об этой скрипке (это музыкальный инструмент, предназначен для детей в возрасте 7–10 лет, недорогой и т. д.), она может получить нужные сведения о других продуктах с похожими характеристиками. К примеру, вы продавали другие скрипки, а люди, которые их покупали, брали в придачу компакт-диски с классической музыкой и пюпитры. Подсистема рекомендаций может найти эти связи между характеристиками продуктов и предоставлять рекомендации на их основании, пока новая скрипка не пользуется популярностью.

Характеристики импортируются вместе с данными каталога, а связывание рейтингов (или важности характеристики в модели) осуществляется при создании рейтинга. Рейтинг характеристики может изменяться в соответствии с особенностями данных по использованию и типом элементов. Но для согласованности данных по использованию и элементов рейтинг должен меняться в незначительных пределах. Рейтинг характеристики должен быть неотрицательным числом. Число 0 означает, что характеристике не присвоен рейтинг (такое происходит, если этот интерфейс API был вызван до завершения первой сборки рейтинга). Дата назначения рейтинга называется возрастом оценки.

### Характеристики — это категориальные сущности
Это значит, что следует создавать характеристики, похожие на категории. Например, "price=9.34" — это не категориальная характеристика. С другой стороны, "priceRange=Under5Dollars" — это категориальная характеристика. Еще одна распространенная ошибка заключается в том, что в качестве характеристики используется имя элемента. Но имя элемента уникально и поэтому не может обозначать категорию. Характеристики должны представлять категории элементов.

### Сколько характеристик и какие характеристики нужно использовать
Рекомендованная сборка поддерживает модели, которые содержат до 20 характеристик. Вы можете назначить и больше, но предполагается, что вы выполните рейтинговую сборку, выбирая только характеристики с высоким рейтингом. (Мы настоятельно рекомендуем характеристики с рейтингом 2.0 и выше.)

### Когда используются характеристики
Модель использует характеристики, когда транзакционных данных слишком мало, чтобы предоставлять рекомендации только на их основе. Поэтому характеристики влияют больше всего на неактивные элементы (элементы, которые участвовали в малом числе транзакций). Если же есть достаточно транзакционных данных о каждом элементе, добавлять характеристики в модель может и не понадобиться.

### Использование характеристик продукта
Чтобы использовать характеристики в рамках сборки:

1. Добавьте характеристики в передаваемый каталог.
2. Активируйте сборку ранжирования. Это нужно для анализа важности или рейтинга характеристик.
3. Активируйте сборку рекомендаций. Для этого настройте параметры сборки: для параметров useFeaturesInModel и allowColdItemPlacement задайте значение true, а для параметра modelingFeatureList нужно выбрать список характеристик (с разделителями-запятыми), с помощью которых вы хотите улучшить свою модель. Дополнительные сведения см. в статье, посвященной [параметрам типа сборки рекомендаций](https://westus.dev.cognitive.microsoft.com/docs/services/Recommendations.V4.0/operations/56f30d77eda5650db055a3d0).

## Данные об использовании
Файл об использовании содержит информацию о том, как используются эти элементы, или транзакции вашего предприятия.

#### Сведения о формате использования
Файл использования — это CSV-файл (файл с разделителями-запятыми), в котором каждая строка представляет взаимодействие между пользователем и элементом. Формат каждой строки:<br> `<User Id>,<Item Id>,<Time>,[<Event>]`

| Name (Имя) | Обязательно | Тип | Описание |
| --- | --- | --- | --- |
| Идентификатор пользователя |Да |[A-z], [a-z], [0-9], [\_] &#40;символ подчеркивания&#41;, [-] &#40;дефис&#41;<br> Максимальная длина: 255 |Уникальный идентификатор пользователя |
| Идентификатор элемента |Да |[A-z], [a-z], [0-9], [&#95;] &#40;символ подчеркивания&#41;, [-] &#40;дефис&#41;<br> Максимальная длина: 50 |Уникальный идентификатор элемента. |
| Время |Да |Дата в формате: ГГГГ/ММ/ДДТЧЧ:ММ:СС (например, 2013/06/20Т10:00:00) |Время данных |
| Событие |Нет |Одно из следующих:<br>• Выбор<br>• Выбор рекомендации<br>• Добавление в корзину<br>•Удаление из корзины<br>• Покупка |Тип транзакции. |

#### Примеры строк в файле использования
    00037FFEA61FCA16,288186200,2015/08/04T11:02:52,Purchase
    0003BFFDD4C2148C,297833400,2015/08/04T11:02:50,Purchase
    0003BFFDD4C2118D,297833300,2015/08/04T11:02:40,Purchase
    00030000D16C4237,297833300,2015/08/04T11:02:37,Purchase
    0003BFFDD4C20B63,297833400,2015/08/04T11:02:12,Purchase
    00037FFEC8567FB8,297833400,2015/08/04T11:02:04,Purchase

#### Отправка файла использования
Чтобы отправить файлы использования, см. [справочные материалы по API](https://westus.dev.cognitive.microsoft.com/docs/services/Recommendations.V4.0/operations/56f316efeda5650db055a3e2). Обратите внимание, что содержимое файла использования нужно передать в качестве тела вызова HTTP.

> Примечание.
> 
> Максимальный размер файла: 200 МБ. Вы можете отправить несколько файлов использования.
> 
> Необходимо отправить файл каталога, прежде чем добавлять данные об использовании в модель. На этапе обучения используются только элементы в файле каталога. Другие элементы игнорируются.
> 
> 

## Сколько данных требуется?
Качество модели во многом зависит от качества и количества данных. Система обучается, когда пользователи покупают различные элементы (мы называем это смежностью). Для некоторых сборок, например FBT, важно знать, какие элементы были приобретены в одной транзакции.

Хорошее проверенное правило — иметь по 20 или больше транзакций для большинства элементов, то есть при наличии 10 000 элементов в каталоге рекомендуется иметь по крайней мере в 20 раз больше транзакций, а это около 200 000. Опять же, это проверенное правило. Вам нужно будет поэкспериментировать с данными.

После создания модели нужно выполнить [автономную оценку](cognitive-services-recommendations-buildtypes.md), чтобы проверить, насколько хорошо будет работать модель.

<!---HONumber=AcomDC_0914_2016-->