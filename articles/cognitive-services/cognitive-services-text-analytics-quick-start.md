<properties
	pageTitle="Краткое руководство: API-интерфейсы текстовой аналитики в машинном обучении | Microsoft Azure"
	description="Текстовая аналитика в машинном обучении Azure — краткое руководство"
	services="cognitive-services"
	documentationCenter=""
	authors="onewth"
	manager="paulettm"
	editor="cgronlun"/>

<tags
	ms.service="cognitive-services"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="07/05/2016"
	ms.author="onewth"/>

# Начало работы с API-интерфейсами текстовой аналитики для определения тональности, ключевых фраз, тем и языка

<a name="HOLTop"></a>

В этом документе описывается настройка службы или приложения для использования [API-интерфейсов текстовой аналитики](//go.microsoft.com/fwlink/?LinkID=759711). Эти API-интерфейсы позволяют определить тональность, ключевые фразы, тему и язык текста. [Щелкните здесь, чтобы просмотреть интерактивный ролик, показывающий возможности интерфейса.](//go.microsoft.com/fwlink/?LinkID=759712)

Техническую документацию об API-интерфейсах см. в документе об [определениях API](//go.microsoft.com/fwlink/?LinkID=759346).

Это руководство предназначено для версии 2 API. Дополнительные сведения о версии 1 интерфейсов API см. в [этом документе](../machine-learning/machine-learning-apps-text-analytics.md).

Выполнив инструкции этого руководства, вы сможете определять программным путем следующие сведения.

- **Тональность** — в тексте преобладают положительные или отрицательные эмоции?

- **Ключевые фразы** — о чем идет речь в конкретной статье?

- **Темы** — что обсуждается в нескольких статьях?

- **Языки** — на каком языке написан текст?

Обратите внимание, что для этого API-интерфейса тарифицируется каждая транзакция для текстовой записи.

<a name="Overview"></a>
## Общая информация ##

Этот документ содержит пошаговое руководство. Мы покажем, какие шаги нужно выполнить, чтобы обучить модель, и расскажем вам о ресурсах, с помощью которых вы сможете поместить модель в рабочую среду. Это упражнение займет около 30 минут.

Для выполнения этих задач потребуется редактор и вызов конечных точек REST на выбранном языке.

Приступим.

## Задача 1. Регистрация в API-интерфейсах текстовой аналитики ####

Выполнив эту задачу, вы зарегистрируетесь в службе текстовой аналитики.

1. Откройте на [портале Azure](//go.microsoft.com/fwlink/?LinkId=761108) раздел **Когнитивные службы** и выберите в качестве типа API значение **Текстовая аналитика**.

1. Выберите план. Вы можете выбрать **бесплатный уровень с 5000 транзакциями в месяц**. Это бесплатный план, поэтому вы не будете платить за использование службы. Войдите в свою подписку Azure.

1. Заполните остальные поля и создайте учетную запись.

1. После регистрации в службе текстовой аналитики найдите свой **ключ API**. Скопируйте первичный ключ, так как он понадобится вам при использовании служб API.


## Задача 2. Определение тональности, ключевых фраз и языков ####

Вы можете легко определить тональность, ключевые фразы и язык текста. Программным путем вы получите те же результаты, которые были показаны в [демонстрационном интерфейсе](//go.microsoft.com/fwlink/?LinkID=759712).

>[AZURE.TIP] Для анализа тональности рекомендуется разбить текст на предложения. Это обычно обеспечивает более высокую точность прогноза тональности.

Обратите внимание, что поддерживаются следующие языки.

| Функция | Коды поддерживаемых языков |
|:-----|:----|
| Мнение | `en` (английский), `es` (испанский), `fr` (французский), `pt` (португальский) |
| Ключевые фразы | `en` (английский), `es` (испанский), `de` (немецкий), `ja` (японский) |


1. Необходимо будет установить для заголовков следующие параметры. Обратите внимание, что в настоящее время API-интерфейсы принимают входные данные только в формате JSON. XML не поддерживается.

		Ocp-Apim-Subscription-Key: <your API key>
		Content-Type: application/json
		Accept: application/json

1. Теперь переведите входные строки в формат JSON. Для тональности, ключевых фраз и языка используется тот же формат. Обратите внимание, что каждый идентификатор должен быть уникальным. Этот идентификатор будет возвращаться системой. Максимальный размер одного документа, который может быть передан, составляет 10 КБ. Максимальный объем всех входных данных — 1 МБ. В рамках одного вызова можно отправить не более 1000 документов. Язык — это необязательный параметр, который следует задавать при анализе текста не на английском языке. Ниже приведен пример входных данных, содержащих необязательный параметр `language` для анализа тональности или выделения ключевых фраз.

		{
			"documents": [
				{
					"language": "en",
					"id": "1",
					"text": "First document"
				},
                ...
                {
					"language": "en",
					"id": "100",
					"text": "Final document"
				}
			]
		}

1. Отправьте в систему вызов **POST** с входными данными для тональности, ключевых фраз и языка. URL-адреса будут выглядеть так:

        POST https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/sentiment
        POST https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/keyPhrases
        POST https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/languages

1. Этот вызов вернет ответ в формате JSON с идентификаторами и обнаруженными свойствами. Ниже приведен пример результата для тональности (сведения об ошибках исключены). Тональность каждого документа оценивается в полученном ответе по шкале от 0 до 1:

        // Sentiment response
		{
		  	"documents": [
				{
					"id": "1",
					"score": "0.934"
		        },
                ...
                {
					"id": "100",
					"score": "0.002"
		        },
			]
		}

        // Key phrases response
        {
		  	"documents": [
				{
					"id": "1",
					"keyPhrases": ["key phrase 1", ..., "key phrase n"]
		        },
                ...
                {
					"id": "100",
					"keyPhrases": ["key phrase 1", ..., "key phrase n"]
		        },
			]
		}

        // Languages response
        {
		  	"documents": [
				{
					"id": "1",
					"detectedLanguages": [
                        {
                            "name": "English",
                            "iso6391Name": "en",
                            "score": "1"
                        }
                    ]
		        },
                ...
                {
                    "id": "100",
                    "detectedLanguages": [
                        {
                            "name": "French",
                            "iso6391Name": "fr",
                            "score": "0.985"
                        }
                    ]
		        }
			]
		}


## Задача 3. Обнаружение тем в тексте ####

Это только что выпущенный API-интерфейс, который определяет основные темы для списка отправленных текстовых записей. Раздел определяется ключевой фразой, которая может содержать одно или несколько связанных слов. Этот API-интерфейс хорошо работает с короткими, написанными человеком текстами, такими как обзоры и отзывы пользователей.

Этот API позволяет определять темы для количества текстовых записей от нескольких сотен до тысяч. При этом **минимальное количество текстовых записей равно 100**. Записи на любом языке, кроме английского, и записи, которые содержат менее 3 слов, будут отклонены и не будут назначены темам. При определении темы максимальный размер одного отправленного документа составляет 30 КБ. Максимальный объем всех входных данных — 30 МБ.

Есть два дополнительных **необязательных** входных параметра, которые могут улучшить качество результатов.

- **Стоп-слова.** Эти слова и их грамматические формы (например, множественное число) будут исключены из конвейера обнаружения тем. Используйте этот параметр для часто встречающихся слов (например, это могут быть слова "проблема", "ошибка" и "пользователь", если речь идет о жалобах клиентов на программное обеспечение). Каждая строка должна состоять из одного слова.
- **Стоп-фразы** — эти фразы будут исключены из списка возвращаемых тем. Используйте их, чтобы исключить общие темы, которые вы не хотите видеть в результатах. Например, можно исключить такие темы, как "Microsoft" и "Azure". Строки могут содержать несколько слов.

Выполните следующие действия для обнаружения тем в тексте.

1. Укажите входные данные в формате JSON. На этот раз вы можете указать стоп-слова и стоп-фразы.

		{
			"documents": [
				{
					"id": "1",
					"text": "First document"
				},
                ...
                {
					"id": "100",
					"text": "Final document"
				}
			],
			"stopWords": [
				"issue", "error", "user"
			],
			"stopPhrases": [
				"Microsoft", "Azure"
			]
		}

1. Используя те же заголовки, что и в задаче 2, отправьте вызов **POST** к конечной точке тем.

        POST https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/topics

1. Этот вызов вернет в ответе `operation-location` в качестве заголовка, где значением является URL-адрес для запроса полученных тем.

        'operation-location': 'https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/operations/<operationId>'

1. Периодически запрашивайте возвращаемое значение `operation-location` с помощью запроса **GET**. Рекомендуется делать это один раз в минуту.

        GET https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/operations/<operationId>

1. Конечная точка вернет ответ, содержащий `{"status": "notstarted"}`, перед обработкой. Значения `{"status": "running"}` и `{"status": "succeeded"}` будут обрабатываться после получения результата. Затем можно использовать результат, который будет иметь следующий формат (обратите внимание, что такие детали, как формат ошибок и даты, исключены из этого примера):

		{
			"status": "succeeded",
			"operationProcessingResult": {
			  	"topics": [
                    {
					    "id": "8b89dd7e-de2b-4a48-94c0-8e7844265196"
					    "score": "5"
					    "keyPhrase": "first topic name"
                    },
                    ...
                    {
					    "id": "359ed9cb-f793-4168-9cde-cd63d24e0d6d"
					    "score": "3"
					    "keyPhrase": "final topic name"
                    }
                ],
			  	"topicAssignments": [
                    {
					    "topicId": "8b89dd7e-de2b-4a48-94c0-8e7844265196",
					    "documentId": "1",
					    "distance": "0.354"
                    },
                    ...
                    {
					    "topicId": "359ed9cb-f793-4168-9cde-cd63d24e0d6d",
					    "documentId": "55",
					    "distance": "0.758"
                    },            
                ]
			}
		}

Обратите внимание, что успешный ответ с темами от конечной точки `operations` будет следовать приведенной ниже схеме.

	{
    		"topics" : [{
        		"id" : "string",
        		"score" : "number",
        		"keyPhrase" : "string"
    		}],
    		"topicAssignments" : [{
        		"documentId" : "string",
        		"topicId" : "string",
        		"distance" : "number"
    		}],
    		"errors" : [{
        		"id" : "string",
        		"message" : "string"
    		}]
    	}

Ниже приведено описание каждой части этого ответа.

**topics**

| Ключ | Описание |
|:-----|:----|
| id | Уникальный идентификатор каждой темы. |
| приложения | Количество документов, назначенных теме. |
| KeyPhrase | Обобщающее слово или фраза для темы. |

**topicAssignments**

| Ключ | Описание |
|:-----|:----|
| documentId | Идентификатор документа. Соответствует идентификатору, включенному во входные данные. |
| topicId | Идентификатор темы, которому был назначен документ. |
| distance | Оценка принадлежности документа к теме от 0 до 1. Чем ниже оценка, тем вероятнее принадлежность к теме. |

**errors**

| Ключ | Описание |
|:-----|:----|
| id | Уникальный идентификатор входного документа, к которому относится ошибка. |
| message | Сообщение об ошибке. |

## Дальнейшие действия ##

Поздравляем! Вы использовали текстовую аналитику для своих данных. Теперь вы можете ознакомиться с инструментом [Power BI](//powerbi.microsoft.com) для визуализации данных, а также с автоматизацией аналитики, чтобы видеть свои текстовые данные в режиме реального времени.

<!---HONumber=AcomDC_0706_2016-->