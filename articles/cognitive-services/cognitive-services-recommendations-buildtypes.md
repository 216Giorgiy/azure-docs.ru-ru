<properties
	pageTitle="Краткое руководство: API рекомендаций для машинного обучения | Microsoft Azure"
	description="Рекомендации по Машинному обучению Azure. Краткое руководство по началу работы"
	services="cognitive-services"
	documentationCenter=""
	authors="luiscabrer"
	manager="paulettm"
	editor="cgronlun"/>

<tags
	ms.service="cognitive-services"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="05/24/2016"
	ms.author="luisca"/>

#  Типы сборок и качество модели #

<a name="TypeofBuilds"></a>
## Какой тип сборки рекомендаций следует использовать? ##

В настоящее время поддерживаются два типа сборки: *рекомендации* и *FBT*. Для создания каждой сборки используются разные алгоритмы. Кроме того, у каждой из них есть свои преимущества. В данном документе описывается каждая из этих сборок, а также методы сравнения качества создаваемых моделей.


> Если вы еще этого не сделали, рекомендуем полностью ознакомиться с [кратким руководством по началу работы](cognitive-services-recommendations-quick-start.md).

<a name="RecommendationBuild"></a>
### Сборка рекомендаций ###

Сборка *рекомендаций* использует факторизацию матрицы для предоставления рекомендаций. Если коротко, транзакции пользователя используются для создания векторов [скрытых переменных](https://en.wikipedia.org/wiki/Latent_variable), которые описывают каждый элемент. Затем при помощи этих скрытых векторов сравниваются похожие элементы.

Предположим, что нужно обучить модель на основе сведений о приобретениях в магазине электроники. При оценке вы указываете Lumia 650 в качестве модели телефона. После этого будет возвращен набор элементов, которые часто покупают люди, которые, возможно, приобретут телефон Lumia 650. Обратите внимание, что элементы могут не быть взаимодополняющими. Например, в этом примере могут быть возвращены телефоны других моделей, так как людям, которым нравится телефон Lumia 650, могут также нравиться другие телефоны.

Сборка рекомендаций обладает двумя привлекательными преимуществами:

-	Она поддерживает размещение неактивных элементов.

 *Неактивные элементы* — это элементы с низкой степенью использования. Например, представьте, что вы только что получили партию новых телефонов Lumia. Так как вы никогда не продавали их, система не сможет определить рекомендации для этого продукта только по транзакциям. Это означает, что система должна обучиться по сведениям о продукте.

 Если нужно использовать размещение неактивных элементов, необходимо указать сведения о характеристиках каждого элемента в каталоге. Первые несколько строк каталога могут выглядеть следующим образом (обратите внимание на формат "ключ=значение" для характеристик):

> 6CX-00001,Surface Pro2, Surface,, Type=Hardware, Storage=128GB, Memory=4G, Manufacturer=Microsoft

> 73H-00013,Wake Xbox 360,Gaming,, Type=Software, Language=English, Rating=Mature

> WAH-0F05,Minecraft Xbox 360,Gaming,, * Type=Software, Language=Spanish, Rating=Youth

> ...

 Кроме того, необходимо задать следующие параметры сборки:

| Параметр сборки | Примечания
|------------------     |-----------
|useFeaturesInModel | Установите значение True. Указывает, можно ли использовать характеристики для повышения эффективности модели рекомендаций. 
|allowColdItemPlacement | Установите значение True. Указывает, должны ли в рекомендации предоставляться неактивные элементы на основе сходства характеристик.
| modelingFeatureList | Разделенный запятыми список названий характеристик, которые будут использоваться при сборке рекомендаций для повышения эффективности модели рекомендаций. Например, Language,Storage для примера выше.

-	Она поддерживает рекомендации пользователей.

 Сборка рекомендаций поддерживает [рекомендации пользователей](https://westus.dev.cognitive.microsoft.com/docs/services/Recommendations.V4.0/operations/56f30d77eda5650db055a3dd). Это означает, что она может использовать журнал транзакций пользователя, чтобы предоставлять персонализированные рекомендации этому пользователю. Для рекомендаций можно указать идентификатор пользователя и/или журнал его недавних транзакций.

 Классический пример, где требуется применить рекомендации пользователя — страница приветствия при первом входе в магазин или на сайт. На ней можно прорекламировать содержимое, которое подходит конкретному пользователю.
 
 Сборку рекомендаций можно также использовать, когда пользователь собирается оформить заказ. На этом этапе есть список элементов, которые клиент собирается приобрести. Именно сейчас нужно предоставить рекомендации на основе текущего набора товаров.
 
#### Параметры сборки рекомендаций 
 
| Имя | 	Описание |	 Тип,<br> допустимые значения<br> (значение по умолчанию)
|-------|-------------------|------------------
| NumberOfModelIterations |	Число итераций, выполняемых моделью, сказывается на общей длительности вычисления и точности модели. Чем оно больше, тем выше будет точность, но вычисление займет больше времени. |	 Целое число,<br> 10–50,<br> значение по умолчанию: 40. 
| NumberOfModelDimensions |	Число измерений связано с числом характеристик, которые модель попытается выявить в ваших данных. Увеличив число измерений, можно разделить результаты на кластеры меньшего размера. Однако если измерений слишком много, модели будет трудно установить взаимосвязи между элементами. |	Целое число,<br> 10–40,<br> значение по умолчанию: 20. |
| ItemCutOffLowerBound |	Определяет минимальное количество точек использования элемента, чтобы он учитывался в модели. |		Целое число,<br> 2 или более. <br>Значение по умолчанию: 2. |
| ItemCutOffUpperBound | 	Определяет максимальное количество точек использования элемента, чтобы он учитывался в модели. | Целое число,<br> 2 или более.<br> Значение по умолчанию: 2147483647. |
|UserCutOffLowerBound |	Определяет минимальное количество транзакций, которые необходимо выполнить пользователю, чтобы он учитывался в модели. |	Целое число,<br> 2 или более. <br>Значение по умолчанию: 2. 
| ItemCutOffUpperBound |	Определяет максимальное количество транзакций, которые необходимо выполнить пользователю, чтобы он учитывался в модели. |	Целое число,<br> 2 или более. <br>Значение по умолчанию: 2147483647.|
| UseFeaturesInModel |	Указывает, можно ли использовать характеристики для повышения эффективности модели рекомендаций. | 	 Логическое значение,<br> значение по умолчанию: True. 
|ModelingFeatureList |	Разделенный запятыми список названий характеристик, которые будут использоваться при сборке рекомендаций для повышения эффективности модели рекомендаций. (Зависит от характеристик, которые важны.) |	Строка, до 512 знаков.
| AllowColdItemPlacement |	Указывает, должны ли в рекомендации предоставляться неактивные элементы на основе сходства характеристик. | Логическое значение,<br> значение по умолчанию: False.	
| EnableFeatureCorrelation | Указывает, можно ли использовать характеристику в обосновании. |	Логическое значение,<br> значение по умолчанию: False.
| ReasoningFeatureList |	Разделенный запятыми список названий характеристик, которые будут использоваться в тексте обоснования (например, в объяснении рекомендации). (Зависит от характеристик, которые важны для клиентов.) | Строка, до 512 знаков.
| EnableU2I |	Включение личных рекомендаций, т. н. U2I (рекомендации "пользователь-элемент"). | Логическое значение,<br> значение по умолчанию: True.
|EnableModelingInsights |	Определяет, следует ли выполнять автономную оценку для сбора данных аналитики моделирования (т. е. метрик точности и разнообразия). Если задано значение true, то подмножество данных не будет использоваться для обучения, так как оно потребуется для тестирования модели. Узнайте больше об [автономных оценках](#OfflineEvaluation). | Логическое значение,<br> значение по умолчанию: False.
| SplitterStrategy | Если для EnableModelingInsights задано значение true, то задает способ разделения данных для оценки. | Строка, *RandomSplitter* или *LastEventSplitter*,<br> значение по умолчанию: RandomSplitter. 


<a name="FBTBuild"></a>
### Сборка FBT ###

*FBT* расшифровывается как часто покупаемые вместе элементы. Сборка FBT выполняет анализ, при котором подсчитывается, сколько раз два или три различных продукта покупают вместе, а затем наборы продуктов сортируются с использованием функции сходства (смежность, коэффициент Жаккара, увеличение точности прогноза).

Коэффициент Жаккара и увеличение точности прогноза можно рассматривать как способы нормализации смежного использования. Это значит, что элементы будут возвращаться, только если они действительно приобретены с начальным элементом.

В примере с телефоном Lumia 650 телефон X будет возвращен, только если они оба приобретены в рамках одного сеанса. Так как вероятность такого события крайне мала, для телефона Lumia 650 возвратятся дополняющие элементы, например защитная пленка или адаптер питания.

В настоящее время предполагается приобретение двух элементов за один сеанс, если они встречаются в транзакции с одним и тем же идентификатором пользователя и одной и той же меткой времени.

Сейчас сборка FBT не поддерживает неактивные элементы, так как она по сути предполагает, что два элемента приобретены за одну транзакцию. Хотя сборки FBT и могут возвращать наборы элементов (триады), они не поддерживают персонализированные рекомендации, так как принимают один начальный элемент в качестве входных данных.


#### Параметры сборки FBT 
 
| Имя | 	Описание |		Тип,<br> допустимые значения<br> (значение по умолчанию)
|-------|---------------|-----------------------
| FbtSupportThreshold | Насколько консервативной является модель. Число одновременных вхождений элементов, которое следует учитывать при моделировании. | Целое число,<br> 3–50,<br> значение по умолчанию: 6. 
| FbtMaxItemSetSize | Ограничивает число элементов в наборе часто встречающихся.| Целое число,<br> 2–3,<br> значение по умолчанию: 2.
| FbtMinimalScore | Минимальный рейтинг, который должен иметь набор часто встречающихся элементов для включения в возвращаемые результаты. Чем выше это значение, тем лучше. | Double,<br> 0 или больше,<br> значение по умолчанию: 0.
| FbtSimilarityFunction | Определяет функцию подобия для использования в процессе построения. Увеличение повышает вероятность точности прогнозов, совместное появление повышает предсказуемость. Коэффициент Жаккара является хорошим компромиссом. | Строка,<br> <i>cooccurrence, lift, jaccard</i>,<br> значение по умолчанию: <i>jaccard</i>. 

<a name="SelectBuild"></a>
## Как подобрать сборку? ##

Рекомендаций выше может быть достаточно, чтобы определить самую подходящую сборку (рекомендаций или FBT), но бывают случаи, когда можно использовать любую из них. Кроме того, даже если вы хотите использовать сборку FBT, вам все равно нужно определить, какую функцию сходства использовать (коэффициент Жаккара или увеличение точности прогноза).

Лучше всего выбрать одну из двух сборок, протестировав каждую из них в реальной среде (оценка в сети) и отследив коэффициент конверсии для каждой из них. Коэффициент конверсии можно рассчитать на основе выбранных рекомендаций, количества фактических приобретений по показанным рекомендациям или даже на основе фактического количества денег, потраченных после отображения различных рекомендаций. Метрику коэффициента конверсии можно выбрать в зависимости от бизнес-цели.

В некоторых случаях модель нужно оценить в автономном режиме, прежде чем добавлять ее в рабочую среду. Автономная оценка не заменяет оценку в сети. Тем не менее ее можно использовать в качестве метрики.

<a name="OfflineEvaluation"></a>
## Автономная оценка  ##

Цель автономной оценки заключается в прогнозировании точности (количества пользователей, которые действительно приобретут один из рекомендуемых элементов) и разнообразия рекомендаций (фактическое количество рекомендуемых элементов). При оценке метрик точности и разнообразия система находит выборку пользователей, а затем транзакции этих пользователей делятся на две группы: набор данных для обучения и для тестирования.

> Примечание.
>
> Чтобы использовать автономные метрики, в данных об использовании должны быть метки времени. (Данные времени требуются, чтобы должным образом разделить сведения об использовании между наборами данных для обучения и тестирования.)

> Кроме того, автономная оценка может не возвратить результаты для небольших файлов использования, так как для тщательной оценки в наборе данных для тестирования должно быть не менее 1000 точек использования.

<a name="Precision"></a>
### Точность до K элементов ###
В следующей таблице представлены результаты автономной оценки способом "Точность до K элементов".

| K | 1 | 2 | 3 | 	4\. | 	5
|---|---|---|---|---|---|
|Процент |	13,75 |	18,04 | 21 |	24,31 |	26,61
|Проверяемые пользователи |	10 000 |	10 000 |	10 000 |	10 000 |	10 000
|Учтенные пользователи |	10 000 |	10 000 |	10 000 |	10 000 |	10 000
|Неучтенные пользователи |	0 |	0 |	0 |	0 |	0

#### K
В таблице выше *K* представляет количество рекомендаций, показанных клиенту. Таблицу можно растолковать следующим образом: если при тестировании клиентам будет показана только одна рекомендация, только 13,75 процента пользователей приобретут рекомендованный элемент. (При условии, что модель обучена на основе данных о приобретениях.) Кроме того, можно сказать, что точность до 1 рекомендации составляет 13,75 процента.

Обратите внимание, что с увеличением количества отображаемых элементов повышается вероятность приобретения рекомендуемых элементов. В эксперименте выше вероятность приобретения практически удваивается (26,61 процента) при рекомендации 5 элементов.

#### Процент
Процент пользователей, которые просмотрели по крайней мере одну из K показанных рекомендаций. Он рассчитывается путем деления количества пользователей, просмотревших хотя бы одну рекомендацию, на общее количество учтенных пользователей. (См. определение учтенных пользователей.)

#### Проверяемые пользователи
Общее количество пользователей в наборе данных для тестирования.

#### Учтенные пользователи
Пользователь учитывается, только если система порекомендовала по крайней мере K элементов на основе модели, созданной с использованием набора данных для обучения.

#### Неучтенные пользователи
Все пользователи, которые не учтены. Пользователи, которым не порекомендовали по крайней мере K элементов.

Неучтенные пользователи = проверяемые пользователи – учтенные пользователи

<a name="Diversity"></a>
### Разнообразие ###
Метрика разнообразия измеряет тип рекомендуемых элементов. В следующей таблице представлены результаты автономной оценки разнообразия.

|Контейнер процентилей |	0–90| 90–99| 99–100
|------------------|--------|-------|---------
|Процент | 34,258 | 55,127| 10,615


Общее количество рекомендованных элементов: 100 000

Количество уникальных рекомендованных элементов: 954

#### Контейнеры процентилей
Каждый контейнер процентилей представлен диапазоном (минимальные и максимальные значения в диапазоне от 0 до 100). Элементы, значение которых близко к 100, являются самыми популярными, а элементы, значение которых близко к 0, наименее популярны. Например, если для контейнеров процентилей в диапазоне 99–100 используется значение процента 10,6, это означает, что 10,6 процента рекомендаций вернули только 1 % самых популярных элементов. Минимальное значение контейнера процентилей является включающим, а максимальное значение — исключающим (кроме 100).
#### Количество уникальных рекомендованных элементов
Количество отдельных элементов, возвращенных для оценки.
#### Общее количество рекомендованных элементов
Общее количество элементов, которые порекомендовали (некоторые могут повторяться).


<a name="ImplementingEvaluation"></a>
### Как получить автономную оценку? ###
Автономные метрики точности и разнообразия пригодятся при выборе сборки. Чтобы получить автономные метрики, выполните следующее.

При сборке с использованием соответствующего типа (сборка рекомендаций или сборка FBT):
1.	Установите для параметра сборки enableModelingInsights значение True.

2.	При необходимости можно выбрать значение параметра *splitterStrategy* (*RandomSplitter* или *LastEventSplitter*). *RandomSplitter* разделяет данные об использовании между наборами данных для обучения и тестирования на основе процента для тестирования, указанного в параметре *randomSplitterParameters*, и случайных начальных значений. *LastEventSplitter* разделяет данные об использовании между наборами данных для обучения и тестирования на основе последней транзакции для каждого пользователя.

Таким образом вы получите сборку, которая использует только подмножество данных для обучения, при этом остальная часть данных используется для вычисления метрик оценки. Чтобы получить результаты оценки после создания сборки, необходимо просто вызвать [API получения метрик сборки](https://westus.dev.cognitive.microsoft.com/docs/services/Recommendations.V4.0/operations/573e43bb3e9d4627a8c4bd3e/console), передав соответствующие параметры *modelId* и *buildId*.

 Ниже приведены выходные данные JSON для выполненной оценки для примера:


    {
     "Result": {
     "precisionItemRecommend": null,
     "precisionUserRecommend": {
      "precisionMetrics": [
        {
          "k": 1,
          "percentage": 13.75,
          "usersInTest": 10000,
          "usersConsidered": 10000,
          "usersNotConsidered": 0
        },
        {
          "k": 2,
          "percentage": 18.04,
          "usersInTest": 10000,
          "usersConsidered": 10000,
          "usersNotConsidered": 0
        },
        {
          "k": 3,
          "percentage": 21.0,
          "usersInTest": 10000,
          "usersConsidered": 10000,
          "usersNotConsidered": 0
        },
        {
          "k": 4,
          "percentage": 24.31,
          "usersInTest": 10000,
          "usersConsidered": 10000,
          "usersNotConsidered": 0
        },
        {
          "k": 5,
          "percentage": 26.61,
          "usersInTest": 10000,
          "usersConsidered": 10000,
          "usersNotConsidered": 0
        }
      ],
      "error": null
    },
    "diversityItemRecommend": null,
    "diversityUserRecommend": {
      "percentileBuckets": [
        {
          "min": 0,
          "max": 90,
          "percentage": 34.258
        },
        {
          "min": 90,
          "max": 99,
          "percentage": 55.127
        },
        {
          "min": 99,
          "max": 100,
          "percentage": 10.615
        }
      ],
      "totalItemsRecommended": 100000,
      "uniqueItemsRecommended": 954,
      "uniqueItemsInTrainSet": null,
      "error": null
      }
     },
    "Id": 1,
    "Exception": null,
    "Status": 5,
    "IsCanceled": false,
    "IsCompleted": true,
    "CreationOptions": 0,
    "AsyncState": null,
    "IsFaulted": false
    }

<!---HONumber=AcomDC_0706_2016-->