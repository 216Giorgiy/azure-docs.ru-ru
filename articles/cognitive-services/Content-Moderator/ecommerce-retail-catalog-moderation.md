---
title: Руководство. Модерация изображений товаров для электронной коммерции с помощью Content Moderator
titlesuffix: Azure Cognitive Services
description: Настройка приложения, которое анализирует изображения товаров, классифицирует их по указанным меткам (с использованием Компьютерного зрения Azure и Пользовательского визуального распознавания) и помечает нежелательные изображения тегами для последующего просмотра с помощью Azure Content Moderator.
services: cognitive-services
author: PatrickFarley
manager: nitinme
ms.service: cognitive-services
ms.subservice: content-moderator
ms.topic: tutorial
ms.date: 01/10/2019
ms.author: pafarley
ms.openlocfilehash: 5c4d2320ffd54054eb8a5bb26ef14c8e99dabb33
ms.sourcegitcommit: 5839af386c5a2ad46aaaeb90a13065ef94e61e74
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2019
ms.locfileid: "57855960"
---
# <a name="tutorial-moderate-e-commerce-product-images-with-azure-content-moderator"></a>Руководство по Модерация изображений товаров для электронной коммерции с помощью Azure Content Moderator

В этом руководстве описано, как с помощью служб Azure Cognitive Services, включая Content Moderator, эффективно классифицировать и модерировать изображения товаров в сценарии электронной коммерции. Мы будем использовать Компьютерное зрение и Пользовательское визуальное распознавание для присвоения изображениям различных тегов (меток) с последующим проведением командной проверки. В основе интеллектуальной системы модерации лежит сочетание технологий машинного обучения в Content Moderator и усилий людей из команды проверки.

В этом учебнике описаны следующие процедуры.

> [!div class="checklist"]
> * Регистрация в Content Moderator и создание команды проверки.
> * Поверка изображений на наличие потенциального содержимого для взрослых и непристойного содержимого с помощью API проверки Content Moderator.
> * Использование Компьютерного зрения для проверки на наличие знаменитостей (или применения других тегов, обнаруживаемых с помощью Компьютерного зрения).
> * Применение Пользовательского визуального распознавания для проверки наличия флагов, игрушек и ручек (или применения других пользовательских тегов).
> * Предоставление комбинированных результатов проверки для пользовательской оценки и окончательного принятия решений.

Полный кода для этого примера доступен в репозитории [Samples eCommerce Catalog Moderation](https://github.com/MicrosoftContentModerator/samples-eCommerceCatalogModeration) на сайте GitHub.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

- Ключ подписки Content Moderator. Следуйте инструкциям в руководстве по [созданию учетной записи Cognitive Services](https://docs.microsoft.com/azure/cognitive-services/cognitive-services-apis-create-account), чтобы получить подписку и ключ для службы Content Moderator.
- Ключ подписки Компьютерного зрения (см. те же инструкции).
- Любой выпуск [Visual Studio 2015 или 2017](https://www.visualstudio.com/downloads/).
- Набор изображений для каждой метки, которую будет использовать классификатор Пользовательского визуального распознавания (в нашем примере это игрушки, ручки и флаги США).

## <a name="create-a-review-team"></a>Создание команды проверки

Изучите статью [Краткое руководство. Опробование Content Moderator в Интернете](quick-start.md), в которой предоставлены инструкции по регистрации для использования [средства проверки Content Moderator](https://contentmoderator.cognitive.microsoft.com/) и созданию команды проверки. Запишите значение **Идентификатор команды**, которое указано на странице **Учетные данные**.

## <a name="create-custom-moderation-tags"></a>Создание пользовательских тегов модерации

Теперь создайте настраиваемые теги в средстве проверки (если потребуется помощь с этим процессом, см. [сведения о тегах](https://docs.microsoft.com/azure/cognitive-services/content-moderator/review-tool-user-guide/tags)). В нашем примере добавляются следующие теги: **celebrity** (знаменитость), **USA** (США), **flag** (флаг), **toy** (игрушка) и **pen** (ручка). Обратите внимание, что в качестве тегов можно использовать не только категории, выявляемые Компьютерным зрением (например, **celebrities**), но и настраиваемые пользовательские теги, для обнаружения которых вы позже проведете обучение классификатора Пользовательского визуального распознавания.

![Настройка пользовательских тегов](images/tutorial-ecommerce-tags2.PNG)

## <a name="create-visual-studio-project"></a>Создание проекта Visual Studio

1. В Visual Studio откройте диалоговое окно "Новый проект". Разверните узел **Установленные**, затем — **Visual C#** и выберите **Консольное приложение (платформа .NET)**.
1. Присвойте приложению имя **EcommerceModeration** и щелкните **ОК**.
1. Если вы добавляете проект в уже существующее решение, определите его как один запускаемый проект.

В этом руководстве внимание уделяется только той части кода, которая важна для нашего проекта. Мы не будем обсуждать каждую строку этого кода. Скопируйте все содержимое файла _Program.cs_ из примера проекта ([Samples eCommerce Catalog Moderation](https://github.com/MicrosoftContentModerator/samples-eCommerceCatalogModeration)) в файл _Program.cs_ в новом проекте. Затем примените пошаговые инструкции из следующих разделов, которые помогут разобраться в устройстве этого проекта и способах его использования.

## <a name="define-api-keys-and-endpoints"></a>Определение ключей и конечных точек API

Как упоминалось выше, в этом руководстве используются три службы Cognitive Services, для которых вам потребуется три комплекта ключей и конечных точек API. Добавьте следующие поля в класс **Program**: 

[!code-csharp[define API keys and endpoint URIs](~/samples-eCommerceCatalogModeration/Fusion/Program.cs?range=21-29)]

В полях `___Key` следует указать реальные значения ключей подписки (значение `CustomVisionKey` вы получите позже), а поля `___Uri` нужно изменить так, чтобы они содержали правильные идентификаторы регионов. В сегменте `YOURTEAMID` поля `ReviewUri` поместите идентификатор ранее созданной команды проверки. Заключительную часть поля `CustomVisionUri` мы заполним позже.

## <a name="primary-method-calls"></a>Вызовы основных методов

Обратите внимание на представленный ниже код из метода **Main**, который в цикле просматривает список URL-адресов изображений. Он вызывает три разные службы для анализа каждого изображения, записывает полученные теги в массив **ReviewTags** и создает анализ для модераторов (то есть отправляет изображения в средство просмотра Content Moderator). Мы подробно рассмотрим эти методы в следующих разделах. Обратите внимание, что здесь вы можете отбирать изображения для дополнительного анализа, проверяя сохраненные в массив **ReviewTags** теги с помощью условного оператора.

[!code-csharp[Main: evaluate each image and create review](~/samples-eCommerceCatalogModeration/Fusion/Program.cs?range=53-70)]

## <a name="evaluateadultracy-method"></a>Метод EvaluateAdultRacy

Просмотрите метод **EvaluateAdultRacy** в классе **Program**. Этот метод принимает в качестве параметров URL-адрес изображения и массив пар "ключ — значение". Он создает вызов REST к API изображений Content Moderator, чтобы получить оценки изображений для взрослых и изображений непристойного характера. Если любая из оценок превысит значение 0,4 (по шкале от 0 до 1), то соответствующему параметру в массиве **ReviewTags** присваивается значение **True**.

[!code-csharp[define EvaluateAdultRacy method](~/samples-eCommerceCatalogModeration/Fusion/Program.cs?range=73-113)]

## <a name="evaluatecustomvisiontags-method"></a>Метод EvaluateCustomVisionTags

Следующий метод принимает URL-адрес изображения и сведения о подписке Компьютерного зрения и анализирует изображение на наличие знаменитостей. Если он обнаружит одну или несколько знаменитостей, соответствующему параметру в массиве **ReviewTags** присваивается значение **True**. 

[!code-csharp[define EvaluateCustomVisionTags method](~/samples-eCommerceCatalogModeration/Fusion/Program.cs?range=115-146)]

## <a name="evaluatecustomvisiontags-method"></a>Метод EvaluateCustomVisionTags

Теперь мы перейдем к методу **EvaluateCustomVisionTags**, который классифицирует товары — в нашем примере это флаги, игрушки и ручки. Следуйте инструкциям в руководстве по [созданию классификатора](https://docs.microsoft.com/azure/cognitive-services/custom-vision-service/getting-started-build-a-classifier), чтобы создать настраиваемый пользовательский классификатор изображений для определения наличия флагов, игрушек и ручек (вы можете выбрать любые другие пользовательские теги).

![Веб-страница Пользовательского визуального распознавания с обучающими изображениями ручек, игрушек и флагов](images/tutorial-ecommerce-custom-vision.PNG)

Завершив обучение классификатора, получите ключ прогнозирования и URL-адрес конечной точки прогнозирования (если потребуется помощь, воспользуйтесь [этими инструкциями](https://docs.microsoft.com/azure/cognitive-services/custom-vision-service/use-prediction-api#get-the-url-and-prediction-key)) и сохраните эти значения в поля `CustomVisionKey` и `CustomVisionUri`, соответственно. Этот метод использует значения в запросе к классификатору. Если классификатор обнаружит на изображении один или несколько пользовательских тегов, он сохранит значения **True** для соответствующих параметров в массиве **ReviewTags**. 

[!code-csharp[define EvaluateCustomVisionTags method](~/samples-eCommerceCatalogModeration/Fusion/Program.cs?range=148-171)]

## <a name="create-reviews-for-review-tool"></a>Создание проверок для средства проверки

В предыдущих разделах вы изучили методы, которые анализируют поступающие изображения на наличие содержимого для взрослых и содержимого непристойного характера (Content Moderator), знаменитостей (Компьютерное зрение) и определенных объектов (Пользовательское визуальное распознавание). Теперь мы перейдем к методу **CreateReview**, который загружает изображения и все присвоенные им теги (в виде _Metadata_) в средство просмотра Content Moderator, где они будут доступны для проверки человеком. 

[!code-csharp[define CreateReview method](~/samples-eCommerceCatalogModeration/Fusion/Program.cs?range=173-196)]

Эти изображения будут отображаться на вкладке Review (Проверка) в [средстве проверки Content Moderator](https://contentmoderator.cognitive.microsoft.com/).

![Снимок экрана средства проверки Content Moderator с несколькими изображениями и выделенными тегами](images/tutorial-ecommerce-content-moderator.PNG)

## <a name="submit-a-list-of-test-images"></a>Отправка списка тестовых изображений

В методе **Main** вы видите код, который проверяет наличие каталога C:Test с файлом _Urls.txt_, который содержит список URL-адресов изображений. Создайте файл и каталог с указанными именами или измените эти значения, чтобы они указывали на ваш текстовый файл с URL-адресами проверяемых изображений.

[!code-csharp[Main: set up test directory, read lines](~/samples-eCommerceCatalogModeration/Fusion/Program.cs?range=38-51)]

## <a name="run-the-program"></a>Запуск программы

Если вы правильно выполнили все описанные выше действия, программа обработает каждое изображение (создав запросы ко всем трем службам для получения соответствующих тегов) и передаст изображения вместе со сведениями о тегах в средство проверки Content Moderator.

## <a name="next-steps"></a>Дополнительная информация

В этом руководстве вы настроили программу, которая анализирует изображения товаров и присваивает им теги с типами товаров, а затем передает изображения команде проверки для принятия обоснованных решений по модерации содержимого. Теперь переходите к подробному изучению модерации изображений.

> [!div class="nextstepaction"]
> [Проверка прошедших модерацию изображений](./review-tool-user-guide/review-moderated-images.md)
