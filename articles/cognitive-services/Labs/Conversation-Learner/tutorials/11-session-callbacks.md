---
title: Использование обратных вызовов сеансов в модели Conversation Learner в Microsoft Cognitive Services | Документация Майкрософт
titleSuffix: Azure
description: Сведения об использовании обратных вызовов сеансов в модели Conversation Learner.
services: cognitive-services
author: v-jaswel
manager: nolachar
ms.service: cognitive-services
ms.component: conversation-learner
ms.topic: article
ms.date: 04/30/2018
ms.author: v-jaswel
ms.openlocfilehash: 0f51b232470e4e4da3f25d40d025dd3b09dd1204
ms.sourcegitcommit: 4e5ac8a7fc5c17af68372f4597573210867d05df
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/20/2018
ms.locfileid: "39171921"
---
# <a name="how-to-use-session-callbacks-with-a-conversation-learner-model"></a>Использование обратных вызовов сеансов в приложении Conversation Learner

В этом руководстве показано использование обратных вызовов onSessionStart и onSessionEnd.

## <a name="video"></a>Видео

[![Предварительная версия руководства 11](http://aka.ms/cl-tutorial-11-preview)](http://aka.ms/blis-tutorial-11)

## <a name="requirements"></a>Требования
Для работы с этим руководством требуется запущенный бот `tutorialSessionCallbacks`.

    npm run tutorial-session-callbacks

## <a name="details"></a>Сведения
В этом руководстве объясняется концепция сеанса, правила обработки сеансов по умолчанию и переопределение этих правил.

Сеансом считается один диалог с ботом. Он может включать несколько ходов, но не должен иметь длительных перерывов (например, более 30 минут).  Допустимая по умолчанию длительность времени ожидания в сеансе приводится на странице справки об ограничениях.

При длительных перерывах бот начинает следующий сеанс.  Запуск нового сеанса восстанавливает исходное состояние нейронной сети.  По умолчанию при этом запуске также очищаются все значения сущностей, но это поведение можно переопределить (см. ниже).

### <a name="open-the-demo"></a>Запуск демонстрационного примера

В списке моделей щелкните Tutorial-11-SessionCallbacks. 

### <a name="entities"></a>Сущности

В модели определены четыре сущности.

![](../media/tutorial11_entities.PNG)

Здесь важно заметить, что BotName — это программная сущность.  Эта сущность устанавливается ботом в начале нового сеанса.

### <a name="actions"></a>Действия

В модели определены четыре действия.

![](../media/tutorial11_actions.PNG)

Сначала в этом руководстве объясняется, как управлять значениями сущности в начале сеанса — например, задать сущность BotName еще до того, как пользователь что-либо скажет.

Затем в этом руководстве объясняется, как сохранять значения между сеансами.  В этом руководстве предполагается, что имя пользователя и номер телефона остаются неизменными при переходе от одного сеанса к другому, но расположение может измениться.  Поэтому мы сохраняем имя и номер телефона между сеансами, но очищаем сведения о расположении пользователя.

### <a name="train-dialog"></a>Обучение диалогу

Ниже приведен пример диалога. Это все один сеанс, то есть в диалоге нет длительных перерывов.

![](../media/tutorial11_traindialog.PNG)

### <a name="code-for-the-callbacks"></a>Код для обратных вызовов

Код для методов обратного вызова находится в файле c:\<каталог_установки>\src\demos\tutorialSessionCallbacks.ts.

![](../media/tutorial11_code.PNG)

Оба метода являются необязательными.

- Метод OnSessionStartCallback задает сущность BotName.
- Метод OnSessionEndCallback позволяет указать, какие данные нужно сохранять. Такой вариант очистит все данные сущностей, за исключением имени и телефона пользователя.

### <a name="try-the-bot"></a>Проверка работы бота

Перейдите в веб-интерфейс и щелкните "Log Dialogs" (Записи диалогов).

1. Введите "hello" (Здравствуйте).
2. Система: "Hi, I'm Botty. What's your name?" (Привет, меня зовут Botty. А ты кто?), где имя Botty взято из метода OnSessionStartCallback.
3. Введите имя "jason" (Павел).
4. Система: "Hi jason. What's your phone number?" (Привет, Павел. Какой у тебя номер телефона?).
5. Введите номер "555-555-5555".
6. Система: "Can you tell Botty your location, jason?" (Павел, ты можешь сказать Botty, где ты находишься?)
7. Введите "Redmond" (Ростов).

Это завершение первого сеанса. Чтобы начать новый сеанс, нужно завершить текущий. 

1. Щелкните "Session Timeout" (Время ожидания сеанса). После этого мы перейдем в следующий сеанс.
    - Кнопка "Session Timeout" (Время ожидания сеанса) предоставлена для отладки.  В реальном сеансе придется дождаться окончания периода ожидания, то есть примерно 30 минут.  Допустимая по умолчанию длительность времени ожидания в сеансе приводится на странице справки об ограничениях.
1. Введите "hi" (Привет).
2. Система: "Can you tell Botty your location, jason?" (Павел, ты можешь сказать Botty, где ты находишься?)
    - Система запомнила имя и номер телефона пользователя.
2. Введите новое расположение: "Seattle" (Самара).
3. Система: "So, jason you are in Seattle" (Итак, Павел сейчас в городе Самара).
4. Щелкните "Done Testing" (Завершить тестирование).

Теперь переключитесь на представление "Log Dialogs" (Записи диалогов). Обратите внимание, что последний диалог разделен на два, так как каждый записанный диалог соответствует одному сеансу.  

![](../media/tutorial11_splitdialogs.PNG)

- В первом взаимодействии задано имя Botty, но нет ни имени, ни номера телефона.
- Второе взаимодействие уже содержит имя и номер телефона.

Теперь вы знаете, как работают правила обработки сеансов по умолчанию и как переопределить эти правила. 

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Вызовы API](./12-api-calls.md)
