---
title: Параметры контейнера Docker
titleSuffix: Language Understanding - Azure Cognitive Services
description: Среда выполнения контейнера LUIS настраивается с помощью аргументов команды `docker run`. LUIS поддерживает несколько обязательных и несколько необязательных параметров.
services: cognitive-services
author: diberry
manager: cgronlun
ms.custom: seodec18
ms.service: cognitive-services
ms.component: language-understanding
ms.topic: conceptual
ms.date: 12/04/2018
ms.author: diberry
ms.openlocfilehash: 98828589832d69ada11205e471314a153a566766
ms.sourcegitcommit: 9fb6f44dbdaf9002ac4f411781bf1bd25c191e26
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/08/2018
ms.locfileid: "53080271"
---
# <a name="configure-containers"></a>Настройка контейнеров

Среда выполнения контейнера Интеллектуальной службы распознавания речи (LUIS) настраивается с помощью аргументов команды `docker run`. LUIS поддерживает несколько обязательных и несколько необязательных параметров. Доступны несколько [примеров](#example-docker-run-commands) этой команды. Для конкретного контейнера настраиваются входные [параметры подключения](#mount-settings) и параметры выставления счетов. 

Параметры контейнера применяются [иерархически](#hierarchical-settings) и настраиваются через [переменные среды](#environment-variable-settings) или [аргументы командной строки](#command-line-argument-settings) Docker.

## <a name="configuration-settings"></a>Параметры конфигурации

К контейнеру применяются следующие параметры конфигурации.

|Обязательно|Параметр|Назначение|
|--|--|--|
|Yes|[apiKey](#apikey-setting)|Используется для отслеживания данных для выставлении счетов.|
|Нет |[ApplicationInsights](#applicationinsights-setting)|Позволяет добавить в контейнер поддержку телеметрии [Azure Application Insights](https://docs.microsoft.com/azure/application-insights).|
|Yes|[Выставление счетов](#billing-setting)|Задает URI конечной точки для ресурса _службы "Распознавание речи"_ в Azure.|
|Yes|[Лицензионное соглашение](#eula-setting)| Указывает, что вы приняли условия лицензии для контейнера.|
|Нет |[Fluentd](#fluentd-settings)|Записывает данные в журнал и (необязательно) передает метрики на сервер Fluentd.|
|Нет |[ведению журналов](#logging-settings)|Обеспечивает поддержку ведения журнала ASP.NET Core для вашего контейнера. |
|Yes|[Подключения](#mount-settings)|Читает и записывает данные с [главного компьютера](luis-container-howto.md#the-host-computer) в контейнер и обратно.|

> [!IMPORTANT]
> Параметры [`ApiKey`](#apikey-setting), [`Billing`](#billing-setting) и [`Eula`](#eula-setting) используются совместно, и для всех трех параметров необходимо указать допустимые значения. В противном случае контейнер не запустится. Дополнительные сведения об использовании этих параметров конфигурации для создания экземпляра контейнера см. в разделе [Выставление счетов](luis-container-howto.md#billing).

## <a name="apikey-setting"></a>Параметр ApiKey

Параметр `ApiKey` определяет ключ ресурса Azure, который используется для отслеживания данных для выставления счетов для контейнера. Значение ApiKey является обязательным и должно содержать допустимый ключ ресурса службы _Распознавание речи_, который определяется в параметре конфигурации [`Billing`](#billing-setting).

Этот параметр можно найти в двух местах.

* На портале Azure. В разделе управления ресурсами для службы **Распознавание речи** есть область **Ключи**
* На портале LUIS. На странице **параметров ключей и конечной точки**. 

Не используйте начальный ключ или ключ разработки. 

## <a name="applicationinsights-setting"></a>Параметр ApplicationInsights.

Параметр `ApplicationInsights` позволяет добавить в контейнер поддержку телеметрии [Azure Application Insights](https://docs.microsoft.com/azure/application-insights). Служба Application Insights обеспечивает детализированный мониторинг контейнера. Вы можете легко отслеживать доступность, производительность и использование своего контейнера. Вы также можете быстро идентифицировать и диагностировать ошибки в контейнере.

В следующей таблице описаны параметры конфигурации, поддерживаемые в разделе `ApplicationInsights`.

|Обязательно| ИМЯ | Тип данных | ОПИСАНИЕ |
|--|------|-----------|-------------|
|Нет | `InstrumentationKey` | Строка | Ключ инструментирования экземпляра Application Insights, которому отправляются данные телеметрии для контейнера. Дополнительные сведения см. в статье [Application Insights для ASP.NET Core](https://docs.microsoft.com/azure/application-insights/app-insights-asp-net-core). <br><br>Пример:<br>`InstrumentationKey=123456789`|


## <a name="billing-setting"></a>Настройка выставления счетов

Параметр `Billing` определяет URI конечной точки ресурса службы _Распознавание речи_ в Azure, который используется для контроля данных для выставления счетов для контейнера. Для этого параметра конфигурации необходимо задать значение, которое должно быть допустимым URI конечной точки для ресурса службы _Распознавание речи_ в Azure.

Этот параметр можно найти в двух местах.

* На портале Azure. В разделе обзорной информации о службе **Распознавание речи**, под меткой `Endpoint`
* На портале LUIS. На странице **параметров ключей и конечной точки**, в составе URI конечной точки.

|Обязательно| ИМЯ | Тип данных | ОПИСАНИЕ |
|--|------|-----------|-------------|
|Yes| `Billing` | Строка | URI конечной точки выставления счетов<br><br>Пример:<br>`Billing=https://westus.api.cognitive.microsoft.com/luis/v2.0` |

## <a name="eula-setting"></a>Параметр Eula

Параметр `Eula` указывает, что вы приняли условия лицензии для контейнера. Для этого параметра конфигурации необходимо указать значение `accept`.

|Обязательно| ИМЯ | Тип данных | ОПИСАНИЕ |
|--|------|-----------|-------------|
|Yes| `Eula` | Строка | Принятие условий лицензионного соглашения<br><br>Пример:<br>`Eula=accept` |

Лицензия на использование контейнеров Cognitive Services предоставляется в рамках [вашего соглашения](https://go.microsoft.com/fwlink/?linkid=2018657) об использовании Azure. Если вы не заключали соглашение, регламентирующее использование Azure, вы подтверждаете, что ваше соглашение об использовании Azure является [соглашением Microsoft Online Subscription](https://go.microsoft.com/fwlink/?linkid=2018755), которое содержит [условия использования веб-служб](https://go.microsoft.com/fwlink/?linkid=2018760). Что касается предварительных версий, вы также принимаете [Дополнительные условия использования предварительных версий Microsoft Azure](https://go.microsoft.com/fwlink/?linkid=2018815). Факт использования вами контейнера подтверждает ваше согласие с этими условиями.

## <a name="fluentd-settings"></a>Параметры Fluentd

Fluentd — это сборщик данных с открытым кодом для унифицированного ведения журнала. Параметры `Fluentd` управляют подключением контейнера к серверу [Fluentd](https://www.fluentd.org). В состав контейнера LUIS входит поставщик ведения журнала Fluentd, который позволяет контейнеру записывать данные журнала и (необязательно) данные метрик на сервер Fluentd.

В следующей таблице описаны параметры конфигурации, поддерживаемые в разделе `Fluentd`.

| ИМЯ | Тип данных | ОПИСАНИЕ |
|------|-----------|-------------|
| `Host` | Строка | IP-адрес или имя узла DNS сервера Fluentd. |
| `Port` | Целое число  | Порт сервера Fluentd.<br/> Значение по умолчанию — 24224. |
| `HeartbeatMs` | Целое число  | Интервал пульса в миллисекундах. Если до окончания этого интервала не отправлялся никакой трафик событий, пульс отправляется на сервер Fluentd. Значение по умолчанию — 60 000 миллисекунд (1 минута). |
| `SendBufferSize` | Целое число  | Место в сетевом буфере (в байтах), выделенное для операций отправки. Значение по умолчанию — 32768 байт (32 килобайта). |
| `TlsConnectionEstablishmentTimeoutMs` | Целое число  | Время ожидания (в миллисекундах) до установки соединения по протоколу SSL/TLS с сервером Fluentd. Значение по умолчанию — 10 000 миллисекунд (10 секунд).<br/> Если для параметра `UseTLS` задано значение false, то это значение игнорируется. |
| `UseTLS` | Логическое | Указывает, должен ли контейнер использовать протокол SSL/TLS для связи с сервером Fluentd. По умолчанию для этого параметра используется значение false. |

## <a name="logging-settings"></a>Параметры ведения журнала

Параметры `Logging` управляют поддержкой ведения журнала ASP.NET Core для контейнера. Вы можете использовать для контейнера те же параметры конфигурации и значения, что и для приложения ASP.NET Core. 

Контейнер LUIS поддерживает указанные ниже поставщики ведения журналов.

|Поставщик|Назначение|
|--|--|
|[Console](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-2.1#console-provider)|Поставщик ведения журнала `Console` для ASP.NET Core. Для этого поставщика ведения журнала поддерживаются все параметры конфигурации ASP.NET Core и значения по умолчанию.|
|[Отладка](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-2.1#debug-provider)|Поставщик ведения журнала `Debug` для ASP.NET Core. Для этого поставщика ведения журнала поддерживаются все параметры конфигурации ASP.NET Core и значения по умолчанию.|
|[Диск](#disk-logging)|Поставщик ведения журнала JSON. Поставщик ведения журнала записывает данные журнала в выходное подключение.|

### <a name="disk-logging"></a>Ведение журнала диска
  
Поставщик ведения журнала `Disk` поддерживает перечисленные ниже параметры конфигурации:  

| ИМЯ | Тип данных | ОПИСАНИЕ |
|------|-----------|-------------|
| `Format` | Строка | Выходной формат файлов журналов.<br/> **Примечание.** Чтобы включить поставщик ведения журнала, необходимо указать значение `json`. Если это значение задано без указания выходного подключения, при создании экземпляра контейнера возникает ошибка. |
| `MaxFileSize` | Целое число  | Максимальный размер файла журнала в мегабайтах (МБ). Когда размер текущего файла журнала достигает этого значения или превышает его, поставщик ведения журнала создает файл журнала. Если задано значение –1, то размер файла журнала ограничивается только максимальным размером файла (если он задан) для выходного подключения. Значение по умолчанию — 1. |

Дополнительные сведения о настройке поддержки ведения журналов для ASP.NET Core см. в разделе [Настройка файла параметров](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-2.1#settings-file-configuration).

## <a name="mount-settings"></a>Параметры подключения

Используйте подключения привязок для чтения данных из контейнера и записи в него. Вы можете указать входное или выходное подключение, указав параметр `--mount` в команде [docker run](https://docs.docker.com/engine/reference/commandline/run/). 

Контейнер LUIS не использует входные или выходные подключения для хранения учебных данных или данных службы. 

Точный синтаксис расположения подключения к узлу зависит от операционной системы узла. Кроме того,расположение подключения на [главном компьютере](luis-container-howto.md#the-host-computer) может оказаться недоступным из-за конфликта между разрешениями для учетной записи службы Docker и расположения подключения к узлу. 

В следующей таблице описаны поддерживаемые параметры.

|Обязательно| ИМЯ | Тип данных | ОПИСАНИЕ |
|-------|------|-----------|-------------|
|Yes| `Input` | Строка | Цель входного подключения. По умолчанию используется значение `/input`. Это расположение файлов из пакета LUIS. <br><br>Пример:<br>`--mount type=bind,src=c:\input,target=/input`|
|Нет | `Output` | Строка | Цель выходного подключения. По умолчанию используется значение `/output`. Это расположение файлов журналов. Сюда относятся журналы запросов LUIS и журналы контейнера. <br><br>Пример:<br>`--mount type=bind,src=c:\output,target=/output`|

## <a name="hierarchical-settings"></a>Иерархические параметры

Параметры для контейнера LUIS имеют иерархическую структуру, и все контейнеры на [главном компьютере](luis-container-howto.md#the-host-computer) используют общую иерархию.

Для настройки параметров можно использовать любой из следующих методов.

* [Переменные среды](#environment-variable-settings)
* [Аргументы командной строки](#command-line-argument-settings).

Значения переменных среды переопределяют значения аргументов командной строки, которые, в свою очередь, переопределяют значения по умолчанию для образа контейнера. Если в переменной среды и аргументе командной строки указаны разные значения для одного параметра конфигурации, при создании экземпляра контейнера будет использоваться значение из переменной среды.

|Приоритет|Расположение параметра|
|--|--|
|1|Переменная среды| 
|2|Командная строка|
|3|Значение по умолчанию в образе контейнера|

### <a name="environment-variable-settings"></a>Параметры переменных среды

Преимущества использования переменных среды:

* Можно настроить несколько параметров.
* Для нескольких контейнеров можно использовать одинаковые параметры.

### <a name="command-line-argument-settings"></a>Параметры аргументов командной строки

Преимущество использования аргументов командной строки заключается в том, что каждый контейнер может использовать разные параметры.

## <a name="example-docker-run-commands"></a>Примеры команд docker run

В следующих примерах параметры конфигурации иллюстрируют процесс написания и использования команд `docker run`.  После запуска контейнер продолжает работу, пока вы его не [остановите](luis-container-howto.md#stop-the-container).


* **Символ продолжения строки**. В командах Docker в следующих разделах используется обратная косая черта (`\`) как символ продолжения строки. Замените или удалите ее в соответствии с требованиями вашей операционной системы. 
* **Порядок аргументов**. Не изменяйте порядок аргументов, если вы еще не очень хорошо знакомы с контейнерами Docker.

Замените строку {_имя_аргумента_} собственными значениями.

| Placeholder | Значение | Формат или пример |
|-------------|-------|---|
|{ENDPOINT_KEY} | Ключ конечной точки обученного приложения LUIS. |xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx|
|{BILLING_ENDPOINT} | Значение конечной точки выставления счетов доступно на странице обзора службы "Распознавание речи" на портале Azure.|https://westus.api.cognitive.microsoft.com/luis/v2.0|

> [!IMPORTANT]
> Для запуска контейнера необходимо указать параметры `Eula`, `Billing` и `ApiKey`. В противном случае контейнер не запустится.  Дополнительные сведения см. в [разделе о выставлении счетов](luis-container-howto.md#billing).
> Значение ApiKey содержит **ключ**, который можно получить на странице параметров ключей и конечной точки на портале LUIS или на странице ключей ресурсов службы "Распознавание речи" в Azure. 

### <a name="basic-example"></a>Простой пример

В следующем примере указано минимальное число аргументов, с которым можно запустить контейнер.

```bash
docker run --rm -it -p 5000:5000 --memory 4g --cpus 2 \
--mount type=bind,src=c:\input,target=/input \
--mount type=bind,src=c:\output,target=/output \
mcr.microsoft.com/azure-cognitive-services/luis:latest \
Eula=accept \
Billing={BILLING_ENDPOINT} \
ApiKey={ENDPOINT_KEY}
```

> [!Note] 
> Предыдущая команда использует каталог с диска `c:`, чтобы избежать конфликтов разрешений в Windows. Если вам требуется конкретный каталог для входных данных, возможно, потребуется предоставить соответствующие разрешения службе Docker. В предыдущей команде Docker используется обратная косая черта (`\`) как символ продолжения строки. Замените или удалите ее в соответствии с требованиями операционной системы [главного компьютера](luis-container-howto.md#the-host-computer). Не изменяйте порядок аргументов, если вы еще не очень хорошо знакомы с контейнерами Docker.


### <a name="applicationinsights-example"></a>Пример ApplicationInsights

В следующем примере задается аргумент ApplicationInsights для отправки данных телеметрии в Application Insights во время выполнения контейнера:

```bash
docker run --rm -it -p 5000:5000 --memory 6g --cpus 2 \
--mount type=bind,src=c:\input,target=/input \
--mount type=bind,src=c:\output,target=/output \
mcr.microsoft.com/azure-cognitive-services/luis:latest \
Eula=accept \
Billing={BILLING_ENDPOINT} \
ApiKey={ENDPOINT_KEY}
InstrumentationKey={INSTRUMENTATION_KEY}
```

### <a name="logging-example-with-command-line-arguments"></a>Пример настройки ведения журнала через аргументы командной строки

Следующая команда задает уровень ведения журнала `Logging:Console:LogLevel`, чтобы настроить уровень ведения журнала [`Information`](https://msdn.microsoft.com). 

```bash
docker run --rm -it -p 5000:5000 --memory 6g --cpus 2 \
--mount type=bind,src=c:\input,target=/input \
--mount type=bind,src=c:\output,target=/output \
mcr.microsoft.com/azure-cognitive-services/luis:latest \
Eula=accept \
Billing={BILLING_ENDPOINT} \
ApiKey={ENDPOINT_KEY} \
Logging:Console:LogLevel=Information
```

### <a name="logging-example-with-environment-variable"></a>Пример настройки ведения журнала с помощью переменной среды

Следующая команда задает переменную среды `Logging:Console:LogLevel`, чтобы настроить уровень ведения журнала [`Information`](https://msdn.microsoft.com). 

```bash
SET Logging:Console:LogLevel=Information
docker run --rm -it -p 5000:5000 --memory 6g --cpus 2 \
--mount type=bind,src=c:\input,target=/input \
--mount type=bind,src=c:\output,target=/output \
mcr.microsoft.com/azure-cognitive-services/luis:latest \
Eula=accept \
Billing={BILLING_ENDPOINT} \
ApiKey={APPLICATION_ID} \
```

## <a name="next-steps"></a>Дополнительная информация

* Изучите статью об [установке и запуске контейнеров](luis-container-howto.md).
* Чтобы решить проблемы, связанные с функциональностью LUIS, ознакомьтесь с [часто задаваемыми вопросами](luis-resources-faq.md).