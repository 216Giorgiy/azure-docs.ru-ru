---
title: 'Руководство по созданию приложения LUIS для получения данных расположения: Azure | Документация Майкрософт'
description: В этом руководстве вы узнаете, как создать простое приложение LUIS, использующее намерения и иерархическую сущность для извлечения данных.
services: cognitive-services
author: v-geberr
manager: kaiqb
ms.service: cognitive-services
ms.component: luis
ms.topic: tutorial
ms.date: 03/27/2018
ms.author: v-geberr
ms.openlocfilehash: 2547407126943161ba604fa2f5e80b9186cae57e
ms.sourcegitcommit: 301855e018cfa1984198e045872539f04ce0e707
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2018
ms.locfileid: "36266504"
---
# <a name="tutorial-create-app-that-uses-hierarchical-entity"></a>Руководство по созданию приложения, использующего иерархическую сущность
В этом руководстве создается приложение, которое показывает, как найти взаимосвязанные элементы данных с учетом контекста. 

<!-- green checkmark -->
> [!div class="checklist"]
> * Основные сведения об иерархических сущностях и обученных по контексту дочерних элементах. 
> * Создание посвященного путешествиям приложения LUIS с намерением Bookflight.
> * Добавление намерения _None_ и примеров фраз.
> * Добавление иерархической сущности расположения с дочерними элементами исходного и целевого расположений.
> * Тестирование и публикация приложения.
> * Запрос конечной точки приложения, чтобы увидеть ответ JSON LUIS, в том числе иерархические дочерние элементы. 

Для работы с этой статьей требуется бесплатная учетная запись [LUIS][LUIS], в которой вы разработаете приложение LUIS.

## <a name="purpose-of-the-app-with-this-entity"></a>Назначение приложения с этой сущностью
Это приложение определяет, хочет ли пользователь забронировать рейс. Иерархические сущности используются для определения расположений, исходного города и города назначения в тексте пользователя. 

Иерархическая сущность является оптимальным выбором для этого типа данных из-за двух блоков данных:

* Оба расположения обычно выражаются в виде кодов городов или аэропортов.
* Обычно есть уникальный набор слов, позволяющих определить, какой из городов является исходным, а какой — городом назначения. Например, "по направлению в", "едет", "из", "покидает".
* Они часто содержатся в одной фразе. 

Назначение **иерархической** сущности — находить связанные данные во фразе, исходя из контекста. Рассмотрите следующую фразу:

```JSON
1 ticket from Seattle to Cairo`
```

Во фразе указано два расположения: исходный город — Сиэтл, а город назначения — Каир. Оба эти города важны при бронировании рейса. Хотя их можно найти с помощью простых сущностей, они связаны друг с другом и будут часто встречаться в одной и той же фразе. Таким образом, целесообразно, чтобы они оба были распределены как дочерние элементы иерархической сущности **Расположение**. 

Так как это обученные с помощью машинного обучения сущности, приложению требуются примеры фраз с отмеченными исходным городом и городом назначения. Это обучает приложение LUIS тому, где сущности размещаются во фразе, насколько они длинные и какие слова с ними связаны. 

## <a name="app-intents"></a>Намерения приложения
Намерения — это категории того, что нужно пользователю. У этого приложения два намерения: BookFlight и None. Намерение [None](luis-concept-intent.md#none-intent-is-fallback-for-app) является целенаправленным и указывает что-либо, не отвечающее предназначению приложения.  

## <a name="hierarchical-entity-is-contextually-learned"></a>Иерархические сущности обучаются с учетом контекста 
Целью сущности является поиск и категоризация частей текста во фразе. [Иерархическая](luis-concept-entity-types.md) сущность — это сущность с отношением "родительский — дочерний", основанная на контексте употребления слов. Пользователь может определить исходный город и город назначения во фразе, основываясь на использовании `to` и `from`. Это пример использования в контексте.  

Для этого приложения путешествий LUIS извлекает исходное расположение и расположение назначения так, чтобы можно было создать и заполнить стандартное бронирование. В LUIS фразы могут включать вариации, аббревиатуры и сленг. 

Ниже приведены примеры простых фраз пользователей.

```
Book a flight to London for next Monday
2 tickets from Dallas to Dublin this weekend
Researve a seat from New York to Paris on the first of April
```

Ниже приведены сокращенные или сленговые версии фраз.

```
LHR tomorrow
SEA to NYC next Monday
LA to MCO spring break
```
 
Иерархическая сущность сопоставляет исходное расположение и расположение назначения. Если имеется только один дочерний элемент (источник или назначение) иерархической сущности, он по-прежнему будет извлечен. Не нужно находить все дочерние элементы, чтобы извлечь один или несколько. 

## <a name="what-luis-does"></a>Действия приложения LUIS
Когда намерение и сущности фразы будут определены, [извлечены](luis-concept-data-extraction.md#list-entity-data) и возвращены в формате JSON из [конечной точки](https://aka.ms/luis-endpoint-apis), работа LUIS будет завершена. Вызывающее приложение или чат-бот принимает этот ответ JSON и выполняет запрос любым настроенным в нем способом. 

## <a name="create-a-new-app"></a>Создание нового приложения
1. Выполните вход на веб-сайте [LUIS][LUIS]. Войдите в [регион][LUIS-regions], где нужно опубликовать конечные точки LUIS.

2. На веб-сайте [LUIS][LUIS] выберите **Create new app** (Создать приложение).  

    [![](media/luis-quickstart-intent-and-hier-entity/app-list.png "Снимок экрана страницы со списком приложений")](media/luis-quickstart-intent-and-hier-entity/app-list.png#lightbox)

3. Во всплывающем диалоговом окне введите имя `MyTravelApp`. 

    [![](media/luis-quickstart-intent-and-hier-entity/create-new-app.png "Снимок экрана всплывающего диалогового окна создания приложения")](media/luis-quickstart-intent-and-hier-entity/create-new-app.png#lightbox)

4. После завершения процесса появится страница **намерений** с намерением **None**. 

    [![](media/luis-quickstart-intent-and-hier-entity/intents-page-none-only.png "Снимок экрана списка намерений с намерением None")](media/luis-quickstart-intent-and-hier-entity/intents-page-none-only.png#lightbox)

## <a name="create-a-new-intent"></a>Создание намерения

1. На странице **намерений** выберите **Create new intent** (Создать намерение). 

    [![](media/luis-quickstart-intent-and-hier-entity/create-new-intent-button.png "Снимок экрана со списком намерений и выделенной кнопкой \"Create new intent\" (Создать намерение)")](media/luis-quickstart-intent-and-hier-entity/create-new-intent-button.png#lightbox)

2. Введите имя нового намерения `BookFlight`. Это намерение следует выбирать каждый раз, когда пользователь хочет забронировать авиабилет.

    Создавая намерение, вы создаете основную категорию информации, которую хотите идентифицировать. Благодаря присвоению имени категории любое другое приложение, использующее результаты запроса LUIS, по этому имени может найти подходящий ответ или предпринять соответствующее действие. LUIS не ответит на эти вопросы, а только определит, какой тип информации запрашивается на естественном языке. 

    [![](media/luis-quickstart-intent-and-hier-entity/create-new-intent.png "Снимок экрана всплывающего диалогового окна создания намерения")](media/luis-quickstart-intent-and-hier-entity/create-new-intent.png#lightbox)

3. Добавьте в намерение `BookFlight` несколько фраз, которые вы ожидаете от пользователя, например:

    | Примеры фраз|
    |--|
    |Забронировать 2 билета на авиарейс из Сиэтла в Каир на следующий понедельник|
    |Зарезервировать билет до Лондона на завтра|
    |Забронировать 4 места из Парижа в Лондон на 1 апреля|

    [![](media/luis-quickstart-intent-and-hier-entity/enter-utterances-on-intent.png "Снимок экрана ввода фраз на странице намерения BookFlight")](media/luis-quickstart-intent-and-hier-entity/enter-utterances-on-intent.png#lightbox)

## <a name="add-utterances-to-none-intent"></a>Добавление фраз в намерение None

В настоящее время приложение LUIS не содержит фраз для намерения **None**. Ему требуются фразы, на которые приложению не нужно отвечать. Их необходимо указать в намерении **None**. Заполните его. 

1. Выберите **намерения** на панели слева. 

    [![](media/luis-quickstart-intent-and-hier-entity/select-intents-from-bookflight-intent.png "Снимок экрана страницы намерений BookFlight с выделенной кнопкой намерений")](media/luis-quickstart-intent-and-hier-entity/select-intents-from-bookflight-intent.png#lightbox)

2. Выберите намерение **None**. Добавьте три фразы, которые может ввести пользователь, но которые не имеют отношения к приложению:

    | Примеры фраз|
    |--|
    |Отмена!|
    |До свидания!|
    |Что происходит?|

## <a name="when-the-utterance-is-predicted-for-the-none-intent"></a>Фразы, которые попадут в намерение None
В приложении, вызывающем LUIS (таком как чат-бот), когда LUIS возвращает намерение **None** для фразы, бот может спросить, хочет ли пользователь завершить разговор. Бот может также дать больше указаний для продолжения разговора, если пользователь хочет продолжить. 

Сущности выполняются в намерении **None**. Если намерение с высшим показателем — **None**, но сущность извлечена, что важно для чат-бота, он может задать уточняющий вопрос, который сосредоточен на намерении клиента. 

## <a name="create-a-location-entity-from-the-intent-page"></a>Создание сущности расположения на странице намерения
Теперь, когда у двух намерений есть фразы, приложению LUIS нужно понять расположение. Вернитесь к намерению `BookFlight` и отметьте имя города во фразе, выполнив следующие шаги:

1. Вернитесь к намерению `BookFlight`, выбрав **намерения** на левой панели.

2. Выберите `BookFlight` из списка намерений.

3. Во фразе `Book 2 flights from Seattle to Cairo next Monday` выберите слово `Seattle`. Появится раскрывающееся меню с текстовым полем в верхней области для создания сущности. Введите имя сущности `Location` в текстовом поле, а затем выберите в раскрывающемся меню **Create new entity** (Создать сущность). 

    [![](media/luis-quickstart-intent-and-hier-entity/label-seattle-in-utterance.png "Снимок экрана страницы намерений BookFlight, создание сущности из выделенного текста")](media/luis-quickstart-intent-and-hier-entity/label-seattle-in-utterance.png#lightbox)

4. Во всплывающем окне выберите **иерархический** тип сущности с `Origin` и `Destination` в качестве дочерних сущностей. Нажмите кнопку **Готово**.

    [![](media/luis-quickstart-intent-and-hier-entity/hier-entity-ddl.png "Снимок экрана всплывающего диалогового окна создания сущности для новой сущности \"Расположение\"")](media/luis-quickstart-intent-and-hier-entity/hier-entity-ddl.png#lightbox)

    Метка для `Seattle` помечается как `Location`, так как LUIS не знает, это исходный город, город назначения или ни один из них. Выберите `Seattle`, затем выберите "Location" (Расположение), а затем в меню справа выберите `Origin` (Исходное расположение).

5. Теперь, когда сущность создана и одна фраза помечена, пометьте другие города. Для этого выберите имя города, щелкните "Location" (Расположение), а затем в меню справа выберите `Origin` (Исходное расположение) или `Destination` (Расположение назначения).

    [![](media/luis-quickstart-intent-and-hier-entity/label-destination-in-utterance.png "Снимок экрана сущности Bookflight с текстом фразы, выбранным для выделения сущности")](media/luis-quickstart-intent-and-hier-entity/label-destination-in-utterance.png#lightbox)

## <a name="train-the-luis-app"></a>Обучение приложения LUIS
Приложение LUIS не знает об изменениях намерений и сущностей (модели), пока не будет обучено. 

1. В верхней правой части веб-сайта LUIS нажмите кнопку **Train** (Обучить).

    ![Обучение приложения](./media/luis-quickstart-intent-and-hier-entity/train-button.png)

2. Когда обучение будет завершено, в верхней части веб-сайта появится зеленая панель состояния, свидетельствующая об успешном результате.

    ![Обучение успешно выполнено](./media/luis-quickstart-intent-and-hier-entity/trained.png)

## <a name="publish-the-app-to-get-the-endpoint-url"></a>Публикация приложения для получения URL-адреса конечной точки
Чтобы получить прогноз LUIS в чат-боте или другом приложении, необходимо опубликовать приложение. 

1. В верхней правой части веб-сайта LUIS нажмите кнопку **Publish** (Опубликовать). 

    [![](media/luis-quickstart-intent-and-hier-entity/publish.png "Снимок экрана намерения BookFlight с выделенной кнопкой \"Publish\" (Опубликовать)")](media/luis-quickstart-intent-and-hier-entity/publish.png#lightbox)

2. Выберите слот "Production" (Рабочий) и нажмите кнопку **Publish** (Опубликовать).

    [![](media/luis-quickstart-intent-and-hier-entity/publish-to-production.png "Снимок экрана страницы публикации с выделенной кнопкой \"Publish\" (Опубликовать) и выбранным слотом \"Production\" (Рабочий)")](media/luis-quickstart-intent-and-hier-entity/publish-to-production.png#lightbox)

3. Когда публикация будет завершена, в верхней части веб-сайта появится зеленая панель состояния, свидетельствующая об успешном результате.

## <a name="query-the-endpoint-with-a-different-utterance"></a>Запрос конечной точки с другой фразой
1. В нижней части страницы **публикации** выберите ссылку на **конечную точку**. В результате откроется другое окно браузера с URL-адресом конечной точки в адресной строке. 

    [![](media/luis-quickstart-intent-and-hier-entity/publish-select-endpoint.png "Снимок экрана страницы публикации с выделенным URL-адресом конечной точки")](media/luis-quickstart-intent-and-hier-entity/publish-select-endpoint.png#lightbox)

2. Перейдите в конец URL-адреса и введите `1 ticket to Portland on Friday`. Последний параметр строки запроса — `q`. Это **запрос** фразы. Эта фраза не совпадает ни с какими помеченными фразами, поэтому она является хорошим тестом. В результате должно быть возвращено намерение `BookFlight` с извлечением иерархической сущности.

```
{
  "query": "1 ticket to Portland on Friday",
  "topScoringIntent": {
    "intent": "BookFlight",
    "score": 0.9998226
  },
  "intents": [
    {
      "intent": "BookFlight",
      "score": 0.9998226
    },
    {
      "intent": "None",
      "score": 0.221926212
    }
  ],
  "entities": [
    {
      "entity": "portland",
      "type": "Location::Destination",
      "startIndex": 12,
      "endIndex": 19,
      "score": 0.564448953
    }
  ]
}
```

## <a name="what-has-this-luis-app-accomplished"></a>Результаты работы этого приложения LUIS
Это приложение, состоящее всего из двух намерений и иерархической сущности, идентифицировало намерение запроса на естественном языке и вернуло извлеченные данные. 

Ваш чат-бот теперь имеет достаточно информации для определения основного действия, `BookFlight`, а информацию о расположении можно найти во фразе. 

## <a name="where-is-this-luis-data-used"></a>Место использования этих данных приложения LUIS 
Приложение LUIS уже выполнило этот запрос. Вызывающее приложение, например чат-бот, может принять результат намерения с наивысшим показателем и данные из сущности, чтобы выполнить следующий шаг. LUIS не выполняет программные действия за чат-бота или вызывающее приложение. LUIS только определяет намерение пользователя. 

## <a name="clean-up-resources"></a>Очистка ресурсов
Удалите приложение LUIS, если оно больше не нужно. Чтобы сделать это, щелкните меню с тремя точками (...) справа от имени приложения в списке приложений и выберите пункт **Delete** (Удалить). Во всплывающем диалоговом окне **Delete app?** (Удалить приложение?) нажмите кнопку **ОК**.

## <a name="next-steps"></a>Дополнительная информация
> [!div class="nextstepaction"] 
> Узнайте, как [добавить список сущностей](luis-quickstart-intent-and-list-entity.md). 

Добавьте [предварительно созданную сущность](luis-how-to-add-entities.md#add-prebuilt-entity) **номера**, чтобы извлечь номер. 

Добавьте [предварительно созданную сущность](luis-how-to-add-entities.md#add-prebuilt-entity) **datetimeV2**, чтобы извлечь сведения о дате.


<!--References-->
[LUIS]: https://docs.microsoft.com/azure/cognitive-services/luis/luis-reference-regions#luis-website
[LUIS-regions]: https://docs.microsoft.com/azure/cognitive-services/luis/luis-reference-regions#publishing-regions
