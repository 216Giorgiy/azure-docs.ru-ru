---
title: Руководство. Применение пользовательского средства обнаружения логотипов для распознавания служб Azure. Средство "Пользовательское визуальное распознавание"
titlesuffix: Azure Cognitive Services
description: В этом руководстве описан пример приложения, в котором средство "Пользовательское визуальное распознавание" Azure используется в сценарии обнаружения логотипа. Узнайте, как средство "Пользовательское визуальное распознавание" используется с другими компонентами для создания комплексного приложения.
services: cognitive-services
author: PatrickFarley
manager: cgronlun
ms.service: cognitive-services
ms.component: custom-vision
ms.topic: tutorial
ms.date: 12/21/2018
ms.author: pafarley
ms.openlocfilehash: 520e1981544f6ad0a6f1412a47dc8ea50fdd53a5
ms.sourcegitcommit: 415742227ba5c3b089f7909aa16e0d8d5418f7fd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2019
ms.locfileid: "55771467"
---
# <a name="tutorial-recognize-azure-service-logos-in-camera-pictures"></a>Руководство. Распознавание логотипов служб Azure на изображениях с камеры

В этом руководстве описан пример приложения, в котором средство "Пользовательское визуальное распознавание" Azure используется как часть большого сценария. Приложение AI Visual Provision (на базе Xamarin.Forms) для мобильных платформ анализирует изображения логотипов служб Azure с камеры, а затем развертывает эти службы в учетной записи пользователя Azure. В этой статье описано, как применять средство "Пользовательское визуальное распознавание" совместно с другими компонентами для создания эффективного комплексного приложения. Возможно, вы захотите полностью запустить приложение для себя или настроить только средство "Пользовательское визуальное распознавание" и изучить, как оно используется в приложении.

В этом учебнике показано, как выполнять следующие действия.

> [!div class="checklist"]
> - создание пользовательского средства обнаружения объектов для распознавания логотипов служб Azure;
> - подключение приложения к API "Компьютерное зрение" и средству "Пользовательское визуальное распознавание" Azure;
> - создание учетной записи субъекта-службы Azure для развертывания служб Azure из приложения.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/), прежде чем начинать работу. 

## <a name="prerequisites"></a>Предварительные требования

- [Visual Studio 2017](https://www.visualstudio.com/downloads/)
- рабочая нагрузка Xamarin для Visual Studio (см. дополнительные сведения в статье [Установка Xamarin в Visual Studio 2017](https://docs.microsoft.com/xamarin/cross-platform/get-started/installation/windows));
- эмулятор iOS или Android для Visual Studio;
- [интерфейс командной строки Azure (CLI)](https://docs.microsoft.com/cli/azure/install-azure-cli-windows?view=azure-cli-latest) (необязательно).

## <a name="get-the-source-code"></a>Получение исходного кода

Если вы хотите использовать предоставленное веб-приложение, клонируйте или скачайте исходный код приложения из репозитория [AI Visual Provision](https://github.com/Microsoft/AIVisualProvision) на GitHub. Откройте файл *Source/VisualProvision.sln* в Visual Studio. Позже вы внесете необходимые изменения в некоторые файлы проекта, чтобы иметь возможность запустить приложение.

## <a name="create-an-object-detector"></a>Создание средства обнаружения объектов

Войдите на веб-сайт [Пользовательского визуального распознавания](https://customvision.ai/) и создайте проект. Укажите тип проекта Object Detection (Обнаружение объектов) и выберите в разделе Domains (Области) пункт Logo (Логотип). Это позволит службе использовать алгоритм, оптимизированный для обнаружения логотипов. 

![диалоговое окно создания проекта на веб-сайте Пользовательского визуального распознавания в браузере Chrome](media/azure-logo-tutorial/new-project.png)

## <a name="upload-and-tag-images"></a>Отправка и снабжение тегами изображений

Затем необходимо обучить алгоритм обнаружения логотипов. Отправьте изображения логотипов служб Azure и вручную добавьте к ним теги. В репозитории AIVisualProvision есть набор изображений, которые можно использовать для обучения. На сайте нажмите кнопку **Add images** (Добавить изображения) на вкладке **Training Images** (Изображения для обучения) и перейдите в папку репозитория **Documents/Images/Training_DataSet**. Вам придется вручную добавлять теги к логотипам на каждом изображении. Поэтому, если вы только тестируете этот проект, можно загрузить часть изображений. Необходимо загрузить не менее 15 экземпляров каждого тега, который вы планируете использовать.

После загрузки изображений для обучения выберите первое изображение на экране. Откроется диалоговое окно добавления тегов. На каждом изображении выделите рамкой каждый логотип и присвойте ему тег. 

![изображение добавления тегов к логотипам на веб-сайте Пользовательского визуального распознавания](media/azure-logo-tutorial/tag-logos.png)

В приложении используются строки тегов определенного формата. См. определения в файле *Source\VisualProvision\Services\Recognition\RecognitionService.cs*:

[!code-csharp[tag definitions](~/AIVisualProvision/Source/VisualProvision/Services/Recognition/RecognitionService.cs?range=18-33)]

После добавления тегов перейдите вправо к следующему изображению. По завершении выйдите из окна добавления тегов.

## <a name="train-the-object-detector"></a>Обучение средства обнаружения объектов

На панели слева установите переключатель **Tags** (Теги) в положение **Tagged** (С тегом): так вы сможете просмотреть все свои изображения. Затем нажмите зеленую кнопку в верхней части страницы, чтобы перейти к обучению модели. Таким образом вы обучите алгоритм распознавать одинаковые теги на новых изображениях. Алгоритм также протестирует модель на нескольких существующих изображениях, чтобы создать оценки точности.

![сайт Пользовательского визуального распознавания, открыта вкладка Training Images (Изображения для обучения), выделена кнопка Train (Обучение)](media/azure-logo-tutorial/train-model.png)

## <a name="get-the-prediction-url"></a>Получение URL-адреса прогнозирования

После обучения модели ее можно интегрировать в свое приложение. Для этого вам нужно получить URL-адрес конечной точки (адрес вашей модели, запрашиваемый приложением) и ключ прогнозирования (чтобы предоставить приложению доступ к запросам прогнозирования). В верхней части страницы на вкладке **Performance** (Производительность) щелкните **Prediction URL** (URL-адрес прогнозирования).

![сайт Пользовательского визуального распознавания с экраном API прогнозирования, на котором показаны URL-адрес и ключ API](media/azure-logo-tutorial/cusvis-endpoint.png)

Скопируйте URL-адрес файла изображения и значение `Prediction-key`, а затем вставьте их в соответствующие поля в файле *Source\VisualProvision\AppSettings.cs*:

[!code-csharp[Custom Vision fields](~/AIVisualProvision/Source/VisualProvision/AppSettings.cs?range=22-26)]

## <a name="examine-custom-vision-usage"></a>Проверка работы Пользовательского визуального распознавания

Откройте файл *Source/VisualProvision/Services/Recognition/CustomVisionService.cs*, чтобы проверить, как ключ и URL-адрес конечной точки Пользовательского визуального распознавания используются в приложении. Метод **PredictImageContentsAsync** принимает поток байтов файла изображения с токеном отмены (для управления асинхронными задачами), вызывает API прогнозирования Пользовательского визуального распознавания и возвращает результат прогнозирования. 

[!code-csharp[Custom Vision fields](~/AIVisualProvision/Source/VisualProvision/Services/Recognition/CustomVisionService.cs?range=12-28)]

Этот результат принимает форму экземпляра **PredictionResult**, который в свою очередь содержит список экземпляров **Prediction**. Экземпляр **Prediction** содержит обнаруженный тег и расположение ограничивающего прямоугольника на изображении.

[!code-csharp[Custom Vision fields](~/AIVisualProvision/Source/VisualProvision/Services/Recognition/Prediction.cs?range=3-12)]

Если вы хотите узнать больше о том, как приложение обрабатывает эти данные, начните с метода **GetResourcesAsync**, определенного в файле *Source/VisualProvision/Services/Recognition/RecognitionService.cs*. 

## <a name="add-computer-vision"></a>Добавление API "Компьютерное зрение"

На этом часть, посвященная средству "Пользовательское визуальное распознавание", завершена, но если вы хотите запустить приложение, необходимо также интегрировать службу "Компьютерное зрение". В этом приложении кроме процесса обнаружения логотипов Azure используется функция распознавания текста службы "Компьютерное зрение". Логотип Azure можно распознать по изображению _или_ по тексту, напечатанному рядом с логотипом. В отличие от моделей Пользовательского визуального распознавания, служба "Компьютерное зрение" предварительно обучена для выполнения определенных операций с изображениями или видео.

Оформите подписку на службу "Компьютерное зрение", чтобы получить ключ и URL-адрес конечной точки. См. дополнительные сведения о выполнении этого шага в статье [Получение ключей подписки](https://docs.microsoft.com/azure/cognitive-services/computer-vision/vision-api-how-to-topics/howtosubscribe).

![служба "Компьютерное зрение" на портале Azure с выбранным меню быстрого запуска; ссылка на ключи и URL-адрес конечной точки API выделены](media/azure-logo-tutorial/comvis-keys.png)

Затем откройте файл *Source\VisualProvision\AppSettings.cs* и заполните переменные `ComputerVisionEndpoint` и `ComputerVisionKey` правильными значениями.

[!code-csharp[Computer Vision fields](~/AIVisualProvision/Source/VisualProvision/AppSettings.cs?range=28-32)]


## <a name="create-a-service-principal"></a>Создание субъекта-службы

Для развертывания служб в подписке Azure приложению потребуется учетная запись субъекта-службы. Субъект-служба позволяет делегировать приложению определенные разрешения с помощью управления доступом на основе ролей. См. дополнительные сведения в статье [Предоставление приложениям доступа к ресурсам Azure Stack за счет создания субъектов-служб](https://docs.microsoft.com/azure/azure-stack/user/azure-stack-create-service-principals).

Вы можете создать субъект-службу с помощью Azure Cloud Shell или Azure CLI следующим образом. Во-первых, войдите в учетную запись и выберите подписку, которую хотите использовать.

```console
az login
az account list
az account set --subscription "<subscription name or subscription id>"
```

Затем создайте субъект-службу (обратите внимание, что это может занять некоторое время).

```console
az ad sp create-for-rbac --name <servicePrincipalName> --password <yourSPStrongPassword>
```

После успешного завершения в выходных данных вы увидите показанный ниже код JSON с необходимыми учетными данными.

```json
{
  "clientId": "(...)",
  "clientSecret": "(...)",
  "subscriptionId": "(...)",
  "tenantId": "(...)",
  ...
}
```
Запишите значения `clientId` и `tenantId`. Введите их в соответствующие поля в файле *Source\VisualProvision\AppSettings.cs*.

[!code-csharp[Computer Vision fields](~/AIVisualProvision/Source/VisualProvision/AppSettings.cs?range=8-16)]

## <a name="run-the-app"></a>Запуск приложения

На этом этапе вы предоставили приложению доступ к:
* обученной модели Пользовательского визуального распознавания;
* службе "Компьютерное зрение";
* учетной записи субъекта-службы. 

Чтобы запустить приложение, сделайте следующее.

1. В обозревателе решений Visual Studio выберите проект VisualProvision.Android или VisualProvision.iOS и соответствующий эмулятор или подключенное мобильное устройство из раскрывающегося меню на главной панели инструментов (обратите внимание, что для запуска эмулятора iOS вам потребуется устройство MacOS). Затем запустите приложение.

1. На первом экране, который загрузится после запуска, введите идентификатор клиента для субъекта-службы, идентификатор арендатора и пароль. Нажмите кнопку **входа**.

    > [!NOTE]
    > В некоторых эмуляторах кнопка **входа** может быть неактивной на этом этапе. В таком случае остановите приложение и откройте файл _Source/VisualProvision/Pages/LoginPage.xaml_. Найдите элемент `Button` с меткой LOGIN BUTTON и удалите следующую строку:
      ```xaml
      IsEnabled="{Binding IsValid}"
      ```
    
    > Затем снова запустите приложение.

    ![экран приложения с полями для ввода учетных данных субъекта-службы](media/azure-logo-tutorial/app-credentials.png)

1. На следующем экране выберите свою подписку Azure в раскрывающемся меню (оно должно содержать все подписки, к которым у вашего субъекта-службы есть доступ). Нажмите кнопку **Продолжить**.

    ![экран приложения с раскрывающимся полем "Целевая подписка Azure"](media/azure-logo-tutorial/app-az-subscription.png)

    На этом этапе приложению может потребоваться доступ к камере и хранилищу фотографий на вашем устройстве. Подтвердите эти разрешения.

1. После этого на вашем устройстве включится камера. Сделайте снимок одного из логотипов служб Azure, для которого выполнено обучение. В диалоговом окне развертывания вам будет предложено выбрать регион и группу ресурсов для новых служб (как при развертывании на портале Azure). 

    ![экран камеры смартфона с двумя вырезанными бумажными логотипами Azure](media/azure-logo-tutorial/app-camera-capture.png)

    ![экран приложения с полями для указания региона развертывания и группы ресурсов](media/azure-logo-tutorial/app-deployment-options.png)

## <a name="clean-up-resources"></a>Очистка ресурсов 

Если вы выполнили все шаги этого сценария и использовали приложение для развертывания служб Azure в своей учетной записи, по завершении обязательно перейдите на [портал Azure](https://ms.portal.azure.com/) и отключите службы, которые вы не будете использовать.

Кроме того, если вы планируете в будущем создать собственный проект обнаружения объектов с помощью Пользовательского визуального распознавания, проект обнаружения логотипов, созданный в рамках этого руководства, можно удалить. При работе в бесплатной пробной версии Пользовательского визуального распознавания можно использовать два проекта. На [веб-сайте Пользовательского визуального распознавания](https://customvision.ai) перейдите в раздел **Projects** (Проекты) и щелкните значок корзины под заголовком **My New Project** (Мой новый проект).

## <a name="next-steps"></a>Дополнительная информация

Изучив это руководство, вы настроили и изучили полнофункциональное приложение Xamarin.Forms, в котором для обнаружения логотипов на изображениях с камер мобильных устройств применяется Пользовательское визуальное распознавание. Теперь изучите рекомендации по созданию модели Пользовательского визуального распознавания, чтобы при разработке собственного приложения вы могли создать точную и эффективную модель.

> [!div class="nextstepaction"]
> [Как улучшить классификатор](getting-started-improving-your-classifier.md)