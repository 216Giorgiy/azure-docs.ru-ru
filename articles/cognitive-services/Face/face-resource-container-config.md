---
title: Настройка контейнеров
titlesuffix: Face - Azure Cognitive Services
description: Параметры конфигурации контейнеров.
services: cognitive-services
author: diberry
manager: cgronlun
ms.custom: seodec18
ms.service: cognitive-services
ms.component: text-analytics
ms.topic: conceptual
ms.date: 01/22/2019
ms.author: diberry
ms.openlocfilehash: a75f5ec11644bbd64a6bafeb8585371437eedc3b
ms.sourcegitcommit: cf88cf2cbe94293b0542714a98833be001471c08
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54476926"
---
# <a name="configure-containers"></a>Настройка контейнеров

Контейнер распознавания лиц использует общую платформу конфигурации, что позволяет легко настроить и контролировать хранилище, ведение журнала и данные телеметрии, а также параметры безопасности для контейнеров.

## <a name="configuration-settings"></a>Параметры конфигурации

Параметры конфигурации в контейнере распознавания лиц являются иерархическими, а все контейнеры используют общую иерархию, основываясь на следующей структуре верхнего уровня:

* [apiKey](#apikey-configuration-setting)
* [ApplicationInsights](#applicationinsights-configuration-settings)
* [Проверка подлинности](#authentication-configuration-settings)
* [Выставление счетов](#billing-configuration-setting)
* [CloudAI](#cloudai-configuration-settings)
* [Eula](#eula-configuration-setting)
* [Fluentd](#fluentd-configuration-settings)
* [Параметры учетных данных прокси-сервера HTTP](#http-proxy-credentials-settings)
* [ведению журналов](#logging-configuration-settings)
* [Подключения](#mounts-configuration-settings)

Можно использовать либо [переменные среды](#configuration-settings-as-environment-variables), либо [аргументы командной строки](#configuration-settings-as-command-line-arguments) для определения параметров конфигурации при создании экземпляра контейнера распознавания лиц.

Значения переменных среды переопределяют значения аргументов командной строки, которые, в свою очередь, переопределяют значения по умолчанию для образа контейнера. Другими словами, если задать разные значения в переменной среды и аргументе командной строки для одного параметра конфигурации, такие как `Logging:Disk:LogLevel`, а затем создать контейнер, значение в переменной среды будет использоваться созданным контейнером.

### <a name="configuration-settings-as-environment-variables"></a>Параметры конфигурации в виде переменных среды

Для определения параметров конфигурации можно использовать [синтаксис переменных среды ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/configuration/?view=aspnetcore-2.1&tabs=basicconfiguration#configuration-by-environment).

Контейнер считывает переменные среды пользователя при создании контейнера. Если существует переменная среды, ее значение переопределяет значение по умолчанию для указанного параметра конфигурации. Преимущество использования переменных среды заключается в том, что перед созданием экземпляров контейнеров можно задать несколько параметров конфигурации, а несколько контейнеров могут автоматически использовать один и тот же набор параметров конфигурации.

Например, приведенные ниже команды используют переменную среды, чтобы задать уровень ведения журнала консоли [LogLevel.Information](https://msdn.microsoft.com), а потом создают контейнер распознавания лиц из образа. Значение переменной среды переопределяет параметр конфигурации по умолчанию.

  ```Docker
  SET Logging:Console:LogLevel=Information
  docker run --rm -it -p 5000:5000 --memory 4g --cpus 1 containerpreview.azurecr.io/microsoft/cognitive-services-face Eula=accept Billing=https://westcentralus.api.cognitive.microsoft.com/face/v1.0 ApiKey=0123456789
  ```

### <a name="configuration-settings-as-command-line-arguments"></a>Параметры конфигурации в виде аргументов командной строки

Вы можете использовать [синтаксис аргументов командной строки ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/configuration/?view=aspnetcore-2.1&tabs=basicconfiguration#arguments) для определения параметров конфигурации.

Вы можете определять параметры конфигурации в необязательном параметре `ARGS` команды [docker run](https://docs.docker.com/engine/reference/commandline/run/), которая используется для создания контейнера из скачанного образа контейнера. Преимущество использования аргументов командной строки заключается в том, что каждый контейнер может использовать отдельный пользовательский набор параметров конфигурации.

Например, приведенная ниже команда создает экземпляр контейнера распознавания лиц из образа и задает уровень ведения журнала консоли LogLevel.Information, переопределяя параметр конфигурации по умолчанию.

  ```Docker
  docker run --rm -it -p 5000:5000 --memory 4g --cpus 1 containerpreview.azurecr.io/microsoft/cognitive-services-face Eula=accept Billing=https://westcentralus.api.cognitive.microsoft.com/face/v1.0 ApiKey=0123456789 Logging:Console:LogLevel=Information
  ```

## <a name="apikey-configuration-setting"></a>Параметр конфигурации ApiKey

Параметр конфигурации `ApiKey` задает ключ конфигурации для ресурса распознавания лиц в Azure, с помощью которого отслеживаются данные для выставления счетов, связанные с этим контейнером. Вам необходимо задать значение этого параметра конфигурации, которое должно быть допустимым ключом конфигурации для ресурса распознавания лиц, определяемого для параметра конфигурации [`Billing`](#billing-configuration-setting).

> [!IMPORTANT]
> Параметры конфигурации [`ApiKey`](#apikey-configuration-setting), [`Billing`](#billing-configuration-setting) и [`Eula`](#eula-configuration-setting) используются совместно, и для всех трех параметров необходимо указать допустимые значения. В противном случае контейнер не запустится. Дополнительные сведения об использовании этих параметров конфигурации для создания экземпляра контейнера см. в разделе [Выставление счетов](face-how-to-install-containers.md#billing).

## <a name="applicationinsights-configuration-settings"></a>Параметры конфигурации Application Insights

С помощью параметров конфигурации в разделе `ApplicationInsights` можно добавить в контейнер поддержку телеметрии [Azure Application Insights](https://docs.microsoft.com/azure/application-insights). Application Insights обеспечивает детализированный мониторинг контейнера на уровне кода. Вы можете легко отслеживать доступность, производительность и использование своего контейнера. Вы также можете быстро идентифицировать и диагностировать ошибки в контейнере, не дожидаясь, пока пользователь сообщит о них.

В следующей таблице описаны параметры конфигурации, поддерживаемые в разделе `ApplicationInsights`.

| ИМЯ | Тип данных | ОПИСАНИЕ |
|------|-----------|-------------|
| `InstrumentationKey` | Строка | Ключ инструментирования экземпляра Application Insights, которому отправляются данные телеметрии для контейнера. Дополнительные сведения см. в статье [Application Insights для ASP.NET Core](https://docs.microsoft.com/azure/application-insights/app-insights-asp-net-core). |

## <a name="authentication-configuration-settings"></a>Параметры конфигурации проверки подлинности

Параметры конфигурации `Authentication` предоставляют параметры безопасности Azure для контейнера. Несмотря на то что в этом разделе доступны параметры конфигурации, контейнер распознавания лиц не использует этот раздел.

| ИМЯ | Тип данных | ОПИСАНИЕ |
|------|-----------|-------------|
| `Storage` | Строка | Ключ инструментирования экземпляра Application Insights, которому отправляются данные телеметрии для контейнера. Дополнительные сведения см. в статье [Application Insights для ASP.NET Core](https://docs.microsoft.com/azure/application-insights/app-insights-asp-net-core). |

## <a name="billing-configuration-setting"></a>Параметр конфигурации выставления счетов

Параметр конфигурации `Billing` определяет URI конечной точки ресурса API распознавания лиц в Azure. Этот параметр используется для контроля данных, связанных с контейнером, для выставления счетов. Для этого параметра конфигурации необходимо задать значение, которое должно быть допустимым URI конечной точки для ресурса распознавания лиц в Azure.

> [!IMPORTANT]
> Параметры конфигурации [`ApiKey`](#apikey-configuration-setting), [`Billing`](#billing-configuration-setting) и [`Eula`](#eula-configuration-setting) используются совместно, и для всех трех параметров необходимо указать допустимые значения. В противном случае контейнер не запустится. Дополнительные сведения об использовании этих параметров конфигурации для создания экземпляра контейнера см. в разделе [Выставление счетов](face-how-to-install-containers.md#billing).

## <a name="cloudai-configuration-settings"></a>Параметры конфигурации CloudAI

В разделе `CloudAI` представлены специальные параметры, уникальные для вашего контейнера. Для контейнера распознавания лиц в разделе `CloudAI` поддерживаются следующие параметры и объекты:

| ИМЯ | Тип данных | ОПИСАНИЕ |
|------|-----------|-------------|
| `Storage` | Объект. | Сценарий хранения, используемый контейнером распознавания лиц. Дополнительные сведения о сценариях хранения и соответствующих параметрах объекта `Storage` см. в разделе [Параметры сценариев хранения](#storage-scenario-settings) |

### <a name="storage-scenario-settings"></a>Параметры сценариев хранения

В контейнере распознавания лиц хранятся большие двоичные объекты, кэш, метаданные и очереди, в зависимости от того, какие данные хранятся. Например, результаты и индексы обучения для большой группы людей хранятся в виде больших двоичных объектов. Контейнер распознавания лиц предоставляет два разных сценария хранения при взаимодействии с данными указанных ниже типов и их хранения.

* Память  
  В памяти хранятся данные всех четырех типов. Они не распределяются и не являются постоянными. При остановке или удалении контейнера распознавания лиц ликвидируются все данные в хранилище для этого контейнера.  
  Это стандартный сценарий хранения для контейнера распознавания лиц.
* Таблицы Azure  
  Контейнер распознавания лиц использует службу хранилища Azure и Azure Cosmos DB для распределения данных этих четырех типов в постоянном хранилище. Большие двоичные данные и очереди данных обрабатывает служба хранилища Azure. Метаданные и данные кэша обрабатывает служба Azure Cosmos DB. При остановке или удалении контейнера распознавания лиц все данные в хранилище для этого контейнера остаются в службе хранилища Azure и Azure Cosmos DB.  
  К ресурсам, используемым в сценариях хранения Azure, применяются перечисленные ниже дополнительные требования.
  * Ресурс службы хранилища Azure должен использовать тип учетной записи StorageV2.
  * Ресурс Azure Cosmos DB должен использовать API Azure Cosmos DB для MongoDB.

Сценариями хранения и соответствующими параметрами конфигурации управляет объект `Storage` в разделе конфигурации `CloudAI`. В объекте `Storage` доступны следующие параметры конфигурации:

| ИМЯ | Тип данных | ОПИСАНИЕ |
|------|-----------|-------------|
| `StorageScenario` | Строка | Сценарий хранения, поддерживаемый контейнером. Доступны следующие значения:<br/>`Memory` — значение по умолчанию. Контейнер использует непостоянное, нераспределенное и размещенное в памяти хранилище для временного использования в одном узле. При остановке или удалении контейнера ликвидируется соответствующее хранилище.<br/>`Azure` — контейнер использует ресурсы Azure для хранения. При остановке или удалении контейнера соответствующее хранилище сохраняется.|
| `ConnectionStringOfAzureStorage` | Строка | Строка подключения для ресурса службы хранилища Azure, используемого контейнером.<br/>Этот параметр применяется только в том случае, если для параметра `StorageScenario` задано значение `Azure`. |
| `ConnectionStringOfCosmosMongo` | Строка | Строка подключения MongoDB для ресурса Azure Cosmos, используемого контейнером.<br/>Этот параметр применяется только в том случае, если для параметра `StorageScenario` задано значение `Azure`. |

Например, приведенная ниже команда указывает сценарий службы хранилища Azure и предоставляет примеры строк подключения для ресурсов службы хранилища Azure и Cosmos DB, которые используются при хранении данных для контейнера распознавания лиц.

  ```Docker
  docker run --rm -it -p 5000:5000 --memory 4g --cpus 1 containerpreview.azurecr.io/microsoft/cognitive-services-face Eula=accept Billing=https://westcentralus.api.cognitive.microsoft.com/face/v1.0 ApiKey=0123456789 CloudAI:Storage:StorageScenario=Azure CloudAI:Storage:ConnectionStringOfCosmosMongo="mongodb://samplecosmosdb:0123456789@samplecosmosdb.documents.azure.com:10255/?ssl=true&replicaSet=globaldb" CloudAI:Storage:ConnectionStringOfAzureStorage="DefaultEndpointsProtocol=https;AccountName=sampleazurestorage;AccountKey=0123456789;EndpointSuffix=core.windows.net"
  ```

Сценарий хранения обрабатывается отдельно от входных и выходных подключений. Вы можете указать сочетание этих функций для одного контейнера. Например, приведенная ниже команда определяет подключение привязки Docker к папке `D:\Output` на хост-компьютере в выходном подключении, а затем создает экземпляр контейнера распознавания лиц из образа, сохраняя файлы журнала в формате JSON во внешнем подключении. Эта команда также указывает сценарий службы хранилища Azure и предоставляет примеры строк подключения для ресурсов службы хранилища Azure и Cosmos DB, которые используются при хранении данных для контейнера распознавания лиц.

  ```Docker
  docker run --rm -it -p 5000:5000 --memory 4g --cpus 1 --mount type=bind,source=D:\Output,destination=/output containerpreview.azurecr.io/microsoft/cognitive-services-face Eula=accept Billing=https://westcentralus.api.cognitive.microsoft.com/face/v1.0 ApiKey=0123456789 Logging:Disk:Format=json CloudAI:Storage:StorageScenario=Azure CloudAI:Storage:ConnectionStringOfCosmosMongo="mongodb://samplecosmosdb:0123456789@samplecosmosdb.documents.azure.com:10255/?ssl=true&replicaSet=globaldb" CloudAI:Storage:ConnectionStringOfAzureStorage="DefaultEndpointsProtocol=https;AccountName=sampleazurestorage;AccountKey=0123456789;EndpointSuffix=core.windows.net"
  ```

## <a name="eula-configuration-setting"></a>Параметр конфигурации Eula

Параметр конфигурации `Eula` указывает, что вы приняли условия лицензии для контейнера. Для этого параметра конфигурации необходимо указать значение `accept`.

> [!IMPORTANT]
> Параметры конфигурации [`ApiKey`](#apikey-configuration-setting), [`Billing`](#billing-configuration-setting) и [`Eula`](#eula-configuration-setting) используются совместно, и для всех трех параметров необходимо указать допустимые значения. В противном случае контейнер не запустится. Дополнительные сведения об использовании этих параметров конфигурации для создания экземпляра контейнера см. в разделе [Выставление счетов](face-how-to-install-containers.md#billing).

Лицензия на контейнеры Cognitive Services предоставляется в рамках [вашего соглашения](https://go.microsoft.com/fwlink/?linkid=2018657) об использовании Azure. Если вы не заключали соглашение, регламентирующее использование Azure, вы соглашаетесь с условиями использования Azure, прописанными в [соглашении Microsoft Online Subscription](https://go.microsoft.com/fwlink/?linkid=2018755), которое содержит [Условия использования Online Services](https://go.microsoft.com/fwlink/?linkid=2018760). Что касается предварительных версий, вы также соглашаетесь с [Дополнительными условиями использования предварительных версий Microsoft Azure](https://go.microsoft.com/fwlink/?linkid=2018815). Факт использования вами контейнера подтверждает ваше согласие с этими условиями.

## <a name="fluentd-configuration-settings"></a>Параметры конфигурации Fluentd

Раздел `Fluentd` управляет параметрами конфигурации для [Fluentd](https://www.fluentd.org) — сборщика данных для единого ведения журнала с открытым кодом. Контейнер распознавания лиц включает поставщика ведения журнала Fluentd, который позволяет контейнеру записывать данные журнала и (при необходимости) метрик на сервер Fluentd.

В следующей таблице описаны параметры конфигурации, поддерживаемые в разделе `Fluentd`.

| ИМЯ | Тип данных | ОПИСАНИЕ |
|------|-----------|-------------|
| `Host` | Строка | IP-адрес или имя узла DNS сервера Fluentd. |
| `Port` | Целое число  | Порт сервера Fluentd.<br/> Значение по умолчанию — 24224. |
| `HeartbeatMs` | Целое число  | Интервал пульса в миллисекундах. Если до окончания этого интервала не отправлялся никакой трафик событий, пульс отправляется на сервер Fluentd. Значение по умолчанию — 60 000 миллисекунд (1 минута). |
| `SendBufferSize` | Целое число  | Место в сетевом буфере (в байтах), выделенное для операций отправки. Значение по умолчанию — 32768 байт (32 килобайта). |
| `TlsConnectionEstablishmentTimeoutMs` | Целое число  | Время ожидания (в миллисекундах) до установки соединения по протоколу SSL/TLS с сервером Fluentd. Значение по умолчанию — 10 000 миллисекунд (10 секунд).<br/> Если для параметра `UseTLS` задано значение false, то это значение игнорируется. |
| `UseTLS` | Логическое | Указывает, должен ли контейнер использовать протокол SSL/TLS для связи с сервером Fluentd. По умолчанию для этого параметра используется значение false. |


## <a name="http-proxy-credentials-settings"></a>Параметры учетных данных прокси-сервера HTTP

[!INCLUDE [Container shared configuration fluentd settings](../../../includes/cognitive-services-containers-configuration-shared-settings-http-proxy.md)]

## <a name="logging-configuration-settings"></a>Параметры конфигурации ведения журнала

Параметры конфигурации `Logging` управляют поддержкой ведения журнала ASP.NET Core для контейнера. Вы можете использовать для контейнера те же параметры конфигурации и значения, что и для приложения ASP.NET Core. Контейнер распознавания лиц поддерживает указанных ниже поставщиков ведения журналов.

* [Console](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-2.1#console-provider)  
  Поставщик ведения журнала `Console` для ASP.NET Core. Для этого поставщика ведения журнала поддерживаются все параметры конфигурации ASP.NET Core и значения по умолчанию.
* [Отладка](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-2.1#debug-provider)  
  Поставщик ведения журнала `Debug` для ASP.NET Core. Для этого поставщика ведения журнала поддерживаются все параметры конфигурации ASP.NET Core и значения по умолчанию.
* Диск  
  Поставщик ведения журнала JSON. Поставщик ведения журнала записывает данные журнала в выходное подключение.  
  Поставщик ведения журнала `Disk` поддерживает перечисленные ниже параметры конфигурации:  

  | ИМЯ | Тип данных | ОПИСАНИЕ |
  |------|-----------|-------------|
  | `Format` | Строка | Выходной формат файлов журналов.<br/> **Примечание.** Чтобы включить регистратор, необходимо указать значение `json`. Если это значение задано без указания выходного подключения, при создании экземпляра контейнера возникает ошибка. |
  | `MaxFileSize` | Целое число  | Максимальный размер файла журнала в мегабайтах (МБ). Когда размер текущего файла журнала достигает этого значения или превышает его, поставщик ведения журнала создает файл журнала. Если задано значение –1, то размер файла журнала ограничивается только максимальным размером файла (если он задан) для выходного подключения. Значение по умолчанию — 1. |

Дополнительные сведения о настройке поддержки ведения журналов для ASP.NET Core см. в разделе [Настройка файла параметров](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-2.1#settings-file-configuration).

## <a name="mounts-configuration-settings"></a>Параметры конфигурации подключений

Контейнеры Docker, предоставляемые Распознаванием лиц, неизменяемы и не учитывают состояние. Другими словами, созданные в контейнере файлы хранятся на поддерживающем запись уровне контейнера, который сохраняется только на время работы контейнера и к которому сложно получить доступ. Если остановить или удалить этот контейнер, созданные в этом контейнере файлы будут удалены.

Однако так как это контейнеры Docker, вы можете использовать параметры хранения Docker, например тома или подключения привязки, чтобы считывать и записывать сохраненные данные вне контейнера, если последний поддерживает это. Дополнительные сведения о том, как задавать и контролировать параметры хранения Docker, см. в статье [Manage data in Docker](https://docs.docker.com/storage/) (Управление данными в Docker).

> [!NOTE]
> Как правило, вам не потребуется менять значения этих параметров конфигурации. Вместо этого значения, заданные для этих параметров конфигурации, используются как цели при указании входных и выходных подключений для контейнера. Дополнительные сведения об указании входных и выходных подключений см. в [этом разделе](#input-and-output-mounts).

В следующей таблице описаны параметры конфигурации, поддерживаемые в разделе `Mounts`.

| ИМЯ | Тип данных | ОПИСАНИЕ |
|------|-----------|-------------|
| `Input` | Строка | Цель входного подключения. По умолчанию используется значение `/input`. |
| `Output` | Строка | Цель выходного подключения. По умолчанию используется значение `/output`. |

### <a name="input-and-output-mounts"></a>Входные и выходные подключения

По умолчанию каждый контейнер может поддерживать *входное подключение*, из которого контейнер может считывать данные, и *выходное подключение*, в которое он может записывать их. Однако контейнерам не обязательно поддерживать входные или выходные подключения, а каждый контейнер может использовать входные и выходные подключения для своих специфических целей помимо вариантов ведения журнала, поддерживаемых контейнером распознавания лиц.

Контейнер распознавания лиц не поддерживает входные подключения, а при необходимости поддерживает выходные.

Вы можете указать входное или выходное подключение с помощью параметра `--mount` команды [docker run](https://docs.docker.com/engine/reference/commandline/run/), которая используется для создания контейнера из скачанного образа. По умолчанию входное подключение использует цель `/input`, а выходное — `/output`. Любой параметр хранения Docker, доступный контейнеру Docker, можно указать в параметре `--mount`.

Например, приведенная ниже команда определяет подключение привязки Docker к папке `D:\Output` на хост-компьютере в выходном подключении, а затем создает экземпляр контейнера распознавания лиц из образа, сохраняя файлы журнала в формате JSON во внешнем подключении.

  ```Docker
  docker run --rm -it -p 5000:5000 --memory 4g --cpus 1 --mount type=bind,source=D:\Output,destination=/output containerpreview.azurecr.io/microsoft/cognitive-services-face Eula=accept Billing=https://westcentralus.api.cognitive.microsoft.com/face/v1.0 ApiKey=0123456789 Logging:Disk:Format=json
  ```

Контейнер распознавания лиц не использует входные или выходные подключения для хранения данных обучения и баз данных. Вместо этого контейнер распознавания лиц предоставляет сценарии хранения для управления данными обучения и баз данных. Дополнительные сведения об использовании сценариев хранения см. в разделе [Параметры сценариев хранения](#storage-scenario-settings).

## <a name="next-steps"></a>Дополнительная информация

* [Поддержка контейнеров в Azure Cognitive Services](../cognitive-services-container-support.md)