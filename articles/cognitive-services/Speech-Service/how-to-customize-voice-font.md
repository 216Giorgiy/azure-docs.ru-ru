---
title: Что такое пользовательские голосовые модели в Cognitive Services
description: В этой статье рассматривается настройка голоса в службе "Преобразование текста в речь" корпорации Майкрософт, которая позволяет создать узнаваемые, уникальные голоса.
services: cognitive-services
author: noellelacharite
ms.service: cognitive-services
ms.topic: article
ms.date: 05/07/2018
ms.author: nolach
ms.openlocfilehash: 84493ae83515c0458bf5b9e9cf44603300a8b4f7
ms.sourcegitcommit: 068fc623c1bb7fb767919c4882280cad8bc33e3a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2018
ms.locfileid: "39284893"
---
# <a name="creating-custom-voice-fonts"></a>Создание настраиваемого голоса

Настройка голоса в службе "Преобразование текста в речь" позволяет создать узнаваемый, уникальный *голос*. 

Чтобы создать голос, сделайте студийную запись и отправьте связанные сценарии в качестве данных обучения. Затем служба создает модель уникального голоса, настроенную для записи. Затем можно использовать этот голос для синтезирования речи. 

Для подтверждения концепции можно начать с небольшого количества данных. Однако чем больше данных вы предоставите, тем более естественно и профессионально будет звучать голос.

Настройка голоса недоступна для английского языка (en US) и континентального китайского (zh-CN).

## <a name="prerequisites"></a>Предварительные требования

Функции настройки голоса в службе "Преобразование текста в речь" в настоящее время находятся в закрытой предварительной версии. Для доступа необходимо [заполнить форму заявки](https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR0N8Vcdi8MZBllkZb70o6KdURjRaUzhBVkhUNklCUEMxU0tQMEFPMjVHVi4u).

Вам также потребуется учетная запись Azure и подписка на службу "Речь". [Создайте ее](https://docs.microsoft.com/azure/cognitive-services/speech-service/get-started), если это еще не сделано. Подключите подписку к порталу Custom Voice следующим образом.

1. Выполните вход на [портал пользовательских голосовых моделей](https://customvoice.ai) с помощью той же учетной записи Майкрософт, которая использовалась для получения доступа.

2. Перейдите в раздел "Подписки" под именем учетной записи пользователя в правом верхнем углу.

    ![Подписки](media/custom-voice/subscriptions.png)

3. На странице "Подписки" выберите Connect existing subscription (Подключиться к имеющейся подписке).

     ![Подключение к имеющейся подписке](media/custom-voice/connect-existing-sub.png)

4. Вставьте ключ подписки в таблицу, как показано ниже. Каждая подписка имеет два ключа. Можно использовать любой из них.

     ![Добавление подписки](media/custom-voice/add-subscription.png)

Все готово.

## <a name="prepare-recordings-and-transcripts"></a>Подготовка записей и расшифровок

Набор данных обучения голоса состоит из набора аудиофайлов, а также текстовых файлов, в которых содержатся расшифровки все этих аудиофайлов.

Эти файлы можно подготовить в любом направлении: либо написать сценарий, чтобы его прочитал актер озвучивания, либо использовать общедоступный аудиофайл и преобразовать его в текст. В последнем случае отредактируйте слова-паразиты в аудиофайлах, таких как "эм" и другие слова-заполнители, заикание, нечетко или неправильно произнесенные слова.

Для получения хорошего голоса необходимо, чтобы запись выполнялась в тихой комнате при помощи качественного микрофона. Согласованный объем, скорость речи, тон голоса и выразительная манера речи необходимы для создания качественного цифрового голоса. Чтобы создать голос для использования в рабочей среде, рекомендуем использовать профессиональную студию звукозаписи и актера озвучивания. Дополнительные сведения см. в разделе [Как записывать образцы голоса для создания пользовательских голосовых моделей](record-custom-voice-samples.md).

### <a name="audio-files"></a>Аудиофайлы

Каждый звуковой файл должен содержать одну фразу (например, одно предложение из выступления, один вопрос или одно действие диалоговой системы). Все файлы должны быть на одном языке (многоязычные пользовательские голоса не поддерживаются). Звуковые файлы также должны иметь уникальное числовое имя файла, сделанное с расширением имени файла `.wav`.

Звуковые файлы следует подготовить следующим образом. Другие форматы не поддерживаются и будут отклонены.

| **Свойство** | **Значение** |
| ------------ | --------- |
| Формат файла  | RIFF (WAV)|
| Частота дискретизации| Не менее 16 000 Гц |
| Формат выборки| PCM, 16-разрядные |
| Имя файла    | Числовое, с расширением `.wav` |
| Формат архива| ZIP      |
| Максимальный размер архива|200 МБ|

Поместите набор звуковых файлов в одну папку без подкаталогов и запакуйте весь набор в виде единого архива ZIP-файлов.

> [!NOTE]
> Звуковые WAV-файлы с дискретизации ниже 16 000 Гц будут отклонены. Если ZIP-файл содержит WAV-файлы с разной частотой дискретизации, будут импортированы только те из них, частота дискретизации которых не меньше 16 000 Гц.
> Портал в настоящее время импортирует ZIP-архивы размером до 200 МБ. Однако можно передать несколько архивов. Максимальное количество разрешенных наборов данных — 10 ZIP-файлов для пользователей бесплатной подписки и 50 — для пользователей стандартной подписки.

### <a name="transcripts"></a>Расшифровка

Файл расшифровки — это обычный текстовый файл (в формате ANSI, UTF-8, UTF-8-BOM, UTF-16-LE или UTF-16-BE). Каждая строка файла транскрибирования должна иметь имя звукового файла с символом табуляции (кодовая точка 9) и расшифровку. Пустые строки не допускаются.

Например: 

```
0000000001  This is the waistline, and it's falling.
0000000002  We have trouble scoring.
0000000003  It was Janet Maslin.
```

Система пользовательских голосовых моделей нормализует расшифровки, преобразовывая текст в нижний регистр и удаляя лишние знаки пунктуации. Важно, чтобы расшифровка соответствовала аудиозаписям на 100 %.

> [!TIP]
> При создании рабочих голосов службы "Преобразование текста в речь" выбирайте фразы (или сценарии написания) с учетом фонетического охвата и эффективности.

## <a name="upload-your-datasets"></a>Обновление наборов данных

После подготовки архива и расшифровок звукового файла передайте их через [пользовательский портал голосовой службы](https://customvoice.ai).

> [!NOTE]
> Наборы данных нельзя изменить после отправки. Например, если вы забыли включить расшифровку некоторых звуковых файлов или случайно выбрали неправильный пол, необходимо снова загрузить весь набор данных. Перед началом отправки тщательно проверьте свой набор данных и настройки.

1. Войдите на портал.

2. Выберите **Данные** в разделе "Пользовательские голосовые модели" на главной странице. 

    ![Мои проекты](media/custom-voice/my-projects.png)

    Появится таблица My Voice Data (Мои голосовые данные). Оно остается пустым, если все наборы голосовых данных еще не отправлены.

3. Щелкните **Импорт данных** для открытия страницы на передачу нового набора данных.

    ![Импорт голосовых данных](media/custom-voice/import-voice-data.png)

4. Введите имя и описание в предоставленные поля. 

5. Выберите языковый стандарт для голоса. Убедитесь, что сведения о языковом стандарте соответствуют языку данных записи и сценариям. 

6. Выберите пол говорящего, чей голос вы используете.

7. Выберите сценарий и звуковые файлы для передачи. 

8. Нажмите кнопку **Импортировать** для передачи данных. Импортирование крупных наборов данных может занять несколько минут.

> [!NOTE]
> Пользователи бесплатной подписки могут отправлять сразу два набора данных. Стандартные подписчики могут одновременно отправлять пять наборов данных. Если вы достигнете предела, подождите, пока хотя бы один из ваших наборов данных не завершит импорт, а затем повторите попытку.

После завершения передачи снова отобразится таблица My Voice Data (Мои голосовые данные). Отобразится запись, соответствующая только что отправленному набору данных. 

Наборы данных автоматически проверяются после отправки. Проверка данных включает ряд проверок звуковых файлов для проверки их формата, размера и частоты выборки. При проверке файлов расшифровки проверяется формат файла и выполняется нормализация текста. Выражения расшифровываются с использованием распознавания речи, полученный текст сравнивается с предоставленной расшифровкой.

![Мои голосовые данные](media/custom-voice/my-voice-data.png)

В следующей таблице показаны состояния обработки импортированных наборов данных. 

| Состояние | Значение
| ----- | -------
| `NotStarted` | Набор данных получен и помещается в очередь для обработки
| `Running` | Проверка набора данных выполнена
| `Succeeded` | Проверка набора данных выполнена, теперь его можно использовать для создания голоса

После завершения проверки можно увидеть общее количество согласованных высказываний для каждого из ваших наборов данных в столбце "Высказывание".

Отчет можно скачать, чтобы проверить оценку произношения и уровень шума каждой записи. Оценка произношения находится в диапазоне от 0 до 100, оценка ниже 70 обычно означает несоответствие речи или сценария. Заметный акцент уменьшает оценку произношения и влияет на созданный цифровой голос.

Более высокий коэффициент сигнала и шума (SNR) обозначает более низкий уровень шума в звуковом файле. Обычно SNR более 50 можно достичь, выполняя запись в профессиональных студиях. Звуковой файл с SNR менее 20 может привести к явному шуму в созданном голосе.

Рассмотрите возможность повторной записи любых высказываний с низкой оценкой произношения или слабым SNR. Если повторная запись невозможна, исключите эти высказывания из набора данных.

## <a name="build-your-voice-font"></a>Создание голоса

После проверки набора данных его можно использовать для создания настраиваемого голоса. 

1. В раскрывающемся меню "Пользовательские голосовые модели" выберите **Модели**. 
 
    Появится таблица My Voice Fonts (Мои голоса), в которой перечислены любые пользовательские голоса, которые уже созданы.

1. Нажмите кнопку **Create voices** (Создать голоса) под названием таблицы. 

    Появится страница для создания голоса. Текущий языковой стандарт отображается в первой записи таблицы. Измените языковой стандарт, чтобы создать голос на другом языке. Языковый стандарт должен быть таким же, что и наборы данных, используемые для создания голоса.

1. Как и при отправке набора данных, введите имя и описание, что поможет идентифицировать эту модель. 

    Имя, которое здесь вводится, будет именем, которое используется, чтобы указать голос в запросе на синтез речи как часть ввода SSML, поэтому выбирайте тщательно. Разрешены только буквы, цифры и несколько знаков препинания, таких как "-", "_" "(", ")".

    Поле "Описание" обычно необходимо для записи имен наборов данных, которые используются для создания модели.

1. Выберите пол для голоса. Он должен соответствовать полу для набора данных.

1. Выберите наборы данных, которые нужно использовать для обучения голоса. Все используемые наборы данных должны быть от одного и того же говорящего.

1. Щелкните **Создать**, чтобы начать создание голоса.

    ![Создание модели](media/custom-voice/create-model.png)

Новая модель появится в таблице My Voice Fonts (Мои голоса). 

![Мои голоса](media/custom-voice/my-voice-fonts.png)

Показанное состояние отражает процесс преобразования набора данных в голос, как показано ниже.

| Состояние | Значение
| ----- | -------
| `NotStarted` | Запрос на создание голоса поставлен в очередь для обработки
| `Running` | Идет создание голоса
| `Succeeded` | Голос создан и может быть развернут

Время обучения зависит от объема обработанных звуковых данных. Обычный диапазон времени варьируется от 30 минут для сотен выражений до 40 часов — для 20 000 выражений.

> [!NOTE]
> Пользователи бесплатной подписки могут одновременно обучать один голос. Стандартные пользователи подписки могут одновременно обучать три голоса. Если вы достигнете предела, подождите, пока хотя бы один из ваших голосов завершит обучение, а затем повторите попытку.

## <a name="test-your-voice-font"></a>Тестирование голоса

После успешного создания голоса его можно протестировать перед развертыванием. Выберите **Тестирование** в столбце "Операции". Для выбранного голоса отображается тестовая страница. Таблица будет пустой, если вы не отправили никаких запросов на тестирование для голоса.

![Мои голоса, часть 2](media/custom-voice/my-voice-fonts2.png)

Нажмите кнопку **Test with text** (Тестирование с текстом) под заголовком таблицы, чтобы отобразить раскрывающееся меню для отправки запросов на текст. Можно отправить запрос на тестирование в виде обычного текста или SSML. Максимальный размер входных данных — 1024 символов, включая все теги для запроса SSML. Язык текста должен быть таким же, что и язык голоса.

![Тестирование голоса](media/custom-voice/voice-font-testing.png)

После заполнения текстового поля и подтверждения режима ввода нажмите кнопку **Да**, чтобы отправить запрос на тестирование и вернуться на страницу тестирования. Таблица теперь содержит запись, которая соответствует новому запросу, и знакомый столбец состояния. Синтезирование голоса может занять несколько минут. Когда в столбцах появится состояние "Успешно", вы можете скачать текстовый ввод (файл `.txt`), аудиовыход (файл `.wav`) и прослушать последний, чтобы оценить качество.

![Тестирование голоса, часть 2](media/custom-voice/voice-font-testing2.png)

## <a name="create-and-use-a-custom-endpoint"></a>Создание пользовательской конечной точки и ее использование

После того, как вы успешно создали и протестировали свою голосовую модель, она развертывается в пользовательской конечной точке службы "Преобразование текста в речь". Затем эта конечная точка используется вместо обычной конечной точки при выполнении запросов службы "Преобразование текста в речь" через REST API. Пользовательская конечная точка может быть вызвана только подпиской, которая использовалась для развертывания шрифта.

Чтобы создать пользовательскую конечную точку, в меню "Пользовательское распознавание речи" в верхней части страницы выберите **Конечные точки**. Появится страница "My Deployed Voices" (Мои развернутые голоса) с таблицей текущих конечных точек пользовательских голосовых моделей, если таковые имеются. Текущий языковой стандарт отображается в первой строке таблицы. Чтобы создать развертывание для другого языка, измените отображаемый языковой стандарт. (Он должен соответствовать голосу, чье развертывание выполняется).

Нажмите кнопку **Deploy voices** (Развернуть голоса), чтобы создать конечную точку. Введите имя и описание пользовательской конечной точки.

В меню "Подписка" выберите подписку, которую нужно использовать. Пользователи бесплатной подписки могут за раз развертывать только одну модель. Пользователи стандартной подписки могут создавать до 20 конечных точек, каждая со своим собственным голосовом.

![Создание конечной точки](media/custom-voice/create-endpoint.png)

После выбора модели, которая подлежит развертыванию, щелкните **Создать**. Страница "My Deployed Voices" (Мои развернутые голоса) появится снова, теперь с записью для новой конечной точки. Создание конечной точки может занять несколько минут. Если состояние развертывания — "Удачно", конечная точка готова к использованию.

![Мои развернутые голоса](media/custom-voice/my-deployed-voices.png)

Если состояние развертывания — "Удачно", конечная точка голоса отображается в таблице "My deployed voices" (Мои развернутые голоса). Этот URI можно использовать непосредственно в HTTP-запросе.

Тестирование конечной точки в сети также доступно через портал настраиваемых пользовательских голосовых моделей. Для проверки конечной точки в раскрывающемся меню "Пользовательские голосовые модели" выберите **Тестирование конечных точек**. Откроется страница тестирования конечной точки. Выберите развернутую пользовательскую голосовую модель и введите в текстовое поле текст, который необходимо произнести (в текстовом формате или в формате SSML).

> [!NOTE] 
> При использовании SSML для тега `<voice>` необходимо указать имя, которое вы дали пользовательскому голосу при создании.

Нажмите кнопку **Воспроизведение**, чтобы прослушать текст с помощью настраиваемого голоса.

![Тестирование конечной точки](media/custom-voice/endpoint-testing.png)

Пользовательская конечная точка функционально идентична стандартной конечной точке, используемой для запросов преобразования текста в речь. Дополнительные сведения см. в статье о [REST API](rest-apis.md).

## <a name="next-steps"></a>Дополнительная информация

- [Пробная версия Cognitive Services](https://azure.microsoft.com/try/cognitive-services/)
- [Краткое руководство. Распознавание речи с помощью пакета SDK службы распознавания речи Cognitive Services C#](quickstart-csharp-dotnet-windows.md)
