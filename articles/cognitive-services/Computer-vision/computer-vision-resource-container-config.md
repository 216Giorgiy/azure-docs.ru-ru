---
title: Настройка контейнеров
titlesuffix: Computer Vision - Azure Cognitive Services
description: Параметры конфигурации для контейнеров в Компьютерном зрении.
services: cognitive-services
author: diberry
manager: cgronlun
ms.custom: seodec18
ms.service: cognitive-services
ms.component: text-analytics
ms.topic: conceptual
ms.date: 11/14/2018
ms.author: diberry
ms.openlocfilehash: f71cbe965e70dfce1b29cf0e5f9ea44faf0a4e27
ms.sourcegitcommit: 9fb6f44dbdaf9002ac4f411781bf1bd25c191e26
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/08/2018
ms.locfileid: "53077024"
---
# <a name="configure-containers"></a>Настройка контейнеров

Компьютерное зрение предоставляет контейнер для Распознавания текста с помощью общей платформы конфигурации, что позволяет легко настроить хранилище, ведение журнала, данные телеметрии и параметры безопасности для контейнеров, а также управлять ими.

## <a name="configuration-settings"></a>Параметры конфигурации

Параметры конфигурации в контейнерах Компьютерного зрения являются иерархическими и все контейнеры используют общую иерархию, основываясь на следующей подробной структуре:

* [apiKey](#apikey-configuration-setting)
* [ApplicationInsights](#applicationinsights-configuration-settings)
* [Проверка подлинности](#authentication-configuration-settings)
* [Выставление счетов](#billing-configuration-setting)
* [Лицензионное соглашение](#eula-configuration-setting)
* [Fluentd](#fluentd-configuration-settings)
* [ведению журналов](#logging-configuration-settings)
* [Подключения](#mounts-configuration-settings)

Вы можете использовать либо [переменные среды](#configuration-settings-as-environment-variables), либо [аргументы командной строки](#configuration-settings-as-command-line-arguments) для определения параметров конфигурации при создании контейнера из контейнеров Компьютерного зрения.

Значения переменной среды переопределяет значения аргументов командной строки, которые, в свою очередь, переопределяют значения по умолчанию для образа контейнера. Другими словами, если задать разные значения в переменной среды и аргументе командной строки для одного параметра конфигурации, такие как `Logging:Disk:LogLevel`, а затем создать контейнер, значение в переменной среды будет использоваться созданным контейнером.

### <a name="configuration-settings-as-environment-variables"></a>Параметры конфигурации в виде переменных среды

Для определения параметров конфигурации можно использовать [синтаксис переменных среды ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/configuration/?view=aspnetcore-2.1&tabs=basicconfiguration#configuration-by-environment).

Контейнер считывает переменные среды пользователя при создании контейнера. Если существует переменная среды, ее значение переопределяет значение по умолчанию для указанного параметра конфигурации. Преимущество использования переменных среды — перед созданием контейнеров можно задать несколько параметров конфигурации и несколько контейнеров могут автоматически использовать тот же набор параметров конфигурации.

Например, приведенные ниже команды используют переменную среды, чтобы задать уровень ведения журнала консоли [LogLevel.Information](https://msdn.microsoft.com), а потом создают контейнер Распознавания текста из образа контейнера. Значение переменной среды переопределяет параметр конфигурации по умолчанию.

  ```Docker
  SET Logging:Console:LogLevel=Information
  docker run --rm -it -p 5000:5000 --memory 4g --cpus 1 containerpreview.azurecr.io/microsoft/cognitive-services-recognize-text Eula=accept Billing=https://westcentralus.api.cognitive.microsoft.com/vision/v1.0 ApiKey=0123456789
  ```

### <a name="configuration-settings-as-command-line-arguments"></a>Параметры конфигурации в виде аргументов командной строки

Вы можете использовать [синтаксис аргументов командной строки ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/configuration/?view=aspnetcore-2.1&tabs=basicconfiguration#arguments) для определения параметров конфигурации.

Вы можете определять параметры конфигурации в необязательном параметре `ARGS` команды [docker run](https://docs.docker.com/engine/reference/commandline/run/), которая используется для создания контейнера из скачанного образа контейнера. Преимуществом использования аргументов командной строки является то, что каждый контейнер может использовать различный пользовательский набор параметров конфигурации.

Например, следующая команда создает контейнер из образа контейнера для Распознавания текста и настраивает уровень ведения журнала консоли LogLevel.Information, переопределяя настройку конфигурации по умолчанию.

  ```Docker
  docker run --rm -it -p 5000:5000 --memory 4g --cpus 1 containerpreview.azurecr.io/microsoft/cognitive-services-recognize-text Eula=accept Billing=https://westcentralus.api.cognitive.microsoft.com/vision/v1.0 ApiKey=0123456789 Logging:Console:LogLevel=Information
  ```

## <a name="apikey-configuration-setting"></a>Настройка конфигурации ApiKey

Настройка конфигурации `ApiKey` определяет ключ конфигурации ресурса Компьютерного зрения в Azure, используемый, чтобы отслеживать данные для выставления счетов для контейнера. Вам необходимо задать значение этого параметра конфигурации, которое должно быть допустимым ключом конфигурации для ресурса Компьютерного зрения, определяемого для параметра конфигурации [`Billing`](#billing-configuration-setting).

> [!IMPORTANT]
> Параметры конфигурации [`ApiKey`](#apikey-configuration-setting), [`Billing`](#billing-configuration-setting) и [`Eula`](#eula-configuration-setting) используются совместно, и для всех трех параметров необходимо указать допустимые значения. В противном случае контейнер не запустится. Дополнительные сведения об использовании этих параметров конфигурации для создания экземпляра контейнера см. в разделе [Выставление счетов](computer-vision-how-to-install-containers.md#billing).

## <a name="applicationinsights-configuration-settings"></a>Параметры конфигурации Application Insights

С помощью параметров конфигурации в разделе `ApplicationInsights` можно добавить в контейнер поддержку телеметрии [Azure Application Insights](https://docs.microsoft.com/azure/application-insights). Application Insights обеспечивает детализированный мониторинг контейнера на уровне кода. Вы можете легко отслеживать доступность, производительность и использование своего контейнера. Вы также можете быстро идентифицировать и диагностировать ошибки в контейнере, не дожидаясь, пока пользователь сообщит о них.

В следующей таблице описаны параметры конфигурации, поддерживаемые в разделе `ApplicationInsights`.

| ИМЯ | Тип данных | ОПИСАНИЕ |
|------|-----------|-------------|
| `InstrumentationKey` | Строка | Ключ инструментирования экземпляра Application Insights, которому отправляются данные телеметрии для контейнера. Дополнительные сведения см. в статье [Application Insights для ASP.NET Core](https://docs.microsoft.com/azure/application-insights/app-insights-asp-net-core). |

## <a name="authentication-configuration-settings"></a>Параметры конфигурации проверки подлинности

Параметры конфигурации `Authentication` предоставляют параметры безопасности Azure для контейнера. Несмотря на то что в этом разделе доступны параметры конфигурации, контейнер Распознавания текста не использует этот раздел.

## <a name="billing-configuration-setting"></a>Параметр конфигурации выставления счетов

Параметр конфигурации `Billing` задает URI конечной точки для ресурса API компьютерного зрения в Azure, с помощью которого измеряются данные для выставления счетов, связанные с этим контейнером. Для этого параметра конфигурации необходимо задать значение, которое должно быть допустимым URI конечной точки для ресурса Компьютерного зрения в Azure.

> [!IMPORTANT]
> Параметры конфигурации [`ApiKey`](#apikey-configuration-setting), [`Billing`](#billing-configuration-setting) и [`Eula`](#eula-configuration-setting) используются совместно, и для всех трех параметров необходимо указать допустимые значения. В противном случае контейнер не запустится. Дополнительные сведения об использовании этих параметров конфигурации для создания экземпляра контейнера см. в разделе [Выставление счетов](computer-vision-how-to-install-containers.md#billing).

## <a name="eula-configuration-setting"></a>Параметр конфигурации лицензионного соглашения

Параметр конфигурации `Eula` указывает, что вы приняли условия лицензии для контейнера. Для этого параметра конфигурации необходимо указать значение `accept`.

> [!IMPORTANT]
> Параметры конфигурации [`ApiKey`](#apikey-configuration-setting), [`Billing`](#billing-configuration-setting) и [`Eula`](#eula-configuration-setting) используются совместно, и для всех трех параметров необходимо указать допустимые значения. В противном случае контейнер не запустится. Дополнительные сведения об использовании этих параметров конфигурации для создания экземпляра контейнера см. в разделе [Выставление счетов](computer-vision-how-to-install-containers.md#billing).

Лицензия на использование контейнеров Cognitive Services предоставляется в рамках [вашего соглашения](https://go.microsoft.com/fwlink/?linkid=2018657) об использовании Azure. Если вы не заключали соглашения, регламентирующего использование Azure, вы соглашаетесь, что ваше соглашение об использовании Azure является [соглашением Microsoft Online Subscription](https://go.microsoft.com/fwlink/?linkid=2018755), которое содержит [Условия использования Online Services](https://go.microsoft.com/fwlink/?linkid=2018760). Что касается предварительных версий, вы также соглашаетесь с [Дополнительными условиями использования предварительных версий Microsoft Azure](https://go.microsoft.com/fwlink/?linkid=2018815). Факт использования вами контейнера подтверждает ваше согласие с этими условиями.

## <a name="fluentd-configuration-settings"></a>Параметры конфигурации Fluentd

Раздел `Fluentd` управляет параметрами конфигурации для [Fluentd](https://www.fluentd.org) — сборщика данных для единого ведения журнала с открытым кодом. Контейнеры Компьютерного зрения включают поставщика ведения журнала Fluentd, который позволяет контейнеру записывать данные журнала и при необходимости данные метрики на сервер Fluentd.

В следующей таблице описаны параметры конфигурации, поддерживаемые в разделе `Fluentd`.

| ИМЯ | Тип данных | ОПИСАНИЕ |
|------|-----------|-------------|
| `Host` | Строка | IP-адрес или имя узла DNS сервера Fluentd. |
| `Port` | Целое число  | Порт сервера Fluentd.<br/> Значение по умолчанию — 24224. |
| `HeartbeatMs` | Целое число  | Интервал пульса в миллисекундах. Если до окончания этого интервала не отправлялся никакой трафик событий, пульс отправляется на сервер Fluentd. Значение по умолчанию — 60 000 миллисекунд (1 минута). |
| `SendBufferSize` | Целое число  | Место в сетевом буфере (в байтах), выделенное для операций отправки. Значение по умолчанию — 32768 байт (32 килобайта). |
| `TlsConnectionEstablishmentTimeoutMs` | Целое число  | Время ожидания (в миллисекундах) до установки соединения по протоколу SSL/TLS с сервером Fluentd. Значение по умолчанию — 10 000 миллисекунд (10 секунд).<br/> Если для параметра `UseTLS` задано значение false, то это значение игнорируется. |
| `UseTLS` | Логическое | Указывает, должен ли контейнер использовать протокол SSL/TLS для связи с сервером Fluentd. По умолчанию для этого параметра используется значение false. |

## <a name="logging-configuration-settings"></a>Параметры конфигурации ведения журнала

Параметры конфигурации `Logging` управляют поддержкой ведения журнала ASP.NET Core для контейнера. Вы можете использовать для контейнера те же параметры конфигурации и значения, что и для приложения ASP.NET Core. Контейнеры Компьютерного зрения поддерживают указанные ниже поставщики ведения журналов:

* [Console](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-2.1#console-provider)  
  Поставщик ведения журнала `Console` для ASP.NET Core. Для этого поставщика ведения журнала поддерживаются все параметры конфигурации ASP.NET Core и значения по умолчанию.
* [Отладка](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-2.1#debug-provider)  
  Поставщик ведения журнала `Debug` для ASP.NET Core. Для этого поставщика ведения журнала поддерживаются все параметры конфигурации ASP.NET Core и значения по умолчанию.
* Диск  
  Поставщик ведения журнала JSON. Поставщик ведения журнала записывает данные журнала в выходное подключение.  
  Поставщик ведения журнала `Disk` поддерживает перечисленные ниже параметры конфигурации:  

  | ИМЯ | Тип данных | ОПИСАНИЕ |
  |------|-----------|-------------|
  | `Format` | Строка | Выходной формат файлов журналов.<br/> **Примечание.** Чтобы включить поставщика ведения журнала, для этого параметра необходимо задать значение `json`. Если это значение задано без указания выходного подключения, при создании экземпляра контейнера возникает ошибка. |
  | `MaxFileSize` | Целое число  | Максимальный размер файла журнала в мегабайтах (МБ). Когда размер текущего файла журнала достигает этого значения или превышает его, поставщик ведения журнала создает файл журнала. Если задано значение –1, то размер файла журнала ограничивается только максимальным размером файла (если он задан) для выходного подключения. Значение по умолчанию — 1. |

Дополнительные сведения о настройке поддержки ведения журналов для ASP.NET Core см. в разделе [Настройка файла параметров](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-2.1#settings-file-configuration).

## <a name="mounts-configuration-settings"></a>Параметры конфигурации подключений

Контейнеры Docker, предоставляемые Компьютерным зрением, неизменяемы и без отслеживания состояния. Другими словами, созданные в контейнере файлы хранятся на поддерживающем запись уровне контейнера, который сохраняется только на время работы контейнера и к которому сложно получить доступ. Если остановить или удалить этот контейнер, созданные в этом контейнере файлы будут удалены.

Однако так как это контейнеры Docker, вы можете использовать параметры хранения Docker, например тома или подключения привязки, чтобы считывать и записывать сохраненные данные вне контейнера, если последний поддерживает это. Дополнительные сведения о том, как задавать и контролировать параметры хранения Docker, см. в статье [Manage data in Docker](https://docs.docker.com/storage/) (Управление данными в Docker).

> [!NOTE]
> Как правило, вам не потребуется менять значения этих параметров конфигурации. Вместо этого значения, заданные для этих параметров конфигурации, используются как цели при указании входных и выходных подключений для контейнера. Дополнительные сведения об указании входных и выходных подключений см. в [этом разделе](#input-and-output-mounts).

В следующей таблице описаны параметры конфигурации, поддерживаемые в разделе `Mounts`.

| ИМЯ | Тип данных | ОПИСАНИЕ |
|------|-----------|-------------|
| `Input` | Строка | Цель входного подключения. По умолчанию используется значение `/input`. |
| `Output` | Строка | Цель выходного подключения. По умолчанию используется значение `/output`. |

### <a name="input-and-output-mounts"></a>Входные и выходные подключения

По умолчанию каждый контейнер может поддерживать *входное подключение*, из которого контейнер может считывать данные, и *выходное подключение*, в которое он может записывать их. Однако контейнерам не обязательно поддерживать входные или выходные подключения, а каждый контейнер может использовать входные и выходные подключения для своих специфических целей помимо вариантов ведения журнала, поддерживаемых контейнером Компьютерного зрения.

Контейнер Распознавания текста не поддерживает входные подключения, а при необходимости поддерживает выходные.

Вы можете указать входное или выходное подключение с помощью параметра `--mount` команды [docker run](https://docs.docker.com/engine/reference/commandline/run/), которая используется для создания из скачанного образа контейнера. По умолчанию входное подключение использует цель `/input`, а выходное — `/output`. Любой параметр хранения Docker, доступный контейнеру Docker, можно указать в параметре `--mount`.

Например, приведенная ниже команда определяет подключение привязки Docker к папке `D:\Output` на хост-компьютере в выходном подключении, а затем создает контейнер из образа контейнера для Распознавания текста, сохраняя файлы журнала в формате JSON в выходное подключение.

  ```Docker
  docker run --rm -it -p 5000:5000 --memory 4g --cpus 1 --mount type=bind,source=D:\Output,destination=/output containerpreview.azurecr.io/microsoft/cognitive-services-recognize-text Eula=accept Billing=https://westcentralus.api.cognitive.microsoft.com/vision/v1.0 ApiKey=0123456789 Logging:Disk:Format=json
  ```
