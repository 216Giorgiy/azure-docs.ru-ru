<properties title="Securing an Azure Website" pageTitle="Securing an Azure Website." description="Learn how to secure an Azure Website." metaKeywords="Azure web site security, azure web site https, azure web site ftps, azure web site ssl, azure web site ssl rewrite" services="web-sites" solutions="" documentationCenter="web" authors="larryfr" videoId="" scriptId="" />

<tags ms.service="web-sites" ms.workload="web" ms.tgt_pltfrm="na" ms.devlang="multiple" ms.topic="article" ms.date="01/01/1900" ms.author="larryfr" />

## Защита веб-приложения на веб-сайте Azure

Одной из задач разработки веб-приложения является обеспечение безопасного и защищенного обслуживания клиентов. В этой статье мы рассмотрим компоненты веб-сайтов Azure, которые могут защитить веб-приложение.

> [WACOM.NOTE] Полное описание аспектов обеспечения безопасности веб-приложений выходит за рамки этого документа. В качестве отправной точки для дальнейшего изучения вопросов защиты веб-приложений см. веб-сайт [открытого проекта безопасности веб-приложений (OWASP)][открытого проекта безопасности веб-приложений (OWASP)], особенно раздел [10 лучших проектов][10 лучших проектов], в котором перечислены текущие 10 самых важных пробелов в защите веб-приложений, согласно определению участников проекта OWASP.

### Оглавление

-   [Безопасные взаимодействия][Безопасные взаимодействия]
-   [Безопасная разработка][Безопасная разработка]
-   [Дальнейшие действия][Дальнейшие действия]

## <a name="https"></a>Безопасные взаимодействия

При использовании доменного имени ***.azurewebsites.net**, созданного для вашего веб-сайта, можно сразу же применять HTTPS, поскольку SSL-сертификат предоставляется для всех доменных имен* **.azurewebsites.net**. Если сайт использует [имя пользовательского домена][имя пользовательского домена], можно отправить SSL-сертификат, чтобы включить HTTPS для пользовательского домена.

Дополнительные сведения см. в статье [Включение HTTPS для веб-сайта на Azure][Включение HTTPS для веб-сайта на Azure].

### Применение HTTPS

Веб-сайты Azure *не* применяют HTTPS принудительно; посетители по-прежнему могут получать доступ к сайту с помощью HTTP, что может привести к раскрытию конфиденциальных сведений. Обеспечить применение HTTPS можно с помощью модуля **переопределения URL-адресов**. Модуль переопределения URL-адресов включен в веб-сайты Azure и позволяет определять правила, которые применяются к входящим запросам перед их обработкой и отправкой в приложение. Его можно использовать для приложений, написанных на любом языке программирования, поддерживаемом веб-сайтами Azure.

> [WACOM.NOTE] Приложения .NET MVC вместо модуля переопределения URL-адресов должны использовать фильтр [RequireHttps][RequireHttps]. Дополнительные сведения об использовании фильтра RequireHttps см. в статье [Развертывание безопасного приложения ASP.NET MVC 5 с членством, OAuth и базой данных SQL на веб-сайте Azure][Развертывание безопасного приложения ASP.NET MVC 5 с членством, OAuth и базой данных SQL на веб-сайте Azure].
>
> Сведения о программном перенаправлении запросов с помощью других языков программирования и платформ см. в документации для этих технологий.

Правила модуля переопределения URL-адресов задаются в файле **web.config**, который хранится в корневом каталоге приложения. В следующем примере показывается базовое правило модуля переопределения URL-адресов, которое заставляет весь входящий трафик использовать HTTPS.

<a name="example"></a>**Пример файла Web.Config модуля переопределения URL-адресов**

    <?xml version="1.0" encoding="UTF-8"?>
    <configuration>
      <system.webServer>
        <rewrite>
          <rules>
            <rule name="Force HTTPS" enabled="true">
              <match url="(.*)" ignoreCase="false" />
              <conditions>
                <add input="{HTTPS}" pattern="off" />
              </conditions>
              <action type="Redirect" url="https://{HTTP_HOST}/{R:1}" appendQueryString="true" redirectType="Permanent" />
            </rule>
          </rules>
        </rewrite>
      </system.webServer>
    </configuration>

Это правило работает путем возврата кода состояния HTTP 301 (постоянное перенаправление), когда пользователь запрашивает страницу с помощью HTTP. Код состояния 301 перенаправляет запрос на тот же запрошенный посетителем URL-адрес, но заменяет в запросе HTTP на HTTPS. Например, запрос <HTTP://contoso.com> будет перенаправлен на адрес <HTTPS://contoso.com>.

> [WACOM.NOTE] Если приложение написано на **Node.js**, **PHP**, **Python Django** или **Java**, в нем скорее всего отсутствует файл web.config. Однако приложения на **Node.js**, **Python Django** и **Java** на самом деле используют web.config при размещении на веб-сайтах Azure, потому что Azure автоматически создает этот файл при развертывании, и вы его не видите. Если включить этот файл в приложение, он переопределит файл, автоматически создаваемый Azure.

### .NET

В случае приложений .NET измените файл web.config для приложения, добавив раздел **\<rewrite\>** из [примера][примера] в раздел **\<system.WebServer\>**.

Если в файле web.config уже имеется раздел **\<rewrite\>**, добавьте **\<rule\>** из [примера][примера] в качестве первой записи в раздел **\<rules\>**.

### PHP

Для приложений PHP просто сохраните [пример][примера] как файл web.config в корневом каталоге приложения, а затем заново разверните приложение на веб-сайте Azure.

### Node.js, Python Django и Java

Если в приложениях Node.js, Python Django и Java отсутствует файл web.config, то он создается автоматически, но существует только на сервере, поскольку создается во время развертывания. Этот автоматически созданный файл содержит параметры, указывающие Azure, как следует размещать приложение.

Чтобы получить этот автоматически созданный файл с веб-сайта и изменить его, выполните следующие действия.

1.  Загрузите файл с помощью FTP (см. статью [Отправка и загрузка файлов с помощью FTP и сбор журналов диагностики][Отправка и загрузка файлов с помощью FTP и сбор журналов диагностики]).

2.  Добавьте его в корневой каталог приложения.

3.  Добавьте в него правила переопределения, используя следующие сведения.

    -   **Node.js и Python Django**

        В файле web.config, созданном для приложений Node.js и Python Django, уже будет раздел **\<rewrite\>**, содержащий записи **\<rule\>**, необходимые для соответствующего функционирования сайта. Чтобы заставить сайт использовать HTTPS, добавьте **\<rule\>** из примера в качестве первой записи в разделе **\<rules\>**. Это обеспечит применение HTTPS и не повлияет на остальные правила.

    -   **Java**

        Файл web.config для приложений Java, использующих Apache Tomcat, не содержит раздел **\<rewrite\>**, поэтому необходимо добавить раздел **\<rewrite\>** из примера в раздел **\<system.webServer\>**.

4.  Выполните повторное развертывание проекта (включая обновленный файл web.config) в Azure.

После развертывания файла web.config с правилом переопределения, заставляющим применять HTTPS, это правило вступит в действие немедленно, и все запросы начнут перенаправляться на HTTPS.

Дополнительные сведения о модуле переопределения URL-адресов IIS см. в документации по [модулю переопределения URL-адресов][модулю переопределения URL-адресов].

## <a name="develop"></a>Безопасная разработка

### Профиль публикации и параметры публикации

При разработке приложений, выполнении задач управления или автоматизации задач с помощью таких служебных программ, как **Visual Studio**, **Web Matrix**, **Azure PowerShell** или **кроссплатформенный интерфейс командной строки** Azure, можно использовать либо файл *параметров публикации*, либо *профиль публикации*. В обоих случаях выполняется проверка подлинности в Azure и требуется защита для предотвращения несанкционированного доступа.

-   Файл **параметров публикации** содержит:

    -   идентификатор подписки Azure;

    -   сертификат управления, позволяющий выполнять задачи управления для подписки *без необходимости предоставления имени учетной записи или пароля*.

-   Файл **профиля публикации** содержит:

    -   сведения для публикации на веб-сайте Azure.

Если применяется служебная программа, использующая параметры публикации или профиль публикации, импортируйте файл, содержащий параметры или профиль публикации, в эту служебную программу, а затем **удалите** этот файл. Если файл необходимо сохранить, например для совместного использования с другими сотрудниками в проекте, сохраните его в безопасном месте, таком как **зашифрованный** каталог с ограниченными разрешениями.

Кроме того, импортированные учетные данные также необходимо защитить. Например, **Azure PowerShell** и **кроссплатформенный интерфейс командной строки Azure** сохраняют импортированные данные в **домашнем каталоге** (*~* в системах Linux или OS X и */users/имя\_пользователя* в системах Windows.) Для дополнительной защиты можно **зашифровать** эти расположения с помощью средств шифрования, имеющихся в используемой операционной системе.

### Параметры конфигурации и строки подключения

Обычно строки подключения, учетные данные для проверки подлинности и другие конфиденциальные данные хранятся в файлах конфигурации. К сожалению, эти файлы могут быть раскрыты на веб-сайте или извлечены в общедоступный репозиторий, предоставляющий информацию из них.

Веб-сайты Azure позволяют хранить сведения о конфигурации в рамках среды выполнения веб-сайтов в качестве **параметров приложения** и **строк подключения**. Эти значения предоставляются в приложение во время выполнения посредством *переменных среды* в большинстве языков программирования. Для приложений .NET эти значения вставляются в конфигурацию .NET во время выполнения.

**Параметры приложения** и **строки подключения** можно настраивать с помощью портала управления Azure или служебных программ, таких как PowerShell или кроссплатформенный интерфейс командной строки Azure.

Дополнительные сведения о параметрах приложения и строках подключения см. в статье [Настройка веб-сайтов][Настройка веб-сайтов].

### FTPS

Azure предоставляет защищенный FTP-доступ к файловой системе для веб-сайта посредством **FTPS**. Это позволяет безопасный доступ к коду приложения на веб сайте, а также к журналам диагностики. Ссылку FTPS для веб-сайта можно найти в узле **Панель мониторинга** на [портале управления Azure][портале управления Azure].

Дополнительные сведения о FTPS см. в статье [Протокол FTP][Протокол FTP].

## Дальнейшие действия

Дополнительные сведения о безопасности платформы Azure, о сообщениях об **инцидентах и нарушениях безопасности** и об информировании Майкрософт о предстоящем выполнении **теста на проникновение** на сайт см. раздел, посвященный безопасности, в [центре управления безопасностью Microsoft Azure][центре управления безопасностью Microsoft Azure].

Дополнительные сведения о файлах **web.config** и **applicationhost.config** на веб-сайтах Azure см. в статье [Параметры конфигурации, разблокированные на веб-сайтах Azure][Параметры конфигурации, разблокированные на веб-сайтах Azure].

Сведения об информации журналов для веб-сайтов Azure, полезной при обнаружении атак, см. в статье [Включение ведения журналов диагностики для веб-сайтов Azure][Включение ведения журналов диагностики для веб-сайтов Azure].

  [10 лучших проектов]: https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project
  [Безопасные взаимодействия]: #https
  [Безопасная разработка]: #develop
  [Дальнейшие действия]: #next
  [имя пользовательского домена]: http://azure.microsoft.com/ru-ru/documentation/articles/web-sites-custom-domain-name/
  [Включение HTTPS для веб-сайта на Azure]: /ru-ru/documentation/articles/web-sites-configure-ssl-certificate/
  [RequireHttps]: http://msdn.microsoft.com/ru-ru/library/system.web.mvc.requirehttpsattribute.aspx
  [Развертывание безопасного приложения ASP.NET MVC 5 с членством, OAuth и базой данных SQL на веб-сайте Azure]: /ru-ru/documentation/articles/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database/
  [примера]: #example
  [Отправка и загрузка файлов с помощью FTP и сбор журналов диагностики]: http://blogs.msdn.com/b/avkashchauhan/archive/2012/06/19/windows-azure-website-uploading-downloading-files-over-ftp-and-collecting-diagnostics-logs.aspx
  [модулю переопределения URL-адресов]: http://www.iis.net/downloads/microsoft/url-rewrite
  [Настройка веб-сайтов]: /ru-ru/documentation/articles/web-sites-configure/
  [портале управления Azure]: https://manage.windowsazure.com
  [Протокол FTP]: http://en.wikipedia.org/wiki/File_Transfer_Protocol
  [центре управления безопасностью Microsoft Azure]: /ru-ru/support/trust-center/security/
  [Параметры конфигурации, разблокированные на веб-сайтах Azure]: http://azure.microsoft.com/blog/2014/01/28/more-to-explore-configuration-options-unlocked-in-windows-azure-web-sites/
  [Включение ведения журналов диагностики для веб-сайтов Azure]: /ru-ru/documentation/articles/web-sites-enable-diagnostic-log/
