---
title: Сбор данных мониторинга в Azure | Документация Майкрософт
description: Общие сведения о данных мониторинга, собираемых из приложений и служб в Azure, а также об инструментах, используемых для их анализа.
documentationcenter: ''
author: bwren
manager: carmonm
editor: tysonn
ms.service: monitoring
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/06/2018
ms.author: bwren
ms.openlocfilehash: efbf0907f3ed75957159c38a536bd31e88a0dbb3
ms.sourcegitcommit: 248c2a76b0ab8c3b883326422e33c61bd2735c6c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2018
ms.locfileid: "39213305"
---
# <a name="collecting-monitoring-data-in-azure"></a>Сбор данных мониторинга в Azure
В этой статье приведены общие сведения о данных мониторинга, собираемых из приложений и служб в Azure, а также об инструментах, используемых для их анализа. 

## <a name="types-of-monitoring-data"></a>Типы данных мониторинга
Все данные мониторинга относятся к одному из двух основных типов: метрики или журналы. Каждый тип имеет отличительные характеристики и используется в конкретных сценариях, как описано ниже.

### <a name="metrics"></a>Метрики
Метрики — это числовые значения, которые описывают конкретный аспект системы в определенный момент времени. Они включают в себя различные данные: само значение, время сбора значения, тип измерения, представляемого значением, и конкретный ресурс, с которым связано значение. Метрики собираются через регулярные промежутки времени независимо от того, изменяется ли значение. Например, вы можете собирать данные об использовании процессоров с виртуальной машины каждую минуту или данные о количестве пользователей, зарегистрированных в вашем приложении, каждые 10 минут.

Метрики —это упрощенный тип данных. Они могут поддерживать сценарии практически в режиме реального времени. Они особенно полезны для создания оповещений, так как их можно часто отбирать, а оповещения можно быстро создавать с относительно простой логикой. Например, вы можете настроить активирование оповещения, когда метрика превышает пороговое значение или когда разница между значениями двух метрик достигает определенного значения.

Индивидуальные метрики, как правило, представляют мало полезных сведений. Они предоставляют одно значение без какого-либо контекста, кроме сравнения с простым порогом. Они ценны в сочетании с другими метриками для определения шаблонов и тенденций или в сочетании с журналами, предоставляя контекст для определенных значений. Например, исходя из определенного количества пользователей приложения в определенный момент времени можно понять состояние работоспособности приложения. Резкое уменьшение числа пользователей хотя и обозначено несколькими значениями одной и той же метрики, может указывать на проблему. Чрезмерные исключения, вызванные приложением и обозначенные отдельной метрикой, могут указывать на проблему приложения, вызывающую спад в использовании. Созданные приложением события, идентифицирующие ошибку в определенных компонентах приложения, могут помочь определить первопричину.

Оповещения на основе журналов возникают не так быстро, как оповещения на основе метрик, но могут содержать более сложную логику. Вы можете создать оповещение на основе результатов любого запроса, который выполняет комплексный анализ данных из нескольких источников.

### <a name="logs"></a>Журналы
Журналы содержат различные типы данных, упорядоченных в записи с разными наборами свойств для каждого типа. Журналы могут содержать числовые значения, такие как метрики, но обычно они содержат текстовые данные с подробными описаниями. Кроме того, они отличаются от метрик по своей структуре. Часто данные журналов не собираются через регулярные промежутки времени.

Обычный тип записи журнала — это событие. События собираются спорадически, так как они создаются приложением или службой и обычно содержат достаточно сведений для самостоятельного предоставления полного контекста.  Например, событие может указывать на то, что определенный ресурс был создан или изменен, новый узел был запущен в ответ на увеличение трафика или в работе приложения была обнаружена ошибка.

Журналы особенно полезны для объединения данных из разных источников для комплексного анализа и определения тенденций с течением времени. Так как формат данных может различаться, приложения могут создавать пользовательские журналы, используя необходимую структуру. Метрики можно даже реплицировать в журналы, чтобы объединить их с другими данными мониторинга для определения тенденций и выполнения другого анализа данных.


## <a name="monitoring-tools-in-azure"></a>Инструменты мониторинга в Azure
Данные мониторинга в Azure собираются и анализируются с использованием нескольких источников, которые описаны в следующих разделах.

### <a name="azure-metrics"></a>Метрики Azure
Метрики из ресурсов и приложений Azure собираются в службе "Метрики Azure". Данные метрик интегрируются в страницы на портале Azure для конкретных ресурсов Azure, таких как виртуальные машины. На этих страницах содержатся графики таких метрик, как использование ЦП и сети для выбранного компьютера. Их также можно проанализировать с помощью [обозревателя метрик](../monitoring-and-diagnostics/monitoring-metric-charts.md), в котором могут отображаться графики значений нескольких метрик с течением времени.  Вы можете просматривать графики в интерактивном режиме или закрепить их на панели мониторинга, чтобы просматривать их вместе с другими визуализациями. Кроме того, вы можете извлечь метрики с помощью [REST API мониторинга Azure](../monitoring-and-diagnostics/monitoring-rest-api-walkthrough.md).

Подробные сведения о данных метрик, которые собираются различными видами ресурсов Azure, приведены в статье об [источниках данных мониторинга в Azure](monitoring-data-sources.md). 

![Обозреватель метрик](media/monitoring-data-collection/metrics-explorer.png)


### <a name="azure-activity-log"></a>Журнал действий Azure 
[Журнал действий Azure](../monitoring-and-diagnostics/monitoring-overview-activity-logs.md) хранит журналы о настройке и состоянии работоспособности служб Azure. Вы можете просматривать эти журналы на портале Azure с помощью обозревателя журналов действий, но обычно они [копируются в Log Analytics](../log-analytics/log-analytics-activity.md) для анализа с другими данными журнала.

В обозревателе журнала действий вы можете отфильтровать журнал действий для соответствия определенным критериям.  В меню большинства ресурсов на портале Azure также будет доступен параметр журнала действий, который отображает обозреватель журнала действий, отфильтрованный для этого ресурса. Вы также можете извлекать журналы действий с помощью [REST API мониторинга Azure](../monitoring-and-diagnostics/monitoring-rest-api-walkthrough.md).

![Обозреватель журнала действий](media/monitoring-data-collection/activity-log-explorer.png)


### <a name="log-analytics"></a>Log Analytics
Log Analytics предоставляет общую платформу данных для управления в Azure. Это основная служба, используемая для хранения и анализа журналов в Azure, сбора данных из различных источников, включая агенты на виртуальных машинах, решения по управлению и различные ресурсы Azure. Данные из других источников, включая метрики и журнал действий, можно скопировать в Log Analytics для создания центрального репозитория данных мониторинга.

В Log Analytics доступен многофункциональный язык запросов для анализа собранных данных.  Вы можете использовать [порталы поиска по журналам](../log-analytics/log-analytics-log-search-portals.md) для интерактивного написания и тестирования запросов, а также анализа их результатов. Кроме того, вы можете [создавать представления](../log-analytics/log-analytics-view-designer.md), чтобы визуализировать результаты поиска по журналам или вставлять результаты запросов непосредственно на панель мониторинга Azure.  Решения по управлению содержат функции поиска по журналам и представления в Log Analytics, позволяющие анализировать собранные данные. Другие службы, такие как Application Insights, хранят данные в Log Analytics и предоставляют дополнительные инструменты для анализа.  

![Журналы](media/monitoring-data-collection/logs.png)

### <a name="application-insights"></a>Application Insights
Служба Application Insights собирает телеметрию для веб-приложений, установленных на различных платформах. Она хранит свои данные в службе "Метрики Azure" и Log Analytics и предоставляет широкий набор различных инструментов (помимо имеющихся) для анализа и визуализации этих данных. Таким образом вы можете применять общий набор служб, таких как оповещения, поиски по журналам и панели мониторинга, используемых для другого мониторинга.


![Анализ приложения](media/monitoring-data-collection/app-insights.png)

### <a name="service-map"></a>Схема услуги
Решение "Сопоставление служб" обеспечивает визуальное представление виртуальных машин с их процессами и зависимостями. Оно хранит большую часть этих данных в Log Analytics, поэтому вы можете анализировать их с помощью других данных управления. Консоль решения "Сопоставление служб" также извлекает данные из Log Analytics для представления их в контексте анализируемой виртуальной машины.

![Схема услуги](media/monitoring-data-collection/service-map.png)


## <a name="transferring-monitoring-data"></a>Передача данных мониторинга

### <a name="metrics-to-logs"></a>Передача метрик в журналы
Метрики также можно реплицировать в Log Analytics для выполнения комплексного анализа с другими типами данных с помощью многофункционального языка запросов. Кроме того, вы можете сохранять данные журнала на более длительные периоды, чем метрики, что позволяет определять тенденции с течением времени. Если метрики или любые другие данные о производительности хранятся в Log Analytics, они выступают в роли журнала. Метрики позволяют поддерживать анализ и создание оповещений в режиме реального времени при использовании журналов для определения тенденций и анализа с другими данными.

Рекомендации по сбору метрик из ресурсов Azure см. в статье [Сбор журналов и метрик для служб Azure для использования в Log Analytics](../log-analytics/log-analytics-azure-storage.md). Сведения о сборе метрик из ресурсов PaaS в Azure см. в статье [Сбор метрик ресурсов PaaS в Azure с помощью Log Analytics](../log-analytics/log-analytics-collect-azurepass-posh.md).

### <a name="logs-to-metrics"></a>Передача журналов в метрики
Как описано выше, метрики реагируют быстрее, чем журналы, позволяя создавать оповещения с более низкой задержкой и меньшими затратами. Log Analytics собирает значительное количество числовых данных, которые подходят для метрик, но не сохраняются в службе "Метрики Azure". Распространенным примером являются данные о производительности, полученные от агентов и решений по управлению. Некоторые из этих значений можно скопировать в службу "Метрики Azure", где они будут доступны для оповещений и анализа с помощью обозревателя метрик.

Описание этой функции приведено в записи блога [Faster Metric Alerts for Logs now in public preview](https://azure.microsoft.com/blog/faster-metric-alerts-for-logs-now-in-limited-public-preview/) (Быстро создаваемые оповещения на основе метрик для журналов находятся в режиме ограниченной общедоступной версии). Список поддерживаемых значений см. в статье [Введение](../monitoring-and-diagnostics/monitoring-near-real-time-metric-alerts.md).

### <a name="event-hub"></a>Концентратор событий
Помимо анализа данных мониторинга с помощью инструментов Azure, вы можете перенаправить их на внешний инструмент, такой как продукт управления информационной безопасностью и событиями безопасности (SIEM). Обычно это делается с помощью [концентратора событий Azure](https://docs.microsoft.com/azure/event-hubs/). 

Сведения о различных типах данных мониторинга см. в статье [Потоковая передача данных мониторинга Azure в концентратор событий для потребления внешним инструментом](../monitoring-and-diagnostics/monitor-stream-monitoring-data-event-hubs.md).

## <a name="next-steps"></a>Дополнительная информация

- Узнайте о [доступных данных мониторинга](monitoring-data-sources.md) для различных источников в Azure. 