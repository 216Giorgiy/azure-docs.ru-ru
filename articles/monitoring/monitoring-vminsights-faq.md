---
title: 'Azure Monitor для виртуальных машин: вопросы и ответы | Microsoft Docs'
description: Azure Monitor для виртуальных машин — это решение в Azure, которое отслеживает работоспособность и производительность ОС виртуальных машин Azure, автоматически обнаруживает компоненты приложений и их зависимости от других ресурсов, а также строит схему каналов связи между ними. В этой статье приведены ответы на распространенные вопросы.
services: azure-monitor
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: tysonn
ms.assetid: ''
ms.service: azure-monitor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/18/2018
ms.author: magoedte
ms.openlocfilehash: e8723bd8e26eb66d9333c2093b5ada8bc78ca14b
ms.sourcegitcommit: 32d218f5bd74f1cd106f4248115985df631d0a8c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46989607"
---
# <a name="azure-monitor-for-vms-frequently-asked-questions"></a>Azure Monitor для виртуальных машин: вопросы и ответы
В этом списке вопросов и ответов от Майкрософт приведены часто задаваемые вопросы об Azure Monitor для виртуальных машин в Microsoft Azure. Если у вас есть другие вопросы об этом решении, вы можете задать их на [форуме для обсуждений](https://feedback.azure.com/forums/34192--general-feedback). Если вопрос задается часто, мы добавим его в эту статью, чтобы его можно было найти быстро и легко.

## <a name="can-i-onboard-to-an-existing-workspace"></a>Можно ли подключиться к существующей рабочей области?
Если ваши виртуальные машины уже подключены к рабочей области Log Analytics, вы можете продолжить использовать эту рабочую область при подключении к Azure Monitor для виртуальных машин при условии, что эта рабочая область находится в одном из перечисленных [здесь](monitoring-vminsights-onboard.md#prerequisites) поддерживаемых регионов.

При подключении мы настраиваем счетчики производительности для рабочей области. В результате система начинает собирать отчетные данные обо всех виртуальных машинах в рабочей области, а затем отображает и анализирует их в Azure Monitor для виртуальных машин.  В результате будут отображаться данные производительности, которые получены со всех виртуальных машин, подключенных к выбранной рабочей области.  Функции "Работоспособность" и "Схема" будут включены только для тех виртуальных машин, которые вы укажете для подключения.

Дополнительные сведения о том, какие счетчики производительности включены, см. в нашей статье, посвященной [подключению](monitoring-vminsights-onboard.md).

## <a name="can-i-onboard-to-a-new-workspace"></a>Можно ли подключиться к новой рабочей области? 
Если на данный момент ваши виртуальные машины не подключены к существующей рабочей области Log Analytics, вам потребуется создать рабочую область для хранения ваших данных.  Если вы настроите одну виртуальную машину Azure для Azure Monitor для виртуальных машин на портале Azure, будет автоматически создана рабочая область, используемая по умолчанию.

Если вы предпочитаете использовать скрипты, см. необходимые действия в статье, посвященной [подключению](monitoring-vminsights-onboard.md). 

## <a name="what-do-i-do-if-my-vm-is-already-reporting-to-an-existing-workspace"></a>Что делать, если виртуальная машина уже отправляет отчеты в существующую рабочую область?
Если вы уже собираете данные со своих виртуальных машин, возможно, вы уже настроили их для передачи отчетных данных в существующую рабочую область Log Analytics.  Пока эта рабочая область находится в одном из поддерживаемых регионов, вы можете включить Azure Monitor для виртуальных машин для этой существующей рабочей области.  Если рабочая область, которую вы уже используете, не находится в одном из поддерживаемых нами регионов, то на данный момент вам не удастся подключиться к Azure Monitor для виртуальных машин.  Мы активно работаем над поддержкой дополнительных регионов.

>[!NOTE]
>Мы настраиваем счетчики производительности для рабочей области, которые затрагивают все виртуальные машины, отправляющие отчетные данные в эту рабочую область, независимо от того, подключите ли вы их к Azure Monitor для виртуальных машин. Дополнительные сведения о настройке счетчиков производительности для рабочей области см. в нашей [документации](../log-analytics/log-analytics-data-sources-performance-counters.md). Сведения о счетчиках, настроенных для Azure Monitor для виртуальных машин, см. в нашей [документации по подключению](monitoring-vminsights-onboard.md#performance-counters-enabled).  

## <a name="why-did-my-vm-fail-to-onboard"></a>Почему не удалось подключить мою виртуальную машину?
При подключении виртуальной машины Azure на портале Azure выполняются указанные ниже действия.

* Система создает рабочую область Log Analytics, используемую по умолчанию, если был выбран соответствующий параметр.
* Система настраивает счетчики производительности для выбранной рабочей области. Если не удастся выполнить это действие, вы заметите, что в некоторых диаграммах и таблицах производительности не отображаются данные для подключенной вами виртуальной машины. Это можно исправить, только выполнив скрипт PowerShell, описанный [здесь](monitoring-vminsights-onboard.md#enable-with-powershell).
* Если система определяет, что необходим агент Log Analytics, она устанавливает его на виртуальных машинах Azure, используя расширение виртуальной машины.  
* При необходимости на виртуальных машинах Azure с использованием расширения устанавливается программа Dependency Agent. Ее требует функция "Схема" в Azure Monitor для виртуальных машин.  
* При необходимости настраиваются компоненты Azure Monitor, поддерживающие функцию "Работоспособность". Кроме того, настраивается виртуальная машина так, чтобы она предоставляла данные о работоспособности.

В процессе подключения мы проверяем состояние на каждом из указанных выше элементов, чтобы возвращать сведения о состоянии уведомления вам на портале.  Настройка рабочей области и установка агента обычно занимает 5–10 минут.  Просмотр данных мониторинга и работоспособности на портале занимает еще 5–10 минут.  

Если вы инициировали подключение, но после этого отображаются сообщения о том, что необходимо подключить виртуальную машину, подождите около 30 минут, пока виртуальная машина завершит процесс. 

## <a name="i-dont-see-some-or-any-data-in-the-performance-charts-for-my-vm"></a>На диаграммах производительности не отображаются некоторые или все данные для моей виртуальной машины
Если данные производительности не отображаются в таблице дисков или в некоторых диаграммах производительности, возможно, не настроены счетчики производительности в рабочей области. Чтобы решить эту проблему, выполните указанный ниже [скрипт PowerShell](monitoring-vminsights-onboard.md#enable-with-powershell).

## <a name="how-is-azure-monitor-for-vms-map-feature-different-from-service-map"></a>Чем функция "Схема" в Azure Monitor для виртуальных машин отличается от решения "Сопоставление служб"?
Функция "Схема" в Azure Monitor для виртуальных машин основана на решении "Сопоставление служб", но при этом имеет указанные ниже отличия.

* Доступ к представлению "Схема" можно получить, выбрав колонку "Виртуальная машина" или элемент "Azure Monitor для виртуальных машин" в Azure Monitor.
* Теперь в функции "Схема" можно щелкать подключения и отображать представления с данными метрик подключений на боковой панели для выбранного подключения.
* Появился новый API, который используется для создания схем с целью улучшения поддержки сложных схем.
* Отслеживаемые виртуальные машины теперь включены в узел групп клиентов, а на кольцевой диаграмме показаны доли отслеживаемых и неотслеживаемых виртуальных машин в группе.  Теперь ее также можно использовать для фильтрации списка компьютеров при развертывании группы.
* Отслеживаемые виртуальные машины теперь включены в узлы групп портов серверов, а на кольцевой диаграмме показаны доли отслеживаемых и неотслеживаемых машин в группе.  Теперь ее также можно использовать для фильтрации списка компьютеров при развертывании группы.
* Стиль схем был обновлен, и теперь он больше соответствует схеме приложений в Application Insights.
* Боковые панели были обновлены, но еще не оснащены полный набором интеграций, которые поддерживались в решении "Сопоставление служб". В них нет решений "Управление обновлениями", "Отслеживание изменений", "Безопасность" и Service Desk. 
* Параметр для выбора групп и машин, которые необходимо сопоставить, был обновлен, и теперь поддерживает "Подписки", "Группы ресурсов", масштабируемые наборы виртуальных машин Azure и облачные службы.
* Вам не удастся создать группы компьютеров в решении "Сопоставление служб", используя функцию "Схема" в Azure Monitor для виртуальных машин.  

## <a name="why-do-my-performance-charts-show-dotted-lines"></a>Почему диаграммы производительности отображаются пунктирными линиями?

Это может произойти по нескольким причинам.  В случаях, когда есть пробелы в собранных данных, мы отображаем строки пунктирной линией.  Если вы изменили частоту выборки данных для включенных счетчиков производительности (по умолчанию сбор данных выполняется каждые 60 секунд), на диаграмме могут отображаться пунктирные линии. Это происходит, если вы выбрали малый диапазон времени для диаграммы, а частота выборки меньше, чем размер сегмента, используемого в диаграмме (например, частота выборки составляет один раз в 10 минут, а каждый сегмент на диаграмме соответствует 5 минутам).  В этом случае, если вы выберете больший диапазон времени для отображения, линии диаграммы должны вновь стать сплошными.

## <a name="are-groups-supported-with-azure-monitor-for-vms"></a>Поддерживаются ли группы в Azure Monitor для виртуальных машин?
Функция "Производительность" поддерживает группы, основанные на выделенных ресурсах в определенной рабочей области, а также группирование, основанное на определенном масштабируемом наборе виртуальных машин Azure и облачной службе.

## <a name="how-do-i-see-the-details-for-what-is-driving-the-95th-percentile-line-in-the-aggregate-performance-charts"></a>Как отобразить сведения о факторах, влияющих на линию 95-го процентиля на агрегированных диаграммах производительности?
По умолчанию список отсортирован так, что в нем отображаются виртуальные машины с самым большим значением для 95-го процентиля для выбранной метрики. Исключение составляет диаграмма "Доступная память", на которой показаны компьютеры с самым маленьким значением 5-го процентиля.  Если щелкнуть диаграмму, откроется представление со списком компьютеров с **лучшими параметрами**.

## <a name="how-does-the-map-feature-handle-duplicate-ips-across-different-vnets-and-subnets"></a>Как функция "Схема" обрабатывает дублирующиеся IP-адреса в разных виртуальных сетях и подсетях?
Если диапазоны IP-адресов дублируются при использовании виртуальных машин либо масштабируемых наборов виртуальных машин Azure в подсетях и виртуальных сетях, в функции "Схема" Azure Monitor для виртуальных машин может отображаться неправильная информация. Это известная проблема, и мы работаем над ее решением.

## <a name="does-map-feature-support-ipv6"></a>Поддерживает ли функция "Схема" протокол IPv6?
На данный момент функция "Схема" поддерживает только протокол IPv4, но мы работаем над поддержкой протокола IPv6. Мы также поддерживаем протокол IPv4, туннелируемый через протокол IPv6.

## <a name="when-i-load-a-map-for-a-resource-group-or-other-large-group-the-map-is-difficult-to-view"></a>Когда я загружаю схему для группы ресурсов или другой большой группы, становится трудно просматривать схему
Несмотря на то что мы усовершенствовали функцию "Схема" в части отображения больших и сложных конфигураций, мы понимаем, что на схеме может быть много узлов, подключений и узлов, работающих как кластеры.  Мы намерены продолжать работу над улучшением функции масштабирования.   

## <a name="why-does-the-network-chart-on-the-performance-tab-look-different-than-the-network-chart-on-the-azure-vm-overview-page"></a>Почему внешний вид диаграммы сети на вкладке "Производительность" отличается от внешнего вида диаграммы сети на странице общих сведений о виртуальной машине Azure?

На странице общих сведений о виртуальной машине Azure отображаются диаграммы, основанные на измерениях активности гостевой виртуальной машины, выполняемых узлом.  На диаграмме сети на странице общих сведений о виртуальной машине Azure отображается только сетевой трафик, за который будет выставлен счет.  Здесь не учитывается трафик между виртуальными сетями.  Данные и диаграммы, отображаемые в Azure Monitor для виртуальных машин, основаны на данных, получаемых из гостевой виртуальной машины, а на диаграмме сети отображается весь входящий и исходящий трафик TCP/IP виртуальной машины, включая трафик между виртуальными сетями.
