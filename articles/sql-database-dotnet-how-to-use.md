<properties urlDisplayName="SQL Database" pageTitle="Использование базы данных SQL (.NET) - Руководство по компонентам Azure" metaKeywords="Приступая к работе с SQL Azure, Приступая к работе с SQL Azure, подключение к базе данных SQL Azure, SQL Azure ADO.NET, SQL Azure ODBC, SQL Azure EntityClient" description="Приступая к работе с Базой данных SQL. Узнайте, как создать экземпляр Базы данных SQL и подключиться к нему с помощью поставщика ADO.NET, ODBC и EntityClient." metaCanonical="" services="sql-database" documentationCenter=".NET" title="How to use Azure SQL Database in .NET applications" authors="jeffreyg" solutions="" manager="jeffreyg" editor="" />

<tags ms.service="sql-database" ms.workload="data-management" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/31/2015" ms.author="jeffreyg" />







# Как использовать базу данных SQL Azure в приложениях .NET

В данном руководстве показано создание логического сервера и экземпляра базы данных на основе базы данных AQL Azure, а также подключение к базе данных с использованием следующих технологий поставщика данных на платформе .NET: ADO.NET, ODBC, и EntityClient Provider.


<h2><a name="Whatis"></a>Что такое база данных SQL</h2>

База данных SQL представляет собой систему управления реляционной базой данных для Azure и основана на технологии сервера SQL. С экземпляром базы данных SQL можно легко подготовить и развернуть решения реляционных баз данных в облаке и воспользоваться преимуществами центра распределенных данных, которые представляют собой корпоративные преимущества доступности, масштабируемости и безопасности вместе со встроенной защитой данных и возможностями самостоятельной регенерации.

## Оглавление

- [Вход в Azure](#PreReq1)
- [Создание и настройка базы данных SQL](#PreReq2)
- [Подключение к базе данных SQL](#connect-db) 
- [Подключение с помощью ADO.NET](#using-sql-server)
- [Подключение с помощью ODBC](#using-ODBC)
- [Подключение с помощью поставщика EntityClient](#using-entity)
- [Дальнейшие действия](#next-steps)

<h2><a name="PreReq1"></a>Вход в Azure</h2>

База данных SQL предоставляет хранилище реляционных данных, доступ и управление службами на Azure. Для пользования ею понадобится подписка Azure.

1. Откройте веб-браузер и перейдите по адресу [http://www.windowsazure.com](http://www.windowsazure.com). Чтобы начать работу с бесплатной учетной записью, нажмите "Бесплатная пробная версия" в верхнем правом углу и следуйте дальнейшим указаниям:

2. Ваша учетная запись создана. Вы готовы начать работу.


<h2><a name="PreReq2"></a>Создание и настройка базы данных SQL</h2>

Теперь создайте и настройте базу данных и сервер. На портале управления исправленные рабочие процессы позволяют сначала создать базу данных, а затем подготовить сервер к работе. 

<h3 name="createsrvr">Создание логического сервера и экземпляра базы данных</h3>

1. Выполните вход на [портал управления Azure][].

2. Щелкните **СОЗДАТЬ** в нижней части страницы.

3. Щелкните **Службы данных**.

4. Щелкните **Базы данных SQL**.

5. Щелкните элемент **Настраиваемое создание**. 

6. В поле "Имя" введите имя базы данных.

7. Выберите выпуск, чтобы выбрать максимальный размер и сортировку. В рамках данного руководства можно использовать значения по умолчанию. 

	Базы данных SQL представлены в трех вариантах: Базовый, Стандартный и Премиум.

	МАКСИМАЛЬНЫЙ РАЗМЕР задается при создании базы данных, и затем может быть изменен с помощью элемента "ИЗМЕНИТЬ БАЗУ ДАННЫХ". МАКСИМАЛЬНЫЙ РАЗМЕР обеспечивает возможность ограничивать размер базы данных.

	Для любой базы данных, созданной на Azure, существует три реплики.  Это необходимо для обеспечения высокой доступности. Отработка отказа является прозрачной и интегрирована в службу.  [Соглашение об уровне службы][] обеспечивает 99.9% рабочего времени для базы данных SQL.

8. В области "Сервер" выберите **Создать сервер базы данных SQL**. 

9. Нажмите кнопку со стрелкой, чтобы перейти к следующей странице.

10. В диалоговом окне "Параметры сервера" укажите имя входа для аутентификации SQL Server.

 База данных SQL использует проверку подлинности SQL с помощью шифрованного подключения. Будет создана новая учетная запись для проверки подлинности SQL Server, назначенная предопределенной роли сервера sysadmin и использующая введенное имя. 

	В качестве логина нельзя использовать адрес электронной почты, учетную запись пользователя Windows или Windows Live ID. База данных SQL не поддерживает утверждения и проверку подлинности Windows.

11. Укажите надежный пароль, который содержит более восьми знаков, в том числе символы в верхнем и нижнем регистре, а также цифры и символы.

12. Выберите регион. Регион определяет географическое расположение сервера. Изменение региона достаточно трудоемко, поэтому выберите регион, имеющий смысл для этого сервера. Выберите местоположение, максимально близкое к вам. Хранение приложения и базы данных Azure в том же регионе снижает расходы на пропускную способность и задержку данных.

13. Убедитесь, что установлен флажок **Разрешить службам Azure доступ к серверу**, чтобы можно было подключиться к этой базе данных, используя портал управления для базы данных SQL, службы хранилища и другие службы Azure. 

14. Закончив, щелкните флажок внизу страницы.

Обратите внимание, что имя сервера не было задано. База данных SQL автоматически создает имя сервера, гарантируя отсутствие повторяющихся записей DNS. Имя сервера является буквенно-цифровой строкой, состоящей из 10 знаков. Невозможно изменить имя сервера баз данных SQL.

После того, как база данных создана, щелкните ее, чтобы открыть панель мониторинга. Панель мониторинга содержит строки подключения, которые можно копировать и использовать в коде приложения. На ней также показан URL-адрес для управления, который понадобится вам для определения, будете ли вы подключаться к базе данных через Management Studio или другой инструмент управления.


![image](./media/sql-database-dotnet-how-to-use/SQLDbDashboard.PNG)


На следующем шаге будет настроен брандмауэр, чтобы разрешить подключение для приложений, работающих в вашей сети.

<h3 name="configFWLogical">Настройка брандмауэра для логического сервера</h3>

1. Щелкните **Базы данных SQL **, затем на **Серверы** в верхней части экрана, и выберите сервер, который вы только что создали.

	![Image2](./media/sql-database-dotnet-how-to-use/SQLDBFirewall.PNG)

2. Щелкните **Настройка**. 

3.  Скопируйте текущий IP-адрес клиента. В случае подключения из сети это IP-адрес, прослушиваемый вашим маршрутизатором или прокси-сервером. База данных SQL определяет IP-адрес, используемый текущим подключением, чтобы можно создать правило брандмауэра для принятия запросов на подключение от этого устройства. 

4. Вставьте IP-адрес в поля "НАЧАЛЬНЫЙ IP-АДРЕС" и "КОНЕЧНЫЙ IP-АДРЕС" для задания диапазона адресов, которым разрешен доступ к серверу. Впоследствии при возникновении проблем с подключением, означающих, что диапазон слишком узок, вы сможете отредактировать это правило и расширить диапазон.

	Если клиентский компьютер использует динамически назначаемые IP-адреса, вы должны указать диапазон, достаточно широкий для покрытия IP-адресов, назначаемых для компьютеров в вашей сети. Начните с узкого диапазона и расширяйте его только в случае необходимости.

5. Введите имя для правила брандмауэра, например имя компьютера или компании.

6. Щелкните значок галочки рядом с правилом, чтобы сохранить его.

	![Image3](./media/sql-database-dotnet-how-to-use/SQLDBIPRange.PNG)

7. Чтобы завершить этот шаг, нажмите кнопку **Сохранить**. Если кнопка **Сохранить** не отображается, обновите страницу браузера.

Теперь у вас есть экземпляр базы данных, логический сервер, правило брандмауэра, позволяющее устанавливать входящее соединение с вашего IP-адреса, и имя для входа в режиме администратора. Вы готовы к программному подключению к базе данных.


<h2><a name="Connect-DB"></a>Подключение к базе данных SQL</h2>

В данном разделе рассматривается подключение к экземпляру базы данных SQL с использованием различных
поставщиков данных на платформе .NET.

Если вы решили использовать Virtual Studio, но веб-приложение Azure не входит в вашу конфигурацию в качестве клиентского интерфейса, нет необходимости в дополнительных инструментах или установке пакетов SDK на компьютер для разработки. Просто начните разработку вашего приложения.

В Visual Studio вы можете пользоваться теми же инструментами разработки для баз данных SQL, что и для сервера SQL. Обозреватель серверов позволяет просматривать (но не редактировать) базу данных. Разработчик Visual Studio Entity Data Model Designer имеет все необходимые функции, и его можно использовать для создания моделей для баз данных SQL в работе с платформой Entity Framework.

### <a name="using-sql-server"></a>Использование поставщика данных на платформе .NET для сервера SQL.

Пространство имен **System.Data.SqlClient** относится к данным на платформе .NET.
Поставщик для сервера SQL.

Стандартная строка подключения выглядит следующим образом:

    Server=tcp:.database.windows.net;
    Database=;
    User ID=@;
    Password=;
    Trusted_Connection=False;
    Encrypt=True;

Можно использовать класс **SQLConnectionStringBuilder** для установления строки подключения, как показано в коде нижеследующего примера:

    SqlConnectionStringBuilder csBuilder;
    csBuilder = new SqlConnectionStringBuilder();
    csBuilder.DataSource = xxxxxxxxxx.database.windows.net;
    csBuilder.InitialCatalog = testDB;
    csBuilder.Encrypt = true;
    csBuilder.TrustServerCertificate = false;
    csBuilder.UserID = MyAdmin;
    csBuilder.Password = pass@word1;

Если элементы строки подключения известны заранее, они могут быть сохранены в файле конфигурации и извлечены в соответствующий момент для построения строк подключения. Вот пример строки подключения в файле конфигурации:

    <connectionStrings>
      <add name="ConnectionString" 
           connectionString ="Server=tcp:xxxxxxxxxx.database.windows.net;Database=testDB;User ID=MyAdmin@xxxxxxxxxx;Password=pass@word1;Trusted_Connection=False;Encrypt=True;" />
    </connectionStrings>

To retrieve the connection string in a configuration file, you use the
**ConfigurationManager** class:

    SqlConnectionStringBuilder csBuilder;
    csBuilder = new SqlConnectionStringBuilder(ConfigurationManager.ConnectionStrings["ConnectionString"].ConnectionString);
    After you have built your connection string, you can use the SQLConnection class to connect the SQL Database server:
    SqlConnection conn = new SqlConnection(csBuilder.ToString());
    conn.Open();

### <a name="using-ODBC"></a>Использование поставщика данных на платформе .NET для ODBC

Пространство имен **System.Data.Odbc** является поставщиком данных на платформе .NET для ODBC. Ниже приводится пример строки подключения ODBC:

    Driver={SQL Server Native Client 10.0};
    Server=tcp:.database.windows.net;
    Database=;
    Uid=@;
    Pwd=;
    Encrypt=yes;

Класс **OdbcConnection** представляет собой открытое соединение с источником данных. Вот пример кода для открытия соединения:

    string cs = "Driver={SQL Server Native Client 10.0};" +
                "Server=tcp:xxxxxxxxxx.database.windows.net;" +
                "Database=testDB;"+
                "Uid=MyAdmin@xxxxxxxxxx;" +
                "Pwd=pass@word1;"+
                "Encrypt=yes;";

    OdbcConnection conn = new OdbcConnection(cs);
    conn.Open();

Если вы хотите сформировать строку подключения во время работы, можно использовать класс **OdbcConnectionStringBuilder**.

### <a name="using-entity"></a>Использование поставщика EntityClient

Пространство имен **System.Data.EntityClient** является поставщиком данных на платформе .NET для платформы Entity Framework.

Платформа Entity Framework позволяет разработчикам создавать приложения для доступа к данным на основе концептуальных моделей приложения, вместо прямого программирования на основе реляционной схемы хранения. Платформа Entity Framework надстраивается на поставщик данных ADO.NET, специфичный для хранения, обеспечивая объект **EntityConnection** для базового поставщика данных и реляционной базы данных.

Для создания объекта **EntityConnection** необходимо задать ссылку на набор данных, содержащий необходимые модели и сопоставления, а также имя поставщика данных для конкретного хранилища и строку подключения. После расположения объекта **EntityConnection** на своем месте, доступ к сущностям может выполняться посредством классов, генерируемых в концептуальной модели.

Ниже приведен пример строки подключения:

    metadata=res://*/SchoolModel.csdl|res://*/SchoolModel.ssdl|res://*/SchoolModel.msl;provider=System.Data.SqlClient;provider connection string="Data Source=xxxxxxxxxx.database.windows.net;Initial Catalog=School;Persist Security Info=True;User ID=MyAdmin;Password=***********"

Для получения дополнительной информации см. [Поставщик EntityClient для платформы Entity
Framework][].

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы ознакомились с основами подключения к базе данных SQL, перейдите к следующим ресурсам для получения дополнительной информации о базе данных SQL.

-   [Разработка в базе данных SQL Azure: инструкции][]
-   [База данных SQL][]


  [Что такое база данных SQL]: #WhatIs
  [Вход в Azure]: #PreReq1
  [Создание и настройка базы данных SQL]: #PreReq2
  [Подключение к базе данных SQL]: #connect-db
  [Подключение с помощью ADO.NET]: #using-sql-server
  [Подключение с помощью ODBC]: #using-ODBC
  [Подключение с помощью поставщика EntityClient]: #using-entity
  [Дальнейшие действия]: #next-steps
  [Бесплатная пробная версия Azure]: {localLink:2187} "Бесплатная пробная версия"
  [Портал управления Azure]: http://manage.windowsazure.com
  [Практическое руководство. Создание сервера базы данных SQL]: http://social.technet.microsoft.com/wiki/contents/articles/how-to-create-a-sql-azure-server.aspx
  [Портал управления для базы данных SQL]: http://msdn.microsoft.com/ru-ru/library/windowsazure/gg442309.aspx
  [Брандмауэр базы данных SQL]: http://social.technet.microsoft.com/wiki/contents/articles/sql-azure-firewall.aspx
  [Поддержка средств и служебных программ (база данных SQL)]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee621784.aspx
  [Создание базы данных SQL в Azure]: http://social.technet.microsoft.com/wiki/contents/articles/how-to-create-a-sql-azure-database.aspx
  [Соглашение об уровне обслуживания]: {localLink:1132} "SLA"
  [Поставщик EntityClient для платформы Entity Framework]: http://msdn.microsoft.com/ru-ru/library/bb738561.aspx
  [Разработка в базе данных SQL Azure: инструкции]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee621787.aspx
  [База данных SQL]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee336279.aspx
