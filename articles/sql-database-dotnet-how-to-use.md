<properties linkid="dev-net-how-to-sql-azure" urlDisplayName="SQL Database" pageTitle="How to use SQL Database (.NET) - Azure feature guide" metaKeywords="Get started SQL Azure, Getting started SQL Azure, SQL Azure database connection, SQL Azure ADO.NET, SQL Azure ODBC, SQL Azure EntityClient" description="Get started with SQL Database. Learn how to create a SQL Database instance and connect to it using ADO.NET, ODBC, and EntityClient Provider." metaCanonical="" services="sql-database" documentationCenter=".NET" title="How to use Azure SQL Database in .NET applications" authors="jeffreyg" solutions="" manager="" editor="" />

<tags ms.service="sql-database" ms.workload="data-management" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="jeffreyg" />

# Как использовать базу данных SQL Azure в приложениях .NET

В этом руководстве показано, как создать логический сервер и экземпляр базы данных в базе данных SQL Azure и подключиться к
базе данных с использованием следующих технологий поставщика данных платформы .NET Framework:
ADO.NET, ODBC и поставщика EntityClient.

## <a name="Whatis"></a>Что такое база данных SQL

База данных SQL предоставляет собой систему управления реляционной базой данных для Azure и основана на технологии SQL Server. С экземпляром базы данных SQL можно легко подготовить и развернуть решения реляционных баз данных в облаке и воспользоваться преимуществами центра распределенных данных, которые представляют собой корпоративные преимущества доступности, масштабируемости и безопасности вместе со встроенной защитой данных и возможностями самостоятельной регенерации.

## Оглавление

-   [Вход в Azure][Вход в Azure]
-   [Создание и настройка базы данных SQL][Создание и настройка базы данных SQL]
-   [Подключение к базе данных SQL][Подключение к базе данных SQL]
-   [Подключение с помощью ADO.NET][Подключение с помощью ADO.NET]
-   [Подключение с помощью ODBC][Подключение с помощью ODBC]
-   [Подключение с помощью поставщика EntityClient][Подключение с помощью поставщика EntityClient]
-   [Дальнейшие действия][Дальнейшие действия]

## <a name="PreReq1"></a>Вход в Azure

База данных SQL предоставляет службы хранения реляционных данных, доступа к ним и управления ими в Azure. Для ее использования необходима подписка Azure.

1.  Откройте браузер и перейдите по адресу [][]<http://www.windowsazure.com></a>. Чтобы начать работу с бесплатной учетной записью, щелкните бесплатное пробное использование в правом верхнем углу и следуйте инструкциям.

2.  Ваша учетная запись создана. Вы готовы начать работу.

## <a name="PreReq2"></a><span class="short-header">Создание и настройка базы данных SQL</span>

Далее необходимо создать и настроить базу данных и сервер. На портале управления исправленные рабочие процессы позволяют сначала создать базу данных, а затем подготовить сервер к работе.

### Создание логического сервера и экземпляра базы данных

1.  Выполните вход на [портал управления Azure][портал управления Azure].

2.  В нижней части страницы щелкните **+СОЗДАТЬ**.

3.  Щелкните элемент **Службы данных**.

4.  Щелкните элемент **База данных SQL**.

5.  Щелкните элемент **Настраиваемое создание**.

6.  В поле «Имя» введите имя базы данных.

7.  Выберите выпуск, максимальный размер и параметры сортировки. В рамках данного руководства можно использовать значения по умолчанию.

    База данных SQL предоставляет два выпуска базы данных. Выпуск Web Edition растет до размера 5 ГБ. Выпуск Business Edition растет до размера 50 ГБ.

    Параметр MAXSIZE задается при создании базы данных и позднее может быть изменен с помощью команды ALTER DATABASE. Параметр MAXSIZE позволяет ограничивать размер базы данных.

    Для каждой созданной в Azure базы данных SQL существует три реплики. Это необходимо для обеспечения высокого уровня доступности. Отработка отказов является прозрачной и интегрирована в службу. [об уровне обслуживания (SLA)][об уровне обслуживания (SLA)] обеспечивает для базы данных SQL время бесперебойной работы на уровне 99,9 %.

8.  В разделе «Сервер» выберите **Создать сервер базы данных SQL**.

9.  Нажмите кнопку со стрелкой, чтобы перейти к следующей странице.

10. В диалоговом окне «Параметры сервера» укажите имя входа для аутентификации SQL Server.

    База данных SQL использует проверку подлинности SQL с помощью шифрованного подключения. Будет создана новая учетная запись для проверки подлинности SQL Server, назначенная фиксированной серверной роли sysadmin и использующая введенное имя.

    В качестве имени входа нельзя использовать электронный адрес, учетную запись пользователя Windows или идентификатор Windows Live ID. Для базы данных SQL не поддерживается аутентификация на основе утверждений и аутентификация Windows.

11. Укажите надежный пароль, который содержит более восьми знаков, в том числе символы в верхнем и нижнем регистре, а также цифры и символы.

12. Выберите регион. Регион определяет географическое расположение сервера. Изменение региона достаточно трудоемко, поэтому выберите регион, имеющий смысл для этого сервера. Выберите местоположение, максимально близкое к вам. Хранение приложения и базы данных Azure в том же регионе снижает расходы на пропускную способность и задержку данных.

13. Убедитесь, что выбран параметр **Разрешить службам Azure доступ к серверу**, чтобы к этой базе данных можно было подключиться из портала управления базами данных SQL, службы хранилища и других служб Azure.

14. Закончив, щелкните флажок внизу страницы.

Обратите внимание, что имя сервера не было задано. База данных SQL автоматически создает имя сервера, гарантируя отсутствие повторяющихся записей DNS. Имя сервера является буквенно-цифровой строкой, состоящей из 10 знаков. Невозможно изменить имя сервера баз данных SQL.

После создания базы данных щелкните ее, чтобы открыть соответствующую панель мониторинга. Панель мониторинга содержит строки подключения, которые можно копировать и использовать в коде приложения. В ней также отображается URL-адрес управления, который необходимо указать при подключении к базе данных из среды Management Studio или другого средства администрирования.

![изображение][изображение]

На следующем шаге будет настроен брандмауэр, чтобы разрешить подключение для приложений, работающих в вашей сети.

### Настройка брандмауэра для логического сервера

1.  Выберите **Базы данных SQL**, щелкните элемент **Серверы** в верхней части страницы, а затем — только что созданный сервер.

    ![рисунок 2][рисунок 2]

2.  Нажмите **Настроить**.

3.  Скопируйте текущий IP-адрес клиента. В случае подключения из сети это IP-адрес, прослушиваемый вашим маршрутизатором или прокси-сервером. База данных SQL определяет IP-адрес, используемый текущим подключением, чтобы можно создать правило брандмауэра для принятия запросов на подключение от этого устройства.

4.  Вставьте IP-адрес в поля «НАЧАЛЬНЫЙ IP-АДРЕС» и «КОНЕЧНЫЙ IP-АДРЕС», чтобы задать диапазон адресов, которым разрешен доступ к серверу. Позже в случае ошибки подключения, сообщающей о слишком узком диапазоне, можно изменить это правило, расширяя диапазон.

    Если клиентские компьютеры используют динамически назначаемые IP-адреса, необходимо указать диапазон, достаточно широкий для включения IP-адресов, назначенных компьютерам в сети. Начните с узкого диапазона и расширяйте его только в случае необходимости.

5.  Введите имя для правила брандмауэра, например имя своего компьютера или компании.

6.  Щелкните значок галочки рядом с правилом, чтобы сохранить его.

    ![рисунок 3][рисунок 3]

7.  Чтобы завершить шаг, нажмите кнопку **Сохранить** в нижней части страницы. Если кнопка **Сохранить** не видна, обновите страницу браузера.

Теперь у вас есть экземпляр базы данных, логический сервер, правило брандмауэра, разрешающее входящие подключения с вашего IP-адреса, и учетная запись администратора. Теперь все готово для программного подключения к базе данных SQL.

## <a name="Connect-DB"></a><span class="short-header">Подключение к базе данных SQL</span>

В этом разделе показано, как подключиться к экземпляру базы данных SQL с использованием различных поставщиков данных платформы .NET Framework.

Если вы решите использовать Visual Studio, и при этом текущая конфигурация не содержит внешнее веб-приложение Azure, на компьютере разработчика не потребуется устанавливать какие-либо дополнительные инструменты или пакеты SDK. Можно сразу же приступить к разработке приложения.

Для работы с базой данных SQL вы можете использовать те же инструменты проектирования в Visual Studio, что и для работы с SQL Server. В обозревателе серверов можно просматривать (но не изменять) объекты баз данных. Конструктор моделей EDM Visual Studio является полнофункциональным, и его можно использовать, чтобы создавать модели для базы данных SQL для работы с Entity Framework.

### <a name="using-sql-server"></a>Использование поставщика данных платформы .NET Framework для SQL Server

Пространство имен **System.Data.SqlClient** является поставщиком данных .NET Framework для SQL Server.

Стандартная строка подключения выглядит следующим образом:

    Server=tcp:.database.windows.net;
    Database=;
    User ID=@;
    Password=;
    Trusted_Connection=False;
    Encrypt=True;

Вы можете использовать класс **SQLConnectionStringBuilder** для создания строки подключения, как показано в следующем примере кода:

    SqlConnectionStringBuilder csBuilder;
    csBuilder = new SqlConnectionStringBuilder();
    csBuilder.DataSource = xxxxxxxxxx.database.windows.net;
    csBuilder.InitialCatalog = testDB;
    csBuilder.Encrypt = true;
    csBuilder.TrustServerCertificate = false;
    csBuilder.UserID = MyAdmin;
    csBuilder.Password = pass@word1;

Если элементы строки подключения известны заранее, они могут сохраняться в файле конфигурации и извлекаться во время выполнения для создания строки подключения. Ниже приведен пример строки подключения в файле конфигурации:

    <connectionStrings>
      <add name="ConnectionString" 
           connectionString ="Server=tcp:xxxxxxxxxx.database.windows.net;Database=testDB;User ID=MyAdmin@xxxxxxxxxx;Password=pass@word1;Trusted_Connection=False;Encrypt=True;" />
    </connectionStrings>

Чтобы получить строку подключения в файле конфигурации, используйте класс **ConfigurationManager**:

    SqlConnectionStringBuilder csBuilder;
    csBuilder = new SqlConnectionStringBuilder(ConfigurationManager.ConnectionStrings["ConnectionString"].ConnectionString);
    After you have built your connection string, you can use the SQLConnection class to connect the SQL Database server:
    SqlConnection conn = new SqlConnection(csBuilder.ToString());
    conn.Open();

### <a name="using-ODBC"></a>Использование поставщика данных платформы .NET Framework для ODBC

Пространство имен **System.Data.Odbc** является поставщиком данных .NET Framework для ODBC. Ниже приведен пример строки подключения ODBC:

    Driver={SQL Server Native Client 10.0};
    Server=tcp:.database.windows.net;
    Database=;
    Uid=@;
    Pwd=;
    Encrypt=yes;

Класс **OdbcConnection** позволяет устанавливать открытое подключение к источнику данных. Ниже приведен пример кода, где показано, как открыть соединение.

    string cs = "Driver={SQL Server Native Client 10.0};" +
                "Server=tcp:xxxxxxxxxx.database.windows.net;" +
                "Database=testDB;"+
                "Uid=MyAdmin@xxxxxxxxxx;" +
                "Pwd=pass@word1;"+
                "Encrypt=yes;";
    OdbcConnection conn = new OdbcConnection(cs);
    conn.Open();

Если вы хотите создать строку подключения во время выполнения, то можете использовать класс **OdbcConnectionStringBuilder**.

### <a name="using-entity"></a>Использование поставщика EntityClient

Пространство имен **System.Data.EntityClient** является поставщиком данных .NET Framework для Entity Framework.

Платформа Entity Framework позволяет разработчикам создавать приложения доступа к данным путем программирования по концептуальной модели приложения, а не напрямую по схеме реляционного хранилища. Платформа Entity Framework создается на основе привязанных к хранилищам поставщиков данных ADO.NET, предоставляя объект **EntityConnection** базовому поставщику данных и реляционной базе данных.

Для создания объекта **EntityConnection** необходима ссылка на набор метаданных, содержащий необходимые модели и сопоставления, а также строка подключения и имя поставщика данных, связанного с определенным хранилищем. После добавления объекта **EntityConnection** доступ к сущностям может осуществляться через классы, сформированные из концептуальной модели.

Ниже приведен пример строки подключения:

    metadata=res://*/SchoolModel.csdl|res://*/SchoolModel.ssdl|res://*/SchoolModel.msl;provider=System.Data.SqlClient;provider connection string="Data Source=xxxxxxxxxx.database.windows.net;Initial Catalog=School;Persist Security Info=True;User ID=MyAdmin;Password=***********"

Дополнительную информацию см. в статье [Поставщик EntityClient для платформы Entity Framework](http://msdn.microsoft.com/ru-ru/library/bb738561.aspx).

## <a name="next-steps"></a> Дальнейшие действия

Теперь, когда вы изучили основы подключения к базе данных SQL, обратитесь
к следующим ресурсам, чтобы получить дополнительную информацию о базе данных SQL.

-   [Разработка в базе данных SQL Azure: инструкции][Разработка в базе данных SQL Azure: инструкции]
-   [База данных SQL][База данных SQL]

  [Вход в Azure]: #PreReq1
  [Создание и настройка базы данных SQL]: #PreReq2
  [Подключение к базе данных SQL]: #connect-db
  [Подключение с помощью ADO.NET]: #using-sql-server
  [Подключение с помощью ODBC]: #using-ODBC
  [Подключение с помощью поставщика EntityClient]: #using-entity
  [Дальнейшие действия]: #next-steps
  []: http://www.windowsazure.com
  [портал управления Azure]: http://manage.windowsazure.com
  [изображение]: ./media/sql-database-dotnet-how-to-use/SQLDbDashboard.PNG
  [рисунок 2]: ./media/sql-database-dotnet-how-to-use/SQLDBFirewall.PNG
  [рисунок 3]: ./media/sql-database-dotnet-how-to-use/SQLDBIPRange.PNG
  [Поставщик EntityClient для платформы Entity Framework]: http://msdn.microsoft.com/ru-ru/library/bb738561.aspx
  [Разработка в базе данных SQL Azure: инструкции]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee621787.aspx
  [База данных SQL]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee336279.aspx
