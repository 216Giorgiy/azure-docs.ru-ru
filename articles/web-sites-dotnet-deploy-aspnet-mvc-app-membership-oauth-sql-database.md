<properties linkid="dev-net-tutorials-web-app-with-sql-azure-vs2013" urlDisplayName="Веб-сайт с базой данных SQL" pageTitle="Развертывание безопасного приложения ASP.NET MVC с членством, OAuth и базой данных SQL на веб-сайте Windows Azure" metaKeywords="Учебник по приложению hello world для Azure, учебник по началу работы с Azure, учебник по работе с базой данных SQL, учебник по созданию приложения hello world для Azure с использованием .NET, учебник по созданию приложения hello world для Azure на C#, учебник по программированию SQL Azure на C#" description="Узнайте, как разработать веб-сайт ASP.NET MVC 5 с базой данных SQL и выполнить внутреннее развертывание его в Windows Azure." metaCanonical="" services="web-sites,sql-database" documentationCenter=".NET" title=" OAuth" authors=""  solutions="" writer="riande" manager="wpickett" editor="mollybos"  />



# Развертывание безопасного приложения ASP.NET MVC 5 с членством, OAuth и базой данных SQL на веб-сайте Windows Azure

***Авторы: [Рик Андерсон](https://twitter.com/RickAndMSFT) и Том Дайкстра. Обновление: 18 октября 2013 г.***


<div class="dev-center-tutorial-selector sublanding"><a href="/ru-ru/develop/net/tutorials/web-site-with-sql-database/" title="Visual Studio 2013" class="current">Visual Studio 2013</a><a href="/ru-ru/develop/net/tutorials/web-site-with-sql-database-vs2012/" title="Visual Studio 2012">Visual Studio 2012</a></div>

В этом учебнике показано, как создать безопасное веб-приложение ASP.NET MVC 5, которое позволяет пользователям входить в систему с учетными данными из Google или Facebook. Вы узнаете также, как развернуть приложение в Windows Azure.

Можно бесплатно создать учетную запись Windows Azure, а если у вас еще нет Visual Studio 2013, пакет SDK автоматически установит Visual Studio 2013 for Web Express. Вы можете приступить к разработке приложений для Windows Azure совершенно бесплатно. Если вы хотите использовать Visual Studio 2012, см. [предыдущий учебник](/ru-ru/develop/net/tutorials/web-site-with-sql-database-vs2012/). Эта версия учебника гораздо проще, чем предыдущая версия.

Этот учебник разработан для читателей, не имеющих опыта использования платформы Windows Azure. По завершении изучения этого учебника вы создадите безопасное приложение на основе данных, выполняемое в облаке и использующее облачную базу данных.

Вы узнаете:

* Как создать безопасный проект Visual Studio ASP.NET MVC 5 и опубликовать его на веб-сайте Windows Azure.
* Как использовать [OAuth](http://oauth.net/ "http://oauth.net/"), [OpenID](http://openid.net/) и базу данных членства ASP.NET для защиты приложения.
* Как использовать новый API членства для добавления пользователей и ролей.
* Как использовать базу данных SQL для хранения данных в Windows Azure.

Вы создадите простое веб-приложение для списка контактов, основанное на платформе ASP.NET MVC 5 и использующее ADO.NET Entity Framework для доступа к базе данных. На следующем рисунке показана страница входа для готового приложения:

![Страница входа][rxb]

<div class="dev-callout"><p><strong>Примечание.</strong> Для работы с этим учебником необходима учетная запись Windows Azure. Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в разделе <a href="http://www.windowsazure.com/ru-ru/pricing/free-trial/?WT.mc_id=A261C142F" target="_blank">Бесплатное использование Windows Azure</a>.</p></div>


В этом учебнике рассматриваются следующие темы:

- [Настройка среды разработки](#setupdevenv)
- [Настройка среды Windows Azure][setupwindowsazureenv]
- [Создание приложения ASP.NET MVC 5][createapplication]
- [Развертывание приложения в Windows Azure][deployapp1]
- [Добавление базы данных в приложение][adddb]
- [Добавление поставщика OAuth][]
- [Использование API членства][]
- [Развертывание приложения в Windows Azure][deployapp11]
- [Дальнейшие действия][]


[WACOM.INCLUDE [install-sdk-2013-only](../includes/install-sdk-2013-only.md)]


<h2><a name="bkmk_setupwindowsazure"></a>Настройка среды Windows Azure</h2>

Настройте среду Windows Azure, для чего создайте веб-сайт Windows Azure и базу данных SQL.

### Создание веб-сайта и базы данных SQL в Windows Azure

Ваш веб-сайт Windows Azure будет работать в общей среде размещения, а это означает, что он работает на виртуальных машинах, к которым имеют общий доступ другие клиенты Windows Azure. Общая среда размещения — недорогой способ начать работу в облаке. Если позднее ваш веб-трафик увеличится, приложение можно масштабировать по необходимости, запуская его на выделенных виртуальных машинах. Если требуется более сложная архитектура, можно перейти в облачную службу Windows Azure. Облачные службы работают на выделенных виртуальных машинах, которые можно настроить в соответствии с конкретными потребностями.

База данных SQL Windows Azure — это облачная служба реляционной базы данных, построенная на основе технологий SQL Server. Средства и приложения, работающие с SQL Server, работают и с базой данных SQL.

1. На [портале управления Windows Azure](https://manage.windowsazure.com) щелкните **Веб-сайты** на левой вкладке, а затем щелкните **Создать**.

	![Кнопка "Создать" на портале управления][rxWSnew]

1. Щелкните **Веб-сайт**, затем щелкните **Настраиваемое создание**.

	![Ссылка "Создать с базой данных" на портале управления][rxCreateWSwithDB] 

	Откроется мастер **Новый веб-сайт — настраиваемое создание**. 

1. На шаге **Создать веб-сайт** в мастере введите в поле **URL-адрес** строку, которая будет использоваться как уникальный URL-адрес для приложения. Полный URL-адрес будет состоять из введенной здесь строки и суффикса, который отображается рядом с текстовым полем. На рисунке показан URL-адрес, который может быть занят, так что вам нужно будет выбрать другой.

	![Ссылка "Создать с базой данных" на портале управления][rr1]

1. В раскрывающемся списке **База данных** выберите **Создать бесплатную базу данных SQL 20 МБ**.

1. В раскрывающемся списке **Область** выберите ту же область, которую выбрали для веб-сайта.
Этот параметр определяет, в каком центре обработки данных будет работать ваша виртуальная машина. 
1. В поле **Имя строки подключения к базе данных** оставьте значение по умолчанию *DefaultConnection*.
1. Щелкните стрелку, указывающую вправо, в нижней части окна.
Мастер перейдет к шагу **Указать параметры базы данных**.

1. В поле **Имя** введите *ContactDB*. (См. изображение ниже.) 
1. В поле **Сервер** выберите **Создать сервер базы данных SQL**. (См. изображение ниже.) Если же вы ранее создали базу данных SQL Server, можно выбрать в раскрывающемся списке этот SQL Server.
1. Укажите в поле **Область** ту же область, в которой создали веб-сайт.
1. Введите **Имя для входа в систему** и **Пароль** администратора. Если выбрано действие **Создать сервер базы данных SQL**, не используйте здесь существующие имя и пароль, введите новые, которые в дальнейшем будут использоваться при обращении к базе данных. Если выбран созданный ранее SQL Server, появится запрос на ввод пароля для ранее созданной учетной записи SQL Server. В этом учебнике поле **Дополнительно** не отмечается.  Для бесплатной базы данных можно задать только параметры сортировки.
1. Щелкните флажок внизу справа от поля, чтобы указать завершение работы.

	![Шаг настройки базы данных в мастере "Новый веб-сайт — создать с базой данных"][setup007]
	
	На следующем изображении показано использование существующего SQL Server и входа в систему.

	![Шаг настройки базы данных в мастере "Новый веб-сайт — создать с базой данных"][rxPrevDB]

	Портал управления возвращается на страницу веб-сайтов, и в столбце **Состояние** указывается, что веб-сайт создается. Через какое-то время (обычно меньше минуты) в столбце **Состояние** указывается, что сайт успешно создан. В строке навигации слева число сайтов вашей учетной записи отображается рядом со значком **Веб-сайты**, а число баз данных — рядом со значком **Базы данных SQL**.

<h2><a name="bkmk_createmvc4app"></a>Создание приложения ASP.NET MVC 5</h2>

Вы создали веб-сайт Windows Azure, но на нем еще нет контента. Следующим шагом будет создание веб-приложения Visual Studio, которое будет опубликовано в Windows Azure.

### Создание проекта

2. В меню **Файл** выберите **Новый проект**.

   !["Новый проект" в меню "Файл"](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/gs13newproj.png)

3. В диалоговом окне **Новый проект** разверните узел **C#** и выберите **Интернет** в разделе **Установленные шаблоны**, а затем выберите **Веб-приложение ASP.NET**.


4. Присвойте приложению имя **ContactManager** и нажмите кнопку **ОК**.

   ![Диалоговое окно "Новый проект"](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/GS13newprojdb.png)
 
   **Примечание.** На изображении показано имя "MyExample", но вы должны ввести "ContactManager". В блоках кода, которые вы будете копировать позже, предполагается, что проект имеет имя ContactManager. 

5. В диалоговом окне **Новый проект ASP.NET** выберите шаблон **MVC**, а затем щелкните **Изменить аутентификацию**.

   ![Диалоговое окно "Новый проект ASP.NET"](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/GS13changeauth.png)

6. Оставьте **Индивидуальные учетные записи пользователей** по умолчанию в диалоговом окне **Изменить аутентификацию**. 

   В диалоговом окне поясняется, что **Индивидуальные учетные записи пользователей** предназначены для приложений, хранящих профили пользователей в базе данных SQL, в случаях, когда пользователи могут регистрироваться, используя свои учетные записи Facebook, Twitter и Google. Сведения о других вариантах проверки подлинности см. в статье [Создание веб-проектов ASP.NET в Visual Studio 2013 — методы проверки подлинности](http://www.asp.net/visual-studio/overview/2013/creating-web-projects-in-visual-studio#auth)

7. Нажмите кнопку **ОК**.

5. В диалоговом окне **Новый проект ASP.NET** нажмите кнопку **ОК**.

     ![Диалоговое окно "Новый проект ASP.NET"](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/GS13changeauth.png)


### Задание верхнего и нижнего колонтитула страницы


1. В **обозревателе решений** откройте файл *Layout.cshtml* в папке *Views\Shared*.
	![_Layout.cshtml в обозревателе решений][newapp004]
1. Замените два вхождения элемента "Мое приложение ASP.NET MVC" с именем "Contact Manager".
1. Измените "Имя приложения" на "CM Demo". 
2. Обновите первую ссылку "Действие" и измените *Главная* на *Cm*, чтобы использовать контроллер *Cm*.

![Изменения кода](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rs3.png)


### Локальный запуск приложения

1. Для запуска приложения нажмите сочетание клавиш CTRL+F5.

	Главная страница приложения откроется в браузере, используемом по умолчанию.

![Веб-сайт, работающий локально](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rr2.png)

Это все что требуется для создания приложения, которое будет развернуто в Windows Azure. Далее вы добавите функции работы с базой данных.

<h2><a name="bkmk_deploytowindowsazure1"></a>Развертывание приложения в Windows Azure</h2>

5. В Visual Studio щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Опубликовать** в контекстном меню.

   !["Опубликовать" в контекстном меню проекта](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/GS13publish.png)
	
   Откроется мастер **Публикация веб-сайта**.

6. На вкладке **Профиль** мастера **Публикация веб-сайта** щелкните **Импорт**.

   ![Параметры импорта публикации][ImportPublishSettings]

   Появится диалоговое окно **Импорт профиля публикации**.

5. С помощью одного из перечисленных ниже способов разрешите Visual Studio подключаться к вашей учетной записи Windows Azure.

   
	* Щелкните **Вход**, а затем введите учетные данные для учетной записи Windows Azure.

		Этот способ самый быстрый и простой, но при его использовании вы не сможете увидеть базу данных SQL Windows Azure или мобильные службы в окне **Обозреватель сервера**.

	* Щелкните **Управление подписками**, чтобы установить сертификат управления, обеспечивающий доступ к вашей учетной записи.

		В диалоговом окне **Управление подписками Windows Azure** откройте вкладку **Сертификаты**, а затем щелкните **Импорт**. Следуя указаниям, загрузите и импортируйте файл подписки (файл *.publishsettings*) для вашей учетной записи Windows Azure.

		> [WACOM.NOTE]
		> Загрузите файл подписки в папку, не входящую в структуру каталогов с исходным кодом (например, в папку "Загрузки"), а затем удалите его сразу после завершения импорта. Злоумышленник, получивший доступ к файлу подписки, сможет изменять, создавать и удалять ваши службы Windows Azure.

		Дополнительные сведения см. в разделе [Подключение Windows Azure из Visual Studio](http://go.microsoft.com/fwlink/?LinkId=324796).

7. В диалоговом окне **Импорт профиля публикации** выберите ваш веб-сайт в раскрывающемся списке, а затем нажмите кнопку **ОК**.

![Импорт профиля публикации](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rs4.png)

1. В диалоговом окне **публикации веб-сайта** щелкните **Опубликовать**.

	![Опубликовать](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rr3.png)

	Созданное вами приложение теперь выполняется в облаке. При следующем развертывании приложения будут развернуты только измененные (или новые) файлы.

<h2><a name="bkmk_addadatabase"></a>Добавление базы данных в приложение</h2>

Теперь вы обновите приложение MVC, чтобы добавить возможности для отображения и обновления контактов и сохранения данных в базе данных. Приложение будет использовать компонент Entity Framework для создания базы данных, а также чтения и обновления данных в базе данных.

### Добавление классов модели данных для контактов

Начните с создания простой модели данных в коде.

1. В **обозревателе решений** щелкните правой кнопкой мыши папку "Модели" и выберите **Добавить**, а затем щелкните **Класс**.

![Контекстное меню добавления класса в папке "Модели"](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rr5.png)

2. В диалоговом окне **Добавление нового элемента** присвойте новому файлу класса имя *Contact.cs*, затем щелкните **Добавить**.

![Диалоговое окно "Добавление нового элемента"][adddb002]

3. Замените содержимое файла Contacts.cs на код, приведенный ниже.

        using System.ComponentModel.DataAnnotations;
        using System.Globalization;
        namespace ContactManager.Models
        {
            public class Contact
            {
                public int ContactId { get; set; }
                public string Name { get; set; }
                public string Address { get; set; }
                public string City { get; set; }
                public string State { get; set; }
                public string Zip { get; set; }
                [DataType(DataType.EmailAddress)]
                public string Email { get; set; }
            }
        }
Класс **Contacts** определяет данные, которые будут храниться для каждого контакта, а также первичный ключ *ContactID*, необходимый для базы данных.

### Создание веб-страниц, позволяющих пользователям приложений работать с контактами

Компонент формирования шаблонов в ASP.NET MVC может автоматически создавать код, выполняющий операции создания, чтения, обновления и удаления.

<h2><a name="bkmk_addcontroller"></a>Добавление контроллера и представления для данных</h2>

1. Создайте проект **(Ctrl + Shift + B)** (проект необходимо создать перед использованием механизма формирования шаблонов). 
1. В **обозревателе решений** щелкните правой кнопкой мыши папку "Контроллеры" и выберите **Добавить**, а затем щелкните **Контроллер**.

	![Контекстное меню добавления контроллера в папке "Контроллеры"][addcode001]

5. В диалоговом окне **Добавление Scaffold** выберите **Контроллер MVC 5 с представлениями, использующий EF** и щелкните **Добавить**.
	
![Диалоговое окно "Добавление Scaffold"](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rr6.png)

5. В диалоговом окне **Добавление контроллера** введите "CmController" в качестве имени контроллера. (См. изображение ниже.)
1. В раскрывающемся списке **Класс модели** выберите **Contact (ContactManager.Models)**.
1. В поле **Класс контекста данных** выберите **ApplicationDbContext (ContactManager.Models)**. **ApplicationDbContext** будет использоваться и для базы данных членства, и для наших контактных данных.

![Диалоговое окно "Новый контекст данных"](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrCtx.png)

1. Щелкните **Добавить**.

   Visual Studio создает методы и представления контроллера для операций создания, чтения, обновления и удаления в базе данных для объектов **Contact**.

## Включение Migrations, создание базы данных, добавление примера данных и инициализатора данных ##

Следующая задача заключается в активации компонента [Code First Migrations](http://msdn.microsoft.com/library/hh770484.aspx) для создания базы данных на основе созданной модели данных.

1. В меню **Сервис** выберите **Диспетчер пакетов библиотеки**, а затем **Консоль диспетчера пакетов**.
	!["Консоль диспетчера пакетов" в меню "Сервис"][addcode008]
2. В окне **Консоль диспетчера пакетов** введите следующую команду:

		enable-migrations
	Команда **enable-migrations** создает папку *Migrations* и помещает в нее файл *Configuration.cs*, в который можно внести изменения для инициализации базы данных и настройки компонента Migrations. 

2. В окне **Консоль диспетчера пакетов** введите следующую команду:

		add-migration Initial


	Команда **add-migration Initial** создает файл с именем **&lt;date_stamp&gt;Initial** в папке *Migrations*, который создает базу данных. Первый параметр ( **Initial** ) является произвольным и используется для создания имени файла. Новые файлы классов можно просмотреть в **обозревателе решений**.
	В классе **Initial** метод **Up** создает таблицу Contacts, а метод **Down** (применяется, когда требуется вернуться к предыдущему состоянию) удаляет ее.
3. Откройте файл *Migrations\Configuration.cs*. 
4. Добавьте следующее пространство имен. 

    	 using ContactManager.Models;



5. Замените метод *Seed* следующим кодом:

        protected override void Seed(ContactManager.Models.ApplicationDbContext context)
        {
            context.Contacts.AddOrUpdate(p => p.Name,
               new Contact
               {
                   Name = "Debra Garcia",
                   Address = "1234 Main St",
                   City = "Redmond",
                   State = "WA",
                   Zip = "10999",
                   Email = "debra@example.com",
               },
                new Contact
                {
                    Name = "Thorsten Weinrich",
                    Address = "5678 1st Ave W",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "thorsten@example.com",
                },
                new Contact
                {
                    Name = "Yuhong Li",
                    Address = "9012 State st",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "yuhong@example.com",
                },
                new Contact
                {
                    Name = "Jon Orton",
                    Address = "3456 Maple St",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "jon@example.com",
                },
                new Contact
                {
                    Name = "Diliana Alexieva-Bosseva",
                    Address = "7890 2nd Ave E",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "diliana@example.com",
                }
                );
        }

	Этот код инициализирует базу данных с контактной информацией. Дополнительные сведения об инициализации базы данных см. в разделе [Инициализация и отладка баз данных Entity Framework (EF)](http://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx).


6. В окне **Консоль диспетчера пакетов** введите команду:

		update-database

	![Команды консоли диспетчера пакетов][addcode009]

	Команда **update-database** выполняет первую миграцию, при которой создается база данных. По умолчанию база данных создается как база данных LocalDB в SQL Server Express. 

7. Нажмите CTRL + F5 для запуска приложения, а затем щелкните ссылку **CM Demo** или перейдите по адресу http://localhost:(port#)/Cm. 

Приложение показывает начальные данные и предоставляет ссылки для изменения, удаления и просмотра подробных сведений. Можно создавать, изменять, удалять и просматривать данные.

![Представление MVC для данных][rx2]

<h2><a name="addOauth"></a><span class="short-header">OAuth</span>Добавление поставщика OAuth2 и OpenID</h2>

[OAuth](http://oauth.net/ "http://oauth.net/") — это открытый протокол, обеспечивающий безопасную авторизацию простым и стандартным способом из веб-приложений, мобильных и настольных приложений. В интернет-шаблоне ASP.NET MVC используются OAuth и [OpenID](http://openid.net/) для предоставления Facebook, Twitter, Google и Microsoft в качестве поставщиков проверки подлинности. В этом учебнике в качестве поставщика проверки подлинности используется только Google, но вы легко можете изменить код, чтобы использовать любой другой поставщик. Шаги по реализации других поставщиков очень похожи на шаги, представленные в этом учебнике. Сведения об использовании Facebook в качестве поставщика проверки подлинности см. в учебнике [Создание приложения ASP.NET MVC 5 с использованием OAuth2 и OpenID для входа с Facebook и Google](http://www.asp.net/mvc/tutorials/mvc-5/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on)

Помимо проверки подлинности в учебнике будут использоваться роли для реализации авторизации. Только пользователи, добавленные к роли *canEdit*, смогут изменять данные (то есть создавать, править и удалять контакты).

1. Откройте файл *App_Start\Startup.Auth.cs*. Удалите символы комментариев для метода *app.UseGoogleAuthentication()*.

1. Запустите приложение и щелкните ссылку **Вход**. 
1. В разделе **Использовать другую службу для входа** нажмите кнопку **Google**. 
1. Введите учетные данные.
1. Щелкните **Принять**, чтобы разрешить приложению доступ к электронной почте и базовой информации.
1. Вы перейдете на страницу регистрации. При желании можно изменить **Имя пользователя**. Щелкните **Регистрация**.

![Регистрация](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rr8.png)

<h2><a name="mbrDB"></a><span class="short-header">База данных членства</span>с использованием API членства</h2>
В этом разделе в базу данных членства будут добавлены локальный пользователь и роль *canEdit*. Только пользователи, входящие в роль *canEdit*, смогут изменять данные. Рекомендуется именовать роли по выполняемым ими действиям, например имя *canEdit* предпочтительнее имени *admin*. По мере развития приложения можно добавлять новые роли, например роль *canDeleteMembers*, имя которой предпочтительнее, чем менее описательное имя *superAdmin*.

1. Откройте файл *migrations\configuration.cs* и добавьте следующие инструкции "using":

        using Microsoft.AspNet.Identity;
        using Microsoft.AspNet.Identity.EntityFramework;

1. Добавьте в класс следующий метод **AddUserAndRole**:

    
         bool AddUserAndRole(ContactManager.Models.ApplicationDbContext context)
         {
            IdentityResult ir;
            var rm = new RoleManager<IdentityRole>
                (new RoleStore<IdentityRole>(context));
            ir = rm.Create(new IdentityRole("canEdit"));
            var um = new UserManager<ApplicationUser>(
                new UserStore<ApplicationUser>(context));
            var user = new ApplicationUser()
            {
               UserName = "user1",
            };
            ir = um.Create(user, "Passw0rd1");
            if (ir.Succeeded == false)
               return ir.Succeeded;
            ir = um.AddToRole(user.Id, "canEdit");
            return ir.Succeeded;
         }

2. Вызовите новый метод из метода **Seed**:

        protected override void Seed(ContactManager.Models.ApplicationDbContext context)
        {
            AddUserAndRole(context);
            context.Contacts.AddOrUpdate(p => p.Name,
                // Code removed for brevity
        }

   Этот код создает новую роль с именем *canEdit*, создает нового локального пользователя *user1* и добавляет *user1* к роли *canEdit*. 

## Использование временного кода для добавления новых пользователей социальных сетей к роли canEdit  ##
В этом разделе будет временно изменен метод **ExternalLoginConfirmation** в контроллере Account для добавления новых пользователей, регистрирующихся с помощью поставщика OAuth или OpenID, к роли *canEdit*. Мы временно изменим метод **ExternalLoginConfirmation** таким образом, чтобы новые пользователи автоматически добавлялись к роли администратора. Пока нет средств для добавления ролей и управления ими, мы будем использовать приведенный ниже код временной автоматической регистрации. Надеемся в будущем предоставить средство, аналогичное [WSAT](http://msdn.microsoft.com/ru-ru/library/ms228053(v=vs.90).aspx), которое позволит вам создавать и изменять учетные записи пользователей и роли. Далее в этом учебнике я покажу, как можно использовать **обозреватель сервера** для добавления пользователей к ролям.  

1. Откройте файл **Controllers\AccountController.cs** и перейдите к методу **ExternalLoginConfirmation**.
1. Добавьте следующий вызов **AddToRoleAsync** прямо перед вызовом **SignInAsync**:

                await UserManager.AddToRoleAsync(user.Id, "CanEdit");

   Приведенный выше код добавляет вновь зарегистрированного пользователя к роли "CanEdit", которая предоставляет доступ к методам действий, изменяющих данные. Ниже показано изображение изменения кода.

   ![Код](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rr9.png)

Далее в этом учебнике будет развернуто приложение в Windows Azure, благодаря которому можно будет войти с помощью Google или другого стороннего поставщика проверки подлинности. Это добавит вновь зарегистрированную учетную запись к роли *canEdit*. Каждый, кому известен URL-адрес вашего сайта, сможет использовать свой идентификатор Google для регистрации и обновления вашей базы данных. Чтобы предотвратить подобные действия со стороны других лиц, можно остановить сайт. Изучив базу данных, вы сможете проверить, кто входит в роль *canEdit*.

На **консоли диспетчера пакетов** нажмите клавишу со стрелкой вверх, чтобы открыть следующую команду:

		Update-Database

Запустите команду **Update-Database**, которая выполнит метод **Seed** и только что добавленный метод **AddUserAndRole**. Метод **AddUserAndRole** создаст пользователя *user1* и добавит его к роли *canEdit*.

## Защита приложения с помощью SSL и атрибута Authorize ##

В этом разделе будет применен атрибут [Authorize](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.authorizeattribute(v=vs.100).aspx) для ограничения доступа к методам действий. Анонимные пользователи смогут просматривать только метод действия **Индекс** главного контроллера. Зарегистрированные пользователи смогут видеть контактные данные (страницы **Индекс** и **Сведения** контроллера Cm), сведения о программе и страницы связи. Только пользователи, входящие в роль *canEdit*, получат доступ к методам действий, изменяющих данные.

1. Добавьте в приложение фильтры [Authorize](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.authorizeattribute(v=vs.100).aspx) и [RequireHttps](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.requirehttpsattribute(v=vs.108).aspx). В качестве альтернативы можно добавить атрибуты [Authorize](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.authorizeattribute(v=vs.100).aspx) и [RequireHttps](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.requirehttpsattribute(v=vs.108).aspx) для каждого контроллера, но с точки зрения безопасности рекомендуется применять их ко всему приложению. В случае глобального добавления атрибутов каждый новый контроллер и метод действия будет защищен автоматически, вам не потребуется помнить о необходимости их применения. Дополнительные сведения см. в разделе [Защита приложений ASP.NET MVC и новый атрибут AllowAnonymous](http://blogs.msdn.com/b/rickandy/archive/2012/03/23/securing-your-asp-net-mvc-4-app-and-the-new-allowanonymous-attribute.aspx) Откройте файл *App_Start\FilterConfig.cs* и замените метод *RegisterGlobalFilters* следующим кодом (который добавляет два фильтра):

        public static void
        RegisterGlobalFilters(GlobalFilterCollection filters)
        {
            filters.Add(new HandleErrorAttribute());
            filters.Add(new System.Web.Mvc.AuthorizeAttribute());
            filters.Add(new RequireHttpsAttribute());
        }

   Фильтр [Authorize](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.authorizeattribute(v=vs.100).aspx), применяемый приведенным выше кодом, не позволит анонимным пользователям получить доступ к методам в приложении. С помощью атрибута [AllowAnonymous](http://blogs.msdn.com/b/rickandy/archive/2012/03/23/securing-your-asp-net-mvc-4-app-and-the-new-allowanonymous-attribute.aspx) вы сможете отказаться от обязательной авторизации в соответствующих методах, чтобы анонимные пользователи могли входить в систему и просматривать главную страницу. Фильтр [RequireHttps](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.requirehttpsattribute(v=vs.108).aspx) будет требовать использования HTTPS для доступа к веб-приложению.

1. Добавьте атрибут [AllowAnonymous](http://blogs.msdn.com/b/rickandy/archive/2012/03/23/securing-your-asp-net-mvc-4-app-and-the-new-allowanonymous-attribute.aspx) в метод **Index** контроллера Home. С помощью атрибута [AllowAnonymous](http://blogs.msdn.com/b/rickandy/archive/2012/03/23/securing-your-asp-net-mvc-4-app-and-the-new-allowanonymous-attribute.aspx) можно создать белый список методов, для которых не нужна авторизация. Ниже показана часть контроллера HomeController:	

         namespace ContactManager.Controllers
         {
            public class HomeController : Controller
            {
               [AllowAnonymous]
               public ActionResult Index()
               {
                  return View();
               }

2. Выполнив глобальный поиск для атрибута *AllowAnonymous*, вы увидите, что он используется в методах входа и регистрации контроллера Account.
1. В файле *CmController.cs* добавьте "[Authorize(Roles = "canEdit")]` в методы HttpGet и HttpPost, которые изменяют данные (Create, Edit, Delete, каждый метод действия, кроме Index и Details) в контроллере *Cm*. Ниже показана часть готового кода. 

   ![Изображение кода](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rr11.png)

## Включение SSL для проекта ##

1. Включение SSL. В обозревателе решений щелкните проект **ContactManager**, а затем нажмите F4, чтобы открыть диалоговое окно свойств. Для параметра **SSL включен** измените значение на "true". Скопируйте **URL-адрес SSL**. Если вы ранее не создали веб-сайты SSL, URL-адрес будет https://localhost:44300/.

	![Включение SSL][rxSSL]
 
1. В обозревателе решений щелкните правой кнопкой мыши проект **Contact Manager**, затем щелкните **Свойства**.
1. На левой вкладке щелкните **Интернет**.
1. Измените **URL-адрес проекта** на **URL-адрес SSL** и сохраните страницу (Ctrl + S).

	![Включение SSL](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrr1.png)
 
1. Для запуска приложения нажмите сочетание клавиш CTRL + F5. Откроется браузер с предупреждением о сертификате. Для нашего приложения можно безопасно щелкнуть ссылку **Перейти на этот веб-сайт**. 
 
	![Предупреждение о сертификате][rxNOT]


	![Предупреждение о сертификате][rxNOT2]
 
   В браузере по умолчанию отображается страница **Индекс** контроллера HomeController. 

1. Если вы все еще не вышли из предыдущего сеанса, нажмите ссылку **Выход**.
1. Щелкните ссылку **О программе** или **Связь**. Вы перейдете на страницу входа, поскольку анонимные пользователи не могут просматривать эти страницы. 
1. Щелкните ссылку **Регистрация** и добавьте локального пользователя с именем *Joe*. Проверьте, может ли *Joe* просматривать главную страницу, страницу сведений о программе и страницу связи. 
1. Щелкните ссылку *CM Demo* и убедитесь, что видите данные. 
1. Щелкнув ссылку "Изменить" на странице, вы перейдете на страницу входа (поскольку новый локальный пользователь не добавляется к роли *canEdit*).
1. Войдите в систему с именем пользователя *user1* и паролем "Passw0rd1" (где "0" — это ноль). Вы перейдете на ранее выбранную страницу изменения. 

   Если не получается войти в систему с этой учетной записью и этим паролем, попробуйте скопировать пароль из исходного кода и вставить его. Если войти по-прежнему не удается, проверьте в таблице **AspNetUsers**, добавлен ли пользователь *user1*. Далее в этом учебнике я покажу, как проверить таблицу **AspNetUsers**.
1. Убедитесь, что можете изменять данные.

<h2><a name="bkmk_deploytowindowsazure11"></a>Развертывание приложения в Windows Azure</h2>

1. Создайте приложение.
1. В Visual Studio щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Опубликовать** в контекстном меню.

	!["Опубликовать" в контекстном меню проекта][firsdeploy003]

Откроется мастер **Публикация веб-сайта**.

1. Перейдите на вкладку **Параметры**. Щелкните значок **v**, чтобы выбрать параметр **Строка удаленного подключения** для **ApplicationDbContext**, затем выберите **ContactDB**.

   (Если закрыть и снова открыть Visual Studio после создания профиля публикации, вы можете не увидеть строку подключения в раскрывающемся списке. В этом случае не изменяйте ранее созданный профиль публикации, а точно таким же способом создайте новый, а затем выполните следующие шаги на вкладке **Параметры**.)

	![Параметры](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrc2.png)

1. В разделе **ContactManagerContext** выберите **Выполнить Code First Migrations**.

![Параметры](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrc3.png)

1. Щелкните **Опубликовать**.

1. Войдите в систему как *user1* и проверьте, можете ли вы изменить данные.

1. Выйдите из системы.

2. Войдите с помощью Google или Facebook. При этом учетная запись Google или Facebook добавится к роли **canEdit**.

### Остановка веб-сайта для предотвращения регистрации других пользователей  

1. В **Обозревателе сервера** перейдите к элементу **Веб-сайты**.
4. Щелкните правой кнопкой мыши каждый экземпляр веб-сайта и выберите **Остановить веб-сайт**. 

	![Остановка веб-сайта](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrr2.png) 

Можно также выбрать веб-сайт на портале управления Windows Azure, а затем щелкнуть значок **Остановить** в нижней части страницы.

![Остановка веб-сайта](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrr3.png)

### Удаление AddToRoleAsync, публикация и тестирование

1. Удалите следующий код из метода **ExternalLoginConfirmation** контроллера Account: 
                `await UserManager.AddToRoleAsync(user.Id, "CanEdit");`
1. Создайте проект (который сохраняет изменения файла и проверяет, нет ли ошибок компиляции).
5. Щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Опубликовать**.

	   !["Опубликовать" в контекстном меню проекта](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/GS13publish.png)
	
4. Нажмите кнопку **Начало предварительного просмотра**. Развертываются только файлы, которые необходимо обновить.
5. Запустите веб-сайт. Проще всего сделать это с портала. **Когда веб-сайт остановлен, публикация невозможна**.
5. Вернитесь в Visual Studio и щелкните **Опубликовать**.
3. Приложение Windows Azure открывается в браузере по умолчанию. Как анонимный пользователь вы видите главную страницу.  
4. Щелкните ссылку **О программе**. Вы перейдете на страницу входа.
5. Щелкните ссылку **Регистрация** на странице входа и создайте локальную учетную запись. С помощью этой локальной учетной записи мы убедимся, что вы имеете доступ к страницам, предназначенным только для чтения, но не имеете доступа к страницам, где изменяются данные (которые защищены ролью *canEdit*). Далее в этом учебнике мы удалим доступ локальной учетной записи. 
<!--
1. Log out of the local user account and log in with the Google account you previously registered with. Verify you can edit data. 
-->

![Выход из системы](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrr6.png)

1. Проверьте, можете ли вы перейти на страницы *О программе* и *Связь*.

![Выход из системы](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrr7.png)

1. Щелкните ссылку **CM Demo** для перехода к контроллеру **Cm**. Можно также добавить *Cm* в URL-адрес. 

![Страница CM](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrr4.png)
 
1. Щелкните ссылку "Изменить". Вы перейдете на страницу входа. В разделе **Использовать другую службу для входа** щелкните Google или Facebook и войдите с использованием ранее зарегистрированной учетной записи.
2. Убедитесь, что можете изменять данные при входе с этой учетной записью.
 	**Примечание.** С помощью этого приложения вы не можете выйти из Google и войти в другую учетную запись Google в том же браузере. Если используется один браузер, необходимо перейти в Google и выйти из системы. Используя другой браузер, вы можете войти с другой учетной записью из того же стороннего приложения проверки подлинности (например, Google).


## Проверка базы данных SQL Azure ##

1. В **Обозревателе сервера** перейдите к элементу **ContactDB**.
2. Щелкните правой кнопкой мыши **ContactDB** и выберите **Открыть в обозревателе объектов SQL Server**.
 
![Открытие в SSOX](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrr12.png)

 
**Примечание.** Если не получается развернуть элемент **Базы данных SQL** и *не удается* увидеть элемент **ContactDB** в Visual Studio, необходимо выполнить приведенные ниже инструкции, чтобы открыть порт или диапазон портов брандмауэра. Выполните инструкции из разделов **Добавление диапазона разрешенных IP-адресов** и **Подключение к базе данных SQL Azure из SSOX**. Возможно, после добавления правила брандмауэра потребуется подождать несколько минут, чтобы получить доступ к базе данных.
 
1. Щелкните правой кнопкой мыши таблицу **AspNetUsers** и выберите **Просмотр данных**.

![Страница CM](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrr8.png)
 
1. Запишите или запомните идентификатор учетной записи Google, с которой вы зарегистрировались, чтобы попасть в роль **canEdit**, а также идентификатор пользователя *user1*. Только эти пользователи должны входить в роль **canEdit**. (Вы проверите это на следующем шаге.)

![Страница CM](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rrr9.png)
 
2. В **обозревателе объектов SQL Server** щелкните правой кнопкой мыши элемент **AspNetUserRoles** и выберите **Просмотр данных**.

![Страница CM](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rs1.png)
 
Убедитесь, что идентификаторы **UserId** принадлежат пользователю *user1* и используемой для регистрации учетной записи Google. 


## Ошибка входа: не удается открыть сервер ##

Выполните шаги, описанные в этом разделе, только если появляется диалоговое окно с ошибкой "Не удается открыть сервер".
	![Ошибка брандмауэра][rx5]

Потребуется добавить ваш IP-адрес к разрешенным IP-адресам.

1. На портале Windows Azure выберите **Базы данных SQL** на левой вкладке.
	![Выбор SQL][rx6]

1. Выберите базу данных, которую нужно открыть.
1. Щелкните ссылку **Настроить правила брандмауэра Windows Azure для этого IP-адреса**.

	![Правила брандмауэра][rx7]

1. При появлении запроса "Текущий IP-адрес xxx.xxx.xxx.xxx не включен в существующие правила брандмауэра. Обновить правила?" щелкните **Да**. Добавления этого адреса за некоторыми корпоративными брандмауэрами часто бывает недостаточно, поэтому вам потребуется добавить диапазон IP-адресов.

Следующим шагом является добавление диапазона разрешенных IP-адресов.

1. На портале Windows Azure щелкните **Базы данных SQL**.
1. Щелкните **Сервер**, на котором размещается ваша база данных.

	![Сервер базы данных][rx8]

1. Щелкните ссылку **Настроить** в верхней части страницы.
1. Добавьте имя правила, начальный и конечный IP-адреса.

	![Диапазон IP-адресов][rx9]

1. В нижней части страницы щелкните **Сохранить**.
1. Пожалуйста, оставьте отзыв и сообщите мне, если вам требуется добавить диапазон IP-адресов для подключения.

Наконец, можно подключиться к экземпляру базы данных SQL из SSOX

1. В меню "Просмотр" выберите **обозреватель объектов SQL Server**.
1. Щелкните правой кнопкой мыши **SQL Server** и выберите **Добавить SQL Server**.
1. В диалоговом окне **Подключиться к серверу** задайте для параметра **Аутентификация** значение **Аутентификация SQL Server**. Значения **Имя сервера** и **Вход** вы получите с портала Windows Azure.
1. В браузере перейдите на портал и выберите **Базы данных SQL**.
1. Выберите **ContactDB**, затем щелкните **Просмотреть строки подключения базы данных SQL**.
1. На странице **Строки подключения** скопируйте значения **Сервер** и **ИД пользователя**. 
1. Вставьте значения **Сервер** и **ИД пользователя** в диалоговое окно **Подключение к серверу** в Visual Studio. Значение **ИД пользователя** переходит в поле **Вход**. Введите пароль, который использовался для создания базы данных SQL.

![Диалоговое окно "Подключиться к серверу"](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rss1.png)

Теперь можно перейти к базе данных Contact DB, следуя приведенным ранее инструкциям.


## Добавление пользователя к роли canEdit путем изменения таблиц базы данных

Ранее в этом учебнике вы использовали код для добавления пользователей к роли canEdit. Альтернативой является непосредственное изменение данных в таблицах членства. В следующих шагах показано, как использовать этот альтернативный метод для добавления пользователя к роли.

2. В **обозревателе объектов SQL Server** щелкните правой кнопкой мыши элемент **AspNetUserRoles** и выберите **Просмотр данных**.

![Страница CM](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rs1.png)

1. Скопируйте идентификатор *RoleId* и вставьте его в пустую (новую) строку.
	
![Страница CM](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rs2.png)
	
2. В таблице **AspNetUsers** найдите пользователя, которого нужно добавить к роли, затем скопируйте *Id* пользователя и вставьте его в столбец **UserId** таблицы **AspNetUserRoles**.

Мы работаем над средством, которое позволит значительно упростить управление пользователями и ролями.

## Вопросы локальной регистрации ##

При текущей регистрации членства ASP.NET в проекте не поддерживается сброс паролей и не проверяется, человек ли регистрируется (например с помощью запроса [CAPTCHA](http://www.asp.net/web-pages/tutorials/security/16-adding-security-and-membership)). Пользователь, прошедший проверку подлинности с использованием одного из сторонних поставщиков, может зарегистрироваться. Если вы решите отключить локальную регистрацию, выполните следующие шаги:


1. В контроллере AccountController удалите атрибут *[AllowAnonymous]* из методов GET и POST для действия *Регистрация*. Это не позволит регистрироваться программам-роботам и анонимным пользователям.
1. В папке *Views\Shared* в файле *_LoginPartial.cshtml* удалите ссылку на действие "Регистрация".
2. В файле *Views\Account\Login.cshtml* удалите ссылку на действие "Регистрация".
2. Разверните приложение.


<h2><a name="nextsteps"></a><span class="short-header">Дальнейшие действия</span>Дальнейшие действия</h2>

Инструкции по добавлению данных профиля в базу данных регистрации пользователей и подробные инструкции по использованию Facebook в качестве поставщика проверки подлинности приведены в моем учебнике [Создание приложения ASP.NET MVC 5 с использованием OAuth2 и OpenID для входа с Facebook и Google](http://www.asp.net/mvc/tutorials/mvc-5/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on ).


Дополнительные сведения об ASP.NET MVC можно найти в учебнике [Начало работы с ASP.NET MVC 5](http://www.asp.net/mvc/tutorials/mvc-5/introduction/getting-started). В отличном учебнике Тома Дайкстра [Начало работы с EF и MVC](http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application) показаны более сложные методы программирования EF.

Этот учебник и образец приложения создал [Rick Anderson](http://blogs.msdn.com/b/rickandy/) (Twitter [@RickAndMSFT](https://twitter.com/RickAndMSFT)) при поддержке Тома Дайкстра и Барри Доррэнса (Twitter [@blowdart](https://twitter.com/blowdart)). 

Пожалуйста, оставьте отзыв о том, что вам понравилось или что вы хотели бы улучшить, не только о самом учебнике, но и о продуктах, которые он демонстрирует. Ваши отзывы помогут нам определить, какие улучшения наиболее приоритетны. 

<!--
To get the colorful Facebook, Google and Yahoo log on buttons, see the blog post [Customizing External Login Buttons in ASP.NET MVC 5](http://www.beabigrockstar.com/customizing-external-login-buttons-in-asp-net-mvc-4/). 
 -->
<!-- bookmarks -->
[Добавление поставщика OAuth]: #addOauth
[Использование API членства]:#mbrDB
[Создание скрипта развертывания данных]:#ppd
[Обновление базы данных членства]:#ppd2

[setupwindowsazureenv]: #bkmk_setupwindowsazure
[createapplication]: #bkmk_createmvc4app
[deployapp1]: #bkmk_deploytowindowsazure1
[deployapp11]: #bkmk_deploytowindowsazure11
[adddb]: #bkmk_addadatabase




<!-- links -->






















<!-- links from Tom's hopefully no collisions -->





















<!-- images-->

[rx2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rx2.png





















[rx5]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rx5.png
[rx6]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rx6.png
[rx7]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rx7.png
[rx8]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rx8.png
[rx9]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rx9.png

[rxb]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rxb.png



[rxSSL]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rxSSL.png

[rxNOT]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rxNOT.png
[rxNOT2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rxNOT2.png

[rxNOT]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rxNOT.png
[rxNOT]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rxNOT.png
[rxNOT]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rxNOT.png
[rr1]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rr1.png


[rxPrevDB]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rxPrevDB.png











[rxWSnew]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rxWSnew2.png
[rxCreateWSwithDB]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/rxCreateWSwithDB.png

[setup007]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/dntutmobile-setup-azure-site-004.png





[newapp004]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/dntutmobile-createapp-004.png





[firsdeploy003]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/dntutmobile-deploy1-publish-001.png







[adddb002]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/dntutmobile-adddatabase-002.png
[addcode001]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/dntutmobile-controller-add-context-menu.png








[addcode008]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/dntutmobile-migrations-package-manager-menu.png
[addcode009]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/dntutmobile-migrations-package-manager-console.png









[Важные сведения об ASP.NET и веб-сайтах Windows Azure]: #aspnetwindowsazureinfo
[Следующие шаги]: #nextsteps



[ImportPublishSettings]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2013/ImportPublishSettings.png
























