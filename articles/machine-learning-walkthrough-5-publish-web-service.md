<properties 
	pageTitle="Шаг 5. Публикация веб-службы машинного обучения | Azure" 
	description="Шаг 5 пошагового руководства решения. Публикация эксперимента по оценке в Студии машинного обучения Azure как веб-службы машинного обучения Azure" 
	services="machine-learning" 
	documentationCenter="" 
	authors="garyericson" 
	manager="paulettm" 
	editor="cgronlun"/>

<tags 
	ms.service="machine-learning" 
	ms.workload="data-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/29/2015" 
	ms.author="garye"/>


Это пятый этап описания [Разработка решения прогнозирования с помощью Azure ML][develop]:

[develop]: ../machine-learning-walkthrough-develop-predictive-solution/


1.	[Создание рабочей области ML][create-workspace]
2.	[Отправка существующих данных][upload-data]
3.	[Создание эксперимента][create-new]
4.	[Подготовка и оценка моделей][train-models]
5.	**Публикация веб-службы**
6.	[Доступ к веб-службе][access-ws]

[create-workspace]: ../machine-learning-walkthrough-1-create-ml-workspace/
[upload-data]: ../machine-learning-walkthrough-2-upload-data/
[create-new]: ../machine-learning-walkthrough-3-create-new-experiment/
[train-models]: ../machine-learning-walkthrough-4-train-and-evaluate-models/
[publish]: ../machine-learning-walkthrough-5-publish-web-service/
[access-ws]: ../machine-learning-walkthrough-6-access-web-service/

----------

# Шаг 5: Публикация веб-сервиса машинного обучения Azure

Чтобы эту модель прогнозирования могли использовать другие пользователи, мы опубликуем ее как веб-сервис на Azure. Пользователь сможет отправлять сервису набор данных по заявке на кредит, а сервис будет возвращать прогноз рисков по кредиту.  

Для этого необходимо выполнить следующие действия:  

-	подготовить эксперимент для публикации;
-	опубликовать его на промежуточном сервере, где можно его тестировать;
-	после того, как мы решим, что эксперимент готов, внедрить его на рабочем сервере.  

Прежде чем продолжать, следует создать копию этого эксперимента для редактирования. Это позволит нам вернуться к обучающему эксперименту в любое время, как только возникнет необходимость продолжить работу над моделями.  

1.	Нажмите кнопку **Сохранить как** под полотном.
2.	Дайте копии эксперимента осмысленное имя. По умолчанию к исходному имени эксперимента добавляется "- Copy". Назовем эксперимент "Credit Risk Prediction - Scoring Experiment" ("Прогноз кредитных рисков - эксперимент для оценки").
3.	Нажмите кнопку **ОК**.  


Теперь в списке экспериментов Студии машинного обучения Microsoft Azure можно видеть как исходный эксперимент, так и его копию.  

![Experiments list][1]
 
##Подготовка эксперимента для оценки
Чтобы подготовить модель к публикации в качестве веб-службы, необходимо выполнить два действия.  

Сначала надо преобразовать эксперимент из *обучающего эксперимента* в *эксперимент для оценки*. Вплоть до этого момента мы экспериментировали с обучением нашей модели. Но опубликованная служба больше не будет выполнять обучение - она будет оценивать данные, введенные пользователем. Сохраним копию обученной модели и устраним все компоненты нашего эксперимента, относящиеся к обучению.  

Во-вторых, веб-служба машинного обучения Azure будет принимать входные данные от пользователя и возвращать результат, поэтому нужно идентифицировать точки ввода и вывода в нашем эксперименте.  

###Преобразование эксперимента для обучения в эксперимент для оценки
Допустим, мы решили, что нам лучше подходит модель ускоренного дерева. Первым делом надо удалить обучающие модули SVM.  

1.	Удалите **вспомогательную двухклассовую векторную машину**
2.	Удалите подключенные к ней модули **Тренировочная модель** и "Модель оценки"
3.	Удалите модуль **Преобразование данных масштабированием** module  

Теперь сохраним обученную нами модель ускоренного дерева. Затем мы сможем удалить оставшиеся модули эксперимента, использованного нами для обучения, и заменить их обученной моделью.  

1.	Щелкните правой кнопкой мыши выходной порт оставшегося модуля**Тренировочная модель** и выберите **Сохранить как тренировочную модель**.
2.	Введите имя и описание обученной модели. В данном примере назовем ее "Прогноз кредитного риска".

	>**Примечание**. Когда мы сохраним эту обученную модель, она появится в палитре модулей и станет доступна для использования в других экспериментах.

3.	Найдите эту модель, напечатав слова "кредитного риска" в поле **Поиск**, а затем перетащите мышью обученную модель **Прогноз кредитного риска** на полотно экспериментов.
4.	Удалите дерево **двухклассового ускоренного решения** и модули **тренировочной модели**.
5.	Подключите выход модели **Прогноз кредитного риска** к левому входу модуля **Модель для оценки**.   

Теперь у нас в эксперименте имеется сохраненная обученная версия модели вместо исходных модулей обучения.  

В эксперименте есть и другие компоненты, добавленные исключительно для обучения и оценки работы нашего двухмодельного алгоритма. Можно удалить и их:  

-	**Разделение**
-	Оба модуля **Execute R Script**
-	**Анализ модели**  

И еще... В исходных данных кредитной карты был столбец "Кредитный риск". Мы передали этот столбец в модуль **обучения модели**, чтобы он мог обучать модель для прогнозирования значений кредитного риска. Но теперь, когда модель обучена, нам не нужно больше передавать этот столбец - обученная модель будет прогнозировать это значение. Чтобы удалить этот столбец из потока данных, используем модуль **Столбец проекта**.  

1.	Найдите и перетащите на полотно модуль **Столбец проекта**.
2.	Подключите этот модуль к выводу модуля **Редактор метаданных** (модули **Разделение** и **Execute R Script** к этому моменту уже удалены)
3.	Выберите модуль **Столбцы проекта** и щелкните **Запустить выбор столбцов**.
4.	В раскрывающемся списке оставьте выбранным значение "Все столбцы".
5.	Нажмите знак "плюс" (+), чтобы создать новую строку раскрывающегося списка.
6.	В этом новом раскрывающемся списке выберите "Исключить названия столбцов" и введите "Кредитный риск" в текстовом поле (можно также указать этот столбец по его номеру 21).
7.	Нажмите кнопку **ОК**.

	>Подсказка: выбор столбцов следует логике выпадающих списков в той последовательности, в которой они появляются. В данном случае мы указали модулю **Столбцы проекта** проходить по всем столбцам, кроме столбца "Кредитный риск". Если бы мы исключили первый выпадающий список, то модуль не обработал бы ни одного столбца.

8.	Подключите вывод модуля **Столбцы проектов** к правому вводу модуля **Модель для оценки**.  

Теперь наш эксперимент должен выглядеть следующим образом:  

![Scoring the trained model][2]  

###Выбор ввода и вывода службы
В изначальной модели оцениваемые данные передавались в правый входной порт ("Набор данных") модуля **Модель для оценки**, а результат появлялся в выходном порту ("Оцененный набор данных"). При запуске этой службы данные пользователя и результаты должны использоваться теми же самыми портами.  

1.	Щелкните правой кнопкой правый входной порт модуля **Модель для оценки** и выберите **Установить как вход для публикации**. В пользовательские данные должны будут входить все данные вектора свойств.

	>**Подсказка**: если нужно выполнить какую-либо манипуляцию над данными пользователя до передачи их в модуль для оценки (например, как в данном случае, когда мы использовали модуль **Преобразование данных масштабированием** для подготовки данных для SVM-модели), оставьте модуль в веб-службе и установите вход службы на входной порт этого модуля.

2.	Щелкните выходной порт правой кнопкой мыши и выберите **Установить как выход для публикации**. Вывод модуля оценки модели будет возвращаться этой службой. Он включает в себя вектор свойств, а также прогноз кредитного риска и оценочное значение вероятности.

	>**Подсказка**: если веб-служба должна возвращать лишь часть этих данных (например, не нужно возвращать весь вектор свойств), то можно добавить модуль **Столбцы проекта** после модуля **Модель для оценки** и настроить его так, чтобы исключить ненужные столбцы, а затем установить выход модуля **Столбцы проекта** на выход веб-службы.  
  

>**Примечание.** Возможно, вас удивляет, почему мы оставили набор данных UCI German Credit Card Data и связанные с ним модули подключенными к модулю **оценки модели**. Служба будет использовать данные пользователя, а не изначальный набор данных - так зачем оставлять их неподключенными?

Да, службе не требуются изначальные данные о кредитной карте. Но по-прежнему нужна схема для этих данных, включающая такие сведения, как общее число столбцов, а также какие столбцы являются числовыми. Эти данные схемы необходимы для интерпретации пользовательских данных. Мы оставили эти компоненты подключенными, чтобы модуль оценки имел схему набора данных при запуске службы. Сами данные не используются, используется лишь схема.  

Запустите эксперимент в последний раз (щелкните **ЗАПУСК**). Чтобы проверить, что модуль по-прежнему работает, щелкните правой кнопкой мыши вывод модуля **Оценка модели** и выберите команду **Визуализировать**. Вы увидите, что изначальные данные отображаются вместе со значением кредитного риска ("Расчетные метки") и оценочным значением вероятности ("Расчетные вероятности").  

##Публикация веб-службы
Чтобы опубликовать веб-службу, унаследованную от данного эксперимента, щелкните **ПУБЛИКАЦИЯ ВЕБ-СЛУЖБЫ** под полотном и выберите вариант ответа **ДА**. ML Studio опубликует эксперимент как веб-службу на промежуточном сервере ML и откроет  панель мониторинга службы.   

>**Совет.** После публикации веб-службы ее можно обновить. Например, если требуется изменить модель, просто измените эксперимент для обучения, сохраненный ранее, отладьте параметры модели и сохраните обученную модель (перезаписав ту, которая была сохранена ранее). При следующем открытии эксперимента для оценки появится уведомление, сообщающее о том, что кое-что было изменено (в данном случае это ваша обученная модель), и вы можете обновить эксперимент. При повторной публикации эксперимента он заменит веб-службу, используя на этот раз обновленную модель.  

Службу можно настроить, открыв вкладку **КОНФИГУРАЦИЯ**. На этой вкладке можно изменить имя службы (по умолчанию она получает имя эксперимента) и предоставить ее описание. Можно также задать более удобочитаемые названия для входных и выходных столбцов.  

Переключатель **ГОТОВ К ПРОИЗВОДСТВУ?** будет рассмотрен позднее.  

##Тестирование веб-службы
На странице **ПАНЕЛЬ МОНИТОРИНГА** щелкните ссылку **Тестирование** в разделе **Промежуточные службы**. Появится диалоговое окно, предлагающее ввести входные данные для службы. Это те же столбцы, которые были в изначальном наборе данных по кредитным рискам для немецкого языка.  

Введите набор данных и щелкните **OK**.  

Результаты, созданные веб-службой, отображаются в нижней части панели мониторинга. Заданная конфигурация службы привела к тому, что результаты сгенерированы модулем оценки.   

##Продвижение веб-службы на рабочий сервер
Пока что служба работает на промежуточном сервере ML. Когда все будет готово для ее запуска в активном режиме, можно подать запрос на повышение службы до активного сервера.  

На вкладке **КОНФИГУРАЦИЯ** выберите вариант "ДА" рядом с вопросом **ГОТОВ К ПРОИЗВОДСТВУ?** ИТ-администратору будет отправлено уведомление, что эта веб-служба готова к использованию конечными пользователями. Тогда администратор сможет повысить службу до активного сервера.

![Promoting the service to the live environment][3]  

----------

**Далее: [Доступ к веб-службе][access-ws]**

[1]: ./media/machine-learning-walkthrough-5-publish-web-service/publish1.png
[2]: ./media/machine-learning-walkthrough-5-publish-web-service/publish2.png
[3]: ./media/machine-learning-walkthrough-5-publish-web-service/publish3.png

<!--HONumber=46--> 
