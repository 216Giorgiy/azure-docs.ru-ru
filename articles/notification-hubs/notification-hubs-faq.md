<properties
	pageTitle="Концентраторы уведомлений Azure — часто задаваемые вопросы"
	description="Часто задаваемые вопросы по разработке и реализации решений в концентраторах уведомлений"
	services="notification-hubs"
	documentationCenter="mobile"
	authors="wesmc7777"
	manager="dwrede"
	editor="" />

<tags
	ms.service="notification-hubs"
	ms.workload="mobile"
	ms.tgt_pltfrm="mobile-multiple"
	ms.devlang="multiple"
	ms.topic="article"
	ms.date="11/25/2015" 
	ms.author="wesmc" />

#Концентраторы уведомлений Azure — часто задаваемые вопросы

##Общие сведения
###1\. Как определяется цена на концентраторы уведомлений?
Доступно три уровня центров уведомлений: *Free*, *Basic* и *Standard*. Дополнительную информацию см. в статье [Цены на центры уведомлений]. Оплата взимается на уровне подписки. Она зависит от количества отправляемых push-уведомлений, поэтому не имеет значения, сколько у вас пространств имен или концентраторов уведомлений. Уровень Free предоставляется для целей разработки без каких-либо гарантий, предусмотренных соглашением об уровне обслуживания. Уровни Basic и Standard предназначены для использования в рабочей среде. Уровень Standard предоставляет следующие основные возможности:

- *Рассылка*. На уровне Basic ограничено количество тегов центра уведомлений до 3000 (при наличии > 5 устройств). Если размер вашей аудитории превышает 3000, вам следует перейти на уровень Standard.
- *Расширенные возможности телеметрии*. На уровне Basic нельзя экспортировать данные телеметрии и регистрации. Если вам требуется возможность экспорта данных телеметрии для автономного просмотра и анализа, перейдите на уровень Standard.
- *Мультитенантность*. При создании мобильного приложения, поддерживающего несколько клиентов, с помощью центра уведомлений следует рассмотреть возможность перехода на уровень Standard. Он позволяет задать учетные данные службы push-уведомлений (PNS) на уровне пространства имен концентратора уведомлений для приложения, а затем разделить клиентов, предоставляя им отдельные концентраторы под этим общим пространством имен. Это упрощает обслуживание, позволяя хранить ключи SAS для отправки и получения уведомлений из концентраторов уведомлений, выделенных для каждого клиента, что, в свою очередь, предотвращает их перекрытие.

###2\. Что предусмотрено в соглашении об уровне обслуживания?
Для уровней концентратора уведомлений Basic и Standard мы гарантируем, что как минимум 99,9 % времени правильно настроенные приложения смогут отправлять уведомления и выполнять операции управления регистрацией через концентратор уведомлений, развернутый на уровне Basic или Standard. Дополнительную информацию о соглашении об уровне обслуживания см. на странице [Соглашения об уровне обслуживания]. Обратите внимание, что в соглашении об уровне обслуживания нет гарантий касательно участка между службой уведомлений платформы и устройством, так как доставка уведомления на устройство из концентратора уведомлений зависит от внешних поставщиков платформы.

###3\. Какие клиенты используют концентраторы уведомлений
Наши концентраторы уведомлений использует множество клиентов. Ниже приведены самые главные из них:

* Sochi 2014 — сотни групп интересов, более 3 миллионов устройств, более 150 миллионов уведомлений, отправленных за 2 недели. [Анализ примера — Sochi]
* Skanska — [Анализ примера — Skanska]
* Seattle Times — [Анализ примера — Seattle Times]
* Mural.ly — [Анализ примера — Mural.ly]
* 7Digital — [Анализ примера — 7Digital]
* Приложения Bing — десятки миллионов устройств, отправляющих 3 миллиона уведомлений ежедневно.

###4\. Как повысить или понизить уровень моих концентраторов уведомлений для изменения уровня служб?
Перейдите на [портал Azure], щелкните "Служебная шина", а затем выберите пространство имен и концентратор уведомлений. На вкладке "Масштаб" можно изменить уровень служб концентраторов уведомлений.

##Проектирование и разработка
###1\. Какие платформы на стороне служб вы поддерживаете?
Мы предоставляем пакеты SDK и образцы для .NET, Java, PHP, Python и Node.js, чтобы можно было настроить серверную часть приложения для взаимодействия с концентраторами уведомлений с помощью любой из этих платформ. Интерфейсы API концентраторов уведомлений основаны на интерфейсе REST, поэтому вы можете взаимодействовать непосредственно с ними. Дополнительную информацию см. в разделе [Использование API REST для концентраторов уведомлений].

###2\. Какие аппаратные платформы вы поддерживаете?
Мы поддерживаем отправку уведомлений на платформы Apple iOS, Android, Windows Universal и Windows Phone, Kindle, Android China (через Baidu), Xamarin (iOS и Android) и платформы приложений Chrome. Руководства по началу работы с пошаговыми указаниями для этих платформ см. в статье [Приступая к работе с концентраторами уведомлений].

###3\. Поддерживаются ли уведомления по SMS и электронной почте, а также веб-уведомления?
Концентраторы уведомлений в первую очередь созданы для отправки уведомлений в мобильные приложения с использованием вышеперечисленных платформ. Мы не предоставляем возможность отправки уведомлений по почте или SMS, однако сторонние платформы, которые предоставляют эти возможности, можно интегрировать вместе с концентраторами уведомлений для отправки системных push-уведомлений с помощью мобильных служб Azure. Мы также не предоставляем возможность отправки push-уведомлений в браузере по умолчанию. Клиенты могут внедрить эту функцию с помощью SignalR. Кроме того, мы предоставляем учебник по отправке push-уведомлений в приложения Chrome, которые будут работать в браузере Google Chrome. См. [руководство по приложениям Chrome].

###4\. Как связаны мобильные службы Azure и концентраторы уведомлений Azure и в каких случаях их нужно использовать?
Если у вас есть существующая серверная часть мобильного приложения и вам требуется добавить возможность для отправки push-уведомлений, используйте для этого концентраторы уведомлений Azure. Если вам требуется настроить серверную часть мобильного приложения с нуля, следует использовать мобильные службы Azure. Мобильная служба Azure автоматически подготавливает концентратор уведомлений, чтобы вы могли легко отправлять push-уведомления из серверной части мобильного приложения. Цена за использование мобильных служб Azure включает базовую стоимость использования концентратора уведомлений. Вы платите только при превышении количества отправляемых push-уведомлений. Дополнительную информацию см. в статье [Цены на мобильные службы].

###5\. Сколько устройств может поддерживаться?
На уровнях Basic и Standard количество активных устройств, которые могут получать уведомления, не ограничено. Дополнительную информацию см. в статье [Цены на концентраторы уведомлений].

###6\. Сколько push-уведомлений я могу отправить?
Клиенты отправляют миллионы push-уведомлений в день с помощью концентраторов уведомлений Azure. Вам не нужно выполнять никакие дополнительные действия для масштабирования концентраторов уведомлений. Масштабирование выполняется автоматически на основе количества уведомлений, проходящих через систему. Обратите внимание, что цены зависят от количества доставленных push-уведомлений.

###7\. Как скоро уведомления доставляются на мое устройство?
При обычном использовании с более или менее согласованной входящей нагрузкой и отсутствием пиков концентраторы уведомлений Azure могут обрабатывать по крайней мере 1 миллион отправленных уведомлений в минуту. Такая скорость может меняться в зависимости от количества тегов, характера входящих данных и т. д. За это время мы можем вычислить целевые объекты для соответствующей платформы и направить сообщения соответствующим службам push-уведомлений на основе зарегистрированных тегов и выражений тегов. На этом этапе службы рush-уведомлений (PNS) отвечают за отправку уведомления на устройство. Службы рush-уведомлений не предоставляют никаких гарантий по доставке уведомлений, предусмотренных соглашением об уровне обслуживания. Однако обычно подавляющая часть сообщений доставляется на устройства в течение нескольких минут (< 10 минут) с момента их отправки на нашу платформу. Могут возникать некоторые выбросы, занимающие больше времени. Кроме того, в концентраторе уведомлений Azure предусмотрена политика для удаления любых уведомлений, которые не были доставлены в PNS в течение 30 минут. Эта задержка может произойти по ряду причин, чаще всего потому, что служба PNS регулирует работу приложения.

###8\. Предоставляются ли какие-либо гарантии по задержкам?
Из-за характера доставки push-уведомлений (они доставляются внешней службой рush-уведомлений для определенной платформы) гарантии по задержкам не предоставляются. Как правило, большая часть уведомлений доставляется в течение нескольких минут.

###9\. Какие моменты нужно учитывать при разработке решения в пространствах имен и концентраторах уведомлений?
*Мобильное приложение и среда* — следует использовать один концентратор уведомлений на мобильное приложение в среде. В мультитенантном сценарии для каждого клиента должен быть отдельный концентратор. Никогда не используйте один и тот же концентратор уведомлений в тестовой и рабочей средах, так как это может вызвать проблемы в дальнейшем при отправке уведомлений. Например, Apple предлагает конечные точки Sandbox и Production Push с отдельными учетными данными для каждой из них. Если для концентратора был изначально настроен сертификат «песочницы» Apple, а затем — сертификат рабочей среды Apple, старые маркеры устройств с новым сертификатом станут недействительными, что может привести к сбою отправки push-уведомлений. Лучше использовать рабочую и тестовую среду по отдельности и использовать разные концентраторы для разных сред.

*Учетные данные PNS* — при регистрации мобильного приложения на портале разработчиков платформы (например, Apple или Google и т. д.) вы получаете идентификатор приложения и токены безопасности, необходимые серверной части приложения для предоставления службам рush-уведомлений платформы, чтобы последние могли отправлять push-уведомления на устройства. Эти маркеры безопасности, которые могут быть представлены в виде сертификатов (например, для Apple iOS или Windows Phone) или ключей безопасности (Google Android, Windows и т. д.), требуется настроить в концентраторах уведомлений. Как правило, это осуществляется на уровне концентратора уведомлений, а также на уровне пространства имен в мультитенантном сценарии.

*Пространства имен* — пространства имен могут также использоваться для группирования развертываний. Кроме того, с их помощью можно представить все концентраторы уведомлений для всех клиентов одного приложения в мультитенантном сценарии.

*Географическое распределение* — географическое распределение не всегда является критически важным для push-уведомлений. Кроме того, следует иметь в виду, что различные службы рush-уведомлений (например, APNS, GCM и т. д.), которые в основном доставляют push-уведомления на устройства, распределены неравномерно. Однако при наличии приложения, которое используется во всем мире, вы можете создать несколько концентраторов в разных пространствах имен и воспользоваться преимуществами доступности службы концентраторов уведомлений в разных регионах Azure по всему миру. Учтите, что это приведет к увеличению затрат на управление, особенно затрат на регистрации. Так что мы не советуем так делать, за исключением случаев крайней необходимости.

###10\. Где следует выполнять регистрацию: в серверной части приложения или непосредственно в устройстве?
Выполняйте регистрацию в серверной части приложения в тех случаях, когда необходимо выполнить аутентификацию клиента перед созданием регистрации или при наличии тегов, которые должны быть созданы и изменены серверной частью приложения на основе определенной логики приложения. Дополнительные рекомендации см. в [Руководстве по регистрации в серверной части] и [Руководстве по регистрации в серверной части (часть 2)].

###11\. Какая модель безопасности используется?
Концентраторы уведомлений Azure используют модель безопасности на основе подписанного URL-адреса (SAS). Маркер SAS можно использовать на уровне корневого пространства имен или на детализированном уровне концентраторов уведомлений. Для этих маркеров SAS можно задать различные правила авторизации, например разрешения для отправки сообщений, прослушивания уведомлений и т. д. Дополнительную информацию см. в разделе [Модель безопасности концентратора уведомлений].

###12\. Как обрабатываются конфиденциальные полезные данные в уведомлениях?
Все уведомления доставляются на устройства службами рush-уведомлений (PNS) платформы. При отправке уведомления в концентратор уведомлений Azure оно обрабатывается и передается в соответствующую службу PNS. Передача уведомлений от отправителя в концентраторы уведомлений Azure, а затем в службу PNS осуществляется по протоколу HTTPS. Концентраторы уведомлений Azure никак не регистрируют полезные данные сообщения. Однако для отправки конфиденциальных полезных данных мы советуем использовать шаблон безопасных push-уведомлений. Его суть заключается в том, что отправитель отправляет ping-уведомление для проверки связи с идентификатором сообщения на устройство без конфиденциальных полезных данных, и когда приложение на устройстве получает эти полезные данные, оно напрямую вызывает API безопасной серверной части приложения, чтобы получить информацию о сообщении. Руководство по реализации этого шаблона см. здесь: [Безопасные push-уведомления посредством центров уведомлений].

##Операции
###1\. Какие особенности аварийного восстановления?
Мы предоставляем аварийное восстановление метаданных со своей стороны (имя концентратора уведомлений, строка подключения и т. д.). В случае аварийного восстановления данные регистрации будут утеряны, поэтому вам потребуется способ, позволяющий повторно заполнить новый концентратор этими данными.

- *Шаг 1.* Создайте дополнительный концентратор уведомлений в другом контроллере домена. Его можно создать непосредственно при аварийном восстановлении или с самого начала. Не имеет значения, какой способ вы выберете, ведь подготовка концентратора уведомлений занимает всего несколько секунд. Мы советуем создать концентратор уведомлений с самого начала, так как это позволит предотвратить влияние на возможности управления в случае аварийного восстановления.

- *Шаг 2*. Заполните дополнительный концентратор уведомлений регистрациями из основного концентратора уведомлений. Не рекомендуется хранить регистрации в обоих концентраторах или мгновенно синхронизировать их по мере поступления, так как это приводит к негативным последствиям из-за специфического характера регистраций, срок действия которых истекает в зависимости от службы PNS. Концентраторы уведомлений удаляют их по мере получения отзывов службы PNS о регистрациях с истекшим сроком действия или недействительных регистрациях.

Рекомендуется использовать серверную часть приложения, которая:

- хранит набор регистраций со своей стороны для выполнения массовой вставки в дополнительный концентратор уведомлений в случае аварийного восстановления ИЛИ

- получает регулярный дамп регистраций из основного концентратора в качестве резервной копии, а затем выполняет массовую вставку в дополнительный концентратор.

(Функции экспорта и импорта регистраций, доступные на уровне "Стандартный", описаны здесь: [Экспорт и импорт регистраций].)

Если у вас нет серверной части, при запуске приложений на устройствах они создадут новую регистрацию в дополнительном концентраторе уведомлений. В конечном итоге этот концентратор уведомлений зарегистрирует все активные устройства. Однако недостатком является то, что в течение определенного периода времени устройства, на которых приложения не открылись, не будут получать уведомления.

###2\. Предусмотрена ли возможность ведения журнала аудита?
Все операции по управлению концентраторами уведомлений регистрируются в журналах операций, которые представлены на портале управления Azure.

##Мониторинг и устранение неполадок
###1\. Какие возможности для устранения неполадок доступны?
Концентраторы уведомлений Azure предоставляют несколько функциональных возможностей для стандартного устранения неполадок, особенно в наиболее распространенном случае удаления уведомлений. Дополнительную информацию см. в этом техническом документе: [Концентратор уведомлений — устранение неполадок].

###2\. Какие телеметрические функции доступны?
Концентраторы уведомлений Microsoft Azure позволяют просматривать данные телеметрии на портале управления Azure. Дополнительную информацию о доступных метриках см. здесь: [Концентратор уведомлений — метрики]. Обратите внимание, что успешная доставка уведомлений означает только то, что уведомления доставлены во внешнюю службу push-уведомлений (например, в APNS для Apple, GCM для Google и т. д.), после чего эта служба должна доставить их на устройства. Кроме того, служба push-уведомлений не предоставляет нам такие метрики. Концентраторы уведомлений также предоставляют возможность экспортировать данные телеметрии программным путем (на уровне Standard). Дополнительную информацию см. в этом примере: [Концентратор уведомлений — примеры метрик].

[портал Azure]: https://manage.windowsazure.com
[Цены на концентраторы уведомлений]: http://azure.microsoft.com/pricing/details/notification-hubs/
[Цены на центры уведомлений]: http://azure.microsoft.com/pricing/details/notification-hubs/
[Соглашения об уровне обслуживания]: http://azure.microsoft.com/support/legal/sla/
[Анализ примера — Sochi]: https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=7942
[Анализ примера — Skanska]: https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=5847
[Анализ примера — Seattle Times]: https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=8354
[Анализ примера — Mural.ly]: https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=11592
[Анализ примера — 7Digital]: https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=3684
[Использование API REST для концентраторов уведомлений]: https://msdn.microsoft.com/library/azure/dn530746.aspx
[Приступая к работе с концентраторами уведомлений]: http://azure.microsoft.com/documentation/articles/notification-hubs-ios-get-started/
[руководство по приложениям Chrome]: http://azure.microsoft.com/documentation/articles/notification-hubs-chrome-get-started/
[Цены на мобильные службы]: http://azure.microsoft.com/pricing/details/mobile-services/
[Руководстве по регистрации в серверной части]: https://msdn.microsoft.com/library/azure/dn743807.aspx
[Руководстве по регистрации в серверной части (часть 2)]: https://msdn.microsoft.com/library/azure/dn530747.aspx
[Модель безопасности концентратора уведомлений]: https://msdn.microsoft.com/library/azure/dn495373.aspx
[Безопасные push-уведомления посредством центров уведомлений]: http://azure.microsoft.com/documentation/articles/notification-hubs-aspnet-backend-ios-secure-push/
[Концентратор уведомлений — устранение неполадок]: http://azure.microsoft.com/documentation/articles/notification-hubs-diagnosing/
[Концентратор уведомлений — метрики]: https://msdn.microsoft.com/library/dn458822.aspx
[Концентратор уведомлений — примеры метрик]: https://github.com/Azure/azure-notificationhubs-samples/tree/master/FetchNHTelemetryInExcel
[Экспорт и импорт регистраций]: https://msdn.microsoft.com/library/dn790624.aspx

<!---HONumber=AcomDC_1203_2015-->