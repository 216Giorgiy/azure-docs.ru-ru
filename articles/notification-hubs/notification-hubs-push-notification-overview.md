<properties
	pageTitle="Концентраторы уведомлений Azure"
	description="Узнайте, как использовать push-уведомления в Azure. Примеры кода написаны на C# с использованием API .NET."
	authors="wesmc7777"
	manager="erikre"
	editor=""
	services="notification-hubs"
	documentationCenter=""/>

<tags
	ms.service="notification-hubs"
	ms.workload="mobile"
	ms.tgt_pltfrm="multiple"
	ms.devlang="multiple"
	ms.topic="hero-article"
	ms.date="08/25/2016"
	ms.author="wesmc"/>


#Концентраторы уведомлений Azure

##Обзор

Центры уведомлений Azure – это простая в использовании масштабируемая многоплатформенная инфраструктура для отправки push-уведомлений на мобильные устройства с любой серверной части (облачной или локальной).

Центры уведомлений позволяют без труда отправлять персонализированные push-уведомления между различными платформами без учета особенностей разных систем отправки уведомлений платформы (PNS). С помощью одного вызова API вы можете выбирать отдельных пользователей или целые группы, содержащие миллионы пользователей, на любом устройстве.

Центры уведомлений можно использовать как для сценариев обслуживания отдельных потребителей, так и целых предприятий. Например:

- Отправка уведомлений об экстренных новостях миллионам пользователей с низкой задержкой (центры уведомлений используют приложения Bing, предустановленные на всех устройствах с ОС Windows и Windows Phone).
- Отправка купонов в соответствии с местоположением сегментам пользователей.
- Отправка уведомлений о событиях пользователям или группам пользователей для спортивных, финансовых или игровых приложений.
- Уведомление пользователей о корпоративных событиях, например новые сообщения и сообщения электронной почты, а также информация о потенциальных покупателях.
- Отправка одноразовых паролей, необходимых для многофакторной проверки подлинности.



##Что такое push-уведомления

Смартфоны и планшеты могут "уведомлять" пользователей о наступлении определенных событий. Эти уведомления могут быть представлены в различных формах.

В приложениях Windows Store и Windows Phone может появляться _всплывающее уведомление_, то есть отображается немодальное окно со звуком, сигнализирующее о появлении нового push-уведомления. Кроме того, поддерживаются другие типы уведомлений, включая уведомления на _плитке_, _необработанные_ уведомления и уведомления через _индикаторы событий_. Дополнительные сведения о типах уведомлений, поддерживаемых на устройствах Windows, см. в статье [Плитки, индикаторы событий и уведомления (приложения среды выполнения Windows)](http://msdn.microsoft.com/library/windows/apps/hh779725.aspx).

На устройствах iOS Apple получение push-уведомления приводит к отображению диалогового окна, запрашивающего у пользователя просмотр или закрытие уведомления. Щелкнув **Вид**, можно открыть приложение, которое получает сообщение. Дополнительные сведения об уведомлениях на устройствах с iOS см. в статье [Notifications](http://go.microsoft.com/fwlink/?LinkId=615245) (Уведомления).

Push-уведомлений помогают мобильным устройствам отображать новую информацию и при этом экономить энергию. Уведомления могут отправляться с серверных систем на мобильные устройства даже в том случае, если соответствующие приложения на устройстве не активны. Push-уведомления являются жизненно важным компонентом приложений для потребителей, где они служат для увеличения степени вовлеченности и использования таких приложений. Уведомления также полезны для предприятий, когда обновленная информация увеличивает скорость реагирования сотрудника на бизнес-события.

Ниже приведены некоторые конкретные примеры сценариев использования push-уведомлений в мобильных приложениях:

1.  Обновление плитки на Windows 8 и Windows Phone с текущей финансовой информацией.
2.  Оповещение пользователя о рабочем задании с помощью всплывающего уведомления в корпоративном приложении на основе рабочего процесса.
3.  Отображение значка с количеством текущих потенциальных продаж в приложении CRM (например, Microsoft Dynamics CRM).

##Как работают push-уведомления

Push-уведомления доставляются через инфраструктуры, предназначенные для конкретных платформ, называемые _системами уведомления платформ_ (PNS). PNS предоставляют только одни функции (то есть без поддержки вещания, персонализации) и не имеют общего интерфейса. Например, чтобы отправить уведомление в приложение Магазина Windows, разработчик должен связаться со службой WNS (службой уведомлений Windows). Чтобы отправить уведомление на устройство iOS, тот же разработчик должен связаться со службой APNs (службой push-уведомлений Apple) и отправить сообщение второй раз. Центры уведомлений Azure предоставляют общий интерфейс и другие возможности для поддержки push-уведомлений на всех платформах.

На высоком уровне, однако, все системы уведомления платформ выполняют одну и ту же процедуру:

1.  Клиентское приложение обращается к PNS для извлечения _дескриптора_. Тип дескриптора зависит от системы. Для WNS это URI или "канал уведомлений". Для APNS это маркер.
2.  Клиентское приложение хранит этот дескриптор в _серверной части_ приложения для дальнейшего использования. Для WNS серверной частью обычно является облачная служба. Для Apple эта система называется _поставщик_.
3.  Для отправки push-уведомления серверная часть приложения обращается к PNS, используя дескриптор, чтобы указать определенный экземпляр клиентского приложения.
4.  PNS перенаправляет уведомление на устройство, указанное дескриптором.

![][0]

##Трудности в работе с push-уведомлениями

Хотя эти системы являются очень мощным средством, разработчикам приложений по-прежнему требуется прилагать много усилий для реализации даже распространенных сценариев использования push-уведомлений, например вещания или отправки push-уведомлений сегментированным пользователям.

Push-уведомления являются одним из наиболее востребованных компонентов облачных служб для мобильных приложений. Это объясняется тем, что инфраструктура, необходимая для их работы, довольно сложная и обычно не связана с основной бизнес-логикой приложения. Ниже приведены некоторые из задач, стоящих перед разработчиком при создании инфраструктуры для push-уведомлений по требованию.

- **Зависимость платформы.** Для отправки уведомлений на устройства на разных платформах необходимо закодировать несколько интерфейсов в серверной части. Отличаются не только низкоуровневые детали, но и само представление уведомлений (плитка, всплывающее уведомление или значок) также зависит от платформы. Эти трудности могут привести к созданию сложного и тяжелого в поддержании кода серверной части.

- **Масштабирование.** Масштабирование этой инфраструктуры имеет два аспекта:
	+ По инструкции PNS маркеры устройства необходимо обновлять каждый раз, когда запускается приложение. Это приводит к большому объему трафика (и последовательным обращениям к базе данных) только для обновления маркеров устройств. Когда возрастает количество устройств (возможно, до миллионов), затраты на создание и поддержку такой инфраструктуры уже нельзя игнорировать.

	+ Большинство PNS не поддерживают вещание на несколько устройств. Следовательно, вещание на миллионы устройств приведет к миллионам вызовов систем PNS. Возможность масштабировать эти запросы является нетривиальной задачей, так как обычно разработчики приложений стремятся сохранить малое время задержки. Например, если последнее из получающих уведомление устройств получает его через 30 минут после отправки, это лишает смысла использование push-уведомлений в целом.
- **Маршрутизация.** Системы PNS предоставляют способ отправки сообщения на устройство. Однако в большинстве приложений уведомления направляются пользователям и/или заинтересованным группам (например, всем сотрудникам, связанным с определенной учетной записью клиента). Таким образом, чтобы направить уведомления на нужные устройства, серверная часть приложения должна поддерживать реестр, который связывает заинтересованные группы с маркерами устройств. Это увеличивает общее время выхода приложения на рынок и повышает затраты на его обслуживание.

##Зачем использовать центры уведомлений

Центры уведомлений упрощают работу: больше не нужно преодолевать трудности в работе с push-уведомлениями. Вместо этого можно использовать концентратор уведомлений. Центры уведомлений используют полную многоплатформенную масштабируемую инфраструктуру для отправки push-уведомлений и значительно сокращают количество необходимого для push-уведомлений кода, выполняемого в серверной части приложения. Центры уведомлений реализуют все функции инфраструктуры push-уведомлений. Устройству остается лишь зарегистрировать дескрипторы PNS, а приложению – отправить зависящие от платформы сообщения пользователям или группам пользователей, как показано на рисунке.

![][1]


Центры уведомлений предоставляют готовую инфраструктуру для отправки push-уведомлений, которая обеспечивает следующие преимущества.

- **Несколько платформ.**
	+  Поддержка всех основных мобильных платформ. Концентраторы уведомлений могут отправлять push-уведомления в приложения Магазина Windows, iOS, Android и Windows Phone.

	+  Концентраторы уведомлений предоставляют общий интерфейс для отправки уведомлений на все поддерживаемые платформы. Специальные протоколы для каждой платформы больше не нужны. Серверная часть приложения может отправлять уведомления в форматах, которые используются для конкретной платформы, или в форматах, которые не зависят от платформы. Приложение соединяется только с центрами уведомлений.

	+  Управление маркером устройства. Центры уведомлений выполняют регистрацию маркеров и обеспечивают обратную связь с PNS.

- **Совместимость с любой серверной частью**: в облаке или локально, .NET, PHP, Java, Node и т. д.

- **Масштабирование.** Концентраторы уведомлений поддерживают масштабирование на миллионы устройств без необходимости повторного проектирования или переделки архитектуры.


- **Широкий набор схем доставки**:

	- *Вещание*: обеспечивает практически одновременное вещание на миллионы устройств с помощью одного вызова API.

	- *Одноадресная или многоадресная рассылка*: отправка по тегам, представляющим отдельных пользователей, включая все их устройства, или более широкую группу, например особые форм-факторы (планшет или телефон).

	- *Сегментация*: отправка в составной сегмент, заданный выражениями тегов (например, устройства, находящиеся в г. Нью-Йорк, подписанные на обновления клуба «Янкиз»).

	Каждое устройство, отправляя свой дескриптор на концентратор уведомлений, может задать один или несколько _тегов_. Более подробную информация о тегах см. [здесь]. Заранее подготавливать или размещать теги не требуется. Теги предоставляют простой способ для отправки уведомлений пользователям или заинтересованным группам. Поскольку теги могут содержать любой идентификатор конкретного приложения (например, идентификаторы пользователя или группы), их использование освобождает серверную часть приложения от необходимости хранить дескрипторы устройств и управлять ими.

- **Персонализация**: каждое устройство может иметь один или несколько шаблонов, обеспечивающих локализацию и персонализацию каждого устройства, не меняя серверный код.

- **Безопасность**: Shared Access Secret (SAS) или федеративная проверка подлинности.

- **Обширная телеметрия**: доступна на портале и с помощью программных средств.


##Интеграция с мобильными приложениями службы приложений

Для упрощения и унификации взаимодействия между службами Azure [мобильные приложения службы приложений] располагают встроенной поддержкой push-уведомлений с помощью центров уведомлений. [Мобильные приложения службы приложений] — это доступная по всему миру высокомасштабируемая платформа разработки мобильных приложений, предназначенная для корпоративных разработчиков и системных интеграторов и расширяющая возможности разработки мобильных приложений.

Разработчики мобильных приложений могут использовать концентраторы уведомлений в следующем рабочем процессе.

1. Получение дескриптора PNS устройства.
2. Регистрация устройства и [шаблонов] в центрах уведомлений с помощью удобного API регистрации клиентского пакета SDK для мобильных приложений.
    + Обратите внимание, что в целях безопасности мобильные приложения удаляют в регистрациях все теги. Работа с концентраторами уведомлений непосредственно на стороне сервера для связывания тегов с устройствами.
3. Отправка уведомлений из серверной части приложения с помощью концентраторов уведомлений.

Далее перечислены некоторые преимущества, получаемые разработчиками в рамках интеграции:

- **Пакеты SDK для клиента мобильных приложений.** Эти многоплатформенные пакеты SDK предоставляют простые API-интерфейсы для регистрации и обращения к концентратору уведомлений, автоматически связанному с мобильным приложением. Разработчикам не нужно хранить учетные данные для разных концентраторов уведомлений и прибегать к дополнительной службе.
    + Пакеты SDK автоматически помечают заданное устройство с помощью идентификатора, прошедшего проверку подлинности пользователя мобильных приложений, позволяя реализовать сценарий принудительной отправки пользователю.
    + Пакеты SDK автоматически используют идентификатор установки мобильных приложений в качестве GUID, чтобы зарегистрироваться в концентраторах уведомлений. Это упрощает работу разработчиков, так как им не требуется использовать несколько GUID для разных служб.
    
- **Модель установки.** Мобильные приложения работают с последней моделью принудительной отправки в концентраторах уведомлений, чтобы представить все свойства извещения, связанные с устройством в установке JSON, которое соответствует службам push-уведомлений и просто в использовании.

- **Гибкость.** Несмотря на интеграцию, разработчики всегда могут работать с концентраторами уведомлений напрямую.

- **Интегрированный интерфейс на [портале Azure].** Отправка push-уведомлений как возможность визуально представлена в мобильных приложениях, с помощью которых разработчики могут легко взаимодействовать со связанным концентратором уведомлений.



##Дальнейшие действия

Дополнительную информацию о центрах уведомлений можно найти в следующих статьях:

+ **[Использование центров уведомлений клиентами]**

+ **[Учебники и руководства по работе с центрами уведомлений]**

+ **Учебники по началу работы с концентраторами уведомлений** ([iOS], [Android], [Windows Universal], [Windows Phone], [Kindle], [Xamarin.iOS], [Xamarin.Android])

Соответствующие управляемые API-ссылки .NET на push-уведомления приведены ниже.

+ [Microsoft.WindowsAzure.Messaging.NotificationHub]
+ [Microsoft.ServiceBus.Notifications]


  [0]: ./media/notification-hubs-overview/registration-diagram.png
  [1]: ./media/notification-hubs-overview/notification-hub-diagram.png
  [Использование центров уведомлений клиентами]: http://azure.microsoft.com/services/notification-hubs
  [Учебники и руководства по работе с центрами уведомлений]: http://azure.microsoft.com/documentation/services/notification-hubs
  [iOS]: http://azure.microsoft.com/documentation/articles/notification-hubs-ios-get-started
  [Android]: http://azure.microsoft.com/documentation/articles/notification-hubs-android-get-started
  [Windows Universal]: http://azure.microsoft.com/documentation/articles/notification-hubs-windows-store-dotnet-get-started
  [Windows Phone]: http://azure.microsoft.com/documentation/articles/notification-hubs-windows-phone-get-started
  [Kindle]: http://azure.microsoft.com/documentation/articles/notification-hubs-kindle-get-started
  [Xamarin.iOS]: http://azure.microsoft.com/documentation/articles/partner-xamarin-notification-hubs-ios-get-started
  [Xamarin.Android]: http://azure.microsoft.com/documentation/articles/partner-xamarin-notification-hubs-android-get-started
  [Microsoft.WindowsAzure.Messaging.NotificationHub]: http://msdn.microsoft.com/library/microsoft.windowsazure.messaging.notificationhub.aspx
  [Microsoft.ServiceBus.Notifications]: http://msdn.microsoft.com/library/microsoft.servicebus.notifications.aspx
  [мобильные приложения службы приложений]: https://azure.microsoft.com/ru-RU/documentation/articles/app-service-mobile-value-prop/
  [шаблонов]: notification-hubs-templates-cross-platform-push-messages.md
  [портале Azure]: https://portal.azure.com
  [здесь]: (http://msdn.microsoft.com/library/azure/dn530749.aspx)

<!---HONumber=AcomDC_0907_2016-->