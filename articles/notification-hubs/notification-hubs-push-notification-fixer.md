---
title: "Концентраторы уведомлений Azure удалены диагностики уведомления"
description: "Дополнительные сведения для диагностики неполадок в удаленных уведомления в концентраторов уведомлений Azure."
services: notification-hubs
documentationcenter: Mobile
author: jwhitedev
manager: kpiteira
editor: 
ms.assetid: b5c89a2a-63b8-46d2-bbed-924f5a4cce61
ms.service: notification-hubs
ms.workload: mobile
ms.tgt_pltfrm: NA
ms.devlang: multiple
ms.topic: article
ms.date: 12/22/2017
ms.author: jawh
ms.openlocfilehash: 47808fcdb419dd44cfbd19ac7882b78b4c846b2c
ms.sourcegitcommit: 9ea2edae5dbb4a104322135bef957ba6e9aeecde
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/03/2018
---
# <a name="diagnose-dropped-notifications-in-notification-hubs"></a>Диагностика удаленные уведомления в концентраторы уведомлений

Одним из наиболее распространенных вопросов от клиентов концентраторов уведомлений Azure является устранение при уведомлений, отправляемых из приложения, не отображаются на клиентских устройствах. Они хотят знать, где и почему уведомления о были удалены и способы устранения проблемы. В этой статье идентифицирует почему уведомления удаляются может или не будут приниматься устройств. Узнайте, как для анализа и определения основной причины. 

Важно понимать как концентраторы уведомлений отправляет уведомления на устройство.

![Архитектура концентраторов уведомлений][0]

В потоке типичные отправки уведомления, сообщение отправляется из *серверной части приложения* для концентраторов уведомлений. Концентраторы уведомлений выполняет некоторую обработку для всех регистраций. Обработка учитывает настроенных теги и выражения с тегами для определения «цели». Цели являются все регистрации, которые должны получать push-уведомлений. Регистрации этих может охватывать все или наших поддерживаемые платформы: iOS, Google, Windows, Windows Phone, Kindle и Baidu для Китая Android.

Установить целям, концентраторы уведомлений помещает уведомления *push-уведомлений службы* для платформы устройств. Примеры включают службы Push-уведомлений Apple (APN) Apple и обмен сообщениями Firebase облака (FCM) для Google. Уведомления о Push-уведомлений концентраторы уведомлений разбиты на несколько пакетов регистраций. Концентраторы уведомлений использует для проверки подлинности соответствующие служба push-уведомлений на основе учетных данных, которые задаются на портале Azure, в разделе **Настройка концентратора уведомления**. Затем push-уведомлений вперед служба уведомлений для соответствующего *клиентских устройств*. 

Обратите внимание, что заключительный сегмент доставки уведомлений выполняется служба push-уведомлений платформы и устройства. Любой из четырех основных компонентов в процессе принудительной уведомления (клиента, серверной части приложения, концентраторы уведомлений и служба push-уведомлений платформы) может привести к уведомления для удаления. Дополнительные сведения об архитектуре концентраторы уведомлений см. в разделе [Обзор концентраторов уведомлений].

Сбой доставки уведомлений могут возникнуть во время первоначального теста или промежуточного этапа. Удаленные уведомления на этом этапе может указывать на проблемы конфигурации. Если происходит сбой доставки уведомлений в рабочей среде, некоторые или все уведомления могут отбрасываться. В этом случае указывается глубже приложения или проблема шаблон обмена сообщениями. 

Следующий раздел рассматриваются сценарии, в которых уведомления могут отбрасываться, от общих до более редко.

## <a name="notification-hubs-misconfiguration"></a>Неправильной настройкой концентраторы уведомлений
Для успешной отправки уведомлений служба соответствующих push-уведомлений, концентраторы уведомлений должен пройти проверку подлинности в контексте разработчика приложения. Чтобы это происходило разработчик создает учетную запись разработчика с соответствующей платформы (Google, Apple, Windows и т. д.). Затем разработчик регистрирует свои приложения с платформы, где они получить учетные данные. 

Учетные данные платформы необходимо добавить на портал Azure. Если нет уведомлений доступны для устройства, сначала необходимо определить убедитесь, что в концентраторах уведомлений настроены правильные учетные данные. Учетные данные должны совпадать приложения, созданного под учетной записью разработчика от платформы. 

Пошаговые инструкции для завершения этого процесса см. в разделе [приступить к работе с концентраторами уведомлений Azure].

Ниже приведены некоторые распространенные ошибки конфигурации для проверки.

* **Общие сведения**
   
    * Убедитесь, что имя концентратора уведомлений (без опечаток) и в каждом из этих расположений:

        * Что вы регистрируете от клиента.
        * Отправление уведомлений из серверной части.
        * Когда вы настроили учетных данных службы уведомлений push.
    
    * Обязательно используйте конфигурации строки подписи общего доступа на клиенте и на сервере приложений. Как правило, необходимо использовать **DefaultListenSharedAccessSignature** на стороне клиента и **DefaultFullSharedAccessSignature** в приложении серверный компонент (предоставляет разрешения для отправки уведомлений Концентраторы уведомлений).

* **Конфигурация APNs**
   
    Необходимо поддерживать два разных концентратора: один концентратора для рабочей среды, а новый концентратор для тестирования. Это означает, что необходимо загрузить сертификат, который используется в среде "песочницы", чтобы отдельные концентратора допустимого сертификата и концентратор, который планируется использовать в производственной среде. Не пытайтесь отправить разные типы сертификатов в одном концентраторе. Это может привести к сбою уведомления. 
    
    При отправке разные типы сертификатов случайно в одном концентраторе рекомендуется удалить концентратор и начать заново, с нового концентратора. Если для какой-либо причине не удается удалить концентратор, как минимум, необходимо удалить все существующие регистрации в центре. 

* **FCM конфигурации** 
   
    1. Убедитесь, что *ключа сервера* , полученный от Firebase совпадает с ключом сервера, который зарегистрирован в портале Azure.
   
    ![Ключ сервера firebase][3]
   
    2. Убедитесь, что вы настроили **идентификатор проекта** на стороне клиента. Можно получить значение для **идентификатор проекта** из панели мониторинга Firebase.
   
    ![Идентификатор проекта firebase][1]

## <a name="application-issues"></a>Проблемы с приложением
* **Теги и выражения с тегами**

    При использовании тегов или выражения с тегами для сегментирования аудитории, возможно, что при отправке уведомления, цель не найден на основе тегов или выражения с тегами, заданные в вызове метода send. 
    
    Просмотрите регистраций, убедитесь, что соответствующие теги при отправке уведомления. Затем проверьте, уведомление о доставке только от клиентов, которые имеют такие регистрации. 
    
    Например если были внесены все регистрации с помощью концентраторов уведомлений с помощью тега «Политика» и отправить уведомление с тегом «Спортивных», уведомление не отправлено на любом устройстве. Сложном случае может потребоваться выражения тегов, в которых зарегистрированы с помощью «Тег A» или «Тег B», но во время отправки уведомлений, целевой «Тег & & тег B.» В разделе советы self-diagnosis далее в этой статье мы показывают, как просматривать ваши регистрации и их тегов. 

* **Проблемы с шаблонами**

    Если используются шаблоны, убедитесь, что выполнены рекомендации, приведенные в [шаблоны]. 

* **Недопустимые регистрации**

    Если концентратор уведомлений был настроен правильно, и если теги или выражения с тегами правильно использовать, найдены допустимые целевые объекты. Эти целевые объекты должны отправляться уведомления. Концентраторы уведомлений затем запускает несколько обработки пакетов в параллельном режиме. Каждый пакет отправляет сообщения в ряд регистраций. 

    > [!NOTE]
    > Так как обработка выполняется параллельно, порядок доставки уведомления не гарантируется. 

    Концентраторы уведомлений оптимизирован для модели доставки сообщений «один раз на большинство». Мы будем стараться дедупликации, чтобы на устройстве без уведомления доставляются более одного раза. Чтобы обеспечить это, проверьте регистрацию и убедитесь, что это только одно сообщение отправляется на идентификатор устройства, перед отправкой сообщения служба push-уведомлений. 

    Каждый пакет отправляется служба push-уведомлений, который в свою очередь принимает и проверка регистрации, это возможно, что служба push-уведомлений обнаружит ошибку с одним или несколькими регистрации в пакете. В этом случае служба push-уведомлений возвращает сообщение об ошибке для концентраторов уведомлений, и процесс останавливается. Служба push-уведомлений полностью удаляет пакета. Это особенно справедливо в отношении APNS, который использует протокол TCP потока. 

    Мы оптимизированы для на большинство однократная доставка. Но в случае сбоя регистрации будут удалены из базы данных. Затем мы повторим доставки уведомлений для остальных устройств в пакете.

    Чтобы получить дополнительные сведения об ошибке ошибки доставки попытке для регистрации, можно использовать API REST концентраторов уведомлений [каждого сообщения телеметрии: получение телеметрии сообщения уведомления](https://msdn.microsoft.com/library/azure/mt608135.aspx) и [PNS отзывы](https://msdn.microsoft.com/library/azure/mt705560.aspx). Пример кода, в разделе [пример отправки REST](https://github.com/Azure/azure-notificationhubs-samples/tree/master/dotnet/SendRestExample).

## <a name="push-notification-service-issues"></a>Push-уведомлений службы проблемы
После получения сообщения уведомления, служба push-уведомлений платформы она отвечает служба push-уведомлений для доставки уведомления на устройство. На этом этапе концентраторы уведомлений выходит за пределы изображения и не обеспечивает контроль над при или если уведомление доставляется на устройство. 

Так как службы платформы notification services являются надежными, уведомления, как правило, для доступа устройств из служба push-уведомлений через несколько секунд. Если служба push-уведомлений регулирование, концентраторы уведомлений применяется стратегия экспоненциальной отсрочки. Если служба push-уведомлений остается недоступен в течение 30 минут, мы можем политику на месте, срок действия и удалять эти сообщения без возможности восстановления. 

Если служба push-уведомлений пытается доставить уведомление, но устройство находится в автономном режиме, служба push-уведомлений в течение ограниченного времени хранит уведомления. Устройство становится доступным уведомление передать на устройство. 

Для каждого приложения хранится только один уведомления о последних. Если несколько уведомления отправляются в том случае, когда устройство отключен от сети, каждый новое уведомление вызывает предварительного уведомления будут отменены. Сохранение только последние уведомления называется *объединяющую уведомления* в APNs, и *свертывание* в FCM (с использованием свертываемых ключ). Если устройство остается в автономном режиме в течение долгого времени, удаляются все уведомления, сохраненные для устройства. Дополнительные сведения см. в разделе [Обзор APNs] и [сообщения о FCM].

С концентраторами уведомлений Azure объединяющую ключ можно передать через заголовка HTTP с помощью универсального SendNotification API. Например, для .NET SDK, можно использовать **SendNotificationAsync**. SendNotification API также использует заголовки HTTP, которые передаются в качестве-— служба соответствующих push-уведомлений. 

## <a name="self-diagnosis-tips"></a>Советы по SELF-diagnosis
Ниже приведены пути к диагностики основной причины удаленные уведомлений в концентраторах уведомлений.

### <a name="verify-credentials"></a>Проверка учетных данных
* **Портал разработчиков служб уведомлений Push**
   
    Проверьте учетные данные в соответствующие принудительной уведомления службы портала для разработчиков (APN, FCM, службы уведомлений Windows и т. д.). Дополнительные сведения см. в разделе [приступить к работе с концентраторами уведомлений Azure].

* **Портал Azure**
   
    Чтобы просмотреть и совпадать с учетными данными с теми, которые получены из принудительной уведомления службы портала для разработчиков, на портале Azure перейдите на **политики доступа** вкладки. 
   
    ![Портал Azure политики доступа][4]

### <a name="verify-registrations"></a>Проверка регистраций
* **Visual Studio**
   
    При использовании Visual Studio для разработки, можно подключиться к Azure через обозреватель серверов для просмотра и управления несколькими службами Azure, включая концентраторы уведомлений. Это особенно удобно при работе в среде разработки или тестирования. 
   
    ![Обозреватель серверов в Visual Studio.][9]
   
    Можно просмотреть и управление всех регистраций на концентраторе, по категориям платформой собственного или регистрацию шаблона, все теги, идентификатор службы уведомления о принудительной, идентификатор регистрации и Дата окончания срока действия. Можно также редактировать регистрацию на этой странице. Это особенно полезно для редактирования тегов. 
   
    ![Регистрация устройств Visual Studio][8]
   
   > [!NOTE]
   > Visual Studio можно используйте для изменения регистрации только во время разработки и тестирования и с ограниченным числом регистраций. Если нужно изменить ваши регистрации в пакетном режиме, рассмотрите возможность использования экспорта и импорта функции регистрации, описанные в [Экспорт и изменение регистраций в пакетном режиме](https://msdn.microsoft.com/library/dn790624.aspx).
   > 
   > 
* **Обозреватель служебной шины**
   
    Многие клиенты используют [обозревателя Service Bus] для просмотра и управления их концентратора уведомлений. Обозреватель шины обслуживания — проект с открытым исходным кодом. Примеры см. в разделе [обозревателя Service Bus кода].

### <a name="verify-message-notifications"></a>Проверка уведомлений о сообщениях
* **Портал Azure**
   
    Чтобы отправить тестовое уведомление для клиентов без необходимости серверную часть службы запуска, в разделе **поддержки + Устранение неполадок**выберите **Тестовая отправка**. 
   
    ![Тестирование функциональности для отправки в Azure][7]
* **Visual Studio**
   
    Вы также можете отправлять тестовые уведомления из Visual Studio.
   
    ![Тестирование функциональности для отправки в Visual Studio][10]
   
    Дополнительные сведения об использовании концентраторов уведомлений с помощью обозревателя серверов Visual Studio см. в следующих статьях: 
   
   * [Просмотр регистраций устройства для концентраторов уведомлений]
   * [Подробное рассмотрение: Visual Studio 2013 обновление 2 RC и пакета Azure SDK 2.3]
   * [Объявляет о выпуске Visual Studio 2013 Update 3 и Azure SDK 2.4]

### <a name="debug-failed-notifications-and-review-notification-outcome"></a>Отладка сбоя уведомления и просмотрите выходное уведомление
**Свойство EnableTestSend**

При отправке уведомлений через концентраторы уведомлений изначально уведомление помещается в очередь для обработки в концентраторах уведомлений. Концентраторы уведомлений определяет правильный целевых объектов, а затем отправляет уведомление, чтобы служба push-уведомлений. При использовании API-интерфейса REST или любой клиент SDK удачном возвращении вызова отправки означает только успешно очередь сообщения с концентраторами уведомлений. У вас нет подсказать, что произошло при концентраторов уведомлений в конечном итоге сообщение отправлено служба push-уведомлений. 

Уведомление не поступают на клиентском устройстве, возможно, что произошла ошибка при попытке доставить сообщение, служба push-уведомлений концентраторов уведомлений. Например размер полезных данных может превысить максимальный служба push-уведомлений или учетных данных, настроенных в концентраторах уведомлений может быть неверным. 

Чтобы получить представление о принудительной ошибки службы уведомлений, можно использовать [EnableTestSend] свойство. Это свойство включается автоматически при отправке тестового сообщения с портала или клиента Visual Studio. Это свойство можно использовать, чтобы просмотреть подробные сведения для отладки. Можно также использовать свойство через API-интерфейсы. В настоящее время его можно использовать в пакете SDK для .NET. В конечном счете он добавляется для всех пакетов SDK клиента. 

Для использования **EnableTestSend** свойство для вызова REST, добавьте параметр строки запроса с именем *тестирования* до конца отправки вызова. Например:  

    https://mynamespace.servicebus.windows.net/mynotificationhub/messages?api-version=2013-10&test

**Пример (пакет SDK для .NET)**

Ниже приведен пример использования пакета SDK .NET для отправки уведомлений собственного всплывающего окна (всплывающих):

```csharp
    NotificationHubClient hub = NotificationHubClient.CreateClientFromConnectionString(connString, hubName);
    var result = await hub.SendWindowsNativeNotificationAsync(toast);
    Console.WriteLine(result.State);
```

В конце выполнения **результат. Состояние** просто указывает, **сообщений в очереди**. Результаты не обеспечивают подсказать, что произошло с push-уведомлений. 

После этого можно использовать **EnableTestSend** логическое свойство. Используйте **EnableTestSend** свойство во время инициализации **NotificationHubClient** Чтобы получить подробные сведения о принудительной ошибки службы уведомлений, которые возникают, когда отправляется уведомление. Результат вызова отправки потребуется дополнительное время, поскольку он возвращается только после того, концентраторы уведомлений реализует уведомление служба push-уведомлений для определения результата. 

```csharp
    bool enableTestSend = true;
    NotificationHubClient hub = NotificationHubClient.CreateClientFromConnectionString(connString, hubName, enableTestSend);

    var outcome = await hub.SendWindowsNativeNotificationAsync(toast);
    Console.WriteLine(outcome.State);

    foreach (RegistrationResult result in outcome.Results)
    {
        Console.WriteLine(result.ApplicationPlatform + "\n" + result.RegistrationId + "\n" + result.Outcome);
    }
```

**Пример результатов выполнения**

    DetailedStateAvailable
    windows
    7619785862101227384-7840974832647865618-3
    The Token obtained from the Token Provider is wrong

Это сообщение указывает, что недопустимые учетные данные настраиваются в концентраторах уведомлений, или имеется проблема с регистраций в концентраторе. Рекомендуется удалить эту регистрацию и заново создайте регистрацию перед отправкой сообщения клиентом. 

> [!NOTE]
> Использование **EnableTestSend** свойство сильно регулируется. Используйте этот параметр только в среде разработки и тестирования, а также с ограниченным набором регистраций. Мы отправлять уведомления отладки только 10 устройств. Мы также имеют ограничение в обработке отправляет отладки до 10 в минуту. 
> 
> 

### <a name="review-telemetry"></a>Просмотр телеметрии
* **Использование портала Azure**
   
    На портале можно получить краткий обзор всех действий в концентратор уведомлений. 
   
    1. На **Обзор** вкладку, вы увидите Агрегированное представление регистраций, уведомления и ошибок платформой. 
   
        ![Панель мониторинга Обзор концентраторов уведомлений][5]
   
    2. На **монитор** вкладку, можно добавить много других метрик платформой более подробные сведения. Вы можете просмотреть специально ошибки, относящиеся к служба push-уведомлений, возвращаемые при попытке отправить уведомление служба push-уведомлений концентраторов уведомлений. 
   
        ![Журнал действий Azure портала][6]
   
    3. Начните с вводных **входящих сообщений**, **операции регистрации**, и **успешные уведомления**. Перейдите на вкладку каждой платформы, чтобы просмотреть ошибки, относящиеся к служба push-уведомлений. 
   
    4. Если параметры проверки подлинности для центра уведомлений являются неправильными, сообщение **ошибка проверки подлинности PNS** отображается. Это свидетельствует о проверку учетных данных службы уведомлений push. 

* **Программный доступ**

    Дополнительные сведения о программный доступ статьях: 

    * [Данные телеметрии программный доступ]  
    * [Данные телеметрии доступ через API-интерфейсы образца] 

    > [!NOTE]
    > Некоторые возможности, связанные с телеметрией, такие как экспорта и импорта регистраций и телеметрии доступ через API-интерфейсы, доступны только на уровень обслуживания Standard. При попытке использовать эти функции из Free или Basic службы уровня, появляется сообщение об исключении при использовании пакета SDK и ошибки HTTP 403 (запрещено) при использовании функций напрямую из API-интерфейсов REST. 
    >
    >Чтобы использовать функции, относящиеся к телеметрии, сначала убедитесь на портале Azure вы используете уровень обслуживания Standard.  
> 
> 

<!-- IMAGES -->
[0]: ./media/notification-hubs-diagnosing/Architecture.png
[1]: ./media/notification-hubs-diagnosing/FCMConfigure.png
[3]: ./media/notification-hubs-diagnosing/FCMServerKey.png
[4]: ../../includes/media/notification-hubs-portal-create-new-hub/notification-hubs-connection-strings-portal.png
[5]: ./media/notification-hubs-diagnosing/PortalDashboard.png
[6]: ./media/notification-hubs-diagnosing/PortalAnalytics.png
[7]: ./media/notification-hubs-ios-get-started/notification-hubs-test-send.png
[8]: ./media/notification-hubs-diagnosing/VSRegistrations.png
[9]: ./media/notification-hubs-diagnosing/VSServerExplorer.png
[10]: ./media/notification-hubs-diagnosing/VSTestNotification.png

<!-- LINKS -->
[Обзор концентраторов уведомлений]: notification-hubs-push-notification-overview.md
[приступить к работе с концентраторами уведомлений Azure]: notification-hubs-windows-store-dotnet-get-started-wns-push-notification.md
[шаблоны]: https://msdn.microsoft.com/library/dn530748.aspx 
[Обзор APNs]: https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html
[сообщения о FCM]: https://firebase.google.com/docs/cloud-messaging/concept-options
[Export and modify registrations in bulk]: http://msdn.microsoft.com/library/dn790624.aspx
[обозревателя Service Bus]: https://msdn.microsoft.com/library/dn530751.aspx#sb_explorer
[обозревателя Service Bus кода]: https://code.msdn.microsoft.com/windowsazure/Service-Bus-Explorer-f2abca5a
[Просмотр регистраций устройства для концентраторов уведомлений]: http://msdn.microsoft.com/library/windows/apps/xaml/dn792122.aspx 
[Подробное рассмотрение: Visual Studio 2013 обновление 2 RC и пакета Azure SDK 2.3]: http://azure.microsoft.com/blog/2014/04/09/deep-dive-visual-studio-2013-update-2-rc-and-azure-sdk-2-3/#NotificationHubs 
[Объявляет о выпуске Visual Studio 2013 Update 3 и Azure SDK 2.4]: http://azure.microsoft.com/blog/2014/08/04/announcing-release-of-visual-studio-2013-update-3-and-azure-sdk-2-4/ 
[EnableTestSend]: https://docs.microsoft.com/en-us/dotnet/api/microsoft.azure.notificationhubs.notificationhubclient.enabletestsend?view=azure-dotnet
[Данные телеметрии программный доступ]: http://msdn.microsoft.com/library/azure/dn458823.aspx
[Данные телеметрии доступ через API-интерфейсы образца]: https://github.com/Azure/azure-notificationhubs-samples/tree/master/FetchNHTelemetryInExcel

