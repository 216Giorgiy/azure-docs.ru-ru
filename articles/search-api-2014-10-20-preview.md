<properties 
	pageTitle="API REST службы поиска Azure, версия 2014-10-20-Preview" 
	description="API REST службы поиска Azure, версия 2014-10-20-Preview" 
	services="search" 
	documentationCenter="" 
	authors="HeidiSteen" 
	manager="mblythe"/>

<tags 
	ms.service="search" 
	ms.devlang="rest-api" 
	ms.workload="search" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.date="03/31/2015" 
	ms.author="heidist"/>

# API REST службы поиска Azure: версия 2014-10-20-Preview #

В этом документе описана версия **2014-10-20-Preview** API REST службы поиска Azure. Это прототип версии API, который может измениться в любое время. Не используйте зависимости от этого API в рабочем коде.

> [AZURE.NOTE]Так как это экспериментальная версия, не все возможности, описанные в этом документе, доступны в пользовательском интерфейсе портала Azure. В частности, поддержка поиска по нескольким языкам с помощью параметра `analyzer` в полях, новая функция оценки `tag` и новая возможность `suggesters` в настоящее время реализованы только в интерфейсе API. Если вы используете API для активации одной из этих возможностей, вы сможете просматривать определения индекса на портале, но не сможете обновлять их, а кроме того, вам будет недоступна визуализация новых функций.

Также доступны указанные ниже материалы, посвященные API для этой версии.

- [Профили оценки (API REST службы поиска Azure, версия 2014-10-20-Preview)](../search-api-scoring-profiles-2014-10-20-preview/)

Документацию для выпущенной версии интерфейса API REST поиска Azure можно найти в MSDN. Дополнительные сведения см. в статье [Интерфейс API REST службы поиска Azure](http://msdn.microsoft.com/library/azure/dn798935.aspx).

##Об интерфейсе API REST службы##

Поиск Azure — это облачная служба, с помощью которой можно создавать собственные поисковые приложения. В Поиске Azure реализованы концепции *служб поиска* и *индексов* (служба поиска содержит один или несколько индексов). Служба поиска идентифицируется уникальным образом с помощью полного доменного имени (например, `mysearchservice.search.windows.net`). При подготовке службы к работе формируется ключ API, который затем используется для проверки подлинности запросов к службе поиска Azure.

В службе поиска Azure можно выполнять действия двух категорий.

- **Управление индексом.** Сюда относятся административные операции со службой и индексом поиска. 

- **Действия с документами.** Это операции, связанные с запросом документов, которые охватывает данный индекс, и управлением ими.

Интерфейсы API, описанные в этом разделе, предназначены для выполнения различных операций с поисковыми данными, таких как создание и заполнение индекса, добавление документов и отправка запросов. При обращении к API следует помнить о некоторых моментах.

- Все интерфейсы API основаны на отправке HTTP-запросов и получении ответов в формате OData JSON.

- Для всех обращений к API необходимо указывать `api-key` в заголовке или строке запроса, как описано в примечаниях ниже.

- Все запросы API отправляются по протоколу HTTPS (на порт по умолчанию — 443).

- Строки всех запросов API должны содержать параметр `api-version`. Его значением должен быть идентификатор версии текущего выпуска службы, как в следующем примере:

    GET /indexes?api-version=2014-10-20-Preview

- Во всех запросах API можно задавать необязательный заголовок HTTP `Accept`. Если этот заголовок не задан, по умолчанию он принимает значение `application/json`.

Для управления службой предназначен отдельный интерфейс API. К таким операциям относятся, в частности, подготовка службе к работе и изменение емкости. Дополнительные сведения об этом API см. в статье «Интерфейс API REST управления поиском Azure».

### Конечная точка ###

Конечной точкой для операций со службой является заданный вами URL-адрес службы поиска Azure: https://*your-service-name*.search.windows.net.


### Версии ###

Существуют различные версии API для работы с Поиском Azure. Если вы проводите оценку, пытаясь понять, насколько целесообразно использовать эту службу в вашей рабочей среде, рекомендуем вам версию `api-version=2014-07-31-Preview`. В настоящий момент это единственная версия, в которую не вносятся изменения. Более подробные сведения см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx).


<a name="Authentication"></a>
### Проверка подлинности и контроль доступа###

Для проверки подлинности в службе поиска Azure необходимы два фрагмента информации: URL-адрес службы и `api-key`. Значения `api-keys` формируются при запуске службы, и при необходимости их можно создать повторно после ее подготовки к работе. `api-key` представляет собой ключ администратора, позволяющий получить доступ ко всем операциям, либо ключ запроса, который используется только для проверки подлинности запросов данных. Для одной службы можно создать два ключа администратора и до 50 ключей запросов.

Контроль доступа к службе охватывает только операции администрирования с помощью элементов управления доступом на базе ролей (role-based access controls, или RBAC), которые доступны на портале предварительной версии Azure. Роли определяют уровни доступа к средствам администрирования службы. Например, просматривать ключ админа могут только пользователи с ролью владельца или участника, а просматривать статус службы — обладатели любой роли.

Доступ к операциям с данными на конечной точке службы поиска, включая управление индексом, его заполнение и отправку запросов к данным, осуществляется исключительно через `api-keys`. Действие RBAC не распространяется на операции с индексом и документами. Дополнительные сведения о `api-keys` и RBAC в службе поиска Azure см. в статье [Управление службой поиска в среде Microsoft Azure](search-manage.md).

**Примечание.** По соображениям безопасности не рекомендуется передавать в URI запросов конфиденциальные данные, например `api-key`. В связи с этим служба поиска Azure принимает ключи запросов только в виде параметров `api-key` в строках запросов, и использовать такую схему рекомендуется только в том случае, если содержимое индекса должно быть общедоступным. Вместо этого рекомендуется передавать `api-key` в заголовке запроса.

###Краткие сведения об интерфейсах API###

Интерфейс API службы поиска Azure поддерживает две синтаксические схемы, которые можно использовать для запроса объектов: простой и альтернативный синтаксис OData (более подробные сведения см. в статье [Поддержка OData (поиск в Azure)](http://msdn.microsoft.com/library/azure/dn798932.aspx)). В разделах из приведенного ниже списка рассматривается простой синтаксис.

[Создание индекса](#CreateIndex)

    POST /indexes?api-version=2014-10-20-Preview

[Обновление индекса](#UpdateIndex)

    PUT /indexes/[index name]?api-version=2014-10-20-Preview

[Получение индекса](#GetIndex)

    GET /indexes/[index name]?api-version=2014-10-20-Preview

[Получение списка индексов](#ListIndexes)

    GET /indexes?api-version=2014-10-20-Preview

[Получение статистических данных индекса](#GetIndexStats)

    GET /indexes/[index name]/stats?api-version=2014-10-20-Preview

[Удаление индекса](#DeleteIndex)

    DELETE /indexes/[index name]?api-version=2014-10-20-Preview

[Добавление, удаление и обновление данных в индексе](#AddOrUpdateDocuments)

    POST /indexes/[index name]/docs/index?api-version=2014-10-20-Preview 

[Поиск документов](#SearchDocs)

    GET /indexes/[index name]/docs?[query parameters]

[Запрос документов](#LookupAPI)

     GET /indexes/[index name]/docs/[key]?[query parameters]

[Подсчет документов](#CountDocs)

    GET /indexes/[index name]/docs/$count?api-version=2014-10-20-Preview

[Предложения](#Suggestions)

    GET /indexes/[index name]/docs/suggest?[query parameters]

________________________________________ <a name="IndexOps"></a>
# Операции с индексом #

Для создания индексов в службе поиска Azure и управления ими используются простые HTTP-запросы (POST, GET, PUT, DELETE), отправляемые к определенному ресурсу индекса. Чтобы создать индекс, необходимо сначала отправить с помощью запроса POST документ JSON, который описывает его схему. В схеме определяются поля индекса, их типы данных, а также возможные варианты их использования (например, в полнотекстовом поиске, фильтрах, сортировке, аспектах и предложениях). Она также определяет профили оценки, средства подбора и другие атрибуты, которые позволяют настроить поведение индекса.

Ниже приведен пример схемы, которая используется для поиска сведений о гостиницах, с полем описания, определенным на двух языках. Обратите внимание на то, как атрибуты определяют порядок использования поля. Например, `hotelId` используется в качестве ключа документа (`"key": true`) и исключается из полнотекстового поиска (`"searchable": false`).

    {
    "name": "hotels",  
    "fields": [
      {"name": "hotelId", "type": "Edm.String", "key": true, "searchable": false},
      {"name": "baseRate", "type": "Edm.Double"},
      {"name": "description", "type": "Edm.String", "filterable": false, "sortable": false, "facetable": false},
	  {"name": "description_fr", "type": "Edm.String", "filterable": false, "sortable": false, "facetable": false, analyzer: "fr.lucene"},
      {"name": "hotelName", "type": "Edm.String"},
      {"name": "category", "type": "Edm.String"},
      {"name": "tags", "type": "Collection(Edm.String)"},
      {"name": "parkingIncluded", "type": "Edm.Boolean"},
      {"name": "smokingAllowed", "type": "Edm.Boolean"},
      {"name": "lastRenovationDate", "type": "Edm.DateTimeOffset"},
      {"name": "rating", "type": "Edm.Int32"},
      {"name": "location", "type": "Edm.GeographyPoint"}
     ],
     "suggesters": [
      {
       "name": "sg",
       "searchMode": "analyzingInfixMatching",
       "sourceFields": ["hotelName"]
      }
     ] 
    }
 
После создания индекса в него необходимо добавить документы. Этот этап описан в разделе [Добавление и обновление документов](#AddOrUpdateDocuments).

Вы также можете ознакомиться с [видеороликом Channel 9 Cloud Cover](http://go.microsoft.com/fwlink/p/?LinkId=511509), в котором рассматривается индексирование в службе поиска Azure.


<a name="CreateIndex"></a>
## Создание индекса ##

Для создания нового индекса в службе поиска Azure используется HTTP-запрос POST. Его тело представляет собой документ JSON, в котором указано название индекса, его поля, атрибуты, определяющее работу запросов, параметры оценки результатов, средства подбора и CORS.

    POST https://[service name].search.windows.net/indexes?api-version=[api-version]
    Content-Type: application/json
    api-key: [admin key]

Вы также можете отправить запрос PUT и передать имя индекса в URI. Если такого индекса не существует, он будет создан.

    PUT https://[search service url]/indexes/[index name]?api-version=[api-version]

**Примечание.** Максимальное разрешенное количество индексов зависит от ценовой категории. В бесплатной версии службы разрешено до трех индексов. В стандартной версии разрешено использовать до 50 индексов на одну службу поиска. Дополнительные сведения см. в разделе [Пределы и ограничения](http://msdn.microsoft.com/library/azure/dn798934.aspx)

**Запрос**

Все запросы к службе отправляются по протоколу HTTPS. Для отправки запроса на **создание индекса** можно использовать метод POST или PUT. Для метода POST в теле запроса передается название индекса вместе с определением его схемы. Для метода PUT имя индекса указывается в составе URL-адреса. Если такого индекса не существует, он будет создан. Если он уже есть, его определение будет обновлено.

Имя индекса передается в нижнем регистре, должно начинаться с буквы или цифры, не должно содержать символов косой черты и точки, а его максимальная длина составляет 127 знаков. Начиная со второго символа имя может содержать буквы, цифры и дефисы (однако последовательности из двух или большего числа дефисов запрещены).

Параметр `api-version` является обязательным. Допустимые значения: `2014-07-31-Preview` и `2014-10-20-Preview`. Для каждого запроса можно выбирать свою версию API, определяющую особенности его поведения, однако рекомендуется использовать одну версию во всем коде. В большинстве случаев оптимальной версией является `2014-07-31-Preview`. В версии `2014-10-20-Preview` доступны экспериментальные функции, такие как поддержка языковых анализаторов, задаваемых с помощью атрибута анализатора индекса. Более подробные сведения о версиях интерфейсов API см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx). Подробные сведения о языковых анализаторах см. в разделе [Поддержка языков](#LanguageSupport).

**Заголовки запроса**

В списке ниже перечислены обязательные и необязательные заголовки запроса.

- `Content-Type`: обязательный. Для этого заголовка должно быть задано значение `application/json`.
- `api-key`: обязательный. Заголовок `api-key` используется для 
- проверки подлинности запроса в службе поиска. Это уникальное строковое значение, присваиваемое службе. Запрос **создания индекса** должен содержать заголовок `api-key` со значением ключа администратора (а не ключа запроса). 
 
Для формирования URL-адреса запроса также понадобится имя службы. Имя и `api-key` можно найти в панели мониторинга службы на портале предварительной версии Azure. Дополнительные сведения о навигации по страницам см. в статье [Начало работы со службой поиска Azure](search-get-started.md).

<a name="RequestData"></a> **Синтаксис тела запроса**

Тело запроса содержит определение схемы со списком полей данных в документах, передаваемых в индекс, типами данных, атрибутами, а также необязательным списком профилей оценки, которые используются для оценки соответствующих критериям поиска документов во время выполнения запроса.

Обратите внимание на то, что в теле запроса POST передается имя индекса.

Индекс может содержать только одно ключевое поле. Оно должно быть строковым. Это поле представляет собой уникальный идентификатор каждого документа, который хранится в индексе.

Ниже описан синтаксис полезных данных запроса. Далее в этом разделе приведен образец запроса.

    {
      "name": (optional on PUT; required on POST) "name_of_index",
      "fields": [
        {
          "name": "name_of_field",
          "type": "Edm.String | Collection(Edm.String) | Edm.Int32 | Edm.Int64 | Edm.Double | Edm.Boolean | Edm.DateTimeOffset | Edm.GeographyPoint",
          "searchable": true (default where applicable) | false (only Edm.String and Collection(Edm.String) fields can be searchable),
          "filterable": true (default) | false,
          "sortable": true (default where applicable) | false (Collection(Edm.String) fields cannot be sortable),
          "facetable": true (default where applicable) | false (Edm.GeographyPoint fields cannot be facetable),
          "suggestions": true | false (default, only Edm.String and Collection(Edm.String) fields can be used for suggestions),
          "key": true | false (default, only Edm.String fields can be keys),
          "retrievable": true (default) | false,
		  "analyzer": "name of text analyzer"
        }
      ],
      "suggesters": [
        {
          "name": "name of suggester",
          "searchMode": "analyzingInfixMatching" (other modes may be added in the future),
          "sourceFields": ["field1", "field2", ...]
        }
      ],
      "scoringProfiles": [
        {
          "name": "name of scoring profile",
          "text": (optional, only applies to searchable fields) {
            "weights": {
              "searchable_field_name": relative_weight_value (positive #'s),
              ...
            }
          },
          "functions": (optional) [
            {
              "type": "magnitude | freshness | distance | tag",
              "boost": # (positive number used as multiplier for raw score != 1),
              "fieldName": "...",
              "interpolation": "constant | linear (default) | quadratic | logarithmic",
              "magnitude": {
                "boostingRangeStart": #,
                "boostingRangeEnd": #,
                "constantBoostBeyondRange": true | false (default)
              },
              "freshness": {
                "boostingDuration": "..." (value representing timespan leading to now over which boosting occurs)
              },
              "distance": {
                "referencePointParameter": "...", (parameter to be passed in queries to use as reference location, see "scoringParameter" for syntax details)
                "boostingDistance": # (the distance in kilometers from the reference location where the boosting range ends)
              },
			  "tag": {
				"tagsParameter": "..." (parameter to be passed in queries to specify list of tags to compare against target field, see "scoringParameter" for syntax details)
              }
            }
          ],
          "functionAggregation": (optional, applies only when functions are specified) 
            "sum (default) | average | minimum | maximum | firstMatching"
        }
      ],
      "defaultScoringProfile": (optional) "...",
      "corsOptions": (optional) {
        "allowedOrigins": ["*"] | ["origin_1", "origin_2", ...],
        "maxAgeInSeconds": (optional) max_age_in_seconds (non-negative integer)
      }
    }    

Примечание. Тип данных `Edm.Int64` поддерживается начиная с версии API 2014-10-20-Preview.
    
**Атрибуты индекса**

При создании индекса можно задать перечисленные ниже атрибуты. Более подробные сведения об оценке и профилях см. в статье [Профили оценки (API REST службы поиска Azure, версия 2014-10-20 Preview)](../search-api-scoring-profiles-2014-10-20-preview/).

`name` — задает имя поля.

`type` — задает тип данных поля. Список поддерживаемых типов см. [здесь](#DataTypes).

`searchable` — помечает поле как доступное для полнотекстового поиска. Это означает, что во время индексирования оно будет включено в анализ (в частности, для разбиения на слова). Если, например, задать для поля с атрибутом `searchable` значение sunny day (солнечный день), оно будет разделено на элементы sunny и day. В результате эти слова смогут участвовать в полнотекстовом поиске. У полей типа `Edm.String` и `Collection(Edm.String)` по умолчанию установлен флаг `searchable`. Для полей других типов установить атрибут `searchable` нельзя.

  - **Примечание.** Поля c атрибутом `searchable` занимают больше места в индексе, так как служба поиска Azure хранит дополнительную (разбитую на элементы) версию значения каждого такого поля для полнотекстового поиска. Если вам нужно сэкономить место в индексе и вы не собираетесь включать поле в поиск, установите для параметра `searchable` значение `false`.

`filterable` — позволяет ссылаться на поле в запросах `$filter`. Строковые значения в полях с атрибутами `filterable` и `searchable` обрабатываются по-разному. Для полей типа `Edm.String` и `Collection(Edm.String)` с атрибутом `filterable` не выполняется разбиение на слова, поэтому они могут попасть в результаты поиска только по точному совпадению. Например, если для такого поля задать в параметре `f` значение sunny day, запрос `$filter=f eq 'sunny'` не вернет совпадений, а запрос — `$filter=f eq 'sunny day'` вернет. По умолчанию атрибут `filterable` устанавливается для всех полей.

`sortable` — по умолчанию система сортирует результаты на основе их оценки, однако пользователям часто бывает нужно отсортировать документы по полям. Для полей типа `Collection(Edm.String)` установить атрибут `sortable` нельзя. Для всех остальных полей флаг `sortable` устанавливается по умолчанию.

`facetable` — как правило, используется для представления результатов поиска, в которых указывается количество найденных документов по категориям (например, при поиске цифровых фотоаппаратов можно разделить результаты по производителям, количеству мегапикселей, цене и т. п.). Этот параметр не предназначен для использования с полями типа `Edm.GeographyPoint`. Для всех остальных полей флаг `facetable` устанавливается по умолчанию.

  - **Примечание.** Поля типа `Edm.String`, для которых задан атрибут `filterable`, `sortable` или `facetable`, должны иметь длину не больше 32 КБ. Это связано с тем, что такие поля обрабатываются как целые условия поиска, а максимальная длина такого условия в службе поиска Azure составляет 32 КБ. Если в одном строковом поле нужно хранить текст большего размера, необходимо явным образом задать в определении индекса для свойств `filterable`, `sortable` и `facetable` значение `false`.

`suggestions` — определяет, можно ли использовать поле для автозавершения при упреждающем вводе. Этот атрибут можно задать только для полей типов `Edm.String` и `Collection(Edm.String)`. По умолчанию свойство `suggestions` принимает значение `false`, так как использование этой функции требует дополнительного места в индексе. **Примечание.** Для получения предложений вместо этой функции можно использовать свойство `suggesters`, которое было введено в версии 2014-10-20-Preview. В будущих версиях свойство `suggestions` будет объявлено устаревшим, и вместо него будет применяться отдельная конструкция `suggesters`.

  - **Примечание.** Если ни для одного из перечисленных выше атрибутов (`searchable`, `filterable`, `sortable`, `facetable` и `suggestions`) не задано значение `true`, такое поле фактически исключается из обращенного индекса. Это могут быть поля, которые не используются в запросах, однако нужны в результатах поиска. Их исключение из индекса позволяет повысить его производительность.

`key` — указывает, что в поле хранятся уникальные идентификаторы документов в индексе. Атрибут `key` должен быть установлен у одного и только у одного поля типа `Edm.String`. Такие ключевые поля можно использовать для запроса документов непосредственно через [API поиска](#LookupAPI).

`retrievable` — определяет, включается ли поле в возвращаемые поиском результаты. Этот атрибут полезен, когда поле (например, показатель прибыльности) нужно использовать для фильтрации, сортировки или оценки, но оно не должно отображаться конечному пользователю. У полей с установленным свойством `key` этот атрибут должен иметь значение `true`.

`scoringProfiles` — позволяет настроить механизм оценки, с помощью которого можно влиять на относительную позицию элементов в результатах поиска. Профили оценки состоят из взвешенных полей и функций. Дополнительные сведения об атрибутах, которые используются в таких профилях, см. в статье [Профили оценки (API REST службы поиска Azure, версия 2014-10-20-Preview)](../search-api-scoring-profiles-2014-10-20-preview/).

`analyzer` — задает имя текстового анализатора, который следует использовать для этого поля. Список допустимых значений см. в статье [Поддержка языков](#LanguageSupport). Этот параметр можно использовать только с полями, для которых задан атрибут `searchable`. Выбрав для поля анализатор, его невозможно изменить.


<a name="LanguageSupport"></a> **Поддержка языков**

Поля с поддержкой поиска подвергаются анализу, который чаще всего включает разбиение на слова, нормализацию текста и выделение условий поиска. По умолчанию поля с поддержкой поиска в службе поиска Azure анализируются с помощью [анализатора Apache Lucene Standard](http://lucene.apache.org/core/4_9_0/analyzers-common/index.html), который разбивает текст на элементы согласно правилам [сегментации текста Юникода](http://unicode.org/reports/tr29/). Кроме того, стандартный анализатор преобразует все знаки в нижний регистр. Анализу подвергаются как индексируемые документы, так и условия поиска во время индексирования и обработки запросов.

В службе поиска Azure поля можно индексировать на различных языках. Для каждого из них необходим нестандартный анализатор текста, который учитывает особенности соответствующего языка. Например, анализатор для французского использует [парадигматический модуль Light French Stemmer](http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/fr/FrenchLightStemmer.html), с помощью которого приводит слова к их [корням](http://en.wikipedia.org/wiki/Stemming). Кроме того, он удаляет из анализируемого текста [элизии ](http://en.wikipedia.org/wiki/Elision) и французские шумовые слова. Анализатор для английского расширяет возможности стандартного анализатора. Он удаляет из слов признаки принадлежности (символы 's в конце), выполняет выделение корней с помощью [стеммера Портера](http://tartarus.org/~martin/PorterStemmer/) и удаляет английские [шумовые слова](http://en.wikipedia.org/wiki/Stop_words).
 
Анализатор можно настроить независимо для каждого поля в определении индекса с помощью свойства `analyzer`. Например, в одном индексе могут существовать отдельные поля для описаний гостиницы на английском, французском и испанском языках. В запросе может быть указано, какое из полей необходимо вернуть в результатах поиска.

Ниже приведен список поддерживаемых анализаторов с кратким описанием их функциональных возможностей.

<table style="font-size:12">
    <tr>
		<th>Язык</th>
		<th>Название анализатора</th>
		<th>Описание</th>
	</tr>
    <tr>
		<td>Арабский</td>
		<td>ar.lucene</td>
		<td>
		<ul>
			<li>Реализует орфографическую нормализацию для арабского языка.</li>
			<li>Выполняет упрощенное алгоритмическое выделение корней.</li>
			<li>Отсеивает арабские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Бразильский</td>
		<td>pt-Br.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает бразильские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Китайский (упрощенное письмо)</td>
		<td>zh-Hans.lucene</td>
		<td>
		<ul>
			<li>Определяет оптимальную сегментацию слов на основе вероятностных моделей знаний.</li>
			<li>Отсеивает китайские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Китайский (традиционное письмо)</td>
		<td>zh-Hant.lucene</td>
		<td>
		<ul>
			<li>Индексирует биграммы (пересекающиеся группы из двух смежных китайских символов).</li>
			<li>Выполняет нормализацию ширины символов.</li>
		</ul>
		</td>
	<tr>
    <tr>
		<td>Чешский</td>
		<td>cs.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает чешские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Датский</td>
		<td>da.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает датские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Нидерландский</td>
		<td>nl.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает нидерландские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Немецкий</td>
		<td>de.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает немецкие шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Греческий</td>
		<td>el.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает греческие шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Английский</td>
		<td>en.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает английские шумовые слова.</li>
			<li>Удаляет признаки принадлежности.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Финский</td>
		<td>fi.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает финские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Французский</td>
		<td>fr.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает французские шумовые слова.</li>
			<li>Удаляет элизии.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Хинди</td>
		<td>hi.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает шумовые слова на хинди.</li>
			<li>Удаляет некоторые различия в вариантах написания.</li>
			<li>Нормализует представление текста на индийских языках в Юникоде.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Венгерский</td>
		<td>hu.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает венгерские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Индонезийский (бахаса)</td>
		<td>id.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает индонезийские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Итальянский</td>
		<td>it.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает итальянские шумовые слова.</li>
			<li>Удаляет элизии.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Японский</td>
		<td>ja.lucene</td>
		<td>
		<ul>
			<li>Использует алгоритмы морфологического анализа.</li>
			<li>Нормализует стандартные варианты написания в катакане.</li>
			<li>Выполняет упрощенное удаление шумовых слов и тегов.</li>
			<li>Нормализует ширину символов.</li>
			<li>Выполняет лемматизацию (приводит флективные прилагательные и глаголы к базовой форме).</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Корейский</td>
		<td>ko.lucene</td>
		<td>
		<ul>
			<li>Индексирует биграммы (пересекающиеся группы из двух смежных китайских символов).</li>
			<li>Выполняет нормализацию ширины символов.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Латышский</td>
		<td>lv.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает латышские шумовые слова.</li>
		</ul>
		</td>
	</tr>

    <tr>
		<td>Норвежский</td>
		<td>no.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает норвежские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Польский</td>
		<td>pl.lucene</td>
		<td>
		<ul>
			<li>Выполняет алгоритмическое выделение корней (алгоритм Штемпеля).</li>
			<li>Отсеивает польские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Португальский</td>
		<td>pt-Pt.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает португальские шумовые слова.</li>
		</ul>
		</td>
	</tr>

    <tr>
		<td>Румынский</td>
		<td>ro.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает румынские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Русский</td>
		<td>ru.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает русские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Испанский</td>
		<td>es.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает испанские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Шведский</td>
		<td>sv.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает шведские шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Турецкий</td>
		<td>tr.lucene</td>
		<td>
		<ul>
			<li>Удаляет все знаки после апострофа (включая и сам апостроф).</li>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает турецкие шумовые слова.</li>
		</ul>
		</td>
	</tr>
    <tr>
		<td>Тайский</td>
		<td>th.lucene</td>
		<td>
		<ul>
			<li>Выполняет упрощенное выделение корней.</li>
			<li>Отсеивает тайские шумовые слова.</li>
		</ul>
		</td>
	</tr>
	<td colspan="3">Кроме того, в службе поиска Azure доступны независимые от языка конфигурации анализаторов.</td> 
    <tr>
		<td>Стандартное приведение к ASCII</td>
		<td>standardasciifolding.lucene</td>
		<td>
		<ul>
			<li>Сегментация текста Юникода (стандартный лексический анализатор)</li>
			<li>Фильтр приведения к ASCII: преобразует символы Юникода, которые не относятся к числу первых 127&#160;знаков кодировки ASCII, к их эквивалентам в этой кодировке. Эта функция полезна для удаления диакритических знаков.</li>
		</ul>
		</td>
	</tr>
</table>

Все анализаторы, в названиях которых есть идентификатор <i>lucene</i>, работают на базе [языковых анализаторов Apache Lucene](http://lucene.apache.org/core/4_9_0/analyzers-common/overview-summary.html). Дополнительные сведения о фильтре приведения к ASCII можно найти [здесь](http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/miscellaneous/ASCIIFoldingFilter.html).

**Параметры CORS**

Клиентский код JavaScript не может обращаться к API, так как браузер блокирует все запросы между разными источниками. Чтобы разрешить такие запросы к индексу, необходимо включить CORS (Cross-Origin Resource Sharing — общий доступ к ресурсам независимо от источника), установив атрибут `corsOptions`. Обратите внимание на то, что по соображениям безопасности технологию CORS поддерживают только интерфейсы API запросов. Для технологии CORS можно настроить перечисленные ниже параметры.

- `allowedOrigins` (обязательный): список источников, которым необходимо предоставлять доступ к индексу. Это означает, что любому коду JavaScript из такого источника будет разрешено отправлять запросы к индексу (при условии, что будет указан правильный ключ API). Источники обычно задаются в формате `protocol://fully-qualified-domain-name:port`, хотя значение порта часто опускается. Дополнительные сведения см. в [этой статье](http://go.microsoft.com/fwlink/?LinkId=330822).
 - Чтобы разрешить доступ всем источникам, добавьте в массив `allowedOrigins` единственный элемент: `*`. Обратите внимание на то, что **делать так в рабочих версиях служб поиска не рекомендуется**. Однако это может оказаться полезно для целей разработки или отладки.
- `maxAgeInSeconds` (необязательный): с помощью этого значения браузеры определяют длительность (в секундах) кэширования предварительных ответов CORS. Это значение должно быть целой неотрицательной величиной. Чем оно больше, чем выше производительность, однако при этом применение изменений в политике CORS занимает больше времени. Если это значение не задано, длительность по умолчанию составляет 5 минут.

<a name="Suggesters"></a> **Средства подбора**

Средство подбора позволяет реализовать автозавершение поисковых запросов. Как правило, фрагмент запроса передается в API предложений, пока пользователь вводит текст, и API возвращает набор предлагаемых фраз.

Служба поиска Azure переходит на новый API средств подбора. В версии 2014-07-31-Preview был реализован ограниченный интерфейс API для работы с предложениями: в рамках этой реализации для поля можно было задать атрибут `"suggestions": true`, а затем можно было производить поиск префиксных предложений для коротких строк (от 3 до 25 знаков). Начиная с версии 2014-10-20-Preview в службе поиска Azure реализован более функциональный вариант поиска предложений на основе средств подбора, описанных в этом разделе. В этой новой реализации можно выполнять префиксный и инфиксный поиск соответствий, а также повышена стойкость к ошибкам в поисковых запросах. Мы настоятельно рекомендуем использовать новый API средств подбора начиная с версии 2014-10-20-Preview.

В настоящее время средства подбора лучше всего работают при поиске предложений по определенным документам, а не по произвольным условиям поиска и фразам. Они хорошо обрабатывают такие поля, как заголовки, имена и другие относительно короткие фразы, идентифицирующие документ. Менее эффективно выполняется поиск по таким полям с множеством повторяющихся элементов, как категории и теги, а также по очень длинным полям, таким как описания и комментарии.

В определении индекса в коллекцию `suggesters` можно добавить одно средство подбора. Для него задаются перечисленные ниже свойства.

- `name`: имя средства подбора. Оно используется при обращении к API `suggest`.
- `searchMode`: методика подбора совпадающих фраз. В настоящее время поддерживается только режим `analyzingInfixMatching`, в рамках которого выполняется гибкий поиск совпадений в начале и середине фраз.
- `sourceFields`: список из одного или нескольких полей, которые служат источником при поиске предложений. Источниками могут быть только поля типов `Edm.String` и `Collection(Edm.String)`. В текущей предварительной версии средств подбора можно использовать только поля, для которых не задан настраиваемый анализатор.

В текущей версии API в коллекции средств подбора может быть только один элемент.

<a name="CreateUpdateIndexExample"></a> **Пример тела запроса**
 
    {
      "name": "hotels",  
      "fields": [
        {"name": "hotelId", "type": "Edm.String", "key": true, "searchable": false},
        {"name": "baseRate", "type": "Edm.Double"},
        {"name": "description", "type": "Edm.String", "filterable": false, "sortable": false, "facetable": false},
	    {"name": "description_fr", "type": "Edm.String", "filterable": false, "sortable": false, "facetable": false, analyzer="fr.lucene"},
        {"name": "hotelName", "type": "Edm.String"},
        {"name": "category", "type": "Edm.String"},
        {"name": "tags", "type": "Collection(Edm.String)"},
        {"name": "parkingIncluded", "type": "Edm.Boolean"},
        {"name": "smokingAllowed", "type": "Edm.Boolean"},
        {"name": "lastRenovationDate", "type": "Edm.DateTimeOffset"},
        {"name": "rating", "type": "Edm.Int32"},
        {"name": "location", "type": "Edm.GeographyPoint"}
      ],
      "suggesters": [
        {
          "name": "sg",
          "searchMode": "analyzingInfixMatching",
          "sourceFields": ["hotelName"]
        }
      ] 
    }

**Ответ**

Для успешного запроса: «201 — Создан ресурс».

По умолчанию тело ответа содержит объект JSON с определением созданного индекса. Если заголовок `Prefer` запроса содержит значение `return=minimal`, тело ответа будет пустым, а код состояния вместо значения «201 — Создан ресурс» принимает значение «204 — Нет содержимого». При этом не играет роли, какой запрос (PUT или POST) использовался для создания индекса.

<a name="UpdateIndex"></a>
## Обновление индекса ##

Обновить существующий индекс в службе поиска Azure можно с помощью HTTP-запроса PUT. В общедоступной предварительной версии в рамках обновления можно добавлять новые поля в существующие схемы, менять параметры CORS, а также вносить изменения в профили оценки (см. статью [Профили оценки (API REST службы поиска Azure, версия 2014-10-20-Preview)](../search-api-scoring-profiles-2014-10-20-preview/)). Указать имя обновляемого индекса можно в URI запроса:

    PUT https://[search service url]/indexes/[index name]?api-version=[api-version]
    Content-Type: application/json
    api-key: [admin key]

**Внимание!** Для обновления схемы можно использовать только операции, которые не ведут к перестройке индекса поиска. Обновления схемы, которые требуют переиндексирования (например, изменение типов полей), пока не поддерживаются. Новые поля можно добавлять в любой момент, однако изменять и удалять существующие поля пока нельзя. То же относится и к средствам подбора: добавить в средство подбора новое поле можно при добавлении этого поля в индекс, однако удалять из них поля или добавлять существующие поля нельзя.

При добавлении в индекс нового поля для всех существующих в индексе документов ему автоматически присваивается значение Null. Дополнительное место в хранилище при этом не потребуется до тех пор, пока в индекс не будут добавлены новые документы.

**Запрос**

Все запросы к службе отправляются по протоколу HTTPS. Для отправки запроса на **обновление индекса** можно использовать HTTP-метод PUT. Для метода PUT имя индекса указывается в составе URL-адреса. Если такого индекса не существует, он будет создан. Если он уже есть, его определение будет обновлено.

Имя индекса передается в нижнем регистре, должно начинаться с буквы или цифры, не должно содержать символов косой черты и точки, а его максимальная длина составляет 127 знаков. Начиная со второго символа имя может содержать буквы, цифры и дефисы (однако последовательности из двух или большего числа дефисов запрещены).

Параметр `api-version` является обязательным. Допустимые значения: `2014-07-31-Preview` и `2014-10-20-Preview`. Для каждого запроса можно выбирать свою версию API, определяющую особенности его поведения, однако рекомендуется использовать одну версию во всем коде. В большинстве случаев оптимальной версией является `2014-07-31-Preview`. В версии `2014-10-20-Preview` доступны экспериментальные функции. Более подробные сведения см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx).

**Заголовки запроса**

В списке ниже перечислены обязательные и необязательные заголовки запроса.

- `Content-Type`: обязательный. Для этого заголовка должно быть задано значение `application/json`.
- `api-key`: обязательный. Заголовок `api-key` используется для проверки подлинности запроса в службе поиска. Это уникальное строковое значение, присваиваемое службе. Запрос **обновления индекса** должен содержать заголовок `api-key` со значением ключа администратора (а не ключа запроса).
 
Для формирования URL-адреса запроса также понадобится имя службы. Имя и `api-key` можно найти в панели мониторинга службы на портале предварительной версии Azure. Дополнительные сведения о навигации по страницам см. в статье [Начало работы со службой поиска Azure](search-get-started.md).

**Синтаксис тела запроса**

При обновлении существующего индекса тело должно содержать исходное определение схемы и новые поля, которые требуется добавить, а также измененные профили оценки, средства подбора и параметры CORS (при их наличии). Если вносить изменения в профили оценки и параметры CORS не требуется, необходимо указать исходные профили и параметры, с которыми был создан индекс. Как правило, рекомендуется извлечь определение индекса с помощью запроса GET, изменить его, а затем обновить с помощью метода PUT.

Для удобства здесь приведен синтаксис схемы для создания индекса. Дополнительные сведения см. в разделе [Создание индекса](#CreateIndex).

    {
      "name": (optional) "name_of_index",
      "fields": [
        {
          "name": "name_of_field",
          "type": "Edm.String | Collection(Edm.String) | Edm.Int32 | Edm.Int64 | Edm.Double | Edm.Boolean | Edm.DateTimeOffset | Edm.GeographyPoint",
          "searchable": true (default where applicable) | false (only Edm.String and Collection(Edm.String) fields can be searchable),
          "filterable": true (default) | false,
          "sortable": true (default where applicable) | false (Collection(Edm.String) fields cannot be sortable),
          "facetable": true (default where applicable) | false (Edm.GeographyPoint fields cannot be facetable),
          "suggestions": true | false (default, only Edm.String and Collection(Edm.String) fields can be used for suggestions),
          "key": true | false (default, only Edm.String fields can be keys),
          "retrievable": true (default) | false,
		  "analyzer": "name of text analyzer"
        }
      ],
      "suggesters": [
        {
          "name": "name of suggester",
          "searchMode": "analyzingInfixMatching" (other modes may be added in the future),
          "sourceFields": ["field1", "field2", ...]
        }
      ],
      "scoringProfiles": [
        {
          "name": "name of scoring profile",
          "text": (optional, only applies to searchable fields) {
            "weights": {
              "searchable_field_name": relative_weight_value (positive #'s),
              ...
            }
          },
          "functions": (optional) [
            {
              "type": "magnitude | freshness | distance | tag",
              "boost": # (positive number used as multiplier for raw score != 1),
              "fieldName": "...",
              "interpolation": "constant | linear (default) | quadratic | logarithmic",
              "magnitude": {
                "boostingRangeStart": #,
                "boostingRangeEnd": #,
                "constantBoostBeyondRange": true | false (default)
              },
              "freshness": {
                "boostingDuration": "..." (value representing timespan leading to now over which boosting occurs)
              },
              "distance": {
                "referencePointParameter": "...", (parameter to be passed in queries to use as reference location, see "scoringParameter" for syntax details)
                "boostingDistance": # (the distance in kilometers from the reference location where the boosting range ends)
              },
			  "tag": {
				"tagsParameter": "..." (parameter to be passed in queries to specify list of tags to compare against target field, see "scoringParameter" for syntax details)
              }
            }
          ],
          "functionAggregation": (optional, applies only when functions are specified) 
            "sum (default) | average | minimum | maximum | firstMatching"
        }
      ],
      "defaultScoringProfile": (optional) "...",
      "corsOptions": (optional) {
        "allowedOrigins": ["*"] | ["origin_1", "origin_2", ...],
        "maxAgeInSeconds": (optional) max_age_in_seconds (non-negative integer)
      }
    }    

Примечание. Тип данных `Edm.Int64` поддерживается начиная с версии API 2014-10-20-Preview.

**Ответ**

Для успешного запроса: «204 — Нет содержимого».

По умолчанию тело ответа пустое. Однако если заголовок `Prefer` запроса имеет значение `return=representation`, тело ответа содержит объект JSON с определением обновленного индекса. В данном случае код состояния после успешного выполнения операции — «200 — ОК».

<a name="ListIndexes"></a>
## Получение списка индексов ##

Операция **получения списка индексов** возвращает список индексов, которые в настоящий момент есть в службе поиска Azure.

    GET https://[service name].search.windows.net/indexes?api-version=[api-version]
    api-key: [admin key]

**Запрос**

Все запросы к службе отправляются по протоколу HTTPS. Для отправки запроса на **получение списка индексов** можно использовать метод GET.

Параметр `api-version` является обязательным. Допустимые значения: `2014-07-31-Preview` и `2014-10-20-Preview`. Для каждого запроса можно выбирать свою версию API, определяющую особенности его поведения, однако рекомендуется использовать одну версию во всем коде. В большинстве случаев оптимальной версией является `2014-07-31-Preview`. В версии `2014-10-20-Preview` доступны экспериментальные функции. Более подробные сведения см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx).

**Заголовки запроса**

В списке ниже перечислены обязательные и необязательные заголовки запроса.
 
- `api-key`: обязательный. Заголовок `api-key` используется для проверки подлинности запроса в службе поиска. Это уникальное строковое значение, присваиваемое службе. Запрос на **получение списка индексов** должен содержать заголовок `api-key` со значением ключа администратора (а не ключа запроса).
 
Для формирования URL-адреса запроса также понадобится имя службы. Имя и `api-key` можно найти в панели мониторинга службы на портале предварительной версии Azure. Дополнительные сведения о навигации по страницам см. в статье [Начало работы со службой поиска Azure](search-get-started.md).

**Тело запроса**

Нет.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код «200 — ОК».

Вот пример тела запроса:

    {
      "value": [
        {
          "name": "Books",
          "fields": [
            {"name": "ISBN", ...},
            ...
          ]
        },
        {
          "name": "Games",
          ...
        },
        ...
      ]
    }

Обратите внимание на то, что в ответе можно отфильтровать нужные свойства. Например, если необходим только список имен индексов, задайте параметр запроса OData `$select`:

    GET /indexes?api-version=2014-10-20-Preview&$select=name

В этом случае ответ из приведенного выше примера будет выглядеть так:

    {
      "value": [
        {"name": "Books"},
        {"name": "Games"},
        ...
      ]
    }

Это удобный способ сократить нагрузку на пропускную способность, если в службе поиска много индексов.

<a name="GetIndex"></a>
## Получение индекса ##

С помощью операции **получения индекса** можно извлечь определение индекса из службы поиска Azure.

    GET https://[service name].search.windows.net/indexes/[index name]?api-version=[api-version]
    api-key: [admin key]

**Запрос**

Запросы к службе отправляются по протоколу HTTPS. Для отправки запроса на **получение индекса** можно использовать метод GET.
 
Параметр [имя индекса] в URI запроса указывает, какой именно индекс требуется извлечь из коллекции.

Параметр `api-version` является обязательным. Допустимые значения: `2014-07-31-Preview` и `2014-10-20-Preview`. Для каждого запроса можно выбирать свою версию API, определяющую особенности его поведения, однако рекомендуется использовать одну версию во всем коде. В большинстве случаев оптимальной версией является `2014-07-31-Preview`. В версии `2014-10-20-Preview` доступны экспериментальные функции. Более подробные сведения см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx).

**Заголовки запроса**

В списке ниже перечислены обязательные и необязательные заголовки запроса.
 
- `api-key`: заголовок `api-key` используется для проверки подлинности запроса в службе поиска. Это уникальное строковое значение, присваиваемое службе. Запрос на **получение индекса** должен содержать заголовок `api-key` со значением ключа администратора (а не ключа запроса).

Для формирования URL-адреса запроса также понадобится имя службы. Имя и `api-key` можно найти в панели мониторинга службы на портале предварительной версии Azure. Дополнительные сведения о навигации по страницам см. в статье [Начало работы со службой поиска Azure](search-get-started.md).

**Тело запроса**

Нет.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код «200 — ОК».

Пример полезных данных запроса см. в образце объекта JSON в разделе [Создание и обновление индекса](#CreateUpdateIndexExample).

<a name="DeleteIndex"></a>
## Удаление индекса ##

Операция **удаления индекса** удаляет из службы поиска Azure индекс и связанные с ним документы. Имя индекса можно найти в панели мониторинга службы на портале предварительной версии Azure или получить с помощью вызова API. Более подробные сведения см. в разделе [Получение списка индексов](#ListIndexes).

    DELETE https://[service name].search.windows.net/indexes/[index name]?api-version=[api-version]
    api-key: [admin key]
    
**Запрос**

Запросы к службе отправляются по протоколу HTTPS. Для отправки запроса на **удаление индекса** можно использовать метод DELETE.
 
Параметр [имя индекса] в URI запроса указывает, какой именно индекс требуется удалить из коллекции.

Параметр `api-version` является обязательным. Допустимые значения: `2014-07-31-Preview` и `2014-10-20-Preview`. Для каждого запроса можно выбирать свою версию API, определяющую особенности его поведения, однако рекомендуется использовать одну версию во всем коде. В большинстве случаев оптимальной версией является `2014-07-31-Preview`. В версии `2014-10-20-Preview` доступны экспериментальные функции. Более подробные сведения см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx).

**Заголовки запроса**

В списке ниже перечислены обязательные и необязательные заголовки запроса.
 
- `api-key`: обязательный. Заголовок `api-key` используется для проверки подлинности запроса в службе поиска. Это строковое значение, уникальное для URL службы. Запрос **удаления индекса** должен содержать заголовок `api-key` со значением ключа администратора (а не ключа запроса).
 
Для формирования URL-адреса запроса также понадобится имя службы. Имя и `api-key` можно найти в панели мониторинга службы на портале предварительной версии Azure. Дополнительные сведения о навигации по страницам см. в статье [Начало работы со службой поиска Azure](search-get-started.md).

**Тело запроса**

Нет.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код «204 — Нет содержимого».

<a name="GetIndexStats"></a>
## Получение статистики индексов ##

Операция **получения статистических данных индекса** возвращает из службы поиска Azure количество документов для текущего индекса, а также сведения об используемом в хранилище месте.

	GET https://[service name].search.windows.net/indexes/[index name]/stats?api-version=[api-version]
    api-key: [admin key]

**Запрос**

Все запросы к службе отправляются по протоколу HTTPS. Для отправки запроса на **получение статистических данных индекса** можно использовать метод GET.

Параметр [имени индекса] в URI запроса указывает службе, для какого именно индекса требуется вернуть статистические данные.

Параметр `api-version` является обязательным. Допустимые значения: `2014-07-31-Preview` и `2014-10-20-Preview`. Для каждого запроса можно выбирать свою версию API, определяющую особенности его поведения, однако рекомендуется использовать одну версию во всем коде. В большинстве случаев оптимальной версией является `2014-07-31-Preview`. В версии `2014-10-20-Preview` доступны экспериментальные функции. Более подробные сведения см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx).

**Заголовки запроса**

В списке ниже перечислены обязательные и необязательные заголовки запроса.
 
- `api-key`: заголовок `api-key` используется для проверки подлинности запроса в службе поиска. Это уникальное строковое значение, присваиваемое службе. Запрос на **получение статистических данных индекса** должен содержать заголовок `api-key` со значением ключа администратора (а не ключа запроса).
 
Для формирования URL-адреса запроса также понадобится имя службы. Имя и `api-key` можно найти в панели мониторинга службы на портале предварительной версии Azure. Дополнительные сведения о навигации по страницам см. в статье [Начало работы со службой поиска Azure](search-get-started.md).

**Тело запроса**

Нет.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код «200 — ОК».

Тело запроса имеет следующий формат:

    {
      "documentCount": number,
	  "storageSize": number (size of the index in bytes)
    }

________________________________________ <a name="DocOps"></a>
# Операции с документами #

В службе поиска Azure индекс заполняется с помощью документов JSON, которые добавляются в службу. Добавленные документы составляют весь объем данных, по которым производится поиск. Документы содержат поля, некоторые из которых разбиваются на условия поиска при добавлении. Сегмент `/docs` URL-адреса в API Поиска Azure представляет коллекцию документов в индексе. Все операции с этой коллекцией (добавление, объединение, удаление документов и запросы к ним) выполняются в контексте одного индекса, поэтому все URL-адреса для них всегда начинаются со строки `/indexes/[index name]/docs`, содержащей имя соответствующего индекса.

Для формирования документов JSON, добавляемых в службу поиска Azure, в коде можно использовать набор результатов из реляционной базы данных или любого другого структурированного источника. Демонстрационный образец приложения Adventure Works Demo для службы поиска Azure в репозитории Codeplex содержит код, в котором документы JSON формируются на основе набора результатов из образца базы данных Adventure Works. Дополнительные сведения об образце приложения можно найти [здесь](search-create-first-solution.md).

В большинстве случаев при разработке приложений данные для поиска обособлены и являются внешними с точки зрения уровня данных приложения. Если приложение использует локальную базу данных для контроля состояния запасов, документы в службе поиска Azure будут содержать похожие или идентичные значения для наименований товаров, цены и доступности, однако они будут храниться в обращенном индексе с целью оптимизации поиска.

Рекомендуется создавать по одному документу для каждого объекта, по которым будет осуществляться поиск. В приложении для видеопроката можно создать по одному документу для каждого фильма, в приложении для интернет-магазина — по документу для каждого номера SKU, в приложении для электронного обучения — по одному документу для каждого курса, в фирме, которая занимается научными исследованиями, — по документу для каждой научной работы из архива и т. д.

Документы состоят из одного или нескольких полей. Поля могут содержать текст, который разбит на условия поиска, а также неразбитые и нетекстовые значения, которые можно использовать в фильтрах и профилях оценки. Имена, типы данных и поддерживаемые для поля функции поиска определяются в схеме индекса. Одно из полей в каждой схеме должно содержать идентификаторы, и у каждого документа в таком поле должно быть значение, уникальным образом идентифицирующее этот документ в индексе. Все прочие поля документа являются необязательными и заполняются значениями Null, если они не указаны явным образом. Обратите внимание на то, что значения Null не занимают места в обращенном индексе.

Перед добавлением документов необходимо создать индекс в службе. Подробные сведения о выполнении этого первого этапа см. в разделе [Создание индекса](#CreateIndex).

**Примечание.** В общедоступной предварительной версии службы поиска Azure поддерживается полнотекстовый поиск только на английском языке.

<a name="AddOrUpdateDocuments"></a>
## Добавление, обновление и удаление документов ##

Для добавления, объединения, объединения/добавления и удаления документов в определенном индексе используются HTTP-запросы POST. Для добавления большого количества документов рекомендуется использовать пакетные запросы (до 1000 документов или ок. 16 МБ на пакет).

    POST https://[service name].search.windows.net/indexes/[index name]/docs/index?api-version=[api-version]
    Content-Type: application/json
    api-key: [admin key]
    
**Запрос**

Все запросы к службе отправляются по протоколу HTTPS. Для добавления, объединения, объединения/добавления и удаления документов в определенном индексе используются HTTP-запросы POST.

URL запроса содержит [имя индекса], которое указывает, в какой именно индекс отправляются документы. За один раз можно отправить документы только в один индекс.

Параметр `api-version` является обязательным. Допустимые значения: `2014-07-31-Preview` и `2014-10-20-Preview`. Для каждого запроса можно выбирать свою версию API, определяющую особенности его поведения, однако рекомендуется использовать одну версию во всем коде. В большинстве случаев оптимальной версией является `2014-07-31-Preview`. В версии `2014-10-20-Preview` доступны экспериментальные функции. Более подробные сведения см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx).

**Заголовки запроса**

В списке ниже перечислены обязательные и необязательные заголовки запроса.

- `Content-Type`: обязательный. Для этого заголовка должно быть задано значение `application/json`.
- `api-key`: обязательный. Заголовок `api-key` используется для проверки подлинности запроса в службе поиска. Это уникальное строковое значение, присваиваемое службе. Запрос **добавления документов** должен содержать заголовок `api-key` со значением ключа администратора (а не ключа запроса).
 
Для формирования URL-адреса запроса также понадобится имя службы. Имя и `api-key` можно найти в панели мониторинга службы на портале предварительной версии Azure. Дополнительные сведения о навигации по страницам см. в статье [Начало работы со службой поиска Azure](search-get-started.md).

**Тело запроса**

Тело запроса содержит один или несколько индексируемых документов. Документы идентифицируются уникальным ключом. С каждым документом связывается действие: добавить, объединить, объединить или добавить либо удалить. Запросы на добавление должны содержать данные документа в виде набора пар «ключ/значение».

    {
      "value": [
        {
          "@search.action": "upload (default) | merge | mergeOrUpload | delete",
          "key_field_name": "unique_key_of_document", (key/value pair for key field from index schema)
          "field_name": field_value (key/value pairs matching index schema)
            ...
        },
        ...
      ]
    }
    
**Действия с документами**

- `upload`: операция добавления аналогична операции upsert, которая добавляет документ, если он новый, и обновляет либо заменяет его, если он уже существует. Обратите внимание на то, что при обновлении все поля заменяются.
- `merge`: операция объединения обновляет существующий документ с использованием указанных полей. Если документ не существует, объединение возвращает ошибку. Поля, указанные в запросе на объединение, заменяют собой существующие поля документа. Это относится и к полям типа `Collection(Edm.String)`. Например, если документ содержит поле tags со значением `["budget"]` и вы выполняете запрос на объединение со значением `["economy", "pool"]` для поля tags, после его обработки оно примет значение `["economy", "pool"]`, а **не** `["budget", "economy", "pool"]`.
- `mergeOrUpload`: работает аналогично операции `merge`, если документ с указанным значением ключа уже существует в индексе. Если его нет, эта операция выполняется так же, как и операция `upload` с новым документом.
- `delete`: операция удаления указанного документа из индекса. Обратите внимание на то, что для операции `delete` можно указать только значение поля ключа. Попытка задать другие поля приведет к тому, что запрос вернет ошибку HTTP 400. Чтобы удалить из документа определенное поле, воспользуйтесь операцией `merge`, явным образом задав для требуемого поля значение `null`. 

**Ответ**

Код состояния: в качестве успешного ответа возвращается код «200 — ОК», указывающий на то, что все элементы проиндексированы (для всех этих документов в поле состояния status заносится значение true):

    {
      "value": [
        {
          "key": "unique_key_of_document",
          "status": true,
          "errorMessage": null
        }
      ]
    }  

Код состояния: если хотя бы один из элементов не удалось проиндексировать, возвращается код 207 (для документов, которые не удалось проиндексировать, в поле состояния status заносится значение false):
 
    {
      "value": [
        {
          "key": "unique_key_of_document",
          "status": false,
          "errorMessage": "The search service is too busy to process this document. Please try again later."
        }
      ]
    }  

Свойство `errorMessage` содержит причину ошибки индексирования, если эти сведения доступны.

**Примечание.** Если клиент часто получает ответ с кодом 207, это может быть связано с повышенной нагрузкой на систему. Чтобы выяснить, так ли это, проверьте значение свойства `errorMessage`. Если это так, рекомендуется воспользоваться ***запросами регулирования индексирования***. В противном случае если поток запросов на индексирование не уменьшится, система может начать отклонять их все с кодом ошибки 503.

Код состояния: если превышено разрешенное количество документов в индексе, система возвращает код ошибки 429. В этом случае нужно создать новый индекс или повысить предельную емкость.

**Пример:**

    {
      "value": [
        {
          "@search.action": "upload",
          "hotelId": "1",
          "baseRate": 199.0,
          "description": "Best hotel in town",
		  "description_fr": "Meilleur hôtel en ville", 
          "hotelName": "Fancy Stay",
		  "category": "Luxury",
          "tags": ["pool", "view", "wifi", "concierge"],
          "parkingIncluded": false,
		  "smokingAllowed": false,
          "lastRenovationDate": "2010-06-27T00:00:00Z",
          "rating": 5,
          "location": { "type": "Point", "coordinates": [-122.131577, 47.678581] }
        },
        {
          "@search.action": "upload",
          "hotelId": "2",
          "baseRate": 79.99,
          "description": "Cheapest hotel in town",
	      "description_fr": "Hôtel le moins cher en ville",
          "hotelName": "Roach Motel",
		  "category": "Budget",
          "tags": ["motel", "budget"],
          "parkingIncluded": true,
		  "smokingAllowed": true,
          "lastRenovationDate": "1982-04-28T00:00:00Z",
          "rating": 1,
          "location": { "type": "Point", "coordinates": [-122.131577, 49.678581] }
        },
        {
          "@search.action": "merge",
          "hotelId": "3",
          "baseRate": 279.99,
          "description": "Surprisingly expensive",
          "lastRenovationDate": null
        },
        {
          "@search.action": "delete",
          "hotelId": "4"
        }
      ]
    }
________________________________________ <a name="SearchDocs"></a>
## Поиск документов ##

Операция **поиска** выполняется с помощью запроса GET, и в ней задаются параметры, которые определяют условия выборки документов.

    GET https://[service name].search.windows.net/indexes/[index name]/docs?[query parameters]
    api-key: [admin key]

**Запрос**

Запросы к службе отправляются по протоколу HTTPS. Для отправки запроса на **поиск** можно использовать метод GET.

В URI запроса указывается целевой индекс, из которого требуется вернуть все документы, соответствующие заданным параметрам.

**Параметры запроса**

`search=[string]` (необязательный): искомый текст. По умолчанию ведется поиск по всем полям с атрибутом `searchable`, если не задан параметр `searchFields`. При поиске по полям со свойством `searchable` искомый текст разбивается на элементы, поэтому условия поиска можно разделять пробелами (пример: `search=hello world`). Чтобы вернуть совпадения по любому из условий, используйте значение `*` (это может быть полезно для запросов логической фильтрации). Если этот параметр опущен, по умолчанию он принимает значение `*`. Синтаксис поиска подробнее описан в разделе «Синтаксис простых запросов» ниже.

  - **Примечание.** При поиске по полям с атрибутом `searchable` результаты иногда могут быть неожиданными. Лексический анализатор использует алгоритмы, применимые для английского текста (с апострофами, запятыми в числах и т. д.). Например, поиск по запросу `search=123,456` вернет совпадения для одного условия — 123,456, а не для двух отдельных условий 123 и 456, так как запятые в английском используются в качестве разделителей групп разрядов в больших числах. В связи с этим для разделения условий в параметре `search` рекомендуется вместо знаков пунктуации использовать пробелы.

`searchMode=any|all` (необязательный, значение по умолчанию — `any`): указывает, необходимо ли совпадение по всем условиям или по любому из них, чтобы документ был возвращен в числе результатов.

`searchFields=[string]` (необязательный): список полей через запятую, в которых нужно искать указанный текст. Для целевых полей должен быть задан атрибут `searchable`.

`$skip=#` (необязательный): количество результатов поиска, которые нужно пропустить (максимальное значение — 100 000). Если нужно выполнить последовательный поиск по документам, однако воспользоваться параметром `$skip` нельзя из-за этого ограничения, попробуйте упорядочить результаты (параметр `$orderby`) по полностью упорядоченному ключу и отфильтровать их (`$filter`) с помощью запроса в диапазоне.

`$top=#` (необязательный): количество результатов поиска, которые нужно вернуть. Значение по умолчанию — 50. Если указано значение больше 1000, а количество результатов превышает 1000, будут возвращены только первые 1000 результатов, а также ссылка на следующую страницу (см. `@odata.nextLink` в [примере ниже](#SearchResponse)).

`$count=true|false` (необязательный, значение по умолчанию — `false`): указывает, нужно ли вернуть общее количество результатов. Если для этого параметра задать значение `true`, это может повлиять на производительность. Обратите внимание на то, что возвращается приблизительное количество результатов.

`$orderby=[string]` (необязательный): список выражений через запятую для сортировки результатов. Выражение может быть именем поля или вызовом функции `geo.distance()`. После выражения можно указать атрибут (`asc` сортировка по возрастанию) или `desc` (сортировка по убыванию). По умолчанию результаты сортируются по возрастанию. При равенстве позиций порядок определяется по показателю совпадения документа. Если параметр `$orderby` не указан, по умолчанию документы сортируются в убывающем порядке по показателю совпадения. Максимальное количество предложений `$orderby` — 32.

`$select=[string]` (необязательный): список извлекаемых полей через запятую. Если этот параметр не указан, возвращаются все поля, помеченные в схеме как подлежащие извлечению. Чтобы явным образом запросить все поля, задайте для этого параметра значение `*`.

`facet=[string]` (ноль или больше параметров): поле, используемое для аспектирования. Это строковое значение может содержать параметры аспектирования в виде перечисленных через запятую пар `name:value`. Ниже перечислены возможные параметры.

- `count` (количество условий аспектирования; значение по умолчанию — 10). Максимального предела нет, однако чем больше количество, чем сильнее это влияет на производительность (особенно если поле аспекта содержит большое число уникальных элементов).
  - Пример. `facet=category,count:5` возвращает первые пять категорий в результатах аспектирования.  
  - **Примечание.** Если значение параметра `count` меньше числа уникальных элементов, результаты могут быть неточными. Это связано с особенностями распределения запросов аспектирования по сегментам. Увеличение значения `count` обычно повышает точность подсчета элементов, но за счет ухудшения производительности. 
- `sort` (`count` — сортировка по количеству в порядке *убывания*, `-count` — сортировка по количеству в порядке *возрастания*, `value` — сортировка по значению в порядке *возрастания*, `-value` — сортировка по значению в порядке *убывания*)
  - Пример. `facet=category,count:3,sort:count` возвращает первые три категории в результатах аспектирования, отсортированные в убывающем порядке по количеству документов с названием каждого из городов. Например, если первые три категории — «бюджетные», «мотели» и «люкс», при этом для категории «бюджетные» найдено 5 документов, для категории «мотели» — 6 документов, а для категории «люкс» — 4 документа, то контейнеры возвращаются в следующем порядке: «мотели», «бюджетные», «люкс».
  - Пример. `facet=rating,sort:-value` возвращает контейнеры со всеми возможными значениями оценки rating, отсортированные в убывающем порядке по значению. Например, для оценок от 1 до 5 контейнеры будут отсортированы в последовательности 5, 4, 3, 2, 1 независимо от количества документов с каждой из оценок.
- `values` (разделенные символами вертикальной черты числовые значения или значения типа `Edm.DateTimeOffset`, задающие динамический набор значений записей аспектов)
  - Пример. `facet=baseRate,values:10|20` возвращает три контейнера: один для базового тарифа от 0 до 10 не включительно, один — от 10 до 20 не включительно, и один — от 20 и выше.
  - Пример. `facet=lastRenovationDate,values:2010-02-01T00:00:00Z` возвращает два контейнера: один для гостиниц, отремонтированных до февраля 2010 г., и один — для гостиниц, отремонтированных 1 февраля 2010 г. или позже.
- `interval` (целочисленный интервал больше 0 для числе либо `minute`, `hour`, `day`, `week`, `month`, `quarter` или `year` для значений даты и времени)
  - Пример. `facet=baseRate,interval:100` возвращает контейнеры для диапазонов базового тарифа с интервалом 100. Например, для базовых тарифов от 60 до 600 долларов будут возвращены контейнеры 0–100, 100–200, 200–300, 300–400, 400–500 и 500–600.
  - Пример: `facet=lastRenovationDate,interval:year` возвращает по одному контейнеру для каждого года, в течение которого выполнялся ремонт гостиниц.
- **Примечание.** Параметры `count` и `sort` можно использовать в одном запросе аспектирования, однако их нельзя объединять параметрами `interval` и `values`, а параметры `interval` и `values` также нельзя использовать в сочетании.

`$filter=[string]` (необязательный): выражение структурированного поиска в стандартном синтаксисе OData. Более подробные сведения о подмножестве синтаксических конструкций OData, которые поддерживаются в службе поиска Azure, см. в разделе [Синтаксис выражений OData](#ODataExpressionSyntax).

`highlight=[string]` (необязательный): набор имен полей через запятую, используемых для выделения совпадений. Для выделения можно использовать только поля с атрибутом `searchable`.

  `highlightPreTag=[string]` (необязательный): строковый тег, который добавляется в начале строки выделения количества совпадений. Для него должно быть задано значение `highlightPostTag`. Зарезервированные символы в составе URL должно быть экранированы знаком процента (например, %23 вместо #).

  `highlightPostTag=[string]` (необязательный): строковый тег, который добавляется в конце строки выделения количества совпадений. Для него должно быть задано значение `highlightPreTag`. Зарезервированные символы в составе URL должно быть экранированы знаком процента (например, %23 вместо #).

`scoringProfile=[string]` (необязательный): имя профиля оценки для сортировки результатов по показателю совпадения документов.

`scoringParameter=[string]` (ноль или больше параметров): задает значения параметров, определенных в функции оценки (например, `referencePointParameter`), в формате «имя:значение». Например, если в профиле оценки определена функция с параметром mylocation, строка запроса может содержать параметр «&scoringParameter=mylocation:-122.2,44.8».

`api-version=[string]` (обязательный). Допустимые значения: `2014-07-31-Preview` и `2014-10-20-Preview`. Для каждого запроса можно выбирать свою версию API, определяющую особенности его поведения, однако рекомендуется использовать одну версию во всем коде. В большинстве случаев оптимальной версией является `2014-07-31-Preview`. В версии `2014-10-20-Preview` доступны экспериментальные функции. Более подробные сведения см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx).

Примечание. Для этой операции `api-version` указывается в качестве параметра запроса.

**Заголовки запроса**

В списке ниже перечислены обязательные и необязательные заголовки запроса.

- `api-key`: заголовок `api-key` используется для проверки подлинности запроса в службе поиска. Это строковое значение, уникальное для URL службы. В запросе **поиска** для параметра `api-key` может быть указан ключ администратора или ключ запроса.
 
Для формирования URL-адреса запроса также понадобится имя службы. Имя и `api-key` можно найти в панели мониторинга службы на портале предварительной версии Azure. Дополнительные сведения о навигации по страницам см. в статье [Начало работы со службой поиска Azure](search-get-started.md).

**Тело запроса**

Нет.

<a name="SearchResponse"></a> **Ответ**

Код состояния: в качестве успешного ответа возвращается код «200 — ОК».

    {
      "@odata.count": # (if $count=true was provided in the query),
      "@search.facets": { (if faceting was specified in the query)
        "facet_field": [
          {
            "value": facet_entry_value (for non-range facets),
            "from": facet_entry_value (for range facets),
            "to": facet_entry_value (for range facets),
            "count": number_of_documents
          }
        ],
        ...
      },
      "value": [
        {
          "@search.score": document_score (if a text query was provided),
          "@search.highlights": {
            field_name: [ subset of text, ... ],
            ...
          },
          key_field_name: document_key,
          field_name: field_value (retrievable fields or specified projection),
          ...
        },
        ...
      ],
      "@odata.nextLink": (URL to fetch the next page of results if $top is greater than 1000)
    }
    
**Примеры**

Дополнительные примеры можно найти в статье [Синтаксис выражений OData для поиска Azure](https://msdn.microsoft.com/library/azure/dn798921.aspx).

1) Получение из индекса документов, отсортированных по дате.

    GET /indexes/hotels/docs?search=*&$orderby=lastRenovationDate desc&api-version=2014-10-20-Preview

ПРИМЕЧАНИЕ. Значения полей даты и времени определяются с точностью до миллисекунды. Если отправить отметку времени с более точным значением (например, как в значении секунд для отметки 10:30:09.7552052), возвращаемое значение округляется вверх (в этом примере — до 10:30:09.7550000).

2) Аспектный поиск: получение из индекса аспектов по категориям, оценкам, тегам, а также документов с базовым тарифом baseRate в определенных диапазонах.

    GET /indexes/hotels/docs?search=test&facet=category&facet=rating&facet=tags&facet=baseRate,values:80|150|220&api-version=2014-10-20-Preview

3) Уточнение результатов аспектного поиска из предыдущего запроса с помощью фильтра после того, как пользователь выбирает оценку 3 и категорию «мотели».

    GET /indexes/hotels/docs?search=test&facet=tags&facet=baseRate,values:80|150|220&$filter=rating eq 3 and category eq 'Motel'&api-version=2014-10-20-Preview

4) Установка для результатов аспектного поиска верхнего предела на количество уникальных условий поиска, возвращаемых запросом. Значение по умолчанию — 10, однако его можно увеличивать и уменьшать с помощью параметра `count` в атрибуте `facet`:

    GET /indexes/hotels/docs?search=test&facet=city,count:5&api-version=2014-10-20-Preview

5) Поиск в индексе по определенным полям (например, в зависимости от языка).

    GET /indexes/hotels/docs?search=hôtel&searchFields=description_fr&api-version=2014-10-20-Preview

6) Поиск в индексе по нескольким полям. Например, в одном индексе можно хранить и искать данные в нескольких доступных для поиска полях на разных языках. Если в одном документе есть описания на английском и французском, в результатах поиска можно вернуть любые или все документы по запросу:

	GET /indexes/hotels/docs?search=hotel&searchFields=description,description_fr&api-version=2014-10-20-Preview
	
Обратите внимание на то, что запрос можно отправить только к одному индексу. Не создавайте отдельные индексы для каждого языка, если не планируете отправлять к ним запросы по отдельности.

7) Разбиение на страницы: получение первой страницы элементов (размер страницы — 10).

    GET /indexes/hotels/docs?search=*&$skip=0&$top=10&api-version=2014-10-20-Preview

7) Разбиение на страницы: получение второй страницы элементов (размер страницы — 10).

    GET /indexes/hotels/docs?search=*&$skip=10&$top=10&api-version=2014-10-20-Preview

9) Получение определенного набора полей.

    GET /indexes/hotels/docs?search=*&$select=hotelName,description&api-version=2014-10-20-Preview

10) Поиск документов, соответствующих определенному поисковому выражению.

    GET /indexes/hotels/docs?$filter=(baseRate ge 60 and baseRate lt 300) or hotelName eq 'Fancy Stay'&api-version=2014-10-20-Preview

11) Поиск в индексе фрагментов с выделением количества совпадений.

    GET /indexes/hotels/docs?search=something&highlight=description&api-version=2014-10-20-Preview
    
12) Извлечение из индекса документов, отсортированных по признаку расстояния (от минимального до максимального) от определенного места.

    GET /indexes/hotels/docs?search=something&$orderby=geo.distance(location, geography'POINT(-122.12315 47.88121)')&api-version=2014-10-20-Preview

13) Поиск в индексе с использованием профиля оценки geo, который содержит две функции оценки расстояния: в одной из них определен параметр currentLocation, в другой — параметр lastLocation.

    GET /indexes/hotels/docs?search=something&scoringProfile=geo&scoringParameter=currentLocation:-122.123,44.77233&scoringParameter=lastLocation:-121.499,44.2113&api-version=2014-10-20-Preview


<a name="LookupAPI"></a>
##Запрос документов##

Операция **запроса документа** возвращает определенный документ из службы поиска Azure. Она применяется в ситуации, когда пользователь щелкает по тому или иному результату поиска и необходимо получить определенные сведения о соответствующем документе.

    GET https://[service name].search.windows.net/indexes/[index name]/docs/[key]?[query parameters] 
    api-key: [admin key]
    
**Запрос**

Запросы к службе отправляются по протоколу HTTPS. **Запрос документа** формируется следующим образом:

    GET /indexes/[index name]/docs/key?[query parameters] 

Кроме того, для поиска по ключу можно использовать традиционный синтаксис OData:

    GET /indexes('[index name]')/docs('[key]')?[query parameters]

URL запроса содержит [имя индекса] и [ключ], который указывает, какой именно документ нужно извлечь из данного индекса. За один раз можно получить только один документ. Получить сразу несколько документов можно с помощью запроса **поиска**.

**Параметры запроса**

`$select=[string]` (необязательный): список извлекаемых полей через запятую. Если этот параметр не указан или содержит значение `*`, возвращаются все поля, помеченные в схеме как подлежащие извлечению и входящие в проекцию.

`api-version=[string]` (обязательный). Допустимые значения: `2014-07-31-Preview` и `2014-10-20-Preview`. Для каждого запроса можно выбирать свою версию API, определяющую особенности его поведения, однако рекомендуется использовать одну версию во всем коде. В большинстве случаев оптимальной версией является `2014-07-31-Preview`. В версии `2014-10-20-Preview` доступны экспериментальные функции. Более подробные сведения см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx).

Примечание. Для этой операции `api-version` указывается в качестве параметра запроса.

**Заголовки запроса**

В списке ниже перечислены обязательные и необязательные заголовки запроса.

- `api-key`: заголовок `api-key` используется для проверки подлинности запроса в службе поиска. Это строковое значение, уникальное для URL службы. В **запросе документа** для параметра `api-key` может быть указан ключ администратора или ключ запроса.
 
Для формирования URL-адреса запроса также понадобится имя службы. Имя и `api-key` можно найти в панели мониторинга службы на портале предварительной версии Azure. Дополнительные сведения о навигации по страницам см. в статье [Начало работы со службой поиска Azure](search-get-started.md).

**Тело запроса**

Нет.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код «200 — ОК».

    {
      field_name: field_value (fields matching the default or specified projection)
    }
    
**Пример**

Запрос документа со значением ключа 2.

    GET /indexes/hotels/docs/2?api-version=2014-10-20-Preview

Запрос документа со значением ключа 3 с помощью синтаксиса OData:

    GET /indexes('hotels')/docs('3')?api-version=2014-10-20-Preview

<a name="CountDocs"></a>
##Подсчет документов##

Операция **подсчета документов** возвращает количество документов в индексе поиска. Синтаксическая конструкция `$count` является частью протокола OData.

    GET https://[service name].search.windows.net/indexes/[index name]/docs/$count?api-version=[api-version]
    Accept: text/plain
    api-key: [admin key]
    
**Запрос**

Запросы к службе отправляются по протоколу HTTPS. Для отправки запроса на **подсчет документов** можно использовать метод GET.

Параметр [имени индекса] в URI запроса указывает службе, для какого именно индекса требуется вернуть количество документов в коллекции.

Параметр `api-version` является обязательным. Допустимые значения: `2014-07-31-Preview` и `2014-10-20-Preview`. Для каждого запроса можно выбирать свою версию API, определяющую особенности его поведения, однако рекомендуется использовать одну версию во всем коде. В большинстве случаев оптимальной версией является `2014-07-31-Preview`. В версии `2014-10-20-Preview` доступны экспериментальные функции. Более подробные сведения см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx).

**Заголовки запроса**

В списке ниже перечислены обязательные и необязательные заголовки запроса.

- `Accept`: для этого заголовка задается значение `text/plain`.
- `api-key`: заголовок `api-key` используется для проверки подлинности запроса в службе поиска. Это строковое значение, уникальное для URL службы. В запросе на **подсчет документов** для параметра `api-key` может быть указан ключ администратора или ключ запроса.
 
Для формирования URL-адреса запроса также понадобится имя службы. Имя и `api-key` можно найти в панели мониторинга службы на портале предварительной версии Azure. Дополнительные сведения о навигации по страницам см. в статье [Начало работы со службой поиска Azure](search-get-started.md).

**Тело запроса**

Нет.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код «200 — ОК».

Тело ответа содержит целочисленное значение количества, отформатированное в виде обычного текста.

<a name="Suggestions"></a>
##Предложения##

Операция **Предложения** возвращает предложения на основе частичных исходных данных. Как правило, она используется в полях поиска и позволяет предложить пользователям варианты при вводе поисковых условий.

Запросы предложений возвращают целевые документы, поэтому текст предложений может повторяться, если несколько документов соответствуют одному и тому же набору исходных данных для поиска. С помощью атрибута `$select` можно извлечь другие поля документа (в том числе ключ), позволяющие определить, какому именно документу соответствует то или иное предложение.

    GET https://[service name].search.windows.net/indexes/[index name]/docs/suggest?[query parameters]
    api-key: [admin key]


**Запрос**

Запросы к службе отправляются по протоколу HTTPS. Для отправки запроса **получение предложений** можно использовать метод GET.

В URI запроса указывается имя индекса. Он также содержит введенный фрагмент условия поискового запроса.

**Параметры запроса**

`search=[string]` — искомый текст, на основе которого должны быть выданы предложения. Минимальная длина — 3 знака, максимальная — 25.

`highlightPreTag=[string]` (необязательный, значение по умолчанию — `) - a string tag that prepends to search hits. Must be set with `highlightPostTag. Зарезервированные символы в составе URL должно быть экранированы знаком процента (например, %23 вместо #).

`highlightPostTag=[string]` (необязательный, значение по умолчанию — `) - a string tag that appends to search hits. Must be set with `highlightPreTag. Зарезервированные символы в составе URL должно быть экранированы знаком процента (например, %23 вместо #).

`suggesterName=[string]` (необязательный): имя средства подбора, указанное в коллекции `suggesters` в определении индекса. Если этот параметр не используется, предложения возвращаются на основе предыдущей версии реализации, которая использует поля с атрибутом `"suggestions": true` и поддерживает только префиксный поиск совпадений.

`fuzzy=[boolean]` (необязательно, значение по умолчанию — false): когда для этого параметра задано значение true, API возвращает предложения, даже если в искомом тексте заменен или отсутствует символ. В определенных ситуациях это улучшает результат, однако ведет к снижению производительности, так как запросы по нечеткому соответствию обрабатываются медленнее и потребляют больше ресурсов.

`searchFields=[string]` (необязательный): список полей через запятую, в которых нужно искать указанный текст. Для целевых полей должен быть разрешен поиск предложений.

`$top=#` (необязательный, значение по умолчанию — 5): количество получаемых предложений. Это значение должно быть в диапазоне от 1 до 100.

`$filter=[string]` (необязательный): выражение для фильтрации документов, по которым производится поиск предложений.

`$orderby=[string]` (необязательный): список выражений через запятую для сортировки результатов. Выражение может быть именем поля или вызовом функции `geo.distance()`. После выражения можно указать атрибут (`asc` сортировка по возрастанию) или `desc` (сортировка по убыванию). По умолчанию результаты сортируются по возрастанию. Максимальное количество предложений `$orderby` — 32.

`$select=[string]` (необязательный): список извлекаемых полей через запятую. Если этот параметр не указан, возвращаются только ключ документа и текст предложения.

`api-version=[string]` (обязательный). Допустимые значения: `2014-07-31-Preview` и `2014-10-20-Preview`. Для каждого запроса можно выбирать свою версию API, определяющую особенности его поведения, однако рекомендуется использовать одну версию во всем коде. В большинстве случаев оптимальной версией является `2014-07-31-Preview`. В версии `2014-10-20-Preview` доступны экспериментальные функции. Более подробные сведения см. в статье [Управление версиями службы поиска](http://msdn.microsoft.com/library/azure/dn864560.aspx).

Примечание. Для этой операции `api-version` указывается в качестве параметра запроса.

**Заголовки запроса**

В списке ниже перечислены обязательные и необязательные заголовки запроса.

- `api-key`: заголовок `api-key` используется для проверки подлинности запроса в службе поиска. Это строковое значение, уникальное для URL службы. В запросе на **получение предложений** для параметра `api-key` может быть указан ключ администратора или ключ запроса.

  Для формирования URL-адреса запроса также понадобится имя службы. Имя и `api-key` можно найти в панели мониторинга службы на портале предварительной версии Azure. Дополнительные сведения о навигации по страницам см. в статье [Начало работы со службой поиска Azure](search-get-started.md).

**Тело запроса**

Нет.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код «200 — ОК».

    {
      "value": [
        {
          "@search.text": "...",
          "<key field>": "..."
        },
        ...
      ]
    }

Если вы используете параметр проекции для извлечения полей, они включаются в каждый элемент массива:

    {
      "value": [
        {
          "@search.text": "...",
          "<key field>": "..."
          <other projected data fields>
        },
        ...
      ]
    }

 **Пример**

Получение пяти предложений для фрагмента поискового запроса lux:

    GET /indexes/hotels/docs/suggest?search=lux&$top=5&suggesterName=sg&api-version=2014-10-20-Preview





<!--HONumber=54-->