<properties
   pageTitle="Размещение веб-приложений в Docker | Microsoft Azure"
   description="Узнайте, как использовать Visual Studio для размещения веб-приложения в контейнере Docker."
   services="visual-studio-online"
   documentationCenter="na"
   authors="TomArcher"
   manager="douge"
   editor="" />
<tags
   ms.service="multiple"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="multiple"
   ms.date="01/30/2016"
   ms.author="tarcher" />

# Размещение веб-приложений в Docker

[Docker](https://www.docker.com/whatisdocker/) — это облегченная платформа контейнеров, чем-то похожая на виртуальную машину, которую можно использовать для размещения приложений и служб. Visual Studio поддерживает Docker в Ubuntu, CoreOS и Windows.

В этом примере показано, как использовать расширение Visual Studio 2015 Tools for Docker для публикации приложения ASP.NET 5 в виртуальной машине под управлением Ubuntu Linux (далее "узел Docker") в Azure с установленным расширением Docker, а также для публикации веб-приложения ASP.NET 5. Те же инструкции можно использовать для публикации в контейнер Windows.

С помощью параметра **Пользовательский узел** вы можете опубликовать приложение в новый узел Docker, размещенный в Azure, на локальный сервер, Hyper-V или узел Boot2Docker. После публикации приложения на узле Docker можно воспользоваться инструментами командной строки для взаимодействия с контейнером, в котором было опубликовано приложение.

## Создание и публикация нового контейнера Docker

В этих процедурах вы создадите новый проект веб-приложения ASP.NET 5, затем создадите узел контейнера и выполните сборку и запуск проекта веб-приложения в контейнере Docker. Для начала загрузите и установите [Visual Studio 2015 Tools for Docker](https://aka.ms/DockerToolsForVS).

### Добавление проекта веб-приложения ASP.NET 5

1. Создайте проект веб-приложения ASP.NET. В главном меню выберите **Файл**, **Новый проект**. В меню **C#**, **Веб** выберите **Веб-приложение ASP.NET**.

1. В списке **Шаблоны предварительного просмотра ASP.NET 5** выберите **Веб-сайт**.

1. Поскольку веб-приложение будет размещаться и запускаться в Docker, снимите флажок **Разместить в облаке**, если он выбран, а затем нажмите кнопку **ОК**.

  ![][0]

  В этот момент в приложение обычно добавляется код, который делает что-то полезное, но для этого примера оставим проект без изменений с параметрами по умолчанию. (Обратите внимание, что также можно выбрать существующие веб-приложения ASP.NET 5).

### Публикация проекта

1. В контекстном меню проекта ASP.NET выберите **Опубликовать**.

1. В разделе **Выбор цели публикации** диалогового окна **Публикация веб-проекта** нажмите кнопку **Контейнеры Docker**.

    Если вы не видите кнопки "Контейнеры Docker", убедитесь в том, что вы установили Visual Studio 2015 Tools для Docker и выбрали шаблон веб-сайта ASP.NET 5 в предыдущей процедуре.

    ![][1]

    Откроется диалоговое окно **Выбрать виртуальную машину Docker**. В нем можно указать узел Docker, в котором вы хотите опубликовать проект. Вы можете создать новый узел Docker или выбрать существующую виртуальную машину, размещенную в Azure или в другом месте. Далее в этом примере мы создадим новый узел Docker в Azure.

1. Если вы уже выполнили вход в учетную запись Azure, перейдите к шагу 5. Если нет, нажмите кнопку **Добавить учетную запись**.

    ![][2]

1. В диалоговом окне **Вход в Visual Studio** введите адрес электронной почты для подписки Azure и нажмите кнопку **Продолжить**.

1. Нажмите кнопку **Создать**, чтобы создать новую виртуальную машину Docker в Azure, затем нажмите кнопку **ОК**.

    ![][3]

    Обратите внимание, что также можно использовать существующий узел Docker. Для этого выберите его из раскрывающегося списка **Существующие виртуальные машины Docker в Azure** вместо нажатия кнопки **Создать**. Этот список содержит не только узлы контейнера, но и все виртуальные машины для клиента Azure.

    В качестве альтернативы можно опубликовать приложение в пользовательский узел Docker. Дополнительные сведения см. в разделе **Создание пользовательского узла Docker** далее в этой статье.

1. Введите следующую информацию в диалоговом окне **Создание виртуальной машины в Microsoft Azure**. Когда все будет готово, нажмите кнопку **ОК**. После этого будет создана виртуальная машина под управлением Linux с настроенным расширением Docker.

    ![][4]

    Обратите внимание, что вы также можете создать узел контейнера Windows с помощью Windows Server 2016 Technical Preview 3 (TP3).

    ![][8]

    |Имя свойства|Настройка|
    |---|---|
    |Расположение|Укажите в этом параметре регион, ближайший к вашему языковому стандарту.|
    |DNS-имя|Укажите уникальное имя виртуальной машины. Если указанное имя будет принято Azure, справа появится зеленый кружок с белым флажком. Если имя не будет принято, появится красный кружок с белым крестиком. В этом случае введите новое уникальное имя.|
    |Образ —|Выберите образ операционной системы для использования в узле Docker (при наличии). Для этого примера выберите образ Ubuntu Server. (Обратите внимание, что образ Windows Server теперь доступен в списке доступных образов.)|
    |Имя пользователя|Укажите уникальное имя пользователя для виртуальной машины.|
    |Пароли|Введите пароль для пользователя, а затем подтвердите его.|
    |Каталог сертификатов |Указывает каталог, в котором хранятся сертификаты Docker. Вы можете создать новую папку или выбрать существующую, однако рекомендуется использовать папку для сертификатов по умолчанию (C:\\Users\\ [*имя пользователя*] \\.docker). В противном случае параметры проверки подлинности не смогут быть извлечены автоматически при повторном использовании одного и того же узла в другом проекте или системе.|

1. Нажмите кнопку с многоточием (...) рядом с записью **Каталог сертификатов**, а затем создайте новую папку для сертификатов Docker или перейдите к существующей.

    Если сертификаты Docker, необходимые для виртуальной машины, не найдены, рядом с разделом "Каталог сертификатов" отображается значок с восклицательным знаком, сообщающий, что необходимые сертификаты не найдены и что перед выполнением следующего действия все существующие сертификаты будут удалены и затем воссозданы заново.

1. Нажмите кнопку **ОК**, чтобы приступить к созданию виртуальной машины. Вы получите сообщение о создании виртуальной машины в Azure.

    Visual Studio создает файл шаблона диспетчера ресурсов Azure, файл параметров и сценарий PowerShell, чтобы в будущем вы смогли снова выполнить эти команды.

    ![][7]

    Ход выполнения операции можно отслеживать в окне **Вывод**. Для развертывания виртуальной машины Visual Studio вызывает сценарий PowerShell. Этот сценарий использует командлеты Azure PowerShell для развертывания группы ресурсов Azure. Затем другой сценарий PowerShell выполняет команды Docker для публикации, так же как при создании узла Docker вручную.

    Подготовка узла Docker может занять некоторое время, поэтому проверяйте состояние операции в окне "Вывод", чтобы увидеть, когда операция завершится.

1. После завершения подготовки узла Docker в Azure вы можете проверить состояние своей учетной записи на портале Azure. В категории **Виртуальная машина** на портале Azure должна появиться новая виртуальная машина.

1. Когда подготовка узла Docker будет завершена, вернитесь назад и опубликуйте проект веб-приложения. В контекстном меню для узла проекта веб-приложения в **Обозревателе решений** выберите **Опубликовать**. Visual Studio создает файл публикации на основе созданной виртуальной машины.

1. На вкладке **Подключения** в диалоговом окне **Публикация веб-проекта** установите флажок **Проверить подключение**, чтобы проверить готовность узла Docker. Если подключение надежное, нажмите кнопку **Опубликовать**, чтобы опубликовать веб-приложение.

    Если вы публикуете приложение на узле Docker впервые, может потребоваться некоторое время для загрузки всех базовых образов, которые указаны в файле Docker (в формате **FROM** *имя образа*).

    Обратите внимание, что формат файла Docker различается в зависимости от операционной системы. При повторной публикации в другую операционную систему необходимо переименовать файл Docker, чтобы Visual Studio мог создать новый файл по умолчанию в зависимости от целевой ОС. Например, если вы выполнили публикацию в контейнер Linux и позднее решили выполнить публикацию в Windows, необходимо переименовать файл Docker в уникальное имя, например DockerLinux. Затем при повторной публикации в Windows Visual Studio повторно создаст файл Docker по умолчанию для Windows. Позже при любой повторной публикации просто выберите соответствующий файл Docker для операционной системы.

## Создание пользовательского узла Docker

В предыдущей процедуре вы создали виртуальную машину Docker, размещенную в Azure. Однако если у вас уже есть узел Docker в другом месте, вы можете выполнить публикацию в него вместо Azure.

### Как создать пользовательский узел Docker

1. В диалоговом окне **Выбор виртуальной машины Docker** установите флажок **Пользовательский узел Docker**.

    ![][5]

1. Нажмите кнопку **ОК**.

1. В диалоговом окне **Публикация веб-сайта** укажите значения следующих параметров в разделе **Пользовательский узел Docker**: URL-адрес сервера, имя образа, расположение файла Docker, номера портов узла и контейнера.

    В разделе **Дополнительные параметры Docker** можно просмотреть или изменить параметры проверки подлинности и выполнения, а также параметры командной строки Docker.

    ![][6]

1. После ввода всех необходимых значений нажмите кнопку **Проверить подключение**, чтобы убедиться, что подключение к узлу Docker работает правильно.

1. Если все в порядке, вы можете нажать кнопку **Далее**, чтобы просмотреть список компонентов, которые будут опубликованы, или нажать кнопку **Опубликовать**, чтобы немедленно опубликовать проект.

## Тестирование узла Docker

Теперь, когда проект опубликован на узле Docker в Azure, можно протестировать его, проверив его параметры. Поскольку инструменты командной строки Docker устанавливаются вместе с расширением Visual Studio, команды Docker можно набирать прямо в командной строке Windows.

Ниже описана процедура взаимодействия с узлом Docker, который был развернут в Azure.

### Как протестировать узел Docker

1. Откройте командную строку Windows.

1. Назначьте узел Docker и проверьте переменные среды. Для этого введите следующие команды в командной строке. (Замените *NameofAzureVM* на имя своего узла Docker).

    ```
    Set DOCKER_HOST=tcp://<NameofAzureVM>.cloudapp.net:2376
    Set DOCKER_TLS_VERIFY=1
    ```

    Вызов этих команд позволяет избежать добавления `–H (Host) tcp://<NameofAzureVM>.cloudapp.net:2376` и `--TLSVERIFY` ко всем выполняемым командам.

1. Теперь вы можете выполнить приведенные ниже команды, чтобы проверить, что узел Docker развернут и работает.

    |Команда|Описание|
    |---|---|
    |`docker info`|Получение сведений о версии Docker.|
    |`docker ps`|Получение списка запущенных контейнеров.|
    |`docker ps –a`|Получение списка контейнеров, включая остановленные объекты.|
    |`docker logs <Docker container name>`|Получение журнала для указанного контейнера.|
    |`docker images`|Получение списка образов.|

    Чтобы получить полный список команд Docker, просто введите команду `docker` в командной строке. Дополнительные сведения см. в разделе [Командная строка Docker](https://docs.docker.com/reference/commandline/cli/).

## Дальнейшие действия

Теперь, когда у вас есть узел Docker, вы можете выполнять для него команды Docker. Дополнительные сведения о Docker см. в [документации по Docker](https://docs.docker.com/) и [онлайн-руководстве по Docker](https://www.docker.com/tryit/).

Сведения об использовании расширения виртуальных машин Docker для Linux в Azure см. в статье [Расширение виртуальных машин Docker для Linux в Azure](/virtual-machines/virtual-machines-docker-vm-extension.md).

Проблемы при использовании Docker в Visual Studio описаны в статье [Устранение ошибок клиента Docker в Windows с помощью Visual Studio](vs-azure-tools-docker-troubleshooting-docker-errors.md).

[0]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796678.png
[1]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796679.png
[2]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796680.png
[3]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796681.png
[4]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796682.png
[5]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796683.png
[6]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796684.png
[7]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796685.png
[8]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796686.png

<!---HONumber=AcomDC_0204_2016-->