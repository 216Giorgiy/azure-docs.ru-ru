<properties
   pageTitle="Размещение веб-приложений в Docker | Microsoft Azure"
   description="Узнайте, как использовать Visual Studio для размещения веб-приложения в контейнере Docker."
   services="visual-studio-online"
   documentationCenter="na"
   authors="TomArcher"
   manager="douge"
   editor="" />
<tags
   ms.service="multiple"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="multiple"
   ms.date="02/10/2016"
   ms.author="tarcher" />

# Размещение веб-приложений в Docker

[Docker](https://www.docker.com/whatisdocker/) — это облегченная платформа контейнеров, чем-то похожая на виртуальную машину, которую можно использовать для размещения приложений и служб. Visual Studio поддерживает Docker в Ubuntu, CoreOS и Windows.

В этом примере показано, как использовать расширение **Инструменты Visual Studio 2015 для Docker** для публикации приложения ASP.NET 5 в виртуальной машине под управлением Ubuntu Linux (которая здесь называется узлом Docker) в Azure. Те же инструкции можно использовать для публикации в контейнер Windows.

После публикации приложения на узле Docker можно воспользоваться инструментами командной строки для взаимодействия с контейнером, в котором было опубликовано приложение.

## Создание и публикация нового контейнера Docker

В следующем разделе вы создадите новый проект веб-приложения ASP.NET 5, затем создадите узел контейнера и выполните сборку и запуск проекта веб-приложения в контейнере Docker. Для начала загрузите и установите [Visual Studio 2015 Tools for Docker](https://aka.ms/DockerToolsForVS).

### Добавление проекта веб-приложения ASP.NET 5

1. В меню Visual Studio выберите **Файл -> Создать -> Проект**. 

1. В разделе **Шаблоны** диалогового окна **Новый проект** выберите **Visual C#** > **Веб-проект**.

1. Выберите **веб-приложение ASP.NET** и укажите название нового проекта. (На снимках экрана в этой статье используется название проекта по умолчанию **WebApplication1**.)

1. Нажмите кнопку **OK**.

1. Поскольку веб-приложение будет размещаться и запускаться в Docker, снимите флажок **Разместить в облаке**, если он выбран, а затем нажмите кнопку **ОК**.

  ![][0]

  В этот момент вы обычно добавляете в веб-приложение полезный код. Мы постараемся сохранить этот пример простым, чтобы сосредоточить внимание на Docker. (Обратите внимание, что также можно выбрать существующее веб-приложение ASP.NET 5.)

### Публикация проекта
После создания проекта (или открытия существующего) выполните следующие действия для публикации проекта в контейнер Docker в Azure.

1. В обозревателе решений Visual Studio щелкните правой кнопкой мыши проект и выберите **Опубликовать** в контекстном меню проекта.

1. В разделе **Выбор цели публикации** диалогового окна **Публикация веб-проекта** нажмите кнопку **Контейнеры Docker**.

    Если вы не видите кнопки "Контейнеры Docker", убедитесь в том, что вы установили инструменты Visual Studio 2015 для Docker и выбрали шаблон веб-сайта ASP.NET 5 в предыдущем разделе.

    ![][1]

    В диалоговом окне **Выбор виртуальной машины Docker** можно указать узел Docker, в котором вы хотите опубликовать проект. Вы можете создать новый узел Docker или выбрать существующую виртуальную машину, размещенную в Azure или в другом месте. Далее в этом примере мы создадим новый узел Docker в Azure.

1. Если вы уже выполнили вход в учетную запись Azure, перейдите к шагу 5. Если вы не вошли в учетную запись, нажмите кнопку **Добавить учетную запись**.

    ![][2]

1. В диалоговом окне **Вход в Visual Studio** введите адрес электронной почты для подписки Azure и нажмите кнопку **Продолжить**.

1. Нажмите кнопку **Создать** для создания новой виртуальной машины Azure Docker и затем нажмите кнопку **ОК**.

    ![][3]

    Обратите внимание, что также можно использовать существующий узел Docker. Для этого выберите его из раскрывающегося списка **Существующие виртуальные машины Docker в Azure** вместо нажатия кнопки **Создать**. Обратите внимание, что список не ограничен только узлами контейнера; он содержит все виртуальные машины клиента Azure.

    В качестве альтернативы можно опубликовать приложение в пользовательский узел Docker. Дополнительные сведения см. в разделе [Создание пользовательского узла Docker](#provide-a-custom-docker-host) далее в этой статье.

1. Введите следующую информацию в диалоговом окне **Создание виртуальной машины в Microsoft Azure**. Закончив, нажмите кнопку **OK**. После этого будет создана виртуальная машина под управлением Linux с настроенным расширением Docker.

    ![][4]

    Обратите внимание, что вы также можете создать узел контейнера Windows с помощью Windows Server 2016 Technical Preview 3 (TP3).

    ![][8]

	|Имя свойства|Настройка|
	|---|---|
	|Расположение|Укажите в этом параметре регион, ближайший к вашему языковому стандарту.|
	|DNS-имя|Укажите уникальное имя виртуальной машины. Если указанное имя будет принято Azure, справа появится зеленый кружок с белым флажком. Если имя не будет принято, появится красный кружок с белым крестиком. В этом случае введите новое уникальное имя.|
	|Образ —|Выберите образ операционной системы для использования в узле Docker (при наличии). Для этого примера выберите образ Ubuntu Server. (Обратите внимание, что образ Windows Server теперь доступен в списке доступных образов.)|
	|Имя пользователя|Укажите уникальное имя пользователя для виртуальной машины.|
	|Пароли|Введите пароль для пользователя, а затем подтвердите его.|
	|Каталог сертификатов |Указывает папку, в которой хранятся сертификаты Docker. Вы можете создать новую папку или выбрать существующую, однако рекомендуется использовать папку для сертификатов по умолчанию (C:\\Users\\ [*имя\_пользователя*] \\.docker). В противном случае параметры проверки подлинности не смогут быть извлечены автоматически при повторном использовании одного и того же узла в другом проекте или системе.|

1. Нажмите кнопку с многоточием (...) рядом с записью **Каталог сертификатов**, а затем создайте новую папку для сертификатов Docker или перейдите к существующей.

    Если сертификаты Docker, необходимые для виртуальной машины, не найдены, рядом с разделом "Каталог сертификатов" отображается значок с восклицательным знаком, сообщающий, что необходимые сертификаты не найдены и что перед выполнением следующего действия все существующие сертификаты будут удалены и затем воссозданы заново.

1. Нажмите кнопку **ОК**, чтобы приступить к созданию виртуальной машины. Вы получите сообщение о создании виртуальной машины в Azure.

    Visual Studio создает файл шаблона диспетчера ресурсов Azure, файл параметров и сценарий PowerShell, чтобы в будущем вы смогли снова выполнить эти команды.

    ![][7]

    Ход выполнения операции можно отслеживать в окне **Вывод**. Для развертывания виртуальной машины Visual Studio вызывает сценарий PowerShell. Этот сценарий использует командлеты Azure PowerShell для развертывания группы ресурсов Azure. Затем другой сценарий PowerShell выполняет команды Docker для публикации, так же как при создании узла Docker вручную.

    Подготовка узла Docker может занять некоторое время, поэтому проверяйте состояние операции в окне "Вывод" Visual Studio, чтобы увидеть, когда операция завершится.

1. После завершения подготовки узла Docker в Azure вы можете проверить состояние своей учетной записи на портале Azure. В категории **Виртуальная машина** на портале Azure должна появиться новая виртуальная машина.

1. Когда подготовка узла Docker будет завершена, вернитесь назад и опубликуйте проект веб-приложения. В контекстном меню для узла проекта веб-приложения в **Обозревателе решений** выберите **Опубликовать**. Visual Studio создает файл публикации на основе созданной виртуальной машины.

1. На вкладке **Подключения** в диалоговом окне **Публикация веб-проекта** установите флажок **Проверить подключение**, чтобы проверить готовность узла Docker. Если подключение надежное, нажмите кнопку **Опубликовать**, чтобы опубликовать веб-приложение.

    Если вы публикуете приложение на узле Docker впервые, может потребоваться некоторое время для загрузки всех базовых образов, которые указаны в файле Docker (в формате **FROM** *имя образа*).

    Обратите внимание, что формат файла Docker различается в зависимости от операционной системы. При повторной публикации в другую операционную систему необходимо переименовать файл Docker, чтобы Visual Studio мог создать новый файл по умолчанию в зависимости от целевой ОС. Например, если вы выполнили публикацию в контейнер Linux и позднее решили выполнить публикацию в Windows, необходимо переименовать файл Docker в осмысленное, но уникальное имя, например DockerLinux. Затем при повторной публикации в Windows Visual Studio повторно создаст файл Docker по умолчанию для Windows. Позже при любой повторной публикации просто выберите соответствующий файл Docker для операционной системы.

## Создание пользовательского узла Docker

В предыдущем разделе вы увидели, как создать виртуальную машину Docker, размещенную в Azure. Однако если у вас уже есть узел Docker в другом месте, вы можете выполнить публикацию в этот узел вместо Azure.

### Как создать пользовательский узел Docker

1. В диалоговом окне **Выбор виртуальной машины Docker** установите флажок **Пользовательский узел Docker**.

    ![][5]

1. Нажмите кнопку **OK**.

1. В диалоговом окне **Публикация веб-сайта** укажите значения следующих параметров в разделе **Пользовательский узел Docker**: URL-адрес сервера, имя образа, расположение файла Docker, номера портов узла и контейнера.

    В разделе **Дополнительные параметры Docker** можно просмотреть или изменить параметры проверки подлинности и выполнения, а также параметры командной строки Docker.

    ![][6]

1. После ввода всех необходимых значений нажмите кнопку **Проверить подключение**, чтобы убедиться, что подключение к узлу Docker работает исправно.

1. Если все в порядке, вы можете нажать кнопку **Далее**, чтобы просмотреть список компонентов, которые будут опубликованы, или нажать кнопку **Опубликовать**, чтобы немедленно опубликовать проект.

## Тестирование узла Docker

Теперь, когда проект опубликован на узле Docker в Azure, можно протестировать его, проверив его параметры. Поскольку инструменты командной строки Docker устанавливаются вместе с расширением Visual Studio, команды Docker можно набирать прямо в командной строке Windows.

Ниже описана процедура взаимодействия с узлом Docker, который был развернут в Azure.

### Как протестировать узел Docker

1. Откройте командную строку Windows.

1. Назначьте узел Docker и проверьте переменные среды. Для этого введите следующие команды в командной строке. (Подставьте имя узла Docker в поле *NameofAzureVM* и регион, в котором он был создан, в поле *Регион*.)

    ```
    Set DOCKER_HOST=tcp://[NameOfAzureVM].[Region].cloudapp.azure.com:2376
    Set DOCKER_TLS_VERIFY=1
    ```

    Настройка этих переменных среды позволяет избежать необходимости задавать эти сведения для каждой выполненной команды Docker вручную.

1. Теперь вы можете выполнить приведенные ниже команды, чтобы проверить, что узел Docker развернут и работает.

	|Команда|Описание|
	|---|---|
	|`docker info`|Получение сведений о версии Docker.|
	|`docker ps`|Получение списка запущенных контейнеров.|
	|`docker ps –a`|Получение списка контейнеров, включая остановленные объекты.|
	|`docker logs <Docker container name>`|Получение журнала для указанного контейнера.|
	|`docker images`|Получение списка образов.|

    Чтобы получить полный список команд Docker, просто введите команду `docker` в командной строке и нажмите клавишу **&lt;Enter>**. Дополнительные сведения см. в разделе [Командная строка Docker](https://docs.docker.com/reference/commandline/cli/).

## Дальнейшие действия

Теперь, когда у вас есть узел Docker, вы можете выполнять для него команды Docker. Дополнительные сведения о Docker см. в [документации по Docker](https://docs.docker.com/) и [онлайн-руководстве по Docker](https://www.docker.com/tryit/).

Сведения об использовании расширения виртуальных машин Docker для Linux в Azure см. в статье [Расширение виртуальных машин Docker для Linux в Azure](virtual-machines/virtual-machines-linux-dockerextension.md).

Проблемы при использовании Docker в Visual Studio описаны в статье [Устранение ошибок клиента Docker в Windows с помощью Visual Studio](vs-azure-tools-docker-troubleshooting-docker-errors.md).

[0]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796678.png
[1]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796679.png
[2]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796680.png
[3]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796681.png
[4]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796682.png
[5]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796683.png
[6]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796684.png
[7]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796685.png
[8]: ./media/vs-azure-tools-docker-hosting-web-apps-in-docker/IC796686.png

<!---HONumber=AcomDC_0323_2016-->