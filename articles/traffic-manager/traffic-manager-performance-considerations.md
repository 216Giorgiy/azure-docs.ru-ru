<properties
   pageTitle="Рекомендации по производительности для диспетчера трафика Azure | Microsoft Azure"
   description="Общие сведения о производительности диспетчера трафика и о проверке производительности веб-сайта при использовании диспетчера трафика"
   services="traffic-manager"
   documentationCenter=""
   authors="kwill-MSFT"
   manager="adinah"
   editor="joaoma" />

<tags 
   ms.service="traffic-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="06/17/2015"
   ms.author="joaoma" />


# Рекомендации по безопасности для диспетчера трафика


Распространенный вопрос по диспетчеру трафика Azure касается проблем производительности, которые он может вызвать. Обычно возникают следующие вопросы: "Насколько увеличится задержка после добавления диспетчера трафика на веб-сайт?", "На сайте мониторинга указано, что мой веб-сайт вчера работал медленно в течение пары часов. Возникали ли в это время проблемы с диспетчером трафика?", "Где размещаются серверы диспетчера трафика? Я хочу убедиться, что они находятся в том же центре обработки данных, что и мой веб-сайт, чтобы производительность не понижалась".

На этой странице описывается непосредственное влияние на производительность, которое оказывает диспетчер трафика на веб-сайт. Если один ваш веб-сайт находится в восточной части США, а другой — в Азии, при сбое проверки диспетчера трафика для веб-сайта в восточной части США все ваши пользователи будут перенаправлены на веб-сайт в Азии, что повлияет на производительность, но это не будет связано непосредственно с диспетчером трафика.

  

## Важное примечание о том, как работает диспетчер трафика

http://msdn.microsoft.com/library/windowsazure/hh744833.aspx — это отличный ресурс, позволяющий узнать, как работает диспетчер трафика, но в нем содержится много информации, поэтому выделить основные сведения о производительности может быть сложно. Важные данные в документации по MSDN указаны в шагах 5 и 6 на рисунке 3. Ниже они описаны более подробно.

- Главным образом диспетчер трафика выполняет разрешение DNS. Это означает, что диспетчер трафика может повлиять на производительность веб-сайта только при первоначальном поиске DNS.
- О поиске DNS диспетчером трафика следует отметить следующее. Диспетчер трафика заполняет и регулярно обновляет обычные корневые DNS-серверы Майкрософт в соответствии с вашей политикой и результатами проверки. Поэтому даже во время первоначального поиска DNS диспетчер трафика не используется, так как запрос DNS обрабатывается обычными корневыми DNS-серверами Майкрософт. При сбое диспетчера трафика (т. е. при сбое проверки политики для виртуальных машин и обновления DNS) DNS-имя диспетчера трафика не будет затронуто, так как записи в DNS-серверах Майкрософт будут по-прежнему сохраняться. Единственное, на что это повлияет, — не будет выполнена проверка и обновление на основе политики (например, при сбое первичного сайта диспетчер трафика не сможет обновить DNS то сайта отработки отказа).
- Трафик НЕ проходит через диспетчер трафика. Также между клиентами и размещенными службами Azure отсутствует диспетчер трафика, играющий роль посредника. После завершения поиска DNS диспетчер трафика полностью удаляется из связи между клиентом и сервером.
- Поиск DNS происходит очень быстро, а полученные данные кэшируются. Скорость первоначального поиска DNS будет зависеть от клиента и настройки его DNS-серверов. Обычно клиент выполняет поиск DNS примерно за 50 мс (см. http://www.solvedns.com/dns-comparison/). После первоначального поиска результаты будут кэшированы на срок жизни DNS, что для диспетчера трафика по умолчанию составляет 300 секунд.
- Выбранная политика диспетчера трафика (производительность, отработка отказа, циклический перебор) не влияет на производительность DNS. Политика производительности может отрицательно повлиять на взаимодействие с пользователями, например если вы перенаправите пользователей США в службу, размещенную в Азии, но это не будет вызвано диспетчером трафика.

  

## Проверка производительности диспетчера трафика

Получить данные о производительности и поведении диспетчера трафика можно с помощью нескольких общедоступных веб-сайтов. Эти веб-сайты помогают определить задержку DNS и то, в какие размещенные службы перенаправляются ваши пользователи по всему миру. Обратите внимание, что большинство этих средств не кэшируют результаты DNS, поэтому при многоразовом выполнении тестов отобразится более полная информация по поиску DNS, тогда как клиенты, подключающиеся к конечной точке диспетчера трафика, увидят только влияние поиска DNS на производительность в течение срока жизни.


## Примеры средств измерения производительности


Одно из самых простых средств — это WebSitePulse. Введите URL-адрес, и вы увидите статистику, например время разрешения DNS, первый байт, последний байт и другую статистику производительности. Вы можете выбрать одно из трех расположений для проверки сайта. В этом примере при первом запуске поиск DNS выполняется за 0,204 с. При втором запуске теста в той же конечной точке диспетчера трафика поиск DNS занимает 0,002 с, так как результаты уже кэшированы.

http://www.websitepulse.com/help/tools.php


![pulse1](./media/traffic-manager-performance-considerations/traffic-manager-web-site-pulse.png)

Время DNS при кэшировании:


![pulse2](./media/traffic-manager-performance-considerations/traffic-manager-web-site-pulse2.png)



Еще одно полезное средство для получения времени разрешения одновременно из нескольких географических регионов — средство проверки веб-сайтов Watchmouse. Введите URL-адрес, чтобы узнать время разрешения DNS, время подключения и скорость из нескольких географических местоположений. Это средство также удобно при проверке на соответствие политике производительности для диспетчера трафика, так как позволяет увидеть, в какую размещенную службу перенаправляются разные пользователи по всему миру.

http://www.watchmouse.com/en/checkit.php


![pulse1](./media/traffic-manager-performance-considerations/traffic-manager-web-site-watchmouse.png)

http://tools.pingdom.com/ — по этой ссылке проверяется веб-сайт и предоставляется статистика производительности для каждого элемента на странице в виде графика. Если переключиться на вкладку "Анализ страницы", можно увидеть процент времени, затраченного на поиск DNS.

 

http://www.whatsmydns.net/ — на этом сайте будет выполнен поиск DNS из 20 различных географических местоположений, а результаты будут отображены на карте. Это отличное визуальное представление, которое помогает определить, к какой размещенной службе будут подключены клиенты.

 

http://www.digwebinterface.com — сайт, аналогичный сайту watchmouse. На нем отображается более подробная информация о DNS, в том числе записи CNAME и A. Установите в параметрах флажки "Выделить цветом выходные данные" и "Статистика", а для Nameservers выберите значение "Все".

## Заключение

Согласно приведенной выше информации, что диспетчер трафика влияет на производительность веб-сайта только при первом поиске DNS (время может разниться, но среднее значение — 50 мс), затем в течение срока жизни DNS производительность не затрагивается (по умолчанию 300 секунд), а после истечения срока жизни происходит обновление кэша DNS. Поэтому ответ на вопрос "Насколько увеличится задержка после добавления диспетчера трафика на веб-сайт?" — нинасколько.


## Дальнейшие действия


[Сведения о методах балансировки нагрузки диспетчера трафика](traffic-manager-load-balancing-methods.md)

[Обзор диспетчера трафика](../traffic-manmager-overview.md)

[Облачные службы](http://go.microsoft.com/fwlink/?LinkId=314074)

[Веб-сайты](http://go.microsoft.com/fwlink/p/?LinkId=393327)

[Операции с диспетчером трафика (справочник по REST API)](http://go.microsoft.com/fwlink/?LinkId=313584)

[Командлеты для диспетчера трафика Azure](http://go.microsoft.com/fwlink/p/?LinkId=400769)
 

<!---HONumber=August15_HO6-->