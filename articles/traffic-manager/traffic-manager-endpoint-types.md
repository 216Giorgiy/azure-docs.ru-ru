---
title: "Типы конечных точек диспетчера трафика | Документация Майкрософт"
description: "В этой статье описываются разные типы конечных точек, которые можно использовать с диспетчером трафика Azure"
services: traffic-manager
documentationcenter: 
author: kumudd
manager: timlt
editor: 
ms.assetid: 4e506986-f78d-41d1-becf-56c8516e4d21
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/11/2016
ms.author: kumud
translationtype: Human Translation
ms.sourcegitcommit: 69b94c93ad3e9c9745af8485766b4237cac0062c
ms.openlocfilehash: 2ced9e73a65160f4f3c8ba92affc143ca554d07c

---

# <a name="traffic-manager-endpoints"></a>Конечные точки диспетчера трафика
С помощью диспетчера трафика Microsoft Azure можно управлять распределением сетевого трафика среди приложений, развернутых в различных центрах обработки данных. В диспетчере трафика каждое развертывание приложения необходимо настроить в качестве конечной точки. Когда диспетчер трафика получает запрос DNS, затем выбирает доступную конечную точку и возвращает ее в ответе DNS. Выбор конечной точки зависит от ее текущего состояния и метода маршрутизации трафика. Дополнительные сведения см. в статье [Как работает диспетчер трафика](traffic-manager-how-traffic-manager-works.md).

Диспетчер трафика поддерживает три типа конечных точек:

* **конечные точки Azure** , используемые для служб, размещенных в Azure;
* **внешние конечные точки** , используемые для служб, размещенных за пределами Azure: локально или с помощью другого поставщика услуг размещения;
* **вложенные конечные точки** , используемые для объединения профилей диспетчера трафика, что позволяет создавать более гибкие и эффективные схемы маршрутизации трафика для поддержки потребностей более крупных и сложных развертываний.

Разные типы конечных точек можно объединять в одном профиле диспетчера трафика без каких-либо ограничений. В каждом профиле может содержаться любое сочетание типов конечных точек.

В следующих разделах каждый тип конечной точки описывается более подробно.

## <a name="azure-endpoints"></a>конечные точки Azure

Конечные точки Azure используются в диспетчере трафика для служб на основе Azure. Поддерживаются следующие типы ресурсов Azure:

* классические виртуальные машины IaaS и облачные службы PaaS;
* Веб-приложения
* ресурсы PublicIPAddress (которые можно подключить к виртуальным машинам: напрямую или с помощью Azure Load Balancer). Для использования в профиле диспетчера трафика ресурсам publicIpAddress необходимо присвоить DNS-имя.

PublicIPAddress — это ресурсы Azure Resource Manager. Они отсутствуют в классической модели развертывания. Таким образом, они поддерживаются только в Azure Resource Manager диспетчера трафика. Другие типы конечных точек поддерживаются для обеих моделей развертывания: Resource Manager и классической.

При использовании конечных точек Azure диспетчер трафика определяет время остановки и запуска классической виртуальной машины IaaS, облачной службы или веб-приложения. Это состояние отражается в состоянии конечной точки. Дополнительные сведения см. в разделе [Состояние конечной точки и профиля](traffic-manager-monitoring.md#endpoint-and-profile-status). При остановке базовой службы диспетчер трафика не проверяет работоспособность конечной точки и не направляет трафик на конечную точку. Для остановленного экземпляра не выставляются счета за использование диспетчера трафика. После перезапуска службы выставление счетов возобновляется, а конечная точка может получать трафик. На конечных точек PublicIpAddress такие события не происходят.

## <a name="external-endpoints"></a>внешние конечные точки

Внешние конечные точки используются для служб за пределами Azure. Например, это могут быть службы, размещенные локально или у другого поставщика услуг. В одном и том же профиле диспетчера трафика внешние конечные точки можно использовать как отдельно, так и в сочетании с конечными точками Azure. Объединение конечных точек Azure с внешними конечными точками позволяет реализовать различные сценарии:

* использование Azure для повышения избыточности в существующем локальном приложении в рамках модели отработки отказа "активный — активный" или "активный — пассивный";
* расширение существующего локального приложения в дополнительные географические расположения в Azure, чтобы уменьшить задержки отклика приложения для пользователей по всему миру. Дополнительные сведения см. в разделе [Метод маршрутизации трафика для повышения производительности](traffic-manager-routing-methods.md#performance-traffic-routing-method);
* использование Azure для получения дополнительной емкости для существующего локального приложения непрерывно или путем расширения в облако, чтобы обеспечить обработку всплеска запросов.

В некоторых случаях внешние конечные точки также можно использовать для ссылки на службы Azure (примеры см. в разделе [Часто задаваемые вопросы](#faq)). В этом случае счета за проверки работоспособности выставляются по тарифу конечных точек Azure, а не внешних конечных точек. Тем не менее, в отличие от конечных точек Azure, при остановке или удалении основной службы за проверки работоспособности будут по-прежнему выставляться счета, пока вы не отключите или удалите конечную точку в диспетчере трафика.

## <a name="nested-endpoints"></a>вложенные конечные точки

Вложенные конечные точки объединяют несколько профилей диспетчера трафика, что позволяет создавать гибкие и эффективные схемы маршрутизации трафика для поддержки потребностей более крупных и сложных развертываний. При использовании вложенных конечных точек дочерний профиль добавляется в качестве конечной точки в родительский профиль. Дочерний и родительский профили могут содержать другие конечные точки любого типа, в том числе другие вложенные профили. Дополнительную информацию см. в статье [Вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md).

## <a name="web-apps-as-endpoints"></a>Веб-приложения в качестве конечных точек

При настройке веб-приложений в качестве конечных точек в диспетчере трафика необходимо учитывать дополнительные рекомендации:

1. В диспетчере трафика можно использовать только веб-приложения с SKU уровня "Стандартный" или выше. Добавление веб-приложения с SKU более низкого уровня завершится ошибкой. Понижение уровня SKU для существующего веб-приложения приведет к тому, что диспетчер трафика перестанет отправлять трафик на веб-приложения.
2. Когда конечная точка получает HTTP-запрос, для определения веб-приложения, которое должно обработать запрос, используется заголовок узла. Заголовок узла содержит DNS-имя, используемое для отправки запроса, например contosoapp.azurewebsites.net. Чтобы использовать другое DNS-имя в веб-приложении, это имя необходимо зарегистрировать в качестве имени пользовательского домена приложения. При добавлении конечной точки веб-приложения в качестве конечной точки Azure DNS-имя в профиле диспетчера трафика автоматически регистрируется для приложения. При удалении конечной точки эта регистрация автоматически отменяется.
3. В каждом профиле диспетчера трафика может быть только одна конечная точка веб-приложения из каждого региона Azure. Чтобы обойти это ограничение, можно настроить веб-приложение как внешнюю конечную точку. Дополнительные сведения см. в разделе [Часто задаваемые вопросы](#faq).

## <a name="enabling-and-disabling-endpoints"></a>Включение и отключение конечных точек

Отключить конечную точку в диспетчере трафика целесообразно, если нужно временно удалить трафик из конечной точки, которая находится в режиме обслуживания или повторно развертывается. После восстановления конечной точки ее можно включить снова.

Конечные точки можно включать и отключать с помощью портала диспетчера трафика, с помощью PowerShell, интерфейса командной строки или REST API, которые поддерживаются как в Resource Manager, так и в классической модели развертывания.

> [!NOTE]
> Отключение конечной точки Azure никак не отражается на состоянии ее развертывания в Azure. Служба Azure (например, виртуальная машина или веб-приложение) остается запущенной и может получать трафик, даже если она отключена в диспетчере трафика. Трафик может направляться непосредственно на экземпляр службы, а не через DNS-имя в профиле диспетчера трафика. Дополнительные сведения см. в статье [Как работает диспетчер трафика](traffic-manager-how-traffic-manager-works.md).

Доступность каждой конечной точки для приема трафика зависит от следующих факторов:

* состояние профиля (включен или отключен);
* состояние конечной точки (включена или отключена);
* результаты проверки работоспособности для конкретной конечной точки.

Дополнительные сведения см. в разделе [Состояние конечной точки и профиля](traffic-manager-monitoring.md#endpoint-and-profile-status).

> [!NOTE]
> Так как диспетчер трафика работает на уровне DNS, он не влияет на существующие подключения к какой-либо конечной точке. Если конечная точка недоступна, диспетчер трафика направляет новые подключения на другую доступную конечную точку. Однако узел отключенной или неработоспособной конечной точки может по-прежнему получать трафик через существующие подключения, пока эти сеансы не будут завершены. Чтобы трафик не проходил через существующие подключения, для приложений следует ограничить продолжительность сеанса.

Если все конечные точки в профиле отключены или отключен сам профиль, диспетчер трафика в ответ на новый запрос DNS отправляет ответ NXDOMAIN.

## <a name="faq"></a>Часто задаваемые вопросы

### <a name="can-i-use-traffic-manager-with-endpoints-from-multiple-subscriptions"></a>Можно ли использовать в диспетчере трафика конечные точки из нескольких подписок?

Использование конечных точек из нескольких подписок не поддерживается в веб-приложениях Azure. Для работы веб-приложений Azure требуется, чтобы любое имя пользовательского домена, используемое в них, использовалось только в пределах одной подписки. Невозможно использовать веб-приложения из нескольких подписок с одним и тем же доменным именем.

Для других типов конечных точек можно использовать диспетчер трафика, если эти конечные точки расположены в нескольких подписках. Настройка диспетчера трафика зависит от того, используете ли вы классическую модель развертывания или Resource Manager.

* В рамках Resource Manager в диспетчер трафика можно добавить конечные точки из любой подписки при условии, что у пользователя, настраивающего профиль диспетчера трафика, есть доступ на чтение к этим конечным точкам. Эти разрешения можно предоставить с помощью [управления доступом на основе ролей Azure Resource Manager](../active-directory/role-based-access-control-configure.md).
* В интерфейсе классической модели развертывания для работы диспетчера трафика требуется, чтобы облачные службы или веб-приложения, настроенные в качестве конечной точки Azure, находились в той же подписке, что и профиль диспетчера трафика. Конечные точки облачной службы в других подписках можно добавить в диспетчер трафика в качестве внешних конечных точек. Счета для таких внешних конечных точек выставляются по тарифам для конечных точек Azure, а не внешних конечных точек.

### <a name="can-i-use-traffic-manager-with-cloud-service-staging-slots"></a>Можно ли использовать диспетчер трафика с промежуточными слотами облачной службы?

Да. Промежуточные слоты облачной службы можно настроить в диспетчере трафика в качестве внешних конечных точек. Проверки работоспособности будут по-прежнему оплачиваться по тарифу для конечных точек Azure. Так как тип внешней конечной точки уже используется, изменения основной службы не применяются автоматически. При работе с внешними конечными точками диспетчер трафика не может обнаружить остановку или удаление облачной службы. Таким образом, диспетчер трафика продолжает выставлять счета за проверки работоспособности, пока конечная точка не будет отключена или удалена.

### <a name="does-traffic-manager-support-ipv6-endpoints"></a>Поддерживает ли диспетчер трафика конечные точки IP версии 6?

Диспетчер трафика в настоящее время не предоставляет серверы доменных имен с IPv6-адресованием. Тем не менее диспетчер трафика может использоваться IPv6-клиентами, подключающимся к конечным точкам IPv6. Клиент не отправляет DNS-запросы непосредственно к диспетчеру трафика. Вместо этого клиент использует рекурсивную службу DNS. Клиент, использующий только IPv6, отправляет запросы к рекурсивной службе DNS через IPv6. Затем рекурсивная служба должна иметь возможность связаться с серверами доменных имен диспетчера трафика, используя IPv4-адрес.

Диспетчер трафика возвращает ответ с DNS-именем конечной точки. Для поддержки конечной точки IPv6 должна существовать запись DNS типа AAAA, указывающая DNS-имя конечной точки для IPv6-адреса. Проверки работоспособности диспетчера трафика поддерживают только IPv4-адреса. Служба должна предоставлять конечную точку IPv4 с тем же DNS-именем.

### <a name="can-i-use-traffic-manager-with-more-than-one-web-app-in-the-same-region"></a>Можно ли использовать в диспетчере трафика несколько веб-приложений в одном и том же регионе?

Как правило, диспетчер трафика используется для перенаправления трафика в приложения, развернутые в разных регионах. Тем не менее его также можно использовать с приложениями, у которых есть несколько развертываний в одном и том же регионе. Конечные точки Azure диспетчера трафика не допускают добавление нескольких конечных точек веб-приложения, находящихся в одном и том же регионе Azure, в один и тот же профиль.

Ниже приведены обходные решения для этого ограничения:

1. Убедитесь, что конечные точки расположены в другой единице масштабирования веб-приложения. Имя домена должно сопоставляться с одним веб-сайтом в данной единице масштабирования. Таким образом, два веб-приложения в одной единице масштабирования не могут совместно использовать профиль диспетчера трафика.
2. Добавьте личное доменное имя в качестве пользовательского имени узла для каждого веб-приложения. Все веб-приложения должны находиться в разных единицах масштабирования. Все веб-приложения должны принадлежать к одной подписке.
3. Добавьте одну-единственную конечную точку веб-приложения в профиль диспетчера трафика в качестве конечной точки Azure.
4. Добавьте каждую дополнительную конечную точку веб-приложения в профиль диспетчера трафика в качестве внешней конечной точки. Внешние конечные точки можно добавить только с помощью модели развертывания Resource Manager.
5. Создайте в личном домене запись DNS CNAME, которая указывает на DNS-имя профиля диспетчера трафика (<…>.trafficmanager.net).
6. Откройте свой сайт, используя личное доменное имя, а не DNS-имя профиля диспетчера трафика.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте больше о том, [как работает диспетчер трафика](traffic-manager-how-traffic-manager-works.md).
* Узнайте больше о [мониторинге конечных точек и автоматической отработке отказов](traffic-manager-monitoring.md)диспетчера трафика.
* Узнайте больше о [методах маршрутизации трафика](traffic-manager-routing-methods.md)в диспетчере трафика.




<!--HONumber=Nov16_HO3-->


