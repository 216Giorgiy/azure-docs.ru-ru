<properties
   pageTitle="Типы конечных точек диспетчера трафика | Microsoft Azure"
   description="В этой статье описываются разные типы конечных точек, которые можно использовать с диспетчером трафика Azure"
   services="traffic-manager"
   documentationCenter=""
   authors="jtuliani"
   manager="carmonm"
   editor="tysonn" />
<tags
   ms.service="traffic-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="06/08/2016"
   ms.author="jtuliani" />

# Конечные точки диспетчера трафика

С помощью диспетчера трафика Microsoft Azure можно управлять распределением пользовательского трафика среди приложений, развернутых в различных центрах обработки данных или в других расположениях по всему миру.

В диспетчере трафика каждое развертывание приложения необходимо настроить в качестве конечной точки. После получения запроса DNS диспетчер трафика выбирает одну из этих конечных точек, которая будет возвращена в ответе DNS, в зависимости от текущей доступности конечных точек и выбранного метода маршрутизации трафика. Дополнительные сведения см. в статье [Как работает диспетчер трафика](traffic-manager-how-traffic-manager-works.md).

Здесь описывается, как диспетчер трафика поддерживает различные типы конечных точек.

## Типы конечных точек, поддерживаемых диспетчером трафика

Диспетчер трафика поддерживает три типа конечных точек:

- **конечные точки Azure**, используемые для служб, размещенных в Azure;
- **внешние конечные точки**, используемые для служб, размещенных за пределами Azure: локально или с помощью другого поставщика услуг размещения;
- **вложенные конечные точки**, используемые для объединения профилей диспетчера трафика, что позволяет создавать более гибкие и эффективные схемы маршрутизации трафика для поддержки потребностей более крупных и сложных развертываний.

Разные типы конечных точек можно объединять в одном профиле диспетчера трафика без каких-либо ограничений. В каждом профиле может содержаться любое сочетание типов конечных точек.

В следующих разделах каждый тип конечной точки описывается более подробно.

### Конечные точки Azure

В диспетчере трафика конечные точки Azure используются для настройки служб на основе Azure. Сейчас конечные точки Azure поддерживают следующие типы ресурсов Azure:

- классические виртуальные машины IaaS и облачные службы PaaS;
- Веб-приложения
- ресурсы PublicIPAddress (которые можно подключить к виртуальным машинам: напрямую или с помощью Azure Load Balancer). Обратите внимание, что для использования в диспетчере трафика к конечной точке publicIpAddress должно быть привязано DNS-имя.

Ресурсы PublicIPAddress — это ресурсы Azure Resource Manager, которые не находятся в API управления службами Azure. Таким образом, они поддерживаются только в Azure Resource Manager в рамках диспетчера трафика. Остальные типы конечных точек поддерживаются как в Resource Manager, так и в средстве управления службами в диспетчере трафика.

При использовании конечных точек Azure диспетчер трафика определяет время остановки и запуска классической виртуальной машины IaaS, облачной службы PaaS или веб-приложения. Оно отображается в разделе состояния конечной точки (дополнительные сведения см. в статье [О мониторинге диспетчера трафика](traffic-manager-monitoring.md#endpoint-and-profile-status)). При остановке работы основной службы диспетчер трафика больше не будет выставлять счета за проверки работоспособности конечной точки и не будет направлять трафик к этой конечной точке. При перезапуске службы выставление счетов возобновляется и конечная точка снова может принимать трафик. Это не распространяется на конечные точки PublicIpAddress.

### Внешние конечные точки

Используя внешние конечные точки, диспетчер трафика можно настроить таким образом, чтобы он направлял трафик в службы, находящиеся за пределами Azure, например в службу, размещенную локально, или службу, размещенную через другого поставщика.

В одном и том же профиле диспетчера трафика внешние конечные точки можно использовать как отдельно, так и в сочетании с конечными точками Azure. Объединение конечных точек Azure с внешними конечными точками позволяет реализовать различные сценарии:

- использование Azure для повышения избыточности в имеющемся локальном приложении в рамках модели отработки отказа "активный — активный" или "активный — пассивный";
- использование Azure для расширения имеющегося локального приложения в дополнительные географические расположения вместе с [маршрутизацией трафика для повышения производительности диспетчера трафика](traffic-manager-routing-methods.md#performance-traffic-routing-method), чтобы уменьшить задержку приложения и повысить производительность для пользователей;
- использование Azure для получения дополнительной емкости для имеющегося локального приложения непрерывно или путем расширения в облако, чтобы обеспечить обработку всплеска запросов.

В некоторых случаях внешние конечные точки также можно использовать для ссылки на службы Azure (примеры см. в разделе [Часто задаваемые вопросы](#faq)). В этом случае счета за проверки работоспособности выставляются по тарифу конечных точек Azure, а не внешних конечных точек. Тем не менее в отличие от конечных точек Azure при остановке или удалении основной службы за соответствующие проверки работоспособности могут по-прежнему выставляться счета, пока вы явно не отключите или удалите конечную точку в диспетчере трафика.

### Вложенные конечные точки

Вложенные конечные точки используются для объединения профилей диспетчера трафика, что позволяет создавать более гибкие и эффективные схемы маршрутизации трафика для поддержки потребностей более крупных и сложных развертываний.

При использовании вложенных конечных точек дочерний профиль добавляется в качестве конечной точки в родительский профиль, чтобы создать иерархию. Дочерний и родительский профили могут содержать другие конечные точки любого типа, в том числе другие вложенные профили.

Дополнительные сведения см. в статье [Вложенные профили диспетчера трафика](traffic-manager-nested-profiles.md).

## Веб-приложения в качестве конечных точек

При настройке веб-приложений в качестве конечных точек в диспетчере трафика необходимо учитывать дополнительные рекомендации:

1. В диспетчере трафика можно использовать только веб-приложения с номером SKU уровня "Стандартный" или выше. Вызовы к диспетчеру трафика для добавления веб-приложения с номером SKU более низкого уровня будут завершаться с ошибкой. Если снизить уровень SKU имеющегося веб-приложения, диспетчер трафика больше не будет отправлять трафик в это веб-приложение, что может привести к удалению конечной точки из диспетчера трафика.

2. Когда в службу веб-приложений поступает HTTP-запрос, для определения веб-приложения, которое должно обработать запрос, используется заголовок узла. Заголовок узла содержит DNS-имя, используемое для отправки запроса, например contosoapp.azurewebsites.net. Чтобы использовать другое DNS-имя в веб-приложении, это имя необходимо зарегистрировать в качестве личного домена приложения. При добавлении конечной точки веб-приложения в качестве конечной точки Azure в профиль диспетчера трафика DNS-имя этого профиля автоматически регистрируется как личный домен приложения. При удалении конечной точки эта регистрация автоматически отменяется.

3. Как правило, веб-приложение настраивается как конечная точка Azure. Однако при некоторых обстоятельствах рекомендуется настраивать веб-приложение в качестве внешней конечной точки (пример см. в следующем пункте). Веб-приложения можно настроить в качестве внешней конечной точки в диспетчере трафика только при использовании диспетчера трафика Resource Manager. Настройка при использовании управления службами не поддерживается.

4. В каждом профиле диспетчера трафика может быть только одна конечная точка веб-приложения из каждого региона Azure. Обходное решение для этого ограничения приведено в разделе [Часто задаваемые вопросы](#faq).

## Включение и отключение конечных точек

Отключить конечную точку в диспетчере трафика целесообразно, если нужно временно удалить трафик из конечной точки, которая находится в режиме обслуживания или повторно развертывается. После того, как конечная точка восстановится и заработает, ее можно включить снова.

Конечные точки можно включать и отключать на портале диспетчера трафика с помощью PowerShell, интерфейса командной строки или REST API, которые поддерживаются как в Resource Manager, так и в управлении службами.

>[AZURE.NOTE] Отключение конечной точки Azure никак не отражается на состоянии ее развертывания в Azure. Служба Azure, например виртуальная машина или веб-приложение, будет продолжать работу и сможет получать трафик, даже если она отключена в диспетчере трафика (если трафик направляется непосредственно в эту службу, а не через DNS-имя профиля диспетчера трафика). Дополнительные сведения см. в статье [Как работает диспетчер трафика](traffic-manager-how-traffic-manager-works.md).

Если конечная точка отключена, она больше не будет возвращаться в ответах DNS и, таким образом, трафик не будет направляться в конечную точку. Кроме того, проверки работоспособности для отключенной конечной точки не выполняются, и за них не выставляются счета. Отключение конечной точки аналогично ее удалению, за исключением того, что в этом случае проще включить ее снова.

Текущая способность каждой конечной точки принимать трафик зависит от состояния профиля (включен или отключен), состояния конечной точки (включена или отключена) и результатов проверок работоспособности этой конечной точки. Дополнительные сведения см. в статье [О мониторинге диспетчера трафика](traffic-manager-monitoring.md#endpoint-and-profile-status).

>[AZURE.NOTE] Так как диспетчер трафика работает на уровне DNS, он не влияет на существующие подключения к какой-либо конечной точке. При направлении трафика между конечными точками (путем изменения параметров профиля либо во время отработки отказа или восстановления после сбоя) диспетчер трафика будет направлять новые подключения в доступные конечные точки. Однако другие конечные точки могут по-прежнему получать трафик через имеющиеся подключения, пока эти сеансы не будут прерваны. Чтобы трафик не проходил через имеющиеся подключения, для приложений следует ограничить продолжительность сеанса в каждой конечной точке.

Если все конечные точки в профиле отключены или отключен сам профиль, запросы DNS выполняются с ответом NXDOMAIN. Если профиль удален, происходит то же самое.

## Часто задаваемые вопросы

### Можно ли использовать в диспетчере трафика конечные точки из нескольких подписок?
Для веб-приложений Azure это невозможно. Причина этого в том, что для работы веб-приложений требуется, чтобы любое имя личного домена, используемое в них, использовалось только в пределах одной подписки. Невозможно использовать веб-приложения из нескольких подписок с одним и тем же доменным именем. Поэтому их нельзя использовать с диспетчером трафика.

Для других типов конечных точек можно использовать диспетчер трафика, если эти конечные точки расположены в нескольких подписках. Способ использования зависит от того, какой API используется для диспетчера трафика: API управления службами или API Resource Manager. На [портале Azure](https://portal.azure.com) используется API Resource Manager, а на [классическом портале](https://manage.windowsazure.com) — API управления службами.

В рамках Resource Manager в диспетчер трафика можно добавить конечные точки из любой подписки при условии, что у пользователя, настраивающего профиль диспетчера трафика, есть доступ на чтение к этим конечным точкам. Эти разрешения можно предоставить с помощью [управления доступом на основе ролей Azure Resource Manager](../active-directory/role-based-access-control-configure.md).

В управлении службами для работы диспетчера трафика требуется, чтобы облачная служба или веб-приложение, настроенные в качестве конечной точки Azure, находились в той же подписке, что и профиль диспетчера трафика. Конечные точки облачной службы в других подписках можно добавить в диспетчер трафика в качестве внешних конечных точек (за них будут по-прежнему выставляться счета по тарифу внутренней конечной точки).

### Можно ли использовать диспетчер трафика с промежуточными слотами облачной службы?
Да. Промежуточные слоты облачной службы можно настроить в диспетчере трафика в качестве внешних конечных точек.

Из-за того, что служба, на которую ссылается конечная точка, находится в Azure, за проверки работоспособности по-прежнему будут выставляться счета по тарифу конечных точек Azure.

Так как тип внешней конечной точки уже используется, изменения основной службы не применяются автоматически. Таким образом, если облачная служба остановлена или удалена, за проверки работоспособности конечной точки диспетчера трафика будут по-прежнему выставляться счета, пока эта конечная точка не будет отключена или удалена в диспетчере трафика.

### Поддерживает ли диспетчер трафика конечные точки IP версии 6?

Да. Несмотря на то, что диспетчер трафика сейчас не поддерживает серверы доменных имен, к которым можно обратиться через IP версии 6, его по-прежнему могут использовать клиенты IP версии 6, подключающиеся к конечным точкам IP версии 6.

Клиент, использующий только IP версии 6, по-прежнему может использовать диспетчер трафика, так как он не отправляет DNS-запросы непосредственно в этот диспетчер. Вместо этого он использует рекурсивную службу DNS. Он также может отправлять запросы в эту службу через IP версии 6, а рекурсивная служба должна иметь возможность связаться с серверами доменных имен диспетчера трафика, используя IPv4-адрес.

При получении запроса DNS диспетчер трафика отправит ответ с DNS-именем конечной точки, к которой клиенту необходимо подключиться. Чтобы конечная точка IP версии 6 поддерживалась, достаточно настроить запись DNS типа AAAA, которая направляет DNS-имя конечной точки по IPv6-адресу.

Обратите внимание, что для выполнения проверок работоспособности диспетчера трафика надлежащим образом служба должна предоставлять доступ к конечной точке IPv4. Для этого необходимо выполнить сопоставление с использованием одного и того же DNS-имени конечной точки и записи DNS типа A.

### Можно ли использовать в диспетчере трафика несколько веб-приложений в одном и том же регионе?

Как правило, диспетчер трафика используется для перенаправления трафика в приложения, развернутые в разных регионах. Тем не менее его также можно использовать с приложениями, у которых есть несколько развертываний в одном и том же регионе.

В случае использования веб-приложений конечные точки Azure диспетчера трафика не допускают добавление нескольких конечных точек веб-приложения, находящихся в одном и том же регионе Azure, в один и тот же профиль. Ниже приведены обходные решения для этого ограничения:

1.	Убедитесь, что веб-приложения, находящиеся в одном регионе, представлены в разных единицах масштабирования веб-приложения, т. е. в разных экземплярах службы веб-приложений. Для этого проверьте путь DNS для записи DNS <...>.azurewebsites.net. Единица масштабирования будет выглядеть примерно следующим образом: waws-prod-xyz-123.vip.azurewebsites.net. Доменное имя необходимо сопоставить с одним сайтом в этой единице масштабирования. Именно поэтому для двух веб-приложений, представленных в одной единице масштабирования, не может использоваться один профиль диспетчера трафика.
2.	Если веб-приложения представлены в разных единицах масштабирования, добавьте для каждого из них личное доменное имя в качестве пользовательского имени узла. Для этого все веб-приложения должны принадлежать одной и той же подписке.
3.	Добавьте одну-единственную конечную точку веб-приложения в профиль диспетчера трафика в качестве конечной точки Azure обычным способом.
4.	Добавьте каждую дополнительную конечную точку веб-приложения в профиль диспетчера трафика в качестве внешней конечной точки. При этом для диспетчера трафика необходимо использовать Resource Manager, а не управление службами.
5.	Создайте запись DNS CNAME из личного домена (как описано на шаге 2 выше) для DNS-имени профиля диспетчера трафика (<…>.trafficmanager.net).
6.	Откройте свой сайт, используя личное доменное имя, а не DNS-имя профиля диспетчера трафика.

## Дальнейшие действия

- Узнайте больше о том, [как работает диспетчер трафика](traffic-manager-how-traffic-manager-works.md).

- Узнайте больше о [мониторинге конечных точек и автоматической отработке отказов](traffic-manager-monitoring.md) диспетчера трафика.

- Узнайте больше о [методах маршрутизации трафика](traffic-manager-routing-methods.md) в диспетчере трафика.

<!---HONumber=AcomDC_0817_2016-->