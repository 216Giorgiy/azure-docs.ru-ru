<properties 
   pageTitle="О методах балансировки нагрузки диспетчера трафика"
   description="Эта статья поможет вам разобраться в различных методах балансировки нагрузки, используемых диспетчером трафика."
   services="traffic-manager"
   documentationCenter=""
   authors="cherylmc"
   manager="adinah"
   editor="tysonn" />
<tags 
   ms.service="traffic-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="02/27/2015"
   ms.author="cherylmc" />

# О методах балансировки нагрузки диспетчера трафика

В диспетчере трафика доступно три метода балансировки нагрузки. Каждый профиль диспетчера трафика может использовать только один из методов балансировки нагрузки, хотя можно выбрать другой метод балансировки нагрузки для профиля в любое время.

Важно отметить, что все методы балансировки нагрузки используют мониторинг конечных точек. После настройки профиля диспетчера трафика с указанием метода балансировки нагрузки, оптимально подходящего к вашим требованиям, настройте параметры мониторинга. Если мониторинг настроен правильно, диспетчер трафика будет наблюдать за состоянием конечных точек, состоящих из облачных служб и веб-сайтов, и не будет отправлять трафик в конечные точки, которые считает недоступными. Подробнее о мониторинге диспетчера трафика см. в разделе [О мониторинге диспетчера трафика](traffic-manager-monitoring.md). 

Три метода балансировки нагрузки диспетчера трафика

- **Отработка отказа**: Выберите "Отработка отказа" при наличии конечных точек в одном или разных центрах данных Azure (области на портале управления), а также при необходимости использования основной конечной точки для всего трафика с резервированием в случае, если основная или резервная конечные точки будут недоступны. Подробнее см. в разделе [Метод отказоустойчивой балансировки нагрузки](#failover-load-balancing-method).

- **Циклический перебор**: Выберите "Циклический перебор", если необходимо распределять нагрузку между несколькими конечными точками в одном или в разных центрах данных. Подробнее см. в разделе [Метод балансировки нагрузки с циклическим перебором](#round-robin-load-balancing-method).

- **Производительность**: Выберите "Производительность" при наличии конечных точек в разных географических расположениях, если нужно, чтобы запрашивающие клиенты использовали "ближайшие" по минимальной задержке конечные точки. Подробнее см. в разделе [Метод балансировки нагрузки по производительности](#performance-load-balancing-method).

Обратите внимание, что веб-сайты Azure уже обеспечивают отработку отказа и циклическую балансировку нагрузки для веб-сайтов в центре данных независимо от режима работы веб-сайта. Диспетчер трафика позволяет использовать отработку отказа и циклическую балансировку нагрузки для веб-сайтов в разных центрах данных.

>[AZURE.NOTE] Параметр срока жизни в DNS сообщает клиентам и сопоставителям DNS на DNS-серверах, как долго разрешенные имена должны находиться в кэше. Клиенты будут продолжать использовать конечную точку при разрешении ее доменного имени, пока его запись в локальном кэше DNS не будет удалена.

### Метод отказоустойчивой балансировки нагрузки

Организации обычно стремятся обеспечить надежность своих служб. Для этого предоставляются службы резервного копирования на случай, если основная служба выйдет из строя. Распространенный подход к обеспечению отказоустойчивости служб заключается в предоставлении набора идентичных конечных точек и передаче трафика основной службе со списком из одной или нескольких резервных служб. Если основная служба недоступна, запрашивающие клиенты направляются к следующей по порядку. Если и первая, и вторая службы в списке недоступны, трафик направляется в третью и т. д.

При настройке метода балансировки нагрузки "Отработка отказа" важен порядок выбранных конечных точек. На портале управления можно настроить порядок отработки отказа на странице конфигурации профиля.

На рис. 1 показан пример метода балансировки нагрузки с отработкой отказа для набора конечных точек.

![Балансировка нагрузки с отработкой отказа диспетчера трафика](./media/traffic-manager-load-balancing-methods/IC750592.jpg)

**Figure 1**

Следующие пронумерованные шаги соответствуют числам на рис. 1.

1. Диспетчер трафика получает входящий запрос от клиента через DNS и находит профиль.
2. Профиль содержит упорядоченный список конечных точек. Диспетчер трафика проверяет, какая точка является первой в списке. Если конечная точка работает (по данным мониторинга конечных точек), он укажет DNS-имя этой конечной точки в ответе DNS клиенту. Если конечная точка недоступна, диспетчер трафика определяет следующую работающую конечную точку в списке. В этом примере точка CS-A вне сети (недоступна), но CS-B в сети (доступна).
3. Диспетчер трафика возвращает доменное имя CS-B DNS-серверу клиента, который разрешает доменное имя в IP-адрес и отправляет его клиенту.
4. Клиент инициирует отправку трафика конечной точке CS-B.

### Метод балансировки нагрузки с циклическим перебором

Общепринятый подход к балансировке нагрузки состоит в предоставлении набора идентичных конечных точек и отправке трафика в каждую из них по принципу циклического перебора. Циклический перебор разделяет трафик между различными конечными точками. Он выбирает работоспособную конечную точку случайным образом и не отправляет трафик недоступным службам. Подробнее см. в разделе [О мониторинге диспетчера трафика](../traffic-manager-onitoring.md).

На рис. 2 показан пример метода балансировки нагрузки с циклическим перебором для набора конечных точек.

![Балансировка нагрузки диспетчера трафика с циклическим перебором](./media/traffic-manager-load-balancing-methods/IC750593.jpg)

**Рис. 2**

Следующие пронумерованные шаги соответствуют числам на рис. 2.

1. Диспетчер трафика получает входящий запрос от клиента и находит профиль.
2. В профиле содержится список конечных точек. Диспетчер трафика в произвольном порядке выбирает в списке конечную точку, исключая все автономные (недоступные) конечные точки, определенные в процессе мониторинга конечных точек. В этом примере это конечная точка CS-B.
3. Диспетчер трафика возвращает доменное имя CS-B DNS-серверу клиента. DNS-сервер клиента разрешает это доменное имя в IP-адрес и отправляет его клиенту.
4. Клиент инициирует отправку трафика конечной точке CS-B.

Метод балансировки нагрузки с циклическим перебором также поддерживает взвешенное распределение сетевого трафика. На рис. 3 показан пример метода взвешенной балансировки нагрузки с циклическим перебором для набора конечных точек.

![Взвешенная балансировка нагрузки с циклическим перебором](./media/traffic-manager-load-balancing-methods/IC750594.png)

**Рис. 3**

Взвешенная балансировка нагрузки с циклическим перебором позволяет распределять нагрузку по различным конечным точкам на основе назначенного "веса" каждой конечной точки. Чем больше вес, тем чаще будет возвращаться конечная точка. Этот метод будет полезен в указанных ниже сценариях.

- Постепенное обновление приложения: направляйте часть трафика в новую конечную точку и постепенно доведите объем трафика до 100 %.
- Миграция приложений в Azure: создайте профиль с конечными точками Azure и внешними конечными точками и укажите вес трафика, который направляется в каждую конечную точку.
- Повышение в облако для получения дополнительной емкости: быстро расширьте локальное развертывание в облако, изменив профиль диспетчера трафика. Если вам требуется дополнительная емкость в облаке, добавьте конечные точки и укажите, какая часть трафика направляется на ту или иную конечную точку.

На данный момент нельзя настроить взвешенную балансировку нагрузки на портале управления. Azure предоставляет программный доступ к этому методу с помощью связанного интерфейса REST API управления службами и командлетов Azure PowerShell.

Подробнее об использовании интерфейсов REST API см. в разделе [Операции, относящиеся к диспетчеру трафика (справочник по интерфейсу REST API)](http://go.microsoft.com/fwlink/p/?LinkId=313584).

Подробнее об использовании командлетов PowerShell Azure см. в разделе [Командлеты для диспетчера трафика Azure](http://go.microsoft.com/fwlink/p/?LinkId=400769). Пример конфигурации см. в разделе [Внешние конечные точки диспетчера трафика Azure и взвешенный циклический перебор с помощью PowerShell](http://azure.microsoft.com/blog/2014/06/26/azure-traffic-manager-external-endpoints-and-weighted-round-robin-via-powershell/) в блоге Azure.

Для тестирования профиля с одного клиента и проверки поведения равномерного или взвешенного циклического перебора убедитесь в том, что DNS-имя разрешается в разные IP-адреса конечных точек согласно равным или взвешенным значениям в профиле. При тестировании необходимо отключать кэширование DNS на стороне клиента или очищать кэш DNS между попытками, чтобы обеспечить отправку запроса нового DNS-имени.

### Метод балансировки нагрузки по производительности

В целях балансировки нагрузки конечных точек, которые находятся в разных центрах данных по всему миру, можно направить входящий трафик на ближайшую по минимальной задержке конечную точку. Обычно "ближайшая" конечная точка одновременно является наиболее близкой географически. Метод балансировки нагрузки с учетом производительности позволяет осуществлять распределение по расположению и задержке, но не может учитывать изменения конфигурации или нагрузки сети в режиме реального времени.

Балансировка нагрузки по производительности находит местоположение клиента и связывает его с ближайшей конечной точкой. "Близость" определяется таблицей интернет-задержек, в которой отражается время от отправки запроса до получения ответа между различными IP-адресами и каждым центром данных Azure. Эта таблица обновляется периодически и не отражает производительность работы через Интернет в реальном времени. Она не учитывает нагрузку на данную службу, хотя диспетчер трафика ведет мониторинг конечных точек на основе выбранного метода и не будет включать их в ответы на запросы DNS, если они не работают. Другими словами, балансировка нагрузки по производительности включает также метод отказоустойчивой балансировки нагрузки.

На рис. 4 показан пример метода балансировки нагрузки по производительности для набора конечных точек.

![Балансировка нагрузки диспетчера трафика по производительности](./media/traffic-manager-load-balancing-methods/IC753237.jpg)

**Рис. 4**

Следующие пронумерованные шаги соответствуют числам на рис. 4.

1. Диспетчер трафика периодически формирует таблицу интернет-задержек. Инфраструктура диспетчера трафика выполняет тесты для определения времени приема-передачи между различными точками земного шара и центрами данных Azure, где размещены конечные точки.
2. Диспетчер трафика получает входящий запрос от клиента через локальный DNS-сервер и находит профиль.
3. Затем он находит строку в таблице интернет-задержек для IP-адреса входящего DNS-запроса. Так как локальный DNS-сервер пользователя выполняет итеративный DNS-запрос для нахождения полномочного DNS-сервера для имени профиля диспетчера трафика, DNS-запрос отправляется с IP-адреса локального DNS-сервера клиента.
4. Далее он находит центр данных с наименьшим временем среди тех, на которых размещены конечные точки, определенные в профиле. В этом примере это CS-B.
5. Диспетчер трафика возвращает доменное имя CS-B локальному DNS-серверу клиента, который разрешает доменное имя в IP-адрес и отправляет его клиенту.
6. Клиент инициирует отправку трафика конечной точке CS-B.

**Примечания**

- Если профиль содержит несколько конечных точек в одном центре данных, направляемый в этот центр данных трафик будет равномерно распределяться между всеми конечными точками, которые доступны и работоспособны согласно данным мониторинга конечных точек.
- Если все конечные точки в заданном центре данных недоступны (согласно данным мониторинга конечных точек), то трафик для таких конечных точек будет распределяться по всем прочим доступным конечным точкам, которые указаны в профиле, а не только по ближайшим. Это помогает избежать каскадных сбоев, которые потенциально могут возникнуть при перегрузке ближайшей конечной точки.
- После обновления таблицы интернет-задержек вы можете заметить разницу в структуре трафика и нагрузке на ваши конечные точки. Эти изменения должны быть минимальными.
- При использовании метода балансировки нагрузки по производительности с внешними конечными точками необходимо указать их расположение. Выберите ближайший к вашему развертыванию регион Azure. Подробнее см. в разделе [Управление конечными точками в диспетчере трафика](traffic-manager-endpoints.md).

## Схемы диспетчера трафика

Если вам нужны схемы, приведенные в этом разделе, для слайдов презентации PowerPoint по диспетчеру трафика или для изменения в личных целях, см. [схемы диспетчера трафика в документации MSDN](http://gallery.technet.microsoft.com/Traffic-Manager-figures-in-887e7c99).

## См. также

[Обзор диспетчера трафика](traffic-manager-overview.md)

[О мониторинге диспетчера трафика](traffic-manager-monitoring.md)

[Операции с диспетчером трафика (справочник по REST API)](http://go.microsoft.com/fwlink/p/?LinkID=313584)

[Облачные службы](http://go.microsoft.com/fwlink/p/?LinkId=314074)

[Веб-сайты](http://go.microsoft.com/fwlink/p/?LinkId=393327)

[Командлеты для диспетчера трафика Azure](http://go.microsoft.com/fwlink/p/?LinkId=400769)


<!--HONumber=49--> 