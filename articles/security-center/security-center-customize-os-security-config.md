---
title: "Настройка конфигурации безопасности операционной системы в центр безопасности Azure [Предварительная версия] | Документы Microsoft"
description: "В этой статье объясняется, как настроить оценки центр безопасности"
services: security-center
documentationcenter: na
author: TerryLanfear
manager: MBaldwin
editor: 
ms.assetid: 
ms.service: security-center
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 01/08/2018
ms.author: terrylan
ms.openlocfilehash: 2fa63515d290e6700fbe4a90ae509f4635b19f29
ms.sourcegitcommit: 719dd33d18cc25c719572cd67e4e6bce29b1d6e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2018
---
# <a name="customizing-os-security-configurations-in-azure-security-center-preview"></a>Настройка конфигурации безопасности операционной системы в центр безопасности Azure [Предварительная версия]

Дополнительные сведения о настройке оценки конфигурации безопасности операционной системы в центр безопасности Azure, используя в данном пошаговом руководстве.

## <a name="what-are-os-security-configurations"></a>Что такое конфигураций безопасности операционной системы

Настройки безопасности мониторы центра безопасности Azure с помощью набора более чем 150 рекомендуемые правила для усиления безопасности операционной системы, включая правила, относящиеся к брандмауэры, аудит, политики паролей и многое другое. Если обнаружено, что компьютер уязвимым конфигурации, формируется рекомендацией по безопасности.

Настройка правил может помочь организациям управления, какие параметры конфигурации больше подходят для своей среды. Эта функция позволяет пользователям задавать политику пользовательские оценки и примените его на всех компьютерах, применимые в подписке.

> [!NOTE]
> - В настоящее время настройки конфигурации безопасности операционной системы доступен для Windows Server 2008, 2008 R2, 2012, 2012R2 операционных систем.
- Конфигурация применяется ко всем виртуальным машинам и компьютеры подключены все рабочие области в выбранной подписке.
- Конфигурация безопасности ОС Настройка доступна только на уровень Standard центра обеспечения безопасности.
>
>

Как настроить правила конфигурации безопасности операционной системы?

Можно настроить правила конфигурации безопасности операционной системы, включение и отключение определенных правил, требуемое значение для существующего правила и добавив новое правило, в зависимости от поддерживаемых типов правил (реестр, политика аудита и политики безопасности). В настоящее время требуемое значение должно быть точное значение.

Новые правила должны быть в один и тот же формат и структуру, как другие существующие правила того же типа.

> [!NOTE]
> Для настройки конфигурации безопасности операционной системы, необходимо назначить роль владельца подписки, администратор безопасности или участника подписки.
>
>

## <a name="customize-security-configuration"></a>Настройка конфигурации безопасности

Для настройки конфигурации безопасности операционной системы, центр обеспечения безопасности по умолчанию:

1.  Откройте панель мониторинга **Центр безопасности**.

2.  В главном меню центра обеспечения безопасности, выберите **политики безопасности**.  **Центр обеспечения безопасности - политика безопасности** открывается.

3.  Выберите подписку, которую требуется выполнить настройку для.

    ![](media/security-center-customize-os-security-config/open-security-policy.png)

4. В разделе **КОМПОНЕНТЫ ПОЛИТИКИ**выберите **изменение конфигураций безопасности**.

6.  **Изменение конфигураций безопасности** открывается. Выполните действия, выделяются на экране для загрузки, изменение и отправки измененного файла.

    ![](media/security-center-customize-os-security-config/blade.png)

  > [!NOTE]
  > По умолчанию, загруженный файл конфигурации находится в *json* формат. Инструкции по изменению этого файла см. [настроить файл конфигурации](#customize-the-configuration-file).
  >

7. После успешного сохранения файла, конфигурация применяется ко всем виртуальным машинам и компьютеры подключены к всех рабочих областей для выбранной подписки. Этот процесс может занять некоторое время, обычно через несколько минут, но можно может занять больше времени, так как он зависит от размера инфраструктуры. Выберите **Сохранить** для фиксации изменений, в противном случае она не хранится.

    ![](media/security-center-customize-os-security-config/save-successfully.png)

В любой момент можно сбросить текущую конфигурацию политики состояние политики по умолчанию, выбрав **Сброс** в диалоговом окне **правила изменить конфигурацию безопасности ОС**. Если этот параметр выбран, вы получите следующее всплывающее уведомление. Выберите **Да** для подтверждения.

![](media/security-center-customize-os-security-config/edit-alert.png)

## <a name="customize-the-configuration-file"></a>Настройка файла конфигурации

В файле настройки каждой поддерживаемой версии ОС имеет набор правил (ruleset). Каждый набор правил имеет собственное имя и уникальный идентификатор, как показано в следующем примере:

![](media/security-center-customize-os-security-config/custom-file.png)

> [!NOTE]
> Этот файл был изменен с помощью Visual Studio, но можно также использовать Блокнот, пока у вас установлен подключаемый модуль просмотра JSON.
>
>

При редактировании этого файла можно изменить одно правило или все из них. Каждый набор правил содержит *правила* раздел, содержащий правила, разделить на три категории правил: реестр, политика аудита и политику безопасности, как показано на следующем рисунке:

![](media/security-center-customize-os-security-config/rules-section.png)

У каждой категории есть свой собственный набор атрибутов. Для существующих правил можно внести изменения в следующие:

- expectedValue: тип данных поля этот атрибут должен соответствовать поддерживаемых значений на каждый тип правила, например:

  - baselineRegistryRules: значение должно соответствовать [regValueType] (определенные в правиле https://msdn.microsoft.com/library/windows/desktop/ms724884 (v=vs.85).

  - baselineAuditPolicyRules: значение должно быть значение строки, одним из следующих:

    - Успешные и неудачные события

    - Успешно

  - baselineSecurityPolicyRules: значение должно быть значение строки, одним из следующих:

    - «Ни один»

    - Список разрешенных групп пользователей, например: «Администраторы», «операторы архива»

-   Состояние: строка, которая может содержать параметры «Отключено» или «Включено». В этом выпуске личной предварительной версии строки с учетом регистра.

Это только поля, которые могут быть настроены. Если Вы нарушаете формат файла или размера, его нельзя сохранить изменения. Следующее сообщение об ошибке возникает, когда не удается обработать файл:

![](media/security-center-customize-os-security-config/invalid-json.png)

В разделе [коды ошибок](#error-codes) список потенциальных ошибок.

Ниже имеются примеры эти правила и атрибуты (полужирным шрифтом), которые могут быть изменены.

**Раздел правил:** baselineRegistryRules
```
{

    "hive": "LocalMachine",
    "regValueType": "Int",
    "keyPath":
    "System\\\\CurrentControlSet\\\\Services\\\\LanManServer\\\\Parameters",
    "valueName": "restrictnullsessaccess",
    "ruleId": "f9020046-6340-451d-9548-3c45d765d06d",
    "originalId": "0f319931-aa36-4313-9320-86311c0fa623",
    "cceId": "CCE-10940-5",
    "ruleName": "Network access: Restrict anonymous access to Named Pipes and
    Shares",
    "ruleType": "Registry",
    "**expectedValue**": "1",
    "severity": "Warning",
    "analyzeOperation": "Equals",
    "source": "Microsoft",
    "**state**": "Disabled"

}
```

**Раздел правил:** baselineAuditPolicyRules
```
{
"auditPolicyId": "0cce923a-69ae-11d9-bed3-505054503030",
"ruleId": "37745508-95fb-44ec-ab0f-644ec0b16995",
"originalId": "2ea0de1a-c71d-46c8-8350-a7dd4d447895",
"cceId": "CCE-11001-5",
"ruleName": "Audit Policy: Account Management: Other Account Management Events",
"ruleType": "AuditPolicy",
"**expectedValue**": "Success and Failure",
"severity": "Critical",
"analyzeOperation": "Equals",
"source": "Microsoft",
"**state**": "Enabled"
},
```

**Разделы правила:** baselineSecurityPolicyRules
```
{
"sectionName": "Privilege Rights",
"settingName": "SeIncreaseWorkingSetPrivilege",
"ruleId": "b0ec9d5e-916f-4356-83aa-c23522102b33",
"originalId": "b61bd492-74b0-40f3-909d-36b9bf54e94c",
"cceId": "CCE-10548-6",
"ruleName": "Increase a process working set",
"ruleType": "SecurityPolicy",
"**expectedValue**": "Administrators, Local Service",
"severity": "Warning",
"analyzeOperation": "Equals",
"source": "Microsoft", "**state**": "Enabled"
},
```

Существует несколько правил, которые повторяются для различных типов ОС. Повторяющиеся правила имеют одинаковые «первоначальный идентификатор изменяющегося измерения».

## <a name="adding-a-new-custom-rule"></a>Добавить новое настраиваемое правило

Также можно создать новое правило. Прежде чем создавать новое правило, необходимо учитывать следующие ограничения:

-   Версия схемы *baselineId* и *baselineName* не может быть изменено.

-   Не удается удалить набор правил.

-   Не удается добавить набора правил.

-   Допустимое (включая правила по умолчанию) не более 1000 правил.

Новые пользовательские правила будут отмечены новый пользовательский источник (! = «Microsoft»). *RuleId* поля может быть неопределенным или пустым. Если не задано, Microsoft формирует одну. Если она не пустая, его должны иметь допустимый идентификатор GUID, уникальный во всех правил (по умолчанию и пользовательские). Проверьте ограничения ниже относительно основные поля:

-   *первоначальный идентификатор изменяющегося измерения* -может быть неопределенным или пустым. Если *первоначальный идентификатор изменяющегося измерения* — не пусто, он должен быть допустимым идентификатором GUID.

-   *cceId* -может быть неопределенным или пустым. Если *cceId* — не пусто, оно должно быть уникальным.

-   *ruleType* — один из: реестра, AuditPolicy или SecurityPolicy.

-   *Серьезность* — один из: неизвестно, критическое, предупреждение или информационное сообщение.

-   *analyzeOperation* -должно быть равно.

-   *auditPolicyId* -должен быть допустимым идентификатором GUID.

-   *regValueType* -должен быть одним из: Int, Long, строка или MultipleString.

> [!NOTE]
> Должен быть куст *LocalMachine*.
>
>

Пример новое настраиваемое правило.

**Реестр**:
```
    {
    "hive": "LocalMachine",
    "regValueType": "Int",
    "keyPath":
    "System\\\\CurrentControlSet\\\\Services\\\\Netlogon\\\\MyKeyName",
    "valueName": "MyValueName",
    "originalId": "",
    "cceId": "",
    "ruleName": "My new registry rule”, "baselineRuleType": "Registry",
    "expectedValue": "123", "severity": "Critical",
    "analyzeOperation": "Equals",
    "source": "MyCustomSource",
    "state": "Enabled"
   }
```
**Политика безопасности**:
```
{

   "sectionName": "Privilege Rights",
   "settingName": "SeDenyBatchLogonRight",
   "originalId": "",
   "cceId": "",
   "ruleName": "My new security policy rule", "baselineRuleType":
   "SecurityPolicy",
   "expectedValue": "Guests",
   "severity": "Critical",
   "analyzeOperation": "Equals", "source": " MyCustomSource ",
   "state": "Enabled"
   }
```
**Политика аудита:**
```
   {
   "auditPolicyId": "0cce923a-69ae-11d9-bed3-505054503030",
   "originalId": "",
   "cceId": "",
   "ruleName": " My new audit policy rule ", "baselineRuleType": "AuditPolicy",
   "expectedValue": " Failure",
   "severity": "Critical",
   "analyzeOperation": "Equals", "source": " MyCustomSource ",
   "state": "Enabled"
   }
```

## <a name="file-upload-failures"></a>Ошибок отправки файлов

Если файл конфигурации отправленной является недопустимым из-за ошибок в значений или форматирования, отображается ошибка. Вы можете загрузить отчет в формате csv подробных сообщений об ошибках для устранения и исправьте ошибки перед повторной отправкой данных исправленный файл конфигурации.

![](media/security-center-customize-os-security-config/invalid-configuration.png)

Пример файла ошибок:

![](media/security-center-customize-os-security-config/errors-file.png)

## <a name="error-codes"></a>Коды ошибок

Список ниже содержит все потенциальные ошибки:

| **Ошибка**                                | **Описание**                                                                                                                              |
|------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------|
| BaselineConfiguratiohSchemaVersionError  | Свойство «schemaVersion» найдено недопустимое или пустое. Значение должно быть равно «{0}».                                                         |
| BaselineInvalidStringError               | Свойство «{0}» не может содержать "\\n".                                                                                                         |
| BaselineNullRuleError                    | Список правил базовых показателей конфигурации содержит правило со значением «null».                                                                         |
| BaselineRuleCceIdNotUniqueError          | CCE-ID «{0}» не является уникальным.                                                                                                                  |
| BaselineRuleEmptyProperty                | Свойство: «{0}» отсутствует или является недопустимым.                                                                                                       |
| BaselineRuleIdNotInDefault               | Правило имеет свойство источника «Microsoft», но не был найден в набор правил Майкрософт по умолчанию.                                                   |
| BaselineRuleIdNotUniqueError             | Код правила не является уникальным.                                                                                                                       |
| BaselineRuleInvalidGuid                  | Свойство «{0}» была обнаружена недопустимая. Значение не является допустимым идентификатором Guid.                                                                             |
| BaselineRuleInvalidHive                  | Куст должно быть LocalMachine.                                                                                                                   |
| BaselineRuleNameNotUniqueError           | Имя правила не является уникальным.                                                                                                                 |
| BaselineRuleNotExistInConfigError        | Правило не найдено в новую конфигурацию. Не удается удалить правило.                                                                     |
| BaselineRuleNotFoundError                | Правило не найдено базовый набор правил по умолчанию.                                                                                        |
| BaselineRuleNotInPlace                   | Правило соответствует правилу по умолчанию с типом {0} и входит в список {1}.                                                                       |
| BaselineRulePropertyTooLong              | Свойство: «{0}» имеет слишком большую длину. Максимальная допустимая длина: {1}.                                                                                        |
| BaselineRuleRegTypeInvalidError          | Ожидаемое значение «{0}» не соответствует тип значения реестра, который определен.                                                              |
| BaselineRulesetAdded                     | Набор правил с идентификатором «{0}» не найден в конфигурации по умолчанию. Невозможно добавить набор правил.                                               |
| BaselineRulesetIdMustBeUnique            | Данный базовый набор правил «{0}» должно быть уникальным.                                                                                           |
| BaselineRulesetNotFound                  | Задайте правила с идентификатором «{0}» и именем «{1}» не найден в заданной конфигурации. Не удается удалить набор правил.                                |
| BaselineRuleSourceNotMatch               | Правило с идентификатором «{0}» уже определен.                                                                                                       |
| BaselineRuleTypeDoesntMatch              | Тип правила по умолчанию — «{0}».                                                                                                              |
| BaselineRuleTypeDoesntMatchError         | Реальный тип правила: {0}, но ruleType свойство: {1}.                                                                          |
| BaselineRuleUnpermittedChangesError      | Только свойства «expectedValue» и «состояние» могут быть изменены.                                                                       |
| BaselineTooManyRules                     | Максимально допустимое число настроенные правила — правила {0}. Данной конфигурации содержит правила {1}. (по умолчанию правила {2} + {3} настраиваемые правила. |
| ErrorNoConfigurationStatus               | Состояние конфигурации не найден. Опишите требуемой конфигурацией состояния — «Default» или «Пользовательский».                                    |
| ErrorNonEmptyRulesetOnDefault            | Состояние конфигурации имеет значение по умолчанию. Список BaselineRulesets должен быть неопределенным или пустым.                                                          |
| ErrorNullRulesetsPropertyOnCustom        | Состояние данной конфигурации 'Custom', но свойство «baselineRulesets» имеет значение null или пустым.                                             |
| ErrorParsingBaselineConfig               | Недопустимый заданной конфигурации. Один или несколько значений, определенных имеют значение null или недопустимый тип.                                  |
| ErrorParsingIsDefaultProperty            | Недопустимое значение заданной «configurationStatus» «{0}». Значение может быть только «Default» или «Пользовательский».                                         |
| InCompatibleViewVersion                  | Просмотреть версию: {0} не поддерживается для этого типа рабочей области.                                                                                   |
| InvalidBaselineConfigurationGeneralError | Заданной базовой конфигурации найден один или несколько ошибок проверки типа.                                                          |
| ViewConversionError                      | Представление, старая версия поддерживается в этой рабочей области. Просмотр произошла ошибка: {0}                                                                 |

Если у вас нет необходимых разрешений, может получить ошибку произошла общая ошибка:

![](media/security-center-customize-os-security-config/general-failure-error.png)

## <a name="next-steps"></a>Дальнейшие действия
В этой статье показано, как настроить оценки конфигурации операционной системы безопасности в центре безопасности. Дополнительные сведения о правилах конфигурации и обновлений, см.:

- [Распространенные конфигурации идентификаторы центра обеспечения безопасности и правила базовых показателей](https://gallery.technet.microsoft.com/Azure-Security-Center-a789e335).
- Центр безопасности использует CCE (перечисление общей конфигурации) для назначения уникальных идентификаторов для правил конфигурации. Посетите сайт [CCE](https://nvd.nist.gov/config/cce/index) , чтобы получить дополнительную информацию.
- [Исправлять конфигурации безопасности](security-center-remediate-os-vulnerabilities.md) показано, как устранить уязвимости при конфигурации операционной системы не соответствует правила конфигурации безопасности.
