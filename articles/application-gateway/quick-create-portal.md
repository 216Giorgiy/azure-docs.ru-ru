---
title: Краткое руководство. Направление веб-трафика с помощью шлюза приложений Azure на портале Azure | Документация Майкрософт
description: Узнайте, как с помощью портала Azure создать шлюз приложений Azure, который направляет веб-трафик к виртуальным машинам в серверном пуле.
services: application-gateway
author: vhorne
ms.service: application-gateway
ms.topic: quickstart
ms.date: 1/8/2019
ms.author: victorh
ms.custom: mvc
ms.openlocfilehash: 16e23f77509d2402f765981b39a30e08a2309f68
ms.sourcegitcommit: 33091f0ecf6d79d434fa90e76d11af48fd7ed16d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/09/2019
ms.locfileid: "54156533"
---
# <a name="quickstart-direct-web-traffic-with-azure-application-gateway---azure-portal"></a>Краткое руководство. Направление веб-трафика с помощью Шлюза приложений Azure на портале Azure

Из этого краткого руководства вы узнаете, как с помощью портала Azure быстро создать шлюз приложений с двумя виртуальными машинами в серверном пуле. Затем вы протестируете шлюз, чтобы убедиться, что он работает правильно. Шлюз приложений Azure позволяет направлять веб-трафик приложения к определенным ресурсам. Для этого портам назначаются прослушиватели, создаются определенные правила и в серверный пул добавляются соответствующие ресурсы.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com) с помощью своей учетной записи Azure.

## <a name="create-an-application-gateway"></a>Создание шлюза приложений

В Azure для обмена между создаваемыми ресурсами необходима виртуальная сеть. В этом примере создаются две подсети: одна — для шлюза приложений, а вторая — для внутренних серверов. Вы можете создать виртуальную сеть во время создания шлюза приложений.

1. Выберите **Создать ресурс** в верхнем левом меню портала Azure. Появится окно **Создать**.

2. Выберите **Сети**, а затем в списке **Рекомендованные** выберите **Шлюз приложений**.

### <a name="basics-page"></a>Страница "Основные"

1. На странице **Основы** введите эти значения для следующих параметров шлюза приложений:

    - **Имя.** Введите *myAppGateway* для имени шлюза приложений.
    - **Группа ресурсов.** Выберите **myResourceGroupAG** для группы ресурсов. Выберите **Создать** для создания группы ресурсов, если она еще не существует.

    ![Создание шлюза приложений](./media/application-gateway-create-gateway-portal/application-gateway-create.png)

2. Оставьте значения по умолчанию для других параметров, а затем нажмите кнопку **ОК**.

### <a name="settings-page"></a>Страница «Параметры»

1. На странице **Параметры** в разделе **Конфигурация подсети** выберите **Выбор виртуальной сети**.

2. На странице **Выбор виртуальной сети** выберите **Создать**, а затем введите значения для следующих параметров виртуальной сети:

    - **Имя.** Введите *myVNet* для имени виртуальной сети.

    - **Диапазон адресов**: Введите *10.0.0.0/16* для адресного пространства виртуальной сети.

    - **Имя подсети**. Введите *myAGSubnet* для имени подсети.<br>Подсеть шлюза приложений может содержать только шлюзы приложений. Другие ресурсы запрещены.

    - **Диапазон адресов подсети**: Введите *10.0.0.0/24* для диапазона адресов подсети.

    ![Создание виртуальной сети](./media/application-gateway-create-gateway-portal/application-gateway-vnet.png)

3. Нажмите кнопку **ОК**, чтобы вернуться на страницу **Параметры**.

4. В разделе **Интерфейсная IP-конфигурация** убедитесь, что для параметра **Тип IP-адреса** установлено значение **Общедоступный**. В разделе **Общедоступный IP-адрес** убедитесь, что выбрано **Создать**. 

5. Введите *myAGPublicIPAddress* для имени общедоступного IP-адреса. 

6. Оставьте значения по умолчанию для других параметров, а затем нажмите кнопку **ОК**.

### <a name="summary-page"></a>Страница "Сводка"

Просмотрите параметры на странице **Сводка** и нажмите кнопку **ОК**, чтобы создать виртуальную сеть, общедоступный IP-адрес и шлюз приложений. Создание шлюза приложений в Azure может занять несколько минут. Дождитесь успешного завершения развертывания перед переходом к следующему разделу.

## <a name="add-a-subnet"></a>Добавление подсети

Добавьте подсеть к созданной виртуальной сети, выполнив следующие шаги.

1. Выберите **Все ресурсы** в меню слева на портале Azure, введите *myVNet* в поле поиска, а затем выберите **myVNet** из результатов поиска.

2. Выберите **Подсети** в меню слева, а затем щелкните **+ Подсеть**. 

    ![Создание подсети](./media/application-gateway-create-gateway-portal/application-gateway-subnet.png)

3. На странице **Добавление подсети** введите *myBackendSubnet* для параметра **Имя** подсети, а затем щелкните **ОК**.

## <a name="create-backend-servers"></a>Создание внутренних серверов

В этом примере вы создадите две виртуальные машины, которые будут использоваться в Azure как внутренние серверы для шлюза приложений. Вы также установите IIS на виртуальных машинах, чтобы убедиться, что шлюз приложений успешно создан в Azure.

### <a name="create-a-virtual-machine"></a>Создание виртуальной машины

1. На портале Azure выберите **Создать ресурс**. Появится окно **Создать**.

2. Выберите **Вычисление**, а затем в списке **Рекомендованные** выберите **Windows Server 2016 Datacenter**. Появится страница **Создание виртуальной машины**.

3. На вкладке **Основы** введите для следующих параметров виртуальной машины такие значения:

    - **Группа ресурсов.** Выберите **myResourceGroupAG** для имени группы ресурсов.
    - **Имя виртуальной машины**. Введите *myVM* для имени виртуальной машины.
    - **Имя пользователя**. Введите *azureuser* для имени администратора.
    - **Пароль**. Введите *Azure123456!* для пароля администратора.

4. Примите остальные значения по умолчанию и щелкните **Далее: Диски**.  

5. Примите значения по умолчанию на вкладке **Диски**, а затем выберите **Далее: Сети**.

6. На вкладке **Сети** убедитесь, что для параметра **Виртуальная сеть** выбрано значение **myVNet**, а для параметра **Подсеть** — значение **myBackendSubnet**. Примите остальные значения по умолчанию и щелкните **Далее: управление**.

8. На вкладке **Управление** для параметра **Диагностика загрузки** задайте значение **Выкл**. Примите другие значения по умолчанию и выберите **Review + create** (Просмотр и создание).

9. На вкладке **Review + create** (Просмотр и создание) проверьте параметры, устраните ошибки проверки, а затем выберите **Создать**.

10. Прежде чем продолжить, дождитесь завершения создания виртуальной машины.

### <a name="install-iis"></a>Установка служб IIS

1. Откройте [Azure PowerShell](https://docs.microsoft.com/azure/cloud-shell/quickstart-powershell). Для этого выберите **Cloud Shell** в верхней панели навигации портала Azure, а затем выберите **PowerShell** из раскрывающегося списка. 

    ![Установка пользовательского расширения](./media/application-gateway-create-gateway-portal/application-gateway-extension.png)

2. Чтобы установить службы IIS, выполните на виртуальной машине следующие команды: 

    ```azurepowershell-interactive
    Set-AzureRmVMExtension `
      -ResourceGroupName myResourceGroupAG `
      -ExtensionName IIS `
      -VMName myVM `
      -Publisher Microsoft.Compute `
      -ExtensionType CustomScriptExtension `
      -TypeHandlerVersion 1.4 `
      -SettingString '{"commandToExecute":"powershell Add-WindowsFeature Web-Server; powershell Add-Content -Path \"C:\\inetpub\\wwwroot\\Default.htm\" -Value $($env:computername)"}' `
      -Location EastUS
    ```

3. Создайте вторую виртуальную машину и установите IIS, следуя только что выполненным инструкциям. Используйте *myVM2* в качестве имени виртуальной машины и параметр **VMName** для командлета **Set-AzureRmVMExtension**.

### <a name="add-backend-servers"></a>Добавление внутренних серверов

1. Выберите **Все ресурсы**, а затем — **myAppGateway**.

2. Выберите **Серверные пулы** в меню слева. При создании шлюза приложений в Azure автоматически создается пул по умолчанию **appGatewayBackendPool**. 

3. Выберите **appGatewayBackendPool**.

4. В разделе **Цели** выберите **Виртуальная машина** из раскрывающегося списка.

5. В столбцах **Виртуальная машина** и **Сетевые интерфейсы** выберите виртуальные машины **myVM** и **myVM2** и связанные с ними сетевые интерфейсы из раскрывающихся списков.

    ![Добавление внутренних серверов](./media/application-gateway-create-gateway-portal/application-gateway-backend.png)

6. Щелкните **Сохранить**.

## <a name="test-the-application-gateway"></a>Тестирование шлюза приложений

1. Найдите общедоступный IP-адрес для шлюза приложений на странице **Обзор**.

    ![Запись общедоступного IP-адреса шлюза приложений](./media/application-gateway-create-gateway-portal/application-gateway-record-ag-address.png)

    Кроме того, вы можете выбрать **Все ресурсы**, ввести *myAGPublicIPAddress* в поле поиска, а затем выбрать его в результатах поиска. Общедоступный IP-адрес отобразится в Azure на странице **Обзор**.

2. Скопируйте общедоступный IP-адрес и вставьте его в адресную строку браузера.

    ![Тестирование шлюза приложений](./media/application-gateway-create-gateway-portal/application-gateway-iistest.png)

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вам уже не нужны ресурсы, созданные с помощью шлюза приложений, удалите группу ресурсов. Удалив ее, вы также удалите шлюз приложений и все связанные с ним ресурсы. 

Чтобы удалить группу ресурсов:
1. На портале Azure в меню слева выберите **Группы ресурсов**.
2. На странице **Группы ресурсов** выполните поиск группы **myResourceGroupAG** в списке и выберите ее.
3. На странице **группы ресурсов** выберите **Удалить группу ресурсов**.
4. Введите *myResourceGroupAG* в поле **Введите имя группы ресурсов**, а затем выберите **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Руководство по управлению веб-трафиком с помощью шлюза приложений и Azure CLI](./tutorial-manage-web-traffic-cli.md)
