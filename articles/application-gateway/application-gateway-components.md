---
title: Компоненты шлюза приложений Azure
description: Эта статья содержит сведения о различных компонентах в шлюзе приложений
services: application-gateway
author: abshamsft
ms.service: application-gateway
ms.topic: article
ms.date: 02/20/2019
ms.author: absha
ms.openlocfilehash: 44c8b331ebb258c39a003c91e0711e6dfb87cb12
ms.sourcegitcommit: 2d0fb4f3fc8086d61e2d8e506d5c2b930ba525a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/18/2019
ms.locfileid: "58076304"
---
# <a name="application-gateway-components"></a>Компоненты шлюза приложения

 Шлюз приложений служит в качестве единственной точкой контакта для клиентов. Он распределяет входящий трафик приложений в нескольких пулах серверной части, например виртуальные машины Azure, масштабируемые наборы виртуальных машин, службы приложений или в локальной среде и внешних серверов. Чтобы сделать это, он использует несколько компонентов, описанных в этой статье.

![компоненты для шлюза приложений](./media/application-gateway-components/application-gateway-components.png)

## <a name="frontend-ip-address"></a>Интерфейсный IP-адрес

Внешний IP-адрес является IP-адрес, связанный со шлюзом приложений. Можно настроить шлюз приложений, либо иметь общедоступный IP-адрес или частный IP-адрес или оба. Поддерживается только один общедоступный или частный IP-адрес. Виртуальную сеть и общедоступный IP-адрес должен быть в том же расположении, что шлюз приложений.

Внешний IP-адрес связан *прослушивателя* после его создания. 

### <a name="static-vs-dynamic-public-ip-address"></a>Статические и динамические общедоступный IP-адрес

Номер SKU v1 поддерживает статические внутренние IP-адреса, но не поддерживает статические общедоступные IP-адреса. Виртуальный IP-адрес может измениться, если шлюз приложений остановлен и запущен. DNS-имя, связанное со шлюзом приложений, не меняется никогда. По этой причине мы рекомендуем использовать псевдоним CNAME и настроить его для DNS-адреса шлюза приложений.

Номер SKU шлюза приложений версии 2 поддерживает статические общедоступные IP-адреса, а также статических внутренних IP-адресов. 

## <a name="listeners"></a>Прослушиватели

Перед началом использования шлюза приложений, необходимо добавить один или несколько прослушивателей. Прослушиватель — это логическая сущность, которое проверяет наличие входящих запросов на подключение и принимает запросы, если протокол, порт, узла и IP-адрес, связанный с запроса соответствуют протокол, порт, узла и IP-адрес, связанный с конфигурацией прослушивателя. Может существовать несколько прослушивателей, присоединенного к шлюзу приложений, и они могут использоваться для тот же протокол. После прослушивателя определяет входящие запросы от клиентов, шлюз приложений направляет эти запросы к элементам в серверном пуле, с помощью правил маршрутизации запроса, определенных вами для прослушивателя, получившего входящего запроса.

Прослушиватели поддерживает следующие порты и протоколы:

### <a name="ports"></a>порты;

Это порт, прослушиваемый прослушиватель для клиентского запроса. Вы можете настроить порты, от 1 до 65502 для версии 1 и 1 для 65199 для номера SKU V2.

### <a name="protocols"></a>Протоколы

Шлюз приложений поддерживает четыре следующих протоколов: HTTP, HTTPS, HTTP/2 и WebSocket

Можно явно задать выбор между протоколами HTTP и HTTPS в конфигурации прослушивателя. [Поддержки для протоколов WebSockets и HTTP/2](https://docs.microsoft.com/azure/application-gateway/overview#websocket-and-http2-traffic) предоставляется в собственном коде. [Поддержка WebSocket](https://docs.microsoft.com/azure/application-gateway/application-gateway-websocket) включена по умолчанию. Настраиваемый пользователем параметр для выборочного включения или отключения поддержки WebSocket отсутствует. Вы можете использовать WebSocket с прослушивателями HTTP и HTTPS. Поддержка протокола HTTP/2 доступна только для клиентов, подключающихся к прослушивателям шлюза приложений. Подключение к внутренним пулам серверов осуществляется по протоколу HTTP/1.1. Поддержка HTTP/2 отключена по умолчанию. Вы можете включить ее.

Прослушиватель HTTPS можно использовать для завершения SSL-запросов. Прослушиватель HTTPS разгружает шифрования и расшифровки работать на шлюз приложений, таким образом, чтобы веб-серверов не испытывать нагрузку, эту нагрузку. Затем приложения могут сосредоточиться на бизнес-логики.

### <a name="custom-error-pages"></a>Пользовательские страницы ошибок

Шлюз приложений позволяет создавать пользовательские страницы ошибок вместо отображения страницы ошибок по умолчанию. На пользовательской странице ошибок вы можете использовать собственные символику и макет. Шлюз приложений может отобразить пользовательскую страницу ошибки, когда запрос не может достичь серверной части. Дополнительные сведения см. в разделе [страницы настраиваемых ошибок для шлюза приложений](https://docs.microsoft.com/azure/application-gateway/custom-error).

### <a name="types-of-listeners"></a>Типы прослушивателей

Существует два типа прослушивателей:

- **Базовый**. Этот тип прослушивателя ожидает передачи данных на сайт одним доменом, где есть одно сопоставление DNS для IP-адрес шлюза приложений. Эта конфигурация прослушивателя является обязательным, при размещении одного сайта за шлюзом приложений.
- **Многосайтовые**: Эта конфигурация прослушивателя необходим при настройке более одного веб-приложения на одном экземпляре шлюза приложений. Это позволяет настроить более эффективную топологию развертывания путем добавления до 100 веб-сайтов в один шлюз приложений. Каждый веб-сайт может быть направлен в свой собственный внутренний пул. Например:   Для трех поддоменов — abc.contoso.com, xyz.contoso.com и pqr.contoso.com, указывающую на IP-адрес шлюза приложений. Создание прослушивателей три типа *многосайтового* и настройка каждого прослушивателя для соответствующих портов и параметров протокола. Дополнительные сведения см. в разделе [размещение нескольких сайтов](https://docs.microsoft.com/azure/application-gateway/application-gateway-web-app-overview).

После создания прослушивателя, связывается с правило маршрутизации запроса, которое определяет, как запрос, полученный на прослушиватель будет направляться на серверной части.

Прослушиватели обрабатываются в том порядке, в котором они указаны. По этой причине если основной прослушиватель соответствует входящего запроса он сначала обрабатывает его. Чтобы обеспечить маршрутизацию трафика в соответствующую внутреннюю службу, многосайтовые прослушиватели следует настроить до основного прослушивателя.

## <a name="request-routing-rule"></a>Правило маршрутизации запроса

Это является самым важным компонентом шлюза приложений и определяет, как маршрутизируется трафик через прослушиватель, связанный с этим правилом. Это правило связывает прослушиватель, параметры HTTP серверной части и пула внутренних серверов. После принятия запроса прослушивателем правило маршрутизации запроса определяет, является ли запрос к внутренней службе или перенаправление в другом месте. Если запрос определяется должно перенаправляться в серверной части, правило маршрутизации запроса определяет какой пул внутренних серверов должен быть передан для. Кроме того правило маршрутизации запроса также определяет, должны быть переписаны заголовков в запросе. Один прослушиватель могут присваиваться только одно правило.

Возможны два типа правил маршрутизации запроса.

- **Базовая.** Все запросы на связанный прослушиватель (например: blog.contoso.com/*) пересылаются связанные во внутренний пул, используя связанный параметр HTTP.
- **На основе путей:** Этот тип правила позволяет перенаправлять запросы на связанный прослушиватель в определенном серверном пуле, в зависимости от URL-адрес в запросе. Если путь к URL-адрес в запросе соответствует шаблону пути в правила на основе пути, запрос перенаправляется с помощью этого правила. Шаблон пути применяется только к пути URL-адрес, а не на своих параметрах запроса. Если путь URL-адреса запроса на прослушиватель не соответствует ни одному из правил на основе путей, то запрос направляется к *по умолчанию* внутренний пул и *по умолчанию* параметры HTTP. Дополнительные сведения см. в разделе [маршрутизация на основе URL-адрес](https://docs.microsoft.com/azure/application-gateway/url-route-overview).

### <a name="redirection-support"></a>Поддержка перенаправления

Правило маршрутизации запроса также дает возможность перенаправления трафика на шлюзе приложений. Это универсальный механизм перенаправления, позволяющий перенаправить трафик с любого порта и на любой порт, определяемый с помощью правил. Можно выбрать целевой объект перенаправления другой прослушиватель (Это позволяет включить автоматическое перенаправление с HTTP на HTTPS) или внешний узел, выберите перенаправление быть временным или постоянным или выберите, добавив к URI путь и запрос на перенаправленном URL-адрес. Дополнительные сведения см. в разделе [перенаправления трафика на шлюз приложений](https://docs.microsoft.com/azure/application-gateway/redirect-overview).

#### <a name="rewrite-http-headers"></a>Перезапись заголовков HTTP

С помощью правил маршрутизации запроса можно добавить, удалить или обновить HTTP (S) запрос и заголовки ответа, тогда как запрос и пакетов ответа перемещать между пулами клиентской и серверной части, с помощью шлюза приложений. Заголовки можно не только задать статические значения, но и других заголовков и важных серверных переменных. Это поможет вам выполнить несколько важных использования, такие как извлечение IP-адреса клиентов, удаления конфиденциальных сведений о серверной части, добавив дополнительные меры безопасности и т. д. Дополнительные сведения см. в разделе [заголовки HTTP, перепишите на шлюзе приложений](https://docs.microsoft.com/azure/application-gateway/rewrite-http-headers).

## <a name="http-settings"></a>Настройки HTTP

Маршруты шлюза приложений трафик к серверной части, с помощью номера порта, протокола (указанные в правиле маршрутизации запроса, к которому присоединены параметры HTTP) серверы и другие параметры, указанные в этом компоненте. Порт и протокол, используемый в параметрах HTTP определяют, зашифрован ли трафик между сервером шлюза и серверной части приложения, тем самым выполнения сквозного режима связи SSL, так и незашифрованные. Этот компонент также используется для: определить, является ли сеанс пользователя должны храниться на одном сервере с помощью [сходства сеансов на основе файлов cookie](https://docs.microsoft.com/azure/application-gateway/overview#session-affinity), добиться правильного удаления участников пула серверной части с помощью [подключения Сток](https://docs.microsoft.com/azure/application-gateway/overview#connection-draining), связать пользовательскую проверку для отслеживания работоспособности серверной части, задайте интервал времени ожидания запроса, переопределить имя узла и путь в запросе и обеспечивают простоту одним щелчком, чтобы задать параметр серверной части для серверной части приложения службы. 

## <a name="backend-pool"></a>Серверный пул

Внутренний пул используется для перенаправления запросов на внутренних серверах, которые обслуживать запрос. Серверные пулы могут состоять из сетевых адаптеров, масштабирования виртуальной машины, наборы, общедоступный IP-адрес адресов, внутренний IP-адрес адреса, полное доменное имя и несколькими клиентами серверные решения, такие как службы приложений Azure. Участники серверного пула шлюза приложений не привязаны к группе доступности. Шлюз приложений может взаимодействовать с экземплярами за пределами виртуальной сети он находится в, поэтому может быть членов во внутренние пулы в кластерах, центрах обработки данных, или за пределами Azure, до тех пор, пока есть IP-подключения. Если вы планируете использовать внутренние IP-адреса в качестве участников серверного пула, потребуется [пиринговая связь между виртуальными сетями](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) или [VPN-шлюз](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways). Виртуальная сеть поддерживается, целесообразно использовать для балансировки нагрузки трафика в других виртуальных сетях. Шлюз приложений также взаимодействуют для локальных серверов, когда они подключены через туннели ExpressRoute или VPN, до тех пор, пока трафик.

Можно создать различные внутренние пулы для различных типов запросов. Например можно создайте один серверный пул для общих запросов и других внутренний пул для запросов к микрослужбам для вашего приложения.

## <a name="health-probes"></a>Пробы работоспособности.

Шлюз приложений по умолчанию отслеживает работоспособность всех ресурсов в свой внутренний пул и автоматически удаляет все ресурсы, как неработоспособного из пула. Он продолжает отслеживать неисправные экземпляры и добавляет их в пул работоспособных серверной части, как только они становятся доступными и отвечать на пробы работоспособности. Помимо проверки работоспособности по умолчанию проверку также можно настроить в соответствии с требованиями приложения. Пользовательская проверка работоспособности позволяет добиться более детального контроля над мониторингом работоспособности. Если вы используете пользовательскую проверку работоспособности, можно настроить интервал, URL-адрес и путь для тестирования и сколько неудачных откликов, прежде чем экземпляра серверного пула будет помечена как Неработоспособная. Настоятельно рекомендуется настроить пользовательские пробы для мониторинга работоспособности каждого внутреннего пула. Дополнительные сведения см. в разделе [мониторинга работоспособности шлюза приложений](https://docs.microsoft.com/azure/application-gateway/application-gateway-probe-overview).

## <a name="next-steps"></a>Дальнейшие действия

После изучения компоненты шлюза приложений, вы можете:
* [Создание шлюза приложений на портале Azure](quick-create-portal.md)
* [Создание шлюза приложений с помощью Azure PowerShell](quick-create-powershell.md)
* [Создание шлюза приложений с помощью Azure CLI](quick-create-cli.md)
