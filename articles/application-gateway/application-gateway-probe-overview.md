---
title: Обзор мониторинга работоспособности для шлюза приложений Azure
description: Дополнительные сведения о возможностях мониторинга для шлюза приложений Azure
services: application-gateway
documentationcenter: na
author: vhorne
manager: jpconnock
tags: azure-resource-manager
ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 3/30/2018
ms.author: victorh
ms.openlocfilehash: 2f62f01c1178f9529eb46051f088affccc5279a7
ms.sourcegitcommit: 59914a06e1f337399e4db3c6f3bc15c573079832
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/20/2018
ms.locfileid: "30310911"
---
# <a name="application-gateway-health-monitoring-overview"></a>Обзор мониторинга работоспособности шлюза приложений

Шлюз приложений Azure по умолчанию отслеживает работоспособность всех ресурсов в своем пуле внутренних серверов и автоматически удаляет из пула все ресурсы, признанные неработоспособными. Шлюз приложений продолжает отслеживать неисправные экземпляры и добавляет их в пул внутренних серверов, как только они становятся доступными и начинают отвечать на проверку работоспособности. Шлюз приложений отправляет пробы работоспособности с помощью порта, который задан в параметрах HTTP серверной части. Благодаря этой конфигурации проверка тестирует тот же порт, с помощью которого клиенты подключаются к внутренней части.

![пример проверки работоспособности шлюза приложений][1]

Помимо проверки работоспособности по умолчанию проверку также можно настроить в соответствии с требованиями приложения. В этой статье рассматривается как проверка работоспособности по умолчанию, так и пользовательская проверка работоспособности.

> [!NOTE]
> Если в подсети шлюза приложений есть группа безопасности сети, то в этой подсети необходимо открыть диапазон портов 65503–65534 для входящего трафика. Эти порты требуются для работы API работоспособности серверной части.

## <a name="default-health-probe"></a>Проверка работоспособности по умолчанию

Если ни одной из пользовательских проверок работоспособности не настроено, шлюз приложений автоматически настраивает проверку работоспособности по умолчанию. Мониторинг осуществляется путем выполнения HTTP-запроса к IP-адресам пула внутренних серверов. Если выполняется стандартная проба и параметры HTTP серверной части настроены так, что используется протокол HTTPS, проба использует этот же протокол и для проверки работоспособности серверных систем.

Пример. Вы настроили шлюз приложений, так что внутренние серверы A, B и C используются для получения сетевого трафика HTTP на порт 80. По умолчанию мониторинг работоспособности осуществляет проверку трех серверов каждые 30 секунд и ожидает получения HTTP-ответа, подтверждающего работоспособность. HTTP-ответ, подтверждающий работоспособность, имеет [код состояния](https://msdn.microsoft.com/library/aa287675.aspx) от 200 до 399.

Если проверка работоспособности по умолчанию для сервера А завершается неудачно, шлюз приложений удаляет его из внутреннего пула и сетевой трафик перестает поступать на этот сервер. Проверка работоспособности по умолчанию по-прежнему продолжает проверять сервер A каждые 30 секунд. Когда сервер A успешно отвечает на запрос проверки работоспособности по умолчанию, он возвращается в пул внутренних серверов, и передача трафика на этот сервер возобновляется.

### <a name="probe-matching"></a>Соответствие проб

По умолчанию ответ HTTP(S) с кодом состояния 200 указывает на работоспособность. Настраиваемые пробы работоспособности поддерживают два критерия соответствия. Критерий соответствия можно использовать, чтобы дополнительно изменить стандартную интерпретацию содержимого ответа, указывающего на работоспособность.

Эти критерии соответствия приведены ниже. 

- **Соответствие кода состояния ответа HTTP**. Критерий соответствия пробы для приема определенного пользователем отдельного кода ответа HTTP или их диапазонов. Поддерживаются отдельные коды состояния ответа, разделенные запятыми, и диапазоны кодов состояния.
- **Соответствие текста ответа HTTP**. Критерий соответствия пробы, позволяющий проверять текст ответа HTTP и сопоставлять его с указанной пользователем строкой. Обратите внимание на то, что возможен только поиск указанной пользователем строки в тексте ответа, но не полного регулярного выражения.

Критерий соответствия можно задать с помощью командлета `New-AzureRmApplicationGatewayProbeHealthResponseMatch`.

Например: 

```
$match = New-AzureRmApplicationGatewayProbeHealthResponseMatch -StatusCode 200-399
$match = New-AzureRmApplicationGatewayProbeHealthResponseMatch -Body "Healthy"
```
После задания критерия соответствия его можно добавить в конфигурацию пробы с помощью параметра `-Match` в PowerShell.

### <a name="default-health-probe-settings"></a>Параметры проверки работоспособности по умолчанию

| Свойства проверки | Значение | ОПИСАНИЕ |
| --- | --- | --- |
| URL-адрес проверки |http://127.0.0.1:\<порт\>/ |URL-адрес |
| Интервал |30 |Интервал проверки в секундах |
| Время ожидания |30 |Время ожидания проверки в секундах |
| Пороговое значение сбоя |3 |Количество повторных попыток проверки. Сервер внутреннего пула считается неисправным, когда количество повторных неудачных попыток проверки достигает порогового значения сбоя. |

> [!NOTE]
> Порт совпадает с портом, указанным в параметрах HTTP серверной части.

Для определения состояния работоспособности проба по умолчанию использует только http://127.0.0.1:\<порт\>. Если необходимо настроить проверку работоспособности для перехода на настраиваемый URL-адрес или изменить любые другие параметры, используйте пользовательскую проверку работоспособности, как описано ниже.

## <a name="custom-health-probe"></a>Пользовательская проверка работоспособности

Пользовательская проверка работоспособности позволяет добиться более детального контроля над мониторингом работоспособности. При использовании пользовательской проверки можно настроить интервал проверки, URL-адрес и путь проверки, а также количество неудачных попыток проверки, после которых экземпляр пула внутренних серверов должен считаться неработоспособным.

### <a name="custom-health-probe-settings"></a>Параметры пользовательской проверки работоспособности

В следующей таблице приведены описания свойств из пользовательской пробы работоспособности.

| Свойства проверки | ОПИСАНИЕ |
| --- | --- |
| ИМЯ |Имя проверки. Это имя используется для указания проверки в параметрах HTTP внутреннего сервера |
| Протокол |Протокол, используемый для проверки. Проба использует протокол, определенный в параметрах HTTP серверной части. |
| Узел |Имя узла для проверки. Применяется только в случае, когда в шлюзе приложений настроено многосайтовое подключение. В противном случае используется значение 127.0.0.1. Это значение отличается от имени узла виртуальной машины. |
| Путь |Относительный путь проверки. Путь должен начинаться с "/". |
| Интервал |Интервал проверки в секундах. Это значение означает интервал времени между двумя последовательными проверками. |
| Время ожидания |Время ожидания проверки в секундах. Если ответ о работоспособности не получен в течение этого времени ожидания, то проба считается неудачной.  |
| Пороговое значение сбоя |Количество повторных попыток проверки. Сервер внутреннего пула считается неисправным, когда количество повторных неудачных попыток проверки достигает порогового значения сбоя. |

> [!IMPORTANT]
> если шлюз приложений настроен для одного сайта, нужно указать стандартное имя узла 127.0.0.1, если только другое имя не задано в пользовательской пробе;
> Для справки пользовательская проба отправляется по адресу \<протокол\>://\<узел\>:\<порт\>\<путь\>. Используемый порт совпадает с портом, указанным в параметрах HTTP серверной части.

## <a name="next-steps"></a>Дополнительная информация
Ознакомившись со сведениями о мониторинге работоспособности шлюза приложений, можно настроить [пользовательскую проверку работоспособности](application-gateway-create-probe-portal.md) на портале Azure либо [пользовательскую проверку работоспособности](application-gateway-create-probe-ps.md) с использованием модели развертывания PowerShell или Azure Resource Manager.

[1]: ./media/application-gateway-probe-overview/appgatewayprobe.png
