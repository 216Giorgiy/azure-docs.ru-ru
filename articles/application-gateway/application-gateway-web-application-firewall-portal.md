---
title: Создание шлюза приложений с брандмауэром веб-приложения с помощью портала | Microsoft Docs
description: Узнайте, как создать шлюз приложений с брандмауэром веб-приложения с помощью портала.
services: application-gateway
documentationcenter: na
author: georgewallace
manager: carmonm
editor: tysonn
tags: azure-resource-manager

ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/26/2016
ms.author: gwallace

---
# <a name="create-an-application-gateway-with-web-application-firewall-by-using-the-portal"></a>Создание шлюза приложений с брандмауэром веб-приложения с помощью портала
> [!div class="op_single_selector"]
> * [Портал Azure](application-gateway-web-application-firewall-portal.md)
> * [PowerShell и диспетчер ресурсов Azure](application-gateway-web-application-firewall-powershell.md)
> 
> 

Шлюз приложений — это балансировщик нагрузки уровня 7. Он отвечает за отработку отказов и эффективную маршрутизацию HTTP-запросов между разными серверами (облачными и локальными).
Шлюз приложений выполняет многие функции контроллера доставки приложений (ADC), включая балансировку нагрузки HTTP, определение сходства сеансов на основе файлов cookie, разгрузку SSL, выполнение пользовательской проверки работоспособности, поддержку нескольких сайтов и т. д.
Полный список поддерживаемых функций представлен в [обзоре шлюза приложений](application-gateway-introduction.md).

Брандмауэр веб-приложения (WAF) в шлюзе приложений Azure защищает веб-приложения от таких распространенных сетевых атак, как атаки путем внедрения кода SQL, атаки межсайтовых сценариев и захваты сеанса.

## <a name="scenarios"></a>Сценарии
В этой статье представлено два сценария.

В первом сценарии рассматривается [добавление брандмауэра веб-приложения в существующий шлюз приложений](#add-web-application-firewall-to-an-existing-application-gateway).

Во втором сценарии рассматривается [создание шлюза приложений с брандмауэром веб-приложения](#create-an-application-gateway-with-web-application-firewall)

![Пример сценария][scenario]

> [!NOTE]
> Дополнительная настройка шлюза приложений, включая пользовательские пробы работоспособности, серверный пул адресов и дополнительные правила, осуществляется после настройки шлюза приложений, а не во время первоначального развертывания.
> 
> 

## <a name="before-you-begin"></a>Перед началом работы
Шлюзу приложений Azure требуется собственная подсеть. При создании виртуальной сети обязательно оставьте достаточно адресного пространства для нескольких подсетей. После развертывания шлюза приложений в подсети в нее можно добавлять только дополнительные шлюзы приложений.

## <a name="add-web-application-firewall-to-an-existing-application-gateway"></a>добавление брандмауэра веб-приложения в существующий шлюз приложений
В этом сценарии шлюз приложений обновляется для поддержки брандмауэра веб-приложения, работающего в режиме предотвращения.

### <a name="step-1"></a>Шаг 1
Перейдите на портал Azure и выберите существующий шлюз приложений.

![Создание шлюза приложений][1]

### <a name="step-2"></a>Шаг 2
Щелкните **Конфигурация** и обновите параметры шлюза приложений. По завершении нажмите кнопку **Сохранить**

Ниже перечислены параметры, позволяющие обновить шлюз приложений для поддержки брандмауэра веб-приложения.

* **Уровень**. Для поддержки брандмауэра веб-приложения нужно выбрать уровень **WAF**.
* **Размер номера SKU**. Этот параметр задает размер шлюза приложений с брандмауэром веб-приложения. Доступные значения: **Средний** и **Крупный**.
* **Состояние брандмауэра**. Этот параметр позволяет отключить или включить брандмауэр веб-приложения.
* **Режим брандмауэра**. Этот параметр определяет, брандмауэр веб-приложения поступает с вредоносным трафиком. В режиме **Обнаружение** события только регистрируются в журнале, тогда как в режиме **Предотвращение** события регистрируются в журнале и останавливается вредоносный трафик.

![Колонка основных параметров][2]

> [!NOTE]
> Чтобы иметь возможность просматривать журналы брандмауэра веб-приложения, необходимо включить систему диагностики и выбрать параметр ApplicationGatewayFirewallLog. Для тестирования можно выбрать число экземпляров, равное 1. Важно знать, что если указать число экземпляров менее двух, то развертывание не попадает под действие соглашения об уровне обслуживания, и поэтому это не рекомендуется. При использовании брандмауэра веб-приложения шлюзы уровня "Мелкий" недоступны.
> 
> 

## <a name="create-an-application-gateway-with-web-application-firewall"></a>создание шлюза приложений с брандмауэром веб-приложения
Вы узнаете:

* как создать средний шлюз приложений с брандмауэром веб-приложения и двумя экземплярами;
* как создать виртуальную сеть AdatumAppGatewayVNET с зарезервированным блоком CIDR (10.0.0.0/16);
* как создать подсеть с именем Appgatewaysubnet и блоком CIDR (10.0.0.0/28);
* как настроить сертификат для разгрузки SSL.

### <a name="step-1"></a>Шаг 1
Перейдите на портал Azure и выберите **Создать** > **Сети** > **Шлюз приложений**.

![Создание шлюза приложений][1-1]

### <a name="step-2"></a>Шаг 2
Далее введите основные сведения о шлюзе приложений. Обязательно выберите уровень **WAF** . По завершении нажмите кнопку **ОК**

Ниже приведены сведения, которые необходимо указать для основных параметров.

* **Имя**. Имя подсети шлюза приложений.
* **Уровень**. Уровень шлюза приложений. Доступные значения: **Стандартный** и **WAF**. Брандмауэр веб-приложения доступен только для уровня WAF.
* **Размер номера SKU**. Этот параметр указывает размер шлюза приложений. Доступные значения: **Средний** и **Крупный**.
* **Число экземпляров**. Число экземпляров должно быть от **2** до **10**.
* **Группа ресурсов**. Группа ресурсов для хранения шлюза приложений. Это может быть существующая или новая группа ресурсов.
* **Расположение**. Регион для шлюза приложений. В нем же располагается группа ресурсов. *Это расположение важно, так как виртуальная сеть и общедоступный IP-адрес должны быть в том же расположении, что и шлюз*.

![Колонка основных параметров][2-2]

> [!NOTE]
> Для тестирования можно выбрать число экземпляров, равное 1. Важно знать, что если указать число экземпляров менее двух, то развертывание не попадает под действие соглашения об уровне обслуживания, и поэтому это не рекомендуется. Шлюзы уровня "Мелкий" не поддерживаются для сценариев с использованием брандмауэра веб-приложения.
> 
> 

### <a name="step-3"></a>Шаг 3.
После определения основных параметров следующий шаг — определить виртуальную сеть. В виртуальной сети находится приложение, для которого шлюз приложений балансирует нагрузку.

Щелкните **Выбор виртуальной сети** , чтобы настроить виртуальную сеть.

![Колонка параметров шлюза приложений][3]

### <a name="step-4"></a>Шаг 4.
В колонке **Выбор виртуальной сети** щелкните **Создать**.

Здесь не описано создание виртуальной сети, поэтому можно выбрать существующую виртуальную сеть.  Важно помнить, что для использования существующей виртуальной сети требуется пустая подсеть либо подсеть только для ресурсов шлюза приложений.

![Выбор колонки виртуальной сети][4]

### <a name="step-5"></a>Шаг 5
Введите сведения о сети в колонке **Создание виртуальной сети** , как указано в приведенном ранее описании [сценария](#scenario) .

![Колонка создания виртуальной сети с введенными данными][5]

### <a name="step-6"></a>Шаг 6
После создания виртуальной сети следующий шаг — определить интерфейсный IP-адрес для шлюза приложений. На этом этапе можно выбрать общедоступный или частный IP-адрес для внешнего интерфейса. Выбор зависит от того, нужен ли приложению доступ к Интернету или оно является исключительно внутренним. В данном сценарии предполагается использовать общедоступный IP-адрес. Чтобы выбрать частный IP-адрес, нажмите кнопку **Частный**. Будет выбран автоматически назначаемый IP-адрес. Вы можете также установить флажок **Выберите конкретный частный IP-адрес**, чтобы ввести IP-адрес вручную.

Щелкните **Выберите общедоступный IP-адрес**. Если на этом этапе имеется доступный общедоступный IP-адрес, то можно выбрать его. В нашем случае следует создать новый общедоступный IP-адрес. Щелкните **Create new**

![Колонка выбора общедоступного IP-адреса][6]

### <a name="step-7"></a>Шаг 7
Присвойте общедоступному IP-адресу понятное имя и нажмите кнопку **ОК**

![Колонка создания общедоступного IP-адреса][7]

### <a name="step-8"></a>Шаг 8
Далее следует настроить конфигурацию прослушивателей.  Если используется протокол **HTTP**, то настраивать больше ничего не нужно и можно нажать кнопку **ОК**. Чтобы использовать протокол **HTTPS** , нужно настроить дополнительные параметры.

Например, для использования **HTTPS**требуется сертификат. Нужен закрытый ключ сертификата, поэтому необходимо предоставить экспортированный PFX-файл сертификата и пароль для него.

Щелкните **HTTPS**, затем щелкните значок **папки** рядом с текстовым полем **Отправить сертификат PFX**.
Перейдите к PFX-файлу сертификата в своей файловой системе. Выбрав его, присвойте сертификату понятное имя и введите пароль для PFX-файла.

По завершении нажмите кнопку **ОК** , чтобы просмотреть параметры шлюза приложений.

![Раздел конфигурации прослушивателя в колонке "Параметры"][8]

### <a name="step-9"></a>Шаг 9.
Настройте определенные параметры **WAF** .

* **Состояние брандмауэра**. Этот параметр позволяет включить или отключить WAF.
* **Режим брандмауэра**. Этот параметр определяет действия, предпринимаемые WAF в отношении вредоносного трафика. Если выбран режим **Обнаружение**, то трафик только регистрируются в журнале.  Если выбран режим **Предотвращение**, то трафик регистрируется в журнале и останавливается с выводом сообщения "403 — не авторизовано".

![Параметры брандмауэра веб-приложения][9]

### <a name="step-10"></a>Шаг 10
Просмотрите страницу сводки и нажмите кнопку **ОК**.  Теперь шлюз приложений поставлен в очередь и создан.

### <a name="step-12"></a>Шаг 12
После создания шлюза приложений перейдите к нему на портале, чтобы продолжить настройку шлюза параметров.

![Представление ресурса шлюза приложений][10]

В результате выполнения этих действий создается базовый шлюз приложений с параметрами по умолчанию для прослушивателя, серверного пула, протокола HTTP серверной части и правил. Вы сможете изменить эти параметры в соответствии с развертыванием после успешного завершения подготовки.

## <a name="next-steps"></a>Дальнейшие действия
Узнайте, как настроить ведение журнала диагностики и как регистрировать в журнале события, которые обнаружил или предотвратил брандмауэр веб-приложения, посетив страницу [Ведение журнала диагностики для шлюза приложений](application-gateway-diagnostics.md)

Узнайте, как создавать пользовательские пробы работоспособности, посетив страницу [Create a custom probe for Application Gateway by using the portal](application-gateway-create-probe-portal.md)

Узнайте, как настроить разгрузку SSL и убрать дорогостоящее шифрование SSL с веб-серверов, посетив страницу [Настройка шлюза приложений для разгрузки SSL с помощью диспетчера ресурсов Azure](application-gateway-ssl-portal.md)

<!--Image references-->
[1]: ./media/application-gateway-web-application-firewall-portal/figure1.png
[2]: ./media/application-gateway-web-application-firewall-portal/figure2.png
[1-1]: ./media/application-gateway-web-application-firewall-portal/figure1-1.png
[2-2]: ./media/application-gateway-web-application-firewall-portal/figure2-2.png
[3]: ./media/application-gateway-web-application-firewall-portal/figure3.png
[4]: ./media/application-gateway-web-application-firewall-portal/figure4.png
[5]: ./media/application-gateway-web-application-firewall-portal/figure5.png
[6]: ./media/application-gateway-web-application-firewall-portal/figure6.png
[7]: ./media/application-gateway-web-application-firewall-portal/figure7.png
[8]: ./media/application-gateway-web-application-firewall-portal/figure8.png
[9]: ./media/application-gateway-web-application-firewall-portal/figure9.png
[10]: ./media/application-gateway-web-application-firewall-portal/figure10.png
[scenario]: ./media/application-gateway-web-application-firewall-portal/scenario.png


<!--HONumber=Oct16_HO2-->


