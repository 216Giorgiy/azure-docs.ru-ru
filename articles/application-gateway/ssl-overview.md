---
title: Включение сквозного режима связи SSL в Шлюзе приложений Azure
description: В этой статье рассматривается поддержка сквозного режима связи SSL в Шлюзе приложений.
services: application-gateway
author: amsriva
ms.service: application-gateway
ms.topic: article
ms.date: 10/23/2018
ms.author: amsriva
ms.openlocfilehash: fcb49f532d5dfcd340baf017bd55c69d4e81e0e6
ms.sourcegitcommit: c94cf3840db42f099b4dc858cd0c77c4e3e4c436
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/19/2018
ms.locfileid: "53630688"
---
# <a name="overview-of-end-to-end-ssl-with-application-gateway"></a>Обзор сквозного режима связи SSL в шлюзе приложений

Шлюз приложений поддерживает функции моста SSL, после применения которых трафик обычно передается в незашифрованном виде на внутренние серверы. Это позволяет избавить веб-серверы от накладных расходов, связанных с ресурсоемкими операциями шифрования и расшифровки. Однако для некоторых клиентов незашифрованная связь с внутренними серверами — неприемлемый вариант. Причина может быть связана с требованиями безопасности и соответствия или с тем, что приложение может принимать только безопасные подключения. Теперь для таких приложений шлюз приложений поддерживает сквозное шифрование SSL.

Сквозное шифрование SSL позволяет безопасно передавать зашифрованные конфиденциальные данные в серверную часть, используя при этом обеспечиваемые шлюзом приложений преимущества балансировки нагрузки уровня 7. Сюда входит сходство сеансов на основе файлов cookie, маршрутизация на основе URL-адресов, поддержка маршрутизации на основе сайтов и возможность внедрения заголовков X-Forwarded-*.

Если на шлюзе приложений настроен сквозной режим связи SSL, он завершает сеансы SSL пользователей на шлюзе и расшифровывает пользовательский трафик. Затем он применяет настроенные правила и выбирает подходящий экземпляр внутреннего пула для передачи трафика в него. Затем шлюз приложений инициирует новое SSL-подключение ко внутреннему серверу и повторно шифрует данные с помощью сертификата открытого ключа внутреннего сервера, прежде чем передать запрос в серверную часть. Чтобы включить сквозной режим связи SSL, следует задать значение HTTPS для параметра протокола в **BackendHTTPSetting**, который применяется к внутреннему пулу. Для каждого внутреннего сервера во внутреннем пуле, для которого включен сквозной режим связи SSL, должен быть настроен сертификат, обеспечивающий безопасный обмен данными.

![Сценарий сквозного шифрования SSL][1]

В этом примере запросы, в которых используется TLS1.2, направляются на внутренние серверы в пул 1 с помощью сквозного шифрования SSL.

## <a name="end-to-end-ssl-and-whitelisting-of-certificates"></a>Сквозное шифрование SSL и список разрешенных сертификатов

Шлюз приложений взаимодействует только с известными экземплярами серверной части, которые имеют сертификат из списка разрешений, определенного на шлюзе приложений. Чтобы включить список разрешенных сертификатов, необходимо передать открытый ключ сертификатов внутреннего сервера (а не корневой сертификат) в шлюз приложений. После этого будут разрешены подключения только к известным и включенным в разрешенный список серверам. Оставшиеся серверы будут выдавать ошибку шлюза. Самозаверяющие сертификаты предназначены только для тестирования и не рекомендуются для рабочих нагрузок в рабочей среде. Такие сертификаты нужно добавить в список разрешений с помощью шлюза приложений, как описано ранее, прежде чем их можно будет использовать.

> [!NOTE]
> Для надежных служб Azure, таких как служба приложений Azure, настраивать сертификат аутентификации не нужно.

## <a name="end-to-end-ssl-with-the-v2-sku"></a>Сквозное шифрование SSL в номере SKU версии 2

Сертификаты проверки подлинности устарели и заменены доверенными корневыми сертификатами в номере SKU Шлюза приложений версии 2. Они действуют идентично сертификатам проверки подлинности, за исключением нескольких ключевых различий:

- Сертификаты, подписанные хорошо известными ЦС, общие имена которых совпадают с именем узла в параметрах HTTP серверной части, не требуют никаких дополнительных действий для обеспечения работы сквозного шифрования SSL. 

   Например, если сертификаты серверной части выданы хорошо известным центром сертификации и имеют общее имя contoso.com, а в поле узла в параметрах HTTP внутреннего сервера также указано значение contoso.com, дополнительные действия не требуются. Для протокола в параметрах HTTP серверной части можно задать HTTPS. Таким образом, и для пробы работоспособности, и для пути данных будет включен SSL. При использовании службы приложений Azure или других веб-служб Azure в качестве внутреннего сервера они имеют неявное доверие. В этом случае для сквозного шифрования SSL дополнительные шаги не требуются.
- Если сертификат самозаверяющий или подписан неизвестными посредниками, тогда для включения сквозного шифрования SSL в номере SKU версии 2 необходимо определить доверенный корневой сертификат. Шлюз приложений будет взаимодействовать только с серверными частями, корневой сертификат сертификата сервера которых совпадает с одним из сертификатов из списка доверенных корневых сертификатов в параметре HTTP серверной части, который связан с пулом.
- Помимо соответствия корневому сертификату Шлюз приложений также проверяет, соответствуют ли параметры узла, указанные в параметрах HTTP серверной части, обычному имени, представленному сертификатом SSL внутреннего сервера. При попытке установить SSL-подключение к серверной части Шлюз приложений задает расширение SNI узлу, указанному в параметрах HTTP серверной части.
- Если в параметре HTTP серверной части **выбрать имя узла из адреса серверной части** вместо поля узла, то заголовок SNI всегда будет со значением полного доменного имени узла серверной части. Общее имя в сертификате SSL внутреннего сервера должно соответствовать полному доменному имени. Участники серверного пула с IP-адресами не поддерживаются в этом сценарии.
- Корневой сертификат — это закодированный в Base64 корневой сертификат из списка сертификатов внутреннего сервера.

## <a name="next-steps"></a>Дополнительная информация

Ознакомившись со сквозным шифрованием SSL, [настройте сквозное шифрование SSL в Шлюзе приложений с помощью PowerShell](application-gateway-end-to-end-ssl-powershell.md), чтобы создать шлюз приложений, использующий сквозное шифрование SSL.

<!--Image references-->

[1]: ./media/ssl-overview/scenario.png
