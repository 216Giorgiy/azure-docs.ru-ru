<properties
   pageTitle="Службы синхронизации Azure AD Connect: универсальный соединитель LDAP"
   description="В этой статье описана настройка универсального соединителя LDAP от Майкрософт."
   services="active-directory"
   documentationCenter=""
   authors="AndKjell"
   manager="stevenpo"
   editor=""/>

<tags
   ms.service="active-directory"
   ms.workload="identity"
   ms.tgt_pltfrm="na"
   ms.devlang="na"
   ms.topic="article"
   ms.date="12/16/2015"
   ms.author="andkjell"/>

# Технический справочник по универсальному соединителю LDAP

В этой статье описывается универсальный соединитель LDAP. Статья относится к следующим продуктам:

- Microsoft Identity Manager 2016 (MIM2016);
- Forefront Identity Manager 2010 R2 (FIM2010R2).
    -   Необходимо установить исправление 4.1.3461.0 или пакет исправлений [KB2870703](https://support.microsoft.com/kb/2870703).

Для MIM2016 и FIM2010R2 соединитель можно загрузить из [центра загрузки Майкрософт](http://go.microsoft.com/fwlink/?LinkId=717495).

При упоминании документов RFC от IETF в этом документе используется формат (RFC [номер документа RFC]/[раздел в документе RFC]), например RFC 4512/4.3. Дополнительные сведения см. на странице http://tools.ietf.org/html/rfc4500 (замените 4500 соответствующим номером документа RFC).

## Общие сведения об универсальном соединителе LDAP

Универсальный соединитель LDAP позволяет интегрировать службу синхронизации с сервером LDAP v3.

Некоторые операции и элементы схемы, например те, которые нужны для импорта изменений, не указаны в документах RFC от IETF. Для таких операций поддерживаются только явно указанные каталоги LDAP.

На системном уровне текущий выпуск соединителя поддерживает следующие функции.

| Функция | Поддержка |
| --- | --- |
| Подключенный источник данных | Соединитель поддерживают все серверы LDAP v3 (соответствуют требованиям документа RFC 4510). Соединитель протестирован со следующими решениями: <li>службы облегченного доступа к каталогам Microsoft Active Directory (AD LDS);</li><li>глобальный каталог Microsoft Active Directory (AD GC);</li><li>389 Directory Server;</li><li>Apache Directory Server;</li><li>IBM Tivoli DS;</li><li>Isode Directory;</li><li>NetIQ eDirectory;</li><li>Novell eDirectory;</li><li>Open DJ;</li><li>Open DS;</li><li>Open LDAP (openldap.org);</li><li>Oracle (предыдущее название — Sun) Directory Server Enterprise Edition;</li><li>RadiantOne Virtual Directory Server;</li><li>Sun One Directory Server.</li>Не поддерживаются такие каталоги: <li>доменные службы Microsoft Active Directory (AD DS) (взамен используйте встроенный соединитель Active Directory);</li><li>Oracle Internet Directory (OID).</li> |
| Сценарии | <li>Управление жизненным циклом объекта.</li><li>Управление группами.</li><li>Управление паролями.</li> |
| Операции |Следующие операции поддерживаются во всех каталогах LDAP: <li>полный импорт;</li><li>экспорт.</li>Следующие операции поддерживаются только в указанных каталогах:<li>импорт изменений;</li><li>установка и изменение пароля.</li> |
| Схема | <li>Схема определяется из схемы LDAP (RFC 3673 и RFC 4512/4.2).</li><li>Поддерживаются структурные классы, дополнительные классы и класс объектов extensibleObject (RFC 4512/4.3).</li>

### Поддержка импорта изменений и управления паролями

Поддерживаемые каталоги для импорта изменений и управления паролями:

- Службы облегченного доступа к каталогам Microsoft Active Directory (AD LDS).
    - Поддерживаются все операции импорта изменений.
    - Поддерживаются установка и изменение пароля.
- Глобальный каталог Microsoft Active Directory (AD GC).
    - Поддерживаются все операции импорта изменений.
    - Поддерживаются установка и изменение пароля.
- 389 Directory Server.
    - Поддерживаются все операции импорта изменений.
    - Поддерживается установка пароля.
- Apache Directory Server.
    - Импорт изменений не поддерживается, так как в этом каталоге нет постоянного журнала изменений.
    - Поддерживается установка пароля.
- IBM Tivoli DS.
    - Поддерживаются все операции импорта изменений.
    - Поддерживаются установка и изменение пароля.
- Isode Directory.
    - Поддерживаются все операции импорта изменений.
    - Поддерживаются установка и изменение пароля.
- Novell eDirectory и NetIQ eDirectory.
    - В контексте импорта изменений поддерживаются операции добавления, обновления и переименования.
    - В контексте импорта изменений операция удаления не поддерживается.
    - Поддерживаются установка и изменение пароля.
- Open DJ.
    - Поддерживаются все операции импорта изменений.
    - Поддерживается установка пароля.
- Open DS.
    - Поддерживаются все операции импорта изменений.
    - Поддерживается установка пароля.
- Open LDAP (openldap.org).
    - Поддерживаются все операции импорта изменений.
    - Поддерживается установка пароля.
    - Изменение пароля не поддерживается.
- Oracle (предыдущее название — Sun) Directory Server Enterprise Edition.
    - Поддерживаются все операции импорта изменений.
    - Поддерживаются установка и изменение пароля.
- RadiantOne Virtual Directory Server (VDS).
    - Требуется версия 7.1.1 или более новая.
    - Поддерживаются все операции импорта изменений.
    - Поддерживаются установка и изменение пароля.
-  Sun One Directory Server.
    - Поддерживаются все операции импорта изменений.
    - Поддерживаются установка и изменение пароля.

### Предварительные требования

Прежде чем использовать соединитель, убедитесь, что, помимо всех упомянутых выше исправлений, на сервере синхронизации установлены такие компоненты:

- Microsoft .NET Framework, начиная с версии 4.5.2.

### Обнаружение сервера LDAP

Для обнаружения и определения сервера LDAP в соединителе задействуются различные методы. Чтобы определить имя поставщика и версию сервера, в соединителе используется атрибут RootDSE. Затем в схеме ищутся уникальные объекты и атрибуты, которые характерны для соответствующих серверов LDAP. Если эти данные найдены, они автоматически добавляются в конфигурацию соединителя.

### Права на доступ к подключенному источнику данных

Чтобы импортировать и экспортировать объекты, хранящиеся в подключенном каталоге, учетной записи соединителя должны быть предоставлены соответствующие разрешения. Для экспорта соединителю требуются разрешения на запись, а для импорта — на чтение. Разрешения настраиваются с помощью средств управления, предоставляемых целевым каталогом.

### Порты и протоколы

Соединитель использует номер порта, указанный в конфигурации. По умолчанию это 389 для LDAP и 636 для LDAPS.

Для LDAPS необходимо использовать протокол SSL 3.0 или TLS. Протокол SSL 2.0 не поддерживается и не может быть активирован.

### Необходимые элементы управления и компоненты

Для правильной работы соединителя на сервере LDAP должны быть доступны следующие элементы управления и компоненты LDAP:

- Логические фильтры (1.3.6.1.4.1.4203.1.5.3).

Зачастую в описании каталога LDAP не говорится о поддержке логических фильтров, и поэтому они иногда упоминаются на **глобальной странице** в разделе **Не найденные обязательные компоненты**. Логические фильтры используются для создания фильтров **ИЛИ** в запросах LDAP, например при импорте нескольких типов объектов. Если вы можете импортировать несколько типов объектов, то ваш сервер LDAP поддерживает логические фильтры.

Если в вашем каталоге привязкой служит уникальный идентификатор, вам также потребуются такие элементы (дополнительные сведения см. в разделе [Настройка привязок](#configure-anchors) далее в этой статье):

- Все операционные атрибуты (1.3.6.1.4.1.4203.1.5.1).

Если количество объектов в каталоге превышает количество результатов, которое может вернуть один вызов к каталогу, рекомендуется использовать разбиение на страницы. Для разбиения на страницы вам потребуются дополнительные элементы управления:

**Вариант 1.**

- pagedResultsControl (1.2.840.113556.1.4.319).

**Вариант 2.**

- VLVControl (2.16.840.1.113730.3.4.9).
- SortControl (1.2.840.113556.1.4.473).

Если в конфигурации соединителя указаны оба варианта, будет использоваться pagedResultsControl.

- ShowDeletedControl (1.2.840.113556.1.4.417).

ShowDeletedControl используется только при импорте изменений с помощью атрибута USNChanged. Основная цель — просмотр удаленных объектов.

Соединитель пытается определить наличие этих параметров на сервере. Если параметры не найдены, на глобальной странице свойств соединителя появится предупреждение. Не все серверы LDAP сообщают о поддержке всех элементов управления и компонентов, поэтому даже при наличии такого предупреждения соединитель может работать без проблем.

### Импорт изменений

Импорт изменений доступен только при наличии поддерживаемых каталогов. Сейчас используются следующие способы импорта:

- Использование журнала доступа LDAP. См. [http://www.openldap.org/doc/admin24/overlays.html#Access Logging](http://www.openldap.org/doc/admin24/overlays.html#Access Logging)
- Использование журнала изменений LDAP. См. [http://tools.ietf.org/html/draft-good-ldap-changelog-04](http://tools.ietf.org/html/draft-good-ldap-changelog-04)
- Использование метки времени. В каталогах Novell/NetIQ eDirectory для получения созданных и обновленных объектов соединитель будет использовать последнюю дату и время. В каталогах Novell NetIQ eDirectory нет инструментов для получения удаленных объектов. Этот способ можно использовать также в том случае, если на сервере LDAP нет других способов импорта изменений. С помощью этого способа нельзя импортировать удаленные объекты.
- Используется атрибут USNChanged. См. [https://msdn.microsoft.com/library/ms677627.aspx](https://msdn.microsoft.com/library/ms677627.aspx)

### Не поддерживается

Следующие возможности LDAP не поддерживаются:

- Ссылки LDAP между серверами (RFC 4511/4.1.10).

## Создание нового соединителя

Чтобы создать универсальный соединитель LDAP, в **службе синхронизации** последовательно выберите элементы **Агент управления** и **Создать**. Выберите **универсальный соединитель LDAP (Microsoft)**.

![Создание соединителя](./media/active-directory-aadconnectsync-connector-genericldap/createconnector.png)

### Соединение

На странице «Подключение» укажите имя узла, номер порта и сведения о привязке. В зависимости от типа выбранной привязки может потребоваться указать дополнительные сведения.

![Соединение](./media/active-directory-aadconnectsync-connector-genericldap/connectivity.png)

- Параметр «Время ожидания подключения» используется только для первого подключения к серверу при определении схемы.
- Если выбрана анонимная привязка, указывать сертификат или имя пользователя и пароль не нужно.
- Для других типов привязки потребуется указать имя пользователя и пароль либо выбрать сертификат.
- Если для проверки подлинности используется Kerberos, укажите область или домен пользователя.

Текстовое поле **Псевдонимы атрибутов** предназначено для атрибутов, определенных в схеме с помощью синтаксиса RFC 4522. Они не определяются в процессе определения схемы, поэтому соединителю нужны данные об этих атрибутах. Например, чтобы правильно определить двоичный атрибут userCertificate, в текстовое поле «Псевдонимы атрибутов» введите следующее:

`userCertificate;binary`

Вот как может выглядеть заполненное поле:

![Соединение](./media/active-directory-aadconnectsync-connector-genericldap/connectivityattributes.png)

Установите флажок **Включить операционные атрибуты в схему**, чтобы также включить атрибуты, созданные сервером. К ним относятся такие атрибуты, как время создания объекта и время последнего обновления.

Установите флажок **Включить расширяемые атрибуты в схему**, если используются расширяемые объекты (RFC 4512/4.3). Выбор этого параметра позволит применять все атрибуты ко всем объектам. Кроме того, активация этого параметра приведет к значительному увеличению размера схемы, поэтому рекомендуется не устанавливать этот флажок, если эта функция не используется в подключенном каталоге.

### Глобальные параметры

На странице глобальных параметров настраивается различающееся имя для разностного журнала изменений и дополнительных компонентов LDAP. Эта страница автоматически заполняется данными, полученными с сервера LDAP.

![Соединение](./media/active-directory-aadconnectsync-connector-genericldap/globalparameters.png)

В верхней части приводятся предоставленные сервером сведения, в частности имя сервера. Соединитель также проверяет наличие обязательных элементов управления в RootDSE. Если они не указаны, появляется предупреждение. Некоторые каталоги LDAP не сообщают о поддержке всех компонентов в RootDSE, однако соединитель может работать без проблем даже после появления предупреждения.

Флажки в разделе **Поддерживаемые элементы управления** влияют на выполнение некоторых операций.

- Если установлен флажок «Иерархическое удаление», иерархия будет удалена с помощью одного вызова LDAP. Если флажок «Иерархическое удаление» снят, соединитель при необходимости будет выполнять рекурсивное удаление.
- Если установлен флажок pagedResultsControl, соединитель будет выполнять постраничный импорт. Размер страницы определяется в шагах выполнения.
- VLVControl и SortControl — альтернативы элементу pagedResultsControl. Эти элементы используются для чтения данных из каталога LDAP.
- Если снять флажок напротив всех трех элементов (pagedResultsControl, VLVControl и SortControl), соединитель будет импортировать все объекты за одну операцию. Операция может завершиться ошибкой, если размер каталога слишком большой.
- ShowDeletedControl используется только при импорте изменений с помощью атрибута USNChanged.

Различающееся имя журнала изменений представляет собой контекст именования, используемый разностным журналом изменений, например **cn=changelog**. Чтобы импортировать изменения, вам потребуется указать это значение.

Ниже приведен список стандартных различающихся имен для журнала изменений.

| Каталог | Разностный журнал изменений |
| --- | --- |
| Microsoft AD LDS и AD GC | Определяется автоматически. Используется атрибут USNChanged. |
| Apache Directory Server. | Недоступен. |
| 389 Directory Server | Журнал изменений. По умолчанию используется значение **cn=changelog**. |
| IBM Tivoli DS | Журнал изменений. По умолчанию используется значение **cn=changelog**. |
| Isode Directory | Журнал изменений. По умолчанию используется значение **cn=changelog**.
| Novell/NetIQ eDirectory | Недоступен. Используется метка времени. Соединитель будет использовать дату и время последнего обновления для получения добавленных и обновленных записей. |
| Open DJ/DS | Журнал изменений. По умолчанию используется значение **cn=changelog**. |
| Open LDAP | Журнал доступа. По умолчанию используется значение **cn=accesslog**. |
| Oracle DSEE | Журнал изменений. По умолчанию используется значение **cn=changelog**. |
| RadiantOne VDS | Виртуальный каталог. Зависит от каталога, подключенного к VDS. |
| Sun One Directory Server | Журнал изменений. По умолчанию используется значение **cn=changelog**. |

Атрибут пароля — это имя атрибута, который будет использоваться соединителем для установки пароля в операциях изменения и установки паролей. По умолчанию используется имя **userPassword**, но его можно изменить, если это нужно для конкретной системы LDAP.

В списке дополнительных разделов можно добавить дополнительные пространства имен, которые не были обнаружены автоматически. Например, этот список можно использовать, если несколько серверов образуют логический кластер, из которого одновременно нужно импортировать все объекты. Это аналогично тому, что один лес Active Directory может включать несколько доменов, которые совместно используют одну схему. Добавление пространств имен в это поле позволяет имитировать такую структуру. Каждое пространство имен может импортировать объекты из разных серверов. Дополнительные параметры этих пространств можно настроить на странице «Настройка разделов и иерархий». Чтобы добавить новую строку, используйте сочетание клавиш Ctrl+ВВОД.

### Настройка иерархии подготовки

На этой странице можно сопоставить компонент различающегося имени, например OU, с типом подготавливаемого объекта, например organizationalUnit.

![Иерархия подготовки](./media/active-directory-aadconnectsync-connector-genericldap/provisioninghierarchy.png)

Настройка иерархии подготовки позволяет настроить соединитель так, чтобы он автоматически создавал структуру. Например, имеется пространство имен dc=contoso,dc=com и подготавливается новый объект cn=Joe, ou=Seattle, c=US, dc=contoso, dc=com. В этом случае соединитель может создать новый объект типа Country для значения US и объект типа organizationalUnit для значения Seattle, если они отсутствуют в каталоге.

### Настройка разделов и иерархий

На странице разделов и иерархий выберите все пространства имен с объектами, которые планируете импортировать и экспортировать.

![Разделы](./media/active-directory-aadconnectsync-connector-genericldap/partitions.png)

Для каждого пространства имен можно задать параметры подключения, которые переопределят значения, указанные на странице «Подключение». Если оставить стандартные пустые значения, будут использоваться сведения, указанные на странице «Подключение».

Также здесь можно выбрать контейнеры и подразделения (OU), которые соединитель будет использовать для импорта экспорта.

### Настройка привязок

На этой странице все значения уже настроены, и изменить их невозможно. Если поставщик и версия сервера определены, здесь может быть указано значение неизменяемого атрибута, например GUID объекта. Если поставщик и версия сервера не определены или известно, что у них нет неизменяемого атрибута, в качестве привязки соединитель будет использовать различающееся имя.

![Привязки](./media/active-directory-aadconnectsync-connector-genericldap/anchors.png)

Ниже приведен список серверов LDAP и используемых привязок.

| Каталог | Атрибут привязки |
| --- | --- |
| Microsoft AD LDS и AD GC | objectGUID |
| 389 Directory Server | Различающееся имя |
| Apache Directory | Различающееся имя |
| IBM Tivoli DS | Различающееся имя |
| Isode Directory | Различающееся имя |
| Novell/NetIQ eDirectory | GUID |
| Open DJ/DS | Различающееся имя |
| Open LDAP | Различающееся имя |
| Oracle ODSEE | Различающееся имя |
| RadiantOne VDS | Различающееся имя |
| Sun One Directory Server | Различающееся имя |

## Другие примечания

В этом разделе приведены дополнительные сведения, которые относятся к этому соединителя, а также информация, которую важно знать по тем или иным причинам.

### Импорт изменений

В Open LDAP в качестве отметки изменений используются дата и время в формате UTC. По этой причине необходимо синхронизировать часы между службой синхронизации FIM и Open LDAP. В противном случае некоторые записи могут не попасть в разностный журнал изменений.

В случае с Novell eDirectory операция импорта изменений не определяет удаленные объекты. По этой причине для определения удаленных объектов необходимо периодически выполнять полный импорт.

Если в каталогах разностный журнал изменений основан на сведениях о дате и времени, в таких каталогах настоятельно рекомендуется периодически выполнять полный импорт. Это позволит определять и устранять расхождения между данными на сервере LDAP и в пространстве соединителя.

## Устранение неполадок

-	Сведения о том, как включить ведение журнала для устранения неполадок соединителя, см. в статье [Включение трассировки событий Windows для соединителей](http://go.microsoft.com/fwlink/?LinkId=335731).

<!---HONumber=AcomDC_1217_2015-->