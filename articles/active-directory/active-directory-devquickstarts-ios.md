<properties
	pageTitle="Приступая к работе с Azure AD для iOS | Microsoft Azure"
	description="Практическое руководство по созданию приложения для iOS, которое интегрируется с Azure AD для входа в систему и вызывает программные интерфейсы приложения, защищенные Azure AD, по протоколу OAuth."
	services="active-directory"
	documentationCenter="ios"
	authors="brandwe"
	manager="mbaldwin"
	editor=""/>

<tags
	ms.service="active-directory"
	ms.workload="identity"
	ms.tgt_pltfrm="mobile-ios"
	ms.devlang="objective-c"
	ms.topic="article"
	ms.date="04/28/2015"
	ms.author="brandwe"/>

# Интеграция Azure AD в приложение для iOS

[AZURE.INCLUDE [active-directory-devguide](../../includes/active-directory-devguide.md)]

При разработке классического приложения служба Microsoft Azure Active Directory позволяет разработчику упростить проверку подлинности учетных записей пользователей в Active Directory. Также разработчик получает возможность безопасно использовать любые веб-API, защищенные Azure AD, такие как интерфейсы Office 365 API или интерфейс Azure API.

Клиентские приложения для iOS, которым необходим доступ к защищенным ресурсам, могут использовать библиотеку проверки подлинности Azure AD (ADAL). Единственное предназначение ADAL — упростить для разработчика процесс получения маркеров доступа. Чтобы показать, насколько это просто, создадим приложение To Do List (список дел) на Objective C, которое:

-	Получает маркеры доступа для вызова интерфейса API Graph Azure AD с помощью [протокола проверки подлинности OAuth 2.0](https://msdn.microsoft.com/library/azure/dn645545.aspx).
-	Осуществляет поиск пользователей в каталоге по псевдониму.
-	Обеспечивает функцию выхода пользователя из приложения.

Для создания полного рабочего приложения необходимо:

2. Зарегистрировать приложение в Azure AD.
3. Установить и настроить библиотеку ADAL.
5. Использовать ADAL для получения маркеров из Azure AD.

Чтобы начать работу, [загрузите каркас приложения](https://github.com/AzureADQuickStarts/NativeClient-iOS/archive/skeleton.zip) или [завершенный пример](https://github.com/AzureADQuickStarts/NativeClient-iOS/archive/complete.zip). Вам также потребуется клиент Azure AD, в котором можно будет создавать пользователей и регистрировать приложение. Если у вас еще нет клиента, [узнайте, как его получить](active-directory-howto-tenant.md).

## Этап 1. Загрузка и запуск образца серверного кода, реализующего интерфейс REST API приложения To Do List для Node.js или для .NET.

Описываемый в этой статье образец специально создается так, чтобы можно было сравнить его работу с существующим образцом, создающим интерфейс REST API для однотенантного  приложения To Do List под управлением Azure AD. Вышеупомянутый образец службы необходим для данного примера быстрого старта.

Для получения информации об его установке просмотрите пример здесь:

* [Образец службы REST API под управлением Azure AD для Node.js](active-directory-devquickstarts-webapi-nodejs.md)

## Этап 2. Регистрация веб-API с помощью клиента Azure AD

**Что я делаю?**

*Служба каталогов Microsoft Active Directory позволяет добавлять приложения двух типов: веб-интерфейсы API, которые предоставляют услуги пользователям, и приложения (работающие через Интернет или на устройстве), использующие эти веб-API. На этом этапе вы зарегистрируете веб-API, который будет работать локально для тестирования данного образца. Обычно этот веб-интерфейс API является службой REST, предоставляющей приложению необходимую функциональность. Microsoft Azure Active Directory может обеспечить защитой любую конечную точку!*

*Здесь выполняется регистрация интерфейса REST API приложения To Do List, но описанная процедура регистрации будет работать для любого веб-интерфейса API, защищаемого Azure AD.*

Действия по регистрации веб-интерфейса API с помощью Azure AD

1. Войдите на [Портал управления Azure](https://manage.windowsazure.com).
2. Щелкните "Active Directory" в левой панели навигации.
3. Выберите клиента каталога, в котором нужно зарегистрировать приложение-пример.
4. Откройте вкладку Приложения.
5. На выдвижной панели нажмите кнопку Добавить.
6. Щелкните "Добавить приложение, которое разрабатывает моя организация".
7. Введите понятное имя для приложения, например "TodoListService", выберите "Веб-приложение и/или веб-API" и нажмите кнопку "Далее".
8. В качестве URL-адреса единого входа введите базовый URL-адрес образца, который по умолчанию имеет значение `https://localhost:8080`.
9. В качестве идентификатора URI приложения введите `https://<your_tenant_name>/TodoListService`, заменив `<your_tenant_name>` на имя вашего клиента Azure AD. Для завершения регистрации нажмите кнопку "OK".
10. Не выходя из портала Azure, откройте вкладку "Конфигурация" приложения.
11. **Найдите значение идентификатора клиента и скопируйте его**, оно потребуются позже при настройке приложения.

## Этап 3. Регистрация образца нативного клиентского приложения для iOS 

Прежде всего необходимо зарегистрировать веб-приложение. Далее необходимо сообщить о приложении в Azure AD. Это позволяет приложению взаимодействовать с только что зарегистрированным веб-API.

**Что я делаю?**

*Как уже говорилось, служба каталогов Microsoft Active Directory позволяет добавлять приложения двух типов: веб-интерфейсы API, которые предоставляют услуги пользователям, и приложения (работающие через Интернет или на устройстве), использующие эти веб-API. На этом этапе регистрируется приложение-образец. Это необходимо для того, чтобы приложение могло запросить доступ к только что зарегистрированному веб-API. Если приложение не зарегистрировано, то Azure AD не позволит ему даже запросить данные для входа. Это часть модели безопасности.*

*Здесь выполняется регистрация приложения-образца, но описанная процедура регистрации будет работать для любого разрабатываемого приложения.*

**Почему приложение и веб-интерфейс API размещаются в одном клиенте?**

*Как вы могли догадаться, можно создать приложение, которое обращается к внешнему интерфейсу API, зарегистрированному в Azure AD из другого клиента. При этом пользователям будет предложено дать согласие на использование этого интерфейса API в приложении. Радует то, что библиотека проверки подлинности ADAL для iOS выполняет все необходимые операции для обработки данного согласия! В более сложных задачах становится очевидным, что обработка согласия является важной составляющей доступа к интерфейсам Microsoft API от Azure и Office, а также любого другого поставщика услуг. Пока приложение и веб-интерфейс зарегистрированы в рамках одного и того же клиента, пользователь не увидит запросы на согласие. Это типично для приложений, предназначенных для использования только внутри компании.*

1. Войдите на [Портал управления Azure](https://manage.windowsazure.com).
2. Щелкните "Active Directory" в левой панели навигации.
3. Выберите клиента каталога, в котором нужно зарегистрировать приложение-пример.
4. Откройте вкладку "Приложения".
5. На выдвижной панели нажмите "Добавить".
6. Щелкните "Добавить приложение, которое разрабатывает моя организация".
7. Введите понятное имя для приложения, например "TodoListClient-iOS", выберите "Собственное клиентское приложение" и нажмите кнопку "Далее".
8. В качестве URI переадресации укажите `http://TodoListClient`. Нажмите кнопку "Готово"
9. Перейдите на вкладку приложения "Настройка".
10. Найдите значение идентификатора клиента и скопируйте его, оно потребуются позже при настройке приложения.
11. В меню "Разрешения для других приложений" щелкните "Добавить приложение". Из раскрывающегося списка "Показать" выберите "Другое" и щелкните флажок вверху. Найдите и щелкните TodoListService, затем установите флажок внизу, чтобы добавить приложение. Выберите "Доступ к TodoListService" из раскрывающегося списка "Делегированные разрешения" и сохраните конфигурацию.


## Этап 4. Загрузка образца кода нативного клиентского приложения для iOS

* `$ git clone git@github.com:AzureADSamples/NativeClient-iOS.git`

## Этап 5. Загрузка библиотеки ADAL для iOS и добавление ее в рабочую область XCode

#### Загрузка ADAL для iOS:

* `git clone git@github.com:MSOpenTech/azure-activedirectory-library-for-ios.git`

#### Импорт библиотеки в рабочую область

В XCode щелкните правой кнопкой мыши каталог проекта и выберите в контекстном меню команду "Add files to “iOS Sample”..." (Добавить файлы в “Образец для iOS”).

При появлении запроса укажите каталог, в который будет клонирована библиотека ADAL для iOS.

#### Добавление libADALiOS.a к связанным платформам и библиотекам

Нажмите кнопку добавления в разделе "Linked Frameworks and Libraries" (Связанные платформы и библиотеки) и добавьте файл библиотеки из раздела импортированных платформ.

Выполните сборку проекта, чтобы убедиться в отсутствии ошибок компиляции.


## Этап 6. Настройка файла settings.plist на использование веб-интерфейса API

Файл settings.plist находится в разделе "Supporting Files" (Вспомогательные файлы). Он содержит следующую информацию:

```XML
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>authority</key>
	<string>https://login.windows.net/common/oauth2/token</string>
	<key>clientId</key>
	<string>xxxxxxx-xxxxxx-xxxxxxx-xxxxxxx</string>
	<key>resourceString</key>
	<string>https://localhost/todolistservice</string>
	<key>redirectUri</key>
	<string>http://demo_todolist_app</string>
	<key>userId</key>
	<string>user@domain.com</string>
	<key>taskWebAPI</key>
	<string>https://localhost/api/todolist/</string>
</dict>
</plist>
```

Замените параметры, указанные в этом файле, на параметры вашего веб-API.

##### ПРИМЕЧАНИЕ

Текущие значения по умолчанию настроены для работы с нашей [службой-образцом REST API под управлением Azure AD, реализованной для Node.js](https://github.com/AzureADSamples/WebAPI-Nodejs). Но вам потребуется указать clientID вашего веб-интерфейса API. При использовании собственного интерфейса API вам потребуется обновить конечные точки так, как это необходимо.

## Этап 7. Создание и запуск приложения

Вы сможете подключиться к конечной точке REST API, и будут запрошены учетные данные из вашей учетной записи Azure AD.

Дополнительные ресурсы: - [AzureADSamples на GitHub >>](https://github.com/AzureAdSamples) -  документация по Azure AD на [Azure.com >>](http://azure.microsoft.com/documentation/services/active-directory/)

<!---HONumber=58--> 