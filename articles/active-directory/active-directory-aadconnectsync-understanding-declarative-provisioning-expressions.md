<properties
	pageTitle="Azure AD Connect Sync: общие сведения о выражениях декларативной подготовки | Microsoft Azure"
	description="Описание выражений декларативной подготовки."
	services="active-directory"
	documentationCenter=""
	authors="markusvi"
	manager="stevenpo"
	editor=""/>

<tags
	ms.service="active-directory"
	ms.workload="identity"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="11/10/2015"
	ms.author="markusvi;andkjell"/>


# Azure AD Connect Sync: общие сведения о выражениях декларативной подготовки

Azure AD Connect Sync основана на принципах декларативной подготовки. Функция декларативной подготовки, впервые представленная в Forefront Identity Manager 2010, позволяет полностью реализовать бизнес-логику интеграции идентификации без необходимости написания кода.

Важной частью декларативной подготовки является язык выражений, используемый в потоке атрибутов. Это подмножество Microsoft® Visual Basic® для приложений (VBA). Этот язык используется в Microsoft Office и знаком пользователи, имеющим опыт работы с VBScript. Язык выражений декларативной подготовки не структурированный и использует только функции, но не методы или инструкции. Вместо этого функции вложены в поток программы.

Дополнительные сведения см. в статье [Справочник по языку Visual Basic для Office 2013](https://msdn.microsoft.com/library/gg264383.aspx).

Атрибуты являются строго типизированными. Функция, ожидающая строку с одним значением, не будет принимать строку с несколькими значениями или атрибуты другого типа. Также учитывается регистр символов. Имена функций и имен атрибутов должны указываться с учетом регистра, иначе произойдет ошибка.

## Определения и идентификаторы языка

- У функции есть имя, за которым следует список аргументов в скобках: имя\_функции(аргумент 1, аргумент N).
- Атрибуты заключаются в квадратные скобки: [имя\_атрибута].
- Параметры задаются знаком процента: %имя\_параметра%.
- Строковые константы заключаются в кавычки: например, "Contoso" (обратите внимание: необходимо использовать прямые "", а не парные “” кавычки).
- Числовые значения приводятся без кавычек; они считаются десятичными. Шестнадцатеричные значения должны иметь префикс &H. Например, 98052, &HFF.
- Логические значения выражаются константами True и False.
- Встроенные константы выражаются только своим именем: NULL, CRLF, IgnoreThisFlow.

### Functions
Декларативная подготовка использует множество функций для преобразования значений атрибутов. Они могут быть вложенными, так что результат из одной функции передается в другую функцию.

Функции также могут работать с многозначными атрибутами. В этом случае функция работает с каждым отдельным значением и применяет одну и ту же функцию к каждому отдельному значению. Например, `Trim([proxyAddresses])` выполнит обрезку (Trim) для каждого значения атрибута proxyAddress.

Полный список функций можно найти в [справочнике по функциям](active-directory-aadconnectsync-functions-reference.md).

### Параметры

Параметр задается соединителем или администратором с помощью PowerShell. Обычно параметры содержат значения, которые отличаются в разных системах, например имя домена, в котором находится пользователь. Эти параметры могут использоваться в потоках атрибутов.

Соединитель Active Directory предоставляет следующие параметры для входящих правил синхронизации.

| Имя параметра | Комментарий |
| --- | --- |
| Domain.Netbios | Формат NetBIOS импортируемого домена, например, FABRIKAMSALES |
| Domain.FQDN | Формат FQDN импортируемого домена, например, sales.fabrikam.com |
| Domain.LDAP | Формат LDAP импортируемого домена, например, DC=sales, DC=fabrikam, DC=com |
| Forest.Netbios | Формат NetBIOS импортируемого имени леса, например, FABRIKAMCORP |
| Forest.FQDN | Формат FQDN импортируемого имени леса, например, fabrikam.com |
| Forest.LDAP | Формат LDAP импортируемого имени леса, например, DC=fabrikam,DC=com |

Система предоставляет следующий параметр, который используется для получения идентификатора запущенного соединителя:

`Connector.ID`

Пример, в котором атрибут domain метавселенной будет заполнен NetBIOS-именем домена, в котором расположен пользователь:

`domain <- %Domain.Netbios%`

### Операторы

Могут использоваться следующие операторы.

- **Сравнение**: <, <=, <>, =, >, >=
- **Математические**: +, -, *, -
- **Строковые**: & (сцепление)
- **Логические**: && (и), || (или)
- **Порядок вычисления**: ( )

Операторы выполняются в порядке слева направо и имеют одинаковый приоритет вычисления. Т. е. * (умножение) не вычисляется до – (вычитания). 2*(5+3) не равно 2*5+3. Скобки () используются, чтобы изменить порядок вычислений, когда порядок вычислений слева направо не подходит.

## Распространенные сценарии

### Длина атрибутов

Строковые атрибуты по умолчанию являются индексируемыми. Их длина не может превышать 448 знаков. При работе с атрибутами, которые могут содержать больше знаков, необходимо включить в поток атрибутов следующее значение.

`attributeName <- Left([attributeName],448)`

### Изменение атрибута userPrincipalSuffix

Атрибут userPrincipalName в Active Directory не всегда известен пользователям. Также он может не подходить в качестве идентификатора для входа. Мастер установки Azure AD Connect Sync позволяет выбрать другой атрибут, например, mail. Но в некоторых случаях этот атрибут должен вычисляться. Например, у компании Contoso есть два каталога Azure AD: один для рабочей среды, а другой для тестовой. Пользователи в тестовом клиенте должны просто изменить суффикс в идентификаторе входа.

`userPrincipalName <- Word([userPrincipalName],1,"@") & "@contosotest.com"`

В этом выражении берется вся часть слева от первого знака @ (Word) и сцепляется с фиксированной строкой.

### Преобразование атрибута с несколькими значениями в атрибут с одним

Некоторые атрибуты в Active Directory имеют несколько значений в схеме, даже если в средстве администрирования «Пользователи и компьютеры Active Directory» они выглядят как атрибуты с одним значением. Пример — атрибут description.

`description <- IIF(IsNullOrEmpty([description]),NULL,Left(Trim(Item([description],1)),448))`

В этом выражении в случае, если атрибут имеет значение, берется первый элемент (Item) в атрибуте, удаляются начальные и конечные пробелы (Trim), а затем сохраняются первые 448 знаков (Left) в строке.

## Расширенная концепция

### Константы NULL и IgnoreThisFlow

Для входящих правил синхронизации всегда должна использоваться константа **NULL**. Она указывает, что в потоке нет значения для передачи, и другое правило может передать значение. Если никакое правило не передает значение, атрибут метавселенной удаляется.

Во входящих правилах синхронизации могут использоваться две константы: NULL и IgnoreThisFlow. Обе константы указывают на то, что в потоке атрибутов нет значения для передачи. При этом разница заключается в том, что именно происходит, если остальные правила также ничего не передают. Если в подключенном каталоге есть существующее значение, при использовании NULL соответствующий атрибут будет удален, а при использовании IgnoreThisFlow будет сохранено существующее значение.

#### Функция ImportedValue

Функция ImportedValues отличается от всех других функций, поскольку имя ее атрибута должно заключаться в кавычки, а не в квадратные скобки: ImportedValue(“proxyAddresses”).

Обычно во время синхронизации атрибут будет использовать ожидаемое значение, даже если оно еще не экспортировано или если во время экспорта произошла ошибка («верхняя часть башни»). Во время входящей синхронизации предполагается, что атрибут, который еще не достиг связанного каталога, обязательно достигнет его. В некоторых случаях важно синхронизировать только значение, подтвержденное подключенным каталогом. В таком случае используется функция ImportedValue («голограмма и башня импорта разницы»).

Пример этого использования можно найти в стандартном правиле синхронизации Exchange: In from AD — User Common. Согласно этому правилу в гибридной среде Exchange значение, добавленное Exchange Online, должно синхронизироваться только в том случае, если был подтвержден успешный экспорт этого значения:

`proxyAddresses <- RemoveDuplicates(Trim(ImportedValues("proxyAddresses")))`

Полный список функций см. в статье [Azure AD Connect Sync: справочник по функциям](active-directory-aadconnectsync-functions-reference.md)


## Дополнительные ресурсы

* [Azure AD Connect Sync: настройка параметров синхронизации](active-directory-aadconnectsync-whatis.md)
* [Интеграция локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md)

<!--Image references-->

<!---HONumber=Nov15_HO3-->