---
title: Настройка единого входа в Azure Active Directory | Документация Майкрософт
description: В этом руководстве показано, как с помощью портала Azure настроить единый вход на основе SAML для приложения в Azure Active Directory (Azure AD).
services: active-directory
author: CelesteDG
manager: mtillman
ms.service: active-directory
ms.subservice: app-mgmt
ms.topic: tutorial
ms.workload: identity
ms.date: 12/06/2018
ms.author: celested
ms.reviewer: arvinh,luleon
ms.collection: M365-identity-device-management
ms.openlocfilehash: 1b04831790083f9ba41f20719a7d8ffddc35348b
ms.sourcegitcommit: 301128ea7d883d432720c64238b0d28ebe9aed59
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/13/2019
ms.locfileid: "56210413"
---
# <a name="tutorial-configure-saml-based-single-sign-on-for-an-application-with-azure-active-directory"></a>Руководство. Настройка единого входа на основе SAML для приложения в Azure Active Directory

В этом руководстве показано, как с помощью [портала Azure](https://portal.azure.com) настроить единый вход на основе SAML для приложения в Azure Active Directory (Azure AD). Используйте это руководство, когда [руководство для конкретного приложения](../saas-apps/tutorial-list.md) недоступно. 

В этом руководстве портал Azure используется для таких целей:

> [!div class="checklist"]
> * Выбор режима единого входа на основе SAML
> * Настройка домена и URL-адресов для конкретного приложения
> * Настройка атрибутов пользователя
> * Создание сертификата подписи SAML
> * Назначение пользователей для приложения
> * Настройка приложения для единого входа на основе SAML
> * Проверка параметров SAML

## <a name="before-you-begin"></a>Перед началом работы

1. Если приложение еще не было добавлено в клиент Azure AD, ознакомьтесь со статьей [Краткое руководство. Добавление приложения в клиент Azure Active Directory](add-application-portal.md).

2. Запросите у поставщика приложения данные, описанные в разделе [Домены и URL-адреса](#configure-domain-and-urls).

3. Рекомендуется использовать нерабочую среду для проверки шагов в этом учебнике. Если у вас нет нерабочей среды Azure AD, можно [получить пробную версию на один месяц](https://azure.microsoft.com/pricing/free-trial/).

4. Войдите на [портал Azure](https://portal.azure.com) в качестве администратора облачных приложений или администратора приложения для клиента Azure AD.

## <a name="select-a-single-sign-on-mode"></a>Выбор режима единого входа

После добавления приложения в клиент Azure AD можно настроить единый вход для приложения.

Чтобы открыть параметры единого входа, сделайте следующее:

1. На [портале Azure](https://portal.azure.com) в области навигации слева щелкните **Azure Active Directory**. 

2. В колонке **Azure Active Directory** нажмите **Корпоративные приложения**. Откроется колонка **Все приложения** для отображения случайной выборки из приложений в клиенте Azure AD. 

3. В меню **Тип приложения** выберите **Все приложения** и нажмите кнопку **Применить**.

4. Укажите имя приложения, для которого необходимо настроить единый вход. Выберите свое приложение или введите **GitHub-test**, чтобы настроить приложение, которое было добавлено с помощью [этого краткого руководства](add-application-portal.md).

5. Щелкните **Единый вход**. В разделе **Режим единого входа** значение **Вход на базе SAML** отображается по умолчанию. 

    ![Варианты настройки](media/configure-single-sign-on-portal/config-options.png)

6. Щелкните **Сохранить** в верхней части колонки. 

## <a name="configure-domain-and-urls"></a>Настройка домена и URL-адресов

Для настройки домена и URL-адресов сделайте следующее:

1. Обратитесь к поставщику приложения, чтобы получить правильные данные для следующих параметров:

    | Параметр конфигурации | Инициированный поставщиком услуг | Инициированный поставщиком удостоверений | ОПИСАНИЕ |
    |:--|:--|:--|:--|
    | URL-адрес входа | Обязательно | Не указывайте | Когда пользователь открывает этот URL-адрес, поставщик услуг выполняет перенаправление в Azure AD для аутентификации и входа пользователя в систему. Azure AD использует URL-адрес, чтобы запустить приложение из Office 365 или на панели доступа Azure AD. Если это поле пусто, Azure AD полагается на поставщика удостоверений, который инициирует единый вход, когда пользователь запускает приложение.|
    | Идентификатор (идентификатор сущности) | Требуется для некоторых приложений | Требуется для некоторых приложений | Однозначно определяет приложение, для которого выполняется настройка единого входа. Azure AD отправляет идентификатор в приложение в качестве параметра "Аудитория" токена SAML. Приложение должно проверить его. Это значение также отображается как идентификатор сущности во всех метаданных SAML, предоставленных приложением.|
    | URL-адрес ответа | Необязательно | Обязательно | Этот параметр указывает место, где приложение ожидает токен SAML. URL-адрес ответа также называется URL-адресом службы обработчика утверждений (ACS). |
    | Состояние ретранслятора | Необязательно | Необязательно | Указывает приложению, куда перенаправить пользователя после аутентификации. Обычно в качестве значения для этого параметра используется допустимый URL-адрес приложения, но в некоторых приложениях это поле заполняется другими значениями. Чтобы получить дополнительные сведения, обратитесь к поставщику приложения.

2. Введите необходимые сведения. Чтобы просмотреть все параметры, щелкните **Показать дополнительные параметры URL-адресов**.

    ![Варианты настройки](media/configure-single-sign-on-portal/config-urls.png)

3. В верхней части колонки щелкните **Сохранить**.

4. В этом разделе есть кнопка **Проверить параметры SAML**. Выполните эту проверку позже с помощью инструкций по [проверке единого входа](#test-single-sign-on) в этом руководстве.

## <a name="configure-user-attributes"></a>Настройка атрибутов пользователя

Атрибуты пользователя позволяют выбирать, какие сведения Azure AD отправляет в приложение в токене SAML каждый раз, когда пользователь входит в систему. Например, Azure AD может отправлять в приложение такие сведения о пользователе, как имя, адрес электронной почты и идентификатор сотрудника. 

Для надлежащей работы единого выхода эти атрибуты могут быть обязательными или необязательными. Чтобы получить дополнительные сведения, см. [руководство по конкретному приложению](../saas-apps/tutorial-list.md) или обратитесь к поставщику приложения.

1. Чтобы просмотреть все параметры, щелкните **Просмотреть и изменить все другие атрибуты пользователей**.

    ![Настройка атрибутов пользователя](media/configure-single-sign-on-portal/config-user-attributes.png)

2. Введите **Идентификатор пользователя**.

    Идентификатор пользователя является уникальным идентификатором для каждого пользователя в приложении. Например, если адрес электронной почты является и именем пользователя, и уникальным идентификатором, задайте значение *user.mail*.

3. Чтобы просмотреть другие атрибуты токена SAML, щелкните **Просмотреть и изменить все другие атрибуты пользователей**.

4. Чтобы добавить атрибут в список **атрибутов токена SAML**, щелкните **Добавить атрибут**. Введите его **имя** и в меню выберите **значение**.

5. Выберите команду **Сохранить**. Новый атрибут появится в таблице.
 
## <a name="create-a-saml-signing-certificate"></a>Создание сертификата подписи SAML

Azure AD использует сертификат для подписи токенов SAML, отправляемых в приложение. 

1. Чтобы просмотреть все параметры, установите флажок **Показать дополнительные параметры подписи с помощью сертификата**.

    ![Настройка сертификатов](media/configure-single-sign-on-portal/config-certificate.png)

2. Чтобы настроить сертификат, щелкните **Создать сертификат**.

3. В колонке **Создание сертификата** укажите **дату окончания срока действия** и нажмите кнопку **Сохранить**.

4. Установите флажок **Сделать сертификат активным**.

5. Дополнительные сведения см. описании [дополнительных параметров подписи сертификата в маркере SAML для приложений коллекции в Azure Active Directory](certificate-signing-options.md).

6. Чтобы сохранить текущие изменения, в верхней части колонки **Единый вход** нажмите кнопку **Сохранить**. 

## <a name="assign-users-to-the-application"></a>Назначение пользователей для приложения

Перед развертыванием приложения в вашей организации корпорация Майкрософт рекомендует протестировать единый вход с помощью нескольких пользователей или групп.

Чтобы назначить пользователя или группу приложению, сделайте следующее:

1. Откройте приложение на портале, если оно еще не открыто.
2. В колонке приложения слева щелкните **Пользователи и группы**.
3. Нажмите кнопку **Добавить пользователя**.
4. В колонке приложения **Добавление назначения** щелкните **Пользователи и группы**.
5. Чтобы найти определенного пользователя, введите имя пользователя в поле **Выбрать**, установите флажок рядом с фотографией профиля или логотипом пользователя и щелкните **Выбрать**. 
6. Найдите текущее имя пользователя и выберите его. При необходимости можно выбрать несколько пользователей.
7. В колонке **Добавление назначения** щелкните **Назначить**. После этого выбранные пользователи появятся в списке **Пользователи и группы**.

## <a name="configure-the-application-to-use-azure-ad"></a>Настройка приложения для использования Azure AD

Осталось совсем немного.  На последнем этапе необходимо настроить приложение для использования Azure AD в качестве поставщика удостоверений SAML. 

1. Прокрутите список в колонке **Единый вход** до конца, чтобы найти приложение. 

    ![Настройка приложения](media/configure-single-sign-on-portal/configure-app.png)

2. На портале щелкните **Настроить приложение** и следуйте инструкциям.
3. Вручную создайте учетные записи пользователей в приложении, чтобы протестировать единый вход. Создайте учетные записи пользователей, назначенных для приложения в [предыдущем разделе](#assign-users-to-the-application). 

## <a name="test-single-sign-on"></a>Проверка единого входа

Все готово для тестирования параметров.  

1. Откройте параметры единого входа для приложения. 
2. Прокрутите страницу до раздела **Настройка домена и URL-адресов**.
2. Нажмите кнопку **Проверить параметры SAML**. Отобразятся параметры тестирования.

    ![Параметры единого входа](media/configure-single-sign-on-portal/test-single-sign-on.png) 

3. Щелкните **Войдите от имени текущего пользователя**. Этот тест позволит сначала увидеть, работает ли единый вход для вас как для администратора.
4. Если возникнет ошибка, появится сообщение об ошибке. Скопируйте и вставьте сведения об ошибке в поле **Как выглядит ошибка**.

    ![Получение рекомендаций по устранению](media/configure-single-sign-on-portal/error-guidance.png)

5. Нажмите кнопку **Получить рекомендации по устранению**. Отобразятся сведения о причине ошибки и рекомендации по ее устранению.  В этом примере пользователь не был назначен приложению.

    ![Исправление ошибки](media/configure-single-sign-on-portal/fix-error.png)

6. Прочтите рекомендации по устранению, а затем при необходимости нажмите кнопку **Исправить**.

7. Выполните проверку еще раз, чтобы она завершилась успешно.



## <a name="next-steps"></a>Дополнительная информация
В этом руководстве вы настроили параметры единого входа для приложения. По завершении настройки вы назначили пользователя приложению и настроили приложение для использования единого входа на основе SAML. После этого вы выполнили проверку и убедились, что вход SAML работает надлежащим образом.

Вы выполнили такие действия:
> [!div class="checklist"]
> * выбор SAML для режима единого входа;
> * подключение к поставщику приложения, чтобы настроить домены и URL-адреса;
> * настройка атрибутов пользователя;
> * создание сертификата подписи SAML;
> * назначение вручную пользователей и групп для приложения;
> * настройка приложения для использования Azure AD в качестве поставщика удостоверений SAML;
> * тестирование единого входа на основе SAML.

Чтобы развернуть приложение для других пользователей в вашей организации, рекомендуется использовать автоматическую подготовку пользователей.

> [!div class="nextstepaction"]
>[Управление подготовкой учетных записей пользователей для корпоративных приложений на портале Azure](configure-automatic-user-provisioning-portal.md)


