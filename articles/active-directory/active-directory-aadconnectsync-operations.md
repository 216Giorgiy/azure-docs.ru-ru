---
title: "Синхронизация Azure AD Connect: рабочие задачи и рекомендации | Документация Майкрософт"
description: "В этой статье описываются рабочие задачи служб синхронизации Azure AD Connect и подготовка к работе с этим компонентом."
services: active-directory
documentationcenter: 
author: AndKjell
manager: femila
editor: 
ms.assetid: b29c1790-37a3-470f-ab69-3cee824d220d
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 09/01/2016
ms.author: billmath
translationtype: Human Translation
ms.sourcegitcommit: 219dcbfdca145bedb570eb9ef747ee00cc0342eb
ms.openlocfilehash: 293c84d0be4434a49aa67a66a6b109fcede9df6f


---
# <a name="azure-ad-connect-sync-operational-tasks-and-consideration"></a>Службы синхронизации Azure AD Connect: рабочие задачи и рекомендации
В этой статье описаны рабочие задачи служб синхронизации Azure AD Connect.

## <a name="staging-mode"></a>Промежуточный режим
Промежуточный режим может использоваться в нескольких ситуациях, например:

* обеспечение высокой доступности;
* тестирование и развертывание новых изменений в конфигурации;
* введение в эксплуатацию нового сервера и списание старого.

Когда сервер работает в промежуточном режиме, вы можете вносить изменения в конфигурацию и просматривать их, прежде чем активировать сервер. Этот режим также позволяет запустить полный импорт и полную синхронизацию, чтобы проверить, все ли изменения имеют нужный вид, прежде чем вносить их в рабочую среду.

Во время установки для сервера можно выбрать **промежуточный режим**. В таком случае сервер будет выполнять импорт и синхронизацию, но не будет выполнять операции экспорта. Сервер в промежуточном режиме не выполняет синхронизацию и обратную запись паролей, даже если эти функции активированы при установке. При отключении промежуточного режима сервер начнет выполнять экспорт, а также синхронизацию и обратную запись паролей.

Вы по-прежнему можете выполнить экспорт принудительно с помощью Synchronization Service Manager.

Сервер в промежуточном режиме продолжает получать изменения из Active Directory и Azure AD. На сервере всегда есть копии последних изменений, и он сможет очень быстро принять на себя функции другого сервера. При внесении изменений в конфигурацию сервера-источника обязательно внесите те же изменения в конфигурацию серверов в промежуточном режиме.

Тем, кто знаком с более ранними технологиями синхронизации, следует помнить об отличиях промежуточного режима, поскольку сервер имеет собственную базу данных SQL. Благодаря такой архитектуре сервер в промежуточном режиме может располагаться в другом центре обработки данных.

### <a name="verify-the-configuration-of-a-server"></a>Проверка конфигурации сервера
Чтобы использовать этот метод, выполните следующие действия.

1. [Подготовка](#prepare)
2. [Импорт и синхронизация](#import-and-synchronize)
3. [Проверка](#verify)
4. [Переключение активного сервера](#switch-active-server)

#### <a name="prepare"></a>Подготовка.
1. Установите Azure AD Connect, выберите **промежуточный режим** и снимите флажок **Запустить синхронизацию** на последней странице мастера установки. В этом режиме можно вручную запустить модуль синхронизации.
   ![ReadyToConfigure](./media/active-directory-aadconnectsync-operations/readytoconfigure.png)
2. Выйдите из системы и снова войдите в нее, а затем в меню "Пуск" выберите пункт **Служба синхронизации**.

#### <a name="import-and-synchronize"></a>Импорт и синхронизация
1. Щелкните **Соединители** и выберите первый соединитель типа **Доменные службы Active Directory**. Щелкните **Запуск**, выберите **Полный импорт** и нажмите кнопку **ОК**. Проделайте это для всех соединителей данного типа.
2. Выберите соединитель типа **Azure Active Directory (Майкрософт)**. Щелкните **Запуск**, выберите **Полный импорт** и нажмите кнопку **ОК**.
3. Убедитесь, что все еще выбрана вкладка "Соединители". Для каждого соединителя типа **Доменные службы Active Directory** щелкните **Запуск**, выберите **Синхронизация изменений** и нажмите кнопку **ОК**.
4. Выберите соединитель типа **Azure Active Directory (Майкрософт)**. Щелкните **Запуск**, выберите**Синхронизация изменений**) и нажмите кнопку **ОК**.

Теперь изменения экспорта размещены в Azure AD и локальном каталоге AD (если используется гибридное развертывание Exchange). С помощью описанных далее действий вы сможете проверить предстоящие изменения, прежде чем фактически запустить экспорт в каталоги.

#### <a name="verify"></a>Проверка
1. Откройте командную строку и перейдите в каталог `%ProgramFiles%\Microsoft Azure AD Sync\bin`
2. Выполните команду `csexport "Name of Connector" %temp%\export.xml /f:x`  
   Имя соединителя можно найти в службе синхронизации. Это будет имя наподобие "contoso.com — AAD" для Azure AD.
3. Выполните команду `CSExportAnalyzer %temp%\export.xml > %temp%\export.csv`
4. Теперь в папке %temp% есть файл export.csv, который можно просмотреть в Microsoft Excel. Этот файл содержит все изменения, которые будут экспортированы.
5. Внесите необходимые изменения в данные и конфигурацию и выполните описанные выше действия (импорт, синхронизация и проверка) повторно, чтобы привести изменения, которые предстоит экспортировать, в нужный вид.

**Основные сведения о файле export.csv**

Большая часть файла не нуждается в объяснении. Вот некоторые сокращения, которые помогут понять содержимое.

* OMODT — тип изменения объекта (от англ. Object Modification Type). Указывает, к какому типу относится операция на уровне объекта: Add (добавление), Update (обновление) или Delete (удаление).
* AMODT — тип изменения атрибута (от англ. Attribute Modification Type). Указывает, к какому типу относится операция на уровне атрибута: Add (добавление), Update (обновление) или Delete (удаление).

Если атрибут имеет несколько значений, отображаются не все изменения. Вы сможете увидеть только количество добавленных и удаленных значений.

#### <a name="switch-active-server"></a>Переключение активного сервера
1. Отключите текущий сервер (DirSync, FIM или Azure AD Sync), чтобы он не выполнял экспорт в Azure AD, или переведите его в промежуточный режим (Azure AD Connect).
2. Запустите мастер установки на сервере в **промежуточном режиме** и отключите **промежуточный режим**.
   ![ReadyToConfigure](./media/active-directory-aadconnectsync-operations/additionaltasks.png)

## <a name="disaster-recovery"></a>Аварийное восстановление
Реализация предусматривает возможность планирования действий в случае потери подключения к серверу синхронизации. Вы можете воспользоваться одной из нескольких моделей. Выбор зависит от ответов на следующие вопросы:

* Насколько приемлема для вас ситуация, когда вы не можете вносить изменения в объекты в Azure AD во время простоя?
* Если вы используете синхронизацию паролей, согласятся ли пользователи использовать старые пароли в Azure AD в случае их изменения в локальной среде?
* Зависите ли вы от выполняемых в реальном времени операций, таких как обратная запись паролей?

В зависимости от политики вашей организации и ответов на эти вопросы можно реализовать одну из следующих стратегий:

* Восстановление при необходимости.
* Наличие запасного резервного сервера ( **промежуточный режим**).
* Использование виртуальных машин.

Если встроенная база данных SQL Express не используется, просмотрите раздел [Высокий уровень доступности сервера SQL](#sql-high-availability) .

### <a name="rebuild-when-needed"></a>Восстановление при необходимости
Одна из эффективных стратегий заключается в возможности восстановления сервера при необходимости. Обычно установка модуля синхронизации и выполнение начального импорта и синхронизации занимают несколько часов. Если нет резервного сервера, модуль синхронизации можно временно разместить на контроллере домена.

Сервер модуля синхронизации не сохраняет состояние объектов, поэтому базу данных можно восстановить из данных в Active Directory и Azure AD. Для объединения объектов из локальной среды и облака используется атрибут **sourceAnchor** . Если восстанавливается сервер с имеющимися объектами в локальной среде и в облаке, то при повторной установке модуль синхронизации повторно сопоставляет эти объекты. Изменения в конфигурации сервера, в частности изменения в правилах фильтрации и синхронизации, необходимо задокументировать и сохранить. Эти пользовательские конфигурации необходимо применить повторно перед началом синхронизации.

### <a name="have-a-spare-standby-server---staging-mode"></a>Наличие запасного резервного сервера (промежуточный режим)
В более сложной среде рекомендуется использовать один или несколько резервных серверов. Во время установки один из серверов можно перевести в **промежуточный режим**.

Дополнительные сведения см. в разделе [Промежуточный режим](#staging-mode).

### <a name="use-virtual-machines"></a>Использование виртуальных машин
Также поддерживается распространенный метод, предусматривающий работу модуля синхронизации на виртуальной машине. Если на узле возникнут проблемы, образ сервера с модулем синхронизации можно будет перенести на другой сервер.

### <a name="sql-high-availability"></a>Высокий уровень доступности сервера SQL
Если вы не используете выпуск SQL Server Express, входящий в Azure AD Connect, вам следует также рассмотреть обеспечение высокого уровня доступности для SQL Server. Единственное поддерживаемое решение для обеспечения высокого уровня доступности — кластеризация SQL. Такие решения, как зеркальное отображение и AlwaysOn, не поддерживаются.

## <a name="next-steps"></a>Дальнейшие действия
**Обзорные статьи**  

* [Службы синхронизации Azure AD Connect: общие сведений о синхронизации и ее настройка](active-directory-aadconnectsync-whatis.md)  
* [Интеграция локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md)  




<!--HONumber=Nov16_HO3-->


