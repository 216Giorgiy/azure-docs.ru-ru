
<properties 
	pageTitle="Использование редактора правил синхронизации Azure AD Connect" 
	description="Сведения о том, как использовать редактор правил синхронизации Azure AD Connect." 
	services="active-directory" 
	documentationCenter="" 
	authors="billmath" 
	manager="swadhwa" 
	editor="curtand"/>

<tags 
	ms.service="active-directory" 
	ms.workload="identity" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="05/28/2015" 
	ms.author="billmath"/>

# Редактор правил синхронизации Azure AD Connect


## Использование редактора правил синхронизации

В Azure AD Connect можно настроить и адаптировать поток объектов и атрибутов между Azure AD и локальными каталогами, используя правила синхронизации.

Правило синхронизации является объектом конфигурации с набором атрибутов, передаваемых при удовлетворении условия. Также оно позволяет описать, как объект в пространстве соединителя связан с объектом в метавселенной, известным как соединение или совпадение. Правила синхронизации имеют приоритет, который указывает их отношение друг к другу. Правило синхронизации с меньшим числовым значением приоритета имеет более высокий приоритет, и в случае конфликта потока атрибутов более высокий приоритет выигрывает при разрешении конфликта. Правила синхронизации можно настроить с помощью редактора правил синхронизации.

В качестве примера рассмотрим правило синхронизации «Поступление из AD — учетная запись пользователя включена». Мы пометим эту строку в редакторе правил синхронизации (SRE) и выберем функцию «Изменить». Правило синхронизации имеет четыре раздела конфигурации: описание, фильтр области действия, правила объединения и преобразования.

### Описание
Первый раздел содержит основные сведения, такие как имя и описание.

<center>![Join Rule](./media/active-directory-aadconnect-whats-next-synch-rules-editor/sync1.png) </center>

Также здесь находятся сведения о том, к какой подключенной системе это правило относится, к какому типу объекта в подключенной системе оно применяется, а также о типе объекта метавселенной. Тип объекта метавселенной всегда является лицом, независимо от того, является ли исходный тип объекта пользователем, iNetOrgPerson или контактом. Тип объекта метавселенной никогда не должен изменяться, поэтому он создается как универсальный тип. Тип связи можно задать как Join, StickyJoin или Provision. Эта настройка работает совместно с разделом «Правила соединения», и мы рассмотрим это позднее.

### Фильтр области действия

Раздел «Фильтр области действия» позволяет настроить, когда следует применять правило синхронизации. Поскольку имя правила синхронизации, которое мы рассматриваем, указывает, что оно должно применяться только для включенных пользователей, область действия настраивается так, что в атрибуте AD userAccountControl не должен быть установлен бит 2. При обнаружении пользователя в AD мы будем применять это правило, если для userAccountControl установлено десятичное значение 512 (включен обычный пользователь), но оно не будет применяться, если у найденного пользователя значение userAccountControl установлено равным 514 (отключен обычный пользователь).

<center>![Join Rule](./media/active-directory-aadconnect-whats-next-synch-rules-editor/sync2.png) </center>

Фильтр области действия содержит группы и предложения, которые могут быть вложенными. Для применения правила синхронизации должны удовлетворяться все предложения в группе. При определении нескольких групп для применения правила должна удовлетворяться по крайней мере одна группа. Т. е. между группами вычисляется логическое ИЛИ, а внутри группы — логическое И. Пример этого можно найти в исходящем правиле синхронизации «Отправка в AAD — объединение групп», показанном ниже. Существуют две группы фильтров синхронизации: для групп безопасности (securityEnabled EQUAL True) и для групп распространения (securityEnabled EQUAL False).

<center>![Join Rule](./media/active-directory-aadconnect-whats-next-synch-rules-editor/sync3.png) </center>

Это правило используется для определения групп, которые должны быть подготовлены в AAD. Для синхронизации групп распространения с AAD для них должна быть включена функция почты, но для групп безопасности это не является обязательным. Как можно видеть, также вычисляется множество дополнительных атрибутов.

###Правила объединения
Третий раздел позволяет настроить, как объекты в пространстве соединителя относятся к объектам в метавселенной. Правило, которое мы рассматривали ранее, не содержит настройки правил объединения, поэтому вместо него мы рассмотрим правило «Поступление из AD — объединение пользователей».

<center>![Join Rule](./media/active-directory-aadconnect-whats-next-synch-rules-editor/sync4.png) </center>

Содержимое правил объединения будет зависеть от параметра совпадения, выбранного в мастере установки. Для входящего правила вычисление начинается с объекта в исходном пространстве соединителя, а затем последовательно вычисляется каждая группа в правилах объединения. Если вычисленный исходный объект совпадает в точности с одним объектом в метавселенной при использовании одного из правил объединения, объекты объединяются. Если вычислены все правила и совпадений нет, то используется тип связи на странице описания. Если этот параметр установлен как Provision, создается новый объект в целевом пространстве (метавселенной). Подготовка нового объекта в метавселенной также называется проекцией объекта в метавселенную. Правила объединения вычисляются только один раз. Когда объект пространства соединителя и объект метавселенной объединяются друг с другом, они останутся объединенными, пока область действия правила синхронизации будет продолжать выполняться. При вычислении правил синхронизации в области действия должно находиться только одно правило синхронизации с определенными правилами объединения. Если для одного объекта найдено несколько правил синхронизации с правилами объединения, выдается ошибка. По этой причине рекомендуется определить только одно правило синхронизации с объединением, если в области действия для объекта имеется несколько правил синхронизации. В изначальной конфигурации для Azure AD Connect эти правила можно найти по слову Join в конце имени. Правило синхронизации без определенных правил объединения будет применять потоки атрибутов, если другое правило синхронизации объединило объекты друг с другом или подготовило новый объект в целевом пространстве.

###Преобразования
В разделе преобразований определяются все потоки атрибутов, которые будут применены к целевому объекту после объединения объектов и при удовлетворении фильтра области действия. Вернувшись к нашему правилу синхронизации «Поступление из AD — учетная запись пользователя включена», мы найдем следующие преобразования:

<center>![Join Rule](./media/active-directory-aadconnect-whats-next-synch-rules-editor/sync5.png) </center>

В общем контексте, при развертывании леса Account-Resource мы ожидаем найти включенную учетную запись в лесу учетных записей и отключенную учетную запись в лесу ресурсов с параметрами Exchange и Lync. Рассматриваемое нами правило синхронизации содержит атрибуты, необходимые для входа, и нам требуется передать их из леса, где мы нашли включенную учетную запись. Все эти потоки атрибутов собираются вместе в одном правиле синхронизации. Преобразование может иметь разные типы: Constant, Direct и Expression. Поток-константа (Constant) будет всегда передавать определенное значение, в приведенном выше случае мы всегда устанавливаем значение True в атрибуте метавселенной с именем accountEnabled. Прямой поток (Direct) будет передавать значение атрибута из источника в целевой атрибут. Третий тип потока — выражение (Expression). Он дает возможность создавать более сложные конфигурации. Языком выражений является VBA (Visual Basic for Applications), поэтому пользователь, обладающий опытом работы с Microsoft Office или VBScript, распознает этот формат. Атрибуты заключаются в квадратные скобки: [attributeName]. В именах атрибутов и функций учитывается регистр, но редактор правил синхронизации будет вычислять выражения и выдавать предупреждение, если выражение является недопустимым. Все выражения выражаются в одной строке с вложенными функциями. Для демонстрации возможностей языка конфигурации ниже приведен поток для pwdLastSet, в который вставлены дополнительные комментарии.

		// If-then-else
		IIF(
		// (The evaluation for IIF) Is the attribute pwdLastSet present in AD? 
		IsPresent([pwdLastSet]),
		// (The True part of IIF) If it is, then from right to left, convert the AD time format to a .Net datetime, change it to the time format used by AAD, and finally convert it to a string.
		CStr(FormatDateTime(DateFromNum([pwdLastSet]),"yyyyMMddHHmmss.0Z")),
		// (The False part of IIF) Nothing to contribute
		NULL
		)

Раздел преобразования велик, и он обеспечивает большую часть настраиваемой конфигурации, которая возможна для Azure AD Connect. Настраиваемая конфигурация не рассматривается в этом обзорном документе, но мы рассмотрим некоторые дополнительные потоки атрибутов далее в этом документе.
 

<!---HONumber=July15_HO4-->