---
title: Предварительная версия защиты паролем Azure AD
description: Блокировка ненадежных паролей в локальной версии Active Directory с помощью предварительной версии функции защиты паролем Azure AD
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: conceptual
ms.date: 02/18/2018
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: jsimmons
ms.collection: M365-identity-device-management
ms.openlocfilehash: f1beae186f6eb276b9aa302d3d51f0ba8688e591
ms.sourcegitcommit: 79038221c1d2172c0677e25a1e479e04f470c567
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2019
ms.locfileid: "56415754"
---
# <a name="preview-enforce-azure-ad-password-protection-for-windows-server-active-directory"></a>Предварительный просмотр: применение защиты паролем Azure AD для Windows Server Active Directory

|     |
| --- |
| Защита паролем Azure AD и пользовательский список заблокированных паролей — это функции Azure Active Directory, которые предоставляются в режиме общедоступной предварительной версии. См. дополнительные сведения о [дополнительных условиях использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).|
|     |

Защита паролем Azure AD — это новая функция в общедоступной предварительной версии на платформе Azure Active Directory (Azure AD), позволяющая улучшить политики паролей в организации. Для локального развертывания Azure AD защита паролем использует глобальный и настраиваемый списки заблокированных паролей, которые хранятся в Azure AD, и выполняет одинаковые локальные проверки облачных изменений Azure AD.

## <a name="design-principles"></a>Принципы проектирования

В компоненте "Защита паролей Azure AD" для Active Directory заложены следующие принципы:

* Контроллеры домена никогда не должны взаимодействовать с Интернетом напрямую.
* На контроллерах домена не открываются новые сетевые порты.
* Изменения схемы Active Directory не требуются. Это программное обеспечение использует имеющийся контейнер Active Directory и объекты схемы serviceConnectionPoint.
* Минимальные требования домена Active Directory или функционального уровня леса (DFL\FFL) не установлены.
* Программное обеспечение не создает и не требует предоставления учетных записей в доменах Active Directory, которые оно защищает.
* Открытые пароли пользователя никогда не покидают контроллер домена (во время операций проверки пароля или в любое другое время).
* Добавочное развертывание поддерживается с учетом такого компромисса: политика паролей применяется, только если установлен агент контроллера домена.
* Мы рекомендуем установить агент контроллера домена на всех контроллерах домена, чтобы обеспечить повсеместное применение защиты паролей.

## <a name="architectural-diagram"></a>Схема архитектуры

Очень важно иметь представление о базовой структуре и функциях Защиты паролей Azure AD перед ее развертыванием в локальной среде Active Directory. На следующей схеме показано, как компоненты Защиты паролей Azure AD работают вместе.

![Взаимодействие компонентов защиты паролем Azure AD](./media/concept-password-ban-bad-on-premises/azure-ad-password-protection.png)

На следующей схеме показаны три основных программных компонента Защиты паролей Azure AD.

* Служба прокси-сервера Защиты паролей Azure AD выполняется на любом компьютере, присоединенном к домену, в текущем лесу Active Directory. Основная цель — перенаправление запросов загрузки политики паролей с контроллеров домена в Azure AD и возврат ответа от Azure AD на контроллер домена.
* Библиотека DLL фильтрации паролей агента контроллера домена функции "Защита паролей Azure AD" получает от операционной системы запросы проверки пароля пользователя и перенаправляет их в службу агента контроллера домена Защиты паролей Azure AD, выполняющуюся локально на контроллере домена.
* Служба агента контроллера домена Защиты паролей Azure AD получает запросы на подтверждение пароля из библиотеки DLL фильтрации паролей агента контроллера домена, обрабатывает их с помощью доступной на данный момент политики паролей и возвращает результат (выполнено/сбой).

## <a name="theory-of-operations"></a>Теория операций

Итак, учитывая приведенную выше схему и принципы структуры, как же Защита паролей Azure AD фактически работает?

Каждая служба прокси-сервера Защиты паролей Azure AD объявляет себя контроллером домена в лесу, создав объект serviceConnectionPoint в Active Directory.

Каждая служба агента контроллера домена Защиты паролей Azure AD также создает объект serviceConnectionPoint в Active Directory. Тем не менее он используется главным образом для создания отчетов и диагностики.

Служба агента контроллера домена Защиты паролей Azure AD отвечает за инициирование загрузки новой политики паролей из Azure AD. Первый шаг — найти службу прокси-сервера Защиты паролей Azure AD, отправив в лес запрос на наличие прокси-объектов serviceConnectionPoint. После обнаружения доступной службы прокси-сервера служба агента контроллера домена отправляет запрос на загрузку политики паролей в службу прокси-сервера, которая, в свою очередь, отправляет его в Azure AD, а затем возвращает ответ для службы агента контроллера домена. После получения новой политики паролей из Azure AD служба агента контроллера домена сохраняет политику в соответствующей папке в корне общего ресурса sysvol своего домена. Служба агента контроллера домена также отслеживает эту папку на случай репликации новых политик из других служб агента контроллера в домене.

Служба агента контроллера домена Защиты паролей Azure AD всегда будет запрашивать новую политику при запуске службы. После запуска службы агента контроллера домена она будет периодически (один раз в час) проверять, как давно обновлялась текущая локальная политика. Если текущая политика была создана более часа назад, служба агента контроллера домена запросит новую политику из Azure AD, как описано выше. В противном случае агент контроллера домена будет продолжать использовать текущую политику.

Служба агента контроллера домена Защиты паролей Azure AD взаимодействует со службой прокси-сервера Защиты паролей Azure AD с помощью RPC (удаленного вызова процедур) по протоколу TCP. Служба прокси-сервера ожидает этих вызовов через динамический или статический порт RPC (согласно настройке).

Агент контроллера домена Защиты паролей Azure AD никогда не прослушивает на порте, который доступен в сети, а служба прокси-сервера никогда не пытается вызвать службу агента контроллера домена.

Служба прокси-сервера Защиты паролей Azure AD работает без отслеживания состояния. Она никогда не кэширует политики или любое другое состояние, загруженное из Azure.

Служба агента контроллера домена Защиты паролей Azure AD только оценит пароль пользователя на основе самой последней локальной доступной политики паролей. Если политика паролей доступна на локальном контроллере домена, пароль будет автоматически принят и в журнал событий будет занесено сообщение для предупреждения администратора.

Защита паролей Azure AD не является подсистемой применения политик в режиме реального времени. Между изменением конфигурации политики паролей в Azure AD и ее применением на всех контроллерах домена может возникнуть задержка.

## <a name="foresttenant-binding-for-azure-ad-password-protection"></a>Привязка клиента или леса для Защиты паролей Azure AD

Развертывание Защиты паролей Azure AD в лесу Active Directory требует регистрации леса Active Directory и всех развернутых служб прокси-сервера Защиты паролей Azure AD в Azure AD. Обе такие регистрации (леса и прокси-сервера) связаны с конкретным клиентом Azure AD, который неявно определяется с помощью учетных данных, используемых во время регистрации. Каждый раз, когда загружается политика паролей Защиты паролей Azure AD, она всегда относится к этому клиенту (т. е. политика всегда будет представлять собой сочетание списка глобально заблокированных паролей Майкрософт и списка пользовательских заблокированных паролей для каждого клиента). Настройка разных доменов или прокси-серверов в лесу для привязки к другим клиентам Azure AD не поддерживается.

## <a name="license-requirements"></a>Требования лицензий

Преимущества списка глобально заблокированных паролей применяются ко всем пользователям Azure Active Directory (Azure AD).

Пользовательский список заблокированных паролей требует наличия лицензий Azure AD Basic.

Защита паролей Azure AD для Windows Server Active Directory требует наличия лицензий Azure AD Premium.

Дополнительные сведения о лицензировании, включая расходы, можно найти на [сайте с ценами на Azure Active Directory](https://azure.microsoft.com/pricing/details/active-directory/).

## <a name="download"></a>Download (Скачать)

Два обязательных установщика агента для Защиты паролей Azure AD можно скачать из [Центра загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=57071).

## <a name="next-steps"></a>Дополнительная информация

[Развертывание защиты паролем Azure AD](howto-password-ban-bad-on-premises-deploy.md)
