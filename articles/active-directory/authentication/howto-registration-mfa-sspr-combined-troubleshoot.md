---
title: Устранение неполадок объединенный регистрации в Azure AD SSPR и многофакторной проверки Подлинности (Предварительная версия)
description: Устранение неполадок многофакторную проверку подлинности Azure AD и самостоятельном сбросе пароля объединенный регистрации (Предварительная версия)
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: conceptual
ms.date: 02/20/2019
ms.author: joflore
author: MicrosoftGuyJFlo
manager: daveba
ms.reviewer: sahenry
ms.collection: M365-identity-device-management
ms.openlocfilehash: b247a733c6874b023d3dc8114b0538e422baccfd
ms.sourcegitcommit: 7723b13601429fe8ce101395b7e47831043b970b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/21/2019
ms.locfileid: "56589374"
---
# <a name="troubleshooting-combined-security-information-registration-preview"></a>Устранение неполадок в сочетании регистрации сведения безопасности (Предварительная версия)

Сведения в этой статье помогут администраторам при устранении неполадок на работу объединенный регистрации, о которых сообщает их для конечных пользователей.

|     |
| --- |
| Объединенный безопасности сведения о регистрации для многофакторной идентификации Azure и Azure AD самостоятельного сброса пароля — это функция предварительной версии из Azure Active Directory. См. дополнительные сведения о [дополнительных условиях использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).|
|     |

## <a name="audit-logs"></a>Журналы аудита

События, зарегистрированные для объединенных регистрации находятся в категории «Методы проверки подлинности» в Azure AD журналы аудита.

![Интерфейс, показывающий некоторые безопасности сведения о регистрации событий для нового пользователя в каталоге журналов аудита Azure AD](media/howto-registration-mfa-sspr-combined-troubleshoot/combined-security-info-audit-log.png)

В следующем списке перечислены все события аудита, создаваемые объединенный регистрации:

| Действие | Status | Причина | ОПИСАНИЕ |
| --- | --- | --- | --- |
| Пользователь зарегистрировал все сведения о безопасности | Успешно | Пользователь зарегистрировал все сведения о безопасности. | Это событие происходит после успешного завершения регистрации пользователя.|
| Пользователь зарегистрировал все сведения о безопасности | Сбой | Пользователь отменил регистрацию сведений о безопасности. | Это событие происходит, когда пользователь отменяет регистрацию из режима прерываний.|
| Пользователь зарегистрировал сведения о безопасности | Успешно | Пользователь зарегистрировал «method». | Это событие происходит, когда пользователь регистрируется отдельного метода. «Метод» может быть приложение Authenticator, телефон, адрес электронной почты, вопросы безопасности, пароль приложения, телефонов, и т.д.| 
| Сведения о безопасности пользователя проверен | Успешно | Пользователь успешно проверить сведения о безопасности. | Это событие происходит, когда пользователь щелкает «Выглядит хорошо» на странице «Просмотр сведений о безопасности».|
| Сведения о безопасности пользователя проверен | Сбой | Не удалось просмотреть сведения о безопасности пользователя. | Это событие происходит, когда пользователь щелкает «Все правильно» на сведения о безопасности просмотрите страницу, но что-то происходит сбой в серверной части.|
| Сведения о безопасности пользователь удален | Успешно | Пользователь удалил «method». | Это событие возникает, когда пользователь удаляет отдельного метода. «Метод» может быть приложение Authenticator, телефон, адрес электронной почты, вопросы безопасности, пароль приложения, телефонов, и т.д.|
| Сведения о безопасности пользователь удален | Сбой | Не удалось удалить «method» пользователя. | Это событие происходит, когда пользователь пытается получить метод delete, но он по какой-либо причине происходит сбой. «Метод» может быть приложение Authenticator, телефон, адрес электронной почты, вопросы безопасности, пароль приложения, телефонов, и т.д.|
| Сведения о безопасности по умолчанию для пользователя изменилось | Успешно | Пользователь изменил сведения о безопасности по умолчанию на «метод». | Это событие происходит, когда пользователь изменяет их метод по умолчанию. «Метод» может быть уведомление от приложения структуры проверки подлинности, код из моей приложении authenticator или токене, вызов + X XXXXXXXXXX, текст кода, чтобы + X XXXXXXXXX и т. д.|
| Сведения о безопасности по умолчанию для пользователя изменилось | Сбой | Не удалось изменить сведения о безопасности по умолчанию на «метод» пользователя. | Это событие происходит, когда пользователь пытается изменить метод по умолчанию, но он по какой-либо причине происходит сбой. «Метод» может быть уведомление от приложения структуры проверки подлинности, код в моем приложении authenticator или токене, вызов + X XXXXXXXXXX, текст кода, чтобы + X XXXXXXXXX и т. д.|

## <a name="troubleshooting-interrupt-mode"></a>Устранение неполадок в режиме прерываний

| Симптом | Действия по устранению неполадок |
| --- | --- |
| Я не вижу методы, которые я ожидал. | 1. Проверьте, есть ли у пользователя с ролью администратора Azure AD. Если Да, просмотрите различия политики администратора SSPR. <br> 2. Определите, является ли пользователь прерывания из-за органы регистрации многофакторной проверки Подлинности или принудительной регистрации SSPR. Просмотрите блок-схемы в режимах объединенный регистрации, чтобы определить, какие методы должны отображаться. <br> 3. Определите, каким образом недавно изменена политика MFA или SSPR. В случае последних изменений может занять некоторое время для обновленной политики для распространения.|

## <a name="troubleshooting-manage-mode"></a>Устранение неполадок управления режим

| Симптом | Действия по устранению неполадок |
| --- | --- |
| Отсутствует параметр для добавления определенного метода. | 1. Определяет, включено ли метод для MFA или SSPR. <br> 2. Если метод включена, повторно сохранить политики и подождите 1 – 2 часа перед тестированием еще раз. <br> 3. Если метод включена, убедитесь, что пользователь не уже настроил максимальное количество, метод, который им разрешено для настройки.|

## <a name="disable-combined-registration"></a>Отключить регистрацию объединенный

Когда пользователь регистрирует их номер телефона и/или мобильного приложения в новом сочетании качества, наши службы отметки набор флагов (StrongAuthenticationMethods) для этих методов на этого пользователя. Эта функция позволяет пользователю при необходимости выполнять Многофакторную Идентификацию Azure (MFA) с использованием этих методов.

Для методов, которые пользователи регистрируют в новом интерфейсе, задается свойство StrongAuthenticationMethods. Если администратор включает предварительную версию, пользователи регистрируются с помощью нового интерфейса, а когда администратор отключает ее, пользователи могут также неосознанно быть зарегистрированы и для MFA.

Если пользователь завершил вместе регистрации переходит к странице регистрации текущего пароля reset (SSPR) в [ https://aka.ms/ssprsetup ](https://aka.ms/ssprsetup), ему будет предложено многофакторную идентификацию при доступе к этой странице. Этот шаг является ожидаемым поведением с технической точки зрения, но для пользователей, которые ранее были зарегистрированы только для SSPR, это неожиданно. Хотя этот дополнительный шаг улучшает состояние безопасности пользователя, обеспечивая дополнительный уровень защиты, администраторы могут не использовать его для своих пользователей, чтобы они не выполняли Многофакторную идентификацию.  

### <a name="how-to-roll-back-users"></a>Как откатить пользователей

Если вы, как администратор, хотите сбросить параметры MFA пользователя, мы создали сценарий PowerShell, который очистит свойство StrongAuthenticationMethods с мобильным приложением или номером телефона пользователя. Запуск этого сценария для ваших пользователей означает, что им потребуется повторная регистрация для MFA в случае необходимости. Мы рекомендуем проверять откаты с одним или двумя пользователями перед откатом всех затронутых пользователей.

Следующие шаги помогут вам откатить пользователя или группу пользователей.

#### <a name="prerequisites"></a>Технические условия

1. Вам необходимо будет установить соответствующие модули Azure AD PowerShell. В окне PowerShell выполните следующие команды для установки модулей:

   ```powershell
   Install-Module -Name MSOnline
   Import-Module MSOnline
   ```

1. Сохраните список затронутых идентификаторов объектов пользователей на своем компьютере в виде текстового файла с одним идентификатором в строке. Запишите расположение файла.
1. Сохраните следующий сценарий на компьютере и запишите расположение сценария:

```powershell
<# 
//********************************************************
//*                                                      *
//*   Copyright (C) Microsoft. All rights reserved.      *
//*                                                      *
//********************************************************
#>

param($path)

# Define Remediation Fn
function RemediateUser {

    param  
    (
        $ObjectId
    )

    $user = Get-MsolUser -ObjectId $ObjectId

    Write-Host "Checking if user is eligible for rollback: UPN: "  $user.UserPrincipalName  " ObjectId: "  $user.ObjectId -ForegroundColor Yellow

    $hasMfaRelyingParty = $false
    foreach($p in $user.StrongAuthenticationRequirements)
    {
        if ($p.RelyingParty -eq "*")
        {
            $hasMfaRelyingParty = $true
            Write-Host "User was enabled for per-user MFA." -ForegroundColor Yellow
        }
    }

    if ($user.StrongAuthenticationMethods.Count -gt 0 -and -not $hasMfaRelyingParty)
    {
        Write-Host $user.UserPrincipalName " is eligible for rollback" -ForegroundColor Yellow
        Write-Host "Rolling back user ..." -ForegroundColor Yellow
        Reset-MsolStrongAuthenticationMethodByUpn -UserPrincipalName $user.UserPrincipalName
        Write-Host "Successfully rolled back user " $user.UserPrincipalName -ForegroundColor Green
    }
    else
    {
        Write-Host $user.UserPrincipalName " is not eligible for rollback. No action required."
    }

    Write-Host ""
    Start-Sleep -Milliseconds 750
}

# Connect
Import-Module MSOnline
Connect-MsolService

foreach($line in Get-Content $path)
{
    RemediateUser -ObjectId $line
}
```

#### <a name="rollback"></a>Откат

В окне PowerShell выполните следующую команду после обновления выделенных расположений. При появлении запроса введите учетные данные глобального администратора. Сценарий выведет результат каждой операции обновления пользователя.

`<script location> -path <user file location>`

### <a name="disable-preview-experience"></a>Отключение использования предварительной версии

Чтобы отключить функцию предварительной версии для пользователей, выполните следующие действия:

1. Войдите на портал Azure как глобальный администратор или администратор пользователей.
2. Перейдите в раздел **Azure Active Directory**, **Параметры пользователя**, **Управление параметрами для функций предварительной версии панели доступа**.
3. В разделе **Пользователи могут использовать функции предварительной версии, чтобы регистрировать конфиденциальные сведения и управлять ими** установите для селектора значение **Нет**, а затем нажмите кнопку **Сохранить**.

Пользователи больше не будут получать предложения о регистрации от предварительной версии.

## <a name="next-steps"></a>Дальнейшие действия

[Дополнительные сведения об общедоступной предварительной версии объединенного регистрация для самостоятельного сброса пароля и многофакторной идентификации Azure](concept-registration-mfa-sspr-combined.md)
