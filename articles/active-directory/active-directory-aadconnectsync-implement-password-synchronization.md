<properties
	pageTitle="Реализация синхронизации паролей с помощью службы Azure AD Connect Sync | Microsoft Azure"
	description="В этой статье объясняется, как работает синхронизация паролей и как ее включить."
	services="active-directory"
	documentationCenter=""
	authors="markusvi"
	manager="stevenpo"
	editor=""/>
<tags
	ms.service="active-directory"
	ms.workload="identity"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="get-started-article"
	ms.date="04/15/2016"
	ms.author="markusvi;andkjell"/>


# Реализация синхронизации паролей с помощью службы Azure AD Connect Sync

Благодаря синхронизации паролей локальный пароль Active Directory можно использовать также для входа в Azure Active Directory.

В этой статье приведена информация о том, как включить синхронизацию паролей и устранить возможные неполадки с ней в своей среде.


## Что такое синхронизация паролей

Синхронизация паролей — это функция для синхронизации паролей пользователей локальной службы Active Directory и облачной службы Azure Active Directory (Azure AD). Эта функция позволяет входить в службы Azure Active Directory (например, Office 365, Microsoft Intune и CRM Online) с помощью пароля, который используется для входа в локальную сеть. Чтобы использовать эту функцию, необходимо установить службы синхронизации Azure Active Directory Connect (службы синхронизации Azure AD Connect).


> [AZURE.NOTE] Дополнительную информацию о доменных службах Active Directory, настроенных для использования FIPS и синхронизации паролей, см. в разделе [Синхронизация паролей и FIPS](#password-synchronization-and-fips).

## Как работает синхронизация паролей

Синхронизация паролей — это расширение функции синхронизации каталогов, реализованное при помощи служб синхронизации Azure AD Connect. Для этой функции необходимо настроить синхронизацию служб каталогов между локальной службой AD и Azure Active Directory.

Доменная служба Active Directory хранит пароли в виде хэш-значений, которые представляют фактические пароли пользователей. Хэш пароля нельзя использовать для:

- входа в локальную сеть;

- возврата к паролю в текстовом формате.

Чтобы синхронизировать пароль, Azure AD Connect Sync извлекает хэш пароля из локального каталога Active Directory. Перед синхронизацией в службу проверки подлинности Azure Active Directory хэш пароля дополнительно обрабатывается системой безопасности. Фактический поток данных в процессе синхронизации паролей аналогичен синхронизации данных пользователей, таких как отображаемые имена или адреса электронной почты.

Пароли синхронизируются:

- для каждого пользователя;

- в хронологическом порядке;

- чаще, чем это обычно делается для других атрибутов.

Синхронизированный пароль перезаписывает существующий в облачной службе.

При первом включении функции синхронизации паролей она выполняет первоначальную синхронизацию паролей всех пользователей в области. Нельзя явно определить подмножество паролей пользователей, которые требуется синхронизировать.

При изменении локального пароля новый пароль, как правило, синхронизируется в течение нескольких минут. Если синхронизация паролей пользователей завершается сбоем, автоматически осуществляется новая попытка. Ошибки, возникающие во время синхронизации паролей, записываются в журнал событий.

Синхронизация пароля не влияет на пользователей, находящихся в системе в момент ее выполнения. Если изменение пароля синхронизируется во время вашего пребывания в облачной службе, оно не применяется в сеансе облачной службы немедленно. Однако когда снова возникнет необходимость в проверке подлинности в облачной службе, потребуется указать новый пароль.

> [AZURE.NOTE] Синхронизация паролей поддерживается только для типа объектов user в Active Directory. Она не поддерживается для типа объектов iNetOrgPerson.

### Как синхронизация паролей работает с доменными службами Azure AD

Если вы включили эту службу в Azure AD, параметр синхронизации паролей является обязательным для поддержки функции единого входа. Если эта служба включена, поведение синхронизации паролей изменяется и хэши паролей также синхронизируются без изменений из локальной службы Active Directory в доменные службы Azure AD. Служба работает подобно средству миграции Active Directory (ADMT) и позволяет доменным службам Azure AD проверять подлинность пользователя, применяя все методы, доступные в локальной службе AD.

### Вопросы безопасности

При синхронизации пароли в текстовом формате не передаются в службу синхронизации паролей, Azure AD или какие-либо другие связанные службы.

Кроме того, в локальном каталоге Active Directory пароли могут храниться в зашифрованном виде и не подлежать восстановлению. При передаче данных между локальным каталогом AD и Azure Active Directory используется хэш-код пароля Active Directory. Хэш-код пароля не может использоваться для доступа к ресурсам вашей локальной среды.

### Рекомендации по политикам паролей

Есть два типа политик паролей, которые затрагивает синхронизация паролей:

1. Политика сложности паролей.
2. Политика срока действия паролей.

**Политика сложности паролей**

Когда синхронизация паролей включена, политики сложности паролей, настроенные в локальном каталоге Active Directory, переопределяют политики сложности, настроенные в облаке для синхронизированных пользователей. Это значит, что любой пароль, действительный для локальной среды Active Directory, можно использовать для доступа к службам Azure AD.

> [AZURE.NOTE] Пароли пользователей, созданные непосредственно в облаке, и впредь регулируются политиками паролей, которые настроены в облаке.

**Политика срока действия паролей**

Если пароль пользователя синхронизируется паролей, для пароля облачной учетной записи устанавливается значение *Неограниченный срок действия*. Это означает, что облачных службах можно продолжать использовать синхронизированный пароль, действие которого истекло в локальной среде.

Пароль для облачной учетной записи изменяется, когда вы изменяете пароль в локальной среде.

### Перезапись синхронизированных паролей

Администратор может вручную сбросить пароль с помощью PowerShell.

В таком случае новый пароль перезапишет синхронизированный пароль, и к новому паролю будут применены все политики паролей, настроенные в облаке.

Если вы снова измените локальный пароль, новый пароль синхронизируется в облако и перезапишет пароль, измененный вручную.


## Включение синхронизации паролей

Включить синхронизацию паролей можно двумя способами.

- Если во время установки Azure AD Connect используются стандартные параметры, синхронизация паролей включается по умолчанию.

- Если во время установки Azure AD Connect используются пользовательские параметры, вам нужно включить синхронизацию паролей на странице входа в систему.

<br> ![Включение синхронизации паролей](./media/active-directory-aadconnectsync-implement-password-synchronization/usersignin.png) <br>

Если используется **федерация с AD FS**, можно дополнительно включить синхронизацию паролей для резервного копирования на случай сбоя инфраструктуры AD FS. Ее также можно включить, если вы планируете использовать доменные службы Azure AD.

### Синхронизация паролей и FIPS

Если сервер заблокирован в соответствии с FIPS (федеральный стандарт обработки информации), схема MD5 отключена. Чтобы включить эту схему для синхронизации паролей, добавьте раздел enforceFIPSPolicy в файл miiserver.exe.config, который находится в папке C:\\Program Files\\Azure AD Sync\\Bin.

```
<configuration>
    <runtime>
        <enforceFIPSPolicy enabled="false"/>
    </runtime>
</configuration>
```

Узел конфигурации или среды выполнения указан в конце файла конфигурации.

Дополнительные сведения о безопасности и FIPS см. в записи блога [Синхронизация паролей, шифрование и соответствие FIPS в AAD](http://blogs.technet.com/b/ad/archive/2014/06/28/aad-password-sync-encryption-and-and-fips-compliance.aspx).


## Устранение неполадок синхронизации паролей

**Для устранения неполадок синхронизации паролей выполните следующие действия.**

1. Откройте **Synchronization Service Manager**.

2. Щелкните **Соединители**.

3. Выберите соединитель Active Directory, к которому относится пользователь.

4. Выберите **Пространство соединителя поиска**.

5. Найдите нужного пользователя.

6. Щелкните вкладку **Журнал обращений и преобразований** и убедитесь, что по крайней мере для одного правила синхронизации в столбце **Синхронизация паролей** отображается значение **True**. В конфигурации по умолчанию это будет правило синхронизации с именем **In from AD - User AccountEnabled**.

    ![Сведения о журнале обращений и преобразований пользователя](./media/active-directory-aadconnectsync-implement-password-synchronization/cspasswordsync.png)

7. Кроме того, необходимо [отследить пользователя](active-directory-aadconnectsync-service-manager-ui-connectors.md#follow-an-object-and-its-data-through-the-system) от метавселенной до пространства соединителя Azure AD. К объекту пространства соединителя должно применяться правило исходящего трафика, в котором для параметра **Синхронизация паролей** задано значение **True**. В конфигурации по умолчанию это будет правило синхронизации с именем **Out to AAD - User Join**.

    ![Свойства пространства соединителя пользователя](./media/active-directory-aadconnectsync-implement-password-synchronization/cspasswordsync2.png)

8. Чтобы просмотреть сведения о синхронизации паролей объекта, нажмите кнопку **Журнал**.<br> Отобразится страница с данными состояния синхронизации паролей пользователя за прошлую неделю.

    ![Сведения журнала объекта](./media/active-directory-aadconnectsync-implement-password-synchronization/csobjectlog.png)

В столбце "Состояние" могут содержаться перечисленные ниже значения.

| Состояние | Описание |
| ---- | ----- |
| Успешно | Пароль успешно синхронизирован |
| FilteredByTarget | Для пароля установлено значение **Пользователь должен изменить пароль при следующем входе**. Пароль не синхронизирован. |
| NoTargetConnection | Объект отсутствует в метавселенной или в пространстве соединителя Azure AD. |
| SourceConnectorNotPresent | Объект не найден в локальном пространстве соединителя Active Directory. |
| TargetNotExportedToDirectory | Объект в пространстве соединителя Azure AD еще не экспортирован. |
| MigratedCheckDetailsForMoreInfo | Запись журнала создана до выхода версии 1.0.9125.0 и отображается в исходном состоянии. |


## Запуск полной синхронизации всех паролей

Как правило, нет необходимости выполнять полную синхронизацию всех паролей.<br> Однако если потребуется, ее можно активировать с помощью следующего сценария:

    $adConnector = "<CASE SENSITIVE AD CONNECTOR NAME>"
    $aadConnector = "<CASE SENSITIVE AAD CONNECTOR NAME>"
    Import-Module adsync
    $c = Get-ADSyncConnector -Name $adConnector
    $p = New-Object Microsoft.IdentityManagement.PowerShell.ObjectModel.ConfigurationParameter “Microsoft.Synchronize.ForceFullPasswordSync”, String, ConnectorGlobal, $null, $null, $null
    $p.Value = 1
    $c.GlobalParameters.Remove($p.Name)
    $c.GlobalParameters.Add($p)
    $c = Add-ADSyncConnector -Connector $c
    Set-ADSyncAADPasswordSyncConfiguration -SourceConnector $adConnector -TargetConnector $aadConnector -Enable $false
    Set-ADSyncAADPasswordSyncConfiguration -SourceConnector $adConnector -TargetConnector $aadConnector -Enable $true




## Дальнейшие действия

* [Azure AD Connect Sync: настройка параметров синхронизации](active-directory-aadconnectsync-whatis.md)
* [Интеграция локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md)

<!---HONumber=AcomDC_0420_2016-->