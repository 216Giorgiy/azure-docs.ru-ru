<properties
	pageTitle="Azure AD Connect Sync: реализация синхронизации паролей"
	description="В этой статье приведена информация о том, как работает синхронизация паролей и как ее включить в своей среде."
	services="active-directory"
	documentationCenter=""
	authors="markusvi"
	manager="swadhwa"
	editor=""/>

<tags
	ms.service="active-directory"
	ms.workload="identity"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="07/27/2015"
	ms.author="markusvi"/>


# Azure AD Connect Sync: реализация синхронизации паролей 

Благодаря синхронизации паролей пользователи могут использовать для входа в Azure Active Directory те же пароли, которые они используют для входа в локальный каталог Active Directory.

В этой статье мы расскажем, как работает синхронизация паролей и как ее включить в своей среде.

## Что такое синхронизация паролей

Синхронизация паролей — это функция служб синхронизации Azure Active Directory Connect (далее —AD Connect Sync), которая синхронизирует пароли пользователей из локального каталога Active Directory в Azure Active Directory (Azure AD). Эта функция позволяет вашим пользователям входить в свои службы Azure Active Directory (например, Office 365, Microsoft Intune, CRM Online и т. д.) с помощью пароля, который они используют для входа в локальную сеть. Важно отметить, что эта функция не обеспечивает возможности единого входа, так как в процессе синхронизации паролей не происходит обмен маркерами.

> [AZURE.NOTE]Дополнительную информацию о доменных службах Active Directory, настроенных для использования FIPS и синхронизации паролей, см. в статье «Сбои синхронизации паролей в FIPS-совместимых системах».
 
## Доступность синхронизации паролей

Синхронизация паролей доступна для всех пользователей Azure Active Directory. Ниже приведена информация о совместимости синхронизации паролей с другими функциями, например с федеративной проверкой подлинности.

## Как работает синхронизация паролей

Синхронизация паролей — это расширение функции синхронизации каталогов, реализованное при помощи Azure AD Connect Sync. Как следствие, для этой функции требуется настроенная синхронизация служб каталогов между локальным каталогом и Azure Active Directory.

Доменная служба Active Directory хранит пароли в виде хэш-значений, которые представляют фактические пароли пользователей. Хэш пароля не может использоваться для входа в локальную сеть. Кроме того, его нельзя обратно преобразовать в обычный текстовый пароль пользователя. Чтобы синхронизировать пароль, Azure AD Connect Sync извлекает хэш пароля пользователя из локального каталога Active Directory. Перед синхронизацией в службу проверки подлинности Azure Active Directory хэш пароля дополнительно обрабатывается системой безопасности. Фактический поток данных в процессе синхронизации паролей аналогичен синхронизации данных пользователей, таких как отображаемые имена или адреса электронной почты.

Синхронизация паролей происходит чаще, чем это обычно делается для других атрибутов. Пароли синхронизируются для каждого пользователя отдельно и обычно в хронологическом порядке. Когда пароль пользователя синхронизируется из локального каталога AD в облако, существующий в облаке пароль перезаписывается.

Когда функция синхронизации паролей запускается впервые, она выполняет первоначальную синхронизацию паролей всех пользователей из локального каталога Active Directory в Azure Active Directory. Явным образом указать группу пользователей, чьи пароли будут синхронизированы в облако, нельзя. Затем, когда локальный пользователь изменяет свой пароль, функция синхронизации выявляет и синхронизирует измененный пароль. Как правило, это происходит в течение нескольких минут. Если синхронизация паролей пользователей завершается сбоем, автоматически осуществляется новая попытка. Ошибки, возникающие во время синхронизации паролей, записываются в журнал событий.

Синхронизация пароля не влияет на пользователей, находящихся в системе на момент ее осуществления. Если вошедший в облачную службу пользователь изменит свой локальный пароль, сеанс работы с облачной службой продолжится без перерыва. Но когда облачная служба потребует повторную проверку подлинности пользователя, ему нужно будет ввести уже новый пароль, который незадолго до этого был синхронизирован из локального каталога Active Directory в облако.

## Вопросы безопасности

При синхронизации пароли в текстовом формате не передаются ни в службу синхронизации паролей, ни в Azure AD, ни в какие-либо другие связанные службы.

Кроме того, в локальном каталоге Active Directory пароли могут храниться в зашифрованном виде и не подлежать восстановлению. При передаче данных между локальным каталогом AD и Azure Active Directory используется хэш-код пароля Windows Active Directory. Хэш-код пароля не может использоваться для доступа к ресурсам локальной среды пользователя.

## Рекомендации по политикам паролей

Есть два типа политик паролей, которые затрагивает синхронизация паролей:

1. Политика сложности паролей.
2. Политика срока действия паролей.

### Политика сложности паролей

Когда синхронизация паролей включена, политики сложности паролей, настроенные в локальном каталоге Active Directory, переопределяют политики сложности, настроенные в облаке для синхронизированных пользователей. Это значит, что любой пароль, действительный для локальной среды Active Directory, можно использовать для доступа к службам Azure AD.


> [AZURE.NOTE]Пароли пользователей, созданные непосредственно в облаке, и впредь регулируются политиками паролей, которые настроены в облаке.
 
### Политика срока действия паролей

Если пароль пользователя синхронизируется, для пароля облачной учетной записи устанавливается неограниченный срок действия. Это значит, что в локальной среде срок действия пароля может истечь, но этот пароль по-прежнему будет работать при входе в облачные службы.

Пароль для облачной учетной записи будет изменен, когда пользователь изменит пароль в локальной среде.


## Перезапись синхронизированных паролей

Администратор может вручную сбросить пароль пользователя с помощью Azure Active Directory PowerShell.

В таком случае новый пароль перезапишет синхронизированный пароль, и к новому паролю будут применены все политики паролей, настроенные в облаке.

Если пользователь снова изменит локальный пароль, новый пароль синхронизируется в облако и перезапишет пароль, измененный вручную.


## Подготовка к синхронизации паролей

Чтобы на клиенте Azure Active Directory включить синхронизацию паролей, сначала следует включить на нем синхронизацию каталогов.


## Включение синхронизации паролей

Синхронизация паролей включается в мастере настройки Azure AD Connect.

На странице **Дополнительные возможности** установите флажок \*\*Синхронизация паролей\*\*.
 
![Дополнительные возможности][1]


> [AZURE.NOTE]Это запустит полную синхронизацию. Цикл полной синхронизации обычно длится дольше, чем другие циклы.
 

## Управление синхронизацией паролей

Вы можете отслеживать ход выполнения синхронизации паролей в журнале событий компьютера, на котором запущено средство Azure AD Connect.


### Состояние синхронизации паролей

Чтобы определить, пароли каких пользователей успешно синхронизированы, просмотрите события, которые соответствуют следующим критериям.

| Источник| Идентификатор события |
| --- | --- |
| Синхронизация службы каталогов| 656|
| Синхронизация службы каталогов| 657|
 
События с идентификатором 656 содержат сведения об обработанных запросах на изменение пароля.

![Идентификатор события 656][2]

Соответствующие события с идентификатором 657 содержат результаты этих запросов.

![Идентификатор события 657][3]

В этих событиях задействованные объекты идентифицируются по значениям привязки и DN. Значение привязки соответствует значению **ImmutableId**, которое возвращает для пользователя командлет Get-MsoUser.

Помимо идентификаторов объектов, **события с идентификатором 656** содержат сведения о дате изменения пароля в локальном каталоге Active Directory.

![Запрос на изменение пароля][4]

Помимо идентификатора исходного объекта, у события с идентификатором 657 есть поле Result (Результат), в котором указывается состояние синхронизации для конкретного объекта пользователя.

Событие с идентификатором 657 и значением Success для атрибута Result свидетельствует об успешной синхронизации пароля. Если пароль не удалось синхронизировать, атрибут Result имеет значение Failure.

![Результат изменения пароля][5]

 
## Отключение синхронизации паролей

Чтобы отключить синхронизацию паролей, нужно повторно запустить мастер настройки Azure AD Connect. При появлении запроса в мастере снимите флажок «Синхронизация паролей».


> [AZURE.NOTE]Это запустит полную синхронизацию. Цикл полной синхронизации обычно длится дольше, чем другие циклы.
 
После завершения работы мастера ваш клиент больше не будет синхронизировать пароли. Новые пароли не будут синхронизироваться в облако. Пользователи, чьи пароли были синхронизированы ранее, смогут и дальше входить с этими паролями, пока не изменят пароли в облаке вручную.



## Дополнительные ресурсы

* [Azure AD Connect Sync: настройка параметров синхронизации](active-directory-aadconnectsync-whatis.md)
* [Интеграция локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md)
 
<!--Image references-->
[1]: ./media/active-directory-aadsync-implement-password-synchronization/IC759788.png
[2]: ./media/active-directory-aadsync-implement-password-synchronization/IC662504.png
[3]: ./media/active-directory-aadsync-implement-password-synchronization/IC662505.png
[4]: ./media/active-directory-aadsync-implement-password-synchronization/IC662506.png
[5]: ./media/active-directory-aadsync-implement-password-synchronization/IC662507.png

<!---HONumber=July15_HO5-->