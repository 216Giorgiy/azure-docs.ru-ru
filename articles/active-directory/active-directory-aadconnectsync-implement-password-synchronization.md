<properties
	pageTitle="Реализация синхронизации паролей с помощью службы Azure AD Connect Sync | Microsoft Azure"
	description="В этой статье объясняется, как работает синхронизация паролей и как ее включить."
	services="active-directory"
	documentationCenter=""
	authors="markusvi"
	manager="stevenpo"
	editor=""/>
<tags
	ms.service="active-directory"
	ms.workload="identity"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="get-started-article"
	ms.date="03/22/2016"
	ms.author="markusvi;andkjell"/>


# Реализация синхронизации паролей с помощью службы Azure AD Connect Sync

Благодаря синхронизации паролей пользователи могут использовать для входа в Azure Active Directory те же пароли, которые они используют для входа в локальный каталог Active Directory.

В этой статье мы расскажем, как работает синхронизация паролей, как ее включить и как устранить неполадки в своей среде.

## Что такое синхронизация паролей

Синхронизация паролей — это функция служб синхронизации Azure Active Directory Connect (Azure AD Connect), которая синхронизирует пароли пользователей из локального каталога Active Directory в Azure Active Directory (Azure AD). Эта функция позволяет вашим пользователям входить в свои службы Azure Active Directory (например, Office 365, Microsoft Intune и CRM Online) с помощью пароля, который они используют для входа в локальную сеть.

> [AZURE.NOTE] Дополнительную информацию о доменных службах Active Directory, настроенных для использования FIPS и синхронизации паролей, см. в разделе [Синхронизация паролей и FIPS](#password-synchronization-and-fips).

### Доступность синхронизации паролей

Синхронизация паролей доступна для всех пользователей Azure Active Directory. Ниже приведена информация о совместимости синхронизации паролей с другими функциями, например с федеративной проверкой подлинности.

## Как работает синхронизация паролей

Синхронизация паролей — это расширение функции синхронизации каталогов, реализованное при помощи служб синхронизации Azure AD Connect. Как следствие, для этой функции требуется настроенная синхронизация служб каталогов между локальным каталогом и Azure Active Directory.

Доменная служба Active Directory хранит пароли в виде хэш-значений, которые представляют фактические пароли пользователей. Хэш пароля не может использоваться для входа в локальную сеть. Кроме того, его нельзя обратно преобразовать в обычный текстовый пароль пользователя. Чтобы синхронизировать пароль, службы синхронизации Azure AD Connect извлекают хэш пароля пользователя из локального каталога Active Directory. Перед синхронизацией в службу проверки подлинности Azure Active Directory хэш пароля дополнительно обрабатывается системой безопасности. Фактический поток данных в процессе синхронизации паролей аналогичен синхронизации данных пользователей, таких как отображаемые имена или адреса электронной почты.

Синхронизация паролей происходит чаще, чем это обычно делается для других атрибутов. Пароли синхронизируются для каждого пользователя отдельно и обычно в хронологическом порядке. Когда пароль пользователя синхронизируется из локального каталога AD в облако, существующий в облаке пароль перезаписывается.

Когда функция синхронизации паролей запускается впервые, она выполняет первоначальную синхронизацию паролей всех пользователей из локального каталога Active Directory в Azure Active Directory. Явным образом указать группу пользователей, чьи пароли будут синхронизированы в облако, нельзя. Затем, когда локальный пользователь изменяет свой пароль, функция синхронизации выявляет и синхронизирует измененный пароль. Как правило, это происходит в течение нескольких минут. Если синхронизация паролей пользователей завершается сбоем, автоматически осуществляется новая попытка. Ошибки, возникающие во время синхронизации паролей, записываются в журнал событий.

Синхронизация пароля не влияет на пользователей, находящихся в системе на момент ее осуществления. Если вошедший в облачную службу пользователь изменит свой локальный пароль, сеанс работы с облачной службой продолжится без перерыва. Но когда облачная служба потребует повторную проверку подлинности пользователя, ему нужно будет ввести уже новый пароль, который незадолго до этого был синхронизирован из локального каталога Active Directory в облако.

> [AZURE.NOTE] Синхронизация паролей поддерживается только для типа объектов user в Active Directory. Она не поддерживается для типа объектов iNetOrgPerson.

### Как синхронизация паролей работает с доменными службами Azure AD

Если вы включили эту службу в Azure AD, параметр синхронизации паролей является обязательным для поддержки функции единого входа. Если эта служба включена, поведение синхронизации паролей изменяется и хэши паролей также синхронизируются без изменений из локальной службы Active Directory в доменные службы Azure AD. Служба работает подобно ADMT (Active Directory Migration Tool) и позволяет доменным службам Azure AD проверять подлинность пользователя, применяя все методы, доступные в локальной службе AD.

### Вопросы безопасности

При синхронизации пароли в текстовом формате не передаются ни в службу синхронизации паролей, ни в Azure AD, ни в какие-либо другие связанные службы.

Кроме того, в локальном каталоге Active Directory пароли могут храниться в зашифрованном виде и не подлежать восстановлению. При передаче данных между локальным каталогом AD и Azure Active Directory используется хэш-код пароля Active Directory. Хэш-код пароля не может использоваться для доступа к ресурсам локальной среды пользователя.

### Рекомендации по политикам паролей

Есть два типа политик паролей, которые затрагивает синхронизация паролей:

1. Политика сложности паролей.
2. Политика срока действия паролей.

**Политика сложности паролей**

Когда синхронизация паролей включена, политики сложности паролей, настроенные в локальном каталоге Active Directory, переопределяют политики сложности, настроенные в облаке для синхронизированных пользователей. Это значит, что любой пароль, действительный для локальной среды Active Directory, можно использовать для доступа к службам Azure AD.

> [AZURE.NOTE] Пароли пользователей, созданные непосредственно в облаке, и впредь регулируются политиками паролей, которые настроены в облаке.

**Политика срока действия паролей**

Если пароль пользователя синхронизируется, для пароля облачной учетной записи устанавливается *Неограниченный срок действия*. Это значит, что в локальной среде срок действия пароля может истечь, однако пользователи по-прежнему смогут продолжить работу с облачными службами с помощью нового пароля после цикла синхронизации паролей.

Пароль для облачной учетной записи будет изменен, когда пользователь изменит пароль в локальной среде.

### Перезапись синхронизированных паролей

Администратор может вручную сбросить пароль пользователя с помощью Azure Active Directory PowerShell.

В таком случае новый пароль перезапишет синхронизированный пароль, и к новому паролю будут применены все политики паролей, настроенные в облаке.

Если пользователь снова изменит локальный пароль, новый пароль синхронизируется в облако и перезапишет пароль, измененный вручную.


## Включение синхронизации паролей

Включить синхронизацию паролей можно двумя способами.

- Если во время установки Azure AD Connect используются стандартные параметры, синхронизация паролей будет включена по умолчанию.

- Если во время установки Azure AD Connect используются пользовательские параметры, вам нужно включить синхронизацию паролей на странице входа в систему.

<br> ![Включение синхронизации паролей](./media/active-directory-aadconnectsync-implement-password-synchronization/usersignin.png) <br>

Если используется **федерация с AD FS**, можно дополнительно включить синхронизацию паролей для резервного копирования на случай сбоя инфраструктуры AD FS. Ее также можно включить, если вы планируете использовать доменные службы Azure AD.

### Синхронизация паролей и FIPS

Если сервер заблокирован в соответствии с FIPS (федеральный стандарт обработки информации), схема MD5 отключена. Чтобы включить эту схему для синхронизации паролей, добавьте раздел enforceFIPSPolicy в файл miiserver.exe.config, который находится в папке C:\\Program Files\\Azure AD Sync\\Bin.

```
<configuration>
    <runtime>
        <enforceFIPSPolicy enabled="false"/>
    </runtime>
</configuration>
```

Узел конфигурации или среды выполнения указан в конце файла конфигурации.

Дополнительные сведения о безопасности и FIPS см. в записи блога [Синхронизация паролей, шифрование и соответствие FIPS в AAD](http://blogs.technet.com/b/ad/archive/2014/06/28/aad-password-sync-encryption-and-and-fips-compliance.aspx).


## Устранение неполадок синхронизации паролей

**Для устранения неполадок синхронизации паролей выполните следующие действия.**

1. Откройте **Synchronization Service Manager**.

2. Щелкните **Соединители**.

3. Выберите соединитель Active Directory, к которому относится пользователь.

4. Выберите **Пространство соединителя поиска**.

5. Найдите нужного пользователя.

6. Щелкните вкладку **Журнал обращений и преобразований** и убедитесь, что по крайней мере для одного правила синхронизации в столбце **Синхронизация паролей** отображается значение **True**. В конфигурации по умолчанию это будет правило синхронизации с именем **In from AD - User AccountEnabled**.

    ![Сведения о журнале обращений и преобразований пользователя](./media/active-directory-aadconnectsync-implement-password-synchronization/cspasswordsync.png)

7. Вы должны [отследить пользователя](active-directory-aadconnectsync-service-manager-ui-connectors.md#follow-an-object-and-its-data-through-the-system) от метавселенной до пространства соединителя Azure AD и убедиться, что существует правило для исходящего трафика, в котором для параметра **Синхронизация паролей** задано значение **True**. В конфигурации по умолчанию это будет правило синхронизации с именем **Out to AAD - User Join**.

    ![Свойства пространства соединителя пользователя](./media/active-directory-aadconnectsync-implement-password-synchronization/cspasswordsync2.png)

8. Чтобы просмотреть сведения о синхронизации паролей объекта, нажмите кнопку **Журнал**.<br> Отобразится страница с данными состояния синхронизации паролей пользователя за прошлую неделю.

    ![Сведения журнала объекта](./media/active-directory-aadconnectsync-implement-password-synchronization/csobjectlog.png)

Столбец состояния может иметь следующие значения, означающие проблемы и причины сбоя синхронизации паролей.

| Состояние | Описание |
| ---- | ----- |
| Успешно | Пароль успешно синхронизирован |
| FilteredByTarget | Для пароля установлено значение **Пользователь должен изменить пароль при следующем входе**. Пароль не синхронизирован. |
| NoTargetConnection | Объект отсутствует в метавселенной или в пространстве соединителя Azure AD. |
| SourceConnectorNotPresent | Объект не найден в локальном пространстве соединителя Active Directory. |
| TargetNotExportedToDirectory | Объект в пространстве соединителя Azure AD еще не экспортирован. |
| MigratedCheckDetailsForMoreInfo | Запись журнала создана до выхода версии 1.0.9125.0 и отображается в исходном состоянии. |


## Запуск полной синхронизации всех паролей

Во многих случаях не обязательно выполнять полную синхронизацию всех паролей.<br> Однако если это необходимо, можно использовать следующий скрипт:

    $adConnector = "<CASE SENSITIVE AD CONNECTOR NAME>"
    $aadConnector = "<CASE SENSITIVE AAD CONNECTOR NAME>"
    Import-Module adsync
    $c = Get-ADSyncConnector -Name $adConnector
    $p = New-Object Microsoft.IdentityManagement.PowerShell.ObjectModel.ConfigurationParameter “Microsoft.Synchronize.ForceFullPasswordSync”, String, ConnectorGlobal, $null, $null, $null
    $p.Value = 1
    $c.GlobalParameters.Remove($p.Name)
    $c.GlobalParameters.Add($p)
    $c = Add-ADSyncConnector -Connector $c
    Set-ADSyncAADPasswordSyncConfiguration -SourceConnector $adConnector -TargetConnector $aadConnector -Enable $false
    Set-ADSyncAADPasswordSyncConfiguration -SourceConnector $adConnector -TargetConnector $aadConnector -Enable $true




## Дальнейшие действия

* [Azure AD Connect Sync: настройка параметров синхронизации](active-directory-aadconnectsync-whatis.md)
* [Интеграция локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md)

<!---HONumber=AcomDC_0330_2016-->