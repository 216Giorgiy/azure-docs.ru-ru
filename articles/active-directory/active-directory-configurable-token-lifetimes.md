---
title: "Настройка времени жизни маркеров в Azure Active Directory | Документация Майкрософт"
description: "С помощью этой функции администраторы и разработчики могут указывать время жизни маркеров, выдаваемых Azure AD."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: 
ms.assetid: 06f5b317-053e-44c3-aaaa-cf07d8692735
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/06/2016
ms.author: billmath
translationtype: Human Translation
ms.sourcegitcommit: 219dcbfdca145bedb570eb9ef747ee00cc0342eb
ms.openlocfilehash: f61d23fec6badb8dd53379d183b177e4c19e5711


---
# <a name="configurable-token-lifetimes-in-azure-active-directory-public-preview"></a>Настройка времени жизни маркеров в Azure Active Directory (общедоступная предварительная версия)
> [!NOTE]
> Эта функция сейчас предоставляется в режиме общедоступной предварительной версии.  Вы должны быть готовы отменить или удалить все изменения.  Доступ к общедоступной предварительной версии мы предоставляем всем желающим, но для использования некоторых возможностей после выхода общедоступной версии вам может потребоваться [подписка на Azure AD "Премиум"](active-directory-get-started-premium.md).
> 
> 

## <a name="introduction"></a>Введение
С помощью этой функции администраторы и разработчики могут указывать время жизни маркеров, выдаваемых Azure AD. Время жизни маркеров можно настроить для всех приложений в клиенте, для многопользовательского приложения или для определенного субъекта-службы в клиенте.

В Azure AD объект политики представлен набором правил, которые применяются к отдельным приложениям или ко всем приложениям в клиенте.  Каждый тип политики имеет уникальную структуру и набор свойств, которые применяются к объектам, для которых назначена эта политика.

Для клиента можно назначить политику по умолчанию. Тогда она будет влиять на любое приложение, существующее в этом клиенте, если только не переопределена политикой с более высоким приоритетом. Политики можно назначать и для отдельных приложений. Приоритетность политики определяется ее типом.

Политики времени жизни маркера можно настроить для маркеров обновления, маркеров доступа, маркеров сеансов и маркеров идентификации.

### <a name="access-tokens"></a>Маркеры доступа
Маркер доступа используется клиентским приложением для доступа к защищенному ресурсу. Маркер доступа можно использовать только для конкретного сочетания пользователя, клиентского приложения и ресурса. Маркеры доступа не могут быть отозваны. Они действуют до истечения срока своего действия. Вредоносный субъект, получивший маркер доступа, сможет использовать его на протяжении всего времени жизни.  Настройка времени жизни маркера доступа — это компромисс между производительностью системы и временем, в течение которого клиентское приложение сохраняет доступ после отключения учетной записи пользователя.  Чтобы повысить производительность системы, нужно минимизировать частоту обращений клиентского приложения за обновленным маркером доступа. 

### <a name="refresh-tokens"></a>Маркеры обновления
Когда клиентское приложение обращается за маркером доступа для доступа к защищенному ресурсу, оно получает и маркер обновления, и маркер доступа. Маркер обновления используется для получения новой пары маркеров доступа и обновления, когда истечет срок действия маркера доступа. Маркеры обновления привязаны одновременно и к пользователю, и клиентскому приложению. Они могут быть отозваны, и при каждом использовании проверяется их действительность.

Важно различать конфиденциальные и общедоступные клиентские приложения. Конфиденциальные — это такие клиентские приложения, которые могут безопасно хранить клиентский пароль, с помощью которого можно подтвердить, что запросы поступают от клиентского приложения, а не от вредоносного субъекта. Так как такие последовательности достаточно безопасные, для них по умолчанию устанавливается более продолжительное время жизни маркеров, и этот срок нельзя изменить с помощью политик.

Из-за ограничений среды выполнения, в которых запущены приложения, общедоступные клиентские приложения не могут безопасно хранить пароль клиента. Для ресурсов можно определить политики, которые запрещают маркерам обновления из общедоступных клиентских приложений, которые старше указанного периода, получать новую пару маркеров доступа и обновления (максимальное время неактивности для маркеров обновления).  Кроме того, с помощью политик можно определить период времени, по истечении которого маркеры обновления больше не принимаются (максимальный возраст маркеров обновления).  Настроив время жизни маркера обновления, вы можете управлять частотой, с которой пользователь должен повторно вводить учетные данные при использовании общедоступного клиентского приложения.

### <a name="id-tokens"></a>Маркеры идентификации
Маркеры идентификации передаются веб-сайтам и собственным клиентам. Они содержат данные профиля пользователя. Маркер идентификации привязан одновременно и к пользователю, и клиентскому приложению. Маркеры идентификации считаются действительными до истечения срока действия.  Как правило, в веб-приложениях длительность пользовательского сеанса согласовывается со временем жизни маркера идентификации, выданного этому пользователю.  Изменяя время жизни маркера идентификации, вы можете управлять частотой завершения пользовательского сеанса в веб-приложении. А также — частотой, с которой пользователю нужно выполнять проверку подлинности в Azure AD (в автоматическом или интерактивном режиме).

### <a name="single-sign-on-session-token"></a>Маркер сеанса единого входа
Если пользователь при проверке подлинности в Azure AD установит флажок "Оставаться в системе", для пользовательского браузер и Azure AD создается сеанс единого входа.  Этот сеанс представлен маркером сеанса единого входа — в виде файла cookie. Важно отметить, что маркер сеанса единого входа не привязан к определенному ресурсу или клиентскому приложению. Маркеры сеанса единого входа могут быть отозваны, а при каждом использовании проверяется их действительность.

Есть два вида маркеров сеанса единого входа. Постоянные маркеры сеанса — хранятся в постоянных файлах cookie, и временные маркеры сеанса — хранятся в виде файлов cookie сеанса (они удаляются при закрытии браузера).

Срок действия временных маркеров сеанса составляет 24 часа, а постоянных маркеров — 180 дней. Каждый раз, когда используется действующий маркер сеанса единого входа, срок его действия продлевается еще на 24 часа или 180 дней соответственно. Если маркер сеанса единого входа не используется в течение срока его действия, он считается истекшим и не будет приниматься. 

С помощью политик можно задать период, следующий за выдачей первого маркера сеанса, по прошествии которого такой маркер не будет приниматься (максимальный возраст маркера сеанса).  Настройка времени жизни действия маркера сеанса позволяет управлять частотой, с которой пользователь должен повторно вводить учетные данные при использовании веб-приложения.

### <a name="token-lifetime-policy-properties"></a>Свойства политики времени жизни маркера
Политика времени жизни маркера — это объект политики, который содержит правила времени жизни маркера.  Свойства этой политики и определяют срок действия соответствующих маркеров.  Если политика не задана, система использует стандартное значение для времени жизни.

### <a name="configurable-token-lifetime-properties"></a>Свойства для настройки времени жизни маркера
| Свойство | Строка свойства политики | Область применения | значение по умолчанию | Минимальная | Максимальная |
| --- | --- | --- | --- | --- | --- |
| Время жизни маркера доступа |AccessTokenLifetime |Маркеры доступа, маркеры безопасности, маркеры SAML2 |1 час |10 минут |1 день |
| Максимальное время неактивности для маркеров обновления |MaxInactiveTime |Маркеры обновления |14 дней |10 минут |90 дней |
| Максимальный возраст однофакторного маркера обновления |MaxAgeSingleFactor |Маркеры обновления (для всех пользователей) |90 дней |10 минут |Пока не будет отозван* |
| Максимальный возраст многофакторного маркера обновления |MaxAgeMultiFactor |Маркеры обновления (для всех пользователей) |90 дней |10 минут |Пока не будет отозван* |
| Максимальный возраст однофакторного маркера сеанса |MaxAgeSessionSingleFactor** |Маркеры сеанса (постоянные и временные) |Пока не будет отозван |10 минут |Пока не будет отозван* |
| Максимальный возраст многофакторного маркера сеанса |MaxAgeSessionMultiFactor*** |Маркеры сеанса (постоянные и временные) |Пока не будет отозван |10 минут |Пока не будет отозван* |

* *Максимальная длительность, которую можно явно задать для этих атрибутов, — 365 дней.
* **Если не задано значение для MaxAgeSessionSingleFactor, этот параметр принимает значение MaxAgeSingleFactor. Если оба параметра не заданы, свойство принимает значение по умолчанию (Until-revoked).
* ***Если не задано значение для MaxAgeSessionMultiFactor, этот параметр принимает значение MaxAgeMultiFactor. Если оба параметра не заданы, свойство принимает значение по умолчанию (Until-revoked).

### <a name="exceptions"></a>Исключения
| Свойство | Область применения | значение по умолчанию |
| --- | --- | --- |
| Максимальное время неактивности для маркера обновления (федеративные пользователи с недостаточной информацией об отзыве) |Маркеры обновления (выданные для федеративных пользователей с недостаточной информацией об отзыве) |12 часов |
| Максимальное время неактивности для маркера обновления (конфиденциальные клиенты) |Маркеры обновления (выданные для конфиденциальных клиентов) |90 дней |
| Максимальный возраст маркеров обновления (выданных для конфиденциальных клиентов) |Маркеры обновления (выданные для конфиденциальных клиентов) |Пока не будет отозван |

### <a name="priority-and-evaluation-of-policies"></a>Приоритетность и оценка политик
Политики времени жизни можно создать и назначить для отдельных приложений, клиентов и субъектов-служб. Это означает, что к определенному приложению может применяться сразу несколько политик. Политики определяют время жизни маркеров в соответствии со следующими правилами:

* если политика явно назначена субъекту-службе, применяется именно она; 
* если нет политики, явно назначенной субъекту-службе, применяется политика, явно назначенная родительскому клиенту субъекта-службы; 
* если нет политики, явно назначенной субъекту-службе или клиенту, применяется политика, назначенная приложению; 
* если нет политики, явно назначенной субъекту-службе, клиенту или объекту приложения, применяются значения по умолчанию (см. таблицу выше).

Дополнительные сведения о связях между объектами приложения и объектами субъекта-службы см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](active-directory-application-objects.md).

Срок действия маркера оценивается при его использовании. Используется политика с самым высоким приоритетом, установленная для оцениваемого приложения.

> [!NOTE]
> Пример
> 
> Пользователь хочет получить доступ к двум веб-приложениям, условно именуемым А и Б. 
> 
> * Оба приложения находятся в одном родительском клиенте. 
> * Для родительского клиента в качестве политики по умолчанию установлена политика времени жизни маркеров 1, в соответствии с которой максимальный возраст маркера сеанса составляет 8 часов.
> * Веб-приложение A — это обычное веб-приложение без настроенных политик. 
> * Веб-приложение Б используется для процессов с высоким уровнем конфиденциальности, и его субъект-служба связана с политикой времени жизни действия маркеров 2, в которой максимальный возраст маркера сеанса составляет 30 минут.
> 
> В 12:00 пользователь открывает новый сеанс браузера и пытается получить доступ к веб-приложению A. Он перенаправляется в Azure AD, где отображается запрос на вход. При этом в браузере удаляется файл cookie с маркером сеанса. После этого пользователь перенаправляется в веб-приложение A с маркером идентификатора, который предоставляет права доступа к приложению.
> 
> В 12:15 этот же пользователь пытается получить доступ к веб-приложению Б. Браузер перенаправляется на платформу Azure AD, которая находит файл cookie сеанса. Субъект-служба веб-приложения Б связана с политикой 2, но также входит в родительский клиент, для которого по умолчанию используется политика 1. Здесь применяется политика 2, так как политики для субъекта-службы имеют более высокий приоритет, чем политики по умолчанию для клиента. Исходный маркер сеанса был выпущен в течение последних 30 минут, поэтому считается допустимым. Пользователь перенаправляется в веб-приложение Б с маркером идентификатора, предоставляющим права доступа.
> 
> В 13:00 пользователь пытается перейти к веб-приложению A и перенаправляется в Azure AD. Веб-приложение A не имеет связанных политик, но входит в клиент, для которого в качестве политики по умолчанию установлена политика 1, поэтому применяется именно эта политика. Система обнаруживает файл cookie сеанса, выпущенный в пределах последних 8 часов. Пользователь автоматически и без проверки подлинности перенаправляется обратно в веб-приложение A с новым маркером идентификатора.
> 
> Теперь пользователь сразу переходит к веб-приложению Б и снова перенаправляется в Azure AD. Как и в прошлый раз, применяется политика 2. Так как маркер был выдан раньше, чем 30 минут назад, пользователю предлагается повторно ввести учетные данные, чтобы получить новые маркер сеанса и маркер идентификатора. Пользователь получает доступ к веб-приложению Б.
> 
> 

## <a name="configurable-policy-properties-in-depth"></a>Настройка свойств политики: подробные сведения
### <a name="access-token-lifetime"></a>Время жизни маркера доступа
**Строка:** AccessTokenLifetime

**Область применения:** маркеры доступа, маркеры безопасности

**Описание:** эта политика определяет, как долго продолжают действовать маркеры доступа и маркеры идентификации для определенного ресурса. Минимизация времени жизни маркера доступа снижает риск использования маркера доступа или маркера идентификатора вредоносным субъектом в течение длительного времени (как мы помним, эти маркеры не могут быть отозваны), но отрицательно влияет на производительность системы, вынуждая чаще заменять маркеры.

### <a name="refresh-token-max-inactive-time"></a>Максимальное время неактивности для маркеров обновления
**Строка:** MaxInactiveTime

**Область применения:** маркеры обновления

**Описание:** эта политика определяет, насколько старым должен быть маркер обновления, чтобы клиент больше не мог использовать его для получения новой пары маркеров доступа и обновления при попытке доступа к определенному ресурсу. При использовании маркера обновления обычно возвращается новый маркер обновления. Следовательно, политика запретит доступ после того, как клиент в течение указанного времени не будет обращаться к каким-либо ресурсам с полученным маркером обновления. 

Эта политика вынуждает пользователей, не выполнявших активных действий в клиентских приложениях, повторно проходить проверку подлинности для получения нового маркера обновления. 

Важно отметить, что максимальное время неактивности маркера обновления должно быть меньше, чем максимальный возраст однофакторного маркера или многофакторного маркера обновления.

### <a name="single-factor-refresh-token-max-age"></a>Максимальный возраст однофакторного маркера обновления
**Строка:** MaxAgeSingleFactor

**Область применения:** маркеры обновления

**Описание:** эта политика определяет, как долго пользователь может применять маркеры обновления для получения новых пар маркеров доступа и обновления после последней успешной проверки подлинности с использованием однофакторных методов. Когда пользователь выполнит проверку подлинности и получит новый маркер обновления, он сможет и дальше использовать последовательность маркеров обновления в течение указанного периода (если текущий маркер обновления не будет отозван или не будет превышено максимальное время неактивности). После этого пользователь должен повторно выполнить проверку подлинности, чтобы получить новый маркер обновления. 

Сокращение максимального возраста вынуждает пользователей чаще выполнять проверку подлинности. Поскольку однофакторная идентификация подлинности считается менее безопасной, чем многофакторная, мы рекомендуем для этой политики указывать значение не больше, чем максимальный возраст многофакторного маркера обновления.

### <a name="multi-factor-refresh-token-max-age"></a>Максимальный возраст многофакторного маркера обновления
**Строка:** MaxAgeMultiFactor

**Область применения:** маркеры обновления

**Описание:** эта политика определяет, как долго пользователь может применять маркеры обновления для получения новых пар маркеров доступа и обновления после последней успешной проверки подлинности с использованием многофакторных методов. Когда пользователь выполнит проверку подлинности и получит новый маркер обновления, он сможет и дальше использовать последовательность маркеров обновления в течение указанного периода (если текущий маркер обновления не будет отозван или не будет превышено максимальное время неактивности). После этого пользователь должен повторно выполнить проверку подлинности, чтобы получить новый маркер обновления. 

Сокращение максимального возраста вынуждает пользователей чаще выполнять проверку подлинности. Так как однофакторная проверка подлинности считается менее безопасной, чем многофакторная, мы рекомендуем для этой политики указывать значение не меньше, чем максимальный возраст однофакторного маркера обновления.

### <a name="single-factor-session-token-max-age"></a>Максимальный возраст однофакторного маркера сеанса
**Строка:** MaxAgeSessionSingleFactor

**Область применения:** маркеры сеанса (постоянные и временные)

**Описание:** эта политика определяет, как долго пользователь может применять маркеры сеанса для получения новых маркеров сеанса и идентификатора после последней успешной проверки подлинности с использованием однофакторных методов. Когда пользователь выполнит проверку подлинности и получит новый маркер сеанса, он сможет и дальше использовать последовательность маркеров сеанса в течение указанного периода времени (если текущий маркер сеанса не будет отозван или не истечет его срок действия). После этого пользователь должен повторно выполнить проверку подлинности, чтобы получить новый маркер сеанса. 

Сокращение максимального возраста вынуждает пользователей чаще выполнять проверку подлинности. Так как однофакторная проверка подлинности считается менее безопасной, чем многофакторная, мы рекомендуем для этой политики указывать значение не больше, чем максимальный возраст многофакторного маркера сеанса.

### <a name="multi-factor-session-token-max-age"></a>Максимальный возраст многофакторного маркера сеанса
**Строка:** MaxAgeSessionMultiFactor

**Область применения:** маркеры сеанса (постоянные и временные)

**Описание:** эта политика определяет, как долго пользователь может применять маркеры сеанса для получения новых маркеров сеанса и идентификатора после последней успешной проверки подлинности с использованием многофакторных методов. Когда пользователь выполнит проверку подлинности и получит новый маркер сеанса, он сможет и дальше использовать последовательность маркеров сеанса в течение указанного периода времени (если текущий маркер сеанса не будет отозван или не истечет его срок действия). После этого пользователь должен повторно выполнить проверку подлинности, чтобы получить новый маркер сеанса. 

Сокращение максимального возраста вынуждает пользователей чаще выполнять проверку подлинности. Так как однофакторная проверка подлинности считается менее безопасной, чем многофакторная, мы рекомендуем для этой политики указывать значение не меньше, чем максимальный возраст однофакторного маркера сеанса.

## <a name="sample-token-lifetime-policies"></a>Пример использования политик срока действия маркеров
Указывая и изменяя время жизни маркеров для приложений, субъектов-служб и клиента в целом, вы сможете реализовать в Azure AD много новых сценариев.  Сейчас мы рассмотрим несколько распространенных вариантов использования политик, которые помогут вам правильно применять новые правила для следующих параметров.

* Сроки действия маркеров
* Максимальное время неактивности для маркеров
* Максимальный возраст маркеров

Мы рассмотрим несколько сценариев, включая:

* управление политикой клиента по умолчанию;
* создание политики для входа в веб-службы;
* создание политики для собственных приложений, вызывающих веб-API;
* управление расширенной политикой. 

### <a name="prerequisites"></a>Предварительные требования
В примерах сценариев мы будем создавать, обновлять, связывать и удалять политики для приложений, субъектов-служб и клиента в целом.  Если вы еще не работали с Azure AD, прежде чем продолжать, изучите [эту статью](active-directory-howto-tenant.md).  

1. Чтобы начать, скачайте последнюю [предварительную версию командлетов Azure AD PowerShell](https://www.powershellgallery.com/packages/AzureADPreview). 
2. Получив командлеты Azure AD PowerShell, выполните команду Connect для входа в учетную запись администратора Azure AD. Это действие нужно выполнять при каждом запуске сеанса.
   
     Connect-AzureAD -Confirm
3. Выполните следующую команду для просмотра всех политик, которые созданы в клиенте.  Эту команду следует использовать после большинства операций в наших примерах.  Также она позволит получить **идентификатор объекта** нужной политики. 
   
     Get-AzureADPolicy

### <a name="sample-managing-a-tenants-default-policy"></a>Пример: управление политикой клиента по умолчанию
В этом примере мы создадим для всего клиента политику, которая позволяет пользователям реже вводить учетные данные. 

Для этого мы создадим политику времени жизни для однофакторных маркеров обновления и применим ее к клиенту. Эта политика будет распространяться на все приложения в клиенте и на все субъекты-службы, для которых не установлены отдельные политики. 

1. **Создание политики времени жизни маркеров** 

Если для параметра срока действия однофакторного маркера обновления установить значение until-revoked, маркер будет действовать неограниченно долго — пока не будет отозван.  Мы создадим политику со следующим определением:

        @("{
          `"TokenLifetimePolicy`":
              {
                 `"Version`":1, 
                 `"MaxAgeSingleFactor`":`"until-revoked`"
              }
        }")

Выполните следующую команду, чтобы создать эту политику: 

    New-AzureADPolicy -Definition @("{`"TokenLifetimePolicy`":{`"Version`":1, `"MaxAgeSingleFactor`":`"until-revoked`"}}") -DisplayName TenantDefaultPolicyScenario -IsTenantDefault $true -Type TokenLifetimePolicy

Чтобы просмотреть созданную политику и получить для нее идентификатор объекта (ObjectID), выполните следующую команду:

    Get-AzureADPolicy
&nbsp;&nbsp;2.    **Обновление политики**

Предположим, вы решили, что созданная политика для службы не соответствует строгим требованиям, и хотите, чтобы однофакторные маркеры обновления истекали через 2 дня. Выполните следующую команду: 

    Set-AzureADPolicy -ObjectId <ObjectID FROM GET COMMAND> -DisplayName TenantDefaultPolicyUpdatedScenario -Definition @("{`"TokenLifetimePolicy`":{`"Version`":1,`"MaxAgeSingleFactor`":`"2.00:00:00`"}}")

&nbsp;&nbsp;3. **Готово!** 

### <a name="sample-creating-a-policy-for-web-sign-in"></a>Пример: создание политики для входа в веб-службы
В этом примере мы создадим политику, в соответствии с которой пользователи должны будут чаще выполнять проверку подлинности в веб-приложении. Эта политика определит время жизни для маркеров доступа и идентификатора, а также максимальный возраст многофакторного маркера сеанса для субъекта-службы веб-приложения.

1. **Создание политики времени жизни маркеров**

Эта политика для входа в веб-службы определит время жизни для маркеров доступа и идентификатора, а также максимальный возраст многофакторного маркера сеанса (2 часа).

    New-AzureADPolicy -Definition @("{`"TokenLifetimePolicy`":{`"Version`":1,`"AccessTokenLifetime`":`"02:00:00`",`"MaxAgeSessionSingleFactor`":`"02:00:00`"}}") -DisplayName WebPolicyScenario -IsTenantDefault $false -Type TokenLifetimePolicy

Чтобы просмотреть созданную политику и получить для нее идентификатор объекта (ObjectID), выполните следующую команду:

    Get-AzureADPolicy
&nbsp;&nbsp;2.    **Назначение политики для субъекта-службы.**

Теперь мы сопоставим новую политику с субъектом-службой.  Вам потребуется также получить доступ к идентификатору **ObjectId** субъекта-службы. Для этого можно запросить [Microsoft Graph](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) или открыть средство [Graph Explorer](https://graphexplorer.cloudapp.net/) и войти в учетную запись Azure AD, чтобы просмотреть список всех субъектов-служб в своем клиенте. 

Получив идентификатор **ObjectId**, выполните следующую команду:

    Add-AzureADServicePrincipalPolicy -ObjectId <ObjectID of the Service Principal> -RefObjectId <ObjectId of the Policy>
&nbsp;&nbsp;3.    **Готово!** 

 

### <a name="sample-creating-a-policy-for-native-apps-calling-a-web-api"></a>Пример: создание политики для собственных приложений, вызывающих веб-API
> [!NOTE]
> Связывание политик с приложениями сейчас отключено.  Такая возможность будет вскоре предоставлена.  Эта страница будет обновлена, как только функция станет доступной.
> 
> 

В этом примере мы создадим политику, которая требует реже выполнять проверку подлинности, а также увеличивает длительность периода, в течение которого пользователи могут оставаться неактивными без необходимости повторной проверки подлинности. Политика будет применяться к веб-API каждый раз, когда собственные приложения обращаются к этому интерфейсу как к ресурсу.

1. **Создание политики времени жизни маркеров** 

Эта команда создает строгую политику для веб-API. 

    New-AzureADPolicy -Definition @("{`"TokenLifetimePolicy`":{`"Version`":1,`"MaxInactiveTime`":`"30.00:00:00`",`"MaxAgeMultiFactor`":`"until-revoked`",`"MaxAgeSingleFactor`":`"180.00:00:00`"}}") -DisplayName WebApiDefaultPolicyScenario -IsTenantDefault $false -Type TokenLifetimePolicy

Чтобы просмотреть созданную политику и получить для нее идентификатор объекта (ObjectID), выполните следующую команду:

    Get-AzureADPolicy

&nbsp;&nbsp;2.    **Назначение политики для веб-API**

Теперь мы сопоставим новую политику с приложением.  Вам потребуется также получить доступ к идентификатору **ObjectId** приложения. Получить **ObjectId** для приложения проще всего на [портале Azure](https://portal.azure.com/). 

Получив идентификатор **ObjectId**, выполните следующую команду:

    Add-AzureADApplicationPolicy -ObjectId <ObjectID of the App> -RefObjectId <ObjectId of the Policy>

&nbsp;&nbsp;3.    **Готово!** 

### <a name="sample-managing-an-advanced-policy"></a>Пример: управление расширенной политикой
В этом примере мы создадим несколько политик для демонстрации системы приоритетов, а также представим методы управления несколькими политиками, примененными к нескольким объектам. Это даст вам некоторое представление о приоритетности политик (см. выше) и позволит реализовывать более сложные сценарии. 

1. **Создание политики времени жизни маркеров**

Пока все было достаточно просто. Мы создали политику по умолчанию для клиента, которая определяет для однофакторного маркера обновления время жизни в 30 дней. 

    New-AzureADPolicy -Definition @("{`"TokenLifetimePolicy`":{`"Version`":1,`"MaxAgeSingleFactor`":`"30.00:00:00`"}}") -DisplayName ComplexPolicyScenario -IsTenantDefault $true -Type TokenLifetimePolicy
Чтобы просмотреть созданную политику и получить ее идентификатор объекта (ObjectID), выполните следующую команду:

    Get-AzureADPolicy

&nbsp;&nbsp;2.    **Назначение политики для субъекта-службы**

Теперь у нас есть политика, примененная ко всему клиенту.  Предположим, что мы хотим сохранить эту политику со сроком действия 30 дней для определенного субъекта-службы, но изменить максимальное ограничение стандартной политики для клиента, указав значение until-revoked (пока не будет отозван). 

Прежде всего, давайте сопоставим новую политику с субъектом-службой.  Вам потребуется также получить доступ к идентификатору **ObjectId** субъекта-службы. Для этого можно запросить [Microsoft Graph](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) или открыть средство [Graph Explorer](https://graphexplorer.cloudapp.net/) и войти в учетную запись Azure AD, чтобы просмотреть список всех субъектов-служб в своем клиенте. 

Получив идентификатор **ObjectId**, выполните следующую команду:

    Add-AzureADServicePrincipalPolicy -ObjectId <ObjectID of the Service Principal> -RefObjectId <ObjectId of the Policy>

&nbsp;&nbsp;3.    **Установите значение false для флага IsTenantDefault, используя следующую команду**. 

    Set-AzureADPolicy -ObjectId <ObjectId of Policy> -DisplayName ComplexPolicyScenario -IsTenantDefault $false
&nbsp;&nbsp;4.    **Создание новой политики по умолчанию для клиента**

    New-AzureADPolicy -Definition @("{`"TokenLifetimePolicy`":{`"Version`":1,`"MaxAgeSingleFactor`":`"until-revoked`"}}") -DisplayName ComplexPolicyScenarioTwo -IsTenantDefault $true -Type TokenLifetimePolicy

&nbsp;&nbsp;5.     **Готово!** 

Теперь ваша исходная политика связана с субъектом-службой, а клиенту в качестве политики по умолчанию назначена новая политика.  Важно помнить, что политики, примененные к субъектам-службам, имеют более высокий приоритет, чем политики по умолчанию для клиента. 

## <a name="cmdlet-reference"></a>Справочник по командлетам
### <a name="manage-policies"></a>Управление политиками
Управлять политиками можно с помощью следующих командлетов.</br></br>

#### <a name="new-azureadpolicy"></a>New-AzureADPolicy
Создает новую политику.

    New-AzureADPolicy -Definition <Array of Rules> -DisplayName <Name of Policy> -IsTenantDefault <boolean> -Type <Policy Type> 

| Параметры | Описание | Пример |
| --- | --- | --- |
| -Definition |Переведенный в строку массив JSON, который содержит все правила политики. |-Definition @("{`"TokenLifetimePolicy`":{`"Version`":1,`"MaxInactiveTime`":`"20:00:00`"}}") |
| -DisplayName |Строка c именем политики. |-DisplayName MyTokenPolicy |
| -IsTenantDefault |Если присвоено значение true, политика устанавливается политикой по умолчанию для клиента; если присвоено значение false — параметр игнорируется. |-IsTenantDefault $true |
| -Type |Тип политики. Для политик времени жизни маркеров всегда используйте значение TokenLifetimePolicy. |-Type TokenLifetimePolicy |
| -AlternativeIdentifier [необязательно] |Задает альтернативный идентификатор политики. |-AlternativeIdentifier myAltId |

</br></br>

#### <a name="get-azureadpolicy"></a>Get-AzureADPolicy
Возвращает полный список политик Azure AD или одну указанную политику. 

    Get-AzureADPolicy 

| Параметры | Описание | Пример |
| --- | --- | --- |
| -ObjectId [необязательно] |Идентификатор политики, который нужно получить. |-ObjectId &lt;значение ObjectID для политики&gt; |

</br></br>

#### <a name="get-azureadpolicyappliedobject"></a>Get-AzureADPolicyAppliedObject
Возвращает список приложений и субъектов-служб, связанных с политикой.

    Get-AzureADPolicyAppliedObject -ObjectId <object id of policy> 

| Параметры | Описание | Пример |
| --- | --- | --- |
| -ObjectId |Идентификатор политики, который нужно получить. |-ObjectId &lt;значение ObjectID для политики&gt; |

</br></br>

#### <a name="set-azureadpolicy"></a>Set-AzureADPolicy
Обновляет существующую политику.

    Set-AzureADPolicy -ObjectId <object id of policy> -DisplayName <string> 

| Параметры | Описание | Пример |
| --- | --- | --- |
| -ObjectId |Идентификатор политики, который нужно получить. |-ObjectId &lt;значение ObjectID для политики&gt; |
| -DisplayName |Строка c именем политики. |-DisplayName MyTokenPolicy |
| -Definition [необязательно] |Переведенный в строку массив JSON, который содержит все правила политики. |-Definition @("{`"TokenLifetimePolicy`":{`"Version`":1,`"MaxInactiveTime`":`"20:00:00`"}}") |
| -IsTenantDefault [необязательно] |Если присвоено значение true, политика устанавливается политикой по умолчанию для клиента; если присвоено значение false — параметр игнорируется. |-IsTenantDefault $true |
| -Type [необязательно] |Тип политики. Для политик времени жизни маркеров всегда используйте значение TokenLifetimePolicy. |-Type TokenLifetimePolicy |
| -AlternativeIdentifier [необязательно] |Задает альтернативный идентификатор политики. |-AlternativeIdentifier myAltId |

</br></br>

#### <a name="remove-azureadpolicy"></a>Remove-AzureADPolicy
Удаляет указанную политику.

     Remove-AzureADPolicy -ObjectId <object id of policy>

| Параметры | Описание | Пример |
| --- | --- | --- |
| -ObjectId |Идентификатор политики, который нужно получить. |-ObjectId &lt;значение ObjectID для политики&gt; |

</br></br>

### <a name="application-policies"></a>Политики приложений
Управлять политиками приложений можно с помощью следующих командлетов.</br></br>

#### <a name="add-azureadapplicationpolicy"></a>Add-AzureADApplicationPolicy
Связывает указанную политику с приложением.

    Add-AzureADApplicationPolicy -ObjectId <object id of application> -RefObjectId <object id of policy>

| Параметры | Описание | Пример |
| --- | --- | --- |
| -ObjectId |Идентификатор объекта (ObjectID) приложения. |-ObjectId &lt;значение ObjectID для приложения&gt; |
| -RefObjectId |Идентификатор объекта (ObjectID) политики. |-RefObjectId &lt;значение ObjectID для политики&gt; |

</br></br>

#### <a name="get-azureadapplicationpolicy"></a>Get-AzureADApplicationPolicy
Возвращает политику, назначенную для приложения.

    Get-AzureADApplicationPolicy -ObjectId <object id of application>

| Параметры | Описание | Пример |
| --- | --- | --- |
| -ObjectId |Идентификатор объекта (ObjectID) приложения. |-ObjectId &lt;значение ObjectID для приложения&gt; |

</br></br>

#### <a name="remove-azureadapplicationpolicy"></a>Remove-AzureADApplicationPolicy
Удаляет политику из приложения.

    Remove-AzureADApplicationPolicy -ObjectId <object id of application> -PolicyId <object id of policy>

| Параметры | Описание | Пример |
| --- | --- | --- |
| -ObjectId |Идентификатор объекта (ObjectID) приложения. |-ObjectId &lt;значение ObjectID для приложения&gt; |
| -PolicyId |Идентификатор объекта (ObjectID) политики. |-PolicyId &lt;значение ObjectID для политики&gt; |

</br></br>

### <a name="service-principal-policies"></a>Политики субъекта-службы
Управлять политиками субъектов-служб можно с помощью следующих командлетов.</br></br>

#### <a name="add-azureadserviceprincipalpolicy"></a>Add-AzureADServicePrincipalPolicy
Связывает указанную политику с субъектом-службой.

    Add-AzureADServicePrincipalPolicy -ObjectId <object id of service principal> -RefObjectId <object id of policy>

| Параметры | Описание | Пример |
| --- | --- | --- |
| -ObjectId |Идентификатор объекта (ObjectID) приложения. |-ObjectId &lt;значение ObjectID для приложения&gt; |
| -RefObjectId |Идентификатор объекта (ObjectID) политики. |-RefObjectId &lt;значение ObjectID для политики&gt; |

</br></br>

#### <a name="get-azureadserviceprincipalpolicy"></a>Get-AzureADServicePrincipalPolicy
Возвращает все политики, связанные с указанной субъектом-службой.

    Get-AzureADServicePrincipalPolicy -ObjectId <object id of service principal>

| Параметры | Описание | Пример |
| --- | --- | --- |
| -ObjectId |Идентификатор объекта (ObjectID) приложения. |-ObjectId &lt;значение ObjectID для приложения&gt; |

</br></br>

#### <a name="remove-azureadserviceprincipalpolicy"></a>Remove-AzureADServicePrincipalPolicy
Удаляет политику из указанной субъекта-службы.

    Remove-AzureADServicePrincipalPolicy -ObjectId <object id of service principal>  -PolicyId <object id of policy>

| Параметры | Описание | Пример |
| --- | --- | --- |
| -ObjectId |Идентификатор объекта (ObjectID) приложения. |-ObjectId &lt;значение ObjectID для приложения&gt; |
| -PolicyId |Идентификатор объекта (ObjectID) политики. |-PolicyId &lt;значение ObjectID для политики&gt; |




<!--HONumber=Nov16_HO3-->


