---
title: "Настройка автоматического ускорения входа для приложения с помощью политики обнаружения домашней области | Документация Майкрософт"
description: "В этом разделе объясняется, что такое клиент Azure AD и как управлять Azure с помощью Azure Active Directory."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
ms.service: active-directory
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: it-pro
ms.date: 11/09/2017
ms.author: billmath
ms.openlocfilehash: b1f0e5da09ef1d6acd234b72878cc71d66bb551e
ms.sourcegitcommit: 659cc0ace5d3b996e7e8608cfa4991dcac3ea129
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2017
---
# <a name="configure-sign-in-auto-acceleration-for-an-application-using-home-realm-discovery-hrd-policy"></a>Настройка автоматического ускорения входа для приложения с помощью политики обнаружения домашней области (HRD)

## <a name="introduction-to-home-realm-discovery-and-auto-acceleration"></a>Обзор обнаружения домашней области и автоматического ускорения
В этой статье приведен обзор обнаружения домашней области и автоматического ускорения.

### <a name="home-realm-discovery"></a>Обнаружение домашней области
Обнаружение домашней области представляет собой процесс, позволяющий Azure Active Directory во время входа определять области, в которых пользователь должен пройти проверку подлинности.  При входе в клиент Azure AD для доступа к ресурсу или на общую страницу входа Azure AD пользователь вводит имя пользователя (UPN).  Azure AD использует его для обнаружения областей, где пользователь должен выполнить вход.   Чтобы пройти аутентификацию, пользователь может быть перенаправлен в:

- Домашний клиент пользователя (может использоваться тот же, которому принадлежит ресурс, к которому пользователь пытается получить доступ). 
- Учетную запись Майкрософт.   В клиенте ресурса пользователь является гостем.
- Другой поставщик удостоверений, включенный в федерацию с клиентом Azure AD.  Локальный поставщик удостоверений, например AD FS.

### <a name="auto-acceleration"></a>Автоматическое ускорение 
Для аутентификации пользователя некоторые организации настраивают свой клиент Azure Active Directory для объединения с другим поставщиком удостоверений, например AD FS.  В этих случаях при входе в приложение пользователь сначала увидит страницу входа Azure AD, а после введения имени участника-пользователя отобразится страница входа поставщика удостоверений.  В случаях, когда это имеет смысл, администраторы могут сразу перенаправить пользователей на страницу входа при входе в отдельные приложения без отображения начальной страницы Azure Active Directory. Этот процесс называется автоматическим ускорением входа.

В случаях федерации клиента с другим поставщиком удостоверений для входа включение автоматического ускорения упрощает вход пользователя, когда с помощью этого поставщика удостоверений может пройти аутентификацию любой пользователь, выполняющий вход.  Автоматическое ускорение входа можно настроить для отдельных приложений.

>[!NOTE]
>При настройке приложения для автоматического ускорения гостевые пользователи не могут выполнить вход. Когда пользователь будет перенаправлен непосредственно к федеративному поставщику удостоверений для проверки подлинности, он больше не сможет вернуться на страницу входа Azure Active Directory.  Гостевые пользователи, которых для аутентификации необходимо направить в другие клиенты или внешние поставщики удостоверений, например учетную запись Майкрософт, не смогут выполнить вход в это приложение, так как шаг обнаружения домашней области пропускается.  

Есть два способа управления автоматическим ускорением входа в федеративный поставщик удостоверений.  Одно из двух:   

- Использовать указание домена в запросах аутентификации для приложения. 
- Настроить политику обнаружения домашней области для включения автоматического ускорения входа.

## <a name="domain-hints"></a>Указания домена 
Указания домена представляют собой директивы, включенные в запрос на аутентификацию из приложения.  Их можно использовать для ускорения входа пользователя на страницу входа федеративного поставщика удостоверений, или они могут использоваться мультитенантным приложением, чтобы ускорить для клиента вход пользователя непосредственно на страницу входа Azure AD с фирменной символикой.  Например, приложение largeapp.com дает возможность клиентам получить доступ к приложению с помощью пользовательского URL-адреса contoso.largeapp.com и может включать указание домена Contoso.com в запросе аутентификации. Синтаксис для указания домена может меняться в зависимости от используемого протокола и обычно настраивается в приложении.

**WS-Federation**:  whr=contoso.com в строке запроса.

**SAML**: либо запрос на аутентификацию SAML, содержащий указание домена, либо строка запроса whr=contoso.com.

**Open ID Connect**: строка запроса domain_hint=contoso.com. 

Если указание домена включено в запрос на проверку подлинности из приложения, а клиент входит в федерацию с этим доменом, Azure AD предпринимает попытку перенаправить вход на страницу поставщика удостоверений, настроенного для этого домена.  Если указание домена не ссылается на проверенный федеративный домен, оно игнорируется и активируется стандартное обнаружение домашней области.

Дополнительные сведения об автоматическом ускорении входа с помощью указаний домена, поддерживаемых Azure Active Directory, см. в этой [записи блога](https://cloudblogs.microsoft.com/enterprisemobility/2015/02/11/using-azure-ad-to-land-users-on-their-custom-login-page-from-within-your-app/).

>[!NOTE]
>Если указание домена включено в запрос на проверку подлинности, его наличие переопределяет любую политику обнаружения домашней области, настроенную для приложения.

## <a name="home-realm-discovery-hrd-policy"></a>Политика обнаружения домашней области (HRD)
Некоторые приложения не предоставляют возможность настройки запроса на проверку подлинности, который они генерируют, и в таких случаях невозможно использовать указания домена для управления автоматическим ускорением.   Автоматическое ускорение можно настроить с помощью политики, чтобы добиться нужного поведения.  

### <a name="setting-hrd-policy"></a>Настройка политики обнаружения домашней области
Настройка автоматического ускорения входа включает три шага.


1. Создание политики обнаружения домашней области для автоматического ускорения.
2. Поиск субъекта-службы, к которому будет применена политика.
3. Применение политики к субъекту-службы.  Политики, созданные в клиенте, не работают, пока они не присоединены к сущности.  Политику обнаружения домашней области можно применить к субъекту-службе, и только одна такая политика может быть активна в заданной сущности в одно время.  

Чтобы настроить автоматическое ускорение входа с помощью политики HRD, вы можете использовать непосредственно API Graph Microsoft Azure Active Directory или командлеты PowerShell для Azure Active Directory.

API Graph, управляющий политикой, описывается [здесь](https://msdn.microsoft.com/library/azure/ad/graph/api/policy-operations).

Ниже приведен пример определения политики обнаружения домашней области:
    
 ```
   {  
    "HomeRealmDiscoveryPolicy":
    {  
    "AccelerateToFederatedDomain":true,
    "PreferredDomain":"federated.example.edu"
    }
   }
```

Тип политики — "HomeRealmDiscoveryPolicy".

Если **AccelerateToFederatedDomain** имеет значение false, влияние политики будет отсутствовать. Параметр **PreferredDomain** должен указывать домен, к которому нужно ускорить вход, и его можно не использовать, если у клиента есть только один федеративный домен.  Если его не использовать, но при этом имеется более одного проверенного федеративного домена, политика не будет применена.

Если **PreferredDomain** содержит значение, он должен соответствовать проверенному федеративному домену для клиента, и у всех пользователей запрашиваемого приложения должна быть возможность входа в этот домен.

### <a name="priority-and-evaluation-of-hrd-policies"></a>Приоритетность и оценка политик HRD
Вы можете создать политики HRD, а затем назначить их отдельным организациям и субъектам-службам. Это означает, что к определенному приложению может применяться сразу несколько политик. Политика HRD оказывает влияние согласно следующим правилам:


- Если указание домена присутствует в запросе проверки подлинности, тогда любая политика обнаружения домашней области игнорируется и используется поведение, заданное указанием домена.
- В противном случае, если политика явно назначена субъекту-службе, применяется именно она. 
- Если отсутствует указание домена и нет политики, явно назначенной субъекту-службе, применяется политика, явно назначенная родительской организации субъекта-службы. 
- Если отсутствует указание домена и нет политики, назначенной субъекту-службе или организации, используется стандартное поведение HRD.

## <a name="tutorial-for-setting-sign-in-auto-acceleration-on-an-application-using-hrd-policy-with-azure-active-directory-powershell-cmdlets"></a>Руководство по настройке автоматического ускорения входа в приложение с помощью политики HRD и командлетов PowerShell для Azure Active Directory
Мы рассмотрим несколько сценариев, включая:


- настройку автоматического ускорения входа приложения для клиента с одним федеративным доменом;
- настройку автоматического ускорения входа приложения в один из нескольких доменов, проверенных для клиента;
- получение списка приложений, для которых настроена политика.

### <a name="prerequisites"></a>Предварительные требования
В примерах ниже создаются, обновляются, связываются и удаляются политики для субъектов-служб приложения в Azure AD.

1.  Чтобы начать, загрузите последнюю предварительную версию командлетов Azure AD PowerShell. 
2.  Получив командлеты, выполните команду Connect для входа в Azure AD с помощью учетной записи администратора.

    ``` powershell
    Connect-AzureAD -Confirm
    ```
3.  Выполните следующую команду для просмотра всех политик в организации.

    ``` powershell
    Get-AzureADPolicy
    ```

Если результат не возвращается, в клиенте нет созданных политик.

### <a name="example-setting-auto-acceleration-for-an-application"></a>Пример: настройка автоматического ускорения входа для приложения 
В этом примере создается политика автоматического ускорения входа пользователей на странице входа AD FS при входе в приложение.  Это происходит без необходимости ввода имени пользователя на странице входа Azure AD. 

#### <a name="step-1-create-an-hrd-policy"></a>Шаг 1. Создание политики обнаружения домашней области
``` powershell
New-AzureADPoly -Definition @("{`"HomeRealmDiscoveryPolicy`":{`"AccelerateToFederatedDomain`":true}}") -DisplayName BasicAutoAccelerationPolicy -Type HomeRealmDiscoveryPolicy
```

При наличии одного федеративного домена, выполняющего проверку подлинности пользователей для приложений, вам необходимо создать только одну политику HRD.  
Чтобы просмотреть созданную политику и получить для нее идентификатор объекта (ObjectID), выполните следующую команду:

``` powershell
Get-AzureADPolicy
```


Чтобы включить автоматическое ускорение входа после настройки политики обнаружения домашней области, ее можно назначить нескольким субъектам-службам приложения.

#### <a name="step-2-locate-the-service-principal-to-assign-the-policy-to"></a>Шаг 2. Поиск субъект-службы для назначения политики  
Чтобы назначить политику субъектам-службам, вам необходим их ObjectId. Есть несколько способов найти идентификатор объекта субъектов-служб.    

Можно использовать портал, выполнить запрос [Microsoft Graph](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) или перейти к [средству обозревателя Graph](https://graphexplorer.cloudapp.net/) и войти в учетную запись Azure AD для просмотра всех субъектов-служб организации. Если вы используете PowerShell, можно использовать командлет get-AzureADServicePrincipal, чтобы получить список субъектов-служб и их идентификаторы.

#### <a name="step-3-assign-the-policy-to-your-service-principal"></a>Шаг 3. Назначение политики для субъекта-службы  
После получения идентификатора объекта субъекта-службы приложения, для которого нужно настроить автоматическое ускорение входа, выполните команду ниже, чтобы связать политику HRD, созданную на шаге 1, с субъектом-службой, найденным на шаге 2.

``` powershell
Add-AzureADServicePrincipalPolicy -Id <ObjectID of the Service Principal> -RefObjectId <ObjectId of the Policy>
```

Эту команду можно повторить для каждого субъекта-службы, для которого необходимо добавить политику.

#### <a name="step-4-check-which-application-service-principals-your-auto-acceleration-policy-is-assigned-to"></a>Шаг 4. Проверка субъектов-служб приложения, которым назначена политика автоматического ускорения входа
Чтобы проверить, для каких приложений настроена политика автоматического ускорения входа, используйте командлет Get-AzureADPolicyAppliedObject и передайте в него идентификатор объекта политики, который нужно проверить.

``` powershell
Get-AzureADPolicyAppliedObject -ObjectId <ObjectId of the Policy>
```
#### <a name="step-5-youre-done"></a>Шаг 5. Готово!
Испытайте приложение, чтобы проверить новую политику в действии.

### <a name="example-listing-the-applications-for-which-an-auto-acceleration-policy-is-configured"></a>Пример: получение списка приложений, для которых настроена политика автоматического ускорения входа

#### <a name="step-1-list-all-policies-created-in-your-organization"></a>Шаг 1. Получение списка всех политик, созданных в организации 

``` powershell
Get-AzureADPolicy
```

Запишите **идентификатор объекта** политики, для которой вы хотите получить список назначений.

#### <a name="step-2-list-the-service-principals-the-policy-is-assigned-to"></a>Шаг 2. Получение списка субъектов-служб, которым назначена политика  

``` powershell
Get-AzureADPolicyAppliedObject -ObjectId <ObjectId of the Policy>
```

### <a name="example-removing-an-auto-acceleration-policy-for-an-application"></a>Пример: удаление политики автоматического ускорения входа для приложения
#### <a name="step-1-use-the-previous-example-to-get-the-objectid-of-the-policy-and-that-of-the-application-service-principal-you-wish-to-remove-it-from"></a>Шаг 1. Использование предыдущего примера для получения идентификатора объекта политики, а также идентификатора субъекта-службы приложения, из которого нужно удалить политику
#### <a name="step-2-remove-the-policy-assignment-from-the-application-service-principal"></a>Шаг 2. Удаление назначения политики из субъекта-службы приложения  

``` powershell
Remove-AzureADApplicationPolicy -ObjectId <ObjectId of the Service Principal>  -PolicyId <ObjectId of the policy>
```

#### <a name="step-3-check-removal-by-listing-the-service-principals-the-policy-is-assigned-to"></a>Шаг 3. Проверка удаления путем получения списка субъектов-служб, которым назначена политика 

``` powershell
Get-AzureADPolicyAppliedObject -ObjectId <ObjectId of the Policy>
```
## <a name="next-steps"></a>Дальнейшие действия
- Дополнительные сведения о принципах работы проверки подлинности в Azure AD см. в статье [Сценарии аутентификации в Azure Active Directory](develop/active-directory-authentication-scenarios.md).
- Дополнительные сведения о едином входе пользователей см. в статье [Управление параметрами единого входа для корпоративных приложений](active-directory-enterprise-apps-manage-sso.md).
- Сведения для разработчиков см. в [руководстве разработчика по Active Directory](develop/active-directory-developers-guide.md).
