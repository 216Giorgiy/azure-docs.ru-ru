---
title: Настройка автоматического ускорения входа для приложения с помощью политики обнаружения домашней области | Документация Майкрософт
description: В этом разделе объясняется, что такое клиент Azure AD и как управлять Azure с помощью Azure Active Directory.
services: active-directory
documentationcenter: ''
author: barbkess
manager: mtillman
ms.service: active-directory
ms.component: app-mgmt
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: it-pro
ms.date: 11/09/2017
ms.author: barbkess
ms.openlocfilehash: 5df12f905595c9b3e8caa8f372b9ba7b54672f81
ms.sourcegitcommit: d98d99567d0383bb8d7cbe2d767ec15ebf2daeb2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/10/2018
---
# <a name="configure-sign-in-auto-acceleration-for-an-application-by-using-a-home-realm-discovery-policy"></a>Настройка автоматического ускорения входа для приложения с помощью политики обнаружения домашней области

В этой статье приведен обзор обнаружения домашней области и автоматического ускорения.

## <a name="home-realm-discovery"></a>Обнаружение домашней области
Обнаружение домашней области (HRD) представляет собой процесс, позволяющий службе Azure Active Directory (Azure AD) во время входа определять области, в которых пользователь должен пройти аутентификацию.  При входе в клиент Azure AD для доступа к ресурсу или на общую страницу входа Azure AD пользователь вводит имя пользователя (имя участника-пользователя). Azure AD использует его для обнаружения областей, где пользователь должен выполнить вход. 

Чтобы пройти аутентификацию, пользователь должен быть перенаправлен в одно из приведенных ниже расположений.

- Домашний клиент пользователя (может использоваться тот же, которому принадлежит ресурс, к которому пользователь пытается получить доступ). 

- Учетную запись Майкрософт.  В клиенте ресурса пользователь является гостем.

- Другой поставщик удостоверений, включенный в федерацию с клиентом Azure AD.

-  Локальный поставщик удостоверений, например службы федерации Active Directory (AD FS).

## <a name="auto-acceleration"></a>Автоматическое ускорение 
Для аутентификации пользователя некоторые организации настраивают свой клиент Azure Active Directory для объединения с другим поставщиком удостоверений, например AD FS.  

В этих случаях, когда пользователь входит в приложение, то сначала он переходит на страницу входа в Azure AD. После их ввода имени участника-пользователя пользователь перенаправляется на страницу входа поставщика удостоверений. При определенных обстоятельствах у администраторов может возникнуть необходимость направлять пользователей на страницу входа, когда они пытаются войти в определенные приложения. 

Это означает, что пользователь может пропустить начальную страницу Azure Active Directory. Этот процесс называется автоматическим ускорением входа.

В случаях, когда клиент является федеративным в отношении другого поставщика удостоверений для входа, автоматическое ускорение позволяет упростить вход пользователей.  Автоматическое ускорение входа можно настроить для отдельных приложений.

>[!NOTE]
>При настройке приложения для автоматического ускорения гостевые пользователи не могут выполнить вход. Когда пользователь будет перенаправлен непосредственно к федеративному поставщику удостоверений для аутентификации, он больше не сможет вернуться на страницу входа Azure Active Directory. Гостевые пользователи, которых требуется направить в другие клиенты или внешние поставщики удостоверений, например учетную запись Майкрософт, не смогут выполнить вход в это приложение, так как шаг обнаружения домашней области пропускается.  

Существуют два способа управления автоматическим ускорением входа в федеративный поставщик удостоверений.   

- Можно использовать указание домена в запросах на аутентификацию для приложения. 
- Можно настроить политику обнаружения домашней области для включения автоматического ускорения входа.

## <a name="domain-hints"></a>Указания домена 
Указания домена представляют собой директивы, включенные в запрос на аутентификацию из приложения. Их можно использовать для ускорения входа пользователя на страницу входа федеративного поставщика удостоверений. Или они могут использоваться мультитенантным приложением, чтобы ускорить для клиента вход пользователя непосредственно на страницу входа Azure AD с фирменной символикой.  

Например, приложение largeapp.com дает возможность клиентам получить доступ к приложению с помощью пользовательского URL-адреса contoso.largeapp.com. Приложение может также включать указание домена contoso.com в запрос на аутентификацию. 

Синтаксис указания домена может быть разным в зависимости от используемого протокола и обычно настраивается в приложении.

**WS-Federation**:  whr=contoso.com в строке запроса.

**SAML**: либо запрос на аутентификацию SAML, содержащий указание домена, либо строка запроса whr=contoso.com.

**Open ID Connect**: строка запроса domain_hint=contoso.com. 

Если указание домена включено в запрос на аутентификацию из приложения, а клиент входит в федерацию с этим доменом, Azure AD предпринимает попытку перенаправить операцию входа на страницу поставщика удостоверений, настроенного для этого домена. 

Если указание домена не ссылается на проверенный федеративный домен, оно игнорируется и активируется стандартное обнаружение домашней области.

Дополнительные сведения об автоматическом ускорении с помощью указаний домена, поддерживаемых службой Azure Active Directory, см. в блоге [Enterprise Mobility + Security](https://cloudblogs.microsoft.com/enterprisemobility/2015/02/11/using-azure-ad-to-land-users-on-their-custom-login-page-from-within-your-app/).

>[!NOTE]
>Если указание домена включено в запрос на аутентификацию, то его наличие переопределяет любую политику обнаружения домашней области, настроенную для приложения.

## <a name="home-realm-discovery-policy"></a>Политика обнаружения домашней области
Некоторые приложения не предоставляют возможность настроить выдаваемый ими запрос на аутентификацию. В таких случаях невозможно использовать указания домена для управления автоматическим ускорением. Автоматическое ускорение можно настроить с помощью политики, чтобы добиться нужного поведения.  

### <a name="set-hrd-policy"></a>Задание политики обнаружения домашней области (HRD)
Настройка автоматического ускорения входа включает в себя три шага.


1. Создание политики обнаружения домашней области для автоматического ускорения.

2. Поиск субъекта-службы, к которому будет применена эта политика.

3. Применение политики к субъекту-службе. Политики, созданные в клиенте, не работают, пока они не подключены к сущности. 

Политику обнаружения домашней области можно применить к субъекту-службе, и только одна такая политика может быть активна для заданной сущности в одно время.  

Чтобы настроить автоматическое ускорение входа с помощью политики обнаружения домашней области, вы можете использовать непосредственно API Graph Microsoft Azure Active Directory или командлеты PowerShell для Azure Active Directory.

API Graph, который позволяет управлять политикой, описан в статье [Operations on policy](https://msdn.microsoft.com/library/azure/ad/graph/api/policy-operations) (Операции с политикой) на сайте MSDN.

Ниже приведен пример определения политики обнаружения домашней области.
    
 ```
   {  
    "HomeRealmDiscoveryPolicy":
    {  
    "AccelerateToFederatedDomain":true,
    "PreferredDomain":"federated.example.edu"
    }
   }
```

Тип политики — "HomeRealmDiscoveryPolicy".

Если параметр **AccelerateToFederatedDomain** имеет значение false, то политика не действует.

В параметре **PreferredDomain** следует указать домен, вход на который требуется ускорить. Его можно опустить, если клиент использует только один федеративный домен.  Если его не указать, но при этом имеется более одного проверенного федеративного домена, политика не будет действовать.

Если указан параметр **PreferredDomain**, он должен соответствовать проверенному федеративному домену для клиента. Все пользователи приложения должны иметь возможность выполнить вход на этот домен.

### <a name="priority-and-evaluation-of-hrd-policies"></a>Приоритетность и оценка политик HRD
Вы можете создать политики HRD, а затем назначить их отдельным организациям и субъектам-службам. Это означает, что к определенному приложению может применяться сразу несколько политик. Политика HRD оказывает влияние согласно следующим правилам:


- Если указание домена присутствует в запросе на аутентификацию, то любая политика обнаружения домашней области игнорируется. В этом случае используется поведение, заданное указанием домена.

- В противном случае, если политика явно назначена субъекту-службе, применяется именно она. 

- Если отсутствует указание домена и нет политики, явно назначенной субъекту-службе, применяется политика, явно назначенная родительской организации субъекта-службы. 

- Если отсутствует указание домена и нет политики, назначенной субъекту-службе или организации, используется стандартное поведение HRD.

## <a name="tutorial-for-setting-sign-in-auto-acceleration-on-an-application-by-using-an-hrd-policy"></a>Руководство по настройке автоматического ускорения входа для приложения с помощью политики обнаружения домашней области
Мы будем использовать командлеты PowerShell для Azure AD, чтобы изучить несколько сценариев, включая:


- настройку автоматического ускорения входа для приложения для клиента с одним федеративным доменом;

- настройку автоматического ускорения входа для приложения в один из нескольких доменов, проверенных клиентом;

- получение списка приложений, для которых настроена политика.

### <a name="prerequisites"></a>предварительным требованиям
В примерах ниже создаются, обновляются, связываются и удаляются политики для субъектов-служб приложения в Azure AD.

1.  Чтобы начать, скачайте последнюю предварительную версию командлетов PowerShell для Azure AD. 

2.  После этого выполните команду Connect для входа в Azure AD с помощью учетной записи администратора.

    ``` powershell
    Connect-AzureAD -Confirm
    ```
3.  Выполните следующую команду для просмотра всех политик в организации.

    ``` powershell
    Get-AzureADPolicy
    ```

Если результат не возвращается, в клиенте нет созданных политик.

### <a name="example-set-auto-acceleration-for-an-application"></a>Пример. Настройка автоматического ускорения входа для приложения 
В этом примере создается политика автоматического ускорения входа пользователей на странице входа AD FS при входе в приложение. Пользователи могут выполнить вход, не вводя перед этим имя пользователя на странице входа Azure AD. 

#### <a name="step-1-create-an-hrd-policy"></a>Шаг 1. Создание политики обнаружения домашней области
``` powershell
New-AzureADPolicy -Definition @("{`"HomeRealmDiscoveryPolicy`":{`"AccelerateToFederatedDomain`":true}}") -DisplayName BasicAutoAccelerationPolicy -Type HomeRealmDiscoveryPolicy
```

При наличии одного федеративного домена, выполняющего аутентификацию пользователей для приложений, вам необходимо создать только одну политику обнаружения домашней области.  

Чтобы просмотреть созданную политику и получить для нее идентификатор **ObjectID**, выполните следующую команду.

``` powershell
Get-AzureADPolicy
```


Чтобы включить автоматическое ускорение после настройки политики обнаружения домашней области, ее можно назначить нескольким субъектам-службам приложения.

#### <a name="step-2-locate-the-service-principal-to-which-to-assign-the-policy"></a>Шаг 2. Поиск субъекта-службы для назначения политики  
Чтобы назначить политику субъектам-службам, необходимо знать их идентификаторы **ObjectID**. Существует несколько способов получения идентификатора **ObjectID** субъектов-служб.    

Можно использовать портал или отправить запрос к [Microsoft Graph](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity). Можно также открыть [Graph Explorer Tool](https://graphexplorer.cloudapp.net/) и войти в учетную запись Azure AD, чтобы просмотреть список всех субъектов-служб в своей организации. Так как вы используете PowerShell, можно использовать командлет get-AzureADServicePrincipal, чтобы вывести список субъектов-служб и их идентификаторов.

#### <a name="step-3-assign-the-policy-to-your-service-principal"></a>Шаг 3. Назначение политики для субъекта-службы  
Получив идентификатор **ObjectID** субъекта-службы приложения, для которого требуется настроить автоматическое ускорение, выполните следующую команду. Эта команда привязывает политику обнаружения домашней области, созданную на шаге 1, к субъекту-службе, определенному на шаге 2.

``` powershell
Add-AzureADServicePrincipalPolicy -Id <ObjectID of the Service Principal> -RefObjectId <ObjectId of the Policy>
```

Эту команду можно повторить для каждого субъекта-службы, для которого необходимо добавить политику.

#### <a name="step-4-check-which-application-service-principals-your-auto-acceleration-policy-is-assigned-to"></a>Шаг 4. Проверка субъектов-служб приложения, которым назначена политика автоматического ускорения входа
Чтобы проверить, для каких приложений настроена политика автоматического ускорения входа, используйте командлет **Get-AzureADPolicyAppliedObject**. Передайте в него идентификатор **ObjectID** политики, которую нужно проверить.

``` powershell
Get-AzureADPolicyAppliedObject -ObjectId <ObjectId of the Policy>
```
#### <a name="step-5-youre-done"></a>Шаг 5. Готово!
Испытайте приложение, чтобы проверить новую политику в действии.

### <a name="example-list-the-applications-for-which-an-auto-acceleration-policy-is-configured"></a>Пример. Получение списка приложений, для которых настроена политика автоматического ускорения входа

#### <a name="step-1-list-all-policies-that-were-created-in-your-organization"></a>Шаг 1. Получение списка всех политик, созданных в организации 

``` powershell
Get-AzureADPolicy
```

Запишите идентификатор **ObjectID** политики, для которой вы хотите получить список назначений.

#### <a name="step-2-list-the-service-principals-to-which-the-policy-is-assigned"></a>Шаг 2. Получение списка субъектов-служб, которым назначена политика  

``` powershell
Get-AzureADPolicyAppliedObject -ObjectId <ObjectId of the Policy>
```

### <a name="example-remove-an-auto-acceleration-policy-for-an-application"></a>Пример. Удаление политики автоматического ускорения входа для приложения
#### <a name="step-1-get-the-objectid"></a>Шаг 1. Получение идентификатора ObjectID
Используйте предыдущий пример, чтобы получить идентификатор **ObjectID** политики, а также идентификатор ObjectID субъекта-службы приложения, из которого нужно удалить эту политику. 

#### <a name="step-2-remove-the-policy-assignment-from-the-application-service-principal"></a>Шаг 2. Удаление назначения политики из субъекта-службы приложения  

``` powershell
Remove-AzureADApplicationPolicy -ObjectId <ObjectId of the Service Principal>  -PolicyId <ObjectId of the policy>
```

#### <a name="step-3-check-removal-by-listing-the-service-principals-to-which-the-policy-is-assigned"></a>Шаг 3. Проверка удаления путем получения списка субъектов-служб, которым назначена политика 

``` powershell
Get-AzureADPolicyAppliedObject -ObjectId <ObjectId of the Policy>
```
## <a name="next-steps"></a>Дополнительная информация
- Дополнительные сведения о принципах работы аутентификации в Azure AD см. в статье [Сценарии аутентификации в Azure Active Directory](develop/active-directory-authentication-scenarios.md).
- Дополнительные сведения о едином входе пользователей см. в статье [Управление параметрами единого входа для корпоративных приложений](active-directory-enterprise-apps-manage-sso.md).
- Сведения для разработчиков см. в [руководстве разработчика по Active Directory](develop/active-directory-developers-guide.md).
