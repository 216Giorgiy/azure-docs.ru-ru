<properties
   pageTitle="Принципы проектирования Azure AD Connect | Microsoft Azure"
	description="В этой статье описываются факторы, которые необходимо учитывать при проектировании реализации"
	services="active-directory"
	documentationCenter=""
	authors="AndKjell"
	manager="stevenpo"
	editor=""/>

<tags
   ms.service="active-directory"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="Identity"
	ms.date="09/03/2015"
	ms.author="andkjell"/>

# Принципы проектирования Azure AD Connect
В этой статье приведено описание факторов, которые должны учитываться при проектировании реализации Azure AD Connect. Здесь подробно рассмотрены некоторые вопросы, которые кратко описывались в других статьях.

## sourceAnchor
Атрибут sourceAnchor определяется как *атрибут, который остается неизменным на протяжении всего времени существования объекта*. Он однозначно определяет объект независимо от того, является ли он локальным или находится в Azure AD. Этот атрибут также называется **immutableId**. Оба этих имени взаимозаменяемы.

Слово «неизменяемый» (immutable) является ключевым. Оно означает, что значение атрибута не может быть изменено. Поскольку значение этого атрибута неизменно после его задания, важно выработать механизм, поддерживающий ваш сценарий.

Данный атрибут используется в следующих случаях.

- При построении нового сервера синхронизации или повторном построении после аварийного восстановления. В этом случае данный атрибут свяжет существующие объекты в Azure AD и локальные объекты.
- При перемещении из исключительно облачного удостоверения в модель синхронизированных удостоверений. В этом случае данный атрибут позволит жестко связывать существующие объекты в Azure AD с локальными объектами.
- Если вы используете федерации, этот атрибут в сочетании с **userPrincipalName** используется в утверждении для уникальной идентификации пользователя.

В этой статье речь пойдет только об атрибуте sourceAnchor в контексте его отношений с пользователями. Аналогичные правила действуют для всех типов объектов, но проблемы обычно возникают именно у пользователей.

### Выбор значений атрибута sourceAnchor.
Значение атрибута должно соответствовать следующим правилам:

- его длина должна быть меньше 60 символов;
- оно не должно содержать специальные символы: &#92; ! # $ % & * + / = ? ^ &#96; { } | ~ < > ( ) ' ; : , [ ] " @ \_
- оно должно быть глобально уникальным;
- оно должно иметь строковый, целочисленный или двоичный тип;
- не должно быть основано на имени пользователя;
- не должно учитывать регистр и не содержать значения, которые могут изменяться по регистру;
- должно назначаться при создании объекта.


Если значение sourceAnchor не является строковым, то в качестве типа Azure AD Connect будет использовать Base64Encode. Это исключит появление специальных символов. Если вы используете сервер федерации, отличный от ADFS, убедитесь что на сервере можно использовать кодировку Base64 для атрибута.

Атрибут sourceAnchor чувствителен к регистру. «JohnDoe» и «johndoe» — это разные значения.

При наличии одного локального леса следует использовать атрибут **objectGUID**. Этот атрибут используется, если вы применяете стандартные параметры Azure AD Connect. Он также используется в DirSync.

Если у вас есть несколько лесов и вы не перемещаете пользователей между лесами или доменами одного леса, рекомендуется использовать атрибут **objectGUID**.

В случае перемещения пользователей между лесами или доменами вам потребуется найти такой атрибут, который никогда не изменяется или может перемещаться с пользователями. Рекомендуется использовать синтетический атрибут. Для этого подойдет атрибут, который будет выглядеть, как идентификатор GUID. При создании объекта пользователю присваивается новый идентификатор GUID. Настраиваемое правило может быть создано на сервере подсистемы синхронизации для формирования этого значения на основе **objectGUID** и обновления выбранного атрибута в ADDS. При перемещении объекта убедитесь, что это значение также копируется.

Кроме того, можно выбрать существующий атрибут, который точно не изменится. Зачастую можно использовать атрибут **employeeID**. Если значение вашего атрибута будет содержать буквы, вам потребуется исключить вероятность изменения регистра (на верхний или нижний) в значении атрибута. Не следует использовать атрибуты, содержащие имя пользователя. В случае женитьбы или развода имя может измениться, что недопустимо для этого атрибута. Это одна из причин того, почему мастер установки Azure AD Connect не позволяет выбирать такие атрибуты, как **userPrincipalName**, **mail** и **targetAddress**. Эти атрибуты также содержат символ @, что недопустимо для sourceAnchor.


### Изменение атрибута sourceAnchor.
Значение атрибута sourceAnchor нельзя изменить после создания объекта в Azure AD и синхронизации удостоверения.

По этой причине в Azure AD Connect действуют следующие ограничения.

- Атрибут sourceAnchor можно задать только при первоначальной установке. При повторном запуске мастера установки этот параметр доступен только для чтения. Для изменения атрибута потребуется удалить и переустановить программу.
- При установке другого сервера Azure AD Connect необходимо выбрать уже используемый атрибут sourceAnchor. Если вы ранее использовали DirSync и переходите на Azure AD Connect, вам потребуется использовать **objectGUID**, так как этот атрибут использовался в DirSync.
- Если после экспорта объекта в Azure AD значение sourceAnchor будет изменено, синхронизация Azure AD Connect выдаст ошибку. После этого вы не сможете вносить изменения в объект до устранения проблемы и возврата sourceAnchor в исходный каталог.

<!---HONumber=September15_HO1-->