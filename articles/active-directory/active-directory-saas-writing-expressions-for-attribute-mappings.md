<properties
	pageTitle="Запись выражений для сопоставления атрибутов в Azure Active Directory"
	description="Узнайте, как использовать сопоставление выражений для преобразования значений атрибутов в допустимый формат при автоматической подготовке объектов приложения SaaS в Azure Active Directory."
	services="active-directory"
	documentationCenter=""
	authors="markusvi"
	manager="swadhwa"
	editor=""/>

<tags
	ms.service="active-directory"
	ms.workload="identity"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="07/27/2015"
	ms.author="markusvi"/>


# Запись выражений для сопоставления атрибутов в Azure Active Directory

При настройке подготовки для приложения SaaS одним из типов сопоставления атрибутов, которые можно указать, является сопоставление выражений. Для этого необходимо написать выражение, похожее на скрипт. Оно позволит вам преобразовать данные пользователей в форматы, более подходящие для приложений SaaS.





## Общие сведения о синтаксисе

Синтаксис выражений для сопоставления атрибутов напоминает функции Visual Basic для приложений (VBA).

- Все выражение должно определяться функциями, состоящими из имени и следующих за ним в скобках аргументов: <br> *имя\_функции (<<argument 1>>, <<argument N>>)*.


- Функции можно вкладывать одну в другую. Например: <br> *функция\_один(функция\_два(<<argument1>>))*.


- В функцию можно передавать следующие три типа аргументов.

   1. Атрибуты, которые должны быть заключены в квадратные скобки. Например: [имя\_атрибута].

   2. Строковые константы, которые должны быть заключены в двойные кавычки. Например: "США".

   3. Другие функции. Например: функция\_один(<<argument1>>, функция\_два(<<argument2>>)).


- Если в строковых константах необходимо использовать обратную косую черту (\) или кавычки (""), такие символы следует экранировать обратной косой чертой (\). Например: "Название компании: "Contoso"".



## Список функций

[Append](#append) &nbsp;&nbsp;&nbsp;&nbsp; [Coalesce](#coalesce) &nbsp;&nbsp;&nbsp;&nbsp; [FormatDateTime](#formatdatetime) &nbsp;&nbsp;&nbsp;&nbsp; [Join](#join) &nbsp;&nbsp;&nbsp;&nbsp; [MatchRegex](#matchregex) &nbsp;&nbsp;&nbsp;&nbsp; [Mid](#mid) &nbsp;&nbsp;&nbsp;&nbsp; [Not](#not) &nbsp;&nbsp;&nbsp;&nbsp; [ObsoleteReplace](#obsoletereplace) &nbsp;&nbsp;&nbsp;&nbsp; [Replace](#replace) &nbsp;&nbsp;&nbsp;&nbsp; [ReplaceRegex](#replaceregex) &nbsp;&nbsp;&nbsp;&nbsp; [StripSpaces](#stripspaces) &nbsp;&nbsp;&nbsp;&nbsp; [Switch](#switch)





----------
### Добавить

**Функция:**<br> Append(источник, суффикс)

**Описание:**<br> Получает исходное строковое значение и присоединяет к его концу суффикс.
 
**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **источник** | Обязательно | Строка | Как правило, имя атрибута из исходного объекта. |
| **суффикс** | Обязательно | Строка | Строка, которую необходимо присоединить к концу исходного значения. |


----------
### Coalesce

**Функция:**<br> Coalesce(источник\_1, источник\_2, …)

**Описание:**<br> Возвращает первое непустое значение из списка параметров источника.
 
**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **источник\_1, ... источник\_N \*\* | Обязательно; количество повторов может меняться | Строка | **Исходные** значения, доступные для выбора |



----------
### FormatDateTime

**Функция:**<br> FormatDateTime(источник, входной\_формат, выходной\_формат)

**Описание:**<br> Преобразовывает строку даты из одного формата в другой.
 
**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **источник** | Обязательно | Строка | Как правило, имя атрибута из исходного объекта. |
| **входной\_формат** | Обязательно | Строка | Предполагаемый формат исходного значения. Список поддерживаемых форматов см. на странице [http://msdn.microsoft.com/library/8kb3ddd4%28v=vs.110%29.aspx](http://msdn.microsoft.com/library/8kb3ddd4%28v=vs.110%29.aspx). |
| **выходной\_формат** | Обязательно | Строка | Формат вывода даты. |



----------
### Join

**Функция:**<br> Join(разделитель, источник\_1, источник\_2, ...)

**Описание:**<br> Функция Join() схожа с функцией Append() за исключением того, что она может объединять несколько **исходных** строковых значений в одну строку; при этом каждое значение разделяется строкой **разделителя**.

Если одно из исходных значений является атрибутом с несколькими значениями, все значения в этом атрибуте будут объединены, а между ними будут значения разделителя.

 
**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **разделитель** | Обязательно | Строка | Строка, используемая для разделения исходных значений, когда они объединяются в одну строку. Если разделитель не требуется, может не иметь значения (""). |
| **источник\_1, ... источник\_N \*\* | Обязательно; количество повторов может меняться | Строка | Строковые значения для объединения. |





----------
### MatchRegex

**Функция:**<br> MatchRegex(источник, поиск, группа)

**Описание:**<br> Возвращает подстроку в рамках исходного значения, которая соответствует шаблону регулярного выражения, указанному в параметре «поиск». Если указана группа, возвращает значение только этой группы регулярных выражений.


**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **источник** | Обязательно | Строка | **Исходное** значение, в котором выполняется поиск. |
| **поиск** | Обязательно | Строка | Регулярное выражение для сопоставления в рамках **исходного** значения. |
| **группа** | Необязательно | Строка | Имя группы в рамках сопоставленного регулярного выражения, значение которого будет использоваться. |



----------
### Mid

**Функция:**<br> Mid(источник, начало, длина)

**Описание:**<br> Возвращает подстроку исходного значения. Подстрокой является строка, содержащая только некоторые символы из исходной строки.


**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **источник** | Обязательно | Строка | Как правило, имя атрибута. |
| **start** | Обязательно | целое число | Индекс положения в **исходной** строке, откуда должна начинаться подстрока. Первый символ в строке будет иметь индекс 1, второй символ — индекс 2 и т. д. |
| **длина** | Обязательно | целое число | Длина подстроки. Если длина превышает размер **исходной** строки, функция возвращает подстроку длиной от из **начала** индекса и до конца **исходной** строки. |




----------
### Not

**Функция:**<br> Not(источник)

**Описание:**<br> Изменяет логическое значение **источника**. Если **исходное** значение равно «\*True\*», возвращает значение «\*False\*». В противном случае возвращает значение «\*True\*».


**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **источник** | Обязательно | Логическая строка | Предполагаемые **исходные** значения: "True" или "False". |



----------
### ObsoleteReplace

**Функция:**<br> ObsoleteReplace(источник, старое\_значение, шаблон\_регулярного\_выражения, имя\_группы\_регулярного\_выражения, значение\_замены, имя\_атрибута\_замены, шаблон)

**Описание:**<br>
> [AZURE.NOTE]Эта функция будет в ближайшее время упразднена и заменена более простыми версиями.

Заменяет значения в пределах строки. Ее работа зависит от указанных параметров.

- Если указаны параметры **старое\_значение** и **значение\_замены**:

   - заменяет все вхождения старого значения в источнике значениями замены.

- Если указаны параметры **старое\_значение** и **шаблон**:

   - заменяет все вхождения **старого\_значения** в **шаблоне** значением **источника**.

- Если указаны параметры **шаблон\_старого\_значения\_регулярного\_выражения**, **имя\_группы\_регулярного\_выражения\_старого\_значения**, **значение\_замены**:

   - заменяет все значения, сопоставимые с шаблоном старого значения регулярного выражения в исходной строке, значением замены.

- Если указаны параметры **шаблон\_старого\_значения\_регулярного\_выражения**, **имя\_группы\_регулярного\_выражения\_старого\_значения**, **имя\_свойства\_замены**:

   - Если **источник** имеет значение, возвращает **источник**.

- Если **источник** не имеет значение, используется **шаблон\_регулярного\_выражения\_старого\_значения** и **имя\_группы\_регулярного\_выражения\_старого\_значения** для извлечения значения замены из свойства с помощью параметра **имя\_свойства\_замены**. В качестве результата возвращается значение замены.


**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **источник** | Обязательно | Строка | Как правило, имя атрибута из исходного объекта. |
| **старое\_значение** | Необязательно | Строка | Значение для замены в **источнике** или **шаблоне**. |
| **шаблон\_регулярного\_выражения** | Необязательно | Строка | Шаблон регулярного выражения для значения, заменяемого в **источнике**. Или, при использовании имени свойства замены, шаблон для извлечения значения из свойства замены. |
| **имя\_группы\_регулярного\_выражения** | Необязательно | Строка | Имя группы внутри **шаблона\_регулярного\_выражения**. Значение этой группы будет извлечено из свойства замены как значение замены, только если используется имя свойства замены. |
| **значение\_замены** | Необязательно | Строка | Новое значение для замены старого. |
| **имя\_атрибута\_замены** | Необязательно | Строка | Имя атрибута, используемого для значения замены, если источник не имеет значение. |
| **шаблон** | Необязательно | Строка | Когда указано значение **шаблон**, будет выполнен поиск **старого\_значения** в шаблоне с последующей заменой исходным значением. |



----------
### Замените

**Функция:**<br> Replace(источник, поиск, замена)

**Описание:**<br> Заменяет все вхождения значения **поиск** в **исходной** строке значением параметра **замена**.

**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **источник** | Обязательно | Строка | **Исходное** значение, в котором выполняется поиск. |
| **поиск** | Обязательно | Строка | Искомое значение. |
| **replace** | Обязательно | Строка | Значение для замены. |



----------
### ReplaceRegex

**Функция:**<br> ReplaceRegex(источник, поиск, замена, группа)

**Описание:**<br> В **исходной** строке заменяет все подстроки, соответствующие регулярному выражению **поиска**, значением **замены**. Если указан параметр **группа**, будет заменено только значение этой группы регулярного выражения.

**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **источник** | Обязательно | Строка | **Исходное** значение, в котором выполняется поиск. |
| **поиск** | Обязательно | Строка | Регулярное выражение для сопоставления в рамках **исходного** значения. |
| **replace** | Обязательно | Строка | Значение для замены. |
| **группа** | Необязательно | Строка | Имя группы в рамках сопоставленного регулярного выражения, значение которого будет использоваться. |




----------
### StripSpaces

**Функция:**<br> StripSpaces(источник)

**Описание:**<br> Удаляет все пробелы (" ") из исходной строки.

**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **источник** | Обязательно | Строка | **Исходное** значение, которое необходимо обновить. |



----------
### Switch

**Функция:**<br> Switch(источник, значение\_по\_умолчанию, ключ\_1, значение\_1, ключ\_2, значение\_2, …)

**Описание:**<br> Если **исходное** значение соответствует **ключу**, возвращается **значение** для этого **ключа**. Если **исходное** значение не соответствует ни одному ключу, возвращается **значение\_по\_умолчанию**. Параметры **ключ** и **значение** должны всегда быть парными. Для функции необходимо всегда использовать четное количество параметров.

**Параметры:**<br>

|Имя| Обязательно/повторяется | Тип | Примечания |
|--- | ---                 | ---  | ---   |
| **источник** | Обязательно | Строка | **Исходное** значение, которое необходимо обновить. |
| **defaultValue** | Необязательно | Строка | Значение по умолчанию, которое необходимо использовать, если источник не соответствует ни одному ключу. Может быть пустой строкой (""). |
| **key** | Обязательно | Строка | **Ключ**, с которым сравнивается **исходное** значение. |
| **значение** | Обязательно | Строка | Значение, которым заменяется **исходное** значение, совпадающее с ключом. |



## Примеры

### Извлечение известного доменного имени

Необходимо извлечь известное доменное имя из адреса электронной почты пользователя, чтобы получить имя пользователя. <br> Например, если домен — «contoso.com», можно использовать следующее выражение.


**Выражение:** <br> `Replace([mail], "@contoso.com", "")`

**Пример ввода и вывода:** <br>

- **ВВОД** (mail): «john.doe@contoso.com»

- **ВЫВОД**: «john.doe»



### Добавление суффикса константы к имени пользователя

При использовании Salesforce Sandbox может потребоваться добавить дополнительный суффикс ко всем именам пользователей перед их синхронизацией.




**Выражение:** <br> `Append([userPrincipalName], ".test"))`

**Пример ввода и вывода:**<br>

- **ВВОД**: (userPrincipalName): «John.Doe@contoso.com»


- **ВЫВОД**: «John.Doe@contoso.com.test»





### Создание псевдонима пользователя путем сцепления частей имени и фамилии

Необходимо создать псевдоним пользователя, используя первые три буквы имени и первые пять букв фамилии пользователя.


**Выражение:** <br> `Append(Mid([givenName], 1, 3), Mid([surname], 1, 5))`

**Пример ввода и вывода:**<br>

- **ВВОД** (givenName): «John»

- **ВВОД** (surname): «Doe»

- **ВЫВОД**: «JohDoe»




### Вывод даты в виде строки в определенном формате

Необходимо отправить в приложение SaaS даты в определенном формате. <br> Например, требуется отформатировать даты для ServiceNow.



**Выражение:** <br>

`FormatDateTime([extensionAttribute1], "yyyyMMddHHmmss.fZ", "yyyy-MM-dd")`

**Пример ввода и вывода:**

- **ВВОД** (extensionAttribute1): «20150123105347.1Z»

- **ВЫВОД**: «2015-01-23»





### Замена значения на основе предопределенного набора параметров

Необходимо определить часовой пояс пользователя на основе кода государства, сохраненного в Azure AD. <br> Если код государства не совпадает с предопределенными параметрами, используйте значение по умолчанию «Австралия/Сидней».


**Выражение:** <br>

`Switch([state], "Australia/Sydney", "NSW", "Australia/Sydney","QLD", "Australia/Brisbane", "SA", "Australia/Adelaide")`

**Пример ввода и вывода:**

- **ВВОД** (state): «QLD»

- **ВЫВОД**: «Австралия/Брисбейн»



## Дополнительные ресурсы

* [Что такое доступ к приложениям и единый вход с помощью Azure Active Directory?](active-directory-appssoaccess-whatis.md)

<!--Image references-->

<!---HONumber=July15_HO5-->