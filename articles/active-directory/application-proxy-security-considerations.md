---
title: "Вопросы безопасности при удаленном доступе к приложениям через прокси приложения Azure AD | Документация Майкрософт"
description: "В этой статье рассматриваются вопросы безопасности при использовании прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/12/2017
ms.author: kgremban
translationtype: Human Translation
ms.sourcegitcommit: 0d6f6fb24f1f01d703104f925dcd03ee1ff46062
ms.openlocfilehash: 4019b379939e43e4e974552f1f0be245c5b1d33e
ms.lasthandoff: 04/17/2017


---

# <a name="security-considerations-for-accessing-apps-remotely-by-using-azure-ad-application-proxy"></a>Вопросы безопасности при удаленном доступе к приложениям через прокси приложения Azure AD

>[!NOTE]
>Функция прокси приложения доступна только после обновления службы Azure Active Directory до выпуска Premium или Basic. Дополнительные сведения см. в разделе [Выпуски Azure Active Directory](active-directory-editions.md).

В этой статье описывается, каким образом прокси приложения Azure Active Directory (Azure AD) обеспечивает безопасную публикацию приложений и удаленный доступ к ним.

Прокси приложения Azure AD предоставляет следующие преимущества безопасности.

**Доступ с проверкой подлинности.** Только подключения, прошедшие проверку подлинности, могут получить доступ к сети.

* Прокси приложения Azure AD во всех случаях использует для проверки подлинности службу маркеров безопасности Azure AD. Трафик приложений, опубликованных с предварительной проверкой подлинности, не может проходить в среду через службу прокси приложения без допустимого маркера службы маркеров безопасности.
* Предварительная проверка подлинности организована так, что она автоматически блокирует значительное количество анонимных атак. Доступ к внутреннему приложению получают только удостоверения, прошедшие проверку подлинности.

**Условный доступ.** Примените расширенные параметры политики, прежде чем устанавливать подключения к сети.

* Благодаря условному доступу можно точнее определить ограничения в отношении трафика, который может проходить к внутренним приложениям. Вы можете определить ограничения на основе расположения, надежности проверки подлинности и профиля риска пользователя.
* Эта функция создает дополнительные препятствия для злоумышленников. Дополнительные сведения об условном доступе см. в статье [Приступая к работе с условным доступом Azure Active Directory](https://azure.microsoft.com/documentation/articles/active-directory-conditional-access-azuread-connected-apps).

**Завершение трафика.** Весь трафик завершается в облаке.

* Прокси приложения Azure AD работает как обратный прокси-сервер, поэтому в этой службе завершается весь трафик, направленный к внутренним приложениям. Сеанс возобновляется только для внутренних серверов, то есть эти внутренние серверы не получают трафик HTTP напрямую. Таким образом, вы можете легко устранить целевые атаки.

**Только исходящий доступ.** Для корпоративной сети не требуется открывать входящие подключения.

* Соединители Azure AD поддерживают исходящие подключения к службе прокси приложения Azure AD, поэтому нет необходимости открывать порты брандмауэра для входящих подключений.
* В рамках традиционных подходов приходилось создавать сеть периметра (другие названия — *DMZ*, *демилитаризованная зона* и *промежуточная подсеть*) и открывать на границе сети доступ для подключений без проверки подлинности. Это требовало дополнительных расходов на брандмауэры веб-приложения (WAF), которые анализируют трафик и защищают сетевую среду. Прокси приложения позволяет избежать такой ситуации. Вы даже можете отказаться от сети периметра, так как теперь все подключения являются исходящими и передаются по защищенному каналу.

**Аналитика безопасности и аналитика на основе машинного обучения.** Используйте самые современные меры безопасности.

* Для защиты идентификации Azure AD с аналитикой на основе машинного обучения используются данные из подразделения Digital Crimes Unit и Microsoft Security Response Center. Вместе мы в упреждающем режиме определяем скомпрометированные учетные записи и обеспечиваем защиту в реальном времени от входов, представляющих высокий уровень риска. Мы учитываем множество факторов, таких как доступ с зараженных устройств, из нетипичных и сомнительных расположений, а также через анонимизирующие сети.
* Многие из этих отчетов и событий уже сейчас можно использовать в API для интеграции с системами управления сведениями о безопасности и событиями (SIEM).
* Дополнительные сведения см. в статье [Защита идентификации Azure Active Directory](https://azure.microsoft.com/documentation/articles/active-directory-identityprotection).

**Удаленный доступ как услуга.** Вам больше не нужно беспокоиться о поддержке локальных серверов и установке для них исправлений.

* Прокси приложения Azure AD — это глобальная служба корпорации Майкрософт, которая гарантирует применение новейших исправлений и обновлений безопасности.
* Программное обеспечение, на котором не установлены исправления, по-прежнему подвергается большому количеству атак. Наша модель служб снимает с вас заботы об управлении пограничными серверами.

Службы с удаленным доступом, предоставляемые через Azure AD, функционируют в соответствии с требованиями и стандартами, изложенными в [центре управления безопасностью Azure](https://azure.microsoft.com/support/trust-center).

На следующей схеме показано, как Azure AD обеспечивает безопасный удаленный доступ к локальным приложениям.

 ![Схема безопасного удаленного доступа через прокси приложения Azure AD](./media/application-proxy-security-considerations/secure-remote-access.png)

>[!NOTE]
>Чтобы повысить уровень безопасности приложений, опубликованных в прокси приложения Azure AD, мы запрещаем программам-обходчикам индексировать и архивировать ваши приложения. Каждый раз, когда программа-обходчик пытается получить параметры автоматической обработки для опубликованного приложения, прокси приложения отправляет ей файл robots.txt, который содержит следующие данные:
>
>_User-agent: *_  
>_Disallow: /_

## <a name="components-of-the-azure-ad-application-proxy-solution"></a>Компоненты решения на базе прокси приложения Azure AD

Прокси приложения Azure AD состоит из двух частей:

* Облачная служба, в которой устанавливают соединения клиенты или пользователи.
* Соединитель прокси приложения Azure AD. Этот локальный компонент прослушивает запросы от службы прокси приложения Azure AD и обрабатывает подключения к внутренним приложениям. Служба берет на себя и такие элементы, как ограниченное делегирование Kerberos (KCD) для единого входа.

Между соединителем и службой прокси приложения устанавливается поток данных. Это происходит в следующих случаях:

* При первоначальной настройке соединителя.
* Когда соединитель обращается к службе прокси приложения, запрашивая сведения о конфигурации, в том числе о том, в какую группу соединителей он входит.
* Пользователь получает доступ к опубликованному приложению.

>[!NOTE]
>Весь обмен данными осуществляется по протоколу SSL и всегда инициируется соединителем службы прокси приложения. В службе используются только исходящие соединения.

Почти для всех вызовов соединитель использует сертификат клиента, чтобы пройти проверку подлинности в службе прокси приложения. Единственным исключением является этап начальной настройки, когда устанавливается сертификат клиента.

### <a name="installing-the-connector"></a>Установка соединителя

При начальной настройке соединителя выполняются события из следующей последовательности.

1. В процессе установки соединителя происходит его регистрация в службе. Сейчас для этого пользователю предлагается ввести учетные данные администратора Azure AD. Полученный маркер затем предъявляется службе прокси приложения Azure AD.
2. Прокси приложения оценивает маркер, чтобы убедиться, что пользователь является членом роли администратора компании в том клиенте, для которого выдан маркер. Если пользователь не является членом роли администратора, процесс завершается.
3. Соединитель генерирует запрос сертификата клиента и вместе с маркером передает его в службу прокси приложения, которая в свою очередь проверяет маркер и подписывает запрос сертификата клиента.
4. Соединитель использует этот сертификат клиента для последующего обмена данными со службой прокси приложения.
5. Соединитель обращается к службе, чтобы получить данные о конфигурации системы, предоставляя сертификат клиента. Теперь все готово, чтобы принимать запросы.

### <a name="updating-the-configuration-settings"></a>Обновление параметров конфигурации

Каждый раз, когда служба прокси приложения обновляет параметры конфигурации, выполняются события из следующей последовательности.

1. Соединитель подключается к конечной точке конфигурации в службе прокси приложения, передавая свой сертификат клиента.
2. После проверки сертификата клиента служба прокси приложения возвращает в соединитель данные о конфигурации (например, в какую группу должен входить этот соединитель).
3. Если с даты начала действия текущего сертификата прошло больше 30 дней, соединитель генерирует новый запрос сертификата. Таким образом, сертификат клиента обновляется каждые 30 дней.

### <a name="accessing-published-applications"></a>Доступ к опубликованным приложениям

Когда пользователь запрашивает доступ к опубликованному приложению, выполняются события из следующей последовательности.

1. Служба прокси приложения проверяет параметры конфигурации приложения. Если в приложении используется предварительная проверка подлинности с помощью Azure AD, пользователи перенаправляются для проверки подлинности в службу маркеров безопасности Azure AD. Если приложение опубликовано в сквозном режиме, этот шаг пропускается.

 а. При проверке подлинности в Azure AD проверяется соответствие всем требованиям политики условного доступа для конкретного приложения. Этот шаг позволяет гарантировать, что пользователь назначен приложению. Если требуется многофакторная идентификация (MFA), появляется запрос на второй этап проверки подлинности.

 b. Когда все проверки выполнены, служба маркеров безопасности Azure AD выдает для приложения подписанный маркер и перенаправляет пользователя обратно в службу прокси приложения.

 c. Прокси приложения выполняет проверку, чтобы подтвердить, что маркер выдан именно тому приложению, к которому пользователь запрашивал доступ. Служба проверяет и другие данные, например подпись Azure AD и срок действия маркера.

 г) Прокси приложения создает зашифрованный файл cookie для проверки подлинности (например, несохраняемый файл cookie), который будет подтверждать, что проверка подлинности в приложении успешно выполнена. Этот файл cookie содержит метку времени, которая обозначает окончание срока его действия, вычисляемое по данным маркера Azure AD и другим данным, таким как имя пользователя, по которому выполнялась проверка подлинности. Файл cookie шифруется с помощью закрытого ключа, известного только службе прокси приложения.

 д. Прокси приложения перенаправляет пользователя к исходному запрошенному URL-адресу.

 >[!NOTE]
 >Если на любом из этапов предварительной проверки подлинности происходит сбой, запрос пользователя отклоняется с сообщением о причинах проблемы.
 >

2. Получив от клиента запрос, прокси приложения проверяет все условия предварительной проверки подлинности и срок действия файла cookie (при необходимости). Затем прокси приложения помещает запрос в соответствующую очередь для обработки с помощью локального соединителя. 

 >[!NOTE]
 >Все запросы от соединителя к службе прокси приложения являются исходящими. Соединители не закрывают исходящее подключение для прокси приложения. Когда поступает новый запрос, прокси приложения добавляет его в очередь в одном из открытых подключений, чтобы его получил соединитель.

 * Запрос содержит данные для приложения, например заголовки запроса и данные из зашифрованного файла cookie, имя пользователя, отправившего запрос, и идентификатор запроса. Однако зашифрованный файл cookie, используемый для проверки подлинности, не передается в соединитель.

3. Соединитель получает запрос из очереди на основе продолжительного исходящего подключения. На основе запроса прокси приложения выполняет одно из следующих действий.

 * Соединитель подтверждает возможность идентификации приложения. Если приложение определить не удается, соединитель устанавливает подключение к службе прокси приложения для сбора сведений о приложении, а ответ кэширует локально.

 * Если запрос является простой операцией (например, когда в тексте нет данных, как в случае с операцией *GET* RESTful), соединитель подключается к целевому внутреннему ресурсу и ожидает ответа.

 * Если в тексте запроса содержатся данные, как в случае с операцией *POST* RESTful, соединитель устанавливает исходящее подключение к экземпляру прокси приложения, используя сертификат клиента. Это подключение используется для запроса данных и открытия подключения к внутреннему ресурсу. Получив запрос от соединителя, служба прокси приложения начинает принимать содержимое от пользователя и перенаправляет данные в соединитель. Соединитель, в свою очередь, перенаправляет данные во внутренний ресурс.

4. Когда завершается выполнение запроса и передача содержимого в серверную службу, соединитель ожидает ответа.

5. Получив этот ответ, соединитель устанавливает исходящее подключение к службе прокси приложения, чтобы передать сведения о заголовке и начать потоковую передачу возвращаемых данных.

6. Прокси приложения выполняет потоковую передачу данных пользователю. В зависимости от требований и параметров приложения может выполняться обработка заголовков.

Если вам нужна помощь в передаче данных через клиентский браузер от веб-приложения Azure к локальной конечной точке SOAP, прошедшей проверку подлинности Windows, ознакомьтесь с [этой записью блога](http://www.azurefieldnotes.com/2016/12/02/claims-to-windows-identity-translation-solutions-and-its-flaws-when-using-azure-ad-application-proxy).

## <a name="next-steps"></a>Дальнейшие действия

[Сведения о соединителях прокси приложения Azure AD](application-proxy-understand-connectors.md)

