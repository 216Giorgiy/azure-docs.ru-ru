---
title: "Вопросы безопасности при удаленном доступе к приложениям через прокси приложения Azure AD | Документация Майкрософт"
description: "В этой статье рассматриваются вопросы безопасности при использовании прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/12/2017
ms.author: kgremban
translationtype: Human Translation
ms.sourcegitcommit: 67650676117fef834ea819da2fc45ca66ed15493
ms.openlocfilehash: 1b713e015f48b044c6c9d8ff6a0d8669d4532a9f


---

# <a name="security-considerations-when-accessing-apps-remotely-using-azure-ad-application-proxy"></a>Вопросы безопасности при удаленном доступе к приложениям через прокси приложения Azure AD

>[!NOTE]
>Прокси приложения — это функция, которая доступна только после обновления до выпуска Premium или Basic службы Azure Active Directory. Дополнительные сведения см. в разделе [Выпуски Azure Active Directory](active-directory-editions.md).
>  

В этой статье описывается, каким образом прокси приложения Azure AD обеспечивает безопасную публикацию приложений и удаленный доступ к ним. 

Прокси приложения Azure AD предоставляет следующие преимущества безопасности.

**Доступ с проверкой подлинности.** Только подключения, прошедшие проверку подлинности, могут получить доступ к сети.

* Все процедуры проверки подлинности прокси приложения Azure AD используют службу маркеров безопасности Azure AD. Трафик приложений, опубликованных с предварительной проверкой подлинности, не может проходить через службу прокси приложения в среду без допустимого маркера службы маркеров безопасности.
* Предварительная проверка подлинности по своей сути блокирует значительное количество анонимных атак, так как доступ к серверному приложению могут получить только те удостоверения, которые прошли проверку подлинности.

**Условный доступ.** Примените расширенные параметры политики, прежде чем устанавливать подключения к сети.

* Благодаря условному доступу можно точнее определить ограничения в отношении трафика, который может проходить к серверным приложениям. Вы можете определить ограничения на основе расположения, надежности проверки подлинности и профиля риска пользователя.
* Эта функция создает дополнительные препятствия для злоумышленников. Дополнительные сведения об условном доступе см. в статье [Приступая к работе с условным доступом Azure Active Directory](https://azure.microsoft.com/en-us/documentation/articles/active-directory-conditional-access-azuread-connected-apps).

**Завершение трафика.** Весь трафик завершается в облаке.

* Прокси приложения Azure AD — это обратный прокси-сервер, поэтому весь трафик, передаваемый в серверные приложения, завершается в службе. Сеанс можно установить заново только с внутреннего сервера. Это означает, что внутренние серверы недоступны для передачи трафика HTTP. Таким образом, вы можете легко устранить целевые атаки.

**Только исходящий доступ.** Для корпоративной сети не требуется открывать входящие подключения.

* Соединители Azure AD поддерживают исходящие подключения к службе прокси приложения Azure AD. Это означает, что открывать порты брандмауэра для входящих подключений не нужно. 
* В традиционных подходах требуется зона периметра и открытие доступа к подключениям без проверки подлинности на границе сети. Это привело к дополнительному инвестированию в продукты WAF для анализа трафика и обеспечения дополнительной защиты в среде. При использовании прокси приложения этого сценария можно избежать. Вы даже можете отказаться от использования сети периметра, так как все подключения исходящие и передаются по защищенному каналу.

**Аналитика безопасности и аналитика на основе машинного обучения.** Современные меры безопасности.

* Для защиты идентификации Azure AD с аналитикой на основе машинного обучения используются данные из Подразделения цифровых преступлений Майкрософт и Центра Microsoft Security Response Center. Вместе мы в упреждающем режиме определяем скомпрометированные учетные записи и обеспечиваем защиту в реальном времени от входов, представляющих высокий уровень риска. Мы учитываем множество факторов, таких как доступ с зараженных устройств, нетипичных и сомнительных расположений, а также через анонимные сети.
* Многие из этих отчетов и событий уже можно интегрировать с системами SIEM через API.
* Дополнительные сведения о защите идентификации Azure AD см. [здесь](https://azure.microsoft.com/en-us/documentation/articles/active-directory-identityprotection).
!
**Удаленный доступ как услуга.** Вам больше не нужно беспокоиться о поддержке локальных серверов и установке для них исправлений.

* Прокси приложения Azure AD — это принадлежащая нам масштабируемая интернет-служба, поэтому вы всегда будете получать последние исправления и обновления безопасности. Как видите, мы заботимся о безопасности вашей сети.
* Программное обеспечение, на котором не установлены исправления, по-прежнему подвергается большому количеству атак. С нашей моделью служб вы больше не несете ответственность за управление пограничными серверами. 

Службы с удаленным доступом, предоставляемые через Azure AD, функционируют в соответствии с требованиями и стандартами, изложенными в [центре управления безопасностью Azure](https://azure.microsoft.com/en-us/support/trust-center). 

На схеме ниже показано, как Azure AD обеспечивает безопасный удаленный доступ к локальным приложениям.

 ![Соединители прокси приложения Azure AD](./media/application-proxy-security-considerations/secure-remote-access.png)

>[!NOTE] 
>Чтобы повысить уровень безопасности приложений, опубликованных прокси приложения Azure AD, мы запрещаем программам-обходчикам индексировать и архивировать ваши приложения. Каждый раз, когда программа-обходчик пытается получить параметры robots опубликованного приложения, прокси приложения отправляет ей файл robots.txt, который содержит следующие данные: <br>
>   _User-agent: *_<br>
>   _Disallow: /_
>

## <a name="components-of-the-azure-ad-app-proxy-solution"></a>Компоненты решения прокси приложения Azure AD

Прокси приложения Azure AD состоит из двух частей:

* Облачная служба (прокси приложения AAD). Здесь устанавливаются внешние подключения клиента или пользователя.
* Локальный компонент, который называется соединителем прокси приложения AAD.  Соединитель прослушивает запросы от службы прокси приложения AAD и обрабатывает подключения к внутренним приложениям, а также обеспечивает такие функции, как ограниченное делегирование Kerberos для единого входа.

### <a name="traffic-flowsand-how-they-are-secured"></a>Потоки трафика и способы их защиты
В этом разделе содержатся сведения о защите потоков. Поток между соединителем и службой прокси приложения устанавливается, когда: 

* Соединитель предварительно настроен.
* Соединитель запрашивает сведения о конфигурации из службы прокси приложения, включая группу соединителей, в которую входит каждый соединитель.
* Пользователь получает доступ к опубликованному приложению.

>[!NOTE]
>Весь обмен данными осуществляется по протоколу SSL и всегда создается в соединителе службы прокси приложения. Эта служба является только исходящей.
>

Соединитель использует сертификат клиента, чтобы проверять подлинность службы прокси приложения для всех вызовов. Единственным исключением является этап начальной настройки, когда устанавливается сертификат клиента.

#### <a name="install-the-connector"></a>Установка соединителя

Следующий поток происходит при начальной настройке соединителя.

1. Регистрация соединителя в службе происходит в процессе его установки. При этом пользователь получает запрос на ввод учетных данных администратора Azure AD. Затем полученный маркер предоставляется службе прокси приложения Azure AD.
2. Прокси приложения оценивает маркер, чтобы убедиться, что пользователь является членом роли администратора компании в клиенте, для которого был выдан маркер. В противном случае процесс завершается.
3. Соединитель генерирует запрос сертификата клиента и передает его с маркером в службу прокси приложения, которая в свою очередь проверяет маркер и подписывает запрос сертификата клиента. 
4. Соединитель использует этот сертификат клиента для будущего обмена данными со службой прокси приложения.
4. Соединитель выполняет начальный запрос данных конфигурации системы из службы с помощью сертификата клиента. Теперь он готов принимать запросы.

#### <a name="periodic-configuration-updates"></a>Периодические обновления конфигурации

Следующий поток происходит периодически, каждый раз, когда служба прокси приложения обновляет параметры конфигурации.

1. Соединитель подключается к конечной точке конфигурации в службе прокси приложения с помощью сертификата клиента.
2. После проверки сертификата клиента служба прокси приложения возвращает данные конфигурации в соединитель, например группу соединителей, в которую должен входить соединитель.
3. Соединитель генерирует запрос сертификата, если с даты начала действия текущего сертификата прошло больше 30 дней. Таким образом, он эффективно развертывает сертификат клиента каждые 30 дней.

#### <a name="accesss-published-applications"></a>Доступ к опубликованным приложениям

Следующий поток происходит, когда пользователи получают доступ к опубликованному приложению.

1. Когда пользователь осуществляет доступ к опубликованному приложению, служба прокси приложения проверяет параметры конфигурации приложения.  Если в приложении настроено использование предварительной проверки подлинности с помощью Azure AD, пользователь перенаправляется в службу маркеров безопасности Azure AD для прохождения проверки подлинности.  Если приложение опубликовано с транзитной предварительной проверкой подлинности, этот шаг пропускается.
 * При проверке подлинности с помощью Azure AD проверяется соответствие любым требованиям политики условного доступа для конкретного приложения. Это нужно, чтобы удостовериться, что пользователь назначен этому приложению (например, если требуется многофакторная идентификация, пользователю нужно будет пройти двухфакторную проверку подлинности).
 * Когда все проверки выполнены, служба маркеров безопасности Azure AD выдает для приложения подписанный маркер и перенаправляет пользователя обратно в службу прокси приложения.
 * Затем прокси приложения проверяет маркер, чтобы убедиться, что он выдан приложению, к которому пользователь запрашивал доступ. При этом выполняются и другие проверки, например проверка того, что маркер был подписан с помощью Azure AD, что его срок действия еще не истек и т. д.
 * Прокси приложения создает зашифрованный файл cookie проверки подлинности (например, несохраняемый файл cookie), чтобы указать, что проверка подлинности в приложении выполнена.  Этот файл cookie содержит отметку времени окончания срока действия на основе маркера из Azure AD и другие данные, например имя пользователя, для которого выполнялась проверка подлинности.  Этот файл шифруется с помощью закрытого ключа, известного только службе прокси приложения.
 * Прокси приложения перенаправляет пользователя обратно к исходному запрошенному URL-адресу.
 >[!NOTE] 
 >При сбое любого из этапов предварительной проверки подлинности запрос пользователя отклоняется и отображается сообщение, содержащее источник проблемы.
 >

2. При получении запроса от клиента прокси приложения проверяет, выполняется ли условие предварительной проверки подлинности и действителен ли файл cookie (при необходимости). Затем он помещает запрос в соответствующую очередь для обработки локальным соединителем. 

 >[!NOTE]
 >Для службы прокси приложения все запросы от соединителя исходящие. Соединители не закрывают исходящее подключение для прокси приложения. При поступлении запроса прокси приложения добавляет его в очередь в одном из открытых подключений, чтобы его получил соединитель.
 >

 * Запрос содержит элементы из приложения, например заголовки запроса и данные из зашифрованного файла cookie, имя пользователя, отправившего запрос, и идентификатор запроса.  Но зашифрованный файл cookie проверки подлинности не отправляется в соединитель.
3. Соединитель получает запрос из очереди на основе продолжительного исходящего подключения. В зависимости от запроса прокси приложения выполняет одно из следующих действий:
 * Соединитель подтверждает возможность идентификации приложения.  В противном случае он устанавливает подключение к службе прокси приложения для сбора сведений о приложении, а затем кэширует их локально.
 * Если запрос является простой операцией, например, когда в тексте нет данных, как в случае с операцией GET RESTful, соединитель подключается к целевому внутреннему ресурсу и ожидает ответа.
 * Если запрос содержит данные, связанные с ним в тексте, например операцию POST RESTful, соединитель устанавливает исходящее подключение к экземпляру прокси приложения, используя сертификат клиента. Это происходит для запроса данных и открытия подключения ко внутреннему ресурсу.  При получении запроса от соединителя служба прокси приложения начинает принимать содержимое от пользователя и перенаправляет его в соединитель.  Соединитель, в свою очередь, перенаправляет данные во внутренний ресурс.
4. После завершения запроса и передачи содержимого в серверную службу соединитель ожидает ответа.
5. После получения ответа соединитель устанавливает исходящее подключение к службе прокси приложения, чтобы вернуть сведения о заголовке и начать потоковую передачу возвращаемых данных.
6. Прокси приложения выполняет потоковую передачу данных к пользователю.  В зависимости от требований и параметров приложения может выполняться обработка заголовков.

Если вам нужна помощь в передаче данных от веб-приложения Azure к локальной конечной точке SOAP, прошедшей проверку подлинности Windows, через клиентский браузер, ознакомьтесь с [этой записью блога](http://www.azurefieldnotes.com/2016/12/02/claims-to-windows-identity-translation-solutions-and-its-flaws-when-using-azure-ad-application-proxy). 

##<a name="next-steps"></a>Дальнейшие действия
[Сведения о соединителях прокси приложения Azure AD](application-proxy-understand-connectors.md)




<!--HONumber=Feb17_HO2-->


