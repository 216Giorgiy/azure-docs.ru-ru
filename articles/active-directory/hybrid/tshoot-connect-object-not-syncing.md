---
title: Устранение неполадок синхронизации объекта с Azure AD | Документация Майкрософт
description: Узнайте, как устранять неполадки синхронизации объекта с Azure AD.
services: active-directory
documentationcenter: ''
author: billmath
manager: daveba
editor: ''
ms.assetid: ''
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/10/2018
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 55668b8ef8019e1ee808bc0cba9d98c0db53c584
ms.sourcegitcommit: 301128ea7d883d432720c64238b0d28ebe9aed59
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/13/2019
ms.locfileid: "56198746"
---
# <a name="troubleshoot-an-object-that-is-not-synchronizing-to-azure-ad"></a>Устранение неполадок синхронизации объекта с Azure AD

Если при синхронизации объекта с Azure AD возникают неполадки, то это может быть вызвано несколькими причинами. Если вы получили от Azure AD сообщение об ошибке по электронной почте или ошибка отображается в службе Azure AD Connect Health, то ознакомьтесь со статьей [Устранение ошибок синхронизации](tshoot-connect-sync-errors.md). Но если возникла ситуация, при которой объект не находится в Azure AD, то вы найдете все необходимые сведения в этой статье. Здесь описывается, как найти ошибки в локальном компоненте под названием "Синхронизация Azure AD Connect".

>[!IMPORTANT]
>Чтобы устранить неполадки с синхронизацией объектов в развертывании Azure Active Directory (AAD) Connect версии 1.1.749.0 и выше, используйте в мастере [задачу устранения неполадок](tshoot-connect-objectsync.md). 

## <a name="synchronization-process"></a>Процесс синхронизации

Прежде чем исследовать проблемы синхронизации, давайте разберемся с процессом синхронизации **Azure AD Connect**.

  ![Процесс синхронизации Azure AD Connect](./media/tshoot-connect-object-not-syncing/syncingprocess.png)

### <a name="terminology"></a>**Терминология**

* **CS** — пространство соединителя, таблица в базе данных.
* **MV** — метавселенная, таблица в базе данных.
* **AD** — Active Directory
* **AAD** — Azure Active Directory

### <a name="synchronization-steps"></a>**Шаги синхронизации**
Процесс синхронизации включает следующие шаги.

1. **Импорт из AD.** Объекты **Active Directory** переносятся в **CS AD**.

2. **Импорт из AAD.** Объекты**Azure Active Directory** переносятся в **CS AAD**.

3. **Синхронизация.** **Правила входящей синхронизации** и **Правила исходящей синхронизации** выполняются в порядке номера приоритета от меньшего к большему. Чтобы просмотреть правила синхронизации, можно перейти в **Редактор правил синхронизации** из приложений рабочего стола. **Правила входящей синхронизации** перемещают данные из CS в MV. **Правила исходящей синхронизации** перемещают данные из MV в CS.

4. **Экспорт в AD.** После выполнения синхронизации объекты экспортируются из CS AD в **Active Directory**.

5. **Экспорт в AAD.** После выполнения синхронизации объекты экспортируются из CS AAD в **Azure Active Directory**.

## <a name="troubleshooting"></a>Устранение неполадок

Чтобы найти ошибки, необходимо просмотреть несколько различных расположений в следующем порядке:

1. [Журналы операций](#operations), где могут быть зафиксированы ошибки, определяемые модулем синхронизации во время импорта и синхронизации.
2. [Пространство соединителя](#connector-space-object-properties), где могут быть отсутствующие объекты и ошибки синхронизации.
3. [Метавселенная](#metaverse-object-properties), где могут быть проблемы, связанные с данными.

Прежде чем выполнять эти действия, запустите [Synchronization Service Manager](how-to-connect-sync-service-manager-ui.md).

## <a name="operations"></a>Операции
Начните устранение неполадок с вкладки "Operations" (Операции) в Synchronization Service Manager. На вкладке "Operations" (Операции) отображаются результаты последних операций.  
![Диспетчер службы синхронизации](./media/tshoot-connect-object-not-syncing/operations.png)  

В верхней части отображены все операции выполнения в хронологическом порядке. По умолчанию журнал операций содержит сведения за последние семь дней, но эту цифру можно изменить с помощью [планировщика](how-to-connect-sync-feature-scheduler.md). Вы можете найти любую операцию выполнения, которая не была завершена успешно. Вы также можете изменить порядок сортировки, щелкая заголовки.

Столбец **Status** (Состояние) является самым важным, он показывает наиболее серьезную проблему при выполнении. Ниже приводится краткая сводка наиболее распространенных состояний в порядке приоритета для анализа (где * означает, что возможно несколько строк ошибки).

| Status | Комментарий |
| --- | --- |
| stopped-* |Не удалось завершить выполнение. Например, если удаленная система не работает и с ней не удается связаться. |
| stopped-error-limit |Обнаружено более 5000 ошибок. Выполнение было автоматически остановлено из-за большого количества ошибок. |
| completed-\*-errors |Выполнение завершено, но есть ошибки (меньше 5000), которые необходимо изучить. |
| completed-\*-warnings |Запуск завершен, но некоторые данные не находятся в ожидаемом состоянии. Если обнаружены ошибки, такое сообщение обычно является указателем. Пока вы не исправили ошибки, не следует рассматривать предупреждения. |
| Успешное завершение |Проблемы отсутствуют. |

При выборе строки в нижней части отображаются сведения об этой операции выполнения. Слева внизу может отображаться список **Step #**(Шаг №). Он отображается, только если у вас в лесу несколько доменов, где каждый домен представлен шагом. Имя домена можно найти в разделе **Partition**(Секция). В разделе **Synchronization Statistics**(Статистика синхронизации) можно найти дополнительные сведения о числе обработанных изменений. Щелкая ссылки, можно получить список измененных объектов. Если у вас есть объекты с ошибкой, они отображаются в разделе **Synchronization Errors**(Ошибки синхронизации).

### <a name="troubleshoot-errors-in-operations-tab"></a>Устранение ошибок на вкладке "Operations" (Операции)
![Диспетчер службы синхронизации](./media/tshoot-connect-object-not-syncing/errorsync.png)  
Если есть ошибки, то отображаемый в них объект и сама ошибка представлены ссылками, перейдя по которым можно получить дополнительные сведения.

Для начала щелкните строку ошибки (**sync-rule-error-function-triggered** на рисунке выше). Сначала отображается обзор объекта. Чтобы просмотреть фактическую ошибку, нажмите кнопку **Stack Trace**(Трассировка стека). Эта трассировка отображает информацию уровня отладки об ошибке.

Вы можете щелкнуть правой кнопкой мыши поле **call stack information** (Сведения о стеке вызовов), выбрать пункт **select all** (Выбрать все) и щелкнуть **copy** (Копировать). Затем можно скопировать стек и просмотреть ошибку в любом редакторе на ваше усмотрение, например в Блокноте.

* Если получена ошибка из **SyncRulesEngine**, в начале сведений стека вызовов можно просмотреть список всех атрибутов объекта. Прокрутите вниз до заголовка **InnerException =>**.  
  ![Диспетчер службы синхронизации](./media/tshoot-connect-object-not-syncing/errorinnerexception.png)  
   В строке ниже отображается ошибка. На рисунке выше ошибка получена из-за создания пользовательского правила синхронизации Fabrikam.

Если сама ошибка не содержит достаточно сведений, значит, пора взглянуть на данные. Вы можете щелкнуть ссылку с идентификатором объекта и продолжить устранение неполадок в [импортированном объекте пространства соединителя](#cs-import).

## <a name="connector-space-object-properties"></a>Свойства объекта пространства соединителя
Если на вкладке [Operations](#operations) (Операции) ошибки не выявлены, то необходимо отследить объект пространства соединителя, перейдя из Active Directory в метавселенную, а затем — в Azure AD. На этом пути проблема должна быть выявлена.

### <a name="search-for-an-object-in-the-cs"></a>Поиск объекта в пространстве соединителя

В **Synchronization Service Manager** откройте раздел **Connectors** (Соединители), выберите соединитель Active Directory, а затем выберите **Search Connector Space** (Поиск в пространстве соединителя).

В поле **Scope** (Область) выберите **RDN**, если требуется выполнить поиск по атрибуту CN, или **DN or anchor** (Различающееся имя или привязка), если требуется выполнить поиск по атрибуту distinguishedName. Введите значение и нажмите кнопку **Search** (Поиск).  
![Поиск в пространстве соединителя](./media/tshoot-connect-object-not-syncing/cssearch.png)  

Если не удается найти искомый объект, то он мог быть отфильтрован с помощью [фильтрации по доменам](how-to-connect-sync-configure-filtering.md#domain-based-filtering) или [фильтрации по подразделениям](how-to-connect-sync-configure-filtering.md#organizational-unitbased-filtering). Ознакомьтесь со статьей [Синхронизация Azure AD Connect: настройка фильтрации](how-to-connect-sync-configure-filtering.md), чтобы проверить правильность настроек фильтрации.

Другой полезный вариант поиска — это выбрать соединитель Azure AD, в поле **Scope** (Область) выбрать **Pending Import** (Ожидание импорта) и установить флажок **Add** (Добавить). При таком поиске отображаются все синхронизируемые в Azure AD объекты, которые не могут быть связаны с локальным объектом.  
![Поиск потерянного объекта в пространстве соединителя](./media/tshoot-connect-object-not-syncing/cssearchorphan.png)  
Эти объекты были созданы другим модулем синхронизации или модулем синхронизации с другими настройками фильтрации. Это представление является списком **потерянных объектов**, управление которыми больше не осуществляется. Просмотрите список и по возможности удалите эти объекты с помощью командлетов [Azure AD PowerShell](https://aka.ms/aadposh).

### <a name="cs-import"></a>Импорт в пространстве соединителя
При открытии объекта пространства соединителя в верхней части отображаются несколько вкладок. На вкладке **импорта** отображаются данные, добавленные после импорта.  
![Объект пространства соединителя](./media/tshoot-connect-object-not-syncing/csobject.png)    
В столбце **Old Value** (Старое значение) отображаются объекты, в настоящее время хранящиеся в Connect. В столбце **New Value** (Новое значение) отображаются объекты, полученные из исходной системы и еще не примененные. Если в объекте имеется ошибка, то изменения не обрабатываются.

**Ошибка**  
![Объект пространства соединителя](./media/tshoot-connect-object-not-syncing/cssyncerror.png)  
Вкладка **Synchronization Error** (Ошибка синхронизации) отображается только при наличии проблемы с объектом. Дополнительные сведения см. в разделе [Устранение ошибок на вкладке "Operations" (Операции)](#troubleshoot-errors-in-operations-tab).

### <a name="cs-lineage"></a>Журнал преобразований пространства соединителя
На вкладке журнала преобразований отображается связь объекта пространства соединителя с объектом метавселенной. Можно увидеть, когда соединитель в последний раз импортировал изменение из подключенной системы и какие правила были применены для внесения данных в метавселенную.  
![Журнал преобразований пространства соединителя](./media/tshoot-connect-object-not-syncing/cslineage.png)  
В столбце **Действия** отображается одно правило синхронизации с направлением **Входящее** и действием **Подготовка**. Это значит, что объект метавселенной хранится, пока существует этот объект пространства соединителя. Если в списке правил синхронизации отображается правило синхронизации с направлением **Outbound** (Исходящее) и действием **Provision** (Подготовка), это значит, что объект удаляется вместе с объектом метавселенной.  
![Диспетчер службы синхронизации](./media/tshoot-connect-object-not-syncing/cslineageout.png)  
В столбце **Синхронизация паролей** можно увидеть, что входящее пространство соединителя может вносить изменения в пароль, так как одно правило синхронизации имеет значение **True**. Затем этот пароль отправляется в Azure AD с помощью правила для исходящего подключения.

Со вкладки журнала преобразований можно перейти к метавселенной. Для этого нужно щелкнуть элемент [Metaverse Object Properties](#mv-attributes) (Свойства объекта метавселенной).

На каждой вкладке в нижней части есть две кнопки: **Preview** (Предварительный просмотр) и **Log** (Журнал).

### <a name="preview"></a>Предварительный просмотр
Страница предварительного просмотра используется для синхронизации одного объекта. Это полезно, если необходимо устранить ошибки некоторых пользовательских правил синхронизации и увидеть результат изменения одного объекта. Можно выбрать нужный режим: **Full Sync** (Полная синхронизация) и **Delta sync** (Синхронизация изменений). Кроме того, можно нажать кнопку **Generate Preview** (Создать предварительный просмотр), чтобы сохранить изменения в памяти, или кнопку **Commit Preview** (Просмотр перед фиксацией), чтобы обновить метавселенную и передать все изменения в целевые пространства соединителей.  
![Диспетчер службы синхронизации](./media/tshoot-connect-object-not-syncing/preview.png)  
Вы можете проверить объект и узнать, какое правило применено к конкретному потоку атрибутов.  
![Диспетчер службы синхронизации](./media/tshoot-connect-object-not-syncing/previewresult.png)

### <a name="log"></a>Журнал
Страница журнала используется для проверки состояния синхронизации пароля и просмотра сведений журнала. Дополнительные сведения см. в статье об [устранении неполадок синхронизации хэшей паролей](tshoot-connect-password-hash-synchronization.md).

## <a name="metaverse-object-properties"></a>Свойства объекта метавселенной
Как правило, лучше начинать поиск с исходного пространства соединителя Active Directory. Но также можно начать поиск с метавселенной.

### <a name="search-for-an-object-in-the-mv"></a>Поиск объекта в метавселенной
В **Synchronization Service Manager** щелкните **Metaverse Search** (Поиск в метавселенной). Создайте запрос, который точно найдет пользователя. Можно искать по распространенным атрибутам, таким как accountName (sAMAccountName) или userPrincipalName. Дополнительные сведения см. в статье [Синхронизация Azure AD Connect: Synchronization Service Manager](how-to-connect-sync-service-manager-ui-mvsearch.md).
![Диспетчер службы синхронизации](./media/tshoot-connect-object-not-syncing/mvsearch.png)  

В окне **Search Results** (Результаты поиска) выберите объект.

Если объект не найден, то это значит, что он еще не достиг метавселенной. Продолжайте поиск объекта в [пространстве соединителя](#connector-space-object-properties) **Active Directory**. Если вы найдете объект в пространстве соединителя **Active Directory**, то может произойти ошибка синхронизации, которая блокирует попадание объекта в метавселенную, или может быть применен фильтр области правила синхронизации.

### <a name="object-not-found-in-the-mv"></a>Объект не найден в MV
Если объект находится в CS **Active Directory**, но отсутствует в MV, то применяется фильтр области действия. 

* Чтобы посмотреть фильтр области действия, перейдите в меню классического приложения и щелкните **Редактор правил синхронизации**. Отфильтруйте правила, применимые к объекту, настроив фильтр, указанный ниже.

  ![Поиск правил входящей синхронизации](./media/tshoot-connect-object-not-syncing/syncrulessearch.png)

* Просмотрите каждое правило в списке выше и проверьте **Фильтр области действия**. Если значение **isCriticalSystemObject**  в приведенном ниже фильтре области действия равно NULL, FALSE или пусто, оно находится в области действия.

  ![Поиск правил входящей синхронизации](./media/tshoot-connect-object-not-syncing/scopingfilter.png)

* Перейдите к списку атрибутов [Импорт CS](#cs-import) и проверьте, какой фильтр блокирует перемещение объекта в MV. Кроме списка атрибутов **пространства соединителя** будут отображаться только непустые атрибуты и атрибуты, которые не равны NULL. Например, если **isCriticalSystemObject** не отображается в списке, это означает, что значение этого атрибута является пустым или NULL.

### <a name="object-not-found-in-the-aad-cs"></a>Объект не найден в службе сертификации AAD
Если объект отсутствует в **пространстве соединителя** **Azure Active Directory**. Тем не менее он присутствует в MV, затем посмотрите на фильтр области действия **Исходящих** правил соответствующего **пространства соединителя** и проверьте, не отфильтрован ли объект в связи с несоответствием критерию [атрибутов MV](#mv-attributes).

* Чтобы посмотреть исходящий фильтр области действия, выберите соответствующие правила для объекта, настроив фильтр, указанный ниже. Просмотрите каждое правило и соответствующее значение [атрибута MV](#mv-attributes).

  ![Поиск правил исходящей синхронизации](./media/tshoot-connect-object-not-syncing/outboundfilter.png)


### <a name="mv-attributes"></a>Атрибуты метавселенной
На вкладке атрибутов можно просмотреть значения и узнать, какой соединитель их передал.  
![Диспетчер службы синхронизации](./media/tshoot-connect-object-not-syncing/mvobject.png)  

Если объект не синхронизируется, то просмотрите следующие атрибуты в метавселенной:
- Присутствует ли атрибут **cloudFiltered** и задано ли ему значение **true**? Если да, то это значит, что он был отфильтрован, как указано в разделе [Фильтрация по атрибутам](how-to-connect-sync-configure-filtering.md#attribute-based-filtering).
- Присутствует ли атрибут **sourceAnchor**? Если нет, то есть у вас топология леса ресурсов учетной записи? Если объект определяется как связанный почтовый ящик (атрибут **msExchRecipientTypeDetails** имеет значение 2), то атрибут sourceAnchor заполняется из леса с действующей учетной записью Active Directory. Убедитесь, что главная учетная запись правильно импортирована и синхронизирована. Главная учетная запись должны быть указана в списке [соединителей](#mv-connectors) для объекта.

### <a name="mv-connectors"></a>Соединители метавселенной
На вкладке соединителей отображаются все пространства соединителя, которые включают представление объекта.  
![Диспетчер службы синхронизации](./media/tshoot-connect-object-not-syncing/mvconnectors.png)  
Необходимо иметь соединитель для:

- каждого леса Active Directory, в котором представлен пользователь (это представление может содержать объекты foreignSecurityPrincipals и Contact);
- соединителя в Azure AD.

Если у вас нет соединителя для Azure AD, то см. раздел [Атрибуты метавселенной](#mv-attributes), чтобы проверить критерии для подготовки в Azure AD.

С этой вкладки также можно перейти к [объекту пространства соединителя](#connector-space-object-properties). Выберите строку и щелкните **Свойства**.

## <a name="next-steps"></a>Дополнительная информация
- [Синхронизация Azure AD Connect: общие сведения о синхронизации и ее настройка](how-to-connect-sync-whatis.md).
- [Что собой представляет гибридная идентификация](whatis-hybrid-identity.md).
