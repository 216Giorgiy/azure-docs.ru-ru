---
title: Предоставление пользователям B2B в Azure AD доступа к локальным приложениям | Документация Майкрософт
description: В этой статье описано, как предоставить облачным пользователям B2B доступ к локальным приложениям с помощью службы совместной работы Azure AD B2B.
services: active-directory
documentationcenter: ''
author: twooley
manager: mtillman
editor: ''
tags: ''
ms.service: active-directory
ms.topic: article
ms.workload: identity
ms.date: 04/20/2018
ms.author: twooley
ms.reviewer: sasubram
ms.openlocfilehash: 0eb567c8587b0eec367160facc86f163ef6b3c15
ms.sourcegitcommit: fa493b66552af11260db48d89e3ddfcdcb5e3152
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2018
---
# <a name="grant-b2b-users-in-azure-ad-access-to-your-on-premises-applications"></a>Предоставление пользователям B2B в Azure AD доступа к локальным приложениям

Теперь организации, использующие возможности совместной работы в Azure Active Directory (AAD) B2B для приглашения гостевых пользователей из партнерских организаций в AAD, могут предоставлять таким пользователям B2B доступ к локальным приложениям. В таких приложениях нужно использовать аутентификацию на основе SAML или встроенную проверку подлинности Windows (IWA) с ограниченным делегированием Kerberos (KCD).

## <a name="access-to-saml-apps"></a>Доступ к приложениям SAML

Если ваше локальное приложение использует аутентификацию на основе SAML, вы легко можете с помощью портала Azure предоставить к ним доступ пользователям службы совместной работы AAD B2B.

Выполните два следующих действия.

- Интегрируйте приложение SAML с помощью шаблона приложения, не включенного в коллекцию, как описано в статье [Настройка единого входа для приложений, которых нет в коллекции приложений Azure Active Directory](active-directory-saas-custom-apps.md). Обязательно запишите значение, которое вы используете для параметра **URL-адрес входа**.
-  С помощью AD Application Proxy опубликуйте локальное приложение и укажите для него источник аутентификации **Azure Active Directory**. Этот процесс описан в статье [Публикация приложений с помощью Azure Active Directory Application Proxy](application-proxy-publish-azure-portal.md). 

   При настройке **внутреннего URL-адреса** введите URL-адрес входа, указанный ранее в шаблоне приложения, не включенного в коллекцию. Это позволит сторонним пользователям обращаться к этому приложению. Прокси приложения реализует функции единого входа SAML для локального приложения.
 
   ![Параметры внутреннего URL-адреса приложения и аутентификации для локального приложения](media/active-directory-b2b-hybrid-cloud-to-on-premises/OnPremAppSettings.PNG)

## <a name="access-to-iwa-and-kcd-apps"></a>Доступ к приложениям IWA и KCD

Чтобы предоставить пользователям B2B доступ к локальным приложениям, защищенным с помощью встроенной проверки подлинности Windows и ограниченного делегирования Kerberos, требуются следующие компоненты:

- **Аутентификация через Azure Active Directory Application Proxy**. Возможность аутентификации пользователей B2B в локальном приложении. Чтобы предоставить эту возможность, локальное приложение следует опубликовать через AD Application Proxy. Дополнительные сведения см. в статье [Начало работы с прокси приложения и установка соединителя](active-directory-application-proxy-enable.md) и [Публикация приложений с помощью Azure Active Directory Application Proxy](application-proxy-publish-azure-portal.md).
- **Авторизация через объект пользователя B2B в локальном каталоге**. Приложение должно иметь возможность проверять права пользователей и правильно предоставлять им доступ к ресурсам. Встроенная проверка подлинности Windows и ограниченное делегирование Kerberos требуют наличия объекта пользователя в локальном каталоге Active Directory на Windows Server. Как описано в разделе [Принцип работы единого входа с применением KCD](active-directory-application-proxy-sso-using-kcd.md#how-single-sign-on-with-kcd-works), прокси приложения использует этот объект пользователя для олицетворения пользователя и получения маркера Kerberos для приложения. 

   При работе с пользователями B2B вы можете использовать два метода создания объектов для гостевых пользователей, которым нужна авторизации в локальном каталоге.

   - [Microsoft Identity Manager (MIM) и агент управления MIM для Microsoft Graph](#create-b2b-guest-user-objects-through-mim-preview). Для этого решения вам потребуется подписка Azure AD Premium P1. 
   - [Скрипт PowerShell](#create-b2b-guest-user-objects-through-a-script-preview). Решение на основе скрипта проще в реализации и не требует наличия MIM или Azure AD Premium. 

Ниже представлена обобщенная схема совместной работы AD Application Proxy и создания объекта пользователя B2B в локальном каталоге для предоставления пользователям B2B доступа к локальным приложениям на основе IWA и KCD. Порядок шагов описан на схеме ниже.

![Схема решений на основе MIM и скрипта B2B](media/active-directory-b2b-hybrid-cloud-to-on-premises/MIMScriptSolution.PNG)

1.  В клиент Contoso приглашается пользователь из партнерской организации (из клиента Fabrikam).
2.  В клиенте Contoso создается объект гостевого пользователя (например, объект пользователя с именем участника-пользователя guest_fabrikam.com#EXT#@contoso.onmicrosoft.com).
3.  Гость Fabrikam импортируется из Contoso через MIM или с помощью скрипта B2B PowerShell.
4.  В локальном каталоге Contoso.com с помощью MIM или скрипта B2B PowerShell создается представление объекта гостевого пользователя Fabrikam (Guest#EXT#).
5.  Гостевой пользователь обращается к локальному приложению app.contoso.com.
6.  Запрос на аутентификацию подтверждается через прокси приложения с применением ограниченного делегирования Kerberos. 
7.  Так как гостевой пользователь существует в локальной среде, аутентификация происходит успешно.

### <a name="lifecycle-management-policies"></a>Политики управления жизненным циклом

Вы можете управлять локальными объектами пользователей B2B с помощью политик управления жизненным циклом. Например: 

- Вы можете настроить для гостевого пользователя политику многофакторной проверки подлинности (MFA), чтобы она обязательно использовалась при аутентификации через прокси приложений. Дополнительные сведения см. в статье [Условный доступ пользователей в службе совместной работы B2B](active-directory-b2b-mfa-instructions.md).
- К локальным пользователям применяются любые правила спонсорства, проверки доступа, проверки учетных записей и пр., которые определены для облачного пользователя B2B. Например, если политика управления жизненным циклом удаляет облачного пользователя, соответствующий ему локальный пользователь также удаляется службой синхронизации MIM или AAD Connect. Дополнительные сведения см. в статье [Управление гостевым доступом с помощью проверок доступа Azure AD](active-directory-azure-ad-controls-manage-guest-access-with-access-reviews.md).

### <a name="create-b2b-guest-user-objects-through-mim-preview"></a>Создание объектов гостевых пользователей B2B через MIM (предварительная версия)

Сведения о том, как с помощью пакета обновления 1 для MIM 2016 и агента управления MIM для Microsoft Graph создавать объекты гостевых пользователей в локальном каталоге см. в руководстве по [совместной работе AAD B2B с Microsoft Identity Manager 2016 SP1 с использованием прокси приложений Azure (предварительная версия)](https://docs.microsoft.com/microsoft-identity-manager/microsoft-identity-manager-2016-graph-b2b-scenario).

### <a name="create-b2b-guest-user-objects-through-a-script-preview"></a>Создание объектов гостевых пользователей B2B через скрипт (предварительная версия)

Мы предлагаем вам пример скрипта PowerShell, на основе которого вы можете разработать свой механизм для создания объектов гостевых пользователей в локальной службе Active Directory.

Этот пример скрипта и файл Readme вы можете скачать в [центре загрузки](https://www.microsoft.com/download/details.aspx?id=51495). Выберите файл **Script and Readme to pull Azure AD B2B users on-prem.zip**.

Прежде чем запускать этот скрипт, обязательно проверьте предварительные требования и изучите важные рекомендации, перечисленные в README-файле. Не забывайте, что этот скрипт предлагается только в качестве примера. Перед запуском скрипта команда разработчиков вашей и (или) партнерской организации должна настроить и проверить его.

## <a name="license-considerations"></a>Рекомендации по лицензированию

Убедитесь, что вы правильно настроили клиентские лицензии (CAL) для внешних гостевых пользователей, которые обращаются к локальным приложениям. Дополнительные сведения см. в разделе "Лицензии External Connector" статьи [Клиентские лицензии и лицензии на управление](https://www.microsoft.com/en-us/licensing/product-licensing/client-access-license.aspx). Конкретные требования к лицензированию вы можете обсудить с представителем Microsoft или локальным торговым посредником.

## <a name="next-steps"></a>Дополнительная информация

- [Служба совместной работы Azure Active Directory B2B для гибридных организаций](active-directory-b2b-hybrid-organizations.md)
- [Предоставление локально управляемым партнерским учетным записям доступа к облачным ресурсам через службу совместной работы AAD B2B](active-directory-b2b-hybrid-on-premises-to-cloud.md)
- Общие сведения об Azure AD Connect см. в статье [Интеграция локальных каталогов с Azure Active Directory](connect/active-directory-aadconnect.md).

