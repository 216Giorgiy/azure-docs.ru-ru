---
title: Руководство. Настройка Workday для автоматической подготовки пользователей с помощью Azure Active Directory | Документация Майкрософт
description: Узнайте, как настроить Azure Active Directory для автоматической подготовки и отзыва учетных записей пользователей в Workday.
services: active-directory
author: cmmdesai
documentationcenter: na
manager: mtillman
ms.assetid: 1a2c375a-1bb1-4a61-8115-5a69972c6ad6
ms.service: active-directory
ms.component: saas-app-tutorial
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 06/18/2018
ms.author: chmutali
ms.openlocfilehash: 754c3278cb01e010718fa4d3cb257acf6ffe99c9
ms.sourcegitcommit: 11d8ce8cd720a1ec6ca130e118489c6459e04114
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2018
ms.locfileid: "52849859"
---
# <a name="tutorial-configure-workday-for-automatic-user-provisioning-preview"></a>Руководство. Настройка Workday для автоматической подготовки пользователей (предварительная версия)

Цель этого руководства — показать, какие действия необходимо выполнить для импорта профилей работников из Workday в Active Directory и Azure Active Directory с необязательной обратной записью электронного адреса в Workday.

## <a name="overview"></a>Обзор

Для подготовки учетных записей пользователей [служба подготовки пользователей Azure Active Directory](../manage-apps/user-provisioning.md) интегрируется с [API отдела кадров Workday](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html). Azure AD использует это подключение для включения следующих рабочих процессов подготовки пользователей:

* **Подготовка пользователей в Active Directory** — синхронизация выбранных групп пользователей из Workday в одном или нескольких доменах Active Directory.

* **Подготовка только облачных пользователей в Azure Active Directory** — в сценариях, где локальный Active Directory не используется, пользователей можно перенести непосредственно из Workday в Azure Active Directory с помощью службы подготовки пользователя Azure AD. 

* **Обратная запись адресов электронной почты в Workday** — служба подготовки пользователей Azure AD может выполнять обратную запись адресов электронной почты пользователей Azure AD в Workday. 

### <a name="what-human-resources-scenarios-does-it-cover"></a>Для каких сценариев работы отдела кадров это подходит?

Рабочие процессы подготовки пользователей Workday, поддерживаемые службой подготовки пользователей Azure AD, позволяют автоматизировать следующие сценарии работы отдела кадров и управления жизненным циклом удостоверений.

* **Наем новых сотрудников.** При добавлении нового сотрудника в Workday учетная запись пользователя автоматически создается в Active Directory, Azure Active Directory и при необходимости в Office 365, а также в [других приложениях SaaS, поддерживаемых Azure AD](../manage-apps/user-provisioning.md), с обратной записью адреса электронной почты в Workday.

* **Обновления атрибута и профиля сотрудника**. При обновлении записи сотрудника в Workday (например, имени, должности или руководителя) его учетная запись пользователя будет автоматически обновлена в Active Directory, Azure Active Directory и при необходимости в Office 365 и [других приложениях SaaS, поддерживаемых Azure AD](../manage-apps/user-provisioning.md).

* **Увольнения сотрудников**. При увольнении сотрудника в Workday его учетная запись пользователя будет автоматически отключена в Active Directory, Azure Active Directory и при необходимости в Office 365 и [других приложениях SaaS, поддерживаемых Azure AD](../manage-apps/user-provisioning.md).

* **Повторные наймы сотрудников**. При повторном поступлении сотрудника на работу в Workday его старая учетная запись может быть автоматически активирована повторно или повторно подготовлена (в зависимости от вашего желания) в Active Directory, Azure Active Directory и при необходимости в Office 365 и [других приложениях SaaS, поддерживаемых Azure AD](../manage-apps/user-provisioning.md).

### <a name="who-is-this-user-provisioning-solution-best-suited-for"></a>Кому это решение подготовки пользователей подходит лучше всего?

Это решение подготовки пользователей в Workday сейчас находится на этапе общедоступной предварительной версии и идеально подходит для:

* организаций, которым необходимо готовое облачное решение для подготовки пользователей в Workday;

* организаций, которым требуется прямая подготовка пользователей из Workday в Active Directory или Azure Active Directory;

* организаций, которым требуется подготавливать пользователей с помощью данных, полученных из модуля HCM Workday (см. раздел об [операции Get_Workers](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html));

* организаций, которым необходимо синхронизировать процессы присоединения, перемещения и удаления пользователей с одним или несколькими лесами Active Directory, доменами и подразделениями на основе только данных изменений, обнаруженных в модуле HCM Workday (см. раздел об [операции Get_Workers](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html));

* организаций, использующих Office 365 для электронной почты.

[!INCLUDE [GDPR-related guidance](../../../includes/gdpr-hybrid-note.md)]

## <a name="solution-architecture"></a>Архитектура решения

В этом разделе описывается архитектура полноценного решения для подготовки пользователей в распространенных гибридных средах. Имеется два связанных потока:

* **Полномочный поток данных отдела кадров Workday в локальную службу Active Directory.** В этом потоке связанные с работниками события (например, наем, перевод и увольнение) сначала происходят в облачном клиенте отдела кадров Workday, а затем данные событий передаются в локальную службу Active Directory через Azure AD и агент подготовки. В зависимости от события, это может приводить к операциям создания, обновления, включения или отключения в AD.
* **Поток обратной записи электронной почты — из локальной службы Active Directory в Workday.** По завершении создания учетной записи в Active Directory она синхронизируется с Azure AD через Azure AD Connect, а атрибут электронной почты, полученный из Active Directory, можно записать обратно в Workday.

![Обзор](./media/workday-inbound-tutorial/wd_overview.png)

### <a name="end-to-end-user-data-flow"></a>Полноценный поток данных пользователей

1. Команда отдела кадров выполняет транзакции с работниками (присоединение, перемещение и удаление или найм, перевод и увольнение) в Workday HCM.
2. Служба подготовки Azure AD выполняет плановую синхронизацию удостоверений из Workday HR и определяет изменения, которые требуется обработать для синхронизации с локальной службой Active Directory.
3. Служба подготовки Azure AD вызывает локальный агент подготовки AAD Connect, включив операции создания, обновления, включения или отключения учетных записей AD в полезные данные запроса.
4. Агент подготовки Azure AD Connect использует учетную запись службы для добавления или обновления данных учетной записи AD.
5. Модуль Azure AD Connect/AD Sync выполняет разностную синхронизацию, чтобы получить обновления в AD.
6. Обновления Active Directory синхронизируются с Azure Active Directory.
7. Если настроен соединитель Workday Writeback, то выполняется обратная запись атрибута электронной почты в Workday в соответствии с используемым атрибутом.


## <a name="planning-your-deployment"></a>Планирование развертывания

Прежде чем приступить к интеграции Workday, проверьте, выполнены ли указанные ниже предварительные условия, и прочтите следующее руководство о том, как сопоставить текущую архитектуру Active Directory и требования к подготовке пользователей с решениями, предоставляемыми Azure Active Directory.

### <a name="prerequisites"></a>Предварительные требования

Сценарий, описанный в этом учебнике, предполагает, что у вас уже имеется:

* Действительная подписка AD Premium P1 с правами глобального администратора.
* Клиент реализации Workday для целей тестирования и интеграции.
* Права администратора в Workday для создания пользователя системы интеграции и внесения изменений для проверки данных о сотруднике в целях тестирования.
* Для подготовки пользователей в Active Directory на сервере Windows Server 2012 (или более поздней версии) со средой выполнения .NET 4.7+ должен быть размещен [локальный агент подготовки](https://go.microsoft.com/fwlink/?linkid=847801).
* [Azure AD Connect](../hybrid/whatis-hybrid-identity.md) для синхронизации между Active Directory и Azure AD.

### <a name="planning-considerations"></a>Рекомендации относительно планирования

Azure AD предоставляет широкий набор соединителей подготовки, упрощающих управление подготовкой и жизненным циклом удостоверений из Workday в Active Directory, Azure AD, приложениях SaaS и т. д. Используемые функции и процедура настройки решения будут зависеть от среды и требований вашей организации. Сначала определите количество имеющихся и развернутых компонентов в организации, дав ответы на следующие вопросы.

* Сколько используется лесов Active Directory?
* Сколько используется доменов Active Directory?
* Сколько используется подразделений Active Directory?
* Сколько используется клиентов Azure Active Directory?
* Существуют ли пользователи, которых нужно подготовить в Active Directory и Azure Active Directory (например, гибридные пользователи)?
* Существуют ли пользователи, которых нужно подготовить в Azure Active Directory, но не в Active Directory (например, только облачные пользователи)?
* Нужно ли выполнить обратную запись адресов электронной почты пользователей в Workday?

Получив ответы на эти вопросы, можно запланировать развертывание подготовки Workday, следуя инструкциям ниже.

#### <a name="planning-deployment-of-aad-connect-provisioning-agent"></a>Планирование развертывания агента подготовки AAD Connect

Решение для подготовки пользователей из Workday в AD требует развертывания одного или нескольких агентов подготовки на серверах под управлением Windows 2012 R2 или более поздней версии, содержащих не менее 4 ГБ ОЗУ, со средой выполнения .NET 4.7+. Перед установкой агента подготовки следует учитывать следующие факторы:

* Убедитесь, что у хост-сервера, на котором выполняется агент подготовки, есть доступ к целевому домену AD.
* Мастер настройки агента подготовки регистрирует агент в клиенте Azure AD, для чего требуется доступ к домену *.msappproxy.net на порту 8082. Убедитесь в наличии правил брандмауэра для исходящего трафика, обеспечивающих такую связь.
* Агент подготовки использует учетную запись службы для связи с локальными доменами AD. Перед установкой агента рекомендуем создать учетную запись службы с разрешениями на чтение и запись свойств пользователя, а также паролем, срок действия которого не ограничен.  
* Во время настройки агента подготовки можно выбрать контроллеры домена, которые должны обрабатывать запросы на подготовку. Если у вас есть несколько географически распределенных контроллеров домена, установите агент подготовки на том же сайте, что и предпочитаемые контроллеры домена, чтобы повысить надежность и производительность полноценного решения.
* Для обеспечения высокого уровня доступности вы можете развернуть несколько агентов подготовки и зарегистрировать их для обработки одного набора локальных доменов AD.

> [!IMPORTANT]
> В рабочих средах корпорация Майкрософт рекомендует настроить не менее 3 агентов подготовки с клиентом Azure AD для обеспечения высокого уровня доступности.

#### <a name="selecting-provisioning-connector-apps-to-deploy"></a>Выбор развертываемых приложений соединителей подготовки

При интеграции с Workday и Active Directory следует учитывать ряд исходных и целевых систем:

| Исходная система | Целевая система | Примечания |
| ---------- | ---------- | ---------- |
| Workday | Домен Active Directory | Каждый домен обрабатывается как отдельная целевая система. |
| Workday | Клиент Azure AD | Требуется только для облачных пользователей. |
| Лес Active Directory | Клиент Azure AD | Сейчас этот поток обрабатывается AAD Connect. |
| Клиент Azure AD | Workday | Для обратной записи адресов электронной почты. |

Чтобы упростить подготовку рабочих процессов между Workday и Active Directory, Azure AD предоставляет ряд приложений соединителей подготовки, которые можно добавлять из коллекции приложений Azure AD.

![Коллекция приложений Azure AD](./media/workday-inbound-tutorial/wd_gallery.png)

* **Workday to Active Directory Provisioning** — это приложение упрощает подготовку учетной записи пользователя из Workday в одном домене Active Directory. Если имеется несколько доменов, можно добавить один экземпляр этого приложения из коллекции приложений Azure AD для каждого домена Active Directory, в котором требуется подготовка.

* **Подготовка Workday в Azure AD** — так как AAD Connect представляет собой инструмент, который должен использоваться для синхронизации пользователей Active Directory с Azure Active Directory, это приложение можно применять для упрощения подготовки только облачных пользователей из Workday в одном клиенте Azure Active Directory.

* **Workday Writeback** — это приложение упрощает обратную запись электронных адресов пользователей из Azure Active Directory в Workday.

> [!TIP]
> Стандартное приложение Workday используется для настройки единого входа между Workday и Azure Active Directory. 

#### <a name="determine-workday-to-ad-user-attribute-mapping-and-transformations"></a>Определение трансформации и сопоставления атрибутов пользователей Workday и AD

Перед началом настройки подготовки пользователей для домена Active Directory ответьте на приведенные ниже вопросы. Ответы на эти вопросы определяют, как необходимо задать фильтры области и атрибуты сопоставления.

* **Каких пользователей в Workday нужно подготовить в этот лес Active Directory?**

   * *Пример. Пользователи, у которых атрибут "Company" Workday содержит значение "Contoso", а атрибут "Worker_Type" — "Regular"*.

* **Каким образом пользователи направляются в разные подразделения организации (OU)?**

   * *Пример. Пользователи направляются в подразделения, соответствующие расположению офиса, как определено в атрибутах "Municipality" и "Country_Region_Reference" Workday*.

* **Как необходимо заполнить следующие атрибуты в Active Directory?**

   * Общее имя (cn)
      * *Пример. Используйте значение User_ID Workday, задаваемое отделом кадров*.
      
   * Идентификатор сотрудника (employeeId)
      * *Пример. Используйте значение Worker_ID Workday*.
      
   * Имя учетной записи SAM (sAMAccountName)
      * *Пример. Используйте значение User_ID Workday, отфильтрованное с помощью выражения подготовки Azure AD для удаления недопустимых символов*.
      
   * Имя участника-пользователя (userPrincipalName)
      * *Пример. Используйте значение User_ID Workday с выражением подготовки Azure AD для добавления доменного имени*.

* **Каким образом необходимо сопоставить пользователей Workday и Active Directory?**

  * *Пример. Пользователи с определенным значением "Worker_ID" Workday сопоставляются с пользователями Active Directory, у которых "employeeID" имеет то же значение. Если значение Worker_ID не найдено в Active Directory, создайте пользователя.*
  
* **Содержит ли лес Active Directory идентификаторы пользователей, необходимые для работы логики сопоставления?**

  * *Пример. Если это новое развертывание Workday, мы настоятельно рекомендуем предварительно заполнить Active Directory правильными значениями Worker_ID Workday (или значением выбранного уникального идентификатора) с целью максимального упрощения логики сопоставления.*



В оставшихся разделах этого руководства рассматриваются процедуры установки и настройки этих специальных приложений соединителей подготовки. Выбор приложений, которые требуется настроить, будет зависеть от того, в каких системах необходимо выполнить подготовку и сколько доменов Active Directory и клиентов Azure AD находится в вашей среде.



## <a name="configure-integration-system-user-in-workday"></a>Настройка пользователя системы интеграции в Workday

Общее требование всех соединителей подготовки Workday состоит в том, что для подключения к API отдела кадров Workday необходимы учетные данные для учетной записи системной интеграции Workday. В этом разделе описывается создание пользователя системы интеграции в Workday.

> [!NOTE]
> Эту процедуру можно обойти и использовать учетную запись глобального администратора Workday в качестве учетной записи системной интеграции. Такой вариант подойдет для демонстраций, но не рекомендуется для рабочих развертываний.

### <a name="create-an-integration-system-user"></a>Создание пользователя системы интеграции

**Создание пользователя системы интеграции:**

1. Войдите в клиент Workday с помощью учетной записи администратора. В области **Workday Application** введите в поле поиска "create user", а затем щелкните ссылку **Create Integration System User** (Создать пользователя системы интеграции).

    ![Создание пользователя](./media/workday-inbound-tutorial/wd_isu_01.png "Создание пользователя")
2. Завершите задачу **Создание пользователя системы интеграции** , указав имя пользователя и пароль для нового пользователя системы интеграции.  
 * Не устанавливайте флажок **Require New Password at Next Sign In** (Запросить новый пароль при следующем входе), так как этот пользователь будет осуществлять вход в систему программными средствами.
 * Для параметра **Session Timeout Minutes** (Время ожидания сеанса в минутах) оставьте значение по умолчанию 0, что не позволит сеансам пользователя завершаться раньше времени.
 * Выберите параметр **Do Not Allow UI Sessions** (Не разрешать сеансы пользовательского интерфейса), так как он предоставляет пользователю пароль системы интеграции при входе в Workday. 

    ![Создание пользователя системы интеграции](./media/workday-inbound-tutorial/wd_isu_02.png "Создание пользователя системы интеграции")

### <a name="create-a-security-group"></a>Создание группы безопасности
На этом этапе вы создадите неограниченную группу безопасности системы интеграции в Workday и назначите этой группе систему интеграции, созданную пользователем на предыдущем этапе.

**Создание группы безопасности:**

1. Введите в поле поиска текст "создать группу безопасности", а затем щелкните **Создать группу безопасности**.

    ![Создание группы безопасности](./media/workday-inbound-tutorial/wd_isu_03.png "Создание группы безопасности")
2. Завершите задачу **создания группы безопасности**.  
   * Выберите **Integration System Security Group (Unconstrained)** (Группа безопасности системы интеграции без ограничений) в раскрывающемся списке **Type of Tenanted Security Group** (Тип клиентский группы безопасности).

    ![Создание группы безопасности](./media/workday-inbound-tutorial/wd_isu_04.png "Создание группы безопасности")

3. После успешного создания группы безопасности вы увидите страницу, где можно назначать участников группе безопасности. Добавьте в эту группу безопасности нового пользователя системы интеграции и выберите соответствующую область организации.
![Изменение группы безопасности](./media/workday-inbound-tutorial/wd_isu_05.png "Изменение группы безопасности")
 
### <a name="configure-domain-security-policy-permissions"></a>Настройка разрешений политики безопасности домена
На этом этапе вы предоставите группе безопасности разрешения политики "безопасности домена" для данных рабочей роли.

**Настройка разрешений политики безопасности домена:**

1. В поле поиска введите **Domain Security Configuration**, а затем перейдите по ссылке **Domain Security Configuration Report** (Отчет о конфигурации безопасности домена).  

    ![Политики безопасности домена](./media/workday-inbound-tutorial/wd_isu_06.png "Политики безопасности домена")  
2. С помощью текстового поля **Domain** (Домен) найдите указанные ниже домены и добавьте их к фильтру по одному.  
   * *External Account Provisioning* (Подготовка внешних учетных записей)
   * *Worker Data: Public Worker Reports* (Данные о работниках: общедоступные отчеты о работниках)
   * *Person Data: Work Contact Information* (Данные о людях: рабочие контактные данные)
   * *Worker Data: All Positions* (Данные о работниках: все должности)
   * *Worker Data: Current Staffing Information* (Данные о работниках: сведения о текущем персонале)
   * *Worker Data: Business Title on Worker Profile* (Данные о работниках: рабочая должность в профиле работника)
 
    ![Политики безопасности домена](./media/workday-inbound-tutorial/wd_isu_07.png "Политики безопасности домена")  

    ![Политики безопасности домена](./media/workday-inbound-tutorial/wd_isu_08.png "Политики безопасности домена") 

    Последовательно выберите **ОК**.

3. В открывшемся отчете нажмите многоточие (...) рядом с элементом **External Account Provisioning** и выберите пункт меню **Domain -> Edit Security Policy Permissions** (Домен -> Изменить разрешения политики безопасности).

    ![Политики безопасности домена](./media/workday-inbound-tutorial/wd_isu_09.png "Политики безопасности домена")  

4. Прокрутите страницу **Edit Domain Security Policy Permissions** (Изменение разрешений политики безопасности для домена) до раздела **Integration Permissions** (Разрешения интеграции). Нажмите значок "+", чтобы добавить группу системы интеграции в список групп безопасности с разрешениями интеграции **Get** и **Put**.

    ![Изменение разрешения](./media/workday-inbound-tutorial/wd_isu_10.png "Изменение разрешения")  

5. Нажмите значок "+", чтобы добавить группу системы интеграции в список групп безопасности с разрешениями интеграции **Get** и **Put**.

    ![Изменение разрешения](./media/workday-inbound-tutorial/wd_isu_11.png "Изменение разрешения")  

6. Повторите указанные выше этапы 3–5 для каждой из оставшихся политик безопасности:

   | Операция | Политика безопасности домена |
   | ---------- | ---------- | 
   | Get и Put | Worker Data: Public Worker Reports (Данные о работниках: общедоступные отчеты о работниках) |
   | Get и Put | Person Data: Work Contact Information (Данные о людях: рабочие контактные данные) |
   | Получить | Worker Data: All Positions (Данные о работниках: все должности) |
   | Получить | Worker Data: Current Staffing Information (Данные о работниках: сведения о текущем персонале) |
   | Получить | Worker Data: Business Title on Worker Profile (Данные о работниках: рабочая должность в профиле работника) |

### <a name="configure-business-process-security-policy-permissions"></a>Настройка разрешений политики безопасности для бизнес-процессов
На этом этапе вы предоставите группе безопасности разрешения политики безопасности бизнес-процессов для данных рабочей роли. Это необходимо для настройки соединителя приложения обратной записи Workday. 

**Настройка разрешений политики безопасности для бизнес-процессов:**

1. Введите **Business Process Policy** в поле поиска и выберите задачу **Edit Business Process Security Policy** (Изменение политики безопасности бизнес-процессов).  

    ![Политики безопасности бизнес-процессов](./media/workday-inbound-tutorial/wd_isu_12.png "Политики безопасности бизнес-процессов")  

2. В текстовом поле **Business Process Type** (Тип бизнес-процесса) выполните поиск по запросу *Contact*, выберите бизнес-процесс **Contact Change** (Изменение контакта) и нажмите кнопку **ОК**.

    ![Политики безопасности бизнес-процессов](./media/workday-inbound-tutorial/wd_isu_13.png "Политики безопасности бизнес-процессов")  

3. Прокрутите страницу **Edit Business Process Security Policy** (Изменение политики безопасности бизнес-процессов) до раздела **Maintain Contact Information (Web Service)** (Хранение контактных данных — веб-служба).

    ![Политики безопасности бизнес-процессов](./media/workday-inbound-tutorial/wd_isu_14.png "Политики безопасности бизнес-процессов")  

4. Выберите новую группу безопасности системы интеграции и добавьте ее в список групп безопасности, которая может инициировать запрос к веб-службам. Нажмите кнопку **Готово**. 

    ![Политики безопасности бизнес-процессов](./media/workday-inbound-tutorial/wd_isu_15.png "Политики безопасности бизнес-процессов")  

 
### <a name="activate-security-policy-changes"></a>Активация изменений политики безопасности

**Активация изменений политики безопасности:**

1. Введите "активировать" в поле поиска и затем нажмите ссылку **Активировать ожидающие изменения политики безопасности**.

    ![Активация](./media/workday-inbound-tutorial/wd_isu_16.png "Активация") 
2. Начните выполнять задачу активации ожидающих изменений политики безопасности: введите комментарий для проведения аудита и нажмите кнопку **ОК**. 

    ![Активация ожидающих изменений безопасности](./media/workday-inbound-tutorial/wd_isu_17.png "Активация ожидающих изменений безопасности")  
1. Завершите задачу на следующем экране, установив флажок **Confirm** (Подтверждаю) и нажав кнопку **ОК**.

    ![Активация ожидающих изменений безопасности](./media/workday-inbound-tutorial/wd_isu_18.png "Активация ожидающих изменений безопасности")  

## <a name="configuring-user-provisioning-from-workday-to-active-directory"></a>Настройка подготовки пользователей из Workday в Active Directory

Следуйте этим инструкциям по настройке подготовки учетной записи пользователя из Workday в каждом домене Active Directory в области интеграции.

### <a name="part-1-install-and-configure-on-premises-provisioning-agents"></a>Часть 1. Установка и настройка локальных агентов подготовки

Чтобы подготовить локальную службу Active Directory, необходимо установить агент на сервере с .NET 4.7+ Framework и сетевым доступом к нужным доменам Active Directory.

> [!TIP]
> Вы можете проверить версию платформы .NET на вашем сервере, воспользовавшись представленными [здесь](https://docs.microsoft.com/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed) инструкциями.
> Если на сервере не установлена платформа .NET 4.7 или более поздней версии, вы можете скачать ее [здесь](https://support.microsoft.com/help/3186497/the-net-framework-4-7-offline-installer-for-windows).  

Развернув .NET 4.7+, вы можете скачать **[локальный агент подготовки здесь](https://go.microsoft.com/fwlink/?linkid=847801)** и выполнить указанные ниже действия, чтобы завершить настройку агента.

1. Войдите на сервер Windows, где требуется установить новый агент.
2. Запустите установщик агента подготовки, примите условия и нажмите кнопку **Install** (Установить).
![Экран установки](./media/workday-inbound-tutorial/pa_install_screen_1.png "Экран установки")

3. По завершении установки запустится мастер, и вы увидите экран **Connect Azure AD** (Подключение Azure AD). Нажмите кнопку **Authenticate** (Проверка подлинности), чтобы подключиться к экземпляру Azure AD.
![Подключение Azure AD](./media/workday-inbound-tutorial/pa_install_screen_2.png "Подключение Azure AD")

4. Пройдите проверку подлинности в экземпляре Azure AD, используя учетные данные глобального администратора. 
![Проверка подлинности администратора](./media/workday-inbound-tutorial/pa_install_screen_3.png "Проверка подлинности администратора")

5. После успешной проверки подлинности в Azure AD вы увидите экран **Connect Active Directory** (Подключение Active Directory). Теперь введите доменное имя AD и нажмите кнопку **Add Directory** (Добавить каталог).
![Добавление каталога](./media/workday-inbound-tutorial/pa_install_screen_4.png "Добавление каталога")

6. Вам будет предложено ввести учетные данные, необходимые для подключения к домену AD. На том же экране можно использовать команду **Select domain controller priority** (Выбрать приоритет контроллеров домена), чтобы указать контроллеры домена, которые агент должен использовать для отправки запросов на подготовку.
![Учетные данные домена](./media/workday-inbound-tutorial/pa_install_screen_5.png "Учетные данные домена")

7. После настройки домена установщик выводит список настроенных доменов. На этом экране можно повторить действия 5 и 6, чтобы добавить другие домены, или нажать кнопку **Next** (Далее), чтобы перейти к регистрации агента. 
![Настроенные домены](./media/workday-inbound-tutorial/pa_install_screen_6.png "Настроенные домены")

   > [!NOTE]
   > Если у вас несколько доменов AD (например, na.contoso.com, emea.contoso.com), добавляйте домены в список по отдельности. Просто добавить родительский домен (например, contoso.com) недостаточно. Рекомендуем зарегистрировать каждый дочерний домен с агентом. 

8. Просмотрите данные конфигурации и нажмите кнопку **Confirm** (Подтвердить), чтобы зарегистрировать агент. 
![Экран подтверждения](./media/workday-inbound-tutorial/pa_install_screen_7.png "Экран подтверждения")

9. В мастере настройки отображается ход регистрации агента.
![Регистрация агента](./media/workday-inbound-tutorial/pa_install_screen_8.png "Регистрация агента")

10. После успешной регистрации агента вы можете нажать кнопку **Exit** (Выход), чтобы выйти из мастера. 
![Экран выхода](./media/workday-inbound-tutorial/pa_install_screen_9.png "Экран выхода")

11. Проверьте установку агента и убедитесь, что он работает, открыв оснастку "Services" (Службы) и обнаружив службу "Microsoft Azure AD Connect Provisioning Agent" ![Services (Службы)](./media/workday-inbound-tutorial/services.png)  


**Устранение неполадок агента**

[Журнал событий Windows](https://technet.microsoft.com/library/cc722404(v=ws.11).aspx) на компьютере Windows Server с агентом содержит события всех операций, выполняемых агентом. Чтобы просмотреть эти события:
    
1. Откройте файл **Eventvwr.msc**.
2. Выберите **Журналы Windows > Приложение**.
3. Просмотрите все события, зарегистрированные для источника **AAD.Connect.ProvisioningAgent**. 
4. Проверьте наличие ошибок и предупреждений.

    
### <a name="part-2-adding-the-provisioning-connector-app-and-creating-the-connection-to-workday"></a>Часть 2. Добавление приложения соединителя подготовки и создание подключения к Workday

**Настройка подготовки Workday в Active Directory.**

1.  Перейдите на сайт <https://portal.azure.com>.

2.  В области навигации слева выберите **Azure Active Directory**.

3.  Щелкните **Корпоративные приложения**, а затем — **Все приложения**.

4.  Выберите **Добавить приложение** и выберите категорию **Все**.

5.  Выполните поиск по условию **Подготовка Workday в Active Directory** и добавьте это приложение из коллекции.

6.  После добавления приложения и отображения экрана сведений о приложений выберите **Подготовка**.

7.  Для параметра **Режим подготовки** **к работе** выберите значение **Автоматически**.

8.  В разделе **Учетные данные администратора** заполните поля следующим образом.

   * **Имя пользователя администратора** — введите имя пользователя учетной записи системы интеграции Workday с указанием имени домена клиента. **Оно должно иметь примерно следующий вид: username@contoso4**

   * **Пароль администратора** — введите пароль учетной записи системы интеграции Workday.

   * **URL-адрес клиента** — введите URL-адрес конечной точки веб-служб Workday для вашего клиента. Он должен иметь следующий вид: https://wd3-impl-services1.workday.com/ccx/service/contoso4/Human_Resources, где contoso4 заменяется правильным именем клиента, а wd3-impl — правильной строкой среды.

   * **Лес Active Directory** — имя домена Active Directory, зарегистрированное в агенте. Как правило, это строка вида: *contoso.com*

   * **Контейнер Active Directory** — выберите различающееся имя контейнера, в котором агент должен по умолчанию создавать учетные записи пользователей. 
        Пример: *OU=Standard Users,OU=Users,DC=contoso,DC=test*
> [!NOTE]
> Этот параметр используется только при создании учетных записей, если в сопоставлениях атрибутов не настроен атрибут *parentDistinguishedName*. Этот параметр не используется для операций обновления и поиска пользователей. Областью действия операции поиска является все дочернее дерево домена.
   * **Адрес электронной почты для уведомлений** — введите адрес электронной почты и установите флажок "send email if failure occurs" (Отправлять по электронной почте в случае сбоя).
> [!NOTE]
> Служба подготовки Azure AD отправляет уведомление по электронной почте, если задание подготовки переходит в состояние [Карантин](https://docs.microsoft.com/azure/active-directory/manage-apps/user-provisioning#quarantine).

   * Нажмите кнопку **Проверить подключение**. Если проверка подключения выполнена успешно, нажмите кнопку **Сохранить** в верхней части. В случае неудачи убедитесь, что учетные данные Workday и AD, заданные в настройках агента, действительны.

![Портал Azure](./media/workday-inbound-tutorial/wd_1.png)

### <a name="part-2-configure-attribute-mappings"></a>Часть 2. Настройка сопоставлений атрибутов 

В этом разделе вы настроите потоки данных пользователя из Workday в Active Directory.

1.  На вкладке "Подготовка" в разделе **Сопоставления** щелкните **Synchronize Workday Workers to OnPremises** (Синхронизировать работников Workday с локальной средой).

2.  В поле **Область исходного объекта** можно выбрать, какие наборы пользователей в Workday должны учитываться при подготовке в AD, определив набор фильтров на основе атрибутов. Область по умолчанию — "Все пользователи в Workday". Примеры фильтров

   * Пример: Охват пользователей с идентификаторами рабочих ролей в диапазоне от 1000000 до 2000000

      * Атрибут: WorkerID.

      * Оператор: REGEX MATCH.

      * Значение: (1[0–9][0–9][0–9][0–9][0–9][0–9]).

   * Пример: Только сотрудники, а не временные работники. 

      * Атрибут: EmployeeID

      * Оператор: IS NOT NULL.

3.  В поле **Действия с целевыми объектами** можно в глобальном масштабе отфильтровать, какие действия разрешены для выполнения в Active Directory. Самыми распространенными являются **создание** и **обновление**.

4.  В разделе **Сопоставление атрибутов** можно определить, как отдельные атрибуты Workday сопоставляются с атрибутами Active Directory.

5. Щелкните существующее сопоставление атрибута, чтобы его обновить, или **Добавить новое сопоставление** в нижней части экрана, чтобы добавить новые сопоставления. Отдельное сопоставление атрибутов поддерживает следующие свойства:

      * **Тип сопоставления**

         * **Прямой** — записывает значение атрибута Workday без изменений в атрибут AD.

         * **Константа** — записывает статическое постоянное строковое значение в атрибут AD.

         * **Выражение** — позволяет записывать пользовательское значение в атрибут AD на основании одного или нескольких атрибутов Workday. [Дополнительные сведения см. в статье о выражениях](../manage-apps/functions-for-customizing-application-data.md).

      * **Исходный атрибут** — атрибут пользователя из Workday. Если нужный вам атрибут отсутствует, см. раздел [Настройка списка атрибутов пользователя Workday](#customizing-the-list-of-workday-user-attributes).

      * **Значение по умолчанию** — необязательно. Если исходный атрибут имеет пустое значение, сопоставление запишет это значение.
            В наиболее распространенной конфигурации это поле остается пустым.

      * **Целевой атрибут** — атрибут пользователя в Active Directory.

      * **Сопоставление объектов с помощью этого атрибута** — должно ли это сопоставление использоваться для уникальной идентификации пользователей между Workday и Active Directory. Как правило, оно задается в поле ИД работника для Workday, который обычно сопоставляется с одним из атрибутов ИД сотрудника в Active Directory.

      * **Приоритет сопоставления** — возможность указания нескольких атрибутов сопоставления. При указании нескольких атрибутов сопоставления они вычисляются в порядке, заданном в этом поле. Как только соответствие найдено, дальнейшие атрибуты сопоставления не вычисляются.

      * **Применить это сопоставление**
       
         * **Всегда** — применить это сопоставление как при создании, так и при обновлении пользователей

         * **Только при создании** — применить это сопоставление только при создании пользователей

6. Чтобы сохранить сопоставления, щелкните **Сохранить** в верхней части раздела "Сопоставление атрибутов".

![Портал Azure](./media/workday-inbound-tutorial/WD_2.PNG)

**Ниже приведено несколько примеров сопоставлений атрибутов между Workday и Active Directory с некоторыми общими выражениями**.

-   Выражение, которое сопоставляется с атрибутом parentDistinguishedName, используется для подготовки пользователей для разных подразделений на основе одного или нескольких исходных атрибутов Workday. В этом примере пользователи помещаются в разные подразделения в зависимости от города, в котором они находятся.

-   Атрибут userPrincipalName в Active Directory создается путем объединения идентификатора пользователя Workday с суффиксом домена.

-   [Документацию о написании выражений см. здесь](../manage-apps/functions-for-customizing-application-data.md). Сюда входят примеры, демонстрирующие удаление специальных символов.

  
| АТРИБУТ WORKDAY | АТРИБУТ ACTIVE DIRECTORY |  ИДЕНТИФИКАТОР СОПОСТАВЛЕНИЯ? | СОЗДАНИЕ ИЛИ ОБНОВЛЕНИЕ |
| ---------- | ---------- | ---------- | ---------- |
| **WorkerID**  |  EmployeeID | **Да** | Записывается только при создании |
| **UserID**    |  cn    |   |   Записывается только при создании |
| **Join("@", [UserID], "contoso.com")**   | userPrincipalName     |     | Записывается только при создании 
| **Replace(Mid(Replace(\[UserID\], , "(\[\\\\/\\\\\\\\\\\\\[\\\\\]\\\\:\\\\;\\\\|\\\\=\\\\,\\\\+\\\\\*\\\\?\\\\&lt;\\\\&gt;\])", , "", , ), 1, 20), , "([\\\\.)\*\$](file:///\\.)*$)", , "", , )**      |    sAMAccountName            |     |         Записывается только при создании |
| **Switch(\[Active\], , "0", "True", "1", "False")** |  accountDisabled      |     | Создание и обновление |
| **FirstName**   | givenName       |     |    Создание и обновление |
| **LastName**   |   sn   |     |  Создание и обновление |
| **PreferredNameData**  |  displayName |     |   Создание и обновление |
| **Company**         | company   |     |  Создание и обновление |
| **SupervisoryOrganization**  | department  |     |  Создание и обновление |
| **ManagerReference**   | manager  |     |  Создание и обновление |
| **BusinessTitle**   |  title     |     |  Создание и обновление | 
| **AddressLineData**    |  streetAddress  |     |   Создание и обновление |
| **Municipality**   |   l   |     | Создание и обновление |
| **CountryReferenceTwoLetter**      |   co |     |   Создание и обновление |
| **CountryReferenceTwoLetter**    |  c  |     |         Создание и обновление |
| **CountryRegionReference** |  st     |     | Создание и обновление |
| **WorkSpaceReference** | physicalDeliveryOfficeName    |     |  Создание и обновление |
| **PostalCode**  |   postalCode  |     | Создание и обновление |
| **PrimaryWorkTelephone**  |  TelephoneNumber   |     | Создание и обновление |
| **Fax**      | facsimileTelephoneNumber     |     |    Создание и обновление |
| **Mobile**  |    mobile       |     |       Создание и обновление |
| **LocalReference** |  preferredLanguage  |     |  Создание и обновление |                                               
| **Switch(\[Municipality\], "OU=Standard Users,OU=Users,OU=Default,OU=Locations,DC=contoso,DC=com", "Dallas", "OU=Standard Users,OU=Users,OU=Dallas,OU=Locations,DC=contoso,DC=com", "Austin", "OU=Standard Users,OU=Users,OU=Austin,OU=Locations,DC=contoso,DC=com", "Seattle", "OU=Standard Users,OU=Users,OU=Seattle,OU=Locations,DC=contoso,DC=com", “London", "OU=Standard Users,OU=Users,OU=London,OU=Locations,DC=contoso,DC=com")**  | parentDistinguishedName     |     |  Создание и обновление |
  


### <a name="part-4-start-the-service"></a>Часть 4. Запуск службы
После завершения частей 1–3 можно запустить службу подготовки на портале Azure.

1.  На вкладке **Подготовка** установите для параметра **Состояние подготовки** значение **Вкл**.

2. Выберите команду **Сохранить**.

3. Будет запущена начальная синхронизация, которая может длиться переменное число часов в зависимости от количества пользователей в Workday.

4. В любой момент можно проверить вкладку **Журналы аудита** на портале Azure, чтобы узнать, какие действия выполнила служба подготовки. В журналах аудита перечислены все отдельные события синхронизации, выполняемые службой подготовки, например, какие пользователи считываются из Workday и впоследствии будут добавлены или обновлены в Active Directory. **[Подробные инструкции о том, как читать журналы аудита, см. в руководстве об отчетах по подготовке](../manage-apps/check-status-user-account-provisioning.md)**.

1.  Проверьте [журнал событий Windows](https://technet.microsoft.com/library/cc722404(v=ws.11).aspx) на компьютере Windows Server с установленным агентом на наличие новых ошибок и предупреждений. Эти события можно просмотреть, запустив **Eventvwr.msc** на сервере и выбрав **Журналы Windows > Приложение**. Все сообщения, относящиеся к подготовке, записываются для источника **AADSyncAgent**.

6. После завершения на вкладке **Подготовка** будет создан сводный отчет аудита, как показано ниже.

![Портал Azure](./media/workday-inbound-tutorial/WD_3.PNG)


## <a name="configuring-user-provisioning-to-azure-active-directory"></a>Настройка подготовки пользователей в Active Directory
Настройка подготовки в Azure Active Directory будет зависеть от требований к подготовке, как описано в следующей таблице.

| Сценарий | Решение |
| -------- | -------- |
| **Необходимо подготовить пользователей в Active Directory и Azure AD** | Используйте **[AAD Connect](../hybrid/whatis-hybrid-identity.md)**. |
| **Необходимо подготовить пользователей только в Active Directory** | Используйте **[AAD Connect](../hybrid/whatis-hybrid-identity.md)**. |
| **Необходимо подготовить пользователей только в Azure AD (только в облаке)** | Используйте приложение **Подготовка Workday в Azure Active Directory** из коллекции приложений. |

Инструкции по настройке Azure AD Connect см. в [документации по Azure AD Connect](../hybrid/whatis-hybrid-identity.md).

В следующих разделах описана настройка подключения между Workday и Azure AD для подготовки только облачных пользователей.

> [!IMPORTANT]
> Выполните следующую процедуру только в том случае, если существуют только облачные пользователи, которых необходимо подготовить в Azure AD, а не в локальной службе Active Directory.

### <a name="part-1-adding-the-azure-ad-provisioning-connector-app-and-creating-the-connection-to-workday"></a>Часть 1. Добавление приложения соединителя подготовки Azure AD и создание подключения к Workday

**Настройка подготовки только облачных пользователей Workday в Azure Active Directory**

1.  Перейдите на сайт <https://portal.azure.com>.

2.  В области навигации слева выберите **Azure Active Directory**.

3.  Щелкните **Корпоративные приложения**, а затем — **Все приложения**.

4.  Выберите **Добавить приложение**, а затем выберите категорию **Все**.

5.  Выполните поиск по условию **Подготовка Workday в Azure AD** и добавьте это приложение из коллекции.

6.  После добавления приложения и отображения экрана сведений о приложений выберите **Подготовка**.

7.  Для параметра **Режим подготовки** **к работе** выберите значение **Автоматически**.

8.  В разделе **Учетные данные администратора** заполните поля следующим образом.

   * **Имя пользователя администратора** — введите имя пользователя учетной записи системы интеграции Workday с указанием имени домена клиента. Оно должно иметь примерно следующий вид: username@contoso4

   * **Пароль администратора** — введите пароль учетной записи системы интеграции Workday.

   * **URL-адрес клиента** — введите URL-адрес конечной точки веб-служб Workday для вашего клиента. Он должен иметь следующий вид: https://wd3-impl-services1.workday.com/ccx/service/contoso4/Human_Resources, где contoso4 заменяется правильным именем клиента, а wd3-impl — правильной строкой среды. Если этот URL-адрес неизвестен, свяжитесь с вашим партнером по интеграции Workday или представителем службы поддержки, чтобы определить правильный URL-адрес для использования.

   * **Адрес электронной почты для уведомлений** — введите адрес электронной почты и установите флажок "send email if failure occurs" (Отправлять по электронной почте в случае сбоя).

   * Нажмите кнопку **Проверить подключение**.

   * Если проверка подключения выполнена успешно, нажмите кнопку **Сохранить** в верхней части. В случае неудачи дважды проверьте правильность URL-адреса и учетных данных Workday в приложении Workday.

### <a name="part-2-configure-attribute-mappings"></a>Часть 2. Настройка сопоставлений атрибутов 

В этом разделе вы настроите потоки данных пользователя из Workday в Active Directory только для облачных пользователей.

1. На вкладке "Подготовка" в разделе **Сопоставления** щелкните **Синхронизировать работников с Azure AD**.

2. В поле **Область исходного объекта** можно выбрать, какие наборы пользователей в Workday должны учитываться при подготовке в Azure AD, определив набор фильтров на основе атрибутов. Область по умолчанию — "Все пользователи в Workday". Примеры фильтров

   * Пример: Охват пользователей с идентификаторами рабочих ролей в диапазоне от 1000000 до 2000000

      * Атрибут: WorkerID.

      * Оператор: REGEX MATCH.

      * Значение: (1[0–9][0–9][0–9][0–9][0–9][0–9]).

   * Пример: Только временные работники, а не сотрудники

      * Атрибут: ContingentID.

      * Оператор: IS NOT NULL.

3. В поле **Действия с целевыми объектами** можно в глобальном масштабе отфильтровать, какие действия разрешены для выполнения в Azure AD. Самыми распространенными являются **создание** и **обновление**.

4. В разделе **Сопоставление атрибутов** можно определить, как отдельные атрибуты Workday сопоставляются с атрибутами Active Directory.

5. Щелкните существующее сопоставление атрибута, чтобы его обновить, или **Добавить новое сопоставление** в нижней части экрана, чтобы добавить новые сопоставления. Отдельное сопоставление атрибутов поддерживает следующие свойства:

   * **Тип сопоставления**

      * **Прямой** — записывает значение атрибута Workday без изменений в атрибут AD.

      * **Константа** — записывает статическое постоянное строковое значение в атрибут AD.

      * **Выражение** — позволяет записывать пользовательское значение в атрибут AD на основании одного или нескольких атрибутов Workday. [Дополнительные сведения см. в статье о выражениях](../manage-apps/functions-for-customizing-application-data.md).

   * **Исходный атрибут** — атрибут пользователя из Workday. Если нужный вам атрибут отсутствует, см. раздел [Настройка списка атрибутов пользователя Workday](#customizing-the-list-of-workday-user-attributes).

   * **Значение по умолчанию** — необязательно. Если исходный атрибут имеет пустое значение, сопоставление запишет это значение.
            В наиболее распространенной конфигурации это поле остается пустым.

   * **Целевой атрибут** — атрибут пользователя в Azure AD.

   * **Сопоставление объектов с помощью этого атрибута** — должно ли это сопоставление использоваться для уникальной идентификации пользователей между Workday и Azure AD. Как правило, оно задается в поле ИД работника для Workday, который обычно сопоставляется с атрибутом ИД сотрудника (новым) или атрибутом расширения в Azure AD.

   * **Приоритет сопоставления** — возможность указания нескольких атрибутов сопоставления. При указании нескольких атрибутов сопоставления они вычисляются в порядке, заданном в этом поле. Как только соответствие найдено, дальнейшие атрибуты сопоставления не вычисляются.

   * **Применить это сопоставление**

     * **Всегда** — применить это сопоставление как при создании, так и при обновлении пользователей

     * **Только при создании** — применить это сопоставление только при создании пользователей

6. Чтобы сохранить сопоставления, щелкните **Сохранить** в верхней части раздела "Сопоставление атрибутов".

### <a name="part-3-start-the-service"></a>Часть 3. Запуск службы
После завершения частей 1–2 можно запустить службу подготовки.

1. На вкладке **Подготовка** установите для параметра **Состояние подготовки** значение **Вкл**.

2. Выберите команду **Сохранить**.

3. Будет запущена начальная синхронизация, которая может длиться переменное число часов в зависимости от количества пользователей в Workday.

4. Отдельные события синхронизации можно просмотреть на вкладке **Журналы аудита**. **[Подробные инструкции о том, как читать журналы аудита, см. в руководстве об отчетах по подготовке](../manage-apps/check-status-user-account-provisioning.md)**.

5. После завершения на вкладке **Подготовка** будет создан сводный отчет аудита, как показано ниже.

## <a name="configuring-writeback-of-email-addresses-to-workday"></a>Настройка обратной записи адресов электронной почты в Workday
Ниже приведены инструкции по настройке обратной записи адресов электронной почты пользователей из Azure Active Directory в Workday.

### <a name="part-1-adding-the-provisioning-connector-app-and-creating-the-connection-to-workday"></a>Часть 1. Добавление приложения соединителя подготовки и создание подключения к Workday

**Настройка соединителя обратной записи Workday:**

1. Перейдите на сайт <https://portal.azure.com>.

2. В области навигации слева выберите **Azure Active Directory**.

3. Щелкните **Корпоративные приложения**, а затем — **Все приложения**.

4. Выберите **Добавить приложение**, а затем выберите категорию **Все**.

5. Выполните поиск по условию **Обратная запись Workday** и добавьте это приложение из коллекции.

6. После добавления приложения и отображения экрана сведений о приложений выберите **Подготовка**.

7. Для параметра **Режим подготовки** **к работе** выберите значение **Автоматически**.

8. В разделе **Учетные данные администратора** заполните поля следующим образом.

   * **Имя пользователя администратора** — введите имя пользователя учетной записи системы интеграции Workday с указанием имени домена клиента. Оно должно иметь примерно следующий вид: username@contoso4

   * **Пароль администратора** — введите пароль учетной записи системы интеграции Workday.

   * **URL-адрес клиента** — введите URL-адрес конечной точки веб-служб Workday для вашего клиента. Он должен иметь следующий вид: https://wd3-impl-services1.workday.com/ccx/service/contoso4/Human_Resources, где contoso4 заменяется правильным именем клиента, а wd3-impl — правильной строкой среды (если необходимо).

   * **Адрес электронной почты для уведомлений** — введите адрес электронной почты и установите флажок "send email if failure occurs" (Отправлять по электронной почте в случае сбоя).

   * Нажмите кнопку **Проверить подключение**. Если проверка подключения выполнена успешно, нажмите кнопку **Сохранить** в верхней части. В случае неудачи дважды проверьте правильность URL-адреса и учетных данных Workday в приложении Workday.

### <a name="part-2-configure-attribute-mappings"></a>Часть 2. Настройка сопоставлений атрибутов 

В этом разделе вы настроите потоки данных пользователя из Workday в Active Directory.

1. На вкладке "Подготовка" в разделе **Сопоставления** щелкните **Синхронизировать пользователей Azure AD с Workday**.

2. В поле **Область исходного объекта** при необходимости можно отфильтровать, для каких групп пользователей в Azure Active Directory нужно выполнить обратную запись адресов электронной почты в Workday. Область по умолчанию — "Все пользователи в Azure AD". 

3. В разделе **Сопоставление атрибутов**, обновите соответствующий идентификатор, чтобы указать атрибут в Azure Active Directory, где хранится идентификатор рабочей роли или идентификатор сотрудника для Workday. Распространенный метод сопоставления заключается в синхронизации ИД работника или ИД сотрудника Workday с extensionAttribute1-15 в Azure AD. Затем этот атрибут используется в Azure AD для обратного сопоставления пользователей в Workday. 

4. Чтобы сохранить сопоставления, щелкните **Сохранить** в верхней части раздела "Сопоставление атрибутов".

### <a name="part-3-start-the-service"></a>Часть 3. Запуск службы
После завершения частей 1–2 можно запустить службу подготовки.

1. На вкладке **Подготовка** установите для параметра **Состояние подготовки** значение **Вкл**.

2. Выберите команду **Сохранить**.

3. Будет запущена начальная синхронизация, которая может длиться переменное число часов в зависимости от количества пользователей в Workday.

4. Отдельные события синхронизации можно просмотреть на вкладке **Журналы аудита**. **[Подробные инструкции о том, как читать журналы аудита, см. в руководстве об отчетах по подготовке](../manage-apps/check-status-user-account-provisioning.md)**.

5. После завершения на вкладке **Подготовка** будет создан сводный отчет аудита, как показано ниже.

## <a name="customizing-the-list-of-workday-user-attributes"></a>Настройка списка атрибутов пользователя Workday
Подготовка приложений Workday для Active Directory и Azure AD включает стандартный список атрибутов пользователей Workday, которые вы можете выбирать. Но эти списки не являются исчерпывающими. Приложение Workday поддерживает сотни пользовательских атрибутов, которые могут быть стандартными или уникальными для клиента Workday. 

Служба подготовки Azure AD позволяет настроить список или атрибут Workday, чтобы включить все атрибуты, отображаемые в операции [Get_Workers](https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Get_Workers.html), в API Human Resources.

Для этого используйте [Workday Studio](https://community.workday.com/studio-download) для извлечения выражений XPath, представляющих атрибуты, которые вы хотите использовать. Затем добавьте их в конфигурацию подготовки с помощью расширенного редактора атрибутов на портале Azure.

**Чтобы получить выражение XPath для атрибута пользователя Workday, сделайте следующее:**

1. Скачайте и установите [Workday Studio](https://community.workday.com/studio-download). Вам потребуется учетная запись сообщества Workday для доступа к установщику.

2. Скачайте файл Workday Human_Resources.wdsl по этому URL-адресу: https://community.workday.com/sites/default/files/file-hosting/productionapi/Human_Resources/v21.1/Human_Resources.wsdl

3. Запустите Workday Studio.

4. На панели команд выберите **Workday > Test Web Service (Workday > Тестировать веб-службу) в параметре Tester (Тестер)**.

5. Щелкните **External** (Внешний) и выберите WSDL-файл Human_Resources, скачанный на шаге 2.

    ![Workday Studio](./media/workday-inbound-tutorial/wdstudio1.png)

6. Задайте для поля **Location** (Расположение) значение `https://IMPL-CC.workday.com/ccx/service/TENANT/Human_Resources`. Замените значение IMPL-CC фактическим типом экземпляра и значение TENANT (Клиент) реальным именем клиента.

7. Задайте для параметра **Operation** значение **Get_Workers**.

8.  Щелкните ссылку **configure** (Настроить) под областями Request/Response (Запрос/Ответ), чтобы задать учетные данные Workday. Установите флажок **Authentication** (Аутентификация), а затем введите имя пользователя и пароль учетной записи системы интеграции Workday. Имя пользователя должно иметь формат name@tenant. Оставьте флажок возле параметра **WS-Security UsernameToken**.

    ![Workday Studio](./media/workday-inbound-tutorial/wdstudio2.png)

9. Нажмите кнопку **ОК**.

10. В области **Request** (Запрос) вставьте XML-код, показанный ниже, и задайте для параметра **Employee_ID** идентификатор сотрудника реального пользователя в клиенте Workday. Выберите пользователя, у которого заполнен атрибут, который вы хотите извлечь.

    ```
    <?xml version="1.0" encoding="UTF-8"?>
    <env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="https://www.w3.org/2001/XMLSchema">
      <env:Body>
        <wd:Get_Workers_Request xmlns:wd="urn:com.workday/bsvc" wd:version="v21.1">
          <wd:Request_References wd:Skip_Non_Existing_Instances="true">
            <wd:Worker_Reference>
              <wd:ID wd:type="Employee_ID">21008</wd:ID>
            </wd:Worker_Reference>
          </wd:Request_References>
          <wd:Response_Group>
            <wd:Include_Reference>true</wd:Include_Reference>
            <wd:Include_Personal_Information>true</wd:Include_Personal_Information>
            <wd:Include_Employment_Information>true</wd:Include_Employment_Information>
            <wd:Include_Management_Chain_Data>true</wd:Include_Management_Chain_Data>
            <wd:Include_Organizations>true</wd:Include_Organizations>
            <wd:Include_Reference>true</wd:Include_Reference>
            <wd:Include_Transaction_Log_Data>true</wd:Include_Transaction_Log_Data>
            <wd:Include_Photo>true</wd:Include_Photo>
            <wd:Include_User_Account>true</wd:Include_User_Account>
            <wd:Include_Roles>true</wd:Include_Roles>
          </wd:Response_Group>
        </wd:Get_Workers_Request>
      </env:Body>
    </env:Envelope>
    ```
 
11. Нажмите кнопку **Send Request** (Отправить запрос) (с зеленой стрелкой), чтобы выполнить команду. Если команда выполнена успешно, ответ должен отображаться в области **Response** (Ответ). Убедитесь, что ответ содержит данные идентификатора пользователя, которые вы ввели, и не содержит ошибок.

12. Если команда выполнена успешно, скопируйте XML-код из области **Response** (Ответ) и сохраните его как XML-файл.

13. В командной строке Workday Studio последовательно выберите **File (Файл) > Open File (Открыть файл)** и откройте только что сохраненный XML-файл. Откроется в редакторе XML Workday Studio.

    ![Workday Studio](./media/workday-inbound-tutorial/wdstudio3.png)

14. В дереве файлов перейдите к файлу **/env: Envelope > env: Body > wd:Get_Workers_Response > wd:Response_Data > wd: Worker**, чтобы найти данные пользователя. 

15. В разделе **wd: Worker** найдите атрибут, который нужно добавить и выберите его.

16. Скопируйте выражение XPath для выбранного атрибута из поля **Document Path** (Путь к документу).

1. Удалите префикс **/env:Envelope/env:Body/wd:Get_Workers_Response/wd:Response_Data/** из скопированного выражения.

18. Если последний элемент в скопированном выражении является узлом (например, "/wd: Birth_Date"), тогда добавьте **/text()** в конце выражения. Это можно не делать, если последний элемент является атрибутом (например, "/@wd: type").

19. Результат должен выглядеть приблизительно так: `wd:Worker/wd:Worker_Data/wd:Personal_Data/wd:Birth_Date/text()`. Скопируйте его на портал Azure.


**Чтобы добавить настраиваемый атрибут пользователя Workday в конфигурацию подготовки, сделайте следующее:**

1. Откройте [портал Azure](https://portal.azure.com) и перейдите к разделу "Подготовка" приложения подготовки Workday, как описано ранее в этом руководстве.

2. Задайте для параметра **Состояние подготовки** значение **Выкл.** и нажмите кнопку **Сохранить**. После этих действий внесенные вами изменения вступят в силу, только когда вы закончите процедуру.

3. В разделе **Сопоставления** выберите **Локальная синхронизация сотрудников** или **Синхронизация сотрудников с Azure AD**.

4. Прокрутите вниз до следующего экрана и выберите **Показать расширенные параметры**.

5. Выберите ссылку **Изменить список атрибутов для Workday**.

    ![Workday Studio](./media/workday-inbound-tutorial/wdstudio_aad1.png)

6. Прокрутите страницу вниз до списка атрибутов, где находятся поля для заполнения.

7. В поле **Имя** введите отображаемое имя для атрибута.

8. В поле **Тип** выберите тип, соответствующий атрибуту (чаще всего это **строка**).

9. В поле **Выражение API** введите выражение XPath, скопированное из Workday Studio. Пример: `wd:Worker/wd:Worker_Data/wd:Personal_Data/wd:Birth_Date/text()`

10. Нажмите кнопку **Добавить атрибут**.

    ![Workday Studio](./media/workday-inbound-tutorial/wdstudio_aad2.png)

11. Нажмите кнопку **Сохранить** выше, а затем — **Да** в диалоговом окне. Закройте экран сопоставления атрибутов, если он еще открыт.

12. Вернитесь на вкладку **Подготовка**. Выберите **Локальная синхронизация сотрудников** или **Синхронизация сотрудников с Azure AD**.

13. Выберите **Добавить новое сопоставление**.

14. Новый атрибут должен появиться в **Атрибут источника**.

15. В случае необходимости добавьте сопоставление для нового атрибута.

16. В конце не забудьте задать для параметра **Состояние подготовки** значение **Вкл.** и сохранить это изменение.

## <a name="known-issues"></a>Известные проблемы

* Запись данных для атрибута пользователя thumbnailPhoto в локальном Active Directory в настоящее время не поддерживается.

* Соединитель "Workday в Azure AD" сейчас не поддерживается для клиентов Azure AD, в которіх включен AAD Connect.  

## <a name="managing-personal-data"></a>Управление персональными данными

Для решения подготовки Workday для Active Directory требуется, чтобы агент синхронизации был установлен на сервере, присоединенном к домену. Этот агент создает журналы в журнале событий Windows, который может содержать личные сведения.

## <a name="next-steps"></a>Дополнительная информация

* [Сведения о просмотре журналов и получении отчетов о действиях по подготовке](../manage-apps/check-status-user-account-provisioning.md)
* [Узнайте, как настроить единый вход Azure Active Directory в Workday](workday-tutorial.md).
* [Узнайте, как интегрировать другие приложения SaaS с Azure Active Directory](tutorial-list.md).

