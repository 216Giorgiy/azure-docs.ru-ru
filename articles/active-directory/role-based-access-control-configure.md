<properties
	pageTitle="Контроль доступа на основе ролей Azure Active Directory | Microsoft Azure"
	description="В этой статье описывается контроль доступа на основе ролей Azure."
	services="active-directory"
	documentationCenter=""
	authors="IHenkel"
	manager="stevenpo"
	editor=""/>

<tags
	ms.service="active-directory"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="identity"
	ms.date="12/04/2015"
	ms.author="inhenk"/>

# Контроль доступа на основе ролей Azure Active Directory

## Контроль доступа на основе ролей
Контроль доступа на основе ролей (RBAC) Azure обеспечивает точное управление доступом для Azure. С помощью RBAC вы можете распределить обязанности внутри команды разработчиков и предоставить пользователям доступ на том уровне, который им необходим для выполнения поставленных задач.

### Основы управления доступом в Azure
Каждая подписка Azure связана с Azure Active Directory. Только пользователям, группам и приложениям из этого каталога может быть предоставлен доступ к управлению ресурсами в подписке Azure с помощью классического портала Azure, программ командной строки Azure и API-интерфейсов управления Azure.

Доступ предоставляется путем назначения соответствующей роли RBAC пользователям, группам и приложениям в подходящей области. Чтобы предоставить доступ ко всей подписке, назначьте роль в области подписки. Чтобы предоставить доступ к определенной группе ресурсов в подписке, назначьте роль в области этой группы ресурсов. Вы также можете назначать роли на уровне определенных ресурсов, таких как веб-сайты, виртуальные машины и подсети, чтобы предоставить доступ только к отдельному ресурсу.

![](./media/role-based-access-control-configure/overview.png)

Роль RBAC, которую вы назначаете пользователям, группам и приложениям, определяет, какими именно ресурсами пользователь (или приложение) может управлять в этой области.

### Встроенные роли RBAC в Azure
Контроль доступа на основе ролей Azure имеет три основные роли, которые применяются ко всем типам ресурсов: владелец, участник и читатель. Владелец имеет полный доступ ко всем ресурсам, включая право делегировать доступ другим. Участник может создавать все типы ресурсов Azure и управлять ими, но не может предоставить доступ другим. Читатель может только просматривать существующие ресурсы Azure. Остальные роли RBAC в Azure разрешают управление определенными ресурсами Azure. Например, роль участника виртуальной машины разрешает создавать виртуальные машины и управлять ими, но не разрешает управлять виртуальной сетью или подсетью, к которой подключается виртуальная машина.

В разделе [Встроенные роли RBAC](role-based-access-built-in-roles.md) перечислены встроенные роли RBAC, доступные в Azure. Для каждой роли указаны операции, к которым встроенная роль предоставляет доступ.

### Иерархия ресурсов Azure и наследование прав доступа
Каждая подписка в Azure принадлежит только к одному каталогу, каждая группа ресурсов принадлежит только к одной подписке, а каждый ресурс принадлежит только к одной группе ресурсов. Доступ, предоставленный вами в родительской области, наследуется в дочерних областях. Если вы назначаете роль читателя группе Azure AD в области уровня подписки, члены этой группы смогут просматривать все группы ресурсов и все ресурсы в подписке. Если вы назначаете роль участника приложению в области группы ресурсов, оно сможет управлять всеми типами ресурсов в этой группе ресурсов, но не в других группах ресурсов в подписке.

### Сравнение Azure RBAC с классическими администраторами и соадминистраторами подписки
Классические администраторы и соадминистраторы подписки имеют полный доступ к подписке Azure. Они могут управлять ресурсами с помощью классического портала Azure (https://manage.windowsazure.com)) и интерфейсами API диспетчера служб Azure, а также портала Azure (https://portal.azure.com)) и новыми интерфейсами API диспетчера ресурсов Azure. В модели RBAC классическим администраторам назначается роль владельца в области подписки.

Специализированная модель авторизации (Azure RBAC) поддерживается только порталом Azure (https://portal.azure.com) и интерфейсами API диспетчера ресурсов Azure. Пользователи и приложения, которым назначены роли RBAC (в области подписки, группы ресурсов или отдельного ресурса), не могут использовать классический портал управления (http://manage.windowsazure.com) и API управления службами Azure.

### Предоставление прав на управление и операции с данными
Специализированная модель авторизации (Azure RBAC) поддерживается только классическим порталом Azure и интерфейсами API диспетчера ресурсов Azure для операций управления ресурсами Azure. С помощью RBAC можно разрешить доступ не ко всем операциям на уровне данных для ресурсов Azure. Например, с помощью RBAC можно управлять разрешениями на создание, чтение, обновление и удаление учетных записей хранения. Однако на сегодняшний день невозможно применять RBAC для управления разрешениями на создание, чтение, обновление и удаление BLOB-объектов или таблиц в учетной записи хранения. Аналогично с помощью RBAC можно управлять разрешениями на создание, чтение, обновление и удаление базы данных SQL, но не разрешениями на создание, чтение, обновление и удаление таблиц SQL в базе данных.

## Управление доступом с помощью классического портала Azure
### Просмотр доступа
Выберите параметры доступа в разделе "Основное" колонки группы ресурсов. Колонка **Пользователи** содержит список всех пользователей, групп и приложений, которым предоставлен доступ к группе ресурсов. Доступ либо назначается для группы ресурсов, либо наследуется от назначения в родительской подписке.

![](./media/role-based-access-control-configure/view-access.png)

> [AZURE.NOTE]Классические администраторы и соадминистраторы подписки являются действующими владельцами подписки в новой модели RBAC.

### Добавление доступа
1. Щелкните значок **Добавить** в столбце **Пользователи**. ![](./media/role-based-access-control-configure/grant-access1.png)
2. Выберите роль, которую хотите назначить.
3. Найдите и выберите пользователя, группу или приложение, которым хотите предоставить доступ.
4. Найдите каталог для пользователей, групп и приложений с помощью отображаемых имен, адресов электронной почты и идентификаторов объектов.![](./media/role-based-access-control-configure/grant-access2.png)

### Запрет доступа
1. В колонке **Пользователи** выберите назначение роли, которое нужно удалить.
2. Щелкните значок **Удалить** в колонке сведений о назначении.
3. Нажмите кнопку **Да** для подтверждения удаления.

![](./media/role-based-access-control-configure/remove-access1.png)


> [AZURE.NOTE]Унаследованные назначения нельзя удалить из дочерних областей. Для удаления таких назначений перейдите к родительской области.


![](./media/role-based-access-control-configure/remove-access2.png)

## Управление доступом с помощью Azure PowerShell
Доступом можно управлять с помощью команд Azure RBAC в средствах Azure PowerShell.

-	Используйте `Get-AzureRmRoleDefinition`, чтобы вывести список доступных для назначения ролей RBAC и просмотреть операции, к которым они предоставляют доступ.

-	Используйте `Get-AzureRmRoleAssignment`, чтобы вывести список назначений доступа RBAC, действующих в рамках указанной подписки, группы ресурсов или отдельного ресурса. Используйте параметр `ExpandPrincipalGroups`, чтобы вывести список назначений доступа для указанного пользователя, а также для групп, членом которых он является. Используйте параметр `IncludeClassicAdministrators`, чтобы вывести список классических администраторов и соадминистраторов подписки.

-	Используйте `New-AzureRmRoleAssignment`, чтобы предоставить доступ к пользователям, группам и приложениям.

-	Используйте `Remove-AzureRmRoleAssignment`, чтобы запретить доступ.

В разделе [Управление доступом с помощью Azure PowerShell](role-based-access-control-manage-access-powershell.md) приведены более подробные примеры управления доступом с помощью Azure PowerShell.

## Управление доступом с помощью интерфейса командной строки Azure
Доступом можно управлять с помощью команд Azure RBAC в интерфейсе командной строки Azure.

-	Используйте `azure role list`, чтобы вывести список доступных для назначения ролей RBAC. Используйте azure role show, чтобы просмотреть операции, к которым они предоставляют доступ.

-	Используйте `azure role assignment list`, чтобы вывести список назначений доступа RBAC, действующих для указанной подписки, группы ресурсов или отдельного ресурса. Используйте параметр `expandPrincipalGroups`, чтобы вывести список назначений доступа для указанного пользователя, а также для групп, членом которых он является. Используйте параметр `includeClassicAdministrators`, чтобы вывести список классических администраторов и соадминистраторов подписки.

-	Используйте `azure role assignment create` для предоставления доступа для пользователей, групп и приложений.

-	Используйте `azure role assignment delete` для запрета доступа.

В разделе [Управление доступом с помощью интерфейса командной строки Azure (Azure CLI)](role-based-access-control-manage-access-azure-cli.md) приведены более подробные примеры управления доступом с помощью Azure CLI.

## Использование отчета с журналом изменений доступа
Все изменения доступа, осуществляемые в ваших подписках Azure, регистрируются в журнале событий Azure.

### Создание отчета с помощью Azure PowerShell
Чтобы создать отчет о том, кто предоставил или запретил определенные типы доступа, для кого изменялся доступ и в какой области внутри ваших подписок Azure, используйте следующую команду PowerShell:

    `Get-AzureAuthorizationChangeLog`

### Создание отчета с помощью Azure CLI
Чтобы создать отчет о том, кто предоставил или запретил определенные типы доступа, для кого изменялся доступ и в какой области внутри ваших подписок Azure, используйте следующую команду интерфейса командной строки Azure:

    `azure authorization changelog`

> [AZURE.NOTE]Можно запрашивать изменения доступа за последние 90 дней (пакетами по 15 дней).

Следующая команда выводит список всех изменений доступа в рамках подписки за последние 7 дней.

![](./media/role-based-access-control-configure/access-change-history.png)

### Экспорт изменений доступа в электронную таблицу
Для просмотра изменений доступа их удобно экспортировать в электронную таблицу.

![](./media/role-based-access-control-configure/change-history-spreadsheet.png)

## Пользовательские роли в Azure RBAC
Если ни одна из стандартных ролей не соответствует вашим задачам, создайте в Azure RBAC пользовательскую роль. Пользовательские роли можно создавать с помощью средств RBAC для командной строки в Azure PowerShell или интерфейса командной строки Azure. Пользовательские роли, как и стандартные, могут назначаться пользователям, группам и приложениям в рамках подписки, группы ресурсов или области ресурсов.

Ниже приведен пример определения пользовательской роли, которая позволяет выполнять мониторинг и перезапуск виртуальных машин.

```
{
  "Name": "Virtual Machine Operator",
  "Id": "cadb4a5a-4e7a-47be-84db-05cad13b6769",
  "IsCustom": true,
  "Description": "Can monitor and restart virtual machines.",
  "Actions": [
    "Microsoft.Storage/*/read",
    "Microsoft.Network/*/read",
    "Microsoft.Compute/*/read",
    "Microsoft.Compute/virtualMachines/start/action",
    "Microsoft.Compute/virtualMachines/restart/action",
    "Microsoft.Authorization/*/read",
    "Microsoft.Resources/subscriptions/resourceGroups/read",
    "Microsoft.Insights/alertRules/*",
    "Microsoft.Insights/diagnosticSettings/*",
    "Microsoft.Support/*"
  ],
  "NotActions": [

  ],
  "AssignableScopes": [
    "/subscriptions/c276fc76-9cd4-44c9-99a7-4fd71546436e",
    "/subscriptions/e91d47c4-76f3-4271-a796-21b4ecfe3624",
    "/subscriptions/34370e90-ac4a-4bf9-821f-85eeedeae1a2"
  ]
}
```
### Действия
Свойство Actions пользовательской роли определяет операции Azure, к которым эта роль предоставляет доступ. Это коллекция строк операций, которые определяют защищенные действия поставщиков ресурсов Azure. Строки операций, содержащие подстановочные знаки (*), предоставляют доступ ко всем операциям, которые соответствуют определенной строке операции. Например:

-	строка `*/read` предоставляет доступ к операциям чтения для всех типов ресурсов для всех поставщиков ресурсов Azure;
-	строка `Microsoft.Network/*/read` предоставляет доступ к операциям чтения для всех типов ресурсов для поставщика ресурсов Microsoft.Network;
-	строка `Microsoft.Compute/virtualMachines/*` предоставляет доступ ко всем операциям виртуальных машин и их вложенных типов ресурсов;
-	строка `Microsoft.Web/sites/restart/Action` предоставляет доступ к перезапуску веб-сайтов.

С помощью команд `Get-AzureRmProviderOperation` или `azure provider operations show` вы можете получить список поставщиков ресурсов Azure. Кроме того, с помощью этих команд можно проверить, является ли строка операции допустимой, а также развернуть строки операций с подстановочными знаками.

![](./media/role-based-access-control-configure/1-get-azurermprovideroperation-1.png)

![](./media/role-based-access-control-configure/1-azure-provider-operations-show.png)

### Запрещенные действия
Если набор операций, которые вы хотите разрешить, удобнее выразить путем исключения определенных операций, а не путем перечисления всех допустимых операций, воспользуйтесь свойством **NotActions** пользовательской роли. Фактические права доступа, которые предоставляет пользовательская роль, реализуются путем исключения операций, определяемых свойством **NotActions** из списка операций, определяемых свойством Actions.

Обратите внимание, что пользователю одновременно могут быть назначены две роли: первая исключает определенную операцию с помощью свойства **NotActions**, а вторая предоставляет доступ к этой же операции. В таком случае пользователь будет иметь право на выполнение этой операции. Свойство **NotActions** не является запрещающим правилом. Это удобный способ создания набора допустимых операций путем исключения некоторых операций.

### AssignableScopes
Свойство **AssignableScopes** пользовательской роли определяет области (подписки, группы ресурсов или ресурсы), в которых эта пользовательская роль будет доступна для назначения пользователям, группам и приложениям. С помощью свойства **AssignableScopes** вы можете разрешить использование пользовательской роли только в тех подписках или группах ресурсов, в которых она действительно нужна. В остальных подписках и группах ресурсов она просто не будет отображаться для удобства пользователей. Свойство **AssignableScopes** пользовательской роли также определяет пользователей, которые могут просматривать, обновлять и удалять эту роль. Ниже приведены примеры допустимых назначаемых областей.

-	/subscriptions/c276fc76-9cd4-44c9-99a7-4fd71546436e и /subscriptions/e91d47c4-76f3-4271-a796-21b4ecfe3624 — определяют доступность роли для назначения в двух подписках.
-	/subscriptions/c276fc76-9cd4-44c9-99a7-4fd71546436e — определяет доступность роли для назначения в одной подписке.
-	/subscriptions/c276fc76-9cd4-44c9-99a7-4fd71546436e/resourceGroups/Network — определяет доступность роли для назначения только в группе ресурсов с именем Network.

### Управление доступом к пользовательским ролям
Свойство **AssignableScopes** пользовательской роли определяет пользователей с правом просматривать, изменять и удалять эту роль.

**Кто может создавать пользовательские роли?** Пользовательская роль будет создана, только если ее создатель имеет право создавать пользовательские роли для всех областей, определенных свойством **AssignableScopes**. Пользовательская роль будет создана, только если ее создатель имеет право выполнять операцию `Microsoft.Authorization/roleDefinition/write operation` для всех областей, определенных свойством **AssignableScopes** этой роли. Таким образом, создавать пользовательские роли для использования в подписках, группах ресурсов и отдельных ресурсах могут владельцы (и администраторы доступа пользователей) этих областей.

**Кто может изменять пользовательские роли?** Изменять пользовательские роли могут пользователи с правом обновлять пользовательские роли во всех областях, определенных свойством **AssignableScopes** этой роли. Изменять пользовательскую роль могут пользователи с правом выполнять операцию `Microsoft.Authorization/roleDefinition/write` во всех областях, определенных свойством **AssignableScopes** этой роли. Например, если пользовательская роль может назначаться в двух подписках Azure (т. е. две подписки определены свойством **AssignableScopes** этой роли), для изменения этой роли пользователь должен быть владельцем (или администратором доступа пользователя) двух этих подписок.

**Кто может просматривать список ролей, доступных для назначения в определенной области?** Просматривать роли RBAC, которые доступны для назначения в области, могут пользователи с правом выполнять операцию `Microsoft.Authorization/roleDefinition/read` для этой области. Все стандартные роли Azure RBAC позволяют просматривать список ролей, доступных для назначения.

<!---HONumber=AcomDC_1210_2015-->