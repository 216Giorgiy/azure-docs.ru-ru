---
title: "Дополнительные сведения об управлении паролями Azure Active Directory | Документация Майкрософт"
description: "Дополнительные разделы по управлению паролями Azure AD, включая принципы работы обратной записи паролей, безопасность обратной записи паролей, принципы работы портала сброса паролей и данные, которые используются при сбросе пароля."
services: active-directory
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
editor: curtand
ms.assetid: d3be2912-76c8-40a0-9507-b7b1a7ce2f8f
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/28/2017
ms.author: joflore
translationtype: Human Translation
ms.sourcegitcommit: 07635b0eb4650f0c30898ea1600697dacb33477c
ms.openlocfilehash: dca6f5189693fc98cec4f92eac81b6985e691889
ms.lasthandoff: 03/28/2017


---
# <a name="learn-more-about-password-management"></a>Дополнительные сведения об управлении паролями
> [!IMPORTANT]
> **Вы здесь потому, что возникают проблемы при входе?** Если это так, [с помощью этих инструкций можно изменить и сбросить пароль](active-directory-passwords-update-your-own-password.md#reset-your-password).
>
>

Если компонент управления паролями уже развернут или вы просто хотите узнать больше о технических деталях работы перед развертыванием, в этом разделе содержится хороший обзор основных технических концепций службы. Мы раскроем следующие темы:

* [**Как работает портал для сброса паролей**](#how-does-the-password-reset-portal-work)
* [**Обзор обратной записи паролей**](#password-writeback-overview)
 * [Как работает обратная запись паролей](#how-password-writeback-works)
* [**Сценарии, поддерживаемые компонентом обратной записи паролей**](#scenarios-supported-for-password-writeback)
 * [Поддерживаемые клиенты Azure AD Connect, Azure AD Sync и DirSync](#supported-clients)
 * [Лицензии, необходимые для компонента обратной записи паролей](#licenses-required-for-password-writeback)
 * [Локальные режимы проверки подлинности, поддерживаемые компонентом обратной записи паролей](#on-premises-authentication-modes-supported-for-password-writeback)
 * [Операции администрирования и операции пользователя, поддерживаемые компонентом обратной записи паролей](#user-and-admin-operations-supported-for-password-writeback)
 * [Операции администрирования и операции пользователя, не поддерживаемые компонентом обратной записи паролей](#user-and-admin-operations-not-supported-for-password-writeback)
* [**Модель безопасности компонента обратной записи паролей**](#password-writeback-security-model)
 * [Сведения о шифровании компонента обратной записи паролей](#password-writeback-encryption-details)
 * [Использование пропускной способности компонента обратной записи паролей](#password-writeback-bandwidth-usage)
* [**Развертывание данных для сброса пароля, управление ими и доступ к ним**](#deploying-managing-and-accessing-password-reset-data-for-your-users)
 * [Какие данные используются при сбросе пароля?](#what-data-is-used-by-password-reset)
 * [Сброс пароля без регистрации конечного пользователя](#deploying-password-reset-without-requiring-end-user-registration)
 * [Что происходит, когда пользователь регистрируется для сброса пароля?](#what-happens-when-a-user-registers)
 * [Получение доступа к данным для сброса паролей пользователей](#how-to-access-password-reset-data-for-your-users)
 * [Настройка данных для сброса пароля с помощью PowerShell](#setting-password-reset-data-with-powershell)
 * [Считывание данных для сброса паролей с помощью PowerShell](#reading-password-reset-data-with-powershell)
* [**Как работает сброс пароля для пользователей B2B**](#how-does-password-reset-work-for-b2b-users)

## <a name="how-does-the-password-reset-portal-work"></a>Как работает портал для сброса паролей
При переходе пользователя на портал сброса пароля запускается рабочий процесс, определяющий допустимость учетной записи пользователя, организацию, к которой принадлежит пользователь, место управления паролем этого пользователя, а также наличие у пользователя лицензии на использование данной функции.  Прочитайте описанные ниже шаги, чтобы узнать о логике страницы сброса пароля.

1. Пользователь открывает ссылку «Невозможно получить доступ к вашей учетной записи» или переходит непосредственно по адресу [https://passwordreset.microsoftonline.com](https://passwordreset.microsoftonline.com).
2. Пользователь вводит идентификатор пользователя и проходит тест CAPTCHA.
3. Azure AD проверяет, имеется ли у пользователя возможность использовать эту функцию, путем следующих действий:
   * Проверяет, включена ли данная функция у пользователя и назначена ли ему лицензия Azure AD.
     * Если у пользователя данная функция не включена или ему не назначена лицензия, пользователю предлагается обратиться к администратору для сброса своего пароля.
   * Проверяет наличие у пользователя нужных проверочных данных, определенных в его учетной записи в соответствии с политикой администратора.
     * Если политика требует только один запрос, то проверяется, определены ли у пользователя соответствующие данные по крайней мере для одной из проверок, включенных политикой администратора.
       * Если учетная запись не настроена, пользователю предлагается обратиться к администратору для сброса своего пароля.
     * Если политика требует два запроса, выполняется проверка наличия у пользователя соответствующих данных, определенных по крайней мере для двух проверок, включенных политикой администратора.
       * Если учетная запись не настроена, пользователю предлагается обратиться к администратору для сброса своего пароля.
   * Проверяет, управляется ли пароль пользователя локально (является ли он федеративным или для него включена синхронизация хэшей паролей).
     * Если развернута обратная запись, а управление паролем пользователя осуществляется локально, то пользователю разрешается продолжить проверку подлинности и сбросить свой пароль.
     * Если обратная запись не развернута, а управление паролем пользователя осуществляется локально, то пользователю предлагается обратиться к администратору для сброса своего пароля.
4. Если выяснилось, что пользователь может успешно сбросить свой пароль, ему выдаются указания по ходу процесса сброса.

Дополнительные сведения о развертывании обратной записи паролей см. в статье [Приступая к работе с компонентами управления паролями](active-directory-passwords-getting-started.md).

## <a name="password-writeback-overview"></a>Обзор обратной записи паролей
Обратная запись паролей — это компонент [Azure Active Directory Connect](connect/active-directory-aadconnect.md), который могут включить и использовать текущие подписчики Azure Active Directory Premium. Дополнительные сведения см. на странице со [сведениями о ценах на выпуски Azure Active Directory](active-directory-editions.md).

Обратная запись паролей позволяет настроить облачного клиента для записи паролей обратно в локальную службу Active Directory.  Это устраняет необходимость в настройке и управлении комплексным локальным решением по сбросу паролей в режиме самообслуживания, а также предоставляет пользователям удобный облачный способ сброса локальных паролей из любого места.  Ниже описаны некоторые ключевые функции обратной записи паролей:

* **Обратная связь с нулевой задержкой.**  Обратная запись паролей выполняется в синхронном режиме.  Пользователи немедленно получают уведомление, если пароль не соответствует политике или если его не удалось сбросить или изменить по любой причине.
* **Поддерживается сброс паролей для пользователей AD FS и других технологий федерации.**  С обратной записью паролей, при условии, что федеративные учетные записи пользователей синхронизируются в клиенте Azure AD, они смогут управлять локальными паролями AD из облака.
* **Поддерживается сброс паролей для пользователей, применяющих синхронизацию хэшей паролей.** Если служба сброса паролей обнаруживает, что для синхронизированной учетной записи пользователя включена синхронизация хэшей паролей, то локальный и облачный пароли для этой учетной записи сбрасываются одновременно.
* **Поддерживается изменение паролей с панели доступа и Office 365.**  При изменении просроченных или непросроченных паролей федеративными пользователями или пользователями с синхронизацией паролей эти пароли будут записываются обратно в локальную среду AD.
* **Поддерживается обратная запись паролей при их сбросе администратором на**[**портале управления Azure**](https://manage.windowsazure.com).  Каждый раз, когда администратор сбрасывает пароль пользователя на [портале управления Azure](https://manage.windowsazure.com), если этот пользователь является федеративным или для него включена синхронизация паролей, выбранный администратором пароль также будет устанавливаться в локальной службе AD.  В настоящее время это не поддерживается на портале администрирования Office.
* **Принудительно применяются политики паролей локальной службы AD.**  Когда пользователь сбрасывает свой пароль, перед его фиксацией в соответствующем каталоге выполняется проверка соблюдения политики локальной службы AD.  Это включает журнал, сложность, срок пользования, фильтры паролей и любые другие ограничения паролей, заданные в локальной службе AD.
* **Не требуется никаких входящих правил брандмауэра.**  Обратная запись паролей использует ретранслятор служебной шины Azure в качестве базового канала связи. Это означает, что для работы этой функции вам не нужно открывать какие-либо входящие порты в брандмауэре.
* **Не поддерживается для учетных записей пользователей, существующих в защищенных группах в локальной службе Active Directory.** Дополнительные сведения о защищенных группах см. в статье [Appendix C: Protected Accounts and Groups in Active Directory](https://technet.microsoft.com/library/dn535499.aspx) (Приложение В. Защищенные учетные записи и группы в Active Directory).

### <a name="how-password-writeback-works"></a>Как работает обратная запись паролей
Обратная запись паролей состоит из тех основных компонентов:

* Облачная служба сброса паролей (она также интегрирована в страницы смены пароля Azure AD)
* Ретранслятор служебной шины Azure для определенного клиента
* Локальная конечная точка сброса пароля

Вместе они работают так, как показано на схеме ниже:

  ![][001]

При сбросе или смене пароля в облаке федеративным пользователем или пользователем с синхронизацией хэшей происходит следующее:

1. Проверяется установленный у пользователя тип пароля.  Если этот пароль управляется локально, проверяется работа службы обратной записи.  Если служба работает, пользователю разрешается продолжить операцию; если нет, ему сообщается о том, что здесь нельзя сбросить его пароль.
2. Затем пользователь проходит соответствующие шлюзы проверки подлинности и достигает экрана сброса пароля.
3. Пользователь выбирает новый пароль и подтверждает его.
4. После нажатия кнопки «Отправить» указанный в виде простого текста пароль шифруется с помощью симметричного ключа, который был создан в процессе установки обратной записи.
5. После шифрования пароля он включается в полезные данные, которые передаются по каналу HTTPS на ретранслятор служебной шины для определенного клиента (который был также настроен в процессе установки обратной записи).  Этот ретранслятор защищается случайно генерируемым паролем, который известен только локальной установленной системе.
6. После того как сообщение достигает служебной шины, конечная точка сброса пароля автоматически активируется и обнаруживает ожидающий запрос на сброс.
7. Затем служба выполняет поиск нужного пользователя с помощью атрибута привязки облака.  Для успешного выполнения этого поиска объект пользователя должен существовать в пространстве соединителя AD, он должен быть привязан к соответствующему объекту MV, а также должен быть привязан к соответствующему объекту соединителя AAD. Наконец, для того чтобы в ходе синхронизации можно было найти эту учетную запись пользователя, в ссылке с объекта соединителя AD на MV должно быть правило синхронизации `Microsoft.InfromADUserAccountEnabled.xxx` .  Это необходимо, поскольку при вызове из облака обработчик синхронизации использует атрибут cloudAnchor для поиска объекта пространства соединителя AAD, затем возвращается по ссылке к объекту MV, после чего возвращается по ссылке к объекту AD. Так как для одного и того же пользователя может быть несколько объектов AD (несколько лесов), обработчик синхронизации полагается на ссылку `Microsoft.InfromADUserAccountEnabled.xxx` для выбора нужного из них. Обратите внимание, что в результате применения этой логики Azure AD Connect необходимо подключить к контроллеру основного домена, чтобы обеспечить работу компонента обратной записи паролей.  Если это необходимо сделать, можно настроить Azure AD Connect для использования эмулятора контроллера основного домена. Для этого щелкните правой кнопкой мыши **Свойства** для соединителя синхронизации Active Directory, а затем выберите **Configure directory partitions** (Настройка разделов каталога). Здесь найдите раздел **Параметры подключения контроллера домена** и установите флажок **Использовать только предпочитаемые контроллеры домена**. Примечание. Если предпочитаемый контроллер домена не является эмулятором основного контроллера домена, Azure AD Connect все равно будет связываться с основным контроллером домена для обратной записи паролей.
8. После нахождения учетной записи пользователя предпринимается попытка сброса пароля непосредственно в соответствующем лесу AD.
9. Если операция установки пароля прошла успешно, пользователь уведомляется о том, что его пароль изменен и он может продолжать работу.
10. В случае сбоя операции установки пароля пользователю возвращается ошибка и предлагается повторить попытку.  Операция может завершиться ошибкой из-за неработающей службы, из-за несоответствия выбранного пароля политикам организации, из-за того, что не удалось найти пользователя в локальной службе AD, или по множеству причин.  Для многих из таких случаем имеется конкретное сообщение, позволяющее указать пользователю на возможности для устранения проблемы.

## <a name="scenarios-supported-for-password-writeback"></a>Сценарии, поддерживаемые для обратной записи паролей
В разделе ниже описано, какие сценарии поддерживаются для каких версий наших возможностей синхронизации.  Как правило, мы всегда советуем использовать функцию автоматического обновления Azure AD Connect или установить последнюю версию [Azure AD Connect](connect/active-directory-aadconnect.md#install-azure-ad-connect), если требуется использовать компонент обратной записи паролей.

* [**Поддерживаемые клиенты Azure AD Connect, Azure AD Sync и DirSync**](#supported-clients)
* [**Лицензии, необходимые для компонента обратной записи паролей**](#licenses-required-for-password-writeback)
* [**Локальные режимы проверки подлинности, поддерживаемые компонентом обратной записи паролей**](#on-premises-authentication-modes-supported-for-password-writeback)
* [**Операции администрирования и операции пользователя, поддерживаемые компонентом обратной записи паролей**](#user-and-admin-operations-supported-for-password-writeback)
* [**Операции администрирования и операции пользователя, не поддерживаемые компонентом обратной записи паролей**](#user-and-admin-operations-not-supported-for-password-writeback)

### <a name="supported-clients"></a>Поддерживаемые клиенты
Мы всегда советуем использовать функцию автоматического обновления Azure AD Connect или установить последнюю версию [Azure AD Connect](connect/active-directory-aadconnect.md#install-azure-ad-connect), если требуется использовать компонент обратной записи паролей.

* **DirSync (все версии выше 1.0.6862)**  - _не поддерживается_. Поддерживает только базовые возможности обратной записи, и больше не поддерживается группой продуктов.
* **Azure AD Sync** -  (_устаревшая версия_). Поддерживает только базовые возможности обратной записи. Отсутствуют возможности разблокирования учетной записи, широкие возможности ведения журналов и улучшения надежности, внесенные в Azure AD Connect. Учитывая вышесказанное, мы **настоятельно** рекомендуем обновить этот компонент.
* **Azure AD Connect** -  _поддерживается полностью_. Поддерживает все возможности обратной записи. Чтобы получить лучшие новые возможности, а также обеспечить оптимальную надежность и стабильность работы, обновите этот компонент до последней версии.

### <a name="licenses-required-for-password-writeback"></a>Лицензии, необходимые для компонента обратной записи паролей
Чтобы использовать компонент обратной записи паролей, в клиенте должна быть назначена одна из приведенных ниже лицензий.

* **Azure AD Premium P1** — ограничения на использование компонента обратной записи паролей отсутствуют.
* **Azure AD Premium P2** — ограничения на использование компонента обратной записи паролей отсутствуют.
* **Enterprise Moblity Suite** — ограничения на использование компонента обратной записи паролей отсутствуют.
* **Enterprise Cloud Suite** — ограничения на использование компонента обратной записи паролей отсутствуют.

Компонент обратной записи паролей нельзя использовать с какими-либо планами лицензирования Office 365 независимо от того, платные они или пробные. Чтобы использовать эту возможность, обновите свой план до одной из указанных выше версий.

Мы не планируем включать компонент обратной записи паролей в какие-либо пакеты номеров SKU службы Office 365.

### <a name="on-premises-authentication-modes-supported-for-password-writeback"></a>Локальные режимы проверки подлинности, поддерживаемые компонентом обратной записи паролей
Компонент обратной записи паролей работает со следующими типами паролей пользователей:

* **Пользователи облака.** В этом случае обратная запись паролей не применяется, так как локальный пароль отсутствует.
* **Пользователи с синхронизацией паролей.** Компонент обратной записи паролей поддерживается.
* **Федеративные пользователи.** Компонент обратной записи паролей поддерживается.
* **Пользователи со сквозной проверкой подлинности.** Компонент обратной записи паролей поддерживается.

### <a name="user-and-admin-operations-supported-for-password-writeback"></a>Операции администрирования и операции пользователя, поддерживаемые компонентом обратной записи паролей
Обратная запись паролей осуществляется во всех следующих ситуациях.

* **Поддерживаемые операции конечных пользователей:**
 * все самостоятельные добровольные операции изменения пароля конечного пользователя;
 * все самостоятельные принудительные операции изменения пароля конечного пользователя (например, из-за окончания срока действия пароля);
 * все самостоятельные операции сброса пароля конечного пользователя, выполняемые на [портале сброса паролей](https://passwordreset.microsoftonline.com).
* **Поддерживаемые операции администрирования:**
 * все самостоятельные добровольные операции изменения пароля администратора;
 * все самостоятельные принудительные операции изменения пароля администратора (например, из-за окончания срока действия пароля);
 * все самостоятельные операции сброса пароля администратора, выполняемые на [портале сброса паролей](https://passwordreset.microsoftonline.com);
 * все операции сброса пароля конечного пользователя, инициируемые администратором на [классическом портале управления Azure](https://manage.windowsazure.com);
 * все операции сброса пароля конечного пользователя, инициируемые администратором на [портале Azure](https://portal.azure.com).

### <a name="user-and-admin-operations-not-supported-for-password-writeback"></a>Операции администрирования и операции пользователя, не поддерживаемые компонентом обратной записи паролей
Обратная запись паролей не осуществляется во всех следующих ситуациях.

* **Неподдерживаемые операции конечных пользователей:**
 * все операции сброса пароля конечного пользователя с помощью PowerShell V1 (V2) или API Graph Azure AD.
* **Неподдерживаемые операции администрирования:**
 * все операции сброса пароля конечного пользователя, инициируемые администратором на [портале управления Azure Office 365](https://portal.office.com);
 * все операции сброса пароля конечного пользователя, инициируемые администратором с помощью PowerShell V1 (V2) или API Graph Azure AD.

Хотя мы и работаем над устранением этих ограничений, но точное время пока указать не можем.

## <a name="password-writeback-security-model"></a>Модель безопасности обратной записи паролей
Обратная запись паролей — это служба с высоким уровнем безопасности и надежности.  Для обеспечения защиты информации мы реализуем четырехуровневую модель безопасности, описанную ниже.

* **Ретранслятор служебной шины для определенного клиента.** При настройке службы настраивается ретранслятор служебной шины для определенного клиента, который защищается случайно генерируемым надежным паролем. У корпорации Майкрософт нет доступа к этому паролю.
* **Заблокированный криптографически надежный ключ шифрования пароля.** После создания ретранслятора служебной шины создается надежный симметричный ключ, который используется для шифрования пароля при передаче по сети.  Этот ключ существует только в секретном хранилище компании, в облаке, которое тщательно блокируется и контролируется, подобно любому паролю в каталоге.
* **TLS отраслевого стандарта.** При выполнении сброса или изменения пароля в облаке мы берем пароль в виде простого текста и шифруем его, используя ваш открытый ключ.  Затем он вставляется в сообщение HTTPS, которое передается по зашифрованному каналу с использованием сертификатов SSL корпорации Майкрософт на ваш ретранслятор служебной шины.  После поступления сообщения в служебную шину ваш локальный агент активируется, проходит проверку подлинности в шине с использованием ранее созданного надежного пароля, забирает шифрованное сообщение, расшифровывает его с помощью созданного нами закрытого ключа, а затем пытается установить пароль посредством интерфейса AD DS SetPassword API.  Именно этот этап позволяет нам принудительно применять политику паролей вашей локальной службы AD (сложность, срок пользования, историю, фильтры и т. д.) в облаке.
* **Политики срока действия сообщений.** Наконец, если по какой-либо причине сообщение задержится в служебной шине из-за неработающей локальной службы, срок его ожидания истечет и оно будет удалено через несколько минут в целях дополнительного повышения безопасности.

### <a name="password-writeback-encryption-details"></a>Сведения о шифровании компонента обратной записи паролей
Ниже описаны этапы шифрования, выполняемые после отправки запроса на сброс пароля перед его поступлением в локальную среду. Шифрование обеспечивает максимальную надежность и защиту службы.

* **Этап 1. Шифрование пароля с использованием 2048-разрядного ключа RSA.** Когда пользователь отправляет пароль для обратной записи в локальную среду, сначала этот пароль шифруется с использованием 2048-разрядного ключа RSA.

* **Этап 2. Шифрование на уровне пакета с использованием алгоритма AES-GCM.** Далее весь пакет (пароль и необходимые метаданные) шифруется с использованием алгоритма AES-GCM. За счет этого пользователи с прямым доступом к базовому каналу служебной шины не могут просматривать и изменять содержимое.

* **Этап 3. Взаимодействие через канал SSL/TLS.** Кроме того, весь обмен данными со служебной шиной осуществляется через канал SSL/TLS. Это позволяет защитить содержимое от несанкционированного стороннего доступа.

* **Этап 4. Автоматическая смена ключей каждые 6 месяцев.** И наконец, автоматически каждые 6 месяцев или каждый раз после отключения и повторного включения компонента обратной записи паролей в Azure AD Connect мы выполняем смену этих ключей, чтобы обеспечить максимальную защиту службы.

### <a name="password-writeback-bandwidth-usage"></a>Использование пропускной способности компонента обратной записи паролей

Компонент обратной записи паролей — это служба с очень низкой пропускной способностью, которая отправляет запросы в локальный агент только при следующих условиях.

1. Два сообщения отправляются при включении или отключении компонента с помощью Azure AD Connect.
2. Одно сообщение отправляется каждые 5 минут как сигнал пульса службы, если служба запущена.
3. Два сообщения отправляются при каждой отправке нового пароля. Одно сообщение отправляется как запрос на выполнение операции, а следующее содержит результат этой операции. Эти сообщения отправляются при следующих обстоятельствах.
4. Во время каждой отправки нового пароля при самостоятельном сбросе пароля пользователем.
5. Во время каждой отправки нового пароля в ходе операции по смене пароля пользователя.
6. Во время каждой отправки нового пароля при сбросе пароля, инициированным администратором (только на портале администрирования Azure).

#### <a name="message-size-and-bandwidth-considerations"></a>Рекомендации по размеру сообщений и пропускной способности

Размер каждого сообщения обычно не превышает 1 КБ. Это означает, что даже при экстремальных нагрузках служба обратной записи паролей будет потреблять максимум несколько килобит в секунду. Каждое сообщение отправляется в режиме реального времени, только если этого требует операция обновления пароля. Размер сообщения настолько небольшой, что потребляемая компонентом обратной записи пропускная способность будет слишком незначительна, чтобы оказывать заметное влияние.

## <a name="deploying-managing-and-accessing-password-reset-data-for-your-users"></a>Развертывание данных для сброса пароля, управление ими и доступ к ним
Вы можете управлять данными для сброса паролей пользователей и получать к ним доступ через Azure AD Connect, PowerShell, Graph или после регистрации.  Кроме того, с помощью параметров, описанных ниже, вы даже можете сбросить пароли целой организации, не регистрируя для этого пользователей.

  * [Какие данные используются при сбросе пароля?](#what-data-is-used-by-password-reset)
  * [Сброс пароля без регистрации конечного пользователя](#deploying-password-reset-without-requiring-end-user-registration)
  * [Что происходит, когда пользователь регистрируется для сброса пароля?](#what-happens-when-a-user-registers)
  * [Получение доступа к данным для сброса паролей пользователей](#how-to-access-password-reset-data-for-your-users)
  * [Настройка данных для сброса пароля с помощью PowerShell](#setting-password-reset-data-with-powershell)
  * [Считывание данных для сброса паролей с помощью PowerShell](#reading-password-reset-data-with-powershell)

### <a name="what-data-is-used-by-password-reset"></a>Какие данные используются при сбросе пароля?
В следующей таблице показано, где и как эти данные используются при сбросе пароля. Это поможет решить, какие параметры проверки подлинности подходят для вашей организации. Также в таблице приведены правила форматирования для случаев, когда данные предоставляются от имени пользователей из входных путей, которые не выполняют проверку данных.

> [!NOTE]
> Рабочий телефон не отображается на портале регистрации, поскольку пользователи в настоящее время не могут изменять это свойство в каталоге. Только администраторы могут задать это значение.
>
>

<table>
          <tbody><tr>
            <td>
              <p>
                <strong>Название способа связи</strong>
              </p>
            </td>
            <td>
              <p>
                <strong>Элемент данных Active Directory</strong>
              </p>
            </td>
            <td>
              <p>
                <strong>Элемент данных Azure Active Directory</strong>
              </p>
            </td>
            <td>
              <p>
                <strong>Где используется / задается?</strong>
              </p>
            </td>
            <td>
              <p>
                <strong>Требования к формату</strong>
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p>Рабочий телефон</p>
            </td>
            <td>
              <p>TelephoneNumber</p>
              <p>Это свойство можно синхронизировать с атрибутом PhoneNumber в Azure Active Directory и использовать для сброса паролей, не выполняя перед этим регистрацию пользователей.</p>
            </td>
            <td>
              <p>PhoneNumber</p>
              <p>Например, Set-MsolUser -UserPrincipalName JWarner@contoso.com -PhoneNumber "+1 1234567890x1234"</p>
            </td>
            <td>
              <p>Используется в следующих местах:</p>
              <p>Портал сброса паролей</p>
              <p>Задается из следующих мест:</p>
              <p>PhoneNumber задается с помощью PowerShell, DirSync, портала управления Azure и портала администрирования Office</p>
            </td>
            <td>
              <p>+ccc xxxyyyzzzz (например, +1 1234567890)</p>
              <ul>
                <li class="unordered">
Необходимо указать код страны<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
Необходимо указать код региона (если применимо)<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
Необходимо указать знак + перед кодом страны<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
Необходимо указать пробел между кодом страны и остальной частью номера<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
Расширения не поддерживаются. Если вы указали какие-либо расширения, они будут удалены из номера перед диспетчеризацией телефонного вызова.<br><br></li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>
              <p>Мобильный телефон</p>
            </td>
            <td>
              <p>Мобильные приложения</p>
              <p>Это свойство можно синхронизировать с атрибутом MobilePhone в Azure Active Directory и использовать для сброса паролей, не выполняя перед этим регистрацию пользователей.</p>
              <p>Сейчас это свойство невозможно синхронизировать с AuthenticationPhone.</p>
            </td>
            <td>
              <p>AuthenticationPhone</p>
              <p>ИЛИ</p>
              <p>MobilePhone</p>
              <p>(AuthenticationPhone используется при наличии данных, иначе происходит возврат к полю мобильного телефона.)</p>
              <p>Например, Set-MsolUser -UserPrincipalName JWarner@contoso.com -MobilePhone "+1 1234567890x1234"</p>
            </td>
            <td>
              <p>Используется в следующих местах:</p>
              <p>Портал сброса паролей</p>
              <p>Портал регистрации</p>
              <p>Задается из следующих мест: </p>
              <p>AuthenticationPhone можно задать на портале регистрации сброса паролей или на портале регистрации многофакторной проверки подлинности (MFA).</p>
              <p>Атрибут MobilePhone задается с помощью PowerShell, Azure AD Connect, портала управления Azure и портала администрирования Office.</p>
            </td>
            <td>
              <p>+ccc xxxyyyzzzz (например, +1 1234567890)</p>
              <ul>
                <li class="unordered">
Необходимо указать код страны.<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
Необходимо указать код региона (если применимо).<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
Необходимо указать знак + перед кодом страны.<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
Необходимо указать пробел между кодом страны и остальной частью номера.<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
Расширения не поддерживаются. Если вы указали какие-либо расширения, они игнорируются при диспетчеризации телефонного вызова.<br><br></li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>
              <p>Запасной адрес электронной почты</p>
            </td>
            <td>
              <p>Недоступно</p>
              <p>Сейчас невозможно синхронизировать значения свойства AuthenticationEmail или AlternateEmailAddresses[0] из Active Directory. </p>
              <p>Значение свойства AlternateEmailAddresses[0] можно задать с помощью PowerShell. Инструкции приведены в разделе под этой таблицей.</p>
            </td>
            <td>
              <p>AuthenticationEmail</p>
              <p>ИЛИ</p>
              <p>AlternateEmailAddresses[0] </p>
              <p>(AuthenticationEmail используется при наличии данных, иначе происходит возврат к полю запасного адреса электронной почты.)</p>
              <p>Примечание. Поле запасного адреса электронной почты указывается в виде массива строк в каталоге.  Мы используем первую запись в этом массиве.</p>
              <p>Например, Set-MsolUser -UserPrincipalName JWarner@contoso.com -AlternateEmailAddresses "email@live.com"</p>
            </td>
            <td>
              <p>Используется в следующих местах:</p>
              <p>Портал сброса паролей</p>
              <p>Портал регистрации</p>
              <p>Задается из следующих мест: </p>
              <p>AuthenticationEmail можно задать на портале регистрации сброса паролей или на портале регистрации многофакторной проверки подлинности (MFA).</p>
              <p>AlternateEmail задается с помощью PowerShell, портала управления Azure и портала администрирования Office</p>
            </td>
            <td>
              <p>
                <a href="mailto:user@domain.com">user@domain.com</a> или 甲斐@黒川.日本</p>
              <ul>
                <li class="unordered">
Адреса электронной почты должны соответствовать стандартным правилам форматирования.<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
Поддерживаются адреса электронной почты в формате Юникода.<br><br></li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>
              <p>Контрольные вопросы и ответы на них</p>
            </td>
            <td>
              <p>Недоступно</p>
              <p>Сейчас невозможно синхронизировать секретные вопросы и ответы из Active Directory.</p>
            </td>
            <td>
              <p>Недоступны для изменения непосредственно в каталоге.</p>
              <p>Можно задать только во время процесса регистрации конечного пользователя для сброса пароля.</p>
            </td>
            <td>
              <p>Используется в следующих местах:</p>
              <p>Портал сброса паролей</p>
              <p>Портал регистрации </p>
              <p>Задается из следующих мест: </p>
              <p>Задать контрольные вопросы можно только на портале управления Azure.</p>
              <p>Задать ответы на контрольные вопросы можно на портале регистрации.</p>
            </td>
            <td>
              <p>Контрольные вопросы могут содержать не менее 3 и не более 200 символов</p>
              <p>Ответы могут содержать максимум 40 символов и минимум 3 символа</p>
            </td>
          </tr>
        </tbody></table>


### <a name="deploying-password-reset-without-requiring-end-user-registration"></a>Сброс пароля без регистрации конечного пользователя
Если требуется сбросить пароль без регистрации пользователей, это можно легко сделать, используя один из двух приведенных ниже параметров. Это может быть удобно для разблокирования большого числа пользователей для использования SSPR с сохранением для них возможности проверить эти сведения в процессе регистрации.

Многие из наших крупных клиентов используют эту возможность, чтобы немедленно приступить к сбросу паролей.

#### <a name="synchronize-phone-numbers-with-azure-ad-connect"></a>Синхронизация телефонных номеров с Azure AD Connect
При синхронизации данных в одно или оба приведенные ниже поля их можно использовать для сброса паролей, не выполняя регистрацию пользователей.

* Мобильный телефон
* Рабочий телефон

Дополнительные сведения о свойствах, которые необходимо обновить в локальной среде, см. в разделе [Какие данные используются при сбросе пароля?](#what-data-is-used-by-password-reset), а также просмотрите поля, упомянутые выше.  

Для правильной работы с нашей системой все телефонные номера должны быть указаны в формате +1 1234567890.

#### <a name="set-phone-numbers-or-emails-with-powershell"></a>Указание телефонных номеров и адресов электронной почты с помощью PowerShell
Указав данные в одном или нескольких приведенных ниже полях, их можно использовать для сброса паролей, не выполняя регистрацию пользователей.

* Мобильный телефон
* Рабочий телефон
* Запасной адрес электронной почты

Сведения о задании этих свойств см. в разделе [Настройка данных для сброса пароля с помощью PowerShell](#setting-password-reset-data-with-powershell).

Для правильной работы с нашей системой все телефонные номера должны быть указаны в формате +1 1234567890.

### <a name="what-happens-when-a-user-registers"></a>Что происходит, когда пользователь проходит регистрацию?
Когда пользователь регистрируется, на странице регистрации **всегда** будут заданы следующие поля:

* Телефон для проверки подлинности
* Адрес электронной почты для проверки подлинности
* Контрольные вопросы и ответы на них

Если вы указали значения для полей **Мобильный телефон** или **Альтернативный адрес электронной почты**, пользователи могут использовать их для сброса паролей, даже если они еще не прошли регистрацию в службе.  Кроме того, эти значения будут отображаться для пользователей при первой регистрации, и они смогут изменить их при необходимости.  Но после успешной регистрации эти значения будут сохраняться в полях **Телефон для проверки подлинности** и **Адрес электронной почты для проверки подлинности** без возможности изменения.

### <a name="how-to-access-password-reset-data-for-your-users"></a>Получение доступа к данным для сброса паролей пользователей
#### <a name="data-settable-via-synchronization"></a>Данные, задаваемые посредством синхронизации
Из локальной среды можно синхронизировать следующие поля:

* Мобильный телефон
* Рабочий телефон

#### <a name="data-settable-with-azure-ad-powershell--azure-ad-graph"></a>Данные, задаваемые с помощью Azure AD PowerShell и API Graph Azure AD
С помощью Azure AD PowerShell и API Graph Azure AD можно задать следующие поля:

* Запасной адрес электронной почты
* Мобильный телефон
* Рабочий телефон

#### <a name="data-settable-with-registration-ui-only"></a>Данные, задаваемые только в пользовательском интерфейсе регистрации
Следующие поля доступны только с помощью пользовательского интерфейса регистрации SSPR (https://aka.ms/ssprsetup):

* Контрольные вопросы и ответы на них

#### <a name="data-readable-with-azure-ad-powershell--azure-ad-graph"></a>Данные, доступные для чтения с помощью Azure AD PowerShell и API Graph Azure AD
При использовании Azure AD PowerShell и API Graph Azure AD доступны следующие поля:

* Запасной адрес электронной почты
* Мобильный телефон
* Рабочий телефон
* Телефон для проверки подлинности
* Адрес электронной почты для проверки подлинности

### <a name="setting-password-reset-data-with-powershell"></a>Настройка данных для сброса пароля с помощью PowerShell
С помощью Azure AD PowerShell можно задать значения для следующих полей.

* Запасной адрес электронной почты
* Мобильный телефон
* Рабочий телефон

**_PowerShell V1_**

Чтобы начать работу, сначала необходимо [скачать и установить модуль Azure AD PowerShell](https://msdn.microsoft.com/library/azure/jj151815.aspx#bkmk_installmodule).  После его установки вы можете выполнить следующие процедуры по настройке каждого поля.

**_PowerShell V2_**

Чтобы начать работу, сначала необходимо [скачать и установить модуль Azure AD PowerShell V2](https://github.com/Azure/azure-docs-powershell-azuread/blob/master/Azure%20AD%20Cmdlets/AzureAD/index.md). После его установки вы можете выполнить следующие процедуры по настройке каждого поля.

Чтобы быстро установить одну из последних версий PowerShell, поддерживающую Install-Module, выполните приведенные ниже команды (первая строка просто проверяет наличие PowerShell).

```
Get-Module AzureADPreview
Install-Module AzureADPreview
Connect-AzureAD
```

#### <a name="alternate-email---how-to-set-alternate-email-with-powershell"></a>Как задать дополнительный адрес электронной почты с помощью PowerShell
**_PowerShell V1_**

```
Connect-MsolService
Set-MsolUser -UserPrincipalName user@domain.com -AlternateEmailAddresses @("email@domain.com")
```

**_PowerShell V2_**

```
Connect-AzureAD
Set-AzureADUser -ObjectId user@domain.com -OtherMails @("email@domain.com")
```

#### <a name="mobile-phone---how-to-set-mobile-phone-with-powershell"></a>Как задать мобильный телефон с помощью PowerShell
**_PowerShell V1_**

```
Connect-MsolService
Set-MsolUser -UserPrincipalName user@domain.com -MobilePhone "+1 1234567890"
```

**_PowerShell V2_**

```
Connect-AzureAD
Set-AzureADUser -ObjectId user@domain.com -Mobile "+1 1234567890"
```

#### <a name="office-phone---how-to-set-office-phone-with-powershell"></a>Как задать рабочий телефон с помощью PowerShell
**_PowerShell V1_**

```
Connect-MsolService
Set-MsolUser -UserPrincipalName user@domain.com -PhoneNumber "+1 1234567890"
```

**_PowerShell V2_**

```
Connect-AzureAD
Set-AzureADUser -ObjectId user@domain.com -TelephoneNumber "+1 1234567890"
```

### <a name="reading-password-reset-data-with-powershell"></a>Считывание данных для сброса паролей с помощью PowerShell
С помощью Azure AD PowerShell можно считать значения для следующих полей.

* Запасной адрес электронной почты
* Мобильный телефон
* Рабочий телефон
* Телефон для проверки подлинности
* Адрес электронной почты для проверки подлинности

#### <a name="alternate-email---how-to-read-alternate-email-with-powershell"></a>Как просмотреть дополнительный адрес электронной почты с помощью PowerShell
**_PowerShell V1_**

```
Connect-MsolService
Get-MsolUser -UserPrincipalName user@domain.com | select AlternateEmailAddresses
```

**_PowerShell V2_**

```
Connect-AzureAD
Get-AzureADUser -ObjectID user@domain.com | select otherMails
```

#### <a name="mobile-phone---how-to-read-mobile-phone-with-powershell"></a>Как просмотреть мобильный телефон с помощью PowerShell
**_PowerShell V1_**

```
Connect-MsolService
Get-MsolUser -UserPrincipalName user@domain.com | select MobilePhone
```

**_PowerShell V2_**

```
Connect-AzureAD
Get-AzureADUser -ObjectID user@domain.com | select Mobile
```

#### <a name="office-phone---how-to-read-office-phone-with-powershell"></a>Как просмотреть рабочий телефон с помощью PowerShell
**_PowerShell V1_**

```
Connect-MsolService
Get-MsolUser -UserPrincipalName user@domain.com | select PhoneNumber
```

**_PowerShell V2_**

```
Connect-AzureAD
Get-AzureADUser -ObjectID user@domain.com | select TelephoneNumber
```

#### <a name="authentication-phone---how-to-read-authentication-phone-with-powershell"></a>Как просмотреть телефон для проверки подлинности с помощью PowerShell
**_PowerShell V1_**

```
Connect-MsolService
Get-MsolUser -UserPrincipalName user@domain.com | select -Expand StrongAuthenticationUserDetails | select PhoneNumber
```

**_PowerShell V2_**

```
Not possible in PowerShell V2
```

#### <a name="authentication-email---how-to-read-authentication-email-with-powershell"></a>Как просмотреть адрес электронной почты для проверки подлинности с помощью PowerShell
**_PowerShell V1_**

```
Connect-MsolService
Get-MsolUser -UserPrincipalName user@domain.com | select -Expand StrongAuthenticationUserDetails | select Email
```

**_PowerShell V2_**

```
Not possible in PowerShell V2
```
## <a name="how-does-password-reset-work-for-b2b-users"></a>Как работает сброс пароля для пользователей B2B
Сброс и изменение пароля полностью поддерживается во всех конфигурациях B2B.  Ниже приведены 3 конфигурации B2B, поддерживаемые системой сброса пароля.

1. **Пользователи из партнерской организации с клиентом Azure AD.** Если организация, с которой вы вступили в партнерские отношения, имеет клиент Azure AD, мы **учитываем политики сброса пароля, включенные в этом клиенте**. Для работы сброса пароля партнерская организация должна включить Azure AD SSPR. Дополнительная плата для клиентов Office 365 не требуется. Указания по включению см. в статье [Приступая к работе с компонентами управления паролями](https://azure.microsoft.com/documentation/articles/active-directory-passwords-getting-started/#enable-users-to-reset-or-change-their-aad-passwords).
2. **Пользователи, зарегистрировавшиеся с помощью функции [самостоятельной регистрации](https://docs.microsoft.com/azure/active-directory/active-directory-self-service-signup)**. Если организация, с которой вы вступили в партнерские отношения, использует функцию [самостоятельной регистрации](https://docs.microsoft.com/azure/active-directory/active-directory-self-service-signup) для входа в клиент, мы позволим им сбросить пароль, указав зарегистрированный адрес электронной почты.
3. **Пользователи B2B.** Все новые пользователи B2B, созданные с помощью [возможностей Azure AD B2B](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b), также смогут сбросить пароль, указав адрес электронной почты, зарегистрированный в процессе приглашения.

Используя одного из этих пользователей-партнеров, перейдите на страницу http://passwordreset.microsoftonline.com, чтобы протестировать один из следующих сценариев.  Если они определили дополнительный адрес электронной почты или адрес электронной почты для проверки подлинности, сброс паролей будет работать должным образом.  Дополнительные сведения о данных, используемых SSPR, см. в [этом разделе](https://azure.microsoft.com/en-us/documentation/articles/active-directory-passwords-learn-more/#what-data-is-used-by-password-reset).

## <a name="next-steps"></a>Дальнейшие действия
Ниже приведены ссылки на все страницы документации по службе сброса паролей Azure AD.

* **Вы здесь потому, что возникают проблемы при входе?** Если это так, [с помощью этих инструкций можно изменить и сбросить пароль](active-directory-passwords-update-your-own-password.md#reset-your-password).
* [**Как работает управление паролями**](active-directory-passwords-how-it-works.md) — узнайте, из каких шести компонентов состоит служба и за что отвечает каждый из них.
* [**Приступая к работе**](active-directory-passwords-getting-started.md) — узнайте, как предоставить пользователям возможность сбрасывать и менять свои облачные и локальные пароли.
* [**Настройка**](active-directory-passwords-customize.md) — узнайте, как настроить оформление и функциональность службы в соответствии с потребностями организации.
* [**Рекомендации**](active-directory-passwords-best-practices.md) — узнайте, как быстро развернуть службу и эффективно управлять паролями в организации.
* [**Аналитика**](active-directory-passwords-get-insights.md) — узнайте об интегрированных функциях отчетности.
* [**Часто задаваемые вопросы**](active-directory-passwords-faq.md) — ознакомьтесь с ответами на часто задаваемые вопросы.
* [**Устранение неполадок**](active-directory-passwords-troubleshoot.md) — узнайте, как быстро устранять проблемы, связанные со службой.

[001]: ./media/active-directory-passwords-learn-more/001.jpg "Image_001.jpg"
[002]: ./media/active-directory-passwords-learn-more/002.jpg "Image_002.jpg"

