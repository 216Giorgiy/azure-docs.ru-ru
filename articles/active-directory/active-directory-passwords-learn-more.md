<properties 
	pageTitle="Дополнительные сведения: управление паролями Azure AD| Microsoft Azure" 
	description="Дополнительные разделы по управлению паролями Azure AD, включая принципы работы обратной записи паролей, безопасность обратной записи паролей, принципы работы портала сброса паролей и данные, которые используются при сбросе пароля." 
	services="active-directory" 
	documentationCenter="" 
	authors="asteen" 
	manager="kbrint" 
	editor="billmath"/>

<tags 
	ms.service="active-directory" 
	ms.workload="identity" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="06/08/2015" 
	ms.author="asteen"/>

# Дополнительные сведения об управлении паролями
Если компонент управления паролями уже развернут или вы просто хотите узнать больше о технических деталях работы перед развертыванием, в этом разделе содержится хороший обзор основных технических концепций службы. Мы раскроем следующие темы:

* [**Обзор обратной записи паролей**](#password-writeback-overview)
  - [Как работает обратная запись паролей](#how-password-writeback-works)
  - [Сценарии, поддерживаемые для обратной записи паролей](#scenarios-supported-for-password-writeback)
  - [Модель безопасности обратной записи паролей](#password-writeback-security-model)
* [**Как работает портал для сброса паролей?**](#how-does-the-password-reset-portal-work)
  - [Какие данные используются при сбросе пароля?](#what-data-is-used-by-password-reset)

## Обзор обратной записи паролей
Обратная запись паролей — это компонент [Azure Active Directory Connect](active-directory-aadconnect), который может быть включен и использован текущими подписчиками Azure Active Directory Premium. Дополнительные сведения см. в статье [Выпуски Azure Active Directory](active-directory-editions.md).

Обратная запись паролей позволяет настроить облачного клиента для записи паролей обратно в локальную службу Active Directory. Это устраняет необходимость в настройке и управлении комплексным локальным решением по сбросу паролей в режиме самообслуживания, а также предоставляет пользователям удобный облачный способ сброса локальных паролей из любого места. Ниже описаны некоторые ключевые функции обратной записи паролей:

- **Обратная связь с нулевой задержкой.** Обратная запись паролей выполняется в синхронном режиме. Пользователи немедленно получают уведомление, если пароль не соответствует политике или если его не удалось сбросить или изменить по любой причине.
- **Поддерживается сброс паролей для пользователей AD FS и других технологий федерации.** С обратной записью паролей, при условии, что федеративные учетные записи пользователей синхронизируются в клиенте Azure AD, они смогут управлять локальными паролями AD из облака.
- **Поддерживается сброс паролей для пользователей, применяющих синхронизацию хэшей паролей.** Если служба сброса паролей обнаруживает, что для синхронизированной учетной записи пользователя включена синхронизация хэшей паролей, то локальный и облачный пароли для этой учетной записи сбрасываются одновременно.
- **Поддерживается изменение паролей с панели доступа и Office 365.** При изменении просроченных или непросроченных паролей федеративными пользователями или пользователями с синхронизацией паролей эти пароли будут записываются обратно в локальную среду AD.
- **Поддерживается обратная запись паролей при их сбросе администратором с** [**портала управления Azure**](https://manage.windowsazure.com). Каждый раз, когда администратор сбрасывает пароль пользователя на [портале управления Azure](https://manage.windowsazure.com), если этот пользователь является федеративным или для него включена синхронизация паролей, выбранный администратором пароль также будет устанавливаться в локальной службе AD. В настоящее время это не поддерживается на портале администрирования Office.
- **Принудительно применяются политики паролей локальной службы AD.** Когда пользователь сбрасывает свой пароль, перед его фиксацией в соответствующем каталоге выполняется проверка соблюдения политики локальной службы AD. Это включает журнал, сложность, срок пользования, фильтры паролей и любые другие ограничения паролей, заданные в локальной службе AD.
- **Не требуется никаких входящих правил брандмауэра.** Обратная запись паролей использует ретранслятор служебной шины Azure в качестве базового канала связи. Это означает, что для работы этой функции вам не нужно открывать какие-либо входящие порты в брандмауэре.
- **Не поддерживается для учетных записей пользователей, существующих в защищенных группах в локальной службе Active Directory.** Дополнительные сведения о защищенных группах см. в статье [Защищенные учетные записи и группы в Active Directory](https://technet.microsoft.com/library/dn535499.aspx).

### Как работает обратная запись паролей
Обратная запись паролей состоит из тех основных компонентов:

- Облачная служба сброса паролей (она также интегрирована в страницы смены пароля Azure AD)
- Ретранслятор служебной шины Azure для определенного клиента
- Локальная конечная точка сброса пароля

Вместе они работают так, как показано на схеме ниже:

  ![][001]

При сбросе или смене пароля в облаке федеративным пользователем или пользователем с синхронизацией хэшей происходит следующее:

1.	Проверяется установленный у пользователя тип пароля. Если этот пароль управляется локально, проверяется работа службы обратной записи. Если служба работает, пользователю разрешается продолжить операцию; если нет, ему сообщается о том, что здесь нельзя сбросить его пароль.
2.	Затем пользователь проходит соответствующие шлюзы проверки подлинности и достигает экрана сброса пароля.
3.	Пользователь выбирает новый пароль и подтверждает его.
4.	После нажатия кнопки «Отправить» указанный в виде простого текста пароль шифруется с помощью симметричного ключа, который был создан в процессе установки обратной записи.
5.	После шифрования пароля он включается в полезные данные, которые передаются по каналу HTTPS на ретранслятор служебной шины для определенного клиента (который был также настроен в процессе установки обратной записи). Этот ретранслятор защищается случайно генерируемым паролем, который известен только локальной установленной системе.
6.	После того как сообщение достигает служебной шины, конечная точка сброса пароля автоматически активируется и обнаруживает ожидающий запрос на сброс.
7.	Затем служба выполняет поиск нужного пользователя с помощью атрибута привязки облака. Для успешного выполнения этого поиска объект пользователя должен существовать в пространстве соединителя AD, он должен быть привязан к соответствующему объекту MV, а также должен быть привязан к соответствующему объекту соединителя AAD. Наконец, для того чтобы в ходе синхронизации можно было найти эту учетную запись пользователя, в ссылке с объекта соединителя AD на MV должно быть правило синхронизации `Microsoft.InfromADUserAccountEnabled.xxx`. Это необходимо, поскольку при вызове из облака обработчик синхронизации использует атрибут cloudAnchor для поиска объекта пространства соединителя AAD, затем возвращается по ссылке к объекту MV, после чего возвращается по ссылке к объекту AD. Так как для одного и того же пользователя может быть несколько объектов AD (несколько лесов), обработчик синхронизации полагается на ссылку `Microsoft.InfromADUserAccountEnabled.xxx` для выбора нужного из них.
8.	После нахождения учетной записи пользователя предпринимается попытка сброса пароля непосредственно в соответствующем лесу AD.
9.	Если операция установки пароля прошла успешно, пользователь уведомляется о том, что его пароль изменен и он может продолжать работу.
10.	В случае сбоя операции установки пароля пользователю возвращается ошибка и предлагается повторить попытку. Операция может завершиться ошибкой из-за неработающей службы, из-за несоответствия выбранного пароля политикам организации, из-за того, что не удалось найти пользователя в локальной службе AD, или по множеству причин. Для многих из таких случаем имеется конкретное сообщение, позволяющее указать пользователю на возможности для устранения проблемы.

### Сценарии, поддерживаемые для обратной записи паролей
В таблице ниже описано, какие сценарии поддерживаются для каких версий наших возможностей синхронизации. Как правило, настоятельно рекомендуется установить новейшую версию [Azure AD Connect](active-directory-aadconnect.md#download-azure-ad-connect), если требуется использовать обратную запись паролей.

  ![][002]

### Модель безопасности обратной записи паролей
Обратная запись паролей — это служба с высоким уровнем безопасности и надежности. Для обеспечения защиты информации мы реализуем четырехуровневую модель безопасности, описанную ниже.

- **Ретранслятор служебной шины для определенного клиента**. При настройке службы настраивается ретранслятор служебной шины для определенного клиента, который защищается случайно генерируемым надежным паролем. У Майкрософт нет доступа к этому паролю.
- **Заблокированный, криптографически надежный ключ шифрования пароля**. После создания ретранслятора служебной шины создается надежный симметричный ключ, который используется для шифрования пароля при передаче по сети. Этот ключ существует только в секретном хранилище клиента в облаке, которые тщательно блокируется и контролируется, подобно любому паролю в каталоге.
- **TLS отраслевого стандарта**. При выполнении операции сброса или изменения пароля в облаке мы берем пароль в виде простого текста и шифруем его вашим открытым ключом. Затем он вставляется в сообщение HTTPS, которое передается по зашифрованному каналу с использованием сертификатов SSL корпорации Майкрософт на ваш ретранслятор служебной шины. После поступления сообщения в служебную шину ваш локальный агент активируется, проходит проверку подлинности в шине с использованием ранее созданного надежного пароля, забирает шифрованное сообщение, расшифровывает его с помощью созданного нами закрытого ключа, а затем пытается установить пароль посредством интерфейса AD DS SetPassword API. Именно этот этап позволяет нам принудительно применять политику паролей вашей локальной службы AD (сложность, срок пользования, историю, фильтры и т. д.) в облаке.
- **Политики срока действия сообщений**. Наконец, если по какой-либо причине сообщение задержится в служебной шине из-за неработающей локальной службы, срок его ожидания истечет и оно будет удалено через несколько минут в целях еще большего повышения безопасности.

## Как работает портал для сброса паролей
При переходе пользователя на портал сброса пароля запускается рабочий процесс, определяющий допустимость учетной записи пользователя, организацию, к которой принадлежит пользователь, место управления паролем этого пользователя, а также наличие у пользователя лицензии на использование данной функции. Прочитайте описанные ниже шаги, чтобы узнать о логике страницы сброса пароля.

1.	Пользователь открывает ссылку «Невозможно получить доступ к вашей учетной записи» или переходит непосредственно по адресу [https://passwordreset.microsoftonline.com](https://passwordreset.microsoftonline.com).
2.	Пользователь вводит идентификатор пользователя и проходит тест CAPTCHA.
3.	Azure AD проверяет, имеется ли у пользователя возможность использовать эту функцию, путем следующих действий:
    - Проверяет, включена ли данная функция у пользователя и назначена ли ему лицензия Azure AD.
        - Если у пользователя данная функция не включена или ему не назначена лицензия, пользователю предлагается обратиться к администратору для сброса своего пароля.
    - Проверяет наличие у пользователя нужных проверочных данных, определенных в его учетной записи в соответствии с политикой администратора.
        - Если политика требует только один запрос, то проверяется, определены ли у пользователя соответствующие данные по крайней мере для одной из проверок, включенных политикой администратора.
          - Если учетная запись не настроена, пользователю предлагается обратиться к администратору для сброса своего пароля.
        - Если политика требует два запроса, выполняется проверка наличия у пользователя соответствующих данных, определенных по крайней мере для двух проверок, включенных политикой администратора.
          - Если учетная запись не настроена, пользователю предлагается обратиться к администратору для сброса своего пароля.
    - Проверяет, управляется ли пароль пользователя локально (является ли он федеративным или для него включена синхронизация хэшей паролей).
       - Если развернута обратная запись, а управление паролем пользователя осуществляется локально, то пользователю разрешается продолжить проверку подлинности и сбросить свой пароль.
       - Если обратная запись не развернута, а управление паролем пользователя осуществляется локально, то пользователю предлагается обратиться к администратору для сброса своего пароля.
4.	Если выяснилось, что пользователь может успешно сбросить свой пароль, ему выдаются указания по ходу процесса сброса.

Дополнительные сведения о развертывании обратной записи паролей см. в статье [Приступая к работе: управление паролями AD Azure](active-directory-passwords-getting-started.md).

### Какие данные используются при сбросе пароля?
В следующей таблице показано, где и как эти данные используются при сбросе пароля. Это поможет решить, какие параметры проверки подлинности подходят для вашей организации. Также в таблице приведены правила форматирования для случаев, когда данные предоставляются от имени пользователей из входных путей, которые не выполняют проверку данных.

> [AZURE.NOTE]Рабочий телефон не отображается на портале регистрации, поскольку пользователи в настоящее время не могут изменять это свойство в каталоге.

<table>
          <tbody><tr>
            <td>
              <p>
                <strong>Название способа связи</strong>
              </p>
            </td>
            <td>
              <p>
                <strong>Элемент данных Azure Active Directory</strong>
              </p>
            </td>
            <td>
              <p>
                <strong>Где используется / задается?</strong>
              </p>
            </td>
            <td>
              <p>
                <strong>Требования к формату</strong>
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p>Рабочий телефон</p>
            </td>
            <td>
              <p>PhoneNumber</p>
              <p>например, Set-MsolUser -UserPrincipalName JWarner@contoso.com -PhoneNumber "+1 1234567890x1234"</p>
            </td>
            <td>
              <p>Используется в следующих местах:</p>
              <p>Портал сброса паролей</p>
              <p>Задается из следующих мест:</p>
              <p>PhoneNumber задается с помощью PowerShell, DirSync, портала управления Azure и портала администрирования Office</p>
            </td>
            <td>
              <p>+ccc xxxyyyzzzz (например, +1 1234567890)</p>
              <ul>
                <li class="unordered">
										Необходимо указать код страны<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
										Необходимо указать код региона (если применимо)<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
										Необходимо указать знак + перед кодом страны<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
										Необходимо указать пробел между кодом страны и остальной частью номера<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
										Расширения не поддерживаются. Если вы указали какие-либо расширения, они будут удалены из номера перед диспетчеризацией телефонного вызова.<br><br></li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>
              <p>Мобильный телефон</p>
            </td>
            <td>
              <p>AuthenticationPhone</p>
              <p>ИЛИ</p>
              <p>MobilePhone</p>
              <p>(AuthenticationPhone используется при наличии данных, иначе происходит возврат к полю мобильного телефона.)</p>
              <p>например, Set-MsolUser -UserPrincipalName JWarner@contoso.com -MobilePhone "+1 1234567890x1234"</p>
            </td>
            <td>
              <p>Используется в следующих местах:</p>
              <p>Портал сброса паролей</p>
              <p>Портал регистрации</p>
              <p>Задается из следующих мест: </p>
              <p>AuthenticationPhone можно задать на портале регистрации сброса паролей или на портале регистрации многофакторной проверки подлинности (MFA).</p>
              <p>MobilePhone задается с помощью PowerShell, DirSync, портала управления Azure и портала администрирования Office</p>
            </td>
            <td>
              <p>+ccc xxxyyyzzzz (например, +1 1234567890)</p>
              <ul>
                <li class="unordered">
										Необходимо указать код страны.<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
										Необходимо указать код региона (если применимо).<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
										Необходимо указать знак + перед кодом страны.<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
										Необходимо указать пробел между кодом страны и остальной частью номера.<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
										Расширения не поддерживаются. Если вы указали какие-либо расширения, они игнорируются при диспетчеризации телефонного вызова.<br><br></li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>
              <p>Запасной адрес электронной почты</p>
            </td>
            <td>
              <p>AuthenticationEmail</p>
              <p>ИЛИ</p>
              <p>AlternateEmailAddresses[0] </p>
              <p>(AuthenticationEmail используется при наличии данных, иначе происходит возврат к полю запасного адреса электронной почты.)</p>
              <p>Примечание. Поле запасного адреса электронной почты указывается в виде массива строк в каталоге. Мы используем первую запись в этом массиве.</p>
              <p>например, Set-MsolUser -UserPrincipalName JWarner@contoso.com -AlternateEmailAddresses "email@live.com"</p>
            </td>
            <td>
              <p>Используется в следующих местах:</p>
              <p>Портал сброса паролей</p>
              <p>Портал регистрации</p>
              <p>Задается из следующих мест: </p>
              <p>AuthenticationEmail можно задать на портале регистрации сброса паролей или на портале регистрации многофакторной проверки подлинности (MFA).</p>
              <p>AlternateEmail задается с помощью PowerShell, портала управления Azure и портала администрирования Office</p>
            </td>
            <td>
              <p>
                <a href="mailto:user@domain.com">user@domain.com</a> или 甲斐@黒川.日本</p>
              <ul>
                <li class="unordered">
										Адреса электронной почты должны соответствовать стандартным правилам форматирования.<br><br></li>
              </ul>
              <ul>
                <li class="unordered">
										Поддерживаются адреса электронной почты в формате Юникода.<br><br></li>
              </ul>
            </td>
          </tr>
          <tr>
            <td>
              <p>Контрольные вопросы и ответы на них</p>
            </td>
            <td>
              <p>Недоступны для изменения непосредственно в каталоге.</p>
            </td>
            <td>
              <p>Используются в следующих местах:</p>
              <p>Портал сброса паролей</p>
              <p>Портал регистрации </p>
              <p>Задается из следующих мест: </p>
              <p>Задать контрольные вопросы можно только на портале управления Azure.</p>
              <p>Задать ответы на контрольные вопросы можно на портале регистрации.</p>
            </td>
            <td>
              <p>Контрольные вопросы могут содержать не менее 3 и не более 200 символов</p>
              <p>Ответы могут содержать максимум 40 символов и минимум 3 символа</p>
            </td>
          </tr>
        </tbody></table>

<br/> <br/> <br/>

**Дополнительные ресурсы**


* [Сведения об управлении паролями](active-directory-passwords.md)
* [Как работает управление паролями](active-directory-passwords-how-it-works.md)
* [Приступая к работе с компонентами управления паролями](active-directory-passwords-getting-started.md)
* [Настройка компонентов управления паролями](active-directory-passwords-customize.md)
* [Рекомендации по управлению паролями](active-directory-passwords-best-practices.md)
* [Получение оперативной аналитики с помощью отчетов об управлении паролями](active-directory-passwords-get-insights.md)
* [Вопросы и ответы об управлении паролями](active-directory-passwords-faq.md)
* [Устранение неполадок, связанных с управлением паролями](active-directory-passwords-troubleshoot.md)
* [Управление паролями в сети MSDN](https://msdn.microsoft.com/library/azure/dn510386.aspx)



[001]: ./media/active-directory-passwords-learn-more/001.jpg "Image_001.jpg"
[002]: ./media/active-directory-passwords-learn-more/002.jpg "Image_002.jpg"
 

<!---HONumber=July15_HO5-->