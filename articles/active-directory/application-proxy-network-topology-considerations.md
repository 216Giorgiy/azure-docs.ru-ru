---
title: "Аспекты топологии сети при использовании прокси приложения Azure AD | Документация Майкрософт"
description: "В этой статье рассматриваются аспекты топологии сети при использовании прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/12/2017
ms.author: kgremban
translationtype: Human Translation
ms.sourcegitcommit: 1fdc00865f31352026a64c2769d9d65047bb2fa6
ms.openlocfilehash: 26ec9167f1f883c3c71947a55142020fb48e206a


---

# <a name="network-topology-considerations-when-using-azure-ad-application-proxy"></a>Аспекты топологии сети при использовании прокси приложения Azure AD
> [!NOTE]
> Прокси приложения — это функция, которая доступна только после обновления до выпуска Premium или Basic службы Azure Active Directory. Дополнительные сведения см. в разделе [Выпуски Azure Active Directory](active-directory-editions.md).
> 

В этой статье рассматриваются аспекты топологии сети при использовании прокси приложения Azure AD для публикации и удаленного доступа к приложениям. 

## <a name="traffic-flow"></a>Поток трафика

При публикации приложения через прокси приложение Azure AD весь трафик, передаваемый от пользователей к целевым серверным приложениям, проходит через следующие прыжки:

* прыжок 1: от пользователя к общедоступной конечной точке службы прокси приложения Azure AD в Azure;
* прыжок 2: от службы прокси приложения к соединителю;
* прыжок 3: от соединителя к целевому приложению.

 ![Несколько поставщиков облачных решений Iaas Azure AD](./media/application-proxy-network-topologies/application-proxy-three-hops.png)

## <a name="tenant-location-and-app-proxy-service"></a>Расположение клиента и службы прокси приложения

При регистрации клиента Azure AD его регион (США, EMEA, АТР и т. д.) определяется на основе указанной вами страны. При включении прокси приложения экземпляры службы прокси приложения для вашего клиента отображаются в том же регионе, где находится клиент Azure AD, или в ближайшем к нему регионе. 

Например, если регион клиента Azure AD — Европейский Союз (ЕС), все соединители прокси приложения Azure AD будут подключены к экземплярам службы прокси приложения в центрах обработки данных Azure в ЕС. Это также означает, что при попытке доступа к опубликованным приложениям все пользователи пройдут через экземпляры службы прокси приложения в этом расположении.

## <a name="considerations-for-reducing-latency"></a>Рекомендации по уменьшению задержки

Все решения прокси влекут за собой задержку в сетевом подключении. Независимо от того, какое решение прокси или VPN выбрано в качестве решения удаленного доступа, в нем всегда будет содержаться набор серверов, обеспечивающих подключение к корпоративной сети. 

Ранее в сети периметра корпораций обычно размещались конечные точки сервера. Однако с прокси приложения Azure AD эта сеть не обязательна.  Это связано с тем, что трафик прокси приложения проходит через прокси-службу в облаке, а соединители находятся в корпоративной сети.

### <a name="connector-placement"></a>Расположение соединителя

Служба прокси приложения выбирает расположение экземпляров на основе расположения клиента. Таким образом, вы сможете выбрать место установки соединителя, что позволяет определить характеристики сквозной задержки сетевого трафика.

Ниже приведены некоторые вопросы по настройке службы прокси приложения, которые следует задать.

* Где расположено приложение?
* Где находится большинство пользователей, осуществляющих доступ к приложению?
* Где находится экземпляр прокси приложения (на основе расположения клиента)?
* У вас уже есть выделенное сетевое подключение к центрам обработки данных Azure (например, настроенное подключение ExpressRoute или аналогичное VPN-подключение)?

Расположение соединителя определит задержку прыжков 2 и 3. При оценке расположения соединителя необходимо учитывать следующее.

* Соединителю нужен "канал прямой видимости" к центру обработки данных, чтобы выполнять операции ограниченного делегирования Kerberos (KCD), если требуется единый вход для серверных приложений.
* Соединитель обычно устанавливается близко к приложению, чтобы сократить время обмена данными между ними.

### <a name="general-approach-to-minimize-latency"></a>Общий подход к уменьшению задержки

Вы можете попробовать уменьшить сквозную задержку трафика, оптимизировав каждый прыжок сети для прохождения трафика.

Каждый прыжок можно оптимизировать следующим образом:

* уменьшить расстояние между двумя конечными точками прыжка;
* выбрать нужную сеть для прохода (например, проход частной сети, а не общедоступного Интернета, может выполняться быстрее из-за выделенных каналов связи).
 
При наличии можно использовать выделенный канал связи VPN или ExpressRoute между Azure и корпоративной сетью.

## <a name="focus-your-optimizing-strategy"></a>Ограничение стратегии оптимизации

Так как пользователи могут получить удаленный доступ к приложениям через Интернет, вам следует всегда акцентировать внимание на оптимизации прыжков 2 и 3. Ниже приведены некоторые распространенные шаблоны, которые можно использовать.

### <a name="pattern-1-optimize-hop-3"></a>Шаблон 1. Оптимизация прыжка 3

Для оптимизации прыжка 3 соединитель размещается близко к целевому приложению в сети клиента. Преимуществом этого является то, что соединителю может понадобиться "канал прямой видимости" к контроллеру домена, как упоминалось выше. Для большинства клиентов и сценариев этого подхода достаточно. Большинство наших клиентов следуют такому шаблону.

 ![Несколько поставщиков облачных решений Iaas Azure AD](./media/application-proxy-network-topologies/application-proxy-hop3.png)


> [!NOTE]
В некоторых сценариях необходимо оптимизировать прыжок 2 и 3, чтобы получить нужные характеристики задержки. Например, если между сетью и центром обработки данных Azure настроено подключение VPN или ExpressRoute, помимо прыжка 3 этот сценарий позволяет также оптимизировать прыжок 2.
>

### <a name="pattern-2-take-advantage-of-expressroute-with-public-peering"></a>Шаблон 2. Использование преимуществ подключения ExpressRoute с общедоступным пирингом

При настройке подключения ExpressRoute с общедоступным пирингом можно применить более быстрое подключение ExpressRoute для прыжка 2. Прыжок 3 уже оптимизирован за счет близкого размещения соединителя к приложению в сети клиента.

![Несколько поставщиков облачных решений Iaas Azure AD](./media/application-proxy-network-topologies/application-proxy-expressroute-public.png)

### <a name="pattern-3-taking-advantage-expressroute-with-private-peering"></a>Шаблон 3. Использование преимуществ подключения ExpressRoute с частным пирингом

При настройке выделенного подключения VPN или ExpressRoute с частным пирингом между Azure и корпоративной сетью, в которой установлено приложение, можно использовать другой вариант. В этой конфигурации виртуальная сеть в Azure обычно рассматривается как расширение корпоративной сети. Таким образом, вы можете установить соединитель в центре обработки данных Azure и по-прежнему выполнять требования к низкой задержке для подключения соединителя к приложению для прыжка 3. 

Задержка не увеличивается, так как трафик передается через выделенное подключение. Тем не менее, вы получаете дополнительное преимущество, которое заключается в улучшении характеристик задержки прыжка 2. Это происходит, потому что подключение службы прокси к соединителю (прыжок 2) является более коротким прыжком, так как соединитель установлен в центре обработки данных Azure близко к расположению клиента AAD (а значит, и к прокси приложения).

![Несколько поставщиков облачных решений Iaas Azure AD](./media/application-proxy-network-topologies/application-proxy-expressroute-private.png)

### <a name="other-approaches"></a>Другие подходы

В предыдущих разделах этой статьи внимание акцентировалось на расположение соединителя. Однако, если для вас допустимо перемещение приложения (например, в Azure или другую размещенную среду), расположение приложения можно изменить, чтобы улучшить показатели задержки. 

Все больше организаций перемещают сети в размещенные среды. Это позволяет им разместить приложения в размещенной среде, которая также является частью корпоративной сети, не выходя за пределы домена. В этом случае шаблоны, приведенные выше, могут применяться к новому расположению приложения.

Возможно, вас также заинтересует использование групп соединителей для целевых приложений, находящихся в разных расположениях и сетях. Если вы рассматриваете этот вариант, перейдите на страницу [Доменные службы Azure Active Directory](https://azure.microsoft.com/en-us/services/active-directory-ds). 

## <a name="common-scenarios"></a>Распространенные сценарии

В этом разделе рассматриваются несколько вариантов использования. Для всех приведенных ниже вариантов использования предполагается, что клиент Azure AD (а значит, и конечная точка службы прокси) находится в США. В других регионах по всему миру обычно применяются те же рекомендации.

### <a name="use-case-1"></a>Вариант использования 1

Приложение находится в сети клиента в США в том же регионе, что и пользователи. Подключение ExpressRoute или VPN между контроллером домена Azure и корпоративной сетью не установлено.

**Рекомендация:** следуйте варианту использования 1, приведенному выше. Для уменьшения задержки рассмотрите использование подключения ExpressRoute (при необходимости см. вариант использования 3 и 4).

Это простой шаблон. Самый распространенный шаблон — это оптимизация прыжка 3, когда соединитель расположен рядом с приложением. Это также является естественным выбором, так как соединитель обычно устанавливается с "прямой видимостью" приложения и контроллера домена для выполнения операций ограниченного делегирования Kerberos.
Этот вариант использования соответствует шаблону 1, приведенному ниже.

![Несколько поставщиков облачных решений Iaas Azure AD](./media/application-proxy-network-topologies/application-proxy-pattern1.png)

### <a name="use-case-2"></a>Вариант использования 2

Приложение находится в сети клиента в США, а пользователи распределены по всему миру. Подключение ExpressRoute или VPN между контроллером домена Azure и корпоративной сетью не установлено.

**Рекомендация:** следуйте варианту использования 2, приведенному выше. Для уменьшения задержки рассмотрите использование подключения ExpressRoute (при необходимости см. вариант использования 3 и 4).

И снова, самый распространенный шаблон — это оптимизация прыжка 3, когда соединитель расположен рядом с приложением (как указано выше). Обычно прыжок 3 не является дорогим, если он находится в одном регионе. Тем не менее, прыжок 1 может обойтись намного дороже в зависимости от того, где находится пользователь, так как все пользователи получают доступ к экземпляру прокси приложения в США. Следует отметить, что здесь любое решение прокси будет иметь сходные характеристики в отношении пользователей, распределенных по всему миру.

Этот вариант использования соответствует шаблону 2, приведенному ниже.

![Несколько поставщиков облачных решений Iaas Azure AD](./media/application-proxy-network-topologies/application-proxy-pattern2.png)

### <a name="use-case-3"></a>Вариант использования 3

Приложение находится в сети клиента в США. Между Azure и корпоративной сетью установлено подключение ExpressRoute с общедоступным пирингом.

**Рекомендация:** разместите соединитель как можно ближе к приложению. Система будет автоматически использовать ExpressRoute для прыжка 2. Этот вариант соответствует шаблону 2, описанному выше.

Если канал связи ExpressRoute использует общедоступный пиринг, трафик между прокси и соединителем будет проходить через этот канал связи и задержка для прыжка 2 будет оптимизирована.

Этот вариант использования соответствует шаблону 3, приведенному ниже.

![Несколько поставщиков облачных решений Iaas Azure AD](./media/application-proxy-network-topologies/application-proxy-pattern3.png)

### <a name="use-case-4"></a>Вариант использования 4

Приложение находится в сети клиента в США. Между Azure и корпоративной сетью установлено подключение ExpressRoute с частным пирингом.

**Рекомендация:** разместите соединитель в контроллере домена Azure, который подключен к корпоративной сети через частный пиринг ExpressRoute. Этот вариант соответствует шаблону 3, описанному выше.

Соединитель можно разместить в контроллере домена Azure. Так как он по-прежнему имеет "прямую видимость" приложения и контроллера домена через частную сеть, прыжок 3 остается оптимизированным. Кроме того, эта настройка дополнительно оптимизирует прыжок 2.

Этот вариант использования соответствует шаблону 4, приведенному ниже.

![Несколько поставщиков облачных решений Iaas Azure AD](./media/application-proxy-network-topologies/application-proxy-pattern4.png)

### <a name="use-case-5"></a>Вариант использования 5

Приложение размещено в сети клиента в ЕС, а большинство пользователей находится в США.

**Рекомендация:** разместите соединитель рядом с приложением. По причинам, указанным выше, это лучший выбор. Так как пользователи США имеют доступ к экземпляру прокси приложения, который находится в том же регионе, прыжок 1 не является слишком дорогим. Прыжок 3 оптимизирован. Однако прыжок 2 в этом варианте использования, как правило, стоит дороже.

Этот вариант использования соответствует шаблону 5, приведенному ниже.

![Несколько поставщиков облачных решений Iaas Azure AD](./media/application-proxy-network-topologies/application-proxy-pattern5a.png)

Рассмотрим использование ExpressRoute, как упоминалось в шаблонах 2 и 3, приведенных выше. Ниже показано применение шаблона 2.

Этот вариант использования соответствует шаблону 5, приведенному ниже.

![Несколько поставщиков облачных решений Iaas Azure AD](./media/application-proxy-network-topologies/application-proxy-pattern5b.png)

Ниже приведен еще один пример использования в рамках этого варианта.

Если большинство пользователей в организации находятся в США, существует вероятность, что ваша сеть также будет "расширена" до этого региона. Если это так, соединитель можно разместить в США, а выделенный канал внутренней корпоративной сети можно использовать в приложении в ЕС. Таким образом, прыжки 2 и 3 оптимизируются.

Этот пример использования соответствует шаблону 5, приведенному ниже.

![Несколько поставщиков облачных решений Iaas Azure AD](./media/application-proxy-network-topologies/application-proxy-pattern5c.png)

## <a name="next-steps"></a>Дальнейшие действия
[Включение прокси приложения](active-directory-application-proxy-enable.md)<br>
[Единый вход с помощью прокси приложения](active-directory-application-proxy-sso-using-kcd.md)<br>
[Работа с условным доступом](active-directory-application-proxy-conditional-access.md)<br>
[Устранение неполадок прокси-сервера приложений](active-directory-application-proxy-troubleshoot.md)





<!--HONumber=Feb17_HO1-->


