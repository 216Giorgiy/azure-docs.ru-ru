---
title: "Аспекты топологии сети при использовании прокси приложения Azure Active Directory | Документация Майкрософт"
description: "В этой статье рассматриваются аспекты топологии сети при использовании прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/12/2017
ms.author: kgremban
translationtype: Human Translation
ms.sourcegitcommit: 4b21bf6bc1be59facd503000a4f83a56189d55d3
ms.openlocfilehash: aea1b35348bec0affe2288ff683e0320e2b0f714
ms.lasthandoff: 02/28/2017


---

# <a name="network-topology-considerations-when-using-azure-active-directory-application-proxy"></a>Аспекты топологии сети при использовании прокси приложения Azure Active Directory
> [!NOTE]
> Прокси приложения — это функция, которая доступна только после обновления до выпуска Premium или Basic службы Azure Active Directory. Дополнительные сведения см. в разделе [Выпуски Azure Active Directory](active-directory-editions.md).
>

В этой статье рассматриваются аспекты топологии сети при использовании прокси приложения Azure Active Directory для публикации и удаленного доступа к приложениям.

## <a name="traffic-flow"></a>Поток трафика

При публикации приложения через прокси приложение Azure AD весь трафик, передаваемый от пользователей к целевым серверным приложениям, проходит через следующие прыжки:

* прыжок 1: от пользователя к общедоступной конечной точке службы прокси приложения Azure AD в Azure;
* прыжок 2: от службы прокси приложения к соединителю;
* прыжок 3: от соединителя к целевому приложению.

 ![Схема передачи трафика от пользователя к целевому приложению](./media/application-proxy-network-topologies/application-proxy-three-hops.png)

## <a name="tenant-location-and-application-proxy-service"></a>Расположение клиента и службы прокси приложения

При регистрации клиента Azure AD для него определяется регион размещения исходя из указанной вами страны. Когда вы включаете прокси приложения, экземпляры службы прокси приложения для вашего клиента отображаются в том же регионе, где находится клиент Azure AD, или в ближайшем к нему регионе.

Например, если для клиента Azure AD установлен регион "Европейский Союз", все соединители прокси приложения для него будут использовать экземпляры службы в центрах обработки данных Azure на территории ЕС. Это также означает, что при попытке доступа к опубликованным приложениям все пользователи подключаются через экземпляры службы прокси приложения в этом расположении.

## <a name="considerations-for-reducing-latency"></a>Рекомендации по уменьшению задержки

Любые решения прокси увеличивают задержку сетевого подключения. Независимо от того, какое решение прокси или VPN используется для удаленного доступа, любое из них содержит набор серверов для подключения к корпоративной сети.

Ранее организации размещали серверные конечные точки в сети периметра. Но прокси приложения Azure AD позволяет избавиться от сети периметра. Теперь трафик проходит через прокси-службу в облаке, а в корпоративной сети размещается только соединитель этой службы.

### <a name="connector-placement"></a>Расположение соединителя

Служба прокси приложения автоматически выбирает расположение экземпляров, исходя из расположения клиента. Вам остается выбрать место установки соединителя, и от него будут зависеть характеристики задержки для сетевого трафика.

Настраивая службу прокси приложения, задайте себе следующие вопросы.

* Где расположено приложение?
* Где находится больше всего пользователей, осуществляющих доступ к приложению?
* Где находится экземпляр прокси приложения (это зависит от расположения клиента)?
* Есть ли у вас выделенное сетевое подключение к центрам обработки данных Azure (например, Azure ExpressRoute или аналогичное VPN-подключение)?

Расположение соединителя определяет задержку для прыжков 2 и 3 (как описано в предыдущем разделе). При выборе расположения для соединителя необходимо учитывать следующее.

* Соединитель должен напрямую обращаться к центру обработки данных. Это необходимо для операций ограниченного делегирования Kerberos (KCD), которые используются при организации единого входа для серверных приложений.
* Соединитель обычно устанавливается близко к приложению, чтобы сократить время обмена данными между ними.

### <a name="general-approach-to-minimize-latency"></a>Общий подход к уменьшению задержки

Вы можете попробовать уменьшить сквозную задержку трафика, оптимизируя любой из прыжков сети. Каждый прыжок можно оптимизировать следующим образом:

* уменьшить расстояние между двумя конечными точками прыжка;
* выбрать нужную сеть для прохода (например, проход частной сети, а не общедоступного Интернета, может выполняться быстрее из-за выделенных каналов связи).

Можно использовать выделенный канал связи VPN или ExpressRoute между Azure и корпоративной сетью, если он у вас есть.

## <a name="focus-your-optimizing-strategy"></a>Ограничение стратегии оптимизации

Так как пользователи могут получить удаленный доступ к приложениям через Интернет, вам следует всегда акцентировать внимание на оптимизации прыжков 2 и 3. Далее приведены некоторые распространенные шаблоны, которые можно использовать.

### <a name="pattern-1-optimize-hop-3"></a>Шаблон 1. Оптимизация прыжка 3

Для оптимизации прыжка 3 соединитель размещается близко к целевому приложению в сети клиента. Это удобно тем, что соединитель получает "канал прямой видимости" к контроллеру домена, который может ему понадобиться. Этот подход достаточно хорош для большинства сценариев. (Именно его использует большинство наших клиентов.)

 ![Схема, демонстрирующая оптимизацию прыжка 3, в которой соединитель размещается рядом с целевым приложением](./media/application-proxy-network-topologies/application-proxy-hop3.png)


> [!NOTE]
В некоторых сценариях необходимо оптимизировать прыжки 2 и 3, чтобы получить нужные характеристики задержки. Например, если между сетью и центром обработки данных Azure настроено подключение VPN или ExpressRoute, этот сценарий позволяет оптимизировать оба этих прыжка.
>

### <a name="pattern-2-take-advantage-of-expressroute-with-public-peering"></a>Шаблон 2. Использование подключения ExpressRoute с общедоступным пирингом

Если у вас сеть подключение ExpressRoute с общедоступным пирингом, это быстрое подключение ExpressRoute можно использовать для ускорения прыжка 2. (Прыжок 3 при этом оптимизируется автоматически, поскольку соединитель будет расположен рядом с приложением в сети клиента.)

![Схема, демонстрирующая оптимизацию прыжка 2 путем использования подключения ExpressRoute](./media/application-proxy-network-topologies/application-proxy-expressroute-public.png)

### <a name="pattern-3-take-advantage-of-expressroute-with-private-peering"></a>Шаблон 3. Использование подключения ExpressRoute с частным пирингом

Если у вас есть выделенное подключение VPN или ExpressRoute с частным пирингом между Azure и корпоративной сетью, можно использовать другой вариант. В этой конфигурации виртуальная сеть в Azure обычно рассматривается как расширение корпоративной сети. Это означает, что вы можете установить соединитель в центре обработки данных Azure, сохраняя низкую задержку для прыжка 3, то есть для подключения соединителя к приложению.

Задержка не увеличится, так как трафик передается через выделенное подключение. И кроме того, вы дополнительно улучшаете характеристики задержки для прыжка 2. Это объясняется тем, что становится короче прыжок подключения службы прокси приложения к соединителю. Соединитель устанавливается в центре обработки данных Azure, рядом с расположением клиента Azure AD (а следовательно, и с прокси приложения).

![Схема, демонстрирующая установку соединителя в центре обработки данных Azure](./media/application-proxy-network-topologies/application-proxy-expressroute-private.png)

### <a name="other-approaches"></a>Другие подходы

Эта статья посвящена выбору расположения для соединителя, но для улучшения характеристик задержки вы можете также переместить само приложение.

Все больше организаций перемещают сети в размещенные среды. В этой ситуации приложения также могут мигрировать в размещенную среду, оставаясь в пределах корпоративной сети и домена. В шаблонах, которые описаны в предыдущем разделе, можно учесть новое расположение приложения.

Возможно, вас также заинтересует использование групп соединителей для целевых приложений, находящихся в разных расположениях и сетях. Если вы рассматриваете этот вариант, перейдите на страницу [Доменные службы Azure Active Directory](https://azure.microsoft.com/services/active-directory-ds).

## <a name="common-scenarios"></a>Распространенные сценарии

В этом разделе рассматриваются несколько вариантов использования. Предполагается, что клиент Azure AD (а значит, и конечная точка службы прокси) находится в США. Все аспекты, рассмотренные в описанных вариантах, почти всегда применимы и к другим регионам мира.

### <a name="use-case-1"></a>Вариант использования 1

Приложение находится в корпоративной сети в США, там же расположены и пользователи. Отсутствуют подключения ExpressRoute или VPN между контроллером домена Azure и корпоративной сетью.

**Рекомендация:** примените шаблон 1, как описано в предыдущем разделе. Если необходимо уменьшить задержку, рассмотрите возможность создать подключение ExpressRoute.

Это простой шаблон. Вы оптимизируете прыжок 3, размещая соединитель рядом с приложением. Это самый естественный вариант, поскольку соединителю требуется "прямая видимость" приложения и центра обработки данных, чтобы выполнять операции ограниченного делегирования Kerberos.

![Схема размещения с очертаниями США и траекторией прыжков в этом варианте использования](./media/application-proxy-network-topologies/application-proxy-pattern1.png)

### <a name="use-case-2"></a>Вариант использования 2

Приложение находится в корпоративной сети в США, а пользователи распределены по всему миру. Отсутствуют подключения ExpressRoute или VPN между контроллером домена Azure и корпоративной сетью.

**Рекомендация:** примените шаблон 2, как описано в предыдущем разделе. Если необходимо уменьшить задержку, рассмотрите возможность создать подключение ExpressRoute.

Здесь снова наиболее применима оптимизация прыжка 3 за счет размещения соединителя рядом с приложением. Обычно прыжок 3 не будет дорогим, если он полностью проходит в одном регионе. Но прыжок 1 может оказаться намного дороже в зависимости от расположения пользователя, так как все пользователи обращаются к одному экземпляру прокси приложения, размещенному в США. Следует отметить, что в случае глобального распределения пользователя любые решения прокси будет иметь сходные характеристики.

![Схема размещения с очертаниями континентов и траекторией прыжков в этом варианте использования](./media/application-proxy-network-topologies/application-proxy-pattern2.png)

### <a name="use-case-3"></a>Вариант использования 3

Приложение находится в корпоративной сети клиента на территории США. Между Azure и корпоративной сетью установлено подключение ExpressRoute с общедоступным пирингом.

**Рекомендация:** разместите соединитель как можно ближе к приложению. Система автоматически использует ExpressRoute для прыжка 2. Это соответствует шаблону 2, как описано в предыдущем разделе.

Если канал связи ExpressRoute использует общедоступный пиринг, трафик между прокси и соединителем будет проходить через этот канал связи. Задержка для прыжка 2 будет оптимизирована.

![Схема размещения с очертаниями США и траекторией прыжков в этом варианте использования](./media/application-proxy-network-topologies/application-proxy-pattern3.png)

### <a name="use-case-4"></a>Вариант использования 4

Приложение находится в корпоративной сети клиента на территории США. Между Azure и корпоративной сетью установлено подключение ExpressRoute с частным пирингом.

**Рекомендация:** разместите соединитель в центре обработки данных Azure, который подключен к корпоративной сети через частный пиринг ExpressRoute. Это соответствует шаблону 3, как описано в предыдущем разделе.

Соединитель можно разместить в центре обработки данных Azure. Так как соединитель по-прежнему имеет "прямую видимость" приложения и центра обработки данных через частную сеть, прыжок 3 остается оптимизированным. Кроме того, теперь оптимизирован и прыжок 2.

![Схема размещения с очертаниями США и траекторией прыжков в этом варианте использования](./media/application-proxy-network-topologies/application-proxy-pattern4.png)

### <a name="use-case-5"></a>Вариант использования 5

Приложение находится в корпоративной сети в ЕС, а большинство пользователей расположено в США.

**Рекомендация:** разместите соединитель рядом с приложением. Так как пользователи США обращаются к экземпляру прокси приложения, размещенному в одном с ними регионе, прыжок 1 не будет слишком дорогим. Прыжок 3 оптимизирован. В этом варианте использования обычно самым дорогим будет прыжок 2.

![Схема размещения с очертаниями континентов и траекторией прыжков в этом варианте использования](./media/application-proxy-network-topologies/application-proxy-pattern5a.png)

Рекомендуется использовать ExpressRoute, как описано в предыдущих разделах, посвященных шаблонам 2 и 3.

![Схема размещения с очертаниями континентов и траекторией прыжков в этом варианте использования](./media/application-proxy-network-topologies/application-proxy-pattern5b.png)

Также в этой ситуации можно применить еще один вариант. Если большинство пользователей организации находятся в США, возможно ваша сеть уже "расширена" в этот регион. Тогда вы можете разместить соединитель в США и использовать выделенный канал внутренней корпоративной сети для обращений к приложению в ЕС. Этот позволит оптимизировать прыжки 2 и 3.

![Схема размещения с очертаниями континентов и траекторией прыжков в этом варианте использования](./media/application-proxy-network-topologies/application-proxy-pattern5c.png)

## <a name="next-steps"></a>Дальнейшие действия
[Включение прокси приложения](active-directory-application-proxy-enable.md)<br>
[Единый вход с помощью прокси приложения](active-directory-application-proxy-sso-using-kcd.md)<br>
[Работа с условным доступом](active-directory-application-proxy-conditional-access.md)<br>
[Устранение неполадок прокси-сервера приложений](active-directory-application-proxy-troubleshoot.md)

