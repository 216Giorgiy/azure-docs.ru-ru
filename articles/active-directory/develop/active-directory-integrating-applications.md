---
title: "Интеграция приложений с Azure Active Directory | Документация Майкрософт"
description: "Сведения о том, как добавить, обновить или удалить приложение в Active Directory (Azure AD)."
services: active-directory
documentationcenter: 
author: bryanla
manager: mbaldwin
editor: mbaldwin
ms.assetid: ae637be5-0b71-4b1e-b1fe-b83df3eb4845
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 10/29/2016
ms.author: mbaldwin;bryanla
translationtype: Human Translation
ms.sourcegitcommit: c579135f798ea0c2a5461fdd7c88244d2d6d78c6
ms.openlocfilehash: 46629edd59fa51e127fe4a4b61ff7de753dd7e68


---
# <a name="integrating-applications-with-azure-active-directory"></a>Интеграция приложений с Azure Active Directory
[!INCLUDE [active-directory-devguide](../../../includes/active-directory-devguide.md)]

Разработчики корпоративных решений и поставщики программного обеспечения как услуги (SaaS) могут разрабатывать коммерческие облачные службы или бизнес-приложения, которые можно интегрировать с Azure Active Directory (Azure AD) для обеспечения безопасного входа и авторизации для служб. Чтобы интегрировать приложение или службу с Azure AD, разработчику сначала необходимо зарегистрировать сведения о своем приложении в Azure AD с помощью классического портала управления Azure.

В этой статье показано, как добавить, обновить или удалить приложение в Azure AD. Вы узнаете о различных типах приложений, которые можно интегрировать с Azure AD, способах настройки приложений для доступа к другим ресурсам, таким как веб-API, и многое другое.

Дополнительные сведения об объектах, которые представляют зарегистрированное приложение, и отношениях между ними см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](active-directory-application-objects.md). Рекомендации по фирменной символике, которых следует придерживаться при разработке приложений с помощью Azure Active Directory, см. в статье [Рекомендации по фирменной символике для приложений](active-directory-branding-guidelines.md).

## <a name="adding-an-application"></a>Добавление приложения
Все приложения, которые будут использовать возможности Azure AD, сначала следует зарегистрировать в клиенте Azure AD. Этот процесс регистрации включает в себя предоставление Azure AD сведений о приложении, например URL-адреса, по которому оно расположено, URL-адреса для отправки ответов после проверки подлинности пользователя, URI, идентифицирующего приложение, и т. д.

При создании веб-приложения, в котором требуется только поддержка входа для пользователей в Azure AD, можно просто следовать приведенным ниже инструкциям. Если вашему приложению для доступа к веб-API требуются учетные данные или оно должно поддерживать доступ пользователей из других клиентов Azure AD, см. раздел [Обновление приложения](#updating-an-application), чтобы продолжить настройку приложения.

### <a name="to-register-a-new-application-in-the-azure-classic-portal"></a>Регистрация приложения на классическом портале управления Azure
1. Войдите на [классический портал Azure](https://manage.windowsazure.com).
2. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.
3. В верхнем меню щелкните **Приложения**. Если в каталоге нет добавленных приложений, на этой странице отображается только ссылка "Добавить приложение". Щелкните ссылку или нажмите кнопку **Добавить** на панели команд.
4. На странице "Что необходимо сделать?" щелкните ссылку **Добавить приложение, разрабатываемое моей организацией**.
5. На странице "Расскажите о своем приложении" следует указать имя для вашего приложения, а также тип регистрируемого в Azure AD приложения.  Можно выбрать такие типы приложений, как [веб-приложение или клиент](active-directory-dev-glossary.md#client-application) / [веб-ресурс или API](active-directory-dev-glossary.md#resource-server) (может функционировать как оба) или [собственное клиентское приложение](active-directory-dev-glossary.md#native-client). По завершении нажмите кнопку со стрелкой в правом нижнем углу страницы.
6. На странице "Свойства приложения" укажите URL-адрес входа и URI кода приложения для регистрируемого веб-приложения или просто URI перенаправления для собственного клиентского приложения, а затем установите флажок в правом нижнем углу страницы.
7. Приложение добавляется в систему, и выполняется переход на страницу быстрого запуска для вашего приложения. В зависимости от того, является ли ваше приложение веб-приложением или собственным приложением, вы увидите различные параметры для добавления дополнительных возможностей в приложение. После добавления приложения можно начать его обновление, чтобы пользователи могли выполнить вход, получить доступ к веб-API в других приложениях или настроить мультитенантное приложение (что позволяет другим организациям осуществлять доступ к вашему приложению).

> [!NOTE]
> По умолчанию регистрация вновь созданного приложения позволяет пользователям из вашего каталога выполнять вход в это приложение.
> 
> 

## <a name="updating-an-application"></a>Обновление приложения
После регистрации приложения в Azure AD может потребоваться обновить его для предоставления доступа к веб-API, обеспечения доступа из других организаций и в других целях. В этом разделе описываются различные способы дальнейшей настройки приложения. Мы начнем с обзора платформы согласия. Ее важно понять, если вы создаете приложения ресурсов или API, которые будут использоваться клиентскими приложениями, создаваемыми разработчиками в вашей или другой организации.

Дополнительные сведения о принципах работы проверки подлинности в Azure AD см. в статье [Сценарии аутентификации в Azure Active Directory](active-directory-authentication-scenarios.md).

### <a name="overview-of-the-consent-framework"></a>Обзор платформы согласия
Платформа согласия Azure AD упрощает разработку веб-приложений или собственных клиентских приложений с несколькими клиентами, которым требуется доступ к веб-API, защищенным клиентом Azure AD, отличающимся от клиента, в котором зарегистрировано клиентское приложение. Эти веб-API включают в себя API Graph, Office 365 и другие службы Майкрософт, дополняющие ваши собственные веб-API. Эта платформа использует согласие пользователя или администратора на регистрацию приложения в своем каталоге, что может включать в себя доступ к данным каталога.

Например, если веб-приложению необходимо вызвать веб-API или приложение ресурсов Office 365 для считывания сведений календаря пользователя, этот пользователь должен дать согласие на обращение к клиентскому приложению. После предоставления такого разрешения клиентское приложение сможет вызывать веб-API Office 365 от имени этого пользователя и пользоваться сведениями календаря по мере необходимости.

Платформа согласия основана на OAuth 2.0 и различных его процедурах, таких как предоставление кода авторизации и учетных данных пользователя, с помощью общедоступных или конфиденциальных клиентов. Благодаря OAuth 2.0 среда Azure AD позволяет создавать множество различных клиентских приложений, например на телефоне, планшете, сервере или в Интернете, и получить доступ к необходимым ресурсам.

Более подробные сведения о платформе согласия см. в статьях [Авторизация доступа к веб-приложениям с помощью OAuth 2.0 и Azure Active Directory](https://msdn.microsoft.com/library/azure/dn645545.aspx), [Сценарии аутентификации в Azure Active Directory](active-directory-authentication-scenarios.md) и статье, посвященной Office 365, [Understanding authentication with Office 365 APIs](https://msdn.microsoft.com/office/office365/howto/common-app-authentication-tasks) (Проверка подлинности с помощью API Office 365).

#### <a name="example-of-the-consent-experience"></a>Пример процедуры согласия
Ниже показаны особенности работы процедуры согласия для разработчика приложений и пользователя.

1. Задайте необходимые приложению разрешения на странице настройки приложения веб-клиента на классическом портале Azure, используя раскрывающиеся меню в элементе управления "Разрешения для других приложений".
   
    ![Разрешения для других приложений](./media/active-directory-integrating-applications/permissions.png)
2. Представим себе, что разрешения вашего приложения были обновлены, само приложение запущено, а пользователь собирается воспользоваться им в первый раз. Если приложение еще не получило токен доступа или обновления, ему следует перейти к конечной точке авторизации Azure AD для получения кода авторизации, который можно использовать для получения нового токена доступа и обновления.
3. Если пользователь еще не прошел проверку подлинности, ему предлагается выполнить вход в Azure AD.
   
    ![Вход пользователя или администратора в Azure AD](./media/active-directory-integrating-applications/useradminsignin.png)
4. После входа Azure AD определяет, требуется ли отобразить этому пользователю страницу согласия. Принятие этого решения основано на том, дал ли этот пользователь (или администратор его организации) свое согласие для приложения. Если согласие еще не было дано, Azure AD запрашивает у пользователя согласие и отображает необходимые для этого разрешения. Набор разрешений, который отображается в диалоговом окне согласия, совпадает с разрешениями, выбранными в элементе управления "Разрешения для других приложений" на классическом портале Azure.
   
    ![Процедура использования согласия пользователей](./media/active-directory-integrating-applications/userconsent.png)
5. После того как пользователь дает свое согласие, в ваше приложение возвращается код авторизации, который можно использовать для получения токена доступа и токена обновления. Дополнительные сведения об этой процедуре см. в разделе [Из веб-приложения к веб-интерфейсу API](active-directory-authentication-scenarios.md#web-application-to-web-api) статьи [Сценарии аутентификации в Azure Active Directory](active-directory-authentication-scenarios.md).

### <a name="configuring-a-client-application-to-access-web-apis"></a>Настройка клиентского приложения для доступа к веб-API
Чтобы клиентское веб-приложение или конфиденциальное клиентское приложение могло участвовать в потоке предоставления кода авторизации, требующего проверки подлинности (и получения маркера доступа), в нем нужно задать защищенные учетные данные. По умолчанию на портале Azure используется метод проверки подлинности "идентификатор клиента + симметричный ключ". В этом разделе рассматриваются шаги настройки, необходимые для предоставления секретного ключа учетных данных клиента.

Кроме того, чтобы клиент смог получить доступ к веб-API, предоставляемому приложением ресурсов (например, Azure AD Graph API), платформа согласия должна позволить ему получить требуемое разрешение в зависимости от запрошенных разрешений. По умолчанию все приложения могут выбирать разрешения из Azure Active Directory (API Graph) и API управления службами Azure, при этом разрешение Enable sign on and read user’s profile (Включить вход и чтение профиля пользователя) Azure AD уже выбрано по умолчанию. Если клиентское приложение регистрируется в клиенте Azure AD Office 365, веб-API и разрешения для SharePoint и Exchange Online также будут доступны для выбора. В раскрывающихся меню рядом с нужным веб-API можно выбрать один из [двух типов разрешений](active-directory-dev-glossary.md#permissions).

* Разрешения приложения: вашему клиентскому приложению требуется доступ к веб-API от своего имени (без контекста пользователя). Этот тип разрешения требует согласия администратора и недоступен для собственных клиентских приложений.
* Делегированное разрешение: вашему приложению требуется доступ к веб-API от лица выполнившего вход пользователя, но с ограничением доступа по выбранному разрешению. Этот тип разрешения может быть предоставлен пользователем, если только для разрешения не настроено обязательное согласие администратора.

#### <a name="to-add-credentials-or-permissions-to-access-web-apis"></a>Добавление учетных данных или разрешений для доступа к веб-API
1. Войдите на [классический портал Azure](https://manage.windowsazure.com)
2. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.
3. В верхнем меню нажмите **Приложения**и выберите приложение, которое требуется настроить. Отображается  страница быстрого запуска с единым входом и другими сведениями о конфигурации. Щелкните ссылку **Настроить** в верхней части страницы, чтобы перейти на страницу настройки приложения.
4. Чтобы добавить свой секретный ключ для учетных данных веб-приложения, прокрутите вниз до раздела "Ключи".  
   
   * Сначала щелкните раскрывающийся список "Выбрать длительность" и выберите 1 или 2 года. 
   * После этого появится новая строка с заполненными датами "Действителен с" и "Истекает".
   * Правый столбец будет содержать значение ключа после сохранения изменений конфигурации (описано ниже). Нажав кнопку "Сохранить", вернитесь к этому разделу и скопируйте это значение, чтобы вы могли использовать его в клиентском приложении для проверки подлинности во время выполнения.
5. Чтобы добавить разрешения на доступ к API ресурсов из клиента, прокрутите вниз к разделу "Разрешения для других приложений". 
   
   * Сначала нажмите кнопку "Добавить приложение".
   * Выберите необходимый тип ресурсов в раскрывающемся списке "Показать".
   * В первом столбце представлен список доступных приложений ресурсов в каталоге, предоставляющих доступ к веб-API. Выберите нужный ресурс, а затем щелкните значок галочки в правом нижнем углу.
   * После этого в список "Разрешения для других приложений" будет добавлен выбранный ресурс.
   * Выберите нужные разрешения для клиентского приложения с помощью раскрывающихся списков "Разрешения приложения" и "Делегированные разрешения".
6. По завершении нажмите кнопку **Сохранить** на панели команд. Если вы указали ключ для приложения, он также будет создан после того, как вы нажмете эту кнопку.

> [!NOTE]
> При нажатии кнопки "Сохранить" также автоматически задаются разрешения для приложения в каталоге на основе настроенных значений "Разрешения для других приложений".  Эти разрешения можно просмотреть  на вкладке "Свойства" приложения.
> 
> 

### <a name="configuring-a-resource-application-to-expose-web-apis"></a>Настройка приложения ресурсов для предоставления веб-API
Вы можете разработать веб-API и сделать его доступным для клиентских приложений, предоставив [области доступа](active-directory-dev-glossary.md#scopes) и [роли](active-directory-dev-glossary.md#roles). Доступ к правильно настроенному веб-API предоставляется по аналогии с другими веб-API корпорации Майкрософт, включая API Graph и API Office 365. Области доступа и роли задаются с помощью [манифеста приложения](active-directory-dev-glossary.md#application-manifest), JSON-файла, который представляет собой конфигурацию удостоверения приложения.  

Ниже показано, как задать области доступа, изменив манифест приложения ресурсов.

#### <a name="adding-access-scopes-to-your-resource-application"></a>Добавление областей доступа в приложение ресурсов
1. Войдите на [классический портал Azure](https://manage.windowsazure.com).
2. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.
3. В верхнем меню щелкните элемент **Приложения**и выберите приложение ресурсов, которое требуется настроить. Отображается  страница быстрого запуска с единым входом и другими сведениями о конфигурации.
4. На панели команд нажмите кнопку **Управление манифестом** и выберите **Загрузить манифест**.
5. Откройте JSON-файл манифеста приложения и замените узел oauth2Permissions следующим фрагментом JSON-кода. В этом фрагменте приведен пример предоставления области доступа, которая называется "олицетворением пользователя", позволяющей владельцу ресурса предоставлять клиентскому приложению тип делегированного доступа к ресурсу. Не забудьте изменить текст и значения для своего приложения:
   
        "oauth2Permissions": [
        {
            "adminConsentDescription": "Allow the application full access to the Todo List service on behalf of the signed-in     user",
            "adminConsentDisplayName": "Have full access to the Todo List service",
            "id": "b69ee3c9-c40d-4f2a-ac80-961cd1534e40",
            "isEnabled": true,
            "type": "User",
            "userConsentDescription": "Allow the application full access to the todo service on your behalf",
            "userConsentDisplayName": "Have full access to the todo service",
            "value": "user_impersonation"
            }
        ],
   
    В качестве значения идентификатора должен выступать новый GUID, созданный с помощью [специального средства](https://msdn.microsoft.com/library/ms241442%28v=vs.80%29.aspx) или программным способом. Оно представляет уникальный идентификатор для разрешения, предоставляемого веб-API. Когда клиент настроен должным образом для запроса доступа к веб-API и вызывает веб-API, он будет представлять токен JWT OAuth 2.0, у которого для утверждения (scp) области задано указанное выше значение (в данном случае это user_impersonation).
   
   > [!NOTE]
   > Позднее вы можете по мере необходимости предоставлять дополнительные области доступа. Помните о том, что веб-API может предоставлять несколько областей, связанных с множеством разных функций. Теперь вы можете управлять доступом к веб-API с помощью утверждения (scp) области в полученном токене JWT OAuth 2.0.
   > 
   > 
6. Сохраните обновленный JSON-файл и отправьте его. Для этого на панели команд нажмите кнопку **Управление манифестом**, выберите команду **Отправить манифест**, перейдите к обновленному файлу манифеста и выберите его. После отправки веб-API настроен для использования другими приложениями в каталоге.

#### <a name="to-verify-the-web-api-is-exposed-to-other-applications-in-your-directory"></a>Для проверки доступности веб-API другим приложениям каталога
1. В верхнем меню щелкните пункт **Приложения**, выберите нужное клиентское приложение, для которого необходимо настроить доступ к веб-API, и нажмите кнопку **Настроить**.
2. Выполните прокрутку вниз до раздела "Разрешения для других приложений". Щелкните раскрывающееся меню "Выбор приложения", чтобы получить возможность выбрать веб-API, для которого только что было предоставлено разрешение. В раскрывающемся меню "Делегированные разрешения" выберите новое разрешение.

![Показаны разрешения списка задач](./media/active-directory-integrating-applications/listpermissions.png)

#### <a name="more-on-the-application-manifest"></a>Дополнительная информация о манифесте приложения
На самом деле манифест приложения является механизмом обновления сущности "Приложение", который определяет все атрибуты конфигурации удостоверения приложения Azure AD, в том числе области доступа API, рассмотренные выше. Дополнительные сведения см. в разделе, посвященном сущности "Приложение" (в [документации по сущности "Приложение API Graph"](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity)). В этом разделе вы найдете полную информацию об элементах сущности "Приложение", которые используются при указании разрешений для API:  

* элемент appRoles — коллекция сущностей [AppRole](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#approle-type), которые можно использовать при определении **разрешений приложения** для веб-API;  
* элемент oauth2Permissions — коллекция сущностей [OAuth2Permission](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#oauth2permission-type), которые можно использовать при определении **делегированных разрешений** для веб-API.

Дополнительные сведения о концепции манифеста приложения см. в статье [Основные сведения о манифесте приложения Azure Active Directory](active-directory-application-manifest.md).

### <a name="accessing-the-azure-ad-graph-and-office-365-apis"></a>Доступ к Azure AD Graph и API Office 365
Как упоминалось ранее, наряду с предоставлением доступа к API в ваших приложениях ресурсов вы также можете обновить клиентское приложение для доступа к API, которые предоставляются ресурсами Майкрософт.  API Graph Azure AD, который называется Azure Active Directory в списке разрешений для других приложений, доступен по умолчанию для всех приложений, которые зарегистрированы в Azure AD. Если вы регистрируете клиентское приложение в клиенте Azure AD, который был подготовлен Office 365, вам также будут доступны все разрешения, предоставляемые API-интерфейсами к различным ресурсам Office 365.

Полную информацию об областях доступа можно найти на следующих ресурсах.  

* Описание областей разрешений, предоставляемых API Graph Azure AD, см. в статье [Области разрешений | Основные понятия API Graph](https://msdn.microsoft.com/Library/Azure/Ad/Graph/howto/azure-ad-graph-api-permission-scopes).
* Описание API Office 365 см. в статье [Authentication and Authorization using Common Consent Framework](https://msdn.microsoft.com/office/office365/howto/application-manifest) (Проверка подлинности и авторизация с помощью общей платформы согласия). Дополнительные сведения о создании клиентского приложения, которое интегрируется с API Office 365, см. в статье [Set up your Office 365 development environment](https://msdn.microsoft.com/office/office365/HowTo/setup-development-environment) (Настройка среды разработки Office 365).

> [!NOTE]
> Из-за имеющихся в данный момент ограничений собственные клиентские приложения могут вызывать API Graph Azure AD только при использовании разрешения Access your organization's directory (Доступ к каталогу организации).  Это ограничение не распространяется на веб-приложения.
> 
> 

### <a name="configuring-multi-tenant-applications"></a>Настройка мультитенантных приложений
При добавлении приложения Azure AD вам может потребоваться предоставить доступ к этому приложению только пользователям в вашей организации. Кроме того, может потребоваться, чтобы доступ к приложению могли получить пользователи из других организаций. Два этих типа приложений называются однотенантными и мультитенантными. Можно изменить конфигурацию отдельного однотенантного приложения, чтобы сделать его мультитенантным, что рассмотрено ниже.

Следует отметить различия между однотенантным и мультитенантным приложением.  

* Однотенантное (для одного клиента) приложение предназначено для использования в одной организации. Обычно это бизнес-приложения (LoB), которые создает разработчик компании. Однотенантное приложение предоставляет пользователям доступ только в одном каталоге. В результате, его достаточно подготовить в одном каталоге.
* Мультитенантное (для нескольких клиентов) приложение предназначено для использования в нескольких организациях. Как правило, это веб-приложение категории "программное обеспечение как услуга" (SaaS), созданное независимым поставщиком программного обеспечения (ISV). Мультитенантные приложения необходимо подготавливать в каждом каталоге, где они будут использоваться. Следовательно, для их регистрации требуется предоставление разрешений пользователем или администратором с помощью инфраструктуры согласия Azure AD. Обратите внимание, что все собственные клиентские приложения являются мультитенантными по умолчанию, так как они установлены на устройстве владельца ресурсов. Дополнительные сведения об инфраструктуре согласия см. в разделе "Обзор инфраструктуры согласия" выше.

#### <a name="enabling-external-users-to-grant-your-application-access-to-their-resources"></a>Предоставление внешним пользователям возможности открывать вашему приложению доступ к своим ресурсам
При создании приложения, которое требуется сделать доступным для клиентов или партнеров за пределами вашей организации, необходимо обновить определение приложения на классическом портале Azure.

> [!NOTE]
> При включении поддержки нескольких клиентов необходимо убедиться, что URI идентификатора приложения принадлежит к проверенному домену. Кроме того, URL-адрес возврата должен начинаться с https://. Дополнительные сведения см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](active-directory-application-objects.md).
> 
> 

Чтобы предоставить доступа к вашему приложению внешним пользователям, выполните следующие действия. 

1. Войдите на [классический портал Azure](https://manage.windowsazure.com)
2. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.
3. В верхнем меню нажмите **Приложения**и выберите приложение, которое требуется настроить. Отобразится страница быстрого запуска с параметрами конфигурации.
4. На странице быстрого запуска разверните раздел **Настройка мультитенантного приложения**, а затем в разделе "Включение доступа" щелкните ссылку **Настроить сейчас**. Отображается страница свойств приложения.
5. Рядом с элементом "Приложение является мультитенантным" нажмите кнопку **Да**, а затем на панели команд нажмите кнопку **Сохранить**.

После внесения указанных выше изменений пользователи и администраторы в других организациях смогут предоставить вашему приложению доступ к их каталогу и другим данным.

#### <a name="triggering-the-azure-ad-consent-framework-at-runtime"></a>Активация инфраструктуры согласия Azure AD во время выполнения
Чтобы использовать инфраструктуру согласия, мультитенантное приложение должно запросить авторизацию с помощью OAuth 2.0. Доступны [примеры кода](https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multi-tenant), демонстрирующие, как веб-приложение, собственное приложение, а также серверное или управляющее приложение запрашивают коды авторизации и маркеры доступа для вызова веб-API.

Веб-приложение может предлагать пользователям пройти регистрацию. Если вы предлагаете процедуру регистрации, предполагается, что пользователь нажмет кнопку регистрации, которая перенаправит браузер на конечную точку authorize OAuth 2.0 Azure AD или конечную точку userinfo OpenID Connect. Эти конечные точки позволяют приложению получить сведения о новом пользователе путем проверки id_token. На следующем этапе регистрации пользователя появится запрос на согласие, как показано в разделе "Обзор инфраструктуры согласия" выше.

Кроме того, веб-приложение может также предлагать процедуру, позволяющую администраторам зарегистрировать компанию. Эта процедура также перенаправляет пользователя на конечную точку "authorize" OAuth 2.0 Azure AD. В этом случае вы также можете передать параметр prompt=admin_consent на конечную точку авторизации для запуска процедуры получения согласия администратора, где администратор предоставит согласие от имени своей организации. Только пользователь, выполняющий проверку подлинности с помощью учетной записи, принадлежащей роли глобального администратора, может предоставить согласие. Остальные пользователи увидят сообщение об ошибке. После успешного получения согласия ответ будет содержать admin_consent=true. При активации токена доступа вы также получите id_token, предоставляющий сведения об организации и администраторе, зарегистрированных для приложения.

### <a name="enabling-oauth-20-implicit-grant-for-single-page-applications"></a>Включение неявного предоставления авторизации OAuth 2.0 для одностраничных приложений
В одностраничных приложениях (SPA) обычно используется клиент с большим объемом кода на JavaScript, который выполняется в браузере и вызывает веб-API серверного приложения для выполнения своих операций бизнес-логики. Для одностраничных приложений, размещенных в Azure AD, проверка подлинности пользователя в Azure AD выполняется с помощью протокола OAuth 2.0 Implicit Grant. После этого пользователь получает маркер, который можно использовать для безопасных вызовов серверного веб-API из клиентского кода JavaScript приложения. После того как пользователь предоставил свое согласие, этот же протокол проверки подлинности можно использовать для получения маркеров для защиты вызовов между клиентом и другими ресурсами веб-API, которые настроены для приложения. Дополнительные сведения о процессе неявного предоставления авторизации и его совместимости с вашим приложением см. в статье [Общие сведения о неявном потоке предоставления OAuth2 в Azure Active Directory (AD)](active-directory-dev-understanding-oauth2-implicit-grant.md).

По умолчанию неявное предоставление авторизации OAuth 2.0 для приложений отключено. Вы можете включить протокол OAuth 2.0 Implicit Grant для приложения, задав значение `oauth2AllowImplicitFlow` в [манифесте приложения](active-directory-application-manifest.md) — JSON-файле, который представляет собой конфигурацию удостоверения приложения.

#### <a name="to-enable-oauth-20-implicit-grant"></a>Чтобы включить неявное предоставление авторизации OAuth 2.0, выполните следующие действия.
1. Войдите на [классический портал Azure](https://manage.windowsazure.com)
2. Щелкните значок **Active Directory** в меню слева, а затем выберите нужный каталог.
3. В верхнем меню нажмите **Приложения**и выберите приложение, которое требуется настроить. Отображается  страница быстрого запуска с единым входом и другими сведениями о конфигурации.
4. На панели команд нажмите кнопку **Управление манифестом** и выберите **Загрузить манифест**.
   Откройте файл манифеста приложения JSON и установите значение параметра oauth2AllowImplicitFlow в true. По умолчанию значение этого параметра равно false.
   
    `"oauth2AllowImplicitFlow": true,`
5. Сохраните обновленный JSON-файл и отправьте его. Для этого на панели команд нажмите кнопку **Управление манифестом**, выберите команду **Отправить манифест**, перейдите к обновленному файлу манифеста и выберите его. После загрузки файла манифеста протокол OAuth 2.0 Implicit Grant настроен для проверки подлинности пользователей веб-API.

### <a name="legacy-experiences-for-granting-access"></a>Устаревшая процедура предоставления доступа
В этом разделе описывается устаревшая процедура получения согласия, которая действовала до 12 марта 2014 г. Эта описанная ниже процедура  по-прежнему поддерживается. До появления новых функциональных возможностей можно было предоставлять только следующие разрешения:

* Вход пользователей из их организации
* Вход пользователей и чтение данных каталога их организации (только от имени приложения)
* Вход пользователей и чтение/запись данных каталога их организации (только от имени приложения)

Выполните действия, описанные в статье [Разработка мультитенантных веб-приложений с помощью Azure AD](https://msdn.microsoft.com/library/azure/dn151789.aspx) , чтобы предоставить доступ новым приложениям, зарегистрированных в Azure AD. Следует отметить, что новая платформа согласия позволяет значительно расширить функциональность приложений, а также позволяет пользователям, а не только администраторам, давать согласие для этих приложений.

#### <a name="building-the-link-that-grants-access-for-external-users-legacy"></a>Создание ссылки для доступа внешних пользователей (предыдущие версии)
Чтобы внешние пользователи могли зарегистрироваться для вашего приложения с помощью своих учетных записей в организации, необходимо обновить приложение для отображения кнопки со ссылкой на страницу в Azure AD, которая позволяет предоставить им необходимый доступ. Рекомендации по фирменной символике для этой кнопки регистрации приведены в статье [Рекомендации по фирменной символике для приложений](active-directory-branding-guidelines.md). После того как пользователь предоставляет или запрещает доступ, страница предоставления доступа Azure AD перенаправляет браузер обратно в ваше приложение с ответом. Дополнительные сведения о свойствах приложений см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](active-directory-application-objects.md).

Azure AD создает страницу предоставления доступа, ссылку на которую можно найти на странице конфигурации приложения на классическом портале Azure. Чтобы открыть страницу конфигурации, в верхнем меню вашего клиента Azure AD щелкните ссылку **Приложения**, выберите приложение, которое требуется настроить, а затем в верхнем меню страницы быстрого запуска щелкните **Настроить**.

Ссылка на ваше приложение будет выглядеть следующим образом: `http://account.activedirectory.windowsazure.com/Consent.aspx?ClientID=058eb9b2-4f49-4850-9b78-469e3176e247&RequestedPermissions=DirectoryReaders&ConsentReturnURL=https%3A%2F%2Fadatum.com%2FExpenseReport.aspx%3FContextId%3D123456`. В следующей таблице описаны части этой ссылки:

| Параметр | Описание |
| --- | --- |
| ClientId |обязательный параметр. Идентификатор клиента, полученный при добавлении приложения. |
| RequestedPermissions |необязательный параметр. Запрашиваемый приложением уровень доступа, который будет отображаться тому пользователю, который предоставляет доступ для вашего приложения. Если значение не указано, запрашиваемый уровень доступа по умолчанию будет включать в себя только единый вход. Другими параметрами являются DirectoryReaders и DirectoryWriters. Дополнительные сведения об этих уровнях доступа см. в статье "Уровни доступа приложения". |
| ConsentReturnUrl |необязательный параметр. URL-адрес, на которых необходимо возвратить ответ о предоставлении доступа. Это значение должно иметь кодировку URL-адреса и должно относиться к тому же домену, что и URL-адрес ответа, настроенный в определении приложения. Если значение не указано, ответ о предоставлении доступа будет перенаправлен на настроенный URL-адрес ответа. |

Указание ConsentReturnUrl отдельно от URL-адреса ответа позволяет приложению реализовать отдельную логическую схему, которая может обработать ответ на URL-адрес, отличный от URL-адреса ответа (который обычно используется при обработке токенов SAML для входа). Можно также указать дополнительные параметры в URL-адресе в кодировке ConsentReturnURL, которые при перенаправлении передаются обратно в приложение в качестве параметров строки запроса.  Этот механизм можно использовать для хранения дополнительных сведений или для связывания запроса приложения на предоставление прав доступа с ответом от Azure AD.

#### <a name="grant-access-user-experience-and-response-legacy"></a>Предоставление доступа: взаимодействие с пользователем и ответ (предыдущие версии)
На следующих изображениях показан интерфейс, с которым сталкивается пользователь, когда приложение выполняет перенаправление по ссылке предоставления доступа.

Если пользователь еще не выполнил вход, ему будет предложено это сделать:

![Вход в AAD](./media/active-directory-integrating-applications/signintoaad.png)

После прохождения пользователем проверки подлинности Azure AD перенаправляет его на страницу предоставления доступа:

![Предоставление доступа](./media/active-directory-integrating-applications/grantaccess.png)

> [!NOTE]
> Только администратор компании во внешней организации может предоставлять доступ к вашему приложению. Если пользователь не является администратором компании, он получает возможность отправить сообщение администратору своей компании, чтобы запросить доступ для данного приложения.
> 
> 

После того как клиент предоставил доступ для вашего приложения, нажав кнопку "Предоставление доступа", или запретил доступ, нажав кнопку "Отмена", Azure AD отправляет ответ на ConsentReturnUrl или настроенный URL-адрес ответа. Этот ответ содержит следующие параметры:

| Параметр | Описание |
| --- | --- |
| TenantId |Уникальный идентификатор организации в Azure AD, которая предоставила доступ для вашего приложения. Этот параметр будет указан только в том случае, если клиент предоставил доступ. |
| Согласие на предоставление разрешений |Для этого параметра будет задано значение "Granted", если доступ для приложения был предоставлен, или значение "Denied", если запрос был отклонен. |

Дополнительные параметры возвращаются в приложение, если они были указаны в составе URL-адреса в кодировке ConsentReturnUrl. Ниже приведен пример ответа на запрос о предоставлении доступа, который указывает, что приложение авторизовано, а также содержит идентификатор ContextID, который был указан в запросе о предоставлении доступа: `https://adatum.com/ExpenseReport.aspx?ContextID=123456&Consent=Granted&TenantId=f03dcba3-d693-47ad-9983-011650e64134`.

> [!NOTE]
> Ответ о предоставлении доступа не содержит токен безопасности для пользователя, поэтому приложение должно выполнить вход пользователя отдельно.
> 
> 

Ниже приведен пример ответа на запрос о предоставлении доступа, который был отклонен: `https://adatum.com/ExpenseReport.aspx?ContextID=123456&Consent=Denied`

#### <a name="rolling-app-keys-for-uninterrupted-access-to-the-graph-api-legacy"></a>Развертывание ключей приложения для непрерывного доступа к API Graph (предыдущие версии)
В течение жизненного цикла приложения может потребоваться изменить ключи, используемые при вызове Azure AD в целях получения токена доступа для вызова API Graph.  Обычно бывает два типа изменения ключей: аварийная смена в случае компрометации ключа и смена в связи со скорым окончанием срока действия текущего ключа. Необходимо следовать описанной ниже процедуре, чтобы обеспечить приложению непрерывный доступ во время обновления ключей (это особенно важно во втором случае).

1. На классическом портале Azure щелкните клиент каталога, выберите пункт **Приложения** в верхнем меню, а затем выберите приложение, которое требуется настроить. Отображается  страница быстрого запуска с единым входом и другими сведениями о конфигурации.
2. Щелкните пункт **Настроить** в верхнем меню, чтобы отобразить список свойств приложения и список ключей.
3. В области "Ключи" щелкните раскрывающийся список **Выбрать длительность** и выберите 1 год или 2 года, а затем нажмите кнопку **Сохранить** на панели команд. При этом для вашего приложения создается новый ключ пароля. Скопируйте этот новый ключ пароля. На этом этапе для получения токена доступа из Azure AD можно использовать как существующий, так и новый ключ.
4. Вернитесь к своему приложению и обновите конфигурацию, чтобы начать использовать новый ключ пароля. Пример выполнения такого обновления см. в статье [Использование API Graph для запроса в Azure AD](https://msdn.microsoft.com/library/azure/dn151791.aspx).
5. Теперь следует распространить это изменение в рабочей среде, сначала проверив его работу на одном узле службы, а затем развернув на остальных узлах.
6. По завершении обновления рабочей среды можно вернуться на классический портал Azure и удалить старый ключ.

#### <a name="changing-app-properties-after-enabling-access-legacy"></a>Изменение свойств приложения после включения доступа (предыдущие версии)
Предоставив внешним пользователям доступ к своему приложению, вы по-прежнему сможете вносить изменения в свойства приложения на классическом портале Azure. Клиенты, которым был предоставлен доступ к приложению до внесения изменений в приложение, не увидят эти изменения при просмотре сведений о приложении на классическом портале Azure. Когда приложение становится доступным для клиентов, вы должны быть крайне осторожным при внесении определенных изменений. Например, если вы обновляете URI идентификатора приложения, то существующие клиенты, доступ которым был предоставлен до внесения таких изменений, не смогут выполнить вход в приложение с помощью своих рабочих или учебных учетных записей.

При внесении изменений в RequestedPermissions для запроса более высокого уровня доступа существующие клиенты, использующие функции приложения, в которых теперь применяются новые вызовы API с повышенным уровнем доступа, могут получить от API Graph ответ с отказом в доступе.  Приложение должно учитывать такие ситуации и просить клиента предоставить доступ к приложению с помощью запроса о повышении уровня доступа.

## <a name="removing-an-application"></a>Удаление приложения
В этом разделе описывается удаление приложения из клиента Azure AD.

### <a name="removing-an-application-authored-by-your-organization"></a>Удаление приложения, созданного организацией
Это приложения, которые отображаются при применении фильтра "Приложения моей компании" на главной странице "Приложения" клиента Azure AD. Технически такие приложения регистрируются вручную с помощью классического портала Azure или программным путем с помощью PowerShell или API Graph. В частности, в вашем клиенте они представлены объектами приложения и субъекта-службы. Дополнительные сведения см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](active-directory-application-objects.md).

#### <a name="to-remove-a-single-tenant-application-from-your-directory"></a>Порядок удаления однотенантного приложения из каталога
1. Войдите на [классический портал Azure](https://manage.windowsazure.com)
2. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.
3. В верхнем меню нажмите **Приложения**и выберите приложение, которое требуется настроить. Отображается  страница быстрого запуска с единым входом и другими сведениями о конфигурации.
4. На панели команд нажмите кнопку **Удалить** .
5. Нажмите кнопку **Да** в сообщении с подтверждением.

#### <a name="to-remove-a-multi-tenant-application-from-your-directory"></a>Порядок удаления мультитенантного приложения из каталога
1. Войдите на [классический портал Azure](https://manage.windowsazure.com)
2. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.
3. В верхнем меню нажмите **Приложения**и выберите приложение, которое требуется настроить. Отображается  страница быстрого запуска с единым входом и другими сведениями о конфигурации.
4. В разделе "Приложение является мультитенантным" нажмите кнопку **Нет**. Приложение будет преобразовано в однотенантное, но оно по-прежнему будет относиться к организации, которая предоставила свое согласие.
5. На панели команд нажмите кнопку **Удалить** .
6. Нажмите кнопку **Да** в сообщении с подтверждением.

### <a name="removing-a-multi-tenant-application-authorized-by-another-organization"></a>Удаление мультитенантного приложения, авторизованного другой организацией
Это подмножество приложений, которые отображаются при применении фильтра "Приложения, используемые моей компанией" на главной странице "Приложения" вашего клиента Azure AD, — в частности те, которые не перечислены в списке "Приложения моей компании". Технически такие мультитенантные приложения регистрируются в процессе предоставления разрешения. В частности, в вашем клиенте они представлены только объектом субъекта-службы. Дополнительные сведения см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](active-directory-application-objects.md).

Чтобы запретить доступ многопользовательского приложения к своему каталогу (после предоставления согласия), администратору компании необходимо иметь подписку Azure для запрета доступа на классическом портале Azure. Перейдите на страницу конфигурации приложения и нажмите кнопку "Управление доступом" внизу. Чтобы запретить доступ, администратор компании также может использовать [командлеты Azure AD PowerShell](http://go.microsoft.com/fwlink/?LinkId=294151) .

## <a name="next-steps"></a>Дальнейшие действия
* Сведения о визуальных подсказках для вашего приложения см. в статье [Рекомендации по фирменной символике для приложений](active-directory-branding-guidelines.md).
* Дополнительные сведения о связи между объектами приложения и субъекта-службы см. в статье [Объекты приложения и субъекта-службы в Azure Active Directory](active-directory-application-objects.md).
* Дополнительные сведения о роли манифеста приложения см. в статье [Основные сведения о манифесте приложения Azure Active Directory](active-directory-application-manifest.md).
* Определения некоторых основных понятий для разработчиков Azure Active Directory (AD) приведены в статье [Глоссарий по Azure Active Directory для разработчика](active-directory-dev-glossary.md).
* Сведения для разработчиков см. в [руководстве разработчика по Active Directory](active-directory-developers-guide.md).




<!--HONumber=Jan17_HO3-->


