---
title: Аутентификация с помощью Azure AD и получение токена JWT с помощью OAuth 2.0
description: Пример кода, демонстрирующий аутентификацию с помощью Azure Active Directory с использованием OAuth 2.0 для доступа к защищенным веб-приложениям и интерфейсам веб-API в вашей организации.
services: active-directory
author: rloutlaw
manager: angerobe
editor: ''
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/12/2018
ms.author: routlaw
ms.custom: aaddev
ms.openlocfilehash: cbc86eb6d13034fb3154ed8e9d021064f1d15ece
ms.sourcegitcommit: a5eb246d79a462519775a9705ebf562f0444e4ec
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2018
ms.locfileid: "39267108"
---
# <a name="request-an-access-token-using-oauth-20-to-access-web-apis-and-applications-secured-by-azure-active-directory"></a>Запрос маркера доступа с помощью OAuth 2.0 и для доступа к интерфейсам веб-API и приложениям, защищенным с помощью Azure Active Directory

В этой статье показано, как получить JSON Web Token (JWT) для доступа к ресурсам, защищенным Azure AD. Предполагается, что у вас есть [маркер авторизации](/azure/active-directory/develop/active-directory-protocols-oauth-code#request-an-authorization-code), предоставленный пользователем или с помощью [субъекта-службы](/azure/active-directory/develop/active-directory-application-objects).

## <a name="build-the-request"></a>Создание запроса

Используйте следующий HTTP-запрос `POST`, чтобы получить JWT для доступа к конкретному приложению или API, защищенному Azure AD.

```http
POST https://{tenant}/oauth2/v2.0/token?client_id={client-id}
&scope={scope}
&code=OAAABAAAAiL9Kn2Z27UubvWFPbm0gLWQJVzCTE9UkP3pSx1aXxUjq3n8b2JRLk4OxVXr...
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&grant_type=authorization_code
&client_secret=JqQX2PNo9bpM0uEihUPzyrh   
```

### <a name="request-headers"></a>Заголовки запросов

Ниже приведены обязательные заголовки.

|Заголовок запроса|ОПИСАНИЕ|  
|--------------------|-----------------|  
| *Host:* | https://login.microsoftonline.com |
| *Content-Type:*| application/x-www-form-urlencoded |
 

### <a name="uri-parameters"></a>Параметры универсального кода ресурса (URI)

| Параметр     |                       | ОПИСАНИЕ                                                                                                                                                                                                                                                                                                                                                                                                                                |
|---------------|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| tenant        | обязательно              | Значение `{tenant}` в пути запроса можно использовать для того, чтобы контролировать, кто может входить в приложение. Допустимые значения: `common`, `organizations`, `consumers`, а также идентификаторы клиента. Дополнительные сведения см. в [описании протоколов](active-directory-v2-protocols.md#endpoints).                                                                                                                                                   |
| client_id     | обязательно              | Идентификатор приложения, назначенный приложению порталом регистрации ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)).                                                                                                                                                                                                                             |
| grant_type    | обязательно              | Должен быть `authorization_code` для потока кода авторизации.                                                                                                                                                                                                                                                                                                                                                                            |
| scope         | обязательно              | Список областей с разделителями-пробелами. Области, запрашиваемые на этом участке, должны быть эквивалентны областям в вызове к `/authorize` или являться их подмножеством. Если области, указанные в этом запросе, охватывают несколько серверов ресурсов, конечная точка версии 2.0 вернет маркер ресурса, указанного в первой области. Более подробное описание областей можно найти в разделе, посвященном [разрешениям, согласию на их предоставление и областям](active-directory-v2-scopes.md). |
| Код          | обязательно              | Код авторизации authorization_code, полученный при вызове к `/authorize`.                                                                                                                                                                                                                                                                                                                                                                |
| redirect_uri  | обязательно              | Значение redirect_uri, которое использовалось для получения кода authorization_code.                                                                                                                                                                                                                                                                                                                                                             |
| client_secret | необходим для веб-приложений | Секрет приложения, созданный на портале регистрации для приложения. Его не следует использовать в собственном приложении, так как невозможно обеспечить полную безопасность секретов клиентов (client_secret) при их хранении на устройствах. Этот секрет требуется для веб-приложений и веб-API с возможностью безопасного хранения секрета клиента на сервере.  Секреты клиента должны быть преобразованы в формат URL-адреса перед отправкой.                                                                                 |
| code_verifier | необязательный              | Это тот же параметр code_verifier, который использовался для получения кода авторизации (authorization_code). Является обязательным, если в запросе на код авторизации использовался PKCE. Дополнительные сведения см. в описании [PKCE RFC](https://tools.ietf.org/html/rfc7636).                                                                                                                                                                                                                                                                                             |
## <a name="handle-the-response"></a>Обработка ответа

Успешный ответ будет содержать токен JWT и выглядеть следующим образом.

```json
{
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "token_type": "Bearer",
    "expires_in": 3599,
    "scope": "https%3A%2F%2Fgraph.microsoft.com%2Fmail.read",
    "refresh_token": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGAMxZGUTdM0t4B4...",
    "id_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIyZDRkMTFhMi1mODE0LTQ2YTctOD...",
}
```
| Параметр     | ОПИСАНИЕ                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| access_token  | Запрашиваемый маркер доступа. Приложение может использовать этот маркер для аутентификации в защищенном ресурсе, таком как веб-API.                                                                                                                                                                                                                                                                                                                                    |
| token_type    | Указывает значение типа маркера. Единственный тип, поддерживаемый Azure AD, — носитель                                                                                                                                                                                                                                                                                                                                                                           |
| expires_in    | Срок действия маркера доступа (в секундах).                                                                                                                                                                                                                                                                                                                                                                                                       |
| scope         | Области, для которых действителен маркер доступа.                                                                                                                                                                                                                                                                                                                                                                                                         |
| refresh_token | Токен обновления OAuth 2.0. Приложение может использовать этот маркер для получения дополнительных маркеров доступа после истечения срока действия текущего маркера доступа. Токены обновления действуют в течение долгого времени. Их можно использовать для длительного сохранения доступа к ресурсам. Дополнительные сведения можно найти в [справочном материале по маркерам версии 2.0](active-directory-v2-tokens.md). <br> **Примечание.** Предоставляется, только если подан запрос на область `offline_access`.                                               |
| id_token      | Неподписанный веб-маркер JSON (JWT). Приложение может декодировать сегменты этого токена, чтобы запрашивать сведения о пользователе, выполнившем вход. Приложение может кэшировать и отображать значения, но оно не должно полагаться на них при авторизации или в целях безопасности. Дополнительные сведения о маркерах id_token см. в [справочнике по маркерам конечной точки версии 2.0](active-directory-v2-tokens.md). <br> **Примечание.** Предоставляется, только если подан запрос на область `openid`. |



