---
title: Включение единого входа для нескольких приложений Android с помощью ADAL | Документация Майкрософт
description: 'Использование функций ADAL SDK для включения единого входа в приложениях. '
services: active-directory
documentationcenter: ''
author: CelesteDG
manager: mtillman
editor: ''
ms.assetid: 40710225-05ab-40a3-9aec-8b4e96b6b5e7
ms.service: active-directory
ms.component: develop
ms.workload: identity
ms.tgt_pltfrm: android
ms.devlang: java
ms.topic: article
ms.date: 06/13/2018
ms.author: celested
ms.reviewer: dadobali
ms.custom: aaddev
ms.openlocfilehash: 4abf6bd2d82753e22d4fde92e219109274ce36be
ms.sourcegitcommit: 615403e8c5045ff6629c0433ef19e8e127fe58ac
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2018
ms.locfileid: "39580982"
---
# <a name="how-to-enable-cross-app-sso-on-android-using-adal"></a>Как включить единый вход для нескольких приложений Android с помощью ADAL
Теперь отраслевым стандартом стало предоставление возможности единого входа, которая позволяет пользователям ввести учетные данные только один раз, после чего они смогут автоматически входить в разные приложения. Сложность ввода имени пользователя и пароля на маленьком экране, часто с дополнительной проверкой подлинности (2FA), например посредством звонка по телефону или кода в SMS, приводит к неудовлетворенности пользователя, если ему приходится это делать больше одного раза.

Кроме того, если вы используете платформу удостоверений, которую могут использовать другие приложения, например учетные записи Майкрософт или рабочую учетную запись Microsoft365, пользователи ожидают, что эти учетные данные будут доступны во всех приложениях любых издателей.

Платформа Microsoft Identity вместе с пакетом SDK для этой платформы предоставляет пользователям возможность единого входа либо во все используемые ими приложения, либо (с помощью брокера и приложений проверки подлинности) на цельном устройстве.

В этом пошаговом руководстве описывается, как настроить пакет SDK в приложении, чтобы ваши пользователи смогли воспользоваться функцией единого входа.

В представленном выше документе предполагается, что вы знаете, как интегрировать приложение с [пакетом SDK Microsoft Identity для Android](https://github.com/AzureAD/azure-activedirectory-library-for-android).

## <a name="sso-concepts-in-the-microsoft-identity-platform"></a>Концепции единого входа на платформе Microsoft Identity
### <a name="microsoft-identity-brokers"></a>Брокеры Microsoft Identity
Корпорация Майкрософт предоставляет приложения для всех мобильных платформ, которые позволяют привязывать учетные данные к приложениям разных поставщиков и использовать специальные расширенные возможности, требующие единого безопасного расположения для проверки учетных данных. Пакет SDK вызывает этих **брокеров**. В iOS и Android брокеры доступны в скачиваемых приложениях, которые пользователи устанавливают самостоятельно, либо их может передавать на устройство сотрудника компания, частично или полностью управляющая такими устройствами. Брокеры поддерживают управление безопасностью только для некоторых приложений или для всего устройства в зависимости от требований ИТ-администраторов. В Windows этот компонент предоставляется средством выбора учетной записи, встроенным в операционную систему (его техническое название — брокер веб-аутентификации).

#### <a name="broker-assisted-logins"></a>вход с брокером.
Так называется вход, выполняемый в приложении брокера с использованием хранилища и системы безопасности брокера, который позволяет применить на устройстве один набор учетных данных для всех приложений, которые используют платформу Microsoft Identity. Подразумевается, что ваши приложения будут использовать брокер для входа пользователей в систему. В iOS и Android брокеры доступны в виде скачиваемых приложений. Эти приложения устанавливаются пользователями самостоятельно либо принудительно передаются на устройство компанией, которая управляет устройствами. Пример этого типа приложений — приложение Microsoft Authenticator в iOS. В Windows этот компонент предоставляется средством выбора учетной записи, встроенным в операционную систему (его техническое название — брокер веб-аутентификации).
Этот способ входа зависит от платформы. При неправильном управлении он может мешать работе пользователей. Возможно, вы знакомы с этим способом входа, если у вас установлено приложение Facebook и вы используете Facebook Connect для входа в другие приложения. Платформа Microsoft Identity использует этот же принцип.

В Android для удобства пользователя средство выбора учетной записи отображается поверх приложения.

#### <a name="how-the-broker-gets-invoked"></a>Способы вызова брокера
При установке совместимого брокера на устройство, например приложение Microsoft Authenticator, пакеты SDK Microsoft Identity автоматически будут выполнять вызов брокера, когда пользователь укажет, что хочет войти с помощью любой учетной записи платформы Microsoft Identity. 
 
 #### <a name="how-microsoft-ensures-the-application-is-valid"></a>Как корпорация Майкрософт проверяет допустимость приложения
 
 Необходимость обеспечения идентификации приложений, обращающихся к брокеру, имеет решающее значение для обеспечения безопасности при входе с брокером. iOS и Android не предоставляют уникальные идентификаторы, действующие только для конкретного приложения, поэтому любое вредоносное ПО может имитировать идентификатор уполномоченного приложения и получать предназначенные для него маркеры. Чтобы убедиться, что во время выполнения корпорация Майкрософт всегда взаимодействует с надежным приложением, разработчику предлагается при регистрации приложений в корпорации Майкрософт предоставлять собственный универсальный код ресурса (URI) для перенаправления. **Ниже подробно описано, как разработчикам следует создавать этот универсальный код ресурса (URI) для перенаправления.** Этот пользовательский URI для перенаправления содержит отпечаток сертификата приложения и служит уникальным идентификатором приложения в магазине Google Play. Когда приложение вызывает брокер, тот запрашивает у операционной системы Android отпечаток сертификата, с которым был вызван этот брокер. Затем брокер предоставляет этот отпечаток сертификата в корпорацию Майкрософт в рамках обращения к системе идентификаций. Если отпечаток сертификата, указанный приложением, не соответствует тому отпечатку сертификата, который разработчик предоставил нам во время регистрации, доступ к запрошенным приложением маркерам ресурса блокируется. Такая проверка гарантирует, что только зарегистрированные разработчиком приложения получат маркеры.

Единый вход с использованием брокеров отличается следующими преимуществами:

* пользователь выполняет единый вход во всех приложениях независимо от поставщика;
* в приложении можно использовать расширенные бизнес-функции и компоненты, включая условный доступ и поддержку сценариев Intune.
* приложение может поддерживать аутентификацию бизнес-пользователей на основе сертификата;
* более безопасная процедура входа — удостоверение приложения и пользователь проверяются приложением брокера с использованием шифрования и дополнительных алгоритмов безопасности.

Ниже показано, как с помощью пакетов SDK для Microsoft Identity можно включить единый вход, используя приложение брокера.

```
+------------+ +------------+   +-------------+
|            | |            |   |             |
|   App 1    | |   App 2    |   |   Someone   |
|            | |            |   |    Else's   |
|            | |            |   |     App     |
+------------+ +------------+   +-------------+
|  ADAL SDK  | |  ADAL SDK  |   |  ADAL SDK   |
+-----+------+-+-----+------+-  +-------+-----+
      |              |                  |
      |       +------v------+           |
      |       |             |           |
      |       | Microsoft   |           |
      +-------> Broker      |^----------+
              | Application
              |             |
              +-------------+
              |             |
              |   Broker    |
              |   Storage   |
              |             |
              +-------------+

```

Теперь, вооружившись базовыми сведениями, вы сможете лучше понимать возможности единого входа и эффективнее реализовывать их в своем приложении с помощью платформы Microsoft Identity и пакетов SDK.

### <a name="turning-on-sso-for-broker-assisted-sso"></a>Включение единого входа с брокером
Возможность приложения использовать любой брокер, который установлен на устройстве, **по умолчанию отключена**. Чтобы пользоваться приложением с брокером, необходимо выполнить дополнительную настройку и добавить код в приложение.

Шаги для выполнения:

1. Включите режим брокера в вызов MS SDK кода приложения
2. Укажите новый код URI перенаправления для самого приложения и его регистрации.
3. Настройте требуемые разрешения в манифесте Android.

#### <a name="step-1-enable-broker-mode-in-your-application"></a>Шаг 1. Включение режима брокера в приложении
Возможность использовать в приложении брокер включается во время создания параметров или при первоначальной настройке экземпляра проверки подлинности. Чтобы сделать это в приложении:

```
AuthenticationSettings.Instance.setUseBroker(true);
```

#### <a name="step-2-establish-a-new-redirect-uri-with-your-url-scheme"></a>Шаг 2. Настройка нового кода URI перенаправления в схеме URL-адреса
Чтобы гарантировать возврат маркеров учетных данных в нужное приложение, необходимо убедиться, что способ выполнения обратного вызова к приложению доступен для проверки операционной системой Android. Операционная система Android использует хэш сертификата в магазине Google Play. Этот хэш сертификата не может быть подделан мошенническим приложением. Вместе с кодом URI приложения брокера корпорация Майкрософт следит за тем, чтобы маркеры возвращались в нужное приложение. Для регистрации в приложении требуется уникальный код URI перенаправления.

Формат кода URI перенаправления должен быть таким:

`msauth://packagename/Base64UrlencodedSignature`

Например, *msauth://com.example.userapp/IcB5PxIyvbLkbFVtBI%2FitkW%2Fejk%3D*

Вы можете указать этот код URI перенаправления при регистрации приложения на [портале Azure](https://portal.azure.com/). Дополнительные сведения о регистрации приложения Azure AD см. в статье, посвященной [интеграции с Azure Active Directory](active-directory-how-to-integrate.md).

#### <a name="step-3-set-up-the-correct-permissions-in-your-application"></a>Шаг 3. Настройка требуемых разрешений в приложении
Приложение брокера в Android использует функцию диспетчера учетных записей ОС Android для управления учетными данными в разных приложениях. Чтобы использовать брокер в приложении Android, ваш манифест приложения должен содержать разрешения на использование учетных записей AccountManager. Дополнительные сведения об этих разрешениях см. в [документации Google по использованию диспетчера учетных записей](http://developer.android.com/reference/android/accounts/AccountManager.html).

Речь идет о следующих разрешениях:

```
GET_ACCOUNTS
USE_CREDENTIALS
MANAGE_ACCOUNTS
```

### <a name="youve-configured-sso"></a>Вы настроили единый вход!
Теперь пакет SDK для Microsoft Identity будет автоматически предоставлять учетные данные в приложения и вызывать брокера, если он есть на устройстве.

