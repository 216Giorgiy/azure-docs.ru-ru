---
title: "Переход из службы контроля доступа Azure (ACS)"
description: "Варианты перемещения приложений и служб из службы контроля доступа Azure | Microsoft Azure"
services: active-directory
documentationcenter: dev-center-name
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 820acdb7-d316-4c3b-8de9-79df48ba3b06
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 11/14/2017
ms.author: dastrock
ms.openlocfilehash: e32cac7feda929a63c4a80fc0078b221117eb2b5
ms.sourcegitcommit: 933af6219266cc685d0c9009f533ca1be03aa5e9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/18/2017
---
# <a name="migrating-from-azure-access-control-service-acs"></a>Переход из службы контроля доступа Azure (ACS)

Использование службы контроля доступа Microsoft Azure Active Directory (также называется просто службой контроля доступа, или ACS) будет прекращено в ноябре 2018 г.  До этой даты приложения и службы, использующие сейчас ACS, должны полностью перейти на другой механизм проверки подлинности. В этом документе описываются рекомендации, которые помогут текущим клиентам спланировать отказ от использования ACS. Если вы сейчас не используете ACS, предпринимать какие-либо действия не нужно.


## <a name="brief-acs-overview"></a>Общие сведения об ACS

ACS — это облачная служба проверки подлинности. Она предоставляет простой способ проверки подлинности и авторизации пользователей для получения доступа к веб-приложениям и службам, одновременно позволяя реализовать множество функциональных возможностей проверки подлинности и авторизации в своем коде. Главным образом ее используют разработчики и архитекторы клиентов .NET, веб-приложений ASP.NET и веб-служб WCF.

Варианты использования ACS можно разделить на три основные категории:

- Проверка подлинности в определенных облачных службах Майкрософт, включая служебную шину Azure, Dynamics CRM и другие. Клиентские приложения могут получать маркеры из ACS, а затем проходить с их помощью проверку подлинности в этих службах и выполнять различные действия.
- Добавление проверки подлинности в пользовательские и предварительно подготовленные (например, Sharepoint) веб-приложения. Пассивная проверка подлинности ACS позволяет обеспечить поддержку входа в веб-приложения с помощью учетных записей Google, Facebook, Yahoo, Майкрософт (Live ID), Azure Active Directory и ADFS.
- Защита пользовательских веб-служб с помощью выданных ACS маркеров. Активная проверка подлинности гарантирует, что к веб-службам могут получить доступ только доверенные клиенты, прошедшие проверку подлинности в ACS.

В разделах ниже рассматривается каждый из этих вариантов использования и рекомендуемые стратегии миграции. В большинстве случаев, чтобы перенести имеющиеся приложения и службы на более новые технологии, нужно значительно изменить код. Мы советуем немедленно приступить к планированию и непосредственно к самому переносу, чтобы избежать возможных сбоев и простоев.

> [!WARNING]
> В большинстве случаев, чтобы перенести имеющиеся приложения и службы на более новые технологии, нужно значительно изменить код. Мы советуем немедленно приступить к планированию и непосредственно к самому переносу, чтобы избежать возможных сбоев и простоев.

В контексте архитектуры ACS полностью состоит из следующих компонентов:

- Служба маркеров безопасности (STS), которая получает запросы на проверку подлинности и взамен выдает маркеры безопасности.
- Классический портал Azure, на котором создаются, удаляются, включаются и отключаются пространства имен ACS.
- Отдельный портал управления ACS, с помощью которого настраивается поведение пространства имен ACS.
- Служба управления, позволяющая автоматизировать функции порталов.
- Модуль правил преобразования маркеров, с помощью которого можно определить сложную логику обработки выходного формата маркеров, выданных ACS.

Чтобы использовать эти компоненты, необходимо создать одно или несколько **пространств имен** ACS. Пространство имен — это выделенный экземпляр ACS, с которым обмениваются данными приложения и службы. Этот экземпляр изолирован от всех клиентов ACS, использующих собственные пространства имен. Пространство имен в ACS имеет выделенный URL-адрес, например:

```HTTP
https://mynamespace.accesscontrol.windows.net
```

По этому URL-адресу выполняется весь обмен данными с STS и операции управления, но для каждой цели используются разные пути. Чтобы определить, используют ли приложения или службы ACS, нужно отследить трафик к `https://{namespace}.accesscontrol.windows.net`.  Любой трафик к этому URL-адресу обрабатывается с помощью ACS, и его нужно прекратить.  Единственное исключение — это трафик к URL-адресу `https://accounts.accesscontrol.windows.net`, обрабатываемый другой службой. Прекращение поддержки ACS не влияет на него.  Кроме того, необходимо войти на классический портал Azure и проверить наличие любых пространств имен ACS в своих подписках.  Пространства имен ACS перечислены в службе **Active Directory** на вкладке **Пространства имен контроля доступа**.

Дополнительные сведения об ACS см. в [этой архивной статье на сайте MSDN](https://msdn.microsoft.com/library/hh147631.aspx).

## <a name="retirement-schedule"></a>График прекращения использования

По состоянию на ноябрь 2017 г. все компоненты ACS полностью поддерживаются и находятся в рабочем режиме. Единственное ограничение — [на классическом портале Azure больше нельзя создавать пространства имен ACS](https://azure.microsoft.com/blog/acs-access-control-service-namespace-creation-restriction/).

Ниже приведена временная шкала прекращения использования этих компонентов.

- **Ноябрь 2017 г.** [Прекращается использование](https://blogs.technet.microsoft.com/enterprisemobility/2017/09/18/marching-into-the-future-of-the-azure-ad-admin-experience-retiring-the-azure-classic-portal/) интерфейса администрирования Azure AD на классическом портале Azure. На этом этапе управлять пространством имен ACS можно по следующему новому выделенному URL-адресу: `http://manage.windowsazure.com?restoreClassic=true`. Здесь вы также можете просматривать имеющиеся пространства имен, включать или отключать их и при необходимости полностью удалять.
- **Апрель 2018 г.** Управлять пространством имен ACS по этому выделенному URL-адресу больше нельзя. На этом этапе вы не сможете включать, отключать, удалять или перечислять пространства имен ACS. Тем не менее портал управления ACS остается полностью работоспособным. Доступ к нему можно получить по следующему адресу: `https://{namespace}.accesscontrol.windows.net`. Все другие компоненты ACS по-прежнему работают в обычном режиме.
- **Ноябрь 2018 г.** Все компоненты ACS навсегда завершают работу. К ним относится портал управления ACS, служба управления, STS и модуль правил преобразования маркеров. На этом этапе все запросы, отправленные к ACS (по адресу `{namespace}.accesscontrol.windows.net`), завершаются ошибкой. До этого времени вы должны перенести все имеющиеся приложения и службы на другие технологии.


## <a name="migration-strategies"></a>Стратегии миграции

В следующих разделах приведены общие рекомендации по переходу с ACS на другие технологии Майкрософт.

### <a name="clients-of-microsoft-cloud-services"></a>Клиенты облачных служб Майкрософт

Каждая из облачных служб Майкрософт, которые принимают маркеры, выданные ACS, поддерживает по крайней мере один альтернативный способ проверки подлинности. Правильный же механизм зависит от каждой службы, поэтому мы советуем воспользоваться рекомендациями из соответствующей документации. Для удобства ниже приведен каждый набор документации.

| служба | Руководство |
| ------- | -------- |
| Azure Service Bus | [Переход от службы контроля доступа Azure Active Directory к авторизации подписанного URL-адреса](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-migrate-acs-sas) |
| Ретранслятор Azure | [Переход от службы контроля доступа Azure Active Directory к авторизации подписанного URL-адреса](https://docs.microsoft.com/azure/service-bus-relay/relay-migrate-acs-sas) |
| Кэш Azure | [Переход на кэш Redis для Azure](https://docs.microsoft.com/azure/redis-cache/cache-faq#which-azure-cache-offering-is-right-for-me) |
| Azure DataMarket | [Переход на API-интерфейсы Cognitive Services](https://docs.microsoft.com/azure/machine-learning/studio/datamarket-deprecation) |
| Службы BizTalk | [Переход на Azure Logic Apps](https://docs.microsoft.com/azure/machine-learning/studio/datamarket-deprecation) |
| Службы мультимедиа Azure | [Azure Media Services announces support for Azure AD and deprecation of Access Control authentication](https://azure.microsoft.com/blog/azure-media-service-aad-auth-and-acs-deprecation/) (Команда разработчиков служб мультимедиа Azure анонсирует поддержку проверки подлинности AAD и объявление проверки подлинности ACS устаревшей) |
| Служба архивации Azure | [Вопросы об агенте службы Azure Backup](https://docs.microsoft.com/azure/backup/backup-azure-file-folder-backup-faq) |

<!-- Dynamics CRM: Migrate to new SDK, Dynamics team handling privately -->
<!-- Azure RemoteApp deprecated in favor of Citrix: http://www.zdnet.com/article/microsoft-to-drop-azure-remoteapp-in-favor-of-citrix-remoting-technologies/ -->
<!-- Exchange push notifications are moving, customers don't need to move -->
<!-- Retail federation services are moving, customers don't need to move -->
<!-- Azure StorSimple: TODO -->
<!-- Azure SiteRecovery: TODO -->


### <a name="web-applications-using-passive-authentication"></a>Веб-приложения, использующие пассивную проверку подлинности

Проверка подлинности ACS предоставляет следующие функции и возможности разработчикам и архитекторам веб-приложений:

- Тесная интеграция с Windows Identity Foundation (WIF).
- Федерация с учетными записями Google, Facebook, Yahoo, Майкрософт (Live ID), Azure Active Directory и ADFS.
- Поддержка следующих протоколов проверки подлинности: OAuth 2.0 (черновой вариант 13), WS-Trust и WS-Federation.
- Поддержка следующих форматов маркеров: JWT, SAML 1.1, SAML 2.0 и SWT.
- Возможность обнаружения домашней области, интегрированная в WIF, благодаря которой пользователи могут выбирать тип учетной записи для входа. Эта возможность реализована в веб-приложении и полностью настраиваемая.
- Преобразование маркеров, позволяющее настраивать утверждения, полученные веб-приложением из ACS, в том числе:
    - отправка утверждений от поставщиков удостоверений;
    - добавление дополнительных настраиваемых утверждений;
    - выдача утверждений при определенных условиях на основе простой логики If-Then.

К сожалению, ни одна служба не предоставляет все соответствующие возможности.  Следует оценить, какие возможности ACS требуются, а затем выберите одну из доступных служб: [**Azure Active Directory**](https://azure.microsoft.com/develop/identity/signin/) (Azure AD), [**Azure AD B2C**](https://azure.microsoft.com/services/active-directory-b2c/) или другую облачную службу проверки подлинности.

#### <a name="migrating-to-azure-active-directory"></a>Переход на Azure Active Directory

Приложения и службы можно непосредственно интегрировать с Azure Active Directory. Azure AD — это облачный поставщик удостоверений рабочих и учебных учетных записей Майкрософт, а именно таких служб, как Office 365, Azure и многих других. Он предоставляет такие же возможности федеративной проверки подлинности, что и ACS, но не поддерживает множество других функций этой службы. Основной пример — федерация с поставщиками удостоверений социальных сетей, таких как Facebook, Google и Yahoo. Если пользователи входят в систему с этим типом учетных данных, тогда Azure AD не подходит вам. Кроме того, Azure AD не всегда поддерживает одинаковые с ACS протоколы проверки подлинности. Хотя обе эти службы поддерживают, например, протокол OAuth, его реализация, требующая изменения кода в процессе миграции, существенно отличается.

Однако Azure AD предоставляет несколько потенциальных преимуществ клиентам ACS. Эта служба изначально поддерживает размещенные в облаке рабочие и учебные учетные записи Майкрософт, которые часто используют клиенты ACS.  Клиент Azure AD через ADFS также можно включить в федерацию с одним или несколькими экземплярами локального каталога Active Directory, что позволяет проходить в приложении проверку подлинности как облачным пользователям, так и пользователям, размещенным в локальной среде.  Кроме того, Azure AD поддерживает протокол WS-Federation, за счет чего эту службу сравнительно легко интегрировать с веб-приложениями с помощью Windows Identity Foundation.

В таблице ниже приводится сравнительная характеристика возможностей, которые предоставляют веб-приложениям службы ACS и Azure AD. В целом **Azure Active Directory — это, скорее всего, правильный выбор, если нужно, чтобы после переноса пользователи входили в систему только с помощью рабочих и учебных учетных записей Майкрософт**.

| Функция | Поддержка ACS | Поддержка Azure AD |
| ---------- | ----------- | ---------------- |
| **Типы учетных записей** | | |
| Рабочие и учебные учетные записи Майкрософт | Поддерживаются | Поддерживаются |
| Учетные записи Windows Server Active Directory и ADFS | Поддерживаются через федерацию с клиентом Azure AD <br /> Поддерживаются через прямую федерацию с ADFS | Поддерживаются только через федерацию с клиентом Azure AD | 
| Учетные записи других корпоративных систем управления удостоверениями | Возможно через федерацию с клиентом Azure AD <br />Поддерживаются через прямую федерацию | Возможно через федерацию с клиентом Azure AD |
| Личные учетные записи Майкрософт (Windows Live ID) | Поддерживаются | Поддерживаются только через протокол OAuth 2.0 Azure AD | 
| Учетные записи Facebook, Google, Yahoo | Поддерживаются | Не поддерживаются ни при каких обстоятельствах |
| **Совместимость с протоколами и пакетом SDK** | | |
| Windows Identity Foundation | Поддерживаются | Поддерживается, но с определенными условиями |
| WS-Federation | Поддерживаются | Поддерживаются |
| OAuth 2.0 | Поддерживается черновая версия 13 | Поддерживается RFC 6749 (последняя спецификация) |
| WS-Trust | Поддерживаются | Не поддерживается |
| **Форматы маркеров** | | |
| Маркеры JWT | Поддерживается в бета-версии | Поддерживаются |
| Маркеры SAML 1.1 | Поддерживаются | Поддерживаются |
| Маркеры SAML 2.0 | Поддерживаются | Поддерживаются |
| Simple Web Token (SWT) | Поддерживаются | Не поддерживается |
| **Настройки** | | |
| Настраиваемый пользовательский интерфейс обнаружения домашней области и выбора учетной записи | Загружаемый код, который можно включить в приложения | Не поддерживается |
| Передача пользовательских сертификатов для подписи маркера | Поддерживаются | Поддерживаются |
| Настройка утверждений в маркерах | Отправка входящих утверждений от поставщиков удостоверений<br />Получение маркера доступа от поставщика удостоверений как утверждения<br />Выдача исходящих утверждений на основе значений входящих утверждений<br />Выдача исходящих утверждений с постоянными значениями | Не может отправлять утверждения от федеративных поставщиков удостоверений<br />Не может получить маркер доступа от поставщика удостоверений как утверждение<br />Не может выдавать исходящие утверждения на основе значений входящих утверждений<br />Не может выдавать исходящие утверждения с постоянными значениями<br />Может выдавать исходящие утверждения на основе свойств пользователя, синхронизированного с Azure AD |
| **Автоматизация** | | |
| Автоматизация задач настройки и управления | Поддерживается через службу управления ACS | Поддерживается через API Microsoft Graph и Azure AD Graph |

Если вы решите продолжить работу с Azure AD, следует рассмотреть два способа интеграции приложений и служб с этой службой.

Чтобы выполнить интеграцию с Azure AD с помощью WS-Federation или WIF, мы советуем рассмотреть [подход, описанный здесь](https://docs.microsoft.com/azure/active-directory/application-config-sso-how-to-configure-federated-sso-non-gallery). В этой статье описана настройка единого входа на основе SAML в Azure AD, но этот способ можно применить и к WS-Federation. При использовании этого подхода требуется лицензия Azure AD Premium, но он предоставляет два следующих преимущества:

- Вы получаете полную гибкость настройки маркера Azure AD. Таким образом, вы можете настраивать утверждения, выданные Azure AD, в соответствии с маркерами ACS (это особенно касается утверждения идентификатора имени и пользователя). Необходимо убедиться, что идентификаторы пользователей, выданные Azure AD, соответствуют выданным ACS. Это позволит получать согласованные идентификаторы даже после изменения технологии.
- Вы можете настроить сертификат для подписи маркера, специфичный для вашего приложения, временем существования которого управляете вы.

<!--

Possible nameIdentifiers from ACS (via AAD or ADFS):
- ADFS - Whatever ADFS is configured to send (email, UPN, employeeID, what have you)
- Default from AAD using App Registrations, or Custom Apps before ClaimsIssuance policy: subject/persistent ID
- Default from AAD using Custom apps nowadays: UPN
- Kusto can't tell us distribution, it's redacted

-->

> [!NOTE]
> При использовании этого подхода требуется лицензия Azure AD Premium. Если вы клиент ACS и вам требуется лицензия Premium, чтобы настроить единый вход в приложение, обратитесь к нам, и мы предоставим лицензии разработчика.

Кроме того, вы можете использовать [этот пример кода](https://github.com/Azure-Samples/active-directory-dotnet-webapp-wsfederation), в котором реализован немного другой подход к настройке WS-Federation. В этом примере кода используется не WIF, а ПО промежуточного слоя ASP.NET 4.5 OWIN. Однако инструкции по регистрации подходят и к приложениям, использующим WIF, но в этом случае лицензия Azure AD Premium не требуется.  Если вы выбрали этот подход, необходимо разобраться со [сменой ключей подписывания в Azure AD](https://docs.microsoft.com/azure/active-directory/develop/active-directory-signing-key-rollover). В нем выдача маркеров осуществляется с помощью общего ключа подписывания Azure AD. По умолчанию WIF не обновляет ключи подписывания автоматически. Когда Azure AD сменяет свои общие ключи подписывания, WIF необходимо подготовить к принятию изменений.

Если вы можете выполнить интеграцию с Azure AD через протоколы OpenID Connect или OAuth, мы советуем применить этот подход.  Подробную документацию и руководства разработчика по интеграции Azure AD с веб-приложением см. в [этой статье](http://aka.ms/aaddev).

<!-- TODO: If customers ask about authZ, let's put a blurb on role claims here -->

#### <a name="migrating-to-azure-ad-b2c"></a>Перенос в Azure AD B2C

Еще один вариант переноса, который следует рассмотреть, — это Azure AD B2C.  B2C — это облачная служба проверки подлинности, напоминающая ACS. Она позволяет разработчикам развернуть в облачной службе логику управления удостоверениями и проверки подлинности сторонних поставщиков.  Эта платная служба (с уровнями "Бесплатный" и "Премиум") предназначена для клиентов, создающих приложения с миллионами активных пользователей.

Одна из наиболее привлекательных возможностей B2C (как и ACS) заключается в поддержке большого количества разных типов учетных записей. B2C позволяет входить в систему с помощью учетных записей Facebook, Google, Майкрософт, LinkedIn, GitHub, Yahoo и многих других. Кроме того, эта служба поддерживает локальные учетные записи — имена пользователей и пароли, создаваемые пользователями специально для определенного приложения. Azure AD B2C также предоставляет широкие возможности расширяемости, с помощью которых можно настроить потоки входа. Однако эта служба не поддерживает все протоколы проверки подлинности и форматы маркеров, необходимые клиентам ACS. С ее помощью также нельзя получить маркеры и запросить дополнительные сведения о пользователе от поставщика удостоверений, корпорации Майкрософт или иным способом.

В таблице ниже приводится сравнительная характеристика возможностей, которые предоставляют веб-приложениям службы ACS и Azure AD B2C. В целом **Azure AD B2C — это, скорее всего, правильный выбор для переноса, если приложение ориентировано на пользователей или поддерживает большое количество разных типов учетных записей**.

| Функция | Поддержка ACS | Поддержка Azure AD B2C |
| ---------- | ----------- | ---------------- |
| **Типы учетных записей** | | |
| Рабочие и учебные учетные записи Майкрософт | Поддерживаются | Поддерживаются через пользовательские политики  |
| Учетные записи Windows Server Active Directory и ADFS | Поддерживаются через прямую федерацию с ADFS | Поддерживаются через федерации SAML с помощью настраиваемых политик |
| Учетные записи других корпоративных систем управления удостоверениями | Поддерживаются через прямую федерацию по протоколу WS-Federation | Поддерживаются через федерации SAML с помощью настраиваемых политик |
| Личные учетные записи Майкрософт (Windows Live ID) | Поддерживаются | Поддерживаются | 
| Учетные записи Facebook, Google, Yahoo | Поддерживаются | Учетные записи Facebook и Google поддерживаются по умолчанию, Yahoo — через федерацию OpenID Connect с помощью настраиваемых политик |
| **Совместимость с протоколами и пакетом SDK** | | |
| Windows Identity Foundation | Поддерживаются | Не поддерживается. |
| WS-Federation | Поддерживаются | Не поддерживается. |
| OAuth 2.0 | Поддерживается черновая версия 13 | Поддерживается RFC 6749 (последняя спецификация) |
| WS-Trust | Поддерживаются | Не поддерживается. |
| **Форматы маркеров** | | |
| Маркеры JWT | Поддерживается в бета-версии | Поддерживаются |
| Маркеры SAML 1.1 | Поддерживаются | Не поддерживается |
| Маркеры SAML 2.0 | Поддерживаются | Не поддерживается |
| Simple Web Token (SWT) | Поддерживаются | Не поддерживается |
| **Настройки** | | |
| Настраиваемый пользовательский интерфейс обнаружения домашней области и выбора учетной записи | Загружаемый код, который можно включить в приложения | Возможность полной конфигурации пользовательского интерфейса через настраиваемые каскадные таблицы стилей |
| Передача пользовательских сертификатов для подписи маркера | Поддерживаются | Настраиваемые ключи подписывания (не сертификаты) поддерживаются через пользовательские политики |
| Настройка утверждений в маркерах | Отправка входящих утверждений от поставщиков удостоверений<br />Получение маркера доступа от поставщика удостоверений как утверждения<br />Выдача исходящих утверждений на основе значений входящих утверждений<br />Выдача исходящих утверждений с постоянными значениями | Отправка утверждений от поставщиков удостоверений Для некоторых утверждений требуются пользовательские политики<br />Не может получить маркер доступа от поставщика удостоверений как утверждение<br />Может выдавать исходящие утверждения на основе значений входящих утверждений через пользовательские политики<br />Может выдавать исходящие утверждения с постоянными значениями через пользовательские политики |
| **Автоматизация** | | |
| Автоматизация задач настройки и управления | Поддерживается через службу управления ACS | Создавать пользователей можно через API Azure AD Graph Не может программно создавать клиенты, приложения или политики B2C |

Если вы решите перенести свои приложения и службы в Azure AD B2C, сначала изучите следующие материалы:

- [Документация по Azure AD B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-overview)
- [Пользовательские политики Azure AD B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-overview-custom)
- [Цены на Azure Active Directory B2C](https://azure.microsoft.com/pricing/details/active-directory-b2c/)


#### <a name="other-migration-options"></a>Другие варианты переноса

Если Azure AD и Azure AD B2C не соответствует требованиям вашего веб-приложения, свяжитесь с нами, и мы поможем определить дальнейшие действия.

<!--

#### Migrating to Ping Identity or Auth0

In some cases, you may find that neither Azure AD nor Azure AD B2C is sufficient to replace ACS in your web applications without making major code changes.  Some common examples might include:

- web applications using WIF and/or WS-Federation for sign-in with social identity providers such as Google or Facebook.
- web applications performing direct federation to an enterprise IDP over the Ws-Federation protocol.
- web applications that require the access token issued by a social identity provider (such as Google or Facebook) as a claim in the tokens issued by ACS.
- web applications with complex token transformation rules that Azure AD or Azure AD B2C cannot reproduce.

In these cases, you may want to consider migrating your web application to another cloud authentication service. We recommend exploring the following options, as each provides capabilities similar to ACS:

- [Auth0](https://auth0.com/) has created [high-level migration guidance for customers of ACS](https://auth0.com/blog/windows-azure-acs-alternative-replacement/), and provides a feature-by-feature comparison of ACS vs. Auth0.
- Enterprise customers should consider [Ping Identity](https://www.pingidentity.com) as well. Reach out to us and we can connect you with a representative from Ping who is prepared to help identify potential solutions.

Our aim in working with Ping Identity & Auth0 is to ensure that all ACS customers have a path forward for their apps & services that minimizes the amount of work required to move off of ACS.

-->

<!--

## Sharepoint 2010, 2013, 2016

TODO: AAD only, use AAD SAML 1.1 tokens, when we bring it back online.
Other IDPs: use Auth0? https://auth0.com/docs/integrations/sharepoint.

-->

### <a name="web-services-using-active-authentication"></a>Веб-службы, использующие активную проверку подлинности

Веб-службам, защищенным выданными ACS маркерами, ACS предоставляет следующие функции и возможности:

- Возможность зарегистрировать одно или несколько **удостоверений службы** в пространстве имен ACS, с помощью которого можно запрашивать маркеры.
- Поддержка запроса маркеров по протоколу OAuth WRAP и OAuth 2.0 (черновой вариант 13), используя следующие типы учетных данных:
    - простой пароль, созданный для удостоверения службы;
    - подписанный маркер SWT, использующий симметричный ключ или сертификат X509;
    - маркер SAML, выданный доверенным поставщиком удостоверений (обычно это экземпляр ADFS).
- Поддержка следующих форматов маркеров: JWT, SAML 1.1, SAML 2.0 и SWT.
- Простые правила преобразования маркеров.

Удостоверения службы в ACS обычно позволяют реализовать проверку подлинности между серверами (S2S).  

#### <a name="migrating-to-azure-active-directory"></a>Переход на Azure Active Directory

При использовании этого типа потока проверки подлинности мы советуем перейти на [**Azure Active Directory**](https://azure.microsoft.com/develop/identity/signin/). Azure AD — это облачный поставщик удостоверений рабочих и учебных учетных записей Майкрософт, а именно таких служб, как Office 365, Azure и многих других. За счет реализации предоставления учетных данных клиента OAuth эта служба обеспечивает проверку подлинности между серверами.  В таблице ниже приводится сравнительная характеристика возможностей проверки подлинности между серверами в ACS и Azure AD.

| Функция | Поддержка ACS | Поддержка Azure AD |
| ---------- | ----------- | ---------------- |
| Регистрация веб-службы | Создание проверяющей стороны на портале управления ACS | Создание веб-приложения Azure AD на портале Azure |
| Регистрация клиента | Создание удостоверения службы на портале управления ACS | Создание другого веб-приложения Azure AD на портале Azure |
| Используемый протокол | OAuth WRAP<br />Предоставление учетных данных клиента OAuth 2.0 (черновой вариант 13) | Предоставление учетных данных клиента OAuth 2.0 |
| Методы проверки подлинности клиента | Простой пароль<br />Подписанный маркер SWT<br />Маркер SAML от федеративного поставщика удостоверений | Простой пароль<br />Подписанный маркер JWT |
| Форматы маркеров | JWT<br />SAML 1.1<br />SAML 2.0<br />SWT<br /> | Только JWT |
| Преобразование маркеров | Добавление пользовательских утверждений<br />Простая логика выдачи утверждения If-Then | Добавление пользовательских утверждений | 
| Автоматизация задач настройки и управления | Поддерживается через службу управления ACS | Поддерживается через API Microsoft Graph и Azure AD Graph |

Рекомендации по реализации межсерверных сценариев см. в следующих источниках:

- [Azure Active Directory для разработчиков](https://aka.ms/aaddev)
- [Calling web APIs in a daemon or long-running process](https://github.com/Azure-Samples/active-directory-dotnet-daemon) (Вызов веб-API в длительном процессе или процессе с использованием управляющей программы)
- [Authenticating to Azure AD in daemon apps with certificates](https://github.com/Azure-Samples/active-directory-dotnet-daemon-certificate-credential) (Проверка подлинности приложений управляющей программы в Azure AD с помощью сертификатов)

#### <a name="other-migration-options"></a>Другие варианты переноса

Если Azure AD не соответствует требованиям вашей веб-службы, оставьте комментарий, и мы поможем составить максимально эффективный план.

<!--

#### Migrating to Ping Identity or Auth0

In some cases, you may find that neither Azure AD's client credentials OAuth grant implementation is not sufficient to replace ACS in your architecture without major code changes.  Some common examples might include:

- server-to-server authentication using token formats other than JWTs.
- server-to-server authentication using an input token provided by an external identity provider.
- server-to-server authentication with token transformation rules that Azure AD cannot reproduce.

In these cases, you may want to consider migrating your web application to another cloud authentication service. We recommend exploring the following options, as each provides capabilities similar to ACS:

- [Auth0](https://auth0.com/) has created [high-level migration guidance for customers of ACS](https://auth0.com/blog/windows-azure-acs-alternative-replacement/), and provides a feature-by-feature comparison of ACS vs. Auth0.
- Enterprise customers should consider [Ping Identity](https://www.pingidentity.com) as well. Reach out to us and we can connect you with a representative from Ping who is prepared to help identify potential solutions.

Our aim in working with Ping Identity & Auth0 is to ensure that all ACS customers have a path forward for their apps & services that minimizes the amount of work required to move off of ACS.

-->

## <a name="questions-concerns--feedback"></a>Вопросы, проблемы и отзывы

Мы понимаем, что сведения о переносе в этой статье подходят не всем, и некоторым клиентам ACS требуются советы и рекомендации по определению правильного плана. Если вы хотите обсудить сценарии переноса и связанные с этим процессом вопросы, оставьте комментарий на этой странице.
