<properties
   pageTitle="Azure AD Connect: обновление до последней версии | Microsoft Azure"
   description="Описывает различные способны обновления Azure Active Direcotry Connect до последней версии, включая обновление ";на месте"; и обновление со сменой сервера."
   services="active-directory"
   documentationCenter=""
   authors="AndKjell"
   manager="stevenpo"
   editor=""/>

<tags
   ms.service="active-directory"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="Identity"
   ms.date="05/19/2016"
   ms.author="andkjell"/>

# Azure AD Connect: обновление до последней версии
В этом разделе описываются различные варианты обновления установки Azure AD Connect до последней версии. Мы рекомендуем устанавливать все новые выпуски Azure AD Connect.

Инструкции по обновлению DirSync см. в статье [Обновление средства синхронизации Azure AD (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).

Существует несколько различных стратегий обновления Azure AD Connect.

Метод | Описание
--- | ---
[Автоматическое обновление](active-directory-aadconnect-feature-automatic-upgrade.md) | Самый простой вариант — для клиентов с экспресс-установкой.
[Обновление «на месте»](#in-place-upgrade) | Если у вас один сервер, установку можно обновить "на месте".
[Обновление со сменой сервера](#swing-migration) | Если серверов два, можно установить новый выпуск на один из них, а затем сменить активный сервер.

Разрешения, необходимые для обновления, см. [здесь](active-directory-aadconnect-accounts-permissions.md#upgrade).

## Обновление «на месте»
Обновление на месте подходит для обновления Azure AD Sync или Azure AD Connect. Оно не подходит для DirSync и решений с FIM + соединитель Azure AD.

Этот вариант является предпочтительным, если у вас есть один сервер и меньше 100 000 объектов. После обновления, если в стандартных правилах синхронизации есть какие-либо изменения, выполняется полный импорт и полная синхронизация. Это гарантирует, что новая конфигурация будет применена ко всем существующим в системе объектам. Импорт и синхронизация могут занять несколько часов в зависимости от числа объектов в области действия модуля синхронизации. Обычная синхронизация изменений, по умолчанию выполняемая каждые 30 минут, приостанавливается, а синхронизация паролей продолжает выполняться. Обновление "на месте" лучше всего проводить в выходные дни. Если в новом выпуске Azure AD Connect не изменены стандартные правила синхронизации, то начнется обычная процедура импорта или синхронизации изменений.

![Обновление "на месте"](./media/active-directory-aadconnect-upgrade-previous-version/inplaceupgrade.png)

Если вы внесли изменения в стандартные правила синхронизации, при обновлении они будут возвращены к конфигурации по умолчанию. Чтобы после обновления конфигурация сохранялась, вносите изменения, как указано в статье [Рекомендации по изменению конфигурации по умолчанию](active-directory-aadconnectsync-best-practices-changing-default-configuration.md).

## Обновление со сменой сервера
При наличии сложного развертывания или большого числа объектов обновление системы "на месте" будет нецелесообразно. У некоторых клиентов оно может занять несколько дней, в течение которых никакие изменения синхронизироваться не будут.

В подобных случаях рекомендуем обновление со сменой сервера. Для того чтобы воспользоваться этим вариантом, потребуется по крайней мере два сервера — активный и промежуточный. Активный сервер (сплошные синие линии на приведенной ниже схеме) будет отвечать за активные загрузки. Промежуточный сервер (фиолетовые пунктирные линии на приведенной ниже схеме) будет использоваться для установки нового выпуска, по завершении которой он станет активным. Сервер, который раньше был активным и на котором теперь установлена старая версия, станет промежуточным и будет обновлен.

Два сервера могут использовать разные версии, например активный сервер, который планируется списать, может использовать Azure AD Sync, а новый промежуточный сервер — Azure AD Connect.

![Промежуточный сервер.](./media/active-directory-aadconnect-upgrade-previous-version/stagingserver1.png)

Примечание. Отмечено, что некоторые клиенты предпочитают использовать для этой цели три или четыре сервера. Пока промежуточный сервер обновляется, он не может служить резервным сервером для [аварийного восстановления](active-directory-aadconnectsync-operations.md#disaster-recovery). При наличии максимум четырех серверов можно подготовить новую пару основного и резервного серверов, в случае чего промежуточный сервер всегда будет доступен.

Эти действия подходят также для обновления Azure AD Sync или решения с FIM + соединитель Azure AD. Они не подходят для обновления DirSync; метод обновления со сменой сервера (также называемый параллельным развертыванием) для DirSync см. в статье [Обновление службы синхронизации Azure Active Directory (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).

### Порядок обновления со сменой сервера

1. При использовании Azure AD Connect на обоих серверах перед началом обновления убедитесь, что на активном и промежуточном серверах используется одна и та же версия. Это упростит сравнение различий позже. При обновлении Azure AD Sync эти серверы будут иметь разные версии.
2. Если вы вносили изменения в конфигурацию на активном сервере, а на промежуточном они отсутствуют, выполните инструкции в разделе [Перенос пользовательской конфигурации с активного на промежуточный сервер](#move-custom-configuration-from-active-to-staging-server).
3. При обновлении более ранней версии Azure AD Connect обновите промежуточный сервер до последней версии. При перемещении из Azure AD Sync установите Azure AD Connect на промежуточном сервере.
4. Разрешите модулю синхронизации выполнить полный импорт и полную синхронизацию на промежуточном сервере.
5. Убедитесь, что новая конфигурация не вызывает непредвиденных изменений, выполнив инструкции раздела **Проверка** в статье [Проверка конфигурации сервера](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server). Если что-то работает неправильно или не так, как ожидалось, выполняйте импорт и синхронизацию с последующей проверкой, пока данные не будут выглядеть должным образом. Эти действия описаны в соответствующей статье.
6. Сделайте промежуточный сервер активным. Это действие соответствует последнему шагу, **Переключите активный сервер**, в статье [Проверка конфигурации сервера](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).
7. При обновлении Azure AD Connect обновите сервер, находящийся в промежуточном режиме, до последней версии. Обновите данные и конфигурацию, как описано выше. При перемещении из Azure AD Sync на этом этапе можно отключить и списать старый сервер.

### Перенос пользовательской конфигурации с активного на промежуточный сервер
Если вы вносили изменения в конфигурацию на активном сервере, их нужно применить и к промежуточному серверу.

Созданные правила синхронизации можно перенести с помощью PowerShell. Другие изменения необходимо применить в обеих системах одним и тем же образом; их миграцию выполнять нельзя.

На обоих серверах должно быть одинаково настроено следующее:

- Подключение к одним и тем же лесам.
- Фильтрация доменов и подразделений.
- Одни и те же дополнительные компоненты, например синхронизация и обратная запись паролей.

**Перенос правил синхронизации**. Для переноса пользовательских правил синхронизации выполните следующие действия.

1. Откройте **редактор правил синхронизации** на активном сервере.
2. Выберите пользовательское правило. Щелкните **Экспорт**. Откроется окно блокнота. Сохраните временный файл с расширением PS1 — он станет сценарием PowerShell. Скопируйте PS1-файл на промежуточный сервер. ![Экспорт правил синхронизации](./media/active-directory-aadconnect-upgrade-previous-version/exportrule.png)
3. На промежуточном сервере используется другой соединитель GUID. Чтобы получить GUID, запустите **редактор правил синхронизации**, выберите одно из стандартных правил, представляющих ту же подключенную систему, и щелкните **Экспорт**. Замените GUID в файл PS1 на GUID для промежуточного сервера.
4. Запустите файл PS1 из командной строки PowerShell. Это создаст пользовательское правило синхронизации на промежуточном сервере.
5. Если у вас есть несколько пользовательских правил, повторите описанные выше действия для каждого из них.

## Дальнейшие действия
Узнайте больше об [интеграции локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md).

<!---HONumber=AcomDC_0525_2016-->