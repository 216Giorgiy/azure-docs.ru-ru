<properties
   pageTitle="Интеграция приложений с Azure Active Directory | Microsoft Azure"
   description="Сведения о том, как добавить, обновить или удалить приложение в Active Directory (Azure AD)."
   services="active-directory"
   documentationCenter=""
   authors="msmbaldwin"
   manager="mbaldwin"
   editor="mbaldwin" />
<tags
   ms.service="active-directory"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="identity"
   ms.date="11/24/2015"
   ms.author="mbaldwin" />

# Интеграция приложений с Azure Active Directory

[AZURE.INCLUDE [active-directory-devguide](../../includes/active-directory-devguide.md)]

Разработчики корпоративных решений и поставщики программного обеспечения как услуги (SaaS) могут разрабатывать коммерческие облачные службы или бизнес-приложения, которые можно интегрировать с Azure Active Directory (Azure AD) для обеспечения безопасного входа и авторизации для служб. Чтобы интегрировать приложение или службу с Azure AD, разработчику сначала необходимо зарегистрировать сведения о своем приложении в Azure AD с помощью портала управления Azure.

В этой статье показано, как добавить, обновить или удалить приложение в Azure AD. Вы узнаете о различных типах приложений, которые можно интегрировать с Azure AD, способах настройки приложений для доступа к другим ресурсам, таким как веб-API, и многое другое.

Дополнительные сведения о свойствах приложения см. в статье [Объекты приложений и объекты участников-служб](active-directory-application-objects.md); рекомендации по фирменной символике, которых следует придерживаться при разработке приложений с помощью Azure Active Directory, см. в статье [Рекомендации по фирменной символике для интегрированных приложений](active-directory-branding-guidelines.md). Манифесты приложений описаны в статье [Основные сведения о манифесте приложения Azure Active Directory](active-directory-application-manifest.md).

## Добавление приложения

Любое приложение, которому требуется использовать возможности Azure AD, сначала следует зарегистрировать в каталоге. Этот процесс регистрации включает в себя предоставление Azure AD сведений о приложении, например URL-адреса, по которому оно расположено, URL-адреса для отправки ответов после проверки подлинности пользователя, URI, идентифицирующего приложение, и т. д.

При создании веб-приложения, в котором требуется использовать только вход для пользователей в Azure AD, можно просто следовать приведенным ниже инструкциям. Если вашему приложению требуется доступ к веб-API, вы создаете собственное приложение, которому требуется доступ к веб-API, или хотите сделать приложение мультитенантным, читайте дальше раздел [Обновление приложения](#updating-an-application), в котором описываются дополнительные настройки.

Если вы хотите сделать свое приложение доступным для других организаций, после добавления приложения необходимо также разрешить внешний доступ.

### Регистрация приложения на портале управления Azure

1. Войдите на портал управления Azure.

1. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.

1. В верхнем меню щелкните Приложения. Если в каталоге нет добавленных приложений, на этой странице отображается только ссылка "Добавить приложение". Щелкните ссылку или, как вариант, можно нажать кнопку "Добавить" на панели команд.

1. На странице "Что необходимо сделать?" щелкните ссылку "Добавить приложение, разрабатываемое моей организацией".

1. На странице "Расскажите о своем приложении" следует указать имя для вашего приложения, а также тип регистрируемого в Azure AD приложения. Вы можете выбрать веб-приложение и/или веб-API (по умолчанию) либо собственное клиентское приложение, которое представляет приложение, устанавливаемое на устройстве, таком как телефон или компьютер. По завершении щелкните значок со стрелкой в правом нижнем углу страницы.

1. На странице "Свойства приложения" укажите "URL-адрес входа" и "URI кода приложения" для своего веб-приложения (или просто "URI перенаправления" для собственного клиентского приложения), а затем установите флажок в нижнем правом углу страницы.

1. Приложение добавляется в систему, и выполняется переход на страницу быстрого запуска для вашего приложения. В зависимости от того, является ли ваше приложение веб-приложением или собственным приложением, вы увидите различные параметры для добавления дополнительных возможностей в приложение. После добавления приложения можно начать его обновление, чтобы пользователи могли выполнить вход, получить доступ к веб-API в других приложениях или настроить мультитенантное приложение (что позволяет другим организациям осуществлять доступ к вашему приложению).

>[AZURE.NOTE]По умолчанию регистрация вновь созданного приложения позволяет пользователям из вашего каталога выполнять вход в это приложение.

## Обновление приложения

После регистрации приложения в Azure AD может потребоваться обновить его для предоставления доступа к веб-API, обеспечения доступа из других организаций и в других целях. В этом разделе описывается дальнейшая настройка приложения. Дополнительные сведения о принципе проверки подлинности в Azure AD см. в статье [Сценарии проверки подлинности в Azure AD](active-directory-authentication-scenarios.md).

### Обзор платформы согласия

Новая платформа согласия Azure AD упрощает разработку веб-приложений и собственных приложений, которым требуется доступ к веб-API, защищенным Azure AD. Эти веб-API включают в себя API Graph, Office 365 и другие службы Майкрософт, дополняющие ваши собственные веб-API. Эта платформа основана на том, что пользователь или администратор дает согласие на регистрацию приложения в своем каталоге, что может включать в себя доступ к данным каталога. Например, если веб-приложению необходимо вызвать веб-API Office 365 для считывания сведений календаря о пользователе, этот пользователь должен дать согласие на приложение. После предоставления такого разрешения веб-приложение сможет вызывать веб-API Office 365 от имени этого пользователя и пользоваться сведениями календаря по мере необходимости.

Платформа согласия основана на OAuth 2.0 и различных его процедурах, таких как предоставление кода авторизации и учетных данных пользователя, с помощью общедоступных или конфиденциальных клиентов. Благодаря OAuth 2.0 среда Azure AD позволяет создавать множество различных клиентских приложений, например на телефоне, планшете, сервере или в Интернете, и получить доступ к необходимым ресурсам.

Дополнительные сведения о платформе согласия см. в статьях [OAuth 2.0 в Azure AD](https://msdn.microsoft.com/library/azure/dn645545.aspx), [Сценарии проверки подлинности в Azure AD](active-directory-authentication-scenarios.md) и разделе, посвященном Office 365 [Проверка подлинности и авторизация с помощью общей платформы согласия](https://msdn.microsoft.com/library/office/dn605895(v=office.15).aspx).

#### Пример процедуры согласия

Ниже показаны особенности работы процедуры согласия для разработчика приложений и пользователя.

1. Задайте необходимые приложению разрешения на странице настройки приложения на портале управления Azure, используя раскрывающиеся меню в элементе управления "Разрешения для других приложений".

    ![Разрешения для других приложений](./media/active-directory-integrating-applications/permissions.png)

1. Представим себе, что разрешения вашего приложения были обновлены, само приложение запущено, а пользователь собирается воспользоваться им в первый раз. Если приложение еще не получило токен доступа или обновления, ему следует перейти к конечной точке авторизации Azure AD для получения кода авторизации, который можно использовать для получения нового токена доступа и обновления.

1. Если пользователь еще не прошел проверку подлинности, ему предлагается выполнить вход в Azure AD.

    ![Вход пользователя или администратора в Azure AD](./media/active-directory-integrating-applications/useradminsignin.png)

1. После входа Azure AD определяет, требуется ли отобразить этому пользователю страницу согласия. Принятие этого решения основано на том, дал ли этот пользователь (или администратор его организации) свое согласие для приложения. Если согласие еще не было дано, Azure AD запрашивает у пользователя согласие и отображает необходимые для этого разрешения. Набор разрешений, который отображается в диалоговом окне согласия, совпадает с разрешениями, выбранными в элементе управления "Разрешения для других приложений" на портале управления Azure.

    ![Процедура использования согласия пользователей](./media/active-directory-integrating-applications/userconsent.png)

1. После того как пользователь дает свое согласие, в ваше приложение возвращается код авторизации, который можно использовать для получения токена доступа и токена обновления. Дополнительные сведения об этой процедуре см. в разделе [Из веб-приложения к веб-интерфейсу API](active-directory-authentication-scenarios.md#web-application-to-web-api) статьи [Сценарии проверки подлинности в Azure AD](active-directory-authentication-scenarios.md).

### Доступ к веб-API в других приложениях

С помощью описанной выше платформы согласия можно настроить приложение на запрос разрешений для доступа к данным, предоставляемым веб-API в вашем каталоге. По умолчанию все приложения могут выбирать разрешения из Azure Active Directory (API Graph) и API управления службами Azure, при этом разрешение Enable sign on and read user’s profile (Включить вход и чтение профиля пользователя) Azure AD уже выбрано по умолчанию. Если ваш каталог также имеет подписку на Office 365, то также можно будет выбрать веб-API и разрешения для SharePoint и Exchange Online. В раскрывающихся меню рядом с требуемым веб-API можно выбрать один из двух типов разрешений.

- Разрешения приложения: вашему приложению требуется доступ к веб-API от своего имени (без контекста пользователя). Этот тип разрешения требует согласия администратора и недоступен для собственных клиентских приложений.

- Разрешения делегирования: вашему приложению требуется доступ к веб-API от лица выполнившего вход пользователя, но с ограничением доступа по выбранному разрешению. Этот тип разрешения может быть предоставлен пользователем, если только для разрешения не настроено обязательное согласие администратора.

#### Для настройки доступа к веб-API в других приложениях

1. Войдите на портал управления Azure.

1. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.

1. В верхнем меню щелкните "Приложения" и выберите приложение, которое требуется настроить. Отображается страница быстрого запуска с единым входом и другими сведениями о конфигурации.

1. Разверните веб-API доступа в области "Другие приложения" страницы быстрого запуска и выберите ссылку "Настроить сейчас" в разделе "Выберите разрешения". Отображается страница свойств приложения.

1. Выполните прокрутку вниз до раздела "Разрешения для других приложений". В первом столбце представлен выбор из доступных приложений в каталоге, предоставляющих доступ к веб-API. После выбора можно выбрать разрешения приложения и делегирования, предоставляемые веб-API.

1. После выбора нажмите кнопку "Сохранить" на панели команд.

>[AZURE.NOTE]При нажатии кнопки "Сохранить" также автоматически задаются разрешения для приложения в каталоге на основе настроенных значений "Разрешения для других приложений". Эти разрешения можно просмотреть на вкладке "Свойства" приложения.

### Предоставление веб-API в других приложениях

Можно разработать веб-API и сделать его доступным для других организаций, предоставив свои области разрешений разработчикам других приложений. Доступ к правильно настроенному веб-API предоставляется по аналогии с другими веб-API корпорации Майкрософт, включая API Graph и API Office 365. Доступ к веб-API предоставляется посредством настройки [манифеста приложения](active-directory-application-manifest.md) — JSON-файла, который представляет собой конфигурацию удостоверения вашего приложения. Свои области разрешений можно предоставить, перейдя в свое приложение на портале управления и нажав кнопку "Манифест приложения" в панели команд. Дополнительные сведения см. в статье [Основные сведения о манифесте приложения Azure Active Directory](active-directory-application-manifest.md).

#### Для открытия веб-API для доступа других приложений

1. Войдите на портал управления Azure.

1. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.

1. В верхнем меню щелкните "Приложения" и выберите приложение, которое требуется настроить. Отображается страница быстрого запуска с единым входом и другими сведениями о конфигурации.

1. Нажмите кнопку "Управление манифестом" в панели команд и выберите "Загрузить манифест".

1. Откройте JSON-файл манифеста приложения и замените узел oauth2Permissions следующим фрагментом JSON-кода. Этот фрагмент является примером того, как предоставить область разрешений, называемую также олицетворением пользователя, при этом не забудьте изменить текст и значения в соответствии со своим собственным приложением.

		"oauth2Permissions": [
		{
			"adminConsentDescription": "Allow the application full access to the Todo List service on behalf of the signed-in 	user",
			"adminConsentDisplayName": "Have full access to the Todo List service",
			"id": "b69ee3c9-c40d-4f2a-ac80-961cd1534e40",
			"isEnabled": true,
			“origin”: “Application”
			"type": "User",
			"userConsentDescription": "Allow the application full access to the todo service on your behalf",
			"userConsentDisplayName": "Have full access to the todo service",
			"value": "user_impersonation"
			}
		],

    В качестве значения идентификатора должен выступать новый GUID, созданный с помощью специального средства или программным образом. Оно представляет уникальный идентификатор для разрешения, предоставляемого веб-API. Когда клиент настроен должным образом для запроса доступа к веб-API и вызывает веб-API, он будет представлять токен JWT OAuth 2.0, у которого для утверждения (scp) области задано указанное выше значение (в данном случае это user\_impersonation).

	>[AZURE.NOTE]Позднее вы можете по мере необходимости предоставлять дополнительные области разрешений. Помните о том, что веб-API может предоставлять несколько разрешений, связанных с множеством различных функций. Теперь вы можете управлять доступом к веб-API с помощью утверждения (scp) области в полученном токене JWT OAuth 2.0.

1. Сохраните обновленный JSON-файл и отправьте его, нажав кнопку "Управление манифестом" в панели команд, выбрав команду "Отправить манифест", перейдя к обновленному файлу манифеста и выбрав его. После отправки веб-API настроен для использования другими приложениями в каталоге.

#### Для проверки доступности веб-API другим приложениям каталога

1. В верхнем меню щелкните пункт "Приложения", выберите нужное приложение, для которого необходимо настроить доступ к веб-API, и нажмите кнопку "Настроить".

1. Выполните прокрутку вниз до раздела "Разрешения для других приложений". Щелкните раскрывающееся меню "Выбор приложения", чтобы получить возможность выбрать веб-API, для которого только что было предоставлено разрешение. Выберите новое разрешение в раскрывающемся меню "Разрешения делегирования".

![Показаны разрешения списка задач](./media/active-directory-integrating-applications/listpermissions.png)

#### Схема AppPermissions для файла манифеста JSON приложения

В следующей таблице перечислены возможные значения для элемента oauth2Permissions в JSON-файле манифеста приложения.

|Элемент|Описание|
|---|---|
|adminConsentDescription|Описание, отображаемое при наведении указателя мыши в диалоговом окне согласия администратора и на странице свойств приложения с согласием.|
|adminConsentDisplayName|Понятное имя для разрешения, отображаемое в раскрывающихся списках области разрешений приложения и/или делегирования, для администраторов во время запроса согласия, а также на странице свойств приложения.|
|id|Представляет уникальный внутренний идентификатор для области разрешений. Он должен быть уникальным среди всех разрешений для приложения, а также должен являться GUID.|
|isEnabled|При создании или обновлении разрешения OAuth2 всегда устанавливайте для этого элемента значение true. Если вы хотите удалить разрешение, необходимо установить для этого элемента значение false и отправить манифест. Затем вы сможете удалить разрешение в последующей отправке манифеста.|
|origin|Зарезервировано для будущего использования. Всегда задавайте значение application.|
|type|Может принимать одно из следующих значений: User — согласие можно получить у конечных пользователей, Admin — необходимо согласие администратора компании.|
|userConsentDescription|Описание, отображаемое при наведении указателя мыши в диалоговом окне согласия пользователя.|
|userConsentDisplayName|Понятное имя для разрешения, отображаемое конечным пользователям во время запроса согласия, а также на странице свойств приложения в панели доступа.|
|значение|Это значение помещается в утверждение scp токена доступа OAuth 2.0, если на это конкретное разрешение было получено согласие пользователя. Веб-API может использовать это значение для определения области уровня доступа, который приложение имеет при олицетворении пользователя. Оно не должно содержать пробелов и должно быть уникальным среди всех разрешений в приложении.|

### Доступ к API Graph

В этом разделе описывается обновление приложения для доступа к API Graph, который называется Azure Active Directory, в список "Разрешения для других приложений". Он доступен по умолчанию для всех приложений, которые зарегистрированы в Azure AD. Благодаря API Graph вам доступны следующие разрешения:

|Имя разрешения|Описание|Тип|
|---|---|---|
|Enable sign-on and read users' profiles (Включить вход и чтение профилей пользователей)|Пользователи могут войти в приложение с использованием своих учетных записей в организации, а приложение может считывать профили выполнивших вход пользователей, например их адрес электронной почты и контактные данные.|Только разрешения делегирования. Согласие может быть получено у пользователей.|
|Access your organization's directory (Доступ к каталогу организации)|Приложение может получить доступ к каталогу организации от имени выполнившего вход пользователя.|Только разрешения делегирования. Согласие может быть получено у пользователей в собственном клиенте и только у администратора для веб-приложений.|
|Прочитать данные каталога|Приложение может считывать данные в каталоге организации, например пользователей, группы и приложения.|Разрешение делегирования и приложения. Согласие должно быть получено у администратора.|
|Чтение и запись данных каталога|Приложение может считывать и записывать данные в каталоге организации, например пользователей и группы.|Разрешение делегирования и приложения. Согласие должно быть получено у администратора.|

Для существующих пользователей на портале управления Azure настройка разрешений "Прочитать данные каталога" и "Чтение и запись данных каталога" через элемент управления "Разрешения для других приложений" осуществляется аналогично работе с описанным выше мастером управления доступом. Описание областей разрешений, предоставляемых Office 365, см. в разделе [Проверка подлинности и авторизация с помощью общей платформы согласия](https://msdn.microsoft.com/office/office365/howto/common-app-authentication-tasks).

>[AZURE.NOTE]Из-за имеющихся в данный момент ограничений собственные клиентские приложения могут вызывать API Graph Azure AD только при использовании разрешения Access your organization's directory (Доступ к каталогу организации). Это ограничение не распространяется на веб-приложения.

### Настройка мультитенантных приложений

При добавлении приложения Azure AD вам может потребоваться предоставить доступ к этому приложению только пользователям в вашей организации. Кроме того, может потребоваться, чтобы доступ к приложению могли получить пользователи из других организаций. Два этих типа приложений называются однотенантными и мультитенантными. Можно изменить конфигурацию отдельного однотенантного приложения, чтобы сделать его мультитенантным, что рассмотрено ниже.

Следует отметить различия между однотенантным и мультитенантным приложением. Однотенантное (для одного клиента) приложение предназначено для использования в одной организации. Обычно это бизнес-приложения (LoB), которые создает разработчик компании. Однотенантное приложение предоставляет пользователям доступ только в одном каталоге. В результате, его достаточно подготовить в одном каталоге. Мультитенантное (для нескольких клиентов) приложение предназначено для использования в нескольких организациях. Как правило, это приложение категории "программное обеспечение как услуга" (SaaS), созданное независимым поставщиком программного обеспечения (ISV). Мультитенантные приложения необходимо подготавливать в каждом каталоге, где они будут использоваться. Следовательно, для их регистрации требуется предоставление разрешений пользователем или администратором.

#### Предоставление доступа внешним пользователям

При создании приложения, которое требуется сделать доступным для клиентов или партнеров за пределами вашей организации, необходимо обновить определение приложения на портале управления Azure.

>[AZURE.NOTE]При включении внешнего доступа необходимо убедиться, что URI идентификатора приложения принадлежит к проверенному домену. Кроме того, URL-адрес возврата должен начинаться с https://. Дополнительные сведения см. в статье [Объекты приложений и объекты участников-служб](active-directory-application-objects.md).

##### Для предоставления доступа внешним пользователям

1. Войдите на портал управления Azure.

1. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.

1. В верхнем меню щелкните "Приложения" и выберите приложение, которое требуется настроить. Отображается страница быстрого запуска с единым входом и другими сведениями о конфигурации.

1. Разверните раздел "Настройка мультитенантного приложения" страницы быстрого запуска, а затем щелкните ссылку "Настроить сейчас" в разделе "Включить доступ". Отображается страница свойств приложения.

1. Нажмите кнопку "Да" рядом с элементом "Приложение является мультитенантным", а затем нажмите кнопку "Сохранить" на панели команд.

После внесения указанных выше изменений пользователи и администраторы в других организациях смогут предоставить вашему приложению доступ к их каталогу и другим данным.

### Предоставление доступа с помощью платформы согласия

Чтобы предоставить доступ с помощью платформы согласия, клиентское приложение должно запросить авторизацию с помощью OAuth 2.0. Доступны [примеры кода](https://github.com/AzureADSamples), демонстрирующие, как веб-приложение, собственное приложение или серверное/управляющее приложение запрашивает коды авторизации и токены доступа для вызова веб-API.

Веб-приложение может предлагать пользователям пройти регистрацию. Если вы предлагаете процедуру регистрации, предполагается, что пользователь нажмет кнопку регистрации (или входа), которая перенаправляет браузер на конечную точку "authorize" OAuth 2.0 Azure AD или конечную точку "userinfo" OpenID Connect. Эти конечные точки позволяют приложению получить сведения о новом пользователе путем проверки id\_token.

Кроме того, веб-приложение может также предлагать процедуру, позволяющую администраторам зарегистрировать компанию. Эта процедура также перенаправляет пользователя на конечную точку "authorize" OAuth 2.0 Azure AD. В этом случае вы также можете передать параметр prompt=admin\_consent для запуска процедуры получения согласия администратора, где администратор предоставит согласие от имени своей организации. После успешного получения согласия ответ будет содержать admin\_consent=true. При активации токена доступа вы также получите id\_token, предоставляющий сведения об организации и администраторе, зарегистрированных для приложения.

#### Включение протокола OAuth 2.0 Implicit Grant для одностраничных приложений

В одностраничных приложениях (SPA) обычно используется клиент с большим объемом кода на JavaScript, который выполняется в браузере и вызывает веб-API серверного приложения для выполнения своих операций бизнес-логики. Для одностраничных приложений, размещенных в Azure AD, проверка подлинности пользователя в Azure AD выполняется с помощью протокола OAuth 2.0 Implicit Grant. После этого пользователь получает маркер, который можно использовать для безопасных вызовов серверного веб-API из клиентского кода JavaScript приложения. После того как пользователь предоставил свое согласие, этот же протокол проверки подлинности можно использовать для получения маркеров для защиты вызовов между клиентом и другими ресурсами веб-API, которые настроены для приложения. По умолчанию протокол OAuth 2.0 Implicit Grant для приложений отключен. Вы можете включить протокол OAuth 2.0 Implicit Grant для приложения, задав значение `oauth2AllowImplicitFlow`"` в [манифесте приложения](active-directory-application-manifest.md) — JSON-файле, который представляет собой конфигурацию удостоверения приложения.

##### Для включения протокола OAuth 2.0 Implicit Grant

1. Войдите на портал управления Azure.
1. Щелкните значок **Active Directory** в меню слева, а затем выберите нужный каталог.
1. В верхнем меню нажмите **Приложения** и выберите приложение, которое требуется настроить. Отображается страница быстрого запуска с единым входом и другими сведениями о конфигурации.
1. Нажмите кнопку **Управление манифестом** в панели команд и выберите команду **Загрузить манифест**. Откройте файл манифеста приложения JSON и установите значение параметра oauth2AllowImplicitFlow в true. По умолчанию значение этого параметра равно false.

       oauth2AllowImplicitFlow: true

1. Сохраните обновленный JSON-файл и отправьте его. Для этого нажмите кнопку **Управление манифестом** в панели команд, выберите команду **Отправить манифест**, перейдите к обновленному файлу манифеста и выберите его. После загрузки файла манифеста протокол OAuth 2.0 Implicit Grant настроен для проверки подлинности пользователей веб-API.


### Устаревшая процедура предоставления доступа

В этом разделе описывается устаревшая процедура получения согласия, которая действовала до 12 марта 2014 г. Эта описанная ниже процедура по-прежнему поддерживается. До появления новых функциональных возможностей можно было предоставлять только следующие разрешения:

- Вход пользователей из их организации

- Вход пользователей и чтение данных каталога их организации (только от имени приложения)

- Вход пользователей и чтение/запись данных каталога их организации (только от имени приложения)

Выполните действия, описанные в статье [Разработка мультитенантных веб-приложений с помощью Azure AD](https://msdn.microsoft.com/library/azure/dn151789.aspx), чтобы предоставить доступ новым приложениям, зарегистрированных в Azure AD. Следует отметить, что новая платформа согласия позволяет значительно расширить функциональность приложений, а также позволяет пользователям, а не только администраторам, давать согласие для этих приложений.

#### Создание ссылки для доступа внешних пользователей (предыдущие версии)

Чтобы внешние пользователи могли зарегистрироваться для вашего приложения с помощью своих учетных записей в организации, необходимо обновить приложение для отображения кнопки со ссылкой на страницу в Azure AD, которая позволяет предоставить им необходимый доступ. Рекомендации по фирменной символике для этой кнопки регистрации приведены в статье [Рекомендации по фирменной символике для интегрированных приложений](active-directory-branding-guidelines.md). После того как пользователь предоставляет или запрещает доступ, страница предоставления доступа Azure AD перенаправляет браузер обратно в ваше приложение с ответом. Дополнительные сведения о свойствах приложений см. в статье [Объекты приложений и объекты участников-служб](active-directory-application-objects.md).

Azure AD создает страницу предоставления доступа, ссылку на которую можно найти на странице конфигурации приложения на портале управления. Чтобы открыть страницу конфигурации, щелкните ссылку "Приложения" в верхнем меню вашего клиента Azure AD, выберите приложение, которое требуется настроить, а затем выберите пункт "Настроить" в верхнем меню страницы быстрого запуска.

Ссылка на ваше приложение будет выглядеть следующим образом: `http://account.activedirectory.windowsazure.com/Consent.aspx?ClientID=058eb9b2-4f49-4850-9b78-469e3176e247&RequestedPermissions=DirectoryReaders&ConsentReturnURL=https%3A%2F%2Fadatum.com%2FExpenseReport.aspx%3FContextId%3D123456`. В следующей таблице описаны части этой ссылки:

|Параметр|Описание|
|---|---|
|ClientId|обязательный параметр. Идентификатор клиента, полученный при добавлении приложения.|
|RequestedPermissions|необязательный параметр. Запрашиваемый приложением уровень доступа, который будет отображаться тому пользователю, который предоставляет доступ для вашего приложения. Если значение не указано, запрашиваемый уровень доступа по умолчанию будет включать в себя только единый вход. Другими параметрами являются DirectoryReaders и DirectoryWriters. Дополнительные сведения об этих уровнях доступа см. в статье "Уровни доступа приложения".|
|ConsentReturnUrl|необязательный параметр. URL-адрес, на которых необходимо возвратить ответ о предоставлении доступа. Это значение должно иметь кодировку URL-адреса и должно относиться к тому же домену, что и URL-адрес ответа, настроенный в определении приложения. Если значение не указано, ответ о предоставлении доступа будет перенаправлен на настроенный URL-адрес ответа.|

Указание ConsentReturnUrl отдельно от URL-адреса ответа позволяет приложению реализовать отдельную логическую схему, которая может обработать ответ на URL-адрес, отличный от URL-адреса ответа (который обычно используется при обработке токенов SAML для входа). Можно также указать дополнительные параметры в URL-адресе в кодировке ConsentReturnURL, которые при перенаправлении передаются обратно в приложение в качестве параметров строки запроса. Этот механизм можно использовать для хранения дополнительных сведений или для связывания запроса приложения на предоставление прав доступа с ответом от Azure AD.

#### Предоставление доступа пользователей и ответ (предыдущие версии)

На следующих изображениях показан интерфейс, с которым сталкивается пользователь, когда приложение выполняет перенаправление по ссылке предоставления доступа.

Если пользователь еще не выполнил вход, ему будет предложено это сделать:

![Вход в AAD](./media/active-directory-integrating-applications/signintoaad.png)

После прохождения пользователем проверки подлинности Azure AD перенаправляет его на страницу предоставления доступа:

![Предоставление доступа](./media/active-directory-integrating-applications/grantaccess.png)

>[AZURE.NOTE]Только администратор компании во внешней организации может предоставлять доступ к вашему приложению. Если пользователь не является администратором компании, он получает возможность отправить сообщение администратору своей компании, чтобы запросить доступ для данного приложения.

После того как клиент предоставил доступ для вашего приложения, нажав кнопку "Предоставление доступа", или запретил доступ, нажав кнопку "Отмена", Azure AD отправляет ответ на ConsentReturnUrl или настроенный URL-адрес ответа. Этот ответ содержит следующие параметры:

|Параметр|Описание|
|---|---|
|TenantId|Уникальный идентификатор организации в Azure AD, которая предоставила доступ для вашего приложения. Этот параметр будет указан только в том случае, если клиент предоставил доступ.|
|Согласие на предоставление разрешений|Для этого параметра будет задано значение "Granted", если доступ для приложения был предоставлен, или значение "Denied", если запрос был отклонен.|

Дополнительные параметры возвращаются в приложение, если они были указаны в составе URL-адреса в кодировке ConsentReturnUrl. Ниже приведен пример ответа на запрос о предоставлении доступа, который указывает, что приложение авторизовано, а также содержит идентификатор ContextID, который был указан в запросе о предоставлении доступа: `https://adatum.com/ExpenseReport.aspx?ContextID=123456&Consent=Granted&TenantId=f03dcba3-d693-47ad-9983-011650e64134`.

>[AZURE.NOTE]Ответ о предоставлении доступа не содержит токен безопасности для пользователя, поэтому приложение должно выполнить вход пользователя отдельно.

Ниже приведен пример ответа на запрос о предоставлении доступа, который был отклонен: `https://adatum.com/ExpenseReport.aspx?ContextID=123456&Consent=Denied`

#### Развертывание ключей приложения для непрерывного доступа к API Graph (предыдущие версии)

В течение жизненного цикла приложения может потребоваться изменить ключи, используемые при вызове Azure AD в целях получения токена доступа для вызова API Graph. Обычно бывает два типа изменения ключей: аварийная смена в случае компрометации ключа и смена в связи со скорым окончанием срока действия текущего ключа. Необходимо следовать описанной ниже процедуре, чтобы обеспечить приложению непрерывный доступ во время обновления ключей (это особенно важно во втором случае).

1. На портале управления Azure щелкните клиент каталога, выберите пункт "Приложения" в верхнем меню, а затем выберите приложение, которое требуется настроить. Отображается страница быстрого запуска с единым входом и другими сведениями о конфигурации.

1. Щелкните пункт "Настроить" в верхнем меню, чтобы отобразить список свойств приложения и список ключей.

1. В области "Ключи" щелкните раскрывающийся список "Выбрать длительность" и выберите 1 год или 2 года, а затем щелкните элемент "Сохранить" на панели команд. При этом для вашего приложения создается новый ключ пароля. Скопируйте этот новый ключ пароля. На этом этапе для получения токена доступа из Azure AD можно использовать как существующий, так и новый ключ.

1. Вернитесь к своему приложению и обновите конфигурацию, чтобы начать использовать новый ключ пароля. Пример выполнения такого обновления см. в статье [Использование API Graph для запроса в Azure AD](https://msdn.microsoft.com/library/azure/dn151791.aspx).

1. Теперь следует распространить это изменение в рабочей среде, сначала проверив его работу на одном узле службы, а затем развернув на остальных узлах.

1. По завершении обновления во всей рабочей среде можно вернуться на портал управления Azure и удалить старый ключ.

#### Изменение свойств приложения после включения доступа (предыдущие версии)

После предоставления внешним пользователям доступа к вашему приложению вы по-прежнему можете вносить изменения в свойства приложения на портале управления Azure. Однако клиенты, которым уже был предоставлен доступ для вашего приложения до внесения изменений в приложение, не увидят эти изменения при просмотре сведений о приложении на портале управления Azure. Когда приложение становится доступным для клиентов, вы должны быть крайне осторожным при внесении определенных изменений. Например, если вы обновляете URI идентификатора приложения, то существующие клиенты, доступ которым был предоставлен до внесения таких изменений, не смогут выполнить вход в приложение с помощью своих рабочих или учебных учетных записей.

При внесении изменений в RequestedPermissions для запроса более высокого уровня доступа существующие клиенты, использующие функции приложения, в которых теперь применяются новые вызовы API с повышенным уровнем доступа, могут получить от API Graph ответ с отказом в доступе. Приложение должно учитывать такие ситуации и просить клиента предоставить доступ к приложению с помощью запроса о повышении уровня доступа.

## Удаление приложения

В этом разделе описывается удаление приложения из каталога как для однотенантных, так и для мультитенантных приложений.

### Порядок удаления однотенантного приложения из каталога

1. Войдите на портал управления Azure.

1. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.

1. В верхнем меню щелкните "Приложения" и выберите приложение, которое требуется настроить. Отображается страница быстрого запуска с единым входом и другими сведениями о конфигурации.

1. На панели команд нажмите кнопку "Удалить".

1. Нажмите кнопку "Да" в сообщении подтверждения.

### Порядок удаления мультитенантного приложения из каталога

1. Войдите на портал управления Azure.

1. Щелкните значок Active Directory в левом меню, а затем выберите нужный каталог.

1. В верхнем меню щелкните "Приложения" и выберите приложение, которое требуется настроить. Отображается страница быстрого запуска с единым входом и другими сведениями о конфигурации.

1. В разделе "Приложение является мультитенантным" нажмите кнопку "Нет". Это преобразует ваше приложение в однотенантное, однако оно по-прежнему остается в организации, которая уже дала для него согласие.

1. На панели команд нажмите кнопку "Удалить".

1. Нажмите кнопку "Да" в сообщении подтверждения.

Чтобы запретить доступ приложения к своему каталогу (после предоставления согласия), администратору компании необходимо иметь подписку Azure для запрета доступа через портал управления Azure. Чтобы запретить доступ, администратор компании также может использовать [командлеты Azure AD PowerShell](http://go.microsoft.com/fwlink/?LinkId=294151).

## Дополнительная информация

- [Рекомендации по фирменной символике для интегрированных приложений](active-directory-branding-guidelines.md)

- [Объекты приложений и объекты субъектов-служб](active-directory-application-objects.md)

- Основные сведения о [манифесте приложения Azure Active Directory](active-directory-application-manifest.md)

- См. [Руководство разработчика по Azure Active Directory](active-directory-developers-guide.md)

<!---HONumber=AcomDC_1203_2015-->