---
title: Azure AD Connect Health. Диагностика ошибок синхронизации повторяющихся атрибутов | Документация Майкрософт
description: В этом документе описывается диагностика ошибок синхронизации повторяющихся атрибутов и возможное исправление сценариев потерянных объектов непосредственно с портала Azure.
services: active-directory
documentationcenter: ''
author: zhiweiw
manager: maheshu
editor: billmath
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/11/2018
ms.author: zhiweiw
ms.openlocfilehash: 0a345fd3443fb33d6f5912c8a04677091e20ecc8
ms.sourcegitcommit: 688a394c4901590bbcf5351f9afdf9e8f0c89505
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/18/2018
ms.locfileid: "34305661"
---
# <a name="duplicate-attribute-sync-errors-diagnosis-and-remediation"></a>Диагностика ошибок синхронизации повторяющихся атрибутов и их устранение 

## <a name="overview"></a>Обзор
В отличие от простого выявления ошибок синхронизации, Azure Active Directory Connect Health представляет возможность самостоятельного устранения ошибок синхронизации повторяющихся атрибутов и потерянных объектов из Azure AD. Основные преимущества функции диагностики:
- обеспечивает процедуру диагностики для сужения сценариев ошибок синхронизации повторяющихся атрибутов и указывает конкретные разрешения;
- применяет исправление для выделенных сценариев из Azure AD, позволяя устранить ошибку одним щелчком мыши;
- для включения этой функции не требуется обновление или настройка
(см. сведения об [устойчивости повторяющихся атрибутов](https://aka.ms/dupattributeresdocs) Azure AD).

## <a name="problems"></a>Проблемы
### <a name="common-scenario"></a>Стандартный сценарий
При возникновении ошибок синхронизации **QuarantinedAttributeValueMustBeUnique** и **AttributeValueMustBeUnique** в Azure AD обычно происходит конфликт имени участника-пользователя и адреса прокси-сервера. Вы можете устранить ошибки синхронизации, обновив конфликтующий исходный объект в локальном расположении. Ошибка синхронизации будет устранена после следующей синхронизации. Например, на приведенном ниже рисунке показан конфликт имени *Joe.J@contoso.com* двух участников-пользователей. В Azure AD конфликтующие объекты помещаются в карантин. 

![Распространенный сценарий диагностики ошибок синхронизации](./media/active-directory-aadconnect-health-sync-iidfix/IIdFixCommonCase.png)

### <a name="orphaned-object-scenario"></a>Сценарий с потерянным объектом
Иногда можно обнаружить, что текущий пользователь теряет привязку к источнику. Удаление исходного объекта произошло в локальной службе AD, но изменение сигнала удаления никогда не синхронизировалось с Azure AD. Это может произойти, например, из-за проблем модуля синхронизации или миграции домена. Когда тот же объект восстанавливается или повторно создается, по логике для текущего пользователя должна выполняться синхронизация из привязки к источнику. Для текущего пользователя только как облачного объекта вы также можете видеть конфликтующего пользователя, синхронизированного с Azure AD, которого нельзя синхронизировать с текущим объектом. Прямого способа переназначить привязку к источнику нет. Ознакомьтесь с [этой статьей базы знаний](https://support.microsoft.com/help/2647098). Например, текущий объект в Azure AD сохраняет лицензию Joe. Недавняя синхронизация объекта с другой привязкой к источнику произошла в состоянии повторяющегося атрибута в Azure AD. В Azure AD изменения имени Joe в локальной службе AD нельзя применить к первоначальному пользователю Joe (текущий объект).  

![Диагностика ошибок синхронизации в сценарии с потерянным объектом](./media/active-directory-aadconnect-health-sync-iidfix/IIdFixOrphanedCase.png)

## <a name="diagnostic-and-troubleshooting-steps-in-connect-health"></a>Шаги по диагностике и устранению неполадок в Connect Health 
Функция диагностики поддерживает объекты-пользователи со следующими повторяющимися атрибутами:

| Имя атрибута | Типы ошибок синхронизации|
| ------------------ | -----------------|
| UserPrincipalName | QuarantinedAttributeValueMustBeUnique или AttributeValueMustBeUnique | 
| ProxyAddresses | QuarantinedAttributeValueMustBeUnique или AttributeValueMustBeUnique | 
| SipProxyAddress | AttributeValueMustBeUnique | 
| OnPremiseSecurityIdentifier |  AttributeValueMustBeUnique |

>[!IMPORTANT]
> Для доступа к этой функции в параметрах RBAC требуется разрешение **глобального администратора** или **участника**. 
>

Следуя шагам на портале Azure, вы сможете сузить сведения об ошибках синхронизации и найти более конкретные решения:

![Шаги по диагностике для определения ошибок синхронизации](./media/active-directory-aadconnect-health-sync-iidfix/IIdFixSteps.png)

На портале Azure вам нужно выполнить несколько шагов, чтобы определить конкретные сценарии для исправления:  
1.  В столбце состояния диагностики вы увидите, есть ли потенциальные методы устранения неполадок, чтобы сузить сценарии ошибки и, возможно, исправить их непосредственно из Azure Active Directory.
| Status | Что это означает? |
| ------------------ | -----------------|
| Не запущено | Вы не рассмотрели этот процесс диагностики. В зависимости от результата диагностики, может существовать возможность исправить ошибку синхронизации напрямую с портала. |
| Требуется исправление вручную | Ошибка не подпадает под критерии доступного исправления с портала. Вариантами могут быть: конфликтующие типы объектов, не являющиеся пользователями; вы уже выполнили шаги по диагностике, а на портале нет доступных исправлений. В этом случае одним из решений по-прежнему будет исправление в локальном расположении. [Дополнительные сведения об исправлении в локальном расположении](https://support.microsoft.com/help/2647098) | 
| Ожидается синхронизация | Исправление было применено. Ожидание следующего цикла синхронизации для устранения ошибки. |
>[!IMPORTANT]
> Данные в столбце состояния диагностики будут сбрасываться после каждого цикла синхронизации. 
>

2.  При нажатии кнопки **Диагностика** в колонке сведений об ошибке вам нужно ответить на несколько вопросов и определить подробности ошибки синхронизации. Ответы помогут определить вариант сценария с потерянным объектом. 

3.  Если после окончания диагностики появляется кнопка **Закрыть**, это означает, что на основе данных ответов на портале нет способов быстрого устранения неполадок. Выберите решение, показанное на последнем шаге. Можно по-прежнему выполнить исправление в локальном расположении. Когда вы нажмете кнопку "Закрыть", состояние текущей ошибки синхронизации изменится на **Требуется исправление вручную**. Это состояние будет сохранено во время текущего цикла синхронизации.

4.  После определения сценария с потерянным объектом вы сможете исправить ошибки синхронизации повторяющихся атрибутов напрямую с портала. Нажмите кнопку **Применить исправление**, чтобы запустить процесс. Состояние текущей ошибки синхронизации обновится и изменится на **Ожидается синхронизация**.

5.  После следующего цикла синхронизации ошибка будет удалена из списка.

## <a name="how-to-answer-the-diagnosis-questions"></a>Как ответить на вопросы по диагностике 
### <a name="does-the-user-exist-in-your-on-premises-active-directory"></a>Есть ли в локальном каталоге Active Directory пользователь?

Вопрос заключается в попытке идентифицировать исходный объект текущего пользователя из локального каталога Active Directory.  
1.  Проверьте, содержит ли Active Directory объект с предоставленным UserPrincipalName. Если нет, ответьте "Нет".
2.  Если да, убедитесь, что объект все еще находится в области для синхронизации.  
  - Выполните поиск в пространстве соединителя Azure AD с помощью различающегося имени.
  - Если состояние найденного объекта **Pending Add** (Ожидание добавления), ответьте "Нет". Azure AD Connect не может подключить объект к нужному объекту AD.
  - Если объект не найден, ответьте "Да".

> Рассмотрим схему ниже. Например, вопрос заключается в попытке идентифицировать, есть ли в локальном расположении Active Directory пользователь *Joe Jackson*.
Для **распространенного сценария** оба пользователя — *Joe Johnson* и *Joe Jackson* будут присутствовать в локальном каталоге Active Directory. Объектами, помещенными в карантин, являются два разных пользователя.

![Распространенный сценарий диагностики ошибок синхронизации](./media/active-directory-aadconnect-health-sync-iidfix/IIdFixCommonCase.png)

> Для **сценария с потерянным объектом** только один пользователь — *Joe Johnson* будет присутствовать в локальном расположении Active Directory:

![Диагностика ошибок синхронизации в сценарии с потерянным объектом](./media/active-directory-aadconnect-health-sync-iidfix/IIdFixOrphanedCase.png)

### <a name="do-both-these-accounts-belong-to-the-same-user"></a>Обе эти учетные записи принадлежат одному пользователю?
Вопрос заключается в проверке входящего конфликтующего пользователя и текущего объекта пользователя в Azure AD, чтобы узнать, принадлежат ли они одному пользователю.  
1.  Конфликтующий объект вновь синхронизируется с Azure Active Directory. Сравните эти объекты на основе следующего:  
  - Отображаемое имя
  - Имя участника-пользователя
  - Object ID
2.  Если сравнить их не удается, проверьте, есть ли в Active Directory объекты с указанными UserPrincipalName. Если найдутся два таких объекта, ответьте "Нет".  

> В приведенном ниже примере два объекта принадлежат одному и тому же пользователю — *Joe Johnson*.

![Диагностика ошибок синхронизации в сценарии с потерянным объектом](./media/active-directory-aadconnect-health-sync-iidfix/IIdFixOrphanedCase.png)


## <a name="what-happened-after-fix-is-applied-for-orphaned-object-scenario"></a>Что происходит после того, как исправление применяется для сценария с потерянным объектом
Ответив на вопросы выше, вы увидите кнопку **Применить исправление**, если оно доступно в Azure AD. В этом случае локальный объект синхронизируется с непредвиденным объектом Azure AD. Два объекта сопоставляются с помощью привязки к источнику. При применении изменения сделайте следующее:
- обновите привязку к источнику для правильного объекта в Azure AD;
- удалите конфликтующий объект в Azure AD (при его наличии).

![Диагностика ошибок синхронизации после исправления](./media/active-directory-aadconnect-health-sync-iidfix/IIdFixAfterFix.png)

>[!IMPORTANT]
> Изменение "Применить исправление" применимо только к сценариям с потерянными объектами.
>

После выполнения описанных выше шагов пользователь сможет получить доступ к исходному ресурсу, который является ссылкой на текущий объект. Значение **состояния диагностики** в представлении списка будет обновлено до **Ожидается синхронизация**. Ошибка синхронизации будет устранена после следующей синхронизации. Connect Health больше не будет отображать в представлении списка исправленную ошибку синхронизации. 


## <a name="faq"></a>Часто задаваемые вопросы
 -  Что происходит при сбое применения исправления?  
Если происходит сбой применения, возможно, в это время в Azure AD Connect возникла ошибка экспорта. Обновите страницу портала и повторите попытку после следующей синхронизации. Цикл синхронизации по умолчанию — 30 минут. 

 -  Что если **текущий объект** является объектом, который нужно удалить?  
Если следует удалить текущий объект, этот процесс не требует изменения привязки к источнику. Это можно исправить из локальной службы AD.  

 -  Какое разрешение должно быть у пользователя, чтобы применить исправление?  
Разрешения глобального администратора или участника в параметрах RBAC позволяют получить доступ к диагностике и устранению неполадок.

 -  Нужно ли мне настраивать AAD Connect или обновлять агент Azure AD Connect Health для этой функции?  
Нет, диагностика — это полностью облачная функция.

 -  При обратимом удалении текущего объекта можно ли с помощью процесса диагностики восстановить его?  
Нет, при исправлении атрибут объекта не обновляется, если это не привязка к источнику. 
