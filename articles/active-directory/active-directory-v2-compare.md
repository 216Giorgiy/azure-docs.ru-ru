<properties
	pageTitle="Модель приложений 2.0 | Microsoft Azure"
	description="Сравнение общедоступной службы Azure AD и общедоступной предварительной версии модели приложения 2.0."
	services="active-directory"
	documentationCenter=""
	authors="dstrockis"
	manager="mbaldwin"
	editor=""/>

<tags
	ms.service="active-directory"
	ms.workload="identity"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="12/09/2015"
	ms.author="dastrock"/>

# Предварительная версия модели приложений v2.0: в чем отличия?

Если вы знакомы с общедоступной службой Azure AD или интегрировали приложения с Azure AD в прошлом, в модели приложений версии 2.0 вы можете встретить несколько неожиданных отличий. Они описаны в этом документе.

> [AZURE.NOTE]Эти сведения относятся к общедоступной предварительной версии модели приложений 2.0. Инструкции по интеграции с общедоступной службой Azure AD см. в статье [Руководство разработчика Azure Active Directory](active-directory-developers-guide.md).


## Учетные записи Майкрософт и Azure AD
Модель приложения версии 2.0 позволяет разработчикам создавать приложения, поддерживающие вход с учетными записями Майкрософт и Azure AD с использованием одной конечной точки. Это дает возможность разрабатывать приложения, которые полностью не зависят от учетных записей. Конечно, *можно* сообщить приложению, какая учетная запись используется в сеансе, но это необязательно.

Например, если приложение вызывает [интерфейсы REST API Office 365](https://msdn.microsoft.com/office/office365/howto/authenticate-Office-365-APIs-using-v2), корпоративным пользователям будут доступны некоторые дополнительные функции и данные, например сайты SharePoint или данные каталога. Но многие действия, такие как [чтение почты пользователя](https://msdn.microsoft.com/office/office365/howto/authenticate-Office-365-APIs-using-v2), можно выполнять с помощью одного кода для учетных записей Майкрософт и Azure AD.

Теперь интеграция приложения с учетными записями Майкрософт и Azure AD — один простой процесс. Вы можете использовать один набор конечных точек, одну библиотеку и один процесс регистрации приложения для получения доступа как к потребительскому, так и корпоративному миру. Подробнее о предварительной версии модели приложения 2.0 см. в этом [обзоре](active-directory-appmodel-v2-overview.md).


## Новый портал регистрации приложений
Модель приложения версии 2.0 требует регистрации приложений Майкрософт в новом месте: [apps.dev.microsoft.com](https://apps.dev.microsoft.com). Это портал, где вы можете получить идентификатор приложения, настроить внешний вид страницы входа и т. д. Мы продолжим расширять возможности этого портала регистрации приложений главным образом на основе отзывов, полученных на этапе предварительной версии. Наша цель — сделать этот портал новым ресурсом, где вы сможете управлять всем, что связано с вашими приложениями Майкрософт.

И, что лучше всего, вам не требуется подписка Azure или Office для его использования. Все, что нужно — личная учетная запись Майкрософт либо рабочая или школьная учетная запись.

Обратите внимание, что в настоящее время приложений, зарегистрированные на новом портале, будут работать только с версией 2.0 модели приложения, и *только* приложения, зарегистрированные на новом портале, будут работать с версией 2.0 модели приложения. Если попытаться использовать одно из этих приложений с общедоступной учетной записью Майкрософт или служб Azure AD либо попробовать использовать существующее приложение с моделью приложения версии 2.0, могут возникнуть проблемы с совместимостью.


## Один идентификатор приложения для всех платформ
В общедоступной версии службы Azure AD можно было зарегистрировать несколько различных приложений для одного проекта. Вам приходилось использовать отдельные регистрации для собственных клиентов и веб-приложений:

![Старый пользовательский интерфейс регистрации приложения](../media/active-directory-v2-flows/old_app_registration.PNG)

Например, если вы создали и веб-сайт, и приложение для iOS, вам было необходимо зарегистрировать их отдельно с использованием двух различных идентификаторов приложений. Если у вас был веб-сайт и серверный веб-API, вы могли зарегистрировать их как отдельные приложения в Azure AD. Если у вас было приложение для iOS и Android, вы также могли зарегистрировать два различных приложения.

<!-- You may have even registered different apps for each of your build environments - one for dev, one for test, and one for production. -->

Теперь же вам необходима всего лишь одна регистрация и один идентификатор приложения для каждого проекта. Можно добавить несколько "платформ" для каждого проекта и предоставить соответствующие данные для каждой добавляемой платформы. Конечно, вы можете создавать столько приложений, сколько хотите, в зависимости от требований, но в большинстве случаев потребуется только один идентификатор приложения.

<!-- You can also label a particular platform as "production-ready" when it is ready to be published to the outside world, and use that same Application Id safely in your development environments. -->

Мы стремимся к тому, чтобы упростить управление приложениями и их разработку, а также создать консолидированное представление проекта, с которым вы можете работать.


## Области, а не ресурсы
В общедоступной службе Azure AD приложения могут вести себя как **ресурс** или получатель маркеров. Ресурс можно определить несколько **областей** или **разрешений oAuth2**, которые он распознает, позволяя клиентским приложениям запрашивать маркеры к этому ресурсу для определенного набора областей. Рассмотрим API Azure AD Graph в качестве примера ресурса.

- Идентификатор ресурса или `AppID URI`: `https://graph.windows.net/`
- Области или `OAuth2Permissions`: `Directory.Read`, `Directory.Write` и т. п.  

Все это справедливо и для модели приложения версии 2.0. Приложение по-прежнему может вести себя как ресурс, определять области и идентифицироваться по URI. Клиентские приложения по-прежнему могут запрашивать доступ к этим областям. Однако способ запроса клиентами этих разрешений изменился. В прошлом запрос авторизации OAuth 2.0 в Azure AD выглядел так:

```
GET https://login.microsoftonline.com/common/oauth2/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e
&resource=https%3A%2F%2Fgraph.windows.net%2F
...
```

где параметр **resource** указывает, к какому ресурсу клиентское приложение запрашивает авторизацию. Служба Azure AD определяла разрешения, необходимые приложению, на основе статической конфигурации на портале Azure и выдавала маркеры соответствующим образом. Теперь же запрос авторизации OAuth 2.0 выглядит так:

```
GET https://login.microsoftonline.com/common/v2.0/oauth2/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e
&scope=https%3A%2F%2Fgraph.windows.net%2Fdirectory.read%20https%3A%2F%2Fgraph.windows.net%2Fdirectory.write
...
```

где параметр **scope** указывает, для каких ресурсов и разрешений приложение запрашивает авторизацию. Нужный ресурс по-прежнему присутствует в запросе — просто он состоит из каждого значения параметра области. Используя параметр области таким образом, модель приложения версии 2.0 улучшает совместимость со спецификацией OAuth 2.0 и поддержку отраслевых стандартов. Это также позволяет приложениям реализовать [добавочное согласие](#incremental-and-dynamic-consent), описанное в следующем разделе.

## Добавочное и динамическое согласие
Приложения, зарегистрированные в общедоступной службе Azure AD, должны были указывать необходимые разрешения OAuth 2.0 на портале Azure во время создания приложения:

![Пользовательский интерфейс регистрации разрешений](../media/active-directory-v2-flows/app_reg_permissions.PNG)

Разрешения, необходимые приложению, настраивались **статически**. Хотя это позволяло хранить конфигурацию приложения на портале и упрощало код, для разработчиков появлялись определенные сложности.

- Приложению должны были быть известны все разрешения, которые могли понадобиться во время создания приложения. Добавить разрешения в дальнейшем было не так просто.
- Приложению заранее должны были быть известны все ресурсы, к которым оно будет обращаться. Было трудно создавать приложения, использующие произвольное количество ресурсов.
- Приложение должно было запрашивать все разрешения, которые могли потребоваться при первом входе пользователя в систему. В некоторых случаях это приводило к получению большого списка разрешений, из-за чего пользователи не разрешали приложению доступ при первоначальном входе.

В модели приложения версии 2.0 можно указывать разрешения, необходимые приложению, **динамически** во время регулярного использования приложения. Для этого можно указать области, требуемые приложению в любой момент времени, включив их в параметр `scope` авторизации запроса:

```
GET https://login.microsoftonline.com/common/v2.0/oauth2/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e
&scope=https%3A%2F%2Fgraph.windows.net%2Fdirectory.read%20https%3A%2F%2Fgraph.windows.net%2Fdirectory.write
...
```

Пример выше запрашивает разрешение на чтение данных каталога пользователя Azure AD, а также на запись данных в каталог. Если пользователи предоставили эти разрешения в прошлом для этого конкретного приложения, они просто введут свои учетные данные и войдут в приложение. Если пользователи не предоставили какие-либо из этих разрешений, конечная точка версии 2.0 запросит у пользователя эти разрешения. Подробнее см. в разделе о [разрешениях, согласии и областях](active-directory-v2-scopes.md).

Возможность приложения динамически запрашивать разрешения с помощью параметра `scope` дает вам полный контроль над взаимодействием с пользователями. При желании можно запросить все разрешения в первоначальном запросе авторизации. Или же, если приложению требуется множество разрешений, вы можете запрашивать их у пользователей постепенно, когда они попытаются применять некоторые функции приложения с течением времени.

## Автономный доступ
Модель приложения версии 2.0 вводит новое известное разрешение для приложений — область `offline_access`. Всем приложения требуется запросить это разрешение, если им необходимо доступ к ресурсам от имени пользователя в течение длительного времени, даже если пользователь не работает с приложением активно. Область `offline_access` отображается в диалоговых окнах запроса согласия как разрешение "Доступ к данным в автономном режиме", которое пользователь должен принять. Запрос разрешения `offline_access` позволит веб-приложению получать маркеры обновления OAuth 2.0 от конечной точки версии 2.0. У маркеров обновления длительный срок действия, и их можно заменить на новые маркеры доступа OAuth 2.0 на значительные периоды доступа.

Если приложение не запрашивает область `offline_access`, оно не получит маркеры обновления. Это значит, что при использовании кода авторизации в [потоке кода авторизации OAuth 2.0](active-directory-v2-protocols.md#oauth2-authorization-code-flow) вы получите только маркер доступа из конечной точки `/oauth2/token`. Маркер доступа будет действительным короткое время (обычно один час), но в конечном итоге срок его действия истечет. В этот момент приложение будет необходимо перенаправить пользователя обратно в конечную точку `/oauth2/authorize`, чтобы получить новый код авторизации. При этом пользователю может потребоваться повторно ввести учетные данные или повторно предоставить разрешения в зависимости от типа приложения.

Подробнее о протоколе OAuth 2.0, маркера обновления и доступа см. в [справочнике по протоколу модели приложения версии 2.0](active-directory-v2-protocols.md).

## Утверждения маркера
Утверждения в маркерах, выданных конечной точкой версии 2.0, не совпадают с маркерами, выданными конечными точками общедоступной службы Azure AD — приложения, переходящие на новую службу, не должны предполагать, что конкретное утверждение будет существовать в маркерах удостоверения или доступа. Маркеры, выданные конечной точкой версии 2.0, соответствуют спецификациям OAuth 2.0 и OpenID Connect, но могут использовать отличную от общедоступной службы Azure AD семантику.

Подробнее об утверждениях, выдаваемых в маркерах модели приложения версии 2.0, см. в [справочнике по маркерам версии 2.0](active-directory-v2-tokens.md).


## Ограничения предварительной версии
Существует ряд ограничений, которые необходимо учитывать при создании приложения на основе модели приложения версии 2.0 на этапе общедоступной предварительной версии. Изучите [документ об ограничениях модели приложения версии 2.0](active-directory-v2-limitations.md), чтобы узнать, применимы ли эти ограничения к вашему сценарию.

<!---HONumber=AcomDC_1217_2015-->