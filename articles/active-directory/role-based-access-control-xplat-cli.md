<properties
	pageTitle="Руководство по контролю доступа на основе ролей для интерфейса командной строки Azure"
	description="Контроль доступа на основе ролей с помощью интерфейса командной строки Azure"
	services="active-directory"
	documentationCenter="na"
	authors="kgremban"
	manager="stevenpo"
	editor=""/>

<tags
	ms.service="active-directory"
	ms.workload="identity"
	ms.tgt_pltfrm="command-line-interface"
	ms.devlang="na"
	ms.topic="article"
	ms.date="03/17/2016"
	ms.author="kgremban"/>

# Руководство по контролю доступа на основе ролей для интерфейса командной строки Azure

> [AZURE.SELECTOR]
- [PowerShell](role-based-access-control-powershell.md)
- [Интерфейс командной строки Azure](role-based-access-control-xplat-cli.md)

Функция управления доступом на основе ролей (RBAC) на портале Azure и в API диспетчера ресурсов Azure позволяет очень точно управлять доступом к подписке и ресурсам. С ее помощью вы можете предоставлять доступ пользователям, группам и субъектам-службам Active Directory, назначая им роли с определенной областью.

Из этого учебника вы узнаете, как использовать интерфейс командной строки Azure CLI для управления RBAC. Он представляет собой пошаговое руководство по созданию ролей и проверке их назначений.

**Предполагаемое время выполнения:** 15 минут.

## Предварительные требования

Чтобы использовать Azure CLI для управления RBAC, вам понадобится:

- Интерфейс командной строки Azure версии 0.8.8 или более поздней. Чтобы установить последнюю версию и связать ее со своей подпиской Azure, см. статью [Установка и настройка интерфейса командной строки Azure](../xplat-cli-install.md);
- Чтобы узнать, как настраивать и использовать Azure Resource Manager в Azure CLI, также прочитайте руководство [Использование Azure CLI для Mac, Linux и Windows с диспетчером ресурсов Azure](../xplat-cli-azure-resource-manager.md).

## <a id="connect"></a>Подключение к подпискам

RBAC работает только с диспетчером ресурсов Azure, поэтому в первую очередь необходимо перейти в режим диспетчера ресурсов Azure. Введите:

    azure config mode arm

Чтобы подключиться к подпискам Azure, введите:

    azure login -u <username>

В командной строке введите пароль вашей учетной записи Azure (поддерживается только рабочая или учебная учетная запись). Интерфейс интерфейс командной строки Azure соберет информацию обо всех подписках с этой учетной записью. В качестве подписки по умолчанию будет выбрана первая из них. Обратите внимание: при использовании управления доступом на основе ролей вы получите только те подписки, в которых у вас есть разрешения, т. е. для которых вы являетесь соадминистратором или вам назначена какая-либо роль.

Если у вас несколько подписок и вы хотите переключиться на другую, введите:

    # This will show you the subscriptions under the account.
    azure account list
    # Use the subscription name to select the one you want to work on.
    azure account set <subscription name>

## <a id="check">Проверка существующих назначений ролей</a>

Теперь давайте проверим, какие назначения ролей уже есть в подписке. Введите:

    azure role assignment list

Эта команда возвращает все назначения ролей в подписке. Обратите внимание на два момента:

1. Вам потребуется доступ на чтение на уровне подписки.
2. Если в подписке много назначений ролей, получение сведений о них может занять некоторое время.

Можно также проверить существующие назначения ролей для конкретного определения роли с конкретной областью для отдельного пользователя. Тип:

    azure role assignment list -g group1 --upn <user email> -o Owner

Эта команда возвращает все назначения ролей для определенного пользователя в каталоге Azure AD, которому назначена роль "Владелец" для группы ресурсов group1. Назначение роли может иметь два разных источника:

1. Назначение роли "Владелец" пользователю для группы ресурсов.
2. Назначение роли "Владелец" пользователю для родительского элемента группы ресурсов (в данном случае это подписка). Если назначить разрешения на родительском уровне, все дочерние элементы будут иметь те же разрешения.

Все параметры этого командлета необязательны. Вы можете использовать их в различных сочетаниях для проверки назначений ролей с разными фильтрами.

## <a id="create"></a>Создание назначения роли

При создании назначения роли необходимо учесть перечисленные ниже моменты.

- Кому вы хотите назначить роль? Для просмотра пользователей, групп и субъектов-служб, существующих в каталоге, можно использовать следующие командлеты Azure Active Directory:

    ```
    azure ad user list  
    azure ad user show  
    azure ad group list  
    azure ad group show  
    azure ad group member list  
    azure ad sp list  
    azure ad sp show  
    ```

- Какую роль вы хотите назначить? Для просмотра поддерживаемых определений ролей можно использовать следующий командлет:

    `azure role list`

- Какую область вы хотите назначить? Доступны три уровня:

    - текущая подписка;
    - Группа ресурсов. Чтобы получить список групп ресурсов, введите команду `azure group list`;
    - Ресурс. Чтобы получить список ресурсов, введите команду `azure resource list`.

Затем используйте `azure role assignment create`, чтобы создать назначение роли. Например:

 	#Create a role assignment at the current subscription level for a user as a reader:
    azure role assignment create --upn <user email> -o Reader

	#Create a role assignment at a resource group level:
    PS C:\> azure role assignment create --upn <user email> -o Contributor -g group1

	#Create a role assignment at a resource level:
    azure role assignment create --upn <user email> -o Owner -g group1 -r Microsoft.Web/sites -u site1

## <a id="verify"></a>Проверка разрешений

Если вашей учетной записи назначены какие-либо роли, вы можете просмотреть, какие именно разрешения предоставляют эти назначения, с помощью следующих командлетов:

    PS C:\> azure group list
    PS C:\> azure resource list

Эти два командлета возвращают только группы ресурсов или ресурсы, для которых у вас есть разрешение на чтение. Они также отображают имеющиеся у вас разрешения.

Попытавшись затем выполнить другие командлеты, например `azure group create`, вы получите сообщение об отказе в доступе, если у вас нет соответствующего разрешения.

## <a id="next"></a>Дальнейшие действия

Чтобы узнать больше об управлении доступом на основе ролей с помощью интерфейса командной строки Azure, воспользуйтесь следующими ресурсами:

- [Управление доступом на основе ролей в Azure](role-based-access-control-configure.md)
- [Установка и настройка интерфейса командной строки Azure](../xplat-cli-install.md)
- [Использование интерфейса командной строки Azure с диспетчером ресурсов](../xplat-cli-azure-resource-manager.md)
- [Управление ресурсами Azure с помощью портала Azure](../azure-portal/resource-group-portal.md): узнайте, как создавать группы ресурсов и управлять ими на портале Azure.
- [Блог Azure](http://blogs.msdn.com/windowsazure): узнайте о новых возможностях в Azure.
- [Настройка управления доступом на основе ролей с помощью Windows PowerShell](role-based-access-control-powershell.md)
- [Устранение неполадок управления доступом на основе ролей](role-based-access-control-troubleshooting.md)

<!---HONumber=AcomDC_0323_2016-->