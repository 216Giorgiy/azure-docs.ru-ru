<properties
   pageTitle="Общие сведения о неявном потоке предоставления OAuth2 в Azure Active Directory | Microsoft Azure"
   description="Узнайте о процессе неявного потока предоставления OAuth2 в Azure Active Directory и его совместимости с вашим приложением."
   services="active-directory"
   documentationCenter="dev-center-name"
   authors="vibronet"
   manager="mbaldwin"
   editor=""/>

<tags
   ms.service="active-directory"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="identity"
   ms.date="06/01/2016"
   ms.author="vittorib;bryanla"/>

# Общие сведения о неявном потоке предоставления OAuth2 в Azure Active Directory (AD)

В спецификации OAuth2 неявное предоставление OAuth2 известно по наибольшему количеству проблем, связанных с безопасностью. Но именно этот подход, реализуемый с использованием библиотеки аутентификации Active Directory для JavaScript, рекомендуется использовать при написании одностраничных приложений. Что это дает? Все зависит от преимуществ: неявное предоставление лучше всего подходит для приложений, которые используют веб-API через JavaScript в браузере.

## Что такое неявное предоставление OAuth2

По своей сути [предоставление кода авторизации OAuth2](https://tools.ietf.org/html/rfc6749#section-1.3.1) предусматривает использование двух отдельных конечных точек. Конечная точка авторизации используется на стадии взаимодействия с пользователем, результатом чего является получение кода авторизации. Клиент использует конечную точку маркера, чтобы обменивать код на маркер доступа, а зачастую также на маркер обновления. Чтобы подключится к конечной точке маркера, для веб-приложений требуются собственные учетные данные. Они позволяют клиенту пройти проверку подлинности на сервере авторизации.

[Неявное предоставление OAuth2](https://tools.ietf.org/html/rfc6749#section-1.3.2) — это способ получения клиентом маркера доступа (а при использовании [OpenId Connect](http://openid.net/specs/openid-connect-core-1_0.html) — id\_token) напрямую из конечной точки авторизации без необходимости связываться с конечной точкой маркера и выполнять проверку подлинности клиентского приложения. Этот вариант разработан специально для приложений JavaScript, работающих в веб-браузере. В стандартных спецификациях OAuth2 маркеры возвращаются во фрагмент универсального кода ресурса (URI). Это обеспечивает доступность маркеров для кода JavaScript в клиенте, но гарантирует, что они не будут перенаправляться на сервер. Возвращение маркера через браузер напрямую из конечных точек также создает преимущество, позволяя исключить требования для выполнения междоменных вызовов, которые могут быть необходимы для взаимодействия приложения JavaScript с конечной точкой маркера.

Важной характеристикой неявного предоставления OAuth2 является то, что такие потоки никогда не возвращают маркеры обновления в клиент. Как мы увидим в следующем разделе, для этого нет необходимости. Кроме того, это может служить причиной проблем с безопасностью.

## Подходящие сценарии для неявного предоставления OAuth2

Как указано в спецификации OAuth2, неявное предоставление предусмотрено, чтобы можно было использовать приложения агента пользователя, т. е. запускать приложения JavaScript в браузере. Определяющей характеристикой таких приложений является использование кода JavaScript для доступа к ресурсам сервера (обычно веб-API) и соответствующего обновления интерфейса приложения. Рассмотрим такие приложения, как Gmail или Outlook Web Access. При выборе входящего сообщения, чтобы отобразить новое выделение, изменяется только область визуализации, в то время как остальная часть страницы остается неизменной. В этом заключается их отличие от традиционных веб-приложений на основе перенаправления, в которых при взаимодействии с пользователем выполняется обратная передача всей страницы и отрисовка нового ответа сервера.

Приложения на основе JavaScript в своем полном выражении называются одностраничными. Они используют только начальную HTML-страницу и связанный объект JavaScript, а все последующие операции выполняются за счет вызовов веб-API через JavaScript. Тем не менее гибридные подходы, когда приложения в основном выполняют обратную передачу, но также и отдельные вызовы JavaScript для реализации некоторых возможностей, не редкость. Их также касаются обсуждения использовании неявного потока.

В приложениях на основе перенаправления запросы защищены с помощью файлов cookie. Этот метод не подходит для приложений JavaScript, так как файлы cookie предназначены для использования в домене, для которого они созданы, а вызовы JavaScript могут направляться в другие домены. К тому же очень часто приложения вызывают API Microsoft Graph, Office и Azure, а они расположены за пределами домена, в котором обслуживается приложение. Все чаще в приложениях JavaScript не бывает интерфейса, а для реализации бизнес-функций полностью используются сторонние веб-API.

Сейчас для защиты вызовов веб-API используется токен носителя OAuth2. При таком подходе каждый вызов сопровождается маркером доступа OAuth2. Веб-API проверяет входящий маркер доступа и, если он находится в области разрешений доступа, API предоставляет доступ к запрошенной операции. Неявный поток предоставляет приложениям JavaScript удобный механизм получения маркеров доступа для веб-API, а также другие преимущества в отношении файлов cookie:

- Маркеры можно получать безопасно, не выполняя междоменные вызовы. Обязательная регистрация URI перенаправления, на который возвращаются маркеры, гарантирует, что они не будут направлены в неправильное расположение.
- Приложения JavaScript могут получать необходимое количество маркеров доступа для целевых веб-API без ограничения по доменам.
- Возможности HTML5, например управления сеансом или локальным хранилищем, предоставляют полный контроль над кэшированием и управлением временем существования маркеров, тогда как управление файлами cookie является непрозрачным для приложения.
- Маркеры доступа неуязвимы к атакам с подделкой межсайтовых запросов (CSRF).

Неявный поток предоставления не выдает маркеры обновления, преимущественно в целях безопасности. В отличие от маркеров доступа, маркеры обновления не используются в узкой области. Они предоставляют больше возможностей, и поэтому их раскрытие причиняет больше вреда. В неявном потоке маркеры предоставляются в URL-адресе, поэтому риск их перехвата больше, чем при предоставлении кода авторизации.

Тем не менее учтите, что приложения JavaScript используют другой механизм обновления маркеров доступа, который не предусматривает многократное запрашивание учетных данных пользователя. Для выполнения новых запросов маркеров к конечной точке авторизации Azure AD приложение может использовать скрытый элемент iframe. Пока в браузере открыт сеанс в домене Azure AD (т. е. сохраняется файл cookie сеанса), при запросе проверки подлинности не нужно взаимодействие с пользователем.

Эта модель приложения JavaScript позволяет независимо обновлять маркеры доступа и даже получать новые маркеры для нового API (если пользователь ранее дал свое согласие). При этом не увеличиваются расходы на получение, обслуживание и защиту такого значимого артефакта, как маркер обновления. Управление файлом cookie сеанса, т. е. артефактом, который позволяет выполнять автоматическое обновление маркера доступа, происходит вне приложения. Еще одним преимуществом этого подхода является то, что при выходе из Azure AD с использованием любого приложения, где Azure AD работает в браузере, удаляется файл cookie сеанса, и приложение JavaScript больше не может обновлять маркеры для пользователя, который вышел.

## Совместимость неявного предоставления с приложением

Неявное предоставление создает намного больше рисков, чем предоставления других типов. Аспекты, на которые следует обратить внимание, описаны в многих документах (например, см. раздел [Misuse of Access Token to Impersonate Resource Owner in Implicit Flow][OAuth2-Spec-Implicit-Misuse] \(Неправильное использование маркера доступа для выполнения роли владельца ресурсов в неявном потоке) и документ [OAuth 2.0 Threat Model and Security Considerations][OAuth2-Threat-Model-And-Security-Implications] \(Модель рисков и рекомендации по безопасности OAuth 2.0)). Но высокий риск связан преимущественно с тем, что предоставление позволяет использовать приложения с активным кодом, который отправляется из удаленного ресурса в браузер. Если используется архитектура безопасной проверки пароля, отсутствуют компоненты интерфейса или просто требуется вызвать веб-API через JavaScript, для получения маркеров рекомендуется использовать неявный поток.

Если приложение — собственный клиент, использовать неявный поток не рекомендуется. Отсутствие файла cookie сеанса Azure AD в контексте собственного клиента не позволяет поддерживать продолжительность сеансов и получать маркеры доступа для новых ресурсов без многократного запрашивания учетных данных пользователя.

При разработке веб-приложения с интерфейсом, который будет использовать API из серверного кода, также не рекомендуется использовать неявный поток. Другие предоставления позволяют использовать больше возможностей. Например, предоставление учетных данных клиента OAuth2 позволяет получать маркеры, которые соответствуют разрешениям, назначенным приложению, а не делегировать пользователей, а также позволяет настраивать программный доступ к ресурсам, даже если пользователь — не активный участник сеанса и т. д. Кроме того, такие предоставления гарантируют более высокий уровень безопасности: маркеры доступа никогда не передаются через браузер и не сохраняются в его истории, а при запросе маркера клиентское приложение выполняет строгую проверку подлинности и т. д.

## Дальнейшие действия

- Полный список ресурсов для разработчиков, в том числе справочная информация о наборе протоколов и потоках предоставления кода авторизации OAuth2.0, поддерживаемых Azure AD, см. в статье [Руководство разработчика по Azure Active Directory][AAD-Developers-Guide].
- Дополнительные сведения об интеграции приложений см. в статье [Интеграция с Azure Active Directory][ACOM-How-To-Integrate].

<!--Image references-->
[Scenario-Topology]: ./media/active-directory-devhowto-auth-using-any-aad/multi-tenant-aad-components.png

<!--Reference style links in use-->
[AAD-Developers-Guide]: active-directory-developers-guide.md
[ACOM-How-And-Why-Apps-Added-To-AAD]: active-directory-how-applications-are-added.md
[ACOM-How-To-Integrate]: active-directory-how-to-integrate.md
[OAuth2-Spec-Implicit-Misuse]: https://tools.ietf.org/html/rfc6749#section-10.16
[OAuth2-Threat-Model-And-Security-Implications]: https://tools.ietf.org/html/rfc6819

<!---HONumber=AcomDC_0601_2016-->