---
title: "Ограничения конечной точки Azure Active Directory версии 2.0 | Документация Майкрософт"
description: "Список ограничений для конечной точки Azure AD версии 2.0."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: a99289c0-e6ce-410c-94f6-c279387b4f66
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/30/2016
ms.author: dastrock
translationtype: Human Translation
ms.sourcegitcommit: 219dcbfdca145bedb570eb9ef747ee00cc0342eb
ms.openlocfilehash: 8fabc37ad8c7a99a09083422f740e5352e403438


---
# <a name="should-i-use-the-v20-endpoint"></a>Следует ли мне использовать конечную точку версии 2.0?
При создании приложений, которые интегрируются с Azure Active Directory (Azure AD), необходимо решить, соответствуют ли конечная точка версии 2.0 и протоколы аутентификации. Исходная конечная точка Azure AD по-прежнему полностью поддерживается и в некоторых отношениях является более функциональной, чем версия 2.0. Однако конечная точка версии 2.0 [представляет значительные преимущества](active-directory-v2-compare.md) для разработчиков. Преимущества версии 2.0 могут побудить вас использовать новую модель программирования.

Ниже приведены рекомендации по использованию конечной точки версии 2.0 в настоящее время.

* Если в приложении требуется поддержка личных учетных записей Майкрософт, используйте конечную точку версии 2.0. Перед этим убедитесь, что вы понимаете ограничения, которые рассматриваются в этой статье, особенно те, что относятся к рабочим и учебным учетным записям.
* Если вашему приложению нужна поддержка только рабочих или учебных учетных записей, используйте [исходные конечные точки Azure AD](active-directory-developers-guide.md).

Со временем конечная точка версии 2.0 будет развиваться и поможет устранить эти ограничения, так что вам нужно будет использовать только ее. А пока эта статья поможет вам определить, подходит ли вам конечная точка версии 2.0. Мы продолжим обновлять эту статью, чтобы отражать текущее состояние конечной точки версии 2.0. Вы можете проверить ее на наличие изменений, чтобы повторно оценить свои требования и возможности версии 2.0.

Если у вас уже есть приложение Azure AD, в котором не используется конечная точка версии 2.0, нет необходимости начинать с нуля. В будущем мы предоставим способ использования конечной точки версии 2.0 существующими приложениями Azure AD.

## <a name="restrictions-on-app-types"></a>Ограничения для типов приложений
Перечисленные ниже типы приложений в настоящее время не поддерживаются конечной точкой версии 2.0. Описание поддерживаемых типов приложений см. в разделе [Типы приложений для конечной точки Azure Active Directory версии 2.0](active-directory-v2-flows.md).

### <a name="standalone-web-apis"></a>Автономные веб-API
Можно использовать конечную точку версии 2.0 для [создания веб-API, защищенного с помощью OAuth 2.0](active-directory-v2-flows.md#web-apis). Однако такой веб-API может получать маркеры только от приложения с тем же идентификатором приложения. Невозможно получить доступ к веб-API из клиента с другим идентификатором приложения. Этот клиент не сможет запрашивать или получать разрешения для веб-API.

Чтобы узнать, как создать веб-API, принимающий маркеры от клиента с тем же идентификатором приложения, ознакомьтесь с примерами веб-API конечной точки версии 2.0 в разделе [Приступая к работе](active-directory-appmodel-v2-overview.md#getting-started).

### <a name="web-api-on-behalf-of-flow"></a>Поток предоставления от имени веб-API
Многие архитектуры включают в себя веб-API, которым требуется вызывать другие подчиненные веб-API. При этом оба интерфейса защищены конечной точкой версии 2.0. Этот сценарий характерен для собственных клиентов с внутренним веб-API, который, в свою очередь, вызывает экземпляр Microsoft Online Services или другой пользовательский веб-API, поддерживающий Azure AD.

Реализовать данный сценарий можно, предоставляя учетные данные токена носителя JSON Web Token (JWT) OAuth 2.0 (т. н. поток предоставления от имени). Однако сейчас поток предоставления от имени не поддерживается для конечной точки версии 2.0. Чтобы увидеть его в общедоступной службе Azure AD, изучите [пример кода предоставления от имени на сайте GitHub](https://github.com/AzureADSamples/WebAPI-OnBehalfOf-DotNet).

## <a name="restrictions-on-app-registrations"></a>Ограничения регистрации приложений
В настоящее время для каждого приложения, которое нужно интегрировать с конечной точкой версии 2.0, необходимо создать регистрацию на новом [портале регистрации приложений Майкрософт](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList). Существующие приложения Azure AD или учетной записи Майкрософт не совместимы с конечной точкой версии 2.0. Приложения, которые зарегистрированы на любом другом портале, кроме портала регистрации приложений, несовместимы с конечной точкой версии 2.0. Мы планируем в будущем предоставить возможность использования существующих приложений в качестве приложений для версии 2.0. В настоящее время невозможно выполнить миграцию существующего приложения для использования конечной точки версии 2.0.

Приложения, зарегистрированные на портале регистрации приложений, не будут работать с исходной конечной точкой аутентификации Azure AD. Тем не менее приложения, создаваемые на портале регистрации приложений, можно успешно интегрировать с конечной точкой аутентификации учетной записи Майкрософт, `https://login.live.com`.

Кроме того, имеются следующие замечания к регистрациям приложений, созданным на [портале регистрации приложений](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList).

* Не поддерживается свойство **homepage**, также известное как *URL-адрес входа*. Без домашней страницы эти приложения не будут отображаться на панели Office MyApps.
* Сейчас для идентификатора приложения можно использовать только два секрета приложения.
* Просматривать регистрацию приложения и управлять ею можно только с помощью одной учетной записи разработчика. Регистрацию не могут совместно использовать несколько разработчиков.
* К формату универсального кода ресурса (URI) перенаправления применяется несколько ограничений. Дополнительные сведения об универсальных кодах ресурсов (URI) перенаправления см. в следующем разделе.

## <a name="restrictions-on-redirect-uris"></a>Ограничения для универсальных кодов ресурсов (URI) перенаправления
В настоящее время приложения, зарегистрированные на портале регистрации приложений, ограничены определенным набором значений универсального кода ресурса (URI) перенаправления. Универсальный код ресурса (URI) перенаправления для веб-приложений и служб должен начинаться со схемы `https`. Все его значения должны совместно использовать один домен DNS. Например, невозможно зарегистрировать веб-приложение с одним из следующих универсальных кодов ресурсов (URI) перенаправления.

`https://login-east.contoso.com`  
`https://login-west.contoso.com`

Система регистрации сравнивает полное DNS-имя имеющегося универсального кода ресурса (URI) перенаправления и DNS-имя добавляемого универсального кода ресурса (URI) перенаправления. Запрос на добавление DNS-имени завершится ошибкой при выполнении любого из следующих условий.  

* Если DNS-имя нового универсального кода ресурса (URI) перенаправления не соответствует DNS-имени существующего универсального кода ресурса (URI) перенаправления.
* Если DNS-имя нового универсального кода ресурса (URI) перенаправления не является поддоменом существующего универсального кода ресурса (URI) перенаправления.

Например, в приложении используется приведенный ниже универсальный код ресурса (URI) перенаправления.

`https://login.contoso.com`

Можно добавить его следующим образом.

`https://login.contoso.com/new`

В этом случае DNS-имя полностью совпадает. Или же можно сделать следующее.

`https://new.login.contoso.com`

В этом случае используется ссылка на поддомен DNS, login.contoso.com. Если необходимо создать приложение с универсальными кодами ресурсов (URI) перенаправления login-east.contoso.com и login-west.contoso.com, то нужно добавить следующие универсальные коды ресурсов (URI) перенаправления в указанном порядке.

`https://contoso.com`  
`https://login-east.contoso.com`  
`https://login-west.contoso.com`  

Два последних значения являются поддоменами первого универсального кода ресурса (URI) перенаправления (contoso.com), поэтому их можно добавить. Это ограничение будет снято в следующей версии.

Чтобы узнать, как зарегистрировать приложение на портале регистрации приложений, ознакомьтесь с разделом [Как зарегистрировать приложение с использованием конечной точки версии 2.0](active-directory-v2-app-registration.md).

## <a name="restrictions-on-services-and-apis"></a>Ограничения для служб и интерфейсов API
На данный момент конечная точка версии 2.0 поддерживает вход для любого приложения, зарегистрированного на портале регистрации приложений, если оно соответствует списку [поддерживаемых потоков аутентификации](active-directory-v2-flows.md). Однако эти приложения могут получать маркеры доступа OAuth 2.0 только для ограниченного набора ресурсов. Конечная точка версии 2.0 выдает маркеры доступа только:

* Для приложения, запросившего маркер. Приложение может получить маркер доступа для себя, если логическое приложение состоит из нескольких различных компонентов или уровней. Увидеть этот сценарий в действии можно в наших учебниках в разделе [Начало работы](active-directory-appmodel-v2-overview.md#getting-started) .
* Интерфейсы REST API Почты, Календаря и Контактов Outlook расположены на сайте https://outlook.office.com. Инструкции по созданию приложения с доступом к этим API можно найти в руководствах в разделе [Начало работы с Office](https://www.msdn.com/office/office365/howto/authenticate-Office-365-APIs-using-v2).
* Для интерфейсов API Microsoft Graph. Вы можете узнать больше о [Microsoft Graph](https://graph.microsoft.io) и данных, которые вам доступны.

Никакие другие службы в настоящее время не поддерживаются. В будущем будут добавлены другие службы Microsoft Online Services, а также поддержка пользовательских веб-API и служб.

## <a name="restrictions-on-libraries-and-sdks"></a>Ограничения для библиотек и пакетов SDK
Сейчас поддержка библиотек для конечной точки версии 2.0 ограничена. Если требуется использовать конечную точку версии 2.0 в рабочем приложении, доступны приведенные ниже варианты.

* Если вы создаете веб-приложение, то для выполнения входа и проверки маркеров можно спокойно использовать общедоступную версию серверного ПО промежуточного слоя Майкрософт. В нее входит ПО промежуточного слоя OWIN OpenID Connect для ASP.NET и подключаемый модуль NodeJS Passport. Примеры кода с использованием ПО промежуточного слоя Майкрософт доступны в разделе [Приступая к работе](active-directory-appmodel-v2-overview.md#getting-started).
* Для других платформ, мобильных и собственных приложений можно выполнять интеграцию с конечной точкой версии 2.0, непосредственно отправляя и принимая сообщения протокола в коде приложения. Чтобы помочь вам выполнить такую интеграцию, [мы добавили детальную информацию](active-directory-v2-protocols.md) о протоколах OpenID Connect и OAuth для версии 2.0.
* Наконец, для интеграции с конечной точкой версии 2.0 вы можете использовать библиотеки с открытым кодом OpenID Connect и OAuth. Протокол версии 2.0 должен быть совместим со многими другими библиотеками протоколов с открытым кодом без существенных изменений. Наличие этих библиотек зависит от языка и платформы. На веб-сайтах [Open ID Connect](http://openid.net/connect/) и [OAuth 2.0](http://oauth.net/2/) можно ознакомиться со списком популярных реализаций. Дополнительные сведения, список клиентских библиотек с открытым кодом и примеры, проверенные с конечной точкой версии 2.0, доступны в статье [Azure Active Directory (AD) версии 2.0 и библиотеки аутентификации](active-directory-v2-libraries.md).

Мы выпустили первоначальную предварительную версию [библиотеки аутентификации Майкрософт (MSAL)](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet) только для .NET. Вы можете воспользоваться ей в клиентских и серверных приложениях .NET. Но так как это предварительная версия библиотеки, она не обеспечивается поддержкой того же уровня, что и общедоступная версия.

## <a name="restrictions-on-protocols"></a>Ограничения для протоколов
Конечная точка версии 2.0 поддерживает только протоколы OpenID Connect и OAuth 2.0. Однако в ней реализованы не все функции и возможности каждого протокола.

В настоящее время в конечной версии 2.0 *недоступны* приведенные ниже обычные функции и возможности протокола.

* Параметр `end_session_endpoint` OpenID Connect, позволяющий приложению завершить сеанс пользователя, недоступен для конечной точки версии 2.0.
* Маркеры идентификации, выданные конечной точкой версии 2.0, содержат только парный идентификатор для пользователя. Это означает, что два разных приложения получают разные идентификаторы для одного пользователя. Обратите внимание, что отправив запрос к конечной точке `/me` Microsoft Graph, можно получить коррелируемый идентификатор для пользователя, который можно использовать в нескольких приложениях.
* Маркеры идентификации, выданные конечной точкой версии 2.0, не содержат утверждение `email` для пользователя, даже если получено разрешение от пользователя на просмотр его электронной почты.
* Конечная точка сведений о пользователе OpenID Connect не реализована в конечной точке версии 2.0. Тем не менее все данные профилей пользователей, которые может получить эта конечная точка, доступны в конечной точке `/me` Microsoft Graph.
* Конечная точка версии 2.0 не поддерживает выдачу утверждений ролей или групп в маркерах идентификации.

Чтобы лучше понять область действия функций протоколов, поддерживаемых в конечной точке версии 2.0, ознакомьтесь со [справочником по протоколам OpenID Connect и OAuth 2.0](active-directory-v2-protocols.md).

## <a name="restrictions-for-work-and-school-accounts"></a>Ограничения для рабочих и учебных учетных записей
В конечной точке версии 2.0 еще не реализована поддержка некоторых возможностей корпоративных пользователей Майкрософт. Дополнительные сведения приведены в следующем разделе.

### <a name="device-based-conditional-access-native-and-mobile-apps-and-microsoft-graph"></a>Условный доступ на основе устройств, собственные и мобильные приложения и Microsoft Graph
Сейчас конечная точка версии 2.0 не поддерживает аутентификацию устройств для мобильных и встроенных устройств, например встроенных приложений под управлением iOS или Android. Поэтому в собственном приложении для некоторых организаций может отсутствовать возможность вызова Microsoft Graph. Если администратор устанавливает политику условного доступа на основе устройства в приложении, требуется аутентификация устройства. Для конечной точки версии 2.0 наиболее вероятный сценарий условного доступа на основе устройств заключается в том, что администратор задает политику для ресурса в Microsoft Graph, например API Outlook. Если администратор устанавливает политику, а собственное приложение запрашивает маркер у Microsoft Graph, такой запрос в конечном итоге завершится ошибкой, так как поддержка аутентификации устройств еще не реализована. Тем не менее при настройке политик на основе устройств предоставляется поддержка веб-приложений, запрашивающих маркеры у Microsoft Graph. Аутентификация устройств в веб-приложении выполняется в браузере пользователя.

Разработчик, скорее всего, не управляет временем установки политик для ресурсов Microsoft Graph. Он даже может не знать, когда это происходит. При создании приложений для рабочих и учебных учетных записей следует использовать [исходную конечную точку Azure AD](active-directory-developers-guide.md), пока в конечной точке версии 2.0 не будет реализована поддержка аутентификации устройств. Вы можете узнать больше об [условном доступе на основе устройств в Azure AD](active-directory-conditional-access.md#device-based-conditional-access).

### <a name="windows-integrated-authentication-for-federated-tenants"></a>Встроенная проверка подлинности Windows для федеративных клиентов
При использовании библиотеки аутентификации Active Directory (ADAL) (с исходной конечной точкой Azure AD) в приложениях для Windows вы могли воспользоваться преимуществом так называемого предоставления утверждения языка разметки заявлений системы безопасности (SAML). С его помощью пользователи федеративных клиентов Azure AD могут проходить аутентификацию в локальном экземпляре Active Directory автоматически, без необходимости ввода учетных данных. На данный момент предоставление утверждения SAML не поддерживается в конечной точке версии 2.0.




<!--HONumber=Nov16_HO3-->


