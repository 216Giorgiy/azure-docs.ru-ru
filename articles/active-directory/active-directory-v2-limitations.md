---
title: 'Конечная точка версии 2.0: ограничения | Microsoft Docs'
description: Список ограничений конечной точки Azure AD версии 2.0.
services: active-directory
documentationcenter: ''
author: dstrockis
manager: mbaldwin
editor: ''

ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/30/2016
ms.author: dastrock

---
# <a name="should-i-use-the-v2.0-endpoint?"></a>Следует ли мне использовать конечную точку версии 2.0?
При создании приложений, которые интегрируются с Azure Active Directory, необходимо решить, соответствуют ли требованиям протоколы конечной точки версии 2.0 и аутентификации.  Исходная конечная точка Azure AD по-прежнему полностью поддерживается и в некоторых отношениях является более функциональной, чем версия 2.0.  Тем не менее конечная точка версии 2.0 [предоставляет значительные преимущества](active-directory-v2-compare.md) для разработчиков, поэтому вы, возможно, захотите попробовать новую модель программирования.

Сейчас мы рекомендуем использовать конечную точку версии 2.0 следующим образом:

* Если в приложении требуется поддержка личных учетных записей Майкрософт, следует использовать конечную точку версии 2.0.  Однако учтите ограничения, описанные в этой статье, особенно связанные с рабочими или учебными учетными записями.
* Если в приложении требуется поддержка только рабочих или учебных учетных записей, следует использовать [исходные конечные точки Azure AD](active-directory-developers-guide.md).

Со временем конечная точка версии 2.0 будет развиваться и поможет устранить эти ограничения, так что вам нужно будет использовать только ее.  А пока эта статья поможет вам определить, подходит ли вам конечная точка версии 2.0.  Мы будем постоянно обновлять эту статью, чтобы она отображала актуальное состояние конечной точки версии 2.0, поэтому рекомендуем перечитать ее, если вам нужно будет повторно сопоставить свои требования и возможности версии 2.0.

Если у вас уже есть приложение с Azure AD, в котором не используется конечная точка версии 2.0, нет необходимости начинать с нуля.  В будущем мы предоставим способ использования конечной точки версии 2.0 существующими приложениями Azure AD.

## <a name="restrictions-on-apps"></a>Ограничения для приложений
Перечисленные ниже типы приложений в настоящее время не поддерживаются конечной точкой версии 2.0.  Описание поддерживаемых типов приложений можно найти в [этой статье](active-directory-v2-flows.md).

##### <a name="standalone-web-apis"></a>Автономные веб-API
Используя конечную точку версии 2.0, вы можете [создать веб-API, защищенный с помощью OAuth 2.0](active-directory-v2-flows.md#web-apis).  Однако этот веб-API сможет получать маркеры только от приложения с тем же идентификатором приложения.  Сборка веб-API с возможностью доступа клиента с другим идентификатором приложения не поддерживается.  Этот клиент не сможет запрашивать или получать разрешения для веб-API.

Чтобы узнать, как создать веб-API, принимающий маркеры от клиента с тем же идентификатором приложения, ознакомьтесь с примерами веб-API конечной точки версии 2.0 в разделе [Приступая к работе](active-directory-appmodel-v2-overview.md#getting-started).

##### <a name="web-api-on-behalf-of-flow"></a>Поток On-Behalf-Of веб-API
Многие архитектуры включают в себя веб-API, которым требуется вызывать другие подчиненные веб-API. При этом оба интерфейса защищены конечной точкой версии 2.0.  Этот сценарий характерен для собственных клиентов с внутренним веб-API, который, в свою очередь, вызывает службу Microsoft Online Services или другой пользовательский веб-API, поддерживающий Azure AD.

Данный сценарий может поддерживаться с помощью предоставления учетных данных носителя маркера JWT OAuth 2.0 или потока On-Behalf-Of.  Однако поток On-Behalf-Of пока не поддерживается для конечной точки версии 2.0.  Чтобы увидеть его в общедоступной службе Azure AD, изучите [пример кода "On-Behalf-Of" на GitHub](https://github.com/AzureADSamples/WebAPI-OnBehalfOf-DotNet).

## <a name="restrictions-on-app-registrations"></a>Ограничения регистрации приложений
В настоящее время все приложения, интегрируемые с конечной точкой версии 2.0, необходимо регистрировать на сайте [apps.dev.microsoft.com](https://apps.dev.microsoft.com).  Существующие приложения с учетными записями Azure AD или Майкрософт, а также приложения, зарегистрированные на портале, отличном от нового портала регистрации приложений, не будут совместимы с конечной точкой версии 2.0.  Мы планируем предоставить возможность использования существующих приложений в качестве приложения версии 2.0. В настоящее время невозможно выполнить переход приложения к конечной точке версии 2.0.

Аналогичным образом приложения, зарегистрированные на новом портале регистрации приложений, не будут работать с исходной конечной точкой проверки подлинности Azure AD.  Тем не менее можно использовать приложения, созданные на портале регистрации приложений, для успешной интеграции с конечной точкой проверки подлинности учетной записи Майкрософт, `https://login.live.com`.

Кроме того, регистрации приложений, созданных на сайте [apps.dev.microsoft.com](https://apps.dev.microsoft.com) , обладают следующими особенностями:

* Не поддерживается свойство **homepage**, также известное как **URL-адрес входа**.  Без домашней страницы эти приложения не будут отображаться на панели Office MyApps.
* Сейчас для идентификатора приложения можно использовать только два секретных ключа.
* Регистрацию приложения можно просматривать, а также осуществлять управление ею только с помощью одной учетной записи разработчика.  Регистрацию не могут совместно использовать несколько разработчиков.
* К формату URI перенаправления применяется множество ограничений.  Дополнительные сведения см. в следующем разделе.

## <a name="restrictions-on-redirect-uris"></a>Ограничения для URI перенаправления
Приложения, зарегистрированные на новом портале регистрации приложений, ограничены определенным набором значений URI перенаправления.  URI перенаправления для веб-приложений и служб должен начинаться со схемы `https`. Все его значения должны совместно использовать один домен DNS.  Например, нельзя зарегистрировать веб-приложения со следующими URI перенаправления:

`https://login-east.contoso.com`  
`https://login-west.contoso.com`

Система регистрации сравнивает полное DNS-имя имеющегося URI перенаправления и DNS-имя нового URI перенаправления. Запрос на добавление DNS-имени завершится ошибкой при выполнении любого из следующих условий:  

* Если DNS-имя нового URI перенаправления не соответствует DNS-имени существующего URI перенаправления.
* Если DNS-имя нового URI перенаправления не является поддоменом существующего URI перенаправления.

Например, если в приложении используется следующий URI перенаправления:

`https://login.contoso.com`

Тогда можно добавить такой URI перенаправления:

`https://login.contoso.com/new`

Как видно, он полностью совпадает с DNS-именем. Возможен также следующий вариант:

`https://new.login.contoso.com`

В этом случае URI перенаправления соответствует поддомену DNS login.contoso.com.  Если необходимо создать приложение с URI перенаправления login-east.contoso.com и login-west.contoso.com, добавьте следующие URI перенаправления в таком порядке:

`https://contoso.com`  
`https://login-east.contoso.com`  
`https://login-west.contoso.com`  

Два последних примера являются поддоменами первого URI перенаправления (contoso.com), поэтому их можно добавить. Это ограничение будет снято в следующей версии.

Инструкции по регистрации приложения на новом портале регистрации приложений можно найти в [этой статье](active-directory-v2-app-registration.md).

## <a name="restrictions-on-services-&-apis"></a>Ограничения для служб и API-интерфейсов
На данный момент конечная точка версии 2.0 поддерживает вход для любого приложения, зарегистрированного на новом портале регистрации приложений, если оно попадает в список [поддерживаемых потоков проверки подлинности](active-directory-v2-flows.md).  Однако эти приложения смогут получать маркеры доступа OAuth 2.0 лишь для весьма ограниченного набора ресурсов.  Конечная точка версии 2.0 выдает маркеры доступа только в следующих случаях:

* Для приложения, запросившего маркер.  Приложение может получить маркер доступа для себя, если логическое приложение состоит из нескольких различных компонентов или уровней.  Увидеть этот сценарий в действии можно в наших учебниках в разделе [Начало работы](active-directory-appmodel-v2-overview.md#getting-started) .
* Интерфейсы REST API Почты, Календаря и Контактов Outlook расположены на сайте https://outlook.office.com.  Инструкции по созданию приложения с доступом к этим API можно найти в учебниках в разделе [Начало работы с Office](https://www.msdn.com/office/office365/howto/authenticate-Office-365-APIs-using-v2) .
* API-интерфейсы Microsoft Graph.  Дополнительные сведения и всю доступную информацию о Microsoft Graph можно просмотреть на сайте [https://graph.microsoft.io](https://graph.microsoft.io).

Никакие другие службы в настоящее время не поддерживаются.  В будущем будут добавлены другие службы Microsoft Online Services, а также поддержка пользовательских веб-API и служб.

## <a name="restrictions-on-libraries-&-sdks"></a>Ограничения для библиотек и пакетов SDK
Сейчас поддержка библиотек для конечной точки версии 2.0 достаточно ограничена.  Если требуется использовать конечную точку версии 2.0 в рабочем приложении, доступны следующие варианты.

* Если вы создаете веб-приложение, для выполнения входа и проверки маркеров можно смело использовать общедоступную версию нашего серверного ПО промежуточного слоя.  К нему относится ПО промежуточного слоя OWIN OpenID Connect для ASP.NET и наш подключаемый модуль NodeJS Passport.  Примеры кода, использующего наше ПО промежуточного слоя, также доступны в разделе [Приступая к работе](active-directory-appmodel-v2-overview.md#getting-started) .
* Для других платформ, мобильных и собственных приложений можно также выполнять интеграцию с конечной точкой версии 2.0, непосредственно отправляя и принимая сообщения протокола в коде приложения.  Чтобы помочь вам выполнить такую интеграцию, [мы добавили детальную информацию](active-directory-v2-protocols.md) о протоколах OpenID Connect 2.0 и OAuth.
* И наконец, для интеграции с конечной точкой версии 2.0 вы можете использовать библиотеки с открытым кодом OpenID Connect и OAuth.  Протокол версии 2.0 должен быть совместим со многими другими библиотеками протоколов с открытым кодом без существенных изменений.  Доступность таких библиотек зависит от языка и платформы, и на веб-сайтах [OpenID Connect](http://openid.net/connect/) и [OAuth 2.0](http://oauth.net/2/) есть список популярных реализаций. Дополнительные сведения, список клиентских библиотек с открытым кодом и примеры, проверенные с конечной точкой версии 2.0, см. в статье [Azure Active Directory (AD) версии 2.0 и библиотеки аутентификации](active-directory-v2-libraries.md).

Мы также выпустили первоначальную предварительную версию [библиотеки аутентификации Майкрософт (MSAL)](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet) только для .NET.  Вы можете воспользоваться ей в клиентских и серверных приложениях .NET. Так как это предварительная версия библиотеки, она не является общедоступной.

## <a name="restrictions-on-protocols"></a>Ограничения для протоколов
Конечная точка версии 2.0 поддерживает только протоколы OpenID Connect и OAuth 2.0.  Однако в ней реализованы не все функции и возможности каждого протокола, включая следующие:

* Параметр `end_session_endpoint` OpenID Connect, позволяющий приложению завершить сеанс пользователя с конечной точкой версии 2.0.
* Маркеры идентификаторов, выданные конечной точкой версии 2.0, содержат только парный идентификатор для пользователя.  Это означает, что два разных приложения получат разные идентификаторы для одного пользователя.  Обратите внимание, что отправив запрос конечной точке `/me` Microsoft Graph, можно будет получить коррелируемый идентификатор для пользователя, который можно использовать в нескольких приложениях.
* Сейчас маркеры идентификаторов, выданные конечной точкой версии 2.0, не содержат утверждение `email` для пользователя, даже если получено разрешение от пользователя на просмотр почты.
* Конечная точка сведений о пользователе OpenID. Сейчас конечная точка сведений о пользователе не реализована в конечной точке версии 2.0.  Тем не менее все данные профилей пользователей, которые может получить эта конечная точка, доступны в конечной точке `/me` Microsoft Graph.
* Утверждения ролей и групп.  В настоящее время конечная точка версии 2.0 не поддерживает выдачу утверждений ролей или групп в маркерах идентификаторов.

Чтобы лучше понять область действия функций протоколов, поддерживаемых в конечной точке версии 2.0, ознакомьтесь со [справочником по протоколам OpenID Connect и OAuth 2.0](active-directory-v2-protocols.md).

## <a name="restrictions-for-work-&-school-accounts"></a>Ограничения для рабочих и учебных учетных записей
В конечной точке версии 2.0 еще не реализована поддержка некоторых возможностей корпоративных пользователей и бизнес-пользователей Майкрософт.

##### <a name="device-based-conditional-access,-native-and-mobile-apps,-and-the-microsoft-graph"></a>Условный доступ на основе устройств, встроенные и мобильные приложения и Microsoft Graph
Сейчас конечная точка версии 2.0 не поддерживает аутентификацию устройств для мобильных и встроенных устройств, например встроенных приложений под управлением iOS или Android.  Поэтому во встроенном приложении может отсутствовать возможность вызова Microsoft Graph для некоторых организаций.  Если администратор устанавливает политику условного доступа на основе устройства в приложении, требуется аутентификация устройства.  Для конечной точки версии 2.0 наиболее вероятный сценарий для условного доступа на основе устройства заключается в том, что администратор задает политику для ресурса в Microsoft Graph, например Outlook API.  Если администратор устанавливает политику, а встроенное приложение запрашивает маркер у Microsoft Graph, такой запрос в конечном итоге завершится ошибкой, так как еще не предоставляется поддержка аутентификации устройств.  Тем не менее при настройке политик на основе устройств предоставляется поддержка веб-приложений, запрашивающих маркеры в Microsoft Graph.  Аутентификация устройств в веб-приложении выполняется в браузере пользователя.

Разработчик, скорее всего, не управляет временем установки политик для ресурсов Microsoft Graph или даже не знают, когда это происходит.  При создании приложений для рабочих и учебных учетных записей следует использовать [исходную конечную точку Azure AD](active-directory-developers-guide.md), пока в конечной точке версии 2.0 не будет реализована поддержка аутентификации устройств.  Дополнительные сведения об условном доступе на основе устройств см. в [этой статье](active-directory-conditional-access.md#device-based-conditional-access).

##### <a name="windows-integrated-authentication-for-federated-tenants"></a>Встроенная проверка подлинности Windows для федеративных клиентов
При использовании ADAL (и, следовательно, исходной конечной точки Azure AD) в приложениях Windows, возможно, использовалось предоставление утверждения SAML.  Таким образом, пользователи федеративных клиентов Azure AD могут проходить аутентификацию в локальном экземпляре Active Directory автоматически, без необходимости ввода учетных данных.  Сейчас предоставление утверждения SAML не поддерживается в конечной точке версии 2.0.

<!--HONumber=Oct16_HO2-->


