---
title: "Сведения о соединителях прокси приложения Azure AD | Документация Майкрософт"
description: "Основные сведения о соединителях прокси приложения Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/12/2017
ms.author: kgremban
translationtype: Human Translation
ms.sourcegitcommit: 2c33e75a7d2cb28f8dc6b314e663a530b7b7fdb4
ms.openlocfilehash: 16a000074ae742cc6bc1b25bf359990fe73608f7
ms.lasthandoff: 04/21/2017


---

# <a name="understand-azure-ad-application-proxy-connectors"></a>Сведения о соединителях прокси приложения Azure AD

Соединители являются основой для работы прокси приложения Azure AD. Они просты в использовании, развертывании и обслуживании. К тому же они очень производительны. В этой статье мы объясним, что такое соединители, как они работают, и дадим несколько практических рекомендаций для повышения эффективности вашего развертывания. 

## <a name="connector-deployment"></a>Развертывание соединителя

Для работы прокси приложения нужно установить в сети службу-соединитель Windows Server. Вы можете установить несколько соединителей в зависимости от требований к масштабируемости и высокому уровню доступности. Сначала добавьте один соединитель и при необходимости добавляйте дополнительные. При установке соединитель добавляется в пул соединителей, обслуживающих клиент.

Корпорация Майкрософт рекомендует не устанавливать соединители на тех же серверах, на которых размещены приложения. Тем не менее вам требуется доступ к приложению на сервере, где устанавливается соединитель.


## <a name="connector-maintenance"></a>Обслуживание соединителей
Соединители и служба отвечают за выполнение задач, связанных с высоким уровнем доступности. Их можно добавлять или удалять динамически. Когда поступает новый запрос, он перенаправляется на один из доступных соединителей. Соединитель может стать временно недоступным, то есть перестанет реагировать на трафик.

Соединители не имеют состояний и не сохраняют на компьютере никаких данных конфигурации, кроме параметров подключения к службе и сертификатов для проверки подлинности. При подключении к службе соединители извлекают все необходимые данные конфигурации и обновляют их каждые несколько минут.
Они также проводят опрос сервера, чтобы узнать, появилась ли более новая версия соединителя. Если такая версия будет найдена, соединители обновятся.

Соединители можно отслеживать с компьютера, на котором они выполняются (с помощью журнала событий и счетчиков производительности), или на портале Azure (на странице прокси приложения).

 ![Соединители прокси приложения Azure AD](./media/application-proxy-understand-connectors/app-proxy-connectors.png)

Вам не требуется вручную удалять неиспользуемые соединители. Выполняясь, соединитель остается активным, так как подключается к службе. Неиспользуемые соединители помечаются как _неактивные_ и удаляются спустя 10 дней. 

## <a name="automatic-updates-to-the-connector"></a>Автоматические обновление соединителей

Служба средства обновления соединителей позволяет выполнять обновление автоматически. Таким образом, вы можете постоянно использовать все новые функции, а также улучшения безопасности и производительности.

Azure AD поддерживает автоматические обновления всех развертываемых соединителей. Пока служба средства обновления соединителей прокси приложения работает, соединители будут обновляться автоматически. Если служба обновления соединителей не отображается на сервере, для получения обновлений необходимо [переустановить соединитель](active-directory-application-proxy-enable.md).

При обновлении соединителя могут возникать простои в следующих случаях.

- У вас только один соединитель. Чтобы избежать такого простоя и обеспечить высокий уровень доступности, установите второй соединитель и [создайте группу соединителей](active-directory-application-proxy-connectors-azure-portal.md).

- Соединитель выполнял транзакцию в момент начала обновления. В этой ситуации браузер обычно автоматически повторяет операцию. Возможно, потребуется обновить страницу. При повторном запросе трафик направляется на резервный соединитель.

## <a name="all-networking-is-outbound"></a>Все сетевые подключения исходящие
Соединители отправляют только исходящие запросы, поэтому подключение всегда инициирует соединитель. Нет необходимости открывать входящие порты, так как трафик свободно передается в обе стороны через установленное соединение.

Исходящий трафик отправляется в службу прокси приложения и в опубликованные приложения. Трафик, отправляемый в службу, передается в центры данных Azure на несколько разных портов. Дополнительные сведения об используемых портах см. в статье [Включение прокси приложения на портале Azure](active-directory-application-proxy-enable.md).

Так как соединители используют только исходящий трафик, нет необходимости настраивать для них балансировку нагрузки или правила брандмауэра для входящего трафика.

Сведения о настройке правил исходящего трафика брандмауэра см. в статье [Работа с существующими локальными прокси-серверами](application-proxy-working-with-proxy-servers.md).

Воспользуйтесь [средством проверки портов соединителей прокси-службы приложения Azure AD](https://aadap-portcheck.connectorporttest.msappproxy.net/), чтобы проверить, сможет ли ваш соединитель подключиться к прокси-службе приложения. Как минимум следует убедиться, что для региона Central US (Центральная часть США) и ближайшего к вам региона отображаются все зеленые флажки. Учитывайте также, что большее число зеленых флажков означает большую устойчивость. 

## <a name="network-security"></a>Безопасность сети

Соединители можно устанавливать в любом месте в сети. Поэтому они могут отправлять запросы и к службе прокси приложения, и к внутренним приложениям. Они будут нормально работать внутри корпоративной сети, в пределах демилитаризованной зоны (сети периметра) или даже на виртуальной машине, запущенной в облаке. Вам достаточно лишь обеспечить доступ к вашим приложениям с компьютера, на котором выполняется соединитель.

Развертывание в сети периметра выполняется сложнее. Но в некоторых ситуациях соединители следует размещать именно в сети периметра, например, если вы планируете использовать дополнительную инфраструктуру для балансировки нагрузки серверной части или для обнаружения вторжений.

## <a name="domain-joining"></a>Присоединение к домену

Соединители могут выполняться на компьютере, не присоединенном к домену. Но если вам нужен единый вход (SSO) в приложения, использующих встроенную проверку подлинности Windows (IWA), компьютер должен быть присоединен к домену. В этом случае компьютеры соединителя должны быть присоединены к домену, который может выполнить ограниченное делегирование [Kerberos](https://web.mit.edu/kerberos) от имени соответствующих пользователей для опубликованных приложений.

Соединители можно также присоединять к доменам или лесам с частичным доверием либо к контроллерам домена только для чтения.

## <a name="connectors-on-hardened-environments"></a>Соединители в средах с усиленной защитой

Развертывание соединителей обычно не вызывает сложностей и не требует дополнительной настройки. Но для некоторых редких сценариев есть определенные условия.

* Если в организации используются ограничения на исходящий трафик, [откройте необходимые порты](active-directory-application-proxy-enable.md#open-your-ports).
* На FIPS-совместимом компьютере может потребоваться изменить конфигурацию таким образом, чтобы служба соединителя, служба обновления соединителей и программа установки могли создать и сохранить сертификат.
* Если в организации используется блокировка среды на основе процессов, создающих сетевые запросы, то для обеих служб соединителей нужно разрешить доступ ко всем требуемым портам и IP-адресам.
* В некоторых случаях исходящие перенаправляющие прокси-серверы могут прервать двустороннюю проверку подлинности на основе сертификата и привести к сбою связи.

## <a name="connector-authentication"></a>Проверка подлинности соединителя

Чтобы предоставить доступ к защищенной службе, соединители должны пройти проверку подлинности в службе, а служба должна пройти проверку подлинности в соединителе. Такая проверка выполняется с использованием сертификатов клиента и службы, когда соединители инициируют подключение. Таким образом имя пользователя и пароль администратора не хранятся на компьютере соединителя.

Используемые сертификаты уникальны для службы прокси приложения. Они создаются во время первоначальной регистрации, а затем соединители автоматически обновляют их каждые несколько месяцев. 

Если соединитель несколько месяцев не подключается к службе, возможно, его сертификаты устарели. В этом случае следует удалить соединитель и установить его заново, чтобы запустить процесс регистрации. Вы можете выполнить следующие команды PowerShell:

```
Import-module AppProxyPSModule
Register-AppProxyConnector
```

## <a name="performance-and-scalability"></a>Производительность и масштабирование

Для веб-службы масштабирование выполняется полностью прозрачно, но для соединителей это может стать важным фактором. Для обработки пикового трафика необходимо иметь достаточное количество соединителей. Соединители не имеют состояния, поэтому для них не имеет значения количество пользователей или сеансов. Но они зависят от количества запросов и объема полезных данных в этих запросах. Обычный компьютер может обработать несколько тысяч запросов стандартного веб-трафика в секунду. Этот показатель зависит от точных характеристик компьютера.

Производительность соединителя связана с ЦП и сетью. Производительность ЦП важна при SSL-шифровании и расшифровке, а сеть нужна, чтобы быстро подключаться к приложениям и веб-службе в Azure. 

Память, напротив, меньше всего важна для соединителей. Интернет-служба занимается большинством операций обработки и отвечает за весь трафик, не прошедший проверку подлинности. Все, что можно сделать в облаке, осуществляется в облаке.

На производительность также влияет качество сетевого подключения между соединителями, которое определяется следующими факторами.

* **Веб-служба.** Малая скорость или высокая задержка подключения ухудшают работу соединителя. Лучше всего в организации подключиться к Azure через Express Route. Для других подключений вашим сетевым инженерам нужно отдельно следить за эффективностью подключений к Azure.  
* **Внутренние приложения.** В некоторых случаях между соединителем и внутренними приложениями установлены дополнительные прокси-серверы. Чтобы проверить связь в такой ситуации, откройте браузер на компьютере соединителя и попробуйте открыть нужные приложения. Если соединители выполняются в Azure, а приложения расположены в локальной среде, качество работы может оказаться ниже, чем ожидают пользователи.
* **Контроллеры домена.** Если соединители выполняют ограниченное делегирование Kerberos с использованием единого входа, сначала они обращаются к контроллерам домена, а затем отправляют запрос к серверной части. Соединители содержат кэш билетов Kerberos, но в средах с высокой нагрузкой скорость реагирования контроллеров домена может ухудшить процесс работы. Такая проблема наиболее характерна для ситуации, когда соединители выполняются в Azure, а контроллеры домена находятся в локальной среде.

## <a name="under-the-hood"></a>Как все устроено

Соединители основаны на прокси веб-приложения Windows Server, поэтому для них доступны почти такие же средства управления, включая журналы событий Windows

 ![Управление журналами событий с помощью средства просмотра событий](./media/application-proxy-understand-connectors/event-view-window.png)

и счетчики производительности Windows. 

 ![Добавление счетчиков в соединитель с помощью системного монитора](./media/application-proxy-understand-connectors/performance-monitor.png)

Для соединителей настроены журнал администратора и журнал сеансов. В журналах администратора регистрируются основные события и соответствующие ошибки. В журналах сеансов содержатся все транзакции и подробные сведения об их обработке. 

Чтобы увидеть журналы, откройте средство просмотра событий и включите в нем параметр **Отобразить аналитический и отладочный журналы** в меню **Вид**. Затем включите в журналах сбор событий. Эти журналы не отображаются в прокси-службе веб-приложения в Windows Server 2012 R2, так как соединители созданы на основе более поздней версии.

Состояние службы можно проверить в окне "Служба". Соединитель состоит из двух служб Windows: собственно соединитель и служба обновления. Они должны постоянно работать.

 ![Окно "Службы (локальные)" Azure AD](./media/application-proxy-understand-connectors/aad-connector-services.png)

## <a name="next-steps"></a>Дальнейшие действия
[Устранение неполадок и сообщения об ошибках прокси приложения](active-directory-application-proxy-troubleshoot.md)

[Работа с имеющимися локальными прокси-серверами](application-proxy-working-with-proxy-servers.md)

[Автоматическая установка соединителя прокси приложения Azure AD](active-directory-application-proxy-silent-installation.md)


