---
title: 'Azure AD Connect: простой единый вход — как это работает | Документы Майкрософт'
description: В этой статье описывается принцип работы функции простого единого входа в Azure Active Directory.
services: active-directory
keywords: что такое Azure AD Connect, установка Active Directory, необходимые компоненты для Azure AD, единый вход
documentationcenter: ''
author: billmath
manager: mtillman
ms.assetid: 9f994aca-6088-40f5-b2cc-c753a4f41da7
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2018
ms.component: hybrid
ms.author: billmath
ms.openlocfilehash: 6507158a63de508164fc74bcafe39785046a2c79
ms.sourcegitcommit: 248c2a76b0ab8c3b883326422e33c61bd2735c6c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2018
ms.locfileid: "39213356"
---
# <a name="azure-active-directory-seamless-single-sign-on-technical-deep-dive"></a>Подробное техническое руководство по простому единому входу Azure Active Directory

В этой статье приводятся технические сведения о работе функции простого единого входа Azure Active Directory.

## <a name="how-does-seamless-sso-work"></a>Как работает простой единый вход?

Этот раздел состоит из трех частей.
1. Настройка функции простого единого входа.
2. Как транзакция единого входа пользователя в веб-браузере работает с простым единым входом.
3. Как транзакция единого входа пользователя в собственном клиенте работает с простым единым входом.

### <a name="how-does-set-up-work"></a>Как выполняется настройка?

Простой единый вход включается с помощью Azure AD Connect, как показано [здесь](active-directory-aadconnect-sso-quick-start.md). При включении функции выполняются следующие действия:
- В каждом лесу AD в локальной службе Active Directory (AD) создается учетная запись компьютера с именем `AZUREADSSOACC` (представляет Azure AD).
- С помощью Azure AD безопасным образом предоставляется ключ расшифровки Kerberos учетной записи компьютера. При наличии нескольких лесов AD каждый из них будет иметь свой собственный ключ расшифровки Kerberos.
- Кроме того, создаются два имени субъектов-служб (SPN) Kerberos, представляющие URL-адреса, используемые при входе в Azure AD.

>[!NOTE]
> Учетная запись компьютера и имена участников-служб Kerberos создаются в каждом лесу AD, который синхронизируется с Azure AD (с помощью Azure AD Connect) и для пользователей которого должен иметься простой единый вход. Переместите учетную запись `AZUREADSSOACC` компьютера в подразделение (OU), где хранятся другие учетные записи компьютеров, чтобы управлять им таким же образом и избежать удаления.

>[!IMPORTANT]
>Настоятельно рекомендуется, чтобы вы [меняли ключ расшифровки Kerberos](active-directory-aadconnect-sso-faq.md#how-can-i-roll-over-the-kerberos-decryption-key-of-the-azureadssoacc-computer-account) для учетной записи компьютера `AZUREADSSOACC` хотя бы раз в 30 дней.

После завершения настройки функция простого входа в Azure AD работает так же, как любая другая функция входа, использующая встроенную проверку подлинности Windows (IWA).

### <a name="how-does-sign-in-on-a-web-browser-with-seamless-sso-work"></a>Как работает вход с функцией простого единого входа в веб-браузере?

Процесс входа в веб-браузере выглядит следующим образом.

1. Пользователь пытается получить доступ к веб-приложению (например, веб-приложению Outlook — https://outlook.office365.com/owa/) с корпоративного устройства, присоединенного к домену, в корпоративной сети.
2. Если пользователь еще не выполнил вход, он перенаправляется на страницу входа в Azure AD.
3. Пользователь вводит свое имя на странице входа в Azure AD.

  >[!NOTE]
  >Для [некоторых приложений](./active-directory-aadconnect-sso-faq.md#what-applications-take-advantage-of-domainhint-or-loginhint-parameter-capability-of-seamless-sso) шаги 2 и 3 пропускаются.

4. С помощью JavaScript, выполняемого в фоновом режиме, Azure AD запрашивает у браузера билет Kerberos (возвращается ответ 401 — не авторизовано).
5. В свою очередь браузер запрашивает в Active Directory билет для учетной записи компьютера `AZUREADSSOACC` (которая представляет Azure AD).
6. Active Directory находит учетную запись компьютера и возвращает браузеру билет Kerberos, зашифрованный с использованием секрета этой учетной записи компьютера.
7. Браузер пересылает билет Kerberos, полученный от Active Directory, в Azure AD.
8. Azure AD расшифровывает билет Kerberos, который содержит удостоверение пользователя, выполнившего вход в корпоративное устройство, с помощью полученного ранее общего ключа.
9. После анализа Azure AD либо возвращает маркер приложению, либо предлагает пользователю выполнить дополнительную проверку, например многофакторную проверку подлинности.
10. При успешном входе в систему пользователь может получить доступ к приложению.

На схеме ниже показаны все соответствующие компоненты и шаги.

![Простой единый вход: процедура для веб-приложения](./media/active-directory-aadconnect-sso/sso2.png)

Простой единый вход — ситуативно-обусловленная функция. Это означает, что если в ней происходит сбой, процедура входа выполняется стандартно, то есть пользователь, как и прежде, должен просто ввести пароль для входа.

### <a name="how-does-sign-in-on-a-native-client-with-seamless-sso-work"></a>Как работает вход с функцией простого единого входа в собственном клиенте?

Процесс входа в собственном клиенте выглядит следующим образом.

1. Пользователь пытается получить доступ к собственному приложению (например, клиенту Outlook) с корпоративного устройства, присоединенного к домену, в корпоративной сети.
2. Если пользователь еще не выполнил вход, то собственное приложение получает его имя пользователя из сеанса Windows на устройстве.
3. Приложение отправляет это имя пользователя в Azure AD и получает конечную точку MEX WS-Trust клиента.
4. Затем приложение отправляет запрос к конечной точке MEX WS-Trust, чтобы определить, доступна интегрированная конечная точка аутентификации.
5. Если шаг 4 завершается успешно, то выдается запрос защиты Kerberos.
6. Если приложению удалось получить билет Kerberos, оно пересылает его на интегрированную конечную точку аутентификации Azure AD.
7. Служба Azure AD расшифровывает билет Kerberos и проверяет его.
8. Azure AD выполняет вход пользователя и выдает токен SAML для приложения.
9. Приложение отправляет токен SAML на конечную точку маркера OAuth 2 Azure AD.
10. Azure AD проверяет токен SAML и выдает приложению маркер доступа и маркер обновления для указанного ресурса, а также маркер идентификации.
11. Пользователь получает доступ к ресурсу приложения.

На схеме ниже показаны все соответствующие компоненты и шаги.

![Простой единый вход: процедура для собственного приложения](./media/active-directory-aadconnect-sso/sso14.png)

## <a name="next-steps"></a>Дополнительная информация

- [**Краткое руководство**](active-directory-aadconnect-sso-quick-start.md). Настройка и подготовка к работе простого единого входа Azure AD.
- [**Часто задаваемые вопросы**](active-directory-aadconnect-sso-faq.md). Ответы на часто задаваемые вопросы.
- [**Устранение неполадок**](active-directory-aadconnect-troubleshoot-sso.md). Узнайте, как устранить самые распространенные проблемы с этой функцией.
- [**UserVoice**](https://feedback.azure.com/forums/169401-azure-active-directory/category/160611-directory-synchronization-aad-connect). Отправка запросов новых функций.
