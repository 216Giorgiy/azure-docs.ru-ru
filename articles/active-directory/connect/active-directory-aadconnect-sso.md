---
title: "Функция единого входа Azure AD Connect | Документация Майкрософт"
description: "В этой статье содержатся сведения о возможностях единого входа из локальной службы Active Directory (AD) в облачную службу Azure Active Directory (Azure AD) и подключенные службы."
services: active-directory
keywords: "что такое Azure AD Connect, установка Active Directory, необходимые компоненты для Azure AD, единый вход"
documentationcenter: 
author: billmath
manager: femila
ms.assetid: 9f994aca-6088-40f5-b2cc-c753a4f41da7
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/06/2016
ms.author: billmath
translationtype: Human Translation
ms.sourcegitcommit: bddd581b5164b03ccba75370cd89a7831101cf37
ms.openlocfilehash: f0133aaf735533159d72b1e63b952258707ad8b9


---

# <a name="what-is-single-sign-on-sso-preview"></a>Общие сведения о функции единого входа (предварительная версия)
Единый вход — это функция в Azure Active Directory Connect, реализующаяся совместно с [синхронизацией хэша паролей](active-directory-aadconnectsync-implement-password-synchronization.md) или [сквозной проверкой подлинности](active-directory-aadconnect-pass-through-authentication.md).  Если эта функция включена, при входе в Azure Active Directory (Azure AD) или другие облачные службы с корпоративных или подключенных к корпоративной сети компьютеров пользователи не должны вводить свои пароли.  

Это также касается и доступа к ресурсам, подключенным к службам Azure Active Directory (например, Office 365, Microsoft Intune, CRM Online и службы SaaS). Однако в этом случае используется билет Kerberos, автоматически полученный от локальной службы Active Directory.

![Единый вход](./media/active-directory-aadconnect-sso/sso1.png)

Поддержка функции единого входа обеспечивает более удобный доступ пользователей к облачным службам, а также предоставляет возможность легко и безопасно входить в корпоративную среду, не используя какие-либо дополнительные локальные компоненты.

Функцию единого входа можно включить в AAD Connect. Она работает с локальной службой Active Directory и поддерживает синхронизацию хэша паролей и сквозную проверку подлинности.  Чтобы реализовать единый вход в своей среде, убедитесь в следующем:


- конечные пользователи работают на компьютерах, присоединенных к домену;
- они имеют прямое подключение к контроллеру домена (например, в корпоративной проводной (беспроводной) сети или через подключение удаленного доступа, например VPN-подключение);
- вы определили конечные точки Kerberos в облаке как часть зоны интрасети.

Если любое из указанных выше условий не выполнено (например, если компьютер находится вне корпоративной сети и служба Active Directory недоступна), при входе в систему пользователю будет просто предложено ввести пароль. Это означает, что единый вход отключен.

## <a name="supported-clients"></a>Поддерживаемые клиенты
Функция единого входа доступна в клиентах на основе веб-браузера и клиентах Office, поддерживающих современные методы проверки подлинности на компьютерах с поддержкой проверки подлинности Kerberos, например компьютерах Windows.  В таблице ниже приведены сведения о клиентах на основе веб-браузера в разных операционных системах.

| Операционная система и браузер |Internet Explorer|Chrome|Firefox|Edge
| --- | --- |--- | --- |--- |
|Windows 10|Да|Да|Да*|Нет
|Windows 8.1|Да|Да|Да*|Недоступно
|Windows 8|Да|Да|Да*|Недоступно
|Windows 7|Да|Да|Да*|Недоступно
|Mac|Недоступно|Недоступно|Недоступно|Недоступно

* Требуется отдельная конфигурация.

>[!NOTE]
>Чтобы упростить доступ к Azure AD, мы рекомендуем использовать на клиентах с Windows 10 функцию [присоединения к Azure AD](../active-directory-azureadjoin-overview.md). 

## <a name="how-single-sign-on-works"></a>Принцип работы единого входа

При включении единого входа в Azure AD Connect в локальной службе Active Directory создается учетная запись компьютера с именем AZUREADSSOACCT. Затем этой службе предоставляется ключ расшифровки Kerberos.  Кроме того, создается два имени субъектов-служб (SPN) Kerberos, представляющих URL-адреса, используемые при проверке подлинности между клиентом и Azure AD.  

После настройки процедура проверки подлинности ничем не отличается от такой же процедуры в любом другом приложении со встроенной проверкой подлинности Windows (IWA).  Если вы знакомы с принципами работы встроенной проверки подлинности Windows, тогда вы уже знаете, как работает единый вход в Azure AD.  Если не знакомы — этот процесс выглядит следующим образом.

![Единый вход](./media/active-directory-aadconnect-sso/sso2.png)

Сначала пользователь пытается получить доступ к ресурсу.  В качестве ресурса может выступать компьютер или URL-адрес.  В случае Azure AD это URL-адрес службы (далее — ресурс Azure AD), например SharePoint Online.

1.  Ресурс Azure AD запрашивает от клиента билет Kerberos (возвращается ответ 401, "Нет доступа").
2.  Клиент запрашивает билет от Active Directory для ресурса Azure AD. 
3.  Active Directory находит учетную запись компьютера, связанную с ресурсом Azure AD, и возвращает клиенту билет Kerberos, зашифрованный с использованием секрета учетной записи компьютера. Этот билет содержит идентификатор пользователя, выполнившего вход в систему компьютера.
4.  Клиент отправляет билет Kerberos, полученный от Active Directory, в Azure AD.
5.  Azure AD расшифровывает билет Kerberos с использованием полученного ранее ключа, а затем либо возвращает маркер для пользователя, либо запрашивает дополнительные удостоверения, например многофакторную идентификацию, согласно требованиям ресурса.

Единый вход — ситуативно-обусловленная функция. Это значит, что в случае ее сбоя, пользователь, как обычно, должен просто ввести пароль на странице входа.

## <a name="enabling-sso-with-pass-through-authentication-or-password-hash-sync"></a>Включение единого входа с возможностями синхронизации хэша паролей или сквозной проверки подлинности
Процесс включения единого входа с возможностями синхронизации хэша паролей или сквозной проверки подлинности в Azure AD Connect очень простой.  Вам потребуются права администратора домена для доступа к одному из доменов в каждом синхронизируемом лесу. Это позволит включить конфигурацию имен субъектов-служб Kerberos в учетной записи компьютера.  Имя пользователя и пароль не нужно сохранять в Azure AD Connect и Azure AD. Эти учетные данные используются только для этой операции.

При установке Azure AD Connect выберите выборочную установку, чтобы настроить единый вход на странице входа в систему. Дополнительные сведения см. в статье [Выборочная установка Azure AD Connect](active-directory-aadconnect-get-started-custom.md).

![Единый вход](./media/active-directory-aadconnect-sso/sso3.png)

После включения единого входа выполните остальные указания мастера, пока не откроется страница единого входа.

![Единый вход](./media/active-directory-aadconnect-sso/sso4.png)

Для каждого указанного леса предоставьте соответствующие сведения об учетной записи. После этого единый вход для Azure Directory будет включен.

## <a name="ensuring-clients-sign-in-automatically"></a>Проверка единого входа клиентов
По умолчанию браузеры не отправляют учетные данные на веб-серверы, если URL-адрес не находится в зоне интрасети.  Как правило, браузер может вычислить необходимую зону по URL-адресу.  Например, в случае с URL-адресом http://intranet/ браузер автоматически отправит учетные данные, так как он сопоставит этот URL-адрес с зоной интрасети.  Однако, если URL-адрес содержит точку, например http://intranet.contoso.com/, сервер не отправит учетные данные автоматически и будет обрабатывать его как URL-адрес веб-сайта.

URL-адреса, используемые для единого входа в Azure AD, содержат точку, так как они являются глобально маршрутизируемыми именами узлов. По этой причине их нужно явным образом добавить в зону интрасети компьютера, в результате чего после входа пользователя в систему браузер будет автоматически отправлять в Azure AD его учетные данные в виде билета Kerberos.  Самый простой способ добавить необходимые URL-адреса в зону интрасети — создать групповую политику в Active Directory.

1.  Откройте средства управления групповыми политиками.
2.  Измените групповую политику, которая будет применяться ко всем пользователям.  Например, политику домена по умолчанию.
3.  Перейдите в раздел **Конфигурация пользователя\Административные шаблоны\Компоненты Windows\Internet Explorer\Панель управления браузером\Вкладка безопасности** и выберите **Список назначений зоны для веб-сайтов**.
![Единый вход](./media/active-directory-aadconnect-sso/sso6.png) </br>
4.  Включите политику и введите следующие значения и данные в диалоговом окне.</br>
        
        Value: https://autologon.microsoftazuread-sso.com
        Data: 1
        Value: https://aadg.windows.net.nsatc.net 
        Data: 1'
5.  Это должно выглядеть следующим образом: ![Единый вход](./media/active-directory-aadconnect-sso/sso7.png)

6.  Два раза последовательно нажмите кнопку "ОК".

Теперь единый вход для пользователей настроен.

>[!NOTE]
>По умолчанию Chrome и Internet Explorer используют одинаковый набор доверенных URL-адресов сайтов.  Если вы настроили для Chrome другие параметры, их необходимо будет обновить отдельно.

## <a name="troubleshooting-single-sign-on-issues"></a>Устранение неполадок единого входа
Важно, чтобы клиент был должным образом настроен для единого входа. Для этого необходимо убедиться в следующем:

1.  И https://autologon.microsoftazuread-sso.com, и https://aadg.windows.net.nsatc.net определены в зоне интрасети.  
2.  Рабочая станция присоединена к домену.
3.  Пользователь вошел в систему, используя учетную запись домена.
4.  Компьютер подключен к корпоративной сети.
5.  Время на компьютере синхронизировано с временем в Active Directory, и разница между правильным временем и временем контроллеров домена не превышает 5 минут.

Выполнив указанные выше требования, просмотрите дополнительные сведения в журналах консоли браузера.  Они находятся в средствах разработчика.  Это поможет вам определить потенциальную проблему.

## <a name="event-log-entries"></a>Записи журнала событий
Если включен аудит неудач, при каждом входе пользователя в систему с помощью единого входа в журнал событий контроллера домена добавляется запись.  Эти события можно найти в журналах событий. Для этого выполните поиск событий безопасности 4769, связанных с учетной записью компьютера AzureADSSOAcc$.  Чтобы найти все события безопасности, связанные с учетной записью компьютера, используйте следующий фильтр:

    <QueryList>
      <Query Id="0" Path="Security">
    <Select Path="Security">*[EventData[Data[@Name='ServiceName'] and (Data='AZUREADSSOACC$')]]</Select>
      </Query>
    </QueryList>






<!--HONumber=Dec16_HO3-->


