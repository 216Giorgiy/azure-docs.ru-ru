---
title: "Azure AD Connect: интегрированный единый вход | Документация Майкрософт"
description: "В этом разделе описывается простой единый вход Azure Active Directory (Azure AD) и то, как он обеспечивает действительно единый вход пользователей корпоративных компьютеров в корпоративной сети."
services: active-directory
keywords: "что такое Azure AD Connect, установка Active Directory, необходимые компоненты для Azure AD, единый вход"
documentationcenter: 
author: swkrish
manager: femila
ms.assetid: 9f994aca-6088-40f5-b2cc-c753a4f41da7
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/26/2017
ms.author: billmath
ms.translationtype: Human Translation
ms.sourcegitcommit: aaf97d26c982c1592230096588e0b0c3ee516a73
ms.openlocfilehash: b3eebdd714b38ffd9432404944829d05ef3c3dc6
ms.contentlocale: ru-ru
ms.lasthandoff: 04/27/2017

---

# <a name="azure-active-directory-seamless-single-sign-on"></a>Простой единый вход Azure Active Directory

## <a name="what-is-azure-active-directory-seamless-single-sign-on"></a>Что такое простой единый вход Azure Active Directory?

Простой единый вход Azure Active Directory — это действительно единый вход пользователей на корпоративные компьютеры, подключенные к корпоративной сети. Если он включен, пользователям не нужно будет вводить пароль для входа в Azure AD, а в большинстве случаев — даже вводить имя пользователя. Данная функция предоставляет пользователям удобный доступ к облачным службам и не требует установки каких-либо дополнительных локальных компонентов.

Простой единый вход можно включить с помощью Azure AD Connect. Его можно совместить с [синхронизацией паролей](active-directory-aadconnectsync-implement-password-synchronization.md) или [сквозной аутентификацией](active-directory-aadconnect-pass-through-authentication.md).

>[!NOTE]
>Эта функция НЕ применима к службам федерации Active Directory (AD FS), в которых она уже реализована.

Чтобы эта функция работала для конкретного пользователя, должны быть выполнены следующие условия.

- Пользователь должен входить на корпоративный компьютер.
- Этот компьютер должен быть присоединен к домену Active Directory (AD).
- У него должно быть прямое подключение к контроллеру домена по корпоративной проводной или беспроводной сети или через подключение удаленного доступа, например VPN-подключение.
- Конечные точки нашей службы должны быть добавлены в зону интрасети в браузере.

Если любое из вышеуказанных условий не выполнено, то пользователю будет предложено ввести имя пользователя и пароль, как раньше.

![Простой единый вход](./media/active-directory-aadconnect-sso/sso1.png)

## <a name="whats-available-during-preview"></a>Что доступно на этапе предварительной версии?

>[!NOTE]
>Простой единый вход находится на этапе предварительной версии. Это бесплатный компонент, и для его использования не требуются платные выпуски Azure AD.

Простой единый вход доступен в браузерных клиентах и клиентах Office, поддерживающих [современную аутентификацию](https://aka.ms/modernauthga), на компьютерах с поддержкой проверки подлинности Kerberos, например компьютерах Windows. В таблице ниже приведены сведения о клиентах на основе веб-браузера в разных операционных системах.

| Операционная система и браузер |Internet Explorer|Google Chrome|Mozilla Firefox|Edge
| --- | --- |--- | --- | --- |
|Windows 10|Да|Да|Да\*|Нет
|Windows 8.1|Да|Да|Да\*|Недоступно
|Windows 8|Да|Да|Да\*|Недоступно
|Windows 7|Да|Да|Да\*|Недоступно
|Mac OS X|Недоступно|Да\*|Да\*|Недоступно

\*Требуется дополнительная настройка.

>[!NOTE]
>Чтобы обеспечить оптимальное взаимодействие с Azure AD, мы рекомендуем использовать в Windows 10 функцию [присоединения к Azure AD](../active-directory-azureadjoin-overview.md).

Если запрос на вход в Azure AD включает параметры `domain_hint` или `login_hint` (инициированные приложением в вашем клиенте), простой единый вход воспользуется этим и пользователю не придется вводить свои имя пользователя и пароль.

## <a name="how-does-azure-ad-seamless-sso-work"></a>Как работает простой единый вход Azure AD?

Включить простой единый вход можно в Azure AD Connect, как показано [ниже](#how-to-enable-azure-ad-seamless-sso?). После его включения в локальной службе Active Directory (AD) создается учетная запись компьютера AZUREADSSOACCT. Этой службе безопасным способом предоставляется ключ расшифровки Kerberos. Кроме того, создаются два имени субъектов-служб (SPN) Kerberos, представляющие URL-адреса служб, используемые при входе в Azure AD.

>[!NOTE]
> Учетная запись компьютера и имена участников-служб Kerberos должны создаваться в каждом лесу AD, который синхронизируется с Azure AD (с помощью Azure AD Connect) и для пользователей которого необходимо включить простой единый вход. Если в лесу AD есть подразделения для учетных записей компьютеров, включив функцию простого единого входа, переместите учетную запись компьютера AZUREADSSOACCT в подразделение, чтобы убедиться, что она не удалена и управление ею осуществляется таким же образом, как и другими учетными записями компьютеров.

После завершения этой настройки функция входа в Azure AD работает так же, как любая другая функция входа, использующая встроенную проверку подлинности Windows (IWA). Ниже описывается, как работает простой единый вход.

Предположим, что пользователь пытается получить доступ к защищенному облачному ресурсу Azure AD, например SharePoint Online. SharePoint Online перенаправляет браузер пользователя в Azure AD для входа.

Если запрос на вход в Azure AD содержит параметр `domain_hint` (идентифицирует клиент Azure AD, например contoso.onmicrosoft.com) или `login_hint` (определяет имя пользователя, например user@contoso.onmicrosoft.com или user@contoso.com), то выполняются шаги 1–5.

Если ни один из этих двух параметров не включен в запрос, то пользователю будет предложено ввести свое имя пользователя на странице входа в Azure AD. Шаги 1–5 выполняются только после того, как пользователь уберет указатель из поля имени пользователя или нажмет кнопку "Продолжить".

1. Azure AD запрашивает от клиента билет Kerberos (возвращается ответ 401, "Нет доступа").
2. Клиент запрашивает в Active Directory билет для Azure AD (представленный учетной записью компьютера, которая была настроена ранее).
3. Active Directory находит учетную запись компьютера и возвращает клиенту билет Kerberos, зашифрованный с использованием секрета этой учетной записи компьютера. Билет содержит удостоверение пользователя, выполнившего вход на данный компьютер.
4. Клиент отправляет билет Kerberos, полученный от Active Directory, в Azure AD.
5. Azure AD расшифровывает билет Kerberos с использованием полученного ранее ключа. Если он расшифрован успешно, Azure AD либо возвращает маркер пользователю, либо запрашивает дополнительную проверку, например Многофакторную идентификацию, согласно требованиям ресурса.

Простой единый вход — ситуативно-обусловленная функция. Это значит, что если в ней происходит сбой, процедура входа выполняется стандартно, то есть пользователь, как и прежде, должен просто ввести пароль на странице входа.

Этот процесс показан на следующем рисунке:

![Простой единый вход](./media/active-directory-aadconnect-sso/sso2.png)

## <a name="how-to-enable-azure-ad-seamless-sso"></a>Как включить простой единый вход Azure AD?

### <a name="pre-requisites"></a>Предварительные требования

Если вы включаете простой единый вход со сквозной аутентификацией и все предварительные требования для сквозной аутентификации выполнены, то больше ничего не требуется.

Если вы включаете простой единый вход с синхронизацией паролей, и между Azure AD Connect и Azure AD настроен брандмауэр, то убедитесь в следующем.

- Сервер Azure AD Connect может взаимодействовать с URL-адресами `*.msappproxy.net`.
- Azure AD Connect (версии 1.1.484.0 или более поздней версии) может выполнять HTTPS-запросы к Azure AD через порт 443. Он используется только для включения функции, не для входа пользователей.
- Кроме того, Azure AD Connect может устанавливать прямые IP-подключения к [диапазонам IP-адресов центра обработки данных Azure](https://www.microsoft.com/en-us/download/details.aspx?id=41653). Опять же, это используется только для включения функции.

>[!NOTE]
> Предыдущие версии Azure AD Connect (предшествующие версии 1.1.484.0) должны иметь возможность взаимодействовать с Azure AD через порт 9090.

### <a name="enabling-the-azure-ad-seamless-sso-feature"></a>Включение функции простого единого входа Azure AD

Простой единый вход Azure AD можно включить с помощью Azure AD Connect.

В случае выполнения новой установки Azure AD Connect выберите [пользовательский путь установки](active-directory-aadconnect-get-started-custom.md). На странице "Вход пользователя" установите флажок "Включить единый вход".

![Azure AD Connect: страница "Вход пользователя"](./media/active-directory-aadconnect-sso/sso8.png)

Если уже имеется установленный экземпляр Azure AD Connect, воспользуйтесь функцией [экспресс-установки](active-directory-aadconnect-get-started-express.md) или укажите [настраиваемый путь установки](active-directory-aadconnect-get-started-custom.md) в программе установки, выберите страницу "Смена имени пользователя для входа" в Azure AD Connect и нажмите кнопку "Далее". Затем установите флажок "Включить единый вход".

![Azure AD Connect: страница "Смена имени пользователя для входа"](./media/active-directory-aadconnect-user-signin/changeusersignin.png)

Следуйте указаниям мастера установки, пока не дойдете до страницы "Включение единого входа". Потребуется предоставить учетные данные администратора домена для каждого леса AD, который синхронизируется с Azure AD (с помощью Azure AD Connect) и для пользователей которого необходимо включить простой единый вход. Обратите внимание на то, что учетные данные администратора домена не хранятся в Azure AD Connect или Azure AD, а используются только для создания учетной записи компьютера и настройки имен субъектов-служб Kerberos, как описано выше.

На этом этапе простой единый вход включен на клиенте. Обратите внимание, что все равно нужно будет выполнить инструкции в следующем разделе, прежде чем пользователи смогут использовать преимущества этой функции.

## <a name="rolling-the-feature-out-to-your-users"></a>Развертывание функции для пользователей

Чтобы развернуть функцию простого единого входа для пользователей, вам понадобится добавить два URL-адреса Azure AD (https://autologon.microsoftazuread-sso.com и https://aadg.windows.net.nsatc.net) в параметры зоны интрасети пользователей с помощью групповой политики в Active Directory. Обратите внимание, что этот вариант подходит только для Internet Explorer и Google Chrome (при условии, что этот браузер использует тот же набор URL-адресов доверенных сайтов, что и Internet Explorer). Понадобится отдельная настройка для Mozilla Firefox.

### <a name="why-do-you-need-this"></a>Зачем это нужно?

По умолчанию браузеры не отправляют билеты Kerberos в облачную конечную точку, если только ее URL-адрес не определен как часть зоны интрасети в браузере. Браузер автоматически вычисляет соответствующую зону (Интернета или интрасети) по URL-адресу. Например, http://contoso/ будет сопоставлен с зоной интрасети, а http://intranet.contoso.com/ — с зоной Интернета (так как этот URL-адрес содержит точку).

Так как URL-адреса Azure AD, используемые для простого единого входа, содержат точку, то их нужно явным образом добавить в параметры зоны интрасети в каждом браузере. После этого браузер будет автоматически отправлять билеты Kerberos выполнившего вход пользователя в Azure AD. Хотя это можно сделать вручную на каждом компьютере, но проще всего добавить необходимые URL-адреса в зону интрасети для всех пользователей, создав групповую политику в Active Directory.

### <a name="detailed-steps"></a>Подробные инструкции

1. Откройте средства управления групповыми политиками.
2. Измените групповую политику, которая применяется ко всем пользователям, например **политику домена по умолчанию**.
3. Перейдите в раздел **Конфигурация пользователя\Административные шаблоны\Компоненты Windows\Internet Explorer\Панель управления браузером\Вкладка безопасности** и выберите **Список назначений зоны для веб-сайтов**.
![Единый вход](./media/active-directory-aadconnect-sso/sso6.png)  
4. Включите политику и введите следующие значения и данные в диалоговом окне. Это URL-адреса Azure AD, на которые отправляются билеты Kerberos.

        Value: https://autologon.microsoftazuread-sso.com  
        Data: 1  
        Value: https://aadg.windows.net.nsatc.net  
        Data: 1  
5. Нажмите кнопку **ОК**, затем нажмите кнопку **ОК** еще раз.

Результат будет выглядеть так:

![Единый вход](./media/active-directory-aadconnect-sso/sso7.png)

>[!NOTE]
>По умолчанию Chrome и Internet Explorer используют одинаковый набор доверенных URL-адресов сайтов. Если вы настроили для Chrome другие параметры, то их необходимо обновить отдельно.

## <a name="troubleshooting-seamless-sso"></a>Устранение неполадок при использовании простого единого входа

Используйте следующий контрольный список для устранения неполадок простого единого входа.

1. Проверьте, включена ли функция простого единого входа на клиенте в инструменте Azure AD Connect. Если функцию не удается включить (например, из-за заблокированного порта), убедитесь, что выполнены все [предварительные условия](#pre-requisites). Если проблемы с включением функции не исчезли, обратитесь в службу поддержки Майкрософт.
2. Оба URL-адреса службы (https://autologon.microsoftazuread-sso.com и https://aadg.windows.net.nsatc.net) должны быть определены в зоне интрасети.
3. Убедитесь, что корпоративный компьютер присоединен к домену AD.
4. Убедитесь, что пользователь вошел на компьютер с помощью доменной учетной записи AD.
5. Убедитесь, что учетная запись пользователя получена из леса AD, где настроен простой единый вход.
6. Убедитесь, что компьютер подключен к корпоративной сети.
7. Убедитесь, что время на компьютере синхронизировано с временем в Active Directory, и разница между временем контроллеров домена не превышает 5 минут.
8. Удалите существующие билеты Kerberos с компьютера этой службы. Это можно сделать, выполнив команду **klist purge** в командной строке.
9. Просмотрите журналы консоли браузера (в разделе "Средства разработчика"), чтобы выявить возможные проблемы.

### <a name="domain-controller-logs"></a>Журналы контроллеров домена

Если в контроллере домена включен аудит успешных операций, при каждом входе пользователя с помощью простого единого входа в журнал событий добавляется запись системы безопасности (событие 4769, связанное с учетной записью компьютера **AzureADSSOAcc$**). Эти события безопасности можно найти с помощью приведенного ниже запроса.

```
    <QueryList>
      <Query Id="0" Path="Security">
    <Select Path="Security">*[EventData[Data[@Name='ServiceName'] and (Data='AZUREADSSOACC$')]]</Select>
      </Query>
    </QueryList>
```

