---
title: "Azure AD Connect: принципы проектирования | Документация Майкрософт"
description: "В этой статье описываются факторы, которые необходимо учитывать при проектировании реализации."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: 
ms.assetid: 4114a6c0-f96a-493c-be74-1153666ce6c9
ms.service: active-directory
ms.custom: azure-ad-connect
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: Identity
ms.date: 09/13/2016
ms.author: billmath
translationtype: Human Translation
ms.sourcegitcommit: 28b5da6098316f8fbe84966e0dac88f5b7d2cb1d
ms.openlocfilehash: 177c622171c4b0e1813c85d1c22bda87aeafce06


---
# <a name="azure-ad-connect-design-concepts"></a>Azure AD Connect: принципы проектирования
В этой статье приведено описание факторов, которые должны учитываться при проектировании реализации Azure AD Connect. Здесь подробно рассмотрены некоторые вопросы, но часть из них вкратце рассмотрена в других статьях.

## <a name="sourceanchor"></a>sourceAnchor
Атрибут sourceAnchor определяется как *атрибут, который остается неизменным на протяжении всего времени существования объекта*. Он однозначно определяет объект независимо от того, является ли он локальным или находится в Azure AD. Этот атрибут также называется **immutableId**. Оба этих имени взаимозаменяемы.

Слово "неизменяемый" является в этой статье ключевым. Оно означает, что значение атрибута не может быть изменено. Так как значение этого атрибута, если оно уже задано, нельзя изменить, важно выбрать такой подход к проектированию, который подойдет для вашей ситуации.

Данный атрибут используется в следующих случаях.

* При создании нового сервера синхронизации или его пересоздании после аварийного восстановления: в таком случае этот атрибут связывает существующие объекты в Azure AD с локальными объектами.
* При смене модели, в которой используются только облачные удостоверения, на модель, в которой используются синхронизированные удостоверения: в таком случае этот атрибут позволяет жестко связывать существующие объекты в Azure AD с локальными объектами.
* При использовании федерации: в этом случае данный атрибут в сочетании с **userPrincipalName** используется в утверждении для уникальной идентификации пользователя.

В этой статье речь идет только об атрибуте sourceAnchor в контексте его значения для пользователей. Аналогичные правила действуют для всех типов объектов, но проблемы обычно возникают именно у пользователей.

### <a name="selecting-a-good-sourceanchor-attribute"></a>Выбор значений атрибута sourceAnchor.
Значение атрибута должно соответствовать следующим правилам:

* Его длина должна быть меньше 60 символов.
  * Символы, отличные от a–z, A–Z или 0–9, кодируются, и каждый из них считается как три символа.
* Оно не должно содержать специальные символы: &#92; ! # $ % & * + / = ? ^ &#96; { } | ~ < > ( ) ' ; : , [ ] " @ _
* Оно должно быть глобально уникальным.
* Значение должно относиться к строковому, целочисленному или двоичному типу.
* Значение не должно быть основано на имени пользователя.
* Значение не должно быть с учетом регистра и содержать значения, которые изменяются в зависимости от регистра.
* Значение должно присваиваться при создании объекта.

Если значение sourceAnchor не является строковым, служба Azure AD Connect шифрует его в формате Base64, чтобы исключить появление специальных символов. Если вы используете сервер федерации, отличный от ADFS, убедитесь, что сервер также может кодировать атрибут в формате Base64.

Атрибут sourceAnchor чувствителен к регистру. JohnDoe и johndoe — это разные значения. При этом не стоит создавать два объекта, имена которых отличаются только регистром.

При наличии одного локального леса следует использовать атрибут **objectGUID**. Этот атрибут используется, если вы применяете стандартные параметры Azure AD Connect. Он также используется в DirSync.

Если у вас есть несколько лесов и вы не перемещаете пользователей между ними или доменами, то и в этом случае мы рекомендуем использовать атрибут **objectGUID** .

Если же вы перемещаете пользователей между лесами или доменами, вам необходимо найти такой атрибут, который либо никогда не изменяется, либо может перемещаться вместе с пользователями. Рекомендуется использовать синтетический атрибут. Для этого подходит атрибут, который может содержать что-нибудь наподобие идентификатора GUID. При создании объекта создается новый идентификатор GUID, который присваивается пользователю. На сервере подсистемы синхронизации можно создать настраиваемое правило синхронизации, которое будет создавать это значение на основе идентификатора **objectGUID** и обновлять выбранный атрибут в службе ADDS. При перемещении объекта убедитесь, что это значение также копируется.

Другой вариант — выбрать существующий атрибут, который никогда не изменяется. Зачастую можно использовать атрибут **employeeID**. Если значение атрибута содержит буквы, исключите вероятность изменения регистра (на верхний или нижний) в этом значении. Не используйте атрибуты, содержащие имя пользователя. В случае женитьбы, замужества или развода имя может измениться, что недопустимо для этого атрибута. Это одна из причин того, почему мастер установки Azure AD Connect не позволяет выбирать такие атрибуты, как **userPrincipalName**, **mail** и **targetAddress**. Эти атрибуты содержат также знак "@", что недопустимо для sourceAnchor.

### <a name="changing-the-sourceanchor-attribute"></a>Изменение атрибута sourceAnchor.
Значение атрибута sourceAnchor нельзя изменить после создания объекта в Azure AD и синхронизации удостоверения.

По этой причине в Azure AD Connect действуют следующие ограничения.

* Атрибут sourceAnchor можно задать только при первоначальной установке. При повторном запуске мастера установки этот параметр доступен только для чтения. Для изменения этого параметра потребуется удалить и повторно установить программу.
* При установке другого сервера Azure AD Connect необходимо выбрать уже используемый атрибут sourceAnchor. Если вы ранее использовали DirSync и переходите на Azure AD Connect, вам потребуется использовать **objectGUID** , так как этот атрибут использовался в DirSync.
* Если после экспорта объекта в Azure AD значение sourceAnchor изменится, синхронизация Azure AD Connect выдаст ошибку и вы больше не сможете изменять этот объект, пока не устраните проблему, восстановив прежнюю версию sourceAnchor в исходном каталоге.

## <a name="azure-ad-sign-in"></a>Вход в Azure AD
При интеграции локального каталога с Azure AD важно понять, как параметры синхронизации могут повлиять на способ проверки подлинности, используемый пользователем. Для аутентификации пользователя служба Azure AD использует имя участника-пользователя (userPrincipalName). Однако при синхронизации пользователей необходимо тщательно выбирать атрибут, который будет использоваться в качестве значения userPrincipalName.

### <a name="choosing-the-attribute-for-userprincipalname"></a>Выбор атрибута для userPrincipalName
При выборе атрибута, который будет использоваться в Azure в качестве значения UPN (имени участника-пользователя), следует убедиться в следующем.

* Значения атрибута соответствуют синтаксису имени участника-пользователя (RFC 822), т. е. формат должен быть таким: username@domain.
* Суффикс в значениях соответствует одному из подтвержденных пользовательских доменов в Azure AD.

В стандартных параметрах предполагается, что для атрибута выбрано значение userPrincipalName. Если атрибут userPrincipalName не содержит значение, с помощью которого пользователи должны входить в Azure, выбирайте **выборочную установку**.

### <a name="custom-domain-state-and-upn"></a>Состояние и имя участника-пользователя пользовательского домена
Важно убедиться, что для суффикса имени участника-пользователя используется подтвержденный домен.

Джон (John) является пользователем в contoso.com. Вам нужно, чтобы после синхронизации пользователей с каталогом Azure AD azurecontoso.onmicrosoft.com Джон входил в Azure с помощью локального имени участника-пользователя john@contoso.com. Для этого вам нужно сначала добавить и подтвердить contoso.com как личный домен в службе Azure AD. Только после этого вы сможете синхронизировать пользователей. Если суффикс имени участника-пользователя Джона (contoso.com) не соответствует подтвержденному домену в службе Azure AD, то Azure AD заменяет такой суффикс на contoso.onmicrosoft.com.

### <a name="non-routable-on-premises-domains-and-upn-for-azure-ad"></a>Не поддерживающие маршрутизацию локальные домены и имена участников-пользователей для Azure AD
В некоторых организациях используются домены, не поддерживающие маршрутизацию, например contoso.local, или простые одноуровневые домены наподобие contoso. В службе Azure AD нельзя подтвердить не поддерживающий маршрутизацию домен. Служба Azure AD Connect может синхронизироваться только с подтвержденным доменом в Azure AD. При создании каталога Azure AD служба создает маршрутизируемый домен (например, contoso.onmicrosoft.com), который становится для Azure AD доменом по умолчанию. Поэтому в данной ситуации возникает необходимость подтвердить любой другой маршрутизируемый домен, на случай если вы не хотите синхронизироваться с доменом onmicrosoft.com по умолчанию.

Дополнительные сведения о добавлении и подтверждении доменов см. в статье [Добавление имени личного домена в Azure Active Directory](../active-directory-add-domain.md).

Azure AD Connect определяет, когда используется не поддерживающая маршрутизацию доменная среда и соответствующим образом предупреждает, чтобы вы не продолжали, не изменив стандартные параметры. Если вы работаете в домене, который не поддерживает маршрутизацию, имена участников-пользователей, скорее всего, тоже имеют не поддерживающий маршрутизацию суффикс. Например, если вы работаете в домене contoso.local, служба Azure AD Connect предлагает вместо стандартных параметров использовать настраиваемые. С помощью настраиваемых параметров можно указать атрибут, который следует использовать в качестве имени участника-пользователя для входа в Azure после синхронизации пользователей с Azure AD.

## <a name="next-steps"></a>Дальнейшие действия
Узнайте больше об [интеграции локальных удостоверений с Azure Active Directory](active-directory-aadconnect.md).




<!--HONumber=Dec16_HO3-->


