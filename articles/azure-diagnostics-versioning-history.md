<properties
	pageTitle="Журнал версий системы диагностики Azure"
	description="Описание изменений в разных версиях системы диагностики Azure, поставляемых с разными версиями пакета SDK для Microsoft Azure."
	services="multiple"
	documentationCenter=".net"
	authors="rboucher"
	manager="jwhit"
	editor=""/>

<tags
	ms.service="multiple"
	ms.workload="na"
	ms.tgt_pltfrm="na"
	ms.devlang="dotnet"
	ms.topic="article"
	ms.date="02/12/2016"
	ms.author="robb"/>


# Журнал версий системы диагностики Microsoft Azure

Не приходилось использовать систему диагностики Azure? См. [обзор системы диагностики Azure](azure-diagnostics.md).

С каждой версией пакета SDK для Azure обычно поставляется новая версия системы диагностики Azure. В следующей таблице описываются версии пакетов SDK для Azure и систем диагностики Azure, связанных с выпуском пакета SDK.



Версия пакета SDK для Azure | Версия системы диагностики Azure | Модель
--- | --- | ---
1\.x | 1\.0 | Подключаемый модуль
2\.0–2.4| 1\.0 | "
2\.5 | 1\.2 | Расширение
2\.6 | 1,3 | "
2\.7 | 1\.4 | "
2\.8 | 1\.5 | "


Последняя версия — 1.5, которая поставляется с пакетом SDK для Azure 2.8. Версия расширения системы диагностики Azure, поставляемая с пакетом SDK, используется только для сценариев локального эмулятора. Любое развернутое приложение, запущенное в Azure, автоматически использует последнюю версию, вне зависимости от того, какая версия пакета SDK использовалась при сборке приложения. Тем не менее, если не установить последний пакет SDK для Azure, могут быть доступны не все инструменты, позволяющие использовать новые возможности.

Различные функции и изменения описаны ниже.

## Пакет SDK для Azure 2.8
В пакет SDK для Azure 2.8 была добавлена возможность отправлять данные диагностики в [Application Insights](./application-insights/app-insights-cloudservices.md). Это упрощает диагностирование проблем в приложении, а также на уровне системы и инфраструктуры.

## Изменения в системе диагностики Azure версии 2.6

Для проектов облачной службы, созданных в Visual Studio с помощью пакета SDK для Azure 2.6, были внесены следующие изменения. (Эти изменения действуют и в более поздних версиях Azure SDK.)

- Локальный эмулятор теперь поддерживает систему диагностики. Это означает, что на этапе разработки и тестирования в Visual Studio вы можете собирать диагностические данные. Это позволит вам убедиться, что приложение создает правильные трассировки. При запуске проекта облачной службы в Visual Studio строка подключения `UseDevelopmentStorage=true` включает сбор диагностических данных с помощью эмулятора хранения Azure. Все диагностические данные собираются в учетную запись хранения (хранилище для разработки).

- Строка подключения к учетной записи хранения диагностической информации (Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString) также хранится в файле конфигурации (CSCFG) службы. В пакете Azure SDK версии 2.5 учетная запись хранения диагностических данных указывается в файле diagnostics.wadcfgx.

Существуют важные различия между работой строки подключения в старых версиях пакета Azure SDK (до версии 2.4 включительно) и более новых (начиная с версии 2.6).

- В Azure SDK 2.4 и более ранних версиях строка подключения использовалась как среда выполнения подключаемого модуля диагностики, который получал из нее параметры учетной записи хранения для передачи журналов диагностики.

- В Azure SDK 2.6 и более поздних версиях Visual Studio использует строку подключения диагностики для настройки учетной записи хранения в расширении диагностики во время публикации. Строка подключения позволяет вам указать разные учетные записи хранения для различных конфигураций службы. Visual Studio будет использовать их во время публикации. Но подключаемый модуль диагностики больше не доступен (в пакетах Azure SDK, начиная с версии 2.5), поэтому сам CSCFG-файл уже не может включить расширение диагностики. Его нужно включать отдельно с помощью таких средств, как Visual Studio или PowerShell.

- Выходные данные пакета Visual Studio содержат, среди прочего, общедоступный XML-файл конфигурации расширения диагностики для каждой роли. Это позволяет упростить процесс настройки расширения с помощью PowerShell. С помощью строки подключения диагностики Visual Studio получает из общедоступной конфигурации данные учетной записи хранения. Общедоступные файлы конфигураций создаются в папке «Расширения» с именами в формате bvt.bnPaaSDiagnostics.<RoleName>.PubConfig.xml. Все развертывания с использованием PowerShell могут использовать этот шаблон имени для сопоставления каждой конфигурации с ролью.

- Строку подключения из CSCFG-файла также использует портал Azure для доступа к диагностическим данным, отображаемым на вкладке **Мониторинг**. Строка подключения позволяет настроить в службе отображение на портале подробных данных мониторинга.

### Перенос проектов на Azure SDK версии 2.6 и выше

Когда проект переносится с Azure SDK 2.5 на Azure SDK 2.6 или более новую версию, данные учетной записи хранения диагностической информации, указанные в WADCFGX-файле, сохраняются. Чтобы воспользоваться преимуществами гибкости использования различных учетных записей хранения для разных конфигураций хранилища, необходимо вручную добавить строку подключения в проект. Если при переносе проекта на основе пакета SDK для Azure 2.4 или более ранней версии на пакет SDK для Azure 2.6 строки подключения системы диагностики сохраняются. Однако не забывайте, что в Azure SDK 2.6 строки подключения используются иначе (см. предыдущий раздел).

### Определение учетной записи хранения диагностических данных в Visual Studio

- Если в CSCFG-файле указана строка подключения диагностики, Visual Studio использует ее для настройки расширения диагностики во время публикации, а также при создании общедоступных XML-файлов конфигурации на этапе упаковки.

- Если в CSCFG-файле строка подключения диагностики не указана, Visual Studio использует для этих же целей учетную запись хранения, указанную в WADCFGX-файле.

- Строка подключения диагностики в CSCFG-файле имеет более высокий приоритет, чем учетная запись хранения в WADCFGX-файле. Если в CSCFG-файле присутствует строка подключения диагностики, Visual Studio использует именно ее, игнорируя учетную запись хранения в WADCFGX-файле.

### Флажок «Обновлять строки подключения хранилища разработки...»

Флажок **Обновлять строки подключения хранилища разработки для диагностики и кэширования, используя учетную запись хранения Microsoft Azure, при публикации в Microsoft Azure** позволяет быстро заменить строку подключения хранилища для разработки учетной записью хранения Azure, указанной во время публикации.

Предположим, вы установили этот флажок, а в строке подключения диагностики указан параметр `UseDevelopmentStorage=true`. Когда вы будете публиковать проект в Azure, Visual Studio автоматически заменит строки подключения диагностики учетной записью хранения, которую вы указали в мастере публикации. Но если в строке подключения диагностики указана реальная учетная запись хранения, будет использоваться именно она.

## Функциональные различия диагностики в Azure SDK между более ранними (до 2.4 включительно) и более поздними (с 2.5 включительно) версиями

Обновляя свой проект с Azure SDK 2.4 на Azure SDK 2.5 и выше, помните о следующих функциональных различиях.

- **API конфигурации больше не используются**. Программная конфигурация диагностики доступна в Azure SDK 2.4 и более ранних версиях, но начиная с версии Azure SDK 2.5 она не используется. Если конфигурация диагностики в вашем проекте определена в коде, после переноса проекта на более новую версию SDK все нужно настроить заново, иначе диагностика работать не будет. Azure SDK 2.4 используется файл конфигурации диагностики diagnostics.wadcfg, а Azure SDK 2.5 и более поздние версии — diagnostics.wadcfgx.

- **Диагностику для приложений облачной службы можно настроить только на уровне роли, а не на уровне экземпляра.**

- **Конфигурация диагностики обновляется при каждом развертывании приложения**. Если вы измените конфигурацию диагностики в обозревателе сервера и повторно развернете приложение, могут возникнуть проблемы с контролем четности.

- **В Azure SDK 2.5 и более поздних версиях аварийные дампы настраиваются в файле конфигурации диагностики, а не в коде**. Если вы настроили аварийные дампы в коде проекта, следует вручную перенести параметры из кода в файл конфигурации, поскольку при переходе на Azure SDK 2.6 аварийные дампы не переносятся.

<!---HONumber=AcomDC_0302_2016-->