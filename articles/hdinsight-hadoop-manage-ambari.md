<properties
   pageTitle="Управление кластерами HDInsight с помощью Ambari | Azure"
   description="Узнайте, как использовать Ambari для наблюдения за кластерами HDInsight на платформе Linux и управления их функционированием."
   services="hdinsight"
   documentationCenter=""
   authors="Blackmist"
   manager="paulettm"
   editor="cgronlun"/>

<tags
   ms.service="hdinsight"
   ms.devlang=""
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="big-data"
   ms.date="02/18/2015"
   ms.author="larryfr"/>

#Управление кластерами HDInsight с помощью Ambari (Предварительная версия)

Узнайте, как использовать Ambari для управления кластерами HDInsight на платформе Linux и наблюдения за их функционированием.

> [AZURE.NOTE] Большая часть информации в этой статье относится только к кластерами HDInsight на платформе Linux. Для кластеров HDInsight на платформе Windows доступен мониторинг только через Ambari REST API. См. статью [Отслеживание кластеров Hadoop в HDInsight с помощью интерфейса Ambari API](hdinsight-monitor-use-ambari-api.md).

##<a id="whatis"></a>Что такое Ambari?

<a href="http://ambari.apache.org" target="_blank">Apache Ambari</a> упрощает управление Hadoop, предоставляя простой в использовании веб-интерфейс, который можно использовать для подготовки кластеров Hadoop, наблюдения за ними, а также управления их функционированием. Разработчики могут интегрировать эти возможности в своих приложениях с помощью  <a href="https://github.com/apache/ambari/blob/trunk/ambari-server/docs/api/v1/index.md" target="_blank">интерфейсов API REST Ambari</a>. 

Ambari предоставляется по умолчанию с кластерами HDInsight на платформе Linux. Кластеры HDInsight на платформе Windows предоставляют средства наблюдения через API REST Ambari.

##Прокси-сервер SSH

> [AZURE.NOTE] Хотя Ambari для кластера доступен напрямую через Интернет, некоторые функциональные возможности зависят от доступа к узлам по внутреннему доменному имени, используемому в кластере. Так как это внутреннее доменное имя, а не общедоступное, вы получите ошибки "сервер не найден", если попытаетесь получить доступ к некоторым функциям сервера через Интернет.

Чтобы обойти эту проблему, используйте туннель SSH для проксирования веб-трафика на головном узле кластера, который может успешно сопоставлять внутренние доменные имена. Используйте следующие статьи, чтобы создать туннель SSH от порта на локальном компьютере до кластера.

* <a href="../hdinsight-hadoop-linux-use-ssh-unix/#tunnel" target="_blank">Использование SSH с Hadoop под управлением Linux в HDInsight в Linux, Unix или OS X</a> - шаги по созданию туннеля SSH с помощью команды `ssh`

* <a href="../hdinsight-hadoop-linux-use-ssh-windows/#tunnel" target="_blank">Использование SSH с Hadoop под управлением Linux в HDInsight в Windows</a> - шаги по созданию PuTTY для создания туннеля SSH

##Веб-интерфейс Ambari

Веб-интерфейс Ambari доступен в каждом кластере HDInsight на платформе Linux, создаваемом по адресу **https://&lt;clustername>.azurehdinsight.net**. На эту страницу можно также перейти с помощью кнопки **Веб-интерфейс Ambari** в нижней части панели мониторинга кластера на портале Azure.

![ambari web icon](./media/hdinsight-hadoop-manage-ambari/ambari-web.png)

На странице будет дважды предложено пройти аутентификацию: первый раз - для аутентификации в кластере HDInsight, а второй раз - для аутентификации в Ambari.

* **Аутентификация в кластере** - используйте имя пользователя администратора кластера (значение по умолчанию - **admin**) и соответствующий пароль.

* **Аутентификация в Ambari** - по умолчанию используется имя пользователя и пароль **admin**

	> [AZURE.NOTE] При изменении пароля для пользователя **admin** необходимо ввести новый пароль.

При открытии страницы обратите внимание на панель в ее верхней части. На ней расположены следующие элементы управления и информация:

![ambari-nav](./media/hdinsight-hadoop-manage-ambari/ambari-nav.png)

* **Эмблема Ambari** - позволяет открыть **панель мониторинга**.

* **К-во операций имя_кластера** - число текущих операций Ambari. Если выбрать имя кластера или **К-во операций**, отобразится список фоновых операций.

* **К-во предупреждений** - число предупреждений или критических оповещений для кластера, если таковые имеются. При выборе этого элемента отобразится список предупреждений.

* **Панель мониторинга** - позволяет отобразить панель мониторинга, которую можно использовать для мониторинга кластера.

* **Службы** - информация и параметры конфигурации служб в кластере.

* **Узлы** - информация и параметры конфигурации узлов в кластере.

* **Предупреждения** - в том числе информация к сведению, предупреждения и критические предупреждения.

* **Администратор** - стек программного обеспечения и службы, которые были установлены или могут добавляться в кластер, информация об учетной записи службы и данные о безопасности Kerberos.

* **Кнопка "Администратор"** - управление Ambari, параметры пользователя и выход.

###Мониторинг

####Оповещения

Ambari предоставляет множество предупреждений, которые могут находиться в одном из следующих состояний.

* **OK**

* **Предупреждение**

* **КРИТИЧЕСКИЙ**

* **НЕИЗВЕСТНО**

При любых предупреждениях, кроме **ОК**, в поле **К-во предупреждений** в верхней части страницы будет отображаться их общее количество. Выберите эту запись, чтобы отобразить предупреждения и их состояние.

Предупреждения разбиты на несколько групп по умолчанию, которые можно просмотреть на странице **Предупреждения**. 

![alerts page](./media/hdinsight-hadoop-manage-ambari/alerts.png)

Группами можно управлять с помощью меню **Действия**, а также выбрав **Управление группами предупреждений**. Это позволит изменить существующие группы или создать новые.

![manage alert groups dialog](./media/hdinsight-hadoop-manage-ambari/manage-alerts.png)

С помощью меню **Действия** можно также создать **уведомления**. Это позволит создавать триггеры, отправляющие уведомления по **электронной почте** или протоколу **SNMP** при появлении определенного предупреждения заданной серьезности. Например, предупреждение может отправляться, если для какого-либо предупреждения в группе **YARN по умолчанию** установлено значение **Критическое**.

![Create alert dialog](./media/hdinsight-hadoop-manage-ambari/create-alert-notification.png)

####Кластер

На вкладке **Метрики** **панели мониторинга** содержится ряд мини-приложений, которые позволяют легко определить состояние кластера с первого взгляда. Если щелкнуть некоторые мини-приложения, например **Загрузка ЦП**, отобразится дополнительная информация.

![dashboard with metrics](./media/hdinsight-hadoop-manage-ambari/metrics.png)

На вкладке **Тепловые карты** метрики отображаются в виде цветных тепловых карт с переходом от зеленого к красному.

![dashboard with heatmaps](./media/hdinsight-hadoop-manage-ambari/heatmap.png)

Чтобы узнать больше об узлах кластера, выберите **Узлы**, а затем - определенный узел, который вас интересует.

![host details](./media/hdinsight-hadoop-manage-ambari/host-details.png)

####Control

Боковая панель **Службы** на панели мониторинга позволяет получить общее представление о состоянии служб, работающих в кластере. Для обозначения состояния или мер, которые необходимо предпринять, используются различные значки, например желтый значок циклического повторения, если нужно перезапустить службу.

![services side-bar](./media/hdinsight-hadoop-manage-ambari/service-bar.png)

При выборе службы для нее отобразится более подробная информация.

![service summary information](./media/hdinsight-hadoop-manage-ambari/service-details.png)

#####Быстрые ссылки

Для некоторых служб в верхней части страницы отображаются **быстрые ссылки**. Их можно использовать для доступа к определенному веб-интерфейсу службы, например:

* **Журнал заданий** - журнал заданий MapReduce;

* **Диспетчер ресурсов** - пользовательский интерфейс диспетчера ресурсов YARN;

* **NameNode** - пользовательский интерфейс HDFS NameNode;

* **Веб-интерфейс Oozie** - пользовательский интерфейс Oozie.

При выборе любой из этих ссылок в браузере откроется новая вкладка с выбранной страницей.

> [AZURE.NOTE] Если не используется SSL-туннель для проксирования веб-трафика, поступающего в кластер, при выборе ссылки **Быстрые ссылки** для любой службы сервер не обнаружит никаких ошибок. Это связано с тем, что Ambari использует для этих ссылок внутреннее доменное имя.
> 
> Информацию об использовании SSL-туннеля с HDInsight см. в одной из следующих статей.
> 
> * <a href="../hdinsight-hadoop-linux-use-ssh-unix/#tunnel" target="_blank">Использование SSH с Hadoop под управлением Linux в HDInsight в Linux, Unix или OS X</a> - шаги по созданию туннеля SSH с помощью команды `ssh`
>
>* <a href="../hdinsight-hadoop-linux-use-ssh-windows/#tunnel" target="_blank">Использование SSH с Hadoop под управлением Linux в HDInsight в Windows</a> - шаги по созданию PuTTY для создания туннеля SSH

###Управление

####Пользователи, группы и разрешения Ambari

В предварительной версии HDInsight на платформе Linux не следует использовать управление пользователями, группами и разрешениями.

####Узел

На странице **Узлы** перечислены все узлы в кластере. Для управления узлами, сделайте следующее.

![hosts page](./media/hdinsight-hadoop-manage-ambari/hosts.png)

> [AZURE.NOTE] В кластерах HDInsight не следует использовать добавление, списание или восстановление списанного узла.

1. Выберите узлы, которыми вы хотите управлять.

2. С помощью меню **Действия** выберите действие, которое необходимо выполнить.

	* **Запустить все компоненты** - запуск всех компонентов на узле.

	* **Остановить все компоненты** - остановка всех компонентов на узле.

	* **Перезапустить все компоненты** - остановки и запуск всех компонентов на узле.

	* **Включить режим обслуживания** - подавление предупреждений для хоста. Этот параметр должен быть включен при выполнении действий, которые приводят к предупреждениям. Например, перезапуск службы, от которой зависит работа служб.

	* **Отключить режим обслуживания** - возврат узла к обычному режиму предупреждений.

	* **Остановить** - остановка DataNode или NodeManagers на узле.

	* **Запуск** - запуск DataNode или NodeManagers на узле.

	* **Перезапустить** - остановка и запуск DataNode или NodeManagers на узле.

	* **Списать** - удаление узла из кластера.

		> [AZURE.NOTE] Не используйте это действие в кластерах HDInsight.

	* **Восстановить списанные** - добавление списанных ранее узлов в кластер.

		> [AZURE.NOTE] Не используйте это действие в кластерах HDInsight.

####<a id="service"></a>Служба

На **панели мониторинга** или странице **Службы** используйте кнопку **Действия** в нижней части списка служб, чтобы **добавить** новые службы или **остановить** и вновь **запустить** все службы.

![service actions](./media/hdinsight-hadoop-manage-ambari/service-actions.png)

Ниже в общих чертах описана процедура **добавления службы**.

1. На **панели мониторинга** или странице **Службы** нажмите кнопку **Действия** и выберите **Добавить службу**.

2. В **мастере добавления службы** выберите службу, которую нужно добавить, а затем щелкните **Далее**.

	![add service](./media/hdinsight-hadoop-manage-ambari/add-service.png)

3. Продолжайте выполнять указания мастера, предоставляя информацию о конфигурации службы. Дополнительную информацию о требованиях к конфигурации см. в документации службы, которую вы добавляете.

4. На странице **Проверка** можно **вывести** информацию о конфигурации или **развернуть** службу в кластере.

5. После развертывания службы отобразится страница **Установка, запуск и тестирование** с информацией о ходе выполнения установки и тестирования службы. Когда индикатор **состояния** станет зеленым, выберите **Далее**.

	![image of install, start, and test page](./media/hdinsight-hadoop-manage-ambari/install-start-test.png)

6. На странице **Сводка** отображается сводка по процессу установки, а также все возможные действия, которые необходимо предпринять. Например, перезапуск других служб. Выберите **Завершить**, чтобы завершить работу мастера.

Хотя с помощью кнопки **Действия** можно перезапустить все службы, зачастую требуется запустить, остановить или перезапустить только одну из них. Чтобы **выполнить действия для отдельной службы**, сделайте следующее.

1. На странице **Панель мониторинга** или **Службы** выберите службу.

2. В верхней части вкладки **Сводка** используйте кнопку **Действия со службой** и выберите действие, которое необходимо предпринять. Это приведет к перезапуску службы на всех узлах.

	![service action](./media/hdinsight-hadoop-manage-ambari/individual-service-actions.png)

	> [AZURE.NOTE] Перезапуск некоторых служб во время работы кластера может привести к формированию предупреждений. Чтобы избежать этого, можно использовать кнопку **Действия со службой**, чтобы включить **режим обслуживания** для службы перед выполнением перезагрузки.

3. После выбора действия значение в поле **К-во операций** в верхней части страницы увеличится, что будет свидетельствовать о выполнении фоновой операции. Если настроено отображение списка фоновых операций, этот список появится на экране.

	> [AZURE.NOTE] Если для службы включен **режим обслуживания**, не забудьте его отключить с помощью кнопки **Действия со службой** после завершения операции.

Чтобы **настроить службу**, сделайте следующее:

1. На странице **Панель мониторинга** или **Службы** выберите службу.

2. Выберите вкладку **Конфигурации**. Отобразится текущая конфигурация. Также отобразится список предыдущих конфигураций.

	![configurations](./media/hdinsight-hadoop-manage-ambari/service-configs.png)

3. Используйте отображаемые поля для изменения конфигурации, а затем выберите **Сохранить**. Можно также выбрать предыдущую конфигурацию, а затем выбрать **Сделать текущей**, чтобы вернуться к предыдущим настройкам.

##Интерфейс REST API

Веб-интерфейс Ambari работает на базе API REST, который можно использовать для создания собственных средств управления и наблюдения. Хотя этот API относительно прост в использовании, при работе с ним следует учитывать некоторые особенности Azure.

* **Аутентификация** - для аутентификации в службе следует использовать имя пользователя администратора кластера (по умолчанию **admin**)
*  и его пароль.

* **Безопасность** - Ambari использует обычную проверку подлинности, поэтому при взаимодействии с API всегда следует использовать протокол HTTPS.

* **IP-адреса** - адрес, возвращаемый для узлов в кластере, недоступен за пределами кластера, если кластер не является частью виртуальной сети Azure. IP-адрес будет доступен для других участников виртуальной сети, но недоступен вне ее.

* **Некоторые функциональные возможности не включены** - некоторые функциональные возможности Ambari отключены, так как ими управляет облачная служба HDInsight. Например, добавление узлов в кластер или удаление их из него. При этом другие функциональные возможности в предварительной версии HDInsight на платформе Linux могут быть реализованы не полностью.

Полный справочник по REST API см. в статье [Справочник по API Ambari версии V1](https://github.com/apache/ambari/blob/trunk/ambari-server/docs/api/v1/index.md).


<!--HONumber=47-->
