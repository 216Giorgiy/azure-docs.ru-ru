<properties 
	pageTitle="Экспорт шаблона Azure Resource Manager | Microsoft Azure" 
	description="Используйте Azure Resource Manager для экспорта шаблона из существующей группы ресурсов." 
	services="azure-resource-manager" 
	documentationCenter="" 
	authors="tfitzmac" 
	manager="timlt" 
	editor="tysonn"/>

<tags 
	ms.service="azure-resource-manager" 
	ms.workload="multiple" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="get-started-article" 
	ms.date="05/10/2016" 
	ms.author="tomfitz"/>

# Экспорт шаблона Azure Resource Manager из существующих ресурсов

Порой трудно понять, как создавать шаблоны Azure Resource Manager. Однако Azure Resource Manager поможет справиться с этой задачей, так как с его помощью можно экспортировать шаблон из существующих ресурсов в подписке. Используя созданный шаблон, можно рассмотреть синтаксис шаблонов или при необходимости автоматизировать повторное развертывание решения.

При работе с этим руководством вы создадите учетную запись хранения на портале и экспортируете для нее шаблон. Затем вы измените группу ресурсов, добавив для нее виртуальную сеть, и экспортируете новый шаблон, представляющий текущее состояние этой группы. Несмотря на то, что в этом разделе рассматривается более простая инфраструктура, эти те же действия подойдут и для экспорта шаблонов для более сложных решений.

## Создание учетной записи хранения

1. На [портале Azure](https://portal.azure.com) последовательно выберите **Создать**, **Данные+хранилище** и **Учетная запись хранения**.

      ![создание хранилища](./media/resource-manager-export-template/create-storage.png)

2. Создайте учетную запись хранения с именем **storage**, добавив свои инициалы и дату. Имя учетной записи хранения должно быть уникальным в Azure. Если имя уже используется, попробуйте изменить его. В качестве группы ресурсов используйте **ExportGroup**. Для других свойств можно использовать значения по умолчанию. Нажмите кнопку **Создать**.

      ![указывание значений для хранилища](./media/resource-manager-export-template/provide-storage-values.png)

После завершения развертывания в подписке появится учетная запись хранения.

## Экспорт шаблона для развертывания
   
1. Перейдите в колонку новой группы ресурсов. Здесь будет указан результат последнего развертывания. Щелкните эту ссылку.

      ![колонка группы ресурсов](./media/resource-manager-export-template/resource-group-blade.png)
   
2. Отобразится журнал развертываний для группы. В вашем случае, возможно, будет отображаться только одно развертывание. Выберите его.

     ![последнее развертывание](./media/resource-manager-export-template/last-deployment.png)

3. После этого отобразится сводка по развертыванию. В сводке содержатся сведения о состоянии развертывания и операциях, а также значения, указанные для параметров. Чтобы увидеть шаблон, который использовался для развертывания, щелкните **Просмотреть шаблон**.

     ![просмотр сводки по развертыванию](./media/resource-manager-export-template/deployment-summary.png)

4. Resource Manager извлечет 5 файлов. К ним относятся:

   1. Шаблон, определяющий инфраструктуру решения. При создании учетной записи хранения на портале Resource Manager использовал шаблон, чтобы развернуть ее, и сохранил его для дальнейшего использования.

   2. Файл параметров, который можно использовать для передачи значений во время развертывания. Он содержит значения, указанные при первом развертывании. Однако любое из них можно изменить при повторном развертывании шаблона.

   3. Файл сценария Azure PowerShell, который можно использовать для развертывания шаблона.

   4. Файл сценария интерфейса командной строки, который можно использовать для развертывания шаблона.
   
   5. Класс .NET, который можно использовать для развертывания шаблона.

     К файлам можно получить доступ, используя ссылки в колонке. По умолчанию выбран шаблон.
     
       ![просмотр шаблона](./media/resource-manager-export-template/view-template.png)
     
     Обратим на него особое внимание. Шаблон должен иметь примерно такой вид:
   
        {
          "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "parameters": {
            "name": {
              "type": "String"
            },
            "accountType": {
              "type": "String"
            },
            "location": {
              "type": "String"
            },
            "encryptionEnabled": {
              "defaultValue": false,
              "type": "Bool"
            }
          },
          "resources": [
            {
              "type": "Microsoft.Storage/storageAccounts",
              "sku": {
                "name": "[parameters('accountType')]"
              },
              "kind": "Storage",
              "name": "[parameters('name')]",
              "apiVersion": "2016-01-01",
              "location": "[parameters('location')]",
              "properties": {
                "encryption": {
                  "services": {
                    "blob": {
                      "enabled": "[parameters('encryptionEnabled')]"
                    }
                  },
                  "keySource": "Microsoft.Storage"
                }
              }
            } 
          ]
        }
   
     Обратите внимание, что он определяет параметры для имени, типа и расположения учетной записи хранения, а также то, включено ли шифрование (значение по умолчанию — **false**). В разделе **resources** содержится определение учетной записи хранения для развертывания.
     
В квадратные скобки заключено выражение, которое вычисляется при развертывании. Выражения в квадратных скобках выше используются для получения значений параметров во время развертывания. Существует множество других выражений. Их примеры рассматриваются далее в этом разделе. Полный список см. в статье [Функции шаблонов Azure Resource Manager](resource-group-template-functions.md).
   
Дополнительные сведения о структуре шаблона см. в статье [Создание шаблонов Azure Resource Manager](resource-group-authoring-templates.md).

## Добавление виртуальной сети

Шаблон, скачанный в предыдущем разделе, представляет инфраструктуру для исходного развертывания. Однако он не отражает изменения, внесенные после развертывания. Чтобы продемонстрировать это, давайте изменим группу ресурсов, добавив виртуальную сеть на портале.

1. В колонке группы ресурсов щелкните **Добавить** и выберите **виртуальную сеть** из доступных ресурсов.
   
2. Присвойте виртуальной сети имя **VNET** и используйте значения по умолчанию для других свойств. Нажмите кнопку **Создать**.

      ![настройка оповещения](./media/resource-manager-export-template/create-vnet.png)
   
3. После успешного развертывания виртуальной сети в группе ресурсов проверьте журнал развертывания еще раз. Теперь там содержится два развертывания. Выберите последнее развертывание.

      ![журнал развертываний](./media/resource-manager-export-template/deployment-history.png)
   
4. Просмотрите шаблон для него. Обратите внимание, что он определяет только изменения, внесенные при добавлении виртуальной сети.

Как правило, рекомендуется использовать шаблон, который развертывает инфраструктуры для решения за одно действие, а не запоминать множество различных шаблонов для развертывания.


## Экспорт шаблона для группы ресурсов

Несмотря на то, что в каждом развертывании отображаются только изменения, внесенные в группу ресурсов, можно в любое время экспортировать шаблон для отображения атрибутов всей группы ресурсов.

1. Чтобы просмотреть шаблон для группы ресурсов, щелкните **Экспортировать шаблон**.

      ![экспорт группы ресурсов](./media/resource-manager-export-template/export-resource-group.png)

2. Снова появятся 5 файлов, которые можно использовать для повторного развертывания решения. Однако в этот раз шаблон выглядит немного иначе. Этот шаблон содержит только 2 параметра (по одному для имени учетной записи хранения и имени виртуальной сети).

        "parameters": {
          "virtualNetworks_VNET_name": {
            "defaultValue": "VNET",
            "type": "String"
          },
          "storageAccounts_storagetf05092016_name": {
            "defaultValue": "storagetf05092016",
            "type": "String"
          }
        },
        
     Resource Manager не извлекал шаблоны, использованные во время развертывания. Вместо этого он создал шаблон на основе текущей конфигурации ресурсов. Resource Manager не знает, какие значения необходимо передать в качестве параметров, поэтому он жестко задает большинство значений на основе значения в группе ресурсов. Например, для расположения и репликации учетной записи хранения задаются следующие значения:
     
        "location": "northeurope",
        "tags": {},
        "properties": {
            "accountType": "Standard_RAGRS"
        },

3. Скачайте шаблон, чтобы с ним можно было работать локально.

      ![скачивание шаблона](./media/resource-manager-export-template/download-template.png)

4. Найдите загруженный ZIP-файл и извлеките его содержимое. Этот скачанный шаблон можно использовать для повторного развертывания инфраструктуры.

## Дальнейшие действия

Поздравляем! Вы узнали, как экспортировать шаблон из ресурсов, созданных на портале.

- Во второй части этого руководства вы настроите скачанный шаблон, добавив дополнительные параметры, и повторно развернете его с помощью скрипта. См. статью [Customize exported Resource Manager template](resource-manager-customize-template.md) (Настройка и повторное развертывание экспортированного шаблона).
- Чтобы узнать, как экспортировать шаблон с помощью PowerShell, см. статью [Использование Azure PowerShell с Azure Resource Manager](powershell-azure-resource-manager.md).
- Чтобы узнать, как экспортировать шаблон с помощью интерфейса командной строки Azure, см. статью [Использование Azure CLI для Mac, Linux и Windows с Azure Resource Manager](xplat-cli-azure-resource-manager.md). 

<!---HONumber=AcomDC_0511_2016-->