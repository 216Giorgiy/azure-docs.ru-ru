<properties
	pageTitle="Экспорт шаблона Azure Resource Manager | Microsoft Azure"
	description="Используйте Azure Resource Manager для экспорта шаблона из существующей группы ресурсов."
	services="azure-resource-manager"
	documentationCenter=""
	authors="tfitzmac"
	manager="timlt"
	editor="tysonn"/>

<tags
	ms.service="azure-resource-manager"
	ms.workload="multiple"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="get-started-article"
	ms.date="05/10/2016"
	ms.author="tomfitz"/>

# Экспорт шаблона Azure Resource Manager из существующих ресурсов

Иногда бывает сложно выбрать способ создания шаблонов Azure Resource Manager. К счастью, Resource Manager помогает с этой задачей, так как шаблон можно экспортировать из существующих ресурсов в подписке. Используя созданный шаблон, можно изучить синтаксис шаблонов или при необходимости автоматизировать повторное развертывание решения.

При работе с этим руководством вы создадите на портале Azure учетную запись хранения, а затем экспортируете для нее шаблон. Вы также добавите виртуальную сеть, чтобы изменить группу ресурсов. Наконец, вы экспортируете новый шаблон, который представляет текущее состояние. Хотя в этой статье рассматривается упрощенная инфраструктура, с помощью описанных действий можно экспортировать шаблоны и для более сложных решений.

## Создайте учетную запись хранения.

1. На [портале Azure](https://portal.azure.com) последовательно выберите **Создать**, **Данные+хранилище** и **Учетная запись хранения**.

      ![создание хранилища](./media/resource-manager-export-template/create-storage.png)

2. Создайте учетную запись хранения с именем **storage**, добавив свои инициалы и дату. Имя учетной записи хранения должно быть уникальным в среде Azure. Если указанное имя уже используется, введите другое. В качестве группы ресурсов используйте **ExportGroup**. Для других свойств можно использовать значения по умолчанию. Нажмите кнопку **Создать**.

      ![указывание значений для хранилища](./media/resource-manager-export-template/provide-storage-values.png)

После завершения развертывания в подписке появится учетная запись хранения.

## Экспорт шаблона для развертывания

1. Перейдите в колонку новой группы ресурсов. Здесь будет указан результат последнего развертывания. Щелкните эту ссылку.

      ![колонка группы ресурсов](./media/resource-manager-export-template/resource-group-blade.png)

2. Отобразится журнал развертываний для группы. В вашем случае, скорее всего, будет отображаться только одно развертывание. Выберите его.

     ![последнее развертывание](./media/resource-manager-export-template/last-deployment.png)

3. После этого отобразится сводка по развертыванию. В сводке содержатся сведения о состоянии развертывания и операциях, а также значения, указанные для параметров. Чтобы увидеть шаблон, который использовался для развертывания, щелкните **Просмотреть шаблон**.

     ![просмотр сводки по развертыванию](./media/resource-manager-export-template/deployment-summary.png)

4. Resource Manager извлекает следующие пять файлов:

   - Шаблон, определяющий инфраструктуру решения. При создании учетной записи хранения на портале Resource Manager использовал шаблон, чтобы развернуть ее, и сохранил его для дальнейшего использования.

   - Файл параметров, который можно использовать для передачи значений во время развертывания. Он содержит значения, указанные при первом развертывании. Но любое из них можно изменить при повторном развертывании шаблона.

   - Файл сценария Azure PowerShell, который можно использовать для развертывания шаблона.

   - Файл скрипта интерфейса командной строки Azure, который можно использовать для развертывания шаблона.

   - Класс .NET, который можно использовать для развертывания шаблона.

     К файлам можно получить доступ, используя ссылки в колонке. По умолчанию выбран шаблон.

       ![просмотр шаблона](./media/resource-manager-export-template/view-template.png)

     Обратим на него особое внимание. Шаблон должен иметь примерно такой вид:

        {
          "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "parameters": {
            "name": {
              "type": "String"
            },
            "accountType": {
              "type": "String"
            },
            "location": {
              "type": "String"
            },
            "encryptionEnabled": {
              "defaultValue": false,
              "type": "Bool"
            }
          },
          "resources": [
            {
              "type": "Microsoft.Storage/storageAccounts",
              "sku": {
                "name": "[parameters('accountType')]"
              },
              "kind": "Storage",
              "name": "[parameters('name')]",
              "apiVersion": "2016-01-01",
              "location": "[parameters('location')]",
              "properties": {
                "encryption": {
                  "services": {
                    "blob": {
                      "enabled": "[parameters('encryptionEnabled')]"
                    }
                  },
                  "keySource": "Microsoft.Storage"
                }
              }
            }
          ]
        }

     Обратите внимание, что шаблон определяет параметры для имени, типа и расположения учетной записи хранения. Кроме того, параметр отвечает за шифрование данных, а также за использование значения по умолчанию **false**. В разделе **resources** содержится определение учетной записи хранения для развертывания.

В квадратные скобки заключено выражение, которое вычисляется при развертывании. Содержащиеся в шаблоне выражения в квадратных скобках используются для получения значений параметров при развертывании. Можно использовать разные выражения. Их примеры рассматриваются ниже. Полный список см. в статье [Функции шаблонов Azure Resource Manager](resource-group-template-functions.md).

Дополнительные сведения о структуре шаблона см. в статье [Создание шаблонов Azure Resource Manager](resource-group-authoring-templates.md).

## Добавление виртуальной сети

Шаблон, скачанный в предыдущем разделе, представляет инфраструктуру для исходного развертывания. Но он не отражает изменения, внесенные после развертывания. Чтобы продемонстрировать это, давайте изменим группу ресурсов, добавив виртуальную сеть на портале.

1. В колонке группы ресурсов щелкните **Добавить** и выберите **виртуальную сеть** из доступных ресурсов.

2. Присвойте виртуальной сети имя **VNET** и используйте значения по умолчанию для других свойств. Нажмите кнопку **Создать**.

      ![настройка оповещения](./media/resource-manager-export-template/create-vnet.png)

3. После успешного развертывания виртуальной сети в группе ресурсов проверьте журнал развертывания еще раз. Теперь там содержится два развертывания. Выберите последнее развертывание.

      ![журнал развертываний](./media/resource-manager-export-template/deployment-history.png)

4. Просмотрите шаблон для него. Обратите внимание, что он определяет только изменения, внесенные при добавлении виртуальной сети.

Обычно рекомендуется использовать шаблон, который развертывает всю инфраструктуру для решения за одно действие, вместо того чтобы запоминать разные шаблоны для развертывания.


## Экспорт шаблона для группы ресурсов

Хотя в каждом развертывании отображаются только изменения, внесенные в группу ресурсов, вы можете в любой момент экспортировать шаблон для отображения атрибутов всей группы ресурсов.

1. Чтобы просмотреть шаблон для группы ресурсов, щелкните **Экспортировать шаблон**.

      ![экспорт группы ресурсов](./media/resource-manager-export-template/export-resource-group.png)

2. Снова появятся пять файлов, которые можно использовать для повторного развертывания решения. Но в этот раз шаблон выглядит немного иначе. Этот шаблон содержит только два параметра: по одному для имени учетной записи хранения и имени виртуальной сети.

        "parameters": {
          "virtualNetworks_VNET_name": {
            "defaultValue": "VNET",
            "type": "String"
          },
          "storageAccounts_storagetf05092016_name": {
            "defaultValue": "storagetf05092016",
            "type": "String"
          }
        },

     Используемые при развертывания шаблоны не извлекались с помощью Resource Manager. Вместо этого был создан новый шаблон на основе текущей конфигурации ресурсов. Resource Manager не различает значения, которые нужно передать в качестве параметров, поэтому большинство значений жестко определяются на основе значения в группе ресурсов. Например, для расположения и репликации учетной записи хранения задаются следующие значения:

        "location": "northeurope",
        "tags": {},
        "properties": {
            "accountType": "Standard_RAGRS"
        },

3. Скачайте шаблон, чтобы с ним можно было работать локально.

      ![скачивание шаблона](./media/resource-manager-export-template/download-template.png)

4. Найдите загруженный ZIP-файл и извлеките его содержимое. Этот скачанный шаблон можно использовать для повторного развертывания инфраструктуры.

## Дальнейшие действия

Поздравляем! Вы узнали, как экспортировать шаблон из ресурсов, созданных на портале.

- Во второй части этого руководства вы настроите скачанный шаблон, добавив дополнительные параметры, и повторно развернете его с помощью скрипта. См. статью [Настройка экспортированного шаблона Resource Manager](resource-manager-customize-template.md).
- Чтобы узнать, как экспортировать шаблон с помощью PowerShell, см. статью [Использование Azure PowerShell с Azure Resource Manager](powershell-azure-resource-manager.md).
- Чтобы узнать, как экспортировать шаблон с помощью интерфейса командной строки Azure, см. статью [Использование Azure CLI для Mac, Linux и Windows с Azure Resource Manager](xplat-cli-azure-resource-manager.md).

<!---HONumber=AcomDC_0518_2016-->