<properties linkid="storage-use-azcopy" urlDisplayName="AzCopy" pageTitle="How to use AzCopy with Microsoft Azure Storage" metaKeywords="Get started Azure AzCopy   Azure unstructured data   Azure unstructured storage   Azure blob   Azure blob storage   Azure file   Azure file storage   Azure file share   AzCopy" description="Learn how to use the AzCopy utility to upload, download, and copy blob and file content." metaCanonical="" disqusComments="1" umbracoNaviHide="1" services="storage" documentationCenter="" title="How to use AzCopy with Microsoft Azure Storage" authors="tamram" manager="mbaldwin" editor="cgronlun" />

<tags ms.service="storage" ms.workload="storage" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="08/06/2014" ms.author="tamram"></tags>

# Приступая к работу со служебной программой командной строки AzCopy

AzCopy — это служебная программа командной строки, разработанная для высокопроизводительной отправки, загрузки и копирования данных из хранилища BLOB-объектов и файлов Azure, а также в него. В настоящем руководстве приводится обзор использования AzCopy.

> [WACOM.NOTE] Это руководство предполагает установку AzCopy 2.5 или более поздней версии. Обратите внимание, что AzCopy предлагается в предварительной версии. Таким образом, параметры командной строки и их функции могут быть изменены в будущих выпусках.

## Оглавление

-   [Загрузка и установка AzCopy][Загрузка и установка AzCopy]
-   [Сведения о синтаксисе командной строки AzCopy][Сведения о синтаксисе командной строки AzCopy]
-   [Ограничение одновременных операций записи при копировании данных][Ограничение одновременных операций записи при копировании данных]
-   [Копирование BLOB-объектов Azure с помощью AzCopy][Копирование BLOB-объектов Azure с помощью AzCopy]
-   [Копирование файлов в общую папку Azure с помощью AzCopy][Копирование файлов в общую папку Azure с помощью AzCopy]
-   [Версии AzCopy][Версии AzCopy]
-   [Дальнейшие действия][Дальнейшие действия]

## <span id="install"></span></a> Загрузка и установка AzCopy

1.  Загрузите [последнюю версию AzCopy][последнюю версию AzCopy].
2.  Запустите установку. По умолчанию при установке AzCopy создается папка с именем `AzCopy` в `%ProgramFiles(x86)%\Microsoft SDKs\Azure\` (на компьютере под управлением 64-разрядной версии Windows) или `%ProgramFiles%\Microsoft SDKs\Azure\` (на компьютере под управлением 32-разрядной версии Windows). Однако путь установки можно изменить в мастере установки.
3.  При необходимости можно добавить место установки AzCopy к системному пути.

## <span id="syntax"></span></a> Сведения о синтаксисе командной строки AzCopy

Далее откройте командное окон и перейдите к каталогу установки AzCopy на компьютере, где располагается исполняемый файл `AzCopy.exe`. В командах AzCopy используется следующий базовый синтаксис:

    AzCopy <source> <destination> [filepattern] [options]

-   Параметр `<source>` определяет исходные данные для копирования. Источником может быть каталог файловой системы, контейнер BLOB-объектов, виртуальный каталог BLOB-объектов или общая папка хранилища.

-   Параметр `<destination>` определяет место назначения для копирования. Местом назначения может быть каталог файловой системы, контейнер BLOB-объектов, виртуальный каталог BLOB-объектов или общая папка хранилища.

-   Поведение дополнительного параметра `filepattern` определяется местоположением исходных данных, а также наличием параметра «рекурсивный режим». Рекурсивный режим задается с помощью параметра `/S`.

    Если определенный источник представляет собой каталог в файловой системе, то используются стандартные подстановочные знаки, и предоставленный шаблон файла сравнивается с файлами в каталоге. При задании параметра `/S` AzCopy также выполняет сравнение определенного шаблона со всеми файлами в любых подпапках каталога.

    Если определенный источник представляет собой контейнер BLOB-объектов или виртуальный каталог, то подстановочные знаки не используются. Если задан параметр `/S`, то AzCopy интерпретирует заданный шаблон файла как префикс BLOB-объекта. Если параметр `/S` не задан, то AzCopy выполняет сопоставление шаблона файла с точными именами BLOB-объектов.

    В случае, когда указанным источником является общая папка Azure, необходимо либо задать точное имя файла (*например,* `abc.txt`), чтобы копировать единичный файл, либо задать параметр `/S` для копирования всех файлов в общей папке рекурсивно. Попытка одновременно задать шаблон файла и параметр `/S` приведет к ошибке.

    Если не задается шаблон файла, то по умолчанию используется шаблон файла `*.*` для каталога файловой системы или пустой префикс для BLOB-объектов Azure или ресурсов хранилища файлов.

    > [WACOM.NOTE] Вследствие проблем с производительностью AzCopy версии 2.5 больше не поддерживает несколько шаблонов файлов в одной команде. Теперь, чтоб выполнить сценарий с несколькими шаблонами файлов, необходимо ввести несколько команд, каждую с одним шаблоном файла.

-   В таблице ниже описываются доступные параметры параметра `options`. Можно также ввести `AzCopy /?` из командной строки для получения помощи при работе с параметрами.

| Имя параметра                    | Описание                                                                                                                                                                                                                                                                                                                                                                     | Применяется к хранилищу BLOB-объектов (да/нет) | Применяется к хранилищу файлов (да/нет) |
|----------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|-----------------------------------------|
| **/DestKey:\<storage-key\>**     | Задает ключ учетной записи хранения для ресурса в месте назначения.                                                                                                                                                                                                                                                                                                          | Да                                             | Да                                      |
| **/DestSAS:\<container-SAS\>**   | Задает подпись общего доступа (SAS) для контейнера назначения (если применяется). Поместите SAS в двойные кавычки, так как подпись может содержать специальные символы командной строки.                                                                                                                                                                                     
                                     Если с качестве ресурса в месте назначения используется BLOB-объект, можно либо задать этот параметр, а после него использовать маркер SAS, либо задать SAS как часть URI BLOB-объект назначения без использования данного параметра.                                                                                                                                        
                                     Этот параметр применяется только для хранилища BLOB-объектов и действителен только при отправке или копировании BLOB-объектов в пределах одной и той же учетной записи хранения.                                                                                                                                                                                             | Да                                             | Нет                                     |
| **/SourceKey:\<storage-key\>**   | Задает ключ учетной записи хранения для исходного ресурса.                                                                                                                                                                                                                                                                                                                   | Да                                             | Да                                      |
| **/SourceSAS:\<container-SAS\>** | Задает подпись общего доступа (SAS) для исходного контейнера (если применяется). Поместите SAS в двойные кавычки, так как подпись может содержать специальные символы командной строки.                                                                                                                                                                                      
                                     Если не предоставляется ни ключ, ни SAS, то контейнер будет считываться через анонимный доступ.                                                                                                                                                                                                                                                                              
                                     Этот параметр доступен только для хранилища BLOB-объектов.                                                                                                                                                                                                                                                                                                                   | Да                                             | Нет                                     |
| **/S**                           | Задает рекурсивный режим для операций копирования. В рекурсивном режиме AzCopy копирует все BLOB-объекты или файлы, соответствующие определенному шаблону файла, в том числе файлы из подпапок.                                                                                                                                                                              | Да                                             | Да                                      |
| **/BlobType:\<block | page\>**   | Определяет, является ли место назначения блочным или страничным BLOB-объектом. Этот параметр применяется только в том случае, когда местом назначения является BLOB-объект. В противном случае создается ошибка. Если в качестве места назначения выступает BLOB-объект и этот параметр не задается, то по умолчанию AzCopy предполагает, что необходим блочный BLOB-объект. | Да                                             | Нет                                     |
| **/CheckMd5**                    | Вычисляет хэш MD5 для загруженных данных и проверяет соответствие хэша MD5, сохраненного в BLOB-объекте, или свойства Content-MD5 файла вычисленному хэшу. Проверка MD5 выключена по умолчанию. Чтобы выполнить проверку MD5 при загрузке данных, необходимо задать этот параметр.                                                                                           
                                     Обратите внимание, что хранилище Azure не гарантирует актуальность хэша MD5, сохраненного для BLOB-объекта или файла. Клиент несет ответственность за обновление MD5 при каждом изменении BLOB-объекта или файла.                                                                                                                                                            
                                     AzCopy всегда задает свойство Content-MD5 для BLOB-объекта или файла Azure после отправки его в службу.                                                                                                                                                                                                                                                                      | Да                                             | Да                                      |
| **/Snapshot**                    | Указывает, передаются ли моментальные снимки. Это параметр действителен только, если в качестве источника используется BLOB-объект.                                                                                                                                                                                                                                          
                                     Переданные моментальные снимки BLOB-объекта переименовываются в следующем формате: [blob-name] (snapshot-time)[extension].                                                                                                                                                                                                                                                   
                                     По умолчанию моментальные снимки не копируются.                                                                                                                                                                                                                                                                                                                              | Да                                             | Нет                                     |
| **/V:[verbose log-file]**        | Выводит сообщения с подробным состоянием в файл журнала. По умолчанию файл журнала с подробными данными именуется как `AzCopyVerbose.log` в `%LocalAppData%\Microsoft\Azure\AzCopy`. При задании существующего местоположения файла для этого параметра журнал с подробными данными будет добавляться к этому файлу.                                                         | Да                                             | Да                                      |
| **/Z:[journal-file-folder]**     | Задает папку файла журнала для возобновления операции.                                                                                                                                                                                                                                                                                                                       
                                     AzCopy всегда поддерживает возобновление, если операция была прервана.                                                                                                                                                                                                                                                                                                       
                                     Если этот параметр не задается или задается без пути папки, AzCopy создаст файл журнала в следующем местоположении по умолчанию: `%LocalAppData%\Microsoft\Azure\AzCopy`.                                                                                                                                                                                                    
                                     При каждом вводе команды для AzCopy выполняется проверка на наличие файла журнала в папке по умолчанию или в папке, которая была задана с помощью данного параметра. Если в обоих местах файл журнала отсутствует, AzCopy воспринимает операцию как новую и создает новый файл журнала.                                                                                      
                                     Если файл журнала не существует, AzCopy проверяет, соответствует ли введенная командная строка командной строке в файле журнала. Если две командные строки совпадают, AzCopy возобновляет незавершенную операцию. Если они не совпадают, вам будет предложено либо переписать файл журнала, чтобы начать новую операцию, либо отменить текущую операцию.                     
                                     После успешного завершения операции файл журнала удаляется.                                                                                                                                                                                                                                                                                                                  
                                     Обратите внимание, что возобновление операции из файла журнала, созданного предыдущей версией AzCopy, не поддерживается.                                                                                                                                                                                                                                                     | Да                                             | Да                                      |
| **/@:response-file**             | Задает файл, который содержит параметры. AzCopy обрабатывает параметры в файле, как если бы они были заданы в командной строке.                                                                                                                                                                                                                                              
                                     В файле ответа можно либо задать несколько параметров в одной строке, либо задать каждый параметр в отдельной строке. Обратите внимание, что отдельный параметр не может занимать несколько строк.                                                                                                                                                                           
                                     Файлы ответов могут содержать строки комментариев, которые начинаются с символов `#`.                                                                                                                                                                                                                                                                                        
                                     Можно задать несколько файлов ответов. Однако, следует иметь в виду, что AzCopy не поддерживает вложенных фалов ответов.                                                                                                                                                                                                                                                     | Да                                             | Да                                      |
| **/Y**                           | Скрывает все запросы на подтверждение AzCopy.                                                                                                                                                                                                                                                                                                                                | Да                                             | Да                                      |
| **/L**                           | Задает только операцию перечисления, данные не копируются.                                                                                                                                                                                                                                                                                                                   | Да                                             | Да                                      |
| **/MT**                          | Задает такое же время последнего изменения загруженного файла, как в исходном BLOB-объекте или файле.                                                                                                                                                                                                                                                                        | Да                                             | Да                                      |
| **/XN**                          | Исключает более новый исходный ресурс. Ресурс не будет копироваться, если источник новее, чем место назначения.                                                                                                                                                                                                                                                              | Да                                             | Да                                      |
| **/XO**                          | Исключает более старый исходный ресурс. Ресурс не будет копироваться, если источник старее, чем место назначения.                                                                                                                                                                                                                                                            | Да                                             | Да                                      |
| **/A**                           | Отправляет только файлы с установленным атрибутом «Архивный».                                                                                                                                                                                                                                                                                                                | Да                                             | Да                                      |
| **/IA:[RASHCNETOI]**             | Отправляет только файлы с любым из следующих установленных атрибутов.                                                                                                                                                                                                                                                                                                        
                                     Доступные атрибуты:                                                                                                                                                                                                                                                                                                                                                          
                                     R   файлы только для чтения                                                                                                                                                                                                                                                                                                                                                  
                                     A   файлы, готовые к архивированию                                                                                                                                                                                                                                                                                                                                           
                                     S   системные файлы                                                                                                                                                                                                                                                                                                                                                          
                                     H   скрытые файлы                                                                                                                                                                                                                                                                                                                                                            
                                     C   сжатые файлы                                                                                                                                                                                                                                                                                                                                                             
                                     N   обычные файлы                                                                                                                                                                                                                                                                                                                                                            
                                     E   зашифрованные файлы                                                                                                                                                                                                                                                                                                                                                      
                                     T   временные файлы                                                                                                                                                                                                                                                                                                                                                          
                                     O   автономные файлы                                                                                                                                                                                                                                                                                                                                                         
                                     I   неиндексированные файлы                                                                                                                                                                                                                                                                                                                                                  | Да                                             | Да                                      |
| **/XA:[RASHCNETOI]**             | Исключает файлы с любым из следующих установленных атрибутов.                                                                                                                                                                                                                                                                                                                
                                     Доступные атрибуты:                                                                                                                                                                                                                                                                                                                                                          
                                     R   файлы только для чтения                                                                                                                                                                                                                                                                                                                                                  
                                     A   файлы, готовые к архивированию                                                                                                                                                                                                                                                                                                                                           
                                     S   системные файлы                                                                                                                                                                                                                                                                                                                                                          
                                     H   скрытые файлы                                                                                                                                                                                                                                                                                                                                                            
                                     C   сжатые файлы                                                                                                                                                                                                                                                                                                                                                             
                                     N   обычные файлы                                                                                                                                                                                                                                                                                                                                                            
                                     E   зашифрованные файлы                                                                                                                                                                                                                                                                                                                                                      
                                     T   временные файлы                                                                                                                                                                                                                                                                                                                                                          
                                     O   автономные файлы                                                                                                                                                                                                                                                                                                                                                         
                                     I   неиндексированные файлы                                                                                                                                                                                                                                                                                                                                                  | Да                                             | Да                                      |
| **/Delimiter:\<delimiter\>**     | Указывает разделитель, используемый для разделения виртуальных каталогов в имени BLOB-объекта.                                                                                                                                                                                                                                                                               
                                     По умолчанию AzCopy использует / как разделитель. Однако, AzCopy поддерживает любой общий символ (например, @, \# или %) в качестве разделителя. Если необходимо ввести любой из этих специальных символов в командную строку следует заключить имя файла в двойные кавычки.                                                                                                 
                                     Этот параметр применяется только для загрузки BLOB-объектов.                                                                                                                                                                                                                                                                                                                 | Да                                             | Нет                                     |
| **/NC**                          | Задает количество одновременных операций.                                                                                                                                                                                                                                                                                                                                    
                                     По умолчанию это число в 8 раз превышает количество ядер процессоров, которое вы используете. Таким образом, если в компьютере 8 ядер, по умолчанию AzCopy начинает 64 одновременных операции.                                                                                                                                                                               
                                     Обратите внимание, что большое количество одновременных операция в среде с низкой пропускной способностью может переполнить сетевое подключение и помешать полному завершению операций. Регулируйте количество одновременных операций в зависимости от фактической доступной пропускной способности сети.                                                                    | Да                                             | Да                                      |
| **/SourceType:Blob**             | Определяет, что ресурс `source` представляет собой BLOB-объект, доступный в локальной среде разработки, в которой запущен эмулятор хранилища.                                                                                                                                                                                                                                | Да                                             | Нет                                     |
| **/DestType:Blob**               | Определяет, что ресурс `destination` представляет собой BLOB-объект, доступный в локальной среде разработки, в которой запущен эмулятор хранилища.                                                                                                                                                                                                                           | Да                                             | Нет                                     |

## <span id="limit-writes"></span></a> Ограничение одновременных операций записи при копировании данных

При копировании BLOB-объектов или файлов с помощью AzCopy следует иметь в виду, что другое приложение может изменять данные в то время, когда они копируются. Если это возможно, обеспечьте, чтобы во время операции копирования не происходило изменение копируемых данных. Например, при копировании VHD, связанного с виртуальной машиной Azure, убедитесь в том, что никакое другое приложение в это время не записывает данные на VHD. В качестве альтернативы можно сначала создать моментальный снимок VHD, а затем скопировать его.

Если не удается предотвратить запись в BLOB-объекты или файлы во время их копирования со стороны других приложений, следует иметь в виду, что к моменту завершения задания скопированные ресурсы могут больше не иметь полного соответствия с исходными ресурсами.

## <span id="copy-blobs"></span></a> Копирование BLOB-объектов Azure с помощью AzCopy

В приведенных ниже примерах рассматриваются различные сценарии копирования BLOB-объектов с помощью AzCopy.

### Копирование одного BLOB-объекта

**Отправка файла из файловой системы в хранилище BLOB-объектов:**

    AzCopy C:\myfolder https://myaccount.blob.core.windows.net/mycontainer /destkey:key abc.txt

**Загрузка BLOB-объекта из хранилища BLOB-объектов в файловую систему:**

    AzCopy https://myaccount.blob.core.windows.net/mycontainer C:\myfolder /sourcekey:key abc.txt

### Копирование BLOB-объекта через копирование на стороне сервера

При копировании BLOB-объекта в пределах учетной записи хранения или между разными учетными записями хранения выполняется операция копирования на стороне сервера. Для получения дополнительной информации об операциях копирования на стороне сервера см. [Сведения об асинхронных операциях копирования BLOB-объектов между различными учетными записями][Сведения об асинхронных операциях копирования BLOB-объектов между различными учетными записями].

**Копирование BLOB-объекта в пределах учетной записи хранения:**

    AzCopy https://myaccount.blob.core.windows.net/mycontainer/mycontainer1 https://myaccount.blob.core.windows.net/mycontainer2 /sourcekey:key /destkey:key abc.txt 

**Копирование BLOB-объектов между различными учетными записями хранения:**

    AzCopy https://sourceaccount.blob.core.windows.net/mycontainer/mycontainer1 https://destaccount.blob.core.windows.net/mycontainer2 /sourcekey:key1 /destkey:key2 abc.txt

### Копирование BLOB-объекта из вторичного региона

Если учетная запись хранения имеет включенное геоизбыточное хранилище для доступа с правом чтения, можно копировать данные из вторичного региона.

**Копирование BLOB-объекта из первичной учетной записи во вторичную:**

    AzCopy https://myaccount1-secondary.blob.core.windows.net/mynewcontainer1 https://myaccount2.blob.core.windows.net/mynewcontainer2 /sourcekey:key1 /destkey:key2 abc.txt

**Загрузка BLOB-объекта во вторичной учетной записи в файл в файловой системе:**

    AzCopy https://myaccount-secondary.blob.core.windows.net/mynewcontainer C:\myfolder /sourcekey:key abc.txt

### Отправка файла в новый контейнер BLOB-объектов или виртуальный каталог

**Отправка файла в новый контейнер BLOB-объектов**

    AzCopy C:\myfolder https://myaccount.blob.core.windows.net/mynewcontainer /destkey:key abc.txt

Обратите внимание, что если указанный контейнер назначения не существует, AzCopy создаст его и загрузит в него файл.

**Отправка файла в новый виртуальный каталог BLOB-объектов**

    AzCopy C:\myfolder https://myaccount.blob.core.windows.net/mycontainer/vd /destkey:key abc.txt

Обратите внимание, что если указанный виртуальный каталог не существует, AzCopy отправит файл, чтобы включить его в виртуальный каталог от своего имени (*например,*, `vd/abc.txt` в указанном выше примере).

### Загрузка BLOB-объекта в новую папку

    AzCopy https://myaccount.blob.core.windows.net/mycontainer C:\myfolder /sourcekey:key abc.txt

Если папка `C:\myfolder` еще не существует, AzCopy создаст ее в файловой системе и загрузит `abc.txt` в новую папку.

### Рекурсивная отправка файлов и подпапок каталога в контейнер

    AzCopy C:\myfolder https://myaccount.blob.core.windows.net/mycontainer /destkey:key /S

При задании параметра `/S` происходит копирование контента определенного каталога в хранилище BLOB-объектов рекурсивно, что означает также копирование всех подпапок и их файлов. Например, предположим, что следующие файлы размещены в папке `C:\myfolder`:

    C:\myfolder\abc.txt
    C:\myfolder\abc1.txt
    C:\myfolder\abc2.txt
    C:\myfolder\subfolder\a.txt
    C:\myfolder\subfolder\abcd.txt

После операции копирования в контейнер будут помещены следующие файлы:

    abc.txt
    abc1.txt
    abc2.txt
    subfolder\a.txt
    subfolder\abcd.txt

### Нерекурсивная отправка файлов из каталога в контейнер

    AzCopy C:\myfolder https://myaccount.blob.core.windows.net/mycontainer /destkey:key

Если параметр `/S` не задается в командной строке, AzCopy не будет выполнять рекурсивное копирование. Копируются только файлы в указанном каталоге. Никакие подпапки и их файлы НЕ копируются. Например, предположим, что следующие файлы размещены в папке `C:\myfolder`:

    C:\myfolder\abc.txt
    C:\myfolder\abc1.txt
    C:\myfolder\abc2.txt
    C:\myfolder\subfolder\a.txt
    C:\myfolder\subfolder\abcd.txt

После операции копирования в контейнер будут помещены следующие файлы:

    abc.txt
    abc1.txt
    abc2.txt

### Рекурсивная загрузка всех BLOB-объектов контейнера в каталог файловой системы

    AzCopy https://myaccount.blob.core.windows.net/mycontainer C:\myfolder /sourcekey:key /S

Предположим, что в указанном контейнере находятся следующие BLOB-объекты:

    abc.txt
    abc1.txt
    abc2.txt
    vd1\a.txt
    vd1\abcd.txt

После операции копирования в каталог `C:\myfolder` будут помещены следующие файлы:

    C:\myfolder\abc.txt
    C:\myfolder\abc1.txt
    C:\myfolder\abc2.txt
    C:\myfolder\vd1\a.txt
    C:\myfolder\vd1\abcd.txt

### Рекурсивная загрузка всех BLOB-объектов виртуального каталога BLOB-объектов в файловую систему

    AzCopy https://myaccount.blob.core.windows.net/mycontainer/vd1/ C:\myfolder /sourcekey:key /S

Предположим, что в указанном контейнере находятся следующие BLOB-объекты:

    abc.txt
    abc1.txt
    abc2.txt
    vd1\a.txt
    vd1\abcd.txt

После операции копирования в каталог `C:\myfolder` будут помещены следующие файлы: Обратите внимание, что копируются только BLOB-объекты в виртуальном каталоге:

    C:\myfolder\a.txt
    C:\myfolder\abcd.txt

### Рекурсивная отправка файлов, соответствующих определенному шаблону файла, в контейнер

    AzCopy C:\myfolder https://myaccount.blob.core.windows.net/mycontainer /destkey:key a* /S

Предположим, что следующие файлы размещены в папке `C:\myfolder`:

    C:\myfolder\abc.txt
    C:\myfolder\abc1.txt
    C:\myfolder\abc2.txt
    C:\myfolder\xyz.txt
    C:\myfolder\subfolder\a.txt
    C:\myfolder\subfolder\abcd.txt

После операции копирования в контейнер будут помещены следующие файлы:

    abc.txt
    abc1.txt
    abc2.txt
    subfolder\a.txt
    subfolder\abcd.txt

### Рекурсивная загрузка BLOB-объектов с заданным префиксом в файловую систему

    AzCopy https://myaccount.blob.core.windows.net/mycontainer C:\myfolder /sourcekey:key a /S

Предположим, что в указанном контейнере находятся следующие BLOB-объекты: Все BLOB-объекты, начинающиеся с префикса `a`, будут копированы:

    abc.txt
    abc1.txt
    abc2.txt
    xyz.txt
    vd1\a.txt
    vd1\abcd.txt

После операции копирования в папку `C:\myfolder` будут помещены следующие файлы:

    C:\myfolder\abc.txt
    C:\myfolder\abc1.txt
    C:\myfolder\abc2.txt

Обратите внимание, что префикс применяется к виртуальному каталогу, который формирует первую часть имени BLOB-объекта. В указанном выше примере виртуальный каталог не соответствует заданному префиксу и не копируется.

### Копирование BLOB-объекта и его моментальных снимков на другую учетную запись хранения

    AzCopy https://sourceaccount.blob.core.windows.net/mycontainer/mycontainer1 https://destaccount.blob.core.windows.net/mycontainer2 /sourcekey:key1 /destkey:key2 abc.txt /snapshot

После выполнения копирования целевой контейнер будет содержать BLOB-объект и его моментальные снимки. Предположим, что в BLOB-объект в приведенном выше примере имеет два моментальных снимка, тогда контейнер будет содержать следующий BLOB-объект и моментальные снимки:

    abc.txt
    abc (2013-02-25 080757).txt
    abc (2014-02-21 150331).txt

### Использование файла ответа для задания параметров командной строки

    AzCopy /@:"C:\myfolder\abc.txt"

В файл ответа можно включить параметры командной строки AzCopy. AzCopy обрабатывает параметры в файле, как если бы он были заданы в командной строке, выполняя прямую замену содержимого файла.

**Задание одного или нескольких однострочных файлов ответа**

Предположим, что у нас имеется файл ответа с именем `source.txt`, который указывает исходный контейнер:

    http://myaccount.blob.core.windows.net/mycontainer

И файл ответа с именем `dest.txt`, который указывает папку назначения в файловой системе:

    C:\myfolder

В также файл ответа с именем `options.txt`, определяющий параметры для AzCopy:

    /S /Y

Чтобы вызвать AzCopy с этими файлами ответов, размещенными в каталоге `C:\responsefiles`, используйте команду:

    AzCopy /@:"C:\responsefiles\source.txt" /@:"C:\responsefiles\dest.txt" /sourcekey:[sourcekey] /@:"C:\responsefiles\options.txt"   

AzCopy обрабатывает эту команду, как если бы все индивидуальные параметры были включены в командную строку:

    AzCopy http://myaccount.blob.core.windows.net/mycontainer C:\myfolder /sourcekey:[sourcekey] /S /Y

**Задание многострочного файла ответа**

Предположим у нас имеется файл ответа с именем `copyoperation.txt`, содержащий следующие строки: Каждый параметр AzCopy задается на своей собственной строке:

    http://myaccount.blob.core.windows.net/mycontainer
    C:\myfolder
    /sourcekey:[sourcekey]
    /S 
    /Y

Чтобы вызвать AzCopy с этими файлами ответов, используйте команду:

    AzCopy /@:"C:\responsefiles\copyoperation.txt"

AzCopy обрабатывает эту команду, как если бы все индивидуальные параметры были включены в командную строку:

    AzCopy http://myaccount.blob.core.windows.net/mycontainer C:\myfolder /sourcekey:[sourcekey] /S /Y

Обратите внимание, что каждый параметр AzCopy должен быть полностью задан на одной строке. Например, при выполнении AzCopy возникнет ошибка, если разделить параметр на две строки, как показано здесь для параметра `/sourcekey`:

    http://myaccount.blob.core.windows.net/mycontainer
    C:\myfolder
    /sourcekey:
    [sourcekey]
    /S 
    /Y

### Указание подписи общего доступа (SAS)

**Указание SAS для исходного контейнера с помощью параметра /sourceSAS**

    AzCopy https://myaccount.blob.core.windows.net/mycontainer1 C:\myfolder /sourceSAS:SAS /S

**Указание SAS для исходного контейнера в URI исходного контейнера**

    AzCopy https://myaccount.blob.core.windows.net/mycontainer1/?SourceSASToken C:\myfolder /S

**Указание SAS для контейнера назначения с помощью параметра /destSAS**

    AzCopy C:\myfolder https://myaccount.blob.core.windows.net/mycontainer1 /destSAS:SAS abc.txt

**Указание SAS для исходного контейнера и контейнера назначения**

    AzCopy https://myaccount.blob.core.windows.net/mycontainer1 https://myaccount.blob.core.windows.net/mycontainer2 /sourceSAS:SAS1 /destSAS:SAS2 abc.txt

### Указание папки файла журнала

При каждом вводе команды для AzCopy выполняется проверка на наличие файла журнала в папке по умолчанию или в папке, которая была задана с помощью данного параметра. Если в обоих местах файл журнала отсутствует, AzCopy воспринимает операцию как новую и создает новый файл журнала.

Если файл журнала не существует, AzCopy проверяет, соответствует ли введенная командная строка командной строке в файле журнала. Если две командные строки совпадают, AzCopy возобновляет незавершенную операцию. Если они не совпадают, вам будет предложено либо переписать файл журнала, чтобы начать новую операцию, либо отменить текущую операцию.

**Использование местоположения по умолчанию для файла журнала**

    AzCopy C:\myfolder https://myaccount.blob.core.windows.net/mycontainer /destkey:key /Z

Если опустить параметр `/Z` или задать параметр `/Z` без пути папки, как указано выше, AzCopy создает файл журнала в местоположении по умолчанию: `%SystemDrive%\Users\%username%\AppData\Local\Microsoft\Azure\AzCopy`. Если файл журнала уже существует, то AzCopy возобновляет операцию на основе файла журнала.

**Задание настраиваемого местоположения для файла журнала**

    AzCopy C:\myfolder https://myaccount.blob.core.windows.net/mycontainer /destkey:key /Z:C:\journalfolder\

В этом примере создается файл журнала, если он еще не существует. Если такой файл существует, то AzCopy возобновляет операцию на основе файла журнала.

**Возобновление операции AzCopy**

    AzCopy /Z:C:\journalfolder\

В этом примере возобновляется последняя операция, при завершении которой произошел сбой.

### Создание файла журнала

**Запись в файл журнала с подробными данными в местоположении по умолчанию**

    AzCopy C:\myfolder https://myaccount.blob.core.windows.net/mycontainer /destkey:key /V

Если задать параметр `/V` без указания пути файла в журнал с подробными данными, AzCopy создает файл журнала в местоположении по умолчанию: `%SystemDrive%\Users\%username%\AppData\Local\Microsoft\Azure\AzCopy`.

**Запись в файл журнала с подробными данными в настраиваемом местоположении**

    AzCopy C:\myfolder https://myaccount.blob.core.windows.net/mycontainer /destkey:key /V:C:\myfolder\azcopy1.log

Обратите внимание, что если задать относительный путь после параметра `/V`, например, `/V:test/azcopy1.log`, то журнал с подробными данными создается в текущем рабочем каталоге в подпапке с именем `test`.

### Установка такого же времени последнего изменения загруженных файлов, как в исходных BLOB-объектах

    AzCopy https://myaccount.blob.core.windows.net/mycontainer C:\myfolder /sourcekey:key /MT

### Исключение BLOB-объектов из операции копирования на основании времени их последнего изменения

Задайте параметр `/MT`, чтобы сравнить время последнего изменения исходного BLOB-объекта и файла назначения.

**Исключение более новых BLOB-объектов, чем файл назначения**

    AzCopy https://myaccount.blob.core.windows.net/mycontainer C:\myfolder /sourcekey:key /MT /XN

**Исключение более старых BLOB-объектов, чем файл назначения**

    AzCopy https://myaccount.blob.core.windows.net/mycontainer C:\myfolder /sourcekey:key /MT /XO

### Задание количества одновременных операций для запуска

Параметр `/NC` задает количество одновременных операций копирования. По умолчанию AzCopy начинает одновременные операции в количестве, в восемь раз превышающем имеющееся количество ядер процессоров. При выполнении AzCopy в сети с низкой пропускной способностью можно задать меньшее количество для этого параметра, чтобы избежать сбоев, вызванных конкуренцией за ресурсы.

### Запуск AzCopy с использованием ресурсов BLOB-объектов в эмуляторе хранилища

    AzCopy https://127.0.0.1:10004/myaccount/myfileshare/ C:\myfolder /SourceKey:key /SourceType:Blob /S

## <span id="copy-files"></span></a> Копирование файлов в общую папку Azure с помощью AzCopy

В приведенных ниже примерах рассматриваются различные сценарии копирования файлов Azure с помощью AzCopy.

### Загрузка файла из общей папки Azure в файловую систему

    AzCopy https://myaccount.file.core.windows.net/myfileshare/myfolder1/ C:\myfolder /SourceKey:key abc.txt

В случае, когда указанным источником является общая папка Azure, необходимо либо задать точное имя файла (*например,* `abc.txt`), чтобы копировать единичный файл, либо задать параметр `/S` для копирования всех файлов в общей папке рекурсивно. Попытка одновременно задать шаблон файла и параметр `/S` приведет к ошибке.

### Рекурсивная загрузка файлов и папок общей папки Azure в файловую систему

    AzCopy https://myaccount.file.core.windows.net/myfileshare/ C:\myfolder /SourceKey:key /S

Обратите внимание, что пустые папки не копируются.

### Рекурсивная отправка файлов и папок из файловой системы в общую папку Azure

    AzCopy C:\myfolder https://myaccount.file.core.windows.net/myfileshare/ /DestKey:key /S

Обратите внимание, что пустые папки не копируются.

### Рекурсивная отправка файлов, соответствующих определенному шаблону файла, в общую папку Azure

    AzCopy C:\myfolder https://myaccount.file.core.windows.net/myfileshare/ /DestKey:key ab* /S

## <span id="versions"></span></a> Версии AzCopy

| Версия     | Новые возможности                                                                                                                                                                  |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **V2.5.0** | **Текущая версия. Оптимизирует производительность при крупномасштабных сценариях копирования, а также реализует несколько важных улучшений для повышения удобства использования.** |
| V2.4.1     | Поддерживает указание папки назначения в мастере установки.                                                                                                                        |
| V2.4.0     | Поддерживает отправку и загрузку файлов для хранилища файлов Azure.                                                                                                                |
| V2.3.0     | Поддерживает геоизбыточные учетные записи хранения для доступа с правом чтения.                                                                                                    |
| V2.2.2     | Обновлена для использования библиотеки клиента хранилища Azure версии 3.0.3.                                                                                                       |
| V2.2.1     | Устранение проблем с производительностью при копировании большого количества файлов в пределах одной учетной записи хранения.                                                      |
| V2.2       | Поддерживает задание разделителя виртуального каталога для имен BLOB-объектов. Поддерживает задание пути файла журнала.                                                            |
| V2.1       | Предоставляет более 20 параметров для выполнения эффективных операций отправки, загрузки и копирования BLOB-объектов.                                                              |

## <span id="next-steps"></span></a>Дальнейшие действия

Для получения дополнительной информации о хранилище Azure и AzCopy см. следующие ресурсы.

### Документация по хранилищу Azure:

-   [Введение в хранилище Azure][Введение в хранилище Azure]
-   [Хранение файлов в хранилище BLOB-объектов][Хранение файлов в хранилище BLOB-объектов]
-   [Создание общей папки SMB в Azure с помощью хранилища файлов][Создание общей папки SMB в Azure с помощью хранилища файлов]

### Записи блога по хранилищу Azure:

-   [Введение в службы файлов Microsoft Azure][Введение в службы файлов Microsoft Azure]
-   [AzCopy 2.5: оптимизированные сценарии для крупномасштабного копирования][AzCopy 2.5: оптимизированные сценарии для крупномасштабного копирования]
-   [AzCopy: поддержка геоизбыточного хранилища для доступа с правом чтения][AzCopy: поддержка геоизбыточного хранилища для доступа с правом чтения]
-   [AzCopy: передача данных с использованием перезапускаемого режима и маркера SAS][AzCopy: передача данных с использованием перезапускаемого режима и маркера SAS]
-   [AzCopy: использование копирования BLOB-объектов между разными учетными записями][AzCopy: использование копирования BLOB-объектов между разными учетными записями]
-   [AzCopy: отправка/ загрузка файлов для BLOB-объектов Windows Azure][AzCopy: отправка/ загрузка файлов для BLOB-объектов Windows Azure]

  [Загрузка и установка AzCopy]: #install
  [Сведения о синтаксисе командной строки AzCopy]: #syntax
  [Ограничение одновременных операций записи при копировании данных]: #limit-writes
  [Копирование BLOB-объектов Azure с помощью AzCopy]: #copy-blobs
  [Копирование файлов в общую папку Azure с помощью AzCopy]: #copy-files
  [Версии AzCopy]: #versions
  [Дальнейшие действия]: #next-steps
  [последнюю версию AzCopy]: http://aka.ms/downloadazcopy
  [Сведения об асинхронных операциях копирования BLOB-объектов между различными учетными записями]: http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/introducing-asynchronous-cross-account-copy-blob.aspx
  [Введение в хранилище Azure]: http://azure.microsoft.com/ru-ru/documentation/articles/storage-introduction/
  [Хранение файлов в хранилище BLOB-объектов]: http://azure.microsoft.com/ru-ru/documentation/articles/storage-dotnet-how-to-use-blobs/
  [Создание общей папки SMB в Azure с помощью хранилища файлов]: http://azure.microsoft.com/ru-ru/documentation/articles/storage-dotnet-how-to-use-files/
  [Введение в службы файлов Microsoft Azure]: http://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/12/introducing-microsoft-azure-file-service.aspx
  [AzCopy 2.5: оптимизированные сценарии для крупномасштабного копирования]: http://go.microsoft.com/fwlink/?LinkId=507682
  [AzCopy: поддержка геоизбыточного хранилища для доступа с правом чтения]: http://blogs.msdn.com/b/windowsazurestorage/archive/2014/04/07/azcopy-support-for-read-access-geo-redundant-account.aspx
  [AzCopy: передача данных с использованием перезапускаемого режима и маркера SAS]: http://blogs.msdn.com/b/windowsazurestorage/archive/2013/09/07/azcopy-transfer-data-with-re-startable-mode-and-sas-token.aspx
  [AzCopy: использование копирования BLOB-объектов между разными учетными записями]: http://blogs.msdn.com/b/windowsazurestorage/archive/2013/04/01/azcopy-using-cross-account-copy-blob.aspx
  [AzCopy: отправка/ загрузка файлов для BLOB-объектов Windows Azure]: http://blogs.msdn.com/b/windowsazurestorage/archive/2012/12/03/azcopy-uploading-downloading-files-for-windows-azure-blobs.aspx
