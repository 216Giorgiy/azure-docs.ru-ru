<properties 
	pageTitle="Отладка приложения API в службе приложений Azure" 
	description="Узнайте, как отлаживать приложение API, когда оно выполняется в службе приложений Azure, с помощью Visual Studio." 
	services="app-service\api" 
	documentationCenter=".net" 
	authors="bradygaster" 
	manager="wpickett" 
	editor="jimbe"/>

<tags 
	ms.service="app-service-api" 
	ms.workload="web" 
	ms.tgt_pltfrm="dotnet" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="07/08/2015" 
	ms.author="bradyg;tarcher"/>

# Отладка приложения API в службе приложений Azure

## Обзор

В этом учебнике вы узнаете, как выполнить отладку кода веб-API ASP.NET, который настроен для запуска в [приложении API](app-service-api-apps-why-best-platform.md) в [службе приложений Azure](../app-service/app-service-value-prop-what-is.md). Вам предстоит выполнить отладку локально и удаленно (во время выполнения в Azure). Учебник работает с приложением API, которое вы [создавали](app-service-dotnet-create-api-app.md) и [развертывали](app-service-dotnet-deploy-api-app.md) при изучении предыдущих учебников этой серии.

## Удаленная отладка приложения API 

Следующие шаги позволяют выполнить отладку приложения API при запуске в облаке, используя пользовательский интерфейс Swagger в качестве тестового клиента.

1. В **обозревателе решений** Visual Studio щелкните правой кнопкой мыши проект, который [был развернут в предыдущем учебнике](app-service-dotnet-deploy-api-app.md), и выберите **Опубликовать**.

	![Опубликовать проект](./media/app-service-api-dotnet-debug/rd-publish.png)

2. В диалоговом окне **Публикация веб-сайта** выберите вкладку «Параметры» и убедитесь, что выбрана конфигурация сборки **Отладка**. Закончив, щелкните **Опубликовать** для отправки изменений в подписку Azure.

	![Опубликовать проект](./media/app-service-api-dotnet-debug/rd-debug-publish.png)

3. Откроется окно браузера с сообщением, подтверждающим успешное создание приложения API.

4. В адресной строке браузера добавьте /swagger в конец URL-адреса и нажмите клавишу &lt;ВВОД>. После этого отобразится клиент пользовательского интерфейса Swagger.

	![Пользовательский интерфейс Swagger](./media/app-service-api-dotnet-debug/rd-swagger-ui.png)

5. Вернитесь в Visual Studio и выберите в меню **Просмотр** **Обозреватель сервера**.

6. В **обозревателе сервера** разверните узел **Azure > Служба приложений**.

7. Найдите группу ресурсов, созданную при развертывании приложения API.

8. В этой группе ресурсов щелкните правой кнопкой мыши узел вашего приложения API и выберите пункт **Подключить отладчик**.

	![Подключение отладчика](./media/app-service-api-dotnet-debug/rd-attach-debugger.png)

	Удаленный отладчик попытается подключиться. В некоторых случаях может потребоваться повторно щелкнуть пункт **Подключить отладчик**, чтобы установить подключение, поэтому при сбое повторите попытку.

	![Подключение отладчика](./media/app-service-api-dotnet-debug/rd-attaching.png)

9. После установки подключения откройте файл **ContactsController.cs** в проекте приложения API и добавьте точки останова в методах `Get` и `Post`. Сначала они могут не отображаться как активные, но, если удаленный отладчик подключен, вы можете начать отладку.

	![Применение точек останова к контроллеру](./media/app-service-api-dotnet-debug/rd-breakpoints.png)

10. Вернитесь в сеанс браузера, щелкните команду **Get** для отображения схемы объекта *Контакт*, а затем нажмите кнопку **Попробовать**. Если задать точку останова в методе контроллера **Get**, Visual Studio остановит выполнение программы, и вы сможете отладить логику вашего контроллера.

	![Попробовать](./media/app-service-api-dotnet-debug/rd-try-it-out.png)

## Локальная отладка приложения API 

Иногда необходимо отладить приложение API локально. Например, чтобы избежать потенциально медленных обменов данными во время циклов тестирования и отладки. Следующие шаги демонстрируют способ локальной отладки приложения API с помощью пользовательского интерфейса Swagger в качестве тестового клиента.

1. В Visual Studio откройте файл *web.config* проекта приложения API. 
 
2. В браузере перейдите на [портал предварительной версии Azure](https://portal.azure.com).

3. Нажмите кнопку **Обзор** на боковой панели и выберите **Приложения API**.

	![Просмотр параметров на портале Azure](./media/app-service-api-dotnet-debug/ld-browse.png)

4. В списке приложений API в подписке выберите созданное приложение API.

	![Список приложений API](./media/app-service-api-dotnet-debug/ld-api-app-list.png)

5. В колонке приложения API щелкните **Узел приложения API**.

	![Узел приложения API](./media/app-service-api-dotnet-debug/ld-api-app-blade-api-app-host.png)

6. В колонке узла приложения API щелкните **Все параметры**.

	![«Все параметры» в колонке «Узел приложения API»](./media/app-service-api-dotnet-debug/ld-api-app-host-all-settings.png)

7. В колонке **Параметры** щелкните раздел **Параметры приложения**.

	![Раздел «Параметры приложения» в колонке «Узел приложения API»](./media/app-service-api-dotnet-debug/ld-application-settings.png)

8. В колонке **Параметры веб-приложения** прокрутите вниз до раздела **Параметры приложения**.

	![Раздел «Параметры приложения» в колонке «Узел приложения API» для локальной отладки](./media/app-service-api-dotnet-debug/ld-app-settings-for-local-debugging.png)

9. В разделе **Параметры приложения** найдите каждое из следующих значений и добавьте их в раздел **appSettings** файла *web.config*:
	- **EMA\_MicroserviceId**;
	- **EMA\_Secret**;
	- **EMA\_RuntimeUrl**.

	По завершении раздел **appSettings** файла *web.config* должен напоминать следующий снимок экрана.

	![Раздел «Параметры приложения» в колонке «Узел приложения API» для локальной отладки](./media/app-service-api-dotnet-debug/ld-debug-settings.png)

	**Примечание.** В значениях *EMA\_*, добавленных в файл *web.config* в этом разделе, содержится конфиденциальная информация об авторизации. Поэтому мы советует осторожно фиксировать этот файл в общедоступной среде управления источниками (такими как *github*), так как эти секретные данные станут открытыми для других пользователей. Дополнительную информацию см. в статье [Рекомендации для развертывания паролей и других конфиденциальных данных в ASP.NET и в службе приложений Azure](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).

10. Поместите одну или несколько точек останова в код контроллера приложения API (в методах `Get` и `Post`).

	![Установка точек останова](./media/app-service-api-dotnet-debug/ld-breakpoints.png)

11. Нажмите клавишу F5, чтобы запустить сеанс отладки Visual Studio.
 
13.  Если задан уровень доступа приложения API **Общедоступный (анонимно)**, можно воспользоваться страницей пользовательского интерфейса Swagger для тестирования.

	* Когда браузер загрузит страницу, отобразится сообщение об ошибке. Добавьте значение */swagger* в конец URL-адреса в адресной строке браузера и нажмите клавишу ВВОД.

	* После загрузки пользовательского интерфейса Swagger щелкните команду **Get** в окне браузера, чтобы отобразить схему для объекта «Контакт», а затем щелкните **Попробовать**.

		Visual Studio остановит выполнение программы в соответствии с ранее назначенными точками останова, и вы сможете произвести отладку логики вашего контроллера.

		![Попробовать](./media/app-service-api-dotnet-debug/ld-try-it-out.png)

14.	Если задан уровень доступа приложения API **Общедоступный (с проверкой подлинности)**, необходимо выполнить проверку подлинности и воспользоваться средством браузера, как описано в разделе [Защита приложения API](app-service-api-dotnet-add-authentication.md#use-postman-to-send-a-post-request) для запроса Post.

	* Перейдите по URL-адресу входа в шлюз и введите учетные данные для входа.
	* Получите значение маркера Zumo из файла cookie x-zumo-auth.
	* Добавьте заголовок x-zumo-auth в запрос; его значение должно соответствовать значению файла cookie x-zumo-auth.
	* Отправьте запрос.

	**Примечание.** При локальном запуске Azure не может контролировать доступ к приложению API, ограничивая выполнение его методов только пользователями, прошедшими проверку подлинности. При запуске в Azure весь трафик, предназначенный для приложения API, направляется через шлюз; при этом шлюз не передает запросы, которые не прошли проверку подлинности. Поскольку при локальном запуске перенаправление не выполняется, запросам без проверки подлинности не запрещается получать доступ к приложению API. Смысл описанной процедуры проверки подлинности заключается в том, что в приложении API можно выполнить код, связанный с проверкой подлинности (например, код, который получает сведения о вошедшем в систему пользователе). Дополнительные сведения о том, как шлюз выполняет проверку подлинности для приложений API, см. в статье [Проверка подлинности для приложений API и мобильных приложений](../app-service/app-service-authentication-overview.md#azure-app-service-gateway).

## Дальнейшие действия

Удаленная отладка для приложений API упрощает просмотр выполнения кода в службе приложений Azure. Подробные данные диагностики и отладки доступны непосредственно в IDE Visual Studio для приложений API Azure.

Приложения API службы приложений — это веб-приложения службы приложений, которые имеют дополнительные возможности для размещения веб-служб, поэтому вы можете использовать для приложений API те же средства отладки и устранения неполадок, которые использовали для веб-приложений. Дополнительные сведения см. в разделе [Устранение неполадок веб-приложения в службе приложений Azure с помощью Visual Studio](../app-service-web/web-sites-dotnet-troubleshoot-visual-studio.md).

Приложение API, созданное в этой серии учебников, является общедоступным для вызова любого пользователя. Сведения о том, как защитить приложения API, ограничив их вызов только пользователями, прошедшими проверку подлинности, см. в статье [Проверка подлинности для приложений API и мобильных приложений в службе приложений Azure](../app-service/app-service-authentication-overview.md).
 

<!---HONumber=July15_HO5-->