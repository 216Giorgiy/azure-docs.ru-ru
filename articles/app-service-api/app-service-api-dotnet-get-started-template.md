<properties
	pageTitle="Приступая к работе с веб-API ASP.NET 2 в службе приложений Azure | Microsoft Azure"
	description="Узнайте, как создать проект веб-API ASP.NET 2 в Visual Studio и развернуть его в новом приложении API в службе приложений Azure."
	services="app-service\api"
	documentationCenter=".net"
	authors="tdykstra"
	manager="wpickett"
	editor=""/>

<tags
	ms.service="app-service-api"
	ms.workload="web"
	ms.tgt_pltfrm="na"
	ms.devlang="dotnet"
	ms.topic="article"
	ms.date="04/13/2016"
	ms.author="rachelap"/>

# Приступая к работе с веб-API ASP.NET 2 в службе приложений Azure с помощью Visual Studio

## Обзор

В этом руководстве описано, как развернуть приложение веб-API ASP.NET 2 в [приложении API](app-service-api-apps-why-best-platform.md) службы приложений Azure с помощью Visual Studio 2015. Здесь описано, как создать проект Visual Studio и развернуть его в приложении API, следуя шагам на схеме ниже.

![Схема создания и развертывания в Visual Studio](./media/app-service-api-dotnet-get-started-template/Create_App.png)

Этот учебник создан для разработчиков ASP.NET без опыта работы с Azure. По завершении работы с этим руководством у вас будет простой веб-API, работающий в облаке.

Вы узнаете следующее:

* Как создать новое приложение API службы приложений во время создания проекта веб-API 2 в Visual Studio.
* Как развернуть проект веб-API 2 в приложении API службы приложений с помощью Visual Studio.
* Как использовать [портал Azure](/features/azure-portal/) для мониторинга приложения API и управления им.

В конце руководства в разделе [Устранение неполадок](#troubleshooting) приводятся рекомендации на случай возможных неисправностей, а в разделе [Дальнейшие действия](#next-steps) указаны ссылки на другие руководства с подробной информацией об использовании службы приложений Azure.

## Предварительные требования

### Учетная запись Azure

Для работы с этим руководством требуется учетная запись Azure. Вы можете:

* [Открыть бесплатную учетную запись Azure](/pricing/free-trial/?WT.mc_id=A261C142F). Вы получаете кредиты, которые можно использовать, чтобы попробовать платные службы Azure. После израсходования кредитов ваша учетная запись не исчезнет. Вы сможете использовать ее для работы с бесплатными службами и функциями Azure.
* [Активировать преимущества подписчика Visual Studio](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F). ваша подписка MSDN каждый месяц приносит вам кредиты, которые можно использовать для оплаты за службы Azure.

Если вы хотите приступить к работе со службой приложений Azure до регистрации и получения учетной записи Azure, перейдите на страницу [Пробное использование службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751). Там можно быстро создать кратковременное приложение начального уровня в службе приложений. Для этого не потребуется ни кредитная карта, ни какие-либо обязательства.

### <a name="setupdevenv"></a>Visual Studio 2015 с пакетом Azure SDK для .NET

Это руководство написано для Visual Studio 2015 с [пакетом Azure SDK для .NET](../dotnet-sdk.md) 2.8.2 или более поздней версии. Скачайте последний пакет Azure SDK для Visual Studio 2015 [отсюда](http://go.microsoft.com/fwlink/?linkid=518003). Будет автоматически установлена программа Visual Studio с пакетом SDK (если она еще не установлена).

Если вы хотите использовать уже установленную версию Visual Studio 2013, вы можете [скачать последний пакет Azure SDK для Visual Studio 2013](http://go.microsoft.com/fwlink/?LinkID=324322). Некоторые снимки экранов, приведенные здесь, могут отличаться от реальных.

>[AZURE.NOTE] В зависимости от того, сколько зависимостей пакета SDK уже имеется на компьютере, установка пакета SDK может занять определенное время, от нескольких минут до получаса или более.

### Веб-API ASP.NET 2

В этом руководстве описывается использование веб-API ASP.NET 2 со службой приложений Azure. В нем не объясняется, как разработать веб-API ASP.NET. Вводные сведения о веб-API ASP.NET 2 см. в статье [Getting Started with ASP.NET Web API 2](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/tutorial-your-first-web-api) (Приступая к работе с веб-API ASP.NET 2) на сайте [ASP.NET](http://asp.net/).

## Создание проекта и приложения API в службе приложений Azure

Прежде всего нужно создать проект веб-API ASP.NET 2 в Visual Studio и приложение API в службе приложений Azure. Затем необходимо развернуть проект в приложении API, чтобы предоставить к веб-API доступ в Интернете.

1. Откройте Visual Studio 2015.

2. Последовательно выберите **Файл > Создать > Проект**.

3. В диалоговом окне **Новый проект** последовательно щелкните **Visual C# > Интернет > Веб-приложение ASP.NET**. (При желании вы можете выбрать **Visual Basic**.)

3. Убедитесь, что выбрана версия **.NET Framework 4.5.2**.

4.  Для мониторинга доступности, производительности и использования приложения API требуется служба [Azure Application Insights](../application-insights/app-insights-overview.md). Флажок **Добавить Application Insights в проект** будет установлен по умолчанию, если вы впервые создаете веб-проект после установки Visual Studio. Если вы не хотите использовать Application Insights, снимите этот флажок.

4. Присвойте приложению имя **MyExample**.

5. Нажмите кнопку **ОК**.

	![Диалоговое окно "Новый проект"](./media/app-service-api-dotnet-get-started-template/GS13newprojdb.png)

5. В диалоговом окне **Новый проект ASP.NET** выберите шаблон **Приложение API Azure**.

5. В разделе **Microsoft Azure** диалогового окна **Новый проект ASP.NET** убедитесь, что флажок **Разместить в облаке** установлен, а в раскрывающемся списке выбран пункт **Служба приложений**.

	![Диалоговое окно "Новый проект ASP.NET"](./media/app-service-api-dotnet-get-started-template/GS13newaspnetprojdb.png)

	Если выбраны эти параметры, Visual Studio создаст приложение API Azure для вашего веб-проекта.

6. Нажмите кнопку **ОК**.

5. Если вы еще не вошли в Azure, Visual Studio покажет запрос для того, чтобы это сделать. Войдите, введя идентификатор и пароль учетной записи, которая используется для управления подпиской Azure.

	Войдя, вы увидите диалоговое окно **Создание службы приложений**, где вам будет предложено выбрать ресурсы, которые требуется создать.

	![Выполнен вход в Azure](./media/app-service-api-dotnet-get-started-template/configuresitesettings.png)

3. В диалоговом окне **Создание службы приложений** укажите **имя приложения API** (оно должно быть уникальным в домене *azurewebsites.net*). Вы можете назвать приложение MyExample и добавить уникальный номер справа (например, MyExample810) или использовать уникальное имя, которое создается автоматически.

	Если кто-то уже использует введенное вами имя, вместо зеленой галочки справа появится красный восклицательный знак. Это значит, что вам нужно ввести другое имя.

	Базовый URL-адрес вашего веб-API будет состоять из этого имени и блока *.azurewebsites.net* (как указано рядом с текстовым полем **Имя веб-приложения**). Например, если имя — `MyExample810`, URL-адрес будет таким: `myexample810.azurewebsites.net`.

6. Рядом с полем **Группа ресурсов** щелкните **Создать** и введите имя MyExample (или любое другое имя).

	В этом поле со списком можно выбрать существующую группу ресурсов или создать отдельную, введя имя, которое отличается от имени любой существующей группы ресурсов в подписке.

	Группа ресурсов — это совокупность ресурсов Azure, таких как приложения API, базы данных и виртуальные машины. Для этого руководства рекомендуется создать новую группу ресурсов, чтобы потом одновременно удалить все ресурсы Azure, созданные для работы с этим руководством. Дополнительные сведения см. в статье [Общие сведения о диспетчере ресурсов Azure](../resource-group-overview.md).

4. Нажмите кнопку **Создать** возле раскрывающегося списка **План службы приложений**.

	![Диалоговое окно "Создание службы приложений"](./media/app-service-api-dotnet-get-started-template/createas.png)

	На снимке экрана выше показаны примеры значений в полях **Имя веб-приложения**, **Подписка** и **Группа ресурсов**. Ваши значения будут другими.

	Далее мы создадим план службы приложений для новой группы ресурсов. План службы приложений определяет вычислительные ресурсы, на которых будет работать ваше приложение API. Например, если выбрать уровень "Бесплатный", ваше приложение будет работает на общих виртуальных машинах, тогда как при выборе некоторых платных уровней приложение будет работать на выделенных виртуальных машинах. Дополнительные сведения см. в статье [Подробный обзор планов службы приложений Azure](../app-service/azure-web-sites-web-hosting-plans-in-depth-overview.md).

5. В диалоговом окне **Настройка плана службы приложений** в соответствующем поле введите MyExamplePlan или другое имя.

5. В раскрывающемся списке **Расположение** выберите ближайшее расположение.

	Этот параметр определяет, в каком центре обработки данных Azure будет выполняться приложение. При работе с учебником вы можете выбрать любой регион, и это не будет оказывать существенного влияния. Тем не менее для рабочего приложения необходимо, чтобы сервер располагался как можно ближе к клиентам, которые осуществляют к нему доступ. Это позволит минимизировать [задержки](http://www.bing.com/search?q=web%20latency%20introduction&qs=n&form=QBRE&pq=web%20latency%20introduction&sc=1-24&sp=-1&sk=&cvid=eefff99dfc864d25a75a83740f1e0090).

5. В раскрывающемся списке **Размер** щелкните **Бесплатный**.

	Эта ценовая категория обеспечит достаточную производительность в рамках заданий этого руководства.

6. В диалоговом окне **Настройка плана службы приложений** нажмите кнопку **ОК**.

	![Диалоговое окно "Настройка службы приложений"](./media/app-service-api-dotnet-get-started-template/configasp.png)

7. В диалоговом окне **Создание службы приложений** нажмите кнопку **Создать**.

	![Диалоговое окно "Создание службы приложений"](./media/app-service-api-dotnet-get-started-template/clickcreate.png)

	За короткий промежуток времени, обычно не более минуты, Visual Studio создаст веб-проект и приложение API.

	В окне **обозревателя решений** отображаются файлы и папки нового проекта.

	![Обозреватель решений](./media/app-service-api-dotnet-get-started-template/solutionexplorer.png)

	В окне **Действие службы приложений Azure** будет показано, что приложение API создано (в сообщении может быть названо веб-приложением.)

	![Созданное приложение API в окне "Действие службы приложений Azure"](./media/app-service-api-dotnet-get-started-template/GS13sitecreated1.png)

	Приложение API также отобразится в окне **Cloud Explorer** программы Visual Studio.

	![Созданное приложение API в Cloud Explorer](./media/app-service-api-dotnet-get-started-template/siteinse.png)
	
	В этом окне можно просматривать различные ресурсы Azure и управлять ими. В вашем окне **Cloud Explorer** могут отображаться не такие типы ресурсов, как на снимке экрана выше. Щелкните правой кнопкой мыши ресурс, например приложение API, чтобы просмотреть варианты управления им.

## Развертывание проекта Visual Studio в приложении API Azure

В этом разделе вы развернете веб-проект в приложении API, как показано на шаге 2 на схеме.

![Схема создания и развертывания в Visual Studio](./media/app-service-api-dotnet-get-started-template/Create_App.png)

1. В **Обозревателе решений** щелкните правой кнопкой проект и выберите пункт **Опубликовать**.

	![Выберите "Опубликовать" в меню Visual Studio](./media/app-service-api-dotnet-get-started-template/choosepublish.png)

	Через несколько секунд откроется окно **мастера веб-публикации**. В мастере откроется *профиль публикации*, содержащий параметры для развертывания проекта в новом приложении API. Если вы хотите выполнить развертывание в другом приложении API, откройте вкладку **Профиль** и создайте другой профиль. В этом руководстве вам нужно будет принять параметры, развертывающие приложение API, которое было создано ранее.

	Профиль публикации содержит имя пользователя и пароль для развертывания. Эти учетные данные созданы автоматически. Их не нужно вводить или изменять. Пароль хранится зашифрованным в скрытом пользовательском файле в папке `Properties\PublishProfiles`.

8. На вкладке **Подключение** **мастера веб-публикации** нажмите кнопку **Далее**.

	![На вкладке "Подключение" мастера веб-публикации нажмите кнопку "Далее"](./media/app-service-api-dotnet-get-started-template/GS13ValidateConnection.png)

	Следующая вкладка — **Параметры** (показана ниже). Здесь можно изменить конфигурацию сборки, чтобы развернуть отладочную сборку для [удаленной отладки](../app-service-web/web-sites-dotnet-troubleshoot-visual-studio.md#remotedebug). На вкладке также представлено несколько **параметров публикации файлов**:

	* "Удалить дополнительные файлы в месте назначения";
	* "Предварительно компилировать при публикации";
	* "Исключить файлы из папки App\_Data".

	В данном руководстве эти параметры не используются. Подробное описание этих параметров см. в статье [Как развертывать проект веб-приложения с помощью публикации одним щелчком в Visual Studio](https://msdn.microsoft.com/library/dd465337.aspx).

10. На вкладке **Параметры** нажмите кнопку **Далее**.

	![Вкладка "Параметры" мастера веб-публикации](./media/app-service-api-dotnet-get-started-template/GS13SettingsTab.png)

	После этого вы перейдете на вкладку **Предварительный просмотр** (показана ниже). На ней можно узнать, какие файлы будут скопированы из проекта в приложение API. Если вы развертываете проект в приложение API, в которое проект уже был развернут, копируются только измененные файлы. Чтобы просмотреть список файлов, которые будут скопированы, нажмите кнопку **Начать просмотр**.

11. На вкладке **Предварительный просмотр** нажмите кнопку **Опубликовать**.

	![Вкладка "Предварительный просмотр" мастера веб-публикации](./media/app-service-api-dotnet-get-started-template/GS13previewoutput.png)

	Когда вы нажмете кнопку **Опубликовать**, Visual Studio начнет копирование файлов на сервер Azure. Это может занять несколько минут.

	В окнах **Вывод** и **Действия службы приложений Azure** отображаются не только сведения о действиях, выполняемых при развертывании, но и отчет об успешном завершении развертывания.

	![Окно вывода с отчетом об успешном развертывании в Visual Studio](./media/app-service-api-dotnet-get-started-template/PublishOutput.png)

	После успешного развертывания базовый URL-адрес развернутого приложения API автоматически открывается в используемом по умолчанию браузере, где отобразится страница с таким сообщением: "Это веб-приложение успешно создано".

	![Окно вывода с отчетом об успешном развертывании в Visual Studio](./media/app-service-api-dotnet-get-started-template/successfullycreated.png)

> [AZURE.TIP] Для быстрого развертывания можно включить панель инструментов **Веб-публикация одним щелчком**. Щелкните **Вид > Панели инструментов**, а затем выберите элемент **Веб-публикация одним щелчком**. На панели инструментов можно выбрать профиль, нажать кнопку публикации или открыть мастер **публикации веб-сайта**. ![Панель инструментов веб-публикации одним щелчком](./media/app-service-api-dotnet-get-started-template/weboneclickpublish.png)

## Тестирование развернутого веб-API

1. Отправьте запрос HTTP GET на URL-адрес *{имя вашего приложения API}.azurewebsites.net/api/values*, используя любое средство клиента HTTP.

	Шаблон проекта веб-API определяет контроллер `Values`, который возвращает массив из двух строк в формате JSON для запроса GET. На снимке экрана ниже показан запрос, отправленный с помощью [Postman](http://www.getpostman.com/), в возвращенном ответе которого содержится текст в формате JSON.

	![Окно вывода с отчетом об успешном развертывании в Visual Studio](./media/app-service-api-dotnet-get-started-template/postman.png)

2. Теперь вы можете внести изменения в код, повторно развернуть проект так же, как при первоначальном развертывании, и просмотреть измененный проект в Azure через несколько секунд.

## <a id="portal"></a> Мониторинг приложения API и управление им на портале Azure (необязательно)

[Портал Azure](/services/management-portal/) — это веб-интерфейс, с помощью которого вы можете отслеживать работу служб Azure (например, только что созданное приложение API), а также управлять ими. В этом разделе вы узнаете, что можно делать на портале.

1. В браузере перейдите по адресу [https://portal.azure.com](https://portal.azure.com) и войдите в систему с учетными данными, используемыми для управления учетной записью Azure.
	
2. Щелкните **Службы приложений** и выберите имя приложения API.

	![Службы приложений на портале Azure](./media/app-service-api-dotnet-get-started-template/selinportal.png)

	В колонке **Приложение API** отображается сводка параметров и статистика использования приложения API. (Окна, которые открываются справа на портале, называются *колонками*.)

	![Колонка "Приложение API" на портале Azure](./media/app-service-api-dotnet-get-started-template/portaldashboard.png)

	До сих пор трафик вашего приложения API был незначительным, поэтому на графике может ничего не отображаться. Если вы отправите несколько дополнительных запросов к веб-API, а затем обновите страницу портала, отобразится некоторая статистика.

3. В колонке **Параметры** представлены дополнительные параметры конфигурации приложения API.

	![Колонка "Параметры" на портале Azure](./media/app-service-api-dotnet-get-started-template/portalconfigure1.png)

	В разделе **API** содержатся ссылки на колонки для настройки конечной точки метаданных API и CORS. Ссылки на руководства, в которых описываются эти возможности, можно просмотреть в разделе [Дальнейшие действия](#next-steps).

	Обратите внимание на ссылку **Учетные данные развертывания** в разделе **Публикация**. Здесь можно создать настраиваемое имя пользователя и пароль для развертывания. Нажмите кнопку **Сохранить** в верхней части колонки, чтобы внести изменения. Если вы создадите новое имя пользователя и пароль, необходимо ввести те же значения на вкладке **Подключение** в мастере **публикации веб-сайта** в своем веб-проекте.
	
	На снимке экрана показана только часть колонки **Параметры**. В этой колонке есть дополнительные разделы, которые не показаны на снимке экрана.

Это всего лишь несколько функций, доступных на портале. Кроме этого, можно создавать новые приложения API, удалять существующие приложения API, останавливать и повторно запускать их, а также управлять различными службами Azure, такими как базы данных и виртуальные машины.

## Удаление приложения API Azure (необязательно)

Если вам больше не нужно приложение API, созданное для этого руководства, его можно удалить.

Чтобы быстро удалить приложение API, нажмите кнопку **Удалить** в верхней части соответствующей колонки **Приложение API** на портале Azure. Но лучше всего удалить группу ресурсов, созданную для хранения приложения API. В этом руководстве группа ресурсов содержит только приложение API, но обычно она содержит коллекцию связанных ресурсов. Например, приложение API может использовать базу данных или учетную запись хранения Azure, которая больше не потребуется, когда вы удалите приложение API. При удалении группы ресурсов удаляется все ее содержимое. Чтобы удалить группу ресурсов с помощью портала Azure, выполните следующие действия.

1. Перейдите на домашнюю страницу [портала Azure](https://portal.azure.com).

2. Щелкните раздел **Группа ресурсов**.

3. В списке групп ресурсов щелкните имя группы ресурсов, которую нужно удалить.

	Появится колонка **Группа ресурсов** со списком содержащихся в ней ресурсов.

4. В колонке **Группа ресурсов** щелкните **Удалить**.

	![Удаление группы ресурсов на портале Azure](./media/app-service-api-dotnet-get-started-template/delresgrp.png)

## Устранение неполадок

Если при работе с этим руководством возникли проблемы, убедитесь, что вы используете последнюю версию пакета Azure SDK для .NET. Самый простой способ сделать это — [скачать пакет Azure SDK для Visual Studio 2015](http://go.microsoft.com/fwlink/?linkid=518003). Если вы имеете текущую версию, установщик веб-платформы сообщит вам, что установка не требуется.

Если вы работаете в корпоративной сети и пытаетесь развернуть службу приложений Azure через брандмауэр, убедитесь, что порты 443 и 8172 открыты для веб-развертывания. Если не удается открыть эти порты, в разделе "Дальнейшие действия" ниже приведены другие варианты развертывания.

Запустив приложение API ASP.NET в службе приложений Azure, можно узнать больше о функциях Visual Studio, которые упрощают устранение неполадок. Сведения о ведении журналов, удаленной отладке и другую информацию см. в статье [Устранение неполадок веб-приложения в службе приложений Azure с помощью Visual Studio](../app-service-web/web-sites-dotnet-troubleshoot-visual-studio.md).

## Дальнейшие действия

Из этого руководства вы узнали, как создать простое веб-приложение и развернуть его в приложении API с помощью службы приложений Azure. Общие сведения о возможностях службы приложений, упрощающих процесс разработки и использования веб-API, см. в серии руководств, начиная с [Приступая к работе с приложениями API и ASP.NET в службе приложений Azure](app-service-api-dotnet-get-started.md).

<!---HONumber=AcomDC_0713_2016-->