<properties
	pageTitle="Сборка и развертывание приложения API Java в службе приложений Azure"
	description="Узнайте, как создать пакет приложения API Java и развернуть его в службе приложений Azure."
	services="app-service\api"
	documentationCenter="java"
	authors="pkefal"
	manager="mohisri" 
	editor="jimbe"/>

<tags
	ms.service="app-service-api"
	ms.workload="web"
	ms.tgt_pltfrm="na"
	ms.devlang="java"
	ms.topic="article"
	ms.date="04/21/2015"
	ms.author="pakefali"/>

# Сборка и развертывание приложения API Java в службе приложений Azure

В этом учебнике показано, как создать приложение Java и развернуть его в приложения API службы приложений Azure, используя [Git](http://git-scm.com). Указания, приведенные в этом учебнике, применимы в любой операционной системе, на которой может работать Java. В этом учебнике также используется [Gradle](https://gradle.org), чтобы сделать возможными автоматическую сборку и разрешение зависимостей пакетов для приложения Java. Наконец, [RESTEasy](http://resteasy.jboss.org/) используется для создания службы RESTful, полностью реализуя спецификации [JaxRS](https://jax-rs-spec.java.net/).

Снимок экрана завершенного приложения:

![][sample-api-app-page]

## Создание приложения API на портале Azure

> [AZURE.NOTE]Для работы с этим учебником необходимо использовать учетную запись Microsoft Azure. Если у вас нет учетной записи, можно [активировать преимущества для подписчиков MSDN](/pricing/member-offers/msdn-benefits-details/) или [подписаться на бесплатную пробную версию](/pricing/free-trial/). Можно также бесплатно попробовать [примеры приложений службы приложения](http://tryappservice.azure.com).

1. Выполните вход на [портал предварительной версии Azure](https://portal.azure.com).

2. Щелкните команду **СОЗДАТЬ** в нижнем левом углу портала.

3. Выберите элементы **Интернет + мобильные устройства > Приложение API**.

	![][portal-quick-create]

4. Введите значение в поле **Имя**, например JavaAPIApp.

5. Выберите план службы приложений или создайте новый. При создании нового плана выберите ценовую категорию, расположение и другие параметры.

	![][portal-create-api]

6. Щелкните **Создать**.

	![][api-app-blade]

	Если установлен флажок **Добавить на начальную панель**, на портале автоматически откроется колонка приложения API после его создания. Если этот флажок снят, выберите элемент **Уведомления** на домашней странице портала, чтобы узнать состояние создания приложения API, а затем щелкните уведомление, чтобы перейти к колонке нового приложения API.

7. Щелкните элементы **Параметры > Параметры приложения**.

9. Установите для уровня доступа значение **Общедоступный (анонимный)**.

11. Щелкните **Сохранить**.

	![][set-api-app-access-level]

## Включение публикации Git для нового приложения API

[Git](http://git-scm.com) является распределенной системой управления версиями, которую можно использовать для развертывания веб-сайта Azure. Код, созданный для приложения API, будет храниться в локальном репозитории Git, а для развертывания кода в Azure он будет передаваться в удаленный репозиторий. Данный метод развертывания характерен для веб-приложений службы приложений, которые можно использовать в приложении API, поскольку приложения API основаны на веб-приложениях: приложение API в службе приложений Azure является веб-приложением с дополнительными возможностями для размещения веб-служб.

Управление функциями, связанными с приложениями API, на портале осуществляется с помощью колонки **Приложения API**, а управление функциями, которые используются совместно с веб-приложениями, — с помощью колонки **Узел приложения API**. Поэтому, выполняя действия из этого раздела, перейдите к колонке **Узел приложения API** для настройки функции развертывания Git.

1. В колонке приложения API щелкните элемент **Узел приложения API**.

	![][api-app-host]

2. Найдите раздел **Развертывание** колонки **Приложения API** и щелкните элемент **Настройка непрерывного развертывания**. Возможно, понадобится прокрутить вниз, чтобы увидеть эту часть колонки.

	![][deployment-part]

3. Щелкните **Выбор источника > Локальный репозиторий Git**.

5. Нажмите кнопку **ОК**.

	![][setup-git-publishing]

6. Если ранее вы не настроили учетные данные развертывания для публикации приложения API или другого приложения службы приложений, сделайте это сейчас, как показано ниже.

	* Щелкните элемент **Настройка учетных данных развертывания**.

	* Укажите имя пользователя и пароль.

	* Щелкните **Сохранить**.

	![][deployment-credentials]

1. В колонке **Узел приложения API** щелкните **Параметры > Свойства**. В разделе «URL-адрес GIT» отображается URL-адрес удаленного репозитория Git, в который выполняется развертывание.

2. Скопируйте URL-адрес для дальнейшего использования в этом учебнике.

	![][git-url]

## Включение среды выполнения Java в новом приложении API

Чтобы приложение API успешно разместило приложение Java, следует включить среду выполнения Java и выбрать сервер приложений. Портал позволяет сделать это очень просто. Мы собираемся включить Java 7 и Jetty для размещения приложения.

1. В колонке приложения API щелкните элемент **Узел приложения API**.

	![][api-app-host]

2. Щелкните **Параметры > Параметры приложения**. Здесь включите Java и выберите Jetty в качестве сервера приложений. Нажмите кнопку **Сохранить**.

	![][api-app-enable-java]

Это позволит **включить среду выполнения Java** для приложения API и создать папку **webapps/** в корневом каталоге веб-сайта. В этой папке будут содержаться все WAR-файлы приложений.

## Скачивание и проверка кода для приложения API Java

В этом разделе выполняется скачивание и просмотр кода, который предоставляется как часть примера приложения JavaAPIApp.

1. Загрузите код в [этот репозиторий GitHub](http://go.microsoft.com/fwlink/?LinkId=571009). Можно клонировать репозиторий или щелкнуть команду **Загрузить Zip**, чтобы загрузить его как ZIP-файл. Если выбрана загрузка ZIP-файла, распакуйте его на локальном диске.

2. Перейдите к папке, в которую вы распаковали пример и перейдите к папке `build\libs`.

	![][api-app-folder-browse]

3. Откройте файл **apiapp.json** в текстовом редакторе и проверьте содержимое.

	![][apiapp-json]

	Чтобы служба приложений Azure распознала приложение Java как приложение API должны быть соблюдены два предварительных требования:

	+ в корневом каталоге приложения должен присутствовать файл с именем *apiapp.json*;
	+ приложение должно отображать конечную точку метаданных Swagger 2.0. URL-адрес этой конечной точки указан в файле *apiapp.json*.

	Обратите внимание на свойство **apiDefinition**. Путь для этого URL-адреса соотносится с URL-адресом вашего приложения API и указывает на конечную точку Swagger 2.0. Службы приложений Azure использует это свойство для обнаружения определения API и реализации множества возможностей приложения API службы приложений.

4. Перейдите к `src\main\java\com\microsoft\trysamples\javaapiapp`, откройте файл **App.java** и проверьте код.

	![][app-java]

	Для создания конечной точки Swagger 2.0 код использует пакет Swagger для JaxRS.

		beanConfig.setVersion("1.0.0");
		beanConfig.setBasePath("/JavaAPIApp/api");
		beanConfig.setHost(websitehostname);
		beanConfig.setResourcePackage("com.microsoft.trysamples.javaapiapp");
		beanConfig.setSchemes(new String[]{"http", "https"});
		beanConfig.setScan(true);

	Метод `setVersion` задает версию API в метаданных, которые обслуживает Swagger.

	Метод `setBasePath` задает базовый путь, который Swagger использует для создания метаданных. Этот URL-адрес соотносится с базовым путем приложения API.

	Метод `setHost` задает узел, который прослушивает API. В этом случае мы используем переменную `websitehostname`, которую мы назначили несколько строк назад, для динамической установки `localhost` при локальной работе или имя узла приложения API при работе приложения в службе приложений Azure.

	Метод `setResourcePackage` задает пакет, который Swagger будет сканировать и который включит в файл Swagger.json, содержащий метаданные API.

	Метод `setSchemes` определяет поддерживаемые схемы.

	Метод `setScan` обеспечивает, что Swagger создаст документацию приложения.

	Доступно также множество других методов, которые настраивают выходные данные Swagger при использовании RESTEasy. Эти методы можно найти на [вики-странице](https://github.com/swagger-api/swagger-core/wiki/Swagger-Core-RESTEasy-2.X-Project-Setup-1.5#using-swaggers-beanconfig) Swagger

	> [AZURE.NOTE]Файл метаданных Swagger можно открыть, используя путь `/JavaAPIApp/api/swagger.json`.

## Локальный запуск кода приложения API

В этом разделе выполняется запуск приложения локально, чтобы проверить его работоспособность перед развертыванием.

1. Перейдите к папке, в которую был загружен пример.

2. Откройте окно командной строки и введите следующую команду:

		gradlew.bat

3. После выполнения команды введите следующую команду:

		gradlew.bat jettyRunWar

	В окне командной строки отобразится:

		17:25:49 INFO  JavaAPIApp runs at:
		17:25:49 INFO    http://localhost:8080/JavaAPIApp

5. Введите в браузере адрес `http://localhost:8080/JavaAPIApp/`

	Откроется следующая страница:

	![][sample-api-app-page]

6. Чтобы просмотреть файл Swagger.json, перейдите по адресу `http://localhost:8080/JavaAPIApp/api/Swagger.json`.

## Публикация кода приложения API в службе приложений Azure

В этом разделе создается локальный репозиторий Git и выполняется принудительная отправка данных из этого репозитория в Azure для развертывания примера приложения в приложение API, работающее в службе приложений Azure.

1. Если Git не установлен, установите его со [страницы загрузки Git](http://git-scm.com/download).

1. С помощью командной строки замените каталоги примером каталога приложения, введите `build\libs`, а затем введите следующие команды, чтобы инициализировать локальный репозиторий Git.

		git init


2. Введите следующие команды для добавления файлов в репозиторий:

		git add .
		git commit -m "Initial commit of the API App"

3. Создайте удаленную ссылку для публикации обновлений в ранее созданное веб-приложение (узел приложения API), используя URL-адрес Git, скопированный ранее:

		git remote add azure [URL for remote repository]

4. Отправьте обновления в Azure с помощью следующей команды:

		git push azure master

	Появится запрос на ввод ранее заданного пароля.

	Результат этой команды завершается сообщением об успешном развертывании:

		remote: Deployment successful.
		To https://user@testsite.scm.azurewebsites.net/testsite.git
	 	* [new branch]      master -> master

## Просмотр определения API на портале Azure

Теперь, после завершения развертывания API в приложение API, можно увидеть определение API на портале Azure. Для начала нужно перезапустить *шлюз*, который позволяет Azure распознавать, что изменилось определение API приложения API. Шлюз является веб-приложением, которое выполняет администрирование API и авторизацию для приложений API в группе ресурсов.

6. На портале Azure перейдите к колонке **Приложение API** для приложения API, которое было создано ранее, и щелкните ссылку **Шлюз**.

	![][click-gateway]

7. В колонке **Шлюз** выберите команду **Перезапуск**. Теперь можно закрыть эту колонку.

	![][restart-gateway]

8. В колонке **Приложение API** щелкните элемент **Определение API**.

	![][api-definition-click]

	В колонке **Определение API** показан метод Get.

	![][api-definition-blade]

## Запуск примера приложения в Azure

На портале Azure перейдите к колонке **Узел приложения API** для своего приложения API и нажмите кнопку **Обзор**.

![][browse-api-app-page]

Браузер отобразит домашнюю страницу, которую вы видели ранее при запуске примера приложения локально.

## Дальнейшие действия

Вы развернули веб-приложение Java, которое использует серверную часть приложения API в Azure. Дополнительную информацию об использовании Java в Azure см. в разделе [Центр разработчиков Java](/develop/java/).

Этот пример приложения можно попробовать использовать в [службе TryApp](http://tryappservice.azure.com)

[portal-quick-create]: ./media/app-service-api-java-api-app/portal-quick-create.png
[portal-create-api]: ./media/app-service-api-java-api-app/portal-create-api.png
[api-app-blade]: ./media/app-service-api-java-api-app/api-app-blade.png
[api-app-folder-browse]: ./media/app-service-api-java-api-app/api-app-folder-browse.png
[api-app-host]: ./media/app-service-api-java-api-app/api-app-host.png
[deployment-part]: ./media/app-service-api-java-api-app/continuous-deployment.png
[set-api-app-access-level]: ./media/app-service-api-java-api-app/set-api-app-access.png
[setup-git-publishing]: ./media/app-service-api-java-api-app/local-git-repo.png
[deployment-credentials]: ./media/app-service-api-java-api-app/deployment-credentials.png
[git-url]: ./media/app-service-api-java-api-app/git-url.png
[apiapp-json]: ./media/app-service-api-java-api-app/apiapp-json.png
[app-java]: ./media/app-service-api-java-api-app/app-java.png
[sample-api-app-page]: ./media/app-service-api-java-api-app/sample-api-app-page.png
[browse-api-app-page]: ./media/app-service-api-java-api-app/browse-api-app-page.png
[api-app-enable-java]: ./media/app-service-api-java-api-app/api-app-enable-java.png
[click-gateway]: ./media/app-service-api-java-api-app/clickgateway.png
[restart-gateway]: ./media/app-service-api-java-api-app/gatewayrestart.png
[api-definition-click]: ./media/app-service-api-java-api-app/apidef.png
[api-definition-blade]: ./media/app-service-api-java-api-app/apidefblade.png

<!---HONumber=58--> 