<properties
	pageTitle="Создание и развертывание приложения API Node.js в службе приложений Azure"
	description="Узнайте, как создать пакет приложения API Node.js и развернуть его в службе приложений Azure."
	services="app-service\api"
	documentationCenter="nodejs"
	authors="pkefal"
  manager="" 
  editor=""/>

<tags
	ms.service="app-service-api"
	ms.workload="web"
	ms.tgt_pltfrm="na"
	ms.devlang="nodejs"
	ms.topic="article"
	ms.date="04/21/2015"
	ms.author="pakefali"/>

# Создание и развертывание приложения API Node.js в службе приложений Azure

В этом учебнике показано, как создать приложение [Node.js](http://nodejs.org) и развернуть его в приложения API в службе приложений Azure с помощью [Git](http://git-scm.com). Инструкции, приведенные в этом учебнике, применимы к любой операционной системе, на которой может работать Node.

Снимок экрана завершенного приложения:

![][sample-api-app-page]

> [AZURE.NOTE]Вы также можете использовать код Visual Studio, чтобы выполнить сборку приложения API Node.js и развернуть его в службе приложений Azure. Дополнительную информацию о коде Visual Studio и Node.js см. в разделах [Код Visual Studio](http://code.visualstudio.com/Docs/) и [Разработка приложений узла](http://code.visualstudio.com//Docs/nodejs).

## Создание приложения API на портале предварительной версии Azure

> [AZURE.NOTE]Для работы с этим учебником необходимо использовать учетную запись Microsoft Azure. Если у вас нет учетной записи, можно [активировать преимущества для подписчиков MSDN](/pricing/member-offers/msdn-benefits-details/) или [подписаться на бесплатную пробную версию](/pricing/free-trial/). Можно также бесплатно попробовать [примеры приложений службы приложения](http://tryappservice.azure.com).

1. Выполните вход на [портал предварительной версии Azure](https://portal.azure.com).

2. Щелкните команду **СОЗДАТЬ** в нижнем левом углу портала.

3. Выберите элементы **Интернет + мобильные устройства > Приложение API**.

	![][portal-quick-create]

4. Введите значение в поле **Имя**, например NodejsAPIApp.

5. Выберите план службы приложений или создайте новый. При создании нового плана выберите ценовую категорию, расположение и другие параметры.

	![][portal-create-api]

6. Щелкните **Создать**.

	![][api-app-blade]

	Если установлен флажок **Добавить на начальную панель**, на портале автоматически откроется колонка приложения API после его создания. Если этот флажок снят, выберите элемент **Уведомления** на домашней странице портала, чтобы узнать состояние создания приложения API, а затем щелкните уведомление, чтобы перейти к колонке нового приложения API.

7. Щелкните элементы **Параметры > Параметры приложения**.

9. Установите для уровня доступа значение **Общедоступный (анонимный)**.

11. Щелкните **Сохранить**.

	![][set-api-app-access-level]

## Включение публикации Git для нового приложения API

[Git](http://git-scm.com/%20target="_blank) является распределенной системой управления версиями, которую можно использовать для развертывания веб-сайта Azure. Код, созданный для приложения API, будет храниться в локальном репозитории Git, а для развертывания кода в Azure он будет передаваться в удаленный репозиторий. Данный метод развертывания характерен для веб-приложений службы приложений, которые можно использовать в приложении API, поскольку приложения API основаны на веб-приложениях: приложение API в службе приложений Azure является веб-приложением с дополнительными возможностями для размещения веб-служб.

Управление функциями, связанными с приложениями API, на портале осуществляется с помощью колонки **Приложения API**, а управление функциями, которые используются совместно с веб-приложениями, — с помощью колонки **Узел приложения API**. Поэтому, выполняя действия из этого раздела, перейдите к колонке **Узел приложения API** для настройки функции развертывания Git.

1. В колонке приложения API щелкните элемент **Узел приложения API**.

	![][api-app-host]

2. Найдите раздел **Развертывание** колонки **Приложения API** и щелкните элемент **Настройка непрерывного развертывания**. Возможно, понадобится прокрутить вниз, чтобы увидеть эту часть колонки.

	![][deployment-part]

3. Щелкните **Выбор источника > Локальный репозиторий Git**.

5. Нажмите кнопку **ОК**.

	![][setup-git-publishing]

6. Если ранее вы не настроили учетные данные развертывания для публикации приложения API или другого приложения службы приложений, сделайте это сейчас, как показано ниже.

	* Щелкните элемент **Настройка учетных данных развертывания**.

	* Укажите имя пользователя и пароль.

	* Щелкните **Сохранить**.

	![][deployment-credentials]

1. В колонке **Узел приложения API** щелкните **Параметры > Свойства**. В разделе "URL-адрес GIT" отображается URL-адрес удаленного репозитория Git, в который выполняется развертывание.

2. Скопируйте URL-адрес для дальнейшего использования в этом учебнике.

	![][git-url]

## Загрузка и проверка кода для приложения API Node.js

В этом разделе выполняется скачивание и просмотр кода, который предоставляется как часть примера приложения NodeAPIApp.

1. Загрузите код в [этот репозиторий GitHub](http://go.microsoft.com/fwlink/?LinkID=534023&clcid=0x409). Можно клонировать репозиторий или щелкнуть команду **Загрузить Zip**, чтобы загрузить его как ZIP-файл. Если выбрана загрузка ZIP-файла, распакуйте его на локальном диске.

2. Перейдите к папке, в которую вы распаковали пример.

	![][api-app-folder-browse]

3. Откройте файл **apiapp.json** в текстовом редакторе и проверьте содержимое.

	![][apiapp-json]

	Чтобы служба приложений Azure распознала приложение Node.js как приложения API должны быть соблюдены два предварительных требования:

	+ в корневом каталоге приложения должен присутствовать файл с именем *apiapp.json*;
	+ приложение должно отображать конечную точку метаданных Swagger 2.0. URL-адрес этой конечной точки указан в файле *apiapp.json*.

	Обратите внимание на свойство **apiDefinition**. Путь для этого URL-адреса соотносится с URL-адресом вашего приложения API и указывает на конечную точку Swagger 2.0. Службы приложений Azure использует это свойство для обнаружения определения API и реализации множества возможностей приложения API службы приложений.

	> [AZURE.NOTE]Конечная точка должна иметь спецификацию Swagger 2.0, т. к. более ранние версии (например, 1.2) в платформе не поддерживаются. Пример приложения использует модуль swaggerize-express для создания спецификации конечной точки Swagger 2.0.

4. Откройте файл **server.js** и проверьте код.

	![][server-js]

	Код использует модуль swaggerize-express для создания конечной точки Swagger 2.0.

		app.use(swaggerize({
		    api: require('./api.json'),
		    docspath: '/swagger',
		    handlers: './handlers/'
		}));

	Свойство `api` указывает на файл api.json, содержащий определение спецификации Swagger 2.0 приложения API. Файл можно создать вручную в текстовом редакторе или использовать [редактор Swagger](http://editor.swagger.io) в Интернете и загрузить файл JSON оттуда. (Файл *Api.json* указывает свойство `host`, но значение этого свойства определяется и заменяется динамически во время выполнения.)

	Свойство `docspath` указывает на конечную точку Swagger 2.0. Этот URL-адрес соотносится с базовым путем API. Базовый путь определяется в файле api.json. В данном примере базовый путь имеет вид */api/data*, поэтому относительный путь к конечной точке swagger имеет такой вид: */api/data/swagger*.

	> [AZURE.NOTE]Так как базовый путь указывается в файле *api.json*, попытка получить доступ к конечной точке */swagger* в качестве относительного пути для URL-адреса приложения API вернет ошибку 404. Это распространенная ошибка при попытке доступа к конечной точке swagger.

	Свойство `handlers` указывает на локальную папку, содержащую обработчики маршрутов для модуля Express.js.

## Локальный запуск кода приложения API

В этом разделе выполняется запуск приложения локально, чтобы проверить его работоспособность перед развертыванием.

1. Перейдите к папке, в которую был загружен пример.

2. Откройте окно командной строки и введите следующую команду:

		npm install

3. Когда команда *install* будет выполнена, введите следующую команду:

		node server.js

	В окне командной строки отображается сообщение «Server started».

5. Введите в браузере адрес http://localhost:1337/

	Откроется следующая страница:

	![][sample-api-app-page]

6. Чтобы просмотреть файл Swagger.json, перейдите по адресу http://localhost:1337/api/data/swagger.

## Публикация кода приложения API в службе приложений Azure

В этом разделе создается локальный репозиторий Git и выполняется принудительная отправка данных из этого репозитория в Azure для развертывания образца приложения в приложение API, работающее в службе приложений Azure.

1. Если Git не установлен, установите его со [страницы загрузки Git](http://git-scm.com/download%20target="_blank").

1. С помощью командной строки измените каталоги на каталог примера приложения и введите следующие команды для инициализации локального репозитория Git.

		git init


2. Введите следующие команды для добавления файлов в репозиторий:

		git add .
		git commit -m "Initial commit of the API App"

3. Создайте удаленную ссылку для публикации обновлений в ранее созданное веб-приложение (узел приложения API), используя URL-адрес Git, скопированный ранее:

		git remote add azure [URL for remote repository]

4. Отправьте обновления в Azure с помощью следующей команды:

		git push azure master

	Появится запрос на ввод ранее заданного пароля.

	Результат этой команды завершается сообщением об успешном развертывании:

		remote: Deployment successful.
		To https://user@testsite.scm.azurewebsites.net/testsite.git
	 	* [new branch]      master -> master

## Просмотр определения API на портале предварительной версии Azure

Теперь, после завершения развертывания API в приложение API, можно увидеть определение API на портале предварительной версии Azure. Для начала нужно перезапустить *шлюз*, который позволяет Azure распознавать, что изменилось определение API приложения API. Шлюз является веб-приложением, которое выполняет администрирование API и авторизацию для приложений API в группе ресурсов.

6. На портале предварительной версии Azure перейдите к колонке **Приложение API** для приложения API, которое было создано ранее, и щелкните ссылку **Шлюз**.

	![](./media/app-service-api-nodejs-api-app/clickgateway.png)

7. В колонке **Шлюз** щелкните **Перезапуск**. Теперь можно закрыть эту колонку.

	![](./media/app-service-api-nodejs-api-app/gatewayrestart.png)

8. В колонке **Приложение API** щелкните элемент **Определение API**.

	![](./media/app-service-api-nodejs-api-app/apidef.png)

	В колонке **Определение API** показаны два метода Get.

	![](./media/app-service-api-nodejs-api-app/apidefblade.png)

## Запуск примера приложения в Azure

На портале предварительной версии Azure перейдите к колонке **Узел приложения API** для вашего приложения API и нажмите кнопку **Обзор**.

![][browse-api-app-page]

Браузер отобразит домашнюю страницу, которую вы видели ранее при запуске образца приложения локально.

[AZURE.INCLUDE [app-service-api-direct-deploy-metadata](../../includes/app-service-api-direct-deploy-metadata.md)]

## Дальнейшие действия

Вы развернули веб-приложение Node.js, которое использует серверную часть приложения API в Azure. Дополнительные сведения об использовании Node.js в Azure см. в разделе [Центр разработчиков Node.js](/develop/nodejs/).

* Этот образец приложения API можно попробовать использовать в [службе TryApp](http://tryappservice.azure.com)

[portal-quick-create]: ./media/app-service-api-nodejs-api-app/portal-quick-create.png
[portal-create-api]: ./media/app-service-api-nodejs-api-app/portal-create-api.png
[api-app-blade]: ./media/app-service-api-nodejs-api-app/api-app-blade.png
[api-app-folder-browse]: ./media/app-service-api-nodejs-api-app/api-app-folder-browse.png
[api-app-host]: ./media/app-service-api-nodejs-api-app/api-app-host.png
[deployment-part]: ./media/app-service-api-nodejs-api-app/continuous-deployment.png
[set-api-app-access-level]: ./media/app-service-api-nodejs-api-app/set-api-app-access.png
[setup-git-publishing]: ./media/app-service-api-nodejs-api-app/local-git-repo.png
[deployment-credentials]: ./media/app-service-api-nodejs-api-app/deployment-credentials.png
[git-url]: ./media/app-service-api-nodejs-api-app/git-url.png
[apiapp-json]: ./media/app-service-api-nodejs-api-app/apiapp-json.png
[server-js]: ./media/app-service-api-nodejs-api-app/server-js.png
[sample-api-app-page]: ./media/app-service-api-nodejs-api-app/sample-api-app-page.png
[browse-api-app-page]: ./media/app-service-api-nodejs-api-app/browse-api-app-page.png
 

<!---HONumber=62-->