<properties
	pageTitle="Проверка подлинности и авторизация для приложений API в службе приложений Azure | Microsoft Azure"
	description="Узнайте о функциях проверки подлинности и авторизации, которые служба приложений Azure предоставляет для приложений API."
	services="app-service\api"
	documentationCenter=".net"
	authors="tdykstra"
	manager="wpickett"
	editor=""/>

<tags
	ms.service="app-service-api"
	ms.workload="na"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="hero-article"
	ms.date="12/04/2015"
	ms.author="tdykstra"/>

# Проверка подлинности и авторизация для приложений API в службе приложений Azure

[AZURE.INCLUDE [app-service-api-get-started-selector](../../includes/app-service-api-get-started-selector.md)]

## Обзор 

В этой статье описываются возможности обработки проверки подлинности и авторизации для приложений API в службе приложений Azure.

Следующая схема иллюстрирует важные характеристики проверки подлинности в службе приложений.

* Выполняет предварительную обработку входящих запросов API и позволяет вам выбрать, насколько подробно вы хотите обрабатывать проверку подлинности в коде приложения. 
* Поддерживает пять поставщиков проверки подлинности: Azure Active Directory, Facebook, Google, Twitter и учетную запись Майкрософт.
* Выполняет проверку подлинности как конечных пользователей, так и субъектов-служб. 
* Работает одинаково для приложений API, веб-приложений и мобильных приложений.

![](./media/app-service-api-authentication/api-apps-overview.png)

## Предварительная обработка входящих запросов

Служба приложений может защищать ваше приложение API от анонимных HTTP-запросов или выполнять проверку подлинности запросов с маркерами, прежде чем они достигнут приложения API. Для приложения API можно настроить один из трех вариантов.

1. Пропускать к приложению API только запросы, прошедшие проверку подлинности.

	Если из браузера приходит анонимный запрос, служба приложений перенаправляет его на страницу входа.

	Это удобно, если заранее известно, что вы будете использовать один поставщик проверки подлинности (Google, Twitter и др.). Служба приложений возьмет на себя работу по обработке входа. Также можно указать собственный URL-адрес, на который служба приложений будет перенаправлять анонимные запросы. Тогда вы сможете предоставить пользователям несколько поставщиков проверки подлинности на выбор.

	В этом варианте в приложении не нужно создавать код проверки подлинности. Авторизация становится проще, поскольку наиболее важные утверждения предоставляются в заголовках HTTP.

2. Пропускать к приложению API все запросы, но проверять запросы проверки подлинности и передавать в заголовках HTTP сведения о проверке подлинности.

	Такой вариант дает вам больше гибкости в обработке анонимных запросов и позволяет легко написать код, который будет обращаться к наиболее распространенным утверждениям. В отличие от варианта 1, здесь вам потребуется написать код, если нужно закрыть API от анонимных пользователей.

3. Пропускать к приложению API все запросы и не выполнять никаких действий для проверки информации о проверке подлинности.

	В этом варианте задачи проверки подлинности и авторизации полностью ложатся на код приложения.

На [портале Azure](https://portal.azure.com/), выберите нужный вариант в колонке **Проверка подлинности и авторизация**.

![](./media/app-service-api-authentication/authblade.png)

Для вариантов 1 и 2, включите **проверку подлинности службы приложений**, а в раскрывающемся списке **Действие, выполняемое, если запрос не прошел проверку подлинности** выберите вариант **Вход** или **Разрешить запрос (никаких действий)**. Если вы выберете вариант **Вход**, нужно выбрать поставщик проверки подлинности и указать для него конфигурацию.

![](./media/app-service-api-authentication/actiontotake.png)
 
## Независимость от языка

Обработка проверки подлинности в службе приложений происходит до того, как запрос достигнет приложении API. Это означает, что функции проверки подлинности будут одинаково работать для приложений API, написанных на любом языке и на любой платформе. API может основываться на ASP.NET, Java, Node.js или любой платформе, которую поддерживает служба приложений.

Служба приложений передает приложению маркер JWT, который приходит в заголовке авторизации HTTP-запроса. Дальше код на любом языке или на любой платформе может получить из маркера необходимые сведения. Кроме того, служба приложений позволяет упростить доступ к самым часто используемым утверждениям. Служба задает некоторые специальные заголовки, как например:

* X-MS-CLIENT-PRINCIPAL-NAME
* X-MS-CLIENT-PRINCIPAL-ID
* X-MS-TOKEN-FACEBOOK-ACCESS-TOKEN
* X-MS-TOKEN-FACEBOOK-EXPIRES-ON
 
В API .NET можно использовать атрибут `Authorize`, а для точной авторизации нетрудно написать код на основе утверждений, поскольку вся эта информация занесена для вас в классы .NET.

## Проверка подлинности субъекта-службы

Вы можете использовать проверку подлинности службы приложений в сценариях внутреннего взаимодействия, например для обращения одного приложения API к другому приложению API. В этом случае для проверки подлинности используются учетные данные службы вместо учетных данных пользователя. Учетная запись службы называется также *субъект-службой*, а проверку подлинности с использованием такой учетной записи называют также сценарием взаимодействия между службами.

В сценариях внутреннего взаимодействия вы можете защитить вызываемое приложение API с помощью Azure Active Directory, а для вызова этого приложения API предоставлять маркер AAD авторизации субъекта-службы. Вы можете запросить маркер из приложения AAD, предоставляя идентификатор клиента и секрет клиента. Не требуется использование специального кода для Azure, в отличие, например, от обработки токена Zumo мобильных служб. Пример такого сценария для приложений API ASP.NET приводится в руководстве [Проверка подлинности с использованием субъекта-службы для приложений API в службе приложений Azure](app-service-api-dotnet-service-principal-auth.md).

Если в сценарии взаимодействия между службами вы хотите обойтись без проверки подлинности службы приложений, используйте сертификаты клиентов или базовую проверку подлинности. Сведения о клиентских сертификатах в Azure см. в статье [Настройка взаимной проверки подлинности TLS для веб-приложения](../app-service-web/app-service-web-configure-tls-mutual-auth.md).

Отдельно следует рассмотреть проверку подлинности субъекта-службы из приложения логики службы приложений. Она описана в статье [Использование настраиваемого интерфейса API, размещенного в службе приложений, с приложениями логики](../app-service-logic/app-service-logic-custom-hosted-api.md).

## Дополнительные сведения

Дополнительные сведения о службах проверки подлинности и авторизации в службе приложений Azure см. в статье [Развертывание проверки подлинности и авторизации службы приложений](/blog/announcing-app-service-authentication-authorization/).

## Дальнейшие действия

В этой статье вы познакомились с функциями проверки подлинности и авторизации, которые существуют для приложений API службы приложений.

Если вы по порядку изучаете руководства серии «Приступая к работе», посвященные ASP.NET и приложениям API, потренируйтесь использовать эти функции в следующем руководстве [Проверка подлинности пользователя для приложений API в службе приложений Azure](app-service-api-dotnet-user-principal-auth.md).

Дополнительные сведения об использовании Node и Java в службе приложений Azure см. в документации [центра разработчиков Node.js](/develop/nodejs/) и [центра разработчиков Java](/develop/java/).

<!---HONumber=AcomDC_1210_2015-->