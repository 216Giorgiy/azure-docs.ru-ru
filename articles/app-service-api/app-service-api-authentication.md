<properties
	pageTitle="Проверка подлинности и авторизация для приложений API в службе приложений Azure | Microsoft Azure"
	description="Узнайте о функциях проверки подлинности и авторизации, которые служба приложений Azure предоставляет для приложений API."
	services="app-service\api"
	documentationCenter=".net"
	authors="tdykstra"
	manager="wpickett"
	editor=""/>

<tags
	ms.service="app-service-api"
	ms.workload="na"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="hero-article"
	ms.date="01/07/2016"
	ms.author="tdykstra"/>

# Проверка подлинности и авторизация для приложений API в службе приложений Azure

[AZURE.INCLUDE [app-service-api-get-started-selector](../../includes/app-service-api-get-started-selector.md)]

## Обзор 

В службе приложений Azure есть встроенные службы проверки подлинности и авторизации, которые реализуют протоколы [OAuth 2.0](#oauth) и [OpenID Connect](#oauth). В этой статье описаны службы и параметры, доступные для приложений API в службе приложений Azure.

Следующая схема иллюстрирует важные характеристики проверки подлинности в службе приложений.

* Выполняется предварительная обработка входящих запросов API. Это означает, что проверка подлинности работает с любыми языками и средами, которые поддерживает служба приложений.
* Вы можете выбрать, насколько подробной должна быть проверка подлинности в коде приложения.
* Выполняется проверка подлинности как конечных пользователей, так и учетных записей служб. 
* Поддерживаются пять поставщиков удостоверений: Azure Active Directory, Facebook, Google, Twitter и учетная запись Майкрософт.
* Работает одинаково для приложений API, веб-приложений и мобильных приложений.

![](./media/app-service-api-authentication/api-apps-overview.png)

## Независимость от языка

Обработка проверки подлинности в службе приложений происходит до того, как запрос достигнет приложении API. Это означает, что функции проверки подлинности будут одинаково работать для приложений API, написанных на любом языке и на любой платформе. API может основываться на ASP.NET, Java, Node.js или любой платформе, которую поддерживает служба приложений.

Служба приложений передает приложению веб-маркер JSON (JWT), который приходит в заголовке авторизации HTTP-запроса. Дальше код (на любом языке или на любой платформе) может получить из маркера необходимые сведения. Кроме того, служба приложений позволяет упростить доступ к самым часто используемым утверждениям. Служба задает некоторые специальные заголовки, как например:

* X-MS-CLIENT-PRINCIPAL-NAME
* X-MS-CLIENT-PRINCIPAL-ID
* X-MS-TOKEN-FACEBOOK-ACCESS-TOKEN
* X-MS-TOKEN-FACEBOOK-EXPIRES-ON
 
В API .NET можно использовать атрибут `Authorize`, а для точной авторизации нетрудно написать код на основе утверждений, поскольку вся эта информация занесена для вас в классы .NET.

## Варианты защиты

Служба приложений может предотвращать поступление анонимных HTTP-запросов в приложение API, передавать все запросы и проверять маркеры на предмет содержащихся в них запросов либо пропускать все запросы, не выполняя с ними никаких действий.

1. Пропускать к приложению API только запросы, прошедшие проверку подлинности.

	Если из браузера приходит анонимный запрос, служба приложений перенаправляет его на страницу входа.

	Это удобно, если заранее известно, какой поставщик проверки подлинности будет использоваться (Google, Twitter и др.). Служба приложений возьмет на себя работу по обработке входа. Также можно указать собственный URL-адрес, на который служба приложений будет перенаправлять анонимные запросы. Тогда вы сможете предоставить пользователям несколько поставщиков проверки подлинности на выбор.

	В этом варианте в приложении не нужно создавать код проверки подлинности. Авторизация становится проще, поскольку наиболее важные утверждения предоставляются в заголовках HTTP.

2. Пропускать к приложению API все запросы, но проверять запросы проверки подлинности и передавать в заголовках HTTP сведения о проверке подлинности.

	Такой вариант дает вам больше гибкости в обработке анонимных запросов и позволяет легко написать код, который будет обращаться к наиболее распространенным утверждениям. В отличие от варианта 1, здесь вам потребуется написать код, если нужно закрыть API от анонимных пользователей.

3. Пропускать к приложению API все запросы и не выполнять никаких действий для проверки информации о проверке подлинности.

	В этом варианте задачи проверки подлинности и авторизации полностью ложатся на код приложения.

На [портале Azure](https://portal.azure.com/), выберите нужный вариант в колонке **Проверка подлинности и авторизация**.

![](./media/app-service-api-authentication/authblade.png)

Для вариантов 1 и 2 включите **проверку подлинности службы приложений**, а в раскрывающемся списке **Действие, выполняемое, если запрос не прошел проверку подлинности** выберите вариант **Вход** или **Разрешить запрос (не выполнять никаких действий)**. Если вы выберете вариант **Вход**, нужно выбрать поставщик проверки подлинности и указать для него конфигурацию.

![](./media/app-service-api-authentication/actiontotake.png)
 
## <a id="internal"></a> Проверка подлинности учетной записи службы

Проверка подлинности службы приложений эффективна при внутреннем взаимодействии, например при обращении одного приложения API к другому. В этом случае для получения маркера используются учетные данные службы вместо учетных данных пользователя. Учетная запись службы также называется *субъектом-службой*, а проверка подлинности с использованием такой учетной записи называется сценарием взаимодействия между службами.

При взаимодействии между службами вызываемое приложение API можно защитить с помощью Azure Active Directory, а для вызова этого приложения API можно предоставить маркер авторизации субъекта-службы AAD. Вы можете получить маркер из приложения AAD, предоставив идентификатор и секрет клиента. Не требуется использование специального кода для Azure, в отличие, например, от обработки токена Zumo мобильных служб. Пример такого сценария для приложений API ASP.NET приводится в руководстве [Проверка подлинности с использованием субъекта-службы для приложений API в службе приложений Azure](app-service-api-dotnet-service-principal-auth.md).

Если в сценарии взаимодействия между службами вы хотите обойтись без проверки подлинности службы приложений, используйте сертификаты клиентов или базовую проверку подлинности. Сведения о клиентских сертификатах в Azure см. в статье [Настройка взаимной проверки подлинности TLS для веб-приложения](../app-service-web/app-service-web-configure-tls-mutual-auth.md). Сведения об обычной проверке подлинности в ASP.NET см. в статье [Authentication Filters in ASP.NET Web API 2](http://www.asp.net/web-api/overview/security/authentication-filters) (Фильтры проверки подлинности в веб-API 2 ASP.NET).

Отдельно следует рассмотреть проверку подлинности учетной записи службы из приложения логики службы приложений. Она описана в статье [Использование настраиваемого интерфейса API, размещенного в службе приложений, с приложениями логики](../app-service-logic/app-service-logic-custom-hosted-api.md).

## Проверка подлинности клиента

Сведения о способах обработки проверки подлинности от мобильных клиентов см. в [документации о проверке подлинности для мобильных приложений](../app-service-mobile/app-service-mobile-ios-get-started-users.md). Проверка подлинности службы приложений работает одинаково для мобильных приложений и приложений API.
  
## Дополнительные сведения

Дополнительные сведения о проверке подлинности и авторизации в службе приложений Azure см. в блоге [Expanding App Service Authentication/Authorization](/blog/announcing-app-service-authentication-authorization/) (Расширение возможностей для проверки подлинности и авторизации службы приложений).

Дополнительные сведения о протоколах OAuth 2.0, OpenID Connect и веб-маркерах JSON (JWT) см. в следующих статьях:

* [Приступая к работе с протоколом OAuth 2.0](http://shop.oreilly.com/product/0636920021810.do "Приступая к работе с протоколом OAuth 2.0") 
* [Общие сведения о протоколах OAuth2, OpenID Connect и JSON Web Tokens (JWT), курс PluralSight](http://www.pluralsight.com/courses/oauth2-json-web-tokens-openid-connect-introduction) 
* [Построение и защита RESTful API для нескольких клиентов в ASP.NET, курс PluralSight](http://www.pluralsight.com/courses/building-securing-restful-api-aspdotnet)

Дополнительные сведения о проверке подлинности с помощью Azure Active Directory см. в следующих статьях:

* [Сценарии проверки подлинности в Azure AD](http://aka.ms/aadscenarios)
* [Руководство разработчика по Azure Active Directory](http://aka.ms/aaddev)
* [Azure Samples](http://aka.ms/aadsamples) (Примеры для Azure)

## Дальнейшие действия

В этой статье вы познакомились с функциями проверки подлинности и авторизации службы приложений, которые можно использовать для приложений API.

Если вы по порядку изучаете руководства серии «Приступая к работе», посвященные ASP.NET и приложениям API, потренируйтесь использовать эти функции, выполнив инструкции, описанные в руководстве [Проверка подлинности пользователя для приложений API в службе приложений Azure](app-service-api-dotnet-user-principal-auth.md).

Дополнительные сведения об использовании Node и Java в службе приложений Azure см. в документации [центра разработчиков Node.js](/develop/nodejs/) и [центра разработчиков Java](/develop/java/).

<!---HONumber=AcomDC_0114_2016-->