---
title: Безопасность сети в Azure Data Lake Storage 1-го поколения | Документация Майкрософт
description: Общие сведения о том, как брандмауэр для IP-адресов и интеграция с виртуальной сетью работают в Azure Data Lake Storage 1-го поколения.
services: data-lake-store
documentationcenter: ''
author: nitinme
manager: jhubbard
editor: cgronlun
ms.service: data-lake-store
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 10/09/2018
ms.author: elsung
ms.openlocfilehash: 0da5962bc0b48a387ee82a1db36099682e14bca3
ms.sourcegitcommit: c282021dbc3815aac9f46b6b89c7131659461e49
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/12/2018
ms.locfileid: "49168192"
---
# <a name="virtual-network-integration-for-azure-data-lake-storage-gen1---preview"></a>Интеграция с виртуальной сетью для Azure Data Lake Storage 1-го поколения (предварительная версия)

Представляем интеграцию с виртуальной сетью для Azure Data Lake Storage 1-го поколения (в предварительной версии). Интеграция с виртуальной сетью позволяет предотвратить несанкционированный доступ к учетным записям Azure Data Lake Storage 1-го поколения путем предоставления доступа к этим учетным записям только определенным виртуальным сетям и подсетям. Теперь вы можете настроить учетную запись ADLS 1-го поколения принимать трафик только из указанных виртуальных сетей и подсетей и блокировать доступ из любых других расположений. Это помогает защитить учетную запись ADLS от внешних угроз.

Функция интеграции с виртуальной сетью для ADLS 1-го поколения использует безопасность на уровне конечной точки службы виртуальной сети между виртуальной сетью и службой Azure Active Directory для создания дополнительных утверждений безопасности в маркере доступа. Эти утверждения используются для проверки подлинности виртуальной сети в учетной записи ADLS 1-го поколения и для предоставления доступа.

> [!NOTE]
> Эта технология находится в предварительной версии. Мы не рекомендуем использовать ее в рабочих средах.
>
> За использование этих возможностей не взимается дополнительная плата. Учетной записи будет выставлен счет по стандартному тарифу за ADLS 1-го поколения ([сведения о ценах](https://azure.microsoft.com/pricing/details/data-lake-store/?cdn=disable)) и за все используемые службы Azure ([сведения о ценах](https://azure.microsoft.com/pricing/#product-picker)).

## <a name="scenarios-for-vnet-integration-for-adls-gen1"></a>Сценарии для интеграции с виртуальной сетью для ADLS 1-го поколения

Функция интеграции с виртуальной сетью службы ADLS 1-го поколения позволяет предоставить доступ к учетной записи ADLS 1-го поколения только из указанных виртуальных сетей и подсетей.  Другие виртуальные сети и виртуальные машины не смогут подключиться к вашей учетной записи, после того как она будет привязана к указанной подсети виртуальной сети.  С функциональной точки зрения интеграция с виртуальной сетью службы ADLS 1-го поколения реализует тот же сценарий, что и [конечные точки службы виртуальной сети](https://docs.microsoft.com/azure/virtual-network/virtual-network-service-endpoints-overview).  Существует ряд ключевых различий, которые описаны в приведенных ниже разделах. 

![Схема сценария интеграции с виртуальной сетью для ADLS 1-го поколения](media/data-lake-store-network-security/scenario-diagram.png)

> [!NOTE]
> В дополнение к правилам виртуальной сети могут использоваться существующие правила брандмауэра для IP-адресов, чтобы также разрешать доступ из локальных сетей. 

## <a name="optimal-routing-with-adls-gen1-vnet-integration"></a>Оптимальная маршрутизация при интеграции с виртуальной сетью для ADLS 1-го поколения

Ключевым преимуществом конечных точек службы виртуальной сети является [оптимальная маршрутизация](https://docs.microsoft.com/azure/virtual-network/virtual-network-service-endpoints-overview#key-benefits) из виртуальной сети.  Чтобы достичь той же оптимизации маршрутизации для учетных записей ADLS 1-го поколения, используйте следующие [определяемые пользователем маршруты](https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview#user-defined) из виртуальной сети к учетным записям ADLS 1-го поколения:

- **Общедоступный IP-адрес ADLS**. Используйте общедоступный IP-адрес для целевых учетных записей ADLS 1-го поколения.  IP-адреса для учетных записей ADLS 1-го поколения данных можно определить, [разрешая их DNS-имена](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-connectivity-from-vnets#enabling-connectivity-to-azure-data-lake-storage-gen1-from-vms-with-restricted-connectivity).  Создайте отдельную запись для каждого адреса.

```azurecli
# Create a Route table for your resource group
az network route-table create --resource-group $RgName --name $RouteTableName

# Create Route Table Rules for ADLS Public IP Addresses
# There will be one rule per ADLS Public IP Addresses 
az network route-table route create --name toADLSregion1 --resource-group $RgName --route-table-name $RouteTableName --address-prefix <ADLS Public IP Address> --next-hop-type Internet

# Update the VNet and apply the newly created Route Table to it
az network vnet subnet update --vnet-name $VnetName --name $SubnetName --resource-group $RgName --route-table $RouteTableName
```

## <a name="data-exfiltration-from-the-customer-vnet"></a>Утечка данных из виртуальной сети клиента

Помимо защиты доступа к учетным записям ADLS из виртуальной сети, вы также можете убедиться в отсутствии утечки данных в несанкционированную учетную запись.

Мы рекомендуем использовать в виртуальной сети брандмауэр, чтобы фильтровать исходящий трафик на основе URL-адреса учетной записи назначения и разрешать доступ только авторизованным учетным записям ADLS 1-го поколения.

Ниже приведены некоторые доступные варианты.
- [Брандмауэр Azure](https://docs.microsoft.com/azure/firewall/overview). Вы можете [развернуть и настроить службу "Брандмауэр Azure"](https://docs.microsoft.com/azure/firewall/tutorial-firewall-deploy-portal) для виртуальной сети, чтобы защитить исходящий трафик ADLS и ограничить его URL-адресом известной авторизованной учетной записи.
- Брандмауэр [сетевого виртуального модуля](https://azure.microsoft.com/solutions/network-appliances/). Если администратор разрешает использовать только определенных поставщиков коммерческих брандмауэров, решение брандмауэра сетевого виртуального модуля, доступное в Azure Marketplace, можно использовать для выполнения той же функции.

> [!NOTE]
> При использовании брандмауэров в пути к данным появляется дополнительный прыжок, что может влиять на производительность сети в комплексных сценариях обмена данными, в том числе на доступную пропускную способность и задержку при подключении. 

## <a name="limitations"></a>Ограничения
1.  После добавления кластеров HDInsight в предварительную версию их необходимо создать заново.  Кластеры, созданные до поддержки интеграции с виртуальной сетью для ADLS 1-го поколения, необходимо пересоздать, чтобы они поддерживали новую функцию. 
2.  При создании нового кластера HDInsight выбор учетной записи ADLS 1-го поколения с включенной интеграцией с виртуальной сетью вызовет сбой процесса. Сначала необходимо отключить правило виртуальной сети или **разрешить доступ изо всех сетей и служб** в колонке **Брандмауэр и виртуальные сети** учетной записи ADLS.  Дополнительные сведения см. в разделе [Исключения](##Exceptions).
3.  Предварительная версия функции интеграции с виртуальной сетью для ADLS 1-го поколения не работает с [управляемыми удостоверениями ресурсов Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview).  
4.  Данные файлов и папок в учетной записи ADLS 1-го поколения с поддержкой интеграции с виртуальной сетью недоступны на портале.  Это включает доступ из виртуальной машины, которая находится в пределах виртуальной сети, и такие действия, как использование Data Explorer.  Действия по управлению учетными записями будут работать.  Данные файлов и папок в учетной записи ADLS с интеграцией с виртуальной сетью доступны через все ресурсы вне портала: пакет SDK для доступа, скрипты PowerShell, другие службы Azure (когда поступают не с портала) и т. д. 

## <a name="configuration"></a>Параметр Configuration

### <a name="step1-configure-your-vnet-to-use-aad-service-endpoint"></a>Шаг 1. Настройка виртуальной сети для использования конечной точки службы AAD
1.  Перейдите на портал Azure и войдите в свою учетную запись. 
2.  [Создайте виртуальную сеть](https://docs.microsoft.com/azure/virtual-network/quick-create-portal) в подписке или перейдите к существующей виртуальной сети.  Виртуальная сеть должна находиться в том же регионе, что и учетная запись ADLS 1-го поколения. 
3.  В колонке виртуальной сети выберите **Конечные точки службы**. 
4.  Нажмите кнопку **Добавить**, чтобы добавить новую конечную точку службы.
![Добавление конечной точки службы виртуальной сети](media/data-lake-store-network-security/config-vnet-1.png)
5.  Выберите **Microsoft.AzureActiveDirectory** как службу для конечной точки.
![Выбор конечной точки службы Microsoft.AzureActiveDirectory](media/data-lake-store-network-security/config-vnet-2.png)
6.  Выберите подсети, для которых вы собираетесь разрешить подключения, а затем щелкните **Добавить**.
![Выбор подсети](media/data-lake-store-network-security/config-vnet-3.png)
7.  Добавление конечной точки службы может занять до 15 минут. После добавления она будет отображаться в списке. Убедитесь, что конечная точка отображается и все сведения соответствуют настройкам. 
![Успешное добавление конечной точки службы](media/data-lake-store-network-security/config-vnet-4.png)

### <a name="step-2-set-up-the-allowed-vnetsubnet-for-your-adls-gen1-account"></a>Шаг 2. Настройка разрешенной виртуальной сети или подсети для учетной записи ADLS 1-го поколения
1.  После настройки виртуальной сети [создайте учетную запись Azure Data Lake Storage 1-го поколения](data-lake-store-get-started-portal.md#create-a-data-lake-storage-gen1-account) в подписке или перейдите к существующей учетной записи ADLS 1-го поколения. Учетная запись ADLS 1-го поколения должна находиться в том же регионе, что и виртуальная сеть. 
2.  Выберите пункт **Брандмауэр и виртуальные сети**.

  > [!NOTE]
  > Если вы не видите пункт **Брандмауэр и виртуальные сети** в параметрах, тогда следует выйти из портала. Закройте браузер. Очистите кэш браузера. Перезапустите компьютер и повторите попытку.

  ![Добавление правила виртуальной сети к учетной записи ADLS](media/data-lake-store-network-security/config-adls-1.png)
3.  Выберите **Выбранные сети**. 
4.  Щелкните **Добавить существующую виртуальную сеть**.
  ![Добавление существующей виртуальной сети](media/data-lake-store-network-security/config-adls-2.png)
5.  Выберите виртуальные сети и подсети, чтобы разрешить подключение, а затем щелкните **Добавить**.
  ![Создание виртуальной сети и подсетей](media/data-lake-store-network-security/config-adls-3.png)
6.  Убедитесь, что виртуальные сети и подсети отображаются в списке корректно, и нажмите кнопку **Сохранить**.
  ![Сохранение нового правила](media/data-lake-store-network-security/config-adls-4.png)

  > [!NOTE]
  > Вступление изменений в силу после сохранения может занять до 5 минут.

7.  [Необязательно.] Если помимо виртуальных сетей и подсетей вы хотите разрешить подключения с определенных IP-адресов, это можно сделать в разделе **брандмауэра** на той же странице. 

## <a name="exceptions"></a>Исключения
В области "Исключения" колонки **Брандмауэр и виртуальные сети** есть два флажка, которые разрешают подключение из набора служб и виртуальных машин в Azure.
![Исключения брандмауэра и виртуальной сети](media/data-lake-store-network-security/firewall-exceptions.png)
- Параметр **Разрешить всем службам Azure доступ к этой учетной записи Data Lake Storage 1-го поколения** разрешает доступ всем службам Azure, таким как Фабрика данных Azure, Центры событий, все Azure виртуальные машины и т. д., взаимодействовать с учетной записью ADLS.

- Параметр **Разрешить Azure Data Lake Analytics доступ к этой учетной записи Data Lake Storage 1-го поколения** разрешает подключение службы Azure Data Lake Analytics к этой учетной записи ADLS. 

Мы рекомендуем включать эти исключения только в том случае, если вам нужно подключение из других служб за пределами виртуальной сети.
