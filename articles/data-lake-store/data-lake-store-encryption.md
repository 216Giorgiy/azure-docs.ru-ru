---
title: "Шифрование в Azure Data Lake Store | Документация Майкрософт"
description: "Узнайте, как действует шифрование и смена ключей в Azure Data Lake Store"
services: data-lake-store
documentationcenter: 
author: yagupta
manager: 
editor: 
ms.assetid: 
ms.service: data-lake-store
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 4/14/2017
ms.author: yagupta
ms.translationtype: Human Translation
ms.sourcegitcommit: db034a8151495fbb431f3f6969c08cb3677daa3e
ms.openlocfilehash: 9bd9996a4a22b2f57510b6f3b6625e22b3183b1c
ms.contentlocale: ru-ru
ms.lasthandoff: 04/29/2017

---

# <a name="encryption-of-data-in-azure-data-lake-store"></a>Шифрование данных в Azure Data Lake Store

## <a name="overview-of-encryption-in-azure-data-lake-store"></a>Общие сведения о шифровании в Azure Data Lake Store

Шифрование в Azure Data Lake Store (ADLS) предоставляет возможность защиты данных, внедрения корпоративных политик безопасности и соответствия нормативным требованиям. В этой статье содержится обзор архитектуры и рассматриваются технические аспекты реализации шифрования данных в Data Lake Store.

ADLS поддерживает прозрачное шифрование неактивных данных, включенное по умолчанию. Далее упомянутые термины представлены подробнее.

* Включение по умолчанию. При создании учетной записи Azure Data Lake Store параметр по умолчанию включает шифрование. Поэтому данные, хранящиеся в Data Lake Store, всегда шифруются перед сохранением на постоянный носитель. Это касается всех данных, и это нельзя изменить после создания учетной записи.
* Прозрачность. ADLS автоматически шифрует данные перед сохранением и расшифровывает их до извлечения. За настройку шифрования и управление им на уровне Data Lake Store отвечает администратор. API доступа к данным не изменяются. Таким образом, для шифрования не требуется изменять приложения и службы, взаимодействующие с Data Lake Store.

Передаваемые (перемещаемые) данные также шифруются в Data Lake Store. Данные не только шифруются перед сохранением на постоянный носитель, но и всегда защищены при передаче за счет использования протокола HTTPS (HTTP через SSL). HTTPS — единственный протокол, который поддерживают интерфейсы REST Data Lake Store.

![На рисунке 1](./media/data-lake-store-encryption/fig1.png)


## <a name="setting-up-encryption-with-azure-data-lake-store"></a>Настройка шифрования с помощью Azure Data Lake Store

Шифрование для Azure Data Lake Store настраивается во время создания учетной записи. Оно всегда включено по умолчанию. Пользователи могут сами управлять ключами или передать эту функцию Azure Data Lake Store (по умолчанию).

Дополнительные сведения о настройке шифрования с помощью Azure Data Lake Store см. в статье [Начало работы с хранилищем озера данных Azure с помощью портала Azure](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).

## <a name="under-the-hood--how-encryption-works-in-azure-data-lake-store"></a>Как действует шифрование в Azure Data Lake Store

### <a name="master-encryption-keys"></a>Главные ключи шифрования

В Azure Data Lake Store предусмотрено два режима для управления главными ключами шифрования. Использование главных ключей шифрования описано подробнее ниже. Сейчас давайте предположим, что главный ключ шифрования является ключом верхнего уровня. Для расшифровки любых данных, хранящихся в Data Lake Store, требуется доступ к главному ключу шифрования.

Ниже приведены два режима управления главным ключом шифрования.

1.    Служба управляет ключами.
2.    Клиент управляет ключами.

В обоих режимах защита главного ключа шифрования обеспечивается за счет его сохранения в Azure Key Vault. Azure Key Vault — полностью управляемая служба высокого уровня безопасности в Azure, которую можно использовать для защиты криптографических ключей. С дополнительными сведениями об Azure Key Vault можно ознакомиться [здесь](https://azure.microsoft.com/services/key-vault).

Вот краткое сравнение возможностей, предоставляемых в двух режимах управления главными ключами шифрования.

|  | Служба управляет ключами | Клиент управляет ключами |
| --- | --- | --- |
|Способ хранения данных|Шифрование перед сохранением|Шифрование перед сохранением|
|Где хранится главный ключ шифрования?|Хранилище ключей Azure|Хранилище ключей Azure|
|Хранятся ли ключи шифрования в незашифрованном виде за пределами Azure Key Vault?|Нет|Нет|
|Можно ли извлечь главный ключ шифрования из Azure Key Vault?|Нет. После сохранения в Key Vault его можно использовать только для шифрования и расшифровки.|Нет. После сохранения в Key Vault его можно использовать только для шифрования и расшифровки.|
|Кто является владельцем Azure Key Vault и главного ключа шифрования?|Служба Azure Data Lake Store.|Клиенту принадлежит Azure Key Vault, которой находится в его подписке Azure. Главным ключом шифрования в Key Vault может управлять программное обеспечение или оборудование (HSM).|
|Может ли клиент отменить доступ службы Azure Data Lake Store к главному ключу шифрования?|Нет|Да. Клиент может управлять списками управления доступом в Azure Key Vault и удалять записи управления доступом в удостоверении службы Azure Data Lake Store.|
|Может ли клиент окончательно удалить главный ключ шифрования?|Нет|Да. Если клиент удаляет главный ключ шифрования из Azure Key Vault, данные в учетной записи ADLS невозможно будет расшифровать даже службе Azure Data Lake Store. <br><br> Если клиент создал явную резервную копию главного ключа шифрования до его удаления из Azure Key Vault, его и данные можно будет восстановить. Тем не менее если не сделать этого, данные в учетной записи ADLS невозможно будет расшифровать.|


Кроме отличий верхнего уровня (управление главным ключом шифрования и Key Vault, в котором он находится), в остальном оба режима похожи.

Выбирая режим управления главными ключами шифрования, не забывайте о следующих важных аспектах.

1.    Режим управления ключами можно выбрать при подготовке учетной записи ADLS.
2.    После подготовки учетной записи ADLS нельзя изменить этот режим.

### <a name="encryption-and-decryption-of-data"></a>Шифрование и расшифровка данных

При шифровании данных в Azure Data Lake используется три вида ключа. В следующей таблице перечислены функции каждого из них.

| Ключ                   | Сокращение | С чем связан | Место хранения                             | Тип       | Примечания                                                                                                   |
|-----------------------|--------------|-----------------|----------------------------------------------|------------|---------------------------------------------------------------------------------------------------------|
| Главный ключ шифрования | MEK          | Учетная запись ADLS | Хранилище ключей Azure                              | Асимметричный | Им может управлять ADLS или клиент                                                              |
| Ключ шифрования данных   | DEK          | Учетная запись ADLS | Постоянное хранилище (управляет служба ADLS) | Симметричный  | Ключ шифрования данных шифрует главный ключ шифрования. Зашифрованный ключ шифрования данных хранится на постоянном носителе. |
| Ключ блочного шифрования  | BEK          | Блок данных | None                                         | Симметричный  | Ключ блочного шифрования можно получить на основе ключа шифрования данных и блока данных                                                      |

Эти концепции представлены на схеме ниже.

![Рисунок 2](./media/data-lake-store-encryption/fig2.png)

#### <a name="pseudo-algorithm-when-a-file-is-to-be-decrypted"></a>Псевдоалгоритм расшифровки файла:
1.    Проверьте, кэширован ли ключ шифрования данных для учетной записи ADLS и готов ли он к использованию.
    * В противном случае считайте зашифрованный ключ шифрования данных из постоянного хранилища и отправьте его в Azure Key Vault для расшифровки. Кэшируйте расшифрованный ключ шифрования данных в памяти. Теперь его можно использовать.
2.    Для каждого блока данных в файле сделайте следующее:
    * Считайте зашифрованный блок данных из постоянного хранилища.
    * Создайте ключ блочного шифрования на основе ключа шифрования данных и зашифрованного блока данных.
    * Используйте ключ блочного шифрования для расшифровки данных.
#### <a name="pseudo-algorithm-when-a-block-of-data-is-to-be-encrypted"></a>Псевдоалгоритм шифрования блока данных:
1.    Проверьте, кэширован ли ключ шифрования данных для учетной записи ADLS и готов ли он к использованию.
    * В противном случае считайте зашифрованный ключ шифрования данных из постоянного хранилища и отправьте его в Azure Key Vault для расшифровки. Кэшируйте расшифрованный ключ шифрования данных в памяти. Теперь его можно использовать.
2.    Создайте уникальный ключ блочного шифрования для блока данных на основе ключа шифрования данных.
3.    Зашифруйте блок данных с помощью ключа блочного шифрования, используя шифрование AES-256.
4.    Сохраните зашифрованный блок данных в постоянном хранилище.

> [!NOTE] 
> По соображениям производительности ключ шифрования данных (DEK) в незашифрованном виде ненадолго кэшируется в памяти и сразу удаляется после этого. Ключ шифрования данных на постоянном носителе всегда хранится в зашифрованном виде. За хранение отвечает главный ключ шифрования (MEK).

## <a name="key-rotation"></a>Смена ключей

Azure Data Lake Store позволяет менять главный ключ шифрования (MEK) при использовании ключей, управляемых клиентом. Дополнительные сведения о настройке учетной записи ADLS с ключами, управляемыми клиентами, см. на странице [Начало работы с хранилищем озера данных Azure с помощью портала Azure](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).

### <a name="pre-requisites"></a>Предварительные требования

При настройке учетной записи Azure Data Lake клиенты решают использовать собственные ключи. Этот параметр нельзя изменить после создания учетной записи. При использовании параметров по умолчанию данные шифруются с использованием ключей, управляемых Azure Data Lake. В этом случае клиент не может менять ключи, так как ими управляет Azure Data Lake. Ниже предполагается, что вы используете ключи, управляемые клиентом (если вы выбрали собственные ключи из Key Vault).

### <a name="how-to-rotate-the-key-mek-in-azure-data-lake-store"></a>Как сменить ключ (MEK) в Azure Data Lake Store

1. Войдите на новый [портал Azure](https://portal.azure.com/).
2. Перейдите в Key Vault, в котором хранятся ключи, связанные с вашей учетной записью Azure Data Lake Store. Выберите ключи.

    ![ключей](./media/data-lake-store-encryption/keyvault.png)

3.    Выберите ключ, связанный с учетной записью Azure Data Lake Store, и создайте новую версию этого ключа.
  
   На этом этапе Azure Data Lake поддерживает только смену ключей до новой версии ключа. Смена в обратном направлении не поддерживается.

   ![новая версия](./media/data-lake-store-encryption/keynewversion.png)

4.    Перейдите к учетной записи Azure Data Lake и выберите "Шифрование".

    ![новая версия](./media/data-lake-store-encryption/select-encryption.png)

5.    Появится примечание о том, что доступна новая версия ключа, и кнопка для соответствующей смены ключа. Нажмите кнопку для смены ключа, чтобы обновить ключ до новой версии.

    ![Готово](./media/data-lake-store-encryption/rotatekey.png)

6. Эта операция занимает меньше 2 минут и не вызывает простоя. После завершения операции будет использоваться новая версия ключа.

