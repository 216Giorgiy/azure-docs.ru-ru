<properties title="Manage your Search service on Microsoft Azure" pageTitle="Manage your Search service on Microsoft Azure" description="Manage your Search service on Microsoft Azure" metaKeywords="" services="" solutions="" documentationCenter="" authors="heidist" videoId="" scriptId="" />

# Управление службой Поиска в Microsoft Azure

[WACOM.INCLUDE [В этой статье используется портал предварительной версии Azure](../includes/preview-portal-note.md)]

Поиск Azure — это облачная служба и интерфейса API на базе HTTP, которые можно использовать в пользовательских приложениях поиска. Наша служба Поиска предоставляет систему для анализа полнотекстового поиска, дополнительных возможностей поиска, хранения, а также синтаксис для команд запросов.

В данной статье разъясняется, каким образом управлять службой Поиска в Microsoft Azure.

Как отмечено ранее, для административных задач будет задействован новый портал предварительной версии. Поиск Azure недоступен в более ранних версиях портала. API управления службой будет доступен в скором времени, что позволит создавать сценарии для общих задач управления.

<!--TOC-->

-   [Подключение службы поиска к подписке][Подключение службы поиска к подписке]
-   [Административные задачи][Административные задачи]
-   [URL-адрес службы][URL-адрес службы]
-   [Управление ключами API][Управление ключами API]
-   [Отслеживание использования ресурсов][Отслеживание использования ресурсов]
-   [Масштабирование вверх или вниз][Масштабирование вверх или вниз]
-   [Запуск и останов службы][Запуск и останов службы]

## Подключение службы поиска к подписке

Как администратор, вы можете добавить поиск в существующую подписку Azure с помощью нового [портала предварительной версии Azure][портала предварительной версии Azure]. Добавлять новые возможности в подписку могут только администраторы. При настройке службы можно выбрать один из двух уровней ценообразования.

Бесплатный доступ для существующих подписчиков. Вы можете использовать общую службу, это рекомендуется делать в целях обучения, экспериментального тестирования или для разработки небольших проектов. Общая служба ограничена 50 МБ хранилища, тремя индексами и числом документов (жесткий предел 10000 документов), даже если потребление хранилища не превышает разрешенные 50 МБ. Для общей службы отсутствуют какие-либо гарантии показателей производительности, так что если вы создаете рабочее приложение поиска, лучше выбрать стандартную службу вместо общей.

Стандартная служба оплачиваемая, потому что вы, подписавшись на выделенные ресурсы и инфраструктуру, используете их только для вашей подписки. Стандартный поиск размещен в определяемых пользователем разделах (хранения) и реплик (нагрузках служб), ценообразование осуществляется за единицу поиска. Вы можете независимо масштабировать на разделы или реплики, добавляя больше тех ресурсов, которые требуются.

Чтобы спланировать емкость и оценить влияние на стоимость, мы рекомендуем эти ссылки:

-   [Пределы и ограничения][Пределы и ограничения]
-   [Сведения о ценах][Сведения о ценах]

Когда вы будете готовы к подписке, см. раздел [Настройка поиска на портале предварительной версии Azure][Настройка поиска на портале предварительной версии Azure].

## Административные задачи

Хотя для некоторых служб могут иметься соадминистраторы, служба Поиска Azure имеет единственного администратора подписки. Вы должны быть администратором для выполнения задач, изложенных в настоящем разделе.
Помимо добавления Поиска в подписку администратор отвечает за выполнение этих дополнительных задач:

-   распределение URL-адресов служб (определяется во время подготовки служб)
-   управление API-ключами и их распределение
-   отслеживание использования ресурсов
-   масштабирование вверх или вниз (только для стандартного поиска)
-   запуск и останов службы

## URL-адрес службы

URL-адрес службы определяется в виде фиксированного свойства при создании службы; он не может быть изменен позже.

Разработчикам, которые создают программы поиска, нужно будет знать URL-адрес службы для формирования HTTP-запросов. Вы можете быстро найти URL-адрес службы через панель мониторинга.

Чтобы найти URL-адрес службы с помощью панели мониторинга:

1.  Выполните вход на [портал предварительной версии Azure][портала предварительной версии Azure].
2.  Щелкните **Обзор** | **Все** | **Службы поиска**.
3.  Щелкните имя облачной службы поиска, чтобы открыть панель мониторинга.
4.  Нажмите **СВОЙСТВА**, чтобы открыть страницу свойств. URL службы отображается в верхней части страницы. Можно сделать закладку страницы для более быстрого доступа в дальнейшем.

    ![][0]

Разработчики также могут попросить вас сообщить версию API. Требование при кодировании API Поиска Azure: в запросе необходимо всегда указать версию API. Это требование существует, так что разработчики могут продолжать использовать предыдущую версию, а затем обновиться на более позднюю версию, когда настанет подходящий момент.

Версия API не отображается в страницах портала, так что вы не можете предоставить эту информацию. Информацию о текущей и предыдущих версиях Api см. в разделе [API REST Поиска Azure][API REST Поиска Azure].

<!---->

## Управление ключами API

Разработчикам, которые создают программы поиска, нужно будет иметь API-ключ, чтобы получить доступ к Поиску. Для каждого запроса HTTP к вашей поисковой службе понадобится ключ API, который был создан специально для вашей службы. Ключ является единственным механизмом для проверки подлинности в вызове для вашего URL-адреса службы поиска.

Для доступа к вашей службе поиска используются два типа ключей:

-   администратор (разрешаются любые операции)
-   запрос (разрешаются только запросы)

Ключ API администратора создается службой. Существует первичный и вторичный ключи. Вы можете использовать их в равной степени; ни один из них не обладает более высоким или более низким уровнем доступа, что полезно в случае, если вы хотите пролонгировать ключи. Вы можете восстановить любой ключ администратора, но вы не сможете добавить его к общему количеству ключей администратора. Для каждой службы поиска может быть максимум два ключа администратора.

Ключи запроса предназначены для использования в клиентских приложениях для непосредственного вызова службы Поиска. Можно создавать до 50 ключей запроса.

Для получения или повторного создания ключей API необходимо открыть панель мониторинга. Нажмите **КЛЮЧИ**, чтобы открыть страницу управления ключами. Команды для получения или повторного создания ключей API приведены в верхней части страницы.

![][1]

<!---->

## Отслеживание использования ресурсов

В этой общедоступной версии предварительного просмотра мониторинг ресурсов ограничивается информацией, показанной в панели мониторинга службы, а также несколькими показателями, которые вы можете получить с помощью запроса к службе.

В панели мониторинга службы, в разделе «Использование», вы можете быстро определить, являются ли уровни ресурсов раздела достаточными для вашего приложения.

Используя API службы Поиска, вы можете получить количество документов и индексов. Существуют жесткие ограничения, связанные с этими количествами на основе уровня ценообразования. Дополнительные сведения см. в разделе [Пределы и ограничения][Пределы и ограничения]

-   [Получение статистики индексов][Получение статистики индексов]
-   [Подсчет документов][Подсчет документов]

> [WACOM.NOTE] Из-за кэширования пределы могут быть временно переоценены. Например, при использовании общей службы вы можете увидеть количество документов, превышающее жесткий предел в 10 000 документов. Такое преувеличение является временным и будет обнаружено при следующей проверке лимитов.

<!---->

## Масштабирование вверх или вниз

Каждая поисковая служба стартует минимум с одной реплики и одного раздела. Если вы подписались на выделенные ресурсы с помощью уровня стандартного ценообразования, вы можете нажать плитку **МАСШТАБИРОВАНИЕ** в панели мониторинга службы, чтобы скорректировать количество разделов и реплик, используемых вашей службой.

При добавлении любого ресурса служба начинает использовать его автоматически. Никаких дополнительных действий с вашей стороны не требуется, но будет небольшая задержка, прежде чем произойдет задействование нового ресурса. Подготовка дополнительных ресурсов может занять 15 минут или больше.

![][2]

### Добавление реплик

Добиться увеличения количества запросов в секунду (QPS) или достигнуть более высокой доступности можно, добавив реплики. Каждая реплика имеет одну копию индекса, так что добавление еще ​​одной реплики означает перенос еще одного индекса, который может использоваться для обслуживания запросов. В настоящее время опытным путем было установлено, что вам нужно по крайней мере три реплики для обеспечения высокой доступности.

Служба поиска, имеющая большое количество реплик, может распределять нагрузку запросов на большее количество индексов. Учитывая уровень объема запросов, пропускная способность запросов будет выше, когда существует больше копий индекса, доступных для обслуживания запроса. Если вы испытываете задержки при обработке запросов, можно ожидать положительное влияние на производительность, как только заработают дополнительные реплики.

Хотя пропускная способность обработки запросов увеличивается по мере добавления реплик, она не удвоится и не утроится при добавлении соответствующего количества реплик к службе. Все приложения поиска могут зависеть от внешних факторов, которые могут противоречить показателям производительности запросов. Сложные запросы и задержки в сети являются двумя факторами, которые способствуют изменениям во времени ответа на запрос.

### Добавление разделов

Большинство приложений служб больше нуждаются в увеличении количества реплик, нежели количества разделов. Так, большинство приложений, которые используют поиск, могут легко поместиться в одном разделе, который может поддерживать до 15 миллионов документов.

Для тех случаев, когда требуется повышенное количество документов, вы можете добавлять разделы. Обратите внимание, что разделы добавляются кратно 12 (в частности, 1, 2, 3, 4, 6 или 12). Это является следствием сегментирования; индекс создается в 12 из 12 разделов, которые все могут быть записаны на одном разделе или поровну на 2, 3, 4, 6, или 12 разделах (один сегмент в одной группе).

### Удаление реплик

После окончания периода большого количества запросов вы, скорее всего, удалите реплики после нормализации нагрузок поисковых запросов (например, после окончания периода сезонных распродаж).

Чтобы сделать это, вам нужно просто переместить ползунок количества реплик обратно в меньшее значение. Больше с вашей стороны ничего делать не нужно. Уменьшение количества реплик освобождает виртуальные машины в центре обработки данных. Теперь ваши запросы и операции приема данных будут работать на меньшем количестве виртуальных машин, чем раньше. Должна быть как минимум одна реплика.

### Удаление разделов

В отличие от удаления реплик, которое не требует дополнительных усилий с вашей стороны, вам, возможно, придется немного потрудиться, если вы захотите уменьшить объем используемого хранилища. Например, если ваше решение использует три раздела, попытка сократить до одного или двух разделов будет генерировать ошибку, если вы используете больше места для хранения, чем можно хранить в меньшем количестве разделов. В этом случае вы можете удалить индексы и документы в ассоциированном индексе, чтобы освободить место, или сохранить текущую конфигурацию.

Способа обнаружения, который подскажет вам, какие индексные сегменты хранятся на конкретных разделах, не существует. Каждый раздел обеспечивает примерно 25 ГБ в хранилище, так что вам нужно будет сократить хранилище до размера, который может быть размещен на имеющемся количестве разделов. Если вы хотите вернуться к одному разделу, то нужно вместить в него все 12 сегментов.

Чтобы помочь при планировании работы, вы можете проверить хранилище (с использованием раздела [Получение статистики индексов][Получение статистики индексов]), чтобы посмотреть, какой объем на самом деле используется.

<!---->

## Запуск и останов службы

Вы можете запускать, останавливать и даже удалять службу с использованием команд в панели мониторинга.

![][3]

Останов или запуск службы не влияет на выставление счетов. Для прекращения учета использования необходимо удалить службу. Все данные, связанные со службой, также будут удалены.

<!--Anchors--> 


  [Подключение службы поиска к подписке]: #sub-1
  [Административные задачи]: #sub-2
  [URL-адрес службы]: #sub-3
  [Управление ключами API]: #sub-4
  [Отслеживание использования ресурсов]: #sub-5
  [Масштабирование вверх или вниз]: #sub-6
  [Запуск и останов службы]: #sub-7

<!--Link references-->
  [портала предварительной версии Azure]: https://portal.azure.com
  [Пределы и ограничения]: http://msdn.microsoft.com/ru-ru/library/dn798934.aspx
  [Сведения о ценах]: http://go.microsoft.com/fwlink/p/?LinkdID=509792
  [Настройка поиска на портале предварительной версии Azure]: ../search-configure/
  [Получение статистики индексов]: http://msdn.microsoft.com/ru-ru/library/dn798942.aspx
  [Подсчет документов]: http://msdn.microsoft.com/ru-ru/library/dn798924.aspx
  [API REST Поиска Azure]: http://go.microsoft.com/fwlink/p/?LinkdID=509922

<!--Image references--> 

  [0]: ./media/search-manage/Azure-Search-Manage-1-URL.png
  [1]: ./media/search-manage/Azure-Search-Manage-2-Keys.png
  [2]: ./media/search-manage/Azure-Search-Manage-3-ScaleUp.png
  [3]: ./media/search-manage/Azure-Search-Manage-4-StartStop.png
