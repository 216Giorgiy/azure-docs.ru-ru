<properties 
	pageTitle="Управление службой Поиска в Microsoft Azure" 
	description="Управление службой Поиска в Microsoft Azure" 
	services="search" 
	documentationCenter="" 
	authors="HeidiSteen" 
	manager="mblythe" 
	editor=""/>

<tags 
	ms.service="search" 
	ms.devlang="rest-api" 
	ms.workload="search" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.date="01/16/2015" 
	ms.author="heidist"/>

# Управление службой Поиска в Microsoft Azure


[WACOM.INCLUDE [В данном разделе рассматривается Портал предварительной версии Azure.](../includes/preview-portal-note.md)]

Поиск Azure - это облачная служба и интерфейс API на базе HTTP, который может применяться в пользовательских поисковых приложениях. Служба поиска предоставляет подсистему для полнотекстового поискового текстового анализа, продвинутые поисковые возможности, хранилище данных поиска и синтаксис поисковых запросов. 

В данной статье описывается администрирование службы поиска на новом [Портале предварительной версии Azure](https://portal.azure.com).

В качестве альтернативы можно использовать управление интерфейсом REST API.   Для получения более подробной информации см. [Приступая к работе с управлением поисковым интерфейсом REST API](http://azure.microsoft.com/documentation/articles/search-get-started-management-api/) и [Управление поисковыми ссылками Azure интерфейса REST API](http://msdn.microsoft.com/library/azure/dn832684.aspx) /

<!--TOC-->

+ [Подключение службы поиска к подписке](#sub-1)
+ [Административные задачи](#sub-2)
+ [URL-адрес службы](#sub-3)
+ [Управление ключами API](#sub-4)
+ [Отслеживание использования ресурсов](#sub-5)
+ [Масштабирование вверх или вниз](#sub-6)
+ [Запуск и останов службы](#sub-7)
+ [Назначение ролей для управления административным доступом](#sub-8)

<h2 id="sub-1">Подключение службы поиска к подписке</h2>

Одной из ваших первых задач в качестве администратора, настраивающего поисковое устройство, будет выбор уровня ценообразования. Варианты включают "Бесплатный" (Free) и "Стандартный" (Standard) уровни.

Поскольку плата за существующих подписчиков не взимается, вы можете выбрать общую службу, рекомендуемую для учебных целей, подтверждения концепций или небольших проектов разработки. Общая служба ограничена 50 МБ хранилища, тремя индексами и числом документов (жесткий предел 10000 документов), даже если потребление хранилища не превышает разрешенные 50 МБ. Общая служба не предоставляет гарантий производительности, так что если вы собираете рабочее приложение, рекомендуется сделать выбор в пользу "Стандартного" уровня.

Поиск на "Стандартном уровне" является платным, поскольку вы подписаны на пользование специализированными ресурсами и инфраструктурами, специфичными именно для вашей подписки. Стандартный поиск размещен в определяемых пользователем разделах (хранения) и реплик (нагрузках служб), ценообразование осуществляется за единицу поиска. Вы можете независимо масштабировать разделы или реплики, при необходимости добавляя больше ресурсов.

Чтобы спланировать емкость и оценить влияние на стоимость, мы рекомендуем эти ссылки:

+	[Пределы и ограничения](http://msdn.microsoft.com/library/dn798934.aspx)
+	[Детали ценообразования](http://go.microsoft.com/fwlink/p/?LinkdID=509792)

Как только вы будете готовы оформить подписку, ознакомьтесь с разделом [Приступая к работе с поиском Azure](search-get-started.md).


<h2 id="sub-2">Административные задачи</h2>

Несмотря на то, что некоторые службы могут администрироваться несколькими пользователями, у службы поиска Azure всего один администратор на подписку. Вы должны иметь права администратора для выполнения заданий, предложенных в этом разделе
Помимо добавления поиска к подписке, администратор отвечает за следующие дополнительные задачи:

+	Распределение URL-адреса службы (определяется во время подготовки службы).
+	Управление и распределение ключей API.
+	Отслеживание использования ресурсов
+	Масштабирование в большую или меньшую сторону (применимо только к "Стандартному" уровню поиска)
+	Запуск или остановка службы
+	Назначение ролей для управления доступом администратора

<h2 id="sub-3">URL-адрес службы</h2>

URL-адрес службы определяется как постоянное свойство при создании службы; впоследствии он не может быть изменен. 

Разработчики, создающие поисковые приложения, должны знать URL-адрес службы для запросов HTTP. URL-адрес службы можно быстро найти с помощью панели мониторинга.

Чтобы найти URL-адрес службы с помощью панели мониторинга:

1.	Выполните вход на [Портал предварительной версии Azure](https://portal.azure.com).
2.	Щелкните **Обзор** | **Все** | **Службы поиска**.
3.	Щелкните имя облачной службы поиска, чтобы открыть панель мониторинга.
4.	Щелкните **СВОЙСТВА**, чтобы открыть страницу со свойствами. URL службы отображается в верхней части страницы. Впоследствии вы можете закрепить эту страницу в меню быстрого доступа.

    ![][8]

Разработчики могут также попросить у вас версию API. Требование при кодировании API Поиска Azure: в запросе необходимо всегда указать версию API. Данное требование существует для того, чтобы разработчики могли продолжать использовать предыдущую версию, а затем мигрировать на более позднюю версию в подходящий момент.

Версия API не отображается на страницах портала, так что вы не можете предоставить эту информацию. Для получения информации о текущей и предыдущей версиях API см. [Интерфейс REST API поиска Azure](http://go.microsoft.com/fwlink/p/?LinkdID=509922).


<!---->
<h2 id="sub-4">Управление ключами API</h2>

Разработчикам, создающие поисковые приложения, необходим ключ API для получения доступа к поиску. Для каждого запроса HTTP к вашей поисковой службе понадобится ключ API, который был создан специально для вашей службы. Этот ключ API является единственным механизмом проверки подлинности для URL-адреса вашей службы поиска.

Для доступа к вашей службе поиска используются два типа ключей:

+	Ключ администратора (действителен для любой операции)
+	Ключ запроса (действителен только для поисковых запросов)

Ключ API администратора создается службой. Существует первичный и вторичный ключи. Вы можете использовать их в равной степени; ни один из них не обладает более высоким или более низким уровнем доступа, что полезно в случае, если вы хотите пролонгировать ключи. Вы можете восстановить любой ключ администратора, но вы не сможете добавить его к общему количеству ключей администратора. В одной службе поиска могут существовать самое большее два ключа администратора.

Ключи поисковых запросов созданы для использования в клиентских приложениях, которые могут напрямую вызывать поиск. Вы можете создать до 50 ключей поисковых запросов.

Для создания или повторного создания ключей API откройте панель мониторинга службы. Нажмите **КЛЮЧИ**, чтобы открыть страницу управления ключами. В верхней части страницы находятся команды для создания или повторного создания ключей.

 ![][9]


<!---->
<h2 id="sub-5">Отслеживание использования ресурсов</h2>

В этой общедоступной версии предварительного просмотра мониторинг ресурсов ограничивается информацией, показанной в панели мониторинга службы, а также несколькими показателями, которые вы можете получить с помощью запроса к службе.

В панели мониторинга службы, в разделе "Использование", вы можете быстро определить, являются ли уровни ресурсов раздела достаточными для вашего приложения.

С помощью службы интерфейса API службы поиска вы можете рассчитать количество документов и индексов. Существуют жесткие ограничения, связанные с этими количествами на основе уровня ценообразования. Дополнительные сведения см. в разделе [Пределы и ограничения](http://msdn.microsoft.com/library/dn798934.aspx) 

+	[Получить статистику по индексам](http://msdn.microsoft.com/library/dn798942.aspx)
+	[Количество документов](http://msdn.microsoft.com/library/dn798924.aspx)

> [WACOM.NOTE] Поведение кэша может временно превышать предел. Например, при использовании общей службы вы можете увидеть количество документов, превышающее жесткий предел в 10&nbsp;000 документов. Такое преувеличение является временным и будет обнаружено при следующей проверке лимитов. 


<!---->
<h2 id="sub-6">Масштабирование вверх или вниз</h2>

Каждая служба поиска начинает с минимума, равного одной реплике и одному разделу. Если вы подписаны на пользование специализированными ресурсами при использовании "Стандартного" уровня ценообразования, то можете щелкнуть заголовок **МАСШТАБИРОВАНИЕ** на панели мониторинга службы и изменить количество реплик и разделов, задействованных в вашей службе.

При добавлении любого ресурса служба начинает использовать его автоматически. Никаких дополнительных действий с вашей стороны не требуется, но будет небольшая задержка, прежде чем произойдет задействование нового ресурса. Подготовка дополнительных ресурсов может занять 15 и более минут.

 ![][10]

<h3>Добавление реплик</h3>

Увеличение количества запросов в секунду (QPS) или достижение высокой производительности осуществляется посредством добавления реплик. Каждая реплика имеет одну копию индекса, так что добавление еще ​​одной реплики означает перенос еще одного индекса, который может использоваться для обслуживания запросов. В настоящее время опытным путем было установлено, что вам нужно по крайней мере три реплики для обеспечения высокой доступности. 

Служба поиска с большим количеством реплик может загружать баланс поисковых запросов по большему числу индексов. Учитывая уровень объема запросов, пропускная способность запросов будет выше, когда существует больше копий индекса, доступных для обслуживания запроса. При возникновении задержки запросов возможен позитивный эффект на производительность, как только дополнительные реплики окажутся в сети.

Несмотря на то, что дополнительные реплики повышают пропускную способность, она в точности не удваивается или утраивается при добавлении реплик к вашей службе. Все приложения поиска могут зависеть от внешних факторов, которые могут противоречить показателям производительности запросов. Сложные запросы и задержки в сети являются факторами, влияющими на изменение времени ответа на запрос.

<h3>Добавление разделов</h3>

Большинство служебных приложений имеют встроенную потребность в большем количестве реплик, а не разделов, поскольку большинство приложений, использующих поиск, легко могут существовать в одном разделе, поддерживающем до 15 миллионов документов. 

В случае возникновения необходимости повышения количества документов нужно добавить разделы. Обратите внимание, что разделы добавляются кратно 12 (в частности, 1, 2, 3, 4, 6 или 12). Это артефакт сегментирования: индекс создается в 12 сегментах, которые все вместе могут храниться в одном разделе или равномерно распределяться по 2, 3, 4, 6 или 12 разделам (один сегмент на раздел).

<h3>Удаление реплик </h3>

После окончания периода большого количества запросов вы, скорее всего, удалите реплики после нормализации нагрузок поисковых запросов (например, после окончания периода сезонных распродаж).

Чтоб сделать это, просто переместите бегунок реплики обратно к меньшему значению. Больше с вашей стороны ничего делать не нужно. Уменьшение количества реплик освобождает виртуальные машины в центре обработки данных. Теперь ваши запросы и операции приема данных будут работать на меньшем количестве виртуальных машин, чем раньше. Минимальный предел - одна реплика.

<h3>Удаление разделов</h3>

В отличие от удаления реплик, не требующего дополнительных усилий с вашей стороны, удаление пространства хранения - более сложная задача, особенно если вы используете больше хранилищ, чем может быть удалено. Например, если ваше решение использует три раздела, попытка сократить до одного или двух разделов будет генерировать ошибку, если вы используете больше места для хранения, чем можно хранить в меньшем количестве разделов. В этом случае рекомендуется удалить индексы или документы в соответствующем индексе для освобождения пространства, или сохранить текущую конфигурацию.

Не существует метода, задающего конкретные сегменты индекса, хранящиеся в каждом разделе. Каждый раздел обеспечивает примерно 25 ГБ в хранилище, так что вам нужно будет сократить хранилище до размера, который может быть размещен на имеющемся количестве разделов. Если вы хотите вернуться к одному разделу, все 12 сегментов должны в него поместиться.

В будущем для планирования вам, возможно, потребуется проверить хранилище (с помощью [Получение статистики индексов](http://msdn.microsoft.com/library/dn798942.aspx)), чтобы узнать, сколько вы на самом деле задействовали. 


<!---->
<h2 id="sub-7">Запуск и останов службы</h2>

Вы можете запускать, останавливать и даже удалять службу с использованием команд в панели мониторинга.

 ![][11]


Запуск и останов службы не отключает учета использования. Для прекращения учета использования необходимо удалить службу. Любые данные, ассоциированные с вашей службой, удаляются при выведении ее из эксплуатации.

<!---->
<h2 id="sub-8">Назначение ролей для управления доступом администратора</h2>

Azure предоставляет глобальную модель авторизации на основе ролей для всех служб, управляемых через портал предварительной версии или API диспетчера ресурсов Azure, если вы работаете с пользовательским инструментом управления. Роли владельца, участника или читателя задают уровень управления службой для пользователей Active Directory, группы и основные настройки безопасности для каждой роли. См. [Управление доступом на основе ролей в портале предварительной версии Azure](http://azure.microsoft.com/updates/role-based-access-control-in-azure-preview-portal/) для получения сведений о ролевой принадлежности.

В терминах поиска Azure контроль и доступ на основе ролей определяет следующие административные задачи:

<table>
<tr>
<td>владелец;</td>
<td>
Запуск, останов или удаление службы.</br>
Создание и просмотр ключей администратора и поискового запроса.</br>
Просмотр состояния службы, в том числе количества индексов, имен индексов, количества документов и размера хранилища.</br>
Добавление или удаление ролевой принадлежности (только владелец может управлять ролевой принадлежностью).</br>
</br>
Администраторы подписки и службы автоматически получают принадлежность к роли владельца.
</td>
</tr>
<tr>
<td>Участник</td>	
<td>Имеет тот же уровень доступа, что и владелец, но не может управлять ролями. Например, участник может просматривать и заново создавать ключ API, но не может изменять ролевые принадлежности.
</td>
</tr>
<tr>
<td>читатель.</td>
<td>Просматривает состояние службы и ключи запросов. Пользователи в этой роли могут запускать или останавливать службу, но не просматривать ключи администратора.
</td>
</tr>
</table>

Обратите внимание, что роли не гарантируют право доступа к конечной точке службы. Операции службы поиска, такие как управление индексами, совокупностями индексов и поисковые запросы к данным, управляются посредством ключей API, а не через роли. Для получения дополнительной информации см. подраздел "Авторизация для управления и операции с данными" в разделе [Управление доступом на основе ролей в портале предварительной версии Azure](http://azure.microsoft.com/updates/role-based-access-control-in-azure-preview-portal/).

Роли обеспечивают управление доступом после создания службы. Только диспетчер подписки может добавить службу поиска к подписке.


<!--Anchors-->
[Подключение службы поиска к подписке]: #sub-1
[Административные задачи]: #sub-2
[URL-адрес службы]: #sub-3
[Управление ключами API]: #sub-4
[Отслеживание использования ресурсов]: #sub-5
[Масштабирование вверх или вниз]: #sub-6
[Запуск и останов службы]: #sub-7
[Назначение ролей для управления административным доступом]: #sub-8


<!--Image references-->
[8]: ./media/search-manage/Azure-Search-Manage-1-URL.png
[9]: ./media/search-manage/Azure-Search-Manage-2-Keys.png
[10]: ./media/search-manage/Azure-Search-Manage-3-ScaleUp.png
[11]: ./media/search-manage/Azure-Search-Manage-4-StartStop.png


<!--Link references-->
[Начало работы со службой поиска Azure]: ../search-get-started/
[Процесс разработки Поиска Azure]: ../search-workflow/
[Создание первого решения для поиска Azure]: ../search-create-first-solution/


<!--HONumber=46--> 
