<properties
   pageTitle="Планирование емкости для приложений Service Fabric | Microsoft Azure"
   description="Описание процедуры определения количество вычислительных узлов, необходимых для приложения Service Fabric."
   services="service-fabric"
   documentationCenter=".net"
   authors="mani-ramaswamy"
   manager="coreysa"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="02/09/2016"
   ms.author="subramar"/>


# Планирование емкости для приложений Service Fabric


В этом документе содержатся сведения об определении объема ресурсов (ЦП, ОЗУ, дискового хранилища), необходимых для выполнения приложений Service Fabric. Чаще всего требования к ресурсам со временем меняются. Как правило, при разработке или тестировании службы требуется незначительное количество ресурсов. Но при переходе в рабочую среду и росте популярности приложения объем ресурсов возрастает. При проектировании приложения следует подумать о требованиях в долгосрочной перспективе. Кроме того, лучше сразу принять решения, которые позволят без усилий выполнить масштабирование службы в соответствии с высокими запросами клиентов.

 Создавая кластер Service Fabric, вы решаете, какие виртуальные машины будут входить в его состав. Каждая виртуальная машина имеет ограниченный объем ресурсов в виде ЦП (ядра и быстродействие), пропускной способности сети, ОЗУ и дискового пространства. По мере расширения службы можно выполнить обновление до виртуальных машин с более высоким объемом и/или добавить в кластер дополнительные виртуальные машины. Разумеется, чтобы решить последнюю задачу, необходимо первоначально так разработать службу, чтобы она смогла поддерживать преимущества новых виртуальных машин, динамически добавляемых в кластер.

Некоторые службы управляют слишком малым объемом данных на самих виртуальных машинах либо не управляют вообще ничем. Следовательно, планирование емкости для этих служб прежде всего должно осуществляться с прицелом на производительность. Это означает, что необходимо уделить особое внимание производительности алгоритмов кода и ЦП виртуальных машин (ядра и быстродействие), необходимых для выполнения алгоритмов. Кроме того, также следует учесть пропускную способность сети, включая частоту передачи данных и объем передаваемых данных. Если по мере увеличения степени использования функционирование службы должно оставаться на высоком уровне, в кластер можно добавить дополнительные виртуальные машины и обеспечить балансировку сетевых запросов на всех виртуальных машинах.

Главным аспектом планирования емкости для служб, управляющих большим объемом данных на виртуальных машинах, должен быть размер. Это означает, что необходимо тщательно продумать вопрос выделения виртуальной машине требуемого объема ОЗУ и дискового пространства. В системе управления виртуальной памятью Windows дисковое пространство выглядит как ОЗУ в коде приложения. Это позволяет приложениям использовать больше памяти, чем доступно физически на виртуальной машине. Увеличение объема памяти просто приводит к увеличению производительности, так как виртуальная машина может содержать больше дискового пространства в ОЗУ. При выборе виртуальной машины отдайте предпочтение той, дисковое пространство которой может содержать все данные виртуальной машины. Также выберите размер ОЗУ, позволяющий обращаться к данным с нужной скоростью. По мере увеличения объема данных службы в кластер можно добавить дополнительные виртуальные машины и секционировать данные на всех виртуальных машинах.

## Определение количества необходимых узлов

Секционирование службы позволяет масштабировать данные службы (дополнительные сведения о секционировании см. в статье [Секционирование Service Fabric](service-fabric-concepts-partitioning.md)). Каждая секция должна помещаться на одной виртуальной машине. Однако на одной виртуальной машине также можно разместить несколько небольших секций. Таким образом, наличие большего количества небольших секций обеспечивает большую гибкость, чем небольшое количество более крупных секций. Компромисс заключается в том, что значительное количество секций увеличивает нагрузку на платформу Service Fabric, поэтому вы не можете выполнять транзакционные операции между секциями. Если коду службы часто требуется доступ к фрагментам данных, расположенным в разных секциях, увеличивается объем потенциального сетевого трафика. При разработке службы следует внимательно рассмотреть эти преимущества и недостатки, чтобы в результате прийти к эффективной стратегии секционирования.

Предположим, что приложение имеет одну службу с отслеживанием состояния, размер хранилища которой будет предположительно увеличиваться до DB\_Size ГБ в год. Вам нужно добавить несколько приложений (и секций), так как ваше решение за год расширилось. Чтобы узнать общий размер базы данных (значение DB\_Size) во всех репликах, нужно также принять во внимание коэффициент репликации (RF), который определяет количество реплик для службы (общий размер базы данных во всех репликах — это коэффициент репликации, умноженный на значение DB\_Size). Значение Node\_Size представляет дисковое пространство/ОЗУ для каждого узла, используемого для службы. Для достижения максимальных результатов нужно, чтобы значение DB\_Size соответствовало объему памяти в кластере. Кроме того, нельзя превышать значение Node\_Size, объем которого приблизительно соответствует емкости ОЗУ выбранной виртуальной машины. Выделяя объем Node\_Size, который превышает емкость ОЗУ, вы переходите в режим подкачки страниц. В таком случае производительность будет далека от оптимальной, но ресурсов для работы службы по-прежнему будет хватать.

Количество узлов, необходимое для достижения максимальной производительности, можно вычислить следующим образом.

```
Number of Nodes = (DB_Size * RF)/Node_Size

```


## Действия с учетом расширения службы

Чтобы вычислить количество узлов, вы можете использовать ожидаемое значение DB\_Size для своей службы в дополнение к исходному значению DB\_Size. По мере роста службы увеличивайте количество узлов, чтобы избежать их избыточной подготовки. Количество секций должно быть основано на количестве узлов, необходимых для работы службы на максимально эффективном уровне.

Рекомендуется иметь несколько доступных в любое время запасных компьютеров (избыточных ресурсов), чтобы обрабатывать непредвиденные пиковые нагрузки или сбои инфраструктуры (например, выход из строя нескольких виртуальных машин). Хотя этот момент должен быть определен с учетом ожидаемых скачков, для начала рекомендуем зарезервировать еще несколько виртуальных машин (дополнительные 5–10 %).

Изложенные выше условия предполагают, что у вас есть одна служба с отслеживанием состояния. Если у вас есть несколько служб с отслеживанием состояния, в уравнение также потребуется добавить значение DB\_Size, связанное с другими службами, или вычислить количество узлов отдельно для каждой службы с отслеживанием состояния. У службы могут быть реплики или секции, которые не сбалансированы. Некоторые секции могут содержать больше данных, чем другие. Дополнительные сведения об этом см. в статье [Секционирование служб Reliable Services в Service Fabric](service-fabric-concepts-partitioning.md). Тем не менее приведенное выше уравнение не зависит от количества секций или реплик, так как Service Fabric обеспечивает оптимальное распределение реплик между узлами.


## Использование таблицы для расчета стоимости

Теперь давайте введем несколько реальных цифр в приведенную выше формулу. В [этом примере таблицы](https://servicefabricsdkstorage.blob.core.windows.net/publicrelease/SF%20VM%20Cost%20calculator-NEW.xlsx) показано планирование емкости для приложения, содержащего три типа объектов данных. Для каждого объекта мы приблизительно определяем его размер и планируемое количество объектов. Мы также выбираем требуемое количество реплик каждого типа объекта. Таблица вычисляет общий объем памяти для хранения в кластере.

Затем мы вводим размер виртуальной машины и ежемесячные расходы. В зависимости от размера виртуальной машины в таблице выводится минимальное количество секций, на которые необходимо разбить данные для физического размещения на узлах. В соответствии с конкретными вычислениями вашего приложения и потребностями сетевого трафика может потребоваться дополнительное количество секций. В таблице показано увеличение количества секций, управляющих объектами профиля пользователя, от 1 до 6.

Теперь на основе этой информации понятно, что вы можете физически получить все данные с нужными разделами и репликами в кластере с 26 узлами. Однако, так как этот кластер плотно упакован, могут потребоваться дополнительные узлы для обработки сбоев и обновлений. В таблице также показано, что наличие более 57 узлов не дает дополнительных преимуществ — у вас просто будут пустые узлы. Опять же, может потребоваться более 57 узлов для обслуживания сбоев и обновлений узлов. Таблицу можно настроить в соответствии с конкретными потребностями.

![Таблица для расчета стоимости][Image1]



## Дальнейшие действия

Дополнительные сведения о секционировании служб см. в статье [Секционирование служб Reliable Services в Service Fabric][10].



<!--Image references-->
[Image1]: ./media/SF-Cost.png

<!--Link references--In actual articles, you only need a single period before the slash-->
[10]: service-fabric-concepts-partitioning.md

<!---HONumber=AcomDC_0211_2016-->