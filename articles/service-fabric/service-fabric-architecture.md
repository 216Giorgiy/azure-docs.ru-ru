<properties
   pageTitle="Архитектура структуры служб"
   description="Структура служб представляет собой платформу распределенных систем, используемых для создания масштабируемых, надежных и легко управляемых приложений в облаке. В настоящей статье освещается архитектура структуры служб."
   services="service-fabric"
   documentationCenter=".net"
   authors="rishirsinha"
   manager="timlt"
   editor="rishirsinha"/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="08/26/2015"
   ms.author="rsinha"/>

# Архитектура структуры служб

Структура служб, как и любая платформа, строится на множестве подсистем. Эти подсистемы организованы по уровням и позволяют разработчикам приложений создавать приложения структуры служб, отвечающие следующим требованиям:

* высокая доступность, 
* масштабируемость, 
* простота в управлении и 
* простота в тестировании.

На следующем изображении показана архитектура и основные подсистемы структуры служб.

![](media/service-fabric-architecture/service-fabric-architecture.png)

В распределенной системе возможность безопасного обмена данными между различными узлами имеет критическую важность. В нижней части стека находится транспортная подсистема, которая обеспечивает возможность безопасного обмена данными между различными узлами. На уровень выше транспортной системы находится подсистема федерации, которая служит для объединения различных узлов в кластер как единую сущность (поименованные кластеры), чтобы система могла обнаруживать ошибки, выполнять выбор лидера и осуществлять согласованную маршрутизацию. Подсистема надежности, уровень которой располагается топологически выше подсистемы федерации, предназначена для обеспечения высокой надежности служб структуры служб при помощи таких механизмов, как репликация, управление ресурсами и управление переключением на резервные мощности. Подсистема федерации также является основой для подсистемы хостинга, которая управляет жизненным циклом приложения на отдельном узле. Подсистема управления кластером управляет жизненным циклом приложений и служб, размещенных на нескольких компьютерах. Подсистема обеспечения тестирования позволяет разработчику приложений проверять работу своих служб путем эмуляции ошибок и сбоев перед развертыванием приложений и служб в производственных средах. Структура служб также обеспечивает возможность разрешать местоположения служб через подсистему коммуникации. Модель программирования приложения, доступная для разработчиков, находится на уровень выше этих подсистем.

## Транспортная подсистема
Транспортная подсистема реализована на модели обмена данными по каналу "точка-точка". Этот канал используется для обмена данными в пределах кластера структуры служб и между кластером структуры служб и клиентами. Поддерживается как односторонняя модель обмена данными, так и модель, подразумевающая вопрос-ответ, что обеспечивает базу для внедрения технологий широковещательной трансляции и многоканальной трансляции на более высоких уровнях. Транспортная подсистема обеспечивает безопасность при обмене данными за счет использования сертификатов X509 или средств безопасности Windows. Эта подсистема используется в пределах структуры служб и недоступна напрямую для разработчиков при программировании приложений.

## Подсистема федерации
Чтобы рассуждать о наборе узлов в распределенной системе, нам потребуется сформировать целостное представление обо всей системе. Подсистема федерации использует составные элементы обмена данными, предоставляемые транспортной подсистемой, и объединяет различные узлы в единую рассматриваемую систему. Это обеспечивает составные элементы распределенной системы, которые требуются другим подсистемам: обнаружение сбоев, выбор лидера и постоянная маршрутизация. Подсистема федерации строится на основе распределенных хэш-таблиц с 128-разрядным пространством маркера и формирует кольцевую топологию на узлах, при этом каждому узлу в кольце выделяется специальное подмножество пространства маркера для владельца. Для обнаружения ошибок этот уровень использует механизм аренды, основанный на сердцебиении и разрешении конфликтов. Кроме того, подсистема федерации при помощи сложных протоколов присоединения и отсоединения гарантирует, что в конкретный момент существует только один владелец. Это позволяет выполнять выбор лидера и гарантировать согласование маршрутизации.

## Подсистема надежности
Подсистема обеспечения надежности обеспечивает механизм, предназначенный для того, чтобы сделать службу структуры служб высокодоступной за счет использования _репликатора_, _диспетчера отработки отказов_ и _средства балансировки нагрузки_.

* Репликатор следит за тем, чтобы смена состояний в основной реплике службы автоматически реплицировалась на вторичные реплики, поддерживая согласованность между первичной и вторичной репликами в наборе реплик службы. Репликатор отвечает за управление кворумом между репликами в наборе реплик. Он взаимодействует с единицей отработки отказа, чтобы получить список операций для репликации, а агент перенастройки предоставляет ему конфигурацию наборов реплик, в которой указано, на какие реплики необходимо реплицировать операции. Структура служб предоставляет репликатор по умолчанию, который называется репликатором структуры и может использоваться разработчиками служб для обеспечения высокодоступного и надежного состояния службы.
* Диспетчер отработки отказов обеспечивает автоматическое перераспределение нагрузки между доступными узлами при добавлении или удалении узлов из кластера. Кластер автоматически перенастроит реплики службы при отказе одного из узлов в кластере так, что потери доступности на произойдет.
* Средство балансировки ресурсов размещает реплики служб в домене сбоя по кластеру и обеспечивает работу всех единиц отработки отказа. Средство балансировки ресурсов также балансирует службы в совместном пуле узлов кластера, чтобы достигнуть равномерного распределения нагрузки.

## Подсистема управления
Подсистема управления обеспечивает комплексное управление жизненным циклом приложений и служб. Командлеты PowerShell и API администрирования позволяют выделять, развертывать, вносить исправления, обновлять и удалять приложения без потери доступности. Подсистема управления выполняет это при помощи следующих служб.

* Диспетчер кластера представляет собой главную службу, которая взаимодействует с диспетчером отработки отказов с точки зрения обеспечения надежности, чтобы разместить приложения в различных узлах на основании ограничений на размещение служб. Средство балансировки ресурсов в отказоустойчивой системе обеспечивает соблюдение установленных ограничений. Диспетчер кластеров управляет жизненным циклом приложений от выделения их ресурсов до момента отмены такого выделения. Он интегрируется с диспетчером работоспособности, описанным на следующем шаге, чтобы обеспечить доступность приложения с точки зрения семантической работоспособности во время обновлений.
* Диспетчер работоспособности включает отслеживание работоспособности приложений, служб и сущностей кластеров. Сущности кластеров (такие как узлы, разделы служб и реплики) могут сообщать сведения о работоспособности, которые затем собираются в централизованное хранилище данных о работоспособности. Эти сведения о работоспособности предоставляют общие моментальные снимки о состоянии работоспособности служб и узлов, распределенные по многим узлам кластера, позволяя предпринимать своевременные действия по исправлению. API, запрашивающие состояние работоспособности, позволяют опрашивать события работоспособности, сообщенные в подсистему работоспособности. API, запрашивающие состояние работоспособности, возвращают необработанные данные о работоспособности, сохраненные в хранилище состояний работоспособности, или собранные и интерпретированные данные о работоспособности по конкретной сущности кластера.
* Хранилище образов. Эта служба позволяет хранить и распространять двоичные файлы приложений. Эта служба представляет собой простое распределенное хранилище файлов, в которое загружаются и из которого выгружаются приложения.


## Подсистема хостинга
Диспетчер кластеров информирует подсистему хостинга (работающую на каждом узле) о том, какими службами ему необходимо управлять на каждом конкретном узле. Подсистема хостинга затем управляет жизненным циклом приложения на этом узле. Она взаимодействует с компонентами обеспечения надежности и работоспособности, чтобы обеспечить нужное размещение реплик и их работоспособность.

## Подсистема связи
Эта подсистема предоставляет надежный обмен сообщениями в пределах кластера, а также функции обнаружения служб через службу именования. Служба именования разрешает имена служб в определенном местоположении в кластере и позволяет пользователям управлять именами и свойствами. Используя службу именования, клиенты могут безопасно обмениваться данными с любыми узлами в кластере, чтобы разрешать имена и извлекать метаданные служб. Используя API клиента именования, пользователи структуры служб могут разрабатывать службы и клиенты, способные разрешать текущее сетевое местоположение вне зависимости от динамичности узлов или размера кластера.

## Подсистема тестирования
Подсистема тестирования представляет собой набор инструментов, специально предназначенных для тестирования служб, созданных в структуре служб. Средства позволяют разработчику без труда вызывать значимые ошибки и запускать тестовые сценарии, чтобы воспроизвести и проверить множество различных состояний и переходов, которые будут происходить со службой в течение ее жизненного цикла, в контролируемых и безопасных условиях. Возможности тестирования также предоставляют механизм для запуска долговременных тестов, которые могут итерироваться по возможным ошибкам без потери доступности, предоставляя пользователям тестовую рабочую среду.
 

<!---HONumber=Sept15_HO2-->