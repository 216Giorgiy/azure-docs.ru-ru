<properties
   pageTitle="Архитектура Service Fabric | Microsoft Azure"
   description="Service Fabric представляет собой платформу распределенных систем, используемых для создания масштабируемых, надежных и легко управляемых приложений в облаке. В настоящей статье освещается архитектура структуры служб."
   services="service-fabric"
   documentationCenter=".net"
   authors="rishirsinha"
   manager="timlt"
   editor="rishirsinha"/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="01/26/2016"
   ms.author="rsinha"/>

# Архитектура Service Fabric

Service Fabric, как и любая платформа, включает множество подсистем. Эти подсистемы, организованные по уровням, помогают разработчикам приложений создавать приложения Service Fabric, которые отвечают следующим требованиям:

* высокая доступность;
* Масштабируемость
* простота в управлении;
* простота в тестировании.

На следующей схеме показана архитектура и основные подсистемы платформы Service Fabric.

![Схема архитектуры Service Fabric](media/service-fabric-architecture/service-fabric-architecture.png)

В распределенной системе возможность безопасного обмена данными между различными узлами имеет решающее значение. В нижней части стека находится транспортная подсистема, которая обеспечивает безопасный обмен данными между узлами. Уровнем выше транспортной системы находится подсистема федерации, которая предназначена для объединения разных узлов в кластер как единую сущность (именованные кластеры). Таким образом система может обнаруживать ошибки, выбирать лидера и осуществлять согласованную маршрутизацию. Подсистема надежности, расположенная уровнем выше подсистемы федерации, обеспечивает высокую надежность служб Service Fabric с помощью таких механизмов, как репликация, управление ресурсами и отработка отказа. Подсистема федерации также является основой для подсистемы хостинга, которая управляет жизненным циклом приложения на отдельном узле. Подсистема управления кластером управляет жизненным циклом приложений и служб, размещенных на нескольких компьютерах. Подсистема тестирования помогает разработчикам приложений проверять работу своих служб, имитируя ошибки и сбои перед развертыванием приложений и служб в производственных средах. Структура служб также обеспечивает возможность разрешать местоположения служб через подсистему коммуникации. Модель программирования приложений, доступная для разработчиков, расположена уровнем выше этих подсистем.

## Транспортная подсистема
Транспортная подсистема реализована на модели обмена данными по каналу "точка-точка". Этот канал используется для обмена данными в пределах кластера структуры служб и между кластером структуры служб и клиентами. Поддерживается как односторонняя модель обмена данными, так и модель на основе схемы "запрос — ответ". Это позволяет внедрять технологии широковещательной и многоканальной трансляции на более высоких уровнях. Транспортная подсистема обеспечивает безопасность при обмене данными за счет использования сертификатов X509 или средств безопасности Windows. Эта подсистема используется в рамках Service Fabric. При программировании приложений она недоступна напрямую для разработчиков.

## Подсистема федерации
Чтобы рассуждать о наборе узлов в распределенной системе, нам потребуется сформировать целостное представление обо всей системе. Подсистема федерации использует составные элементы обмена данными, предоставляемые транспортной подсистемой, и объединяет различные узлы в единую рассматриваемую систему. Это обеспечивает составные элементы распределенной системы, которые требуются другим подсистемам: обнаружение сбоев, выбор лидера и постоянная маршрутизация. Подсистема федерации основана на распределенных хэш-таблицах с 128-разрядным пространством маркера. Она создает кольцевую топологию на узлах, где каждому узлу в кольце выделяется подмножество пространства маркера для владельца. Для обнаружения ошибок этот уровень использует механизм аренды, основанный на сердцебиении и разрешении конфликтов. Кроме того, подсистема федерации при помощи сложных протоколов присоединения и отсоединения гарантирует, что в конкретный момент существует только один владелец. Это позволяет выбирать лидера и обеспечивать согласованную маршрутизацию.

## Подсистема надежности
Подсистема надежности предусматривает механизм, обеспечивающий высокую доступность службы Service Fabric за счет использования _репликатора_, _диспетчера отработки отказов_ и _балансировщика нагрузки_.

* Репликатор следит за тем, чтобы смена состояний в основной реплике службы автоматически реплицировалась на вторичные реплики, поддерживая согласованность между первичной и вторичной репликами в наборе реплик службы. Репликатор отвечает за управление кворумом между репликами в наборе. Он взаимодействует с единицей отработки отказа, чтобы получить список операций для репликации, а агент перенастройки предоставляет ему конфигурацию набора реплик. В этой конфигурации указано, на какие реплики необходимо реплицировать операции. В Service Fabric используется репликатор по умолчанию, который называется репликатором структуры. Он может использоваться разработчиками служб для обеспечения высокодоступного и надежного состояния службы.
* Диспетчер отработки отказов отвечает за автоматическое перераспределение нагрузки между доступными узлами при добавлении или удалении узлов из кластера. Кластер автоматически перенастроит реплики службы при отказе одного из узлов в кластере, обеспечивая доступность.
* Балансировщик ресурсов размещает реплики служб в домене сбоя в кластере, обеспечивая работоспособность всех единиц отработки отказа. Балансировщик ресурсов также распределяет ресурсы службы в рамках совместного пула узлов кластера, обеспечивая равномерное распределение нагрузки.

## Подсистема управления
Подсистема управления обеспечивает комплексное управление жизненным циклом приложений и служб. Командлеты PowerShell и API администрирования позволяют выделять, развертывать, вносить исправления, обновлять и удалять приложения без потери доступности. Подсистема управления выполняет это при помощи следующих служб.

* Диспетчер кластера представляет собой главную службу, которая взаимодействует с диспетчером отработки отказов с точки зрения обеспечения надежности, чтобы разместить приложения в различных узлах на основании ограничений на размещение служб. При отработке отказа балансировщик ресурсов обеспечивает соблюдение установленных ограничений. Диспетчер кластеров управляет жизненным циклом приложений, включая подготовку и ее отмену. Он интегрируется с диспетчером работоспособности, описанным на следующем шаге, чтобы обеспечить доступность приложения с точки зрения семантической работоспособности во время обновлений.
* Диспетчер работоспособности включает наблюдение за работоспособностью приложений, служб и сущностей кластеров. Сущности кластеров (такие как узлы, разделы служб и реплики) могут сообщать сведения о работоспособности, которые затем собираются в централизованное хранилище данных о работоспособности. Эти сведения о работоспособности предоставляют общие моментальные снимки о состоянии работоспособности служб и узлов, распределенных между многими узлами кластера, позволяя предпринимать своевременные корректирующие действия. API, запрашивающие состояние работоспособности, позволяют опрашивать события работоспособности, сообщенные в подсистему работоспособности. API, запрашивающие состояние работоспособности, возвращают необработанные данные о работоспособности, сохраненные в хранилище состояний работоспособности, или собранные и интерпретированные данные о работоспособности по конкретной сущности кластера.
* Хранилище образов позволяет хранить и распространять двоичные файлы приложений. Эта служба представляет собой простое распределенное хранилище файлов, в которое отправляются и из которого скачиваются приложения.


## Подсистема хостинга
Диспетчер кластеров информирует подсистему хостинга (работающую на каждом узле) о том, какими службами ему необходимо управлять на каждом конкретном узле. Подсистема хостинга затем управляет жизненным циклом приложения на этом узле. Она взаимодействует с компонентами обеспечения надежности и работоспособности, чтобы обеспечить нужное размещение реплик и их работоспособность.

## Подсистема связи
Эта подсистема предоставляет надежный обмен сообщениями в пределах кластера, а также функции обнаружения служб через службу именования. Служба именования присваивает имена служб определенному расположению в кластере, позволяя пользователям управлять именами и свойствами. Используя службу именования, клиенты могут безопасно обмениваться данными с любыми узлами в кластере, чтобы разрешать имена и извлекать метаданные служб. Используя API клиента именования, пользователи структуры служб могут разрабатывать службы и клиенты, способные разрешать текущее сетевое расположение независимо от динамичности узлов или размера кластера.

## Подсистема тестирования
Подсистема тестирования представляет собой набор инструментов, специально предназначенных для тестирования служб, созданных в структуре служб. Эти инструменты позволяют разработчику легко вызывать значимые ошибки и запускать тестовые сценарии, чтобы воспроизводить и проверять в контролируемых и безопасных условиях разные состояния и переходы, происходящие со службой в течение ее жизненного цикла. Средства тестирования также предоставляют механизм для запуска долговременных тестов с возможностью итерации по возможным ошибкам без потери доступности. Это предоставляет пользователям тестовую рабочую среду.

<!---HONumber=AcomDC_0204_2016-->