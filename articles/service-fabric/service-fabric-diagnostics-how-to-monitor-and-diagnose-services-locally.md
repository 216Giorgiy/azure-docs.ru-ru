<properties
   pageTitle="Платформа Microsoft Azure Service Fabric: локальный мониторинг состояния и диагностика служб"
   description="В этой статье описывается мониторинг и диагностика состояния служб с использованием платформы Microsoft Azure Service Fabric на локальном компьютере для разработки."
   services="service-fabric"
   documentationCenter=".net"
   authors="kunaldsingh"
   manager="samgeo"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="04/22/2015"
   ms.author="kunalds"/>


# Мониторинг и диагностика состояния служб в локальной среде разработки
Благодаря возможностям мониторинга состояния, а также выявления, диагностики и устранения неполадок службы могут работать практически без перерывов. Контролировать состояние в рабочей среде очень важно. Однако можно существенно повысить эффективность работы и обеспечить успешное перемещение служб в рабочую среду, внедрив аналогичную модель мониторинга во время разработки служб. Платформа Service Fabric позволяет использовать средства диагностики, которые одинаково хорошо работают как в среде разработки на одном локальном компьютере, так и в реальном рабочем кластере.

## Трассировка и ведение журнала
Для трассировки сообщений в Service Fabric рекомендуется использовать технологию [трассировки событий Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803.aspx) (ETW). На это есть несколько причин:

* ETW работает быстро. Технология разработана таким образом, что время выполнения кода практически не меняется.
* Трассировка событий Windows одинаково работает в локальных средах разработки и в рабочем кластере. Это означает, что вам не потребуется изменять код трассировки, когда вы будете готовы развернуть свой код в реальном кластере.
* Для внутренней трассировки системного кода Service Fabric также используется ETW. Данные с точек трассировки приложения можно просматривать параллельно с данными с системных точек трассировки Service Fabric, что облегчает установление связей между кодом приложения и событиями в базовой системе.
* В инструментах Visual Studio для работы с Service Fabric поддержка событий ETW предусмотрена по умолчанию.


## Просмотр системных событий Service Fabric в Visual Studio

Service Fabric генерирует события ETW, чтобы разработчики понимали, что происходит в платформе. Для просмотра этих событий, выполните перечисленные ниже действия.

1. Установите следующие программы и инструменты:
   * Visual Studio 2015
   * Пакет SDK для Service Fabric
2. Запустите Visual Studio от имени администратора.
3. Создайте (или откройте) проект службы или субъекта с отслеживанием или без отслеживания состояния. ![Создание проекта Service Fabric](./media/service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally/CreateServiceFabricProject.png)

4. Нажмите клавишу F5 для запуска отладки приложения. События Service Fabric должны отобразиться в окне «События диагностики». Стандартные метаданные события включают сведения об исходных узле, приложении и службе. События в списке событий можно фильтровать (например, по имени узла или службы), используя поле фильтра в верхней части окна. ![Средство просмотра событий диагностики Visual Studio](./media/service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally/DiagEventsExamples2.png)

5. Если окно «События диагностики» не откроется автоматически, перейдите в обозреватель серверов в Visual Studio, щелкните правой кнопкой мыши кластер Service Fabric и выберите в контекстном меню команду «Просмотреть события диагностики».

![Откройте средство просмотра событий диагностики Visual Studio](./media/service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally/ServerExViewDiagEvents.png)

## Добавление собственных точек трассировки в код приложения
В шаблонах проектов Service Fabric в Visual Studio приведен пример кода, демонстрирующий добавление в код приложения собственных точек трассировки ETW. Их данные отображаются в средстве просмотра данных ETW в Visual Studio вместе с системными данными трассировки Service Fabric. Преимущество этого метода заключается в том, что метаданные автоматически добавляются в точки трассировки и их отображение уже настроено в средстве просмотра данных диагностики Visual Studio.

Для проектов, созданных из **шаблонов служб** (с отслеживанием или без отслеживания состояния):

1. Откройте файл **Service.cs**. Вызовите `ServiceEventSource.Current.Message` с помощью метода *RunAsync*, чтобы просмотреть пример пользовательской точки трассировки ETW в коде приложения.
2. В файле **ServiceEventSource.cs** перегрузки метода `ServiceEventSource.Message` демонстрируют альтернативный вариант написания пользовательских точек трассировки ETW.

Для проектов, созданных из **шаблонов субъектов** (с отслеживанием или без отслеживания состояния):

1. Откройте файл **имя_проекта.cs**, где *имя_проекта* — это имя, которое вы выбрали для своего проекта Visual Studio.  
2. Найдите строку `ActorEventSource.Current.ActorMessage(this, "Doing Work");` в методе *DoWorkAsync*. Это пример пользовательской точки трассировки ETW в коде приложения.  
3. В файле **ActorEventSource.cs** перегрузки метода `ActorEventSource.ActorMessage` демонстрируют альтернативный вариант написания пользовательских точек трассировки ETW.

После добавления пользовательской точки трассировки ETW в код службы вы можете снова скомпилировать, развернуть и запустить приложение, чтобы просмотреть события в средстве просмотра данных диагностики. При запуске отладки приложения с помощью клавиши F5 средство просмотра данных диагностики открывается автоматически.

##Скоро
Код трассировки, добавленный в приложение для локальной диагностики, будет работать с инструментами, используемыми для просмотра соответствующих событий при выполнении того же кода в кластере Azure. Дополнительная информация будет доступна в ближайшее время.

## Дальнейшие действия

* [Общие сведения о работоспособности в Service Fabric](service-fabric-health-introduction.md)
* [Настройка Application Insights](service-fabric-diagnostics-application-insights-setup.md)
* [Диагностика и мониторинг производительности субъектов в Azure Service Fabric](service-fabric-reliable-actors-diagnostics.md)
* [Диагностика надежных служб с отслеживанием состояния](service-fabric-reliable-services-diagnostics.md)
 

<!---HONumber=July15_HO4-->