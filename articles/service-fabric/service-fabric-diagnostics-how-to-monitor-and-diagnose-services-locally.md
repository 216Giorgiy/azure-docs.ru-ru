<properties
   pageTitle="Платформа Microsoft Azure Service Fabric: локальный мониторинг состояния и диагностика служб"
   description="В этой статье описывается мониторинг и диагностика состояния служб с использованием платформы Microsoft Azure Service Fabric на локальном компьютере для разработки."
   services="service-fabric"
   documentationCenter=".net"
   authors="kunaldsingh"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="11/04/2015"
   ms.author="kunalds"/>


# Мониторинг и диагностика состояния служб в локальной среде разработки
Благодаря возможностям мониторинга состояния, а также выявления, диагностики и устранения неполадок службы могут работать практически без перерывов. Контролировать состояние в рабочей среде очень важно. Однако можно существенно повысить эффективность работы и обеспечить успешное перемещение служб в рабочую среду, внедрив аналогичную модель мониторинга во время разработки служб. Платформа Service Fabric позволяет использовать средства диагностики, которые одинаково хорошо работают как в среде разработки на одном локальном компьютере, так и в реальном рабочем кластере.

## Зачем использовать ETW для трассировки и ведения журнала
Для трассировки сообщений в Service Fabric рекомендуется использовать технологию [трассировки событий Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803.aspx) (ETW). На это есть несколько причин:

* ETW работает быстро. Технология разработана таким образом, что время выполнения кода практически не меняется.
* Трассировка событий Windows одинаково работает в локальных средах разработки и в рабочем кластере. Это означает, что вам не потребуется изменять код трассировки, когда вы будете готовы развернуть свой код в реальном кластере.
* Для внутренней трассировки системного кода Service Fabric также используется ETW. Данные с точек трассировки приложения можно просматривать параллельно с данными с системных точек трассировки Service Fabric, что облегчает установление связей между кодом приложения и событиями в базовой системе.
* В инструментах Visual Studio для работы с Service Fabric поддержка событий ETW предусмотрена по умолчанию.


## Просмотр системных событий Service Fabric в Visual Studio

Service Fabric генерирует события ETW, чтобы разработчики понимали, что происходит в платформе. Если это еще не сделано, следуйте указаниям раздела [Создание первого приложения в Visual Studio](./service-fabric-create-your-first-application-in-visual-studio.md), чтобы получить запущенное и работающее приложение со средством просмотра событий диагностики, показывающим сообщения трассировки.

1. Если окно «События диагностики» не откроется автоматически, перейдите в обозреватель серверов в Visual Studio, щелкните правой кнопкой мыши кластер Service Fabric и выберите в контекстном меню команду «Просмотреть события диагностики».

  ![Откройте средство просмотра событий диагностики Visual Studio](./media/service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally/ServerExViewDiagEvents.png)

2. Стандартные метаданные события включают сведения об исходных узле, приложении и службе. События в списке событий можно фильтровать (например, по имени узла или службы), используя поле фильтра в верхней части окна. Также при просмотре информации о событии можно приостановить поток информации с помощью кнопки в верхней части окна, а позже возобновить его без потери событий.

  ![Средство просмотра событий диагностики Visual Studio](./media/service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally/DiagEventsExamples2.png)

## Добавление собственных точек трассировки в код приложения
В шаблонах проектов Service Fabric в Visual Studio приведен пример кода, демонстрирующий добавление в код приложения собственных точек трассировки ETW. Их данные отображаются в средстве просмотра данных ETW в Visual Studio вместе с системными данными трассировки Service Fabric. Преимущество этого метода заключается в том, что метаданные автоматически добавляются в точки трассировки и их отображение уже настроено в средстве просмотра данных диагностики Visual Studio.

Для проектов, созданных из **шаблонов служб** (с отслеживанием или без отслеживания состояния), просто ищите реализацию `RunAsync`:

1. Вызовите `ServiceEventSource.Current.ServiceMessage` с помощью метода `RunAsync`, чтобы просмотреть пример пользовательской точки трассировки ETW в коде приложения.
2. В файле **ServiceEventSource.cs** вы найдете перегрузку для метода `ServiceEventSource.ServiceMessage`, которая должна использоваться для событий с высокой частотой по соображениям производительности.

Для проектов, созданных из **шаблонов субъектов** (с отслеживанием или без отслеживания состояния):

1. Откройте файл **имя\_проекта.cs**, где *имя_проекта* — это имя, которое вы выбрали для своего проекта Visual Studio.  
2. Найдите строку `ActorEventSource.Current.ActorMessage(this, "Doing Work");` в методе *DoWorkAsync*. Это пример пользовательской точки трассировки ETW из кода приложения.  
3. В файле **ActorEventSource.cs** вы найдете перегрузку для метода `ActorEventSource.ActorMessage`, которая должна использоваться для событий с высокой частотой по соображениям производительности.

После добавления пользовательской точки трассировки ETW в код службы вы можете снова скомпилировать, развернуть и запустить приложение, чтобы просмотреть события в средстве просмотра данных диагностики. При запуске отладки приложения с помощью клавиши F5 средство просмотра данных диагностики открывается автоматически.

## Дальнейшие действия
Один и тот же код трассировки, добавленный в приложение выше для локальной диагностики, будет работать с инструментами, которые вы можете использовать для просмотра этих событий при выполнении приложения в кластере Azure. Ознакомьтесь с приведенными ниже статьями, в которых рассматриваются различные варианты инструментов и описывается, как их можно настроить. * [Сбор журналов из кластера Service Fabric в Azure с помощью системы диагностики Microsoft Azure и оперативная аналитика](service-fabric-diagnostics-how-to-setup-wad-operational-insights.md) * [Использование ElasticSearch как хранилища трассировок приложения Service Fabric](service-fabric-diagnostic-how-to-use-elasticsearch.md)

<!----HONumber=Nov15_HO4-->