<properties
   pageTitle="Обновление приложения структуры служб"
   description="В этой статье представлена вводная информация об обновлении приложения структуры служб."
   services="service-fabric"
   documentationCenter=".net"
   authors="mani-ramaswamy"
   manager="samgeo"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="07/17/2015"
   ms.author="subramar"/>


# Обновление приложения структуры служб


Приложение структуры служб представляет собой коллекцию служб. Во время обновления структура служб сравнивает новый [манифест приложения](service-fabric-application-model.md#describe-an-application) с предыдущей версией и определяет, каким службам в приложении требуется обновление. Это определяется путем сравнения номеров версий в манифестах служб с предыдущими версиями. Если служба не была изменена, эта служба не обновляется.

## Обзор последовательных обновлений
При последовательном обновлении приложения обновление выполняется поэтапно. На каждом этапе обновление применяется к определенному подмножеству узлов в кластере, который называется доменом обновления. В результате этого приложение остается доступным в течение всего времени обновления. Во время обновления в кластере может содержаться сочетание старых и новых версий приложения. По этой причине обе версии должны обладать прямой и обратной совместимостью. Если такая совместимость отсутствует, администратор приложения несет ответственность за поэтапное многофазное обновление для обеспечения доступности. Это делается путем выполнения обновления с использованием промежуточной версии приложения, которая будет одинаково совместима с предыдущей версией до обновления и с финальной версией.

Домены обновления указываются в манифесте кластера при его настройке. Не следует полагать, что домены обновления будут получать обновления в определенном порядке. Домен обновления представляет собой логическую единицу, в пределах которой развертывается то или иное приложение. Домены обновления позволяют сохранять высокий уровень доступности служб во время обновления.

Непоследовательные обновления возможны в том случае, если обновление применяется ко всем узлам кластера, что и происходит, если у приложения имеется только один домен обновления. Это не рекомендуется, поскольку служба будет отключена и недоступна в течение всего срока выполнения обновления. Кроме того, Azure не предоставляет никаких гарантий в случаях, когда кластер настраивается только с одним доменом обновления.

## Проверки работоспособности во время обновления
Для обновления необходимо настроить политики работоспособности (могут также использоваться значения по умолчанию). Обновление считается успешным, когда все домены обновления обновлены в пределах заданного времени ожидания, а все домены обновления сочтены работоспособными. Работоспособный домен обновления означает, что домен обновления проходит все проверки работоспособности, указанные в политике работоспособности, при этом политика работоспособности может требовать, чтобы все службы в экземпляре приложения были <em>работоспособны</em>, поскольку работоспособность определяется на уровне структуры служб.

Политики работоспособности и проверки во время обновлений средствами структуры служб не опираются на службы и приложения. Это означает, что проверка результатов тестирования конкретных служб не выполняется. Например, для вашей службы может быть задано минимальное требование по пропускной способности. Однако структура службы не обладает сведениями, необходимыми, чтобы это проверить, поэтому проверка пропускной способности не будет выполняться в соответствии с заданными в приложениях параметрами. См. [статьи о работоспособности](service-fabric-health-introduction.md), чтобы узнать о выполняемых проверках работоспособности — при обновлении выполняется проверки правильности копирования пакета приложения, запуска экземпляра и т. п.

Работоспособность приложения фактически представляет собой коллекцию дочерних сущностей приложения. Одним словом, структура служб выполняет оценку работоспособности приложения по переданным данным о работоспособности приложения, а также по данным о работоспособности служб для этого приложения. Работоспособность служб приложения далее оценивается путем статистической обработки данных о работоспособности их дочерних элементов, таких как реплики служб. После того как условия политики работоспособности приложения будут удовлетворены, обновление может продолжиться, в противном случае при нарушении условий политики работоспособности обновление не будет успешным.

## Режимы обновления

Обычным (и рекомендуемым) режимом обновления является отслеживаемое обновление. В отслеживаемом режиме обновление выполняется на одном домене обновления и, при успешном разрешении всех проверок безопасности (в соответствии с определенной политикой), переходит к другому домену обновления автоматически и т. д. Если проверки работоспособности завершаются с ошибкой или превышены значения времени ожидания, выполняется либо откат обновления для домена обновления, либо режим изменяется на UnmonitoredManual, если выбран соответствующий параметр во время обновления.

При использовании режима UnmonitoredManual потребуется ручное вмешательство после каждого обновления в домене обновления, чтобы перевести обновление на следующий домен обновления. Проверки работоспособности на уровне структуры служб не выполняются, действует промежуточный механизм для выполнения проверок работоспособности или состояния перед началом обновления в следующем домене обновления.

## Диаграмма хода обновления приложения

Диаграмма ниже помогает понять процесс обновления приложения структуры служб. В частности, в диаграмме описано, как значения времени ожидания, в том числе *HealthCheckStableDuration*, *HealthCheckRetryTimeout* и *UpgradeHealthCheckInterval*, помогают управлять тем, при каких обстоятельствах обновление домена обновления будет сочтено успешным или неудачным.

![Процесс обновления приложения структуры служб][image]


## Дальнейшие действия

[Учебник по обновлению](service-fabric-application-upgrade-tutorial.md)

[Параметры обновления](service-fabric-application-upgrade-parameters.md)

[Сериализация данных](service-fabric-application-upgrade-data-serialization.md)

[Дополнительные разделы](service-fabric-application-upgrade-advanced.md)

[Поиск и устранение неисправностей при обновлении приложения](service-fabric-application-upgrade-troubleshooting.md)



[image]: media/service-fabric-application-upgrade/service-fabric-application-upgrade-flowchart.png
 

<!---HONumber=Oct15_HO3-->