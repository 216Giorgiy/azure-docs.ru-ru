<properties
   pageTitle="Диспетчер кластерных ресурсов Service Fabric: стоимость перемещения"
   description="Общие сведения о стоимости перемещения для служб Service Fabric"
   services="service-fabric"
   documentationCenter=".net"
   authors="masnider"
   manager="timlt"
   editor=""/>

<tags
   ms.service="Service-Fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="03/03/2016"
   ms.author="masnider"/>

# Стоимость перемещения
Еще одним важным фактором, который мы принимаем во внимание при попытке определить, какие изменения вносить в кластер и как оценить данное решения, является общая стоимость этого решения.

Перемещение экземпляров или реплик службы как минимум требует затрат процессорного времени и пропускной способности сети. А в случае служб с отслеживанием состояния также затрачивается дисковое пространство, необходимое для создания копии состояния перед завершением работы старых реплик. Очевидно, что вы хотели бы свести к минимуму затраты на любое решение с использованием диспетчера ресурсов, но также вы не хотели бы игнорировать решения, которые значительно улучшили бы распределение ресурсов кластера.

При использовании диспетчера ресурсов Service Fabric можно двумя способами вычислить затраты и ограничить их. Во-первых, когда диспетчер ресурсов планирует новый макет для кластера, он подсчитывает каждое действие, которое потребуется выполнить. В самом простом случае, если вы получите два решения примерно с одинаковым общим балансом (оценкой), то сможете просто выбрать решение с наиболее низкими затратами (общим числом перемещений). Это прекрасно работает, пока не возникает та же проблема, что и с нагрузкой по умолчанию или статической нагрузкой: маловероятно, что в любой сложной системе все перемещения равноценны. Некоторые могут быть более затратными. Как и в случае с нагрузкой, мы даем службе возможность самостоятельно сообщить о том, насколько затратно ее переместить в любой момент времени.

Код

```csharp
this.ServicePartition.ReportMoveCost(MoveCost.Medium);
```

MoveCost имеет четыре уровня: Zero, Low, Medium и High. Повторюсь, это относительные уровни, за исключением Zero, который означает, что перемещение реплики не требует затрат и не должно учитываться в оценке решения. Если настроить стоимость перемещения High, это не гарантирует, что реплика не будет перемещена. Просто мы не станем ее перемещать без веской причины.

![Влияние стоимости перемещения на выбор реплик для перемещения][Image1]

Стоимость перемещения помогает найти решения, которые в целом приводят к меньшему прерыванию работы и позволяют достичь равноценного баланса. Понятие стоимости службы может зависеть от многих факторов, но наиболее распространенными являются следующие:

1.	Объем данных состояния или информации, перемещаемой для службы.
2.	Стоимость отключения клиентов (то есть затраты на перемещение первичной реплики будет выше, чем затраты на перемещение вторичной реплики).
3.	Стоимость прерывания некоторых активных операций (некоторые операции уровня хранилища данных являются дорогостоящими, и на определенном этапе их не следует прерывать без крайней необходимости). Поэтому во время эксплуатации вы увеличиваете стоимость, чтобы уменьшить вероятность перемещения реплики или экземпляра службы, а после завершения операции восстанавливаете ее обычное значение.

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## Дальнейшие действия
- [Дополнительная информация о метриках](service-fabric-cluster-resource-manager-metrics.md)
- [Дополнительные сведения о балансировке нагрузки в кластере с помощью диспетчера кластерных ресурсов](service-fabric-cluster-resource-manager-balancing.md)

[Image1]: ./media/service-fabric-cluster-resource-manager-movement-cost/service-most-cost-example.png

<!---HONumber=AcomDC_0309_2016-->