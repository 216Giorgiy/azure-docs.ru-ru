.<properties
   pageTitle="Диспетчер кластерных ресурсов Service Fabric: стоимость перемещения | Microsoft Azure"
   description="Общие сведения о стоимости перемещения для служб Service Fabric"
   services="service-fabric"
   documentationCenter=".net"
   authors="masnider"
   manager="timlt"
   editor=""/>

<tags
   ms.service="Service-Fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="08/19/2016"
   ms.author="masnider"/>

# Влияние стоимости перемещения службы на выбор диспетчера ресурсов
Еще одним важным фактором, который мы принимаем во внимание при попытке определить, какие изменения вносить в кластер и как оценить данное решения, является общая стоимость этого решения.

Перемещение экземпляров или реплик службы как минимум требует затрат процессорного времени и пропускной способности сети. А в случае служб с отслеживанием состояния также затрачивается дисковое пространство, необходимое для создания копии состояния перед завершением работы старых реплик. Очевидно, что вы хотели бы свести к минимуму затраты на любое решение с использованием диспетчера кластерных ресурсов, но также вы не хотели бы игнорировать решения, которые значительно улучшили бы распределение ресурсов в кластере.

В диспетчере кластерных ресурсов есть два способа вычисления затрат и их ограничения, применяемых даже при попытке управлять кластером в соответствии с другими его целями. Во-первых, когда диспетчер кластерных ресурсов планирует новый макет для кластера, он подсчитывает каждое действие, которое потребуется выполнить. В самом простом случае, если вы получите два решения примерно с одинаковым общим балансом (оценкой), то сможете просто выбрать решение с наиболее низкими затратами (общим числом перемещений).

Это прекрасно работает, пока не возникает та же проблема, что и с нагрузкой по умолчанию или статической нагрузкой: маловероятно, что в любой сложной системе все перемещения равноценны. Некоторые могут быть более затратными.

## Изменение стоимости перемещения реплики и факторы, которые следует учитывать
Как и при создании отчетов о нагрузке (еще одна функция диспетчера кластерных ресурсов), мы предоставляем службе возможность самостоятельно сообщать о том, насколько затратно ее перемещать в любой момент времени.

Код

```csharp
this.ServicePartition.ReportMoveCost(MoveCost.Medium);
```

MoveCost имеет четыре уровня: Zero, Low, Medium и High. Повторюсь, это относительные уровни, за исключением Zero, который означает, что перемещение реплики не требует затрат и не должно учитываться в оценке решения. Если настроить стоимость перемещения High, это *не* гарантирует, что реплика не будет перемещена. Просто она не будет перемещена без веской причины.

![Влияние стоимости перемещения на выбор реплик для перемещения][Image1]

Параметр MoveCost помогает найти решения, которые в целом приводят к меньшему прерыванию работы и позволяют легче достичь равноценного баланса. Понятие стоимости службы может зависеть от многих факторов. Наиболее распространенные представлены ниже.

1.	Объем данных состояния или информации, перемещаемой для службы.
2.	Стоимость отключения клиентов (то есть затраты на перемещение первичной реплики обычно будут выше, чем затраты на перемещение вторичной реплики).
3.	Стоимость прерывания некоторых текущих операций (некоторые операции уровня хранилища данных или операции, выполняемые в ответ на вызов клиента, являются дорогостоящими, и на определенном этапе их не следует прерывать без крайней необходимости). Поэтому во время эксплуатации вы увеличиваете стоимость, чтобы уменьшить вероятность перемещения реплики или экземпляра службы, а после завершения операции восстанавливаете ее обычное значение.

## Дальнейшие действия
- Метрики показывают, как диспетчер кластерных ресурсов Service Fabric управляет потреблением и емкостью в кластере. Дополнительные сведения о метриках и их настройке см. в [этой статье](service-fabric-cluster-resource-manager-metrics.md).
- Чтобы узнать, как диспетчер кластерных ресурсов управляет нагрузкой кластера и балансирует ее, ознакомьтесь со статьей о [балансировке нагрузки](service-fabric-cluster-resource-manager-balancing.md).

[Image1]: ./media/service-fabric-cluster-resource-manager-movement-cost/service-most-cost-example.png

<!---HONumber=AcomDC_0824_2016-->