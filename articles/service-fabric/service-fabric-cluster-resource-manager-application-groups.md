---
title: "Диспетчер кластерных ресурсов Service Fabric: группы приложений | Документация Майкрософт"
description: "Общие сведения о назначении групп приложений в диспетчере кластерных ресурсов службы Fabric Service"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 4cae2370-77b3-49ce-bf40-030400c4260d
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 01/05/2017
ms.author: masnider
translationtype: Human Translation
ms.sourcegitcommit: eef9cbca0479801cbac53ae1ae5713d4dac6a4bf
ms.openlocfilehash: 57525cd41d518b12f3f465d5dea7247659e3c8b6


---
# <a name="introduction-to-application-groups"></a>Введение в группы приложений
Диспетчер кластерных ресурсов Service Fabric, который управляет ресурсами кластера, обычно равномерно распределяет нагрузку (представленную в [метриках](service-fabric-cluster-resource-manager-metrics.md)) по всему кластеру. Service Fabric также управляет емкостью узлов в кластере и [емкостью](service-fabric-cluster-resource-manager-cluster-description.md) кластера в целом. Метрики и емкость отлично работают для большинства рабочих нагрузок, но для структур, активно использующих разные экземпляры приложений Service Fabric, иногда возникают дополнительные требования. К таким дополнительным требованиям обычно относятся:

* возможность резервировать в кластере емкость для служб экземпляров приложений;
* возможность ограничивать общее количество узлов, на которых выполняются службы в рамках приложения;
* определение емкости для самого экземпляра приложения, чтобы ограничивать внутренний объем потребления ресурсов.

Для соблюдения этих требований диспетчер кластерных ресурсов Service Fabric поддерживает группы приложений.

## <a name="managing-application-capacity"></a>Управление емкостью приложения
Емкость приложения можно использовать для ограничения количества узлов, на которых оно выполняется. Также она позволяет ограничить нагрузку метрики для службы приложений на отдельных узлах и в целом. Также вы можете резервировать ресурсы кластера для приложения.

Емкость приложения можно настраивать при создании новых приложений и изменять для уже существующих.

### <a name="limiting-the-maximum-number-of-nodes"></a>Ограничение максимального количества узлов
В простейшем варианте использования емкость приложения позволяет ограничить количество узлов, на которых создаются экземпляры приложения. Если емкость приложения не указана, диспетчер кластерных ресурсов Service Fabric создает и размещает службы согласно обычным правилам (балансировки или дефрагментации).

Следующий рисунок демонстрирует экземпляры приложения, для которых определены или не определены ограничения по максимальному количеству узлов. Такой подход не определяет, какие реплики или экземпляры каких служб будут расположены вместе. Он также не определяет, какие узлы будут использоваться.

<center>
![Определение максимального количества узлов для экземпляров приложения][Image1]
</center>

В примере слева для приложения с тремя службами не задана емкость приложения. Менеджер кластерных ресурсов распределил реплики по всем шести доступным узлам, чтобы сбалансировать нагрузку на кластер. В примере справа мы видим то же приложение, но с ограничением до трех узлов.

Такое поведение управляется параметром MaximumNodes. Этот параметр можно задать при создании приложения или изменить для уже выполняющегося экземпляра приложения.

PowerShell

``` posh
New-ServiceFabricApplication -ApplicationName fabric:/AppName -ApplicationTypeName AppType1 -ApplicationTypeVersion 1.0.0.0 -MaximumNodes 3
Update-ServiceFabricApplication –Name fabric:/AppName –MaximumNodes 5
```

C#

``` csharp
ApplicationDescription ad = new ApplicationDescription();
ad.ApplicationName = new Uri("fabric:/AppName");
ad.ApplicationTypeName = "AppType1";
ad.ApplicationTypeVersion = "1.0.0.0";
ad.MaximumNodes = 3;
fc.ApplicationManager.CreateApplicationAsync(ad);

ApplicationUpdateDescription adUpdate = new ApplicationUpdateDescription(new Uri("fabric:/AppName"));
adUpdate.MaximumNodes = 5;
fc.ApplicationManager.UpdateApplicationAsync(adUpdate);

var appMetric = new ApplicationMetricDescription();
appMetric.Name = "Metric1";
appMetric.TotalApplicationCapacity = 1000;

adUpdate.Metrics.Add(appMetric);
```

## <a name="application-metrics-load-and-capacity"></a>Метрики, нагрузка и емкость приложения
Группы приложений позволяют также определять метрики для конкретного экземпляра приложения и устанавливать емкость приложения по этим метрикам. Это позволяет отслеживать, резервировать и ограничивать потребление ресурсов службами внутри конкретного экземпляра приложения.

Для каждой метрики приложения можно установить два значения.

* **Общая емкость приложения**. Это значение представляет общую емкость всего приложения по определенной метрике. Диспетчер кластерных ресурсов запрещает создание новых служб для этого экземпляра приложения, если такое создание приведет к превышению указанного значения общей емкости. Рассмотрим такой пример: для экземпляра приложения указано ограничение емкости 10, а текущая нагрузка составляет 5. В этой ситуации будет запрещено создание службы, для которой указана стандартная нагрузка 10.
* **Максимальная емкость узла**. Это значение определяет максимальную общую нагрузку для всех реплик служб приложения на одном узле. Если общая нагрузка на одном узле превысит эту емкость, диспетчер кластерных ресурсов Service Fabric попытается переместить реплики на другие узлы, чтобы соблюдать ограничение по емкости.

## <a name="reserving-capacity"></a>Резервирование емкости
Еще одно распространенное использование групп приложений — резервирование ресурсов кластера для конкретного экземпляра приложения. Это можно сделать, даже если в экземпляре приложения не созданы службы или они не потребляют ресурсы. Посмотрим, как это происходит.

### <a name="specifying-a-minimum-number-of-nodes-and-resource-reservation"></a>Минимальное количество узлов и резервирование ресурсов
Чтобы зарезервировать ресурсы для экземпляра приложения, следует использовать два других дополнительных параметра: *MinimumNodes* и *NodeReservationCapacity*.

* **MinimumNodes** (Минимальное количество узлов). Вы можете указать не только максимальное количество узлов, на которых будут работать службы приложения, но и минимальное. Этот параметр определяет количество узлов, на которых будут зарезервированы ресурсы, то есть при создании экземпляра приложения ему будет выделена гарантированная емкость в кластере.
* **NodeReservationCapacity** (Зарезервированная емкость узла). Этот параметр можно установить для любой метрики в пределах приложения. Он определяет, какая величина этой метрики будет зарезервирована для приложения на каждом узле, на котором размещаются любые реплики или экземпляры служб этого приложения.

Рассмотрим пример резервирования емкости.

<center>
![Определение резервируемой емкости для экземпляров приложения][Image2]
</center>

В примере слева для приложений не определены параметры емкости. Диспетчер кластерных ресурсов распределяет всю нагрузку по обычным правилам.

Допустим, в примере справа приложение было создано со следующими параметрами:

* MinimumNodes имеет значение&2;
* MaximumNodes имеет значение&3;
* для приложения определена метрика со следующими значениями:
  * NodeReservationCapacity = 20;
  * MaximumNodeCapacity = 50;
  * TotalApplicationCapacity = 100.

Service Fabric резервирует мощность на двух узлах для приложения, выделенного синим цветом, и не позволяет использовать его емкость службам других экземпляров приложения в кластере. Зарезервированная для приложения емкость считается потребляемой и будет учитываться при определении остатка доступной емкости на этом узле или в кластере.

Когда приложение создается с резервированием ресурсов, диспетчер кластерных ресурсов выделяет для него емкость в размере MinimumNodes × NodeReservationCapacity (для каждой метрики). На конкретном узле емкость резервируется только в тот момент, когда на нем появляется хотя бы одна реплика. Этот второй этап резервирования позволяет более гибко и более эффективно использовать ресурсы, поскольку на конкретных узлах резервирование происходит только по мере необходимости.

## <a name="obtaining-the-application-load-information"></a>Получение сведений о нагрузке приложения
Для каждого приложения с определенной емкостью вы можете получить сведения о суммарной нагрузке, создаваемой репликами его служб.

Например, следующий командлет PowerShell позволяет получить информацию о нагрузке:

``` posh
Get-ServiceFabricApplicationLoad –ApplicationName fabric:/MyApplication1

```

Запрос ApplicationLoad возвращает основные сведения о параметрах емкости, указанных для приложения. Сюда входят данные о минимальном и максимальном числе узлов, а также о том, сколько узлов приложение занимает в настоящее время. Также вы получите информацию по каждой метрике нагрузки для приложения, в том числе перечисленные ниже сведения.

* Metric Name: имя метрики.
* Reservation Capacity: емкость, зарезервированная в кластере для этого приложения.
* Application Load: общая нагрузка, создаваемая дочерними репликами этого приложения.
* Application Capacity: максимально допустимое значение нагрузки приложения.

## <a name="removing-application-capacity"></a>Удаление емкости приложения
Когда для приложения будут установлены параметры емкости приложения, их можно будет удалить с помощью API-интерфейсов обновления приложения или командлетов PowerShell. Например:

``` posh
Update-ServiceFabricApplication –Name fabric:/MyApplication1 –RemoveApplicationCapacity

```

Эта команда удаляет все параметры емкости, установленные для приложения. Команда применяется немедленно. После выполнения этой команды диспетчер кластерных ресурсов использует режим по умолчанию для управления приложениями. Параметры емкости для приложения можно задать снова, используя команду Update-ServiceFabricApplication.

### <a name="restrictions-on-application-capacity"></a>Ограничения на емкость приложений
Существует ряд ограничений на параметры емкости приложений, которые необходимо соблюдать. Если при проверке параметров обнаружатся ошибки, создание или обновление приложения будет отклонено с ошибкой и изменения применяться не будут.

* Все числовые параметры должны иметь неотрицательные значения.
* MinimumNodes не может иметь значение больше, чем MaximumNodes.
* Если определены емкости для метрики нагрузки, они должны соответствовать следующим правилам.
  * NodeReservationCapacity не может иметь значение больше, чем MaximumNodeCapacity. Например, вы не можете для метрики нагрузки на процессор на узле установить ограничение в две единицы и одновременно зарезервировать по три единицы этого ресурса на каждом узле.
  * Если указан параметр MaximumNodes, произведение значений MaximumNodes и MaximumNodeCapacity не может быть больше, чем значение TotalApplicationCapacity. Предположим, вы установили значение&8; для максимальной емкости узла для метрики нагрузки на процессор. При этом максимальное число узлов вы ограничили числом&10;. В этом случае общая емкость приложения для этой метрики нагрузки должна быть больше 80.

Эти ограничения применяются как при создании приложения (на стороне клиента), так и при его обновлении (на стороне сервера).

## <a name="how-not-to-use-application-capacity"></a>Как не следует использовать емкость приложения
* Не пытайтесь с помощью групп приложений сделать так, чтобы приложение выполнялось на _определенном_ подмножестве узлов. Другими словами, вы можете указать, что для приложения нельзя использовать больше пяти узлов, но не можете выбрать, какие именно это будут узлы в кластере. Чтобы прикрепить приложение к конкретным узлам, используйте ограничения на размещение для служб.
* Не пытайтесь с помощью емкости приложений разместить две службы одного приложения вместе. Требование о выполнении служб на одном узле реализуется через сходство или с помощью ограничений на размещение, в зависимости от конкретных требований.

## <a name="next-steps"></a>Дальнейшие действия
* Дополнительные сведения о других вариантах настройки служб см. в статье [Настройка параметров диспетчера кластерных ресурсов для служб Service Fabric](service-fabric-cluster-resource-manager-configure-services.md).
* Чтобы узнать, как диспетчер кластерных ресурсов управляет нагрузкой кластера и балансирует ее, ознакомьтесь со статьей о [балансировке нагрузки](service-fabric-cluster-resource-manager-balancing.md)
* Начните с самого начала, [изучив общие сведения о диспетчере кластерных ресурсов Service Fabric](service-fabric-cluster-resource-manager-introduction.md)
* Дополнительные сведения об использовании метрик см. в статье [Управление потреблением ресурсов и нагрузкой в Service Fabric с помощью метрик](service-fabric-cluster-resource-manager-metrics.md).
* Диспетчер кластерных ресурсов предоставляет много параметров для описания кластера. Дополнительные сведения об этих параметрах см. в статье с [описанием кластера Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md).

[Image1]:./media/service-fabric-cluster-resource-manager-application-groups/application-groups-max-nodes.png
[Image2]:./media/service-fabric-cluster-resource-manager-application-groups/application-groups-reserved-capacity.png



<!--HONumber=Jan17_HO1-->


