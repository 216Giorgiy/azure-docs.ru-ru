<properties
   pageTitle="Создание локального или полиоблачного кластера Azure Service Fabric | Microsoft Azure"
   description="Узнайте, как создать кластер Azure Service Fabric на любом компьютере (физическом или виртуальном) под управлением Windows Server, расположенном в локальной системе или облаке."
   services="service-fabric"
   documentationCenter=".net"
   authors="ChackDan"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="05/12/2016"
   ms.author="chackdan"/>


# Создание кластера Azure Service Fabric в локальной системе или облаке

Azure Service Fabric позволяет создавать кластеры Service Fabric на любых виртуальных машинах или компьютерах под управлением Windows Server. Это означает, что вы сможете разворачивать и запускать приложения Service Fabric в любой среде с набором подключенных друг к другу компьютеров под управлением Windows Server как локально, так и у любого поставщика облачных служб. Service Fabric предоставляет установочный пакет для создания таких кластеров Service Fabric.

В этой статье подробно рассматривается создание кластера с использованием изолированного пакета для локальной версии Service Fabric, хотя эту процедуру легко адаптировать к любой среде, в том числе к другим облачным решениям.

## Загрузка изолированного пакета Service Fabric

[Скачайте изолированный пакет для развертывания Service Fabric для Windows Server 2012 R2](http://go.microsoft.com/fwlink/?LinkId=730690) с именем *Microsoft.Azure.ServiceFabric.WindowsServer.&lt;version&gt;.zip*.

В скачиваемом пакете вы найдете следующие файлы.

|**Имя файла**|**Краткое описание**|
|-----------------------|--------------------------|
|MicrosoftAzureServiceFabric.cab|CAB-файл, содержащий двоичные файлы, которые будут развернуты на каждом компьютере в кластере.|
|ClusterConfig.JSON|Файл конфигурации кластера, который содержит все параметры кластера, в том числе сведения о каждом компьютере, который является частью кластера.|
|EULA.txt|Условия лицензии на использование изолированного пакета Microsoft Azure Service Fabric. [Щелкните здесь](http://go.microsoft.com/fwlink/?LinkID=733084), если хотите скачать копию лицензионного соглашения.|
|Readme.txt|Ссылка на заметки о выпуске и инструкции по стандартной установке. На этой странице вы найдете лишь небольшой набор инструкций.|
|CreateServiceFabricCluster.ps1|Сценарий PowerShell, который создает кластер, используя параметры в файле ClusterConfig.JSON.|
|RemoveServiceFabricCluster.ps1|Сценарий PowerShell для удаления кластера с использованием параметров в файле ClusterConfig.JSON.|

## Планирование и подготовка развертывания кластера
Перед созданием кластера нужно выполнить следующие действия.

### Шаг 1. Планирование инфраструктуры кластера
Вы собираетесь создать кластер Service Fabric на принадлежащих вам компьютерах, поэтому вам нужно решить, к каким сбоям должен быть устойчив кластер. Например, нужны ли отдельные линии электропитания или подключения к Интернету для этих компьютеров? Кроме того, следует также учитывать физическую безопасность этих компьютеров. Где они расположены и кому нужен доступ к ним? После принятия этих решений следует логически сопоставить компьютеры с различными доменами сбоя (ниже приведены дополнительные сведения). Планирование инфраструктуры рабочих кластеров потребует гораздо больше усилий, чем для тестовых кластеров.

### Шаг 2. Подготовка компьютеров для соблюдения предварительных требований
Предварительные требования к каждому компьютеру, который требуется добавить в кластер.

- Рекомендуется не менее 2 ГБ памяти.
- Сетевое подключение. Убедитесь, что эти компьютеры находятся в защищенной сети или сетях.
- Windows Server 2012 R2 или Windows Server 2012 (для этой версии необходимо установить исправление KB2858668).
- Полностью установленная платформа .NET Framework 4.5.1 или более поздней версии.
- Windows PowerShell 3.0.
- У администратора кластера, который развертывает и настраивает кластер, должны быть привилегии администратора на всех компьютерах.
- На всех компьютерах должна быть запущена служба RemoteRegistry.

### Шаг 3. Определение исходного размера кластера
Каждый узел состоит из полного стека Service Fabric и является отдельных участником кластера Service Fabric. В типичной развернутой службе Service Fabric используется один узел на экземпляр ОС (физический или виртуальный). Размер кластера определяется потребностями бизнеса. Тем не менее размер кластера не должен быть меньше минимального, равного трем узлам (это могут быть компьютеры или виртуальные машины). Обратите внимание, что в целях разработки на одном компьютере можно настроить более одного узла. В рабочей среде Service Fabric поддерживает только один узел на физический компьютер или виртуальную машину.

### Шаг 4. Определение количества доменов сбоя и доменов обновления
**Домен сбоя** — это физическая единица сбоя, непосредственно связанная с физической инфраструктурой в центрах обработки данных. Домен сбоя состоит из аппаратных компонентов (компьютеры, коммутаторы и многое другое), совместно использующих единую точку отказа. Хотя нет однозначного соответствия между доменами сбоя и стойками, грубо говоря, каждую стойку можно считать доменом сбоя. При выборе узлов в кластере настоятельно рекомендуется распределить узлы по крайней мере на три домена сбоя.

При указании доменов сбоя в *ClusterConfig.JSON* необходимо выбрать имя домена сбоя. Service Fabric поддерживает иерархические домены сбоя, поэтому в них можно отразить имеющуюся топологию инфраструктуры. Например, допускается следующее.

- "faultDomain": "fd:/Room1/Rack1/Machine1"
- "faultDomain": "fd:/FD1"
- "faultDomain": "fd:/Room1/Rack1/PDU1/M1"


**Домен обновления** — это логическая единица узлов. Во время обновления под управлением Service Fabric (обновления приложения или кластера) все узлы в домене обновления отключаются для выполнения обновления, а узлы в других доменах обновления остаются доступными для обслуживания запросов. Обновления встроенного ПО, выполняемые на компьютерах, не связаны с работой доменов обновления, поэтому их необходимо выполнять на компьютерах по очереди.

Проще всего рассматривать эти понятия, считая домен сбоя единицей незапланированного сбоя, а домен обновления — единицей планового обслуживания.

При указании доменов обновления в *ClusterConfig.JSON* необходимо выбрать имя домена обновления. Например, допускается следующее.

- "upgradeDomain": "UD0"
- "upgradeDomain": "UD1A"
- "upgradeDomain": "DomainRed"
- "upgradeDomain": "Blue"

### Шаг 5. Скачивание изолированного пакета Service Fabric для Windows Server
[Скачайте изолированный пакет Service Fabric для Windows Server](http://go.microsoft.com/fwlink/?LinkId=730690) и извлеките его содержимое на компьютер развертывания, который не является частью кластера, или на один из компьютеров, который будет частью кластера.

## Создание кластера

Выполнив шаги, описанные в предыдущем разделе о планировании и подготовке, вы готовы к созданию кластера.

### Шаг 1. Изменение конфигурации кластера
Откройте файл *ClusterConfig.JSON* из скачанного пакета. Используя любой редактор на свой выбор, измените следующие параметры.

|**Параметр конфигурации**|**Описание**|
|-----------------------|--------------------------|
|NodeTypes|Типы узлов позволяют разделить узлы кластера на различные группы. У кластера должен быть по крайней мере один NodeType. Все узлы в группе имеют следующие общие характеристики. <br> *Name* — имя типа узла. <br>*EndPoints* — различные именованные конечные точки (порты), связанные с этим типом узла. Можно использовать любой номер порта на свой выбор, если он не конфликтует ни с каким параметром в этом манифесте и не используется другой программой на компьютере или виртуальной машине. <br> *PlacementProperties* — описывает свойства данного типа узла, которые можно будет использовать как ограничения размещения для системных или ваших служб. Это свойства представляют собой определяемые пользователем пары "ключ-значение", которые содержат дополнительные метаданные для заданного узла. К свойствам узла относится, например, наличие у него жесткого диска или видеоадаптера, количество шпинделей в его жестком диске, число ядер и другие физические качества. <br> *Capacities* — емкость узла определяет имя и величину конкретного ресурса, доступного для использования на конкретном узле. Например, для узла может быть определена емкость для метрики MemoryInMb и выделено 2048 МБ памяти, доступной по умолчанию. Емкости используются во время выполнения, чтобы гарантировать, что службы, которым требуется определенный объем ресурсов, будут размещены на узлах, обладающими такими ресурсами.|
|Nodes|Сведения о каждом из узлов, которые будут частью кластера (тип узла, имя узла, IP-адрес, домен сбоя и домен обновления узла). В этом разделе необходимо перечислить компьютеры, на основе которых вы хотите создать кластер, и их IP-адреса. <br> Если использовать одинаковые IP-адреса для всех узлов, то будет создан универсальный кластер, который можно использовать для тестирования. Универсальные кластеры не должны использоваться для развертывания рабочих нагрузок в рабочей среде.|

### Шаг 2. Выполнение сценария создания кластера
Изменив конфигурацию кластера в документе JSON и добавив все сведения об узлах, в папке пакета выполните сценарий PowerShell для создания кластера и передайте в него путь к файлу конфигурации и расположение корня пакета.

Этот сценарий может выполняться на любом компьютере, у которого есть доступ администратора ко всем компьютерам, перечисленным в качестве узлов в файле конфигурации кластера. Компьютер, на котором выполняется этот сценарий, может и не входить в кластер.

```
.\CreateServiceFabricCluster.ps1 -ClusterConfigFilePath C:\Microsoft.Azure.ServiceFabric.WindowsServer.5.0.135.9590\ClusterConfig.JSON -MicrosoftServiceFabricCabFilePath C:\Microsoft.Azure.ServiceFabric.WindowsServer.5.0.135.9590\MicrosoftAzureServiceFabric.cab
```

## Дальнейшие действия

После создания кластер необходимо защитить.
- [Безопасность кластера](service-fabric-cluster-security.md)

Прочтите следующие статьи, чтобы приступить к разработке и развертыванию приложений.
- [Пакет SDK для Service Fabric и начало работы](service-fabric-get-started.md)
- [Управление приложениями Service Fabric в Visual Studio](service-fabric-manage-application-in-visual-studio.md)

Узнайте больше о кластерах Azure и изолированных кластерах.
- [Разворачивайте приложения Service Fabric везде на Windows Server или Linux](service-fabric-deploy-anywhere.md)

<!---HONumber=AcomDC_0518_2016-->