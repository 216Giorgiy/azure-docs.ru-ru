---
title: "Анализ событий Azure Service Fabric с помощью OMS | Документы Майкрософт"
description: "Ознакомьтесь со сведениями о визуализации и анализе событий с использованием OMS для мониторинга и диагностики кластеров Azure Service Fabric."
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: timlt
editor: 
ms.assetid: 
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 10/15/2017
ms.author: dekapur
ms.openlocfilehash: f0cefab15a115719ea9c378546a7e6004bd06187
ms.sourcegitcommit: a7c01dbb03870adcb04ca34745ef256414dfc0b3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2017
---
# <a name="event-analysis-and-visualization-with-oms"></a>Анализ и визуализация событий с помощью OMS

Operations Management Suite (OMS) — это набор служб управления, которые помогают в мониторинге и диагностике приложений и служб, размещенных в облаке. Более подробные сведения о наборе OMS и его возможностях см. в статье [Что такое Operations Management Suite (OMS)?](../operations-management-suite/operations-management-suite-overview.md)

## <a name="log-analytics-and-the-oms-workspace"></a>Служба Log Analytics и рабочая область OMS

Служба Log Analytics собирает данные из управляемых ресурсов, включая таблицу или агент службы хранилища Azure, и сохраняет их в центральном репозитории. Эти данные далее могут использоваться для анализа, оповещения, визуализации или последующего экспорта. Log Analytics поддерживает события, данные производительности, а также любые иные пользовательские данные.

Если набор OMS настроен, вы получаете доступ к определенной *рабочей области OMS*, из которой данные можно запрашивать и визуализировать на панелях мониторинга.

После получения данных службой Log Analytics можно применять ряд *решений для управления* из состава набора OMS для отслеживания входящих данных. Эти решения оптимизированы для нескольких сценариев. К ним относятся *Аналитика Service Fabric* и *Контейнеры* — два наиболее важных решения для диагностики и мониторинга кластеров Service Fabric. Есть и другие решения, достойные рассмотрения. Кроме того, OMS позволяет создавать пользовательские решения, о чем можно больше узнать [здесь](../operations-management-suite/operations-management-suite-solutions.md). Все решения, которые вы выбираете для кластера, настраиваются в одной рабочей области OMS вместе с Log Analytics. Рабочие области обеспечивают использование пользовательских панелей мониторинга, визуализацию данных и изменение данных, которые необходимо собирать, обрабатывать и анализировать.

## <a name="setting-up-an-oms-workspace-with-the-service-fabric-analytics-solution"></a>Настройка рабочей области OMS в решении "Аналитика Service Fabric"
Мы рекомендуем включить в рабочую область OMS решение Service Fabric, которое включает панель мониторинга с входящими каналами журналов от уровней платформы и приложений и дает возможность запрашивать данные из определенных журналов Service Fabric. Так выглядит сравнительно простое решение Service Fabric с одним приложением, развернутым в кластере:

![Решение OMS Service Fabric](media/service-fabric-diagnostics-event-analysis-oms/service-fabric-solution.png)

Существует два способа подготовки и настройки рабочей области OMS: с помощью шаблона Resource Manager или напрямую из Azure Marketplace. Первый способ применяется при развертывании кластера, а второй — при наличии развернутого кластера с включенной диагностикой.

### <a name="deploying-oms-using-a-resource-management-template"></a>Развертывание OMS с помощью шаблона Resource Management

При развертывании кластера с помощью шаблона Resource Manager этот шаблон также может создать рабочую область OMS, добавить в нее решение Service Fabric и настроить в ней чтение данных из соответствующих таблиц службы хранилища.

>[!NOTE]
>Для этого должна быть включена диагностика. Таким образом обеспечивается наличие таблиц службы хранилища Azure, из которых OMS и Log Analytics считывают данные.

[Здесь](https://azure.microsoft.com/resources/templates/service-fabric-oms/) можно найти пример шаблона, который выполняет описанные выше действия и который вы можете использовать и изменять согласно требованиям. Если вам нужна дополнительная гибкость, есть и другие шаблоны, которые предоставляют различные возможности в зависимости от этапа настройки рабочей области OMS. Их можно найти на странице [шаблонов Service Fabric и OMS](https://azure.microsoft.com/resources/templates/?term=service+fabric+OMS).

### <a name="deploying-oms-using-through-azure-marketplace"></a>Развертывание OMS посредством Azure Marketplace

Если вы предпочитаете добавить рабочую область OMS после развертывания кластера, перейдите в Azure Marketplace и выполните поиск по запросу *Аналитика Service Fabric*.

![Аналитика Service Fabric OMS в Marketplace](media/service-fabric-diagnostics-event-analysis-oms/service-fabric-analytics.png)

* Нажмите кнопку **Создать**
* В окне создания Аналитики Service Fabric щелкните **Создать рабочую область**, чтобы появилось поле *Рабочая область OMS*, а затем выберите **Создать новую рабочую область**. Укажите необходимые записи. Единственным требованием является совпадение подписки для кластера Service Fabric и рабочей области OMS. Когда завершится проверка записей, начнется развертывание рабочей области OMS. Это займет не более нескольких минут.
* Когда процесс завершится, снова щелкните **Создать** в нижней части окна создания Аналитики Service Fabric. Убедитесь, что новая рабочая область отображается в разделе *Рабочая область OMS*. В таком случае решение будет добавлено в только что созданную рабочую область.


Хотя решение будет добавлено в рабочую область, ее все равно потребуется подключить к данным диагностики, поступающим из кластера. Перейдите к созданной группе ресурсов, в которой вы создали решение "Аналитика Service Fabric". Вы увидите в ней элемент *ServiceFabric (\<имя_рабочей_области_OMS\>)*.

* Щелкните это решение, чтобы открыть страницу обзора, на которой вы можете изменить параметры решения и (или) рабочей области, а также перейти на портал OMS.
* В меню навигации слева щелкните **Журналы учетной записи хранения** в разделе *Источники данных рабочей области*.

    ![Решение "Аналитика Service Fabric" на портале](media/service-fabric-diagnostics-event-analysis-oms/service-fabric-analytics-portal.png)

* На странице *Журналы учетной записи хранения* щелкните **Добавить** в верхней части, чтобы добавить в рабочую область журналы кластера.
* Щелкните элемент **Учетная запись хранения** и добавьте учетную запись хранения, созданную в кластере. Если вы использовали имя по умолчанию, она называется *sfdg\<имя_группы_ресурсов\>*. Вы можете проверить, какое значение указано для параметра `applicationDiagnosticsStorageAccountName` в шаблоне Azure Resource Manager, на основе которого вы развертывали кластер. Если имя учетной записи не отображается, прокрутите страницу до конца и щелкните **Загрузить еще**. Щелчком выберите нужное имя учетной записи хранения, когда оно появится на экране.
* Теперь укажите значение **События Service Fabric** для параметра *Тип данных*.
* При этом для параметра *Источник* будет автоматически установлено значение *WADServiceFabric\*EventTable*.
* Щелкните **ОК**, чтобы подключить рабочую область к журналам кластера.

    ![Добавление журналов учетной записи хранения к OMS](media/service-fabric-diagnostics-event-analysis-oms/add-storage-account.png)

* Теперь учетная запись будет отображаться в списке *Журналы учетной записи хранения* в разделе источников данных для рабочей области.

Это означает, что вы успешно добавили решение "Аналитика Service Fabric" в рабочую область OMS Log Analytics и подключили ее к платформе кластера и таблице журналов приложения. Аналогичным образом вы можете добавить в рабочую область дополнительные источники.

## <a name="using-the-oms-agent"></a>Использование агента OMS

В качестве решений для статистической обработки рекомендуется использовать EventFlow и WAD, так как они обеспечивают более модульный подход к диагностике и мониторингу. Например, если необходимо изменить выходные данные из EventFlow, изменение фактического инструментирования не потребуется. Нужно будет всего лишь внести небольшое изменение в файл конфигурации. Однако если вы решите инвестировать в использование набора OMS и захотите применять его для анализа событий (это необязательно должна быть единственная используемая платформа; более вероятно, что это будет одна из платформ), мы рекомендуем ознакомиться с настройкой [агента OMS](../log-analytics/log-analytics-windows-agents.md). При развертывании контейнеров в кластер используйте агент OMS, как описано ниже.

Соответствующий процесс сравнительно прост, так как необходимо всего лишь добавить агент в качестве расширения масштабируемого набора виртуальных машин в шаблон Resource Manager и установить его на каждом узле. Пример шаблона Resource Manager, развертывающего рабочую область OMS с решением Service Fabric (как описано выше) и добавляющего агент в узлы, можно найти для кластеров [Windows](https://github.com/ChackDan/Service-Fabric/tree/master/ARM%20Templates/SF%20OMS%20Samples/Windows) или [Linux](https://github.com/ChackDan/Service-Fabric/tree/master/ARM%20Templates/SF%20OMS%20Samples/Linux).

Ниже перечислены преимущества такого подхода.

* Более подробные данные счетчиков производительности и метрик.
* Из кластера собираются метрики, которые вы можете легко настроить, не меняя конфигурацию кластера. Изменения в параметры агента можно внести с помощью портала OMS. Агент автоматически перезапустится с новой требуемой конфигурацией. Чтобы настроить агент OMS для выбора конкретных счетчиков производительности, откройте рабочую область **Главная > Параметры > Данные > Счетчики производительности Windows** и выберите данные, которые следует собирать.
* Данные отображаются быстрее, чем при сохранении перед сбором OMS и службой Log Analytics.
* Отслеживать контейнеры гораздо проще, так как имеется возможность сбора журналов (stdout, stderr) и статистики (метрик производительности на уровнях контейнеров и узлов) для контейнеров Docker.

Но нужно учитывать то, что агент развертывается в кластере вместе с приложениями и несколько снижает их производительность.

## <a name="monitoring-containers"></a>Отслеживание контейнеров

При развертывании контейнеров в кластере Service Fabric рекомендуется установить в кластере агент OMS и добавить решение "Контейнеры" в рабочую область OMS, чтобы обеспечить мониторинг и диагностику. Вот как выглядит решение "Контейнеры" в рабочей области:

![Основная панель мониторинга OMS](./media/service-fabric-diagnostics-event-analysis-oms/oms-containers-dashboard.png)

Агент обеспечивает сбор нескольких журналов, относящихся к контейнерам, которые могут запрашиваться в OMS или использоваться для визуализации показателей эффективности. Собираются следующие типы журналов.

* ContainerInventory — отображает информацию о местонахождении контейнера, имени и образах.
* ContainerImageInventory — информация о развернутых образах, в том числе их идентификаторы или размеры.
* ContainerLog — журналы конкретных ошибок, журналы Docker (StdOut и т. д.) и другие записи.
* ContainerServiceLog — выполнявшиеся команды управляющей программы Docker.
* Perf — счетчики производительности контейнера, в том числе ЦП, память, сетевой трафик, операции ввода и вывода на диске и пользовательские метрики с компьютеров узла.

В этой статье рассматриваются шаги, необходимые для настройки мониторинга контейнера в кластере. Дополнительные сведения о решении OMS "Контейнеры" см. в [документации](../log-analytics/log-analytics-containers.md) по решению.

Чтобы настроить решение "Контейнеры" в рабочей области, необходимо развернуть агент OMS в узлах кластера, выполнив описанные выше действия. Когда кластер будет готов, разверните в нем контейнер. Не забывайте, что при первом запуске образ контейнера развертывается в кластер. Скачивание образа занимает несколько минут (в зависимости от его размера).

В Azure Marketplace найдите *Решение мониторинга контейнеров* и создайте требуемый результат **решения мониторинга контейнеров** в категории "Мониторинг и управление".

![Добавление решения "Контейнеры"](./media/service-fabric-diagnostics-event-analysis-oms/containers-solution.png)

На этапе создания решение запрашивает рабочую область OMS. Выберите рабочую область, которую вы создали во время развертывания. На этом шаге решение "Контейнеры" добавляется в рабочую область OMS и автоматически определяется агентом OMS, который развернут с помощью шаблона. Агент начнет сбор данных по процессам контейнеров в кластере, и менее чем через 15 минут вы увидите, что в решении появились данные, как показано на изображении панели мониторинга выше.


## <a name="next-steps"></a>Дальнейшие действия

Изучите перечисленные ниже средства и параметры OMS, чтобы настроить рабочую область в соответствии с вашими потребностями.

* Для локальных кластеров OMS предлагает шлюз (прокси-сервер переадресации HTTP), который можно использовать для отправки данных в OMS. Дополнительные сведения см. в разделе [Подключения компьютеров к OMS с помощью шлюза OMS без доступа к Интернету](../log-analytics/log-analytics-oms-gateway.md).
* Настройте OMS, чтобы настроить [автоматические оповещения](../log-analytics/log-analytics-alerts.md), которые помогают выполнять обнаружение и диагностику.
* Ознакомьтесь с функциями [поиска по журналам и запросов к журналам](../log-analytics/log-analytics-log-searches.md), которые являются частью решения Log Analytics.