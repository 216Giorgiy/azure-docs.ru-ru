---
title: Создание приложения-контейнера Azure Service Fabric в Linux | Документация Майкрософт
description: В этом кратком руководстве вы создадите свое первое приложение-контейнер Linux в Azure Service Fabric.  Создание образа Docker с приложением, отправка образа в реестр контейнеров, сборка и развертывание приложения-контейнера Service Fabric.
services: service-fabric
documentationcenter: linux
author: suhuruli
manager: timlt
editor: ''
ms.assetid: ''
ms.service: service-fabric
ms.devlang: python
ms.topic: quickstart
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/11/2018
ms.author: suhuruli
ms.custom: mvc
ms.openlocfilehash: 65f048d67ef5f250691700a382e781814c57e8a8
ms.sourcegitcommit: 9cdd83256b82e664bd36991d78f87ea1e56827cd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
ms.locfileid: "31416376"
---
# <a name="quickstart-deploy-an-azure-service-fabric-linux-container-application-on-azure"></a>Краткое руководство. Развертывание приложения-контейнера Azure Service Fabric на платформе Linux в Azure
Azure Service Fabric — это платформа распределенных систем для развертывания масштабируемых надежных микрослужб и контейнеров и управления ими. 

В этом руководстве объясняется, как развертывать контейнеры Linux в кластер Service Fabric. Изучив это руководство, вы создадите приложение для голосования с веб-интерфейсом Python и серверной частью Redis, которое работает в кластере Service Fabric. Вы также узнаете, как выполнить отработку отказа приложения и масштабировать приложение в кластере.

![Веб-страница приложения для голосования][quickstartpic]

В этом кратком руководстве среда Bash используется в оболочке Azure Cloud Shell для выполнения команд интерфейса командной строки Service Fabric. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/), прежде чем начинать работу.

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

Если Cloud Shell запускается впервые, вам будет предложено настроить файловый ресурс `clouddrive`. Можно принять значения по умолчанию или присоединить существующий файловый ресурс. Дополнительные сведения см. в разделе [Настройка общей папки `clouddrive`](https://docs.microsoft.com/azure/cloud-shell/persisting-shell-storage#set-up-a-clouddrive-file-share).

## <a name="get-the-application-package"></a>Получение пакета приложения
Чтобы развернуть контейнеры в кластер Service Fabric, вам понадобится набор файлов манифеста (определение приложения), которые описывают отдельные контейнеры и приложение.

В Cloud Shell с помощью Git клонируйте копию определения приложения, а затем замените каталоги клонированного экземпляра каталогом `Voting`. 

```bash
git clone https://github.com/Azure-Samples/service-fabric-containers.git

cd service-fabric-containers/Linux/container-tutorial/Voting
```

## <a name="create-a-service-fabric-cluster"></a>Создание кластера Service Fabric
Чтобы развернуть приложение в Azure, требуется кластер Service Fabric, в котором будет выполняться приложение. С помощью кластеров сообщества можно быстро и просто создать кластер Service Fabric. Общедоступные кластеры — это размещенные в Azure бесплатные временные кластеры Service Fabric, которыми управляет команда Service Fabric. Общедоступные кластеры можно использовать для развертывания приложений и изучения возможностей платформы. Кластер использует один самозаверяющий сертификат для обеспечения безопасности при взаимодействии между узлами и между клиентом и узлом.

Войдите в систему и [присоедините кластер Linux](http://aka.ms/tryservicefabric). Загрузите сертификат PFX на компьютер, щелкнув ссылку **PFX**. Щелкните ссылку на **файл сведений**, чтобы найти пароль для сертификата и инструкции о том, как настраивать различные среды для использования сертификата. Не закрывайте страницу **приветствия** и **файл сведений**. Некоторые из этих инструкций будут использованы на следующих шагах. 

> [!Note]
> В течение одного часа доступно ограниченное число общедоступных кластеров. Если при попытке регистрации в общедоступном кластере появляется сообщение об ошибке, подождите немного и повторите попытку или следуйте инструкциям из раздела о [создании кластера Service Fabric в Azure](service-fabric-tutorial-create-vnet-and-linux-cluster.md), чтобы создать кластер в подписке. 
> 
>При создании собственного кластера обратите внимание, что по умолчанию служба веб-интерфейса настроена для прослушивания через порт 80 для входящего трафика. Убедитесь, что порт открыт в кластере. (Если используется общедоступный кластер, этот порт открыт.)
>

## <a name="configure-your-environment"></a>Настройка среды
Service Fabric предоставляет ряд средств, которые можно использовать для управления кластером и его приложениями:

- средство Service Fabric Explorer на основе браузера;
- интерфейс командной строки (CLI) Service Fabric, который работает на базе Azure CLI 2.0;
- команды PowerShell. 

При работе с этим кратким руководством используются интерфейс командной строки Service Fabric в Cloud Shell и Service Fabric Explorer. Ниже показано, как установить сертификат, необходимый для подключения к безопасному кластеру с помощью этих средств.

### <a name="configure-certificate-for-the-service-fabric-cli"></a>Настройка сертификата для интерфейса командной строки Service Fabric
Чтобы использовать интерфейс командной строки в Cloud Shell, необходимо отправить PFX-файл сертификата в Cloud Shell и с его помощью создать PEM-файл.

1. Чтобы отправить сертификат в текущий рабочий каталог в Cloud Shell, перетащите PFX-файл сертификата из папки загрузки на компьютере в окно Cloud Shell.  

2. Для преобразования PFX-файла в PEM-файл используйте следующую команду: (Для общедоступных кластеров можно скопировать команду, указанную для PFX-файла, и пароль из инструкций на странице **файла сведений**.)

    ```bash
    openssl pkcs12 -in party-cluster-1486790479-client-cert.pfx -out party-cluster-1486790479-client-cert.pem -nodes -passin pass:1486790479
    ``` 

### <a name="configure-certificate-for-service-fabric-explorer"></a>Настройка сертификата для Service Fabric Explorer
Чтобы использовать Service Fabric Explorer, необходимо импортировать PFX-файл сертификата, скачанный с веб-сайта общедоступного кластера, в хранилище сертификатов (Windows или Mac) или в сам браузер (Ubuntu). Вам потребуется пароль закрытого ключа PFX-файла, который можно найти на странице **файла сведений**.

Для импорта сертификата на компьютер можно использовать любой удобный метод. Например: 

- В Windows: дважды щелкните PFX-файл и следуйте инструкциям на экране для установки сертификата в личном хранилище, `Certificates - Current User\Personal\Certificates`. Кроме того, можно использовать команду PowerShell из инструкций в **файле сведений**.
- В Mac: дважды щелкните PFX-файл и следуйте инструкциям на экране, чтобы установить сертификат в цепочке ключей.
- В Ubuntu: браузером по умолчанию в Ubuntu 16.04 является Mozilla Firefox. Чтобы импортировать сертификат в Firefox, нажмите кнопку меню в правом верхнем углу браузера, а затем щелкните **Options** (Параметры). На странице **Preferences** (Настройки) введите в поле поиска слово "сертификаты". Нажмите кнопку **View Certificates** (Просмотр сертификатов), выберите вкладку **Your Certificates** (Ваши сертификаты), щелкните **Import** (Импорт) и следуйте инструкциям на экране, чтобы импортировать сертификат.
 
   ![Установка сертификата в Firefox](./media/service-fabric-quickstart-containers-linux/install-cert-firefox.png) 

## <a name="deploy-the-service-fabric-application"></a>Развертывание приложения Service Fabric 
1. В Cloud Shell подключитесь к кластеру Service Fabric в Azure с помощью интерфейса командной строки. Конечная точка — это конечная точка управления кластера. В предыдущем разделе вы создали PEM-файл. (Для общедоступных кластеров можно скопировать команду, указанную для PEM-файла, и конечную точку из инструкции на странице **файла сведений**.)

    ```bash
    sfctl cluster select --endpoint https://linh1x87d1d.westus.cloudapp.azure.com:19080 --pem party-cluster-1277863181-client-cert.pem --no-verify
    ```

2. С помощью скрипта установки, предназначенного для копирования определения приложения для голосования в кластер, зарегистрируйте тип приложения и создайте экземпляр приложения.

    ```bash
    ./install.sh
    ```

2. Откройте веб-браузер и перейдите в конечную точку Service Fabric Explorer для кластера. Конечная точка имеет следующий формат: https://\<my-azure-service-fabric-cluster-url>:19080/Explorer, например `https://linh1x87d1d.westus.cloudapp.azure.com:19080/Explorer`. </br>(Конечную точку Service Fabric Explorer для общедоступных кластеров можно найти на странице **приветствия**.) 

3. Разверните узел **Приложения**, чтобы увидеть запись для типа приложения голосования и созданный вами экземпляр.

    ![Service Fabric Explorer][sfx]

3. Чтобы подключиться к запущенному контейнеру, откройте веб-браузер и перейдите по URL-адресу кластера, например `http://linh1x87d1d.westus.cloudapp.azure.com:80`. Вы должны увидеть приложение голосования в браузере.

    ![Веб-страница приложения для голосования][quickstartpic]


> [!NOTE]
> Можно также развернуть приложения Service Fabric с помощью Docker Compose. Например, следующую команду можно использовать для развертывания и установки приложения в кластере с помощью Docker Compose.
>  ```bash
> sfctl compose create --deployment-name TestApp --file-path ../docker-compose.yml
> ```

## <a name="fail-over-a-container-in-a-cluster"></a>Отработка отказа контейнера в кластере
Платформа Service Fabric обеспечивает автоматический перенос экземпляров контейнера на другие узлы в кластере в случае сбоя. Можно также вручную перенести контейнеры с одного узла на другие узлы в кластере. Service Fabric предоставляет несколько способов масштабирования ваших служб. В приведенных далее шагах используется средство Service Fabric Explorer.

Чтобы выполнить отработку отказа внешнего контейнера, сделайте следующее:

1. Откройте Service Fabric Explorer в своем кластере (например, по ссылке `https://linh1x87d1d.westus.cloudapp.azure.com:19080/Explorer`).
2. Щелкните узел **fabric:/Voting/azurevotefront** в представлении в виде дерева и разверните узел раздела (он отображается в виде идентификатора GUID). Найдите имя узла в представлении в виде дерева с узлами, на которых сейчас выполняется контейнер. Пример: `_nodetype_4`.
3. Разверните узел **Узлы** в представлении в виде дерева. Щелкните многоточие (…) рядом с узлом, на котором выполняется контейнер.
4. Выберите **Перезапустить**, чтобы перезапустить этот узел, и подтвердите операцию перезапуска. Перезапуск приведет к отработке отказа контейнера на другой узел в кластере.

    ![Представление узла в Service Fabric Explorer][sfxquickstartshownodetype]

## <a name="scale-applications-and-services-in-a-cluster"></a>Масштабирование приложений и служб в кластере
Службы Service Fabric можно легко масштабировать в пределах кластера в соответствии с изменениями нагрузки на службы. Масштабирование службы осуществляется путем изменения числа экземпляров, запущенных в кластере.

Для масштабирования службы веб-интерфейса выполните следующие действия:

1. Откройте Service Fabric Explorer в своем кластере (например, по ссылке `https://linh1x87d1d.westus.cloudapp.azure.com:19080`).
2. Щелкните многоточие (три точки) рядом с узлом **fabric:/Voting/azurevotefront** в представлении в виде дерева и выберите **Масштабировать службу**.

    ![Запуск масштабирования службы Service Fabric Explorer][containersquickstartscale]

  Теперь вы можете изменить количество экземпляров службы веб-интерфейса.

3. Измените количество на **2** и нажмите кнопку **Масштабировать службу**.
4. Щелкните узел **fabric:/Voting/azurevotefront** в представлении в виде дерева и разверните узел раздела (он отображается в виде идентификатора GUID).

    ![Масштабирование службы Service Fabric Explorer завершено][containersquickstartscaledone]

    Теперь вы видите два экземпляра службы. В представлении в виде дерева можно просмотреть, на каких узлах выполняются эти экземпляры.

С помощью этой простой задачи управления вы удвоили количество ресурсов для обработки пользовательской нагрузки для службы веб-интерфейса. Важно понимать, что для надежной работы службы не требуется запускать несколько экземпляров службы. При сбое в работе службы Service Fabric запускает новый экземпляр службы в кластере.

## <a name="clean-up-resources"></a>Очистка ресурсов
1. Чтобы удалить экземпляр приложения из кластера и отменить регистрацию типа приложения, используйте скрипт удаления (uninstall.sh), указанный в шаблоне. Очистка экземпляра займет некоторое время. Поэтому не следует запускать скрипт установки сразу же после выполнения скрипта удаления. С помощью Service Fabric Explorer вы сможете определить, что экземпляр удален, а регистрация типа приложения отменена. 

    ```bash
    ./uninstall.sh
    ```

2. По завершении работы с кластером можно удалить сертификат из хранилища сертификатов. Например: 
   - В Windows: используйте [оснастку MMC для сертификатов](https://docs.microsoft.com/dotnet/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in). При добавлении оснастки не забудьте выбрать **свою учетную запись пользователя**. Перейдите в папку `Certificates - Current User\Personal\Certificates` и удалите сертификат.
   - В Mac: используйте приложение цепочки ключей.
   - В Ubuntu: выполните шаги, которые вы использовали для просмотра сертификатов, и удалите сертификат.

3. Если вы больше не хотите использовать оболочку Cloud Shell, можно удалить связанную ней учетную запись хранения, чтобы избежать расходов. Закройте сеанс Cloud Shell. На портале Azure щелкните учетную запись хранения, связанную с Cloud Shell, а затем щелкните **Удалить** в верхней части страницы и следуйте инструкциям на экране.

## <a name="next-steps"></a>Дополнительная информация
Из этого краткого руководства вы узнали, как развернуть приложение-контейнер Linux в кластере Service Fabric в Azure, выполнить отработку отказа для приложения и масштабировать приложение в кластере. Дополнительные сведения о работе с контейнерами Linux в Service Fabric см. в руководстве для приложений-контейнеров Linux.

> [!div class="nextstepaction"]
> [Создание приложения-контейнера Linux](./service-fabric-tutorial-create-container-images.md)


[sfx]: ./media/service-fabric-quickstart-containers-linux/containersquickstartappinstance.png
[quickstartpic]: ./media/service-fabric-quickstart-containers-linux/votingapp.png
[sfxquickstartshownodetype]:  ./media/service-fabric-quickstart-containers-linux/containersquickstartrestart.png
[containersquickstartscale]: ./media/service-fabric-quickstart-containers-linux/containersquickstartscale.png
[containersquickstartscaledone]: ./media/service-fabric-quickstart-containers-linux/containersquickstartscaledone.png
