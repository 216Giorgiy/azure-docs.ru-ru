<properties
   pageTitle="Обновление приложений: дополнительные темы | Microsoft Azure"
   description="В этой статье рассматриваются некоторые дополнительные темы, относящиеся к обновлению приложения структуры служб."
   services="service-fabric"
   documentationCenter=".net"
   authors="mani-ramaswamy"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="04/14/2016"
   ms.author="subramar"/>

# Обновление приложений Service Fabric: дополнительные темы

## Добавление или удаление служб во время обновления приложения

Если новая служба добавляется в уже развернутое приложение и публикуется как обновление, она будет добавлена в развернутое приложении (без обновления, затрагивающего службы, которые уже входили в состав приложения). Однако чтобы активировать новую службу, потребуется запустить экземпляр службы, который был добавлен. Запуск следует выполнить с помощью командлета `New-ServiceFabricService`.

Кроме того, в ходе обновления также можно удалить службы из приложения, однако прежде чем продолжить обновление (с помощью `Remove-ServiceFabricService` командлета), необходимо убедиться, что все текущие экземпляры службы (те, которые должны быть удалены в процессе обновления) остановлены.

## Ручной режим обновления

> [AZURE.NOTE]  Неотслеживаемый ручной режим должен использоваться только для сбойных или отложенных обновлений. Отслеживаемый режим рекомендуется для использования с приложениями Service Fabric.

Service Fabric обеспечивает применение нескольких режимов обновления для поддержки кластеров разработки и рабочих кластеров. Каждый из вариантов развертывания идеально подходит для разных типов сред.

Отслеживаемое последовательное обновление приложений является наиболее распространенным типом обновления, используемым в рабочей среде. При определении политики обновления структура служб обеспечивает работоспособность приложения перед продолжением обновления.

 Администратор приложения может использовать режим ручного последовательного обновления приложений для обеспечения полного контроля над ходом процесса обновления для различных доменов обновления. Этот режим полезен для определенных ситуаций, в которых необходима более настраиваемая или сложная политика оценки работоспособности или необходимо нестандартное обновление (например, приложение уже потеряло некоторые данные).

Наконец, автоматизированное последовательное обновление полезно для сред разработки или тестирования, что обеспечивает быстрый цикл итераций во время разработки службы.

## Переключение в ручной режим обновления
**Ручной**. Остановите обновление приложения на текущем домене обновления и измените режим обновления на "Неотслеживаемый ручной". Администратору необходимо вручную вызвать команду **MoveNextApplicationUpgradeDomainAsync**, чтобы продолжить обновление, или запустить откат, начав новое обновление. После того как обновление перейдет в ручной режим, оно остается в нем до тех пор, пока не будет запущено новое обновление. Команда **GetApplicationUpgradeProgressAsync** возвращает FABRIC\_APPLICATION\_UPGRADE\_STATE\_ROLLING\_FORWARD\_PENDING.

## Обновление при помощи пакета diff

Приложение структуры служб может обновляться путем подготовки полного самостоятельного пакета приложения. Приложение может также быть обновлено путем использования пакета diff, который содержит только обновленные файлы приложения и манифеста приложения , а также файлы манифеста служб.

Полный пакет приложений содержит все необходимые файлы для запуска и выполнения приложения структуры служб. Пакет diff содержит только файлы, которые изменились между последним выделением приложения и текущим обновлением, плюс полные файлы манифеста приложения и служб. Если Service Fabric не может найти в макете сборки ссылку, указанную в манифесте приложения или манифесте службы, она попытается найти ее в хранилище образов.

Для первичной установки приложений в кластер необходимы полные пакеты приложений. При последующих обновлениях может использоваться либо полный пакет обновлений, либо пакет diff.

Случаи, в которых использование пакета diff является оптимальным.

* Пакет diff предпочтительно применять тогда, когда используется объемный пакет приложения, который ссылается на несколько файлов манифеста службы или на несколько пакетов кода, пакетов конфигурации или пакетов данных.

* Использование пакета diff является предпочтительным в случае, если система развертывания формирует структуру сборки напрямую в ходе создания сборки приложения. В этом случае, хотя в самом коде ничего не изменилось, новые сборки будут обладать другой контрольной суммой. Использование полного пакета приложения потребует обновления версии всех пакетов кода. При использовании пакета diff вы предоставляете только измененные файлы и файлы манифеста, версия которых изменилась.

При обновлении приложения с помощью Visual Studio пакет diff публикуется автоматически. Чтобы создать пакет diff вручную (например, для обновления с помощью PowerShell), следует обновить приложение и манифесты служб, но включить только те пакеты, которые были изменены в итоговом пакете приложения.

К примеру, начнем со следующего приложения (номера версий приведены для простоты понимания):

```text
app1       	1.0.0
  service1 	1.0.0
    code   	1.0.0
    config 	1.0.0
  service2 	1.0.0
    code   	1.0.0
    config 	1.0.0
```

Предположим, что необходимо обновить только код пакета service1, использующего пакет diff, с помощью PowerShell. Теперь обновленное приложение будет выглядеть следующим образом:

```text
app1       	2.0.0      <-- new version
  service1 	2.0.0      <-- new version
    code   	2.0.0      <-- new version
    config 	1.0.0
  service2 	1.0.0
    code   	1.0.0
    config 	1.0.0
```

В этом случае вы обновляете манифест приложения до версии 2.0.0 и манифест службы для service1 для отражения обновления пакета кода. Структура папок для пакета приложения будет выглядеть следующим образом:

```text
app1/
  service1/
    code/
```

## Дальнейшие действия

Пошаговое руководство [Обновление приложения с помощью Visual Studio](service-fabric-application-upgrade-tutorial.md) поможет вам выполнить обновление приложения с помощью Visual Studio.

Пошаговое руководство [Обновление приложения с помощью PowerShell](service-fabric-application-upgrade-tutorial-powershell.md) поможет вам выполнить обновление приложения с помощью PowerShell.

Управление обновлениями приложения осуществляется с помощью [параметров обновления](service-fabric-application-upgrade-parameters.md).

Узнайте, как использовать [сериализацию данных](service-fabric-application-upgrade-data-serialization.md), чтобы обеспечить совместимость обновлений приложения.

Сведения об устранении распространенных проблем при обновлении приложений см. в разделе [Устранение неполадок обновления приложения](service-fabric-application-upgrade-troubleshooting.md).
 

<!---HONumber=AcomDC_0420_2016-->