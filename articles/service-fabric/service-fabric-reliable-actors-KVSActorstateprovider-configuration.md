<properties
   pageTitle="Общие сведения о конфигурации KVSActorStateProvider при использовании надежных субъектов Service Fabric"
   description="Информация о настройке субъектов Service Fabric с отслеживанием состояния и типом KVSActorStateProvider."
   services="Service-Fabric"
   documentationCenter=".net"
   authors="sumukhs"
   manager="vipulm"
   editor=""/>

<tags
   ms.service="Service-Fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="04/20/2015"
   ms.author="sumukhs"/>

# Конфигурация надежных субъектов — KVSActorStateProvider
Используемую по умолчанию конфигурацию KVSActorStateProvider можно изменить. Для этого нужно обновить файл settings.xml, созданный в папке Config конкретного субъекта в корневом каталоге пакета Visual Studio.

Среда выполнения Service Fabric ищет имена предварительно определенных разделов в файле settings.xml и использует значения конфигурации при создании базовых компонентов среды выполнения.

> [AZURE.NOTE]**Не** удаляйте и не изменяйте имена разделов в перечисленных ниже конфигурациях в файле settings.xml, который создается в решении Visual Studio.

## Конфигурация безопасности репликатора
Конфигурации безопасности репликаторов используются для защиты канала связи, который используется во время репликации. Это означает, что службы не будут «видеть» реплицируемый трафик друг друга, что позволит обеспечить высокую доступность и высокий уровень защиты. Пустой раздел конфигурации безопасности означает, что канал репликации не защищен.
### Имя раздела
&lt;ActorName&gt;ServiceReplicatorSecurityConfig
### Имена конфигураций
См. статью [Защита трафика репликации](../service-fabric/service-fabric-replication-security.md).

## Настройка репликатора
Конфигурации репликатора используются для настройки репликатора, отвечающего за надежность состояний поставщика состояний субъекта. Как правило, достаточно использовать конфигурацию по умолчанию, которая создается с помощью шаблона Visual Studio. В этом разделе мы расскажем о дополнительных конфигурациях, с помощью которых можно выполнить более тонкую настройку репликатора.
### Имя раздела
&lt;ActorName&gt;ServiceReplicatorConfig
### Имена конфигураций

|Имя|Единица измерения|Значение по умолчанию|Примечания|
|----|----|-------------|-------|
|BatchAcknowledgementInterval|Секунды|0,05|Период времени, в течение которого дополнительный репликатор после получения операции находится в режиме ожидания, а затем отправляет подтверждение обратно основному репликатору. Любые другие подтверждения, отправляемые для операций, обработанных в течение этого интервала, отправляются как один ответ.|
|ReplicatorEndpoint|Недоступно|Нет (обязательный параметр)|IP-адрес и порт, которые будут использоваться основным и дополнительным репликаторами для связи с другими репликаторами в наборе реплик. Значение должно быть ссылкой на конечную точку ресурса TCP в манифесте службы. Дополнительные сведения об определении ресурсов конечных точек в манифесте службы см. в статье [Ресурсы манифеста службы](service-fabric-service-manifest-resources.md). |
|RetryInterval|Секунды|5|Период времени, после которого репликатор повторно передает сообщение, если не получил подтверждение операции.|
|MaxReplicationMessageSize|Байты|50 МБ|Максимальный размер данных репликации, которые могут быть переданы в одном сообщении.|
|MaxPrimaryReplicationQueueSize|Количество операций|1024|Максимальное количество операций в основной очереди. Операция освобождается после того, как основной репликатор получит подтверждение от всех дополнительных репликаторов. Это значение должно быть больше 64 и представлять собой степень числа 2.|
|MaxSecondaryReplicationQueueSize|Количество операций|2048|Максимальное количество операций в дополнительной очереди. Операция освобождается после того, как для ее состояния обеспечивается высокая доступность (посредством сохранения). Это значение должно быть больше 64 и являться степенью числа 2.|

## Конфигурация хранилища
Конфигурации хранилища используются для настройки локального хранилища, используемого для хранения реплицируемого состояния. Как правило, достаточно использовать конфигурацию по умолчанию, которая создается с помощью шаблона Visual Studio. В этом разделе рассматриваются дополнительные конфигурации локального хранилища.
### Имя раздела
&lt;ActorName&gt;ServiceLocalStoreConfig
### Имена конфигураций

|Имя|Единица измерения|Значение по умолчанию|Примечания|
|----|----|-------------|-------|
|MaxAsyncCommitDelay|Миллисекунды|200|Задает максимальный интервал для устойчивой пакетной фиксации в локальном хранилище.|
|MaxVerPages|Количество страниц|8192|Максимальное количество страниц версий в базе данных локального хранилища. Определяет максимальное число необработанных транзакций.|

## Образец файла конфигурации

```xml
<?xml version="1.0" encoding="utf-8"?>
<Settings xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/2011/01/fabric">
   <Section Name="MyActorServiceReplicatorConfig">
      <Parameter Name="ReplicatorEndpoint" Value="MyActorServiceReplicatorEndpoint" />
      <Parameter Name="BatchAcknowledgementInterval" Value="0.05"/>
   </Section>
   <Section Name="MyActorServiceLocalStoreConfig">
      <Parameter Name="MaxVerPages" Value="8192" />
   </Section>
   <Section Name="MyActorServiceReplicatorSecurityConfig">
      <Parameter Name="CredentialType" Value="X509" />
      <Parameter Name="FindType" Value="FindByThumbprint" />
      <Parameter Name="FindValue" Value="9d c9 06 b1 69 dc 4f af fd 16 97 ac 78 1e 80 67 90 74 9d 2f" />
      <Parameter Name="StoreLocation" Value="LocalMachine" />
      <Parameter Name="StoreName" Value="My" />
      <Parameter Name="ProtectionLevel" Value="EncryptAndSign" />
      <Parameter Name="AllowedCommonNames" Value="My-Test-SAN1-Alice,My-Test-SAN1-Bob" />
   </Section>
</Settings>
```
## Примечания

Параметр BatchAcknowledgementInterval управляет задержкой репликации. Значение 0 обеспечивает минимальную возможную задержку за счет уменьшения скорости репликации (потому что необходимо отправлять и обрабатывать большее количество сообщений с подтверждениями, каждое из которых содержит меньше подтверждений). По мере увеличения значения BatchAcknowledgementInterval увеличивается общая скорость репликации и задержка операций. Значение этого параметра напрямую влияет на задержку фиксации транзакций.
 

<!---HONumber=July15_HO2-->