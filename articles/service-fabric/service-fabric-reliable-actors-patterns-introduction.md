<properties
   pageTitle="Шаблоны Reliable Actors и антишаблоны | Microsoft Azure"
   description="Общие сведения о модели программирования субъектов, шаблонах проектирования, которые эффективно работают с моделью Reliable Actors в среде выполнения Service Fabric, а также о некоторых неэффективных шаблонах, которых следует избегать."
   services="service-fabric"
   documentationCenter=".net"
   authors="vturecek"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="08/11/2015"
   ms.author="vturecek"/>

# Общие сведения о шаблонах разработки Reliable Actors

Модель программирования Reliable Actors для Service Fabric — это платформа, построенная на основе субъектной модели для решения реальных проблем в масштабе облака. Azure Service Fabric — это платформа для построения высоконадежных масштабируемых приложений для облачных и локальных сред, которые легко разрабатывать и которыми легко управлять. Данная статья представляет собой практическое руководство для решения прикладных проблем. Ознакомившись с различными шаблонами, вы поймете, как с помощью модели Reliable Actors создавать корпоративные и облачные решения.

## Шаблоны

В этом разделе мы перечислим ряд шаблонов и связанных с ними сценариев, которые мы собрали во время работы с заказчиками. Эти шаблоны представляют классы проблем, которые применимы к широкому спектру решений, создаваемых нашими заказчиками на базе Microsoft Azure. В то время как сценарии основаны на реальных случаях, мы убрали большинство деталей, касающихся конкретных доменов, чтобы сделать шаблоны более понятными для читателя. Вы можете обнаружить, что большая часть кода в образцах проста или очевидна. Этот код мы включили для полноты картины, а не потому что он является особенно выдающимся.

Шаблоны, представленные в этом документе, не претендуют на комплексность или каноничность. Некоторые разработчики могут решать ту же проблему или реализовывать тот же шаблон иначе, чем это показываем мы.

[Шаблон: смарт-кэш](service-fabric-reliable-actors-pattern-smart-cache.md)

[Шаблон: распределенные сети и графы](service-fabric-reliable-actors-pattern-distributed-networks-and-graphs.md)

[Шаблон: управление ресурсами](service-fabric-reliable-actors-pattern-resource-governance.md)

[Шаблон: построение службы с отслеживанием состояния](service-fabric-reliable-actors-pattern-stateful-service-composition.md)

[Шаблон: Интернет вещей](service-fabric-reliable-actors-pattern-internet-of-things.md)

[Шаблон: распределенные вычисления](service-fabric-reliable-actors-pattern-distributed-computation.md)

[Некоторые антишаблоны](service-fabric-reliable-actors-anti-patterns.md)

### Дополнительные сведения о субъектах — краткая история

[Документ](http://dl.acm.org/citation.cfm?id=1624804) авторства Hewitt и др., который является источником субъектной модели, был опубликован в 1973 году. Но только сравнительно недавно эта модель начала привлекать больше внимания как средство решения проблем параллелизма и сложности в распределенных системах. Модель субъектов поддерживает индивидуальные объекты с тонкой настройкой (субъекты), которые изолированы друг от друга. Они взаимодействуют путем асинхронной передачи сообщений, что делает возможным прямой обмен данными между субъектами. Субъект исполняется с помощью однопоточной семантики. В сочетании с инкапсуляцией состояния субъекта и его изоляцией от других субъектов это упрощает написание систем с высокой степенью параллелизма, удаляя из кода субъекта проблемы параллельного выполнения. Субъекты динамически создаются в пуле доступных аппаратных ресурсов.

Наиболее популярной реализацией субъектной модели является [Erlang](http://www.erlang.org/). Разработчики начали заново открывать для себя субъектную модель, что стимулировало возобновление интереса к Erlang и создание новых Erlang-подобных решений, например субъектов [Scala](http://www.scala-lang.org/), [Akka](http://akka.io), [Akka.net](http://getakka.net/), [DCell](http://research.microsoft.com/pubs/75988/dcell.pdf).

## Краткий обзор Azure Service Fabric

API-интерфейс Reliable Actors — это реализация субъектной модели, которая заимствует некоторые идеи из Erlang и систем распределенных объектов, добавляет уровень косвенного обращения субъектов и предоставляет их в интегрированной модели программирования, использующей преимущества платформы Azure Service Fabric.

Основные преимущества API-интерфейса Reliable Actors: 1) **высокая производительность труда разработчиков**, даже у программистов без большого опыта работы; 2) **прозрачная масштабируемость по умолчанию** без специальных усилий со стороны программистов. API-интерфейс Reliable Actors представляет собой библиотеку .NET, работающую поверх Service Fabric, а также средства, которые значительно упрощают разработку сложных распределенных приложений и делают получаемые в результате приложения изначально масштабируемыми. Ниже мы подробнее раскроем каждое из этих преимуществ. Модель программирования повышает производительность программистов различной квалификации, предоставляя следующие ключевые абстракции, гарантии и системные службы.

* *Знакомая парадигма объектно-ориентированного программирования (ООП)*. Субъекты являются классами .NET, реализующими декларированные интерфейсы субъектов .NET с асинхронными методами и свойствами. Таким образом, субъекты отображаются для программиста в виде удаленных объектов, методы и свойства которых можно вызывать напрямую. Это обеспечивает программисту знакомую парадигму ООП, превращая вызовы методов в сообщения, направляя их в нужные конечные точки, вызывая методы целевого субъекта и прозрачно обрабатывая сбои и пограничные случаи.

* *Однопоточное исполнение субъектов.* Среда выполнения Reliable Actors гарантирует, что субъект никогда не будет выполняться более чем в одном потоке одновременно. В сочетании с изоляцией от других субъектов это позволяет программисту никогда не сталкиваться с параллелизмом на уровне субъекта, и поэтому ему никогда не нужно использовать блокировки или другие механизмы синхронизации для управления доступом к общим данным. Одна лишь эта функция делает разработку распределенных приложений доступной для начинающих программистов.

* *Прозрачная активация.* Среда выполнения активирует субъект по мере необходимости только при наличии сообщения для обработки этим субъектом. Это четко разделяет понятия логического создания субъекта, который является видимым для кода приложения и управляется им, и физической активации субъекта в памяти, который является прозрачным для приложения. API-интерфейс Reliable Actors подобен виртуальной памяти в том, что он определяет, когда субъект нужно деактивировать или активировать. Приложение получает постоянный доступ к полному «пространству памяти» логически созданных субъектов независимо от того, находятся ли они в физической памяти в определенный момент времени. Прозрачная активация позволяет выполнять динамическую, адаптивную балансировку нагрузки путем размещения и миграции субъектов по пулу аппаратных ресурсов.

* *Прозрачность расположения.* Ссылка на субъект (прокси-объект), используемая программистом для вызова методов субъекта или передачи другим компонентам, содержит только логический идентификатор субъекта. Трансляция логического идентификатора субъекта в его физическое расположение и соответствующая маршрутизация сообщений прозрачно выполняются средой выполнения Reliable Actors. Код приложения взаимодействует с субъектами без учета их физического расположения, которое может изменяться со временем из-за ошибок или управления ресурсами либо из-за деактивации субъекта на момент его вызова.

* *Прозрачная интеграция с постоянным хранилищем.* API-интерфейс Reliable Actors позволяет декларативно отображать в постоянном хранилище состояние субъектов в памяти. Система синхронизирует обновления, прозрачно гарантируя, что вызывающие объекты будут получать результаты только после успешного обновления постоянного состояния.

* *Высокий уровень доступности, поддержка отработки отказа и управление жизненным циклом приложений.* Состоянием субъектов управляет платформа. Состояние реплицируется таким образом, чтобы его можно было восстановить в случае отказа узла в кластере. Service Fabric также управляет жизненным циклом приложения и позволяет обновлять его с нулевым временем простоя. Модель программирования с использованием Reliable Actors предназначена для сопровождения программистов на пути вероятного успеха в масштабировании их приложения или службы через несколько порядков. Это осуществляется путем внедрения проверенных рекомендаций и шаблонов и обеспечивает эффективную реализацию низкоуровневых функциональных возможностей системы. Вот некоторые ключевые факторы, обеспечивающие масштабируемость и производительность приложений Service Fabric.

* *Неявное секционирование состояния приложения с высокой степенью детализации.* Используя субъекты как адресуемые напрямую сущности, программисты неявно разбивают общее состояние своих приложений. В то время как эта модель не предписывает конкретный размер субъекта, в большинстве случаев есть смысл поддерживать относительно большое число субъектов (миллионы или более), каждый из которых представляет естественную сущность приложения, например учетную запись пользователя, заказ на покупку и т. д. Индивидуальная адресация субъектов и абстрагирование их физического расположения средой выполнения обеспечивают большие возможности для прозрачной и универсальной балансировки нагрузки и обработки «горячих мест» без участия разработчика приложения.

* *Адаптивное управление ресурсами.* Поскольку субъекты не делают предположений насчет местоположения других субъектов, с которыми они взаимодействуют, а также благодаря прозрачности расположений, среда выполнения может динамично контролировать и корректировать распределение доступных аппаратных ресурсов, принимая детализированные решения по размещению или миграции субъектов в вычислительном кластере в ответ на шаблоны загрузки и обмена данными без ошибок входящих запросов. Путем создания нескольких реплик определенного субъекта среда выполнения может при необходимости увеличить его пропускную способность без внесения изменений в код приложения.

* *Мультиплексная связь.* Субъекты в Service Fabric обладают логическими конечными точками, и обмен сообщениями между ними мультиплексируется в фиксированном наборе физических подключений типа «все ко всем» (сокеты TCP). Это позволяет среде выполнения размещать очень большое количество (миллионы) адресуемых сущностей с нулевыми издержками ОС на каждый субъект. Кроме того, активация или деактивация субъекта не приводит к затратам на регистрацию или отмене регистрации физической конечной точки, например TCP-порта или URL-адреса HTTP.

* *Эффективное планирование.* Среда выполнения Reliable Actors планирует выполнение большого числа однопоточных субъектов в настраиваемом пуле потоков с одним потоком на каждое физическое ядро процессора. Так как код субъекта написан без блокировки продолжения (требование модели программирования), код приложения выполняется эффективным «кооперативным» многопоточным путем без конфликтов. Это позволяет системе достичь высокой пропускной способности и работать с очень высокой загрузкой ЦП (до 90 + %) и с высокой стабильностью. Поскольку рост числа субъектов в системе и нагрузки не ведет к созданию дополнительных потоков или других примитивов ОС, это позволяет масштабировать отдельные узлы и всю систему.

* *Явная асинхронность.* Модель программирования с использованием Reliable Actors делает явным асинхронный характер распределенного приложения и ориентирует программистов на написание неблокирующего асинхронного кода. Это делает возможной большую степень распределенного параллелизма и общей пропускной способности без явного использования многопоточности.

<!---HONumber=AcomDC_1210_2015-->