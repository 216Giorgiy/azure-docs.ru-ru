<properties
   pageTitle="Шаблоны Reliable Actors и антишаблоны | Microsoft Azure"
   description="Общие сведения о модели программирования с субъектами — конструктивных шаблонах, которые эффективно работают с моделью Reliable Actors в Service Fabric, а также о некоторых антишаблонах, которых следует избегать."
   services="service-fabric"
   documentationCenter=".net"
   authors="vturecek"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="08/11/2015"
   ms.author="vturecek"/>

# Общие сведения о шаблонах разработки Reliable Actors

Модель программирования Reliable Actors в Azure Service Fabric — это платформа на основе модели субъектов, предназначенная для решения реальных проблем в масштабе облака. Service Fabric — это платформа, позволяющая легко разрабатывать надежные масштабируемые приложения для облачных и локальных сред, а также управлять ими.

В этой статье рассматриваются практические проблемы. Ознакомившись с различными шаблонами, вы поймете, как с помощью модели Reliable Actors создавать корпоративные и облачные решения.

## Шаблоны

В этом разделе мы перечислим ряд шаблонов и связанных с ними сценариев, которые мы создали во время работы с клиентами. Эти шаблоны представляют классы проблем, которые применимы к широкому спектру решений, создаваемых нашими заказчиками на базе Microsoft Azure. Хотя сценарии основаны на реальных случаях, мы убрали детали, касающиеся конкретных доменов, чтобы сделать шаблоны более понятными. Вы можете обнаружить, что большая часть кода в образцах проста или очевидна. Этот код мы включили для полноты картины, а не потому что он является особенно выдающимся.

Шаблоны, представленные здесь, не претендуют на комплексность или каноничность. Некоторые разработчики могут найти другие решения проблем или способы использования шаблонов, которые отличаются от предложенных нами.

[Конструктивный шаблон Reliable Actors: смарт-кэш](service-fabric-reliable-actors-pattern-smart-cache.md)

[Конструктивный шаблон Reliable Actors: распределенные сети и графы](service-fabric-reliable-actors-pattern-distributed-networks-and-graphs.md)

[Конструктивный шаблон Reliable Actors: управление ресурсами](service-fabric-reliable-actors-pattern-resource-governance.md)

[Конструктивный шаблон Reliable Actors в Service Fabric: построение служб с отслеживанием состояния](service-fabric-reliable-actors-pattern-stateful-service-composition.md)

[Шаблон: Интернет вещей](service-fabric-reliable-actors-pattern-internet-of-things.md)

[Конструктивный шаблон Reliable Actors: распределенные вычисления](service-fabric-reliable-actors-pattern-distributed-computation.md)

[Конструктивный шаблон Reliable Actors: некоторые антишаблоны](service-fabric-reliable-actors-anti-patterns.md)

### Субъекты. Краткая история

Этот [документ](http://dl.acm.org/citation.cfm?id=1624804) Карла Хьюитта (Carl Hewitt) и его соавторов, которые первыми описали модель субъектов, опубликован в 1973 г. Но только сравнительно недавно на модель субъектов стали обращать внимание как на средство решения проблем, связанных с параллелизмом и сложностью, в распределенных системах.

Модель субъектов поддерживает индивидуальные объекты с тонкой настройкой (субъекты), изолированные друг от друга. Они взаимодействуют путем асинхронной передачи сообщений, что делает возможным прямой обмен данными между субъектами. Субъект исполняется с помощью однопоточной семантики. Наряду с инкапсуляцией состояния субъекта и его изоляцией от других субъектов это упрощает написание систем с высокой степенью параллелизма. Это достигается, когда из кода субъекта удаляются проблемы параллельного выполнения. Субъекты динамически создаются в пуле доступных аппаратных ресурсов.

Наиболее популярной реализацией субъектной модели является [Erlang](http://www.erlang.org/). Разработчики заново открывают для себя модель субъектов, что вызывает возобновление интереса к Erlang и создание новых Erlang-подобных решений, например субъектов [Scala](http://www.scala-lang.org/), [Akka](http://akka.io), [Akka.NET](http://getakka.net/) и [DCell](http://research.microsoft.com/pubs/75988/dcell.pdf).

## Преимущества модели Reliable Actors Service Fabric

Модель программирования Reliable Actors — это реализация модели субъектов, которая заимствует некоторые идеи из Erlang и систем распределенных объектов. Затем она добавляет уровень косвенного обращения субъектов и предоставляет субъекты в интегрированной модели программирования, которая использует платформу Service Fabric.

Основные преимущества модели Reliable Actors: 1) **высокая производительность труда разработчиков**, даже у программистов без большого опыта работы; 2) **прозрачная масштабируемость по умолчанию** без специальных усилий со стороны программистов. Модель программирования Reliable Actors использует библиотеку .NET, которая работает на базе Service Fabric. Она предоставляет средства, которые существенно упрощают разработку сложных распределенных приложений. Эти средства также специально создают масштабируемые приложения. Ниже мы подробнее раскроем каждое из этих преимуществ. Модель программирования повышает производительность программистов различной квалификации, предоставляя следующие ключевые абстракции, гарантии и системные службы.

* *Знакомая парадигма объектно-ориентированного программирования (ООП)*. Субъекты являются классами .NET, реализующими декларированные интерфейсы субъектов .NET с асинхронными методами и свойствами. Таким образом, субъекты отображаются для программиста в виде удаленных объектов, методы и свойства которых можно вызывать напрямую. Программист работает в рамках знакомой парадигмы ООП, превращая вызовы методов в сообщения, направляя их в нужные конечные точки, вызывая методы целевого субъекта и прозрачно обрабатывая сбои и пограничные случаи.

* *Однопоточное исполнение субъектов.* Среда выполнения Reliable Actors гарантирует, что субъект никогда не будет выполняться более чем в одном потоке одновременно. Благодаря этому и изоляции субъектов друг от друга программисты никогда не сталкиваются с параллелизмом на уровне субъектов. Программистам не нужно использовать блокировку или другие механизмы синхронизации для управления доступом к общим данным. Одна лишь эта функция делает разработку распределенных приложений доступной для начинающих программистов.

* *Прозрачная активация.* Среда выполнения активирует субъект по мере необходимости только при наличии сообщения для обработки этим субъектом. Это позволяет четко разделить понятия логического создания субъекта, который является видимым для кода приложения и управляется им, и физической активации субъекта в памяти, который является прозрачным для приложения. Модель Reliable Actors напоминает использование виртуальной памяти, так как она определяет время деактивации и активации субъекта. Приложение имеет непрерывный доступ к полному "пространству памяти" логически созданных субъектов, независимо от того, находятся ли они в физической памяти в любой момент времени. Прозрачная активация позволяет выполнять динамическую, адаптивную балансировку нагрузки путем размещения и миграции субъектов по пулу аппаратных ресурсов.

* *Прозрачность расположения.* Ссылка на субъект (прокси-объект), используемая программистом для вызова методов субъекта или их передачи другим компонентам, содержит только логический идентификатор субъекта. Трансляция логического идентификатора субъекта в его физическое расположение и соответствующая маршрутизация сообщений прозрачно выполняются средой выполнения Reliable Actors. Код приложения взаимодействует с субъектами без учета их физического расположения, которое может изменяться со временем из-за ошибок или управления ресурсами. Расположение субъекта также может изменяться, потому что субъект деактивируется в момент его вызова.

* *Прозрачная интеграция с постоянным хранилищем.* Модель программирования Reliable Actors позволяет декларативно отображать в постоянном хранилище состояние субъектов в памяти. Система синхронизирует обновления, прозрачно гарантируя, что вызывающие объекты будут получать результаты только после успешного обновления постоянного состояния.

* *Высокий уровень доступности, поддержка отработки отказа и управление жизненным циклом приложений.* Состоянием субъектов управляет платформа. Состояние реплицируется таким образом, чтобы его можно было восстановить в случае отказа узла в кластере. Service Fabric также управляет жизненным циклом приложения и позволяет обновлять его с нулевым временем простоя. Модель программирования Reliable Actors помогает программистам успешно масштабировать приложения или службы на несколько порядков. Это достигается путем внедрения проверенных рекомендаций и шаблонов и обеспечивает эффективную реализацию низкоуровневых функциональных возможностей системы. Вот некоторые ключевые факторы, обеспечивающие масштабируемость и производительность приложений Service Fabric.

  * *Неявное секционирование состояния приложения с высокой степенью детализации.* Используя субъекты как адресуемые напрямую сущности, программисты неявно разбивают общее состояние своих приложений. Хотя модель программирования Reliable Actors не предписывает конкретный размер субъекта, в большинстве случаев есть смысл поддерживать относительно большое число субъектов (миллионы или более). Каждый из этого множества субъектов представляет естественную сущность приложения, например учетную запись пользователя или заказ на покупку. Индивидуальная адресация субъектов и абстрагирование их физического расположения средой выполнения обеспечивают потрясающую гибкость при балансировке нагрузки и работе с гиперобъектами. Это происходит прозрачно и обобщенно без участия разработчиков приложений.

  * *Адаптивное управление ресурсами.* У субъектов нет предположений о местоположении других субъектов, с которыми они взаимодействуют. Благодаря прозрачности расположения среда выполнения может управлять распределением доступных аппаратных ресурсов и очень динамично корректировать его. Это происходит благодаря точным решениям по размещению и миграции субъектов в вычислительном кластере без сбоев входящих запросов при использовании шаблонов загрузки и взаимодействия. Создав несколько реплик определенного субъекта, среда выполнения может увеличивать его пропускную способность без внесения изменений в код приложения.

  * *Мультиплексная связь.* Субъекты в Service Fabric обладают логическими конечными точками, и обмен сообщениями между ними мультиплексируется в фиксированном наборе физических подключений типа «все ко всем» (сокеты TCP). Это позволяет среде выполнения размещать очень большое количество (миллионы) адресуемых сущностей без дополнительных затрат ОС на каждый субъект. Кроме того, активация или деактивация субъекта не приводит к затратам на регистрацию или отмену регистрации физической конечной точки, например TCP-порта или URL-адреса HTTP.

  * *Эффективное планирование.* Среда выполнения Reliable Actors планирует выполнение большого количества однопоточных субъектов в настраиваемом пуле потоков с одним потоком на каждое физическое ядро процессора. Так как код субъекта написан без блокировки продолжения (требование модели программирования), код приложения выполняется высокоэффективным "кооперативным" многопоточным путем без состязания за ресурсы. Это позволяет системе достичь высокой пропускной способности и стабильно работать при очень высокой загрузке ЦП (90 % и выше). Рост числа субъектов в системе и нагрузки не ведет к созданию дополнительных потоков или других примитивов ОС. Это позволяет масштабировать отдельные узлы и всю систему.

  * *Явная асинхронность.* Модель программирования Reliable Actors делает явным асинхронный характер распределенного приложения и ориентирует программистов на написание неблокирующего асинхронного кода. Это увеличивает распределенный параллелизм и общую пропускную способность без явного использования многопоточности.

<!---HONumber=AcomDC_0128_2016-->