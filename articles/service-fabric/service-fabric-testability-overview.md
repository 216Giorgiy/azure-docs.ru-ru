<properties
   pageTitle="Обзор Testability | Microsoft Azure"
   description="В этой статье описывается компонент Testability тестирования в Microsoft Azure Service Fabric, используемый в целях провоцирования ошибок и запуска сценариев тестирования для служб."
   services="service-fabric"
   documentationCenter=".net"
   authors="rishirsinha"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="07/13/2015"
   ms.author="rsinha"/>

# Обзор Testability

Testability — это набор инструментов, специально предназначенных для тестирования служб, созданных с помощью Microsoft Azure Service Fabric. Эти инструменты позволяют разработчику без труда вызывать значимые ошибки и запускать тестовые сценарии, чтобы воспроизвести и проверить множество различных состояний и переходов, которые будут происходить со службой в течение ее жизненного цикла, в контролируемых и безопасных условиях.

Это возможно благодаря наличию в наборе Tesability определенных действий и сценариев. Действия являются отдельными ошибками, специально выполняющимися в службе для ее тестирования. Разработчик службы может использовать их в качестве стандартных блоков для создания сложных сценариев. Например:

  + Перезапустите узел для имитации любого числа ситуаций, в которых выполняется перезагрузка компьютера или виртуальной машины.
  + Переместите реплики службы с отслеживанием состояния для имитации балансировки нагрузки, отработки отказа или обновления приложения.
  + Вызовите потерю кворума в службе с отслеживанием состояния, чтобы создать ситуацию, в которой операции записи невозможны, так как отсутствуют "резервные" или "вторичные" реплики, необходимые для приема новых данных.
  + Вызовите потерю данных в службе с отслеживанием состояния, чтобы создать ситуацию, в которой все данные о состоянии в памяти полностью уничтожаются.

Сценарии — это комплексные проверки, которые состоят из одного или нескольких действий. Так как действия представляют из себя команды PowerShell и функции C#, они могут принимать любую форму: долговременные службы, команды PowerShell, приложения командной строки и т. д. В наборе Testability доступны два готовых к использованию сценария:

  + тест Chaos Test;
  + тест Failover Test.

В наборе Testability представлены интерфейсы API PowerShell и C#. Это расширяет возможности разработчика по использованию сценариев PowerShell и обеспечивает улучшенный контроль над интерфейсами API C# (при необходимости).

## Важность набора Testability

Платформа Service Fabric значительно упрощает задания, связанные с созданием распределенных масштабируемых приложений и управлением ими. Компонент Testability на платформе Service Fabric предназначен для того, чтобы упростить тестирование распределенного приложения. При тестировании необходимо устранить три основные проблемы.

1. Моделирование и создание ошибок, которые могут возникнуть в реальных сценариях: один из важных аспектов Service Fabric — то, что эта платформа обеспечивает восстановление распределенных приложений при различных сбоях. Однако чтобы проверить, что приложение может восстановиться после этих сбоев, нам нужен механизм моделирования и создания таких реальных сбоев в управляемой тестовой среде.
2. Возможность создания коррелированных ошибок: хотя в системе в основном возникают такие сбои, как ошибки сети, аппаратные сбои могут легко возникать по отдельности. Создание значительное количество сценариев, возможных в реальном мире в результате взаимодействия этих отдельных ошибок, — нетривиальная задача.
3. Унифицированные возможности на различных уровнях разработки и развертывания: существует множество систем внесения ошибок, которые позволяют моделировать сбои различных типов. Однако эти возможности уменьшаются, когда мы переходим от универсальных сценариев разработки к выполнению аналогичных проверок в больших тестовых средах и в рабочей среде.

Хотя существует ряд механизмов для решения упомянутых выше проблем, нет системы, которая реализует все эти возможности с необходимыми гарантиями (как в универсальной среде разработки, так и при тестировании в производственных кластерах). Компонент Testability позволяет разработчикам сосредоточиться на тестировании своей бизнес-логики. Компонент тестирования предоставляет все возможности, необходимые для проверки взаимодействия службы с базовой распределенной системой.

### Моделирование и создание реальных сценариев возникновения ошибок
Чтобы проверить устойчивость распределенной системы к сбоям, нам нужен механизм создания ошибок. Хотя теоретически создать ошибку (например, прервать работу узла) не так и сложно, на практике возникают распространенные проблемы с согласованностью, которые призвана решить платформа Service Fabric. Например, в случае завершения работы узла рабочий процесс выглядит следующим образом.

1. Клиент отправляет запрос на завершение работы узла.
2. Запрос отправляется в нужный узел.
	1. Если узел не найден, должна возникнуть ошибка.
	2. Если узел найден, запрос должен вернуться, только если узел не работает.

С точки зрения тестирования необходимо знать, что при инициировании этого сбоя сбой фактически происходит для проверки ошибки. Windows Fabric гарантирует следующее: узел либо завершит работу, либо уже не работает, когда команда достигает узла. В любом случае тестирование должно верно определить причину состояния и успешно либо неудачно выполнить ее правильную проверку. В системе, реализованной за пределами платформы Service Fabric для создания аналогичного набора ошибок, может возникнуть ряд проблем с сетями, оборудованием и программным обеспечением, которые могут помешать ей предоставить указанные выше гарантии. При наличии проблем, уже упомянутых ранее, платформа Service Fabric перенастроит состояние кластера для решения проблем, благодаря чему компонент Testability сможет предоставить нужные гарантии.

### Создание необходимых событий и сценариев
Хотя во время моделирования реальной ошибки обеспечить изначальную согласованность непросто, возможность создания коррелированных сбоев — еще более сложная задача. Например, в материализованной службе с отслеживанием состояния наблюдается потеря данных в следующих случаях.

1. Кворум записи реплик обеспечивается только во время репликации. Все вторичные реплики отстают от первичной.
2. Кворум записи не функционирует должным образом, так как реплики выходят из строя (из-за пакета кода или завершения работы узла).
3. Не удается снова обеспечить кворум записи из-за потери данных для реплик (вследствие повреждения диска или пересоздания образа компьютера).

Эти коррелированные ошибки действительно случаются (хотя реже, чем отдельные сбои) на практике. Очень важна возможность проверить эти сценарии до их возникновения в рабочей среде. Еще более важно иметь возможность моделировать их в рабочей нагрузке в управляемых условиях (в середине дня при наличии всех инженеров), а не при первом возникновении в рабочей среде в 2:00 утра.

### Единые возможности в различных средах
Общепринятая практика заключается в создании трех разных наборов возможностей: по одному для среды разработки, для тестов и для рабочей среды. Использовалась следующая модель.

1. В среде разработки создавались смены состояний, что позволяло выполнять модульные тесты отдельных методов.
2. В тестовой среде создавались сбои, что позволяло проводить сквозные тесты различных сценариев ошибок.
3. Рабочая среда поддерживалась в начальном состоянии во избежание неестественных ошибок, а также для обеспечения быстрого реагирования специалистов на сбои.

Так как в платформе Service Fabric есть модуль и служба Testability, мы предлагаем качественно новый подход, который состоит в использовании одного метода, начиная со среды разработки и заканчивая рабочей средой. Это достигается двумя способами. 1. Для вызова управляемых сбоев интерфейсы API Testability постоянно используются как в универсальной среде, так и в рабочих кластерах. 2. Чтобы автоматически создать сбои на кластере, используется служба Testability. Управление частотой сбоев путем настройки позволяет проверять одну службу по-разному в различных средах.

Аналогичный механизм используется и в платформе Service Fabric (только мы имеем дело с другим масштабом сбоев и отличными средами). Это позволяет намного быстрее внедрить код в конвейере развертывания и проверить службы в условиях реальных нагрузок.

## Использование компонента Testability
### Использование компонента Testability с языком C# 
Различные возможности тестирования представлены в сборке System.Fabric.Testability.dll. Этот DLL-файл можно найти в пакете NuGet Microsoft.ServiceFabric.Testability.nupack. Чтобы использовать функции компонента Testability, включите пакет NuGet в качестве ссылки в свой проекте.

## Использование компонента Testability в оболочке PowerShell
Чтобы использовать компонент Testability в PowerShell, необходимо установить MSI среды выполнения. После установки MSI автоматически загрузится модуль ServiceFabricTestability для PowerShell, который смогут использовать разработчики.

## Заключение
Чтобы создать службы в масштабе облака, очень важно убедиться, что службы устойчивы к реальным ошибкам до развертывания и в рабочей среде. Кроме того, в современном мире служб огромное значение имеет возможность быстро внедрять и перемещать код в рабочей среде. Компонент Testability платформы Service Fabric позволяет разработчикам служб с легкостью выполнить указанные выше задачи.

## Дальнейшие действия

- [Действия, доступные благодаря Testability](service-fabric-testability-actions.md)
- [Сценарии Testability](service-fabric-testability-actions.md)
- Тестирование службы
	- [Моделирование ошибок во время рабочих нагрузок службы](service-fabric-testability-workload-tests.md)
   - [Ошибки обмена данными между службами](service-fabric-testability-scenarios-service-communication.md)

 

<!---HONumber=Nov15_HO2-->