
<properties
   pageTitle="Обновление приложений: параметры обновления | Microsoft Azure"
   description="Описывает параметры, относящиеся к обновлению приложения Service Fabric, включая проверки работоспособности и политики для автоматической отмены обновления."
   services="service-fabric"
   documentationCenter=".net"
   authors="mani-ramaswamy"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="07/17/2015"
   ms.author="subramar"/>



# Параметры обновления приложений

В настоящей статье описаны различные параметры, которые применяются во время обновления приложения структуры службы. В параметрах содержится имя и версия приложения, а также элементы управления временем ожидания и проверками работоспособности, которые применяются во время обновления и указывают политики, которые должны применяться при сбое обновления.


<br>

| Параметр | Описание |
| --- | --- |
| ApplicationName | Имя обновляемого приложения. Примеры: fabric:/VisualObjects, fabric:/ClusterMonitor |
| TargetApplicationTypeVersion | Версия типа приложения, для которой предназначено обновление. |
| FailureAction | Свойство FailureAction описывает действие, которое должно быть предпринято структурой службы при сбое обновления. Возможно, что будет выполнен откат приложения до последней версии перед обновлением либо обновление приложения будет остановлено на уровне текущего домена обновления, а режим обновления изменится на ручной. Допустимые значения этого свойства: Rollback (Откат) и Manual (Вручную). |
| HealthCheckWaitDurationSec | Время ожидания (в секундах) после завершения обновления на уровне домена обновления перед тем, как структура службы выполнит оценку работоспособности приложения. Этот срок можно рассматривать как время, в течение которого приложение должно быть запущено, чтобы оно могло рассматриваться работоспособным. После успешной проверки работоспособности процесс обновления переходит к следующему домену обновления. При сбое проверки работоспособности структура службы будет ожидать в течение определенного времени (UpgradeHealthCheckInterval) перед возобновлением попытки выполнить проверку работоспособности снова до момента истечения срока, заданного свойством HealthCheckRetryTimeout. По умолчанию и рекомендуемое значение — "0 секунд". |
| HealthCheckRetryTimeoutSec | Продолжительность (в секундах), в течение которой структура службы продолжит выполнение оценки работоспособности перед выводом уведомления о сбое обновления. По умолчанию используется значение "600 секунд". Этот срок запускается после достижения конечного значения HealthCheckWaitDuration. В течение этого времени ожидания HealthCheckRetryTimeout структура службы может выполнить несколько проверок работоспособности приложения. Значение по умолчанию — "10 минут", его рекомендуется откорректировать в соответствии с вашим приложением. |
| HealthCheckStableDurationSec | Продолжительность (в секундах) ожидания завершения проверки и заключения о стабильности приложения перед переходом в следующий домен обновления или завершением обновления. Это время ожидания используется для того, чтобы предотвратить возможность пропуска необнаруженных проблем работоспособности сразу после выполнения проверки работоспособности. Значение по умолчанию — "0 секунд". Его рекомендуется откорректировать в соответствии с требованиями вашего приложения. |
| UpgradeDomainTimeoutSec | Максимальное время (в секундах) для обновления одного домена обновления. По истечении этого времени ожидания обновление остановится, после чего будет предпринято действие, предписанное атрибутом UpgradeFailureAction. Значение по умолчанию — "никогда" (бесконечно). Его рекомендуется откорректировать в соответствии с требованиями вашего приложения. |
| UpgradeTimeout | Время ожидания (в секундах), применяемое для всего обновления. По истечении этого времени ожидания обновление остановится, после чего будет запущено действие UpgradeFailureAction. Значение по умолчанию — "никогда" (бесконечно). Его рекомендуется откорректировать в соответствии с требованиями вашего приложения. |
| UpgradeHealthCheckInterval | Эта настройка задает частоту проверки состояния работоспособности (значение по умолчанию — "60 секунд") и указывается в разделе ClusterManager _манифеста_ _кластера_ (не в командлете обновления). |






<br>
## Оценка работоспособности службы во время обновления приложения

<br> Критерии оценки работоспособности указывать не обязательно. Если критерии оценки работоспособности не указываются перед началом обновления, структура службы использует политики работоспособности приложения, указанные в файле ApplicationManifest.xml экземпляра приложения, для которого выполняется обновление.


<br>

| Параметр | Описание |
| --- | --- |
| ConsiderWarningAsError | Значение по умолчанию — False. Обрабатывает события, предупреждающие о работоспособности приложения, при оценке работоспособности приложения во время обновления в качестве ошибок. По умолчанию структура службы не оценивает события предупреждения о состоянии работоспособности как сбой (ошибку), чтобы обновление могло продолжаться, даже если возникают события предупреждения. |
| MaxPercentUnhealthyDeployedApplications | По умолчанию и рекомендуемое значение — "0". Укажите максимальное количество развертываемых приложений (см. [раздел "Работоспособность"](service-fabric-health-introduction.md)), которые могут быть сочтены неработоспособными перед тем, как само приложение будет сочтено неработоспособным и возникнет сбой обновления. Здесь имеется в виду работоспособность пакета приложения на этом узле, поэтому эта функция полезна для обнаружения неполадок во время обновления и тогда, когда пакет приложения, который разворачивается на узле, неработоспособен (неожиданное прерывание работы и т. п.). В обычном случае реплики приложения будут сбалансированы по нагрузке на другом узле, поэтому приложение может выглядеть работоспособным, позволяя таким образом выполнить дальнейшее обновление. При указании строгого значения работоспособности в атрибуте MaxPercentUnhealthyDeployedApplications структура служб может обнаружить проблему с пакетом приложения очень быстро, что приведет к сбою быстрого обновления. |
| MaxPercentUnhealthyServices | По умолчанию и рекомендуемое значение — "0". Укажите максимальное количество служб в экземпляре приложения, которое может быть признано неработоспособным до того, как само приложение будет сочтено неработоспособным, что приведет к сбою обновления. |
| MaxPercentUnhealthyPartitionsPerService | По умолчанию и рекомендуемое значение — "0". Укажите максимальное количество разделов в службе, которые могут быть неработоспособными, прежде чем служба будет считается неработоспособной. |
| MaxPercentUnhealthyReplicasPerPartition | По умолчанию и рекомендуемое значение — "0". Укажите максимальное количество реплик в разделе, которые могут быть признаны неработоспособными до того, как весь раздел будет сочтен неработоспособным. |
| UpgradeReplicaSetCheckTimeout | Служба без отслеживания состояния. При работе в одном домене обновления структура служб пытается обеспечить доступность дополнительных экземпляров службы. Если счетчик целевых экземпляров превышает значение "1", структура служб ожидает, пока станет доступным более одного экземпляра, вплоть до максимального значения времени ожидания (указывается в свойстве UpgradeReplicaSetCheckTimeout). По истечении времени ожидания структура службы продолжает обновление вне зависимости от количества экземпляров службы. Если счетчик целевых экземпляров имеет значение "1", структура службы не ожидает обновления, а сразу переходит к обновлению. Служба с отслеживанием состояния. В одном домене обновления структура службы пытается обеспечить наличие кворума в наборе реплик. Структура служб ожидает доступности кворума вплоть до достижения максимального значения времени ожидания (указанного в свойстве UpgradeReplicaSetCheckTimeout). По истечении времени ожидания структура службы продолжает обновление вне зависимости от кворума. Этот параметр имеет значение "никогда" (бесконечно) при откате до следующей версии (применяется при продолжении обновления в соответствии с ожиданием) и "900 секунд" при откате до предыдущей версии (применяется при возникновении ошибок обновления с последующим откатом). |
| ForceRestart | Если вы обновите конфигурацию или пакет данных без обновления кода службы, структура служб не перезапустит службу, если для свойства ForceRestart не установлено значение True в рамках вызова API. По завершении обновления структура служб уведомляет службу о том, что доступен новый пакет конфигурации или пакет данных. Ответственность за применение изменений принадлежит службе. При необходимости служба может самостоятельно перезапуститься. |



<br> <br> Критерии MaxPercentUnhealthyServices, MaxPercentUnhealthyPartitionsPerService и MaxPercentUnhealthyReplicasPerPartition можно указать для каждого типа служб отдельно для экземпляра приложения. Это необходимо для того, чтобы, если приложение содержит различные типы служб, для него можно было установить отличные политики оценки для каждого типа служб. В качестве примера тип службы "шлюз без отслеживания состояния" может иметь различные значения MaxPercentUnhealthyPartitionsPerService, которые отличаются от типа службы "механизм с отслеживанием состояния" для определенного экземпляра приложения.

## Дальнейшие действия


[Учебник по обновлению](service-fabric-application-upgrade-tutorial.md)

[Дополнительные разделы](service-fabric-application-upgrade-advanced.md)

[Поиск и устранение неисправностей при обновлении приложения](service-fabric-application-upgrade-troubleshooting.md)

[Сериализация данных](service-fabric-application-upgrade-data-serialization.md)
 

<!---HONumber=Nov15_HO2-->