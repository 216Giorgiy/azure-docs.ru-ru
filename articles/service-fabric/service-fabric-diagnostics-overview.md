---
title: "Обзор мониторинга и диагностики Azure Service Fabric | Документы Майкрософт"
description: "Сведения о функциях мониторинга и диагностики для кластеров, приложений и служб Azure Service Fabric."
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: timlt
editor: 
ms.assetid: 
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/17/2017
ms.author: dekapur
ms.openlocfilehash: 88f4a23f89a1c8fd88db1df3a7ff03ae5df64c0f
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="monitoring-and-diagnostics-for-azure-service-fabric"></a>Мониторинг и диагностика для Azure Service Fabric

Мониторинг и диагностика крайне важны для разработки, тестирования и развертывания приложений и служб в любой среде. Оптимальная работа решений Service Fabric зависит от эффективного планирования и реализации мониторинга и диагностики, которые помогают обеспечить правильную работу приложений и служб в локальной среде разработки или в производственной среде.

Основные цели мониторинга и диагностики:
* обнаружение и диагностика проблем с оборудованием и инфраструктурой;
* выявление проблем с программным обеспечением и приложениями, а также сокращение времени простоя служб;
* анализ потребления ресурсов и помощь в принятии решений, связанных с выполнением операций;
* оптимизация производительности приложений, служб и инфраструктуры;
* создание бизнес-аналитики и определение областей для оптимизации.


Общий рабочий процесс мониторинга и диагностики состоит из трех этапов.

1. **Создание событий**. Сюда входят события (журналы, трассировки, пользовательские события) на уровне инфраструктуры (кластера), платформы и приложения или службы.
2. **Агрегирование событий**. Создаваемые события должны быть собраны и агрегированы, прежде чем они могут быть отображены.
3. **Анализ**. События должны быть доступными для просмотра и использования в определенном формате, обеспечивающем возможность анализа и отображения.

Доступны разные продукты с поддержкой этих трех областей, и вы можете использовать разные инструменты для реализации каждого из этапов. Очень важно убедиться в эффективной совместной работе этих компонентов, обеспечивающей комплексное решение мониторинга для кластера.

## <a name="event-generation"></a>Создание событий

Первый этап в рабочем процессе мониторинга и диагностики — создание и формирование событий и журналов. Такие события, журналы и трассировки могут создаваться на двух уровнях: на уровне платформы (включая кластер, виртуальные машины или действия Service Fabric) или на уровне приложений (любые инструменты, добавленные в приложения и службы, развернутые в кластере). События на каждом из этих уровней можно настраивать, хотя Service Fabric предоставляет некоторое инструментирование по умолчанию.

Ознакомьтесь с дополнительными сведениями о [событиях уровня платформы](service-fabric-diagnostics-event-generation-infra.md) и [событиях уровня приложений](service-fabric-diagnostics-event-generation-app.md), чтобы понять, какое инструментирование предоставляется по умолчанию, а какое можно добавить дополнительно.

После принятия решения о поставщике ведения журнала необходимо убедиться в правильном агрегировании и хранении журналов.

## <a name="event-aggregation"></a>Агрегация событий

Для сбора журналов и событий, создаваемых приложениями и кластером, обычно рекомендуется использовать службу [диагностики Azure](service-fabric-diagnostics-event-aggregation-wad.md) (аналогична сбору журналов на основе агентов) или [EventFlow](service-fabric-diagnostics-event-aggregation-eventflow.md) (внутрипроцессный сбор журналов).

Сбор журналов приложений с помощью расширения системы диагностики Azure можно рекомендовать для служб Service Fabric, если набор источников и мест назначения журналов невелик и редко меняется, а источники и места назначения легко сопоставимы. Это связано с тем, что настройка системы диагностики Azure происходит на уровне Resource Manager, поэтому для внесения существенных изменений в конфигурацию требуется обновление или повторное развертывание кластера. Кроме того, рекомендуется обеспечить хранение журналов в более постоянном расположении, к которому можно получить доступ из различных платформ аналитики. Таким образом, в конечном итоге этот вариант менее эффективен, чем использование EventFlow.

Использование [EventFlow](https://github.com/Azure/diagnostics-eventflow) позволяет службам отправлять свои журналы непосредственно в платформу анализа и визуализации и (или) в хранилище. Для этой цели можно использовать и другие библиотеки (ILogger, Serilog и т. д.), однако EventFlow имеет преимущество, так как она была разработана специально для внутрипроцессного сбора журналов и поддержки служб Service Fabric. Как правило, это имеет несколько потенциальных преимуществ.

* Простая настройка и развертывание
    * Конфигурация сбора диагностических данных является лишь частью конфигурации службы. Ее легко сохранять "синхронизированной" с остальной частью приложения.
    * Настройка каждого приложения или службы также не представляет сложности.
    * Настройка назначения данных через EventFlow заключается в добавлении соответствующего пакета NuGet и внесении изменений в файл *eventFlowConfig.json*.
* Гибкость
    * Приложение может отправлять данные куда угодно при наличии клиентской библиотеки, поддерживающей систему хранения целевых данных. При необходимости можно добавлять новые расположения.
    * Можно реализовать сложные правила сбора, фильтрации и статистической обработки данных.
* Доступ к внутренним данным приложения и контексту
    * В подсистему диагностики, которая работает внутри процесса приложения или службы, можно легко добавить трассировку с помощью контекстной информации.

Следует отметить, что эти два варианта не являются взаимоисключающими, и хотя для выполнения тех или иных функций можно использовать одно из решений, имеет смысл настроить оба варианта. В большинстве случаев объединение агента с внутрипроцессным сбором данных помогает организовать более надежный рабочий процесс мониторинга. Расширение системы диагностики Azure (агент) можно использовать для журналов уровня платформы, тогда как EventFlow (внутрипроцессный сбор) — для журналов уровня приложений. Выбрав оптимальное решение, можно подумать о способе отображения и анализа данных.

## <a name="event-analysis"></a>Анализ событий

На рынке представлено несколько отличных платформ анализа и визуализации данных мониторинга и диагностики. Мы рекомендуем [OMS](service-fabric-diagnostics-event-analysis-oms.md) и [Application Insights](service-fabric-diagnostics-event-analysis-appinsights.md) благодаря более эффективной интеграции с Service Fabric, однако также следует обратить внимание на [Elastic Stack](https://www.elastic.co/products) (особенно если вы собираетесь запускать кластер в автономной среде), [Splunk](https://www.splunk.com/) или любую другую предпочитаемую вами платформу.

Основные моменты, на которые следует обратить внимание: удобство пользовательского интерфейса и составления запросов, возможность визуализации данных и создания удобных панелей мониторинга, а также наличие дополнительных средств для повышения эффективности мониторинга, таких как автоматическая генерация оповещений.

В дополнение к выбранной платформе при настройке кластера Service Fabric как ресурса Azure вы также получаете доступ к готовым функциям мониторинга Azure для виртуальных машин, которые могут быть полезны для определенных типов мониторинга производительности и метрик.

### <a name="azure-monitor"></a>Azure Monitor

[Мониторинг Azure](../monitoring-and-diagnostics/monitoring-overview.md) дает возможность отслеживать многие ресурсы Azure, из которых состоит кластер Service Fabric. Данные по набору метрик для [масштабируемого набора виртуальных машин](../monitoring-and-diagnostics/monitoring-supported-metrics.md#microsoftcomputevirtualmachinescalesets) и отдельных [виртуальных машин](../monitoring-and-diagnostics/monitoring-supported-metrics.md#microsoftcomputevirtualmachinescalesetsvirtualmachines) автоматически собираются и отображаются на портале Azure. Чтобы просмотреть собранные сведения, выберите на портале Azure группу ресурсов, содержащую кластер Service Fabric. Затем выберите нужный масштабируемый набор виртуальных машин. В разделе **Мониторинг** выберите **Метрики**, чтобы увидеть график значений.

![Представление собранных данных метрик на портале Azure](media/service-fabric-diagnostics-overview/azure-monitoring-metrics.png)

Настройка параметров диаграммы описана в статье [Обзор метрик в Microsoft Azure](../monitoring-and-diagnostics/insights-how-to-customize-monitoring.md). Кроме того, на основе этих метрик можно создавать оповещения, как описано в статье [Создание оповещений в Azure Monitor для служб Azure с помощью портала Azure](../monitoring-and-diagnostics/insights-alerts-portal.md). Можно отправлять оповещения в службу уведомлений с помощью объектов webhook, как описано в статье [Настройка объектов webhook для оповещений на основе метрик Azure](../monitoring-and-diagnostics/insights-webhooks-alerts.md). Azure Monitor поддерживает только одну подписку. Если вы настраиваете мониторинг для нескольких подписок или вам нужны дополнительные функции, воспользуйтесь решением [Log Analytics](https://azure.microsoft.com/documentation/services/log-analytics/), которое входит в состав пакета Operations Management Suite. Это комплексное решение для управления как локальной, так и облачной ИТ-инфраструктурой. Данные из Azure Monitor можно направлять непосредственно в Log Analytics, чтобы метрики и журналы для всей среды отображались в одном расположении.

## <a name="next-steps"></a>Дальнейшие действия

### <a name="watchdogs"></a>Модули наблюдения

Модуль наблюдения — это отдельная служба, которая может отслеживать работоспособность и нагрузку в службах и сообщать о работоспособности любого элемента в иерархии модели работоспособности. Он позволяет предотвратить ошибки, которые невозможно обнаружить в контексте отдельной службы. Модули наблюдения также удобны для размещения кода, выполняющего корректирующие действия без участия пользователя (например, очистку файлов журнала в хранилище через определенные интервалы времени). Пример реализации службы наблюдения см. [здесь](https://github.com/Azure-Samples/service-fabric-watchdog-service).

Прежде всего, необходимо понять принципы создания событий и журналов на [уровне платформы](service-fabric-diagnostics-event-generation-infra.md) и [уровне приложений](service-fabric-diagnostics-event-generation-app.md).