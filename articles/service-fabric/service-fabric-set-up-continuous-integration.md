<properties
   pageTitle="Непрерывная интеграция для Service Fabric | Microsoft Azure"
   description="Общие сведения о том, как настроить непрерывную интеграцию для приложения Service Fabric, используя Visual Studio Team Services (VSTS)."
   services="service-fabric"
   documentationCenter="na"
   authors="mthalman-msft"
   manager="timlt"
   editor="" />
<tags
   ms.service="multiple"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="multiple"
   ms.date="07/25/2016"
   ms.author="mthalman" />

# Настройка непрерывной интеграции для приложения Service Fabric с использованием Visual Studio Team Services

В этой статье подробно описаны действия по настройке непрерывной интеграции для приложения Azure Service Fabric с использованием служб Visual Studio Team Services (VSTS), которые обеспечивают автоматизацию сборки, упаковки и развертывания приложения.

Этот документ описывает текущую процедуру, которая со временем будет изменена.

## Предварительные требования

Чтобы приступить к работе, выполните эти действия.

1. Обеспечьте доступ к учетной записи Team Services или [создайте](https://www.visualstudio.com/docs/setup-admin/team-services/sign-up-for-visual-studio-team-services) ее самостоятельно.

2. Обеспечьте доступ к командному проекту Team Services или [создайте](https://www.visualstudio.com/docs/setup-admin/create-team-project) его самостоятельно.

3. Убедитесь в наличии кластера Service Fabric, на котором можно развернуть приложение, или создайте его, используя [портал Azure](service-fabric-cluster-creation-via-portal.md), [шаблон Resource Manager](service-fabric-cluster-creation-via-arm.md) или [Visual Studio](service-fabric-cluster-creation-via-visual-studio.md).

4. Убедитесь, что проект приложения Service Fabric (SFPROJ-файл) уже создан.

>[AZURE.NOTE] Пользовательские агенты сборки больше не требуются. Размещенные в Team Services агенты сборки теперь устанавливаются вместе с программным обеспечением для управления кластером Service Fabric, что позволяет развертывать приложения непосредственно из этих агентов.

## Настройка и совместное использование исходных файлов

Первое, что необходимо сделать, — подготовить профиль публикации для процесса развертывания, который будет выполняться в Team Services. Профиль публикации следует настроить для целевого кластера, который был подготовлен ранее.

1.	Выберите в проекте приложения профиль публикации, который вы хотите использовать для рабочего процесса непрерывной интеграции, и следуйте [указаниям по публикации](service-fabric-publish-app-remote-cluster.md), которые описывают публикацию приложения на удаленном кластере. Хотя на самом деле публиковать приложение не требуется. Можно просто щелкнуть гиперссылку **Сохранить** в диалоговом окне публикации после выполнения всех настроек.
2.	Если требуется обновлять приложение при каждом развертывании в Team Services, то понадобится настроить профиль публикации таким образом, чтобы обеспечить обновление. Убедитесь, что в диалоговом окне публикации, которое вы использовали на шаге 1, установлен флажок **Upgrade the Application** (Обновить приложение). Вы можете узнать больше о [настройке дополнительных параметров обновления](service-fabric-visualstudio-configure-upgrade.md). Щелкните гиперссылку **Сохранить**, чтобы сохранить параметры в профиле публикации.
3.	Убедитесь, что изменения в профиле публикации сохранены, и закройте диалоговое окно публикации.
4.	Теперь пора обеспечить [совместное использование исходных файлов проекта приложения](https://www.visualstudio.com/docs/setup-admin/team-services/connect-to-visual-studio-team-services#vs) с Team Services. Когда исходные файлы станут доступны в Team Services, можно будет перейти к следующему шагу — созданию сборок.

## Создание определения сборки

Определение сборки Team Services описывает рабочий процесс, состоящий из набора шагов сборки, которые выполняются последовательно. Цель создаваемого вами определения сборки — создать пакет приложения Service Fabric, а также некоторые дополнительные файлы, которые затем могут использоваться для развертывания приложения на кластере. Узнайте больше об [определениях сборок](https://www.visualstudio.com/docs/build/define/create) Team Services.

### Создание определения

1.	Откройте командный проект в Visual Studio Team Services.
2.	Выберите вкладку **Сборка**.
3.	Щелкните зеленый значок **+**, чтобы создать определение сборки.
4.	В нижней части открывшегося диалогового окна щелкните **Пустой**.
5.	Щелкните **Далее**.
6.	Выберите репозиторий и ветвь, связанные с приложением Service Fabric.
7.	Выберите очередь агента, которую вы хотите использовать. Поддерживаются размещенные агенты.
8.	Нажмите кнопку **Создать**.
9.	Переключитесь на вкладку **Переменные** и добавьте следующие переменные.
   1. Имя: BuildConfiguration, значение: Release.
   2. Имя: BuildPlatform, значение: x64.
9. Вернитесь на вкладку **Сборка** и добавьте следующие шаги сборки в определение:
   1. Установщик NuGet.
   2. Сборка Visual Studio (имя: Выполнение сборки решения).
      1. Платформа: $(BuildPlatform).
      2. Конфигурация: $(BuildConfiguration).
   3. Сборка Visual Studio (имя: Упаковка приложения).
      1. Решение: ** \\*.sfproj.
      2. Аргументы MSBuild: /t:Package /p:PackageLocation=$(build.artifactstagingdirectory)\\applicationpackage
      3. Платформа: $(BuildPlatform).
      4. Конфигурация: $(BuildConfiguration).
   4. Обновление версий приложения Service Fabric
      1. Пакет приложения: $(build.artifactstagingdirectory)\\applicationpackage.
   5. Копирование файлов.
      1. Исходная папка: $(build.sourcesdirectory).
      2. Содержимое: **\\PublishProfiles\\*.xml &lt;new line&gt; **\\ApplicationParameters\\*.xml.
      3. Целевая папка: $(build.artifactstagingdirectory)\\projectartifacts.
   6. Публикация артефактов сборки.
      1. Путь для публикации: $(build.artifactstagingdirectory).
      2. Имя артефакта: drop.
      3. Тип артефакта: Server.
10. Сохраните определение сборки и укажите его имя.

### Проверка значений полей по умолчанию для задач

1.	Проверьте поля ввода **решения** для шагов сборки **Восстановление NuGet** и **Выполнение сборки решения**. По умолчанию эти шаги сборки будут выполняться для всех файлов решения, находящихся в связанном репозитории. Если требуется, чтобы определение сборки оперировало только одним из файлов решения, то необходимо явным образом обновить путь к этому файлу.
2.	Проверьте поля ввода **решения** для шага сборки **Упаковка приложения**. По умолчанию на этом шаге сборки предполагается, что в репозитории существует только один проект приложения Service Fabric (SFPROJ-файл). Если в репозитории есть несколько файлов и требуется указать только один из них для определения сборки, то нужно явным образом обновить путь к этому файлу. Если нужно упаковать несколько проектов приложений из репозитория, то необходимо в определении сборки создать дополнительные шаги **сборки Visual Studio** для каждого из этих проектов. Затем необходимо будет обновить поле **Аргументы MSBuild** для каждого из этих шагов сборки, чтобы расположение пакета было уникальным для каждого из них.
3.	Проверьте поведение управления версиями, определенного в шаге сборки **Обновление версий приложения Service Fabric**. По умолчанию этот шаг сборки добавляет номер сборки во все значения версий в файлах манифеста пакета приложения. Дополнительные сведения см. на [странице документации по этой задаче](https://go.microsoft.com/fwlink/?LinkId=820529). Это удобно для поддержки обновлений приложения, так как для каждого развертывания обновления требуются отличающиеся значения версий из предыдущего развертывания. Если вы не собираетесь использовать обновление приложения в рабочем процессе, то можете отключить этот шаг сборки.
4.	Сохраните все изменения, внесенные в определение сборки.

### Попробовать

Щелкните **Поставить сборку в очередь**, чтобы запустить сборку вручную. Сборки также будут активированы после принудительного запуска или возврата. Убедившись, что сборка успешно выполняется, вы можете перейти к созданию определения выпуска, которое будет развертывать приложение в кластере.

## Создание определения выпуска

Определение выпуска Team Services описывает рабочий процесс, состоящий из набора задач, которые выполняются последовательно. Цель создаваемого определения выпуска — получить пакет приложения и развернуть его в кластере. Вместе определение сборки и определение выпуска могут выполнить весь рабочий процесс, начиная с исходных файлов и заканчивая запуском приложения в кластере. Узнайте больше об [определениях выпуска](https://www.visualstudio.com/docs/release/author-release-definition/more-release-definition) Team Services.

### Создание определения

1.	Откройте проект в Visual Studio Team Services.
2.	Выберите вкладку **Выпуск**.
3.	Щелкните зеленый знак **+**, чтобы создать определение выпуска, и выберите в меню **Создать определение выпуска**.
4.	В нижней части открывшегося диалогового окна щелкните **Пустой**.
5.	Щелкните **Далее**.
6.	Выберите определение сборки, которое вы хотите использовать как источник для этого определения выпуска. Определение выпуска будет ссылаться на артефакты, которые были созданы с помощью выбранного определения сборки.
7.	Установите флажок **Непрерывное развертывание**, если вы хотите, чтобы служба Team Services автоматически создавала новый выпуск и разворачивала приложение Service Fabric после завершения каждой сборки.
8.	Выберите очередь агента, которую вы хотите использовать. Поддерживаются размещенные агенты.
9.	Нажмите кнопку **Создать**.
10.	Измените имя определения, щелкнув значок карандаша в верхней части страницы.
11.	Нажмите кнопку **Добавить задачи**.
12.	В открывшемся диалоговом окне нажмите кнопку "Добавить" для задачи **Service Fabric Application Deployment** (Развертывание приложения Service Fabric) в категории **Развертывание**.
13.	Закройте это диалоговое окно.
14.	Определите путь к профилю публикации, который вы хотите использовать для развертывания приложения в кластере, в поле ввода **Профиль публикации** задачи. Этот путь ссылается на файл, который содержится в каталоге артефактов публикации, созданных с помощью связанного определения сборки. Пример пути: $(system.defaultworkingdirectory)/MyBuildDefinition/drop/projectartifacts/Solution/AppProject/PublishProfiles/Cloud.xml.
15.	В поле ввода **Пакет приложения** задачи укажите путь к пакету приложения для развертывания в кластере. Этот путь ссылается на расположение в каталоге артефактов публикации, созданных с помощью связанного определения сборки. Пример пути: $(system.defaultworkingdirectory)/MyBuildDefinition/drop/applicationpackage.
16.	В поле ввода **Cluster Connection** (Подключение к кластеру) задачи выберите кластер, на котором должно быть развернуто приложение. Подключение к кластеру предоставляет необходимую информацию, позволяющую задаче развертывания подключиться к кластеру. Если у вас еще нет подключения к кластеру, щелкните гиперссылку **Управление** рядом с полем, чтобы добавить подключение. На открывшейся странице выполните следующие действия.
    1. Выберите **Создать конечную точку службы**, затем в меню выберите **Azure Service Fabric**.
    2. Выберите тип аутентификации на кластере, используемом этой конечной точкой.
    2. Укажите имя подключения в поле **Имя подключения**. Обычно используется имя кластера.
    3. Укажите URL-адрес конечной точки подключения клиента в поле **Конечная точка кластера**. Пример: https://contoso.westus.cloudapp.azure.com:19000.
    4. В полях **Пользователь** и **Пароль** укажите учетные данные Azure Active Directory для подключения к кластеру.
    5. В поле **Сертификат клиента** укажите кодировку Base64 для файла сертификата клиента, используемого для аутентификации на основе сертификата. Сведения о том, как получить это значение, получите во всплывающем окне справки для этого поля. Если ваш сертификат защищен паролем, укажите его в поле **Пароль**.
    6. Подтвердите изменения, нажав кнопку **ОК**. Вернувшись к определению выпуска, щелкните значок "Обновить" для поля **Cluster Connection** (Подключение к кластеру), чтобы отобразить только что добавленную конечную точку.
17.	Сохраните определение выпуска.

Созданное определение состоит из одной задачи: **Deploy Service Fabric Application** (Развертывание приложения Service Fabric). Дополнительные сведения см. на [странице документации по этой задаче](https://go.microsoft.com/fwlink/?LinkId=820528).

### Попробовать

В меню кнопки **Выпуск** выберите **Создать выпуск**, чтобы создать выпуск вручную. В появившемся диалоговом окне выберите сборку, на которой должен быть основан выпуск, и щелкните **Создать**. Если вы включили непрерывное развертывания, то выпуски также будут создаваться автоматически после завершении сборки посредством связанного определения сборки.

## Дальнейшие действия

Дополнительные сведения о непрерывной интеграции с приложениями Service Fabric см. в следующих статьях:

 - [Домашняя страница документации по Team Services](https://www.visualstudio.com/docs/overview)
 - [Управление сборками в Team Services](https://www.visualstudio.com/docs/build/overview)
 - [Управление выпусками в Team Services](https://www.visualstudio.com/docs/release/overview)

<!---HONumber=AcomDC_0727_2016-->