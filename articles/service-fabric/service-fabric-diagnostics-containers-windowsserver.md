---
title: "Мониторинг и диагностика контейнеров Azure Service Fabric | Документация Майкрософт"
description: "Узнайте, как помощью решения OMS \"Контейнеры\" отслеживать и диагностировать контейнеры, организованные в Microsoft Azure Service Fabric."
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: timlt
editor: 
ms.assetid: 
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 10/15/2017
ms.author: dekapur
ms.openlocfilehash: 319ee2c0f7492389bc1767aa2669dd273f8cfa1b
ms.sourcegitcommit: a7c01dbb03870adcb04ca34745ef256414dfc0b3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2017
---
# <a name="monitoring-windows-server-containers-with-oms"></a>Отслеживание контейнеров Windows Server с помощью OMS

## <a name="oms-containers-solution"></a>Решение OMS "Контейнеры"

Log Analytics в Operations Management Suite (OMS) содержит решение "Контейнеры", которое можно использовать для наблюдения за контейнерами. Это решение в комбинации с Service Fabric представляет собой отличное средство для отслеживания развертываний контейнеров, управляемых в Service Fabric. Ниже показано, как выглядит панель мониторинга этого решения.

![Основная панель мониторинга OMS](./media/service-fabric-diagnostics-containers-windowsserver/oms-containers-dashboard.png)

Это решение также собирает различные журналы, которые можно запросить в средстве Log Analytics OMS и использовать для визуализации любых метрик и происходящих событий. Собираются следующие типы журналов.

1. ContainerInventory — отображает информацию о местонахождении контейнера, имени и образах.
2. ContainerImageInventory — информация о развернутых образах, в том числе их идентификаторы или размеры.
3. ContainerLog — журналы конкретных ошибок, журналы Docker (StdOut и т. д.) и другие записи.
4. ContainerServiceLog — выполнявшиеся команды управляющей программы Docker.
5. Perf — счетчики производительности контейнера, в том числе ЦП, память, сетевой трафик, операции ввода и вывода на диске и пользовательские метрики с компьютеров узла.

В этой статье рассматриваются шаги, необходимые для настройки мониторинга контейнера в кластере. Дополнительные сведения о решении OMS "Контейнеры" см. в [документации](../log-analytics/log-analytics-containers.md) по решению.

## <a name="1-set-up-a-service-fabric-cluster"></a>1. Настройка кластера Service Fabric

Создайте кластер с помощью шаблона Azure Resource Manager, который можно скачать [здесь](https://github.com/ChackDan/Service-Fabric/tree/master/ARM%20Templates/SF%20OMS%20Samples/Windows). Обязательно добавьте уникальное имя рабочей области OMS. Этот шаблон также по умолчанию развертывает кластер в предварительной версии сборки Service Fabric (255.255). Это означает, что его нельзя использовать в рабочей среде и нельзя обновить до другой версии Service Fabric. Если этот шаблон нужен вам для долгосрочных целей или вы хотите использовать его в рабочей среде, измените его версию на стабильную.

После настройки кластера убедитесь, что вы установили соответствующий сертификат и что вы можете подключиться к кластеру.

Убедитесь, что вы правильно настроили группу ресурсов. Для этого перейдите на [портал Azure](https://portal.azure.com/) и найдите соответствующее развертывание. Группа ресурсов должна содержать все ресурсы Service Fabric, а также решение Log Analytics и решение Service Fabric.

Вот как изменить существующий кластер Service Fabric.
* Убедитесь, что вы включили диагностику (если нет, включите ее [обновив масштабируемый набор виртуальных машин](/rest/api/virtualmachinescalesets/create-or-update-a-set)).
* Добавьте рабочую область OMS, создав решение "Аналитика Service Fabric" с помощью Azure Marketplace.
* Измените источники данных решения Service Fabric, чтобы они выбирали данные из соответствующих таблиц службы хранилища Azure (настроенные с помощью WAD) в группе ресурсов, в которой находится кластер.
* Добавьте агент в качестве [расширения для масштабируемого набора виртуальных машин](/powershell/module/azurerm.compute/add-azurermvmssextension) с помощью PowerShell или путем обновления масштабируемого набора виртуальных машин (используйте ссылку выше, чтобы изменить шаблон Resource Manager).

## <a name="2-deploy-a-container"></a>2) Развертывание контейнера

Если кластер готов и вы можете открыть его, разверните в него контейнер. Если вы решили использовать предварительную версию, заданную шаблоном, ознакомьтесь с новой возможностью Service Fabric — Docker Compose. Не забывайте, что при первом запуске образ контейнера развертывается в кластер. Скачивание образа занимает несколько минут (в зависимости от его размера).

## <a name="3-add-the-containers-solution"></a>3. Добавление решения "Контейнеры"

На портале Azure с помощью Azure Marketplace создайте ресурс "Контейнеры" (в категории "Мониторинг и управление"). 

![Добавление решения "Контейнеры"](./media/service-fabric-diagnostics-containers-windowsserver/containers-solution.png)

На этапе создания решение запрашивает рабочую область OMS. Выберите рабочую область, которую вы создали во время развертывания. На этом шаге решение "Контейнеры" добавляется в рабочую область OMS и автоматически определяется агентом OMS, который развернут с помощью шаблона. Агент начнет сбор данных о процессах контейнеров в кластере, и через 10–15 минут вы увидите, что в решении появились данные, как показано на рисунке панели мониторинга выше.

## <a name="4-next-steps"></a>4. Дальнейшие действия

В рабочей области OMS вы найдете разные инструменты, которые вам могут пригодиться. Ознакомьтесь со следующими возможностями настройки решения в соответствии с требованиями.
- Ознакомьтесь с функциями [поиска по журналам и запросов к журналам](../log-analytics/log-analytics-log-searches.md), которые являются частью решения Log Analytics.
- Настройте агент OMS для выбора конкретных счетчиков производительности. Для этого откройте рабочую область "Главная" > "Параметры" > "Данные" > "Счетчики производительности Windows".
- Настройте OMS, чтобы настроить правила [автоматических предупреждений](../log-analytics/log-analytics-alerts.md), которые помогают выполнять обнаружение и диагностику.