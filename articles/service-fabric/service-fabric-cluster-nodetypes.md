<properties
   pageTitle="Типы узлов и масштабируемые наборы виртуальных машин в Service Fabric | Microsoft Azure"
   description="Описание связи типов узлов с масштабируемыми наборами ВМ в Service Fabric и сведения о процедуре удаленного подключения к экземпляру масштабируемого набора ВМ или узлу кластера."
   services="service-fabric"
   documentationCenter=".net"
   authors="ChackDan"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="05/02/2016"
   ms.author="chackdan"/>


# Связь между типами узлов Service Fabric и масштабируемыми наборами виртуальных машин

Масштабируемые наборы виртуальных машин относятся к вычислительным ресурсам Azure. Их можно использовать для развертывания коллекции виртуальных машин и управления ею как набором. Каждый тип узла, определенный в кластере Service Fabric, настроен как отдельный масштабируемый набор ВМ. Каждый тип узла поддерживает возможность независимого масштабирования, имеет разные наборы открытых портов и собственные метрики емкости.

На следующем снимке экрана показан кластер с двумя типами узлов: FrontEnd и BackEnd. Каждый тип узла имеет пять узлов.

![Снимок экрана с двумя типами узлов][NodeTypes]

## Сопоставление экземпляров масштабируемых наборов ВМ с узлами

Как можно заметить на снимке выше, нумерация экземпляров масштабируемых наборов ВМ начинается с нуля и увеличивается. Нумерация отражается в именах. Например, BackEnd\_0 является нулевым экземпляром масштабируемого набора ВМ BackEnd. Этот конкретный масштабируемый набор ВМ имеет пять экземпляров с именами BackEnd\_0, BackEnd\_1, BackEnd\_2, BackEnd\_3 и BackEnd\_4.

При увеличении масштаба масштабируемого набора ВМ создается новый экземпляр. Имя нового экземпляра масштабируемого набора ВМ обычно имеет следующий формат: имя масштабируемого набора ВМ + номер следующего экземпляра. В нашем примере это будет BackEnd\_5.


## Сопоставление балансировщиков нагрузки масштабируемых наборов ВМ с каждым типом узла или масштабируемым набором ВМ

Если вы развернули кластер на портале или использовали предоставленный образец шаблона ARM, при получении списка всех ресурсов в разделе группы ресурсов вы увидите балансировщики нагрузки для каждого типа узла или масштабируемого набора ВМ.

Имя будет выглядеть следующим образом: **LB-<имя типа узла>**. Например, LB-sfcluster4doc-0, как показано на следующем снимке экрана:


![Ресурсы][Resources]


## Удаленное подключение к экземпляру масштабируемого набора ВМ или узлу кластера
Каждый тип узла, определенный в кластере, настроен как отдельный масштабируемый набор ВМ. Это означает, что типы узлов поддерживают независимое масштабирование и могут состоять из различных номеров SKU ВМ. В отличие от ВМ, состоящих из одного экземпляра, экземпляры масштабируемых наборов ВМ не получают собственные виртуальные IP-адреса. Поэтому поиск IP-адреса и порта, которые можно использовать для удаленного подключения к определенному экземпляру, может оказаться непростой задачей.

Ниже приведены действия по их обнаружению.

### Шаг 1. Определение виртуального IP-адреса для типа узла и правил NAT для входящего трафика для RDP

Для этого необходимо получить значения правил NAT для входящего трафика, которые были определены в рамках определения ресурсов для **Microsoft.Network/loadBalancers**.

На портале перейдите к колонке балансировщика нагрузки и затем выберите **Параметры**.

![LBBlade][LBBlade]


В разделе **Параметры** щелкните **Правила NAT для входящего трафика**. Вы увидите IP-адрес и порт, которые можно использовать для удаленного подключения к первому экземпляру масштабируемого набора ВМ. На приведенном ниже снимке экрана это **104.42.106.156** и **3389**.

![NATRules][NATRules]

### Шаг 2. Определение порта, который можно использовать для удаленного подключения к конкретному экземпляру масштабируемого набора ВМ или узлу

Ранее в этом документе говорилось о сопоставлении экземпляров масштабируемого набора ВМ с узлами. Мы будем использовать эти данные для определения точного номера порта.

Порты распределяются по возрастанию номера экземпляра масштабируемого набора ВМ. Поэтому в примере с типом узла FrontEnd для каждого из пяти экземпляров будут использоваться указанные далее порты. Вам потребуется выполнить такое же сопоставление для экземпляра масштабируемого набора ВМ.

|**Экземпляр масштабируемого набора ВМ**|**Порт**|
|-----------------------|--------------------------|
|FrontEnd\_0|3389|
|FrontEnd\_1|3390|
|FrontEnd\_2|3391|
|FrontEnd\_3|3392|
|FrontEnd\_4|3393|
|FrontEnd\_5|3394|


### Шаг 3. Удаленное подключение к определенному экземпляру масштабируемого набора ВМ

На приведенном ниже снимке экрана использовалось подключение к удаленному рабочему столу для подключения к FrontEnd\_1.

![RDP][RDP]

## Изменение значений диапазона портов RDP

### Перед развертыванием кластера

При настройке кластера с помощью шаблона ARM можно указать диапазон в **inboundNatPools**.

Перейдите к определению ресурса для **Microsoft.Network/loadBalancers**. В нем вы найдете описание **inboundNatPools**. Замените значения *frontendPortRangeStart* и *frontendPortRangeEnd*.

![InboundNatPools][InboundNatPools]


### После развертывания кластера
Это довольно сложный процесс, который может привести к перезапуску виртуальных машин. Теперь вам необходимо задать новые значения с помощью Azure PowerShell. Убедитесь, что на компьютере установлена среда Azure PowerShell 1.0 или более поздней версии. Если вы не сделали этого ранее, настоятельно рекомендуем выполнить инструкции в статье [Установка и настройка Azure PowerShell](../powershell-install-configure.md).

Войдите в учетную запись Azure. Если команды PowerShell по какой-то причине завершаются неудачно, проверьте, правильно ли установлен Azure PowerShell.

```
Login-AzureRmAccount
```

Выполните приведенную ниже команду для получения сведений о балансировщике нагрузки, и вы увидите значения и описание **inboundNatPools**.

```
Get-AzureRmResource -ResourceGroupName <RGname> -ResourceType Microsoft.Network/loadBalancers -ResourceName <load balancer name>
```

Задайте для *frontendPortRangeEnd* и *frontendPortRangeStart* требуемые значения.

```
$PropertiesObject = @{
	#Property = value;
}
Set-AzureRmResource -PropertyObject $PropertiesObject -ResourceGroupName <RG name> -ResourceType Microsoft.Network/loadBalancers -ResourceName <load Balancer name> -ApiVersion <use the API version that get returned> -Force
```


## Дальнейшие действия

- [Общие сведения о функции "Развертывание в любом месте" и сравнение кластеров под управлением Azure](service-fabric-deploy-anywhere.md)
- [Безопасность кластера](service-fabric-cluster-security.md)
- [Пакет SDK для Service Fabric и начало работы](service-fabric-get-started.md)


<!--Image references-->
[NodeTypes]: ./media/service-fabric-cluster-nodetypes/NodeTypes.png
[Resources]: ./media/service-fabric-cluster-nodetypes/Resources.png
[InboundNatPools]: ./media/service-fabric-cluster-nodetypes/InboundNatPools.png
[LBBlade]: ./media/service-fabric-cluster-nodetypes/LBBlade.png
[NATRules]: ./media/service-fabric-cluster-nodetypes/NATRules.png
[RDP]: ./media/service-fabric-cluster-nodetypes/RDP.png

<!---HONumber=AcomDC_0518_2016-->