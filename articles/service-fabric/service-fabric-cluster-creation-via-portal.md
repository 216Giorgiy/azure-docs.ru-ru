<properties
   pageTitle="Настройка кластера Service Fabric на портале Azure | Microsoft Azure"
   description="Настройка кластера Service Fabric на портале Azure."
   services="service-fabric"
   documentationCenter=".net"
   authors="ChackDan"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="11/16/2015"
   ms.author="chackdan"/>

# Настройка кластера Service Fabric на портале Azure

На этой странице содержатся сведения, которые помогут вам настроить кластер Service Fabric. Предполагается, что ваша подписка поддерживает достаточное количество ядер для развертывания виртуальных машин IaaS, которые войдут в состав этого кластера.


## Создание кластера

1. Войдите на портал Azure [http://aka.ms/servicefabricportal](http://aka.ms/servicefabricportal).

2. Щелкните **+ Создать**, чтобы добавить новый шаблон ресурсов. Найдите наш шаблон на Marketplace в категории «Все». Он называется **Кластер Service Fabric**. Вы можете перейти к категории **Все**, выбрав категорию верхнего уровня Marketplace. Затем выполните поиск по запросу «Fabric» в категории «Все» и нажмите клавишу ВВОД. Иногда автофильтр не работает, поэтому обязательно **нажмите клавишу ВВОД**. ![SearchforServiceFabricClusterTemplate][SearchforServiceFabricClusterTemplate]

3. Выберите в списке «Кластер Service Fabric».
4. Перейдите к колонке кластера Service Fabric, щелкните **Создать** и укажите сведения о кластере.
5. Создайте **новую группу ресурсов** и присвойте ей такое же имя, как у кластера. Это облегчит дальнейший поиск. Это особенно полезно при внесении изменений в развертывание и/или удалении кластера.

  	Примечание. Хотя вы можете использовать существующую группу ресурсов, рекомендуется создать новую. Это облегчит удаление ненужных кластеров.

 	 ![CreateRG][CreateRG]


6. Выберите **подписку**, в которой вы хотите развернуть кластер, особенно при наличии нескольких подписок.

7. Выберите **расположение** в раскрывающемся списке (значение по умолчанию — Запад США).

8. Настройте **тип узла**. Тип узла можно считать эквивалентом роли в облачных службах. Он определяет размер виртуальных машин, их количество и свойства. В кластере может быть несколько типов узлов. Единственное ограничение заключается в том, что вам нужно указать хотя бы один тип узла (основной или первый из заданных на портале), который будет состоять минимум из 5 виртуальных машин.
	1. Выберите нужный размер виртуальной машины и ценовую категорию. Категория по умолчанию — «Стандартный» (D4), но если вы планируете использовать этот кластер только для тестирования приложения, можно выбрать размер виртуальной машины D2 или меньше.	
	2. Укажите количество виртуальных машин. Позднее вы сможете масштабировать это количество в типе узла, но основной или первый указанный тип узла должен иметь по крайней мере 5 виртуальных машин.
	3. Выберите имя для типа узла (от 1 до 12 буквенно-цифровых символов).	
	4. Выберите имя пользователя и пароль для удаленного рабочего стола виртуальной машины.
	5. **Рекомендации по типам узлов при наличии нескольких типов узлов**. Если вы планируете развертывание кластера с одним типом узла, перейдите к следующему шагу.

		- Чтобы объяснить эту концепцию, рассмотрим пример. Допустим, вы хотите развернуть приложение, содержащее интерфейсную службу и серверную службу. При этом интерфейсная служба должна размещаться на небольших виртуальных машинах (размера A2, D2 и т. д.) с портами, открытыми для интернет-трафика, а серверная служба, в которой выполняется основная часть вычислений, — на виртуальных машинах большего размера (D4, D6, D12 и т. д.) без выхода в Интернет.
		- Обе службы можно разместить в узле одного типа, однако рекомендуется разместить их в кластере с двумя типами узлов. Для каждого из этих типов узлов можно задать различные свойства, такие как подключение к Интернету, размер и количество виртуальных машин, которые можно масштабировать независимо друг от друга.
		- Укажите тип узла. Первоначальное количество виртуальных машин должно быть не менее 5. Для других типов узлов можно задать минимум 1 виртуальную машину.
					

  	![CreateNodeType][CreateNodeType]

9. **Порты для приложений**. Если вы планируете немедленно начать развертывание приложений в кластере, добавьте порты, которые необходимо открыть для приложений в этом типе узла (или в типах узлов, созданных вами). Порты можно добавить в тип узла позднее, изменив балансировщик нагрузки, связанный с этим типом узла (в таком случае следует создать зонд, а затем добавить его к правилам балансировщика нагрузки). Удобнее сделать это прямо сейчас, чтобы служба автоматизации портала добавила необходимые зонды и правила в балансировщик нагрузки.
	1. Порты приложений можно найти в манифестах служб, которые входят в пакет приложения. В каждом из приложений откройте манифесты служб и запишите все входные конечные точки, с помощью которых приложения обмениваются данными с внешним миром.
	2. Добавьте все порты, разделенные запятыми, в поле «Входные конечные точки приложения». Конечная точка для клиентского TCP-подключения — 19000 по умолчанию, поэтому ее указывать не нужно. Например, для моего приложения необходимо открыть порт 83. Его можно найти в файле servicemanifest.xml в пакете приложения (файлов servicemanifest.xml может быть несколько).

  В большинстве примеров приложений используются порты 80 и 8081, поэтому их необходимо добавить, если вы планируете развертывать примеры в этом кластере.

  ![порты;][Ports]



1. **Свойства размещения (необязательно)**. Параметры в этом разделе можно не настраивать, так как система автоматически добавляет стандартное свойство размещения NodeTypeName. Вы можете добавить другие свойства, если это необходимо для вашего приложения. 

  
## Настройка безопасности

В настоящее время платформа Service Fabric поддерживает защиту кластеров только с помощью сертификата X509. Перед началом этого процесса необходимо передать сертификат в хранилище ключей. Дополнительные инструкции см. в статье [Безопасность кластера Service Fabric](service-fabric-cluster-security.md).

Устанавливать защиту кластера необязательно, но мы настоятельно рекомендуем это сделать. Если вы решили не защищать кластер, переведите переключатель режима безопасности в положение «Нет».

Рекомендации и инструкции по защите кластера см. в документе [Безопасность кластера Service Fabric](service-fabric-cluster-security.md).

![SecurityConfigs][SecurityConfigs]



## Настройка диагностики (необязательно)

Диагностика в кластере включена по умолчанию. Это упрощает устранение неполадок. Если вы хотите отключить диагностику, сделайте следующее.

1. Перейдите в колонку «Конфигурация диагностики».

2. Установите выключатель состояния в положение «Выкл.».

## Параметры Fabric (необязательно)

Это дополнительный параметр, который позволяет изменять стандартные параметры кластера Service Fabric. Такие значения **не рекомендуется изменять**, если вы не уверены, что это необходимо для вашего приложения и/или кластера.

## Завершение создания кластера
Вы можете щелкнуть **Сводка**, чтобы просмотреть заданные параметры, или скачать шаблон ARM, который будет использоваться для развертывания кластера. Когда вы укажете обязательные параметры, кнопка «Создать» активируется, и вы сможете начать процесс создания кластера.
 

Ход выполнения можно просмотреть в области уведомлений (щелкните значок колокольчика возле строки состояния в правой части экрана). Если при создании кластера вы установили флажок «Закрепить на начальной панели», на начальной доске вы увидите закрепленную плитку «Развертывание кластера Service Fabric».

![Уведомления][Notifications]

## Просмотр состояния кластера

После завершения развертывания можно проверить кластер на портале.

1. Щелкните **Обзор** и выберите ресурс **Кластеры Service Fabric**.

2. Найдите нужный кластер и щелкните его.

  ![BrowseCluster][BrowseCluster]

3. На панели мониторинга отобразятся подробные сведения о кластере, включая его общедоступный IP-адрес. Обратите внимание: если навести указатель мыши на элемент **Общедоступный IP-адрес кластера**, отобразится буфер обмена, в который можно скопировать IP-адрес.

  ![ClusterDashboard][ClusterDashboard]

  В части «Монитор узла» колонки «Панель мониторинга кластера» отображается количество работоспособных и неработоспособных виртуальных машин. Дополнительные сведения о состоянии работоспособности см. в разделе [Общие сведения о наблюдении за работоспособностью системы в Service Fabric](service-fabric-health-introduction.md) нашей документации.


## Подключение к кластеру и развертывание приложения

Настроив кластер, можно подключиться к нему и начать развертывание приложений.

1. На компьютере с установленным пакетом SDK для Service Fabric запустите Windows PowerShell.

2. Выполните один из следующих наборов команд PS в зависимости от того, какой кластер создан (защищенный или незащищенный).
 

- Вариант 1. **Подключение к незащищенному кластеру** 

```powershell
Connect-serviceFabricCluster -ConnectionEndpoint <Cluster FQDN>:19000 -KeepAliveIntervalInSec 10 
```

Выполните следующие команды для развертывания приложения, заменив указанные здесь пути соответствующими значениями на своем компьютере.

 - Вариант 2. **Подключение к защищенному кластеру**

Выполните следующую команду, чтобы установить сертификат на компьютере, на котором вы собираетесь выполнять команду PS Connect-serviceFabricCluster.

```powershell
Import-PfxCertificate -Exportable -CertStoreLocation Cert:\CurrentUser\My `
            -FilePath C:\docDemo\certs\DocDemoClusterCert.pfx `
            -Password (ConvertTo-SecureString -String test -AsPlainText -Force)
```

Теперь выполните следующую команду PS, чтобы подключиться к защищенному кластеру. Сертификат имеет те же данные, которые вы указали на портале.

```powershell
Connect-serviceFabricCluster -ConnectionEndpoint <Cluster FQDN>:19000 `
            -KeepAliveIntervalInSec 10 `
            -X509Credential -ServerCertThumbprint <Certificate Thumbprint> `
            -FindType FindByThumbprint -FindValue <Certificate Thumbprint> `
            -StoreLocation CurrentUser -StoreName My
```
Например, приведенная выше команда PS должна выглядеть следующим образом.

```powershell
Connect-serviceFabricCluster -ConnectionEndpoint sfcluster4doc.westus.cloudapp.azure.com:19000 `
            -KeepAliveIntervalInSec 10 `
            -X509Credential -ServerCertThumbprint C179E609BBF0B227844342535142306F3913D6ED `
            -FindType FindByThumbprint -FindValue C179E609BBF0B227844342535142306F3913D6ED `
            -StoreLocation CurrentUser -StoreName My
```


Выполните следующие команды для развертывания приложения, заменив указанные здесь пути соответствующими значениями на своем компьютере. В приведенном ниже примере показано развертывание примера приложения для подсчета слов.

Скопируйте пакет в кластер, к которому вы подключились на предыдущем шаге.


```powershell
$applicationPath = "C:\VS2015\WordCount\WordCount\pkg\Debug"
```

```powershell
Copy-ServiceFabricApplicationPackage -ApplicationPackagePath $applicationPath -ApplicationPackagePathInImageStore "WordCount" -ImageStoreConnectionString fabric:ImageStore
````
Register your application type with service fabric.

```powershell
Register-ServiceFabricApplicationType -ApplicationPathInImageStore "WordCount" ````

Создайте новый экземпляр только что зарегистрированного типа приложения.

```powershell New-ServiceFabricApplication -ApplicationName fabric:/WordCount -ApplicationTypeName WordCount -ApplicationTypeVersion 1.0.0.0 ````

Теперь откройте любой браузер и подключитесь к конечной точке, которую прослушивает приложение. URL-адрес для моего примера приложения выглядит так:

http://sfcluster4doc.westus.cloudapp.azure.com:31000



<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## Дальнейшие действия
- [Управление приложениями Service Fabric в Visual Studio](service-fabric-manage-application-in-visual-studio.md)
- [Безопасность кластера Service Fabric](service-fabric-cluster-security.md)
- [Общие сведения о наблюдении за работоспособностью системы в Service Fabric](service-fabric-health-introduction.md)

<!--Image references-->
[SearchforServiceFabricClusterTemplate]: ./media/service-fabric-cluster-creation-via-portal/SearchforServiceFabricClusterTemplate.png
[CreateRG]: ./media/service-fabric-cluster-creation-via-portal/CreateRG.png
[CreateNodeType]: ./media/service-fabric-cluster-creation-via-portal/NodeType.png
[Ports]: ./media/service-fabric-cluster-creation-via-portal/ports.png
[SFConfigurations]: ./media/service-fabric-cluster-creation-via-portal/SFConfigurations.png
[SecurityConfigs]: ./media/service-fabric-cluster-creation-via-portal/SecurityConfigs.png
[Notifications]: ./media/service-fabric-cluster-creation-via-portal/notifications.png
[BrowseCluster]: ./media/service-fabric-cluster-creation-via-portal/browse.png
[ClusterDashboard]: ./media/service-fabric-cluster-creation-via-portal/ClusterDashboard.png
[SecureConnection]: ./media/service-fabric-cluster-creation-via-portal/SecureConnection.png

<!---HONumber=Nov15_HO4-->