<properties
   pageTitle="Создание кластера Service Fabric на портале Azure | Microsoft Azure"
   description="Создание кластера Service Fabric на портале Azure."
   services="service-fabric"
   documentationCenter=".net"
   authors="ChackDan"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="05/02/2016"
   ms.author="chackdan"/>


# Создание кластера Service Fabric на портале Azure

Эта страница поможет вам создать кластер Azure Service Fabric. Ваша подписка должна включать достаточное количество ядер для развертывания виртуальных машин IaaS, которые войдут в состав этого кластера.


## Поиск кластерных ресурсов Service Fabric

1. Войдите на [портал Azure](https://portal.azure.com/).

2. Щелкните **+ Создать**, чтобы добавить новый шаблон ресурсов. Найдите нужный шаблон в **Marketplace** в разделе **Все** — он называется **Кластер Service Fabric**.

    а. На верхнем уровне щелкните **Marketplace**.

    b. В разделе **Все** введите "Fabric" и нажмите клавишу ВВОД. Автофильтр срабатывает не всегда, поэтому обязательно нажмите клавишу ВВОД. ![Снимок экрана: поиск шаблона кластера Service Fabric на портале Azure.][SearchforServiceFabricClusterTemplate]

3. Выберите в списке **Кластер Service Fabric**.

4. Перейдите к колонке **Кластер Service Fabric** и щелкните **Создать**.

5. Отобразится колонка **Создание кластера Service Fabric**, в которой нужно выполнить 4 шага.

## Шаг 1. Основные сведения

В колонке "Основные сведения" требуется указать основные сведения для кластера.

1. Введите имя кластера.

2. Выберите **имя пользователя** и **пароль** для удаленного рабочего стола виртуальной машины.

3. Выберите **подписку**, в которой вы хотите развернуть кластер, особенно при наличии нескольких подписок.

4. Создайте **новую группу ресурсов**. Рекомендуется присвоить ей имя, совпадающее с именем кластера. Это облегчит дальнейший поиск, особенно при внесении изменений в развертывание или удалении кластера.

    >[AZURE.NOTE] Хотя вы можете использовать существующую группу ресурсов, рекомендуется создать новую. Это позволит легко удалить ненужные кластеры.

 	![Снимок экрана: создание группы ресурсов.][CreateRG]


5. Выберите **расположение** из раскрывающегося списка. Значение по умолчанию — **Западная часть США**. Нажмите кнопку ОК.

## Шаг 2. Настройка кластера

10. Сначала необходимо разобраться, что собой представляет **тип узла**. Тип узла можно считать эквивалентом роли в облачных службах. Он определяет размер виртуальных машин, их количество и свойства. Кластер может содержать узлы нескольких типов, однако основной тип узла (тот, который вы задали на портале) должен включать не менее пяти виртуальных машин. На узлах такого типа расположены системные службы Service Fabric. Чтобы определить, нужны ли вам несколько типов узлов, рассмотрите рекомендации ниже.

	* Приложение, которое вам необходимо развернуть, содержит интерфейсную и серверную службы. Интерфейсную службу нужно разместить на виртуальных машинах меньшего размера (например, D2), на которых есть порты, открытые для доступа через Интернет, а серверную службу, которая будет выполнять ресурсоемкие вычисления, — на более крупных виртуальных машинах (D4, D6, D15 и т. д.) без выхода в Интернет.

	* Лучше всего поместить эти службы в кластер с двумя типами узлов. Каждый тип узла может иметь различные свойства, такие как подключение к Интернету, размер виртуальной машины и число виртуальных машин, которые можно корректировать независимо друг от друга.

	* В первую очередь задайте тип узла, который будет включать не меньше пяти виртуальных машин. Узлы других типов должны включать как минимум по одной виртуальной машине.

13.  Чтобы настроить тип узла, выполните описанные ниже действия.

	а. Выберите имя для типа узла (от 1 до 12 буквенно-цифровых символов).

	b. Минимальный размер виртуальных машин для первичного типа узла зависит от выбранного для кластера уровня устойчивости. Значение по умолчанию для уровня устойчивости — Bronze. Дополнительные сведения о том, как выбрать уровень надежности и устойчивости кластера Service Fabric, см. в этом [документе](service-fabric-cluster-capacity.md).

	b. Выберите размер виртуальной машины и ценовую категорию. Категория по умолчанию — "Стандартный" (D4), но если вы планируете использовать этот кластер только для тестирования приложений, можно выбрать размер виртуальной машины D2 или меньше.

	c. Минимальное количество виртуальных машин для первичного типа узла зависит от выбранного для кластера уровня надежности. Значение по умолчанию для уровня надежности — Silver. Дополнительные сведения о том, как выбрать уровень надежности и устойчивости кластера Service Fabric, см. в этом [документе](service-fabric-cluster-capacity.md).

	c. Выберите количество виртуальных машин для типа узла. Количество виртуальных машин для типа узла можно увеличить или уменьшить позже, но минимальное количество виртуальных машин на первичном узле зависит от выбранного уровня надежности. Для других типов узлов можно задать минимум 1 виртуальную машину.


  	![Снимок экрана: создание типа узлов.][CreateNodeType]

9. Если вы планируете немедленно начать развертывание приложений в кластере, добавьте порты, которые необходимо открыть для приложений, в тип узла **Порты приложений** (или в созданные вами типы узлов). Порты можно добавить в тип узла позднее, изменив балансировщик нагрузки, связанный с этим типом узла (в таком случае следует создать зонд, а затем добавить его к правилам балансировщика нагрузки). Удобнее сделать это прямо сейчас, чтобы служба автоматизации портала добавила необходимые зонды и правила в балансировщик нагрузки.

	а. Порты приложений можно найти в манифестах служб, которые входят в пакет приложения. В каждом из приложений откройте манифесты служб и запишите все входные конечные точки, с помощью которых приложения обмениваются данными с внешним миром.

	b. Добавьте все порты, разделенные запятыми, в поле **Входные конечные точки приложения**. Конечная точка для клиентского TCP-подключения — 19000 по умолчанию, поэтому ее указывать не нужно. Например, для приложения WordCount из образца необходимо открыть порт 83. Его можно найти в файле servicemanifest.xml в пакете приложения (файлов servicemanifest.xml может быть несколько).

    c. В большинстве примеров приложений используются порты 80 и 8081, поэтому их необходимо добавить, если вы планируете развертывать примеры в этом кластере. ![порты;][Ports]

10. Параметры **Свойства размещения** можно не настраивать, так как система автоматически добавляет стандартное свойство размещения NodeTypeName. Если этого требует ваше приложение, можно добавить дополнительные свойства.

11. Параметры **Свойства емкости** настраивать не обязательно, но рекомендуется, так как их можно использовать в приложениях, чтобы отправлять отчеты о нагрузке в систему, тем самым оказывая влияние на решения о размещении и балансировке ресурсов, которые принимает система в кластере Service Fabric. Дополнительные сведения о балансировке ресурсов Service Fabric см. в [этом документе](service-fabric-cluster-resource-manager-architecture.md).

12. Выполните указанные выше действия для всех типов узлов.

14. Настройте **систему диагностики** кластера. Диагностика в кластере включена по умолчанию. Это упрощает устранение неполадок. Если вы хотите отключить систему диагностику, установите переключатель **Состояние** в положение **Выкл.**. Отключать систему диагностики **не** рекомендуется.

15. Можно задать дополнительный параметр **Параметры кластера Service Fabric**, который позволяет изменять стандартные настройки кластера Service Fabric. Такие значения не рекомендуется изменять, если вы не уверены, что это необходимо для вашего приложения или кластера.

## Шаг 3. Настройка безопасности

Сценарии защиты и основные понятия безопасности см. в документе [Защита кластера Service Fabric](service-fabric-cluster-security.md). В настоящее время Service Fabric поддерживает защиту кластеров только с помощью сертификатов X.509. Инструкции о том, как это сделать, см. в разделе [Защита кластера Service Fabric в Azure с помощью сертификатов](service-fabric-secure-azure-cluster-with-certs.md).

Устанавливать защиту кластера необязательно, но мы настоятельно рекомендуем это сделать. Если вы решили не защищать кластер, установите переключатель **Режим безопасности** в положение **Небезопасное**. Обратите внимание, что в дальнейшем вы **не** сможете изменить эти настройки таким образом, чтобы кластер стал защищенным.

![Снимок экрана: настройка безопасности на портале Azure.][SecurityConfigs]


## Шаг 4. Завершение создания кластера

Чтобы завершить создание кластера, щелкните **Сводка** и проверьте указанные параметры или скачайте шаблон Azure Resource Manager, который будет использоваться для развертывания кластера. Когда вы укажете обязательные параметры, активируется кнопка **ОК**, нажав которую вы сможете начать процесс создания кластера.

Ход создания кластера будет отображаться в области уведомлений. (Щелкните значок колокольчика рядом со строкой состояния в правом верхнем углу экрана.) Если при создании кластера вы установили флажок **Закрепить на начальной панели**, на **начальной доске** вы увидите закрепленный элемент **Развертывание кластера Service Fabric**.

![Снимок экрана: начальная доска с заголовком "Развертывание кластера Service Fabric".][Notifications]

## Просмотр состояния кластера

После создания кластера его можно просмотреть на портале.

1. Щелкните **Обзор** и выберите **Кластеры Service Fabric**.

2. Найдите нужный кластер и щелкните его.
 ![Снимок экрана: поиск кластера на портале.][BrowseCluster]

3. На панели мониторинга отобразятся подробные сведения о кластере, включая его общедоступный IP-адрес. Если навести указатель мыши на элемент **Cluster Public IP Address** (Общедоступный IP-адрес кластера), отобразится буфер обмена, в который можно скопировать IP-адрес. ![Снимок экрана: сведения о кластере на панели мониторинга.][ClusterDashboard]

  В разделе **Node Monitor** (Монитор узла) колонки панели мониторинга кластера отображается количество работоспособных и неработоспособных виртуальных машин. Дополнительные сведения о состоянии работоспособности кластеров см. в статье [Общие сведения о наблюдении за работоспособностью системы в Service Fabric](service-fabric-health-introduction.md).

>[AZURE.NOTE] Для постоянной работы кластеров Service Fabric требуется определенное количество узлов, чтобы все время поддерживать доступность и сохранять состояние, которое называется "поддержание кворума". Поэтому обычно не рекомендуется завершать работу всех виртуальных машин в кластере, пока не будет выполнена [полная архивация состояния](service-fabric-reliable-services-backup-restore.md), так как это может быть небезопасно.

## Подключение к кластеру и развертывание приложения

Завершив настройку кластера, вы можете к нему подключиться и начать развертывание приложений. Для начала запустите Windows PowerShell на компьютере с установленным пакетом SDK для Service Fabric. Затем, чтобы установить подключение к кластеру, выполните один из следующих наборов команд PowerShell в зависимости от того, какой кластер вы создали (защищенный или незащищенный):

### Подключение к незащищенному кластеру

```
powershell
Connect-serviceFabricCluster -ConnectionEndpoint <Cluster FQDN>:19000 -KeepAliveIntervalInSec 10
```

### Безопасное подключение к кластеру

1. Выполните следующую команду, чтобы установить сертификат на компьютере, на котором вы собираетесь выполнять команду PowerShell Connect-serviceFabricCluster.

    ```powershell
    Import-PfxCertificate -Exportable -CertStoreLocation Cert:\CurrentUser\My `
            -FilePath C:\docDemo\certs\DocDemoClusterCert.pfx `
            -Password (ConvertTo-SecureString -String test -AsPlainText -Force)
    ```

2. Для подключения к защищенному кластеру выполните следующую команду PowerShell: Сертификат имеет те же данные, которые вы указали на портале.

    ```powershell
    Connect-serviceFabricCluster -ConnectionEndpoint <Cluster FQDN>:19000 `
              -KeepAliveIntervalInSec 10 `
              -X509Credential -ServerCertThumbprint <Certificate Thumbprint> `
              -FindType FindByThumbprint -FindValue <Certificate Thumbprint> `
              -StoreLocation CurrentUser -StoreName My
    ```

    Например, приведенная выше команда PowerShell должна выглядеть следующим образом:

    ```powershell
    Connect-serviceFabricCluster -ConnectionEndpoint sfcluster4doc.westus.cloudapp.azure.com:19000 `
              -KeepAliveIntervalInSec 10 `
              -X509Credential -ServerCertThumbprint C179E609BBF0B227844342535142306F3913D6ED `
              -FindType FindByThumbprint -FindValue C179E609BBF0B227844342535142306F3913D6ED `
              -StoreLocation CurrentUser -StoreName My
    ```

### Развертывание приложения
Установив подключение, выполните следующие команды для развертывания приложения, заменив указанные здесь пути соответствующими значениями на своем компьютере. В приведенном ниже примере показано развертывание примера приложения для подсчета слов:

1. Скопируйте пакет в кластер, к которому вы подключились ранее.

    ```
    powershell
    $applicationPath = "C:\VS2015\WordCount\WordCount\pkg\Debug"
    ```

    ```powershell
    Copy-ServiceFabricApplicationPackage -ApplicationPackagePath $applicationPath -ApplicationPackagePathInImageStore "WordCount" -ImageStoreConnectionString fabric:ImageStore
    ```
2. Зарегистрируйте свой тип приложения в Service Fabric.

    ```
    powershell
    Register-ServiceFabricApplicationType -ApplicationPathInImageStore "WordCount"
    ```

3. Создайте новый экземпляр только что зарегистрированного типа приложения.

    ```
    powershell
    New-ServiceFabricApplication -ApplicationName fabric:/WordCount -ApplicationTypeName WordCount -ApplicationTypeVersion 1.0.0.0
    ```

4. Теперь откройте любой браузер и подключитесь к конечной точке, которую прослушивает приложение. URL-адрес приложения WordCount из образца выглядит следующим образом:

    http://sfcluster4doc.westus.cloudapp.azure.com:31000

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->

## Удаленное подключение к экземпляру из набора масштабирования виртуальных машин или узлу кластера

Каждый из типов NodeType, задаваемый в кластере, отражается на конфигурации масштабируемого набора ВМ. Дополнительные сведения см. в разделе [Удаленное подключение к экземпляру масштабируемого набора ВМ или узлу кластера](service-fabric-cluster-nodetypes.md#remote-connect-to-a-vm-scale-set-instance-or-a-cluster-node).

## Дальнейшие действия

После создания кластера вы можете узнать больше о защите и развертывании приложений:
- [Управление приложениями Service Fabric в Visual Studio](service-fabric-manage-application-in-visual-studio.md)
- [Защита кластера Service Fabric](service-fabric-cluster-security.md)
- [Общие сведения о наблюдении за работоспособностью системы в Service Fabric](service-fabric-health-introduction.md)


<!--Image references-->
[SearchforServiceFabricClusterTemplate]: ./media/service-fabric-cluster-creation-via-portal/SearchforServiceFabricClusterTemplate.png
[CreateRG]: ./media/service-fabric-cluster-creation-via-portal/CreateRG.png
[CreateNodeType]: ./media/service-fabric-cluster-creation-via-portal/NodeType.png
[Ports]: ./media/service-fabric-cluster-creation-via-portal/ports.png
[SFConfigurations]: ./media/service-fabric-cluster-creation-via-portal/SFConfigurations.png
[SecurityConfigs]: ./media/service-fabric-cluster-creation-via-portal/SecurityConfigs.png
[Notifications]: ./media/service-fabric-cluster-creation-via-portal/notifications.png
[BrowseCluster]: ./media/service-fabric-cluster-creation-via-portal/browse.png
[ClusterDashboard]: ./media/service-fabric-cluster-creation-via-portal/ClusterDashboard.png
[SecureConnection]: ./media/service-fabric-cluster-creation-via-portal/SecureConnection.png

<!---HONumber=AcomDC_0622_2016-->