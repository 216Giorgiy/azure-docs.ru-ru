<properties
   pageTitle="Создание кластера Service Fabric на портале Azure | Microsoft Azure"
   description="Создание кластера Service Fabric на портале Azure."
   services="service-fabric"
   documentationCenter=".net"
   authors="ChackDan"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="01/29/2016"
   ms.author="chackdan"/>


# Создание кластера Service Fabric на портале Azure

Эта страница поможет вам создать кластер Azure Service Fabric. Ваша подписка должна включать достаточное количество ядер для развертывания виртуальных машин IaaS, которые войдут в состав этого кластера.


## Создание кластера

1. Войдите на [портал Azure](https://portal.azure.com/).

2. Щелкните **+ Создать**, чтобы добавить новый шаблон ресурсов. Найдите нужный шаблон в **Marketplace** в разделе **Все** — он называется **Кластер Service Fabric**.

    а. На верхнем уровне щелкните **Marketplace**.

    b. В разделе **Все** щелкните **Fabric** и нажмите клавишу ВВОД. Автофильтр срабатывает не всегда, поэтому обязательно нажмите клавишу ВВОД. ![Снимок экрана: поиск шаблона кластера Service Fabric на портале Azure.][SearchforServiceFabricClusterTemplate]

3. Выберите в списке **Кластер Service Fabric**.

4. Перейдите к колонке **Кластер Service Fabric**, щелкните **Создать** и укажите данные кластера.

5. В разделе **Создание группы ресурсов** укажите имя для группы ресурсов, совпадающее с именем кластера. Так вы сможете найти эту группу, если захотите внести изменения в развертывание или удалить кластер.

    >[AZURE.NOTE] Хотя вы можете использовать существующую группу ресурсов, рекомендуется создать новую. Это позволит легко удалить ненужные кластеры.

 	![Снимок экрана: создание группы ресурсов.][CreateRG]

6. Выберите **подписку**, в которой вы хотите развернуть кластер, особенно при наличии нескольких подписок.

7. Выберите **Расположение** из раскрывающегося списка. Значение по умолчанию — **западная часть США**.

8. Настройте **тип узла**. Тип узла можно считать эквивалентом роли в облачных службах. Он определяет размер виртуальных машин, их количество и свойства. Кластер может содержать узлы нескольких типов, однако основной тип узла (тот, который вы задали на портале) должен включать не менее пяти виртуальных машин. Чтобы настроить тип узла, выполните описанные ниже действия.

	а. Выберите нужный размер виртуальной машины и ценовую категорию. Категория по умолчанию — "Стандартный" (D4), но если вы планируете использовать этот кластер только для тестирования приложений, можно выбрать размер виртуальной машины D2 или меньше.

	b. Укажите количество виртуальных машин. Позднее вы сможете увеличить или уменьшить это значение в типе узла, однако первый тип узла должен включать не меньше пяти виртуальных машин.

	c. Выберите имя для типа узла (от 1 до 12 буквенно-цифровых символов).

	г) Выберите **имя пользователя** и **пароль** для удаленного рабочего стола виртуальной машины.

	д. Если в кластере должно быть несколько типов узлов, обратите внимание на следующие моменты. (Если вы планируете развернуть кластер с одним типом узла, перейдите к шагу 9.)

	* Предположим, что вы хотите развернуть приложение, содержащее клиентскую и серверную службы. Вы собираете установить клиентскую службу на виртуальные машины меньшего размера (A2, D2 и т. п.) с портами, открытыми для доступа через Интернет. Серверную службу, которая будет выполнять вычисления, вы планируете разместить на более крупных виртуальных машинах (D4, D6, D12 и т. п.) без доступа через Интернет.

	* Лучше всего поместить эти службы в кластер с двумя типами узлов. Каждый тип узла может иметь различные свойства, такие как подключение к Интернету, размер виртуальной машины и число виртуальных машин, которые можно корректировать независимо друг от друга.

	* В первую очередь задайте тип узла, который будет включать не меньше пяти виртуальных машин. Узлы других типов должны включать как минимум по одной виртуальной машине.

  	![Снимок экрана: создание типа узлов.][CreateNodeType]

9. Если вы планируете немедленно начать развертывание приложений в кластере, добавьте порты, которые необходимо открыть для приложений, в тип узла **Порты приложений** (или в созданные вами типы узлов). Порты можно добавить в тип узла позднее, изменив балансировщик нагрузки, связанный с этим типом узла (в таком случае следует создать зонд, а затем добавить его к правилам балансировщика нагрузки). Удобнее сделать это прямо сейчас, чтобы служба автоматизации портала добавила необходимые зонды и правила в балансировщик нагрузки.

	а. Порты приложений можно найти в манифестах служб, которые входят в пакет приложения. В каждом из приложений откройте манифесты служб и запишите все входные конечные точки, с помощью которых приложения обмениваются данными с внешним миром.

	b. Добавьте все порты, разделенные запятыми, в поле **Входные конечные точки приложения**. Конечная точка для клиентского TCP-подключения — 19000 по умолчанию, поэтому ее указывать не нужно. Например, для приложения WordCount из образца необходимо открыть порт 83. Его можно найти в файле servicemanifest.xml в пакете приложения (файлов servicemanifest.xml может быть несколько).

    c. В большинстве примеров приложений используются порты 80 и 8081, поэтому их необходимо добавить, если вы планируете развертывать примеры в этом кластере. 
    ![порты;][Ports]

10. Параметры **Свойства размещения** можно не настраивать, так как система автоматически добавляет стандартное свойство размещения NodeTypeName. Если этого требует ваше приложение, можно добавить дополнительные свойства.

## Настройка безопасности

В настоящее время платформа Service Fabric поддерживает защиту кластеров только с помощью сертификата X509. Перед началом этого процесса необходимо передать сертификат в хранилище ключей. Дополнительные сведения о получении этих данных см. в статье [Безопасность кластера Service Fabric](service-fabric-cluster-security.md).

Устанавливать защиту кластера необязательно, но мы настоятельно рекомендуем это сделать. Если вы решили не защищать кластер, переведите переключатель **режима безопасности** в положение **Нет**.

Рекомендации и инструкции по защите кластеров см. в документе [Безопасность кластера Service Fabric](service-fabric-cluster-security.md).

![Снимок экрана: настройка безопасности на портале Azure.][SecurityConfigs]

## (Необязательно) Настройка диагностики

Диагностика в кластере включена по умолчанию. Это упрощает устранение неполадок. Если вы хотите отключить диагностику, сделайте следующее.

1. Перейдите в колонку **Конфигурация диагностики**.

2. Установите выключатель **состояния** в положение **Выкл**.

## (Необязательно) Настройка параметров кластера Service Fabric

Это дополнительный параметр, который позволяет изменять стандартные параметры кластера Service Fabric. Такие значения не рекомендуется изменять, если вы не уверены, что это необходимо для вашего приложения или кластера.

## Завершение создания кластера

Чтобы завершить создание кластера, щелкните **Сводка** и проверьте указанные параметры или загрузите шаблон диспетчера ресурсов Azure, который будет использоваться для развертывания кластера. Когда вы укажете обязательные параметры, активируется кнопка **Создать**, щелкнув которую вы сможете начать процесс создания кластера.

Ход создания кластера будет отображаться в области уведомлений. (Щелкните значок колокольчика рядом со строкой состояния в правом верхнем углу экрана.) Если при создании кластера вы установили флажок **Закрепить на начальной панели**, на **начальной** доске вы увидите закрепленную плитку **Развертывание кластера Service Fabric**.

![Снимок экрана: начальная доска с заголовком "Развертывание кластера Service Fabric".][Notifications]

## Просмотр состояния кластера

После завершения развертывания можно проверить кластер на портале.

1. Щелкните **Обзор**, а затем **Кластеры Service Fabric**.

2. Найдите нужный кластер и щелкните его. ![Снимок экрана: поиск кластера на портале.][BrowseCluster]

3. На панели мониторинга отобразятся подробные сведения о кластере, включая его общедоступный IP-адрес. Если навести указатель мыши на элемент **Общедоступный IP-адрес кластера**, отобразится буфер обмена, в который можно скопировать IP-адрес. ![Снимок экрана: сведения о кластере на панели мониторинга.][ClusterDashboard]

  В разделе **Монитор узла** панели мониторинга кластера отображается количество работоспособных и неработоспособных виртуальных машин. Дополнительные сведения о состоянии работоспособности кластеров см. в статье [Общие сведения о наблюдении за работоспособностью системы в Service Fabric](service-fabric-health-introduction.md).

## Подключение к кластеру и развертывание приложения

Завершив настройку кластера, вы можете к нему подключиться и начать развертывание приложений. Для начала запустите Windows PowerShell на компьютере с установленным пакетом SDK для Service Fabric. Затем, чтобы установить подключение к кластеру, выполните один из следующих наборов команд PowerShell в зависимости от того, какой кластер вы создали (защищенный или незащищенный):

- Вариант 1. Подключение к незащищенному кластеру.

    ```powershell
    Connect-serviceFabricCluster -ConnectionEndpoint <Cluster FQDN>:19000 -KeepAliveIntervalInSec 10
    ```

- Вариант 2. Подключение к защищенному кластеру.

    1. Выполните следующую команду, чтобы установить сертификат на компьютере, на котором вы собираетесь выполнять команду PowerShell Connect-serviceFabricCluster.

        ```powershell
        Import-PfxCertificate -Exportable -CertStoreLocation Cert:\CurrentUser\My `
                -FilePath C:\docDemo\certs\DocDemoClusterCert.pfx `
                -Password (ConvertTo-SecureString -String test -AsPlainText -Force)
        ```

    2. Для подключения к защищенному кластеру выполните следующую команду PowerShell: Сертификат имеет те же данные, которые вы указали на портале.

        ```powershell
        Connect-serviceFabricCluster -ConnectionEndpoint <Cluster FQDN>:19000 `
                  -KeepAliveIntervalInSec 10 `
                  -X509Credential -ServerCertThumbprint <Certificate Thumbprint> `
                  -FindType FindByThumbprint -FindValue <Certificate Thumbprint> `
                  -StoreLocation CurrentUser -StoreName My
        ```

        Например, приведенная выше команда PowerShell должна выглядеть следующим образом:

        ```powershell
        Connect-serviceFabricCluster -ConnectionEndpoint sfcluster4doc.westus.cloudapp.azure.com:19000 `
                  -KeepAliveIntervalInSec 10 `
                  -X509Credential -ServerCertThumbprint C179E609BBF0B227844342535142306F3913D6ED `
                  -FindType FindByThumbprint -FindValue C179E609BBF0B227844342535142306F3913D6ED `
                  -StoreLocation CurrentUser -StoreName My
        ```

Установив подключение, выполните следующие команды для развертывания приложения, заменив указанные здесь пути соответствующими значениями на своем компьютере. В приведенном ниже примере показано развертывание примера приложения для подсчета слов:

1. Скопируйте пакет в кластер, к которому вы подключились ранее.

    ```powershell
    $applicationPath = "C:\VS2015\WordCount\WordCount\pkg\Debug"
    ```

    ```powershell
    Copy-ServiceFabricApplicationPackage -ApplicationPackagePath $applicationPath -ApplicationPackagePathInImageStore "WordCount" -ImageStoreConnectionString fabric:ImageStore
    ```
2. Зарегистрируйте свой тип приложения в Service Fabric.

    ```powershell
    Register-ServiceFabricApplicationType -ApplicationPathInImageStore "WordCount"
    ```

3. Создайте новый экземпляр только что зарегистрированного типа приложения.

    ```powershell
    New-ServiceFabricApplication -ApplicationName fabric:/WordCount -ApplicationTypeName WordCount -ApplicationTypeVersion 1.0.0.0
    ```

4. Теперь откройте любой браузер и подключитесь к конечной точке, которую прослушивает приложение. URL-адрес приложения WordCount из образца выглядит следующим образом:

    http://sfcluster4doc.westus.cloudapp.azure.com:31000

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->

## Дальнейшие действия

- [Управление приложениями Service Fabric в Visual Studio](service-fabric-manage-application-in-visual-studio.md)
- [Защита кластера Service Fabric](service-fabric-cluster-security.md)
- [Общие сведения о наблюдении за работоспособностью системы в Service Fabric](service-fabric-health-introduction.md)

<!--Image references-->
[SearchforServiceFabricClusterTemplate]: ./media/service-fabric-cluster-creation-via-portal/SearchforServiceFabricClusterTemplate.png
[CreateRG]: ./media/service-fabric-cluster-creation-via-portal/CreateRG.png
[CreateNodeType]: ./media/service-fabric-cluster-creation-via-portal/NodeType.png
[Ports]: ./media/service-fabric-cluster-creation-via-portal/ports.png
[SFConfigurations]: ./media/service-fabric-cluster-creation-via-portal/SFConfigurations.png
[SecurityConfigs]: ./media/service-fabric-cluster-creation-via-portal/SecurityConfigs.png
[Notifications]: ./media/service-fabric-cluster-creation-via-portal/notifications.png
[BrowseCluster]: ./media/service-fabric-cluster-creation-via-portal/browse.png
[ClusterDashboard]: ./media/service-fabric-cluster-creation-via-portal/ClusterDashboard.png
[SecureConnection]: ./media/service-fabric-cluster-creation-via-portal/SecureConnection.png

<!---HONumber=AcomDC_0204_2016-->