<properties
   pageTitle="Основные сведения о микрослужбах | Microsoft Azure"
   description="Общие сведения о том, почему разработка облачных приложений с применением подхода с использованием микрослужб важна для современной разработки приложений и как платформа Azure Service Fabric позволяет достичь этой цели"
   services="service-fabric"
   documentationCenter=".net"
   authors="msfussell"
   manager="timlt"
   editor="bscholl"/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="11/18/2015"
   ms.author="mfussell"/>

# Разработка приложений с использованием микрослужб
При разработке приложений разработчики программного обеспечения все еще полагаются на необходимость разбивать их на составные части. Это основная парадигма объектного ориентирования, абстракций программного обеспечения и разбиения на компоненты. Сейчас такое разделение принимает форму классов и интерфейсов между общими библиотеками и уровнями технологий. Обычно оно выражается в разбивке на уровни: серверное хранилище, бизнес-логика среднего уровня и внешний пользовательский интерфейс. За последние несколько лет изменилось лишь то, что разработчики стали создавать распределенные приложения для облака, управляемого организацией.

Некоторые бизнес-потребности быстро меняются. К ним относятся:

- необходимость создания и использования масштабируемой службы для увеличения охвата клиентов, например для выхода в новые географические регионы или без необходимости развертывания в местоположении клиента;
- ускоренное предоставление функций и возможностей для обеспечения гибкости реагирования на запросы клиентов;
- более эффективное использование ресурсов, позволяющее снизить затраты.

*Способ* разработки приложений зависит от этих бизнес-потребностей.

## Подходы к разработке приложений: монолитные приложения и приложения, состоящие из микрослужб
По прошествии времени все приложения развиваются. Успешные приложения развиваются за счет использования. Неудачные приложения не развиваются и в конечном счете устаревают. Вопрос состоит в следующем: какие требования вы выдвигаете к приложениям сегодня и как они могут повлиять на приложения в будущем? Например, при создании приложения формирования отчетов с кратковременным сроком существования для подразделения организации, которое будет использоваться исключительно в ее пределах, и при создании, например, службы для предоставления видеоматериалов десяткам миллионов клиентов используются разные подходы. Иногда внедрение чего-либо на практике для тестирования концепции служит определяющим фактором при понимании того, что позже приложение можно переработать. Но перерабатывать то, что никогда не используется, совсем нецелесообразно. Таков обычный компромисс при разработке приложений. С другой стороны, если в компании зашла речь о разработке для облака, предполагаемые цели — рост и использование. Проблема состоит в том, что рост и масштаб достаточно сложно предсказать, и поэтому требуется быстро разрабатывать прототипы, но в то же время быть уверенными, что все это может привести к успеху в будущем. Подход, который применяют небольшие новые компании, — разработка, измерение, анализ данных, повторение всего цикла.

В эпоху клиент-серверной архитектуры разработчики создавали многоуровневые приложения с использованием определенных технологий на каждом уровне. Потом возник термин «монолитные» приложения, так как интерфейсы находились как бы между уровнями, а на самом уровне, как правило, компоненты были более тесно связаны, т. е. при разработке и разделении классы компилировались в библиотеки, а библиотеки объединялись в несколько исполняемых файлов и библиотеки DLL. Использование принципа монолитности при разработке приложений дает определенные преимущества. Такие приложения не требуют больших усилий при проектировании, вызовы между компонентами осуществляются быстрее за счет применения механизма межпроцессного взаимодействия, все могут тестировать один продукт, за счет чего обеспечивается эффективное использование человеческих ресурсов. Недостатки такого подхода: тесная связь компонентов приложения в слоях, невозможность масштабирования отдельных компонентов, а также то, что при необходимости выполнения исправлений или обновлений нужно подождать, пока другие завершат тестирование. Таким образом, обеспечение гибкости усложняется.

Микрослужбы позволяют устранить эти недостатки и добиться более точного соответствия бизнес-требованиям, описанным выше. Но они также обладают своими преимуществами и недостатками. Преимущества микрослужб состоят в том, что обычно каждая из них включает в себя простые бизнес-функции, а также поддерживает возможность независимого вертикального масштабирования, тестирования, развертывания и управления. Основное преимущество такого подхода заключается в том, что команды разработчиков, как правило, уделяют больше внимание бизнес-сценариям, а не технологиям, что рекомендуется при разработке многоуровневых приложений. На практике это означает, что небольшие команды разрабатывают микрослужбу на основе сценария клиента, используя при этом любые технологии. Другими словами, организации не требуется стандартизировать технологии для поддержки своих монолитных приложений, а отдельные команды, владеющие службами, могут делать то, что они считают целесообразным, исходя из собственных знаний или подходящих действий, требующихся для задачи, которую пытается решить эта служба. Конечно, на практике предпочтительнее использовать набор рекомендуемых технологий, например при выборе конкретного хранилища NoSQL или платформы веб-приложений. Использование микрослужб связано и с некоторыми недостатками, например управление большим числом отдельных сущностей, работа с более сложными развертываниями и необходимость управления версиями, а также повышение объема сетевого трафика между микрослужбами и вытекающие из этого сетевые задержки. Большое количество избыточных детализированных служб — отличный рецепт для снижения производительности. Отсутствие средств выявления этих зависимостей усложняет возможность обзора системы в целом. В конечном счете микрослужбы становятся полезными благодаря применению стандартов, а не контрактов, которым нужно неукоснительно следовать, т. е. составляются правила обмена данными и учитываются только те задачи, которые должна выполнять служба. Поэтому при разработке эти связи нужно определить заранее, так как службы будут обновляться независимо друг от друга. При разработке приложений с использованием микрослужб выделяется еще одна характеристика — «детализированная сервисноориентированная архитектура».


***В самом простом понимании при разработке с использованием микрослужб применяются несвязанные федерации служб с возможностью независимых изменений каждой из них и согласованные стандарты для обмена данными.***


По мере создания дополнительных облачных приложений все больше людей осознают, что такая декомпозиция всего приложения на отдельные службы, ориентированные на сценарии, представляет собой лучший подход в долгосрочной перспективе.
## Сравнение подходов к разработке приложений

![Платформа Service Fabric][Image1]

1\. Монолитные приложения обладают функциональными возможностями домена и обычно делятся на функциональные уровни, например сеть, бизнес и данные.

2\. Такие приложения масштабируются путем клонирования на нескольких серверах, в виртуальных машинах или контейнерах.

3\. В приложениях, состоящих из микрослужб, функциональные возможности распределены по отдельным службам меньшего размера.

4\. Такие приложения масштабируются путем развертывания каждой службы независимо друг от друга и создания экземпляров этих служб на серверах, в виртуальных машинах и контейнерах.


Использование микрослужб при разработке — не универсальный подход. Но он позволяет достичь более точного соответствия бизнес-целям, описанным выше. Применить монолитный подход также можно, если известно, что позже при необходимости можно будет переработать код и использовать его для создания микрослужб. Но чаще всего разработчики создают монолитное приложение, а затем медленно поэтапно изменяют его, начиная с функциональных областей, в которых следует увеличить масштабируемость и гибкость.

Итак, в основе подхода с использованием микрослужб лежит составление приложения из множества мелких служб, работающих в контейнерах, которые развернуты в кластере компьютеров. При этом подходе каждую службу разрабатывает небольшая команда, ориентированная на сценарии, а тестирование, управление версиями, развертывание и масштабирование выполняется в каждой службе отдельно, чтобы позволить развиться приложению в целом.

## Что такое микрослужба

Существуют различные определения микрослужб. В Интернете можно найти множество хороших ресурсов, в которых представлены различные точки зрения и определения. Можно выделить следующие общие характеристики.

- Инкапсуляция сценария клиента или бизнес-сценария. Какую проблему требуется решить?
- Разработка небольшими командами разработчиков
- Возможность написания кода на любом языке программирования и использования любой платформы 
- Составляющие компоненты включают в себя код и при необходимости состояние, которые можно развертывать и масштабировать, а также управлять их версиями независимо друг от друга
- Взаимодействие с другими микрослужбами с применением четко определенных интерфейсов и протоколов 
- Уникальное имя (URL-адрес), которое можно использовать для распознавания расположения
- Стабильность работы и доступность в случае сбоя

Эти характеристики можно объединить в следующее определение:

***приложения, состоящие из микрослужб, состоят из небольших ориентированных на клиента служб с независимым управлением версиями и масштабированием, которые взаимодействуют по стандартным протоколам с применением четко определенных интерфейсов.***


Первые два пункта из списка выше рассмотрены в предыдущем разделе. В следующих разделах мы более подробно рассмотрим остальные.

### Возможность написания кода на любом языке программирования и использования любой платформы
Разработчики могут выбирать необходимые язык или платформу в зависимости от своих навыков или потребностей службы. В некоторых службах имеют значение преимущества производительности, обеспечиваемые языком C++, тогда как в других большую роль играет простота управляемой разработки на языке C# или Java. В некоторых случаях может потребоваться использовать определенные сторонние библиотеки, технологии хранилища данных или средства предоставления службы клиентам.

Выбрав технологию, можно перейти к управлению процессами или жизненным циклом службы и ее масштабированию.

### Код и состояние, которые можно развертывать и масштабировать, а также управлять их версиями независимо друг от друга  

Независимо от языка программирования микрослужбы каждую из них следует развертывать, обновлять и масштабировать отдельно для кода и при необходимости для состояния. На самом деле, эту проблему сложно решить, так как она сводится к выбору технологий и (для масштабирования) пониманию того, как следует осуществлять разделение (или сегментирование) для кода и состояния. Если в коде и состоянии используются разные технологии (а на сегодняшний день именно так и происходит), в сценариях развертывания микрослужбы должна быть предусмотрена возможность масштабирования и кода, и состояния. Кроме того, следует учитывать гибкость и динамичность использования, благодаря которым можно обновить некоторые микрослужбы одновременно. Ненадолго вернемся к сравнению двух подходов при разработке приложений. На приведенной ниже схеме показаны различия в подходах к хранению данных о состоянии.

### Различия в хранении данных о состоянии в двух подходах к разработке приложений
![Платформа Service Fabric][Image2]

***Слева представлен монолитный подход с отдельной базой данных и уровнями определенных технологий.***

***Справа представлен подход с использованием микрослужб. На рисунке изображена схема взаимосвязанных микрослужб, где состояние обычно ограничивается отдельной микрослужбой и используются различные технологии.***

В монолитном подходе приложение, как правило, использует отдельную базу данных. Преимущество — единое местоположение, что упрощает развертывание. У каждого компонента может быть одна таблица для хранения данных о состоянии. Сложность состоит в том, что командам разработчиков необходимо строго разграничивать состояния. Кроме того, обязательно появится соблазн просто добавить новый столбец в существующую таблицу клиента, объединить таблицы и создавать зависимости на уровне хранилища. После этого масштабирование отдельных компонентов станет непредсказуемым. При использовании подхода с применением микрослужб каждая служба управляет собственным состоянием и хранит собственные данные о нем. Это означает, что она отвечает за масштабирование кода и состояния для обеспечения соответствия собственным требованиям. Недостаток этого подхода заключается в необходимости создавать представления данных приложения или запросы на их основе, которая вытекает из необходимости запрашивать эти разрозненные хранилища состояний. Как правило, эту проблему можно решить, использовав отдельную микрослужбу, которая создает представление коллекции микрослужб. Если нужно выполнить несколько нерегламентированных запросов данных, в каждой микрослужбе должна предусматриваться возможность записи данных в службу хранилища данных для применения в автономной аналитике.


Управление версиями осуществляется на основе развернутой версии микрослужбы и является обязательным для обеспечения параллельного развертывания и взаимодействия нескольких различных версий. Управление версиями применяется при сбое более новой версии микрослужбы во время обновления и необходимости отката к предыдущей версии. Управление версиями также применяется при A/B-тестировании, при котором разные пользователи используют разные версии службы. Например, микрослужбы часто обновляют для определенной группы клиентов, которые тестируют новые функциональные возможности, прежде чем развертывать их для широкой аудитории. Рассмотрев управление жизненным циклом микрослужб, можно перейти к их взаимодействию.


### Взаимодействие с другими микрослужбами с применением четко определенных интерфейсов и протоколов

Обширная литература по сервисноориентированной архитектуре, опубликованная за последние 10 лет, раскрывает эту тему почти полностью, так как большая ее часть предназначалась для шаблонов взаимодействия. Сегодня, как правило, все сводится к использованию REST, протоколов HTTP и TCP, а также формата сериализации XML или JSON. С точки зрения интерфейса используется подход веб-дизайна. Но вы также можете применять двоичные протоколы или собственные форматы данных. Просто будьте готовы к тому, что в таком случае вашими микрослужбами (если они появятся в открытом доступе) будет сложнее пользоваться.

### Уникальное имя (URL-адрес), которое можно использовать для распознавания расположения

Почему же микрослужба похожа на сеть? Как и к сети, к микрослужбе нужно обращаться во время ее работы. Если думать только о компьютерах и о том, на каком из них выполняется определенная микрослужба, все быстро пойдет наперекосяк. Микрослужба должна иметь уникальное имя, позволяющее обнаружить ее расположение, подобно тому, как DNS разрешает URL-адрес для конкретного компьютера. Таким образом, микрослужбам требуются адресуемые имена, которые делают их независимыми от инфраструктуры, под управлением которой они работают. Конечно, это значит, что существует связь между развертыванием службы и ее обнаружением, исходя из необходимости наличия реестра службы. Подобным образом должна существовать связь между сбоем компьютера и тем, как он влияет на микрослужбу, чтобы предоставить службе реестра возможность определить расположение микрослужбы. На этом этапе мы можем перейти к следующему разделу, в котором рассматривается устойчивость и стабильность работы.
 
### Стабильность работы и доступность в случае сбоя

Устранение неожиданных сбоев — одна из проблем, которую сложнее всего решить, особенно в распределенной системе. Основная часть кода, который пишут разработчики, ориентирована на обработку исключений. Этому аспекту также уделяется большая часть времени при тестировании. Но решение проблемы намного сложнее, чем просто написать код, позволяющий исправить ошибки. Что случится при сбое компьютера, на котором запущена микрослужба? В этом случае потребуется не только определить сбой микрослужбы (а это проблема, которую трудно решить саму по себе), но и найти способ ее перезапуска. Для обеспечения доступности микрослужба должна быть устойчива к сбоям и в ней должна предусматриваться возможность частого перезапуска на другом компьютере. Кроме того, учитывается состояние, сохраненное микрослужбой, откуда его можно восстановить и то, есть ли вообще возможность успешного перезапуска. Другими словами, важна как устойчивость к сбоям в вычислениях (т. е. возможность перезапуска процесса), так и устойчивость к сбоям в состоянии или устойчивость к ошибкам в данных (отсутствие потери данных и их согласованность).

В других сценариях, например при сбое во время обновления приложения, может возникнуть сразу несколько проблем устойчивости. Для обеспечения согласованности микрослужбам, работающим с системой развертывания, необходимо не только восстановиться, но и определить дальнейшие действия — возможен ли переход к новой версии или нужно выполнить откат к предыдущей версии. Кроме того, следует учитывать такие вопросы: достаточно ли компьютеров для последующего обновления и как восстановить предыдущие версии микрослужбы. Для принятия решений на основе ответов на эти вопросы требуется, чтобы микрослужба могла передавать информацию о состоянии.

### Передача информации о работоспособности и диагностических данных

Крайне важно, чтобы микрослужба передавала информацию о работоспособности и диагностические данные. В противном случае будет невозможно получить достаточно сведений о ходе процессов в микрослужбе. Но зачастую этому кажущемуся очевидным моменту уделяется недостаточно внимания. Сложность заключается в выявлении взаимосвязи диагностических событий в ряде независимых служб с журналом событий, который ведет отдельная служба, и сопоставления расхождений в показаниях часов компьютера для определения порядка событий. Как и при взаимодействии с микрослужбами с использованием согласованных протоколов и форматов данных, возникает необходимость стандартизации способа ведения журнала событий работоспособности и диагностических событий, которые в конечном счете оказываются в хранилище событий, которое можно запрашивать и просматривать. В подходе с использованием микрослужб различным командам следует прежде всего согласовать единый формат ведения журнала, так как в приложении должен использоваться согласованный подход к просмотру диагностических событий.

Данные о работоспособности и диагностические данные — это не одно и то же. Работоспособность заключается в том, что микрослужба сообщает о своем текущем состоянии для принятия соответствующих мер. Наиболее очевидная мера — работа с механизмами обновления и развертывания для обеспечения доступности. Например, служба может быть в неработоспособном состоянии из-за сбоя процессов или перезагрузки компьютера, но по-прежнему работать. Обновление микрослужбы — самое худшее решение, которое можно принять в такой ситуации. Лучше всего сначала проанализировать ситуацию или дождаться восстановления микрослужбы. События работоспособности микрослужбы позволяют принимать обоснованные решения и фактически помогают создавать службы с возможностью к самовосстановлению.

## Платформа микрослужб Service Fabric

Платформа Service Fabric создана при переходе корпорации Майкрософт от предоставления готовых продуктов (зачастую монолитных) к предоставлению служб. При ее создании учитывался опыт разработки и эксплуатации больших служб, например баз данных Azure SQL, Document DB и других основных служб Azure. Эта платформа полностью удовлетворяла бизнес-требованиям к масштабированию, гибкости и работе независимых команд. Она продолжала развиваться по мере внедрения во множестве служб. Важно отметить, что Service Fabric работала не только в среде Azure, но и в автономных развертываниях Windows Server.

***Service Fabric помогает решить сложные проблемы при разработке и запуске службы, связанные, например, со сбоями, обновлениями и эффективным использованием ресурсов инфраструктуры, что позволяет командам решать бизнес-задачи, применяя подход с использованием микрослужб.***

Service Fabric предусматривает две обширные области, позволяющие разрабатывать приложения с применением подхода с использованием микрослужб.

- Платформа, состоящая из набора системных служб, выполняющих развертывания, обновления, обнаружение служб, в которых произошел сбой, и их перезапуск, обнаружение расположения выполняемых служб, управление состоянием, мониторинг работоспособности и т. д. В сущности, эти системные службы позволяют задействовать множество характеристик микрослужб, описанных выше.

-  Интерфейсы API программирования или платформы, позволяющие создать приложения как микрослужбы. Предоставленные интерфейсы API программирования называются [Reliable Actors и Reliable Services](service-fabric-choose-framework.md). Конечно же, для создания микрослужбы можно использовать любой код. Однако интерфейсы API программирования не только упрощают задачу, но и интегрируются с платформой на более глубоком уровне. Таким образом можно, например, получать информацию о работоспособности и диагностическую информацию или воспользоваться преимуществом встроенной высокой доступности.

***Service Fabric не зависит от способа создания службы, поэтому можно использовать любую технологию. Но она предоставляет встроенные интерфейсы API программирования, упрощающие создание микрослужб.***

### Подходят ли микрослужбы моему приложению?

Возможно. Все больше команд разработчиков в корпорации Майкрософт разрабатывали приложения для облака из деловых соображений. Многие из них осознали преимущества применения подхода, аналогичного подходу с использованием микрослужб. Например, в поисковой системе Bing такой подход применяется уже в течение нескольких лет. Для других команд этот подход был совсем новым, и они обнаружили сложные проблемы, которые они не могли решить. Именно поэтому платформа Service Fabric быстро заслужила популярность как предпочтительная технология для создания служб.

Платформа Service Fabric призвана упростить процесс создания приложений с применением подхода с использованием микрослужб и устранить необходимость в дорогостоящих изменениях. В платформе заложен такой принцип: создание небольшого приложения, масштабирование по мере необходимости, удаление устаревших служб, добавление новых служб и развитие приложения по мере использования клиентами. Мы знаем, что в действительности, чтобы сделать микрослужбы более доступными для большинства разработчиков, следует решить еще множество проблем. Контейнеры и модель программирования на основе субъектов — примеры маленьких шагов на пути к этой цели. Мы уверены, что появится еще множество инноваций, позволяющих упростить разработку приложений. <!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## Дальнейшие действия

* Дополнительная информация 
	* [Общие сведения о Service Fabric](service-fabric-overview.md)
	* [Технический обзор](service-fabric-technical-overview.md)
* Настройка [среды разработки Service Fabric](service-fabric-get-started.md)
* Выбор [платформы модели программирования](service-fabric-choose-framework.md) для службы

[Image1]: media/service-fabric-overview-microservices/monolithic-vs-micro.png
[Image2]: media/service-fabric-overview-microservices/statemonolithic-vs-micro.png

<!---HONumber=Nov15_HO4-->