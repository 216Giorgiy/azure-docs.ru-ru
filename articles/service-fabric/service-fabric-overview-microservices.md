<properties
   pageTitle="Общие сведения о микрослужбах | Microsoft Azure"
   description="Общие сведения о том, почему разработка облачных приложений с применением подхода с использованием микрослужб важна для современной разработки приложений и как платформа Azure Service Fabric позволяет достичь этой цели"
   services="service-fabric"
   documentationCenter=".net"
   authors="msfussell"
   manager="timlt"
   editor=""/>

.<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="09/20/2016"
   ms.author="mfussell"/>

# Разработка приложений с использованием микрослужб
Разработчики программного обеспечения до сих пор считают необходимым разбивать приложения на составные части. Это основная парадигма объектного ориентирования, абстракций программного обеспечения и компонентизации. Сейчас такое разделение принимает форму классов и интерфейсов между общими библиотеками и уровнями технологий. Как правило, многоуровневый подход предполагает наличие серверного хранилища, бизнес-логики среднего уровня и внешнего пользовательского интерфейса. За последние несколько лет *изменилось* только то, что разработчики стали создавать распределенные приложения для облака, управляемого организацией.

Некоторые бизнес-потребности быстро меняются. Они включают следующее.

- Создание и использование масштабируемой службы для взаимодействия с клиентами в новых географических регионах (к примеру).
- ускоренное предоставление функций и возможностей для обеспечения гибкости реагирования на запросы клиентов;
- Более эффективное использование ресурсов, позволяющее снизить затраты.

Эти бизнес-потребности определяют *способ* сборки приложений.

Дополнительные сведения о применяющемся в Azure подходе к микрослужбам см. в статье [Микрослужбы: революция в области приложений на основе облака](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/).

## Подходы к разработке приложений: монолитные приложения и приложения, состоящие из микрослужб
По прошествии времени все приложения развиваются. Успешные приложения развиваются за счет использования. Неудачные приложения не развиваются и в конечном счете устаревают. Вопрос состоит в следующем: какие требования вы выдвигаете к приложениям сегодня и какими они будут в будущем? К примеру, предположим, что вы создаете приложение формирования отчетов для определенного подразделения. Это приложение будет использоваться исключительно в рамках организации, а срок существования отчетов будет кратковременным. В этом случае подход отличается от используемого, например, при создании службы для доставки видеоматериалов десяткам миллионов клиентов. Иногда внедрение чего-либо на практике для тестирования концепции является решающим. Кроме того, важно понимать, что позже приложение можно переработать. Но перерабатывать то, что никогда не используется, совсем нецелесообразно. Таков обычный компромисс при разработке приложений. С другой стороны, если компания планирует создание продукта для облака, ожидается, что такой продукт будет расширяться и использоваться. Проблема заключается в том, что расширение и масштаб достаточно сложно предсказать. Поэтому требуются навыки быстрого создания прототипов наряду с уверенностью в том, что такая стратегия будет успешной в будущем. Подход, который применяют небольшие новые компании, включает сборку, измерение, анализ данных и повторение всего цикла.

В эпоху клиент-серверной архитектуры разработчики создавали многоуровневые приложения с использованием определенных технологий на каждом уровне. Потом для обозначения подобных подходов возник термин «монолитные» приложения. Интерфейсы находились как бы между уровнями, а на самом уровне компоненты были более тесно связаны. При разработке и разделении классы компилировались в библиотеки, а библиотеки объединялись в несколько исполняемых файлов и библиотек DLL. Использование принципа монолитности при разработке приложений дает определенные преимущества. Зачастую такие приложения не требуют больших усилий при разработке, а вызовы между компонентами осуществляются быстрее благодаря механизму межпроцессного взаимодействия. Кроме того, все пользователи могут тестировать один продукт, за счет чего обеспечивается эффективное использование человеческих ресурсов. Недостаток этого подхода: тесная связь компонентов приложения в рамках уровней и невозможность масштабирования отдельных компонентов. Кроме того, при необходимости выполнения исправлений или обновлений нужно ждать, пока другие завершат тестирование. А это негативно сказывается на гибкости.

Микрослужбы позволяют устранить эти недостатки и добиться более точного соответствия ранее описанным бизнес-требованиям. Но они также обладают как преимуществами, так и недостатками. Преимущества микрослужб состоят в том, что обычно каждая из них включает в себя простые бизнес-функции, а также поддерживает возможность независимого вертикального масштабирования, тестирования, развертывания и управления. Основное преимущество подхода с использованием микрослужб заключается в том, что команды разработчиков уделяют больше внимания бизнес-сценариям, чем технологиям, что рекомендуется при разработке многоуровневых приложений. На практике небольшие команды разрабатывают микрослужбу на основе сценария клиента, используя при этом любые технологии. Иными словами, организации не нужно стандартизировать технологии для поддержки своих монолитных приложений. Отдельные команды, владеющие службами, могут делать то, что они считают целесообразным, исходя из собственных знаний или подходящих действий для решения задачи. На практике предпочтительнее использовать набор рекомендуемых технологий, например при выборе конкретного хранилища NoSQL или платформы веб-приложений.

Недостаток микрослужб проявляется в управлении растущим количеством отдельных сущностей, работе с более сложными развертываниями и управлении версиями. Объем сетевого трафика между микрослужбами увеличивается, в результате чего возникают сетевые задержки. Большое количество избыточных "узкопрофильных" служб — вот рецепт для катастрофического снижения производительности. Отсутствие средств выявления этих зависимостей усложняет возможность обзора системы в целом. Микрослужбы становятся полезными благодаря применению стандартов, а не контрактов, которым нужно неукоснительно следовать, т. е. составляются правила обмена данными и учитываются только те задачи, которые должна выполнять служба. Поэтому при разработке эти связи нужно определить заранее, так как службы обновляются независимо друг от друга. При разработке приложений с использованием микрослужб выделяется еще одна характеристика — мелкомодульная сервисноориентированная архитектура.


***Фактически при разработке с использованием микрослужб применяются несвязанные федерации служб с возможностью независимых изменений каждой из них и согласованные стандарты для обмена данными.***


По мере создания дополнительных облачных приложений люди осознают, что такая декомпозиция всего приложения на отдельные службы, ориентированные на сценарии,— это лучший подход в долгосрочной перспективе.

## Сравнение подходов к разработке приложений

![Разработка приложений на платформе Service Fabric][Image1]

1. Монолитные приложения обладают функциональными возможностями домена и обычно делятся на функциональные уровни, например сеть, бизнес-решения и данные.

2. Такие приложения масштабируются путем клонирования на нескольких серверах, в виртуальных машинах или контейнерах.

3. В приложениях, состоящих из микрослужб, функциональные возможности распределены между отдельными службами меньшего размера.

4. Такие приложения масштабируются путем развертывания каждой службы независимо друг от друга и создания экземпляров этих служб на серверах, в виртуальных машинах и контейнерах.


Использование микрослужб при разработке — не универсальный подход. Но он позволяет достичь более точного соответствия бизнес-целям, описанным выше. Применить монолитный подход можно, если известно, что позже у вас не будет возможности при необходимости переработать код для разработки микрослужб. Но чаще всего разработчики сначала создают монолитное приложение, а затем медленно и поэтапно разделяют его, начиная с функциональных областей, в которых следует увеличить масштабируемость и гибкость.

Таким образом, подход с использованием микрослужб представляет собой сборку приложения из множества мелких служб. Эти службы выполняются в контейнерах, развернутых в кластерах компьютеров. Небольшие команды разрабатывают службу, ориентированную на сценарии. При этом тестирование, управление версиями, развертывание и масштабирование выполняется для каждой службы отдельно, позволяя приложению развиваться как единое целое.

## Что такое микрослужба

Существуют различные определения микрослужб. В Интернете можно найти множество хороших ресурсов, в которых представлены различные точки зрения и определения. Тем не менее можно выделить следующие общие характеристики микрослужб.

- Инкапсуляция сценария клиента или бизнес-сценария. Какую проблему требуется решить?
- Разработка небольшими командами разработчиков.
- Написание кода на любом языке программирования и использование любой платформы.
- Составляющие компоненты включают в себя код и при необходимости состояние, которые можно развертывать и масштабировать, а также управлять их версиями независимо друг от друга.
- Взаимодействие с другими микрослужбами с помощью четко определенных интерфейсов и протоколов.
- Наличие уникальных имен (URL-адресов), которые можно использовать для определения их расположения.
- Обеспечение стабильности работы и доступности в случае сбоя.

Эти характеристики можно объединить в одно предложение.

***Приложения, состоящие из микрослужб, формируются из небольших ориентированных на клиента служб с независимым управлением версиями и масштабированием, которые взаимодействуют по стандартным протоколам с применением четко определенных интерфейсов.***


Первые два пункта из списка выше рассмотрены в предыдущем разделе. Теперь мы более подробно рассмотрим остальные.

### Написание кода на любом языке программирования и использование любой платформы
Разработчики могут выбирать необходимые язык или платформу в зависимости от своих навыков или потребностей службы. Для некоторых служб преимущества в отношении производительности, обеспечиваемые языком C++, могут иметь большее значение, чем все остальные. В других службах большую роль играет простота управляемой разработки на языке C# или Java. В некоторых случаях может потребоваться использовать определенные сторонние библиотеки, технологии хранения данных или средства предоставления службы клиентам.

Выбрав технологию, можно перейти к управлению процессами или жизненным циклом службы и ее масштабированию.

### Возможность независимого управления версиями, развертывания и масштабирования кода и состояния  

Независимо от языка программирования микрослужбы код и при необходимости состояние следует развертывать, обновлять и масштабировать отдельно. На самом деле эту проблему сложно решить, так как все сводится к выбору технологий. А для масштабирования все сводится к пониманию того, как секционировать (или сегментировать) код и состояние. Если в коде и состоянии используются разные технологии (а на сегодняшний день именно так и происходит), в сценариях развертывания микрослужбы должна быть предусмотрена возможность масштабирования и кода, и состояния. Кроме того, следует обеспечить гибкость и динамичность использования, позволяющие обновлять отдельные микрослужбы, а не все одновременно. Ненадолго вернемся к сравнению двух подходов при разработке приложений. На следующей схеме показаны различия в подходах к хранению данных о состоянии.

#### Различия в хранении данных о состоянии в двух подходах к разработке приложений
![Хранилище состояний платформы Service Fabric][Image2]

***Слева представлен монолитный подход с отдельной базой данных и уровнями определенных технологий.***

***Справа представлен подход с применением микрослужб. На рисунке изображена схема взаимосвязанных микрослужб, где состояние обычно ограничивается отдельной микрослужбой и используются различные технологии.***

Монолитное приложение, как правило, использует отдельную базу данных. Преимущество — единое расположение, что упрощает развертывание. У каждого компонента может быть одна таблица для хранения данных о состоянии. Сложность состоит в том, что командам разработчиков необходимо строго разграничивать состояния. Кроме того, обязательно появится соблазн добавить новый столбец в имеющуюся таблицу клиента, объединить таблицы и создать зависимости на уровне хранилища. Однако в таком случае будет невозможно масштабировать отдельные компоненты. При подходе с использованием микрослужб каждая служба управляет собственным состоянием и хранит данные о нем. Каждая служба отвечает за масштабирование кода и состояния для обеспечения соответствия собственным требованиям. Недостаток такого подхода заключается в том, что вам нужно создавать представления данных приложения или запросы на их основе. Это обусловлено необходимостью отправлять запросы в разрозненные хранилища состояний. Как правило, эту проблему можно решить, использовав отдельную микрослужбу, которая создает представление коллекции микрослужб. Если нужно выполнить несколько нерегламентированных запросов данных, в каждой микрослужбе должна предусматриваться возможность записи данных в службу хранилища данных для использования в автономной аналитике.

Управление версиями осуществляется на основе развернутой версии микрослужбы для обеспечения параллельного развертывания и взаимодействия нескольких различных версий. Управление версиями применяется при сбое более новой версии микрослужбы во время обновления с необходимостью отката к предыдущей версии. Управление версиями также применяется при A/B-тестировании, при котором разные пользователи используют разные версии службы. Например, микрослужбы часто обновляют для определенной группы клиентов, которые тестируют новые функциональные возможности, прежде чем развертывать их для широкой аудитории. Рассмотрев управление жизненным циклом микрослужб, можно перейти к их взаимодействию.


### Взаимодействие с другими микрослужбами с применением четко определенных интерфейсов и протоколов

Здесь не нужно приводить подробные сведения, так как за последние 10 лет опубликована обширная литература по сервисноориентированной архитектуре, которая описывает шаблоны взаимодействия. Сейчас, как правило, для взаимодействия между службами используется REST, протоколы HTTP и TCP, а также формат сериализации XML или JSON. На уровне интерфейса используются средства веб-дизайна. Но вы также можете применять двоичные протоколы или собственные форматы данных. Будьте готовы, что в таком случае вашими микрослужбами (если они появятся в открытом доступе) будет сложнее пользоваться.

### Уникальное имя (URL-адрес), используемое для распознавания расположения

Почему же микрослужба похожа на сеть? Как и сеть, во время работы микрослужба должна быть адресуемой. Думать только о компьютерах и о том, на каком из них выполняется определенная микрослужба, — это заведомо неправильный подход. Микрослужба должна иметь уникальное имя, позволяющее обнаружить ее расположение, подобно тому, как DNS разрешает URL-адрес для конкретного компьютера. Микрослужбам требуются адресуемые имена, которые делают их независимыми от инфраструктуры, в рамках которой они работают. Таким образом, необходимость в реестре службы предполагает определенную связь между развертыванием службы и ее обнаружением. Не менее важно, чтобы при сбое компьютера служба реестра указывала, где запущена служба. На этом этапе мы можем перейти к следующему разделу, в котором рассматривается устойчивость и стабильность работы.

### Стабильность работы и доступность в случае сбоя

Устранение неожиданных сбоев — одна из самых труднорешаемых задач, особенно в распределенной системе. Основная часть кода, который пишут разработчики, ориентирована на обработку исключений. Этому аспекту также уделяется большая часть времени при тестировании. Но решение проблемы намного сложнее, чем просто написать код, позволяющий исправить ошибки. Что происходит при сбое компьютера, на котором запущена микрослужба? В такой ситуации вам нужно не только определить сбой микрослужбы (а это сама по себе непростая задача), но и найти способ ее перезапуска. Для обеспечения доступности микрослужба должна быть устойчива к сбоям и в ней должна предусматриваться возможность частого перезапуска на другом компьютере. Другой важный момент — это состояние, сохраненное микрослужбой, из которого она может восстановить его, а также принципиальная возможность успешного перезапуска. Другими словами, важна как устойчивость к сбоям в вычислениях (возможность перезапуска процесса), так и устойчивость к сбоям в состоянии или устойчивость к ошибкам в данных (отсутствие потери данных и их согласованность).

Другие сценарии, включающие сбои во время обновления приложения, могут сопровождаться проблемами с устойчивостью. Микрослужбе, работающей с системой развертывания, не требуется восстановление. Она также должна определить, возможен ли переход к новой версии или нужно выполнить откат к предыдущей версии. Кроме того, следует учитывать такие моменты: достаточно ли компьютеров для последующего обновления и как восстановить предыдущие версии микрослужбы. Для принятия решений на основе ответов на эти вопросы требуется, чтобы микрослужба могла передавать информацию о состоянии.

### Передача информации о работоспособности и диагностических данных

Крайне важно (хотя зачастую этому кажущемуся очевидным моменту уделяется недостаточно внимания), чтобы микрослужба передавала сведения о работоспособности и диагностические данные. Иначе будет невозможно получить достаточно сведений о ходе процессов в микрослужбе. Сложность заключается не только в выявлении связи между диагностическими событиями для ряда независимых служб, но и в сопоставлении расхождений в показаниях часов компьютера для определения порядка событий. Как и при взаимодействии с микрослужбами с использованием согласованных протоколов и форматов данных, необходимо стандартизировать способ ведения журнала событий работоспособности и диагностических событий, которые в конечном счете оказываются в хранилище событий, к которому можно обращаться для просмотра данных и создания запросов. При подходе с использованием микрослужб разработчикам следует прежде всего согласовать единый формат ведения журнала. В приложении должен использоваться согласованный подход к просмотру диагностических событий.

Данные о работоспособности и диагностические данные — это не одно и то же. Отчет о работоспособности микрослужбы — это данные о ее текущем состоянии, необходимые для принятия соответствующих мер. Хорошим примером является работа с механизмами обновления и развертывания для обеспечения доступности. Служба может быть временно в неработоспособном состоянии (из-за сбоя процессов или перезагрузки компьютера), но при этом по-прежнему работать. Обновление микрослужбы — самое худшее действие в такой ситуации. Лучше сначала проанализировать ситуацию или дождаться восстановления микрослужбы. События работоспособности микрослужбы позволяют принимать обоснованные решения и фактически помогают создавать службы с возможностью к самовосстановлению.

## Платформа микрослужб Service Fabric

Платформа Azure Service Fabric создана в рамках перехода корпорации Майкрософт от предоставления готовых продуктов (зачастую монолитных) к предоставлению служб. При ее создании учитывался опыт разработки и эксплуатации масштабных служб, например Баз данных SQL Azure и DocumentDB. Она продолжала развиваться по мере внедрения во множестве служб. Важно отметить, что Service Fabric работает не только в среде Azure, но и в автономных развертываниях Windows Server.

***Service Fabric помогает решить сложные проблемы при разработке и запуске службы, связанные с эффективным использованием ресурсов инфраструктуры, что позволяет командам решать бизнес-задачи, применяя подход с использованием микрослужб.***

Service Fabric предусматривает два масштабных решения, которые позволяют создавать приложения в рамках подхода с использованием микрослужб.

- Платформа, которая предоставляет системные службы для развертывания, обновления, обнаружения и перезапуска служб, в которых произошел сбой, а также обнаружения расположения служб, управления состоянием и выполнения мониторинга работоспособности. В сущности, эти системные службы позволяют задействовать множество характеристик микрослужб, описанных ранее.

-  Программные интерфейсы (или платформы), позволяющие создавать приложения как микрослужбы: [Reliable Actors и Reliable Services](service-fabric-choose-framework.md). Конечно же, для создания микрослужбы можно использовать любой код. Однако программные интерфейсы не только упрощают задачу, но и обеспечивают более глубокую интеграцию с платформой. Так вы можете, например, получать информацию о работоспособности и данные диагностики, а также пользоваться преимуществами встроенных средств, обеспечивающих высокую доступность.

***Для Service Fabric не важен способ создания службы, поэтому вы можете использовать любую технологию. Но эта платформа предоставляет встроенные программные интерфейсы, упрощающие создание микрослужб.***

### Подходят ли микрослужбы моему приложению?

Возможно. Все больше команд разработчиков в корпорации Майкрософт начинают разрабатывать облачные приложения для решения бизнес-задач. Многие из них оценили преимущества подхода с использованием микрослужб. Например, в поисковой системе Bing микрослужбы разрабатываются с использованием этого подхода уже в течение нескольких лет. Для других команд этот подход был новым. Они столкнулись со сложными проблемами, которые им не удалось решить. Именно поэтому платформа Service Fabric быстро заслужила популярность как предпочтительная технология для создания служб.

Платформа Service Fabric призвана упростить процесс создания приложений в рамках подхода с использованием микрослужб, устраняя необходимость в дорогостоящих изменениях. Принцип использования платформы: создание небольшого приложения, масштабирование по мере необходимости, удаление устаревших служб, добавление новых служб и развитие приложения по мере использования клиентами. Мы знаем, что в действительности, чтобы сделать микрослужбы более доступными для большинства разработчиков, следует решить еще множество проблем. Контейнеры и модель программирования на основе субъектов — примеры маленьких шагов на пути к этой цели. Мы уверены, что появится еще множество инноваций, позволяющих упростить разработку приложений.  
.<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## Дальнейшие действия

* Дополнительные сведения
    * [Общие сведения о терминологии Service Fabric](service-fabric-technical-overview.md)
    * [Микрослужбы: революция в области приложений на основе облака](https://azure.microsoft.com/ru-RU/blog/microservices-an-application-revolution-powered-by-the-cloud/)


[Image1]: media/service-fabric-overview-microservices/monolithic-vs-micro.png
[Image2]: media/service-fabric-overview-microservices/statemonolithic-vs-micro.png

<!---HONumber=AcomDC_0928_2016-->