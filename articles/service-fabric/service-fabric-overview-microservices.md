<properties
   pageTitle="Общие сведения о микрослужбах | Microsoft Azure"
   description="Общие сведения о том, почему разработка облачных приложений с применением подхода с использованием микрослужб важна для современной разработки приложений и как платформа Azure Service Fabric позволяет достичь этой цели"
   services="service-fabric"
   documentationCenter=".net"
   authors="msfussell"
   manager="timlt"
   editor="bscholl"/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="03/24/2016"
   ms.author="msfussell"/>

# Разработка приложений с использованием микрослужб
Разработчики программного обеспечения до сих пор считают необходимым разбивать приложения на составные части. Это основная парадигма объектного ориентирования, абстракций программного обеспечения и компонентизации. Сейчас такое разделение принимает форму классов и интерфейсов между общими библиотеками и уровнями технологий. Как правило, это происходит в рамках многоуровневого подхода, предполагающим наличие серверного хранилища, бизнес-логики среднего уровня и внешнего пользовательского интерфейса. За последние несколько лет *изменилось* только то, что разработчики стали создавать распределенные приложения для облака, управляемого организацией.

Некоторые бизнес-потребности быстро меняются. Они включают следующее.

- Необходимость создания и использования масштабируемой службы для увеличения охвата клиентов. Это позволяет, например, выходить в новые географические регионы или не выполнять развертывание в расположении клиента.
- ускоренное предоставление функций и возможностей для обеспечения гибкости реагирования на запросы клиентов;
- Более эффективное использование ресурсов, позволяющее снизить затраты.

Эти бизнес-потребности определяют *способ* сборки приложений.

Дополнительные сведения о применяющемся в Azure подходе к микрослужбам см. в статье [Микрослужбы: революция в области приложений на основе облака](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/).

## Подходы к разработке приложений: монолитные приложения и приложения, состоящие из микрослужб
По прошествии времени все приложения развиваются. Успешные приложения развиваются за счет использования. Неудачные приложения не развиваются и в конечном счете устаревают. Вопрос состоит в следующем: какие требования вы выдвигаете к приложениям сегодня и как они могут повлиять на приложения в будущем? Например, вам нужно создать приложение по созданию отчетов с коротким сроком жизни для какого-то отдела, и это приложение будет использоваться исключительно в рамках организации. В этом случае подход будет отличаться от используемого, например, при создании службы для предоставления видеоматериалов десяткам миллионов клиентов. Иногда внедрение чего-либо на практике для тестирования концепции является решающим. Кроме того, важно понимать, что позже приложение можно переработать. Но перерабатывать то, что никогда не используется, нецелесообразно. Таков обычный компромисс при разработке приложений. С другой стороны, если компания планирует создание продукта для облака, ожидается, что такой продукт будет расширяться и использоваться. Проблема заключается в том, что расширение и масштаб достаточно сложно предсказать. Поэтому требуются навыки быстрого создания прототипов наряду с уверенностью в том, что такая стратегия будет успешной в будущем. Подход, который применяют небольшие новые компании, включает сборку, измерение, анализ данных и повторение всего цикла.

В эпоху клиент-серверной архитектуры разработчики создавали многоуровневые приложения с использованием определенных технологий на каждом уровне. Потом для обозначения подобных подходов возник термин «монолитные» приложения. Интерфейсы находились как бы между уровнями, а на самом уровне, как правило, компоненты были более тесно связаны. При разработке и разделении классы компилировались в библиотеки, а библиотеки объединялись в несколько исполняемых файлов и библиотек DLL. Использование принципа монолитности при разработке приложений дает определенные преимущества. Такие приложения не требуют больших усилий при разработке, а вызовы между компонентами осуществляются быстрее благодаря механизму межпроцессного взаимодействия. Кроме того, все пользователи могут тестировать один продукт, за счет чего обеспечивается эффективное использование человеческих ресурсов. Недостатки такого подхода: тесная связь компонентов приложения в рамках уровней и невозможность масштабирования отдельных компонентов. Кроме того, при необходимости выполнения исправлений или обновлений нужно ждать, пока другие завершат тестирование, что негативно влияет на гибкость.

Микрослужбы позволяют устранить эти недостатки и добиться более точного соответствия бизнес-требованиям, описанным выше. Но они также имеют как преимущества, так и недостатками. Преимущества микрослужб состоят в том, что обычно каждая из них включает в себя простые бизнес-функции, а также поддерживает независимое масштабирование, тестирование, развертывание и управление. Основное преимущество подхода с использованием микрослужб заключается в том, что команды разработчиков, как правило, уделяют больше внимание бизнес-сценариям, чем технологиям, что рекомендуется при разработке многоуровневых приложений. На практике это означает, что небольшие команды разрабатывают микрослужбу на основе сценария клиента, используя при этом любые технологии. Иными словами, организации не нужно стандартизировать технологии для поддержки своих монолитных приложений. Кроме того, отдельные команды, владеющие службами, могут делать то, что они считают целесообразным, исходя из собственных знаний или подходящих действий в рамках задачи, которую должна решить эта служба. Конечно, на практике предпочтительнее использовать набор рекомендуемых технологий, например, при выборе конкретного хранилища NoSQL или платформы веб-приложений. Использование микрослужб связано и с некоторыми недостатками. Это управление растущим количеством отдельных сущностей, работа с более сложными развертываниями и управление версиями, а также повышение объема сетевого трафика между микрослужбами и вытекающие из этого сетевые задержки. Большое количество избыточных «узкопрофильных» служб — вот рецепт для катастрофического снижения производительности. Отсутствие средств выявления этих зависимостей усложняет возможность обзора системы в целом. В конечном счете микрослужбы становятся полезными благодаря применению стандартов, а не контрактов, которым нужно неукоснительно следовать, т. е. составляются правила обмена данными и учитываются только те задачи, которые должна выполнять служба. Поэтому при разработке эти связи нужно определить заранее, так как службы будут обновляться независимо друг от друга. При разработке приложений с использованием микрослужб выделяется еще одна характеристика — мелкомодульная сервис-ориентированная архитектура (SOA).


***В самом простом понимании при разработке с использованием микрослужб применяются несвязанные федерации служб с возможностью независимых изменений каждой из них и согласованные стандарты для обмена данными.***


По мере создания дополнительных облачных приложений все больше людей осознают, что такая декомпозиция всего приложения на отдельные службы, ориентированные на сценарии,— это лучший подход в долгосрочной перспективе.
## Сравнение подходов к разработке приложений

![Разработка приложений на платформе Service Fabric][Image1]

1. Монолитные приложения обладают функциональными возможностями домена и обычно делятся на функциональные уровни, например сеть, бизнес-решения и данные.

2. Такие приложения масштабируются путем клонирования на нескольких серверах, в виртуальных машинах или контейнерах.

3. В приложениях, состоящих из микрослужб, функциональные возможности распределены между отдельными службами меньшего размера.

4. Такие приложения масштабируются путем развертывания каждой службы независимо друг от друга и создания экземпляров этих служб на серверах, в виртуальных машинах и контейнерах.


Использование микрослужб при разработке — не универсальный подход. Но он позволяет достичь более точного соответствия бизнес-целям, описанным выше. Применить монолитный подход также можно, если известно, что позже у вас будет возможность при необходимости переработать код для разработки микрослужб. Но чаще всего разработчики сначала создают монолитное приложение, а затем медленно и поэтапно разделяют его, начиная с функциональных областей, в которых следует увеличить масштабируемость и гибкость.

Таким образом, подход с использованием микрослужб представляет собой сборку приложения из множества мелких служб, которые выполняются в контейнерах, развернутых в кластере компьютеров. В таком случае каждую службу разрабатывает небольшая команда, ориентированная на сценарии. При этом тестирование, управление версиями, развертывание и масштабирование выполняется для каждой службы отдельно, позволяя приложению развиваться как единое целое.

## Что такое микрослужба

Существуют различные определения микрослужб. В Интернете можно найти множество хороших ресурсов, в которых представлены различные точки зрения и определения. Тем не менее можно выделить следующие общие характеристики микрослужб.

- Они содержат сценарии клиентов или бизнес-сценарии. Какую проблему требуется решить?
- Их создают небольшие команды разработчиков.
- Для их создания можно использовать любой язык программирования и любую платформу.
- Они состоят из кода и (при необходимости) состояния. Управление версиями, развертывание и масштабирование для этих двух компонентов выполняются независимо друг от друга.
- Они взаимодействуют с другими микрослужбами с помощью четко определенных интерфейсов и протоколов.
- Они имеют уникальные имена (URL-адреса), которые можно использовать для определения их расположения.
- Они обеспечивают стабильность работы и доступность в случае сбоя.

Эти характеристики можно объединить в следующее определение.

***Приложения, состоящие из микрослужб, формируются из небольших ориентированных на клиента служб с независимым управлением версиями и масштабированием, которые взаимодействуют по стандартным протоколам с применением четко определенных интерфейсов.***


Первые два пункта из списка выше рассмотрены в предыдущем разделе. В следующих разделах мы более подробно рассмотрим остальные.

### Возможность написания кода на любом языке программирования и использования любой платформы
Разработчики могут выбирать необходимые язык или платформу в зависимости от своих навыков или потребностей службы. В некоторых службах имеют значение преимущества производительности, обеспечиваемые языком C++, тогда как в других большую роль играет простота управляемой разработки на языке C# или Java. В некоторых случаях может потребоваться использовать определенные сторонние библиотеки, технологии хранения данных или средства предоставления службы клиентам.

Выбрав технологию, можно перейти к управлению процессами или жизненным циклом службы и ее масштабированию.

### Возможность независимого управления версиями, развертывания и масштабирования кода и состояния  

Независимо от языка программирования микрослужбы каждую из них следует развертывать, обновлять и масштабировать отдельно для кода и (при необходимости) для состояния. На самом деле эту проблему сложно решить, так как она сводится к выбору технологий и (для масштабирования) пониманию того, как разделять (или сегментировать) код и состояние. Если в коде и состоянии используются разные технологии (а на сегодняшний день именно так и происходит), в сценариях развертывания микрослужбы должна быть предусмотрена возможность масштабирования и кода, и состояния. Кроме того, следует обеспечить гибкость и динамичность использования, позволяющие обновлять отдельные микрослужбы, а не все одновременно. Ненадолго вернемся к сравнению двух подходов при разработке приложений. На приведенной ниже схеме показаны различия в подходах к хранению данных о состоянии.

#### Различия в хранении данных о состоянии в двух подходах к разработке приложений
![Хранилище состояний платформы Service Fabric][Image2]

***Слева представлен монолитный подход с отдельной базой данных и уровнями определенных технологий.***

***Справа представлен подход с применением микрослужб. На рисунке изображена схема взаимосвязанных микрослужб, где состояние обычно ограничивается отдельной микрослужбой и используются различные технологии.***

Монолитное приложение, как правило, использует отдельную базу данных. Преимущество — единое расположение, что упрощает развертывание. У каждого компонента может быть одна таблица для хранения данных о состоянии. Сложность состоит в том, что командам разработчиков необходимо строго разграничивать состояния. Кроме того, обязательно появится соблазн просто добавить новый столбец в существующую таблицу клиента, объединить таблицы и создавать зависимости на уровне хранилища. Однако в таком случае будет невозможно масштабировать отдельные компоненты. При использовании подхода с применением микрослужб каждая служба управляет собственным состоянием и хранит собственные данные о нем. Это означает, что она отвечает за масштабирование и кода, и состояния, обеспечивая соответствие требованиям. Недостаток такого подхода заключается в том, что вам нужно создавать представления данных приложения или запросы на их основе. Это обусловлено необходимостью отправлять запросы в разрозненные хранилища состояний. Как правило, эту проблему можно решить, использовав отдельную микрослужбу, которая создает представление коллекции микрослужб. Если нужно выполнить несколько нерегламентированных запросов данных, в каждой микрослужбе должна предусматриваться возможность записи данных в службу хранилища данных для использования в автономной аналитике.


Управление версиями зависит от развернутой версии микрослужбы. Оно является обязательным для параллельного развертывания и выполнения нескольких различных версий. Управление версиями применяется при сбое более новой версии микрослужбы во время обновления с необходимостью отката к предыдущей версии. Управление версиями также применяется при A/B-тестировании, при котором разные пользователи используют разные версии службы. Например, микрослужбы часто обновляют для определенной группы клиентов, которые тестируют новые функциональные возможности, прежде чем развертывать их для широкой аудитории. Рассмотрев управление жизненным циклом микрослужб, можно перейти к их взаимодействию.


### Взаимодействие с другими микрослужбами с применением четко определенных интерфейсов и протоколов

Обширная литература по сервис-ориентированной архитектуре, опубликованная за последние 10 лет, раскрывает эту тему почти полностью, так как большая ее часть описывала шаблоны взаимодействия. Сейчас, как правило, все сводится к использованию REST, протоколов HTTP и TCP, а также формата сериализации XML или JSON. На уровне интерфейса используются средства веб-дизайна. Но вы также можете применять двоичные протоколы или собственные форматы данных. Просто будьте готовы, что в таком случае вашими микрослужбами (если они появятся в открытом доступе) будет сложнее пользоваться.

### Уникальное имя (URL-адрес), которое можно использовать для распознавания расположения

Почему же микрослужба похожа на сеть? Как и сеть, во время работы микрослужба должна быть адресуемой. Думать только о компьютерах и о том, на каком из них выполняется определенная микрослужба, — это заведомо неправильный подход. Микрослужба должна иметь уникальное имя, позволяющее обнаружить ее расположение, подобно тому, как DNS разрешает URL-адрес для конкретного компьютера. Микрослужбам требуются адресуемые имена, которые делают их независимыми от инфраструктуры, в рамках которой они работают. Таким образом, необходимость в реестре службы предполагает определенную связь между развертыванием службы и ее обнаружением. Подобным образом должна быть связь между сбоем компьютера и тем, как этот сбой влияет на микрослужбу. Благодаря этому служба реестра может определить текущее расположение микрослужбы. На этом этапе мы можем перейти к следующему разделу, в котором рассматривается устойчивость и стабильность работы.

### Стабильность работы и доступность в случае сбоя

Устранение неожиданных сбоев — одна из самых труднорешаемых задач, особенно в распределенной системе. Основная часть кода, который пишут разработчики, ориентирована на обработку исключений. Этому аспекту также уделяется большая часть времени при тестировании. Но решение проблемы намного сложнее, чем просто написать код, позволяющий исправить ошибки. Что происходит при сбое компьютера, на котором запущена микрослужба? В такой ситуации вам нужно не только определить сбой микрослужбы (а это сама по себе непростая задача), но и найти способ ее перезапуска. Для обеспечения доступности микрослужба должна быть устойчива к сбоям и в ней должна предусматриваться возможность частого перезапуска на другом компьютере. Другой важный момент — это состояние, сохраненное микрослужбой, из которого она может восстановить его, а также принципиальная возможность успешного перезапуска. Другими словами, важна как устойчивость к сбоям в вычислениях (т. е. возможность перезапуска процесса), так и устойчивость к сбоям в состоянии или устойчивость к ошибкам в данных (отсутствие потери данных и их согласованность).

Другие сценарии, включающие сбои во время обновления приложения, могут сопровождаться проблемами с устойчивостью. Для поддержки согласованного состояния микрослужбе, работающей с системой развертывания, необходимо не просто восстановиться. Она также должна определить, возможен ли переход к новой версии или нужно выполнить откат к предыдущей версии. Кроме того, следует учитывать такие моменты: достаточно ли компьютеров для последующего обновления и как восстановить предыдущие версии микрослужбы. Для принятия решений на основе ответов на эти вопросы требуется, чтобы микрослужба могла передавать информацию о состоянии.

### Передача информации о работоспособности и диагностических данных

Крайне важно (хотя зачастую этому кажущемуся очевидным моменту уделяется недостаточно внимания), чтобы микрослужба передавала информацию о работоспособности и диагностические данные. Иначе будет невозможно получить достаточно сведений о ходе процессов в микрослужбе. Сложность заключается не только в выявлении связи между событиями диагностики для ряда независимых служб с журналом событий, который ведет каждая служба, но и в сопоставлении расхождений в показаниях часов компьютера для определения порядка событий. Как и при взаимодействии с микрослужбами с использованием согласованных протоколов и форматов данных, необходимо стандартизировать способ ведения журнала событий работоспособности и диагностических событий, которые в конечном счете оказываются в хранилище событий, к которому можно обращаться для просмотра данных. При использовании микрослужб разным командам разработчиков следует прежде всего согласовать единый формат ведения журнала, так как в приложении должен использоваться согласованный подход к просмотру диагностических событий.

Данные о работоспособности и диагностические данные — это не одно и то же. Отчет о работоспособности микрослужбы — это данные о ее текущем состоянии, необходимые для принятия соответствующих мер. Самые очевидные действия включают работу с механизмами обновления и развертывания для обеспечения доступности. Например, служба может быть временно в неработоспособном состоянии (из-за сбоя процессов или перезагрузки компьютера), но при этом по-прежнему работать. Обновление микрослужбы — самое худшее действие в такой ситуации. Лучше сначала проанализировать ситуацию или дождаться восстановления микрослужбы. События работоспособности микрослужбы позволяют принимать обоснованные решения и фактически помогают создавать службы с возможностью к самовосстановлению.

## Платформа микрослужб Service Fabric

Платформа Azure Service Fabric создана в рамках перехода корпорации Майкрософт от предоставления готовых продуктов (зачастую монолитных) к предоставлению служб. При ее создании учитывался опыт разработки и эксплуатации масштабных служб, например баз данных Azure SQL, DocumentDB и других основных служб Azure. Эта платформа полностью удовлетворяет бизнес-требованиям к масштабированию, гибкости и работе независимых команд, продолжая развиваться по мере использования множеством служб. Важно отметить, что Service Fabric работает не только в среде Azure, но и в автономных развертываниях Windows Server.

***Service Fabric помогает решать сложные проблемы при создании и запуске службы, связанные, например, со сбоями, обновлениями и эффективным использованием ресурсов инфраструктуры. Это позволяет командам решать бизнес-задачи, применяя подход с использованием микрослужб.***

Service Fabric предусматривает два масштабных решения, которые позволяют создавать приложения в рамках подхода с использованием микрослужб.

- Платформа, состоящая из набора системных служб, выполняющих развертывания, обновления, обнаружение и перезапуск служб, в которых произошел сбой, обнаружение расположения выполняемых служб, управление состоянием, мониторинг работоспособности и т. д. В сущности, эти системные службы позволяют задействовать множество характеристик микрослужб, описанных выше.

-  Программные интерфейсы (или платформы), позволяющие создавать приложения как микрослужбы. Предоставляемые интерфейсы API программирования называются [Reliable Actors и Reliable Services](service-fabric-choose-framework.md). Конечно же, для создания микрослужбы можно использовать любой код. Однако программные интерфейсы не только упрощают задачу, но и обеспечивают более глубокую интеграцию с платформой. Так вы можете, например, получать информацию о работоспособности и данные диагностики, а также пользоваться преимуществами встроенных средств, обеспечивающих высокую доступность.

***Для Service Fabric не важен способ создания службы, поэтому вы можете использовать любую технологию. Но эта платформа предоставляет встроенные программные интерфейсы, значительно упрощающие создание микрослужб.***

### Подходят ли микрослужбы моему приложению?

Возможно. Все больше команд разработчиков в корпорации Майкрософт разрабатывают облачные приложения для решения бизнес-задач. Многие из них оценили преимущества подхода с использованием микрослужб. Например, в поисковой системе Bing такой подход применяется уже в течение нескольких лет. Для других команд такое решение было новым. При этом были обнаружены сложные нерешаемые проблемы. Именно поэтому платформа Service Fabric быстро заслужила популярность как предпочтительная технология для создания служб.

Платформа Service Fabric призвана упростить процесс создания приложений в рамках подхода с использованием микрослужб, устраняя необходимость в дорогостоящих изменениях. Принцип использования платформы: создание небольшого приложения, масштабирование по мере необходимости, удаление устаревших служб, добавление новых служб и развитие приложения по мере использования клиентами. Мы знаем, что в действительности, чтобы сделать микрослужбы более доступными для большинства разработчиков, следует решить еще множество проблем. Контейнеры и модель программирования на основе субъектов — примеры маленьких шагов на пути к этой цели. Мы уверены, что появится еще множество инноваций, позволяющих упростить разработку приложений.
<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## Дальнейшие действия

* Дополнительная информация
	* [Общие сведения о Service Fabric](service-fabric-overview.md)
    * [Микрослужбы: революция в области приложений на основе облака](https://azure.microsoft.com/ru-RU/blog/microservices-an-application-revolution-powered-by-the-cloud/)

[Image1]: media/service-fabric-overview-microservices/monolithic-vs-micro.png
[Image2]: media/service-fabric-overview-microservices/statemonolithic-vs-micro.png

<!---HONumber=AcomDC_0330_2016-->