<properties
   pageTitle="Общие сведения о конфигурации ReliableDictionaryActorStateProvider при использовании надежных субъектов Service Fabric"
   description="Информация о настройке субъектов Service Fabric с отслеживанием состояния и типом ReliableDictionaryActorStateProvider."
   services="Service-Fabric"
   documentationCenter=".net"
   authors="sumukhs"
   manager="anuragg"
   editor=""/>

<tags
   ms.service="Service-Fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="08/26/2015"
   ms.author="sumukhs"/>

# Настройка надежных субъектов — ReliableDictionaryActorStateProvider
Конфигурацию ReliableDictionaryActorStateProvider по умолчанию можно изменить. Для этого нужно обновить файл settings.xml, созданный в папке Config корневого каталога пакета Visual Studio конкретного субъекта.

Среда выполнения Service-Fabric ищет имена предварительно определенных разделов в файле settings.xml и использует значения конфигурации при создании базовых компонентов среды выполнения.

> [AZURE.NOTE]**Не** удаляйте и не изменяйте имена разделов в перечисленных ниже конфигурациях в файле settings.xml, который создается в решении Visual Studio.

## Конфигурация безопасности репликатора
Конфигурации безопасности репликаторов используются для защиты канала связи, который используется во время репликации. Это означает, что службы не будут «видеть» реплицируемый трафик друг друга, что позволит обеспечить высокую доступность и высокий уровень защиты. Пустой раздел конфигурации безопасности означает, что канал репликации не защищен.
### Имя раздела
&lt;ActorName&gt;ServiceReplicatorSecurityConfig

## Конфигурация репликатора
Конфигурации репликатора используются для настройки репликатора, отвечающего за надежность состояния поставщика состояний субъекта путем репликации и локального сохранения состояния. Конфигурация по умолчанию создается шаблоном Visual Studio и подходит для большинства случаев. В этом разделе мы расскажем о дополнительных конфигурациях, с помощью которых можно выполнить более тонкую настройку репликатора.
### Имя раздела
&lt;ActorName&gt;ServiceReplicatorConfig
### Имена конфигураций

|Имя|Единица измерения|Значение по умолчанию|Примечания|
|----|----|-------------|-------|
|BatchAcknowledgementInterval|Секунды|0,05|Период времени, в течение которого дополнительный репликатор после получения операции находится в режиме ожидания, а затем отправляет подтверждение обратно основному репликатору. Любые другие подтверждения, отправляемые для операций, обработанных в течение этого интервала, отправляются как один ответ.||
|ReplicatorEndpoint|Недоступно|Нет (обязательный параметр)|IP-адрес и порт, которые будут использоваться основным и дополнительным репликаторами для связи с другими репликаторами в наборе реплик. Значение должно быть ссылкой на конечную точку ресурса TCP в манифесте службы. Дополнительные сведения об определении ресурсов конечных точек в манифесте службы см. в статье [Ресурсы манифеста службы](service-fabric-service-manifest-resources.md). |
|RetryInterval|Секунды|5|Период времени, после которого репликатор повторно передает сообщение, если не получил подтверждение операции.|
|MaxReplicationMessageSize|Байты|50 МБ|Максимальный размер данных репликации, которые могут быть переданы в одном сообщении.|
|MaxPrimaryReplicationQueueSize|Количество операций|1024|Максимальное количество операций в основной очереди. Операция освобождается после того, как основной репликатор получит подтверждение от всех дополнительных репликаторов. Это значение должно быть больше 64 и представлять собой степень числа 2.|
|MaxSecondaryReplicationQueueSize|Количество операций|2048|Максимальное количество операций в дополнительной очереди. Операция освобождается после того, как для ее состояния обеспечивается высокая доступность (посредством сохранения). Это значение должно быть больше 64 и представлять собой степень числа 2.|
|MaxStreamSizeInMB|МБ|1024|Объем зарезервированного места для файла журнала. Размер в байтах должен быть больше, чем 16-кратная величина значения MaxRecordSize в байтах.|
|MaxRecordSizeInKB|КБ|1024|Максимальный размер записи, которую репликатор может записать в журнал. Это значение должно быть кратно 4 и больше 16.|
|OptimizeForLocalSSD|Логическое|нет|При значении True журнал настраивается таким образом, чтобы сведения о состоянии записывались в отдельный файл журнала реплики. Это обеспечивает наилучшую производительность, если файлы журнала располагаются на твердотельном носителе или если скорость ввода-вывода для диска ВМ регулируется. При значении False сведения о состоянии сначала помещаются в общий файл журнала, а затем переносятся в отдельный файл журнала.|
|OptimizeLogForLowerDiskUsage|Логическое|нет|При значении True журнал настраивается таким образом, чтобы отдельный файл журнала реплики создавался с использованием разреженного файла NTFS. Это уменьшает фактически используемое файлом место на диске. Если значение равно False, создаваемому файлу назначается фиксированный размер места на диске, что обеспечивает оптимальную производительность записи.|
|SharedLogId|guid|""|Уникальный идентификатор GUID для определения общего файла журнала, используемого с данной репликой. Обычно в службах не следует использовать этот параметр, однако если параметр SharedLogId задан, то необходимо также задать SharedLogPath.|
|SharedLogPath|Полное имя пути|""|Полный путь к расположению, где будет создан общий файл журнала для данной реплики. Обычно в службах не следует использовать этот параметр, однако если параметр SharedLogPath задан, то необходимо задать также параметр SharedLogId.|


## Образец файла конфигурации

```xml
<?xml version="1.0" encoding="utf-8"?>
<Settings xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/2011/01/fabric">
   <Section Name="MyActorServiceReplicatorConfig">
      <Parameter Name="ReplicatorEndpoint" Value="MyActorServiceReplicatorEndpoint" />
      <Parameter Name="BatchAcknowledgementInterval" Value="0.05"/>
      <Parameter Name="MaxStreamSizeInMB" Value="512" />
   </Section>
   <Section Name="MyActorServiceReplicatorSecurityConfig">
      <Parameter Name="CredentialType" Value="X509" />
      <Parameter Name="FindType" Value="FindByThumbprint" />
      <Parameter Name="FindValue" Value="9d c9 06 b1 69 dc 4f af fd 16 97 ac 78 1e 80 67 90 74 9d 2f" />
      <Parameter Name="StoreLocation" Value="LocalMachine" />
      <Parameter Name="StoreName" Value="My" />
      <Parameter Name="ProtectionLevel" Value="EncryptAndSign" />
      <Parameter Name="AllowedCommonNames" Value="My-Test-SAN1-Alice,My-Test-SAN1-Bob" />
   </Section>
</Settings>
```

## Примечания
Параметр BatchAcknowledgementInterval управляет задержкой репликации. Значение 0 обеспечивает минимальную возможную задержку за счет уменьшения скорости репликации (потому что необходимо отправлять и обрабатывать большее количество сообщений с подтверждениями, каждое из которых содержит меньше подтверждений). По мере увеличения значения BatchAcknowledgementInterval увеличивается общая скорость репликации и задержка операций. Это непосредственно перетекает в задержку фиксаций транзакций.

Значение MaxStreamSizeInMB определяет объем места на диске, которое репликатор может использовать для хранения сведений о состоянии в выделенном файле журнала реплики. Так как сохраненное состояние информации позволяет обеспечить соответствие другой реплики состоянию основной, в общем случае лучше иметь файл журнала большего размера, так как это уменьшит количество времени, в течение которого другая реплика достигает состояния основной. Однако большие файлы журнала могут занимать больше места на диске и таким образом уменьшать число реплик, которые можно разместить на определенном узле.

Параметр OptimizeForLowerDiskUsage позволяет подготавливать для файлов журналов больше места, чем им фактически нужно. Поэтому активные реплики смогут сохранять в журналах больше сведений о состоянии, тогда как неактивные реплики будут использовать меньше дискового пространства. Так, вы можете разместить на узле больше реплик, чем это было бы возможно в случае нехватки места на диске, но если для параметра OptimizeForLowerDiskUsage установить значение False, сведения о состоянии будут записываться в журналы быстрее.

Параметр OptimizeForLocalSSD используется для отключения записи сведений о состоянии в общий файл журнала перед переносом в отдельный файл. Этот параметр обычно следует задавать в том случае, когда локальное дисковое хранилище для отдельного файла журнала представляет собой твердотельный носитель, так как минимизация перемещения дисковых головок в этом случае не требуется. Этот параметр может применяться также тогда, когда ВМ выполняет множество локальных дисковых операций ввода-вывода и их скорость регулируется узлом ВМ.

Параметр MaxRecordSizeInKB определяет максимальный размер записи, которая может быть записана репликатором в файл журнала. В большинстве случаев заданный по умолчанию размер записи (1024 КБ) является оптимальным, однако, если служба предусматривает запись в сведения о состоянии больших фрагментов данных, может возникнуть необходимость увеличить это значение. Особой пользы от установки значения MaxRecordSizeInKB меньше 1024 нет, так как для меньших записей используется ровно столько места, сколько они занимают. Изменять этот параметр требуется только в редких случаях.

Параметры SharedLogId и SharedLogPath всегда используются совместно и позволяют службе использовать отдельный общий журнал из установленного по умолчанию общего журнала для узла. Для достижения наилучшей эффективности один и тот же общий журнал следует указывать в как можно большем количестве служб. Общие файлы журналов следует размещать на дисках, которые используются исключительно для хранения общих журналов. Это позволяет уменьшить конфликты перемещения головок. Изменять этот параметр требуется только в редких случаях.

<!---HONumber=Sept15_HO4-->