<properties
   pageTitle="Масштабирование кластера Service Fabric | Microsoft Azure"
   description="Масштабирование кластера Service Fabric за счет добавления или удаления узлов виртуальных машин позволяет обеспечить соответствие запросам."
   services="service-fabric"
   documentationCenter=".net"
   authors="ChackDan"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="01/11/2016"
   ms.author="chackdan"/>

# Масштабирование кластера Service Fabric путем добавления в него виртуальных машин или удаления их из него.

Масштабирование кластеров Service Fabric за счет добавления или удаления виртуальных машин позволяет обеспечить соответствие запросам.

>[AZURE.NOTE]Предполагается, что ваша подписка поддерживает достаточное количество ядер для добавления новых виртуальных машин, которые войдут в состав этого кластера.


## Масштабирование кластера Service Fabric вручную

Если кластер имеет несколько типов узлов, вам потребуется добавить или удалить виртуальные машины из определенных типов узлов. Вы можете добавлять виртуальные машины к узлам одного типа и удалять их из узлов другого типа в одном и том же развертывании.

### Обновление кластера, развернутого с помощью портала

Это сложный процесс, поэтому мы загрузили в репозиторий Git модуль PowerShell, которым вы сможете воспользоваться для его выполнения.

**Шаг 1**. Скопируйте эту папку на компьютер из [репозитория Git](https://github.com/ChackDan/Service-Fabric/tree/master/Scripts/ServiceFabricRPHelpers).

**Шаг 2**. Убедитесь, что на компьютере установлен пакет SDK для Azure версии 1.0 или более поздней версии.

**Шаг 3**. Откройте окно Powershell и импортируйте файл ServiceFabricRPHelpers.psm.

```
Remove-Module ServiceFabricRPHelpers
```

Импортируйте модуль PoweShell, который только что скопировали. Можете скопировать следующую команду и изменить путь к файлу .psm1, указав в нем имя своего компьютера.

```
Import-Module "C:\Users\chackdan\Documents\GitHub\Service-Fabric\Scripts\ServiceFabricRPHelpers\ServiceFabricRPHelpers.psm1"
```

 **Шаг 4**. Войдите в свою учетную запись Azure.

```
Login-AzureRmAccount
```

Выполните команду Invoke-ServiceFabricRPClusterScaleUpgrade и убедитесь, что имя группы ресурсов и подписка указаны правильно.

```
Invoke-ServiceFabricRPClusterScaleUpgrade -ResourceGroupName <string> -SubscriptionId <string>
```

Вот заполненный пример той же команды PS.

```
Invoke-ServiceFabricRPClusterScaleUpgrade -ResourceGroupName chackod02 -SubscriptionId 18ad2z84-84fa-4798-ad71-e70c07af879f
```

  **Шаг 5**. Команда соберет сведения о кластере и проведет вас по всем типам узлов, сначала сообщая вам текущее количество виртуальных машин/узлов для этого типа узла и затем запрашивая у вас новое значение количества виртуальных машин/узлов.

 **Для увеличения размера узла этого типа** увеличьте текущее количество виртуальных машин.

**Для уменьшения размера узла этого типа** уменьшите текущее количество виртуальных машин.

Эта процедура будет повторена для всех типов узлов. Если кластер имеет только один тип узла, то процедура пройдет только один раз.
 
  **Шаг 6**. Теперь при добавлении новых виртуальных машин у вас будут запрашиваться идентификатор пользователя удаленного рабочего стола и пароль для виртуальных машин, которые вы добавляете.
 
**Шаг 7**. В окне вывода теперь будут отображаться сообщения, информирующие о ходе развертывания. После завершения развертывания количество узлов кластера должно соответствовать указанному на шаге 5.


![Увеличение и уменьшение размера][ScaleupDownPSOut]


**Шаг 8**. Если размер узла был уменьшен, вы должны удалить виртуальные машины. Сценарий деактивирует все виртуальные машины, удаление которых вы запросили, например, на этих узлах или виртуальных машинах нет реплик приложения или системы. Теперь можно безопасно удалить эти виртуальные машины.

**Примечание**. Хотя деактивированные узлы больше не используются кластером SF, деактивированные виртуальные машины нужно удалить, чтобы их использование не тарифицировалось.

**Шаг 8.1**. Выполните вход на портал Azure [http://aka.ms/servicefabricportal](http://aka.ms/servicefabricportal).

**Шаг 8.2**. Перейдите к ресурсу кластера, размер которого вы уменьшили, и щелкните "Все параметры" в разделе "Основные компоненты".

**Шаг 8.3**. Щелкните "Типы узлов". Вы должны увидеть список узлов, которые будут деактивированы. На этом рисунке chackodnt15, chackodnt24 chackodnt25 и chackodnt26 — виртуальные машины, которые теперь нужно удалить.

![Список деактивированных узлов][DeactivatedNodeList]

**Шаг 8.4**. Удалите эти виртуальные машины с помощью PS или портала. После удаления виртуальных машин процесс уменьшения размера этого узла завершен.

```
Remove-AzureRmResource -ResourceName <Deactivated Node name without the understore> -ResourceType Microsoft.Compute/virtualMachines -ResourceGroupName <Resource Group name> -ApiVersion <Api version>
```
Вот заполненный пример этой команды.

```
Remove-AzureRmResource -ResourceName chackodnt26 -ResourceType Microsoft.Compute/virtualMachines -ResourceGroupName chackod02 -ApiVersion 2015-05-01-preview
```

### Обновление кластера, развернутого с помощью ARM PowerShell или интерфейса командной строки

Если кластер изначально был развернут с помощью шаблона ARM, необходимо изменить количество виртуальных машин для данного типа узла и всех ресурсов, которые поддерживают виртуальную машину. Минимальное количество виртуальных машин, допустимых для типа основного узла — 5 (для кластеров, не используемых для тестирования), для тестовых кластеров — 3.

После создания нового шаблона его можно развернуть через ARM с помощью той же группы ресурсов, в которую входит обновляемый кластер.


## Автоматическое масштабирование кластера Service Fabric

В настоящее время кластеры Service Fabric не поддерживают автоматическое масштабирование. В ближайшем будущем кластеры будут создаваться на основе масштабируемых наборов виртуальных машин (VMSS), при этом будет возможно их автоматическое масштабирование, действие которого будет аналогично автоматическому масштабированию в облачных службах.


## Дальнейшие действия

- [Узнайте об обновлениях кластера.](service-fabric-cluster-upgrade.md)
- [Узнайте о секционировании служб с отслеживанием для максимального масштабирования.](service-fabric-concepts-partitioning.md)


<!--Image references-->
[ScaleupDownPSOut]: ./media/service-fabric-cluster-scale-up-down/ScaleupDownPSOut.png
[DeactivatedNodeList]: ./media/service-fabric-cluster-scale-up-down/DeactivatedNodeList.png

<!---HONumber=AcomDC_0114_2016-->