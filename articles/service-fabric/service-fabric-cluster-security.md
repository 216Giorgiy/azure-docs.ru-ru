<properties
   pageTitle="Настройка безопасности кластера Service Fabric | Microsoft Azure"
   description="Описываются сценарии обеспечения безопасности кластера Service Fabric и различные технологии, используемые для реализации этих сценариев."
   services="service-fabric"
   documentationCenter=".net"
   authors="ChackDan"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="08/19/2016"
   ms.author="chackdan"/>

# Сценарии защиты кластера Service Fabric

Кластер Service Fabric — это ресурс, владельцем которого являетесь вы. Кластеры всегда должны быть защищены для предотвращения подключения к ним неавторизованных пользователей, особенно в тех случаях, когда на кластере выполняются рабочие нагрузки в рабочей среде. Существует возможность создания незащищенного кластера, однако стоит учитывать, что это позволит любому анонимному пользователю подключаться к нему, если конечные точки управления кластером общедоступны через Интернет.

Эта статья содержит обзор сценариев безопасности автономных или работающих в Azure кластеров. В ней также рассматриваются различные технологии, используемые для реализации этих сценариев. Сценарии обеспечения безопасности кластера:

- безопасность обмена данными между узлами;
- безопасность обмена данными между клиентами и узлами;
- Управление доступом на основе ролей (RBAC)

## безопасность обмена данными между узлами;
Обеспечивается безопасность обмена данными между виртуальными машинами и компьютерами в кластере. Такая защита гарантирует, что размещать приложения и службы в кластере смогут владельцы только тех компьютеров, которые прошли авторизацию для подключения к кластеру.

![Схема обмена данными между узлами][Node-to-Node]

Кластеры, работающие в Azure, или автономные кластеры, работающие под управлением Windows, могут использовать [безопасность на основе сертификатов](https://msdn.microsoft.com/library/ff649801.aspx) или [безопасность Windows](https://msdn.microsoft.com/library/ff649396.aspx) для компьютеров Windows Server.
### Безопасность обмена данными между узлами на основе сертификатов
Service Fabric использует сертификаты сервера X.509, которые указываются как часть конфигурации типа узла при создании кластера. Краткий обзор этих сертификатов и способа их получения или создания приведен в конце этой статьи.

При создании кластера безопасность на основе сертификатов можно настроить с помощью портала Azure, шаблонов Azure Resource Manager или автономного шаблона JSON. Вы можете указать основной сертификат и необязательный дополнительный сертификат, который будет использоваться для смены сертификатов. Эти сертификаты должны отличаться от сертификатов клиента администрирования и клиента только для чтения, указанных для [безопасности обмена данными между клиентами и узлами](#client-to-node-security).

Чтобы узнать, как настроить безопасность на основе сертификатов в кластере, работающем в Azure, см. статью [Настройка кластера Service Fabric с использованием шаблона диспетчера ресурсов Azure](service-fabric-cluster-creation-via-arm.md).

Сведения для автономного кластера Windows Server см. в статье [Защита автономного кластера под управлением Windows с помощью сертификатов](service-fabric-windows-cluster-x509-security.md).

### Безопасность обмена данными между узлами Windows
Сведения для автономного кластера Windows Server см. в статье [Защита автономного кластера под управлением Windows с помощью системы безопасности Windows](service-fabric-windows-cluster-windows-security.md).

## Безопасность обмена данными между клиентами и узлами
Обеспечивается безопасность обмена данными между клиентом Service Fabric и отдельными узлами в кластере. Этот тип защиты выполняет проверку подлинности и обеспечивает безопасность обмена данными с клиентом, благодаря чему к кластеру и развернутым в нем приложениям могут получить доступ только авторизованные пользователи. Клиенты однозначно определяются с помощью своих учетных данных системы безопасности Windows или учетных данных сертификата безопасности.

![Схема обмена данными между узлом и клиентом][Client-to-Node]

Кластеры, работающие в Azure, или автономные кластеры, работающие под управлением Windows, могут использовать [безопасность на основе сертификатов](https://msdn.microsoft.com/library/ff649801.aspx) или [безопасность Windows](https://msdn.microsoft.com/library/ff649396.aspx).

### Безопасность обмена данными между клиентами и узлами на основе сертификатов
 Безопасность обмена данными между клиентами и узлами на основе сертификатов настраивается при создании кластера (на портале Azure, с помощью шаблонов Resource Manager или автономного шаблона JSON). Для этого указывается сертификат клиента администрирования и (или) пользовательский сертификат клиента. Эти сертификаты должны отличаться от основного и дополнительного сертификатов, указанных для [защиты обмена данными между узлами](#node-to-node-security).

Клиенты, подключающиеся к кластеру с помощью сертификата администрирования получают полный доступ к возможностям управления. Клиенты, подключающиеся к кластеру с помощью сертификата клиента только для чтения, получают доступ только для чтения к возможностям управления. Другими словами, эти сертификаты используются для управления доступом на основе ролей. Это описано далее в этой статье.

Чтобы узнать, как настроить безопасность на основе сертификатов в кластере, работающем в Azure, см. статью [Настройка кластера Service Fabric с использованием шаблона диспетчера ресурсов Azure](service-fabric-cluster-creation-via-arm.md).

Сведения для автономного кластера Windows Server см. в статье [Защита автономного кластера под управлением Windows с помощью сертификатов](service-fabric-windows-cluster-x509-security.md).

### Безопасность обмена данными между клиентами и узлами Azure Active Directory в Azure
Для защиты доступа к конечным точкам управления кластеры под управлением Azure также могут использовать Azure Active Directory (AAD). Сведения о том, как создать необходимые артефакты Azure Active Directory (AAD), как их заполнить при создании кластера, а после этого подключиться к этим кластерам, см. в статье [Настройка кластера Service Fabric с использованием шаблона диспетчера ресурсов Azure](service-fabric-cluster-creation-via-arm.md).

## Рекомендации по обеспечению безопасности
Чтобы обеспечить безопасность обмена данными между узлами в кластерах Azure, рекомендуется использовать безопасность AAD для аутентификации клиентов и сертификатов.

Если в рамках автономных кластеров Windows Server используется Windows Server 2012 R2 и Active Directory, рекомендуется применять безопасность Windows с учетными записями, управляемыми группой. В противном случае используйте безопасность Windows с учетными записями Windows.

## управление доступом на основе ролей (RBAC).
Благодаря контролю доступа администратор кластера может ограничить доступ разных групп пользователей на выполнение определенных операций в кластере, повысив тем самым уровень безопасности кластера. Для клиентов, подключающихся к кластеру, поддерживаются два типа управления доступом: администратор и пользователь.

Администраторы имеют полный доступ к возможностям управления (включая возможности чтения и записи). Пользователи по умолчанию имеют доступ только на чтение для управления (например, при работе с запросами) и возможность разрешения приложений и служб.

Клиентские роли (администратора или клиента) задаются во время создания кластера путем предоставления отдельных удостоверений (сертификатов, AAD и т. д.) для каждой из них. Дополнительные сведения о параметрах управления доступом по умолчанию и их изменении см. в статье [Контроль доступа на основе ролей для клиентов Service Fabric](service-fabric-cluster-security-roles.md).


## Сертификаты X.509 и Service Fabric
Цифровые сертификаты X.509 обычно используются для проверки подлинности клиентов и серверов, а также для шифрования и цифровой подписи сообщений. Дополнительные сведения об этих сертификатах см. в статье [Работа с сертификатами](http://msdn.microsoft.com/library/ms731899.aspx).

Необходимо учитывать следующие важные моменты.

- Сертификаты, которые используются в кластерах, выполняющих рабочие нагрузки в рабочей среде, следует создать с помощью правильно настроенной службы сертификации Windows Server или получить из утвержденного [центра сертификации](https://en.wikipedia.org/wiki/Certificate_authority).
- Никогда не используйте в рабочей среде какие-либо временные или тестовые сертификаты, созданные с помощью таких инструментов, как MakeCert.exe.
- Можно использовать самозаверяющий сертификат, но это следует делать только для тестовых кластеров, а не в рабочей среде.

### Сертификаты X.509

Основной задачей сертификатов сервера является проверка подлинности сервера (узла) для клиентов или сервера (узла) для сервера (узла). Одна из начальных проверок при проверке подлинности узла — сопоставление значения общего имени в поле "Субъект". В списке разрешенных общих имен должно быть это общее имя или одно из альтернативных имен субъекта сертификатов.

Способы создания сертификатов с альтернативными именами субъектов (SAN) см. в статье [Как добавить дополнительное имя субъекта сертификата безопасного LDAP](http://support.microsoft.com/kb/931351).

В поле "Субъект" может быть несколько значений, каждое из которых содержит сокращение в виде префикса, определяющее тип значения. Чаще всего для общего имени используется сокращение CN. Например, CN = www.contoso.com. Поле "Субъект" также можно оставить пустым. Если необязательное поле "Альтернативное имя субъекта" заполнено, его значение должно содержать общее имя сертификата и альтернативное имя субъекта. Эти имена вводятся как значения DNS-имени.

Поле "Назначения" для сертификата должно содержать соответствующие значения, например "Проверка подлинности сервера" или "Проверка подлинности клиента".

### Сертификаты X.509 клиентов

Как правило, сертификаты клиентов не выдаются сторонними центрами сертификации. В личном хранилище текущего расположения пользователя обычно содержатся сертификаты клиента, помещенные туда корневым центром сертификации. Значение поля назначения — "Проверка подлинности клиента". Клиент может использовать такой сертификат, когда требуется взаимная проверка подлинности.

>[AZURE.NOTE] Для выполнения всех операций управления в кластере Service Fabric необходимы сертификаты серверов. Для управления нельзя использовать сертификаты клиента.

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->


## Дальнейшие действия

В этой статье содержатся общие сведения о безопасности кластера. Следующим шагом [создайте в Azure кластер с помощью шаблона Resource Manager](service-fabric-cluster-creation-via-arm.md) или с помощью [портала Azure](service-fabric-cluster-creation-via-portal.md).

<!--Image references-->
[Node-to-Node]: ./media/service-fabric-cluster-security/node-to-node.png
[Client-to-Node]: ./media/service-fabric-cluster-security/client-to-node.png

<!---HONumber=AcomDC_0824_2016-->
