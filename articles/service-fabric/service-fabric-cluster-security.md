<properties
   pageTitle="Настройка безопасности кластера Service Fabric | Microsoft Azure"
   description="Описываются сценарии обеспечения безопасности кластера Service Fabric и различные технологии, используемые для реализации этих сценариев."
   services="service-fabric"
   documentationCenter=".net"
   authors="ChackDan"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="06/01/2016"
   ms.author="chackdan"/>

# Сценарии защиты кластера Service Fabric

Кластер Service Fabric — это ресурс, владельцем которого являетесь вы. Во избежание несанкционированного доступа, следует защитить его, особенно, если на нем выполняются рабочие нагрузки. Эта статья содержит обзор сценариев безопасности для кластеров под управлением Azure и Windows Server. В ней также рассматриваются различные технологии, используемые для реализации этих сценариев. Сценарии обеспечения безопасности кластера:

- безопасность обмена данными между узлами;
- безопасность обмена данными между клиентами и узлами;
- управление доступом на основе ролей (RBAC).

## Безопасность обмена данными между узлами
Обеспечивается безопасность обмена данными между виртуальными машинами и компьютерами в кластере. Такая защита гарантирует, что размещать приложения и службы в кластере смогут владельцы только тех компьютеров, которые прошли авторизацию для подключения к кластеру.

![Схема обмена данными между узлами][Node-to-Node]

Кластеры, работающие в Azure, или автономные кластеры, работающие под управлением Windows, могут использовать [безопасность на основе сертификатов](https://msdn.microsoft.com/library/ff649801.aspx) или [безопасность Windows](https://msdn.microsoft.com/library/ff649396.aspx). Безопасность на основе сертификатов настраивается при создании кластера (на портале Azure или с помощью шаблонов ARM). Для этого указывается основной сертификат и необязательный дополнительный сертификат. Эти сертификаты должны отличаться от сертификатов клиента администрирования и клиента только для чтения, указанных для [защиты обмена данными между клиентами и узлами](#client-to-node-security). Чтобы узнать, как настроить безопасность на основе сертификатов в кластере под управлением Azure, ознакомьтесь с разделом [Защита кластера Service Fabric в Azure с помощью сертификатов](service-fabric-secure-azure-cluster-with-certs.md) или [Настройка кластера Service Fabric с использованием шаблона диспетчера ресурсов Azure](service-fabric-cluster-creation-via-arm.md).

## Безопасность обмена данными между клиентами и узлами
Обеспечивается безопасность обмена данными между клиентом Service Fabric и отдельными узлами в кластере. Этот тип защиты выполняет проверку подлинности и обеспечивает безопасность обмена данными с клиентом, благодаря чему к кластеру и развернутым в нем приложениям могут получить доступ только авторизованные пользователи. Клиенты однозначно определяются с помощью своих учетных данных системы безопасности Windows или учетных данных сертификата безопасности.

![Схема обмена данными между узлом и клиентом][Client-to-Node]

Кластеры, работающие в Azure, или автономные кластеры, работающие под управлением Windows, могут использовать [безопасность на основе сертификатов](https://msdn.microsoft.com/library/ff649801.aspx) или [безопасность Windows](https://msdn.microsoft.com/library/ff649396.aspx). Безопасность обмена данными между клиентами и узлами на основе сертификатов настраивается при создании кластера (на портале Azure или с помощью шаблонов ARM). Для этого указывается сертификат клиента администрирования и (или) сертификат клиента только для чтения. Эти сертификаты должны отличаться от основного и дополнительного сертификатов, указанных для [защиты обмена данными между узлами](#node-to-node-security). Клиенты, подключающиеся к кластеру с помощью сертификата администрирования или основного сертификата, получают полный доступ к возможностям управления. Клиенты, подключающиеся к кластеру с помощью сертификата клиента только для чтения, получают доступ только для чтения к возможностям управления. Чтобы узнать, как настроить безопасность на основе сертификатов в кластере под управлением Azure, ознакомьтесь с разделом [Защита кластера Service Fabric в Azure с помощью сертификатов](service-fabric-secure-azure-cluster-with-certs.md) или [Настройка кластера Service Fabric с использованием шаблона диспетчера ресурсов Azure](service-fabric-cluster-creation-via-arm.md).

Service Fabric использует сертификаты сервера X.509, которые указываются как часть конфигурации типа узла при создании кластера. Краткий обзор этих сертификатов и способа их получения или создания приведен в конце этой статьи.

Для защиты доступа к конечным точкам управления кластеры под управлением Azure также могут использовать Azure Active Directory (AAD). Сведения о том, как создать необходимые артефакты AAD, как их заполнить при создании кластера, а после этого подключиться к этим кластерам, см. в разделе [ПРЕДВАРИТЕЛЬНАЯ ВЕРСИЯ: создание кластера Service Fabric с использованием Azure Active Directory для проверки подлинности клиента](service-fabric-cluster-security-client-auth-with-aad.md).

## управление доступом на основе ролей (RBAC).
Благодаря контролю доступа администратор кластера может ограничить доступ разных групп пользователей на выполнение определенных операций в кластере, повысив тем самым уровень безопасности кластера. Для клиентов, подключающихся к кластеру, поддерживаются два типа управления доступом: администратор и пользователь. Администраторы имеют полный доступ к возможностям управления (включая возможности чтения и записи). Пользователи по умолчанию имеют доступ только на чтение для управления (например, при работе с запросами) и возможность разрешения приложений и служб. Клиентские роли (администратора или клиента) задаются во время создания кластера путем предоставления отдельных сертификатов для каждой из них. Дополнительные сведения о параметрах управления доступом по умолчанию и их изменении см. в разделе [Контроль доступа на основе ролей для клиентов Service Fabric](service-fabric-cluster-security-roles.md).


## Сертификаты X.509 и Service Fabric
Цифровые сертификаты X.509 обычно используются для проверки подлинности клиентов и серверов, а также для шифрования и цифровой подписи сообщений. Дополнительные сведения об этих сертификатах см. в статье [Работа с сертификатами](http://msdn.microsoft.com/library/ms731899.aspx).

Необходимо учитывать следующие важные моменты.

- Сертификаты, которые используются в кластерах, выполняющих рабочие нагрузки в рабочей среде, следует создать с помощью правильно настроенной службы сертификации Windows Server или получить из утвержденного [центра сертификации](https://en.wikipedia.org/wiki/Certificate_authority).
- Никогда не используйте в рабочей среде какие-либо временные или тестовые сертификаты, созданные с помощью таких инструментов, как MakeCert.exe.
- Можно использовать самозаверяющий сертификат, но это следует делать только для тестовых кластеров, а не в рабочей среде.

### Сертификаты X.509

Основной задачей сертификатов сервера является проверка подлинности сервера (узла) для клиентов или сервера (узла) для сервера (узла). Одна из начальных проверок при проверке подлинности узла — сопоставление значения общего имени в поле "Субъект". В списке разрешенных общих имен должно быть это общее имя или одно из альтернативных имен субъекта сертификатов.

Способы создания сертификатов с альтернативными именами субъектов (SAN) см. в статье [Как добавить дополнительное имя субъекта сертификата безопасного LDAP](http://support.microsoft.com/kb/931351).

В поле "Субъект" может быть несколько значений, каждое из которых содержит сокращение в виде префикса, определяющее тип значения. Чаще всего для общего имени используется сокращение CN. Например, CN = www.contoso.com. Поле "Субъект" также можно оставить пустым. Если необязательное поле "Альтернативное имя субъекта" заполнено, его значение должно содержать общее имя сертификата и альтернативное имя субъекта. Эти имена вводятся как значения DNS-имени.

Поле "Назначения" для сертификата должно содержать соответствующие значения, например "Проверка подлинности сервера" или "Проверка подлинности клиента".

### Сертификаты X.509 клиентов

Как правило, сертификаты клиентов не выдаются сторонними центрами сертификации. В личном хранилище текущего расположения пользователя обычно содержатся сертификаты клиента, помещенные туда корневым центром сертификации. Значение поля назначения — "Проверка подлинности клиента". Клиент может использовать такой сертификат, когда требуется взаимная проверка подлинности.

>[AZURE.NOTE] Для выполнения всех операций управления в кластере Service Fabric необходимы сертификаты серверов. Для управления нельзя использовать сертификаты клиента.

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->


## Дальнейшие действия
После настройки кластера узнайте о обновлениях кластера.

- [Обновление кластера Service Fabric](service-fabric-cluster-upgrade.md)

Узнайте больше о безопасности приложений.

- [Запуск от имени: запуск приложения Service Fabric с использованием разных разрешений безопасности](service-fabric-application-runas-security.md)

- [Защита взаимодействия служб в Azure Service Fabric](service-fabric-reliable-services-secure-communication.md)

<!--Image references-->
[Node-to-Node]: ./media/service-fabric-cluster-security/node-to-node.png
[Client-to-Node]: ./media/service-fabric-cluster-security/client-to-node.png

<!---HONumber=AcomDC_0608_2016-->