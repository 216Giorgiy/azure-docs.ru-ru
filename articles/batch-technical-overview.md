<properties 
	pageTitle="Технический обзор Пакетной службы Azure" 
	description="Узнайте об основных понятиях, рабочих процессах и сценариях Пакетной службы Azure" 
	services="batch" 
	documentationCenter="" 
	authors="dlepow" 
	manager="timlt"/>

<tags 
	ms.service="batch" 
	ms.workload="big-compute" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/30/2015" 
	ms.author="danlep"/>


#Технический обзор Пакетной службы Azure
Пакетная служба Azure помогает запускать облачные приложения, которые осуществляют крупномасштабные параллельные вычисления с высокой производительностью, а также предоставляет платформу для планирования заданий и автоматическое масштабирование вычислительных ресурсов как услугу. С помощью Пакетной службы и ее пакета SDK возможно выполнение по запросу или расписанию пакетных рабочих нагрузок в управляемой коллекции виртуальных машин, что позволит не беспокоиться о сложностях планирования заданий и управления ресурсами базовой платформы.
 
>[WACOM.NOTE]Сейчас доступна предварительная версия Пакетной службы. Чтобы использовать Пакетную службу, необходимо иметь учетную запись Microsoft Azure и активировать в подписке предварительную версию Пакетной службы. Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Подробную информацию см. в разделе [Создание учетной записи Azure](http://azure.microsoft.com/develop/php/tutorials/create-a-windows-azure-account/). 


В этой статье рассматриваются следующие темы:
 
* [Варианты использования](#BKMK_Scenarios)
* [Сценарии для разработчика](#BKMK_Approaches)
* [Основные понятия Пакетной службы](#BKMK_Entities)
* [Рабочий процесс для рабочего элемента](#BKMK_Workflow_workitems)
* [Рабочий процесс для публикации и выполнения приложений](#BKMK_Workflow_cloudappss)
* [Дополнительные ресурсы](#BKMK_Resources)

<h2 id="BKMK_Scenarios">Варианты использования</h2>

Пакетная служба использует эластичность и масштабируемость облака при *пакетной обработке* или *пакетных вычислениях*, то есть программном выполнении больших объемов схожих задач. Программа командной строки или сценарий принимает набор файлов данных в качестве входных данных, обрабатывает их в виде последовательности задач и создает набор выходных файлов. Выходные файлы могут содержать окончательные результаты или же быть промежуточным шагом в более крупном рабочем процессе.       
 
Пакетные вычисления - это общий шаблон для организаций, используемый для обработки, преобразования и анализа больших объемов данных по расписанию или запросу. Он включает в себя обработку полного цикла. Например, создание ежедневного банковского отчета о рисках или зарплатах, который должен формироваться по расписанию. Также он может решать задачи крупного бизнеса, науки и технического применения, для которых обычно требуются инструменты и ресурсы вычислительного кластера или сетки. Это могут быть традиционные приложения высокопроизводительных вычислительных систем (например, моделирование динамики жидкостей или специализированные рабочие нагрузки из области проектирования автомобилей, нефтегазовых исследований, исследований науки о жизни и создание цифрового содержимого). 
 
Пакетная служба хорошо работает с приложениями и рабочими нагрузками, которые параллельно выполняют задачи на нескольких компьютерах, таких как вычислительные виртуальные машины под управлением Пакетной службы. См. рис. 1.  

![Parallel tasks][parallel]

**Рис. 1. Параллельные задачи, которые выполняются на нескольких компьютерах**

Примеры приведены ниже.

* Моделирование финансовых рисков. 
* Обработка и визуализация изображений.
* Кодирование и перекодировка мультимедиа.
* Анализ генетических последовательностей.
* Тестирование программного обеспечения.

Пакетная служба может использоваться для выполнения параллельных вычислений с уменьшением шага, а также других, более сложных ациклических параллельных рабочих нагрузок. 

>[WACOM.NOTE]Сейчас предварительная версия Пакетной службы не поддерживает приложения интерфейса передачи сообщений (MPI).

<h2 id="BKMK_Approaches">Сценарии разработки</h2>

Интерфейсы API Пакетной службы на основе REST поддерживают два сценария разработки для настройки и запуска пакетных рабочих нагрузок с помощью Пакетной службы:
 
1. **Распределение вычислений в виде рабочих элементов** с помощью API *Пакетной службы* для создания гибкого пула вычислительных виртуальных машин и управления им, а также для назначения им рабочих элементов. Это дает вам полный контроль над ресурсами. Клиент осуществляет управление конвейером выполнения задач. Например, с помощью диспетчера рабочих процессов или метапланировщика, который может быть реализован помощью интерфейсов REST API Пакетной службы или диспетчера заданий рабочего элемента. Вместо того, чтобы настраивать вычислительный кластер или писать код для создания очереди и планирования заданий, можно автоматизировать процессы планирования заданий и масштабирования пула вычислительных ВМ для выполнения заданий. В процессе определения рабочих элементов вам нужно указать все зависимости и описать работу с входными и выходными файлами. 

2. **Публикация и запуск приложений с использованием пакетной службы** - интерфейсы API *приложений Пакетной службы* обеспечивают более высокий уровень абстракции и размещенный на стороне Пакетной службы конвейер выполнения заданий. С помощью приложений Пакетной службы можно создать рабочую нагрузку в виде облачной службы на базе существующего приложения, которое сейчас выполняется на клиентских рабочих станциях или вычислительном кластере. Приложения Пакетной службы позволяют переносить существующие двоичные и исполняемые файлы и публиковать их для запуска на виртуальных машинах пула, которые создает Пакетная служба и осуществляет управление ими в фоновом режиме. Платформа для приложений Пакетной службы осуществляет перемещение входных и выходных файлов, выполнение заданий, управление заданиями и сохранение данных. Приложения Пакетной службы также позволяют моделировать задачи разделения данных и выделения этапов задания. В состав входит REST API-интерфейс и портал приложений Пакетной службы, где можно наблюдать за выполнением переданных заданий. Доступ к нему можно получить с помощью портала управления Microsoft Azure.


<h2 id="BKMK_Entities">Основные понятия Пакетной службы</h2>

В следующих разделах приведены основные понятия для работы с Пакетной службой и интерфейсами API. Дополнительную информацию см. в разделе [Основные сведения об API-интерфейсе Пакетной службы Azure](http://azure.microsoft.com/documentation/articles/batch-api-basics). 

* [Учетная запись Пакетной службы](#BKMK_Account)
* [Виртуальные машины задач и пулы](#BKMK_TVM)
* [Рабочие элементы, задания и задачи](#BKMK_Workitem)
* [Файлы и каталоги](#BKMK_Files)

<h3 id="BKMK_Account">Учетная запись Пакетной службы</h3>
Для работы с Пакетной службой вам необходимо иметь уникальную **учетную запись службы**. При выполнении операций API с помощью Пакетной службы аутентификация осуществляется через запросы с URL-адресом учетной записи и ее ключа доступа. Для доступа к порталу приложений Пакетной службы вам также необходима учетная запись службы.
 
Создание учетной записи Пакетной службы и управление ключами доступа для учетной записи осуществляется на портале управления Microsoft Azure.

Вот как можно создать учетную запись Пакетной службы:

1. Войдите на [портал управления Azure](https://manage.windowsazure.com).
2. Нажмите **Создать**, **Вычисления**, **Пакетная служба**, а затем **Быстрое создание**.
![Create a Batch account][account_portal]

3. Введите следующие сведения:

	* В поле **Имя учетной записи** введите уникальное имя, которое будет использоваться в URL-адресе учетной записи Пакетной службы.
	* В поле **Регион** выберите регион, в котором будет доступна Пакетная служба.
	* Если у вас несколько подписок, в поле **Подписка** выберите нужную подписку, для которой будут выставляться счета за использование службы.

 
<h3 id="BKMK_TVM">Виртуальные машины задач и пулы</h3>

Виртуальная** машина задач** (ВМЗ) - это виртуальная машина Microsoft Azure, которая выделена Пакетной службой для выполнения определенной рабочей нагрузки (задачи) вашему приложению (это может быть исполняемый файл (EXE-файл) или, если используются приложения службы, одна или несколько программ из образа приложения). В отличие от обычной виртуальной машины Microsoft Azure вам не нужно управлять ВМЗ напрямую. Пакетная служба создает **пул** одинаково настроенных вычислительных ресурсов (ВМЗ) и управляет ними, как показано на рис. 2. 

![Pool and TVMs][TVM_pool]

**Рис. 2. Рис. 2. Пул ВМЗ**

При использовании интерфейсов API Пакетной службы пул можно создать напрямую или же настроить Пакетную службу так, чтобы он создавался автоматически, когда вы указываете работу, которую нужно выполнить. При использовании вами интерфейсов API приложений Пакетной службы пул создается автоматически во время запуска вами облачного приложения Пакетной службы.


Атрибуты пула включают в себя:

* Раз[мер](http://msdn.microsoft.com/library/azure/dn197896.aspx) ВМЗ 
* Операционная система ВМЗ.
* Максимальное количество ВМЗ.
* Правила масштабирования для пула - это формула, основанная на текущей рабочей нагрузке и использовании ресурсов, которая динамически настраивает количество обрабатывающих задачи ВМЗ.
* Доступные порты брандмауэра для обмена данными между ВМЗ внутри пула.
* Установленный на ВМЗ сертификат (например, для аутентификации доступа к учетной записи хранения).
* Задача запуска для ВМЗ - это операция, которая будет выполнена только один раз (например, установка приложений или скачивание данных для задач).

>[WACOM.NOTE]В настоящее время ВМЗ поддерживают только следующие операционные системы: Windows Server 2012 R2, Windows Server 2012 и Windows Server 2008 R2 с пакетом обновления 1 (SP1).

Пул может использоваться только той учетной записью Пакетной службы, с помощью которой он был создан. Учетная запись Пакетной службы может содержать более одного пула.

Каждой добавляемой к пулу ВМЗ присваивается уникальное имя и IP-адрес. При удалении ВМЗ из пула она теряет все изменения, внесенные в операционную систему, свои локальные файлы, назначенное имя и IP-адрес. Когда ВМЗ покидает пул, она перестает существовать.


<h3 id="BKMK_Workitem">Рабочие элементы, задания и задачи</h3>

Рабочий** элемент** - это шаблон, который определяет способ выполнения приложения на ВМЗ в пуле. Задание** представляет** собой запланированный экземпляр рабочего элемента и может выполняться как один раз, так и несколько. Задание состоит из набора **задач**. На рис. 3 показаны основные связи.    
 
![Work item, job, and tasks][job_task]

**Рис. 3. Рабочий элемент, задание и задача**

В зависимости от интерфейсов API, которые используются для разработки с использованием Пакетной службы, необходимо указывать ту или иную информацию о рабочих элементах, заданиях и задачах.

* При разработке приложения, которое работает с низкоуровневыми интерфейсами API Пакетной службы, необходимо программно определить все рабочие элементы, задания и задачи, которые будут обрабатываться Пакетной службой, а также настроить пулы ВМЗ.

* Если ваше клиентское приложение интегрируется с помощью API-интерфейсов приложений Пакетной службы и ее инструментов, вы можете использовать компоненты, которые автоматически разделят задания на задачи, выполнят обработку задач и слияние результатов отдельных задач в итоговый результат задания. При отправке рабочей нагрузки в пакетную службу платформа приложений Пакетной службы будет автоматически управлять заданиями и выполнять задачи на базовых вычислительных ресурсах. 



<h3 id="BKMK_Files">Файлы и каталоги</h3>

Файл - это часть данных, которые используются в качестве входных данных для задания. Задача может содержать один или несколько связанных с ней входных файлов, либо не содержать их вообще. Файл может использоваться в нескольких задачах. Например, у задач визуализации фильма могут быть общие текстуры и модели. Для задач в задании анализа данных файлы могут содержать набор наблюдений или измерений.

У каждой задачи есть рабочий каталог, в котором она может создавать дополнительные файлы и каталоги для хранения программы, выполняемой задачей, обрабатываемых задачей данных, а также выходных данных. Во время выполнения задания эти каталоги и файлы доступны для использования в других задачах. Все задачи, файлы и каталоги в ВМЗ принадлежат одной учетной записи.

В зависимости от того, какие вы используете интерфейсы API Пакетной службы, вам нужно будет указать ту или иную информацию о расположениях и перемещении входных и выходных файлов для заданий и задач. При разработке приложения, которое работает с низкоуровневыми интерфейсами API Пакетной службы, необходимо явно указать все зависимости и правила перемещения файлов. При использовании приложений Пакетной службы большую часть этой работы платформа сделает за вас. 

<h2 id="BKMK_Workflow_workitems"> Рабочие элементы рабочего процесса</h2>
На рис. 4 показан типичный рабочий процесс распределения вычислений между ВМЗ пула с использованием API Пакетной службы.

![Work items workflow][work_item_workflow]

**Рис. 4. Рабочий процесс распределения рабочих элементов между виртуальными машинами пула**

1.	Передайте входные файлы (например, исходные данные или изображения) для задания учетной записи хранения Azure. Чтобы Пакетная служба имела к ним доступ, они должны находиться в учетной записи хранения. Пакетная служба передаст их в ВМЗ при выполнении задачи.
2.	Передайте зависимые двоичные файлы в учетную запись хранения. Двоичные файлы включают в себя программу, которая выполняется задачей, и зависимые сборки. Эти файлы также должны быть доступны из службы хранения и загружены в ВМЗ.
3.	Создайте пул ВМЗ, указав размер ВМЗ в пуле, операционную систему и другие свойства. Когда задача запускается, ей назначается ВМЗ из этого пула.
4.	Создайте рабочий элемент. При создании рабочего элемента задание создается автоматически. Рабочий элемент позволяет вам управлять заданием с задачами.
5.	Добавьте задачи в задание. Каждая задача использует переданную вами программу для обработки информации из переданного вами файла.
6.	Запустите приложение и отслеживайте полученные выходные данные.

<h2 id="BKMK_Workflow_cloudapps">Рабочий процесс для публикации и запуска приложений </h2>
На рис. 5 показан основной рабочий процесс публикации приложения с помощью API приложений Пакетной службы с последующей передачей заданий в приложение Пакетной службы.

![Application publishing workflow][app_pub_workflow]

**Рис. 5. Рабочий процесс публикации и запуска приложения с помощью приложений Пакетной службы**

1.	Подготовьте **образ приложения** - ZIP-файл с исполняемыми файлами приложения и всеми необходимыми файлами. Это могут быть те же исполняемые файлы, которые вы запускаете на традиционных фермах серверов или кластере.
2.	Создайте ZIP-файл с **облачной сборкой**, которая будет вызывать рабочие нагрузки и перенаправлять их в Пакетную службу. Облачная сборка содержит два компонента, которые доступны с помощью пакета SDK:

	a. **Разделитель заданий** разбивает задание на задачи, которые могут быть обработаны независимо друг от друга. Например, в сценарии анимации разделитель заданий будет принимать в качестве задания фильм и разбивать его на отдельные кадры.

	b. **Обработчик задач** вызывает исполняемый файл приложения для заданной задачи. Например, в сценарии анимации обработчик задач будет вызывать программу визуализации для обработки отдельного, указанного задачей кадра. 

3.	Используйте интерфейсы API приложений Пакетной службы или инструменты разработчика, чтобы передать ZIP-файлы, подготовленные на двух предыдущих шагах, в учетную запись хранения Azure. Чтобы Пакетная служба имела к ним доступ, они должны находиться в учетной записи хранения. Обычно эта операция однократно выполняется администратором службы для каждого приложения.
4.	Укажите способ отправки заданий в приложение в Azure. Это может быть подключаемый модуль пользовательского интерфейса в приложении, веб-портал или автоматическая служба, которая является частью серверной системы. Все необходимые примеры, демонстрирующие различные варианты, можно найти в пакете SDK. 

	Вот как можно выполнить задание:

	a. Передайте входные файлы задания пользователя (например, исходные данные или изображения). Чтобы Пакетная служба имела к ним доступ, они должны находиться в учетной записи хранения.

	b. Отправьте задание с необходимыми параметрами и списком файлов.
	
	c. Отслеживайте ход выполнения задания с помощью интерфейсов API или портала приложений Пакетной службы.
	
	d. Скачайте выходные данные.
	
<h2 id="BKMK_Resources">Дополнительные ресурсы</h2>

* [Приступая к работе с библиотекой Пакетной службы Azure для .NET](http://azure.microsoft.com/documentation/articles/batch-dotnet-get-started/)
* [Библиотеки и инструменты разработки Пакетной службы Azure](http://azure.microsoft.com/documentation/articles/batch-development-libraries-tools/)
* [Справочник по REST API Пакетной службы Azure](http://go.microsoft.com/fwlink/p/?LinkId=517803)
* [Справочник по REST API приложений Пакетной службы Azure](http://go.microsoft.com/fwlink/p/?LinkId=517804)

[parallel]: ./media/batch-technical-overview/parallel.png
[TVM_pool]: ./media/batch-technical-overview/TVM_pool.png
[job_task]: ./media/batch-technical-overview/job_task.png
[account_portal]: ./media/batch-technical-overview/account_portal.png
[work_item_workflow]: ./media/batch-technical-overview/work_item_workflow.png
[app_pub_workflow]: ./media/batch-technical-overview/app_pub_workflow.png

<!--HONumber=35.2-->

<!--HONumber=46--> 
