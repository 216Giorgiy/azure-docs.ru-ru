---
title: "Вопросы и ответы по проблемам подключения и сетей для облачных служб Microsoft Azure | Документы Майкрософт"
description: "В этой статье приведены часто задаваемые вопросы по подключениям и сетям для облачных служб Microsoft Azure."
services: cloud-services
documentationcenter: 
author: genlin
manager: cshepard
editor: 
tags: top-support-issue
ms.assetid: 84985660-2cfd-483a-8378-50eef6a0151d
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/20/2017
ms.author: genli
ms.openlocfilehash: d86f3ec043c504c9d79b18f1f0b4c9cf0adb115b
ms.sourcegitcommit: cc03e42cffdec775515f489fa8e02edd35fd83dc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/07/2017
---
# <a name="connectivity-and-networking-issues-for-azure-cloud-services-frequently-asked-questions-faqs"></a>Проблемы подключения и сетей для облачных служб Azure. Вопросы и ответы (FAQ)

В этой статье приведены часто задаваемые вопросы по подключениям и сетям для [облачных служб Microsoft Azure](https://azure.microsoft.com/services/cloud-services). Сведения о размерах приводятся в статье [Размеры для облачных служб](cloud-services-sizes-specs.md) .

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

## <a name="i-cant-reserve-an-ip-in-a-multi-vip-cloud-service"></a>Не удается зарезервировать IP-адрес в облачной службе с несколькими виртуальными IP-адресами
Сначала убедитесь, что экземпляр виртуальной машины, для который вы пытаетесь зарезервировать IP-адрес, включен. Далее убедитесь, что вы используете зарезервированные IP-адреса как для промежуточного, так и для рабочего развертывания. **Не изменяйте** параметры во время обновления развертывания.

## <a name="how-do-i-remote-desktop-when-i-have-an-nsg"></a>Как использовать удаленный рабочий стол при наличии NSG?
Добавьте в NSG правила, разрешающие передачу трафика через порты **3389** и **20000**.  Удаленный рабочий стол использует порт **3389**.  В экземплярах облачной службы реализована балансировка нагрузки, поэтому вы не можете напрямую управлять подключением к экземпляру.  Агенты *RemoteForwarder* и *RemoteAccess* управляют трафиком RDP и позволяют клиенту отправлять файлы cookie по RDP и указывать отдельный экземпляр для подключения.  Агентам *RemoteForwarder* и *RemoteAccess* требуется, чтобы порт **20000** был открыт. При использовании группы безопасности сети он может быть заблокирован.

## <a name="can-i-ping-a-cloud-service"></a>Можно ли проверить связь с облачной службой?

Нет, только не с помощью обычного протокола проверки связи или ICMP. Протокол ICMP не разрешен в подсистеме балансировки нагрузки Azure.

Чтобы проверить подключение, рекомендуется выполнить проверку связи с портом. Хотя Ping.exe использует протокол ICMP, другие инструменты, такие как PSPing, Nmap и telnet, позволяют проверить возможность подключения к конкретному порту TCP.

Дополнительные сведения см. в статье [Использование проверки связи с портом вместо ICMP для проверки подключения к виртуальной машине Azure](https://blogs.msdn.microsoft.com/mast/2014/06/22/use-port-pings-instead-of-icmp-to-test-azure-vm-connectivity/).

## <a name="how-do-i-prevent-receiving-thousands-of-hits-from-unknown-ip-addresses-that-indicate-some-sort-of-malicious-attack-to-the-cloud-service"></a>Как избежать получения тысяч вхождений с неизвестных IP-адресов, указывающих, что в облачную службу производится вредоносная атака?
Azure реализует многоуровневую сетевую безопасность для защиты служб платформы от распределенных атак типа "отказ в обслуживании" (DDoS). Система защиты Azure от DDoS-атак — часть непрерывного процесса мониторинга Azure, которая постоянно улучшается благодаря тестам на проникновение. Эта система защиты от DDoS-атак предназначена для защиты не только от атак извне, но и от других клиентов Azure. Дополнительные сведения см. в разделе [Сетевая безопасность Microsoft Azure](http://download.microsoft.com/download/C/A/3/CA3FC5C0-ECE0-4F87-BF4B-D74064A00846/AzureNetworkSecurity_v3_Feb2015.pdf).

Вы также можете создать задачу при запуске для выборочного блокирования некоторых конкретных IP-адресов. Дополнительные сведения см. в разделе [Блокирование определенного IP-адреса](cloud-services-startup-tasks-common.md#block-a-specific-ip-address).

## <a name="when-i-try-to-rdp-to-my-cloud-service-instance-i-get-the-message-the-user-account-has-expired"></a>При попытке выполнить удаленное подключение к моему экземпляру облачной службы появляется сообщение "Срок действия этой учетной записи пользователя истек".
Вы можете получить сообщение "Срок действия этой учетной записи пользователя истек" при обходе даты истечения срока действия, которая настраивается в параметрах протокола удаленного рабочего стола. Можно изменить дату истечения срока действия на портале, выполнив следующие действия.
1. Войдите на [портал Azure](https://portal.azure.com), перейдите к облачной службе и выберите вкладку **Удаленный рабочий стол**.
2. Выберите **рабочий** или **промежуточный** слот развертывания.
3. Измените дату истечения срока действия и затем сохраните конфигурацию.

Теперь вы сможете подключиться к своему компьютеру по протоколу удаленного рабочего стола.

## <a name="why-is-loadbalancer-not-balancing-traffic-equally"></a>Почему LoadBalancer не балансирует трафик одинаково?
Сведения о том, как работает внутренняя подсистема балансировки нагрузки, см. в разделе [Новый режим распределения Azure Load Balancer](https://azure.microsoft.com/blog/azure-load-balancer-new-distribution-mode/).

В основе алгоритма распределения лежит использование хэша 5 кортежей (исходный IP-адрес, порт источника, IP-адрес назначения, порт назначения, тип протокола) для сопоставления трафика с доступными серверами. Он позволяет закреплять IP-адреса только в рамках сеанса транспорта. Пакеты в одном сеансе TCP или UDP будут направляться на один экземпляр IP-адреса центра обработки данных (DIP) в конечной точке с балансировкой нагрузки. Когда клиент закрывает и снова открывает подключение или начинает новый сеанс с того же исходного IP-адреса, порт источника изменяется и перенаправляет трафик к другой конечной точке DIP.

## <a name="how-can-i-redirect-the-incoming-traffic-to-my-default-url-of-cloud-service-to-a-custom-url"></a>Как перенаправить входящий трафик со стандартного URL-адреса облачной службы на пользовательский URL-адрес? 

Модуль переопределения URL-адресов IIS позволяет перенаправлять трафик, поступающий на URL-адрес облачной службы по умолчанию (например, \*.cloudapp.net), к любому пользовательскому имени DNS или URL-адресу. Поскольку модуль переопределения URL-адресов по умолчанию включен для веб-ролей, а его правила настраиваются в файле web.config для приложения, он всегда будет доступен на всех виртуальных машинах независимо от любых перезагрузок или пересозданий образов. Дополнительные сведения можно найти в разделе 

- [Creating Rewrite Rules for the URL Rewrite Module](https://docs.microsoft.com/iis/extensions/url-rewrite-module/creating-rewrite-rules-for-the-url-rewrite-module) (Создание правил переопределения для модуля переопределения URL-адресов).
- Информация о том, [как удалить ссылку по умолчанию](https://stackoverflow.com/questions/32286487/azure-website-how-to-remove-default-link?answertab=votes#tab-top).

## <a name="how-can-i-blockdisable-the-incoming-traffic-to-the-default-url-of-my-cloud-service"></a>Как заблокировать или отключить поступление входящего трафика на URL-адрес облачной службы, используемый по умолчанию? 

Чтобы запретить поступление входящего трафика на стандартный URL-адрес или адрес с именем облачной службы (например, \*.cloudapp.net), укажите в заголовке узла пользовательское DNS-имя (например, www.MyCloudService.com), используя конфигурацию привязки сайта в CSDEF-файле с определением облачной службы, как указано ниже. 
 

    <?xml version="1.0" encoding="utf-8"?> 
    <ServiceDefinition name="AzureCloudServicesDemo" xmlns="http://schemas.microsoft.com/ServiceHosting/2008/10/ServiceDefinition" schemaVersion="2015-04.2.6"> 
      <WebRole name="MyWebRole" vmsize="Small"> 
        <Sites> 
          <Site name="Web"> 
            <Bindings> 
              <Binding name="Endpoint1" endpointName="Endpoint1" hostHeader="www.MyCloudService.com" /> 
            </Bindings> 
          </Site> 
        </Sites> 
        <Endpoints> 
          <InputEndpoint name="Endpoint1" protocol="http" port="80" /> 
        </Endpoints> 
        <ConfigurationSettings> 
          <Setting name="Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString" /> 
        </ConfigurationSettings> 
      </WebRole> 
    </ServiceDefinition> 
 
Поскольку эта привязка к заголовку узла применяется при помощи CSDEF-файла, служба будет доступна только по адресу с указанием пользовательского имени www.MyCloudService.com. При этом все входящие запросы по адресу *.cloudapp.net будут завершаться ошибкой. Но если вы используете пользовательский зонд с программной подсистемой балансировки нагрузки или внутреннюю подсистему балансировки нагрузки, блокировка стандартного URL-адреса или имени службы может повлиять на поведение этих систем. 

## <a name="how-to-make-sure-the-public-facing-ip-address-of-a-cloud-service-aka-vip-never-changes-so-that-it-could-be-customarily-whitelisted-by-few-specific-clients"></a>Как можно гарантировать, что общедоступный открытый IP-адрес (виртуальный IP-адрес) облачной службы никогда не будет изменяться, чтобы определенные клиенты могли включить его в список разрешений?

Чтобы включить IP-адрес облачной службы в список разрешений, следует связать с этой службой зарезервированный IP-адрес. Иначе предоставляемый Azure виртуальный IP-адрес удаляется из подписки, когда вы удаляете развертывание. Обратите внимание, что для успешного переключения виртуального IP-адреса вам потребуется присвоить зарезервированные IP-адреса и рабочей, и промежуточной средам. При отсутствии второго адреса операция переключения завершится ошибкой. Выполните инструкции в этих статьях, чтобы зарезервировать IP-адрес и связать его с облачными службами.  
 
- [Резервирование IP-адреса существующей облачной службы](../virtual-network/virtual-networks-reserved-public-ip.md#reserve-the-ip-address-of-an-existing-cloud-service)
- [Связывание зарезервированного IP-адреса с облачной службой с помощью файла конфигурации службы](../virtual-network/virtual-networks-reserved-public-ip.md#associate-a-reserved-ip-to-a-cloud-service-by-using-a-service-configuration-file) 

Если у вас несколько экземпляров каждой роли, связывание зарезервированного IP-адреса с облачной службой не будет вызывать простоев. Кроме того, вы можете включить в список разрешений весь диапазон IP-адресов используемого центра обработки данных Azure. Диапазоны IP-адресов Azure вы найдете [здесь](https://www.microsoft.com/en-us/download/details.aspx?id=41653). 

Этот файл содержит диапазоны IP-адресов (включая диапазоны вычисления, хранения и SQL), используемые в центрах обработки данных Microsoft Azure. Обновленный файл публикуется еженедельно и отражает развернутые в настоящее время диапазоны и все предстоящие изменения IP-адресов. Новые диапазоны, появившиеся в файле, не будут использоваться в центрах обработки данных по крайней мере одну неделю. Скачивайте новый XML-файл каждую неделю и вносите соответствующие изменения на своем сайте, чтобы правильно определять службы, выполняемые в Azure. Пользователи Express Route могут заметить, что этот файл используется для того, чтобы обновлять объявление BGP пространства Azure в первую неделю каждого месяца. 

## <a name="how-can-i-use-azure-resource-manager-vnets-with-cloud-services"></a>Как использовать виртуальные сети Azure Resource Manager совместно с облачными службами? 

Облачные службы нельзя разместить в виртуальных сетях Azure Resource Manager, но такие виртуальные сети можно соединять с классическими виртуальными сетями при помощи пирингового подключения. Дополнительные сведения см. в статье [Пиринг между виртуальными сетями](../virtual-network/virtual-network-peering-overview.md).