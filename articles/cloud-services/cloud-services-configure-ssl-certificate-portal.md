<properties 
	pageTitle="Настройка SSL для облачной службы | Microsoft Azure" 
	description="Узнайте, как определить конечную точку HTTPS для веб-роли и как передать SSL-сертификат, чтобы обеспечить безопасность приложения. В этих примерах используется портал Azure." 
	services="cloud-services" 
	documentationCenter=".net" 
	authors="Thraka" 
	manager="timlt" 
	editor=""/>

<tags 
	ms.service="cloud-services" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="07/05/2016"
	ms.author="adegeo"/>




# Настройка SSL для приложения в Azure

> [AZURE.SELECTOR]
- [Портал Azure](cloud-services-configure-ssl-certificate-portal.md)
- [Классический портал Azure](cloud-services-configure-ssl-certificate.md)

SSL-шифрование — это наиболее распространенный метод обеспечения безопасности данных, отправленных через Интернет. В этой теме, посвященной общим задачам, обсуждается, как определить конечную точку HTTPS для веб-роли и как передать SSL-сертификат, чтобы обеспечить безопасность приложения.

> [AZURE.NOTE] Процедуры в этом задании применяются для облачных служб Azure. Информацию о процедурах для служб приложений см. в [этом разделе](../app-service-web/web-sites-configure-ssl-certificate.md).

В этой задаче будет использоваться производственное развертывание; сведения об использовании промежуточного развертывания приведены в конце данной темы.

Если вы еще не создали облачную службу, сначала прочтите [эту статью](cloud-services-how-to-create-deploy-portal.md).

[AZURE.INCLUDE [websites-cloud-services-css-guided-walkthrough](../../includes/websites-cloud-services-css-guided-walkthrough.md)]

## Шаг 1. Получение SSL-сертификата

Чтобы настроить SSL для приложения, сначала необходимо получить SSL-сертификат, подписанный центром сертификации, то есть доверенным сторонним поставщиком, который выдает сертификаты для этой цели. Если у вас еще нет сертификата, нужно получить его в компании, продающей SSL-сертификаты.

Сертификат должен отвечать следующим требованиям для SSL-сертификатов в Azure.

-   Сертификат должен содержать закрытый ключ.
-   Сертификат должен быть создан для обмена ключами, которые можно экспортировать в файл обмена личной информацией (PFX-файл).
-   Имя субъекта сертификата должно совпадать с именем домена, которое используется для обращения к облачной службе. Не удается получить SSL-сертификат от центра сертификации (ЦС) в домене cloudapp.net. Необходимо получить имя пользовательского домена для использования при получении доступа к службе. При запросе сертификат в ЦС имя субъекта сертификата должно совпадать с именем пользовательского домена, которое используется для доступа к вашему приложению. Например, если вы используете домен **contoso.com**, необходимо запросить сертификат из центра сертификации для ***.contoso.com** или **www.contoso.com**.
-   Сертификат должен использовать как минимум 2048-разрядное шифрование.

В целях тестирования вы можете [создать](cloud-services-certs-create.md) и использовать самозаверяющий сертификат. Самозаверяющий сертификат не прошел аутентификацию через ЦС, и можно использовать домен cloudapp.net в качестве URL-адреса веб-сайта. Например, в нижеприведенной задаче используется самозаверяющий сертификат, в котором находится общее имя (CN) в сертификате **sslexample.cloudapp.net**.

Далее необходимо включить сведения о сертификате в файлы определения службы и конфигурации службы.

<a name="modify"> </a>
## Шаг 2. Изменение файлов определения службы и конфигурации

Ваше приложение должно быть настроено для использования сертификата и также необходимо добавить конечную точку HTTPS. Для этого следует обновить файлы определения службы и конфигурации службы.

1.  В среде разработки откройте файл определения службы (CSDEF-файл), добавьте раздел **Certificates** внутри раздела **WebRole** и включите следующие сведения о сертификате (и промежуточных сертификатах).

        <WebRole name="CertificateTesting" vmsize="Small">
        ...
            <Certificates>
                <Certificate name="SampleCertificate" 
							 storeLocation="LocalMachine" 
                    		 storeName="My"
                             permissionLevel="limitedOrElevated" />
                <!-- IMPORTANT! Unless your certificate is either
                self-signed or signed directly by the CA root, you
                must include all the intermediate certificates
                here. You must list them here, even if they are
                not bound to any endpoints. Failing to list any of
                the intermediate certificates may cause hard-to-reproduce
                interoperability problems on some clients.-->
                <Certificate name="CAForSampleCertificate"
                             storeLocation="LocalMachine"
                             storeName="CA"
                             permissionLevel="limitedOrElevated" />
            </Certificates>
        ...
        </WebRole>

    В разделе **Certificates** определяется имя сертификата, его расположение и имя хранилища, в котором он находится.
    
    Разрешениям (атрибуту `permisionLevel`) можно присвоить одно из следующих значений:

    | Значение разрешения | Описание |
    | ----------------  | ----------- |
    | limitedOrElevated | **(По умолчанию).** Все процессы роли могут получить доступ к закрытому ключу. |
    | elevated | Доступ к закрытому ключу могут получить только процессы повышенного уровня.|

2.  В файле определения службы добавьте элемент **InputEndpoint** в раздел **Endpoints**, чтобы включить HTTPS:

        <WebRole name="CertificateTesting" vmsize="Small">
        ...
            <Endpoints>
                <InputEndpoint name="HttpsIn" protocol="https" port="443" 
                    certificate="SampleCertificate" />
            </Endpoints>
        ...
        </WebRole>

3.  В файле определения службы добавьте элемент **Binding** в раздел **Sites**. Это действие добавляет привязку HTTPS для сопоставления конечной точки с вашим сайтом:

        <WebRole name="CertificateTesting" vmsize="Small">
        ...
            <Sites>
                <Site name="Web">
                    <Bindings>
                        <Binding name="HttpsIn" endpointName="HttpsIn" />
                    </Bindings>
                </Site>
            </Sites>
        ...
        </WebRole>

    Итак, все необходимые изменения внесены в файл определения службы, но еще нужно добавить сведения о сертификате в сам файл конфигурации службы.

4.  В файле конфигурации службы (CSCFG), ServiceConfiguration.Cloud.cscfg, добавьте раздел **Certificates** в раздел **Role**, заменяя приведенный ниже пример значения отпечатка сертификата на значение отпечатка вашего сертификата:

        <Role name="Deployment">
        ...
            <Certificates>
                <Certificate name="SampleCertificate" 
                    thumbprint="9427befa18ec6865a9ebdc79d4c38de50e6316ff" 
                    thumbprintAlgorithm="sha1" />
                <Certificate name="CAForSampleCertificate"
                    thumbprint="79d4c38de50e6316ff9427befa18ec6865a9ebdc" 
                    thumbprintAlgorithm="sha1" />
            </Certificates>
        ...
        </Role>

(В приведенном выше примере для алгоритма отпечатка используется обозначение **sha1**.) Укажите соответствующее значение для алгоритма отпечатка своего сертификата.)

Теперь, когда файлы определения службы и конфигурации службы обновлены, создайте пакет развертывания для передачи в Azure. Если используется **cspack**, убедитесь, что вы не используете флаг **/generateConfigurationFile**, поскольку это приведет к перезаписи сведений о сертификате, которые вы только что добавили.

## Шаг 3. Загрузка сертификата

Подключитесь к порталу и...

1. Выберите на портале свою **облачную службу**. Она находится в разделе **Все ресурсы**.
    
    ![Публикация облачной службы](media/cloud-services-configure-ssl-certificate-portal/browse.png)

3. Откройте **Параметры** облачной службы.

    ![Откройте параметры](media/cloud-services-configure-ssl-certificate-portal/all-settings.png)

4. Щелкните **Сертификаты**.

    ![Щелкните значок «сертификаты»](media/cloud-services-configure-ssl-certificate-portal/certificate-item.png)

4. Укажите **Файл** и **Пароль**, затем нажмите **Загрузить**.

## Шаг 4. Подключение к экземпляру роли с использованием HTTPS

Теперь, когда развертывание готово и работает в Azure, вы можете подключиться к нему, используя HTTPS.
    
1.  Щелкните по **URL-адресу сайта**, и откроется окно браузера.

    ![Щелкните по URL-адресу сайта](media/cloud-services-configure-ssl-certificate-portal/navigate.png)

2.  В своем браузере измените ссылку таким образом, чтобы использовать **https** вместо **http**, и перейдите на страницу.

    >[AZURE.NOTE] Если используется самозаверяющий сертификат, то при переходе к конечной точке HTTPS, связанной с самозаверяющим сертификатом, в браузере появится сообщение об ошибке сертификата. Эту проблему можно устранить, воспользовавшись сертификатом, подписанным доверенным центром сертификации. Пока это не будет сделано, вы можете игнорировать данную ошибку. (Другой способ — добавить самозаверяющий сертификат в используемое хранилище сертификатов доверенного центра сертификации.)

    ![Предварительный просмотр сайта](media/cloud-services-configure-ssl-certificate-portal/show-site.png)

    >[AZURE.TIP] Если вы хотите использовать SSL для промежуточного развертывания вместо производственного, вам нужно сначала определить URL-адрес, используемый для промежуточного развертывания. После развертывания облачной службы URL-адрес промежуточной среды определяется по **идентификатору развертывания** GUID и имеет следующий формат:`https://deployment-id.cloudapp.net/`
      
    >Создайте сертификат с общим именем (CN), соответствующим полученному по GUID URL-адресу (например, **328187776e774ceda8fc57609d404462.cloudapp.net**), в портале управления добавьте сертификат в промежуточную облачную службу, затем добавьте сведения о сертификате в файлы CSDEF и CSCFG, повторно создайте пакет приложения и обновите промежуточное развертывание для использования нового пакета и файла CSCFG.

## Дальнейшие действия

* [Общая настройка облачной службы](cloud-services-how-to-configure-portal.md).
* Узнайте, как [развернуть облачную службу](cloud-services-how-to-create-deploy-portal.md).
* Настройте [пользовательское доменное имя](cloud-services-custom-domain-name-portal.md).
* [Управляйте облачной службой](cloud-services-how-to-manage-portal.md).

<!---HONumber=AcomDC_0706_2016-->