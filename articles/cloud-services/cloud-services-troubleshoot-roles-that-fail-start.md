<properties
   pageTitle="Устранение неполадок, если роли не запускаются | Microsoft Azure"
   description="Здесь описаны самые распространенные причины, по которым роль облачной службы может не запуститься. Приведены также решения этих проблем."
   services="cloud-services"
   documentationCenter=""
   authors="simonxjx"
   manager="felixwu"
   editor=""
   tags="top-support-issue"/>
<tags
   ms.service="cloud-services"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="tbd"
   ms.date="05/26/2016"
   ms.author="v-six" />

# Устранение неполадок, если роли облачной службы не запускаются

Ниже приведены некоторые распространенные проблемы и решения на случай, если роли облачной службы Azure не запускаются.

## Обращение в службу поддержки клиентов Azure

Если в любой момент при изучении этой статьи вам потребуется дополнительная помощь, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/).

Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [веб-сайт поддержки Azure](http://azure.microsoft.com/support/options/) и щелкните **Получить поддержку**. Дополнительные сведения об использовании службы поддержки Azure см. в статье [Часто задаваемые вопросы о поддержке Microsoft Azure](http://azure.microsoft.com/support/faq/).

## Отсутствующие DLL-библиотеки и зависимости

Если роли не отвечают или циклически переключаются между состояниями **Инициализация**, **Занято** и **Остановка**, это может быть вызвано отсутствием сборок или библиотек DLL.

Симптомы отсутствия сборок и библиотек DLL могут быть такими:

- экземпляр роли циклически переключается между состояниями **Инициализация**, **Занято** и **Остановка**;
- экземпляр роли перешел в состояние **Готово**, но при переходе к веб-приложению страница не отображается.

Эти проблемы можно решить несколькими способами.

## Диагностика неполадок в связи с отсутствующими библиотеками DLL в веб-роли

Когда вы переходите на веб-сайт, развернутый в веб-роли, в браузере отображается похожее сообщение об ошибке сервера, которое может указывать на то, что библиотека DLL отсутствует:

![Ошибка сервера в приложении «/».](./media/cloud-services-troubleshoot-roles-that-fail-start/ic503388.png)

## Диагностика проблем с помощью отключения режима настраиваемых ошибок

Для полного отображения ошибки настройте файл web.config для веб-роли, чтобы отключить режим настраиваемых ошибок, и повторно разверните службу.

Чтобы просмотреть ошибки полностью без использования удаленного рабочего стола, выполните следующие действия.

1. Откройте решение в Microsoft Visual Studio.

2. В **обозревателе решений** найдите файл web.config и откройте его.

3. В файле web.config найдите раздел system.web и добавьте следующую строку:

    ```xml
    <customErrors mode="Off" />
    ```

4. Сохраните файл.

5. Перепакуйте и повторно разверните службу.

Когда служба будет повторно развернута, ниже отобразится сообщение об ошибке, содержащее имя отсутствующей сборки или библиотеки DLL.

## Диагностика проблем с помощью удаленного изучения ошибок

Чтобы получить удаленный доступ к роли и просмотреть информацию об ошибках полностью, вы можете использовать удаленный рабочий стол. Чтобы просмотреть ошибки с помощью удаленного рабочего стола, сделайте следующее:

1. Убедитесь, что установлен пакет SDK для Azure версии 1.3 или более поздней.

2. Во время развертывания решения с помощью Visual Studio щелкните "Настроить подключения к удаленному рабочему столу...". Дополнительные сведения о настройке подключения к удаленному рабочему столу см. в статье [Использование удаленного рабочего стола с ролями Azure](../vs-azure-tools-remote-desktop-roles.md).

3. Когда для экземпляра отобразится состояние **Готово**, на классическом портале Microsoft Azure щелкните один из экземпляров роли.

4. В области **Удаленный доступ** ленты щелкните значок **Подключить**.

5. Войдите в виртуальную машину, используя учетные данные, указанные во время настройки удаленного рабочего стола.

6. Откройте командное окно.

7. Введите `IPconfig`.

8. Запомните IPV4-адрес.

9. Откройте браузер Internet Explorer.

10. Введите адрес и имя веб-приложения. Пример: `http://<IPV4 Address>/default.aspx`.

Если перейти на веб-сайт, отобразятся более точные сообщения об ошибках.

* Ошибка сервера в приложении «/».

* Описание: произошло необработанное исключение во время выполнения текущего веб-запроса. Чтобы получить дополнительную информацию об ошибке и ее источнике в коде, изучите трассировку стека.

* Сведения об исключении: System.IO.FIleNotFoundException: не удалось загрузить файл, сборку Microsoft.WindowsAzure.StorageClient, Version=1.1.0.0, Culture=neutral, PublicKeyToken=31bf856ad364e35 или какую-то их зависимость. Системе не удается найти указанный файл.

Например:

![Явная ошибка сервера в приложении «/».](./media/cloud-services-troubleshoot-roles-that-fail-start/ic503389.png)

## Диагностика неполадок с помощью эмулятора вычислений

Вы можете использовать эмулятор вычислений Microsoft Azure, чтобы диагностировать и устранять неполадки, связанные с отсутствующими зависимостями, а также ошибки web.config.

Чтобы улучшить результаты использования этого метода диагностики, следует использовать компьютер или виртуальную машину, на которой выполнена чистая установка Windows. Чтобы лучше имитировать среду Azure, следует использовать 64-разрядную версию Windows Server 2008 R2.

1. Установите изолированную версию пакета [SDK Azure](https://azure.microsoft.com/downloads/).

2. На компьютере разработки создайте проект облачной службы.

3. В проводнике перейдите к папке bin\\debug проекта облачной службы.

4. Скопируйте папку CSX и CSCFG-файл на компьютер, который вы используете для устранения проблем.

5. На чистой машине откройте окно командной строки пакета SDK для Azure и введите `csrun.exe /devstore:start`.

6. В командной строке выполните следующую команду: `run csrun <path to .csx folder> <path to .cscfg file> /launchBrowser`.

7. Когда роль запускается, в браузере Internet Explorer отображается подробная информация об ошибке. Для более подробной диагностики вы можете использовать также стандартные средства устранения неполадок Windows.

## Диагностика неполадок с помощью IntelliTrace

Для рабочих ролей и веб-ролей, которые используют платформу .NET Framework 4, можно использовать функцию [IntelliTrace](https://msdn.microsoft.com/library/dd264915.aspx), доступную в [Microsoft Visual Studio Ultimate](https://www.visualstudio.com/products/visual-studio-ultimate-with-MSDN-vs).

Чтобы развернуть службу с активной функцией IntelliTrace, выполните следующие действия.

1. Убедитесь, что установлен пакет SDK для Azure версии 1.3 или более поздней.

2. Разверните решение с помощью Visual Studio. Во время развертывания установите флажок **Включить IntelliTrace для ролей .NET 4**.

3. После запуска экземпляра откройте **обозреватель сервера**.

4. Разверните узел **Azure\\облачные службы** и найдите развертывание.

5. Разверните развертывание и найдите в нем экземпляры роли. Щелкните правой кнопкой мыши один из экземпляров.

6. Выберите элемент **Просмотр журналов IntelliTrace**. Откроется **сводка IntelliTrace**.

7. Найдите в сводке раздел исключений. При наличии исключений он будет называться **Данные исключения**.

8. Разверните раздел **Данные исключения** и поищите ошибки **System.IO.FileNotFoundException**, подобные этой:

![Данные исключения, отсутствующий файл или сборка](./media/cloud-services-troubleshoot-roles-that-fail-start/ic503390.png)

## Устранение ошибок из-за отсутствующих библиотек DLL и сборок

Чтобы устранить ошибки отсутствующих библиотек DLL и сборок, выполните следующие действия.

1. Откройте решение в Visual Studio.

2. В **обозревателе решений** откройте папку **Ссылки**.

3. Щелкните сборку, указанную в сообщении об ошибке.

4. На панели **Свойства** найдите свойство **Copy Local** и задайте для него значение **True**.

5. Повторно разверните облачную службу.

Убедившись, что все ошибки исправлены, вы можете развернуть службу, не устанавливая флажок **Включить IntelliTrace для ролей .NET 4**.

## Дальнейшие действия

Просмотрите дополнительные [статьи об устранении неполадок](..\?tag=top-support-issue&service=cloud-services) в облачных службах.

Чтобы узнать, как устранять неполадки ролей облачной службы с помощью диагностических данных компьютеров Azure PaaS, см. [серию статей в блоге Кевина Уильямсона](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).

<!---HONumber=AcomDC_0601_2016-->