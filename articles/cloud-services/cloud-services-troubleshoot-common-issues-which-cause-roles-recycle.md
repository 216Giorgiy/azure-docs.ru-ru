<properties 
   pageTitle="Распространенные причины перезапуска ролей облачных служб | Microsoft Azure"
   description="Внезапно перезапускающаяся роль облачной службы может привести к длительному простою. Ниже приведены некоторые распространенные проблемы, вызывающие перезапуск ролей, что может приводить к увеличению времени простоя."
   services="cloud-services"
   documentationCenter=""
   authors="dalechen"
   manager="msmets"
   editor=""
   tags="top-support-issue"/>
<tags 
   ms.service="cloud-services"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="tbd"
   ms.date="10/14/2015"
   ms.author="daleche" />

# Распространенные проблемы, которые вызывают повторное использование ролей

Здесь приведены некоторые распространенные причины проблем с развертыванием, а также советы по их устранению. На наличие проблем с приложением указывает то, что экземпляр роли не запускается или циклически переключается между состояниями **инициализации**, **работы** и **остановки**.

## Обращение в службу поддержки клиентов Azure

Если в любой момент при изучении этой статьи вам потребуется дополнительная помощь, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](http://azure.microsoft.com/support/forums/).

Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт службы поддержки Azure](http://azure.microsoft.com/support/options/) и щелкните **Поддержка**. Дополнительные сведения об использовании службы поддержки Azure см. в статье [Часто задаваемые вопросы о поддержке Microsoft Azure](http://azure.microsoft.com/support/faq/).


## Отсутствующие зависимости среды выполнения

Если роль в приложении использует какую-либо сборку, которая не является частью управляемой библиотеки Azure или платформы .NET Framework, необходимо явно включить эту сборку в пакет приложения. Имейте в виду, что другие платформы Майкрософт недоступны в Azure по умолчанию. Если ваша роль использует такую платформу, необходимо добавить эти сборки в пакет приложения.

Перед сборкой и упаковкой приложения проверьте следующее.

- При работе в Visual Studio убедитесь, что свойство **Копировать локально** имеет значение **True** для каждой упоминаемой в проекте сборки, которая не является частью пакета SDK для Azure или платформы .NET Framework.

- Убедитесь, что файл **web.config** не ссылается на любые неиспользуемые сборки в элементе **compilation**.
 
- Параметр **Действие при сборке** для каждого CSHTML-файла имеет значение **Содержимое**. Это обеспечивает правильное отображение файлов в пакете, а также позволяет указать в этом пакете другие файлы, на которые имеются ссылки.



## Сборка нацелена на неверную платформу.

Azure является 64-разрядной средой. Таким образом, сборки .NET, скомпилированные для 32-разрядной среды, не будут работать в Azure.



## Роль вызывает необработанные исключения во время инициализации или остановки.

Любые исключения, выдаваемые методами класса [RoleEntryPoint], к которым относятся [OnStart], [OnStop] и [Run], являются необработанными. В случае возникновения необработанного исключения в одном из этих методов роль будет перезапущена. Если роль постоянно перезапускается, возможно, она вызывает необработанное исключение при каждой попытке запуска.


## Роль возвращается из метода Run.

Метод [Run] должен работать постоянно. Если ваш код переопределяет метод [Run], он должен постоянно находиться в режиме ожидания. В случае возврата метода [Run] роль перезапускается.




## Неверный параметр DiagnosticsConnectionString

Если приложение использует систему диагностики Microsoft Azure, то в файле конфигурации службы необходимо указать параметр конфигурации `DiagnosticsConnectionString`. Этот параметр должен указывать HTTPS-подключение к вашей учетной записи хранения в Azure.

Чтобы убедиться в правильности параметра `DiagnosticsConnectionString` перед развертыванием пакета приложения в Azure, проверьте следующее.

- Параметр `DiagnosticsConnectionString` указывает на действительную учетную запись хранения в Azure. По умолчанию этот параметр указывает на эмулированную учетную запись хранения, поэтому необходимо явным образом изменить его перед развертыванием пакета приложения. Если этого не сделать, то при попытке экземпляра роли запустить монитор диагностики возникает исключение. Это может вызвать бесконечный перезапуск экземпляра роли.
  
- Строка подключения указывается в следующем [формате](storage-configure-connection-string.md) (должен быть задан протокол HTTPS). Замените *MyAccountName* именем своей учетной записи хранения, а *MyAccountKey* — своим ключом доступа:

        DefaultEndpointsProtocol=https;AccountName=MyAccountName;AccountKey=MyAccountKey

  Если вы разрабатываете приложение с помощью инструментов Azure для Microsoft Visual Studio, для задания этого значения можно использовать [страницы свойств](https://msdn.microsoft.com/library/ee405486).



## Экспортированный сертификат не содержит закрытый ключ.

Чтобы запустить веб-роль с SSL, необходимо убедиться, что экспортированный сертификат управления содержит закрытый ключ. При использовании *диспетчера сертификатов Windows* для экспорта сертификата не забудьте выбрать значение *Да* для параметра экспорта закрытого ключа. Сертификат следует экспортировать в формат PFX, так как в настоящее время поддерживается только он.



## Дальнейшие действия

Просмотрите дополнительные [статьи об устранении неполадок](..\?tag=top-support-issue&service=cloud-services) в облачных службах.




[RoleEntryPoint]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx
[OnStart]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx
[OnStop]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx
[Run]: https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx

<!---HONumber=Oct15_HO4-->