<properties 
	pageTitle="Настройка автомасштабирования для облачной службы | Microsoft Azure" 
	description="Узнайте, как с помощью портала настроить правила автоматического масштабирования для облачной службы и связанных ресурсов в Azure." 
	services="cloud-services" 
	documentationCenter="" 
	authors="Thraka" 
	manager="timlt" 
	editor=""/>

<tags 
	ms.service="cloud-services" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="12/07/2015"
	ms.author="adegeo"/>





# Автомасштабирование приложения

На странице "Масштаб" классического портала Azure можно вручную масштабировать приложение или задать параметры для автоматического масштабирования. Можно масштабировать приложения, которые выполняют веб-роли, рабочие роли или виртуальные машины. Чтобы масштабировать приложение, которое выполняет экземпляры веб-ролей или рабочих ролей, необходимо распределить рабочую нагрузку путем добавления или удаления экземпляров.

При масштабировании приложения, в котором работают виртуальные машины, новые машины не создаются и не удаляются, а включаются или отключаются в группе доступности ранее созданных машин. Масштабирование можно задать как на основе среднего процента использования ЦП, так и на основе количества сообщений в очереди.

При настройке масштабирования приложения следует учитывать следующие сведения.

- Необходимо добавить созданные виртуальные машины в группу доступности, чтобы масштабировать использующее их приложение. Добавляемые виртуальные машины могут быть изначально включены или выключены, однако они будут включены при увеличении масштабирования и выключены при его уменьшении. Дополнительную информацию о виртуальных машинах и группах доступности см. в разделе [Управление доступностью виртуальных машин](../virtual-machines-manage-availability.md).

- Масштабирование зависит от использования ядер. Более крупные экземпляры ролей или виртуальные машины задействуют больше ядер. Масштабировать приложение можно только в пределах количества ядер по используемой подписке. Например, если подписка ограничена двадцатью ядрами и выполняется приложение с двумя средними по размерам виртуальными машинами (всего четыре ядра), можно увеличить масштаб других развернутых в рамках подписки облачных служб на шестнадцать ядер. Все виртуальные машины в группе доступности, используемые при масштабировании приложения, должны быть одного размера. Дополнительную информацию об использовании ядер и размерах машин см. в разделе [Размеры виртуальных машин и облачных служб для Azure](http://msdn.microsoft.com/library/dn197896.aspx).

- Прежде чем приступить к масштабированию приложения на основе порогового значения сообщений, необходимо создать очередь и связать ее с ролью или группой доступности. Дополнительную информацию см. в разделе [How to use the Queue Storage Service](../storage-dotnet-how-to-use-queues.md) (Как использовать службу хранения очередей).

- Можно масштабировать ресурсы, привязанные к используемой облачной службе. Дополнительные сведения о связанных ресурсах см. в разделе [Практическое руководство. Связывание ресурса с облачной службой](cloud-services-how-to-manage.md#how-to-link-a-resource-to-a-cloud-service).

- В целях обеспечения высокой доступности приложения необходимо убедиться, что приложение развернуто с двумя и более экземплярами ролей или виртуальных машин. Дополнительные сведения см. в разделе [Соглашения об уровне обслуживания](http://azure.microsoft.com/support/legal/sla/).


## вручную масштабировать приложение, которое выполняет веб-роли или рабочие роли;

На странице масштаба можно вручную увеличить или уменьшить количество работающих в облачной службе экземпляров.

1. На [классическом портале Azure](https://manage.windowsazure.com/) щелкните **Облачные службы**, затем щелкните имя облачной службы, чтобы открыть панель мониторинга.

2. Щелкните пункт **Масштаб**. Автоматическое масштабирование по умолчанию отключено для всех ролей, что позволяет вручную изменить количество экземпляров, используемых приложением.

    ![Страница масштабирования][manual_scale]

3. Каждая роль в облачной службе имеет ползунок для изменения количества используемых экземпляров. Чтобы добавить экземпляр роли, перетащите ползунок вправо. Чтобы удалить экземпляр, перетащите ползунок влево.
    
    ![Масштабирование роли][slider_role]
    
    Количество используемых экземпляров можно увеличить только в том случае, если для поддержки этих экземпляров используется достаточное количество ядер. Цвета ползунка представляют используемые и доступные по подписке ядра:
    
    - синий цвет означает ядра, которые используются выбранной ролью;
    
    - темно-серый цвет означает ядра, которые используются всеми ролями и виртуальными машинами в рамках подписки;
    
    - светло-серый цвет означает ядра, доступные для использования в рамках масштабирования;
    
    - розовый цвет означает внесенные изменения, которые еще не были сохранены.

4. Щелкните **Сохранить**. Экземпляры роли добавляются и удаляются в зависимости от пользовательского выбора.

## Автоматическое масштабирование приложения, выполняющего веб-роли, рабочие роли или виртуальные машины

На странице "Масштаб" можно настроить облачную службу для автоматического увеличения или уменьшения количества экземпляров или виртуальных машин, используемых приложением. Можно настроить масштабирование на основе следующих параметров:

- [Среднее использование ЦП](#averagecpu) — если средний процент использования ЦП превышает определенные пороговые значения или опускается ниже этих значений, будет выполняться создание или удаление экземпляров роли, включение виртуальных машин в группу доступности или их исключение из нее.
- [Сообщения в очереди](#queuemessages) — если количество сообщений в очереди превышает определенное пороговое значение или опускается ниже его, экземпляры роли создаются или удаляются или виртуальные машины включаются в группу доступности или исключаются из нее.

## Среднее использование ЦП

1. На [классическом портале Azure](https://manage.windowsazure.com/) щелкните **Облачные службы**, затем щелкните имя облачной службы, чтобы открыть панель мониторинга.

2. Щелкните пункт **Масштаб**.

3. Перейдите к разделу роли или группы доступности и щелкните пункт **ЦП**. Это приведет к включению автоматического масштабирования приложения на основе среднего процента ресурсов ЦП, которые оно использует.

    ![Автомасштабирование включено][autoscale_on]

4. Каждая роль или группа доступности имеет ползунок для изменения числа экземпляров, доступного для использования. Чтобы задать максимальное количество доступных для использования экземпляров, перетащите вправо расположенный справа ползунок. Чтобы задать минимальное количество доступных для использования экземпляров, перетащите влево расположенный слева ползунок.
    
    **Примечание.** На странице "Масштаб" раздел **Экземпляр** представляет экземпляр роли или экземпляр виртуальной машины.
    
    ![Диапазон экземпляров][instance_range]
    
    Максимальное число экземпляров ограничено числом ядер, доступных в рамках используемой подписки. Цвета ползунка представляют используемые и доступные по подписке ядра:
    
    - синий цвет представляет максимальное количество ядер, доступных для использования ролью;
    
    - темно-серый цвет означает ядра, которые используются всеми ролями и виртуальными машинами в рамках подписки; Если это значение превышает количество ядер, используемых ролью, цвет меняется на темно-синий;
    
    - светло-серый цвет означает ядра, доступные для использования в рамках масштабирования;
    
    - розовый цвет означает внесенные изменения, которые еще не были сохранены.

5. Ползунок используется для определения диапазона среднего процента использования ЦП. Если средний процент использования ЦП превышает заданное максимальное значение, создаются дополнительные экземпляры роли или включаются виртуальные машины. Если средний процент использования ЦП опускается ниже заданного минимального значения, экземпляры роли удаляются или виртуальные машины выключаются. Чтобы задать максимальный средний процент ЦП, перетащите расположенный справа ползунок вправо. Чтобы задать минимальный средний процент использования ЦП, перетащите расположенный слева ползунок влево.

    ![Целевой ЦП][target_cpu]

6. Можно указать число экземпляров для добавления или включения при каждом масштабировании приложения вверх. Чтобы увеличить количество экземпляров, создаваемых или включаемых при масштабировании приложения в сторону увеличения, перетащите ползунок вправо. Чтобы уменьшить это количество, перетащите ползунок влево.

    ![Увеличение масштаба ЦП][scale_cpuup]

7. Задайте количество минут ожидания между предыдущим действием по масштабированию и следующим действием по увеличению масштаба. Последнее действие по масштабированию может быть как увеличением, так и уменьшением масштаба.

    ![Увеличение масштаба][scale_uptime]

    При вычислении среднего процента использования ЦП учитываются все экземпляры, а среднее значение основано на использовании в течение предыдущего часа. В зависимости от количества экземпляров, используемых приложением, действие по масштабированию может занять дольше указанного времени ожидания, если для последнего указано слишком низкое значение. Минимальное время между масштабированием составляет пять минут. Действия по масштабированию не могут возникать, если любой из экземпляров находится в состоянии перехода.

8. Можно также указать количество экземпляров для удаления или выключения при масштабировании приложения в сторону уменьшения. Чтобы увеличить количество экземпляров, удаляемых или выключаемых при масштабировании приложения в сторону уменьшения перетащите ползунок вправо. Чтобы уменьшить это количество, перетащите ползунок влево.

    ![Уменьшение масштаба ЦП][scale_cpudown]
    
    Если приложение характеризуется внезапными всплесками использования ЦП, необходимо убедиться в наличии достаточного минимального количества экземпляров для надлежащей обработки этой активности.

9. Задайте количество минут ожидания между предыдущим действием по масштабированию и следующим действием по уменьшению масштаба. Последнее действие по масштабированию может быть как увеличением, так и уменьшением масштаба.

    ![Уменьшение масштаба][scale_downtime]

10. Щелкните **Сохранить**. Масштабирование может выполняться в течение до пяти минут.

## Сообщения в очереди

1. На [классическом портале Azure](https://manage.windowsazure.com/) щелкните **Облачные службы**, затем щелкните имя облачной службы, чтобы открыть панель мониторинга.
2. Щелкните пункт **Масштаб**.
3. Перейдите к разделу роли или группы доступности и щелкните пункт **Очередь**. Будет включено автоматическое масштабирование приложения на основе целевого количества сообщений в очереди.

    ![Очередь масштабирования][scale_queue]

4. Каждая роль или группа доступности в облачной службе имеет ползунок для изменения доступного для использования числа экземпляров. Чтобы задать максимальное количество доступных для использования экземпляров, перетащите вправо расположенный справа ползунок. Чтобы задать минимальное количество доступных для использования экземпляров, перетащите влево расположенный слева ползунок.

    ![Диапазон очереди][queue_range]
    
    **Примечание.** На странице "Масштаб" раздел **Экземпляр** представляет экземпляр роли или экземпляр виртуальной машины.
    
    Максимальное число экземпляров ограничено числом ядер, доступных в рамках используемой подписки. Цвета ползунка представляют используемые и доступные по подписке ядра. Синий цвет представляет максимальное количество ядер, которое может использовать роль. Темно-серый цвет представляет ядра, которые используются всеми ролями и виртуальными машинами в подписке. Если это значение превышает количество ядер, используемых ролью, цвет меняется на темно-синий. Светло-серый цвет представляет ядра, которые можно использовать для масштабирования. Розовый цвет представляет изменение, которое было внесено, но не сохранено.

5. Выберите учетную запись хранения, связанную с очередью, которую следует использовать.

    ![Имя хранилища][storage_name]

6. Выберите очередь.

    ![Имя очереди][queue_name]

7. Укажите количество сообщений, которое должно поддерживаться каждым экземпляром. Экземпляры будут масштабироваться на основе общего числа сообщений, разделенного на целевое количество сообщений на один компьютер.

    ![Количество сообщений][message_number]

8. Можно указать число экземпляров для добавления или включения при каждом масштабировании приложения вверх. Чтобы увеличить количество экземпляров, добавляемых или включаемых при масштабировании приложения в сторону увеличения, перетащите ползунок вправо. Чтобы уменьшить это количество, перетащите ползунок влево.

    ![Увеличение масштаба ЦП][scale_cpuup]

9. Задайте количество минут ожидания между предыдущим действием по масштабированию и следующим действием по увеличению масштаба. Последнее действие по масштабированию может быть как увеличением, так и уменьшением масштаба.

    ![Увеличение масштаба][scale_uptime]
    
    Минимальное время между масштабированием составляет пять минут. Действия по масштабированию не могут возникать, если любой из экземпляров находится в состоянии перехода.

10. Можно также указать количество экземпляров для удаления или прекращения использования при масштабировании приложения вниз. Ползунок используется для определения шага масштабирования. Чтобы увеличить количество экземпляров, удаляемых или не используемых при масштабировании приложения в сторону уменьшения перетащите ползунок вправо. Чтобы уменьшить это количество, перетащите ползунок влево.

    ![Уменьшение масштаба ЦП][scale_cpudown]

11.	Задайте количество минут ожидания между предыдущим действием по масштабированию и следующим действием по уменьшению масштаба. Последнее действие по масштабированию может быть как увеличением, так и уменьшением масштаба.

    ![Уменьшение масштаба][scale_downtime]

12. Щелкните **Сохранить**. Масштабирование может выполняться в течение до пяти минут.

## Масштабирование связанных ресурсов

Часто при масштабировании роли выгодно масштабировать также и базу данных, используемую приложением. Если база данных связана с облачной службой, можно изменить версию и размер базы данных SQL на странице "Масштабирование".

1. На [классическом портале Azure](https://manage.windowsazure.com/) щелкните **Облачные службы**, затем щелкните имя облачной службы, чтобы открыть панель мониторинга.
2. Щелкните пункт **Масштаб**.
3. В разделе "Связанные ресурсы" выберите версию, используемую для базы данных.

    ![Связанные ресурсы][linked_resources]

4. Выберите размер базы данных.
5. Нажмите кнопку **Сохранить**, чтобы обновить связанные ресурсы.

## Планирование масштабирования приложения

Можно запланировать автоматическое масштабирование приложения путем настройки расписаний для различных периодов. Для автоматического масштабирования доступны следующие параметры:

- **Без расписания** — это параметр по умолчанию, который делает возможным автоматическое масштабирование приложения одинаковым способом в любое время.

- **День и ночь** — этот параметр позволяет указывать масштабирование для определенного времени суток.

**Примечание.** Расписания в настоящее время недоступны для приложений, использующих виртуальные машины.

1. На [классическом портале Azure](https://manage.windowsazure.com/) щелкните **Облачные службы**, затем щелкните имя облачной службы, чтобы открыть панель мониторинга.
2. Щелкните пункт **Масштаб**.
3. На странице "Масштаб" выберите **Настройка расписания**

    ![Планирование масштабирования][scale_schedule]

4. Выберите тип расписания масштабирования, которое требуется настроить.

5. Укажите время начала и окончания дня, а также выберите часовой пояс. При планировании дня и ночи указывается время начала и конца дня, оставшееся время представляет ночь.

6. Чтобы сохранить расписания, щелкните флажок в нижней части страницы.

7. После сохранения расписаний они появятся в списке. Можно выбрать график, который требуется использовать, а затем изменить настройки масштабирования. Эти настройки масштабирования будут действовать только во время выбранного расписания. Расписания можно изменить, нажав кнопку **Настройка расписания**

[manual_scale]: ./media/cloud-services-how-to-scale/CloudServices_ManualScaleRoles.png
[slider_role]: ./media/cloud-services-how-to-scale/CloudServices_SliderRole.png
[autoscale_on]: ./media/cloud-services-how-to-scale/CloudServices_AutoscaleOn.png
[instance_range]: ./media/cloud-services-how-to-scale/CloudServices_InstanceRange.png
[target_cpu]: ./media/cloud-services-how-to-scale/CloudServices_TargetCPURange.png
[scale_cpuup]: ./media/cloud-services-how-to-scale/CloudServices_ScaleUpBy.png
[scale_uptime]: ./media/cloud-services-how-to-scale/CloudServices_ScaleUpWaitTime.png
[scale_cpudown]: ./media/cloud-services-how-to-scale/CloudServices_ScaleDownBy.png
[scale_downtime]: ./media/cloud-services-how-to-scale/CloudServices_ScaleDownWaitTime.png
[scale_queue]: ./media/cloud-services-how-to-scale/CloudServices_QueueScale.png
[queue_range]: ./media/cloud-services-how-to-scale/CloudServices_QueueRange.png
[storage_name]: ./media/cloud-services-how-to-scale/CloudServices_StorageAccountName.png
[queue_name]: ./media/cloud-services-how-to-scale/CloudServices_QueueName.png
[message_number]: ./media/cloud-services-how-to-scale/CloudServices_TargetMessageNumber.png
[linked_resources]: ./media/cloud-services-how-to-scale/CloudServices_ScaleLinkedResources.png
[scale_schedule]: ./media/cloud-services-how-to-scale/CloudServices_SetUpSchedule.png
 

<!---HONumber=AcomDC_1210_2015-->