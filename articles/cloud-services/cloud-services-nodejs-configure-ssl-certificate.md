<properties 
	pageTitle="Настройка SSL для облачной службы(Node.js) — Azure" 
	description="Установите конечную точку HTTPS для веб-роли Node.js и отправьте SSL-сертификат, чтобы обеспечить безопасность приложения." 
	services="cloud-services" 
	documentationCenter="nodejs" 
	authors="MikeWasson" 
	manager="wpickett" 
	editor=""/>

<tags 
	ms.service="cloud-services" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="na" 
	ms.devlang="nodejs" 
	ms.topic="article" 
	ms.date="02/20/2015" 
	ms.author="mwasson"/>




# Настройка SSL для приложения Node.js в веб-роли Azure

SSL-шифрование – это наиболее распространенный метод обеспечения безопасности данных, отправленных через Интернет. В этой теме, посвященной общим задачам, обсуждается, как определить конечную точку HTTPS для приложения Node.js, размещенного в облачной службе Azure в веб-роли, а также как передать SSL-сертификат, чтобы обеспечить безопасность приложения.

> [AZURE.NOTE]Действия, описанные в данной статье, применимы только к приложениям узла, размещенным в качестве облачной службы Azure в веб-роли; сведения, применимые к веб-сайтам, см. в разделе [Настройка SSL-сертификата для веб-сайта Azure](../web-sites-configure-ssl-certificate.md).

Эта задача включает следующие шаги:

-   [Шаг 1. Создание службы Node.js и ее публикация в облаке]
-   [Шаг 2. Получение SSL-сертификата]
-   [Шаг 3. Импорт сертификата SSL]
-   [Шаг 4. Изменение файлов определения и конфигурации службы]
-   [Шаг 5. Подключение к экземпляру роли с использованием HTTPS]

## <a name="step1"> </a>Шаг 1. Создание службы Node.js и ее публикация в облаке

При развертывании приложения Node.js в веб-роли Azure сертификат сервера и SSL-подключение управляются IIS, поэтому служба Node.js может быть записана в качестве http-службы. Чтобы создать простую службу Node.js hello world с помощью оболочки Azure PowerShell, выполните следующие действия.

1. В меню **Пуск** или на **Начальном экране** найдите **Azure PowerShell**. Щелкните правой кнопкой мыши **Azure PowerShell** и выберите **Запуск от имени администратора**.

	![Значок Azure PowerShell][powershell-menu]

[AZURE.INCLUDE [install-dev-tools](../../includes/install-dev-tools.md)]


2.  Создайте новый проект службы с помощью командлета **New-AzureServiceProject**. 

	![][1]

3.  Добавьте в службу веб-роль с помощью командлета **Add-AzureNodeWebRole**.

    ![][2]

4.  Опубликуйте службу в облаке с помощью командлета **Publish-AzureServiceProject**.

    ![][3]

	> [AZURE.NOTE]Если вы ранее не импортировали параметры публикации для своей подписки Azure, при попытке выполнить публикацию появится сообщение об ошибке. Дополнительные сведения о загрузке и импорте параметров публикации для подписки см. в разделе [Использование Azure PowerShell для Node.js](https://www.windowsazure.com/develop/nodejs/how-to-guides/powershell-cmdlets/#ImportPubSettings)

Значение **URL-адрес созданного веб-сайта**, возвращаемое командлетом **Publish-AzureServiceProject**, содержит полное доменное имя вашего размещенного приложения. Далее вам необходимо получить SSL-сертификат для указанного полного доменного имени и развернуть его в Azure.

## <a name="step2"> </a>Шаг 2. Получение SSL-сертификата

Чтобы настроить SSL для приложения, сначала необходимо получить SSL-сертификат, подписанный центром сертификации, то есть доверенным сторонним поставщиком, который выдает сертификаты для этой цели. Если у вас еще нет сертификата, нужно получить его в компании, продающей SSL-сертификаты.

Сертификат должен отвечать следующим требованиям для SSL-сертификатов в Azure.

-   Сертификат должен содержать закрытый ключ.
-   Сертификат должен быть создан для обмена ключами (PFX-файлами).
-   Имя субъекта сертификата должно совпадать с именем домена, которое используется для обращения к облачной службе. Вы не можете приобрести SSL-сертификат для домена cloudapp.net, поэтому имя субъекта сертификата должно совпадать с пользовательским именем домена, которое используется для доступа к вашему приложению. Например, __mysecuresite.cloudapp.net__.
-   Сертификат должен использовать как минимум 2048-разрядное шифрование.

## <a name="step3"> </a>Шаг 3. Импорт сертификата SSL

При наличии сертификата установите его в хранилище сертификатов на компьютере разработчика. Этот сертификат будет получен и передан в Azure как часть пакета развертывания приложения на основе изменений конфигурации, которые будут внесены на следующем шаге.

> [AZURE.NOTE]Действия, используемые в этом разделе, основаны на версии мастера импорта сертификатов в Windows 8. При использовании предыдущей версии Windows приведенные здесь действия могут не совпадать с порядком, отображаемым в мастере. В этом случае полностью прочитайте данный раздел, прежде чем использовать мастер импорта сертификатов, чтобы понимать, какие действия нужно выполнять в целом.

Чтобы импортировать SSL-сертификат, выполните следующие действия.

1.   С помощью проводника Windows перейдите в каталог, где находится **PFX-файл**, содержащий сертификат, а затем дважды щелкните по сертификату. Откроется мастер импорта сертификатов.
	
	![мастер сертификатов][cert-wizard]

2.   В разделе **Расположение хранилища** выберите **Текущий пользователь** и нажмите кнопку **Далее**. Будет выполнена установка сертификата в хранилище сертификатов вашей учетной записи пользователя.

3.   Продолжайте выполнять указания мастера, принимая значения по умолчанию, пока не перейдете на экран **Защита закрытого ключа**. Здесь необходимо указать пароль (если применимо) для этого сертификата. Также необходимо отметить пункт **Пометить этот ключ как экспортируемый**. Наконец, нажмите кнопку **Далее**.

	![защита закрытого ключа][key-protection]

4. Следуйте дальнейшим указаниям мастера, принимая значения по умолчанию, пока сертификаты не будут установлены.

Теперь необходимо изменить определение службы, чтобы оно ссылалось на установленный сертификат.

## <a name="step4"> </a>Шаг 4. Изменение определения службы и файлов конфигурации

Необходимо настроить приложение, чтобы оно ссылалось на сертификат, и добавить конечную точку HTTPS. Для этого следует обновить файлы определения службы и конфигурации службы.

1.  В каталоге службы откройте файл определения службы (ServiceDefinition.csdef), добавьте раздел **Certificates** в раздел **WebRole**и включите следующие сведения о сертификате:

        <WebRole name="WebRole1" vmsize="ExtraSmall">
        ...
            <Certificates>
                <Certificate name="SampleCertificate" 
                    storeLocation="LocalMachine" storeName="My" />
            </Certificates>
        ...
        </WebRole>

    Раздел **Certificates** определяет имя сертификата, его расположение и имя хранилища, где он находится. Поскольку мы установили сертификат в хранилище сертификатов пользователя, используется значение "My". Можно использовать другие хранилища сертификатов. Дополнительную информацию см. в разделе [Сопоставление сертификата со службой].

2.  В файле определения службы обновите элемент http **InputEndpoint** в разделе **Endpoints**, чтобы включить HTTPS.

        <WebRole name="WebRole1" vmsize="Small">
        ...
            <Endpoints>
                <InputEndpoint name="Endpoint1" protocol="https" 
                    port="443" certificate="SampleCertificate" />
            </Endpoints>
        ...
        </WebRole>

    Итак, все необходимые изменения внесены в файл определения службы, но еще нужно добавить сведения о сертификате в сам файл конфигурации службы.

3.  В файлах конфигурации службы (**ServiceConfiguration.Cloud.cscfg** и **ServiceConfiguration.Local.cscfg**) добавьте сертификат в пустой раздел **Certificates** раздела **Role**, заменив приведенный ниже образец отпечатка на значение отпечатка вашего сертификата:

        <Role name="WebRole1">
        ...
            <Certificates>
                <Certificate name="SampleCertificate" 
                    thumbprint="9427befa18ec6865a9ebdc79d4c38de50e6316ff" 
                    thumbprintAlgorithm="sha1" />
            </Certificates>
        ...
        </Role>

4.  Обновите конфигурацию службы в облаке, выполнив повторную публикацию службы. В командной строке Azure PowerShell перейдите в каталог службы и введите **Publish-AzureServiceProject**.

	В процессе публикации указанный сертификат будет скопирован из локального хранилища сертификатов и включен в пакет развертывания.

## <a name="step5"> </a>Шаг 5. Подключение к экземпляру роли с использованием HTTPS

Теперь, когда развертывание готово и работает в Azure, вы можете подключиться к нему, используя HTTPS.

1.  На портале управления выберите облачную службу, а затем щелкните по элементу **Панель мониторинга**.

2. Выполните прокрутку вниз и щелкните по ссылке **URL-адрес сайта**.

    ![URL-адрес сайта][site-url]

	> [AZURE.IMPORTANT]Если отображаемый на портале URL-адрес сайта не определяет протокол HTTPS, необходимо вручную ввести адрес в браузере, указав префикс HTTPS вместо HTTP.

3.  Веб-сайт откроется в новом окне браузера.

    Кроме того, в браузере будет отображаться значок замка, свидетельствующий о том, что установлено подключение HTTPS. Это означает, что ваше приложение правильно настроено для работы с протоколом SSL.

    ![][8]

## Дополнительные ресурсы

[Связь сертификата со службой]

[Настройка SSL для приложения Node.js в рабочей роли Azure]

[Настройка SSL-сертификата в конечной точке HTTPS]

  [Шаг 1. Создание службы Node.js и ее публикация в облаке]: #step1
  [Шаг 2. Получение SSL-сертификата]: #step2
  [Шаг 3. Импорт сертификата SSL]: #step3
  [Шаг 4. Изменение файлов определения и конфигурации службы]: #step4
  [Шаг 5. Подключение к экземпляру роли с использованием HTTPS]: #step5
  [**Azure PowerShell**]: http://go.microsoft.com/?linkid=9790229&clcid=0x409
  
  
  
  
  [1]: ./media/cloud-services-nodejs-configure-ssl-certificate/enable-ssl-01.png
  [2]: ./media/cloud-services-nodejs-configure-ssl-certificate/enable-ssl-02.png
  [3]: ./media/cloud-services-nodejs-configure-ssl-certificate/enable-ssl-03.png
  [Azure Management Portal]: http://manage.windowsazure.com
  
  
  [Связь сертификата со службой]: http://msdn.microsoft.com/library/windowsazure/gg465718.aspx
  
  [site-url]: ./media/cloud-services-nodejs-configure-ssl-certificate/site-url.png
  [8]: ./media/cloud-services-nodejs-configure-ssl-certificate/enable-ssl-08.png
  [Настройка SSL-сертификата в конечной точке HTTPS]: http://msdn.microsoft.com/library/windowsazure/ff795779.aspx
  [powershell-menu]: ./media/cloud-services-nodejs-configure-ssl-certificate/azure-powershell-start.png
  [cert-wizard]: ./media/cloud-services-nodejs-configure-ssl-certificate/certificateimport.png
  [key-protection]: ./media/cloud-services-nodejs-configure-ssl-certificate/exportable.png
  [Настройка SSL для приложения Node.js в рабочей роли Azure]: /develop/nodejs/common-tasks/enable-ssl-worker-role/
 

<!---HONumber=August15_HO6-->