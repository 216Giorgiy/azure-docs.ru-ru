<properties 
	pageTitle="Непрерывная доставка с использованием Visual Studio Online в Azure" 
	description="В данном разделе приводится информация о том, как настроить командные проекты Visual Studio Online для автоматического создания и развертывания веб-приложений или облачных служб Azure." 
	services="cloud-services" 
	documentationCenter=".net" 
	authors="kempb" 
	manager="douge" 
	editor="tglee"/>

<tags 
	ms.service="cloud-services" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="na" 
	ms.devlang="dotnet" 
	ms.topic="article" 
	ms.date="05/08/2015" 
	ms.author="kempb"/>


# Непрерывная доставка в Azure с использованием Visual Studio Online

  Вы можете настроить командные проекты Visual Studio Online для автоматического построения облачных служб или веб-сайтов Azure. (Дополнительную информацию о настройке непрерывного процесса построения и развертывания системы с использованием *локального* решения Team Foundation Server см. в разделе [Непрерывная доставка для облачных служб в Azure](cloud-services-dotnet-continuous-delivery.md).)

В данном учебнике предполагается, что у вас установлены решения Visual Studio 2013 и пакет SDK Azure. Чтобы загрузить Visual Studio 2013, щелкните ссылку **Начните работу бесплатно** на сайте [www.visualstudio.com](http://www.visualstudio.com). Пакет SDK Azure можно установить по [этой ссылке](http://go.microsoft.com/fwlink/?LinkId=239540).

> [AZURE.NOTE]Для работы с этим учебником необходима учетная запись Visual Studio Online. Вы можете [бесплатно зарегистрировать учетную запись Visual Studio Online](http://go.microsoft.com/fwlink/p/?LinkId=512979).

Чтобы настроить облачную службу для автоматического построения и развертывания в Azure с использованием Visual Studio Online, выполните следующие действия:

-   [Шаг 1. Создание командного проекта.][]

-   [Шаг 2. Регистрация проекта в системе управления версиями.][]

-   [Шаг 3. Подключение проекта к Azure.][]

-   [Шаг 4. Внесение необходимых изменений и запуск повторного построения и развертывания.][]

-   [Шаг 5. Повторное развертывание предыдущей сборки (необязательно).][]

-   [Шаг 6. Изменение рабочего развертывания (только для облачных служб).][]

-	[Шаг 7. Выполнение модульных тестов (необязательно).][]

## <a name="step1"></a>Шаг 1. Создание командного проекта

Следуйте указаниям, приведенным [здесь](http://go.microsoft.com/fwlink/?LinkId=512980), чтобы создать командный проект и связать его с Visual Studio. В этом руководстве в качестве системы управления версиями применяется Team Foundation Version Control (TFVC). Если для управления версиями вы хотите использовать Git, см. [версию этого руководства для Git](http://go.microsoft.com/fwlink/p/?LinkId=397358).

## <a name="step2"> </a>Шаг 2. Регистрация проекта в системе управления версиями

1. В Visual Studio откройте решение, которое вы хотите развернуть, или создайте новое. В этом пошаговом руководстве представлены инструкции по развертыванию веб-приложения или облачной службы (приложение Azure). Чтобы создать новое решение, создайте новый проект облачной службы Azure или новый проект MVC ASP.NET. Убедитесь, что в проекте используется платформа .NET Framework 4 или 4.5 и создается проект облачной службы, добавьте рабочую роль и веб-роль ASP.NET MVC, после чего выберите интернет-приложение для веб-роли. При появлении запроса выберите **Интернет-приложение**. Чтобы создать веб-приложение, выберите шаблон проекта «Веб-приложение ASP.NET» и затем выберите MVC. См. статью [Создание веб-приложения ASP.NET в службе приложений Azure](../web-sites-dotnet-get-started.md).

> [AZURE.NOTE]В настоящее время Visual Studio Online поддерживают только развертывания CI веб-приложений Visual Studio. Проекты веб-сайтов выходят за эти рамки.


2. Откройте контекстное меню решения и выберите **Добавить решение в систему управления версиями**.<br/> ![][5]

3. Примите предлагаемые по умолчанию параметры или измените их, после чего нажмите кнопку **ОК**. По завершении обработки в обозревателе решений появится значок системы управления версиями.<br/> ![][6]

4. Откройте контекстное меню решения и выберите пункт **Регистрация**.<br/>![][7]

5. В области «Ожидающие изменения» в обозревателе Team Explorer введите примечания к регистрации и нажмите кнопку **Регистрация**.<br/> ![][8]

<br/> Обратите внимание на варианты для включения или исключения определенных изменений при регистрации. Если нужные изменения исключаются, нажмите ссылку **Включить все**.<br/> ![][9]

## <a name="step3"> </a>Шаг 3. Подключение проекта к Azure

1. После того как был создан командный проект VSO с определенным исходным кодом, вы можете подключить его к Azure. Выполните вход на [портал Azure](http://manage.windowsazure.com), выберите существующие облачную службу или веб-приложение либо создайте новые с помощью значка «+» в нижнем левом углу, после чего выберите **Облачная служба** или **Веб-приложение** и щелкните **Быстрое создание**. Щелкните ссылку **Настройка публикации в Visual Studio Online**.<br/> ![][10]

2. В текстовом поле в мастере введите имя своей учетной записи Visual Studio Online и щелкните ссылку **Авторизовать сейчас**. Может появиться запрос на вход в систему.<br/> ![][11]

3. Во всплывающем диалоговом окне OAuth нажмите кнопку **Принять**, чтобы предоставить Azure полномочия для настройки командного проекта в VSO.<br/> ![][12]

4. После успешной авторизации появится раскрывающийся список, в котором будут представлены ваши командные проекты Visual Studio Online. Щелкните имя созданного на предыдущих шагах командного проекта и нажмите кнопку с галочкой в мастере.<br/> ![][13]

5. После привязки проекта появятся инструкции по проверке изменений в командном проекте Visual Studio Online. При следующей регистрации Visual Studio Online будет строить и развертывать ваш проект в Azure. Чтобы проверить реализованное поведение, щелкните ссылку **Регистрация из Visual Studio**, а затем ссылку **Запустить Visual Studio** (или аналогичную кнопку **Visual Studio** в нижней части окна портала).<br/> ![][14]

## <a name="step4"> </a>Шаг 4. Запуск повторного построения и развертывания проекта

1. В обозревателе Visual Studio Team Explorer щелкните ссылку **Обозреватель управления исходным кодом**.<br/> ![][15]

2. Перейдите к файлу решения и откройте его.<br/> ![][16]

3. Откройте и измените файл в обозревателе решений. Например, измените файл _Layout.cshtml в папке Views\\Shared веб-роли MVC.<br/> ![][17]

4. Измените логотип сайта и сохраните этот файл с помощью клавиш CTRL + S.<br/> ![][18]

5. В обозревателе Team Explorer щелкните ссылку **Ожидающие изменения**.<br/> ![][19]

6. Введите комментарий и нажмите кнопку **Регистрация**.<br/> ![][20]

7. Нажмите кнопку «Главная», чтобы вернуться на главную страницу Team Explorer.<br/> ![][21]

8. Щелкните ссылку **Сборки**, чтобы просмотреть выполняющиеся сборки.<br/> ![][22] <br/> Обозреватель Team Explorer показывает, что для вашей регистрации был запущен процесс сборки.<br/> ![][23]

9. Дважды щелкните имя выполняемой сборки, чтобы просмотреть подробный журнал процесса сборки.<br/> ![][24]

10. В процессе построения вы можете просмотреть определение сборки, созданное во время привязки TFS к Azure с помощью мастера. Откройте контекстное меню определения сборки и выберите **Редактировать определение сборки**.<br/> ![][25] <br/> На вкладке **Триггер** указывается, что в определении сборки настроено выполнение сборки по умолчанию при каждой регистрации.<br/> ![][26] <br/> На вкладке **Процесс** указывается, что в среде разработки настроено имя ваших облачной веб-службы или веб-сайта. При работе с веб-приложениями здесь будут показаны другие свойства.<br/> ![][27] <br/> При необходимости измените установленные по умолчанию значения свойств. Свойства публикации Azure находятся в разделе «Развертывание». В следующей таблице приводятся доступные свойства в разделе «Развертывание»:
	<table>
<tr><td><b>Свойство</b></td><td><b>Значение по умолчанию</b></td></tr>
><tr><td>Разрешить недоверенные сертификаты</td><td>Если установлено значение false, то SSL-сертификаты должны быть подписаны корневым центром сертификации.</td></tr>
<tr><td>Разрешить обновление</td><td>Разрешает обновление существующего развертывания вместо создания нового. Сохраняет IP-адрес.</td></tr><tr><td>Не удалять</td><td>Если установлено значение true, не разрешена перезапись существующего несвязанного развертывания (обновление разрешено).</td></tr>
<tr><td>Путь к параметрам развертывания</td><td>Путь к PUBXML-файлу для веб-приложения относительно корневой папки репозитория. Для облачных служб игнорируется.</td></tr>
<tr><td>Среда развертывания Sharepoint</td><td>Совпадает с именем службы.</td></tr>
<tr><td>Среда развертывания Azure</td><td>Имя веб-приложения или облачной службы</td></tr>
</table> <br/>

Если используется несколько конфигураций служб (CSCFG-файлов), можно указать желаемую конфигурацию службы в параметрах **Сборка, Дополнительно, Аргументы MSBuild**. Например, чтобы использовать файл ServiceConfiguration.Test.cscfg, задайте аргумент командной строки MSBuild /p:TargetProfile=Test.<br/> ![][38]

11. К этому моменту процесс сборки должен быть успешно завершен.<br/> ![][28]

12. Если дважды щелкнуть имя сборки, Visual Studio отобразит **сводку сборки**, включающую все результаты тестирования из соответствующих проектов модульного теста.<br/> ![][29]

13. На [портале Azure](http://manage.windowsazure.com) можно увидеть соответствующее развертывание на вкладке развертываний, выбрав промежуточную среду.<br/> ![][30]

14.	Перейдите по URL-адресу вашего сайта. Для веб-приложения достаточно нажать кнопку «Обзор» на панели команд. Для облачной службы выберите URL-адрес в разделе **Сводка** на странице **Панель мониторинга**, где отображается промежуточная среда для облачной службы. Развертывания из решений непрерывной интеграции для облачных служб по умолчанию публикуются в промежуточной среде. Чтобы изменить это поведение, присвойте свойству "Альтернативная среда облачной службы" значение "Рабочая". На этом снимке экрана показано местонахождение URL-адреса сайта на странице панели мониторинга облачной службы: <br/> ![][31] <br/> Ваш работающий сайт откроется на новой вкладке браузера.<br/> ![][32]

15.	При внесении других изменений в проект для облачных служб запускаются дополнительные процессы построения, в результате чего создается несколько развертываний, последнее из которых отмечается как активное.<br/> ![][33]

## <a name="step5"> </a>Шаг 5. Повторное развертывание предыдущей сборки

Этот шаг необязателен и применяется к облачным службам. Чтобы восстановить состояние сайта на момент более ранней регистрации, выберите предыдущее развертывание на портале управления и нажмите кнопку **Повторное развертывание**. Обратите внимание, что при этом в TFS будет запущен новый процесс построения, а в историю развертывания будет добавлена новая запись.<br/> ![][34]

## <a name="step6"> </a>Шаг 6. Изменение развертывания в рабочей среде

Этот шаг применяется только к облачным службам и недоступен для веб-приложений. Выполнив все необходимые действия, вы можете повысить промежуточную среду до рабочей с помощью кнопки "Переключить" портала управления. Вновь развернутая промежуточная среда повышается до уровня рабочей, а ранее установленная рабочая среда становится промежуточной. Активное развертывание может быть разным для рабочей среды и промежуточной среды, однако журнал развертывания последних сборок один и тот же независимо от среды.<br/> ![][35]

## <a name="step7"> </a>Шаг 7. Выполнение модульных тестов

Этот шаг применяется только к веб-приложениям, не облачным службам. Чтобы поместить условия качества вашего развертывания, можно выполнять модульные тесты и, если они не могут остановить развертывание.

1.  В Visual Studio добавьте проект модульного теста.<br/> ![][39]

2.  Добавьте ссылки на проект в проект, который требуется проверить.<br/> ![][40]

3.  Добавьте модульные тесты. Сначала попробуйте фиктивный тест, который всегда выдает положительный результат.

		using System;
		using Microsoft.VisualStudio.TestTools.UnitTesting;
		
		namespace UnitTestProject1
		{
		    [TestClass]
		    public class UnitTest1
		    {
		        [TestMethod]
		        [ExpectedException(typeof(NotImplementedException))]
		        public void TestMethod1()
		        {
		            throw new NotImplementedException();
		        }
		    }
		}

4.  Измените определение сборки, выберите вкладку «Процессы» и разверните узел «Test».


5.  Установите для параметра **Завершить сборку при ошибке теста** значение True. Это означает, что развертывание не будет происходить, если тест не будет пройден положительно.<br/> ![][41]

6.  Поставьте новую сборку в очередь.<br/> ![][42] <br/> ![][43]

7. По мере обработки сборки проверяйте ход выполнения.<br/> ![][44] <br/> ![][45]

7. После завершения сборки проверьте результаты теста.<br/> ![][46] <br/> ![][47]

8.  Попробуйте создать тест, который выдаст отрицательный результат. Добавьте новый тест путем копирования первой, переименовать его и закомментируйте строку кода, о том, что NotImplementedException является ожидаемое исключение.

		[TestMethod]
		//[ExpectedException(typeof(NotImplementedException))]
		public void TestMethod2()
		{
		    throw new NotImplementedException();
		}

9. Примените изменения, чтобы поставить в очередь новую сборку.<br/> ![][48]

10. Просмотрите результаты теста, чтобы узнать подробные сведения о сбое.<br/> ![][49] <br/> ![][50]

Дополнительную информацию о модульном тестировании в Visual Studio Online см. в разделе [Выполнение тестов в процессе сборки](http://go.microsoft.com/fwlink/p/?LinkId=510474).

Дополнительные сведения см. в разделе [Visual Studio Online](http://go.microsoft.com/fwlink/?LinkId=253861). При использовании Git, см. разделы [Совместное использование кода в Git](http://www.visualstudio.com/get-started/share-your-code-in-git-vs.aspx) и [Непрерывное развертывание с использованием GIT в службе приложений Azure](../web-sites-publish-source-control.md).

[Шаг 1. Создание командного проекта.]: #step1
[Шаг 2. Регистрация проекта в системе управления версиями.]: #step2
[Шаг 3. Подключение проекта к Azure.]: #step3
[Шаг 4. Внесение необходимых изменений и запуск повторного построения и развертывания.]: #step4
[Шаг 5. Повторное развертывание предыдущей сборки (необязательно).]: #step5
[Шаг 6. Изменение рабочего развертывания (только для облачных служб).]: #step6
[Шаг 7. Выполнение модульных тестов (необязательно).]: #step7
[0]: ./media/cloud-services-continuous-delivery-use-vso/tfs0.PNG
[1]: ./media/cloud-services-continuous-delivery-use-vso/tfs1.png
[2]: ./media/cloud-services-continuous-delivery-use-vso/tfs2.png


[5]: ./media/cloud-services-continuous-delivery-use-vso/tfs5.png
[6]: ./media/cloud-services-continuous-delivery-use-vso/tfs6.png
[7]: ./media/cloud-services-continuous-delivery-use-vso/tfs7.png
[8]: ./media/cloud-services-continuous-delivery-use-vso/tfs8.png
[9]: ./media/cloud-services-continuous-delivery-use-vso/tfs9.png
[10]: ./media/cloud-services-continuous-delivery-use-vso/tfs10.png
[11]: ./media/cloud-services-continuous-delivery-use-vso/tfs11.png
[12]: ./media/cloud-services-continuous-delivery-use-vso/tfs12.png
[13]: ./media/cloud-services-continuous-delivery-use-vso/tfs13.png
[14]: ./media/cloud-services-continuous-delivery-use-vso/tfs14.png
[15]: ./media/cloud-services-continuous-delivery-use-vso/tfs15.png
[16]: ./media/cloud-services-continuous-delivery-use-vso/tfs16.png
[17]: ./media/cloud-services-continuous-delivery-use-vso/tfs17.png
[18]: ./media/cloud-services-continuous-delivery-use-vso/tfs18.png
[19]: ./media/cloud-services-continuous-delivery-use-vso/tfs19.png
[20]: ./media/cloud-services-continuous-delivery-use-vso/tfs20.png
[21]: ./media/cloud-services-continuous-delivery-use-vso/tfs21.png
[22]: ./media/cloud-services-continuous-delivery-use-vso/tfs22.png
[23]: ./media/cloud-services-continuous-delivery-use-vso/tfs23.png
[24]: ./media/cloud-services-continuous-delivery-use-vso/tfs24.png
[25]: ./media/cloud-services-continuous-delivery-use-vso/tfs25.png
[26]: ./media/cloud-services-continuous-delivery-use-vso/tfs26.png
[27]: ./media/cloud-services-continuous-delivery-use-vso/tfs27.png
[28]: ./media/cloud-services-continuous-delivery-use-vso/tfs28.png
[29]: ./media/cloud-services-continuous-delivery-use-vso/tfs29.png
[30]: ./media/cloud-services-continuous-delivery-use-vso/tfs30.png
[31]: ./media/cloud-services-continuous-delivery-use-vso/tfs31.png
[32]: ./media/cloud-services-continuous-delivery-use-vso/tfs32.png
[33]: ./media/cloud-services-continuous-delivery-use-vso/tfs33.png
[34]: ./media/cloud-services-continuous-delivery-use-vso/tfs34.png
[35]: ./media/cloud-services-continuous-delivery-use-vso/tfs35.png
[36]: ./media/cloud-services-continuous-delivery-use-vso/tfs36.PNG
[37]: ./media/cloud-services-continuous-delivery-use-vso/tfs37.PNG
[38]: ./media/cloud-services-continuous-delivery-use-vso/AdvancedMSBuildSettings.PNG
[39]: ./media/cloud-services-continuous-delivery-use-vso/AddUnitTestProject.PNG
[40]: ./media/cloud-services-continuous-delivery-use-vso/AddProjectReferences.PNG
[41]: ./media/cloud-services-continuous-delivery-use-vso/EditBuildDefinitionForTest.PNG
[42]: ./media/cloud-services-continuous-delivery-use-vso/QueueNewBuild.PNG
[43]: ./media/cloud-services-continuous-delivery-use-vso/QueueBuildDialog.PNG
[44]: ./media/cloud-services-continuous-delivery-use-vso/BuildInTeamExplorer.PNG
[45]: ./media/cloud-services-continuous-delivery-use-vso/BuildRequestInfo.PNG
[46]: ./media/cloud-services-continuous-delivery-use-vso/BuildSucceeded.PNG
[47]: ./media/cloud-services-continuous-delivery-use-vso/TestResultsPassed.PNG
[48]: ./media/cloud-services-continuous-delivery-use-vso/CheckInChangeToMakeTestsFail.PNG
[49]: ./media/cloud-services-continuous-delivery-use-vso/TestsFailed.PNG
[50]: ./media/cloud-services-continuous-delivery-use-vso/TestsResultsFailed.PNG
 

<!---HONumber=July15_HO3-->