<properties
	pageTitle="Настройка гибридного кластера HPC с помощью пакета Microsoft HPC | Microsoft Azure"
	description="Узнайте, как использовать пакет Microsoft HPC и Azure для настройки небольшого гибридного кластера высокопроизводительных вычислений (HPC)"
	services="cloud-services"
	documentationCenter=""
	authors="dlepow"
	manager="timlt"
	editor=""
	tags="azure-service-management,hpc-pack"/>

<tags
	ms.service="cloud-services"
	ms.workload="big-compute"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="04/14/2016"
	ms.author="danlep"/>


# Настройка гибридного кластера высокопроизводительных вычислительных систем (HPC) с помощью пакета Microsoft HPC и рабочих экземпляров Azure по требованию

Используйте пакет Microsoft HPC Pack 2012 R2 и Azure для настройки небольшого гибридного кластера высокопроизводительных вычислительных систем (HPC). Кластер будет состоять из локального головного узла (компьютер под управлением операционной системы Windows Server и пакета HPC) и нескольких вычислительных узлов, развертываемых по требованию в качестве экземпляров рабочих ролей в облачной службе Azure. Затем вы сможете выполнять вычислительные задания в гибридном кластере.

![Гибридный кластер высокопроизводительных вычислений (HPC)][Overview]

В этом учебнике демонстрируется один из способов использования масштабируемых вычислительных ресурсов в Azure, доступных по требованию, для запуска ресурсоемких приложений, который также называют "ускорением в облако".

В этом учебнике предполагается, что у читателя нет опыта работы с вычислительными кластерами или пакетом HPC. Оно предназначено только для того, чтобы помочь вам быстро развернуть кластер вычислений для демонстрационных целей. Рекомендации и действия для развертывания гибридного кластера с пакетом HPC большего масштаба в производственной среде см. в [подробном руководстве](http://go.microsoft.com/fwlink/p/?LinkID=200493). Другие сценарии использования пакета HPC, включая автоматизированное развертывание кластера в виртуальных машинах Azure, см. в разделе [Возможности создания кластера высокопроизводительных вычислительных систем (HPC) на основе Windows и управления им в Azure с помощью пакета Microsoft HPC](../virtual-machines/virtual-machines-windows-hpcpack-cluster-options.md).


## Предварительные требования

* **Подписка Azure**. Если ее нет, можно за пару минут создать [бесплатную учетную запись](https://azure.microsoft.com/free/).

* **Локальный компьютер под управлением Windows Server 2012 R2 или Windows Server 2012**. Этот компьютер будет головным узлом кластера HPC. Если вы еще не установили Windows Server, вы можете загрузить и установить [ознакомительную версию](http://technet.microsoft.com/evalcenter/dn205286.aspx).

	* Компьютер должен быть присоединен к домену Active Directory.

	* Убедитесь, что не установлены дополнительные роли сервера или службы ролей.

	* Для поддержки пакета HPC необходимо установить операционную систему на одном из следующих языков: английский, японский или китайский (упрощенное письмо).

	* Убедитесь, что установлены важные и критические обновления.

* **Пакет HPC 2012 R2**. Бесплатно [скачайте](http://go.microsoft.com/fwlink/p/?linkid=328024) установочный пакет последней версии и скопируйте файлы на компьютер головного узла или в сетевую папку. Выберите установочные файлы на языке установленной системы Windows Server.

* **Учетная запись домена**. Для установки пакета HPC эта учетная запись должна быть настроена с разрешениями локального администратора на головном узле.

* **Подключение по протоколу TCP через порт 443** от головного узла к Azure.

## Установка пакета HPC на головном узле

Сначала установите пакет Microsoft HPC на локальном компьютере под управлением Windows Server, который будет головным узлом кластера.

1. Войдите на головной узел с помощью доменной учетной записи с правами локального администратора.

2. Откройте мастер установки пакета HPC, запустив файл Setup.exe из пакета HPC.

3. На экране **Установка пакета HPC 2012 R2 Setup** нажмите кнопку **Новая изолированная установка или добавление новых компонентов к существующему экземпляру**.

	![Установка пакета HPC 2012][install_hpc1]

4. На **странице пользовательского соглашения по программному обеспечению Microsoft** нажмите кнопку **Далее**.

5. На странице **Выбор типа установки** выберите опцию **Создание кластера HPC с головным узлом** и нажмите кнопку **Далее**.

	![Выбор типа установки][install_hpc2]

6. Мастер выполняет несколько тестов перед установкой. Нажмите кнопку **Далее** на странице **Правила установки**, если все тесты пройдены. В противном случае ознакомьтесь с предоставленной информацией и внесите необходимые изменения в вашей среде. Затем повторите тесты или, при необходимости, запустите мастер установки еще раз.

	![Правила установки][install_hpc3]

7. На странице **Настройки базы данных HPC** убедитесь, что выбран **Головной узел** для всех баз данных HPC, а затем нажмите кнопку **Далее**.

	![Конфигурация базы данных][install_hpc4]

8. Примите параметры по умолчанию на оставшихся страницах мастера. На странице **Установка обязательных компонентов** нажмите кнопку **Установить**.

	![Установить][install_hpc6]

9. После завершения установки снимите флажок **Запустить диспетчер кластеров HPC** и нажмите кнопку **Готово**. (Вы запустите диспетчер кластеров HPC позднее.)

	![Готово][install_hpc7]

## Подготовка подписки Azure
Используйте [классический портал Azure](https://manage.windowsazure.com) для выполнения следующих действий с подпиской Azure. Они необходимы для развертывания узлов Azure из локального головного узла.

- Загрузка сертификата управления (необходим для безопасных соединений между головным узлом и службами Azure)

- Создание облачной службы Azure, в которой будут работать узлы Azure (экземпляры рабочей роли)

- Создание учетной записи хранения Azure

	>[AZURE.NOTE]Также запишите идентификатор подписки Azure, которая понадобится позже. Его можно найти в [сведениях об учетной записи Azure](https://account.windowsazure.com/Subscriptions).

### Загрузка сертификата управления по умолчанию
Пакет HPC устанавливает самозаверяющий сертификат на головном узле с именем "Сертификат управления Microsoft HPC Azure по умолчанию", который можно загрузить как сертификат управления Azure. Этот сертификат предназначен для тестирования и экспериментальных развертываний.

1. На компьютере головного узла войдите на [классический портал Azure](https://manage.windowsazure.com).

2. Нажмите кнопку **Параметры**, а затем — **Сертификаты управления**.

3. На панели команд нажмите **Загрузить**.

	![Параметры сертификата][upload_cert1]

4. На головном узле перейдите к файлу C:\\Program Files\\Microsoft HPC Pack 2012\\Bin\\hpccert.cer. Затем нажмите кнопку **Проверить**.

	![Загрузка сертификата][install_hpc10]

В списке сертификатов управления вы увидите **сертификат управления Azure HPC по умолчанию**.

### Создание облачной службы Azure

>[AZURE.NOTE]Для лучшей производительности рекомендуется создавать облачные службы и учетную запись хранения (позднее) в одном географическом регионе.

1. На панели команд классического портала нажмите кнопку **Создать**.

2. Последовательно выберите пункты **Создать** > **Облачная служба** > **Быстрое создание**.

3. Введите URL-адрес облачной службы и нажмите кнопку **Создать облачную службу**.

	![Создать службу][createservice1]

### Создание учетной записи хранения Azure

1. На панели команд классического портала нажмите кнопку **Создать**.

2. Последовательно выберите **Службы данных** > **Хранилище** > **Быстрое создание**.

3. Введите URL-адрес учетной записи и нажмите кнопку **Создать учетную запись хранения**.

	![Создание хранилища][createstorage1]

## Настройка головного узла

Чтобы развернуть узлы Azure с помощью диспетчера кластеров HPC и отправлять задания, необходимо выполните некоторые действия для настройки кластера.

1. На головном узле запустите диспетчер кластеров HPC. Если откроется диалоговое окно **Выбор головного узла**, щелкните **Локальный компьютер**. Появится **список дел развертывания**.

2. В разделе **Необходимые задачи развертывания** нажмите **Настроить сеть**.

	![Настройка сети][config_hpc2]

3. В мастере настройки сети выберите параметр **Все узлы только в корпоративной сети** (топология 5).

	![Топология 5][config_hpc3]

	>[AZURE.NOTE]Это простейшая конфигурация для демонстрационных целей, поскольку головному узлу для подключения к Active Directory и Интернету требуется только один сетевой адаптер. В этом учебнике не рассматриваются сценарии, в которых кластеру требуются дополнительные сети.

4. Нажмите кнопку **Далее**, чтобы принять значения по умолчанию на оставшихся страницах мастера. Затем на вкладке **Просмотр** щелкните **Настройка** для завершения настройки сети.

5. В **списке дел развертывания** нажмите **Ввести учетные данные установки**.

6. В диалоговом окне **Учетные данные установки** введите учетные данные доменной учетной записи, которая использовалась для установки пакета HPC. Нажмите кнопку **ОК**.

	![Учетные данные установки][config_hpc6]

	>[AZURE.NOTE]Службы пакета HPC используют учетные данные установки только для развертывания присоединенных к домену вычислительных узлов. Узлы Azure, добавляемые в этом учебнике, не присоединены к домену.

7. В **списке дел развертывания** нажмите **Настроить именование новых узлов**.

8. В диалоговом окне **Указать серию именования узлов** примите значения по умолчанию и нажмите кнопку **OK**.

	![Именование узлов][config_hpc8]

	>[AZURE.NOTE]Серия именования формирует только имена для вычислительных узлов, присоединенных к домену. Имена узлов Azure задаются автоматически.

9. В **списке дел развертывания** нажмите **Создать шаблон узла**. Этот шаблон будет использоваться для добавления узлов Azure в кластер.

10. В окне мастера создания узла шаблона выполните следующие действия.

	а. На странице **Выбор типа шаблона** узла щелкните **шаблон узла Azure**, а затем нажмите кнопку **Далее**.

	![Шаблон узла][config_hpc10]

	b. Щелкните **Далее**, чтобы использовать имя шаблона по умолчанию.

	c. На странице **Укажите сведения о подписке** введите свой идентификатор подписки Azure (он доступен в сведениях об учетной записи Azure). Затем в разделе **Сертификат управления** нажмите кнопку **Обзор** и выберите **Управление HPC Azure по умолчанию.** Нажмите кнопку **Далее**.

	![Шаблон узла][config_hpc12]

	г) На странице **Укажите сведения о службе** выберите облачную службу и учетную запись хранения, созданные на предыдущем шаге. Нажмите кнопку **Далее**.

	![Шаблон узла][config_hpc13]

	д. Нажмите кнопку **Далее**, чтобы принять значения по умолчанию на оставшихся страницах мастера. Затем на вкладке **Просмотр** нажмите кнопку **Создать**, чтобы создать шаблон узла.

	>[AZURE.NOTE]По умолчанию шаблон узла Azure содержит параметры для запуска (подготовки) и остановки узлов вручную с помощью диспетчера кластеров HPC. При желании можно настроить расписание для автоматического запуска и остановки узлов Azure.

## Добавление узлов Azure в кластер

Этот шаблон будет использоваться для добавления узлов Azure в кластер. При добавлении узлов в кластер сведения об их конфигурации сохраняется, что позволяет запускать (настраивать) их в любое время в качестве экземпляров ролей в облачной службе. Плата за узлы Azure взимается с вашей подписки только после запуска экземпляров ролей в облачной службе.

В этом учебнике вы добавите два мелких узла.

1. В диспетчере кластеров HPC в разделе **Управление узлами** (в некоторых версиях пакета HPC он называется **Управление ресурсами**) на панели **Действия** нажмите кнопку **Добавить узел**.

	![Добавление узла][add_node1]

2. В окне мастера добавления узла на странице **Выбор метода развертывания** нажмите кнопку **Добавить узлы Azure**, а затем **Далее**.

	![Добавление узла Azure][add_node1_1]

3. На странице **Укажите новые узлы** выберите созданный ранее шаблон узла Azure (который по умолчанию называется **шаблоном узла Azure по умолчанию**). Затем укажите узлы **2** **мелких** узла и нажмите кнопку **Далее**.

	![Указание узлов][add_node2]

	Дополнительные сведения о доступных размерах см. в разделе [Размеры для облачных служб](cloud-services-sizes-specs.md).

4. На **последней странице мастера добавления узла** нажмите кнопку **Готово**.

	 Два узла Azure с именем **AzureCN-0001** и **AzureCN-0002** появятся в диспетчере кластеров HPC. Они находятся в состоянии **Не развернуто**.

	![Добавленные узлы][add_node3]

## Запуск узлов Azure
При необходимости использовать ресурсы кластера в Azure используйте диспетчер кластеров HPC, чтобы запустить (подготовить) узлы Azure и перевести их в оперативный режим.

1.	В диспетчере кластеров HPC в разделе **Управление узлами** (в некоторых версиях пакета HPC он называется **Управление ресурсами**) выберите один или оба узла, а затем на панели **Действия** нажмите кнопку **Пуск**.

	![Запуск узлов][add_node4]

2. В диалоговом окне **Запуск узлов Azure** нажмите кнопку **Пуск**.

	![Запуск узлов][add_node5]

	Узлы перейдут в состояние **подготовки**. Для отслеживания хода подготовки можно просматривать журнал подготовки.

	![Подготовка узлов][add_node6]

3. Через несколько минут подготовка узлов Azure завершится, и они перейдут в **автономное** состояние. В этом состоянии экземпляры ролей выполняются, но еще не принимают задания кластера.

4. Чтобы убедиться, что экземпляры ролей выполняются, на [классическом портале](https://manage.windowsazure.com) нажмите **Облачные службы**, затем выберите *имя вашей облачной службы* и щелкните **Экземпляры**.

	![Выполняющиеся экземпляры][view_instances1]

	Вы увидите два запущенных экземпляра рабочей роли в службе. Пакет HPC также автоматически развертывает два экземпляра **HpcProxy** (среднего размера) для обработки взаимодействия между головным узлом и Azure.

5. Чтобы перевести узлы Azure в оперативный режим для выполнения заданий кластера, выберите узлы, щелкните правой кнопкой мыши и выберите команду **Перевести в оперативный режим**.

	![Автономные узлы][add_node7]

	Диспетчер кластеров HPC покажет, что узлы находятся в **оперативном** состоянии.

## Выполнение команды в кластере

Для проверки установки воспользуйтесь командой **clusrun** пакета HPC для выполнения команды или запуска приложения в одном или нескольких узлах кластера. В качестве простого примера выполните команду **clusrun**, чтобы получить конфигурацию IP-адресов узлов Azure.

1. На головном узле откройте командную строку.

2. Введите следующую команду:

	`clusrun /nodes:azurecn* ipconfig`

3. Должен появиться результат, аналогичный приведенному ниже.

	![Clusrun][clusrun1]

## Выполнение тестового задания

Теперь отправьте тестовое задание, которое выполняется на гибридном кластере. Данный пример является простым заданием параметрического анализа (тип классических параллельных вычислений). В этом примере выполняются подзадачи, добавляющие целое число с помощью команды **set /a**. Все узлы в кластере участвуют в выполнения подзадач для целых чисел от 1 до 100.

1. В диспетчере кластеров HPC в разделе **Управление заданиями** в области **Действия** нажмите **Создать задание параметрического анализа**.

	![Новое задание][test_job1]

2. В диалоговом окне **Создание задания параметрического анализа** в **командной строке** введите `set /a *+*` (замените командную строку, которая отображается по умолчанию). Оставьте значения по умолчанию для остальных параметров и нажмите кнопку **Отправить**, чтобы отправить задание.

	![Параметрический анализ][param_sweep1]

3. После завершения задания дважды нажмите задание **Моя задача анализа**.

4. Нажмите кнопку **Просмотреть задачи**, затем нажмите подзадачу, чтобы просмотреть результаты ее выполнения.

	![Результаты выполнения задачи][view_job361]

5. Для просмотра узла, который выполняет расчет для этой подзадачи, нажмите **Выделенные узлы**. (Кластер может показывать другое имя узла).

	![Результаты выполнения задачи][view_job362]

## Остановка узлов Azure

После тестирования кластера остановите узлы Azure, чтобы избежать ненужных расходов для вашей учетной записи. При этом облачная служба будет остановлена, а экземпляры ролей Azure будут удалены.

1. В диспетчере кластеров HPC в разделе **Управление узлами** (в некоторых версиях пакета HPC он называется **Управление ресурсами**) выберите оба узла Azure. Затем в области **действий** нажмите кнопку **Остановить**.

	![Остановка узлов][stop_node1]

2. В диалоговом окне **Остановка узлов Azure** нажмите кнопку **Остановить**.

	![Остановка узлов][stop_node2]

3. Узлы перейдут в состояние **Остановка**. Через несколько минут диспетчер кластеров HPC покажет, что узлы находятся в состоянии **Не развернуто**.

	![Неразвернутые узлы][stop_node4]

4. Чтобы убедиться, что экземпляры ролей больше не выполняются в Azure, на [классическом портале](https://manage.windowsazure.com) нажмите **Облачные службы**, затем выберите *имя вашей облачной службы* и щелкните **Экземпляры**. В рабочей среде будут отсутствовать развернутые экземпляры.

	![Нет экземпляров][view_instances2]

	На этом учебник завершен.

## Дальнейшие действия

* Изучите документацию по [пакетам HPC 2012 R2 и HPC 2012](http://go.microsoft.com/fwlink/p/?LinkID=263697).

* Сведения о настройке гибридного развертывания кластера пакета HPC в большом масштабе см. в разделе [Burst to Azure Worker Role Instances with Microsoft HPC Pack (Ускорение в экземпляры рабочих ролей Azure с помощью пакета Microsoft HPC)](http://go.microsoft.com/fwlink/p/?LinkID=200493).

* Другие способы создания кластера пакета HPC в Azure, включая использование шаблонов Azure Resource Manager, см. в разделе [HPC cluster options with Microsoft HPC Pack in Azure (Варианты создания кластера высокопроизводительных вычислений (HPC) в Azure и управления им с помощью пакета Microsoft HPC)](../virtual-machines/virtual-machines-linux-hpcpack-cluster-options.md).
* Дополнительные сведения о больших вычислениях и облачных решениях HPC в Azure см. в разделе [Большие вычисления в Azure: технические ресурсы для пакетных и высокопроизводительных вычислений (HPC)](../batch/big-compute-resources.md).


[Overview]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/hybrid_cluster_overview.png
[install_hpc1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc1.png
[install_hpc2]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc2.png
[install_hpc3]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc3.png
[install_hpc4]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc4.png
[install_hpc6]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc6.png
[install_hpc7]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc7.png
[install_hpc10]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/install_hpc10.png
[upload_cert1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/upload_cert1.png
[createstorage1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/createstorage1.png
[createservice1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/createservice1.png
[config_hpc2]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc2.png
[config_hpc3]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc3.png
[config_hpc6]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc6.png
[config_hpc8]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc8.png
[config_hpc10]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc10.png
[config_hpc12]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc12.png
[config_hpc13]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/config_hpc13.png
[add_node1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node1.png
[add_node1_1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node1_1.png
[add_node2]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node2.png
[add_node3]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node3.png
[add_node4]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node4.png
[add_node5]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node5.png
[add_node6]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node6.png
[add_node7]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/add_node7.png
[view_instances1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/view_instances1.png
[clusrun1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/clusrun1.png
[test_job1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/test_job1.png
[param_sweep1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/param_sweep1.png
[view_job361]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/view_job361.png
[view_job362]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/view_job362.png
[stop_node1]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/stop_node1.png
[stop_node2]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/stop_node2.png
[stop_node4]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/stop_node4.png
[view_instances2]: ./media/cloud-services-setup-hybrid-hpcpack-cluster/view_instances2.png

<!---HONumber=AcomDC_0420_2016-->