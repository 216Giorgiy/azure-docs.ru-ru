<properties title="Настройка группы доступности для виртуальных машин" pageTitle="Настройка группы доступности для виртуальных машин" description="Описаны этапы настройки группы доступности для виртуальной машины в Azure" metaKeywords="" services="virtual-machines" solutions="" documentationCenter="" authors="kathydav" manager="timlt" videoId="" scriptId="" />

<tags ms.service="virtual-machines" ms.workload="infrastructure-services" ms.tgt_pltfrm="vm-multiple" ms.devlang="na" ms.topic="article" ms.date="09/30/2014" ms.author="kathydav" />

# Настройка группы доступности для виртуальных машин

Группа доступности позволяет поддерживать доступность виртуальных машин во время простоев, например связанных с обслуживанием. Размещение двух или более одинаково настроенных виртуальных машин в группе доступности создает избыточность, необходимую для обеспечения доступности приложений или служб, выполняемых на виртуальной машине. Подробную информацию см. в разделе [Управление доступностью виртуальных машин][Управление доступностью виртуальных машин].

Чтобы обеспечить постоянную доступность и эффективность работы приложения, рекомендуется использовать и группы доступности, и балансировку нагрузки конечных точек. Информацию о балансировке нагрузки конечных точек см. в разделе [Балансировка нагрузки для служб инфраструктуры Azure][Балансировка нагрузки для служб инфраструктуры Azure].

Есть два способа поместить виртуальные машины в группы доступности:

-   [Вариант 1. Одновременное создание виртуальной машины и группы доступности][Вариант 1. Одновременное создание виртуальной машины и группы доступности]. Затем добавляйте создаваемые виртуальные машины в эту группу.
-   [Вариант 2. Добавление существующей виртуальной машины к группе доступности][Вариант 2. Добавление существующей виртуальной машины к группе доступности].

> [WACOM.NOTE] Виртуальные машины, которые вы хотите поместить в одну группу доступности, должны относиться к одной облачной службе.

## <span id="createset"></span> </a>Вариант 1. Одновременное создание виртуальной машины и группы доступности

Для этого можно использовать портал управления или командлеты Azure PowerShell.

С помощью портала управления:

1.  Войдите на [портал управления Azure][портал управления Azure] (если вы еще этого не сделали).

2.  На панели команд нажмите **Создать**.

3.  Щелкните **Виртуальная машина** и **Из коллекции**.

4.  На первых двух экранах укажите образ, имя пользователя и пароль и т. д. Информацию см. в разделе [Создание виртуальной машины под управлением Windows][Создание виртуальной машины под управлением Windows].

5.  На третьем экране можно настроить ресурсы сети, хранилища и доступности. Выполните следующее:

    1.  Выберите подходящий вариант для облачной службы. Выберите **Создать новую облачную службу** (если только вы не добавляете новую виртуальную машину в существующую облачную службу виртуальных машин). Затем укажите имя в поле **DNS-имя облачной службы**. DNS-имя становится частью URI, который используется для связи с виртуальной машиной. Облачная служба играет роль группы связи и изоляции. Все виртуальные машины в одной облачной службе могут взаимодействовать друг с другом, их можно настроить для балансировки нагрузки и добавить в одну группу доступности.

    2.  В поле **Регион, территориальная группа, виртуальная сеть** укажите виртуальную сеть, если вы планируете ее использовать. **Важно!** Если требуется использовать виртуальную машину по виртуальной сети, при создании виртуальной машины обязательно подключите ее к виртуальной сети. Присоединить виртуальную машину к виртуальной сети после ее создания невозможно. Дополнительные сведения см. в разделе [Общие сведения о сетевых функциях Azure][Общие сведения о сетевых функциях Azure].

    3.  Создайте группу доступности. В поле **Группа доступности** выберите вариант **Создать группу доступности**. Укажите имя группы.
    4.  Создайте конечные точки по умолчанию и при необходимости добавьте дополнительные конечные точки. Их также можно добавить позже.

    ![Создание группы доступности для новой виртуальной машины][Создание группы доступности для новой виртуальной машины]

6.  На четвертом экране выберите расширения, которые следует установить. Расширения обеспечивают функциональность, которая облегчает управление виртуальной машиной, например запуск антивирусного ПО или восстановление паролей. Информацию см. в разделе [Агент виртуальных машин Azure и расширения виртуальных машин][Агент виртуальных машин Azure и расширения виртуальных машин].

7.  Щелкните стрелку, чтобы создать виртуальную машину и группу доступности.

    Из панели мониторинга новой виртуальной машины щелкните **Настройки**, чтобы убедиться, что виртуальная машина принадлежит к новой группе доступности.

С помощью командлетов Azure:

1.  Откройте сеанс Azure PowerShell и выполните команды, аналогичные следующим примерам. Обратите внимание, что в этих примерах предполагается, что вы создаете виртуальную машину, облачную службу и группу доступности.

2.  Получите имя образа, который вы хотите использовать для создания виртуальной машины, и сохраните его в переменной. Команда использует номер индекса и свойство ImageName объекта образа:

    `C:\PS> $image = (Get-AzureVMImage)[4].ImageName`

    > [WACOM.NOTE] Для получения списка всех образов, доступных для вашей подписки, выполните команду `Get-AzureVMImage` без параметров.

3.  Задайте конфигурацию для новой виртуальной машины и используйте конвейер для передачи объекта конфигурации в командлет, который создает виртуальную машину. Не забудьте подставить собственные значения вместо заполнителей, таких как \<VmName\> и \<VmSize\>.

    `C:\PS> New-AzureVMConfig -Name "<VmName>" -InstanceSize <VmSize> -AvailabilitySetName "<SetName>" -ImageName $image | Add-AzureProvisioningConfig -Windows -AdminUsername "<UserName>" -Password "<MyPassword>" | Add-AzureDataDisk -CreateNew -DiskSizeInGB 50 -DiskLabel 'datadisk1' -LUN 0 | New-AzureVM –ServiceName "<MySvc1>"`

## <span id="addmachine"></span> </a>Вариант 2. Добавление существующей виртуальной машины к группе доступности

На портале управления можно добавить существующие виртуальные машины к существующей группе доступности либо создать для них новую группу. (Учитывайте, что виртуальные машины должны входить в одну облачную службу.) Выполняемые действия практически идентичны. В Azure PowerShell можно добавить виртуальную машину к существующей группе доступности.

1.  Войдите на [портал управления][портал управления Azure] Azure, если вы этого еще не сделали.

2.  В панели навигации щелкните **Виртуальные машины**.

3.  В списке выберите одну из виртуальных машин, которую следует добавить к группе. Щелкните строку виртуальной машины, чтобы открыть панель мониторинга.

4.  На вкладках под именем виртуальной машины щелкните **Настроить**.

5.  В разделе "Параметры" найдите **Группу доступности**. Выполните одно из следующих действий.

    A. Выберите **Создать группу доступности** и укажите имя для группы.

    Б. Выберите **Выбрать группу доступности** и выберите имя группы из списка.

    ![Создание группы доступности для существующей виртуальной машины][Создание группы доступности для существующей виртуальной машины]

6.  Щелкните **Сохранить**.

С помощью командлетов Azure:

Откройте сеанс Azure PowerShell и выполните следующую команду. Не забудьте подставить собственные значения вместо заполнителей, таких как \<VmCloudServiceName\> и \<VmName\>.

    C:\PS> Get-AzureVM -ServiceName "<VmCloudServiceName>" -Name "<VmName>" | Set-AzureAvailabilitySet -AvailabilitySetName "<MyAvSet>" | Update-AzureVM

> [WACOM.NOTE] Перезапустите виртуальную машину, чтобы завершить ее добавление к группе доступности.

## Дополнительные ресурсы

[Сведения о параметрах конфигурации виртуальной машины Azure][Сведения о параметрах конфигурации виртуальной машины Azure]

<!-- LINKS -->

  [Управление доступностью виртуальных машин]: ../virtual-machines-manage-availability
  [Балансировка нагрузки для служб инфраструктуры Azure]: ../virtual-machines-load-balance
  [Вариант 1. Одновременное создание виртуальной машины и группы доступности]: #createset
  [Вариант 2. Добавление существующей виртуальной машины к группе доступности]: #addmachine
  [портал управления Azure]: http://manage.windowsazure.com
  [Создание виртуальной машины под управлением Windows]: ../virtual-machines-windows-tutorial
  [Общие сведения о сетевых функциях Azure]: http://go.microsoft.com/fwlink/p/?linkid=294063
  [Создание группы доступности для новой виртуальной машины]: ./media/virtual-machines-how-to-configure-availability/VMavailabilityset.png
  [Агент виртуальных машин Azure и расширения виртуальных машин]: http://go.microsoft.com/fwlink/p/?LinkId=XXX
  [Создание группы доступности для существующей виртуальной машины]: ./media/virtual-machines-how-to-configure-availability/VMavailabilityExistingVM.png
  [Сведения о параметрах конфигурации виртуальной машины Azure]: http://msdn.microsoft.com/ru-ru/library/azure/dn763935.aspx
