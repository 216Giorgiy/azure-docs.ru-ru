<properties
   pageTitle="Проекты группы ресурсов Azure в Visual Studio | Microsoft Azure"
   description="Использование Visual Studio для создания проекта группы ресурсов Azure и развертывания ресурсов в Azure."
   services="azure-resource-manager"
   documentationCenter="na"
   authors="tfitzmac"
   manager="timlt"
   editor="tysonn" />
<tags
   ms.service="azure-resource-manager"
   ms.devlang="multiple"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="08/03/2016"
   ms.author="tomfitz" />

# Создание и развертывание групп ресурсов Azure с помощью Visual Studio

С помощью Visual Studio и [пакета Azure SDK](https://azure.microsoft.com/downloads/) можно создать проект для развертывания инфраструктуры и кода в Azure. Например, можно определить веб-узел, веб-сайт и базу данных для приложения, а затем развернуть эту инфраструктуру вместе с кодом. Или можно определить виртуальную машину, виртуальную сеть и учетную запись хранилища, а затем развернуть эту инфраструктуру со сценарием, который выполняется на виртуальной машине. Проект развертывания **группа ресурсов Azure** позволяет развернуть все необходимые ресурсы в ходе одной воспроизводимой операции. Подробнее о развертывании ресурсов и управлении ими см. в разделе [Общие сведения о диспетчере ресурсов Azure](resource-group-overview.md).

Проекты групп ресурсов Azure содержат шаблоны JSON Azure Resource Manager, определяющие ресурсы, которые развертываются в Azure. Сведения об элементах шаблона диспетчера ресурсов см. в статье [Создание шаблонов диспетчера ресурсов Azure](resource-group-authoring-templates.md). Visual Studio позволяет изменять эти шаблоны и предоставляет средства, которые упрощают работу с ними.

В этой статье мы развернем веб-приложение и базу данных SQL. Ресурсы любого другого типа развертываются практически так же. С такой же легкостью можно развернуть виртуальную машину и связанные с ней ресурсы. Visual Studio предоставляет разные начальные шаблоны для распространенных сценариев развертывания.

В этой статье показано использование Visual Studio 2015 с обновлением 2 и пакета Microsoft Azure SDK для .NET 2.9. Использование Visual Studio 2013 с пакетом Azure SDK 2.9 в основном такое же. Можно использовать версии пакета Azure SDK 2.6 и выше, но в таком случае описанная в статье работа в пользовательском интерфейсе может отличаться. Настоятельно рекомендуем установить последнюю версию пакета [Azure SDK](https://azure.microsoft.com/downloads/) перед началом работы.

## Создание проекта группы ресурсов Azure

В этой процедуре мы создадим проект группы ресурсов Azure с помощью шаблона **Веб-приложение + SQL**.

1. В Visual Studio последовательно выберите **Файл**, **Создать проект**, а затем — **C#** или **Visual Basic**. Щелкните **Облако**, а затем выберите проект **Группа ресурсов Azure**.

    ![Проект облачного развертывания](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/create-project.png)

1. Выберите шаблон, который вы намерены развернуть в диспетчере ресурсов Azure. Обратите внимание, что доступны разные варианты, основывающиеся на типе проекта, который вы хотите развернуть. В этом примере следует выбрать шаблон **Веб-приложение + SQL**.

    ![Выберите шаблон](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/select-project.png)

    Выбор шаблона — это просто отправная точка. Вы можете добавлять и удалять ресурсы для реализации своего сценария.

    >[AZURE.NOTE] Visual Studio получает список доступных шаблонов в Интернете. Этот список может изменяться.

    Visual Studio создает проект развертывания группы ресурсов для веб-приложения и базы данных SQL.

1. Разверните узлы в проекте развертывания, чтобы увидеть, какие ресурсы созданы.

    ![Показать узлы](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/show-items.png)

    Так как в этом примере мы выбрали шаблон "Веб-приложение + SQL", отобразятся указанные ниже файлы.

    |Имя файла|Описание|
    |---|---|
    |Deploy-AzureResourceGroup.ps1|Сценарий PowerShell, вызывающий команды PowerShell для развертывания в Azure Resource Manager.<br />**Примечание**. Этот сценарий PowerShell используется в Visual Studio для развертывания вашего шаблона. Любые изменения, внесенные в этот сценарий, влияют на развертывание в Visual Studio, поэтому будьте внимательны.|
    |WebSiteSQLDatabase.json|Шаблон Resource Manager, определяющий инфраструктуру, которую требуется развернуть в Azure, и параметры, которые можно указать во время развертывания. Кроме того, он определяет зависимости между ресурсами, благодаря чему Resource Manager развертывает их в правильном порядке.|
    |WebSiteSQLDatabase.parameters.json|Файл параметров, который содержит значения, необходимые для шаблона. Это значения, передаваемые для настройки каждого развертывания.|

    Все проекты развертывания группы ресурсов содержат эти основные файлы. Другие проекты могут содержать дополнительные файлы для поддержки других функциональных возможностей.

## Настройка шаблона в диспетчере ресурсов

Вы можете настроить проект развертывания, изменив шаблоны JSON, описывающие ресурсы, которые требуется развернуть. JSON означает JavaScript Object Notation (нотация объектов JavaScript) и представляет собой удобный в использовании формат сериализованных данных. Файлы JSON используют схему, ссылка на которую располагается в верхней части каждого файла. Вы можете скачать эту схему и проанализировать ее для лучшего понимания. В схеме определены допустимые элементы, типы и форматы полей, возможные значения перечисляемых значений и т. д. Сведения об элементах шаблона Resource Manager см. в статье [Создание шаблонов диспетчера ресурсов Azure](resource-group-authoring-templates.md).

Для работы с шаблоном откройте файл **WebSiteSQLDatabase.json**.

Редактор Visual Studio предоставляет средства, которые помогают изменить шаблон Resource Manager. Окно **Структура JSON** упрощает просмотр элементов, определенных в шаблоне.

![Показать структуру JSON](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/show-json-outline.png)

При выборе любого элемента в структуре отображается соответствующая часть шаблона и фрагмента JSON.

![Перейти к JSON](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/navigate-json.png)

Можно добавить новый ресурс, нажав кнопку **Добавить ресурс** в верхней части окна структуры JSON. Или же можно щелкнуть правой кнопкой мыши элемент **Ресурсы** и выбрать команду **Добавить новый ресурс**.

![Добавить ресурсы](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/add-resource.png)

Для этого примера выберите пункт **Учетная запись хранения** и присвойте этой учетной записи имя. Имя учетной записи хранения должно содержать только цифры и строчные буквы, а длина не должна превышать 23 символа. Так как проект добавит к указанному имени уникальную строку длиной в 13 символов, введенное имя должно содержать не более 11 символов.

![Добавить хранилище](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/add-storage.png)

Обратите внимание, что добавляется не только ресурс: для типа учетной записи хранения также будет добавлен параметр, а для ее имени — переменная.

![Показать структуру](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/show-new-items.png)

Для параметра **storageType** предварительно определяются допустимые типы и тип по умолчанию. Вы можете использовать эти значения или изменить их для своего сценария. Если требуется ограничить доступ к развертыванию учетной записи хранения **Premium\_LRS** посредством этого шаблона, просто удалите его из списка допустимых типов.

    "storageType": {
      "type": "string",
      "defaultValue": "Standard_LRS",
      "allowedValues": [
        "Standard_LRS",
        "Standard_ZRS",
        "Standard_GRS",
        "Standard_RAGRS"
      ]
    }

Кроме того, Visual Studio предоставляет шаблон IntelliSense, который определяет свойства, доступные при редактировании шаблона. Например, чтобы изменить свойства плана службы приложений, перейдите к ресурсу **HostingPlan** и задайте значение для параметра **properties**. Обратите внимание, что в шаблоне IntelliSense отображаются доступные значения, а также приводится описание каждого значения.

![Показать Intellisense](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/show-intellisense.png)

Можно задать для параметра **numberOfWorkers** значение 1.

    "properties": {
      "name": "[parameters('hostingPlanName')]",
      "numberOfWorkers": 1
    }

## Развертывание проекта группы ресурсов в Azure

Теперь все готово для развертывания проекта. Проект группы ресурсов Azure развертывается в группе ресурсов Azure. Группа ресурсов — это логическое объединение ресурсов с общим жизненным циклом.

1. В контекстном меню узла проекта развертывания последовательно выберите пункты **Развернуть** и **Создать развертывание**.

    ![Пункт меню "Развертывание", "Новое развертывание"](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/deploy.png)

    Откроется диалоговое окно **Развертывание в группе ресурсов**.

    ![Диалоговое окно "Развертывание в группе ресурсов"](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/show-deployment.png)

1. В раскрывающемся списке **Группа ресурсов** выберите существующую группу ресурсов или создайте новую. Чтобы создать группу ресурсов, откройте раскрывающийся список **Группа ресурсов** и выберите **Создать**.

    ![Диалоговое окно "Развертывание в группе ресурсов"](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/create-new-group.png)

    Откроется диалоговое окно **Создание группы ресурсов**. Укажите имя и расположение группы, а затем нажмите кнопку **Создать**.

    ![Диалоговое окно "Создание группы ресурсов"](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/create-resource-group.png)
   
1. Вы можете изменить параметры развертывания, нажав кнопку **Изменить параметры**. Укажите значения для параметров и нажмите кнопку **Сохранить**.

    ![Диалоговое окно "Изменение параметров"](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/provide-parameters.png)
    
    Использовать вариант **Сохранить пароли как обычный текст в файле параметров** не рекомендуется из соображений безопасности.

1. Щелкните кнопку **Развернуть**, чтобы развернуть проект в Azure. Вы можете следить за ходом развертывания в окне **Вывод**. Развертывание может занять несколько минут в зависимости от конфигурации. В консоли PowerShell при появлении запроса введите пароль администратора базы данных. Если процесс развертывания приостановился, возможно, вам нужно ввести пароль в консоли PowerShell.

    >[AZURE.NOTE] В Visual Studio может отобразиться запрос на установку командлетов Azure PowerShell. Командлеты Azure PowerShell необходимы для успешного развертывания групп ресурсов. При появлении запроса установите их.
    
1. По окончании развертывания в окне **Вывод** появится сообщение со следующим содержанием:

        ...
        15:19:19 - DeploymentName     : websitesqldatabase-0212-2318
        15:19:19 - CorrelationId      : 6cb43be5-86b4-478f-9e2c-7e7ce86b26a2
        15:19:19 - ResourceGroupName  : DemoSiteGroup
        15:19:19 - ProvisioningState  : Succeeded
        ...

1. Откройте в браузере [портал Azure](https://portal.azure.com/) и войдите в свою учетную запись. Чтобы просмотреть группу ресурсов, щелкните **Группы ресурсов** и укажите группу ресурсов, в которой выполнено развертывание.

    ![Выбрать группу](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/select-group.png)

1. Отобразятся все развернутые ресурсы.

    ![Показать ресурсы](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/show-deployed-resources.png)

1. Если вы захотите повторно развернуть проект после изменения конфигурации, выберите существующую группу ресурсов в контекстном меню проекта группы ресурсов Azure. В контекстном меню выберите **Развернуть**, а затем выберите развернутую группу ресурсов.

    ![Развернутая группа ресурсов Azure](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/redeploy.png)

## Развертывание кода с определенной инфраструктурой

На этом этапе инфраструктура для приложения уже развернута, а фактический код для проекта — еще нет. В этом разделе показано, как развернуть веб-приложение и таблицы базы данных SQL. При развертывании виртуальной машины вместо веб-приложения на компьютере необходимо запустить определенный код. Процесс развертывания кода для веб-приложения практически не отличается от процесса настройки виртуальной машины.

1. Добавьте в решение Visual Studio шаблон **Веб-приложение ASP.NET**.

    ![Добавить веб-приложение](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/add-app.png)
    
1. Выберите **MVC** и снимите флажок **Разместить в облаке** — эту задачу выполнит проект группы ресурсов.

    ![Выбрать MVC](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/select-mvc.png)
    
1. Когда программа Visual Studio создаст веб-приложение, добавьте ссылку на проект веб-приложения в проект группы ресурсов.

    ![Добавить ссылку](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/add-reference.png)
    
    Добавляя ссылку, вы связываете проект веб-приложения с проектом группы ресурсов и автоматически задаете три ключевых свойства.
    
    - Свойство **Дополнительные свойства** содержит данные о промежуточном расположении пакета веб-развертывания, который будет отправлен в службу хранилища Azure.
    - Свойство **Include File Path** (Включать путь к файлу) содержит путь к расположению, в котором будет создан пакет. Свойство **Include Targets** (Включать целевые объекты) содержит команду, которая будет выполнена при развертывании.
    - Значение по умолчанию свойства **Build;Package** (Сборка;пакет) отвечает за сборку и создание пакета веб-развертывания (package.zip) при развертывании.
    
    Профиль публикации не требуется, так как при развертывании необходимые для создания пакета данные будут получены из свойств.
    
      ![Просмотреть ссылку](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/see-reference.png)
      
1. Добавьте в шаблон какой-нибудь ресурс и на этот раз выберите **Веб-развертывание для веб-приложений**.

    ![Добавить веб-развертывание](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/add-web-deploy.png)
    
1. Повторно разверните проект группы ресурсов в группе ресурсов. В этом случае будут использоваться некоторые новые параметры. Вам не нужно задавать значения для параметров **\_artifactsLocation** или **\_artifactsLocationSasToken**. Visual Studio создает эти значения автоматически. Добавьте в путь, содержащий пакет развертывания, папку и имя файла.

    ![Добавить веб-развертывание](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/set-new-parameters.png)
    
    Для параметра **Учетная запись хранения артефактов** можно указать учетную запись, развернутую в этой группе ресурсов.
    
По завершении развертывания можно перейти на сайт и убедиться, что используемое по умолчанию приложение ASP.NET развернуто успешно.

![Показать развернутое приложение](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/show-deployed-app.png)

## Дальнейшие действия

- Сведения об управлении ресурсами на портале см. в статье [Управление ресурсами Azure через портал](./azure-portal/resource-group-portal.md).
- Дополнительные сведения о шаблонах см. в статье [Создание шаблонов диспетчера ресурсов Azure](resource-group-authoring-templates.md).

<!---HONumber=AcomDC_0810_2016-->