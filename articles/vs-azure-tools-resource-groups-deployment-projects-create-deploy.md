<properties
   pageTitle="Создание и развертывание проектов развертывания группы ресурсов Azure | Microsoft Azure"
   description="Создание и развертывание проектов развертывания группы ресурсов Azure"
   services="visual-studio-online"
   documentationCenter="na"
   authors="kempb"
   manager="douge"
   editor="tlee" />
<tags
   ms.service="azure-resource-manager"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="10/02/2015"
   ms.author="kempb" />

# Создание и развертывание проектов развертывания группы ресурсов Azure

Шаблон проекта развертывания **группы ресурсов Azure** доступен в Visual Studio после установки пакета Azure SDK версии 2.6. Проекты групп ресурсов Azure позволяют сгруппировать несколько связанных ресурсов Azure и опубликовать их в одной операции развертывания. Проекты групп ресурсов Azure используют технологию **Диспетчер ресурсов Azure**. **Диспетчер ресурсов Azure** является службой API REST и позволяет определять группы ресурсов Azure, содержащие несколько ресурсов Azure, обычно использующихся совместно и имеющих схожий жизненный цикл. С помощью групп ресурсов вы можете одним вызовом функции управлять всеми ресурсами группы, а не вызывать функции отдельно для каждого ресурса. Дополнительную информацию о группах ресурсов Azure см. в статье [Управление ресурсами Azure с помощью портала предварительной версии Azure](resource-group-portal.md). Более подробный сквозной сценарий развертывания группы ресурсов Azure приведен в статье [Группа ресурсов Azure для Visual Studio](https://azure.microsoft.com/blog/azure-resource-manager-2-5-for-visual-studio/).

Проекты групп ресурсов Azure содержат шаблоны JSON диспетчера ресурсов Azure, определяющие элементы, которые развертываются в группу ресурсов. Дополнительную информацию см. в статье [Создание шаблонов диспетчера ресурсов Azure](resource-group-authoring-templates.md).

Диспетчер ресурсов Azure содержит множество доступных поставщиков ресурсов, которые вы можете использовать для развертывания ресурсов, например Ubuntu Server и Windows Server 2012 R2. В этом разделе мы используем ресурс **веб-приложений** для развертывания пустого базового веб-сайта в Azure.

## Создание проекта группы ресурсов Azure

В этой процедуре вы узнаете, как создать проект группы ресурсов Azure с помощью шаблона **веб-приложения**.

### Создание проекта группы ресурсов Azure

1. В Visual Studio последовательно выберите **Файл**, **Создать проект**, а затем — **C#** или **Visual Basic**. Щелкните **Облако**, а затем выберите проект **Группа ресурсов Azure**.

    ![Проект облачного развертывания](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/IC796668.png)

1. Выберите шаблон, который вы намерены развернуть в диспетчере ресурсов Azure. В нашем примере мы выберем шаблон **Веб-приложение**.

    ![Выберите шаблон](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/IC796669.png)

    Также вы сможете позже добавить дополнительные ресурсы в группу ресурсов.

    >[AZURE.NOTE]Список доступных шаблонов передается через Интернет и может измениться.

    Visual Studio создает проект развертывания группы ресурсов Azure для веб-приложения.

1. Разверните узлы в проекте развертывания, чтобы увидеть, какие ресурсы созданы.

    Поскольку в этом примере мы выбрали шаблон веб-приложения, вы увидите следующие файлы.

    |Имя файла|Описание|
    |---|---|
    |Deploy-AzureResourceGroup.ps1|Сценарий PowerShell, вызывающий команды PowerShell для развертывания в диспетчере ресурсов Azure.

    **Примечание**. Visual Studio использует этот сценарий PowerShell для развертывания шаблона. Любые изменения, внесенные в этот сценарий, будут влиять и на развертывание в Visual Studio, поэтому будьте внимательны. | ! WebSite.json| Файл конфигурации, содержащий все сведения, который вы желаете развернуть в диспетчере ресурсов Azure. | | WebSite.param.dev.json| Файл параметров, который содержит конкретные значения, необходимые для файла конфигурации. | | AzCopy.exe| Средство, которое сценарий PowerShell использует для копирования файлов из пути перемещения локального хранилища в контейнер учетной записи хранения. Это средство используется только в том случае, если в конфигурации проекта вы настроите развертывание кода одновременно с шаблоном. |

    Все проекты развертывания группы ресурсов Azure содержат эти четыре основных файла. Другие проекты могут содержать дополнительные файлы для поддержки других функциональных возможностей.

## Настройка проекта группы ресурсов Azure

Вы можете настроить проект развертывания, изменив файлы шаблона JSON, описывающие ресурсы Azure, которые вы желаете развернуть. JSON означает JavaScript Object Notation (нотация объектов JavaScript) и представляет собой удобный в использовании формат сериализованных данных.

Проекты групп ресурсов Azure содержат в узле **Шаблоны** обозревателя решений два файла шаблона, которые вы можете изменить: файл шаблона диспетчера ресурсов Azure и файл параметров.

- **Файлы шаблонов диспетчера ресурсов Azure** (с расширением JSON) указывают файлы с нужными вам ресурсами и параметры, необходимые для проекта развертывания, например имя и расположение сайта. Также они определяют зависимости компонентов в группе ресурсов Azure и их свойства, например имена, теги и правила для триггеров. Вы можете изменить этот файл, чтобы добавить собственные функции. Например, вы можете добавить в шаблон базу данных. Параметры, которые необходимо указать в шаблоне, вы сможете найти в документации для конкретного поставщика ресурсов. Дополнительную информацию см. в статье [Поставщики ресурсов](https://msdn.microsoft.com/library/azure/dn790572.aspx).

- **Файлы параметров ** (с расширением `.param.*.json`) содержат значения для тех параметров, которые указаны в файле конфигурации для каждого поставщика ресурсов. В этом примере файл конфигурации для веб-приложения (WebSite.json) определяет параметры *siteName* и *siteLocation*. Во время развертывания вам будет предложено задать значения для параметров, указанных в файле шаблона, и эти значения будут сохранены в файле параметров. Также вы можете напрямую редактировать файл параметров.

Файлы JSON можно изменить в редакторе Visual Studio. Если вы установите [средства PowerShell для Visual Studio](https://visualstudiogallery.msdn.microsoft.com/c9eb3ba8-0c59-4944-9a62-6eee37294597), то сможете использовать подсветку синтаксиса, парные фигурные скобки и функцию IntelliSense, которые облегчают чтение и редактирование сценариев PowerShell. Ссылка на установку средств PowerShell, если они еще не установлены, отображается в верхней части редактора.

![Установка средств PowerShell](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/IC796671.png)

Файлы JSON используют схему, ссылка на которую располагается в верхней части каждого файла. Вы можете загрузить эту схему и проанализировать ее для лучшего понимания. В схеме определены допустимые элементы, типы и форматы полей, возможные значения перечисляемых значений и т. д.

Если вы хотите использовать разные конфигурации развертывания или часто меняете параметры, вы можете создать несколько копий файла *param*. Старайтесь использовать один шаблон для всех сред.

## Развертывание проекта группы ресурсов Azure в группе ресурсов Azure

При развертывании проекта группы ресурсов Azure вы разворачиваете его в группе ресурсов Azure, которая представляет собой логическое группирование ресурсов в Azure, например веб-приложений, баз данных и т. д.

1. Последовательно выберите в контекстном меню узла проекта развертывания пункты **Развернуть** и **Новое развертывание**.

    ![Пункт меню «Развертывание», «Новое развертывание»](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/IC796672.png)

    Откроется диалоговое окно **Развертывание в группе ресурсов**.

    ![Диалоговое окно «Развертывание в группе ресурсов»](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/IC796673.png)

1. Выберите существующую группу ресурсов в раскрывающемся списке **Группа ресурсов** или создайте новую. Чтобы создать группу ресурсов, откройте раскрывающийся список **Группа ресурсов** и выберите пункт **<Create New...>**.

    Откроется диалоговое окно **Создание группы ресурсов**.

    ![Диалоговое окно «Создание группы ресурсов»](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/IC796674.png)

    >[AZURE.NOTE]Обычно при выполнении нового проекта развертывания вы будете создавать новую группу ресурсов и выполнять развертывание в ней.

1. Введите имя и расположение для группы ресурсов и нажмите кнопку **Создать**.

    Расположение группы ресурсов не должно совпадать с расположением ресурсов, поскольку ресурсы в группе могут охватывать несколько регионов.

1. Выберите файлы конфигурации и параметров шаблона, которые вы хотите использовать для этого развертывания, или подтвердите значения по умолчанию.

    Вы можете изменить свойства ресурса, нажав кнопку **Изменить параметры**. Если при развертывании отсутствуют обязательные параметры, появится диалоговое окно **Изменить параметры**, в котором вы сможете ввести нужные значения. В строках с теми параметрами, для которых отсутствуют значения, в поле **Значение** будет указано **<null>**. В этом примере (ресурс веб-приложения) обязательными параметрами являются имя узла, план размещения и расположение узла. (Возможно, вы помните, что эти параметры получают по умолчанию значения null в файле параметров). Для других параметров существуют значения по умолчанию.

    ![Диалоговое окно «Изменение параметров»](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/IC796675.png)

1. В диалоговом окне **Изменение параметров** введите имя и расположение сайта, имя плана размещения, а также проверьте значения других свойств. Когда все будет готово, нажмите кнопку **Сохранить**.

    - Параметр *siteName* является первой частью URL-адреса веб-страницы. Например, для URL-адреса mywebsitename.azurewebsites.net параметр siteName будет иметь значение **mywebsitename**.

    - Параметр *hostingPlanName* указывает план размещения. В этом примере вы можете использовать значение «Free». Дополнительные сведения о планах размещения см. в разделе [Подробный обзор планов службы приложений Azure](http://azure.microsoft.com/documentation/articles/azure-web-sites-web-hosting-plans-in-depth-overview/).

    - Параметр *siteLocation* указывает регион Azure, где будет размещен сайт, например «Запад США». Список доступных регионов см. на странице [Регионы Azure](http://azure.microsoft.com/regions/).

1. Щелкните кнопку **Развернуть**, чтобы развернуть проект в Azure.

    Вы можете следить за ходом развертывания в окне **Вывод**. Развертывание может занять несколько минут в зависимости от конфигурации.

    >[AZURE.NOTE]Вы можете получить запрос на установку командлетов Microsoft Azure PowerShell. Поскольку эти командлеты обязательны для развертывания группы ресурсов Azure, вам следует установить их.

1. Откройте в браузере [портал предварительной версии Azure](https://portal.azure.com/). Поскольку это новое изменение, на вкладке **Уведомления** должно присутствовать новое сообщение. Выберите его, чтобы просмотреть сведения о новой группе ресурсов Azure. Чтобы просмотреть список всех доступных групп ресурсов, выберите вкладку **Обзор** и щелкните **Группы ресурсов**.

    ![Подготовленная группа ресурсов Azure](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/IC796676.png)

1. Если вы захотите повторно развернуть проект после изменения конфигурации, вы можете выбрать существующую группу ресурсов непосредственно в контекстном меню проекта группы ресурсов Azure. В контекстном меню выберите **Развернуть**, а затем выберите группу ресурсов, в которую было выполнено развертывание.

    ![Развернутая группа ресурсов Azure](./media/vs-azure-tools-resource-groups-deployment-projects-create-deploy/IC796677.png)

    При развертывании группы ресурсов Azure развертывается только этот проект. Если решение содержит проект кода или другие дополнительные проекты, вам нужно будет развернуть их отдельно.

## Использование проектов облачного развертывания пакета Azure SDK 2.5 с пакетом Azure SDK версии 2.6

Если вы используете проекты облачного развертывания, которые были созданы с помощью пакета Azure SDK 2.5, следует выполнить обновление до Azure SDK 2.6 или более поздней версии, чтобы использовать новые функции редактирования и развертывания шаблонов ресурсов Azure. Для повторного использования шаблонов, созданных с помощью Azure SDK 2.5, проще всего будет создать версию проекта для пакета Azure SDK 2.6 или более поздней версии, переместить в него шаблоны и внести некоторые изменения.

### Использование проектов облачного развертывания пакета Azure SDK 2.5 с пакетом Azure SDK 2.6 или более поздней версии

1. Добавьте в свое решение новый проект группы ресурсов Azure для пакета Azure SDK 2.6 или более поздней версии.

    1. Откройте решение, в котором размещен проект облачного развертывания Azure SDK 2.5.

    1. В меню **Файл** выберите **Создать**, а затем — **Проект**.

    1. В диалоговом окне **Новый проект** найдите проект **Группа ресурсов Azure** в разделе **Visual C#**/**Облако** или **Visual Basic**/ **Облако**.

         Имя шаблона проекта изменено с **Облачное развертывание** на «Группа ресурсов Azure».

    1. Введите имя для проекта.

    1. В раскрывающемся списке решения выберите **Добавить в решение**.

    1. Далее вам будет предложено выбрать шаблон. Поскольку вы будете перемещать готовые шаблоны из проекта облачного развертывания Azure SDK 2.5, здесь можно выбрать любой шаблон, например пустой шаблон в нижней части списка.

    1. Нажмите кнопку **ОК**.

        Новый проект будет добавлен в решение.

1. Скопируйте файлы шаблона и параметров из проекта облачного развертывания Azure SDK 2.5 в проект группы ресурсов Azure SDK 2.6 или более поздней версии.

    1. Перейдите в обозреватель решений, найдите в проекте развертывания Azure SDK 2.5 файлы шаблона и параметров, которые хотите скопировать, выделите их и скопируйте.

    2. Вставьте файлы в папку **Шаблоны** нового проекта группы ресурсов Azure SDK 2.6 или более поздней версии.

1. Перейдите в обозреватель решений, найдите в проекте развертывания Azure SDK 2.5 файлы шаблона и параметров, которые хотите скопировать, выделите их и скопируйте.

1. Вставьте файлы в папку «Шаблоны» нового проекта группы ресурсов Azure SDK 2.6 или более поздней версии.

1. Если вместе с шаблоном развертывается и веб-приложение, необходимо будет создать ссылку на это веб-приложение в новом проекте группы ресурсов Azure SDK 2.6 или более поздней версии.

    1. В обозревателе решений откройте контекстное меню узла **Ссылки** нового проекта группы ресурсов Azure SDK 2.6 или более поздней версии и выберите **Добавить ссылку**.

    1. Установите флажок напротив нужного веб-приложения в списке проектов, а затем нажмите кнопку **ОК**.

1. В обозревателе решений откройте контекстное меню узла «Ссылки» нового проекта группы ресурсов Azure SDK 2.6 или более поздней версии и выберите «Добавить ссылку».

1. Установите флажок напротив нужного веб-приложения в списке проектов, затем нажмите кнопку ОК.

1. Переименуйте все экземпляры параметров *dropLocation* и *dropLocationSasToken* в *\_artifactsLocation* и *\_artifactsLocationSasToken*.

1. Вы можете удалить пустые файлы шаблонов и параметров, которые были автоматически добавлены в проект Azure SDK 2.6 или более поздней версии при его создании, если не собираетесь использовать их.

    1. Удалите файл DeployTemplate.json.

    1. Удалите файл DeploymentTemplate.param.dev.json.

1. Если вы вносили изменения в сценарий Publish-AzureResourceGroup.ps1 проекта Azure SDK 2.5, следует перенести эти изменения в сценарий Deploy-AzureResourceGroup.ps1 проекта Azure SDK 2.6 или более поздней версии.

    Теперь вы можете развернуть шаблон с помощью команды развертывания в проекте группы ресурсов Azure SDK 2.6 или более поздней версии. После этого вы сможете пользоваться новыми функциями Azure SDK 2.6 для редактирования шаблонов. Когда вы убедитесь, что проект Azure SDK 2.6 или более поздней версии работает правильно, можете удалить из решения проект Azure SDK 2.5.

## Почему требуется обновление проекта

Были внесены некоторые изменения в шаблоны, развернутые в Azure SDK 2.6, и теперь они не совместимы со сценарием развертывания и шаблонами Azure SDK 2.5. Первым и основным изменением является запуск развертывания. В Azure SDK 2.5 был скомпилирован код, который использовал интерфейсы REST API Azure для передачи шаблона и запуска развертывания. Многие разработчики выражали пожелание, чтобы среда Visual Studio просто запускала сценарий PowerShell, включенный в проект. Поэтому в Azure SDK 2.6 команда развертывания запускает для развертывания шаблона сценарий PowerShell, который включен в проект. Это позволяет вам изменять настройки развертывания и всегда использовать их как при развертывании из командной строки с помощью Azure PowerShell, так и при развертывании с помощью команды развертывания из Visual Studio. Для развертывания из Visual Studio следует использовать сценарий развертывания PowerShell для пакета Azure SDK 2.6 (или более поздней версии), если вы установили пакет Azure SDK 2.6 или более поздней версии.

Также внесены изменения в имена некоторых переменных и задач построения, чтобы они соответствовали соглашениям об именовании, используемым в автоматических сборках TFS и других проектах корпорации Майкрософт. Код в Visual Studio, который собирает переменные и значения для запуска сценария PowerShell, будет искать эти новые имена.

## Дальнейшие действия

Узнайте из статьи [Добавление ресурсов в группу ресурсов Azure](vs-azure-tools-resource-group-adding-resources.md), как добавить ресурсы в группу ресурсов Azure в Visual Studio.

<!---HONumber=AcomDC_1203_2015-->