<properties title="Manage DocumentDB capacity and performance" pageTitle="Manage DocumentDB capacity and performance | Azure" description="Learn how you can elastically scale DocumentDB to meet the performance and storage needs of your application." metaKeywords="" services="documentdb" solutions="data-management"  authors="bradsev" manager="jhubbard" editor="cgronlun"  videoId="" scriptId="" />

<tags ms.service="documentdb" ms.workload="data-services" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="08/20/2014" ms.author="bradsev" />

# Управление емкостью и производительностью DocumentDB

DocumentDB это полностью управляемая, масштабируемая, документоориентированная служба баз данных NoSQL. При использовании DocumentDB нет необходимости арендовать виртуальные машины, устанавливать программное обеспечение, осуществлять мониторинг баз данных или беспокоиться об аварийном восстановления. DocumentDB обслуживается и постоянно контролируется инженерами корпорации Майкрософт, чтобы предоставлять первоклассный сервис по показателям доступности, производительности и защиты данных.

Вы можете начать работу с DocumentDB, создав учетную запись базы данных через портал Microsoft Azure. DocumentDB предоставляется в виде составных единиц емкости (CU) из хранилищ на базе SSD и пропускной способности. Вы можете гибко масштабировать DocumentDB для удовлетворения потребностей производительности и хранения вашего приложения.

Каждая единица емкости имеет квоту гибких коллекций для хранения данных документов, подготовленного хранилища документов и подготовленной пропускной способности в единицах запросов в секунду. Если требования к емкости вашего приложения изменятся, вы можете провести горизонтальное или вертикальное масштабирование подготовленных емкостей для вашей учетной записи базы данных. Емкость, подготовленная для учетной записи базы данных, доступна для всех баз данных и коллекций, которые уже существуют или будут созданы в учетной записи.

# Учетная запись баз данных и административные квоты

Как подписчик служб Azure, вы можете подготовить одну или несколько учетных записей баз данных DocumentDB. Каждая учетная запись базы данных имеет квоту административных ресурсов, включая 100 баз данных, 500 000 пользователей и 2 000 000 разрешений.

# Базы данных с неограниченным хранилищем документов

Отдельная база данных DocumentDB может содержать практически неограниченное количество хранимых документов, разбитых на разделы коллекциями. Коллекции образуют домены транзакций для документов, содержащихся в них. База данных DocumentDB по умолчанию обладает гибкостью, размер может меняться от нескольких гигабайт до потенциально петабайт хранилищ документов на базе SSD и подготовленной пропускной способности. В отличие от традиционных реляционных СУБД, базы данных в DocumentDB не ограничены одним узлом.

С DocumentDB по мере роста масштабов потребностей вашего приложения, вы можете создать несколько коллекций или баз данных, либо и то и другое. Действительно, различные собственные приложения корпорации Майкрософт уже используют DocumentDB в потребительском масштабе путем создания чрезвычайно больших баз данных DocumentDB, каждая из которых содержит тысячи коллекций с терабайтами хранимых документов. Вы можете увеличить или уменьшить базу данных, добавляя или удаляя коллекции для удовлетворения требований масштабности вашего приложения. Вы можете создать любое количество коллекций в пределах субъекта базы данных, чтобы обеспечить доступность и количество единиц емкости, которые вы покупаете. Хранилища на базе SSD и пропускная способность, подготовленная для вас, может быть распределена по коллекции под базы данных в вашей учетной записи баз данных.

# Эластичные коллекции

Каждая база данных DocumentDB содержит одну или несколько коллекций. Коллекция обеспечивает область для хранения документов и выполнения запросов. Коллекция также является доменом транзакций для всех входящих в ее состав документов. Коллекции обладают гибкостью, они могут увеличиваться и уменьшаться в объеме хранения и пропускной способности. Вы можете создать любое количество коллекций в соответствии с требованиями масштабируемости ваших приложений. Для создания коллекций предварительно необходимо приобрести одну или несколько единиц емкости (capacity unit (CU). Каждая единица емкости включает квоту коллекций, при превышении которой необходимо приобрести для учетной записи дополнительные единицы емкости.

> [AZURE.NOTE] Обратите внимание, что для предварительной версии размер коллекций может изменяться в пределах от 0 до 10 ГБ.

# Подготовленные хранилища и пропускная способность в виде единиц емкости

Вы можете подготовить наращиваемые единицы хранилищ документов на базе SSD и пропускную способность в виде единиц емкости (CU). Вы можете гибко масштабировать DocumentDB с предсказуемым уровнем производительности путем приобретения дополнительных единиц емкости, чтобы удовлетворить потребности вашего приложения для масштабирования операций чтения, хранения данных и пропускной способности.

Каждая CU включает с 3 гибких коллекций, подготовленное хранилище документов на базе SSD объемом 10 ГБ и 2000 единиц запросов (RU) для подготовленной пропускной способности. Подготовленное хранилище и пропускная способность, связанные с CU, распределяются по коллекции DocumentDB, которую вы создаете.

# Подготовленная пропускная способность, единицы запросов и операции базы данных

В отличие от хранилищ ключ-значение NoSQL, которые предлагают элементарные операции GET и PUT, DocumentDB позволяет в полной мере воспользоваться набором операций с базами данных, включая реляционные и иерархические запросы с пользовательскими функциями, хранимыми процедурами и триггерами, и все это работает с документами в коллекции базы данных. Затраты, связанные с каждой из этих операций будет зависеть от типа процессора, операций ввода-вывода и памяти, необходимой для завершения операции. Вместо того чтобы думать о закупке и управлении аппаратными ресурсами, вы можете думать о единице запроса (RU) как единой меры для ресурсов, необходимых для выполнения различных операций с базами данных и обслуживания запросов приложений.

Единицы запросов подготавливаются для каждой учетной записи базы данных на основе приобретенных единиц емкости. Удельный расход единиц запросов оценивается в расчете на одну секунду. Частота запросов для приложений, у которых она превышает подготовленные единицы запросов для учетной записи, будет снижена, пока она не упадет ниже зарезервированного для учетной записи уровня. Если ваше приложение требует более высокого уровня пропускной способности, вы можете приобрести дополнительные единицы емкости.

В следующей таблице приводится список различных операций с базами данных и единиц запросов доступных для CU. Таблица поможет вам спланировать, каким образом операции базы данных потребляют подготовленную пропускную способность, связанную с CU. Мы исходим из предположения, что размер документа составляет 1 килобайт, он состоит из 10 уникальных значений свойств с уровнем согласованности по умолчанию установленным в "сеанс" и все документы автоматически проиндексированны DocumentDB.

| Операции с базой данных                                              | Количество операций в секунду на CU \\ |
|----------------------------------------------------------------------|----------------------------------------|
| Чтение одиночного документа                                          | 2000                                   |
| Вставка/замена/удаление одиночного документа                         | 500                                    |
| Запрос коллекции с простым предикатом и возврат одиночного документа | 1000                                   |
| Хранимая процедура со вставкой 50 документов                         | 20                                     |

Обратите внимание, что единицы запросов, потребляемые операциями вставки/замены/удаления операций для автоматически индексированных документов примерно в 4 раза больше, чем для операций чтения документа. Вышеуказанная таблица приведена исключительно в справочных целях. Однако, на практике,

-   размеры документов могут отличаться (и не соответствовать размеру в 1 КБ),
-   документы могут иметь более 10 свойств.
-   Вы можете выбрать уровень согласованности по умолчанию из значений Strong, Bounded Staleness или Eventual
-   Вы можете исключить из индексирования некоторые из ваших документов
-   Вы можете выбрать для индекса только некоторые из свойств, не позволяя DocumentDB автоматически индексировать все свойства
-   Ваши запросы и хранимые процедуры могут быть гораздо сложнее.

Для получения точного количества единиц запросов для вашего приложения, вы можете использовать калькулятор единиц запросов для расчета единиц запросов, потребленных для различных операций. Вы также можете проверить заголовок ответа x-ms-request-charge, который включает количество единиц запросов потребляемых для данного запроса.

[Калькулятор единиц запросов][Калькулятор единиц запросов]

# Коллекции и подготовленная пропускная способность

Подготовленная пропускная способность для вашей учетной записи базы данных выделяется равномерно для всех коллекций до достижения максимального уровня (единиц запросов) для одной коллекции. Например, если вы покупаете одну единицу емкости и создаете единственную коллекцию, то вся подготовленная пропускная способность для CU будут доступна этой коллекции. Если будет создана дополнительная коллекция, то подготовленная пропускная способность будет распределена равномерно, для каждой коллекции будет выделена половина всей подготовленной пропускной способности.

# Выбор уровня согласованности и пропускной способности

Выбор уровня согласованности по умолчанию влияет на производительность и задержки. Вы можете установить уровень согласованности по умолчанию как программно, так и через портал Azure. Вы также можете переопределить уровень согласованности для каждого запроса. По умолчанию, уровень согласованности определен на уровне сеанса, что обеспечивает монотонное чтение/запись и гарантированное чтение записанных данных. Согласованность на уровне сеанса великолепна для ориентированных на пользователей приложений, и обеспечивает идеальный баланс компромиссов согласованности и производительности.

-   Согласованность на уровней сеанса и согласованность в конечном счете обеспечивают около 2000 запросов на чтение документов и 500 операций вставки/замены/удаления документов.
-   Сильные и ограниченные уровни согласованности обеспечивают около 1200 запросов на чтение документов и примерно 500 операций вставки/замены/ удаления документов. Задержки при вставке/замене/удалении для ограниченной согласованности значительно ниже, чем для сильной.

[Калькулятор единиц запросов][Калькулятор единиц запросов]

# Подготовленное хранилище документов и накладные расходы на индексирование

Каждый приобретенный CU добавляет к вашей учетной записи хранилище документов на базе SSD объемом 10 ГБ. В эти 10 ГБ включено как место для хранения собственно документов, так и место для хранения индекса. По умолчанию, коллекция DocumentDB настроена на автоматическое индексирование всех документов без явного указания вторичных индексов или схем. На основании применения DocumentDB в реальных масштабах первых сторонних приложений, типичные накладные расходы на хранение индекса составляют 2-20%. Технология индексирования, используемая DocumentDB, гарантирует, что независимо от значений свойств, показатель накладных расходов не превышает 80% от размера документов с параметрами по умолчанию.

По умолчанию все документы индексируются DocumentDB автоматически. Тем не менее, в случае, если вы хотите, чтобы точно настроить накладные расходы на индексирование, вы можете выбрать удаление определенных документы из индексации при вставке или замене документа. Вы можете настроить коллекцию DocumentDB чтобы исключить все документы в коллекции от индексации. Вы также можете настроить коллекцию DocumentDB для выборочного индексирования только определенных свойства или путей со специальными символами в ваших документах JSON. Исключение свойств или документов их индексирования также улучшает пропускную способность записи, это значит, вы будете потреблять меньшее количество единиц запросов.

[Калькулятор единиц запросов][Калькулятор единиц запросов]

  [Калькулятор единиц запросов]: http://go.microsoft.com/fwlink/?LinkID=510088
