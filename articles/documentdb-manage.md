<properties title="Manage DocumentDB capacity and performance" pageTitle="Управление емкостью и производительностью DocumentDB | Azure" description="Узнайте, как эластично масштабировать DocumentDB, чтобы удовлетворить потребности производительности и хранения данных своего приложения." metaKeywords="" services="documentdb" solutions="data-management"  authors="bradsev" manager="jhubbard" editor="cgronlun"  videoId="" scriptId="" />

<tags ms.service="documentdb" ms.workload="data-services" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="08/20/2014" ms.author="spelluru" />

#Управление емкостью и производительностью DocumentDB
DocumentDB - это полностью управляемая, масштабируемая, документоориентированная служба баз данных NoSQL.  DocumentDB не требует аренды виртуальных машин, развертывания программного обеспечения, отслеживания баз данных или аварийного восстановления. Для обеспечения высочайших показателей доступности, производительности и защиты данных DocumentDB обслуживается и постоянно контролируется инженерами корпорации Майкрософт.  

Вы можете начать работу с DocumentDB, создав учетную запись базы данных на портале Microsoft Azure. DocumentDB предоставляется в виде составных единиц емкости (CU) из хранилищ на базе SSD и пропускной способности. Вы можете увеличивать или уменьшать масштаб DocumentDB в зависимости от требований к производительности и объему хранилища вашего приложения. 

Каждая единица емкости включает квоту коллекций (количество которых можно изменять) для хранения данных документов, предоставляемые хранилище документов и пропускную способность, которая измеряется в единицах запросов в секунду. Если требования к емкости вашего приложения изменятся, вы можете провести горизонтальное или вертикальное масштабирование подготовленных емкостей для вашей учетной записи базы данных. Емкость, предоставляемая для учетной записи базы данных, доступна для всех существующих и создаваемых баз данных и коллекций в учетной записи.  

#Учетная запись баз данных и административные квоты
Как подписчик служб Azure, вы можете предоставить одну или несколько учетных записей баз данных DocumentDB. Каждая учетная запись базы данных имеет квоту административных ресурсов, включая 100 баз данных, 500 000 пользователей и 2 000 000 разрешений.   

#Базы данных с неограниченным хранилищем документов
Отдельная база данных DocumentDB может содержать практически неограниченное хранилище документов, разделенных на коллекции. Коллекции образуют домены транзакций для документов, содержащихся в них. База данных DocumentDB по умолчанию обладает гибкостью, размер может меняться от нескольких гигабайт до потенциально петабайт хранилищ документов на базе SSD и подготовленной пропускной способности. В отличие от традиционных реляционных СУБД базы данных в DocumentDB не ограничены одним узлом.   

По мере увеличения потребностей вашего приложения вы можете создать в DocumentDB несколько коллекций или баз данных, либо и то и другое. Действительно, различные собственные приложения корпорации Майкрософт уже используют DocumentDB в потребительском масштабе путем создания чрезвычайно больших баз данных DocumentDB, каждая из которых содержит тысячи коллекций с терабайтами хранимых документов. Вы можете увеличить или уменьшить базу данных, добавляя или удаляя коллекции для удовлетворения требований масштабности вашего приложения. Вы можете создать любое количество коллекций в пределах субъекта базы данных, чтобы обеспечить доступность и количество единиц емкости, которые вы покупаете. Хранилище на базе SSD и пропускная способность, предоставляемые вам, могут распределяться между коллекциями в рамках баз данных в вашей учетной записи базы данных. 

#Эластичные коллекции
Каждая база данных DocumentDB может содержать одну или несколько коллекций. Коллекция обеспечивает область для хранения документов и выполнения запросов. Коллекция также является доменом транзакций для всех входящих в ее состав документов. Коллекции обладают гибкостью, они могут увеличиваться и уменьшаться в объеме хранения и пропускной способности. Вы можете создать любое количество коллекций в соответствии с требованиями масштабируемости ваших приложений. Для создания коллекций предварительно необходимо приобрести одну или несколько единиц емкости (capacity unit (CU). Каждая единица емкости включает квоту коллекций для учетной записи, при превышении которой необходимо приобрести дополнительные единицы емкости.  

>[AZURE.NOTE] Обратите внимание, что в предварительном выпуске размер коллекций может изменяться в пределах от 0 до 10 ГБ. 

#Предоставляемые хранилища и пропускная способность в виде единиц емкости
Вы можете предоставить наращиваемые единицы хранилища документов на базе SSD и пропускную способность в виде единиц емкости. Чтобы соответствовать потребностям вашего приложения для масштабирования операций чтения, хранения данных и пропускной способности, вы можете масштабировать DocumentDB с предсказуемым уровнем производительности путем приобретения дополнительных единиц емкости.  
 
Каждая единица емкости включает 3 гибких коллекции, предоставляемое хранилище документов на базе SSD объемом 10 ГБ и предоставляемую пропускную способность на 2000 единиц запросов. Хранилище и пропускная способность, предоставляемые в единицах емкости, распределяются между коллекциями, которые вы создаете в DocumentDB.   

#Подготовленная пропускная способность, единицы запросов и операции базы данных
В отличие от хранилищ NoSQL, использующих принцип "ключ-значение" и предлагающих элементарные операции GET и PUT, DocumentDB использует расширенный набор операций с базами данных, в том числе реляционные и иерархические запросы с использованием UDF, хранимых процедур и триггеров для работы с документами в коллекции базы данных. Затраты, связанные с каждой из этих операций, будут зависеть от типа процессора, операций ввода-вывода и памяти, необходимой для завершения операции.  Вместо того чтобы думать о закупке и управлении аппаратными ресурсами, вы можете думать о единице запроса (RU) как единой меры для ресурсов, необходимых для выполнения различных операций с базами данных и обслуживания запросов приложений.   

Единицы запросов предоставляются для каждой учетной записи базы данных в зависимости от количества приобретенных единиц емкости. Удельный расход единиц запросов оценивается в расчете на одну секунду. Частота запросов для приложений, у которых она превышает подготовленные единицы запросов для учетной записи, будет снижена, пока она не упадет ниже зарезервированного для учетной записи уровня. Если ваше приложение требует более высокой пропускной способности, вы можете приобрести дополнительные единицы емкости.  

В следующей таблице представлены список различных операций с базами данных и количество единиц запросов в одной единице емкости. Таблица поможет вам спланировать, каким образом операции базы данных потребляют пропускную способность, предоставляемую в единицах емкости.  Мы предполагаем, что для документа размером 1 КБ, состоящего из 10 уникальных значений свойств, по умолчанию задана согласованность на уровне сеанса и все документы автоматически индексируются в DocumentDB. 

|Операции с базой данных|Количество операций в секунду на единицу емкости|
|-------------------|--------------------------------------|
|Чтение одного документа	|2000
|Вставка, замена и удаление одного документа	|500
|Запрос коллекции с простым предикатом и возврат одного документа	|1000
|Хранимая процедура с возможностью вставки 50 документов	|20

Обратите внимание, что единицы запросов, потребляемые операциями вставки, замены и удаления для автоматически индексированных документов примерно в 4 раза больше, чем для операций чтения документа. Вышеуказанная таблица приведена исключительно в справочных целях. Но на практике  

-	размеры документов могут отличаться (и не соответствовать размеру в 1 КБ), 
-	документы могут иметь более 10 свойств.
-	Вы можете выбрать уровень согласованности по умолчанию из значений Strong, Bounded Staleness или Eventual
-	Вы можете исключить из индексирования некоторые из ваших документов 
-	Вы можете выбрать для индекса только некоторые из свойств, не позволяя DocumentDB автоматически индексировать все свойства
-	Ваши запросы и хранимые процедуры могут быть гораздо сложнее.  

 Вы можете подсчитать количество единиц запросов, потребляемых для конкретного запроса, проверив заголовок ответа x-ms-request-charge этого запроса.  

#Коллекции и подготовленная пропускная способность
Предоставляемая пропускная способность для вашей учетной записи базы данных выделяется равномерно для всех коллекций до достижения максимального уровня (единиц запросов) для одной коллекции. Например, если вы покупаете одну единицу емкости и создаете единственную коллекцию, то вся подготовленная пропускная способность для CU будут доступна этой коллекции. При создании дополнительной коллекции предоставляемая пропускная способность будет распределена равномерно - для каждой коллекции будет выделена половина всей предоставляемой пропускной способности.  

#Выбор уровня согласованности и пропускной способности
Выбор уровня согласованности по умолчанию влияет на производительность и задержки.  Вы можете установить уровень согласованности по умолчанию как с помощью программных средств, так и на портале Azure. Вы также можете переопределить уровень согласованности для каждого запроса. По умолчанию, уровень согласованности определен на уровне сеанса, что обеспечивает монотонное чтение/запись и гарантированное чтение записанных данных. Согласованность на уровне сеанса идеально подходит для приложений, ориентированных на пользователя, и обеспечивает идеальный баланс между согласованностью и производительностью.   

-	Согласованность на уровней сеанса и согласованность в конечном счете обеспечивают около 2000 запросов на чтение документов и 500 операций вставки/замены/удаления документов.
-	Строгая согласованность и ограниченная согласованность с запаздыванием обеспечивают около 1200 запросов на чтение документов и 500 операций вставки, замены и удаления документов. Задержки операций вставки, замены и удаления при ограниченной согласованности с запаздыванием значительно ниже, чем при строгой.  

#Подготовленное хранилище документов и накладные расходы на индексирование
С каждой приобретенной единицей емкости к вашей учетной записи добавляется 10 ГБ хранилища документов на базе SSD. В эти 10 ГБ включено как место для хранения собственно документов, так и место для хранения индекса. По умолчанию коллекция DocumentDB настроена на автоматическое индексирование всех документов без явного указания вторичных индексов или схем. На основании применения DocumentDB в реальных масштабах первых сторонних приложений типичные накладные расходы на хранение индекса составляют 2-20 %. Технология индексирования, используемая DocumentDB, гарантирует, что, независимо от значений свойств, показатель накладных расходов не превышает 80 % от размера документов с параметрами по умолчанию.  

По умолчанию все документы индексируются DocumentDB автоматически. Тем не менее, в случае, если вы хотите, чтобы точно настроить накладные расходы на индексирование, вы можете выбрать удаление определенных документы из индексации при вставке или замене документа. Вы можете настроить коллекцию DocumentDB чтобы исключить все документы в коллекции от индексации. Кроме того, вы можете настроить в коллекции DocumentDB выборочное индексирование только определенных свойств или путей со специальными символами в документах JSON.  Исключение свойств или документов также повышает пропускную способность записи, то есть будет потребляться меньшее количество единиц запросов.   
 
