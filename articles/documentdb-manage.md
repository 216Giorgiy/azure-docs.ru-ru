<properties 
	pageTitle="Управление емкостью и производительностью DocumentDB | Azure" 
	description="Узнайте, как гибко масштабировать DocumentDB для удовлетворения потребностей своего приложения в емкости." 
	services="documentdb" 
	authors="mimig1, johnfmacintyre" 
	manager="jhubbard" 
	editor="cgronlun" 
	documentationCenter=""/>

<tags 
	ms.service="documentdb" 
	ms.workload="data-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/13/2015" 
	ms.author="mimig"/>

# Управление емкостью и производительностью DocumentDB
DocumentDB - это полностью управляемая, масштабируемая и ориентированная на документы служба базы данных NoSQL.  Благодаря DocumentDB вам не нужно арендовать виртуальные машины, развертывать программное обеспечение, отслеживать работу баз данных и беспокоиться об аварийном восстановлении. Система DocumentDB обслуживается и непрерывно контролируется инженерами корпорации Майкрософт, что позволяет добиться доступности, производительности и защиты данных мирового уровня.  

Вы можете начать работу с DocumentDB, создав учетную запись базы данных на [портале управления предварительной версии Microsoft Azure](https://portal.azure.com/). DocumentDB предлагается в виде наращиваемых единиц емкости, представленных хранилищем на базе твердотельных накопителей и пропускной способностью. Вы можете гибко масштабировать DocumentDB для удовлетворения потребностей производительности и хранения вашего приложения. 

Каждая единица емкости имеет квоту коллекций для хранения данных документов, подготовленное хранилище документов и подготовленную пропускную способность в единицах запросов в секунду. Если требования к емкости вашего приложения изменятся, вы можете провести горизонтальное или вертикальное масштабирование подготовленных емкостей для вашей учетной записи базы данных. Емкость, предоставляемая в рамках учетной записи базы данных, доступна для всех баз данных и коллекций, существующих или создаваемых в этой учетной записи.

> [AZURE.NOTE] Каждая коллекция способна осуществлять масштабирование как по хранилищу, так и по пропускной способности до максимально допустимого [предела](http://azure.microsoft.com/documentation/articles/documentdb-limits/). Пропускная способность равномерно распределяется между всеми коллекциями с учетом максимального предела на коллекцию.

Когда приложение превышает уровни производительности для одной или нескольких коллекций, осуществляется регулирование запросов по отдельным коллекциям. Это означает, что некоторые запросы приложения могут успешно выполняться, в то время как другие могут регулироваться.

## <a name="DBaccount"></a>Учетная база данных и административные ресурсы
Являясь подписчиком Azure, вы можете подготовить к работе одну или несколько учетных записей базы данных DocumentDB. Каждая учетная запись базы данных имеет квоту на административные ресурсы, включая базы данных, пользователей и разрешения. На эти ресурсы распространяются [ограничения и квоты](http://azure.microsoft.com/documentation/articles/documentdb-limits/). Если вам нужны дополнительные административные ресурсы, обратитесь в службу поддержки.   

## <a name="DBstorage"></a> Базы данных с неограниченным хранилищем документов
Отдельная база данных DocumentDB может содержать практически неограниченное хранилище документов, разделенное на коллекции. Коллекции образуют домены транзакций для документов, содержащихся в них. Неотъемлемой чертой базы данных DocumentDB является гибкость, позволяющая использовать SSD-хранилище документов размером от нескольких гигабайт до нескольких терабайт и подготовленную пропускную способность. В отличие от традиционных реляционных СУБД, базы данных в DocumentDB не ограничены одним узлом.   

Благодаря DocumentDB по мере роста потребностей вашего приложения вы можете создать больше коллекций и/или баз данных. Действительно, различные собственные приложения корпорации Майкрософт уже используют DocumentDB в потребительском масштабе путем создания чрезвычайно больших баз данных DocumentDB, каждая из которых содержит тысячи коллекций с терабайтами хранимых документов. Вы можете увеличить или уменьшить базу данных, добавляя или удаляя коллекции для удовлетворения требований масштабности вашего приложения. Вы можете создать любое количество коллекций в пределах субъекта базы данных, чтобы обеспечить доступность и количество единиц емкости, которые вы покупаете. Хранилища на базе SSD и пропускная способность, подготовленная для вас, может быть распределена по коллекции под базы данных в вашей учетной записи баз данных. 

## <a name="DBCollections"></a>Коллекции базы данных
Каждая база данных DocumentDB может содержать одну или несколько коллекций. Коллекция обеспечивает область для хранения документов и выполнения запросов. Коллекция также является доменом транзакций для всех входящих в ее состав документов. Вы можете создать любое количество коллекций в соответствии с требованиями масштабируемости ваших приложений. Для создания коллекций предварительно необходимо приобрести одну или несколько единиц емкости (capacity unit (CU). Каждая единица емкости включает квоту коллекций, при превышении которой необходимо приобрести для учетной записи дополнительные единицы емкости.  

>[AZURE.NOTE] Каждая коллекция поддерживает хранилище для данных документов объемом до 10 ГБ. 

## <a name="ProvStorage"></a>Подготовленное хранилище и пропускная способность в виде единиц емкости
Вы можете подготавливать наращиваемые ресурсы хранилища на базе твердотельных накопителей и пропускной способности в качестве единиц емкости (CU). Вы можете гибко масштабировать DocumentDB с предсказуемым уровнем производительности путем приобретения дополнительных единиц емкости, чтобы удовлетворить потребности вашего приложения для масштабирования операций чтения, хранения данных и пропускной способности.  
 
Каждая единица емкости имеет 3 гибких коллекции, подготовленное SSD-хранилище документов объемом 10 ГБ и подготовленную пропускную способность в виде 2000 единиц запросов (RU). Подготовленное хранилище и пропускная способность, связанные с CU, распределяются по коллекции DocumentDB, которую вы создаете.   

## <a name="ProvThroughput"></a>Единицы запросов и операции базы данных
DocumentDB позволяет выполнять обширный набор операций базы данных, включая реляционные и иерархические запросы с использованием UDF, хранимых процедур и триггеров, для документов в коллекции базы данных. Затраты, связанные с каждой из этих операций будет зависеть от типа процессора, операций ввода-вывода и памяти, необходимой для завершения операции.  Вместо того чтобы думать о закупке и управлении аппаратными ресурсами, вы можете думать о единице запроса (RU) как единой меры для ресурсов, необходимых для выполнения различных операций с базами данных и обслуживания запросов приложений.   

Единицы запросов предоставляются для каждой учетной записи базы данных на основании приобретенного вами числа единиц емкости. Удельный расход единиц запросов оценивается в расчете на одну секунду. Частота запросов для приложений, у которых она превышает подготовленные единицы запросов для учетной записи, будет снижена, пока она не упадет ниже зарезервированного для учетной записи уровня. Если ваше приложение требует более высокого уровня пропускной способности, вы можете приобрести дополнительные единицы емкости.  

В следующей таблице приведен список различных операций базы данных, а также указано число доступных единиц запросов на единицу емкости. Эта таблица помогает спланировать, как операция базы данных использует подготовленную на базе единицы емкости пропускную способность.  Мы предполагаем, что для документа размером 1 КБ, состоящего из 10 уникальных значений свойств, по умолчанию задана согласованность на уровне сеанса и все документы автоматически индексируются в DocumentDB. 

|Операции базы данных|Число операций в секунду на единицу емкости|
|-------------------|--------------------------------------|
|Чтение отдельного документа	|2000
|Вставка/замена/удаление отдельного документа	|500
|Отправка запроса с простым предикатом в коллекцию и возврат отдельного документа	|1000
|Хранимая процедура с 50 вставками документов	|20

Обратите внимание, что число единиц запросов, используемых операциями вставки/замены/удаления для автоматически индексируемых документов, приблизительно в 4 раза больше числа единиц запросов для чтения отдельного документа. Вышеуказанная таблица приведена исключительно в справочных целях. Однако, на практике,  

-	размеры документов могут отличаться (и не соответствовать размеру в 1 КБ), 
-	документы могут иметь более 10 свойств.
-	Вы можете выбрать уровень согласованности по умолчанию из значений Strong, Bounded Staleness или Eventual
-	Вы можете исключить из индексирования некоторые из ваших документов 
-	Вы можете выбрать для индекса только некоторые из свойств, не позволяя DocumentDB автоматически индексировать все свойства
-	Ваши запросы и хранимые процедуры могут быть гораздо сложнее.  

 Вы можете подсчитать количество единиц запросов, потребляемых для конкретного запроса, проверив заголовок ответа x-ms-request-charge этого запроса.  

## <a name="Collections"></a>Коллекции и подготовленная пропускная способность
Подготовленная пропускная способность для учетной записи базы данных равномерно распределяется по всем коллекциям до достижения максимального уровня (единицы запросов) у отдельной коллекции. Например, если вы покупаете одну единицу емкости и создаете единственную коллекцию, то вся подготовленная пропускная способность для CU будут доступна этой коллекции. Если будет создана дополнительная коллекция, то подготовленная пропускная способность будет распределена равномерно, для каждой коллекции будет выделена половина всей подготовленной пропускной способности.  

## <a name="Consistency"></a>Выбор уровня согласованности и пропускной способности
Выбор уровня согласованности по умолчанию влияет на производительность и задержки.  Вы можете задать уровень согласованности по умолчанию как программным образом, так и через портал Azure. Вы также можете переопределить уровень согласованности для каждого запроса. По умолчанию, уровень согласованности определен на уровне сеанса, что обеспечивает монотонное чтение/запись и гарантированное чтение записанных данных. Согласованность уровня Session отлично подходит для приложений, ориентированных на пользователей, и предлагает оптимальный компромисс между согласованностью и производительностью.   

-	Уровни согласованности Session и Eventual предлагают около 2000 запросов на чтение документов и 500 на вставку, замену и удаление документов.
-	Уровни согласованности Strong и Bounded Staleness предлагают около 1200 запросов на чтение документов и 500 на вставку, замену и удаление документов. На уровне Bounded Staleness операции вставки, замены и удаления выполняются с заметно более низкой задержкой, чем на уровне Strong.  

Инструкции по изменению уровня согласованности на портале управления предварительной версии Azure см. в подразделе "Практическое руководство. Управление параметрами согласованности DocumentDB" раздела [Управление учетной записью DocumentDB](../documentdb-manage-account/).

## <a name="IndexOverhead"></a>Подготавливаемое хранилище документов и затраты на индексирование
С каждой приобретаемой единицей емкости в вашей учетной записи подготавливается SSD-хранилище документов объемом 10 ГБ. В эти 10 ГБ включено как место для хранения собственно документов, так и место для хранения индекса. По умолчанию коллекция DocumentDB настроена на автоматическое индексирование всех документов без явного указания вторичных индексов или схем. На основании применения DocumentDB в реальных масштабах первых сторонних приложений типичные накладные расходы на хранение индекса составляют 2-20 %. Технология индексирования, используемая DocumentDB, гарантирует, что независимо от значений свойств, показатель накладных расходов не превышает 80% от размера документов с параметрами по умолчанию.  

По умолчанию все документы индексируются DocumentDB автоматически. Тем не менее, в случае, если вы хотите, чтобы точно настроить накладные расходы на индексирование, вы можете выбрать удаление определенных документы из индексации при вставке или замене документа. Вы можете настроить коллекцию DocumentDB чтобы исключить все документы в коллекции от индексации. Вы также можете настроить коллекцию DocumentDB для выборочного индексирования только определенных свойства или путей со специальными символами в ваших документах JSON.  Исключение свойств или документов их индексирования также улучшает пропускную способность записи, это значит, вы будете потреблять меньшее количество единиц запросов.   
 
## <a name="NextSteps"></a>Дальнейшие действия
Инструкции по управлению учетной записью DocumentDB на портале управления предварительной версии Azure см. в подразделе "Практическое руководство. "Управление параметрами согласованности DocumentDB" раздела [Управление учетной записью DocumentDB](../documentdb-manage-account/).

Инструкции по мониторингу уровней производительности на портале управления предварительной версии Azure см. в разделе [Мониторинг учетной записи DocumentDB](../documentdb-monitor-accounts/).

<!--HONumber=47-->
