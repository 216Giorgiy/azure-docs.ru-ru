<properties title="Get started with SQL database auditing" pageTitle="Приступая к работе с аудитом базы данных SQL | Azure " description="Приступая к работе с аудитом базы данных SQL" metaKeywords="" services="sql-database" solutions="data-management" documentationCenter="" authors="jeffreyg" videoId="" scriptId="" manager="jeffreyg" />

<tags ms.service="sql-database" ms.workload="data-management" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/31/2015" ms.author="jeffreyg" />
 
# Приступая к работе с аудитом базы данных SQL 
<p> Аудит базы данных Azure отслеживает события базы данных и записывает их в журнал аудита, расположенный в учетной записи хранения Azure. Функция аудита имеется в виде предварительного тестирования для уровней Basic, Standard и Premium.

Аудит может помочь вам соблюсти требования нормативов, проанализировать работу с базой данных и получить представление о расхождениях и аномалиях, которые могут указывать на бизнес-проблемы или предполагаемые нарушения безопасности. 

Средства аудита позволяют и способствуют соблюдению стандартов, но не гарантируют соответствия им. Чтобы получить дополнительную информацию о программах Azure, поддерживающих проверку соблюдения стандартов, см. <a href="http://azure.microsoft.com/ru-ru/support/trust-center/compliance/" target="_blank">Центр управления безопасностью Azure</a>.

+ [Основы аудита баз данных SQL Azure] 
+ [Настройка аудита базы данных]
+ [Анализ журналов и отчетов аудита]

##<a id="subheading-1">Основы аудита баз данных SQL Azure</a>

Настройка аудита осуществляется на портале предварительной версии Azure. Значения не имеет, была ли база данных создана на портале Azure или на портале предварительной версии Azure. Аудит баз данных SQL позволяет:

- **Сохранить** журнал аудита выбранных событий. Определите категории действий баз данных и событий для записи в журнал.
- **Создавать отчеты** по действиям, производимым с базой данных. Используйте предварительно настроенные отчеты и панель мониторинга для быстрого начала работы с отчетностью по действиям и событиям.
- **Анализировать** отчеты. Находите подозрительные события, необычную деятельность и тенденции.

Можно организовать аудит следующих действий и событий:

- **Доступ к данным**
- **Изменения схемы данных (DDL)**
- **Изменения данных (DML)**
- **Учетные записи, роли и разрешения (DSL)**
- **Исключительные ситуации, связанные с безопасностью**

Дополнительную информацию о действиях и событиях, записываемых в журнал, см. в <a href="http://go.microsoft.com/fwlink/?LinkId=506733" target="_blank">справочнике по формату журнала аудита (скачать DOC-файл)</a>. 

Также можно выбрать учетную запись хранения, в которую будут сохраняться журналы аудита.

###Строка безопасного подключения
В ходе настройки аудита Azure предоставит строку для безопасного подключения к базе данных. В журнал аудита будут записываться действия и события только тех клиентских приложений, которые будут использовать эту строку для подключения, поэтому необходимо обновить существующие клиентские приложения для использования строки подключения в новом формате.

Традиционный формат строки подключения: <имя_сервера>.database.windows.net

Новая строка для безопасного подключения: <имя_сервера>.database.**secure**.windows.net


##<a id="subheading-2"></a>Настройка аудита базы данных

1. Запустите <a href="https://portal.azure.com" target="_blank">портал предварительной версии Azure</a> по адресу https://portal.azure.com или <a href= "https://manage.windowsazure.com/" target="_bank">Классический портал Azure</a> по адресу https://manage.windowsazure.com/. См. информацию ниже.
2. Перейдите к выноске настройки базы данных для аудита. Перейдите к разделу **Операции**, а затем щелкните **Аудит**, чтобы включить функцию аудита и открыть выноску настройки аудита.

	![][1]

3. В выноске настройки аудита выберите учетную запись хранения Azure, в которой будут храниться журналы. **Подсказка.** Для того, чтобы в полной мере воспользоваться возможностями шаблонов предварительно настроенных отчетов используйте одну и ту же учетную запись хранения для всех баз данных.

	![][2]

4. В разделе **Настройки аудита** щелкните **Все** для отслеживания всех событий или выберите отдельные типы событий.

	![][3]

5. Выберите **Сохранить эти параметры в качестве параметров сервера по умолчанию**, если вы хотите применить эти настройки ко всем создаваемым в дальнейшем на данном сервере базам данных, не имеющем собственных настроек аудита. В дальнейшем эти настройки можно переопределить, выполнив аналогичные действия. 

6. Щелкните **Показать строки подключения к базе данных** и скопируйте или отметьте соответствующую строку безопасного подключения для своего приложения. Используйте эту строку для всех клиентских приложений, чьи действия необходимо отслеживать.

	![][5]

7. Нажмите кнопку **ОК**.



##<a id="subheading-3">Анализ журналов и отчетов аудита</a>

Журналы аудита объединяются в единую таблицу службы хранилища Azure под названием **AuditLogs** в учетной записи хранения Azure, выбранной на этапе настройки. Просматривать файлы журнала можно с помощью таких инструментов, как <a href="http://azurestorageexplorer.codeplex.com/" target="_blank">Обозреватель хранилищ Azure</a>.

Для быстрого анализа данных журнала доступен <a href="http://go.microsoft.com/fwlink/?LinkId=403540" target="_blank">предварительно настроенный шаблон отчета панели мониторинга,</a> который можно скачать в виде электронной таблицы Excel. Чтобы использовать шаблон с вашими журналами аудита, вам потребуется Excel 2013 или более поздней версии и Power Query, который можно скачать <a href="http://www.microsoft.com/ru-ru/download/details.aspx?id=39379">здесь</a>. 

В шаблоне приведен пример вымышленных данных, вы можете настроить Power Query для импорта журнала аудита непосредственно в учетную запись хранения Azure. 

Более подробные указания по работе с шаблоном отчета приведены в <a href="http://go.microsoft.com/fwlink/?LinkId=506731">практическом руководстве (скачать DOC-файл)</a>.

![][6]


##<a id="subheading-4"></a>Настройка аудита базы данных с помощью классического портала Azure

1. Запустите <a href= "https://manage.windowsazure.com/" target="_bank">Классический портал Azure</a> по адресу https://manage.windowsazure.com/. 
2. Щелкните базу данных для аудита, а затем выберите вкладку **Просмотр аудита и безопасности**.
3. В разделе аудита щелкните "Включить".

![][7]

4. При необходимости измените значение параметра **ТИП СОБЫТИЯ**.

![][8]

5. Выберите значение для параметра **УЧЕТНАЯ ЗАПИСЬ ХРАНЕНИЯ**.
6. Щелкните **СОХРАНИТЬ**.
7. Щелкните **Показать безопасную строку подключения** для соответствующей строки подключения.


##<a id="subheading-3">Рекомендации по использованию в рабочей среде</a>
Описания в этом разделе относятся к снимкам экрана выше. Можно использовать <a href="https://portal.azure.com" target="_blank">портал предварительной версии Azure</a> или <a href= "https://manage.windowsazure.com/" target="_bank">Классический портал Azure</a> .
 

##<a id="subheading-4"></a>Безопасный доступ

В рабочей среде вам, скорее всего, понадобится, чтобы весь трафик между базой данных и всеми приложениями и инструментами проверялся. Для этого необходимо изменить значение параметра **Безопасный доступ** с "Необязательно" на "Обязательно" и сохранить политику. Если установлено значение "Обязательно", к базе данных невозможно подключиться с помощью исходной строки подключения и необходимо использовать безопасную строку подключения.


![][9]


##<a id="subheading-4"></a>Повторное создание ключа хранилища

Обычно, в рабочей среде приходится периодически обновлять ключи хранилища. Служба аудита не сохраняет ваши ключи учетной записи хранения. После сохранения для таблицы аудита создается ключ подписанного URL-адреса (SAS), доступный только для записи (читать журналы аудита может только клиент). Поэтому при обновлении ключей необходимо повторно сохранять политику. Вот как это можно сделать:


1. В выноске настройки аудита (описанной в разделе настройки аудита выше) измените значение параметра **Ключ доступа к хранилищу** с "Первичный" на "Вторичный" и нажмите кнопку **СОХРАНИТЬ**.
![][10]
2. Перейдите к выноске настройки хранилища и **повторно создайте** первичный ключ доступа.

3. В колонке настройки аудита измените значение параметра **Ключ доступа к хранилищу** с "Вторичный" на "Первичный" и нажмите кнопку **СОХРАНИТЬ**.

4. В интерфейсе хранилища **повторно создайте** вторичный ключ доступа (для подготовки к следующему циклу обновления ключей).
  
##<a id="subheading-4"></a>Автоматизация
Информацию о PowerShell см. в <a href="https://github.com/Azure/azure-powershell" target="_blank">документации по PowerShell SDK.</a>.

Дополнительную информацию об интерфейсе API REST см. в <a href="http://download.microsoft.com/download/D/8/D/D8D90BA1-977F-466B-A839-7823FF37FD02/04-Azure SQL DB Auditing REST API.docx">документе "Управление базами данных SQL Azure с помощью API".</a>





<!--Anchors-->
[Основы аудита баз данных SQL Azure]: #subheading-1
[Настройка аудита базы данных]: #subheading-2
[Анализ журналов и отчетов аудита]: #subheading-3
[Настройка аудита базы данных с помощью классического портала Azure]: #subheading-4


<!--Image references-->
[1]: ./media/sql-database-auditing-get-started/sql-database-get-started-auditingpreview.png
[2]: ./media/sql-database-auditing-get-started/sql-database-get-started-storageaccount.png
[3]: ./media/sql-database-auditing-get-started/sql-database-auditing-eventtype.png
[5]: ./media/sql-database-auditing-get-started/sql-database-get-started-connectionstring.png
[6]: ./media/sql-database-auditing-get-started/sql-database-auditing-dashboard.png
[7]: ./media/sql-database-auditing-get-started/sql-database-auditing-classic-portal-enable.png
[8]: ./media/sql-database-auditing-get-started/sql-database-auditing-classic-portal-configure.png
[9]: ./media/sql-database-auditing-get-started/sql-database-auditing-security-enabled-access.png
[10]: ./media/sql-database-auditing-get-started/sql-database-auditing-storage-account.png






<!--Link references-->
[Соедините 1 с другим разделом документации azure.microsoft.com]: ../virtual-machines-windows-tutorial/
[Соедините 2 с другим разделом документации azure.microsoft.com]: ../web-sites-custom-domain-name/
[Соедините 3 с другим разделом документации azure.microsoft.com]: ../storage-whatis-account/


<!--HONumber=35_1-->
