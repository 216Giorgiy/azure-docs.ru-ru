---
title: Преобразование данных с помощью Azure Data Box Edge | Документация Майкрософт
description: Узнайте, как настроить роль вычислений в Data Box Edge и использовать ее для преобразования данных перед отправкой в Azure.
services: databox
author: alkohli
ms.service: databox
ms.subservice: edge
ms.topic: tutorial
ms.date: 10/19/2018
ms.author: alkohli
Customer intent: As an IT admin, I need to understand how to configure compute on Data Box Edge so I can use it to transform the data before sending it to Azure.
ms.openlocfilehash: e970f7cc0d4c4620f2da69286be36d0c22e0d747
ms.sourcegitcommit: da3459aca32dcdbf6a63ae9186d2ad2ca2295893
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/07/2018
ms.locfileid: "51260369"
---
# <a name="tutorial-transform-data-with-azure-data-box-edge-preview"></a>Руководство по преобразованию данных с помощью Azure Data Box Edge (предварительная версия)

В этом руководстве описывается, как настроить роль вычислений в Data Box Edge. После того как роль настроена, Data Box Edge может преобразовывать данные перед отправкой в ​​Azure.

Эта процедура может занять около 30-45 минут.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание ресурса центра Интернета вещей
> * Настройка роли вычислений.
> * Добавление модуля вычислений.
> * Проверка преобразования и передачи данных.

> [!IMPORTANT]
> В данный момент решение Data Box Edge находится в состоянии предварительной версии. Изучите [Дополнительные условия использования Предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/), прежде чем заказывать и развертывать это решение.
 
## <a name="prerequisites"></a>Предварительные требования

Прежде чем вы настроите вычисления в Data Box Edge, убедитесь, что:

* Устройство Data Edge активировано, как описано в статье [Tutorial: Connect, set up, activate Azure Data Box Edge (Preview)](data-box-edge-deploy-connect-setup-activate.md) (Подключение, настройка и активация Azure Data Box Edge(предварительная версия)).


## <a name="create-an-iot-hub-resource"></a>Создание ресурса центра Интернета вещей

Прежде чем настраивать роль вычислений в Data Box Edge, вы должны создать ресурс Центра Интернета вещей.

Подробные инструкции см. в разделе [Создание Центра Интернета вещей](https://docs.microsoft.com/azure/iot-hub/iot-hub-create-through-portal#create-an-iot-hub). Используйте ту же подписку и группу ресурсов, что и для вашего ресурса Data Box Edge.

![Создание ресурса Центра Интернета вещей](./media/data-box-edge-deploy-configure-compute/create-iothub-resource-1.png)

Если роль вычислений Edge не настроена, обратите внимание на следующее:

- В ресурсе центра Интернета вещей отсутствуют устройства Интернета вещей и устройства IoT Edge.
- Вы не можете создавать локальные общие ресурсы Edge. Когда вы добавляете общий ресурс, возможность создания локального общего ресурса для вычисления Edge не включена.


## <a name="set-up-compute-role"></a>Настройка роли вычислений

При настройке роли вычислений Edge на устройстве Edge создается два устройства — устройство Интернета вещей и устройство IoT Edge. Оба устройства можно просмотреть в ресурсе центра Интернета вещей.

Чтобы настроить роль вычислений на устройстве, выполните следующие действия.

1. Перейдите к ресурсу Data Box Edge, а затем выберите **Обзор** и нажмите кнопку **Set up compute role** (Настройка роли вычислений). 

    ![Настройка роли вычислений](./media/data-box-edge-deploy-configure-compute/setup-compute-1.png)
   
    Вы также можете перейти на вкладку **Модули** и нажать кнопку **Настройка вычислений**.

    ![Настройка роли вычислений](./media/data-box-edge-deploy-configure-compute/setup-compute-2.png)
 
2. В раскрывающемся списке выберите **ресурс центра Интернета вещей**, который вы создали на предыдущем шаге. На данный момент доступна только платформа Linux для устройства IoT Edge. Нажмите кнопку **Создать**.

    ![Настройка роли вычислений.](./media/data-box-edge-deploy-configure-compute/setup-compute-3.png)
 
3. Для создания роли вычислений требуется несколько минут. Из-за ошибки в этом выпуске даже при создании роли вычислений экран не обновляется. Перейдите в раздел **Модули**, и вы увидите, что пограничные вычисления настроены.  

    ![Настройка роли вычислений](./media/data-box-edge-deploy-configure-compute/setup-compute-4.png)

4. Перейдите на вкладку **Обзор** снова. Теперь экран обновлен и на нем указано, что настроена роль вычислений.

    ![Настройка роли вычислений](./media/data-box-edge-deploy-configure-compute/setup-compute-5.png)
 
5. Перейдите в Центр Интернета вещей, который вы использовали при создании роли пограничных вычислений. Перейдите к **устройствам Интернета вещей**. Вы увидите, что устройство Интернета вещей теперь включено. 

    ![Настройка роли вычислений](./media/data-box-edge-deploy-configure-compute/setup-compute-6.png)

6. Перейдите к **IoT Edge** и вы увидите, что устройство IoT Edge также включено.

    ![Настройка роли вычислений](./media/data-box-edge-deploy-configure-compute/setup-compute-7.png)
 
7. Выберите и щелкните устройство IoT Edge. Агент Edge работает на этом устройстве IoT Edge. 

    ![Настройка роли вычислений](./media/data-box-edge-deploy-configure-compute/setup-compute-8.png) 

Однако на этом устройстве Edge нет настраиваемых модулей. Теперь можно добавить настраиваемый модуль к этому устройству. Чтобы узнать, как создать пользовательский модуль, см. статью [Develop a C# IoT Edge module to move files on Data Box Edge (Preview)](data-box-edge-create-iot-edge-module.md) (Разработка модуля IoT Edge на C# для перемещения файлов в Data Box Edge (предварительная версия)).


## <a name="add-a-custom-module"></a>Добавление настраиваемого модуля

В этом разделе вы добавите пользовательский модуль к устройству IoT Edge, которое было создано с помощью руководства [Develop a C# IoT Edge module to move files on Data Box Edge (Preview)](data-box-edge-create-iot-edge-module.md) (Разработка модуля IoT Edge на C# для перемещения файлов в Data Box Edge (предварительная версия)). 

В этой процедуре используется пример, в котором используемый настраиваемый модуль берет файлы из локального ресурса на устройстве Edge и переносит их в облачный файловый ресурс на устройстве. Затем облачный ресурс переносит файлы в учетную запись Azure, связанную с облачным ресурсом. 

1. Первым шагом является добавление локального ресурса на устройство Edge. В ресурсе Data Box Edge перейдите на вкладку **Общие папки**. Щелкните **+ Add share** (+ Добавить общую папку). Укажите имя общего ресурса и выберите его. Чтобы создать локальный общий ресурс, установите флажок **Настройка в качестве локальной общей папки Edge**. Выберите **имеющегося пользователя** или **создайте нового**. Нажмите кнопку **Создать**.

    ![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-1.png) 

    Если вы создали локальный общий ресурс NFS, используйте следующую команду rsync для копирования в него файлов:

    `rsync --inplace <source file path> < destination file path>`

     Дополнительные сведения о команде rsync см. в [документации по Rsync](https://www.computerhope.com/unix/rsync.htm). 

 
2. Как только локальный общий ресурс будет создан и вы получите уведомление об успешном создании (список общих папок может обновится до этого, но вы должны дождаться завершения создания ресурса), перейдите к списку ресурсов. 

    ![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-2.png) 
 
3. Выберите и щелкните созданный локальный общий ресурс и просмотрите свойства этого ресурса. Скопируйте и сохраните **точки локального подключения для модулей Edge**, соответствующие этому ресурсу.

    ![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-3.png) 
 
    Перейдите к имеющемуся облачному общему ресурсу, созданному на вашем устройстве Data Box Edge. Снова скопируйте и сохраните локальную точку подключения для модулей пограничных вычислений для этого облачного ресурса. Эти локальные точки подключения будут использоваться при развертывании модуля.

    ![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-4.png)  

4. Для добавления настраиваемого модуля на устройство IoT Edge перейдите к ресурсу Центра Интернета вещей и выберите **Устройство IoT Edge**. Выберите и щелкните свое устройство. На вкладке **Сведения об устройстве** на панели команд вверху щелкните **Задание модулей**. 

    ![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-5.png) 

5. В разделе **Добавить модули** выполните следующие действия:

    1. Укажите **имя**, **адрес**, **имя пользователя** и **пароль** для **параметров реестра контейнеров** для настраиваемого модуля. Имя, адрес и перечисленные учетные данные используются для извлечения модулей с соответствующим URL-адресом. Чтобы развернуть этот модуль, в разделе **Модули развертывания** выберите **Модуль IoT Edge**. Этот модуль IoT Edge является контейнером docker, который можно развернуть на устройстве IoT Edge, связанном с устройством Data Box Edge.

        ![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-6.png) 
 
    2. Укажите настройки для настраиваемого модуля IoT Edge. Укажите **имя** модуля и **URI образа** для соответствующего образа контейнера. 
    
        ![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-7.png) 

    3. В разделе **Параметры создания контейнера** укажите локальные точки подключения для модулей Edge, скопированных на предыдущих шагах для облака и локального общего ресурса (важно использовать эти пути, а не создавать новые). Локальные точки подключения сопоставляются с соответствующими значениями **InputFolderPath** и **OutputFolderPath**, которые вы указали в модуле при его [обновлении с помощью пользовательского кода](data-box-edge-create-iot-edge-module.md#update-the-module-with-custom-code). 
    
        Вы можете скопировать и вставить пример, показанный ниже, в свои **параметры создания контейнера**: 
        
        ```
        {
         "HostConfig": {
          "Binds": [
           "/home/hcsshares/mysmblocalshare:/home/LocalShare",
           "/home/hcsshares/mysmbshare1:/home/CloudShare"
           ]
         }
        }
        ```

        Здесь также укажите любые переменные среды для вашего модуля.

        ![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-8.png) 
 
    4. При необходимости **настройте расширенные параметры Edge**, а затем нажмите кнопку **Далее**.

        ![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-9.png) 
 
6.  В разделе **Укажите маршруты** настройте маршруты между модулями. В этом случае укажите имя локального общего ресурса, который будет отправлять данные в облачный общий ресурс. Щелкните **Далее**.

    Маршрут можно заменить следующей строкой маршрута:       "route": "FROM /* WHERE topic = 'mysmblocalshare' INTO BrokeredEndpoint(\"/modules/filemovemodule/inputs/input1\")"

    ![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-10.png) 
 
7.  В разделе **Проверка развертывания** просмотрите все параметры и, если все в порядке, **отправьте** модуль для развертывания.

    ![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-11.png) 
 
При этом начнется развертывание модуля, как показано на вкладке **Пользовательский модуль IoT Edge** в разделе **Модули**.

![Добавление настраиваемого модуля](./media/data-box-edge-deploy-configure-compute/add-a-custom-module-12.png) 

### <a name="verify-data-transform-and-transfer"></a>Проверка преобразования и передачи данных

Последний шаг — убедиться, что модуль подключен и работает как ожидалось. Выполните следующие шаги, чтобы убедиться, что модуль работает.

1. Состояние выполнения модуля должно быть "Работает" для вашего устройства IoT Edge в ресурсе Центра Интернета вещей.

    ![Проверка преобразования данных](./media/data-box-edge-deploy-configure-compute/verify-data-transform-1.png) 
 
2. Щелкните модуль и посмотрите на вкладку **Двойник удостоверения модуля**. Должно отображаться состояние **Подключено** для клиента модуля и устройства Edge.

    ![Проверка преобразования данных](./media/data-box-edge-deploy-configure-compute/verify-data-transform-2.png) 
 
3.  Как только модуль будет запущен, он также появится в списке модулей Edge в вашем ресурсе Data Box Edge. **Состояние среды выполнения** модуля, который вы добавили, — **Запущен**.

    ![Проверка преобразования данных](./media/data-box-edge-deploy-configure-compute/verify-data-transform-3.png) 
 
4.  Подключитесь к локальным и облачным общим ресурсам, созданным с помощью проводника.

    ![Проверка преобразования данных](./media/data-box-edge-deploy-configure-compute/verify-data-transform-4.png) 
 
5.  Добавьте данные в локальную общую папку.

    ![Проверка преобразования данных](./media/data-box-edge-deploy-configure-compute/verify-data-transform-5.png) 
 
6.  Данные переносятся в облачную общую папку.

    ![Проверка преобразования данных](./media/data-box-edge-deploy-configure-compute/verify-data-transform-6.png)  

7.  Затем данные переносятся из облачного ресурса в учетную запись хранения. Для просмотра данных перейдите в Обозреватель службы хранилища.

    ![Проверка преобразования данных](./media/data-box-edge-deploy-configure-compute/verify-data-transform-7.png) 
 
На этом завершается процесс проверки.


## <a name="next-steps"></a>Дополнительная информация

В этом руководстве вы изучили такие темы о Data Box Edge:

> [!div class="checklist"]
> * Создание ресурса центра Интернета вещей.
> * Настройка роли вычислений.
> * Добавление модуля вычислений.
> * Проверка преобразования и передачи данных.

Перейдите к следующему руководству, чтобы узнать, как администрировать службу Data Box Edge.

> [!div class="nextstepaction"]
> [Use local web UI to administer a Data Box Edge](https://aka.ms/dbg-docs) (Использование локального веб-интерфейса для администрирования Data Box Edge)


