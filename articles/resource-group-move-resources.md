<properties 
	pageTitle="Перемещение ресурсов в новую группу ресурсов | Microsoft Azure" 
	description="Перемещайте ресурсы в новую группу ресурсов или новую подписку с помощью Azure Resource Manager." 
	services="azure-resource-manager" 
	documentationCenter="" 
	authors="tfitzmac" 
	manager="timlt" 
	editor="tysonn"/>

<tags 
	ms.service="azure-resource-manager" 
	ms.workload="multiple" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="05/31/2016" 
	ms.author="tomfitz"/>

# Перемещение ресурсов в новую группу ресурсов или подписку

В этом разделе показано, как перемещать ресурсы из одной группы ресурсов в другую. Можно также перемещать ресурсы в новую подписку (но подписка должна существовать в том же [клиенте](./active-directory/active-directory-howto-tenant.md)). Перемещение ресурсов может потребоваться в следующих случаях:

1. Для выставления счетов ресурс должен находиться в другой подписке.
2. Теперь жизненные циклы этого ресурса и ресурсов, с которыми он ранее был сгруппирован, не совпадают. Ресурс нужно переместить в новую группу ресурсов, чтобы управлять им отдельно от других ресурсов.

При перемещении ресурсов группу источника и группа назначения блокируются на время операции. Операции записи и удаления для групп блокируются до завершения перемещения.

Расположение ресурса изменить невозможно. При перемещении ресурс всего лишь перемещается в новую группу ресурсов. Даже если новая группа ресурсов находится в другом расположении, расположение ресурса не меняется.

> [AZURE.NOTE] В этой статье описывается, как перемещать ресурсы в рамках существующего предложения для учетной записи Azure. Если вы действительно хотите изменить предложение для своей учетной записи Azure (например, перейти с оплаты по мере использования на предоплату), продолжая работать с существующими ресурсами, см. статью [Переход на другое предложение Azure](billing-how-to-switch-azure-offer.md).

## Рекомендации перед перемещением ресурсов

Вот некоторые важные особенности, которые следует учитывать перед перемещением ресурса. Проверив эти условия, можно избежать ошибок.

1. Служба должна поддерживать возможность перемещения ресурсов. Список [служб, поддерживающих перемещение ресурсов](#services-that-support-move), приведен ниже.
2. Подписка назначения должна быть зарегистрирована для перемещаемого поставщика ресурсов. В противном случае вы получите сообщение о том, что **подписка не зарегистрирована для типа ресурса**. Эта проблема может возникнуть при перемещении ресурса в новую подписку, которая никогда не использовалась с этим типом ресурса. Сведения о регистрации поставщиков ресурсов и проверке состояния регистрации см. в разделе [Поставщики и типы ресурсов](../resource-manager-supported-services.md#resource-providers-and-types).
3. Если вы используете Azure PowerShell или интерфейс командной строки Azure, убедитесь, что у вас установлена последняя версия. Чтобы обновить текущую версию, запустите установщик веб-платформы Майкрософт и проверьте доступность более новой версии. Дополнительные сведения см. в статьях [Установка и настройка Azure PowerShell](powershell-install-configure.md) и [Установка интерфейса командной строки Azure](xplat-cli-install.md).
4. При перемещении приложения службы приложений необходимо ознакомиться с разделом [Ограничения службы приложений](#app-service-limitations).
5. При перемещении ресурсов, развернутых с помощью классической модели, необходимо ознакомиться с разделом [Ограничения классического развертывания](#classic-deployment-limitations).

## Службы, поддерживающие перемещение

Сейчас к службам, которые поддерживают перемещение в новую группу ресурсов и подписку, относятся:

- Управление API
- Приложения службы приложений — см. раздел [Ограничения службы приложений](#app-service-limitations)
- Автоматизация
- Пакетная служба
- CDN
- Облачные службы — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
- Фабрика данных
- DNS
- DocumentDB
- Кластеры HDInsight
- хранилище ключей;
- Mobile Engagement;
- Центры уведомлений
- Operational Insights;
- Кэш Redis
- Планировщик
- Поиск
- Хранилище
- Служба хранилища (классическая) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
- Сервер базы данных SQL — база данных и сервер должны находиться в одной группе ресурсов. При перемещении сервера SQL Server все его базы данных также перемещаются.
- Виртуальные машины
- Виртуальные машины (классические) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).

## Службы, частично поддерживающие перемещение

Службы с поддержкой перемещения в новую группу ресурсов, но не в новую подписку:

- Виртуальные сети

## Службы, не поддерживающие перемещение

Службы, которые в настоящее время не поддерживают перемещение ресурсов:

- Application Insights
- ExpressRoute
- Виртуальные сети (классические) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations)

## Ограничения службы приложений

При работе с приложениями службы приложений невозможно переместить только план службы приложений. Далее приводятся варианты перемещения приложений службы приложений.

- Перемещение плана службы приложений и всех других ресурсов службы приложений из этой группы ресурсов в новую группу ресурсов, которая еще не содержит ресурсы службы приложений. Это означает перемещение даже тех ресурсов службы приложений, которые не связаны с планом службы приложений. 
- Перемещение приложений в другую группу ресурсов, но сохранение планов службы приложений в исходной группе ресурсов.

Если исходная группа ресурсов также содержит ресурс Application Insights, вы не сможете переместить этот ресурс, так как в настоящее время Application Insights не поддерживает операцию перемещения. Если при перемещении приложений службы приложений включить ресурс Application Insights, то вся операции перемещения закончится ошибкой. Тем не менее, для корректной работы приложения ресурс Application Insights и план службы приложений не должны обязательно находиться в одной группе ресурсов.

Например, если группа ресурсов содержит:

- ресурс **web-a**, связанный с **plan-a** и **app-insights-a**;
- ресурс **web-b**, связанный с **plan-b** и **app-insights-b**.

Вам доступны следующие действия:

- перемещение **web-a**, **plan-a**, **web-b** и **plan-b**;
- перемещение **web-a** и **web-b**;
- перемещение **web-a**;
- перемещение **web-b**.

Все другие сочетания включают перемещение типа ресурса, который нельзя перемещать (Application Insights), или необходимость оставить тип ресурса, который нельзя оставлять при перемещении плана службы приложений (любой тип ресурса службы приложений).

Если веб-приложение находится в одной группе ресурсов, а его план службы приложений — в другой, но в новую группу ресурсов требуется переместить и веб-приложение, и план, то необходимо выполнить перемещение в два этапа. Например:

- **web-a** находится в группе **web-group**;
- **plan-a** находится в группе **plan-group**;
- вы хотите поместить **web-a** и **plan-a** в объединенную группу **combined-group**.

Чтобы осуществить это перемещение, выполните две отдельные операции перемещения в следующей последовательности:

1. Переместите **web-a** в группу **plan-group**.
2. Переместите **web-a** и **plan-a** в объединенную группу **combined-group**.

## Ограничения классического развертывания

Процедуры перемещения ресурсов, развернутых с помощью классической модели, отличаются в зависимости от того, перемещаются ли ресурсы в пределах одной подписки, или они переносятся в новую подписку.

При перемещении ресурсов из одной группы ресурсов в другую **в пределах одной подписки** действуют следующие ограничения:

- Нельзя перемещать виртуальные сети (классические).
- Виртуальные машины (классические) необходимо перемещать с облачной службой. 
- Облачную службу можно перемещать только в тех случаях, когда перемещение включает в себя все виртуальные машины этой службы.
- Одновременно можно перемещать только одну облачную службу.
- Одновременно можно перемещать только одну учетную запись хранения (классическую).
- Нельзя перемещать учетную запись хранения (классическую) в рамках одной операции с виртуальной машиной или облачной службой.

При перемещении ресурсов в **новую подписку** действуют следующие ограничения:

- Все классические ресурсы в подписке необходимо переместить в рамках одной операции.
- Перемещение можно запросить только через портал или через отдельный интерфейс REST API для классических перемещений. Стандартные команды перемещения Resource Manager не работают, если перемещение классических ресурсов осуществляется в новую подписку. В следующих разделах описаны процедуры перемещения с помощью портала или интерфейса REST API.

## Перемещение ресурсов с помощью портала

Некоторые ресурсы можно переместить с помощью портала. Однако такую возможность предоставляют не все поставщики ресурсов, поддерживающие операции перемещения.

Чтобы переместить ресурс, выберите его, а затем нажмите кнопку **Переместить**.

![перемещение ресурса](./media/resource-group-move-resources/move-resources.png)

При перемещении ресурса укажите целевую подписку и целевую группу ресурсов. Если с этим ресурсом необходимо переместить другие ресурсы, они будут перечислены.

![выбор места назначения](./media/resource-group-move-resources/select-destination.png)

В области **уведомлений** вы увидите, что операция перемещения выполняется.

![отображение состояния перемещения](./media/resource-group-move-resources/show-status.png)

После ее завершения отобразится уведомление о результате.

![отображение результата перемещения](./media/resource-group-move-resources/show-result.png)

Чтобы иначе переместить ресурсы в новую группу ресурсов (но не подписку), выберите ресурс, который необходимо переместить.

![выбор ресурса для перемещения](./media/resource-group-move-resources/select-resource.png)

Выберите его **свойства**.

![выбор свойств](./media/resource-group-move-resources/select-properties.png)

Выберите команду **Изменить группу ресурсов**, если она доступна для этого типа ресурса.

![изменение группы ресурсов](./media/resource-group-move-resources/change-resource-group.png)

Можно выбрать, какие ресурсы перемещать и в какую группу ресурсов выполнять перемещение.

![перемещение ресурсов](./media/resource-group-move-resources/select-group.png)

При перемещении ресурсов, развернутых с помощью классической модели, в новую группу ресурсов можно использовать значок редактирования, расположенный рядом с именем группы ресурсов.

![перемещение классических ресурсов](./media/resource-group-move-resources/edit-rg-icon.png)

Выберите ресурсы для перемещения, учитывая [ограничения классического развертывания](#classic-deployment-limitations). Чтобы начать перемещение, нажмите кнопку **ОК**.

 ![выбор классических ресурсов](./media/resource-group-move-resources/select-classic-resources.png)
 
 При перемещении ресурсов, развернутых с помощью классической модели, в новую подписку можно использовать значок редактирования, расположенный рядом с именем подписки.
 
 ![перемещение в новую подписку](./media/resource-group-move-resources/edit-subscription-icon.png)
 
 Все классические ресурсы выбираются для перемещения автоматически.

## Перемещение ресурсов с помощью PowerShell

Чтобы переместить существующие ресурсы в другую группу ресурсов или подписку, используйте команду **Move-AzureRmResource**.

В первом примере показано, как переместить один ресурс в новую группу ресурсов.

    $resource = Get-AzureRmResource -ResourceName ExampleApp -ResourceGroupName OldRG
    Move-AzureRmResource -DestinationResourceGroupName NewRG -ResourceId $resource.ResourceId

Во втором примере показано, как переместить несколько ресурсов в новую группу ресурсов.

    $webapp = Get-AzureRmResource -ResourceGroupName OldRG -ResourceName ExampleSite
    $plan = Get-AzureRmResource -ResourceGroupName OldRG -ResourceName ExamplePlan
    Move-AzureRmResource -DestinationResourceGroupName NewRG -ResourceId $webapp.ResourceId, $plan.ResourceId

Чтобы переместить ресурс в новую подписку, добавьте значение параметра **DestinationSubscriptionId**.

Вам будет предложено подтвердить перемещение указанных ресурсов.

    Confirm
    Are you sure you want to move these resources to the resource group
    '/subscriptions/{guid}/resourceGroups/newRG' the resources:

    /subscriptions/{guid}/resourceGroups/destinationgroup/providers/Microsoft.Web/serverFarms/exampleplan
    /subscriptions/{guid}/resourceGroups/destinationgroup/providers/Microsoft.Web/sites/examplesite
    [Y] Yes  [N] No  [S] Suspend  [?] Help (default is "Y"): y

## Перемещение ресурсов с помощью интерфейса командной строки Azure

Чтобы переместить существующие ресурсы в другую группу или подписку, используйте команду **azure resource move**. В следующем примере показано, как переместить кэш Redis в новую группу ресурсов. В параметре **-i** укажите разделенный запятыми список идентификаторов ресурсов для перемещения.

    azure resource move -i "/subscriptions/{guid}/resourceGroups/OldRG/providers/Microsoft.Cache/Redis/examplecache" -d "NewRG"
	
Вам будет предложено подтвердить перемещение указанного ресурса.
	
    info:    Executing command resource move
    Move selected resources in OldRG to NewRG? [y/n] y
    + Moving selected resources to NewRG
    info:    resource move command OK

## Перемещение ресурсов с помощью REST API

Чтобы переместить существующие ресурсы в другую группу ресурсов или подписку, выполните следующую команду:

    POST https://management.azure.com/subscriptions/{source-subscription-id}/resourcegroups/{source-resource-group-name}/moveResources?api-version={api-version} 

В тексте запроса укажите целевую группу ресурсов и ресурсы для перемещения. Дополнительные сведения об операции перемещения REST см. в разделе [Перемещение ресурсов](https://msdn.microsoft.com/library/azure/mt218710.aspx).

Однако чтобы переместить **классические ресурсы в новую подписку**, необходимо использовать другие операции REST. Чтобы проверить, может ли подписка участвовать в операции перемещения классических ресурсов между подписками в качестве исходной или целевой подписки, используйте следующее действие:

    POST https://management.azure.com/subscriptions/{subscriptionId}/providers/Microsoft.ClassicCompute/validateSubscriptionMoveAvailability?api-version=2016-04-01
    
В качестве исходной подписки используйте текст запроса:

    {
        "role": "source"
    }

В качестве целевой подписки используйте текст запроса:

    {
        "role": "target"
    }

Ответ для любой операции проверки будет следующим:

    {
        "status": "{status}",
        "reasons": [
            "reason1",
            "reason2"
        ]
    }

Чтобы переместить все классические ресурсы из одной подписки в другую, используйте следующее действие:

    POST https://management.azure.com/subscriptions/{subscription-id}/providers/Microsoft.ClassicCompute/moveSubscriptionResources?api-version=2016-04-01

С текстом запроса:

    {
        "target": "/subscriptions/{target-subscription-id}"
    }



## Дальнейшие действия
- Сведения о командлетах PowerShell для управления подпиской см. в статье [Использование Azure PowerShell с Azure Resource Manager](powershell-azure-resource-manager.md).
- Сведения о командах интерфейса командной строки Azure для управления подпиской см. в статье [Использование Azure CLI для Mac, Linux и Windows с Azure Resource Manager](xplat-cli-azure-resource-manager.md).
- Сведения о функциях портала для управления подпиской см. в статье [Развертывание ресурсов Azure и управление ими с помощью портала Azure](./azure-portal/resource-group-portal.md).
- Сведения о логической организации ресурсов см. в разделе [Использование тегов для организации ресурсов в Azure](resource-group-using-tags.md).

<!---HONumber=AcomDC_0608_2016-->