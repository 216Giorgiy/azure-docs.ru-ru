---
title: "Локальный шлюз данных | Документация Майкрософт"
description: "Локальный шлюз данных необходим тогда, когда сервер служб Analysis Services в Azure будет подключен к локальным источникам данных."
services: analysis-services
documentationcenter: 
author: minewiskan
manager: erikre
editor: 
tags: 
ms.assetid: cd596155-b608-4a34-935e-e45c95d884a9
ms.service: analysis-services
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: na
ms.date: 04/18/2017
ms.author: owend
translationtype: Human Translation
ms.sourcegitcommit: 8c4e33a63f39d22c336efd9d77def098bd4fa0df
ms.openlocfilehash: e47fa44d87ad29054b833ee4bf201ac4d72e1e6e
ms.lasthandoff: 04/20/2017


---
# <a name="on-premises-data-gateway"></a>Локальный шлюз данных
Локальный шлюз данных действует как мост, обеспечивая передачу данных между локальными источниками данных и сервером служб Azure Analysis Services в облаке.

Шлюз устанавливается на компьютере в сети. Для каждого сервера служб Azure Analysis Services в подписке Azure необходимо установить один шлюз. Например, при наличии в подписке Azure двух серверов, которые подключаются к локальным источникам данных, шлюз необходимо установить на двух разных компьютерах в сети.

## <a name="requirements"></a>Требования
**Минимальные требования:**

* .NET Framework 4.5;
* 64-разрядная версия Windows 7 / Windows Server 2008 R2 (или более новой версии).

**Рекомендуется:**

* 8-ядерный ЦП;
* 8 ГБ ОЗУ;
* 64-разрядная версия Windows 2012 R2 (или более поздняя версия).

**Важные сведения:**

* Шлюз нельзя устанавливать на контроллере домена.
* На одном компьютере можно установить только один шлюз.
* Устанавливайте шлюз на компьютере, который не выключается и не переходит в спящий режим. Если компьютер выключен, сервер служб Azure Analysis Services не сможет подключиться к локальным источникам данных для обновления данных.
* Не устанавливайте шлюз на компьютере, подключенном к сети с помощью беспроводного соединения. Это может стать причиной снижения производительности.
* Чтобы изменить имя сервера для шлюза, который уже настроен, необходимо повторно установить и настроить новый шлюз.
* В некоторых случаях табличные модели, которые подключаются к источникам данных с помощью собственных поставщиков, таких как собственный клиент SQL Server (SQLNCLI11), могут возвращать ошибку. Дополнительные сведения см. в статье [Datasource connections](analysis-services-datasource.md) (Подключение к источникам данных).

## <a name="supported-on-premises-data-sources"></a>Поддерживаемые локальные источники данных
Шлюз поддерживает подключения между сервером служб Azure Analysis Services и следующими локальными источниками данных:

* SQL Server
* Хранилище данных SQL
* APS
* Oracle
* Teradata

## <a name="download"></a>Загрузить
 [Скачайте шлюз](https://aka.ms/azureasgateway).

## <a name="install-and-configure"></a>Установка и настройка
1. Запустите программу установки.
2. Выберите расположение установки и примите условия лицензионного соглашения.
3. Войдите в Azure.
4. Укажите имя сервера анализа данных Azure. Можно указать только один сервер для каждого шлюза. Нажмите кнопку **Настроить**. Теперь все готово.

    ![вход в Azure](./media/analysis-services-gateway/aas-gateway-configure-server.png)

## <a name="how-it-works"></a>Принцип работы
Шлюз работает как служба Windows, **локальный шлюз данных**, на компьютере в сети организации. В основе шлюза, который устанавливается для использования со службой Azure Analysis Services, лежит аналогичный шлюз, который используется для других служб, таких как Power BI, но в настройках этого шлюза есть некоторые отличия.

![Принцип работы](./media/analysis-services-gateway/aas-gateway-how-it-works.png)

Запросы и поток данных работают следующим образом:

1. Облачная служба создает запрос с зашифрованными учетными данными для локального источника. Затем запрос отправляется в очередь, чтобы его обработал шлюз.
2. Облачная служба шлюза анализирует запрос и отправляет его в [служебную шину Azure](https://azure.microsoft.com/documentation/services/service-bus/).
3. Локальный шлюз данных опрашивает служебную шину Azure, чтобы проверить наличие ожидающих запросов.
4. Шлюз получает запрос, расшифровывает учетные данные и подключается к источникам данных, используя эти учетные данные.
5. Затем шлюз отправляет запрос к источнику данных для выполнения.
6. Результаты отправляются из источника данных обратно в шлюз, а затем — в облачную службу.

## <a name="windows-service-account"></a>Учетная запись службы Windows
Локальный шлюз данных настроен для использования *NT SERVICE\PBIEgwService* в качестве учетных данных для входа службы Windows. По умолчанию у него есть право входа в систему в качестве службы в контексте компьютера, на котором устанавливается шлюз. Эти учетные данные не принадлежат той же учетной записи, которая используется для подключения к локальным источникам данных или к учетной записи Azure.  

При возникновении проблем с прокси-сервером из-за проверки подлинности можно изменить учетную запись службы Windows на учетную запись пользователя домена или управляемую запись службы.

## <a name="ports"></a>порты;
Шлюз создает исходящее подключение к служебной шине Azure. Он обменивается данными через исходящие порты: TCP 443 (по умолчанию), а также 5671, 5672 и 9350–9354.  Шлюзу не требуются входящие порты.

Рекомендуем добавить IP-адреса для области данных в список разрешений вашего брандмауэра. Вы можете скачать [список IP-адресов центра обработки данных Microsoft Azure](https://www.microsoft.com/download/details.aspx?id=41653). Список обновляется раз в неделю.

> [!NOTE]
> IP-адреса, перечисленные в списке центра обработки данных Azure, находятся в нотации CIDR. Например, 10.0.0.0/24 не означает 10.0.0.0–10.0.0.24. Дополнительные сведения о нотации CIDR см. [здесь](http://whatismyipaddress.com/cidr).
>
>

Ниже приведены полные доменные имена, которые используются шлюзом.

| Имена доменов | Исходящие порты | Description (Описание) |
| --- | --- | --- |
| *.powerbi.com |80 |HTTP для скачивания установщика. |
| *.powerbi.com |443 |HTTPS |
| *.analysis.windows.net |443 |HTTPS |
| *.login.windows.net |443 |HTTPS |
| *.servicebus.windows.net |5671–5672 |Протокол AMQP |
| *.servicebus.windows.net |443, 9350–9354 |Прослушиватели ретрансляции служебной шины по протоколу TCP (порт 443 требуется для получения маркера контроля доступа). |
| *.frontend.clouddatahub.net |443 |HTTPS |
| *.core.windows.net |443 |HTTPS |
| login.microsoftonline.com |443 |HTTPS |
| *.msftncsi.com |443 |Используется для проверки подключения к Интернету, если шлюз недоступен для службы Power BI. |
| *.microsoftonline-p.com |443 |Используется для проверки подлинности в зависимости от конфигурации. |

### <a name="forcing-https-communication-with-azure-service-bus"></a>Принудительное использование протокола HTTPS для связи со служебной шиной Azure
Можно выбрать принудительное использование протокола HTTPS для связи между шлюзом и служебной шиной Azure вместо прямого подключения TCP. Однако это может значительно снизить производительность. Чтобы принудительно использовать протокол, нужно изменить файл *Microsoft.PowerBI.DataMovement.Pipeline.GatewayCore.dll.config*. Измените значение `AutoDetect` на `Https`. По умолчанию этот файл находится в расположении *C:\Program Files\On-premises data gateway*.

```
<setting name="ServiceBusSystemConnectivityModeString" serializeAs="String">
    <value>Https</value>
</setting>
```


## <a name="troubleshooting"></a>Устранение неполадок
Кроме того, локальный шлюз данных для подключения служб Azure Analysis Services к локальным источникам данных — это тот же шлюз, который используется с Power BI.

Если у вас возникли проблемы с установкой или настройкой шлюза, см. статью [Устранение неполадок локального шлюза данных](https://powerbi.microsoft.com/documentation/powerbi-gateway-onprem-tshoot/). Если возникли проблемы с брандмауэром, ознакомьтесь с разделами о настройке брандмауэра или прокси-сервера.

При возникновении проблем с настройкой прокси-сервера для шлюза см. статью [Настройка параметров прокси-сервера для шлюзов Power BI](https://powerbi.microsoft.com/documentation/powerbi-gateway-proxy.md).

### <a name="telemetry"></a>Телеметрия
Телеметрию можно использовать для мониторинга и устранения неполадок. 

**Включение телеметрии**

1.    Проверьте клиентский каталог локального шлюза данных на компьютере. Обычно это каталог %системный_диск%\Program Files\On-premises data gateway. Кроме того, можно открыть консоль "Службы" и проверить свойство "Путь доступа к исполняемому файлу" для службы локального шлюза данных.
2.    В файле Microsoft.PowerBI.DataMovement.Pipeline.GatewayCore.dll.config в каталоге клиента выполните указанные ниже действия. Измените значение параметра SendTelemetry на true.
        
    ```
        <setting name="SendTelemetry" serializeAs="String">
                    <value>true</value>
        </setting>
    ```

3.    Сохраните изменения и перезапустите службу Windows "Локальный шлюз данных".




## <a name="next-steps"></a>Дальнейшие действия
* [Управление службами Analysis Services](analysis-services-manage.md)
* [Получение данных из служб Azure Analysis Services](analysis-services-connect.md)

