---
title: Взаимодействие между ExpressRoute, VPN-подключением типа "сеть — сеть" и пирингом виртуальных сетей. Анализ плоскости данных для взаимодействия компонентов подключения к серверной части в Azure | Документация Майкрософт
description: Эта страница содержит анализ плоскости данных для тестовой конфигурации, созданной для анализа взаимодействия ExpressRoute, VPN-подключения типа "сеть — сеть" и пиринга виртуальных сетей.
documentationcenter: na
services: networking
author: rambk
manager: tracsman
ms.service: expressroute,vpn-gateway,virtual-network
ms.topic: article
ms.workload: infrastructure-services
ms.date: 10/18/2018
ms.author: rambala
ms.openlocfilehash: c9f3824b1e0f44338696ba3c2e434d60eee3af8b
ms.sourcegitcommit: 9e179a577533ab3b2c0c7a4899ae13a7a0d5252b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2018
ms.locfileid: "49947100"
---
# <a name="interoperability-of-expressroute-site-to-site-vpn-and-vnet-peering---data-plane-analysis"></a>Взаимодействие ExpressRoute, VPN-подключения типа "сеть — сеть" и пиринга виртуальных сетей. Анализ плоскости данных

В этой статье мы выполним анализ тестовой конфигурации в плоскости данных. Сама тестовая конфигурация описана в [этой статье][Setup]. Чтобы просмотреть подробные сведения о настройке тестовой конфигурации, изучите [этот документ][Configuration]. Анализ плоскости управления для тестовой конфигурации приводится [здесь][Control-Analysis].

В анализе плоскости данных рассматривается путь пакетов, проходящих из одной локальной или виртуальной сети в другую сеть в рамках той же топологии. Путь данных между двумя локальными сетями не всегда будет симметричным. Соответственно, в этой статье мы отдельно проанализируем путь переадресации из одной локальной сети в другую и обратный путь.

##<a name="data-path-from-hub-vnet"></a>Путь данных из виртуальной сети концентратора

###<a name="path-to-spoke-vnet"></a>Путь к периферийной виртуальной сети

Пиринг виртуальных сетей эмулирует функциональные возможности сетевого моста между двумя виртуальными сетями, для которых настроен этот пиринг. Ниже представлена трассировка маршрута пакетов из виртуальной сети концентратора на виртуальную машину в периферийной виртуальной сети.

    C:\Users\rb>tracert 10.11.30.4

    Tracing route to 10.11.30.4 over a maximum of 30 hops

      1     2 ms     1 ms     1 ms  10.11.30.4

    Trace complete.

На следующем снимке экрана показано графическое представление связи между виртуальной сетью концентратора и периферийной виртуальной сетью, созданное в Наблюдателе за сетями Azure.


[![1]][1]

###<a name="path-to-branch-vnet"></a>Путь к виртуальной сети филиала

    C:\Users\rb>tracert 10.11.30.68

    Tracing route to 10.11.30.68 over a maximum of 30 hops

      1     1 ms     1 ms     1 ms  10.10.30.142
      2     *        *        *     Request timed out.
      3     2 ms     2 ms     2 ms  10.11.30.68

    Trace complete.

В приведенном выше маршруте трассировки в качестве первого прыжка указан VPN-шлюз в виртуальной сети концентратора. Второй прыжок — VPN-шлюз в виртуальной сети филиала, IP-адрес которого не объявляется в виртуальной сети концентратора. Третий прыжок — виртуальная машина в виртуальной сети филиала.

На следующем снимке экрана показано графическое представление связи между виртуальной сетью концентратора и виртуальной сетью филиала, созданное в Наблюдателе за сетями Azure.

[![2]][2]

На следующем снимке экрана показано представление сетки для того же подключения, созданное в Наблюдателе за сетями Azure.

[![3]][3]

###<a name="path-to-on-premises-location-1"></a>Путь к локальному расположению 1

    C:\Users\rb>tracert 10.2.30.10

    Tracing route to 10.2.30.10 over a maximum of 30 hops

      1     2 ms     2 ms     2 ms  10.10.30.132
      2     *        *        *     Request timed out.
      3     *        *        *     Request timed out.
      4     2 ms     2 ms     2 ms  10.2.30.10

    Trace complete.

В приведенном выше маршруте трассировки в качестве первого прыжка указана конечная точка туннеля от шлюза ExpressRoute до MSEE. Вторым и третьим прыжком являются IP-адреса маршрутизатора CE и локальной сети локального расположения 1 соответственно. Эти IP-адреса не объявляются в виртуальной сети концентратора. Четвертый прыжок — виртуальная машина в локальном расположении 1.


###<a name="path-to-on-premises-location-2"></a>Путь к локальному расположению 2

    C:\Users\rb>tracert 10.1.31.10

    Tracing route to 10.1.31.10 over a maximum of 30 hops

      1    76 ms    75 ms    75 ms  10.10.30.134
      2     *        *        *     Request timed out.
      3     *        *        *     Request timed out.
      4    75 ms    75 ms    75 ms  10.1.31.10

    Trace complete.

В приведенном выше маршруте трассировки в качестве первого прыжка указана конечная точка туннеля от шлюза ExpressRoute до MSEE. Вторым и третьим прыжком являются IP-адреса маршрутизатора CE и локальной сети локального расположения 2 соответственно. Эти IP-адреса не объявляются в виртуальной сети концентратора. Четвертый прыжок — виртуальная машина в локальном расположении 2.

###<a name="path-to-remote-vnet"></a>Путь к удаленной виртуальной сети

    C:\Users\rb>tracert 10.17.30.4

    Tracing route to 10.17.30.4 over a maximum of 30 hops

      1     2 ms     2 ms     2 ms  10.10.30.132
      2     *        *        *     Request timed out.
      3    69 ms    68 ms    69 ms  10.17.30.4

    Trace complete.

В приведенном выше маршруте трассировки в качестве первого прыжка указана конечная точка туннеля от шлюза ExpressRoute до MSEE. Второй прыжок — IP-адрес шлюза удаленной виртуальной сети. Диапазон IP-адресов, в который входит адрес второго прыжка, не объявляется в виртуальной сети концентратора. Третий прыжок — виртуальная машина в удаленной виртуальной сети.

##<a name="data-path-from-spoke-vnet"></a>Путь данных из периферийной виртуальной сети

Как вы помните, представление сети для периферийной виртуальной сети будет таким же, как и для виртуальной сети концентратора. Периферийная виртуальная сеть через пиринг виртуальных сетей использует подключение к удаленному шлюзу виртуальной сети концентратора, как если бы он был напрямую подключен к периферийной виртуальной сети.

###<a name="path-to-hub-vnet"></a>Путь к виртуальной сети концентратора

    C:\Users\rb>tracert 10.10.30.4

    Tracing route to 10.10.30.4 over a maximum of 30 hops

      1    <1 ms    <1 ms    <1 ms  10.10.30.4

    Trace complete.

###<a name="path-to-branch-vnet"></a>Путь к виртуальной сети филиала

    C:\Users\rb>tracert 10.11.30.68

    Tracing route to 10.11.30.68 over a maximum of 30 hops

      1     1 ms    <1 ms    <1 ms  10.10.30.142
      2     *        *        *     Request timed out.
      3     3 ms     2 ms     2 ms  10.11.30.68

    Trace complete.

В приведенном выше маршруте трассировки в качестве первого прыжка указан VPN-шлюз в виртуальной сети концентратора. Второй прыжок — VPN-шлюз в виртуальной сети филиала, IP-адрес которого не объявляется в виртуальной сети концентратора или в периферийной виртуальной сети. Третий прыжок — виртуальная машина в виртуальной сети филиала.

###<a name="path-to-on-premises-location-1"></a>Путь к локальному расположению 1

    C:\Users\rb>tracert 10.2.30.10

    Tracing route to 10.2.30.10 over a maximum of 30 hops

      1    24 ms     2 ms     3 ms  10.10.30.132
      2     *        *        *     Request timed out.
      3     *        *        *     Request timed out.
      4     3 ms     2 ms     2 ms  10.2.30.10

    Trace complete.

В приведенном выше маршруте трассировки в качестве первого прыжка указана конечная точка туннеля от шлюза ExpressRoute в виртуальной сети концентратора до MSEE. Вторым и третьим прыжком являются IP-адреса маршрутизатора CE и локальной сети локального расположения 1 соответственно. Эти IP-адреса не объявляются в виртуальной сети концентратора или в периферийной виртуальной сети. Четвертый прыжок — виртуальная машина в локальном расположении 1.

###<a name="path-to-on-premises-location-2"></a>Путь к локальному расположению 2

    C:\Users\rb>tracert 10.2.30.10

    Tracing route to 10.2.30.10 over a maximum of 30 hops

      1    24 ms     2 ms     3 ms  10.10.30.132
      2     *        *        *     Request timed out.
      3     *        *        *     Request timed out.
      4     3 ms     2 ms     2 ms  10.2.30.10

    Trace complete.

В приведенном выше маршруте трассировки в качестве первого прыжка указана конечная точка туннеля от шлюза ExpressRoute в виртуальной сети концентратора до MSEE. Вторым и третьим прыжком являются IP-адреса маршрутизатора CE и локальной сети локального расположения 2 соответственно. Эти IP-адреса не объявляются в виртуальной сети концентратора или в периферийной виртуальной сети. Четвертый прыжок — виртуальная машина в локальном расположении 2.

###<a name="path-to-remote-vnet"></a>Путь к удаленной виртуальной сети

    C:\Users\rb>tracert 10.17.30.4

    Tracing route to 10.17.30.4 over a maximum of 30 hops

      1     2 ms     1 ms     1 ms  10.10.30.133
      2     *        *        *     Request timed out.
      3    71 ms    70 ms    70 ms  10.17.30.4

    Trace complete.

В приведенном выше маршруте трассировки в качестве первого прыжка указана конечная точка туннеля от шлюза ExpressRoute в виртуальной сети концентратора до MSEE. Второй прыжок — IP-адрес шлюза удаленной виртуальной сети. Диапазон IP-адресов, в который входит адрес второго прыжка, не объявляется в виртуальной сети концентратора или в периферийной виртуальной сети. Третий прыжок — виртуальная машина в удаленной виртуальной сети.

##<a name="data-path-from-branch-vnet"></a>Путь данных из виртуальной сети филиала

###<a name="path-to-hub-vnet"></a>Путь к виртуальной сети концентратора

    C:\Windows\system32>tracert 10.10.30.4

    Tracing route to 10.10.30.4 over a maximum of 30 hops

      1    <1 ms    <1 ms    <1 ms  10.11.30.100
      2     *        *        *     Request timed out.
      3     4 ms     3 ms     3 ms  10.10.30.4

    Trace complete.

В приведенном выше маршруте трассировки в качестве первого прыжка указан VPN-шлюз в виртуальной сети филиала. Второй прыжок — VPN-шлюз в виртуальной сети концентратора, IP-адрес которого не объявляется в удаленной виртуальной сети. Третий прыжок — виртуальная машина в виртуальной сети концентратора.

###<a name="path-to-spoke-vnet"></a>Путь к периферийной виртуальной сети

    C:\Users\rb>tracert 10.11.30.4

    Tracing route to 10.11.30.4 over a maximum of 30 hops

      1     1 ms    <1 ms     1 ms  10.11.30.100
      2     *        *        *     Request timed out.
      3     4 ms     3 ms     2 ms  10.11.30.4

    Trace complete.

В приведенном выше маршруте трассировки в качестве первого прыжка указан VPN-шлюз в виртуальной сети филиала. Второй прыжок — VPN-шлюз в виртуальной сети концентратора, IP-адрес которого не объявляется в удаленной виртуальной сети, а третий прыжок — виртуальная машина в периферийной виртуальной сети.

###<a name="path-to-on-premises-location-1"></a>Путь к локальному расположению 1

    C:\Users\rb>tracert 10.2.30.10

    Tracing route to 10.2.30.10 over a maximum of 30 hops

      1     1 ms    <1 ms    <1 ms  10.11.30.100
      2     *        *        *     Request timed out.
      3     3 ms     2 ms     2 ms  10.2.30.125
      4     *        *        *     Request timed out.
      5     3 ms     3 ms     3 ms  10.2.30.10

    Trace complete.

В приведенном выше маршруте трассировки в качестве первого прыжка указан VPN-шлюз в виртуальной сети филиала. Второй прыжок — VPN-шлюз в виртуальной сети концентратора, IP-адрес которого не объявляется в удаленной виртуальной сети. Третий прыжок — точка завершения туннеля VPN на основном маршрутизаторе CE. Четвертый прыжок — внутренний IP-адрес локальной сети локального расположения 1, который не объявляется вне маршрутизатора CE. Пятый прыжок — целевая виртуальная машина в локальном расположении 1.

###<a name="path-to-on-premises-location-2-and-remote-vnet"></a>Путь к локальному расположению 2 и удаленной виртуальной сети

Как уже говорилось выше в анализе плоскости управления, виртуальная сеть филиала в этой сетевой конфигурации не имеет доступа к локальному расположению 2 или к удаленной виртуальной сети. Этот факт подтверждается результатом следующей команды проверки связи. 

    C:\Users\rb>ping 10.1.31.10

    Pinging 10.1.31.10 with 32 bytes of data:

    Request timed out.
    ...
    Request timed out.

    Ping statistics for 10.1.31.10:
        Packets: Sent = 4, Received = 0, Lost = 4 (100% loss),

    C:\Users\rb>ping 10.17.30.4

    Pinging 10.17.30.4 with 32 bytes of data:

    Request timed out.
    ...
    Request timed out.

    Ping statistics for 10.17.30.4:
        Packets: Sent = 4, Received = 0, Lost = 4 (100% loss),

##<a name="data-path-from-on-premises-location-1"></a>Путь данных из локального расположения 1

###<a name="path-to-hub-vnet"></a>Путь к виртуальной сети концентратора

    C:\Users\rb>tracert 10.10.30.4

    Tracing route to 10.10.30.4 over a maximum of 30 hops

      1    <1 ms    <1 ms    <1 ms  10.2.30.3
      2    <1 ms    <1 ms    <1 ms  192.168.30.0
      3    <1 ms    <1 ms    <1 ms  192.168.30.18
      4     *        *        *     Request timed out.
      5     2 ms     2 ms     2 ms  10.10.30.4

    Trace complete.

В приведенном выше маршруте трассировки первые два прыжка являются частью локальной сети. Третий прыжок — основной интерфейс MSEE, подключенный к маршрутизатору CE. Четвертый прыжок — шлюз ExpressRoute в виртуальной сети концентратора, диапазон IP-адресов которого не объявляется в локальной сети. Пятый прыжок — целевая виртуальная машина.

Все представления, созданные Наблюдателем за сетями, ориентированы на Azure. Чтобы создать представление с точки зрения локальной сети, мы применили Монитор производительности сети Azure (NPM). NPM содержит агенты, которые устанавливаются на серверах в сети за пределами Azure и выполняют анализ пути данных.

На следующем снимке экрана показано представление топологии для подключения виртуальной машины из локального расположения 1 к виртуальной машине в сети концентратора через ExpressRoute.

[![4]][4]

Как вы помните, в тестовой конфигурации VPN-подключение типа "сеть — сеть" используется в качестве резервного, а основным служит подключение ExpressRoute между локальным расположением 1 и виртуальной сетью концентратора. Чтобы протестировать обратный путь данных, мы смоделируем сбой канала ExpressRoute между основным маршрутизатором CE в локальном расположении 1 и соответствующим MSEE, отключив интерфейс CE, подключенный к этому MSEE.

    C:\Users\rb>tracert 10.10.30.4

    Tracing route to 10.10.30.4 over a maximum of 30 hops

      1    <1 ms    <1 ms    <1 ms  10.2.30.3
      2    <1 ms    <1 ms    <1 ms  192.168.30.0
      3     3 ms     2 ms     3 ms  10.10.30.4

    Trace complete.

На следующем снимке экрана показано представление топологии для подключения виртуальной машины из локального расположения 1 к виртуальной машине в сети концентратора через VPN-подключение типа "сеть — сеть" при неработающем подключении ExpressRoute.

[![5]][5]

###<a name="path-to-spoke-vnet"></a>Путь к периферийной виртуальной сети

Теперь мы снова включим основное подключение ExpressRoute, чтобы выполнить анализ пути данных к периферийной виртуальной сети.

    C:\Users\rb>tracert 10.11.30.4

    Tracing route to 10.11.30.4 over a maximum of 30 hops

      1    <1 ms    <1 ms    <1 ms  10.2.30.3
      2    <1 ms    <1 ms    <1 ms  192.168.30.0
      3    <1 ms    <1 ms    <1 ms  192.168.30.18
      4     *        *        *     Request timed out.
      5     3 ms     2 ms     2 ms  10.11.30.4

    Trace complete.

Для остальной части анализа пути данных основное подключение ExpressRoute в локальном расположении 1 будет включено.

###<a name="path-to-branch-vnet"></a>Путь к виртуальной сети филиала

    C:\Users\rb>tracert 10.11.30.68

    Tracing route to 10.11.30.68 over a maximum of 30 hops

      1    <1 ms    <1 ms    <1 ms  10.2.30.3
      2    <1 ms    <1 ms    <1 ms  192.168.30.0
      3     3 ms     2 ms     2 ms  10.11.30.68

    Trace complete.

###<a name="path-to-on-premises-location-2"></a>Путь к локальному расположению 2

Как уже говорилось выше в анализе плоскости управления, локальное расположение 1 в этой сетевой конфигурации не имеет доступа к локальному расположению 2. Этот факт подтверждается результатом следующей команды проверки связи. 

    C:\Users\rb>ping 10.1.31.10
    
    Pinging 10.1.31.10 with 32 bytes of data:

    Request timed out.
    ...
    Request timed out.

    Ping statistics for 10.1.31.10:
        Packets: Sent = 4, Received = 0, Lost = 4 (100% loss),

###<a name="path-to-remote-vnet"></a>Путь к удаленной виртуальной сети

    C:\Users\rb>tracert 10.17.30.4

    Tracing route to 10.17.30.4 over a maximum of 30 hops

      1    <1 ms    <1 ms    <1 ms  10.2.30.3
      2     2 ms     5 ms     7 ms  192.168.30.0
      3    <1 ms    <1 ms    <1 ms  192.168.30.18
      4     *        *        *     Request timed out.
      5    69 ms    70 ms    69 ms  10.17.30.4

    Trace complete.

##<a name="data-path-from-on-premises-location-2"></a>Путь данных из локального расположения 2

###<a name="path-to-hub-vnet"></a>Путь к виртуальной сети концентратора

    C:\Windows\system32>tracert 10.10.30.4

    Tracing route to 10.10.30.4 over a maximum of 30 hops

      1    <1 ms    <1 ms    <1 ms  10.1.31.3
      2    <1 ms    <1 ms    <1 ms  192.168.31.4
      3    <1 ms    <1 ms    <1 ms  192.168.31.22
      4     *        *        *     Request timed out.
      5    75 ms    74 ms    74 ms  10.10.30.4

    Trace complete.

###<a name="path-to-spoke-vnet"></a>Путь к периферийной виртуальной сети

    C:\Windows\system32>tracert 10.11.30.4

    Tracing route to 10.11.30.4 over a maximum of 30 hops
      1    <1 ms    <1 ms     1 ms  10.1.31.3
      2    <1 ms    <1 ms    <1 ms  192.168.31.0
      3    <1 ms    <1 ms    <1 ms  192.168.31.18
      4     *        *        *     Request timed out.
      5    75 ms    74 ms    74 ms  10.11.30.4

    Trace complete.

###<a name="path-to-branch-vnet-on-premises-location-1-and-remote-vnet"></a>Путь к виртуальной сети филиала, локальному расположению 1 и удаленной виртуальной сети

Как уже говорилось выше в анализе плоскости управления, локальное расположение 1 в этой сетевой конфигурации не имеет доступа к виртуальной сети филиала, локальному расположению 1 и удаленной виртуальной сети. 

##<a name="data-path-from-remote-vnet"></a>Путь данных из удаленной виртуальной сети

###<a name="path-to-hub-vnet"></a>Путь к виртуальной сети концентратора

    C:\Users\rb>tracert 10.10.30.4

    Tracing route to 10.10.30.4 over a maximum of 30 hops

      1    65 ms    65 ms    65 ms  10.17.30.36
      2     *        *        *     Request timed out.
      3    69 ms    68 ms    68 ms  10.10.30.4

    Trace complete.

###<a name="path-to-spoke-vnet"></a>Путь к периферийной виртуальной сети

    C:\Users\rb>tracert 10.11.30.4

    Tracing route to 10.11.30.4 over a maximum of 30 hops

      1    67 ms    67 ms    67 ms  10.17.30.36
      2     *        *        *     Request timed out.
      3    71 ms    69 ms    69 ms  10.11.30.4

    Trace complete.

### <a name="path-to-branch-vnet-and-on-premises-location-2"></a>Путь к виртуальной сети филиала и к локальному расположению 2

Как уже говорилось выше в анализе плоскости управления, удаленная виртуальная сеть в этой сетевой конфигурации не имеет доступа к виртуальной сети филиала или к локальному расположению 2. 


### <a name="path-to-on-premises-location-1"></a>Путь к локальному расположению 1

    C:\Users\rb>tracert 10.2.30.10

    Tracing route to 10.2.30.10 over a maximum of 30 hops

      1    67 ms    67 ms    67 ms  10.17.30.36
      2     *        *        *     Request timed out.
      3     *        *        *     Request timed out.
      4    69 ms    69 ms    69 ms  10.2.30.10

    Trace complete.


## <a name="further-reading"></a>Дополнительные материалы

### <a name="using-expressroute-and-site-to-site-vpn-connectivity-in-tandem"></a>Параллельное использование подключения ExpressRoute и VPN-подключения типа "сеть — сеть"

####<a name="site-to-site-vpn-over-expressroute"></a>VPN-подключение типа "сеть — сеть" через ExpressRoute

VPN-подключение типа "сеть — сеть" можно настроить через пиринг Microsoft ExpressRoute, чтобы организовать закрытый обмен данными между локальной сетью и виртуальными сетями Azure с гарантией конфиденциальности, защиты от повтора, подлинности и целостности. Дополнительные сведения о настройке VPN-подключения IPSec типа "сеть — сеть" в туннельном режиме через пиринг Microsoft ExpressRoute см. [в этой статье][S2S-Over-ExR]. 

Основным ограничением конфигурации с VPN-подключением типа "сеть — сеть" через пиринг Майкрософт является пропускная способность. Пропускная способность туннеля IPSec ограничена емкостью VPN-шлюза. Пропускная способность шлюза VPN всегда меньше пропускной способности ExpressRoute. В таких ситуациях можно оптимизировать использование пропускной способности ExpressRoute, настроив туннель IPSec для трафика, требующего высокого уровня безопасности, и частный пиринг для всего остального трафика.

#### <a name="site-to-site-vpn-as-a-secure-failover-path-for-expressroute"></a>VPN-подключение типа "сеть — сеть" в качестве пути отработки отказа для ExpressRoute.
ExpressRoute предоставляется в виде пары каналов, что обеспечивает избыточность и высокий уровень доступности. Вы можете настроить географически избыточное подключение ExpressRoute в разных регионах Azure. Как и в нашей тестовой конфигурации, если для подключения ExpressRoute нужен переход на другой ресурс в пределах определенного региона Azure, его можно создать с помощью VPN-подключения типа "сеть — сеть". Если одни и те же префиксы объявляются через ExpressRoute и VPN-подключение типа "сеть — сеть", Azure отдает предпочтение ExpressRoute. Чтобы избежать асимметричной маршрутизации между ExpressRoute и VPN-подключением типа "сеть — сеть", в локальной сети следует также настроить конфигурацию с более высоким приоритетом ExpressRoute относительно VPN-подключения типа "сеть — сеть".

Дополнительные сведения о настройке параллельных подключений ExpressRoute и VPN типа "сеть — сеть" см. в статье [Настройка параллельных подключений "сеть — сеть" и ExpressRoute с помощью PowerShell][ExR-S2S-CoEx].

### <a name="extending-backend-connectivity-to-spoke-vnets-and-branch-locations"></a>Расширение подключения серверной части к периферийным виртуальным сетям и филиалам

#### <a name="spoke-vnet-connectivity-using-vnet-peering"></a>Подключение к периферийной виртуальной сети с использованием пиринга

Звездообразная архитектура виртуальных сетей нашла широкое применение. Главной является виртуальная сеть в Azure, которая выступает в качестве центральной точки подключения периферийных виртуальных сетей к локальной сети. "Периферийными" называются виртуальные сети, которые устанавливают пиринг с центральной сетью и могут использоваться для изоляции рабочих нагрузок. Трафик передается между локальным центром обработки данных и центральной сетью через подключение ExpressRoute и (или) VPN. Дополнительные сведения о звездообразной архитектуре см. в [этой статье][Hub-n-Spoke].

Пиринг виртуальных сетей в пределах региона позволяет периферийным виртуальным сетям использовать шлюзы центральной виртуальной сети (шлюз VPN или ExpressRoute) для подключения к удаленным сетям.

#### <a name="branch-vnet-connectivity-using-site-to-site-vpn"></a>Подключение к виртуальной сети филиала с помощью VPN типа "сеть — сеть"

Виртуальные сети филиалов (расположенные в разных регионах) могут взаимодействовать с локальными сетями через центральную виртуальную сеть. Стандартным решением в Azure для такой конфигурации является VPN-подключение типа "сеть — сеть". Для маршрутизации в центральной сети также можно использовать виртуальные сетевые модули.

Сведения о настройке VPN-шлюзов см. в [этой статье][VPN]. Сведения о развертывании высокодоступных виртуальных сетевых модулей (NVA) см. в [этой статье][Deploy-NVA].

## <a name="next-steps"></a>Дополнительная информация

Чтобы узнать, сколько каналов ExpressRoute можно подключить к шлюзу ExpressRoute и сколько шлюзов ExpressRoute можно подключить к каналу ExpressRoute, а также изучить другие ограничения масштабирования ExpressRoute, см. [вопросы и ответы об ExpressRoute][ExR-FAQ]


<!--Image References-->
[1]: ./media/backend-interoperability/HubVM-SpkVM.jpg "Представление Наблюдателя за сетями: подключение виртуальной сети концентратора к периферийной виртуальной сети"
[2]: ./media/backend-interoperability/HubVM-BranchVM.jpg "Представление Наблюдателя за сетями: подключение виртуальной сети концентратора к виртуальной сети филиала"
[3]: ./media/backend-interoperability/HubVM-BranchVM-Grid.jpg "Представление сетки Наблюдателя за сетями: подключение виртуальной сети концентратора к виртуальной сети филиала"
[4]: ./media/backend-interoperability/Loc1-HubVM.jpg "Представление Монитора производительности сети: подключение от виртуальной машины в расположении 1 к виртуальной сети концентратора через канал ExpressRoute 1"
[5]: ./media/backend-interoperability/Loc1-HubVM-S2S.jpg "Представление Монитора производительности сети: подключения от виртуальной машины в расположении 1 к виртуальной сети концентратора через канал VPN типа "сеть — сеть""

<!--Link References-->
[Setup]: https://docs.microsoft.com/azure/networking/connectivty-interoperability-preface
[Configuration]: https://docs.microsoft.com/azure/networking/connectivty-interoperability-config
[ExpressRoute]: https://docs.microsoft.com/azure/expressroute/expressroute-introduction
[VPN]: https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways
[VNet]: https://docs.microsoft.com/azure/virtual-network/tutorial-connect-virtual-networks-portal
[Configuration]: https://docs.microsoft.com/azure/networking/connectivty-interoperability-configuration
[Control-Analysis]:https://docs.microsoft.com/azure/networking/connectivty-interoperability-control-plane
[Data-Analysis]: https://docs.microsoft.com/azure/networking/connectivty-interoperability-data-plane
[ExR-FAQ]: https://docs.microsoft.com/azure/expressroute/expressroute-faqs
[S2S-Over-ExR]: https://docs.microsoft.com/azure/expressroute/site-to-site-vpn-over-microsoft-peering
[ExR-S2S-CoEx]: https://docs.microsoft.com/azure/expressroute/expressroute-howto-coexist-resource-manager
[Hub-n-Spoke]: https://docs.microsoft.com/azure/architecture/reference-architectures/hybrid-networking/hub-spoke
[Deploy-NVA]: https://docs.microsoft.com/azure/architecture/reference-architectures/dmz/nva-ha
[VNet-Config]: https://docs.microsoft.com/azure/virtual-network/virtual-network-manage-peering




