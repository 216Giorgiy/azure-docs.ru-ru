<properties 
   pageTitle="Ресурсы подключений в службе автоматизации Azure"
   description="Ресурсы подключений в службе автоматизации Azure содержат данные, необходимые для подключения к внешней службе или приложению из Runbook. В статье подробно рассматриваются подключения и работа с ними как в текстовых, так и в графических модулях."
   services="automation"
   documentationCenter=""
   authors="bwren"
   manager="stevenka"
   editor="tysonn" />
<tags 
   ms.service="automation"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="05/21/2015"
   ms.author="bwren" />

# Ресурсы подключений в службе автоматизации Azure

Ресурс подключения службы автоматизации содержит сведения, необходимые для подключения к внешней службе или приложению из Runbook. Это может включать данные, необходимые для аутентификации, такие как имя пользователя и пароль, а также информацию о подключении, например URL-адрес или порт. Вместо создания нескольких переменных значение подключения хранит в одном ресурсе все свойства для подключения к определенному приложению. Пользователь может изменять значения для подключения в одном месте, и передать имя подключения в Runbook можно в одном параметре. К свойствам соединения можно обращаться в Runbook с помощью действия **Get-AutomationConnection**.

При создании подключения необходимо указать его *тип*. Тип подключения — это шаблон, определяющий набор его свойств. Подключение определяет значения для каждого свойства, определенного в его типе. Типы подключений добавляются в службу автоматизации Azure в модулях интеграции или создаются с помощью [API службы автоматизации Azure](http://msdn.microsoft.com/library/azure/mt163818.aspx). При создании подключения доступны только типы, установленные в вашей учетной записи службы автоматизации.

>[AZURE.NOTE]К защищенным ресурсам в службе автоматизации Azure относятся учетные данные, сертификаты, подключения и зашифрованные переменные. Эти ресурсы шифруются и хранятся в службе автоматизации Azure с помощью уникального ключа, который создается для каждой учетной записи службы автоматизации. Ключ шифруется главным сертификатом и хранится в службе автоматизации Azure. Перед сохранением защищенного ресурса ключ учетной записи службы автоматизации дешифруется с помощью главного сертификата и используется для шифрования ресурса.

## Командлеты Windows PowerShell

Командлеты, представленные в следующей таблице, используются для создания подключений службы автоматизации и управления ими с помощью Windows PowerShell. Они входят в состав [модуля Azure PowerShell](../powershell-install-configure.md), который можно использовать в модулях Runbook службы автоматизации.

|Командлет|Описание|
|:---|:---|
|[Get-AzureAutomationConnection](http://msdn.microsoft.com/library/dn921828.aspx)|Извлекает подключение. Содержит хэш-таблицу со значениями полей подключения.|
|[New-AzureAutomationConnection](http://msdn.microsoft.com/library/dn921825.aspx)|Создает новое подключение.|
|[Remove-AzureAutomationConnection](http://msdn.microsoft.com/library/dn921827.aspx)|Удаляет существующее подключение.|
|[Set-AzureAutomationConnectionFieldValue](http://msdn.microsoft.com/library/dn921826.aspx)|Задает значение определенного поля для существующего подключения.|

## Действия Runbook

Действия в следующей таблице используются для доступа к подключениям в модуле Runbook.

|Действия|Описание|
|---|---|
|Get-AutomationConnection|Получает подключение для использования в Runbook. Возвращает хэш-таблицу со свойствами подключения.|

>[AZURE.NOTE]Не следует использовать переменные в параметре –Name в **Get-AutomationConnection**, так как это может усложнить обнаружение зависимостей между модулями Runbook и ресурсами подключений во время разработки.

## Создание нового подключения

### Создание нового подключения на портале Azure

1. Из учетной записи службы автоматизации щелкните **Активы** в верхней части окна.
1. Нажмите кнопку **Добавить параметр** в нижней части окна.
1. Щелкните **Добавить подключение**.
2. В раскрывающемся списке **Тип подключения** выберите тип подключения, которое необходимо создать. Мастер представит свойства для этого типа.
1. Завершите работу мастера и установите флажок, чтобы сохранить новое подключение.


### Создание нового подключения на портале предварительной версии Azure

1. Из учетной записи службы автоматизации щелкните элемент **Активы**, чтобы открыть колонку **Активы**.
1. Щелкните элемент **Подключения**, чтобы открыть колонку **Подключения**.
1. Щелкните **Добавить подключение** в верхней части колонки.
2. В раскрывающемся списке **Тип** выберите тип подключения, которое необходимо создать. Форма представит свойства для этого типа.
1. Заполните форму и нажмите кнопку **Создать** для сохранения нового подключения.



### Создание нового подключения с помощью Windows PowerShell

Создайте новое подключение в Windows PowerShell с помощью командлета [New-AzureAutomationConnection](http://msdn.microsoft.com/library/dn921825.aspx). У этого командлета есть параметр **ConnectionFieldValues**, который ожидает [хэш-таблицу](http://technet.microsoft.com/library/hh847780.aspx), задающую значения для каждого свойства, определенного типом подключения.


Команды в приведенном ниже примере создают новое подключение к [Twilio](http://www.twilio.com) — службе телефонии, позволяющий отправлять и принимать текстовые сообщения. Пример модуля интеграции, содержащий тип подключения Twilio, доступен в на сайте [Script Center](http://gallery.technet.microsoft.com/scriptcenter/Twilio-PowerShell-Module-8a8bfef8). Этот тип подключения определяет свойства идентификатора безопасности учетной записи и маркера авторизации, необходимых для проверки учетной записи при подключении к Twilio. Необходимо [скачать этот модуль](http://gallery.technet.microsoft.com/scriptcenter/Twilio-PowerShell-Module-8a8bfef8) и установить его в учетной записи службы автоматизации, чтобы этот пример кода работал.

	$AccountSid = "DAf5fed830c6f8fac3235c5b9d58ed7ac5"
	$AuthToken  = "17d4dadfce74153d5853725143c52fd1"
	$FieldValues = @{"AccountSid" = $AccountSid;"AuthToken"=$AuthToken}

	New-AzureAutomationConnection -AutomationAccountName "MyAutomationAccount" -Name "TwilioConnection" -ConnectionTypeName "Twilio" -ConnectionFieldValues $FieldValues


## Использование подключения в Runbook

Для получения подключения в Runbook используется командлет **Get-AutomationConnection**. Это действие получает значения различных полей в подключении и возвращает их в виде [хэш-таблицы](http://go.microsoft.com/fwlink/?LinkID=324844), которую затем можно использовать с помощью соответствующих команд в Runbook.

### Пример текстового Runbook
Команды в приведенном ниже примере демонстрируют использование подключения Twilio из предыдущего примера для отправки текстового сообщения из Runbook. У используемого здесь действия Send-TwilioSMS есть два набора параметров, использующих разные методы аутентификации в службе Twilio. В одном используется объект подключения, в другом — отдельные параметры для идентификатора безопасности и маркера авторизации учетной записи. В этом примере показаны оба метода.

	$Con = Get-AutomationConnection -Name "TwilioConnection"
	$NumTo = "14255551212"
	$NumFrom = "15625551212"
	$Body = "Text from Azure Automation."

	#Send text with connection object.
	Send-TwilioSMS -Connection $Con -From $NumFrom -To $NumTo -Body $Body

	#Send text with connection properties.
	Send-TwilioSMS -AccountSid $Con.AccountSid -AuthToken $Con.AuthToken $Con -From $NumFrom -To $NumTo -Body $Body

### Примеры графических Runbook

Можно добавить действие **Get-AutomationConnection** в графический Runbook, щелкнув правой кнопкой мыши подключение в области «Библиотека» графического редактора и выбрав пункт **Добавить на холст**.

![](media/automation-connections/connection-add-canvas.png)

На следующем рисунке показан пример использования подключения в графическом Runbook. Это приведенный выше пример для отправки текстового сообщения с использованием Twilio из текстового Runbook. В этом примере для действия **Send-TwilioSMS** задан параметр **UseConnectionObject**, использующий объект подключения для аутентификации в службе. Здесь используется [конвейерная связь](automation-graphical-authoring-intro.md#links-and-workflow), так как параметр Connection ожидает один объект.

Причина того, что для значения в параметре **To** используется выражение PowerShell, а не постоянное значение, состоит в том, что этот параметр ожидает значение типа «строковый массив», то есть вы можете отправить сообщение на несколько номеров. Выражение PowerShell позволяет предоставить одиночное значение или массив.

![](media/automation-connections/get-connection-object.png)

На следующем рисунке показан тот же пример, что описан выше, но с использованием набора параметров **SpecifyConnectionFields**, который ожидает параметры AccountSid и AuthToken, указанные отдельно, а не использует для аутентификации объект подключения. В этом случае поля подключения указываются вместо самого объекта.

![](media/automation-connections/get-connection-properties.png)



## Связанные статьи

- [Использование связей при создании графических модулей](automation-graphical-authoring-intro.md#links-and-workflow)
 

<!---HONumber=July15_HO4-->