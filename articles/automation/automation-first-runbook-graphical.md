<properties
    pageTitle="Мой первый графический модуль Runbook в службе автоматизации Azure | Microsoft Azure"
    description="Учебник, в котором описывается создание, тестирование и публикация простого графического модуля Runbook."
    services="automation"
    documentationCenter=""
    authors="mgoedtel"
    manager="jwhit"
    editor=""/>

<tags
    ms.service="automation"
    ms.workload="tbd"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="get-started-article"
    ms.date="04/21/2016"
    ms.author="magoedte;bwren"/>

# Первый графический Runbook

> [AZURE.SELECTOR] - [Graphical](automation-first-runbook-graphical.md) - [PowerShell Workflow](automation-first-runbook-textual.md) - [PowerShell](automation-first-runbook-textual-PowerShell.md)

В данном учебнике описана процедура создания [графического модуля Runbook](automation-runbook-types.md#graphical-runbooks) в службе автоматизации Azure. Для начала мы протестируем и опубликуем простой модуль Runbook и расскажем, как отслеживать состояние его заданий. Затем мы изменим Runbook, настроив его на фактическое управление ресурсами Azure (в данном случае на запуск виртуальной машины Azure). После этого мы повысим надежность модуля Runbook, добавив параметры и условные связи.

## Предварительные требования

Для работы с этим учебником необходимо следующее.

-	Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или <a href="/pricing/free-account/" target="_blank">[зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/).
-	[Учетная запись службы автоматизации](automation-security-overview.md), чтобы хранить модуль Runbook и выполнять проверку подлинности при работе с ресурсами Azure. Эта учетная запись должна иметь разрешение на запуск и остановку виртуальной машины.
-	Виртуальная машина Azure. Это не должна быть рабочая машина, поскольку в процессе изучения данного материала ее нужно будет остановить и запустить заново.


## Шаг 1. Создание нового модуля Runbook

Для начала мы создадим простой модуль Runbook, выводящий на экран текст *Привет, мир!*

1.	На портале Azure выберите свою учетную запись в службе автоматизации. Страница учетной записи в службе автоматизации позволяет быстро получить представление о ресурсах, доступных в этой учетной записи. Некоторые ресурсы уже должны быть доступны. Большинство из них — это модули, которые добавляются в каждую новую учетную запись в службе автоматизации по умолчанию. Кроме того, вам потребуется ресурс учетных данных, упомянутый в [предварительных требованиях](#prerequisites).
2.	Щелкните **Модули Runbook**, чтобы открыть список модулей Runbook.<br> ![Элемент управления "Модули Runbook"](media/automation-first-runbook-graphical/runbooks-control.png)
3.	Создайте новый модуль Runbook, щелкнув **Добавить Runbook**, а затем **Создать новый Runbook**.
4.	Присвойте модулю Runbook имя *MyFirstRunbook-Graphical*.
5.	В этом примере мы создаем [графический модуль Runbook](automation-graphical-authoring-intro.md), поэтому выберите в поле **Тип Runbook** значение **Графический**.<br> ![Новый Runbook](media/automation-first-runbook-graphical/new-runbook.png)<br>
6.	Щелкните **Создать**, чтобы создать модуль Runbook и открыть графический редактор.

## Шаг 2. Добавление действий в модуль Runbook

Элемент управления "Библиотека" в левой части редактора позволяет добавлять действия в модуль Runbook. Мы добавим командлет **Write-Output** для вывода текста из модуля Runbook.

1.	В элементе управления "Библиотека" щелкните текстовое поле поиска и введите **Write-Output**. Результаты поиска будут отображены ниже. <br> ![Microsoft.PowerShell.Utility](media/automation-first-runbook-graphical/search-powershell-cmdlet-writeoutput.png)
2.	Прокрутите список до конца. Здесь можно щелкнуть правой кнопкой мыши **Write-Output** и выбрать пункт **Добавить на холст** или щелкнуть многоточие рядом с командлетом и выбрать пункт **Добавить на холст**.
3.	Выберите действие **Write-Output** на холсте. Откроется колонка управления конфигурацией, где можно настроить выбранное действие.
4.	В поле **Метка** по умолчанию указывается имя командлета, но можно указать и более понятное название. Введите в это поле значение *Вывод текста "Привет, мир!"*.
5.	Щелкните **Параметры**, чтобы указать значения для параметров командлета. Некоторые командлеты имеют несколько наборов параметров, и вам нужно выбрать, какой из них будет использоваться. В данном случае командлет **Write-Output** имеет только один набор параметров, поэтому выбор делать не нужно.<br>![Свойства командлета Write-Output](media/automation-first-runbook-graphical/write-output-properties-update.png)
6.	Выберите параметр **InputObject**. В этом параметре мы укажем текст для отправки в поток выходных данных.
7.	В раскрывающемся списке **Источник данных** выберите пункт **Выражение PowerShell**. Раскрывающийся список **Источник данных** включает разные источники, которые можно использовать для заполнения значения параметра. Можно использовать выходные данные из таких источников, как другое действие, ресурс автоматизации или выражение PowerShell. В данном случае нам нужно вывести только текст *Привет, мир!* Для этого мы воспользуемся выражением PowerShell и укажем строку.
8.	В поле **Выражение** введите текст *Привет, мир!* и дважды нажмите кнопку **ОК**, чтобы вернуться к холсту.<br>![Выражение PowerShell](media/automation-first-runbook-graphical/expression-hello-world.png)
9.	Щелкните **Сохранить**, чтобы сохранить модуль Runbook.<br> ![Сохранить Runbook](media/automation-first-runbook-graphical/runbook-toolbar-save.png)

## Шаг 3. Тестирование модуля Runbook

Прежде чем опубликовать модуль Runbook и, таким образом, сделать его доступным для рабочей среды, необходимо проверить, нормально ли он работает. Чтобы протестировать модуль Runbook, нужно запустить его **черновую** версию и проверить его работу в интерактивном режиме.

1.	Щелкните **область тестирования**, чтобы открыть колонку "Тест".<br> ![Область тестирования](media/automation-first-runbook-graphical/runbook-toolbar-test.png)
2.	Щелкните **Пуск**, чтобы начать тестирование. Активным должен быть только этот параметр.
3.	При этом создается объект [Задание Runbook](automation-runbook-execution.md), а его состояние отображается на панели. Сначала задание получает состояние *В очереди*, то есть оно ожидает, пока рабочая роль Runbook в облаке станет доступной. Как только исполнитель затребует задание, оно получит состояние *Запущено*, а с началом фактического выполнения модуля Runbook — состояние *Выполняется*.  
4.	Когда задание модуля Runbook будет выполнено, на экране появится результат. В нашем случае это должен быть текст *Привет, мир!*<br>![Hello World](media/automation-first-runbook-graphical/runbook-test-results.png)
5.	Закройте колонку "Тест", чтобы вернуться на холст.

## Шаг 4. Публикация и запуск модуля Runbook

Модуль, который мы только что создали, все еще находится в режиме проекта. Прежде чем запустить модуль в рабочей среде, его нужно опубликовать. При публикации модуля Runbook существующая опубликованная версия перезаписывается черновой версией. В нашем случае опубликованной версии не существует, поскольку Runbook был создан только что.

1.	Нажмите кнопку **Опубликовать**, чтобы опубликовать Runbook, а затем кнопку **Да** в появившемся запросе.<br> ![Опубликовать](media/automation-first-runbook-graphical/runbook-toolbar-publish.png)
2.	Прокрутите экран влево. В колонке **Модули Runbook** **состояние авторизации** модуля должно иметь значение **Опубликовано**.
3.	Прокрутите экран обратно вправо до колонки **MyFirstRunbook**. Параметры в верхней части экрана позволяют запустить модуль Runbook, запланировать его запуск в определенное время или создать [Webhook](automation-webhooks.md), чтобы модуль можно было запускать с помощью HTTP-вызова.
4.	Нам нужно только запустить модуль Runbook, поэтому щелкните **Пуск**, а затем **Да** в появившемся запросе.<br> ![Запуск модуля Runbook](media/automation-first-runbook-graphical/runbook-controls-start.png)
5.	Откроется колонка заданий с созданным заданием Runbook. Эту колонку можно закрыть, но мы пока оставим ее открытой, чтобы проследить за выполнением задания.
6.	Состояние задания отображается в поле **Сводные данные задания** и отражает состояния, которые мы наблюдали при тестировании модуля Runbook.<br> ![Сводные данные задания](media/automation-first-runbook-graphical/runbook-job-summary.png)
7.	Как только состояние модуля Runbook изменится на *Выполнено*, щелкните **Выходные данные**. Откроется колонка **Выходные данные** с нашим текстом *Hello World*.<br> ![Сводные данные задания](media/automation-first-runbook-graphical/runbook-job-output.png)  
8.	Закройте колонку выходных данных.
9.	Щелкните **Все журналы**, чтобы открыть колонку "Потоки" для задания Runbook. В потоке выходных данных должен отображаться только текст *Привет, мир!*, но могут присутствовать и другие потоки заданий Runbook, например "Подробная информация" и "Ошибка", если Runbook записывает в них какие-то данные.<br> ![Сводные данные задания](media/automation-first-runbook-graphical/runbook-job-AllLogs.png)
10.	Закройте колонки "Все журналы" и "Задания", чтобы вернуться к колонке MyFirstRunbook.
11.	Щелкните **Задания**, чтобы открыть колонку "Задания" для нашего модуля. Откроется список всех заданий, созданных этим модулем Runbook. В нем должно быть только одно задание, так как мы запускали задание только один раз.<br> ![Задания](media/automation-first-runbook-graphical/runbook-control-jobs.png)
12.	Если щелкнуть это задание, откроется та же область заданий, которую мы видели при запуске модуля Runbook. С ее помощью можно вернуться назад и просмотреть сведения о любом задании, созданном для конкретного модуля Runbook.

## Шаг 5. Создание ресурсов для переменных

Мы протестировали и опубликовали свой модуль Runbook, но пока он не выполняет никаких полезных действий. Нам нужно, чтобы он управлял ресурсами Azure. Перед тем, как настроить проверку подлинности, мы создадим переменную и сохраним в ней идентификатор подписки. На эту переменную мы будем ссылаться при настройке действия для проверки подлинности (см. шаг 6). Прежде чем продолжить, скопируйте идентификатор подписки из элемента "Подписки" на панели навигации.

1. В колонке "Учетные записи автоматизации" щелкните плитку **Ресурсы**. Откроется колонка **Ресурсы**.
2. В колонке "Ресурсы" щелкните плитку **Переменные**.
3. В колонке "Переменные" нажмите кнопку **Добавить переменную**.<br>![Переменная службы автоматизации](media/automation-first-runbook-graphical/create-new-subscriptionid-variable.png)
4. В колонке "Создание переменной" введите в поле **Имя** значение **AzureSubscriptionId**, а в поле **Значение** — свой идентификатор подписки. Оставьте значение *Строка* для поля **Тип**, а также значение по умолчанию для поля **Шифрование**.  
5. Щелкните **Создать**, чтобы создать переменную.  


## Шаг 6. Добавление проверки подлинности для управления ресурсами Azure

Теперь у нас есть переменная, которая содержит идентификатор подписки. Мы можем настроить свой модуль Runbook выполнять проверку подлинности с использованием этого идентификатора и учетных данных, которые указаны в разделе [Предварительные требования](#prerequisites). Для этого мы добавим командлет **Add-AzureRMAccount**. Но сначала нам нужно создать в модуле Runbook входной параметр для учетных данных, так как мы не можем получить их напрямую из параметра **Credential** командлета **Add-AzureRMAccount**.

1.	Откройте графический редактор, щелкнув **Изменить** в колонке MyFirstRunbook.<br> ![Изменить Runbook](media/automation-first-runbook-graphical/runbook-controls-edit.png)
2.	Название **Вывод текста "Привет, мир!"** нам больше не нужно, поэтому щелкните его правой кнопкой мыши и выберите команду **Удалить**.
3.	Щелкните **Ввод и вывод**, а затем — **Добавить входные данные**, чтобы открыть колонку входных параметров для модуля Runbook.<br> ![Входные и выходные данные Runbook](media/automation-first-runbook-graphical/runbook-toolbar-InputandOutput.png)
4.	Укажите значение *AzureCredentialAssetName* в поле **Имя**. Сохраните значение *Строка* для поля **Тип**, а в поле **Настраиваемое значение по умолчанию** введите свои учетные данные для службы автоматизации Azure. Нажмите кнопку **ОК**.
5.	В элементе управления "Библиотека" разверните элемент **Ресурсы**, затем **Переменные**, и добавьте **AzureSubscriptionId** на холст, выбрав **Добавить переменную Get на холст**.
6.	На холсте выберите **Get-AutomationVariable**. На панели управления конфигурацией в текстовое поле **Метка** введите текст **Get Subscription ID**.  
7.	В элементе управления "Библиотека" введите в поле поиска текст **Get-AutomationPS**.
8.	Добавьте **Get-AutomationPSCredential** на холст.<br>![Поиск командлета Get-AutomationPSCred](media/automation-first-runbook-graphical/search-get-automationpscredential-cmdlet.png)
9.	На холсте выберите **Get-AutomationPSCredential**. На панели управления конфигурацией в текстовое поле **Метка** введите текст **Get Azure Credential**.
10.	Щелкните **Параметры**, чтобы открыть колонку конфигурации параметров действия. 
11. В этой колонке щелкните **Имя**. Откроется колонка значения параметра.  
12.	 В этой колонке выберите **Входные данные Runbook** для параметра **Источник данных**, а затем в списке выберите **AzureCredentialAssetName** и дважды нажмите кнопку **ОК**.   
13.	Наведите указатель мыши на элемент **Get Subscription Id**, чтобы в нижней части элемента появился кружок. Щелкните этот кружок и перетащите стрелку к элементу **Get Azure Credential**. Стрелка, которую вы только что создали, является *связью*. При запуске этот модуль Runbook выполнит действие **Get Subscription ID**, а затем **Get Azure Credential**.<br> ![Создание связи между действиями](media/automation-first-runbook-graphical/runbook-link-getsubscription-getcredential.png)
14.	В элементе управления "Библиотека" введите в поле поиска текст **Add-AzureRm**.
15. Добавьте на холст командлет **Add-AzureRmAccount**.<br> ![Add-AzureRMAccount](media/automation-first-runbook-graphical/search-powershell-cmdlet-addazurermaccount.png)
16.	Наведите указатель мыши на элемент **Get Azure Credential**, чтобы в нижней части элемента появился кружок. Щелкните этот кружок и перетащите стрелку к элементу **Add-AzureRmAccount**.
17.	Выберите командлет **Add-AzureRmAccount** и щелкните **Parameter** в области управления конфигурацией.
18.	У командлета **Add-AzureRmAccount** есть несколько наборов параметров; вам нужно выбрать один из них, прежде чем вводить значения параметров. Щелкните **Набор параметров** и выберите набор параметров **SubscriptionId**.
19.	Параметры из выбранного набора появятся в колонке конфигурации параметров действия. Щелкните **Учетные данные**.<br> ![Добавление параметров учетной записи Azure RM](media/automation-first-runbook-graphical/add-azurermaccount-parameters.png)
20.	В колонке значения параметра выберите **Выходные данные действия** для параметра **Источник данных**, а затем в списке выберите **Get Azure Credential** и нажмите кнопку **ОК**.   
21.	Щелкните **SubscriptionId** и в колонке значения параметра выберите в списке **Get Subscription ID**. Затем два раза нажмите кнопку **ОК**, чтобы вернуться на холст.
22.	В области управления конфигурацией введите **Connect to Azure** в текстовое поле **Метка**.

Теперь ваш модуль Runbook должен выглядеть примерно так: <br>![Настройка проверки подлинности Runbook](media/automation-first-runbook-graphical/runbook-authentication-config.png)

## Шаг 7. Добавление действия для запуска виртуальной машины

Теперь мы добавим действие **Start-AzureRmVM** для запуска виртуальной машины. Вы можете выбрать любую виртуальную машину в своей подписке Azure. Имя этой машины будет прописано в коде командлета.

1. В элементе управления "Библиотека" введите в поле поиска текст **Start-AzureRm**.
2. Добавьте на холст **Start-AzureRmVM**, а затем перетащите его под элемент **Connect to Azure**.
3. Наведите указатель мыши на элемент **Connect to Azure**, чтобы в нижней части элемента появился кружок. Щелкните этот кружок и перетащите стрелку к элементу**Start-AzureRmVM**. 
4.	Выберите **Start-AzureRmVM**. Щелкните **Параметры**, а затем **Набор параметров**, чтобы просмотреть наборы параметров для командлета **Start-AzureRmVM**. Выберите набор параметров **ResourceGroupNameParameterSetName**. Обратите внимание, что рядом с параметрами **ResourceGroupName** и **Name** есть восклицательные знаки. Это означает, что данные параметры являются обязательными. Также оба параметра ожидают ввода строковых значений.
5.	Выберите параметр **Имя**. Выберите **Выражение PowerShell** для параметра **Источник данных** и введите имя виртуальной машины (в двойных кавычках), которую следует запускать с этим Runbook. Нажмите кнопку **ОК**.<br>![Значение параметра имени для Start-AzureRmVM](media/automation-first-runbook-graphical/runbook-startvm-nameparameter.png)
6.	Выберите **ResourceGroupName**. Укажите значение **Выражение PowerShell** для параметра **Источник данных** и введите имя группы ресурсов, заключенное в двойные кавычки. Нажмите кнопку **ОК**.<br> ![Параметры Start-AzureRmVM](media/automation-first-runbook-graphical/startazurermvm-params.png)
8.	Щелкните область тестирования, чтобы проверить модуль Runbook.
9.	Щелкните **Пуск**, чтобы начать тестирование. После завершения теста проверьте, запущена ли виртуальная машина.

Теперь ваш модуль Runbook должен выглядеть примерно так: <br>![Настройка проверки подлинности Runbook](media/automation-first-runbook-graphical/runbook-startazurermvm.png)

## Шаг 8. Добавление дополнительных входных параметров в Runbook

Сейчас наш модуль Runbook запускает виртуальную машину, указанную в командлете **Start-AzureRmVM**. Но будет удобнее, если мы сможем выбирать нужную виртуальную машину при запуске Runbook. Для этого добавим в модуль Runbook входные параметры.

1. Откройте графический редактор, щелкнув **Изменить** в области **MyFirstRunbook**.
2. Щелкните **Ввод и вывод**, а затем **Добавить входные данные**, чтобы открыть область входных параметров для модуля Runbook.<br>![Входные и выходные данные Runbook](media/automation-first-runbook-graphical/runbook-toolbar-InputandOutput.png)
3. Укажите для параметра **Имя** значение *ИмяВМ*. Для параметра **Тип** оставьте значение *Строка*, но для параметра **Обязательный** выберите значение *Да*. Нажмите кнопку **ОК**.
4. Создайте второй обязательный входной параметр с именем *ResourceGroupName* и нажмите кнопку **ОК**, чтобы закрыть панель **Ввод и вывод**.<br> ![Входные параметры Runbook](media/automation-first-runbook-graphical/start-azurermvm-params-outputs.png)
5. Выберите действие **Start-AzureRmVM** и щелкните **Параметры**.
6. В поле **Источник данных** для параметра **Имя** выберите вариант **Входные данные Runbook**, а затем выберите **VMName**.<br>
7. В поле **Источник данных** для параметра **ResourceGroupName** выберите вариант **Входные данные Runbook**, а затем выберите **ResourceGroupName**.<br> ![Параметры командлета Start-AzureVM](media/automation-first-runbook-graphical/start-azurermvm-params-runbookinput.png)
8. Сохраните модуль Runbook и откройте область тестирования. Обратите внимание, что теперь значения двух входных переменных, которые будут использоваться в тесте, можно указать.
9. Закройте область тестирования.
10.	Щелкните **Опубликовать**, чтобы опубликовать новую версию модуля Runbook.
11.	Остановите виртуальную машину, запущенную на предыдущем этапе.
12.	Щелкните **Пуск**, чтобы запустить модуль Runbook. Введите **VMName** и **ResourceGroupName** для виртуальной машины, которую нужно запустить.<br> ![Запуск модуля Runbook](media/automation-first-runbook-graphical/runbook-start-inputparams.png)
13.	Когда модуль Runbook будет выполнен, проверьте, запустилась ли виртуальная машина.

## Шаг 9. Создание условной связи

Теперь мы изменим модуль Runbook, чтобы он запускал виртуальную машину только в том случае, если она еще не запущена. Для этого добавим в Runbook командлет **Get-AzureRmVM**, который получает текущее состояние виртуальной машины. Затем мы добавим модуль с именем **Get Status** для рабочего процесса PowerShell. Фрагмент кода PowerShell в этом модуле будет определять состояние виртуальной машины (запущена или остановлена). Условная связь между модулем **Get Status** и действием **Start-AzureVM** позволит запускать действие, только если виртуальная машина остановлена. И еще мы выведем сообщение с информацией о том, удалось ли командлету PowerShell Write-Output запустить виртуальную машину.

1. Откройте **MyFirstRunbook** в графическом редакторе.
2. Удалите связь между элементами **Add-AzureAccount** и **Start-AzureVM**. Для этого щелкните ее и нажмите *клавишу DELETE*.
3. В элементе управления "Библиотека" введите в поле поиска текст **Get-AzureRm**.
4. Добавьте на холст командлет **Get-AzureRmVM**.
5. Выберите элемент **Get-AzureRmVM**, а затем **Набор параметров**, чтобы просмотреть наборы параметров для командлета **Get-AzureRmVM**. Выберите набор параметров **GetVirtualMachineInResourceGroupNameParamSet**. Обратите внимание, что рядом с параметрами **ResourceGroupName** и **Name** есть восклицательные знаки. Это означает, что данные параметры являются обязательными. Также оба параметра ожидают ввода строковых значений.
6. В поле **Источник данных** для параметра **Name** выберите вариант **Входные данные Runbook**, а затем выберите **VMName**. Нажмите кнопку **ОК**.
7. В поле **Источник данных** для параметра **ResourceGroupName** выберите вариант **Входные данные Runbook**, а затем выберите **ResourceGroupName**. Нажмите кнопку **ОК**.
8. В поле **Источник данных** для параметра **Status** выберите значение **Константа**, а затем щелкните **True**. Нажмите кнопку **ОК**.  
9. Создайте связь, ведущую от элемента **Connect to Azure** к **Get-AzureRmVM**.
10. В элементе управления "Библиотека" разверните элемент **Runbook Control** и добавьте на холст элемент **Code**.  
11. Создайте связь, ведущую от командлета **Get-AzureRmVM** к элементу **Code**.  
12. Щелкните **Code** и в области конфигурации измените значение метки на **Get Status**.
13. Выберите параметр **Code**. Появится колонка **редактора кода**.  
14. В редакторе кода вставьте этот фрагмент кода:

     ```
     $StatusesJson = $ActivityOutput['Get-AzureRmVM'].StatusesText 
     $Statuses = ConvertFrom-Json $StatusesJson 
     $StatusOut ="" 
     foreach ($Status in $Statuses){ 
     if($Status.Code -eq "Powerstate/running"){$StatusOut = "running"} 
     elseif ($Status.Code -eq "Powerstate/deallocated") {$StatusOut = "stopped"} 
     } 
     $StatusOut 
     ```

16. Создайте связь, ведущую от элемента **Get Status** до **Start-AzureRmVM**.<br> ![Runbook с модулем кода](media/automation-first-runbook-graphical/runbook-startazurermvm-get-status.png)
17. Выберите эту связь и в области конфигурации измените значение параметра **Apply condition** на **Yes**. Обратите внимание, что связь станет пунктирной. Это означает, что целевое действие будет выполняться только при соблюдении условия.  
18. В поле **Выражение условия** введите *$ActivityOutput['Get Status'] -eq "Stopped"*. Теперь командлет **Start-AzureRmVM** будет выполняться, только если виртуальная машина остановлена.
19.	В элементе управления "Библиотека" разверните узел **Командлеты** и выберите **Microsoft.PowerShell.Utility**.
20.	Дважды добавьте командлет **Write-Output** на холст.<br> ![Runbook с командлетом Write-Output](media/automation-first-runbook-graphical/runbook-startazurermvm-final.png)
21. На первом экземпляре **Write-Output** щелкните **Параметры** и измените **метку**, указав значение *Notify VM Started*.
22. Для параметра **InputObject** измените значение в поле **Источник данных** на **Выражение PowerShell** и введите выражение *"$VMName successfully started."*.
23. На втором экземпляре **Write-Output** щелкните **Параметры** и измените **метку**, указав значение *Notify VM Start Failed*.
24. Для параметра **InputObject** измените значение в поле **Источник данных** на **Выражение PowerShell** и введите выражение *"$VMName could not start."*.
25. Создайте связь, ведущую от **Start-AzureRmVM** к элементу **Notify VM Started**, и еще одну, ведущую к элементу **Notify VM Start Failed**.
26. Выберите ту связь, которая ведет к элементу **Notify VM Started**, и укажите для параметра **Применять условие** значение **True**.
27. В поле **Выражение условия** введите *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -eq $true*. Теперь этот элемент управления Write-Output будет выполняться только тогда, когда успешно запустится виртуальная машина.
28. Выберите ту связь, которая ведет к элементу **Notify VM Start Failed**, и укажите для параметра **Применять условие** значение **True**.
29. В поле **Выражение условия** введите *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -ne $true*. Теперь этот элемент управления Write-Output будет выполняться только тогда, когда виртуальная машина не сможет запуститься.
30.	Сохраните модуль Runbook и откройте область тестирования.
31.	Запустите модуль Runbook при остановленной виртуальной машине; модуль должен запуститься.

## Дальнейшие действия

-	Дополнительные сведения о графической разработке см. в статье [Графическая разработка в службе автоматизации Azure](automation-graphical-authoring-intro.md).
-	Подробные сведения о том, как начать работу с модулями Runbook рабочих процессов PowerShell, см. в статье [Мой первый модуль Runbook PowerShell](automation-first-runbook-textual.md).
-	Подробные сведения о том, как начать работу с модулями Runbook рабочих процессов PowerShell, см. в статье [Мой первый модуль Runbook PowerShell](automation-first-runbook-textual-PowerShell.md).

<!---HONumber=AcomDC_0427_2016-->