---
title: "Создание графического модуля Runbook в службе автоматизации Azure | Документация Майкрософт"
description: "Учебник, в котором описывается создание, тестирование и публикация простого графического модуля Runbook."
services: automation
documentationcenter: 
author: georgewallace
manager: jwhit
editor: 
keywords: "Runbook, шаблон Runbook, служба автоматизации Runbook и Azure Runbook"
ms.assetid: dcb88f19-ed2b-4372-9724-6625cd287c8a
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 05/17/2017
ms.author: magoedte;bwren
ms.openlocfilehash: ab4ca2bf37e30bff66de7acc3932e3cb89b6e93b
ms.sourcegitcommit: fa28ca091317eba4e55cef17766e72475bdd4c96
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2017
---
# <a name="my-first-graphical-runbook"></a>Первый графический Runbook

> [!div class="op_single_selector"]
> * [Графический](automation-first-runbook-graphical.md)
> * [PowerShell](automation-first-runbook-textual-powershell.md)
> * [Рабочий процесс PowerShell](automation-first-runbook-textual.md)
> * [Python](automation-first-runbook-textual-python2.md)
> 

В данном учебнике описана процедура создания [графического модуля Runbook](automation-runbook-types.md#graphical-runbooks) в службе автоматизации Azure. Сначала вы протестируете и опубликуете простой модуль runbook и узнаете, как отслеживать состояние его заданий. Затем мы изменим модуль runbook, настроив его для фактического управления ресурсами Azure (в нашем примере это запуск виртуальной машины Azure). Затем вы завершите работу с руководством, повысив надежность модуля runbook, а также добавив параметры и условные связи.

## <a name="prerequisites"></a>Предварительные требования
Для работы с этим учебником требуется:

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](automation-offering-get-started.md) , чтобы хранить модуль Runbook и выполнять проверку подлинности ресурсов Azure. Эта учетная запись должна иметь разрешение на запуск и остановку виртуальной машины.
* Виртуальная машина Azure. Это не должна быть рабочая виртуальная машина, так как в процессе изучения этого руководства ее нужно будет остановить и запустить заново.

## <a name="step-1---create-runbook"></a>Шаг 1. Создание нового модуля Runbook
Для начала вы создадите простой модуль runbook, при помощи которого на экран выводится текст *Hello World*.

1. На портале Azure выберите свою учетную запись службы автоматизации.

   Страница учетной записи в службе автоматизации позволяет быстро получить представление о ресурсах, доступных в этой учетной записи. Некоторые ресурсы уже должны быть доступны. Большинство из них — это модули, которые добавляются в каждую новую учетную запись службы автоматизации по умолчанию. Кроме того, вам потребуется ресурс учетных данных, упомянутый в [предварительных требованиях](#prerequisites).

2. В разделе **Управление процессами** выберите **Модули Runbook**, чтобы открыть список модулей.
3. Создайте новый модуль Runbook. Для этого нажмите кнопку **Add a runbook** (Добавить модуль Runbook), а затем выберите **Создать новый Runbook**.
4. Присвойте модулю Runbook имя *MyFirstRunbook-Graphical*.
5. В этом примере создается [графический модуль runbook](automation-graphical-authoring-intro.md), поэтому в поле **	Тип Runbook** выберите значение **Графический**.<br> ![Новый Runbook](media/automation-first-runbook-graphical/create-new-runbook.png)<br>
6. Щелкните **Создать** , чтобы создать модуль Runbook и открыть графический редактор.

## <a name="step-2---add-activities-to-the-runbook"></a>Шаг 2. Добавление действий в модуль Runbook
Элемент управления "Библиотека" в левой части редактора позволяет добавлять действия в модуль Runbook. Добавьте командлет **Write-Output** для вывода текста при помощи модуля runbook.

1. В элементе управления "Библиотека" щелкните текстовое поле поиска и введите **Write-Output**. На следующем изображении показаны результаты поиска: <br> ![Microsoft.PowerShell.Utility](media/automation-first-runbook-graphical/search-powershell-cmdlet-writeoutput.png)
2. Прокрутите список до конца. Щелкните правой кнопкой мыши **Write-Output** и выберите пункт **Добавить на холст** или же щелкните значок многоточия рядом с командлетом и выберите пункт **Добавить на холст**.
3. Щелкните **Write-Output** на холсте. Откроется колонка управления конфигурацией, где можно настроить выбранное действие.
4. В поле **Метка** по умолчанию указывается имя командлета, но можно указать и более понятное название. Введите в это поле значение *Вывод текста "Привет, мир!"*.
5. Щелкните **Параметры**, чтобы указать значения параметров командлета.

   Некоторые командлеты имеют несколько наборов параметров, и вам нужно выбрать, какой из них будет использоваться. В этом случае командлет **Write-Output** имеет только один набор параметров, поэтому выбор делать не нужно. <br> ![Свойства командлета Write-Output](media/automation-first-runbook-graphical/write-output-properties-b.png)

6. Выберите параметр **InputObject** . В этом параметре вы зададите текст для отправки в поток вывода.
7. В раскрывающемся списке **Источник данных** выберите **PowerShell expression** (Выражение PowerShell). Раскрывающийся список **Источник данных** содержит разные источники, которые можно использовать для заполнения значения параметра.

   Можно использовать выходные данные из таких источников, как другое действие, ресурс автоматизации или выражение PowerShell. В нашем случае нужно вывести только текст *Hello World*. Для этого воспользуйтесь выражением PowerShell и укажите строку.

8. В поле **Выражение** введите *Привет, мир* и дважды нажмите кнопку **ОК**, чтобы вернуться к холсту.<br> ![PowerShell Expression](media/automation-first-runbook-graphical/expression-hello-world.png)
9. Сохраните модуль Runbook, щелкнув **Сохранить**.<br> ![Сохранить Runbook](media/automation-first-runbook-graphical/runbook-toolbar-save-revised20165.png)

## <a name="step-3---test-the-runbook"></a>Шаг 3. Тестирование модуля Runbook
Прежде чем опубликовать модуль runbook и, таким образом, сделать его доступным для рабочей среды, необходимо проверить, правильно ли он работает. Чтобы протестировать модуль Runbook, нужно запустить его **черновую** версию и проверить его работу в интерактивном режиме.

1. Щелкните **Test pane** (Тестовая область), чтобы открыть колонку "Тестирование".<br> ![Область тестирования](media/automation-first-runbook-graphical/runbook-toolbar-test-revised20165.png)
2. Щелкните **Пуск** , чтобы начать тестирование. Активным должен быть только этот параметр.
3. При этом создается объект [Задание Runbook](automation-runbook-execution.md) , а его состояние отображается на панели.

   Сначала задание получает состояние *В очереди*, которое означает, что задание стало доступно рабочей роли runbook в облаке. Как только рабочая роль затребует задание, оно получит состояние *Запущено*, а с началом фактического выполнения модуля Runbook — состояние *Выполняется*.

4. Когда задание модуля Runbook будет выполнено, на экране появится результат. В этом случае вы увидите текст *Hello World*.<br> ![Привет, мир!](media/automation-first-runbook-graphical/runbook-test-results.png)
5. Закройте колонку "Тест", чтобы вернуться на холст.

## <a name="step-4---publish-and-start-the-runbook"></a>Шаг 4. Публикация и запуск модуля Runbook
Модуль runbook, который вы только что создали, все еще находится в режиме черновика. Прежде чем запустить модуль в рабочей среде, его нужно опубликовать. При публикации модуля Runbook существующая опубликованная версия перезаписывается черновой версией. В нашем случае опубликованной версии не существует, поскольку модуль runbook создан только что.

1. Щелкните **Опубликовать**, чтобы опубликовать модуль Runbook, а затем нажмите кнопку **Да** в появившемся запросе.<br> ![Опубликовать](media/automation-first-runbook-graphical/runbook-toolbar-publish-revised20166.png)
2. Прокрутите экран влево. В колонке **Модули Runbook** для параметра **Состояние создания** модуля должно отображаться значение **Опубликовано**.
3. Прокрутите экран вправо до колонки **MyFirstRunbook**.

   Параметры в верхней части экрана позволяют запустить модуль Runbook, запланировать его запуск в определенное время или создать [Webhook](automation-webhooks.md) , чтобы модуль можно было запускать с помощью HTTP-вызова.

4. Чтобы запустить модуль runbook, щелкните **Запуск** и нажмите кнопку **Да** в появившемся запросе.<br> ![Запуск модуля Runbook](media/automation-first-runbook-graphical/runbook-controls-start-revised20165.png)
5. Откроется колонка заданий с созданным заданием runbook. Убедитесь, что для **состояния задания** отображается значение **Завершено**.
7. Как только состояние модуля Runbook изменится на *Выполнено*, щелкните **Выходные данные**. Откроется колонка **Выходные данные** с текстом *Hello World*.
8. Закройте колонку выходных данных.
9. Щелкните **Все журналы** , чтобы открыть колонку "Потоки" для задания Runbook. В потоке вывода должен отображаться только текст *Hello World*, но могут присутствовать и другие потоки заданий runbook, например "Подробные сведения" и "Ошибка", если модуль записывает в них какие-то данные.
10. Закройте колонки "Все журналы" и "Задания", чтобы вернуться к колонке MyFirstRunbook.
11. Чтобы просмотреть все задания для модуля runbook, закройте колонку **Задание** и выберите **Задания** в разделе **Ресурсы**. Откроется список всех заданий, созданных этим модулем Runbook. В нем должно быть только одно задание, так как вы запустили задание только один раз.
12. Если щелкнуть это задание, откроется та же область заданий, что и при запуске модуля runbook. С ее помощью можно вернуться назад и просмотреть сведения о любом задании, созданном для конкретного модуля Runbook.

## <a name="step-5---create-variable-assets"></a>Шаг 5. Создание ресурсов для переменных
Вы протестировали и опубликовали свой модуль runbook, но пока он не выполняет никаких полезных действий. Нужно, чтобы он управлял ресурсами Azure. Перед тем как настроить аутентификацию модуля runbook, нужно создать переменную и сохранить в ней идентификатор подписки. На эту переменную вы будете ссылаться при настройке действия для аутентификации (см. шаг 6). Добавив ссылку в контекст подписки, вы сможете легко работать с несколькими подписками. Прежде чем продолжить, скопируйте идентификатор подписки из элемента "Подписки" в области навигации.

1. В колонке "Учетные записи службы автоматизации" выберите **Переменные** в разделе **Общие ресурсы**.
2. Щелкните **Добавить переменную**.<br>![Переменная службы автоматизации](media/automation-first-runbook-graphical/create-new-subscriptionid-variable.png)
4. В колонке "Создание переменной" введите в поле **Имя** значение **AzureSubscriptionId**, а в поле **Значение** — свой идентификатор подписки. Для параметра **Тип** укажите значение *Строка*, а для параметра **Шифрование** используйте значение по умолчанию.  
5. Щелкните **Создать** , чтобы создать переменную.  

## <a name="step-6---add-authentication-to-manage-azure-resources"></a>Шаг 6. Добавление проверки подлинности для управления ресурсами Azure
Теперь, когда у вас есть переменная с идентификатором подписки, можно настроить модуль runbook для выполнения аутентификации. Для этого используйте учетные данные запуска от имени, которые указаны в разделе [Предварительные требования](#prerequisites). Добавьте на холст командлет **Add-AzureRMAccount** и **ресурс** подключения учетной записи запуска от имени Azure.  

1. Вернитесь к модулю runbook и выберите **Изменить** в колонке MyFirstRunbook.<br> ![Изменить Runbook](media/automation-first-runbook-graphical/runbook-controls-edit-revised20165.png)
2. Так как название **Write Hello World to output** (Вывод текста Hello World) больше не нужно, щелкните значок многоточия и выберите **Удалить**.
3. В элементе управления "Библиотека" разверните узлы **Ресурсы** и **Подключения**, а затем добавьте на холст элемент **AzureRunAsConnection**. Для этого выберите **Добавить на холст**.
5. В элементе управления "Библиотека" в поле поиска введите текст **Add-AzureRmAccount** .
6. Добавьте на холст командлет **Добавьте на холст командлет-AzureRmAccount** .<br> ![ресурс](media/automation-first-runbook-graphical/search-powershell-cmdlet-addazurermaccount.png)
7. Наведите указатель мыши на элемент **Get Run As Connection** (Получить подключение запуска от имени), чтобы в нижней части элемента появился кружок. Щелкните этот кружок и перетащите стрелку к элементу **Add-AzureRmAccount**. Созданная стрелка является *связью*. При запуске этот модуль Runbook выполнит действие **Get Run As Connection** (Получить подключение запуска от имени), а затем — командлет **Add-AzureRmAccount**.<br> ![Создание связи между действиями](media/automation-first-runbook-graphical/runbook-link-auth-activities.png)
8. На холсте выберите элемент **Add-AzureRmAccount** и в области управления конфигурацией в текстовое поле **Метка** введите текст **Выполнить вход в Azure**.
9. Щелкните **Параметры** , чтобы открыть колонку "Конфигурация параметров действия".
10. Командлет **Add-AzureRmAccount** имеет несколько наборов параметров. Нужно выбрать один из них, прежде чем вводить значения параметров. Щелкните **Набор параметров** и выберите набор параметров **ServicePrincipalCertificate**.
11. Параметры из выбранного набора появятся в колонке конфигурации параметров действия. Щелкните **APPLICATIONID**.<br> ![Добавление параметров учетной записи Azure RM](media/automation-first-runbook-graphical/add-azurermaccount-params.png)
12. В колонке "Значение параметра" выберите для параметра **Источник данных** значение **Activity output** (Выходные данные действия), в списке выберите **Get Run As Connection** (Получить подключение запуска от имени), в текстовом поле **Field path** (Путь к полю) введите текст **ApplicationId**, а затем нажмите кнопку **OК**. Для элемента "Путь поля" определяется имя свойства, так как действие выводит объект с несколькими свойствами.
13. Щелкните **CERTIFICATETHUMBPRINT** и в колонке "Значение параметра" выберите для параметра **Источник данных** значение **Activity output** (Выходные данные действия). В списке выберите **Get Run As Connection** (Получить подключение запуска от имени), в текстовом поле **Field path** (Путь к полю) введите **CertificateThumbprint**, а затем нажмите кнопку **OК**.
14. Щелкните **SERVICEPRINCIPAL** и в колонке "Значение параметра" выберите для параметра **Источник данных** значение **ConstantValue**. Затем выберите значение **True** и нажмите кнопку **OК**.
15. Щелкните **TENANTID** и в колонке "Значение параметра" выберите для параметра **Источник данных** значение **Activity output** (Выходные данные действия). В списке выберите **Get Run As Connection** (Получить подключение запуска от имени), в текстовом поле **Field path** (Путь к полю) введите **TenantId**, а затем дважды нажмите кнопку **OК**.  
16. В элементе управления "Библиотека" введите в поле поиска текст **Set-AzureRmContext** .
17. Добавьте на холст командлет **Set-AzureRmContext** .
18. На холсте выберите **Set-AzureRmContext** и в области управления конфигурацией в текстовое поле **Метка** введите текст **Указать идентификатор подписки**.
19. Щелкните **Параметры** , чтобы открыть колонку "Конфигурация параметров действия".
20. Командлет **Set-AzureRmContext** имеет несколько наборов параметров. Нужно выбрать один из них, прежде чем вводить значения параметров. Щелкните **Набор параметров** и выберите набор параметров **SubscriptionId**.  
21. Параметры из выбранного набора появятся в колонке конфигурации параметров действия. Щелкните **SubscriptionID**
22. В колонке "Значение параметра" для параметра **Источник данных** выберите значение **Variable Asset** (Ресурс-контейнер переменной), а затем в списке выберите **AzureSubscriptionId** и дважды нажмите кнопку **OК**.   
23. Наведите указатель мыши на элемент **Login to Azure** (Выполнить вход в Azure), чтобы в нижней части элемента появился кружок. Щелкните этот кружок и перетащите стрелку к элементу **Specify Subscription Id**(Указать идентификатор подписки).

Теперь модуль Runbook должен выглядеть примерно так:  <br>![Настройка проверки подлинности Runbook](media/automation-first-runbook-graphical/runbook-auth-config.png)

## <a name="step-7---add-activity-to-start-a-virtual-machine"></a>Шаг 7. Добавление действия для запуска виртуальной машины
Теперь добавьте действие **Start-AzureRmVM** для запуска виртуальной машины. Вы можете выбрать любую виртуальную машину в своей подписке Azure. Имя этой машины будет прописано в коде командлета.

1. В элементе управления "Библиотека" введите в поле поиска текст **Start-AzureRm** .
2. Добавьте на холст командлет **Start-AzureRmVM**, а затем перетащите его под элемент **Specify Subscription Id** (Указать идентификатор подписки).
3. Наведите указатель мыши на элемент **Specify Subscription Id** (Указать идентификатор подписки), чтобы в нижней части элемента появился кружок. Щелкните этот кружок и перетащите стрелку к элементу **Start-AzureRmVM**.
4. Выберите **Start-AzureRmVM**. Щелкните **Параметры**, а затем выберите **Набор параметров**, чтобы просмотреть наборы параметров для командлета **Start-AzureRmVM**. Выберите набор параметров **ResourceGroupNameParameterSetName** . Рядом с параметрами **ResourceGroupName** и **Name** стоят восклицательные знаки. Это означает, что данные параметры являются обязательными. Также оба параметра ожидают ввода строковых значений.
5. Выберите параметр **Имя**. В поле **Источник данных** выберите **Выражение PowerShell** и введите имя виртуальной машины (в двойных кавычках), которую следует запускать при помощи этого модуля runbook. Нажмите кнопку **ОК**.<br>![Значение параметра имени для Start-AzureRmVM](media/automation-first-runbook-graphical/runbook-startvm-nameparameter.png)
6. Выберите **ResourceGroupName**. Укажите для параметра **Выражение PowerShell** в поле **Выходные данные действия** и введите имя группы ресурсов, заключенное в двойные кавычки. Нажмите кнопку **ОК**.<br> ![Параметры Start-AzureRmVM](media/automation-first-runbook-graphical/startazurermvm-params.png)
7. Щелкните область тестирования, чтобы проверить модуль runbook.
8. Щелкните **Пуск** , чтобы начать тестирование. После завершения теста проверьте, запущена ли виртуальная машина.

Теперь модуль Runbook должен выглядеть примерно так:  <br>![Настройка проверки подлинности Runbook](media/automation-first-runbook-graphical/runbook-startvm.png)

## <a name="step-8---add-additional-input-parameters-to-the-runbook"></a>Шаг 8. Добавление дополнительных входных параметров в Runbook
Сейчас модуль runbook запускает виртуальную машину в группе ресурсов, указанной в командлете **Start-AzureRmVM**. Модуль runbook был бы полезнее, если бы при его запуске мы могли указать оба значения. Для этого добавьте в модуль runbook входные параметры.

1. Откройте графический редактор, щелкнув **Изменить** в области **MyFirstRunbook**.
2. Щелкните **Входные и выходные данные**, а затем выберите **Добавить входные данные**, чтобы открыть область входных параметров для модуля Runbook.<br> ![Входные и выходные данные Runbook](media/automation-first-runbook-graphical/runbook-toolbar-InputandOutput-revised20165.png)
3. Укажите для параметра *Имя* значение **ИмяВМ**. Для параметра **Тип** оставьте значение *Строка*, но для параметра **Обязательный** выберите значение *Да*. Нажмите кнопку **ОК**.
4. Создайте второй обязательный входной параметр с именем *ResourceGroupName* и нажмите кнопку **ОК**, чтобы закрыть область **Входные и выходные данные**.<br> ![Входные параметры Runbook](media/automation-first-runbook-graphical/start-azurermvm-params-outputs.png)
5. Выберите действие **Start-AzureRmVM** и щелкните **Параметры**.
6. В поле **Источник данных** для параметра **Имя** задайте значение **Runbook input** (Входные данные Runbook), а затем выберите **VMName**.<br>
7. В поле **Источник данных** для параметра **ResourceGroupName** задайте значение **Runbook input** (Входные данные Runbook), а затем выберите **ResourceGroupName**.<br> ![Параметры командлета Start-AzureVM](media/automation-first-runbook-graphical/start-azurermvm-params-runbookinput.png)
8. Сохраните модуль Runbook и откройте область тестирования. Теперь вы можете указать значения двух входных переменных, которые будут использоваться в тесте.
9. Закройте область тестирования.
10. Щелкните **Опубликовать** , чтобы опубликовать новую версию модуля Runbook.
11. Остановите виртуальную машину, запущенную на предыдущем этапе.
12. Щелкните **Пуск** , чтобы запустить модуль Runbook. Введите значения **VMName** и **ResourceGroupName** для виртуальной машины, которую нужно запустить.<br> ![Start Runbook](media/automation-first-runbook-graphical/runbook-start-inputparams.png)
13. Когда модуль Runbook будет выполнен, проверьте, запустилась ли виртуальная машина.

## <a name="step-9---create-a-conditional-link"></a>Шаг 9. Создание условной связи
Теперь измените модуль runbook, чтобы он запускал виртуальную машину только в том случае, если она еще не запущена. Для этого добавьте в Runbook командлет **Get-AzureRmVM**, который получает текущее состояние виртуальной машины. Затем добавьте модуль кода с именем **Get Status** для рабочего процесса PowerShell. Фрагмент кода PowerShell в этом модуле будет определять состояние виртуальной машины (запущена или остановлена). Условная связь между модулем **Get Status** и действием **Start-AzureRmVM** позволит запускать действие, только если виртуальная машина остановлена. Также выведите сообщение с информацией о том, удалось ли командлету PowerShell Write-Output запустить виртуальную машину.

1. Откройте **MyFirstRunbook** в графическом редакторе.
2. Удалите связь между элементами **Specify Subscription Id** (Указать идентификатор подписки) и **Start-AzureRmVM**. Для этого щелкните ее и нажмите клавишу *Delete*.
3. В элементе управления "Библиотека" введите в поле поиска текст **Get-AzureRm** .
4. Добавьте на холст командлет **Get-AzureRmVM** .
5. Выберите **Get-AzureRmVM**, а затем — **Набор параметров**, чтобы просмотреть наборы параметров для командлета **Get-AzureRmVM**. Выберите набор параметров **GetVirtualMachineInResourceGroupNameParamSet** . Рядом с параметрами **ResourceGroupName** и **Name** стоят восклицательные знаки. Это означает, что данные параметры являются обязательными. Также оба параметра ожидают ввода строковых значений.
6. В поле **Источник данных** для параметра **Имя** укажите значение **Runbook input** (Входные данные Runbook), а затем выберите **VMName**. Нажмите кнопку **ОК**.
7. В поле **Источник данных** для параметра **ResourceGroupName** укажите значение **Runbook input** (Входные данные Runbook), а затем выберите **ResourceGroupName**. Нажмите кнопку **ОК**.
8. В поле **Источник данных** для параметра **Состояние** выберите **Значение-константа**, а затем щелкните **True**. Нажмите кнопку **ОК**.
9. Создайте связь, ведущую от элемента **Specify Subscription Id** (Указать идентификатор подписки) к **Get-AzureRmVM**.
10. В элементе управления "Библиотека" разверните элемент **Управление Runbook** и добавьте на холст элемент **Код**.  
11. Создайте связь, ведущую от командлета **Get-AzureRmVM** к элементу **Код**.  
12. Щелкните **Код** и в области конфигурации измените значение метки на **Get Status** (Получить состояние).
13. Выберите параметр **Код**. Появится колонка **Редактор кода**.  
14. В редакторе кода вставьте этот фрагмент кода:
    
     ```powershell
     $StatusesJson = $ActivityOutput['Get-AzureRmVM'].StatusesText
     $Statuses = ConvertFrom-Json $StatusesJson
     $StatusOut =""
     foreach ($Status in $Statuses){
     if($Status.Code -eq "Powerstate/running"){$StatusOut = "running"}
     elseif ($Status.Code -eq "Powerstate/deallocated") {$StatusOut = "stopped"}
     }
     $StatusOut
     ```
15. Создайте связь, ведущую от элемента **Get Status** (Получить состояние) к **Start-AzureRmVM**.<br> ![Runbook с модулем кода](media/automation-first-runbook-graphical/runbook-startvm-get-status.png)  
16. Выберите эту связь и в области конфигурации измените значение параметра **Apply condition** (Применить условие) на **Да**. Обратите внимание, что связь станет пунктирной. Это означает, что целевое действие будет выполняться только при соблюдении условия.  
17. В поле **Выражение условия**введите *$ActivityOutput['Get Status'] -eq "Stopped"*. **Start-AzureRmVM** выполняется, только если виртуальная машина остановлена.
18. В элементе управления "Библиотека" разверните узел **Командлеты** и выберите **Microsoft.PowerShell.Utility**.
19. Дважды добавьте командлет **Write-Output** на холст.<br> ![Runbook с командлетом Write-Output](media/automation-first-runbook-graphical/runbook-startazurermvm-complete.png)
20. В первом элементе управления **Write-Output** щелкните **Параметры** и укажите для параметра **Метка** значение *Notify VM Started* (Сообщить о запуске виртуальной машины).
21. Для параметра **InputObject** измените значение в поле **Источник данных** на **PowerShell expression** (Выражение PowerShell) и введите выражение *$VMName successfully started*.
22. Во втором элементе управления **Write-Output** щелкните **Параметры** и укажите для параметра **Метка** значение *Notify VM Start Failed* (Сообщить о сбое при запуске виртуальной машины).
23. Для параметра **InputObject** измените значение в поле **Источник данных** на **PowerShell expression** (Выражение PowerShell) и введите выражение *$VMName could not start*.
24. Создайте связь, ведущую от **Start-AzureRmVM** к элементу **Notify VM Started** (Сообщить о запуске виртуальной машины), и еще одну, ведущую к элементу **Notify VM Start Failed** (Сообщить о сбое при запуске виртуальной машины).
25. Выберите связь, ведущую к элементу **Notify VM Started** (Сообщить о запуске виртуальной машины), и укажите для параметра**Apply condition** (Применить условие) значение **True**.
26. В поле **Выражение условия**введите *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -eq $true*. Теперь этот элемент управления Write-Output выполняется только тогда, когда успешно запустится виртуальная машина.
27. Выберите связь, ведущую к элементу **Notify VM Start Failed** (Сообщить о сбое при запуске виртуальной машины), и укажите для параметра **Apply condition** (Применить условие) значение **True**.
28. В поле **Выражение условия**введите *$ActivityOutput['Start-AzureRmVM'].IsSuccessStatusCode -ne $true*. Теперь этот элемент управления Write-Output будет выполняться только тогда, когда виртуальная машина не сможет запуститься.
29. Сохраните модуль Runbook и откройте область тестирования.
30. Запустите модуль Runbook при остановленной виртуальной машине; модуль должен запуститься.

## <a name="next-steps"></a>Дальнейшие действия
* Дополнительные сведения о графической разработке см. в статье [Графическая разработка в службе автоматизации Azure](automation-graphical-authoring-intro.md).
* Сведения о том, как начать работу с модулями Runbook, см. в статье [Мой первый модуль Runbook PowerShell](automation-first-runbook-textual-powershell.md).
* Чтобы приступить к работе с модулями Runbook рабочих процессов PowerShell, обратитесь к статье [Мой первый модуль Runbook рабочего процесса PowerShell](automation-first-runbook-textual.md)

