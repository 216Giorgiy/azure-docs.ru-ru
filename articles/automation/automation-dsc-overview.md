---
title: "Обзор Azure Automation DSC | Документация Майкрософт"
description: "Обзор DSC службы автоматизации Azure, условий использования и известных проблем"
services: automation
documentationcenter: dev-center-name
author: eslesar
manager: carmonm
keywords: "PowerShell DSC, настройка требуемого состояния, PowerShell DSC для Azure"
ms.assetid: fd40cb68-c1a6-48c3-bba2-710b607d1555
ms.service: automation
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: powershell
ms.workload: TBD
ms.date: 02/02/2017
ms.author: magoedte;eslesar
translationtype: Human Translation
ms.sourcegitcommit: f0d3a5c1929bb6dafef735ae3f4291e329861cc9
ms.openlocfilehash: b750878703baf143a2e8247bdd01f358e462e598

---
# <a name="azure-automation-dsc-overview"></a>Обзор DSC службы автоматизации Azure

## <a name="what-is-azure-automation-dsc"></a>Что такое DSC службы автоматизации Azure?

Развертывание серверов и ресурсов приложения в требуемом состоянии, а также поддержание этого состояния может занять много времени и сопровождаться ошибками. С помощью DSC службы автоматизации Azure вы можете последовательно развернуть все ИТ-ресурсы в требуемом состоянии, безопасно осуществлять их мониторинг и автоматически обновлять в масштабе облака. Созданная на основе PowerShell DSC, Automation DSC позволяет развернуть конфигурацию желаемого состояния в физической или виртуальной машине под управлением Windows или Linux как в облачной, так и в локальной среде. При необходимости вы можете непрерывно предоставлять ИТ-услуги с согласованным контролем и быстрым управлением изменениями в разнородных гибридных ИТ-средах.

В основе DSC службы автоматизации Azure заложены основополагающие принципы, представленные в PowerShell DSC и призванные еще больше упростить управление конфигурацией. Azure Automation DSC обеспечивает тот же слой управления для [настройки требуемого состояния PowerShell](https://msdn.microsoft.com/powershell/dsc/overview) , что и служба автоматизации Azure сегодня предлагает для сценариев PowerShell.

Azure Automation DSC позволяет [создавать конфигурации требуемого состояния PowerShell и управлять ими](https://technet.microsoft.com/library/dn249918.aspx), импортировать [ресурсы DSC](https://technet.microsoft.com/library/dn282125.aspx) и создавать конфигурации узлов DSC (документы MOF), и все это в облаке. Эти элементы DSC размещаются на [опрашивающем сервере DSC](https://technet.microsoft.com/library/dn249913.aspx) службы автоматизации Azure, чтобы целевые узлы могли автоматически получать конфигурации, переходить в требуемое состояние и сообщать о готовности. Служба автоматизации Azure может работать с виртуальными и физическими машинами, размещенными в облаке или локально. 

Предпочитаете смотреть, а не читать? Посмотрите следующий видеоролик, выпущенный в мае 2015 г., когда впервые было объявлено о создании службы Azure Automation DSC. **Примечание.** Несмотря на то что основные концепции и жизненный цикл, о которых рассказывается в этом видеоролике, по-прежнему актуальны, с момента записи этого видеоролика Automation DSC Azure сделала большой шаг вперед. Теперь она стала общедоступной, оснащена более функциональным пользовательским интерфейсом на портале Azure и поддерживает множество дополнительных возможностей.

> [!ВИДЕО https://channel9.msdn.com/Events/Ignite/2015/BRK3467/player]

## <a name="azure-automation-dsc-terms"></a>Терминология DSC службы автоматизации Azure

### <a name="configuration"></a>Конфигурация

В PowerShell DSC появилась новая концепция — конфигурации. Конфигурации позволяют с помощью синтаксиса PowerShell определить требуемое состояние среды. Чтобы использовать DSC для настройки среды, сначала определите блок сценария Windows PowerShell с помощью ключевого слова configuration, после которого должны стоять идентификатор и фигурные скобки ({}) для отделения блока.

![замещающий текст](./media/automation-dsc-overview/AADSC_1.png)

Внутри блока конфигурации можно определить конфигурации узлов, которые задают требуемое состояние для набора однотипных узлов (компьютеров) в вашей среде. Таким образом конфигурация узла представляет предполагаемую "роль" для одного или нескольких узлов. Блок конфигурации узла начинается с ключевого слова node. После него указывается ключевое слово с именем роли, которая может быть переменной или выражением. После имени роли добавьте фигурные скобки {}, чтобы отделить блок конфигурации узла.

![замещающий текст](./media/automation-dsc-overview/AADSC_2.png)

Внутри блока конфигурации узла можно определить блоки ресурсов для настройки определенных ресурсов DSC. Блок ресурсов начинается с имени ресурса, затем идет идентификатор, которым вы хотите обозначить этот блок, и фигурные скобки {}, отделяющие блок.

![замещающий текст](./media/automation-dsc-overview/AADSC_3.png)

Дополнительная информация о ключевом слове configuration есть в статье [Конфигурации DSC](https://msdn.microsoft.com/en-us/powershell/dsc/configurations "Конфигурации DSC").

Выполнение (компиляция) конфигурации DSC создает одну или несколько конфигураций узлов DSC (документов MOF), которые должны применить узлы DSC для достижения требуемого состояния.

DSC службы автоматизации Azure позволяет импортировать, создавать и компилировать конфигурации DSC в службе автоматизации Azure точно так же, как можно в ней импортировать, создавать и запускать модули Runbook.

> [!IMPORTANT]
> Конфигурация должна содержать только один блок конфигурации с тем же именем, что и конфигурация в DSC службы автоматизации Azure.

### <a name="node-configuration"></a>Конфигурация узла

При компиляции конфигурации DSC, в зависимости от блоков Node в ней, создается одна или несколько конфигураций узла. Конфигурация узла — это "документ MOF" или "документ конфигурации". Конфигурация узла представляет определенную роль, например роль веб-сервера или рабочую роль. Один или несколько узлов должны принять требуемое состояние этой роли или проверять свое соответствие этому состоянию. Имена конфигураций узлов в Automation DSC Azure имеют следующий вид: имя_конфигурации.имя_блока_конфигурации_узла.

Чтобы сообщить узлам PS DSC о конфигурациях узлов, которые они должны выполнять, следует использовать метод push или pull DSC. DSC службы автоматизации Azure полагается на метод pull DSC. При этом узлы запрашивают нужные конфигурации узла с опрашивающего сервера DSC службы автоматизации Azure. Так как узлы делают запрос в DSC службы автоматизации Azure, они могут находиться за брандмауэрами, все их входящие порты могут быть закрыты и т. д. Они должны иметь исходящий доступ к Интернету (напрямую или через прокси-сервер).

### <a name="node"></a>Узел

Узел DSC — это любой компьютер, конфигурацией которого управляет DSC. Это может быть виртуальная машина Azure Windows или Linux, локальная виртуальная машина, физический узел или виртуальная машина в другом общедоступном облаке. Узлы применяют конфигурации узлов, чтобы поддерживать соответствие требуемому состоянию, которое определено в конфигурациях. Затем узлы передают на сервер отчетов информацию о своей конфигурации и состоянии соответствия.

Служба Azure Automation DSC позволяет гибко и легко вводить узлы в эксплуатацию. Служба Azure Automation DSC может изменять конфигурацию узла, назначенную каждому узлу. Когда происходит изменение конфигурации узла, он автоматически получает новую роль и начинает передавать информацию в соответствии с этой новой ролью. 

### <a name="resource"></a>Resource (Ресурс)

Ресурсы DSC — это стандартные блоки, которые можно использовать для определения конфигурации требуемого состояния Windows PowerShell DSC. DSC поставляется с набором встроенных ресурсов, в том числе для файлов и папок, компонентов и ролей сервера, параметров реестра, переменных среды, служб и процессов. Дополнительная информация о полном списке встроенных ресурсов DSC и их использовании: [Встроенные ресурсы Windows PowerShell DSC](https://msdn.microsoft.com/powershell/dsc/builtinresource).

Ресурсы DSC можно также импортировать как часть модулей PowerShell, чтобы расширить набор встроенных ресурсов DSC . Если конфигурация узла содержит ссылки на ресурсы, не используемые по умолчанию, узлы DSC получают эти ресурсы с опрашивающего сервера DSC. Чтобы узнать, как создавать пользовательские ресурсы, см. статью [Создание пользовательских ресурсов настройки требуемого состояния Windows PowerShell](https://msdn.microsoft.com/powershell/dsc/authoringresource).

DSC службы автоматизации Azure поставляется с теми же встроенными ресурсами DSC, что и PS DSC. Можно добавить дополнительные ресурсы в DSC службы автоматизации Azure, импортировав модули PowerShell, содержащие ресурсы, в службу автоматизации Azure.

### <a name="compilation-job"></a>Задание компиляции

Задание компиляции в DSC службы автоматизации Azure представляет собой экземпляр компиляции конфигурации, используемый для создания одной или нескольких конфигураций узлов. Эти задания аналогичны заданиям Runbook службы автоматизации Azure, за исключением того, что в действительности они не выполняют какие-либо задачи, кроме создания конфигураций узлов. Любые созданные заданием компиляции конфигурации узлов автоматически размещаются на опрашивающем сервере Automation DSC Azure и перезаписывают предыдущие версии конфигураций (если таковые существовали для этой конфигурации). Имя конфигурации узла, производимой заданием компиляции, имеет вид "имя_конфигурации.имя_блока_конфигурации_узла". Например, при компиляции следующей конфигурации будет создана одна конфигурация узла с именем MyConfiguration.webserver.

![замещающий текст](./media/automation-dsc-overview/AADSC_5.png)

> [!NOTE]
> Как модули Runbook, конфигурации можно публиковать. Это не связано с помещением элементов DSC на опрашивающий сервер DSC службы автоматизации Azure. Задания компиляции помещают элементы DSC на опрашивающий сервер DSC службы автоматизации Azure. Дополнительные сведения о "публикации" в службе автоматизации Azure см. в статье [Публикация Runbook](https://msdn.microsoft.com/library/dn903765.aspx).


## <a name="azure-automation-dsc-lifecycle"></a>Жизненный цикл Azure Automation DSC

Для перехода от пустой учетной записи автоматизации к управляемому набор правильно настроенных узлов требуется ряд процессов для определения конфигураций, их преобразования в конфигурации узлов, перенос узлов в Azure Automation DSC и применение этих конфигураций узлов. На следующей схеме показан жизненный цикл Azure Automation DSC:

![замещающий текст](./media/automation-dsc-overview/DSCLifecycle.png)

На следующем рисунке показан подробный пошаговый процесс жизненного цикла DSC. Он включает в себя различные способы импорта конфигураций и их применения к узлам службы автоматизации Azure. Кроме того, здесь приведены компоненты локальной машины, необходимые для поддержки DSC и взаимодействия между различными компонентами.

![Архитектура DSC](./media/automation-dsc-overview/dsc-architecture.png)

## <a name="gotchas--known-issues"></a>Подводные камни и известные проблемы

* Должна быть установлена последняя версия WMF 5, чтобы агент PowerShell DSC для Windows имел возможность обмениваться данными со службой автоматизации Azure. Должна быть установлена последняя версия агента PowerShell DSC для Linux, чтобы ОС Linux имела возможность обмениваться данными со службой автоматизации Azure.
* Если виртуальная машина, которую вы хотите обновить до версии WMF 5 RTM, уже зарегистрирована как узел в службе Azure Automation DSC, то сначала отмените эту регистрацию, а после установки WMF 5 зарегистрируйте виртуальную машину повторно. Перед повторной регистрацией удалите файл $env:windir\system32\configuration\DSCEngineCache.mof.
* DSC может работать неправильно, если вы установите WMF 5 RTM поверх установки WMF 5 Production Preview. Чтобы устранить эту проблему, выполните следующую команду в сеансе PowerShell с повышенными правами (от имени администратора): `mofcomp $env:windir\system32\wbem\DscCoreConfProv.mof`
* Сейчас служба Azure Automation DSC не поддерживает частичные или составные конфигурации DSC. Однако вы можете импортировать составные ресурсы DSC и использовать их в конфигурациях Azure Automation DSC так же, как и в локальном PowerShell. Это позволяет повторно использовать элементы конфигурации.
* Традиционный опрашивающий сервер PowerShell DSC ожидает, что ZIP-файлы модуля размещаются на опрашивающем сервере в формате **ИмяМодуля_Версия.zip**. Служба автоматизации Azure ожидает, что модули PowerShell импортируются с именами в виде **ИмяМодуля.zip**. В [этой записи блога](https://azure.microsoft.com/blog/2014/12/15/authoring-integration-modules-for-azure-automation/) можно подробнее узнать о формате модуля интеграции, необходимом для импорта модуля в службу автоматизации Azure.
* Модули PowerShell, импортированные в службу автоматизации Azure, не могут содержать DOC- или DOCX-файлы. Некоторые модули PowerShell, содержащий ресурсы DSC, содержат эти файлы в справочных целях. Эти файлы надо удалить из модулей, прежде чем выполнять импорт в службу автоматизации Azure.
* После первоначальной регистрации узла в учетной записи службы автоматизации Azure или после сопоставления узла с другой конфигурацией узла на стороне сервера узел имеет статус соответствующего. Это происходит, даже если состояние узла не соответствует конфигурации узла, с которой он сопоставлен. После того, как узел отправит свой первый отчет после регистрации или изменения сопоставления конфигурации узла, состояние узла можно будет считать надежным.
* Когда выполняется входящая миграция виртуальной машины Azure под управлением Windows для управления с использованием DSC службы автоматизации Azure при помощи любых прямых методов, эта виртуальная машина отобразится в качестве узла в DSC службы автоматизации Azure в течение одного часа. Это связано с тем, что расширение DSC для виртуальных машин Azure устанавливает на виртуальную машину платформу Windows Management Framework 5.0, которая требуется для размещения этой виртуальной машины в DSC службы автоматизации Azure.
* После регистрации каждый узел автоматически согласовывает уникальный сертификат для проверки подлинности, срок действия которого составляет один год. В настоящее время протокол регистрации PowerShell DSC не может автоматически обновлять сертификаты при приближении даты окончания срока их действия, поэтому по истечении года необходимо повторно регистрировать узлы. Перед повторной регистрацией убедитесь, что на каждом узле работает Windows Management Framework 5.0 RTM. Если истек срок действия сертификата аутентификации узла и узел не зарегистрирован, он не может взаимодействовать со службой автоматизации Azure и получает пометку "Не отвечает". Повторную регистрацию можно выполнить таким же образом, как и первоначальную регистрацию узла. Повторная регистрация, выполненная не позднее чем через 90 дней с момента истечения срока действия сертификата или в любой момент после истечения срока действия сертификата, приведет к созданию и использованию нового сертификата.


## <a name="related-articles"></a>Связанные статьи

* [Подключение компьютеров для управления с помощью Azure Automation DSC](automation-dsc-onboarding.md)
* [Компиляция конфигураций в Azure Automation DSC](automation-dsc-compile.md)
* [Командлеты Automation DSC Azure](https://msdn.microsoft.com/library/mt244122.aspx)
* [Цены на Automation DSC Azure](https://azure.microsoft.com/pricing/details/automation/)
* [Непрерывное развертывание на виртуальные машины IaaS с помощью Azure Automation DSC и Chocolatey](automation-dsc-cd-chocolatey.md)




<!--HONumber=Feb17_HO1-->


