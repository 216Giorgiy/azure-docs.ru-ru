<properties 
   pageTitle="Обзор Automation DSC Azure | Microsoft Azure" 
   description="Обзор DSC службы автоматизации Azure, условий использования и известных проблем" 
   services="automation" 
   documentationCenter="dev-center-name" 
   authors="coreyp-at-msft" 
   manager="stevenka" 
   editor="tysonn"/>

<tags
   ms.service="automation"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="powershell"
   ms.workload="TBD" 
   ms.date="09/24/2015"
   ms.author="coreyp"/>

# Обзор DSC службы автоматизации Azure #

## Что такое PowerShell DSC? ##
Desired State Configuration (DSC) — это новая платформа управления в Windows PowerShell, позволяющая управлять настройкой физических узлов и виртуальных машин с помощью декларативного синтаксиса PowerShell.

DSC предоставляет набор расширений языка Windows PowerShell, новые командлеты Windows PowerShell и ресурсы, которые можно использовать, чтобы декларативно указать, как должна быть настроена программная среда. Эта платформа также предоставляет средства для обслуживания существующих конфигураций и управления ими.

### Практическое применение ###
Ниже приведены некоторые примеры сценариев, где можно использовать встроенные ресурсы DSC для автоматизированной настройки и управления набором компьютеров (также известных как целевые узлы):

- Включение или отключение ролей и компонентов сервера.
- Управление параметрами реестра.
- Управление файлами и каталогами.
- Запуск и остановка процессов и служб, а также управление ими.
- Управление группами и учетными записями пользователей.
- Развертывание нового программного обеспечения.
- Управление переменными среды.
- Выполнение сценариев Windows PowerShell.
- Исправление конфигурации, которая отклонилась от требуемого состояния.
- Обнаружение фактического состояния конфигурации на заданном узле.

Кроме того, вы можете создать настраиваемые ресурсы для настройки состояния любого параметра приложения или системы.


Дополнительная информация о PowerShell DSC: [Конфигурация в мире разработки и операций — Windows PowerShell DSC](http://blogs.msdn.com/b/powershell/archive/2013/11/01/configuration-in-a-devops-world-windows-powershell-desired-state-configuration.aspx).

##Что такое DSC службы автоматизации Azure?##
В основе DSC службы автоматизации Azure заложены основополагающие принципы, представленные в PowerShell DSC и призванные еще больше упростить управление конфигурацией. DSC службы автоматизации Azure обеспечивает тот же слой управления в [PowerShell DSC](https://technet.microsoft.com/library/dn249912.aspx) <link>, что и служба автоматизации Azure сегодня предлагает для сценариев PowerShell.

DSC службы автоматизации Azure позволяет [создавать конфигурации требуемого состояния PowerShell и управлять ими](https://technet.microsoft.com/library/dn249918.aspx), импортировать [ресурсы DSC](https://technet.microsoft.com/library/dn282125.aspx) и создавать конфигурации узлов DSC (документы MOF), и все это в облаке. Эти элементы DSC будут помещаться на [опрашивающий сервер DSC](https://technet.microsoft.com/library/dn249913.aspx) службы автоматизации Azure, чтобы целевые узлы (например, физические компьютеры и виртуальные машины) в облаке или локальной среде могли извлекать их, автоматически согласовывать с указанным требуемым состоянием и сообщать службе автоматизации Azure об их соответствии требуемому состоянию.

Предпочитаете смотреть, а не читать? Посмотрите указанный ниже видеоролик, выпущенный в мае 2015 г., когда впервые было объявлено об Automation DSC Azure. **Примечание.** Несмотря на то что основные концепции и жизненный цикл, о которых рассказывается в этом видеоролике, по-прежнему актуальны, с момента записи этого видеоролика Automation DSC Azure сделала большой шаг вперед. Сейчас она доступна для всеобщего ознакомления, оснащена более функциональным пользовательским интерфейсом на портале Azure и поддерживает дополнительные возможности.

> [AZURE.VIDEO microsoft-ignite-2015-heterogeneous-configuration-management-using-microsoft-azure-automation]

## Терминология DSC службы автоматизации Azure ##
### Конфигурация ###
В PowerShell DSC появилась новая концепция — конфигурации. Конфигурации позволяют с помощью синтаксиса PowerShell определить требуемое состояние среды. Чтобы использовать DSC для настройки среды, сначала определите блок сценария Windows PowerShell с помощью ключевого слова configuration, затем укажите идентификатор и фигурные скобки ({}) для отделения блока.

![замещающий текст](./media/automation-dsc-overview/AADSC_1.png)

Внутри блока конфигурации можно определить блоки конфигурации узлов, задающие требуемую конфигурацию для набора узлов (компьютеров) в вашей среде, которые должны быть настроены совершенно одинаково. Таким образом конфигурация узла представляет предполагаемую "роль" для одного или нескольких узлов. Блок конфигурации узла начинается с ключевого слова node. После него указывается ключевое слово с именем роли, которая может быть переменной или выражением. После имени роли добавьте фигурные скобки {}, чтобы отделить блок конфигурации узла.

![замещающий текст](./media/automation-dsc-overview/AADSC_2.png)
 
Внутри блока конфигурации узла можно определить блоки ресурсов для настройки определенных ресурсов DSC. Блок ресурсов начинается с имени ресурса, затем идет идентификатор, которым вы хотите обозначить этот блок, и фигурные скобки {}, отделяющие блок.

![замещающий текст](./media/automation-dsc-overview/AADSC_3.png)

Дополнительная информация о ключевом слове configuration: [Общие сведения о ключевом слове Configuration в конфигурации требуемого состояния](http://blogs.msdn.com/b/powershell/archive/2013/11/05/understanding-configuration-keyword-in-desired-state-configuration.aspx "Общие сведения о ключевом слове Configuration в конфигурации требуемого состояния").

Выполнение (компиляция) конфигурации DSC создаст одну или несколько конфигураций узлов DSC (документов MOF), соответствующих узлам DSC, которые должны соответствовать желаемому состоянию.

DSC службы автоматизации Azure позволяет импортировать, создавать и компилировать конфигурации DSC в службе автоматизации Azure точно так же, как можно в ней импортировать, создавать и запускать модули Runbook.

>[AZURE.IMPORTANT]Конфигурация должна содержать только один блок конфигурации с тем же именем, что и конфигурация в DSC службы автоматизации Azure.


###Конфигурация узла###

При компиляции конфигурации DSC, в зависимости от блоков Node в ней, создается одна или несколько конфигураций узла. Конфигурация узла — это то же самое, что "MOF" или "документ конфигурации" (если вы знакомы с этими терминами PS DSC). Она представляет собой "роль", например, веб-сервера или рабочего процесса, которая предполагается для требуемого состояния одного или нескольких узлов. Имена конфигураций узлов в Automation DSC Azure имеют следующий вид: <Configuration-name>.<Node configuration-block-name>.

Чтобы сообщить узлам PS DSC о конфигурациях узлов, которые они должны выполнять, следует использовать метод push или pull DSC. DSC службы автоматизации Azure полагается на метод pull DSC. При этом узлы запрашивают нужные конфигурации узла с опрашивающего сервера DSC службы автоматизации Azure. Так как узлы делают запрос в DSC службы автоматизации Azure, они могут находиться за брандмауэрами, все их входящие порты могут быть закрыты и т. д. Им требуется только исходящий доступ к Интернету.


###Узел###

Узел DSC — это любой компьютер, конфигурацией которого управляет DSC. Это может быть виртуальная машина Azure, локальная виртуальная машина или физический узел. Узлы применяют конфигурации узлов, чтобы принять и сохранить соответствие требуемому состоянию, определяемому ими. Также они могут сообщать на сервер отчетов о своем состоянии конфигурации и его соответствии.

DSC службы автоматизации Azure упрощает адаптацию узлов для управления с помощью DSC службы автоматизации Azure и позволяет на стороне сервера изменять конфигурацию узла, назначенную каждому узлу. Таким образом, когда узел в следующий раз проверит инструкции на сервере, он примет другую роль и соответственно изменит свою конфигурацию. Узлы также сообщают о своем состояния и о том, соответствует ли их конфигурация DSC службы автоматизации Azure.


###Ресурс###
Ресурсы DSC — это стандартные блоки, которые можно использовать для определения конфигурации требуемого состояния Windows PowerShell DSC. DSC поставляется с набором встроенных функций для настройки ресурсов, в том числе файлов и папок, компонентов и ролей сервера, параметров реестра, переменных среды, служб и процессов. Дополнительная информация о полном списке встроенных ресурсов DSC и их использовании: [Встроенные ресурсы Windows PowerShell DSC](https://technet.microsoft.com/library/dn249921.aspx).

Ресурсы DSC можно также импортировать как часть модулей PowerShell, чтобы расширить набор встроенных ресурсов DSC . Ресурсы, не используемые по умолчанию, будет получены узлами DSC с опрашивающего сервера DSC, если конфигурация узла содержит ссылки на эти ресурсы. Чтобы узнать, как создавать пользовательские ресурсы, см. также: [Создание пользовательских ресурсов Windows PowerShell DSC](https://technet.microsoft.com/library/dn249927.aspx).

DSC службы автоматизации Azure поставляется с теми же встроенными ресурсами DSC, что и PS DSC. Можно добавить дополнительные ресурсы в DSC службы автоматизации Azure, импортировав модули PowerShell, содержащие ресурсы, в службу автоматизации Azure.


###Задание компиляции###
Задание компиляции в DSC службы автоматизации Azure представляет собой экземпляр компиляции конфигурации, используемый для создания одной или нескольких конфигураций узлов. Эти задания аналогичны заданиям Runbook службы автоматизации Azure, за исключением того, что в действительности они не выполняют какие-либо задачи, кроме создания конфигураций узлов. Любые созданные заданием компиляции конфигурации узлов автоматически размещаются на опрашивающем сервере Automation DSC Azure и перезаписывают предыдущие версии конфигураций (если таковые существовали для этой конфигурации). Имя конфигурации узла, производимой заданием компиляции, имеет вид "<Configuration-name>.<Node configuration-block-name>". Например, компиляция указанной ниже конфигурации приведет к созданию одной конфигурации узла — MyConfiguration.webserver.


![замещающий текст](./media/automation-dsc-overview/AADSC_5.png)


>[AZURE.NOTE]Как модули Runbook, конфигурации можно публиковать. Это не связано с помещением элементов DSC на опрашивающий сервер DSC службы автоматизации Azure. Задания компиляции помещают элементы DSC на опрашивающий сервер DSC службы автоматизации Azure. Дополнительная информация о "публикация" в службе автоматизации Azure: [Публикация Runbook](https://msdn.microsoft.com/library/dn903765.aspx).

Сейчас DSC службы автоматизации Azure предоставляет в [модуле PowerShell диспетчера ресурсов Azure](https://msdn.microsoft.com/library/mt244122.aspx) следующие командлеты для управления заданиями компиляции:

-	`Get-AzureAutomationDscCompilationJob`
-	`Get-AzureAutomationDscCompilationJobOutput`
-	`Start-AzureAutomationDscCompilationJob`

##Жизненный цикл Azure Automation DSC##
Для перехода от пустой учетной записи автоматизации к управляемому набор правильно настроенных узлов требуется ряд процессов для определения конфигураций, их преобразования в конфигурации узлов, перенос узлов в Azure Automation DSC и применение этих конфигураций узлов. На следующей схеме показан жизненный цикл Azure Automation DSC:

![замещающий текст](./media/automation-dsc-overview/DSCLifecycle.png)


##Подводные камни и известные проблемы##

- Сейчас DSC службы автоматизации Azure не поддерживает частичные или составные конфигурации DSC.

- Должна быть установлена последняя версия WMF 5, чтобы агент PowerShell DSC для Windows имел возможность обмениваться данными со службой автоматизации Azure. Агент PowerShell DSC для Linux в настоящее время не поддерживает обмен данными со службой автоматизации Azure. Скоро это должно быть изменено.

- Служба автоматизации Azure не поддерживает параллельное использование модулей PowerShell. Это значит, все конфигурации в учетной записи службы автоматизации должны работать с последней версией модуля PowerShell, импортированной в эту учетную запись, и с любыми ресурсами PowerShell DSC в этом модуле, которые используются в конфигурации.

- Традиционный опрашивающий сервер PowerShell DSC ожидает, что ZIP-файлы модуля размещаются на опрашивающем сервере в формате **ИмяМодуля\_Версия.zip**. Служба автоматизации Azure ожидает, что модули PowerShell импортируются с именами в виде **ИмяМодуля.zip**. В [этой записи блога](http://azure.microsoft.com/blog/2014/12/15/authoring-integration-modules-for-azure-automation/) можно подробнее узнать о формате модуля интеграции, необходимом для импорта модуля в службу автоматизации Azure.

- Модули PowerShell, одновременно указывающие ресурсы DSC внутри модуля в формате "отдельная папка для каждой версии", сейчас не будут работать в службе автоматизации Azure.

- Модули PowerShell, импортированные в службу автоматизации Azure, не могут содержать DOC- или DOCX-файлы. Некоторые модули PowerShell, содержащий ресурсы DSC, содержат эти файлы в справочных целях. Эти файлы надо удалить из модулей, прежде чем импортировать их в службу автоматизации Azure.

- При первой регистрации узла с помощью учетной записи службы автоматизации Azure или изменении узла для сопоставления с другой конфигурацией узла на стороне сервера он будет находиться в состоянии "Совместимый", даже если оно фактически не соответствует конфигурации узла, с которой он сейчас сопоставлен. После того как узел сделает первый запрос и отправит свой первый отчет после регистрации или изменения сопоставления конфигурации узла, состояние узла можно будет считать надежным.

- Если при адаптации виртуальной машины Azure для управления через DSC автоматизации Azure с помощью `Register-AzureAutomationDscNode`, `Set-AzureVMExtension` или расширения для виртуальных машин DSC службы автоматизации Azure на портале предварительной версии Azure происходит сбой регистрации с сообщением **Имя компьютера не задано, и в каталоге конфигурации нет файлов конфигурации**, это ложный сигнал, и регистрация виртуальной машины в действительности выполнена успешно. Успешную регистрацию можно проверить с помощью командлета `Get-AzureAutomationDscNode`.

- Когда выполняется входящая миграция виртуальной машины Azure для управления с Automation DSC Azure при помощи `Register-AzureAutomationDscNode`, `Set-AzureVMExtension` или расширения для виртуальных машин Automation DSC Azure на портале предварительной версии Azure, эта VM отобразится в качестве узла DSC в службе автоматизации Azure в течение одного часа. Это связано с тем, что расширение DSC для виртуальных машин Azure устанавливает на виртуальную машину платформу Windows Management Framework 5.0, которая требуется для размещения этой виртуальной машины в DSC службы автоматизации Azure.

- После регистрации каждый узел автоматически согласовывает уникальный сертификат для проверки подлинности, срок действия которого составляет один год. В настоящее время протокол регистрации PowerShell DSC не имеет возможности автоматически обновлять сертификаты при приближении даты окончания срока их действия, поэтому по истечении года необходимо повторно регистрировать узлы. Перед повторной регистрацией убедитесь, что на каждом узле работает Windows Management Framework 5.0 RTM. Если истек срок действия сертификата проверки подлинности узла и узел не зарегистрирован, то он не сможет взаимодействовать со службой автоматизации Azure и получит пометку "Не отвечает". Повторную регистрацию можно выполнить таким же образом, как и первоначальную регистрацию узла. Повторная регистрация, выполненная не позднее чем через 90 дней с момента истечения срока действия сертификата или в любой момент после истечения срока действия сертификата, приведет к созданию и использованию нового сертификата.

##Связанные статьи##

- [Командлеты Automation DSC Azure](https://msdn.microsoft.com/library/mt244122.aspx)
- [Цены на Automation DSC Azure](http://azure.microsoft.com/pricing/details/automation/)

<!---HONumber=Oct15_HO1-->