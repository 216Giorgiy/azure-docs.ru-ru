<properties
   pageTitle="Настройка учетной записи пользователя Azure AD | Microsoft Azure"
   description="В этой статье объясняется, как настроить учетные данные учетной записи пользователя Azure AD для модулей Runbook в службе автоматизации Azure для выполнения проверки подлинности в ARM и ASM."
   services="automation"
   documentationCenter=""
   authors="MGoedtel"
   manager="jwhit"
   editor="tysonn" />
<tags
   ms.service="automation"
   ms.devlang="na"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="04/08/2016"
   ms.author="magoedte" />

# Проверка подлинности модулей Runbook с помощью Azure Service Management и диспетчера Resource Manager

В этой статье описываются действия по настройке учетной записи пользователя Azure AD для модулей Azure Automation Runbook, запущенных с ресурсами Azure Service Management (ASM) или Azure Resource Manager (ARM). Хотя удостоверение проверки подлинности для модулей Runbook на основе ARM по-прежнему поддерживается, мы рекомендуем использовать в Azure новую учетную запись запуска от имени.

## Создание нового пользователя Azure Active Directory

1. Войдите на классический портал Azure как администратор службы для подписки Azure, которой вы хотите управлять.
2. Щелкните **Active Directory**, а затем выберите имя каталога своей организации.
3. Откройте вкладку **Пользователи**, а затем в области управления выберите **Добавить пользователя**.
4. На странице **Тип учетной записи пользователя** в раскрывающемся меню **Тип пользователя** выберите пункт **Новый пользователь в вашей организации**.
5. Введите имя пользователя.  
6. Выберите имя каталога, связанное с вашей подпиской Azure на странице Active Directory.
7. На странице **профиля пользователя** введите имя, фамилию и понятное имя, а затем выберите роль пользователя в списке **Роли**. Снимите флажок для параметра **Включить многофакторную проверку подлинности**.
8. Запишите полное имя пользователя и временный пароль.
9. Выберите **Параметры > Администраторы > Добавить**.
10. Введите полное имя пользователя, созданного вами.
11. Выберите подписку, которой этот пользователь будет управлять.
12. Выйдите из Azure, а затем войдите снова, используя только что созданную учетную запись. Вам будет предложено изменить пароль пользователя.


## Создание учетной записи службы автоматизации на классическом портале Azure
В этом разделе перечисляются действия, с помощью которых на портале Azure можно создать новую учетную запись службы автоматизации Azure, которая будет использоваться для управления ресурсами модулей Runbook в режимах ASM и ARM.

>[AZURE.NOTE] Управление учетными записями службы автоматизации, которые были созданы с помощью классического портала Azure, доступно с помощью любого набора командлетов как на классическом портале Azure, так и на портале Azure. После создания учетной записи нет никакой разницы в том, как вы будете создавать ресурсы в этой учетной записи и управлять ими. Если вы планируете и впредь использовать классический портал Azure, для создания учетных записей службы автоматизации нужно использовать его, а не портал Azure.


1. Войдите на классический портал Azure как администратор службы для подписки Azure, которой вы хотите управлять.
2. Выберите элемент **Служба автоматизации**.
3. На странице **службы автоматизации** выберите **Создание учетной записи автоматизации**.
4. В поле **Создание учетной записи автоматизации** введите имя для новой учетной записи автоматизации и выберите в раскрывающемся списке **регион**.  
5. Нажмите кнопку **ОК**, чтобы принять параметры и создать учетную запись.
6. Когда учетная запись будет создана, ее название появится на странице **службы автоматизации**.
7. Щелкните учетную запись, чтобы перейти на страницу панели мониторинга.  
8. На странице панели мониторинга службы автоматизации выберите элемент **Ресурсы**.
9. В нижней части страницы **Ресурсы** выберите **Добавить параметры**.
10. На странице **Добавление параметров** выберите **Добавить учетные данные**.
11. На странице **Определение учетных данных** в раскрывающемся списке **Тип учетных данных** выберите **Учетные данные Windows PowerShell** и укажите имя для учетных данных.
12. На следующей странице **Определение учетных данных** введите в поле **Имя пользователя** созданное ранее имя пользователя учетной записи AD, а также заполните поля **Пароль** и **Подтверждение пароля**. Нажмите кнопку **ОК**, чтобы сохранить изменения.

## Создание учетной записи службы автоматизации на портале Azure

В этом разделе приведены действия, с помощью которых на портале Azure можно создать учетную запись службы автоматизации Azure, которая будет использоваться для ресурсов управления модулями Runbook в режиме ARM.

1. Войдите на портал Azure как администратор службы для подписки Azure, которой вы хотите управлять.
2. Выберите элемент **Учетные записи службы автоматизации**.
3. В колонке "Учетные записи службы автоматизации" нажмите кнопку **Добавить**.<br>![Добавление учетной записи службы автоматизации](media/automation-sec-configure-azure-runas-account/add-automation-acct-properties.png)
2. В колонке **Добавление учетной записи службы автоматизации** в поле **Имя** введите имя новой учетной записи службы автоматизации.
5. Если у вас несколько подписок, укажите одну из них для новой учетной записи, а также новую или существующую **группу ресурсов** и **расположение** центра обработки данных Azure.
3. Для параметра **Создать учетную запись запуска от имени в Azure** выберите значение **Нет** и нажмите кнопку **Создать**.  

    >[AZURE.NOTE] Если вы выбрали значение **Нет**, чтобы не создавать учетную запись запуска от имени, в колонке **Добавление учетной записи службы автоматизации** появится предупреждение. Хотя учетная запись создается и назначается роли **Участник** в подписке, она не будет содержать соответствующее удостоверение проверки подлинности в службе каталогов вашей подписки и поэтому не будет иметь доступ к ресурсам в вашей подписке. Из-за этого модули Runbook, ссылающиеся на эту учетную запись, не смогут проходить проверку подлинности и выполнять задачи с ресурсами ARM.

    ![Предупреждение в колонке "Добавление учетной записи службы автоматизации"](media/automation-sec-configure-azure-runas-account/add-automation-acct-properties-error.png)

4. Проследить за созданием учетной записи службы автоматизации в Azure можно в разделе **Уведомления** в меню.

После создания учетных данных вам нужно создать ресурс учетных данных, чтобы связать учетную запись службы автоматизации с созданной ранее учетной записью пользователя AD. Помните: мы только создали учетную запись службы автоматизации; она не связана с удостоверением проверки подлинности. Выполните шаги, описанные в статье [Ресурсы учетных данных в службе автоматизации Azure](../automation/automation-credentials.md#creating-a-new-credential) и введите значение в поле **Имя пользователя** в формате **домен\\пользователь**.

## Использование учетных данных в Runbook

Учетные данные в Runbook можно получить с помощью действия [Get-AutomationPSCredential](http://msdn.microsoft.com/library/dn940015.aspx) и затем использовать их в [Add-AzureAccount](http://msdn.microsoft.com/library/azure/dn722528.aspx) для подключения к подписке Azure. Если это учетные данные администратора нескольких подписок Azure, то также следует использовать [Select-AzureSubscription](http://msdn.microsoft.com/library/dn495203.aspx), чтобы указать соответствующую подписку. Как показано в примере Windows PowerShell ниже, она обычно будет отображаться в верхней части большинства модулей Runbook службы автоматизации Azure.

    $cred = Get-AutomationPSCredential –Name "myuseraccount.onmicrosoft.com"
	Add-AzureAccount –Credential $cred
	Select-AzureSubscription –SubscriptionName "My Subscription"

Эти строки должны повторяться после любой [контрольной точки](http://technet.microsoft.com/library/dn469257.aspx#bk_Checkpoints) в Runbook. Если выполнение Runbook приостанавливается, а затем возобновляется другим работником, ему необходимо будет заново пройти аутентификацию.

## Дальнейшие действия
* Сведения о разных типах модулей Runbook и действиях по созданию собственных модулей Runbook см. в статье [Типы модулей Runbook в службе автоматизации Azure](../automation/automation-runbook-types.md).

<!---HONumber=AcomDC_0413_2016-->