<properties
   pageTitle="Служба автоматизации Azure и управление гибридным облаком: автоматизация развертывания виртуальной машины на платформе Amazon Web Services"
   description="Служба автоматизации Azure и управление гибридным облаком: автоматизация развертывания виртуальной машины на платформе Amazon Web Services"
   services="automation"
   documentationCenter=""
   authors="tiander"
   manager="stevenka"
   editor="" />
<tags
   ms.service="automation"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="02/01/2016"
   ms.author="tiandert; bwren" />

# Служба автоматизации Azure и управление гибридным облаком: автоматизация развертывания виртуальной машины на платформе Amazon Web Services

В ходе [репортажа об облачных средах](https://microsoftcloudroadshow.com/cities), когда я рассказывал о службе автоматизации Azure, был поднят ряд вопросов о предназначении и целевой среде службы автоматизации Azure. К счастью, у меня сохранилось демонстрационное видео, посвященное этой теме. Но если совсем коротко, то **служба автоматизации Azure предназначена не только для облака Azure и не только для локальных ресурсов. Она *ТАКЖЕ* предназначена и для управления гибридными облачными средами.** Таким образом, если вы являетесь, например, клиентом Amazon Web Services (AWS), вы также можете использовать службу автоматизации Azure.

## Цели

В этой статье я расскажу о том, как использовать службу автоматизации Azure для подготовки виртуальных машин в AWS. Также вы узнаете, как присвоить виртуальной машине определенное имя, что в контексте AWS называется обозначением виртуальных машин с помощью тегов.

## Предположения

Для работы с этой статьей вам понадобится настроенная учетная запись службы автоматизации Azure, а также подписка на AWS.

Дополнительные сведения о настройке учетной записи службы автоматизации Azure см. на [странице документации](automation-configuring.md).

## Подготовка: сохранение учетных данных AWS

Чтобы служба автоматизации Azure могла взаимодействовать с AWS, вам необходимо получить учетные данные AWS и сохранить их в качестве ресурса в службе автоматизации Azure.

Войдите на портал AWS, щелкните маленький треугольник под именем пользователя и выберите пункт **Security Credentials** (Учетные данные безопасности).

![Учетные данные безопасности AWS](./media/automation-aws-deployment/73522ff9-30b5-431c-a3b6-5a33167827ab.png "Учетные данные безопасности AWS")

Щелкните **Access Keys** (Ключи доступа).

![Ключи доступа AWS](./media/automation-aws-deployment/215d76d0-6e7f-4f55-9128-ba618d4514be.jpg "Ключи доступа AWS")

Скопируйте свой ключ доступа и секретный ключ доступа (при необходимости скачайте файл ключа и сохраните его в безопасном месте).

![Создание ключей доступа AWS](./media/automation-aws-deployment/81ca1d36-2814-478b-858f-8346f2a28211.png "Создание ключей доступа AWS")

## Ресурсы AWS в службе автоматизации Azure

Вы уже скопировали и сохранили **идентификатор ключа доступа** и **секретный ключ доступа** AWS. Теперь мы сохраним эти данные в службе автоматизации Azure.

Перейдите к учетной записи службы автоматизации и последовательно выберите пункты **Ресурсы** > **Учетные данные**. Затем добавьте новые учетные данные и назовите их **AWScred**.

![изображение](./media/automation-aws-deployment/19c3669d-5259-4566-9479-5dbebb8ac733.png "изображение")

Введите необязательное описание и убедитесь, что в поле **Имя пользователя** указан ваш **идентификатор доступа**, а в поле **Пароль** — **секретный ключ доступа**. Сохраните учетные данные AWS.

## Модуль PowerShell для Amazon Web Services

В процессе работы наш модуль Runbook для подготовки виртуальной машины будет использовать модуль PowerShell для AWS. Модуль PowerShell для AWS включен в [коллекцию PowerShell](http://www.powershellgallery.com/packages/AWSPowerShell/). Чтобы добавить его в учетную запись службы автоматизации, нажмите кнопку **Deploy to Azure Automation** (Развернуть в службе автоматизации Azure).

![Импорт модуля AWS PS в службу автоматизации](./media/automation-aws-deployment/daa07d22-0464-4ec2-8c85-35525f95e5e4.png "Импорт модуля AWS PS в службу автоматизации")

Когда вы нажмете на кнопку **Deploy to Azure Automation** (Развертывание в службе автоматизации Azure), система перенаправит вас на страницу входа в Azure. Введя учетные данные, вы увидите следующий экран.

![Мастер импорта модуля AWS](./media/automation-aws-deployment/575cd4d9-2ca5-4540-869d-3919f91294af.png "Мастер импорта модуля AWS")

Укажите существующую учетную запись службы автоматизации или создайте новую. Обратите внимание, что для существующих учетных записей раскрывающийся список не предусмотрен, поэтому вводить данные нужно внимательно и без опечаток. Также для учетной записи в службе автоматизации нужно указать правильные регион и группу ресурсов. Чтобы завершить настройку, выполните все необходимые шаги и нажмите кнопку **Создать**.

Если вы перейдете к указанной учетной записи службы автоматизации и последовательно выберете пункты **Ресурсы** > **Модули**, вы увидите модуль AWS и 1427 действий, ура!

>[AZURE.NOTE] Импорт модуля PowerShell в службу автоматизации Azure включает два этапа.
>
> 1.  Импорт модуля.
> 2.  Извлечение командлетов.
>
>Действия не будут отображаться, пока импорт модуля и извлечение командлетов не завершатся. А это может занять несколько минут.

## Модуль Runbook для подготовки виртуальной машины AWS

Теперь, когда у нас есть все необходимые компоненты, самое время создать модуль Runbook для подготовки виртуальной машины в AWS. Мы также покажем, как использовать в службе автоматизации Azure собственный сценарий PowerShell вместо рабочего процесса PowerShell.

Дополнительные сведения о различиях между собственным сценарием PowerShell и рабочим процессом PowerShell можно найти [здесь](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/). Сведения о создании графических модулей Runbook можно просмотреть [здесь](https://azure.microsoft.com/blog/azure-automation-graphical-and-textual-runbook-authoring/).

Сценарий PowerShell для нашего модуля Runbook можно скачать из [коллекции PowerShell](https://www.powershellgallery.com/packages/New-AwsVM/DisplayScript).

Чтобы скачать сценарий, откройте сеанс PowerShell и введите следующее: **Save-Script -Name New-AwsVM -Path <путь>**

Сохраненный сценарий PowerShell можно добавить в службу автоматизации Azure как модуль Runbook, выполнив следующее.

В своей **учетной записи службы автоматизации** щелкните **Модули Runbook** и выберите команду **Добавить модуль Runbook**. Выберите **Быстрое создание** (Создание модуля Runbook), введите имя модуля, а затем в разделе **Тип модуля Runbook** выберите **PowerShell**. Затем нажмите кнопку **Создать**.

![Создание модуля Runbook AWS](./media/automation-aws-deployment/4759ad00-f800-44ba-94be-307cf034a9df.png "Создание модуля Runbook AWS")

Когда откроется редактор модулей Runbook, скопируйте и вставьте сценарий PowerShell в область создания модуля Runbook.

![изображение](./media/automation-aws-deployment/7e13addf-cae3-49a5-9d6c-28aa0b7263f4.png "изображение")

При использовании загруженного сценария PowerShell обратите внимание на следующее.

-   Модуль Runbook содержит несколько значений параметров по умолчанию (см. раздел #ToDo). Проверьте все значения по умолчанию и при необходимости обновите их.
-   Убедитесь, что вы сохранили свои учетные данные для AWS в разделе **Ресурсы** под именем **AWScred**.
-   Используемый регион зависит от вашей подписки на AWS. На портале AWS (там, где вы копировали свои учетные данные безопасности) щелкните стрелку рядом со своей учетной записью, чтобы проверить регион.

![Регион AWS](./media/automation-aws-deployment/5a789953-7329-4f0e-9501-e2d3347a8730.png "Регион AWS")

-   Определите, [какой регион](http://docs.aws.amazon.com/powershell/latest/userguide/pstools-installing-specifying-region.html) необходимо указать в модуле Runbook. Например, мой регион — западная часть США (Орегон), который будет преобразован в us-west-2.

![Регионы AWS](./media/automation-aws-deployment/3ee8065d-0480-4c78-a2e3-6062653e9cb6.png "Регионы AWS")

-   Вы можете получить список имен образов при использовании интегрированной среды сценариев PowerShell, импорте модуля или проверке подлинности в AWS. Для этого в интегрированной среде сценариев вам нужно заменить командлет **Get-AutomationPSCredential** командлетом **$AwsCred = Get-Credential.** Когда появится запрос на ввод учетных данных, в качестве имени пользователя и пароля вы можете указать **идентификатор ключа доступа** и **секретный ключ доступа**. См. пример ниже.


		#Sample to get the AWS VM available images
		#Please provide the path where you have downloaded the AWS PowerShell module
		Import-Module AWSPowerShell
		$AWSRegion = "us-west-2"
		$AwsCred = Get-Credential
		$AwsAccessKeyId = $AwsCred.UserName
		$AwsSecretKey = $AwsCred.GetNetworkCredential().Password
		
		# Set up the environment to access AWS
		Set-AWSCredentials -AccessKey $AwsAccessKeyId -SecretKey $AwsSecretKey -StoreAs AWSProfile
		Set-DefaultAWSRegion -Region $AWSRegion
		
		Get-EC2ImageByName -ProfileName AWSProfile 


В результате этого действия на экране отобразится следующее:

![Получение образов AWS](./media/automation-aws-deployment/1b1b0e9f-1af0-471c-9f5e-43f4bb29f4ed.png "Получение образов AWS")

Скопируйте и вставьте любое имя образа в переменную службы автоматизации, связав его с элементом **$InstanceType** в модуле Runbook. Так как я использую бесплатный уровень AWS, в своем модуле Runbook я выбрал **t2.micro**.

Дополнительные сведения о типах экземпляра Amazon EC2 можно просмотреть [здесь](https://aws.amazon.com/ec2/instance-types/).

## Тестирование модуля Runbook для подготовки виртуальной машины AWS

Список предварительных требований.

-   Созданы ресурсы для проверки подлинности в AWS, которым присвоено имя **AWScred**.
-   Модуль PowerShell для AWS импортирован в службу автоматизации Azure.
-   Создан новый модуль Runbook, а значения параметров проверены и при необходимости обновлены.
-   Для параметров **Записи ведения журнала** и (при необходимости) **Подробные записи в журнале** в настройках модуля Runbook задано значение **Включено**.

Давайте запустим новый модуль Runbook, указав значение для параметра **VMname.**

![Запуск модуля Runbook: New-AwsVM](./media/automation-aws-deployment/31cd9d1d-208e-4e96-897f-05e37bf5ee7d.png "Запуск модуля Runbook: New-AwsVM")

Так как мы включили **Записи ведения журнала** и **Подробные записи в журнале**, выходные данные раздела **Потоки** можно просмотреть в разделе **Все журналы**.

![Раздел "Поток": выходные данные](./media/automation-aws-deployment/77191c69-37fa-4598-82d8-cf5dbadfaff5.png "Раздел "Поток": выходные данные")

Давайте теперь проверим, что происходит в AWS:

![Консоль AWS: развернутая виртуальная машина](./media/automation-aws-deployment/c5a16bd4-6c54-40d6-9811-7d8e6c5ec74d.png "Консоль AWS: развернутая виртуальная машина")

Отлично!

В этой статье я привожу пример того, как можно использовать службу автоматизации Azure для управления гибридными облаками. Для этого в Amazon Web Services мы создаем виртуальную машину и присваиваем ей имя с помощью пользовательских тегов.

Желаю вам успехов в работе со службой автоматизации. До новых встреч!

Тайендер.

<!---HONumber=AcomDC_0204_2016-->