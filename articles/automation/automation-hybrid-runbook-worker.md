---
title: Гибридные компоненты Runbook Worker в службе автоматизации Azure
description: В этой статье содержатся сведения об установке и использовании гибридной рабочей роли Runbook, которая является компонентом службы автоматизации Azure, позволяющим запускать модули runbook на компьютерах в локальном центре обработки данных или поставщике облачных решений.
services: automation
ms.service: automation
ms.component: process-automation
author: georgewallace
ms.author: gwallace
ms.date: 04/25/2018
ms.topic: article
manager: carmonm
ms.openlocfilehash: 0af8806cdc55b89a9ab87a8059808e4fcc9a1730
ms.sourcegitcommit: e14229bb94d61172046335972cfb1a708c8a97a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2018
ms.locfileid: "34159192"
---
# <a name="automate-resources-in-your-data-center-or-cloud-with-hybrid-runbook-worker"></a>Автоматизация ресурсов в центре обработки данных или облаке с помощью гибридной рабочей роли Runbook

Модули runbook в службе автоматизации Azure могут не получить доступ к ресурсам в других облаках или локальной среде, так как они выполняются в облаке Azure. Гибридная рабочая роль Runbook службы автоматизации Azure позволяет выполнять модули runbook непосредственно на компьютере, размещающем роль, для работы с ресурсами в среде, что позволяет управлять этими локальными ресурсами. Для хранения модулей runbook и управления ими используется служба автоматизации Azure, затем они передаются на один или несколько целевых компьютеров.

Эта функция проиллюстрирована на рисунке ниже.

![Обзор гибридного компонента Runbook Worker](media/automation-hybrid-runbook-worker/automation.png)

## <a name="hybrid-runbook-worker-groups"></a>Группы гибридных компонентов Runbook Worker

Каждый гибридный компонент Runbook Worker является членом группы гибридных компонентов Runbook Worker, которая указывается при установке агента. Группа может включать одного агента, но в нее можно установить несколько агентов для обеспечения высокого уровня доступности.

Когда вы запускаете модуль runbook в гибридной рабочей роли Runbook, вы выбираете группу для его выполнения. Каждый компонент Worker в группе опрашивает службу автоматизации, чтобы узнать, доступны ли какие-либо задания. Если задание доступно, то его получает первый компонент. Указание конкретного компонента Worker для выполнения конкретной задачи не предусмотрено.

## <a name="installing-a-hybrid-runbook-worker"></a>Установка гибридной рабочей роли Runbook Worker

Процесс установки гибридной рабочей роли runbook отличается в зависимости от ОС. Следующая таблица содержит ссылки на различные методы, которые вы можете использовать для установки гибридной рабочей роли Runbook. Ниже описаны два метода установки и настройки гибридной рабочей роли Runbook Windows. Мы рекомендуем использовать модуль runbook службы автоматизации для полностью автоматической настройки компьютера Windows. Второй метод заключается в пошаговом выполнении инструкций по ручной установке и настройке роли. Для компьютеров с Linux для установки агента запустите скрипт Python.

|ОС  |Типы развертывания  |
|---------|---------|
|Windows     | [PowerShell](automation-windows-hrw-install.md#automated-deployment)<br>[Вручную](automation-windows-hrw-install.md#manual-deployment)        |
|Linux     | [Python](automation-linux-hrw-install.md#installing-linux-hybrid-runbook-worker)        |

> [!NOTE]
> Чтобы управлять конфигурацией серверов, поддерживающих гибридную рабочую роль Runbook с настройкой требуемого состояния (DSC), добавьте такие серверы в качестве узлов DSC. Дополнительные сведения о развертывании этих узлов для управления с помощью DSC см. в статье [Подключение компьютеров для управления с помощью Azure Automation DSC](automation-dsc-onboarding.md).
>
>Если вы включите [решение по управлению обновлениями](automation-update-management.md), любой подключенный к рабочей области Log Analytics компьютер будет автоматически настроен в качестве гибридной рабочей роли Runbook для поддержки модулей runbook, которые входят в это решение. Но он не регистрируется в группах гибридных рабочих ролей, которые уже определены в вашей учетной записи службы автоматизации. Его можно добавить в группу гибридных рабочих ролей Runbook в учетной записи службы автоматизации, чтобы обеспечить поддержку модулей Runbook службы автоматизации при условии, что вы используете одну и ту же учетную запись для решения и для членства в группе гибридных рабочих ролей Runbook. Эта функция добавлена в версии 7.2.12024.0 гибридной рабочей роли Runbook.

Перед началом развертывания гибридной рабочей роли Runbook ознакомьтесь со следующими [сведениями о подготовке сети](#network-planning). После успешного развертывания рабочей роли Runbook ознакомьтесь с [запуском модулей runbook в гибридной рабочей роли Runbook](automation-hrw-run-runbooks.md), чтобы узнать, как настроить модули runbook для автоматизации процессов в локальном центре обработки данных или другой облачной среде.

## <a name="removing-hybrid-runbook-worker"></a>Удаление гибридного компонента Runbook Worker

Можно удалить одну или несколько гибридных рабочих ролей Runbook из группы либо удалить группу, в зависимости ваших целей. Чтобы удалить гибридную рабочую роль Runbook на локальном компьютере, выполните следующие действия.

1. На портале Azure перейдите к учетной записи службы автоматизации.
2. В колонке **Параметры** щелкните **Ключи** и запишите значения полей **URL-адрес** и **Первичный ключ доступа**. Эти сведения потребуются для выполнения следующего шага.

### <a name="windows"></a>Windows

Откройте сеанс PowerShell в режиме администратора и выполните следующую команду. Получить подробный журнал процедуры удаления можно с помощью параметра **-Verbose** .

```powershell
Remove-HybridRunbookWorker -url <URL> -key <PrimaryAccessKey>
```

Чтобы удалить устаревшие машины из группы гибридной рабочей роли, используйте необязательный параметр `machineName`.

```powershell-interactive
Remove-HybridRunbookWorker -url <URL> -key <PrimaryAccessKey> -machineName <ComputerName>
```

### <a name="linux"></a>Linux

```bash
sudo python onboarding.py --deregister --endpoint="<URL>" --key="<PrimaryAccessKey>" --groupname="Example" --workspaceid="<workspaceId>"
```

> [!NOTE]
> Агент мониторинга Майкрософт не удаляется с компьютера, удаляются только функциональные возможности и настройки гибридной рабочей роли Runbook.

## <a name="remove-hybrid-worker-groups"></a>Удаление групп гибридных рабочих ролей

Чтобы удалить группу, необходимо сначала удалить гибридную рабочую роль Runbook с каждого компьютера, который является участником этой группы, с помощью приведенной выше процедуры, а затем выполнить приведенные ниже инструкции по удалению группы.

1. На портале Azure откройте учетную запись службы автоматизации.
1. В разделе **Автоматизация процессов** выберите пункт **Группы гибридных рабочих ролей**. Выберите группу, которую необходимо удалить. После выбора конкретной группы отобразится страница свойств **группы гибридных рабочих ролей**.

   ![Страница группы гибридных рабочих ролей Runbook](media/automation-hybrid-runbook-worker/automation-hybrid-runbook-worker-group-properties.png)

1. На странице свойств выбранной группы щелкните **Удалить**. Появится запрос на подтверждение этого действия. Выберите **Да**, если вы уверены, что хотите продолжить.

   ![Диалоговое окно подтверждения удаления группы](media/automation-hybrid-runbook-worker/automation-hybrid-runbook-worker-confirm-delete.png)

   Этот процесс может занять несколько секунд. Ход его выполнения можно просмотреть в разделе **Уведомления** в меню.

## <a name="network-planning"></a>Настройка сети

### <a name="hybrid-worker-role"></a>Гибридная рабочая роль

Чтобы гибридная рабочая роль Runbook могла подключаться и регистрироваться в службе Log Analytics, ей нужен доступ к номерам портов и URL-адресам, описанным в этом разделе. Этот список является дополнением к [списку URL-адресов и портов, необходимых для подключения Microsoft Monitoring Agent](../log-analytics/log-analytics-agent-windows.md) к Log Analytics.

При использовании прокси-сервера для обмена данными между агентом и службой Log Analytics необходимо убедиться, что соответствующие ресурсы доступны. Если доступ к Интернету ограничивается брандмауэром, вам нужно изменить его настройки, чтобы разрешить доступ к OMS.

Для обмена данными между гибридной рабочей ролью Runbook и службой автоматизации необходимы следующие порт и URL-адрес:

* порт: только исходящий трафик Интернета через TCP-порт 443.
* Глобальный URL-адрес: *.azure-automation.net.
* Глобальный URL-адрес US Gov (Вирджиния): *.azure automation.us
* Служба агента: https://\<ИД рабочей области\>.agentsvc.azure-automation.net

При наличии учетной записи службы автоматизации, определенной для конкретного региона, можно ограничить обмен данными с таким региональным центром обработки данных. В таблице ниже содержатся записи DNS для каждого региона.

| **Регион** | **Запись DNS** |
| --- | --- |
| Западно-центральная часть США | wcus-jobruntimedata-prod-su1.azure-automation.net</br>wcus-agentservice-prod-1.azure-automation.net |
| Южно-центральный регион США |scus-jobruntimedata-prod-su1.azure-automation.net</br>scus-agentservice-prod-1.azure-automation.net |
| Восток США 2 |eus2-jobruntimedata-prod-su1.azure-automation.net</br>eus2-agentservice-prod-1.azure-automation.net |
| Центральная Канада |cc-jobruntimedata-prod-su1.azure-automation.net</br>cc-agentservice-prod-1.azure-automation.net |
| Западная Европа |we-jobruntimedata-prod-su1.azure-automation.net</br>we-agentservice-prod-1.azure-automation.net |
| Северная Европа |ne-jobruntimedata-prod-su1.azure-automation.net</br>ne-agentservice-prod-1.azure-automation.net |
| Юго-Восточная Азия |sea-jobruntimedata-prod-su1.azure-automation.net</br>sea-agentservice-prod-1.azure-automation.net|
| Центральная Индия |cid-jobruntimedata-prod-su1.azure-automation.net</br>cid-agentservice-prod-1.azure-automation.net |
| Восточная часть Японии |jpe-jobruntimedata-prod-su1.azure-automation.net</br>jpe-agentservice-prod-1.azure-automation.net |
| Юго-Восточная Австралия |ase-jobruntimedata-prod-su1.azure-automation.net</br>ase-agentservice-prod-1.azure-automation.net |
| Южная часть Великобритании | uks-jobruntimedata-prod-su1.azure-automation.net</br>uks-agentservice-prod-1.azure-automation.net |
| Правительство штата Вирджиния | usge-jobruntimedata-prod-su1.azure-automation.us<br>usge-agentservice-prod-1.azure-automation.us |

Для списка IP-адресов региона вместо его имен скачайте XML-файл [IP-адресов центра обработки данных Azure](https://www.microsoft.com/download/details.aspx?id=41653) из Центра загрузки Майкрософт и ознакомьтесь с ним.

> [!NOTE]
> В XML-файле IP-адресов центра обработки данных Azure приводится список диапазонов IP-адресов, используемых в центрах обработки данных Microsoft Azure. Этот файл включает диапазоны вычисления, хранения и SQL.
>
>Обновленный файл публикуется еженедельно. Он отражает развернутые в настоящее время диапазоны и все предстоящие изменения IP-адресов. Новые диапазоны, появившиеся в файле, не будут использоваться в центрах обработки данных по крайней мере одну неделю.
>
> Скачивайте новый XML-файл каждую неделю и вносите соответствующие изменения на своем сайте, чтобы правильно определять службы, выполняемые в Azure. Пользователям Azure ExpressRoute следует обратить внимание, что этот файл используется для того, чтобы обновлять объявление протокола пограничного шлюза (BGP) пространства Azure в первую неделю каждого месяца.

### <a name="update-management"></a>управление обновлениями;

В дополнение к стандартным адресам и портам, которые требуются гибридной рабочей роли, для управления обновлениями необходимы следующие адреса. Взаимодействие с этими адресами выполняется через порт 443.

|Azure Public  |Azure Government  |
|---------|---------|
|*.ods.opinsights.azure.com     |*.ods.opinsights.azure.us         |
|*.oms.opinsights.azure.com     | *.oms.opinsights.azure.us        |
|*.blob.core.windows.net|*.blob.core.usgovcloudapi.net|

## <a name="troubleshooting"></a>Устранение неполадок

Гибридная рабочая роль Runbook зависит от агента, который используется для взаимодействия с учетной записью автоматизации для регистрации рабочей роли, получения заданий runbook и сообщения о состоянии. Для Windows — агент Microsoft Monitoring Agent. Для Linux — агент Operations Management Suite для Linux. Если при регистрации рабочей роли произошла ошибка, это могло произойти по следующим причинам:

### <a name="the-hybrid-worker-is-behind-a-proxy-or-firewall"></a>Гибридная рабочая роль находится за прокси-сервером или брандмауэром.

Проверьте, имеет ли компьютер исходящий доступ к *.azure-automation.net на порту 443.

### <a name="the-computer-the-hybrid-worker-is-running-on-has-less-than-the-minimum-hardware-requirements"></a>Компьютер, на котором выполняется гибридная рабочая роль, не соответствует минимальным требованиям к оборудованию.

Прежде чем назначать компьютеры, на которых будет выполняться гибридная рабочая роль Runbook, необходимо выполнить на них соответствующие минимальные требования к оборудованию. Иначе в зависимости от использования ресурсов других фоновых процессов и возникновения конфликтов, вызванных модулями runbook во время выполнения, компьютер становится чрезмерно загруженным. Из-за этого при выполнении задания runbook возникают задержки и простои.

Убедитесь, что компьютер, предназначенный для выполнения гибридной рабочей роли Runbook, соответствует минимальным требованиям к оборудованию. Если требования выполнены, отследите использование ЦП и памяти, чтобы определить корреляцию между производительностью процессов гибридной рабочей роли Runbook и Windows. Если есть нагрузка на память или ЦП, возможно, необходимо обновить или добавить дополнительные процессоры либо увеличить объем памяти, чтобы устранить ошибку и проблему нехватки ресурсов. Как вариант, выберите другой вычислительный ресурс, который соответствует минимальным требованиям и масштабируется в соответствии с требованиями рабочей нагрузки.

Дополнительные сведения об устранении неполадок для конкретных ОС см. [в разделе для Linux](automation-linux-hrw-install.md#troubleshooting) или [в этом разделе для Windows](automation-windows-hrw-install.md#troubleshooting).

## <a name="next-steps"></a>Дополнительная информация

Ознакомьтесь с [запуском модулей runbook в гибридной рабочей роли Runbook](automation-hrw-run-runbooks.md), чтобы узнать, как настроить модули runbook для автоматизации процессов в локальном центре обработки данных или другой облачной среде.
