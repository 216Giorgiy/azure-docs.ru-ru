---
title: "Устранение распространенных проблем службы автоматизации Azure | Документация Майкрософт"
description: "В этой статье приведены сведения, которые позволят диагностировать и устранять распространенные ошибки службы автоматизации Azure."
services: automation
documentationcenter: 
author: georgewallace
manager: stevenka
editor: tysonn
tags: top-support-issue
keywords: "ошибка службы автоматизации, устранение неполадок, проблема"
ms.assetid: 5f3cfe61-70b0-4e9c-b892-d02daaeee07d
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/22/2017
ms.author: sngun; v-reagie
ms.openlocfilehash: 29362ea94fb86f86f7ff85be81cbf33fef6accce
ms.sourcegitcommit: 0e1c4b925c778de4924c4985504a1791b8330c71
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2018
---
# <a name="troubleshooting-common-issues-in-azure-automation"></a>Устранение распространенных проблем службы автоматизации Azure 
Эта статья содержит сведения о распространенных ошибках, которые могут возникнуть в службе автоматизации Azure, и возможных решениях по их устранению.

## <a name="authentication-errors-when-working-with-azure-automation-runbooks"></a>Ошибки, связанные с аутентификацией, при работе с модулями Runbook службы автоматизации Azure
### <a name="scenario-sign-in-to-azure-account-failed"></a>Сценарий: не удается войти в учетную запись Azure
**Ошибка:** при работе с командлетами Add-AzureAccount или Login-AzureRmAccount возникает ошибка "Unknown_user_type: неизвестный тип пользователя".

**Причина ошибки:** Эта ошибка возникает, если имя актива учетных данных является недопустимым или если имя пользователя и пароль, который использовался для настройки учетных данных службы автоматизации не допускаются.

**Советы по устранению неполадки** : чтобы определить причину ошибки, сделайте следующее.  

1. Убедитесь, что в имени ресурса-контейнера учетных данных службы автоматизации, используемом для подключения к Azure, отсутствуют специальные знаки, включая **@** .  
2. Убедитесь, что вы можете использовать имя пользователя и пароль, которые хранятся в учетных данных службы автоматизации Azure в редакторе локальной интегрированной среды сценариев PowerShell. Для этого в интегрированной среде сценариев PowerShell выполните следующие командлеты:  

        $Cred = Get-Credential  
        #Using Azure Service Management   
        Add-AzureAccount –Credential $Cred  
        #Using Azure Resource Manager  
        Login-AzureRmAccount –Credential $Cred
3. Локальный сбой проверки подлинности означает, что учетные данные Azure Active Directory были указаны неправильно. Сведения о том, как правильно настроить учетную запись Azure Active Directory, см. в записи блога об [аутентификации в Azure с помощью Azure Active Directory](https://azure.microsoft.com/blog/azure-automation-authenticating-to-azure-using-azure-active-directory/).  

### <a name="scenario-unable-to-find-the-azure-subscription"></a>Сценарий: не удается найти подписку Azure
**Ошибка:** при работе с командлетами Select-AzureSubscription или Select-AzureSubscription возникает ошибка "Подписка с именем ``<subscription name>`` не найдена".

**Причина ошибки** : эта ошибка возникает, если недействительно имя подписки, а также если пользователь Azure Active Directory, который пытается получить сведения о подписке, не является ее администратором.

**Советы по устранению неполадки** : чтобы убедиться, что вы прошли аутентификацию в Azure и получили доступ к требуемой подписке, сделайте следующее.  

1. Убедитесь, что вы выполняете командлет **Add-AzureAccount** перед командлетом **Select-AzureSubscription**.  
2. Если это сообщение об ошибке не исчезло, измените код, добавив командлет **Get-AzureSubscription** после командлета **Add-AzureAccount**, а затем выполните код. Теперь проверьте, содержат ли выходные данные командлета Get-AzureSubscription сведения о подписке.  

   * Если вы не видите сведения о подписке в выходных данных, это означает, что подписка еще не инициализирована.  
   * Если сведения о подписке отображаются в выходных данных, убедитесь, что с командлетом **Select-AzureSubscription** используется правильное имя или идентификатор подписки.   

### <a name="scenario-authentication-to-azure-failed-because-multi-factor-authentication-is-enabled"></a>Сценарий: не удается выполнить проверку подлинности в Azure из-за включенной многофакторной проверки подлинности
**Ошибка:** сообщение об ошибке «Add-AzureAccount: AADSTS50079: регистрации строгой проверки подлинности (подтверждение до) является обязательным» при проверке подлинности в Azure с помощью Azure имени пользователя и пароля.

**Причина ошибки** : если в учетной записи Azure активирована многофакторная проверка подлинности, применять пользователя Azure Active Directory для аутентификации в Azure нельзя. Вместо этого при проверке подлинности в Azure используйте сертификат или субъект-службу.

**Советы по устранению неполадок:** использовать сертификат с помощью командлетов развертывания Azure классической модели, см. [Создание и добавление сертификата для управления службами Azure.](http://blogs.technet.com/b/orchestrator/archive/2014/04/11/managing-azure-services-with-the-microsoft-azure-automation-preview-service.aspx) Сведения об использовании субъекта-службы с командлетами диспетчера ресурсов Azure см. в статьях о [создании субъекта-службы с помощью портала Azure](../azure-resource-manager/resource-group-create-service-principal-portal.md) и [аутентификации субъекта-службы в диспетчере ресурсов Azure](../azure-resource-manager/resource-group-authenticate-service-principal.md).

## <a name="common-errors-when-working-with-runbooks"></a>Распространенные ошибки при работе с модулями Runbook
### <a name="scenario-the-runbook-job-start-was-attempted-three-times-but-it-failed-to-start-each-time"></a>Сценарий: было предпринято три попытки запуска задания Runbook, но все они были неудачными
**Ошибка:** runbook завершается с ошибкой ««задание была предпринята попытка три раза, но его не удалось.»

**Причина ошибки:** эта ошибка может вызываться описанными ниже причинами.  

1. Предельный объем памяти. Существуют документированные ограничения на объем памяти, выделенной в "песочнице" [ограничения службы автоматизации](../azure-subscription-service-limits.md#automation-limits) , задание может выполнять отработку отказа при использовании более 400 МБ памяти. 

2. Модуль несовместим. Это может произойти, если зависимости модулей заданы неправильно, и если они не runbook обычно возвращает «команда не найдено» или «Не удается привязать параметр» сообщения. 

**Советы по устранению неполадок:** любой из следующих решений устранить проблему:

* Чтобы работа выполнялась в заданных пределах объема памяти, рекомендуется разделить рабочую нагрузку между несколькими модулями Runbook, не обрабатывать слишком большой объем данных в памяти, не записывать ненужные выходные данные из модулей Runbook или учитывать, сколько контрольных точек записывается в модули Runbook рабочих процессов PowerShell.  

* Обновить Azure модули, выполнив действия [обновление модули Azure PowerShell в службе автоматизации Azure](automation-update-azure-modules.md).  


### <a name="scenario-runbook-fails-because-of-deserialized-object"></a>Сценарий: сбой модуля Runbook из-за десериализованного объекта
**Ошибка:** выполнение модуля Runbook завершается ошибкой "Не удается привязать параметр ``<ParameterName>``. Не удается преобразовать значение ``<ParameterType>`` десериализированного типа ``<ParameterType>`` в тип ``<ParameterType>``".

**Причина ошибки:** когда модуль Runbook является рабочим процессом PowerShell, он хранит сложные объекты в десериализированном формате. Это позволяет сохранить состояние модуля при приостановке рабочего процесса.

**Советы по устранению неполадок:** любой из следующих трех решений этой проблемы:

1. Если сложные объекты передаются от одного командлета к другому через конвейер, включите эти командлеты в InlineScript.
2. Передайте только требуемое имя или значение сложного объекта, а не весь объект.
3. Используйте модуль Runbook PowerShell, а не модуль Runbook рабочего процесса PowerShell.

### <a name="scenario-runbook-job-failed-because-the-allocated-quota-exceeded"></a>Сценарий: не удается выполнить задание модуля Runbook из-за превышения выделенной квоты
**Ошибка:** задание модуля Runbook завершается ошибкой "Квота ежемесячного общего времени выполнения заданий для этой подписки исчерпана".

**Причина ошибки:** эта ошибка возникает, когда время выполнения задания превышает квоту в 500 бесплатных минут для вашей учетной записи. Эта квота применяется ко всем типам задач при выполнении задания, включая тестирование задания, запуск задания на портале, выполнение задания с помощью веб-перехватчиков, а также планирование задания с помощью портала Azure или центра обработки данных. Дополнительные сведения о ценах для автоматизации см. в разделе [цены автоматизации](https://azure.microsoft.com/pricing/details/automation/).

**Советы по устранению неполадок:** Если вы хотите использовать более 500 минут обработки в месяц, необходимо изменить подписку из бесплатный уровень на уровень Basic. Это можно сделать так.  

1. Войдите в свою подписку Azure.  
2. Выберите учетную запись службы автоматизации, которую вы хотите обновить.  
3. Щелкните **Параметры** > **Цены**.
4. Нажмите кнопку **Включить** в нижней части страницы, чтобы обновить свою учетную запись до уровня **Базовый**.

### <a name="scenario-cmdlet-not-recognized-when-executing-a-runbook"></a>Сценарий: не удается распознать командлет при выполнении модуля Runbook
**Ошибка:** задание модуля Runbook завершается ошибкой "``<cmdlet name>``: выражение ``<cmdlet name>`` не распознано как имя командлета, функции, файла сценария или исполняемой программы".

**Причина ошибки** : эта ошибка возникает, когда модулю PowerShell не удается найти командлет, который используется в модуле Runbook. Такое случается, когда в учетной записи отсутствует модуль, содержащий командлет, когда возникает конфликт имен с именем модуля Runbook, а также когда командлет существует и в другом модуле, а службе автоматизации не удается разрешить имя.

**Советы по устранению неполадок:** любой из следующих решений устранить проблему:  

* Проверьте правильность ввода имени командлета.  
* Убедитесь, что командлет существует в учетной записи службы автоматизации, а конфликты отсутствуют. Чтобы проверить наличие командлета, откройте модуль Runbook в режиме редактирования и найдите требуемый командлет в библиотеке или выполните **Get-Command ``<CommandName>``**. Убедившись в наличии командлета в учетной записи и отсутствии конфликта имен с другими командлетами или модулями Runbook, добавьте его на холст. При этом в модуле Runbook должен использоваться допустимый набор параметров.  
* Если обнаружен конфликт имен, а сам командлет доступен в двух разных модулях, проблему можно решить использованием полного имени командлета. Например, можно использовать следующий формат: **имя_модуля\имя_командлета**.  
* Если модуль Runbook выполняется на локальном компьютере в гибридном компоненте Worker, на компьютере с гибридным компонентом Worker должен быть установлен соответствующий модуль или командлет.

### <a name="scenario-a-long-running-runbook-consistently-fails-with-the-exception-the-job-cannot-continue-running-because-it-was-repeatedly-evicted-from-the-same-checkpoint"></a>Сценарий: долго работающий модуль Runbook постоянно выдает исключение "Невозможно продолжить выполнение задания, поскольку оно было несколько раз прекращено до достижения контрольной точки".
**Причина ошибки.** Эта реакция на событие связана с мониторингом справедливого распределения процессов в службе автоматизации Azure, которая автоматически приостанавливает любой модуль Runbook, выполняемый дольше 3 часов. В то же время сообщение об ошибке не дает пользователю варианты дальнейших действий. Модуль Runbook может быть приостановлен по целому ряду причин. Чаще всего приостановка связана с какой-либо ошибкой. Например неперехваченное исключение в модуле runbook, сбой сети или сбоя в рабочем процессе Runbook, выполнение runbook, все причина приостановку и начать с последней контрольной точки при возобновлении runbook.

**Советы по устранению неполадок.** Задокументированный способ предотвращения этой проблемы — использовать в рабочем процессе контрольные точки. Дополнительные сведения см. в статье [Изучение рабочего процесса Windows PowerShell](automation-powershell-workflow.md#checkpoints). Более подробно справедливое распределение процессов и контрольные точки описываются в записи блога [Azure Automation: Reliable, Fault-Tolerant Runbook Execution Using Checkpoints](https://azure.microsoft.com/blog/azure-automation-reliable-fault-tolerant-runbook-execution-using-checkpoints/) (Служба автоматизации Azure: надежное и отказоустойчивое выполнение модулей Runbook с помощью контрольных точек).

## <a name="common-errors-when-importing-modules"></a>Распространенные ошибки при импорте модулей
### <a name="scenario-module-fails-to-import-or-cmdlets-cant-be-executed-after-importing"></a>Сценарий: не удается импортировать модуль или командлеты не выполняются после импорта
**Ошибка** : не модулю удается осуществить импорт, либо импорт выполнен успешно, но командлеты не извлекаются.

**Причина ошибки** : наиболее распространенные причины, из-за которых модуль не может успешно завершить импорт в службу автоматизации Azure, следующие.

* Структура не соответствует той, которая требуется для службы автоматизации.
* Модуль зависит от другого модуля, который не был развернут для учетной записи службы автоматизации.
* В папке отсутствуют зависимости модуля.
* Командлет **New-AzureRmAutomationModule** используется для передачи модуля, при этом полный путь для хранения не указан или модуль не загружен с помощью общедоступного URL-адреса.

**Советы по устранению неполадок:** любой из следующих решений устранить проблему:

* Убедитесь, что модуль следует следующий формат: ModuleName.Zip  **->**  ModuleName или номер версии  **->**  (ModuleName.psm1, ModuleName.psd1)
* Откройте файл PSD1 и проверьте, есть ли у модуля зависимости. Если зависимости есть, отправьте эти модули в учетную запись службы автоматизации.
* Убедитесь, что все указанные библиотеки DLL находятся в папке модуля.

## <a name="common-errors-when-working-with-desired-state-configuration-dsc"></a>Распространенные ошибки при настройке требуемого состояния (DSC)
### <a name="scenario-node-is-in-failed-status-with-a-not-found-error"></a>Сценарий: Узел находится в состоянии сбоя с ошибкой «Не найдено»
**Ошибка:** узел имеет отчет с **сбой** состояние и с ошибкой «попытка получить действие из сервера https://``<url>``//accounts/ ``<account-id>`` /Nodes(AgentId=``<agent-id>``) / GetDscAction не удалось, так как допустимую конфигурацию ``<guid>`` не найден.»

**Причина ошибки.** Эта ошибка обычно возникает из-за того, что узлу назначается имя конфигурации (например, "ABC") вместо имени конфигурации узла (например, "ABC.WebServer").

**Советы по устранению неполадок:**

* Убедитесь, что вы назначаете узлу "имя конфигурации узла", а не "имя конфигурации".
* Конфигурацию узла можно назначить узлу с помощью портала Azure или с помощью командлета PowerShell.

  * Чтобы назначить узлу конфигурацию узла с помощью портала Azure, откройте страницу **Узлы DSC**, затем выберите узел и нажмите кнопку **Назначить конфигурацию узла**.  
  * Чтобы назначить узлу конфигурацию узла с помощью PowerShell, используйте командлет **Set-AzureRmAutomationDscNode** .

### <a name="scenario-no-node-configurations-mof-files-were-produced-when-a-configuration-is-compiled"></a>Сценарий: при компиляции конфигурации не были созданы файлы конфигурации узла (MOF-файлы).
**Ошибка:** приостанавливает задание компиляции DSC с ошибкой: «Компиляция завершена успешно, но были сформированы не .mofs конфигурации узла».

**Причина ошибки:** при следующее выражение **узел** ключевое слово в конфигурации DSC, результатом которого является `$null`, то не создаются никакие настройки узла.

**Советы по устранению неполадок:** любой из следующих решений устранить проблему:

* Убедитесь, что выражение рядом с ключевым словом **Node** в определении конфигурации не равно $null.
* Если при компиляции конфигурации вы передаете ConfigurationData, то убедитесь, что передаются ожидаемые значения из [ConfigurationData](automation-dsc-compile.md#configurationdata), которые необходимы конфигурации.

### <a name="scenario-the-dsc-node-report-becomes-stuck-in-progress-state"></a>Сценарий: Отчет узла DSC перестает отвечать состоянии «выполняется»
**Ошибка:** агент DSC выдает «Экземпляр не найден с заданными значениями свойств.»

**Причина ошибки** : вы обновили свою версию WMF, что привело к повреждению WMI.

**Советы по устранению неполадок:** для устранения проблемы выполните инструкции в [DSC известные проблемы и ограничения](https://msdn.microsoft.com/powershell/wmf/5.0/limitation_dsc) статьи.

### <a name="scenario-unable-to-use-a-credential-in-a-dsc-configuration"></a>Сценарий: не удается использовать учетные данные в конфигурации DSC
**Ошибка:** задания компиляции DSC было приостановлено с ошибкой: «System.InvalidOperationException ошибка при обработке свойство «Учетные данные» типа ``<some resource name>``: преобразуя и сохраняя зашифрованный пароль в виде обычного текста допустим только в том случае, если PSDscAllowPlainTextPassword задано значение true».

**Причина ошибки:** вы использовали учетные данные в конфигурации, но не передали соответствующие данные **ConfigurationData**, чтобы присвоить **PSDscAllowPlainTextPassword** значение true для конфигурации каждого узла.

**Советы по устранению неполадок:**

* Передайте правильные данные **ConfigurationData**, чтобы присвоить **PSDscAllowPlainTextPassword** значение true для конфигурации каждого узла. Дополнительные сведения см. в разделе [средств в Azure Automation DSC](automation-dsc-compile.md#assets).

## <a name="common-errors-when-onboarding-solutions"></a>Распространенные ошибки при адаптации решения

При адаптации решения могут возникнуть ошибки. Ниже приведен список наиболее распространенных ошибок, которые можно встретить.

### <a name="computergroupqueryformaterror"></a>ComputerGroupQueryFormatError

**Причина ошибки:**

Данный код ошибки означает, что сохраненный поисковый запрос группы компьютеров, используются для работы решения не отформатированы надлежащим образом. Изменить запрос, или оно могло быть изменено в системе.

**Советы по устранению неполадок:**

Можно удалить запрос для этого решения и решения, которое воссоздает запрос reonboard. Запрос может быть найден в рабочей области в разделе **сохраненные поисковые запросы**. Имя запроса — **MicrosoftDefaultComputerGroup**, и категория запроса — это имя решения, связанные с этим запросом. Если включены несколько решений, **MicrosoftDefaultComputerGroup** области отображается несколько раз **сохраненные условия поиска**.

## <a name="next-steps"></a>Дальнейшие действия

Если выполнены предыдущие шаги по устранению неполадок и не удается найти ответ, вы можете просмотреть дополнительную поддержку, следующие параметры:

* Обратитесь за помощью к экспертам Azure. Отправить проблему для [форумы MSDN Azure или переполнения стека](https://azure.microsoft.com/support/forums/).
* Отправьте запрос в службу поддержки Azure Перейдите на [сайт службы поддержки Azure](https://azure.microsoft.com/support/options/) и в разделе **Technical and billing support** (Поддержка по выставлению счетов и техническая поддержка) щелкните **Получить поддержку**.
* Опубликуйте запрос на сценарий на странице [Центр скриптов](https://azure.microsoft.com/documentation/scripts/) , если вы ищете модуль интеграции или определенное решение для службы автоматизации Azure, в котором используются модули Runbook.
* Оставьте свой отзыв или запрос на ту или иную функцию для службы автоматизации Azure на [странице отзывов](https://feedback.azure.com/forums/34192--general-feedback).
