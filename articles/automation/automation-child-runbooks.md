<properties 
   pageTitle="Дочерние модули Runbook в службе автоматизации Azure | Microsoft Azure"
   description="Описывает различные методы запуска Runbook в службе автоматизации Azure из другого Runbook и обмена информацией между ними."
   services="automation"
   documentationCenter=""
   authors="bwren"
   manager="stevenka"
   editor="tysonn" />
<tags 
   ms.service="automation"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="02/18/2016"
   ms.author="magoedte;bwren" />

# Дочерние модули Runbook в службе автоматизации Azure


Рекомендуется создавать в службе автоматизации Azure повторно используемые модульные Runbook с отдельной функцией, которую могут использовать другие Runbook. Родительский Runbook часто будет вызывать один или несколько дочерних Runbook для выполнения требуемых функций. Существует два способа вызвать дочерний Runbook, и у каждого из них есть определенные отличия, которые следует понимать, чтобы определить, какой способ наилучшим образом подходит для тех или иных сценариев.

##  Вызов дочернего Runbook с использованием встроенного выполнения

Чтобы вызвать Runbook изнутри другого Runbook, используйте имя Runbook и укажите значения его параметров точно так же, как при использовании действия или командлета. Так все Runbook в одной учетной записи службы автоматизации доступны для использования всем остальным. Родительский Runbook ожидает завершения работы дочернего Runbook, прежде чем перейти к следующей строке, и любые выходные данные возвращаются непосредственно в родительский Runbook.

При встроенном вызове дочерний Runbook выполняется в той же задаче, что и родительский Runbook. В журнале заданий дочернего Runbook не будет записей о его выполнении. Любые исключения и любой потоковый вывод дочернего Runbook будут связаны с родительским Runbook. Это уменьшает число заданий и упрощает отслеживание и устранение неполадок, так как все исключения, порождаемые дочерним Runbook, и любой его потоковый вывод связан с родительским заданием.

При публикации Runbook все дочерние Runbook, которые он вызывает, уже должны быть опубликованы. Это связано с тем, что служба автоматизации Azure создает связь с любыми дочерними Runbook при компиляции Runbook. В противном случае родительский компонент Runbook будет отображаться как доступный для публикации, но будет выдавать исключение при запуске. В этом случае можно повторно опубликовать родительский Runbook, чтобы исправить ссылки на дочерние Runbook. Не надо повторно публиковать родительский Runbook, если были изменены все дочерние Runbook, так как связь уже будет создана.

Параметры дочернего Runbook со встроенным вызовом могут иметь любой тип данных, включая сложные объекты. Также отсутствует [сериализация JSON](automation-starting-a-runbook.md#runbook-parameters), как при запуске Runbook с помощью портала управления Azure или командлета Start-AzureAutomationRunbook.

### Типы Runbook

Вам не удастся использовать [Runbook рабочего процесса PowerShell](automation-runbook-types.md#powershell-workflow-runbooks) или [графический Runbook](automation-runbook-types.md#graphical-runbooks) в качестве дочернего элемента в [Runbook PowerShell](automation-runbook-types.md#powershell-runbooks) с помощью встроенного выполнения. Аналогично, вам не удастся использовать компонент Runbook PowerShell в качестве дочернего элемента с помощью встроенного выполнения в графическом компоненте icalrunbook или в компоненте Runbook рабочего процесса PowerShell. Runbook PowerShell могут использовать в качестве дочерних элементов только другие PowerShell. Графические Runbook и Runbook рабочего процесса PowerShell могут использовать друг друга в качестве дочерних Runbook.

При вызове графического Runbook и Runbook рабочего процесса PowerShell с помощью встроенного выполнения просто используйте имя необходимого Runbook. При вызове дочернего Runbook PowerShell необходимо перед его именем использовать сочетание символов *.\*, чтобы указать, что сценарий находится в локальном каталоге.

### Пример

В следующем примере вызывается тестовый дочерний Runbook, который принимает три параметра: сложный объект, целое число и логическое значение. Выходные данные дочернего Runbook присваиваются переменной. В этом случае дочерний Runbook представляет собой Runbook рабочего процесса PowerShell.

	$vm = Get-AzureVM –ServiceName "MyVM" –Name "MyVM"
	$output = Test-ChildRunbook –VM $vm –RepeatCount 2 –Restart $true

Ниже приведен тот же пример с использованием Runbook PowerShell в качестве дочернего элемента.

	$vm = Get-AzureVM –ServiceName "MyVM" –Name "MyVM"
	$output = .\Test-ChildRunbook.ps1 –VM $vm –RepeatCount 2 –Restart $true


##  Запуск дочернего Runbook с помощью командлета

Чтобы запустить Runbook, воспользуйтесь командлетом [Start-AzureAutomationRunbook](http://msdn.microsoft.com/library/dn690259.aspx), как описано в статье [Запуск Runbook с помощью Windows PowerShell](../automation-starting-a-runbook.md#starting-a-runbook-with-windows-powershell). При запуске дочернего Runbook из командлета родительский Runbook перейдет к следующей строке сразу после создания задания для дочернего Runbook. Если необходимо извлечь выходные данные из Runbook, то следует получить доступ к заданию с помощью командлета [Get AzureAutomationJobOutput](http://msdn.microsoft.com/library/dn690268.aspx).

Задание дочернего Runbook, запущенного с помощью командлета, будет выполняться отдельно от задания родительского Runbook. Это порождает больше заданий, чем при встроенном вызове компонента runbook, и усложняет их отслеживание. Родительский Runbook может запустить несколько дочерних Runbook, не ожидая завершения каждого из них. Для такого параллельного выполнения дочерних Runbook с помощью встроенного вызова в родительском Runbook потребуется использовать [ключевое слово parallel](automation-powershell-workflow.md#parallel-processing).

Параметры дочернего Runbook, запускаемого с помощью командлета, предоставляются в виде хэш-таблицы, как описано в статье [Параметры Runbook](automation-starting-a-runbook.md#runbook-parameters). Можно использовать только простые типы данных. Если у Runbook есть параметр со сложным типом данных, то для него необходимо использовать встроенный вызов.

### Пример

В следующем примере запускается дочерний Runbook с параметрами и ожидается его завершение. После завершения его выходные данные собираются из задания родительским Runbook.

	$params = @{"VMName"="MyVM";"RepeatCount"=2;"Restart"=$true} 
	$job = Start-AzureAutomationRunbook –AutomationAccountName "MyAutomationAccount" –Name "Test-ChildRunbook" –Parameters $params
	
	$doLoop = $true
	While ($doLoop) {
	   $job = Get-AzureAutomationJob –AutomationAccountName "MyAutomationAccount" -Id $job.Id
	   $status = $job.Status
	   $doLoop = (($status -ne "Completed") -and ($status -ne "Failed") -and ($status -ne "Suspended") -and ($status -ne "Stopped") 
	}
	
	Get-AzureAutomationJobOutput –AutomationAccountName "MyAutomationAccount" -Id $job.Id –Stream Output

[Start-ChildRunbook](http://gallery.technet.microsoft.com/scriptcenter/Start-Azure-Automation-1ac858a9) — это вспомогательный Runbook из коллекции TechNet, используемый для запуска Runbook из командлета. Это дает возможность дождаться завершения дочернего Runbook и извлечь выходные данные. Помимо использования этого Runbook в собственной среде службы автоматизации Azure, его можно использовать в качестве эталона для работы с модулями Runbook и заданиями с помощью командлетов. Сам вспомогательный Runbook должен быть вызван с помощью встроенного вызова, так как ему требуется параметр хэш-таблицы, чтобы принять значения параметров для дочернего Runbook.


## Сравнение методов вызова дочернего Runbook

В следующей таблице перечислены различия между двумя методами вызова Runbook из другого Runbook.

| | Встроенный| Командлет|
|:---|:---|:---|
|Job|Дочерние Runbook выполняются в том же задании, что и родительский.|Для дочернего Runbook создается отдельное задание.|
|Выполнение|Родительский Runbook ожидает завершения дочернего Runbook, прежде чем продолжить выполнение.|Родительский Runbook продолжает выполнение сразу после запуска дочернего Runbook.|
|Выходные данные|Родительский Runbook может получить выходные данные непосредственно из дочернего Runbook.|Родительский Runbook должен извлекать выходные данные из задания дочернего Runbook.|
|Параметры|Значения параметров дочернего Runbook указываются отдельно и могут иметь любой тип данных.|Значения параметров дочернего Runbook должны быть объединены в одну хэш-таблицу и могут содержать только простые, регулярные и объектные типы данных, использующие сериализацию JSON.|
|Учетная запись службы автоматизации|Родительский Runbook может использовать только дочерний Runbook, находящийся в той же учетной записи автоматизации.|Родительский Runbook может использовать дочерний Runbook из любой учетной записи автоматизации в той же подписке Azure и даже в другой подписке, если к ней есть подключение.|
|Публикация|Перед публикацией родительского Runbook должен быть опубликован дочерний Runbook.|Дочерний Runbook должен быть опубликован в любое время до запуска родительского Runbook.|

## Связанные статьи

- [Запуск модуля Runbook в службе автоматизации Azure](automation-starting-a-runbook.md)
- [Выходные данные и сообщения Runbook в службе автоматизации Azure](automation-runbook-output-and-messages.md)

<!---HONumber=AcomDC_0224_2016-->