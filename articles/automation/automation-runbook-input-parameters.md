<properties 
   pageTitle="Входные параметры Runbook"
   description="Возможность настройки входных параметров увеличивает гибкость модулей Runbook, позволяя передавать данные в уже запущенный модуль. В этой статье описаны различные сценарии использования входных параметров в модулях Runbook."
   services="automation"
   documentationCenter=""
   authors="SnehaGunda"
   manager="stevenka"
   editor="tysonn" />
<tags 
   ms.service="automation"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="12/16/2015"
   ms.author="sngun"/>

# Входные параметры Runbook

Возможность настройки входных параметров увеличивает гибкость модулей Runbook, позволяя передавать данные в уже запущенный модуль. За счет настройки параметров можно оптимизировать действия Runbook согласно определенным сценариям и средам. В этой статье подробно описаны различные сценарии использования входных параметров в модулях Runbook.

## Настройка входных параметров

Входные параметры настраиваются в модулях Runbook PowerShell рабочих процессов PowerShell и в графических модулях Runbook. Runbook может использовать несколько параметров с разными типами данных или вообще не использовать параметры. Входные параметры могут быть обязательными или необязательными. Для необязательных параметров можно назначать значения по умолчанию. Входным параметрам Runbook можно назначать значения при запуске модуля. Для этого подходит любой доступный метод, в том числе запуск через пользовательский интерфейс, объекты Webhook, веб-службы, а также через другой Runbook при помощи встроенного вызова дочернего модуля.

## Настройка входных параметров в модулях Runbook PowerShell и рабочих процессов PowerShell

[Модули Runbook рабочих процессов PowerShell](automation-first-runbook-textual.md) и Runbook PowerShell в службе автоматизации Azure поддерживают входные параметры, для определения которых используются следующие атрибуты:

| **Свойство** | **Описание** |
|:--- |:---|
| Тип | обязательный параметр. Предполагаемый тип данных значения параметра. Допускаются любые типы .Net. |
| Имя | обязательный параметр. Имя параметра. Оно должно быть уникальным для Runbook, может содержать только буквы, цифры или символы подчеркивания и должно начинаться с буквы. |
| Обязательно | необязательный параметр. Указывает, должно ли быть указано значение для параметра. Если установлено значение **$true**, то при запуске модуля будет необходимо указывать значение. Если установлено значение **$false**, указывать значение необязательно. |
| Значение по умолчанию | необязательный параметр. Указывает значение, используемое для параметра, если при запуске модуля не передано значение. Для любого параметра можно задать значение по умолчанию. Как результат, параметр автоматически станет необязательным независимо от значения параметра «Обязательный». |

Windows PowerShell поддерживает больше атрибутов входных параметров, чем перечислено здесь, например атрибуты проверки, псевдонимов, наборов параметров. Однако служба автоматизации Azure сейчас поддерживает только вышеперечисленные параметры.

Для определения параметров модулей Runbook рабочих процессов PowerShell используется следующий общий формат, где несколько параметров разделяются запятыми.

```
     Param
     (
         [Parameter (Mandatory= $true/$false)]
         [Type] Name1 = <Default value>,

         [Parameter (Mandatory= $true/$false)]
         [Type] Name2 = <Default value>
     ) 
```

>[AZURE.NOTE]Если не указать атрибут **Mandatory** при определении параметров, то по умолчанию параметр будет необязательным. Кроме того, если в модуле Runbook рабочих процессов PowerShell задать для параметра значение по умолчанию, он будет необязательным в PowerShell независимо от значения атрибута **Mandatory**.

К примеру, настроим входные параметры Runbook рабочего процесса PowerShell, который выводит сведения об одной или всех виртуальных машинах в службе. Как показано на снимке экрана ниже, у такого модуля Runbook будет два параметра — параметр имени виртуальной машины и имени службы.

![Рабочий процесс PowerShell службы автоматизации](media/automation-runbook-input-parameters/automation_01_PowerShellWorkflow.png)

В этом определении **$VMName** и **$ServiceName** — обычные параметры строкового типа. Однако модули Runbook PowerShell и рабочих процессов PowerShell поддерживают все простые и сложные типы входных параметров, такие как **object** или **PSCredential**.

Чтобы передать значение при наличии в Runbook входного параметра типа [object], следует использовать хэш-таблицу PowerShell с парами (имя-значение). Например, если в Runbook есть такой параметр

     [Parameter (Mandatory = $true)]
     [object] $FullName

вы можете передать для него следующее значение:

    @{"FirstName"="Joe";"MiddleName"="Bob";"LastName"="Smith"}


## Настройка входных параметров в графических модулях Runbook

Чтобы показать, как настроить графический Runbook, мы создадим [графический модуль Runbook](automation-first-runbook-graphical.md), который выводит сведения об одной или всех виртуальных машинах в службе. Такой модуль предусматривает выполнение двух основных действий:

* [**Add-AzureAccount**](https://msdn.microsoft.com/library/dn495128.aspx) — для проверки подлинности в Azure.
* [**Get-AzureVM**](https://msdn.microsoft.com/library/azure/dn495236.aspx) — для получения всех виртуальных машин.

Для вывода имен виртуальных машин можно использовать действие [**Write-Output**](https://technet.microsoft.com/library/hh849921.aspx). Действие **Get-AzureVM** принимает два параметра — **имя виртуальной машины** и **имя учетной записи службы**. Так как при каждом запуске Runbook для этих параметров могут требоваться различные значения, вы можете добавить в модуль входные параметры. Их добавление предусматривает три шага:

1. В колонке **Модули Runbook** выберите графический модуль Runbook и [измените](automation-graphical-authoring-intro.md) его. 

2. В колонке **Изменить** щелкните **Входные и выходные данные**, чтобы открыть колонку **Входные и выходные данные**.

    ![Графический модуль Runbook службы автоматизации](media/automation-runbook-input-parameters/automation_02_GraphicalRunbook.png)

 
3. В колонке **Входные и выходные данные** отображается список входных параметров, определенных для Runbook. В этой колонке можно добавить новый входной параметр или изменить конфигурацию существующего. Чтобы добавить новый параметр для Runbook, щелкните **Добавить входные данные**. Откроется колонка «Входные параметры Runbook», где можно настроить следующие параметры:

    | **Свойство** | **Описание** |
    |:--- |:---|
    | Имя | обязательный параметр. Имя параметра. Оно должно быть уникальным для Runbook, может содержать только буквы, цифры или символы подчеркивания и должно начинаться с буквы. |
    | Описание | необязательный параметр. Описание предназначения входного параметра. |
    | Тип | необязательный параметр. Предполагаемый тип данных значения параметра. Поддерживаются параметры строкового, логического, объектного типа, а также типа Int32, Int64, DateTime и типа десятичного числа. Если тип данных не выбран, то по умолчанию используется значение строкового типа. |
    | Обязательно | необязательный параметр. Указывает, должно ли быть указано значение для параметра. Если для переключателя установлено положение **Да**, при запуске модуля будет необходимо указывать значение. Если для переключателя установлено положение **Нет**, ввод значения при запуске модуля не будет обязательным и можно установить значение по умолчанию. |
    | Значение по умолчанию | необязательный параметр. Указывает значение, используемое для параметра, если при запуске модуля не передано значение. Значение по умолчанию можно задать для необязательного параметра. Чтобы установить значение по умолчанию, можно установить переключатель в положение **Пользовательское**. Это значение используется, если при запуске модуля не указано другое значение. Установите переключатель в положение **Нет**, если не нужно использовать значения по умолчанию. |  

    ![AddNewInput](media/automation-runbook-input-parameters/automation_03_AddNewInput.png)

4. Создайте два параметра со следующими свойствами, которые будут использоваться для действия **Get-AzureVM**:

    * **Параметр1:** «Имя» — VMName, «Тип» — «Строковый», «Обязательный» — «Нет».
	
    * **Параметр2:** «Имя» — ServiceName, «Тип» — «Строковый», «Обязательный» — «Нет», «Значение по умолчанию» — «Пользовательское», «Пользовательское значение по умолчанию» — <имя службы по умолчанию, которая содержит виртуальные машины>.

5. После добавления параметров нажмите кнопку **ОК**. Теперь вы можете просмотреть их в колонке **Входные и выходные данные**. Нажмите кнопку **ОК** еще раз, а затем — **Сохранить** и **Опубликовать**, чтобы сохранить параметры и опубликовать модуль Runbook.

## Назначение значений входным параметрам в Runbook

Передавать значения для входных параметров в модули Runbook можно в сценариях, описанных ниже.

### Запуск Runbook и назначение параметров

Существует много способов для запуска модуля Runbook — с помощью пользовательского интерфейса портала Azure, объекта Webhook, командлетов PowerShell, REST API и пакета SDK. Ниже рассмотрены различные методы запуска Runbook и назначения параметров.

* **Запуск опубликованного модуля Runbook на портале Azure и назначение параметров**

При [запуске модуля Runbook](automation-starting-a-runbook#starting-a-runbook-with-the-azure-portal.md) открывается колонка **Запустить Runbook**, где можно настроить значения недавно созданных параметров.

![Начало работы с порталом](media/automation-runbook-input-parameters/automation_04_StartRunbookUsingPortal.png)

Надпись под текстовым полем ввода позволяет узнать атрибуты параметра: обязательный или необязательный, тип и значение по умолчанию. Подсказка рядом с именем параметра позволяет просмотреть все основные сведения, необходимые для принятия решений об установке входных значений параметра. В ней содержатся сведения о том, обязателен или необязателен параметр, тип параметра, значение по умолчанию и т. п.

![Подсказка](media/automation-runbook-input-parameters/automation_05_HelpBaloon.png)


>[AZURE.NOTE]Параметры строкового типа поддерживают **пустые** строковые значения. Если ввести **[EmptyString]** в текстовое поле входного параметра, ему будет передана пустая строка. Параметры строкового типа не поддерживают передачу значений **Null**. Если строковому параметру не передать значение, PowerShell интерпретирует отсутствие значения как значение null.

* **Запуск опубликованного модуля Runbook с помощью командлетов PowerShell и назначение параметров**

    * **Командлеты для управления службами Azure.** Модуль Runbook службы автоматизации, созданный в группе ресурсов по умолчанию, можно запустить с помощью командлета [Start-AzureAutomationRunbook](https://msdn.microsoft.com/library/dn690259.aspx).

    **Пример**

      ``` $params = @{“VMName”=”WSVMClassic”; ”ServiceName”=”WSVMClassicSG”}

        Start-AzureAutomationRunbook -AutomationAccountName “TestAutomation” -Name “Get-AzureVMGraphical” -Parameters $params
      ```


    * **Командлеты диспетчера ресурсов Azure.** Модуль Runbook службы автоматизации, созданный в группе ресурсов, можно запустить с помощью командлета [Start-AzureRMAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx).

    **Пример**

      ``` $params = @{“VMName”=”WSVMClassic”;”ServiceName”=”WSVMClassicSG”}

        Start-AzureRMAutomationRunbook -AutomationAccountName “TestAutomationRG” -Name “Get-AzureVMGraphical” –ResourceGroupName “RG1” -Parameters $params
      ```

>[AZURE.NOTE]При запуске модуля Runbook с помощью командлетов PowerShell наряду с передачей входных параметров создается параметр по умолчанию, **MicrosoftApplicationManagementStartedBy**, со значением **PowerShell**. Этот параметр можно просмотреть в колонке сведений о задании.

* **Запуск Runbook с использованием пакета SDK и назначение параметров**

    * **Метод, предусматривающий использование управления службами Azure**. Вы можете запустить Runbook, используя пакет SDK для языка программирования. Ниже приведен фрагмент кода C# для запуска модуля Runbook из своей учетной записи службы автоматизации. Весь код можно просмотреть в [репозитории GitHub](https://github.com/Azure/azure-sdk-for-net/blob/master/src/ServiceManagement/Automation/Automation.Tests/TestSupport/AutomationTestBase.cs).  

    ```      
        public Job StartRunbook(string runbookName, IDictionary<string, string> parameters = null)
        {
            var response = AutomationClient.Jobs.Create(automationAccount, new JobCreateParameters
            {
                Properties = new JobCreateProperties 
                {
                    Runbook = new RunbookAssociationProperty
                    {
                        Name = runbookName
                    },
                        Parameters = parameters
                }
            });
            return response.Job;
        }
    ```
      
    * **Метод, предусматривающий использование диспетчера ресурсов Azure.** Для запуска модуля Runbook можно использовать пакет SDK для языка программирования. Ниже приведен фрагмент кода C# для запуска модуля Runbook из своей учетной записи службы автоматизации. Весь код можно просмотреть в [репозитории GitHub](https://github.com/Azure/azure-sdk-for-net/blob/master/src/ResourceManagement/Automation/Automation.Tests/TestSupport/AutomationTestBase.cs).  

    ```
        public Job StartRunbook(string runbookName, IDictionary<string, string> parameters = null)
        {
           var response = AutomationClient.Jobs.Create(resourceGroup, automationAccount, new JobCreateParameters
           {
               Properties = new JobCreateProperties 
               {
                   Runbook = new RunbookAssociationProperty
                   {
                       Name = runbookName
                   },
                       Parameters = parameters
               }
           });
        return response.Job;
        }
    ```

Чтобы запустить этот метод, создайте словарь для хранения параметров Runbook, VMName и ServiceName, а также их значений и запустите модуль. Ниже приведен фрагмент кода C# для вызова метода, определенного выше.

```
    IDictionary<string, string> RunbookParameters = new Dictionary<string, string>();

    // Add parameters to the dictionary.
    RunbookParameters.Add("VMName", "WSVMClassic");
    RunbookParameters.Add("ServiceName", "WSVMClassicSG");

    //Call the StartRunbook method with parameters
    StartRunbook(“Get-AzureVMGraphical”, RunbookParameters);
```

* **Запуск Runbook с использованием REST API и назначение параметров**

Задание Runbook можно создать и запустить с помощью REST API службы автоматизации Azure. Для этого необходимо использовать метод **PUT** и следующий универсальный код ресурса (URI) запроса.

    https://management.core.windows.net/<subscription-id>/cloudServices/<cloud-service-name>/resources/automation/~/automationAccounts/<automation-account-name>/jobs/<job-id>?api-version=2014-12-08

В URI запроса замените следующие параметры:
 
* **subscription-id** — идентификатором своей подписки Azure.  
* **cloud-service-name** — именем облачной службы, в которую следует отправить запрос.  
* **automation-account-name** — именем учетной записи службы автоматизации в указанной облачной службе.  
* **job-id** — идентификатором GUID задания. Чтобы создать GUID в PowerShell, можно использовать командлет **[GUID]::NewGuid().ToString()**.
	
Чтобы передать параметры для задания Runbook, используйте текст запроса, который принимает два свойства в формате JSON:

* **Runbook Name** — обязательный параметр. Имя модуля Runbook для запуска задания.  
* **Runbook Parameters** — необязательный параметр. Это словарь со списком параметров (именами и значениями) в формате, где имя должно быть строкового типа, а значение может быть любым допустимым значением JSON. 

Если вы хотите запустить Runbook **Get AzureVMTextual**, созданный ранее с использованием параметров VMName и ServiceName, используйте следующий формат JSON в тексте запроса.

```
        {
           "properties":{
           "runbook":{
               "name":"Get-AzureVMTextual"
           },
           "parameters":{
               "VMName":"WSVMClassic",
               "ServiceName":”WSCS1”
           }
          }
       }
```

Если задание создано успешно, вернется код состояния HTTP 201. Дополнительные сведения о заголовках и тексте ответа см. в разделе [Создание задания Runbook с помощью REST API](https://msdn.microsoft.com/library/azure/mt163849.aspx).

### Тестирование Runbook и назначение параметров

Во время [тестирования](automation-testing-runbook.md) черновой версии модуля Runbook с использованием параметра тестирования откроется колонка **Тест**, где можно задать значения недавно созданных параметров.

![Тестирование и назначение параметров](media/automation-runbook-input-parameters/automation_06_TestAndAssignParameters.png)

### Связывание Runbook с расписанием и назначение параметров

Вы можете [связать расписание](automation-scheduling-a-runbook.md) с модулем, чтобы запускать Runbook в определенное время. При создании расписания пользователь назначает входные параметры, значения которых будут использоваться Runbook во время запуска согласно расписанию. Расписание нельзя сохранить, если не указаны значения для всех обязательных параметров.

![Создание расписания и назначение параметров](media/automation-runbook-input-parameters/automation_07_ScheduleAndAssignParameters.png)

### Создание объекта Webhook для модуля Runbook и назначение параметров

Для модуля Runbook можно создать объект [Webhook](automation-webhooks.md) и настроить входные параметры. Webhook нельзя сохранить, если не указаны значения для всех обязательных параметров.

![Создание Webhook и назначение параметров](media/automation-runbook-input-parameters/automation_08_CreateWebhookAndAssignParameters.png)

При выполнении Runbook с помощью объекта Webhook происходит отправка предопределенного входного параметра **[Webhookdata](automation-webhooks.md#details-of-a-webhook)** и входных параметров, определенных пользователем. Щелкните параметр WebhookData, чтобы развернуть его и просмотреть дополнительные сведения.

![Параметр WebhookData](media/automation-runbook-input-parameters/automation_09_WebhookDataParameter.png)


## Дальнейшие действия

- Дополнительные сведения о входных и выходных данных Runbook см. в записи блога [Служба автоматизации Azure. Входные данные и выходные данные Runbook. Вложенные модули Runbook](https://azure.microsoft.com/blog/azure-automation-runbook-input-output-and-nested-runbooks/).
- Дополнительные сведения о различных способах запуска модуля Runbook см. в статье [Запуск модуля Runbook](automation-starting-a-runbook.md).
- Сведения об изменении текстового модуля Runbook см. в статье [Изменение текстовых модулей Runbook](automation-edit-textual-runbook.md).
- Сведения об изменении графического модуля Runbook см. в статье [Графическая разработка в службе автоматизации Azure](automation-graphical-authoring-intro.md).

<!---HONumber=AcomDC_1223_2015-->