<properties
   pageTitle="Настройка службы автоматизации Azure"
   description="Описывает шаги, которые необходимо выполнить для настройки службы автоматизации Azure при первом использовании."
   services="automation"
   documentationCenter=""
   authors="SnehaGunda"
   manager="stevenka"
   editor="tysonn" />
<tags
   ms.service="automation"
   ms.devlang="na"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="02/18/2016"
   ms.author="magoedte;bwren" />

# Настройка службы автоматизации Azure

В этой статье описаны действия, которые необходимо выполнить, чтобы начать использовать службу автоматизации Azure.

## Учетные записи службы автоматизации

При первом запуске службы автоматизации Azure необходимо создать по крайней мере одну учетную запись службы автоматизации. Учетные записи службы автоматизации позволяют изолировать ваши ресурсы службы автоматизации (модули Runbook, ресурсы-контейнеры и конфигурации) от ресурсов, содержащихся в других учетных записях службы автоматизации. Учетные записи службы автоматизации можно использовать, чтобы разделить ресурсы службы автоматизации на отдельные логические среды. Например, можно использовать одну учетную запись для разработки, а другую — для рабочей среды.

Ресурсы службы автоматизации для каждой учетной записи службы автоматизации связаны с одним регионом Azure, но учетные записи службы автоматизации могут управлять службами Azure в любом регионе. Главной причиной создания учетных записей службы автоматизации в разных регионах может быть наличие политик, требующих изолировать данные и ресурсы в определенном регионе.

>[AZURE.NOTE] Учетные записи службы автоматизации и содержащиеся в них ресурсы, которые создаются с помощью портала Azure, недоступны на классическом портале Azure. Если требуется управлять этими учетными записями или их ресурсами с помощью Windows PowerShell, необходимо использовать модули диспетчера ресурсов Azure.
>
>Вы можете управлять учетными записями службы автоматизации, созданными с помощью классического портала Azure, на портале или с помощью набора командлетов. После создания учетной записи нет никакой разницы в том, как вы будете создавать ресурсы в этой учетной записи и управлять ими. Если вы планируете продолжать использовать классический портал Azure, вам нужно использовать его вместо портала Azure для создания учетных записей службы автоматизации.


Учетная запись службы автоматизации может быть приостановлена, если обнаружена проблема с учетной записью Azure, например, просроченный платеж. В этом случае вы не сможете получить доступ к учетной записи, будут приостановлены все запущенные задания и все расписания будут отключены. Можно будет просматривать учетную запись, но вы не будете видеть ресурсы в ней. После устранения проблемы и включения учетной записи службы автоматизации необходимо будет включить расписания и перезапустить все приостановленные модули Runbook.


## Настройка аутентификации для ресурсов Azure

При доступе к ресурсам Azure с помощью [командлетов Azure](http://msdn.microsoft.com/library/azure/jj554330.aspx) необходимо обеспечить аутентификацию своей подписки Azure. В службе автоматизации Azure это выполняется с помощью рабочей учетной записи в Azure Active Directory, настроенной в качестве администратора для вашей подписки. Затем можно создать [учетные данные](http://msdn.microsoft.com/library/dn940015.aspx) для этой учетной записи и использовать в [Add-AzureAccount](http://msdn.microsoft.com/library/azure/dn722528.aspx) в модуле Runbook.

>[AZURE.NOTE] Учетные записи Майкрософт, ранее известные как идентификаторы Live ID, не могут использоваться в службе автоматизации Azure.

## Создание нового пользователя Azure Active Directory для управления подпиской Azure

1. Войдите на классический портал Azure как администратор службы для подписки Azure, которой вы хотите управлять.
2. Выберите **Active Directory**.
3. Выберите имя каталога, связанного с вашей подпиской Azure. При необходимости можно изменить эту связь, выбрав **Параметры > Подписки > Изменить каталог**.
4. [Создайте нового пользователя Active Directory](http://msdn.microsoft.com/library/azure/hh967632.aspx). Выберите **Новый пользователь в вашей организации** для параметра **Тип пользователя** и не выбирайте параметр **Включение многофакторной проверки подлинности**.
5. Запишите полное имя пользователя и временный пароль.
7. Выберите **Параметры > Администраторы > Добавить**.
8. Введите полное имя пользователя, созданного вами.
9. Выберите подписку, которой этот пользователь будет управлять.
10. Выйдите из Azure, а затем войдите снова, используя только что созданную учетную запись. Вам будет предложено изменить пароль пользователя.
11. Создайте новый [ресурс учетных данных службы автоматизации Azure](automation-credentials.md) для созданной учетной записи. Для параметра **Тип учетных данных** следует выбрать **Учетные данные Windows PowerShell**.

## Создание учетной записи службы автоматизации

Учетная запись автоматизации — это контейнер для ресурсов в службе автоматизации Azure. Он позволяет разделять среды и дополнительно упорядочивать рабочие процессы. Если у вас уже есть учетная запись, этот шаг можно пропустить.

1. Войдите на [портал Azure](https://portal.azure.com/).

2. Щелкните **Создать** > **Управление** > **Учетная запись службы автоматизации**.

3. В колонке **Добавление учетной записи службы автоматизации** настройте параметры учетной записи.

>[AZURE.NOTE] Если учетная запись службы автоматизации создается с помощью портала Azure, учетная запись и все связанные с ней ресурсы не переносятся на классический портал Azure.

Далее приведен список настраиваемых параметров.

|Параметр |Описание |
|:---|:---|
| Имя | Имя учетной записи службы автоматизации (это должно быть уникальное значение). |
| Группа ресурсов | Группы ресурсов упрощают просмотр связанных ресурсов Azure и управление ими. На портале Azure для учетной записи службы автоматизации можно выбрать существующую группу ресурсов или создать новую. На классическом портале Azure все учетные записи службы автоматизации помещаются в группу ресурсов по умолчанию. |
| Подписка | Выберите подписку из списка доступных подписок. |
| Регион | Регион определяет, где будут храниться соответствующие ресурсы службы автоматизации. Вы можете выбрать любой регион из списка. Это не повлияет на функциональность учетной записи, но модули Runbook могут выполняться быстрее, если ресурсы Azure и учетная запись службы автоматизации будут храниться рядом. |
| Параметры учетной записи | Этот параметр позволяет выбрать, какие ресурсы будут создаваться в новой учетной записи службы автоматизации. Если выбрать **Да**, будет создан модуль Runbook из этого руководства. |

![Создание учетной записи](media/automation-configuration/automation-01-create-automation-account.png)

>[AZURE.NOTE] Если учетная запись службы автоматизации, созданная с помощью классического портала Azure, [перемещается в другую группу ресурсов](../resource-group-move-resources.md) с помощью портала Azure, такая учетная запись будет недоступна на классическом портале Azure.



## Использование учетных данных в Runbook

Учетные данные в Runbook можно получить с помощью действия [Get-AutomationPSCredential](http://msdn.microsoft.com/library/dn940015.aspx) и затем использовать их в [Add-AzureAccount](http://msdn.microsoft.com/library/azure/dn722528.aspx) для подключения к подписке Azure. Если это учетные данные администратора нескольких подписок Azure, то также следует использовать [Select-AzureSubscription](http://msdn.microsoft.com/library/dn495203.aspx), чтобы указать соответствующую подписку. Как показано в примере Windows PowerShell ниже, она обычно будет отображаться в верхней части большинства модулей Runbook службы автоматизации Azure.

    $cred = Get-AutomationPSCredential –Name "myuseraccount.onmicrosoft.com"
	Add-AzureAccount –Credential $cred
	Select-AzureSubscription –SubscriptionName "My Subscription"

Эти строки должны повторяться после любой [контрольной точки](http://technet.microsoft.com/library/dn469257.aspx#bk_Checkpoints) в Runbook. Если выполнение Runbook приостанавливается, а затем возобновляется другим работником, ему необходимо будет заново пройти аутентификацию.

## Связанные статьи
- [Служба автоматизации Azure: аутентификация в Azure с помощью Azure Active Directory](https://azure.microsoft.com/blog/2014/08/27/azure-automation-authenticating-to-azure-using-azure-active-directory/)
 

<!---HONumber=AcomDC_0224_2016-->