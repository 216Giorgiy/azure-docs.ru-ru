<properties
    pageTitle="Обработка оповещений виртуальной машины Azure с помощью модулей Runbook службы автоматизации | Microsoft Azure"
    description="В этой статье показано, как интегрировать оповещения виртуальной машины Azure с модулями Runbook службы автоматизации Azure и автоматически устранять проблемы"
    services="automation"
    documentationCenter=""
    authors="csand-msft"
    manager="stevenka"
    editor="tysonn" />    
<tags
    ms.service="automation"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="infrastructure-services"
    ms.date="04/11/2016"
    ms.author="csand;magoedte" />

# Решение службы автоматизации Azure: обработка оповещений виртуальной машины Azure

Для службы автоматизации Azure и виртуальных машин Azure доступна новая функция, которая позволяет настроить оповещения виртуальных машин для запуска модулей Runbook службы автоматизации. Эта новая возможность позволяет автоматически выполнять стандартное исправление в ответ на оповещения виртуальных машин, например перезапускать или останавливать виртуальную машину.

Ранее при создании правила оповещений виртуальной машины можно было [указать веб-перехватчик службы автоматизации](https://azure.microsoft.com/blog/using-azure-automation-to-take-actions-on-azure-alerts/), запускающий модуль Runbook при возникновении оповещения. Но для этого необходимо было создавать модуль Runbook, создавать веб-перехватчик для этого модуля и вставлять веб-перехватчик при создании правила оповещения. В этом новом выпуске процесс упростился. Теперь можно непосредственно выбрать модуль Runbook из списка при создании правила оповещения, а также выбрать учетную запись службы автоматизации, которая будет запускать модуль Runbook, или без труда создать такую учетную запись.

В этой статье мы покажем, насколько просто настроить оповещение виртуальной машины Azure и модуль Runbook службы автоматизации, чтобы он запускался при инициализации оповещения. Примеры сценариев включают перезапуск виртуальной машины, когда использование памяти превышает определенный предел из-за приложения на виртуальной машине с утечкой памяти, или остановку виртуальной машины, если время использования ЦП за последний час составляло меньше 1 % и если ЦП не используется. Кроме того, мы рассмотрим, как автоматическое создание субъекта-службы в учетной записи службы автоматизации упрощает использование модулей Runbook при обработке оповещений Azure.

## Создание оповещения на виртуальной машине

Выполните следующие действия, чтобы настроить оповещение для запуска модуля Runbook, когда достигается пороговое значение.

>[AZURE.NOTE] В этом выпуске поддерживаются только виртуальные машины V2. Поддержка классических виртуальных машин будет добавлена в ближайшее время.

1. Войдите на портал Azure и щелкните элемент **Виртуальные машины**.  
2. Выберите одну из виртуальных машин. Появится колонка панели мониторинга виртуальной машины, а справа от нее отобразится колонка **Параметры**.  
3. В колонке **Параметры**, в разделе "Мониторинг" выберите пункт **Правила оповещения**.
4. В колонке **Правила оповещения** выберите команду **Добавить оповещение**.

Откроется колонка **Добавление правила оповещения**, в которой можно настроить условия для оповещения и выбрать один или все варианты: отправить электронное сообщение, использовать веб-перехватчик для пересылки оповещения в другую систему и/или запустить модуль Runbook службы автоматизации, чтобы попытаться устранить проблему.

## Настройка модуля Runbook

Чтобы настроить модуль Runbook для запуска при достижении порога оповещения виртуальной машины, выберите пункт **Модуль Runbook службы автоматизации**. В колонке **Настройка модуля Runbook** можно выбрать модуль Runbook для запуска и учетную запись службы автоматизации, в которой необходимо запускать этот модуль.

![Настройка модуля Runbook службы автоматизации и создание учетной записи службы автоматизации](media/automation-azure-vm-alert-integration/ConfigureRunbookNewAccount.png)

>[AZURE.NOTE] В этом выпуске можно выбрать один из трех модулей Runbook, предоставляемых службой: "Перезапуск виртуальной машины", "Остановка виртуальной машины" или "Удаление виртуальной машины". Возможность выбора других или одного из собственных модулей Runbook будет доступна в будущих выпусках.

![Модули Runbook для выбора](media/automation-azure-vm-alert-integration/RunbooksToChoose.png)

После выбора одного из трех доступных модулей Runbook отобразится раскрывающийся список **Учетная запись службы автоматизации**, где можно выбрать учетную запись службы автоматизации, от имени которой будет запускаться модуль Runbook. Модули Runbook необходимо запускать в [учетной записи службы автоматизации](automation-security-overview.md), т. е. в вашей подписке Azure. Можно выбрать уже созданную учетную запись службы автоматизации или создать новую учетную запись.

Проверка подлинности предоставленных модулей Runbook выполняется в Azure с помощью субъекта-службы. Если вы решили запустить модуль Runbook в одной из существующих учетных записей службы автоматизации, субъект-служба будет создана автоматически. Если вы решили создать учетную запись службы автоматизации, субъект-служба будет создана автоматически вместе с учетной записью. В обоих случаях в учетной записи службы автоматизации будут созданы два ресурса: ресурс сертификата с именем **AzureRunAsCertificate** и ресурс подключения с именем **AzureRunAsConnection**. Модули Runbook будут использовать ресурс **AzureRunAsConnection** для проверки подлинности в Azure, чтобы выполнить действие управления для виртуальной машины.

>[AZURE.NOTE] Субъект-служба создается в области действия подписки и назначается роли участника. Эта роль необходима для того, чтобы учетная запись имела разрешение на запуск модулей Runbook службы автоматизации для управления виртуальными машинами Azure. Создание учетной записи службы автоматизации и/или субъекта-службы является одноразовым событием. После их создания эту учетную запись можно использовать для запуска модулей Runbook для оповещений других виртуальных машин Azure.

После нажатия кнопки **ОК** выполняется настройка оповещения. Если выбран вариант создания учетной записи службы автоматизации, она создается вместе с субъектом-службой. Для завершения этого процесса может понадобиться несколько секунд.

![Настройка модуля Runbook](media/automation-azure-vm-alert-integration/RunbookBeingConfigured.png)

После завершения настройки вы увидите имя модуля Runbook в колонке **Добавление правила оповещения**.

![Модуль Runbook настроен](media/automation-azure-vm-alert-integration/RunbookConfigured.png)

Нажмите кнопку **ОК** в колонке **Добавление правила оповещения**, и, если виртуальная машина запущена, будет создано и активировано правило оповещений.

### Включение и отключение модуля Runbook

Если для оповещения настроен модуль Runbook, его можно отключить, не удаляя конфигурацию модуля Runbook. Это позволяет продолжить выполнение оповещения и, возможно, проверить некоторые правила оповещения и позже включить модуль Runbook повторно.

## Сводка

При настройке оповещения на виртуальной машине Azure вы получаете возможность легко настраивать модуль Runbook службы автоматизации для автоматического выполнения действия исправления при инициализации оповещения. В этом выпуске можно выбрать модуль Runbook для перезапуска, остановки или удаления виртуальной машины в зависимости от вашего сценария оповещений. Это только начало использования сценариев, в которых вы управляете действиями (оповещение, устранение неполадок, исправление), автоматически предпринимаемыми при инициализации оповещения.

## Дальнейшие действия

- Чтобы приступить к работе с графическими модулями Runbook, обратитесь к статье [Первый графический Runbook](automation-first-runbook-graphical.md)
- Чтобы приступить к работе с модулями Runbook рабочих процессов PowerShell, обратитесь к статье [Первый Runbook рабочего процесса PowerShell](automation-first-runbook-textual.md)
- Чтобы получить дополнительные сведения о типах модулей Runbook, их преимуществах и ограничениях, обратитесь к статье [Типы модулей Runbook в службе автоматизации Azure](automation-runbook-types.md)

<!---HONumber=AcomDC_0420_2016-->