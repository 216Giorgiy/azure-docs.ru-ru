---
title: Решение для управления обновлениями в Azure
description: Цель этой статьи — помочь вам понять, как использовать это решение для управления обновлениями на компьютерах Windows и Linux.
services: automation
ms.service: automation
ms.component: update-management
author: georgewallace
ms.author: gwallace
ms.date: 04/23/2018
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: d93f79874ff65a1b6bb7ddd75932111c5caa6072
ms.sourcegitcommit: eb75f177fc59d90b1b667afcfe64ac51936e2638
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2018
ms.locfileid: "34195851"
---
# <a name="update-management-solution-in-azure"></a>Решение для управления обновлениями в Azure

Решение по управлению обновлениями в службе автоматизации Azure позволяет управлять обновлениями операционной системы для компьютеров Windows и Linux, развернутых в Azure, локальных средах или других поставщиках облачных услуг. Благодаря ему вы сможете быстро оценить состояние доступных обновлений на всех компьютерах агентов и управлять установкой необходимых обновлений на серверах.

Вы можете включить управление обновлениями для виртуальных машин непосредственно из учетной записи службы автоматизации Azure.
Сведения о включении управления обновлениями для виртуальных машин из учетной записи службы автоматизации см. в статье [Управление обновлениями для нескольких виртуальных машин Azure](manage-update-multi.md). Вы также можете включить управление обновлениями для одной виртуальной машины на странице виртуальной машины на портале Azure. Этот сценарий доступен для виртуальных машин [Linux](../virtual-machines/linux/tutorial-monitoring.md#enable-update-management) и [Windows](../virtual-machines/windows/tutorial-monitoring.md#enable-update-management).

## <a name="solution-overview"></a>Обзор решения

Ниже перечислены конфигурации, которые используются компьютерами, управляемыми с помощью решения "Управление обновлениями", для выполнения развертываний оценок и обновлений:

* Microsoft Monitoring Agent для Windows или Linux;
* служба настройки требуемого состояния PowerShell;
* гибридные рабочие роли Runbook службы автоматизации;
* службы центра обновления Майкрософт или Windows Server Update Services для компьютеров с Windows.

На схеме ниже показано концептуальное представление потока данных и его поведения, а также, как решение анализирует и применяет обновления безопасности ко всем подключенным компьютерам Windows Server и Linux в рабочей области.

![Поток процесса управления обновлениями](media/automation-update-management/update-mgmt-updateworkflow.png)

После того как компьютер проверит соответствие обновлениям, агент переадресовывает сведения в Log Analytics в пакетном режиме. На компьютере с Windows проверка на соответствия по умолчанию выполняется через каждые 12 часов. Помимо расписания проверки при перезапуске Microsoft Monitoring Agent (MMA) в течение 15 минут запускается проверка на соответствие обновлений. Это происходит перед установкой обновления и после нее. На компьютерах с Linux проверка на соответствия по умолчанию выполняется через каждые 3 часа, а в случае перезапуска агента MMA — через каждые 15 минут.

Решение формирует отчет по актуальности состояния компьютера в зависимости от настроенного для синхронизации источника. Если компьютер с Windows настроен на отправку отчетов в службы WSUS в зависимости от последней синхронизации WSUS с центром обновления Майкрософт, результаты центра обновления Майкрософт могут быть недостоверными. То же самое касается компьютеров с Linux, настроенных на отправку отчета в локальный или общедоступный репозиторий.

> [!NOTE]
> Управление обновлениями требует, чтобы определенные URL-адреса и порты были включены для надлежащего отчета в службу. Дополнительные сведения см. в статье [Автоматизация ресурсов в центре обработки данных или облаке с помощью гибридной рабочей роли Runbook](automation-hybrid-runbook-worker.md#network-planning).

Вы можете развернуть и установить обновления программного обеспечения на компьютерах, требующих обновлений с помощью запланированного развертывания. *Необязательные* обновления не включены в область развертывания для компьютеров с Windows. Запланированное развертывание определяет, какие целевые компьютеры будут получать применимые обновления. Для этого можно явным образом указать компьютеры или же выбрать [группу компьютеров](../log-analytics/log-analytics-computer-groups.md) на основе поиска по журналам определенного набора компьютеров. Вы также можете указать расписание для назначения и подтверждения периода времени, в течение которого могут быть установлены обновления. Обновления устанавливаются с помощью Runbook в службе автоматизации Azure. Эти модули Runbook нельзя просмотреть, и они не требуют настройки. При создании развертывания обновлений в нем создается расписание, по которому в указанное время для компьютеров, включенных в развертывание, запускается главный Runbook обновлений. Этот Runbook запускает для каждого агента дочерний Runbook, который выполняет установку необходимых обновлений.

Целевой компьютер будет параллельно выполнять развертывания согласно дате и времени, указанным в развертывании обновлений. Сначала проверяется, нужны ли еще обновления, и только после этого выполняется установка. Если обновления для клиентских компьютеров WSUS не утверждены службой WSUS, развертывание обновлений завершится сбоем.

## <a name="clients"></a>Клиенты

### <a name="supported-client-types"></a>Поддерживаемые типы клиентов

В следующей таблице перечислены поддерживаемые операционные системы.

|Операционная система  |Заметки  |
|---------|---------|
|Windows Server 2008, Windows Server 2008 R2 RTM    | Поддерживает только оценки обновлений.         |
|Windows Server 2008 R2 с пакетом обновления 1 и более поздней версии     |Требуется Windows PowerShell 4.0 или более поздней версии ([скачать WMF 4.0](https://www.microsoft.com/download/details.aspx?id=40855)).</br> Для повышения надежности рекомендуем использовать Windows PowerShell 5.1 ([скачать WMF 5.1](https://www.microsoft.com/download/details.aspx?id=54616)).         |
|CentOS 6 (x86 или x64) и 7 (x64)      | У агентов Linux должен быть доступ к репозиторию обновлений.        |
|Red Hat Enterprise 6 (x86 или x64) и 7 (x64)     | У агентов Linux должен быть доступ к репозиторию обновлений.        |
|SUSE Linux Enterprise Server 11 (x86 или x64) и 12 (x64)     | У агентов Linux должен быть доступ к репозиторию обновлений.        |
|Ubuntu 12.04 LTS, 14.04 LTS, 16.04 LTS (x86/x64)      |У агентов Linux должен быть доступ к репозиторию обновлений.         |

### <a name="unsupported-client-types"></a>Неподдерживаемые типы клиентов

В следующей таблице перечислены неподдерживаемые операционные системы:

|Операционная система  |Заметки  |
|---------|---------|
|Клиент Windows     | Операционные системы клиента (Windows 7, Windows 10 и т. д.) не поддерживаются.        |
|Nano Server Windows Server 2016     | Не поддерживается       |

### <a name="client-requirements"></a>Требования к клиенту

#### <a name="windows"></a>Windows

На агентах Windows необходимо настроить связь с сервером служб Windows Server Update Services (WSUS) или доступ к Центру обновления Майкрософт. Решение "Управление обновлениями" можно использовать с System Center Configuration Manager. Дополнительные сведения см. в статье о [сценариях интеграции System Center Configuration Manager с решением "Управление обновлениями"](oms-solution-updatemgmt-sccmintegration.md#configuration). [Агент Windows](../log-analytics/log-analytics-agent-windows.md) является обязательным компонентом. При подключении виртуальной машины Azure этот агент устанавливается автоматически.

#### <a name="linux"></a>Linux

Для Linux у виртуальной машины должен быть доступ к репозиторию обновлений, который может быть закрытым или общедоступным. Это решение не поддерживает агент OMS для Linux, настроенный для отправки отчетов в несколько рабочих областей Log Analytics.

Дополнительные сведения по установке агента OMS для Linux и скачиванию последней версии см. [здесь](https://github.com/microsoft/oms-agent-for-linux). Дополнительные сведения по установке агента OMS для Windows см. в статье [Подключение компьютеров Windows к службе Log Analytics в Azure](../log-analytics/log-analytics-windows-agent.md).

## <a name="permissions"></a>Разрешения

Для создания развертываний обновлений и управления ими требуются определенные разрешения. Дополнительные сведения об этих разрешениях см. в разделе, посвященном [управлению обновлениями с доступом на основе ролей](automation-role-based-access-control.md#update-management).

## <a name="solution-components"></a>Компоненты решения

Это решение состоит из приведенных ниже ресурсов, добавленных в учетную запись службы автоматизации, и подключенных напрямую агентов или подключенной группы управления Operations Manager.

### <a name="hybrid-worker-groups"></a>Группы гибридных рабочих ролей

После включения этого решения любой подключенный к рабочей области Log Analytics компьютер с Windows будет автоматически настроен в качестве гибридной рабочей роли Runbook для поддержки модулей Runbook, которые входят в это решение. Для каждого компьютера с Windows, управляемого этим решением, эти роли будут указаны на странице групп гибридных рабочих ролей как группа гибридных рабочих ролей системы для учетной записи службы автоматизации с использованием соглашения об именовании *Имя узла FQDN_GUID*. Вы не можете выбрать эти группы с помощью модулей Runbook в своей учетной записи, так как произойдет сбой. Эти группы предназначены только для поддержки решения для управления.

Но вы можете добавить компьютеры с Windows в группу гибридных рабочих ролей Runbook в учетной записи службы автоматизации, чтобы обеспечить поддержку модулей Runbook службы автоматизации при условии, что вы используете одну и ту же учетную запись для решения и для участия в группе гибридных рабочих ролей Runbook. Эта функция добавлена в версии 7.2.12024.0 гибридной рабочей роли Runbook.

### <a name="management-packs"></a>Пакеты управления

Если группа управления System Center Operations Manager подключена к рабочей области Log Analytics, в Operations Manager будут установлены следующие пакеты. После добавления этого решения пакеты управления также будут установлены на компьютерах с Windows, подключенных напрямую. Управление и настройка здесь не требуются.

* Пакет аналитики оценки обновления Microsoft System Center Advisor (Microsoft.IntelligencePacks.UpdateAssessment);
* Microsoft.IntelligencePack.UpdateAssessment.Configuration (Microsoft.IntelligencePack.UpdateAssessment.Configuration);
* пакет управления развертыванием обновлений.

Дополнительные сведения об обновлении пакетов управления для решений см. в статье [Подключение Operations Manager к Log Analytics](../log-analytics/log-analytics-om-agents.md).

### <a name="confirm-non-azure-machines-are-onboarded"></a>Подтверждение подключения виртуальных машин, не относящихся к Azure

Чтобы подтвердить, что подключенные напрямую виртуальные машины взаимодействуют с Log Analytics, вы можете выполнить следующий поиск по журналу:

#### <a name="linux"></a>Linux

```
Heartbeat
| where OSType == "Linux" | summarize arg_max(TimeGenerated, *) by SourceComputerId | top 500000 by Computer asc | render table
```

#### <a name="windows"></a>Windows

```
Heartbeat
| where OSType == "Windows" | summarize arg_max(TimeGenerated, *) by SourceComputerId | top 500000 by Computer asc | render table`
```

Чтобы установить подключение агента к Log Analytics на компьютере с Windows, сделайте следующее:

1. Откройте Microsoft Monitoring Agent на панели управления. На вкладке **Azure Log Analytics** агент отобразит сообщение **The Microsoft Monitoring Agent has successfully connected to Log Analytics** (Microsoft Monitoring Agent успешно подключен к Log Analytics).
2. Откройте журнал событий Windows, перейдите к **журналам приложения и служб или Operations Manager** и выполните поиск идентификатора события 3000 или 5002 в исходном соединителе службы. Эти события указывают, что компьютер был зарегистрирован для рабочей области Log Analytics и получает конфигурации.

Если агент не взаимодействует с Log Analytics и настроен на взаимодействие с Интернетом через брандмауэр или прокси-сервер, вам необходимо проверить, правильно ли настроен брандмауэр или прокси-сервер. Для этого ознакомьтесь с разделом о [настройке сети для агента Windows](../log-analytics/log-analytics-agent-windows.md) или [агента Linux](../log-analytics/log-analytics-agent-linux.md).

> [!NOTE]
> Если при подключении этого решения системы Linux настроены для взаимодействия с прокси-сервером или шлюзом OMS, обновите разрешения *proxy.conf*, чтобы предоставить группе omiuser разрешение на чтение файла. Для этого выполните следующие команды: `sudo chown omsagent:omiusers /etc/opt/microsoft/omsagent/proxy.conf`
> `sudo chmod 644 /etc/opt/microsoft/omsagent/proxy.conf`

Добавленные агенты Linux отобразят статус **обновления** после оценки. Этот процесс может занять до 6 часов.

О том, как подтвердить, что группа управления Operations Manager взаимодействует с Log Analytics, описывается в разделе [Проверка интеграции Operations Manager с OMS](../log-analytics/log-analytics-om-agents.md#validate-operations-manager-integration-with-log-analytics).

## <a name="data-collection"></a>Сбор данных

### <a name="supported-agents"></a>Поддерживаемые агенты

В следующей таблице описаны подключенные источники, которые поддерживаются этим решением.

| Подключенный источник | Поддерживаются | ОПИСАНИЕ |
| --- | --- | --- |
| Агенты Windows |Yes |Решение собирает сведения об обновлениях системы с агентов Windows и запускает установку требуемых обновлений. |
| Агенты Linux |Yes |Решение собирает сведения об обновлениях системы с агентов Linux и запускает установку требуемых обновлений для поддерживаемых дистрибутивов. |
| Группа управления Operations Manager |Yes |Решение собирает сведения о системных обновлениях с агентов, состоящих в подключенной группе обновления.</br>Прямое подключение агента Operations Manager к Log Analytics не требуется. Данные пересылаются из группы управления в рабочую область Log Analytics. |

### <a name="collection-frequency"></a>Частота сбора

Дважды в день выполняется проверка каждого управляемого компьютера Windows. Каждые 15 минут вызывается API Windows, чтобы выполнить запрос последнего времени обновления для определения изменения статуса. В случае его изменения запускается проверка на соответствие. Каждые три часа выполняется проверка всех управляемых компьютеров Linux.

Отображение обновленных данных на управляемых компьютерах на панели мониторинга может занять от 30 минут до 6 часов.

## <a name="viewing-update-assessments"></a>Просмотр оценки обновлений

Щелкните пункт **Управление обновлениями** в своей учетной записи службы автоматизации, чтобы просмотреть состояние компьютеров.

В этом представлении содержатся сведения о ваших компьютерах, отсутствующих обновлениях, развертываниях обновлений и запланированных развертываниях обновлений.

Вы можете запустить поиск по журналам, который возвращает сведения о компьютере, обновлении или развертывании, выбрав элемент в списке. При этом откроется страница **поиска по журналам** с запросом на выбранный элемент.

## <a name="installing-updates"></a>Установка обновлений

После оценки обновлений для всех компьютеров с Windows и Linux в рабочей области можно установить обязательные обновления, создав *развертывание обновлений*. Развертывание обновлений — это запланированная установка требуемых обновлений для одного или нескольких компьютеров. Вы можете указать дату и время развертывания, а также компьютер или группу компьютеров, которые следует включить в развертывание. Дополнительные сведения о группах компьютеров см. в статье [Использование групп компьютеров при поиске по журналам Log Analytics](../log-analytics/log-analytics-computer-groups.md). При включении групп компьютеров в развертывание обновлений они будут проанализированы один раз после создания расписания. Последующие изменения группы отображаться не будут. Чтобы обойти эту проблему, удалите запланированное развертывание обновлений, а затем повторно создайте его.

> [!NOTE]
> Виртуальные машины с Windows, развернутые по умолчанию из Azure Marketplace, настроены для получения автоматических обновлений из службы обновлений Windows. Это не меняется после добавления этого решения или виртуальных машин с Windows в рабочую область. Если вы не управляете обновлениями с помощью этого решения, будет применено поведение по умолчанию (автоматическое применение обновлений).

Чтобы обновления применялись только в период обслуживания в Ubuntu, повторно настройте пакет unattended-upgrades и отключите автоматическое обновление. Дополнительные сведения о настройке см. в разделе [Автоматические обновления](https://help.ubuntu.com/lts/serverguide/automatic-updates.html) руководства по Ubuntu Server.

Виртуальным машинам, которые созданы на основе доступных в Azure Marketplace предоставляемых по запросу образов Red Hat Enterprise Linux (RHEL), обеспечивается доступ к развернутой в Azure инфраструктуре [Red Hat Update Infrastructure (RHUI)](../virtual-machines/virtual-machines-linux-update-infrastructure-redhat.md). Любой другой дистрибутив Linux должен быть обновлен с помощью интернет-репозитория дистрибутивов посредством поддерживаемых методов.

## <a name="viewing-missing-updates"></a>Просмотр отсутствующих обновлений

Щелкните **Отсутствующие обновления**, чтобы просмотреть список обновлений, отсутствующих на ваших компьютерах. Для каждого обновления отображается информация о количестве компьютеров, которым оно требуется, операционной системе и ссылка для получения дополнительных сведений. Вы можете выбрать любое обновление, и на странице **поиска по журналам** появятся подробные сведения об обновлениях.

## <a name="viewing-update-deployments"></a>Просмотр развертываний обновлений

Щелкните вкладку **Развертывания обновлений**, чтобы просмотреть список существующих развертываний обновлений. Если щелкнуть какое-либо развертывание обновления в таблице, откроется страница **Обновление запуска развертывания** для этого развертывания обновления.

![Обзор результатов развертывания обновлений](./media/automation-update-management/update-deployment-run.png)

## <a name="creating-an-update-deployment"></a>Создание развертывания обновлений

Создайте развертывание обновлений, нажав кнопку **Запланировать развертывание обновлений** в верхней части экрана, чтобы открыть страницу **Новое развертывание обновления**. Вам необходимо указать значения для свойств, приведенных в таблице ниже.

| Свойство | ОПИСАНИЕ |
| --- | --- |
| ИМЯ |Уникальное имя для идентификации развертывания обновлений. |
|Операционная система| Windows или Linux|
| Компьютеры, на которые нужно установить обновления |Щелкните сохраненный поиск или выберите компьютеры в раскрывающемся списке и выберите нужные компьютеры. |
|Классификации обновлений|Выберите все необходимые категории обновления.|
|Исключаемые обновления|Введите все базы знаний, которые нужно исключить, без префикса "KB".|
|Параметры расписания|Выберите время запуска, а затем — однократное применение или повторяющееся.|
| Период обслуживания |Количество минут, установленное для обновлений. Значение должно составлять не менее 30 минут, но не более 6 часов. |

## <a name="update-classifications"></a>Классификации обновлений

В следующих таблицах содержатся списки классификаций обновлений в Управлении обновлениями, а также определения для каждой классификации.

### <a name="windows"></a>Windows

|классификация;  |ОПИСАНИЕ  |
|---------|---------|
|критические обновления;     | Обновление для конкретной проблемы, которая относится к критической, не связанной с безопасностью ошибке.        |
|обновления для системы безопасности;     | Обновление для ошибки, связанной с безопасностью конкретного продукта.        |
|накопительные пакеты обновления;     | Накопительный набор исправлений, упакованных в один пакет для удобства развертывания.        |
|пакеты дополнительных компонентов;     | Новые функции продукта, которые распространяются вне выпуска продукта.        |
|пакеты обновления;     | Накопительный набор исправлений, применяемых к приложению.        |
|обновления определений;     | Обновление для вирусов или других файлов определений.        |
|Средства     | Служебная программа или функция, которая помогает выполнить одну или несколько задач.        |
|Обновления     | Обновление приложения или файла, установленного в настоящее время.        |

### <a name="linux"></a>Linux

|классификация;  |ОПИСАНИЕ  |
|---------|---------|
|критические обновления и обновления для системы безопасности;     | Обновления для конкретной проблемы или проблемы, связанной с безопасностью продукта.         |
|Другие обновления     | Все другие обновления, которые не являются критическими или обновления для системы безопасности.        |

## <a name="ports"></a>порты;

Для Управления обновлениями требуются следующие адреса. Взаимодействие с этими адресами выполняется через порт 443.

|Azure Public  |Azure Government  |
|---------|---------|
|*.ods.opinsights.azure.com     |*.ods.opinsights.azure.us         |
|*.oms.opinsights.azure.com     | *.oms.opinsights.azure.us        |
|*.blob.core.windows.net|*.blob.core.usgovcloudapi.net|

Дополнительные сведения о портах, которым необходима гибридная рабочая роль Runbook, см. в статье [Автоматизация ресурсов в центре обработки данных или облаке с помощью гибридной рабочей роли Runbook](automation-hybrid-runbook-worker.md#hybrid-worker-role).

## <a name="search-logs"></a>Поиск по журналам

Кроме подробных сведений, которые предоставляются на портале, можно выполнить поиск по журналам. Откройте страницу **Отслеживание изменений** и щелкните **Log Analytics**. Откроется страница **Поиск по журналу**.

### <a name="sample-queries"></a>Примеры запросов

Следующая таблица содержит примеры запросов поиска по журналу для получения записей обновлений, собранных этим решением.

| Запрос | ОПИСАНИЕ |
| --- | --- |
|Блокировка изменений</br>&#124; where UpdateState == "Needed" and Optional == false</br>&#124; project Computer, Title, KBID, Classification, PublishedDate |Все компьютеры с недостающими обновлениями</br>Для применения ограничений к операционной системе введите один из типов ниже:</br>OSType = "Windows"</br>OSType == "Linux" |
| Блокировка изменений</br>&#124; where UpdateState == "Needed" and Optional == false</br>&#124; where Computer == "ContosoVM1.contoso.com"</br>&#124; project Computer, Title, KBID, Product, PublishedDate |Отсутствующие обновления для определенного компьютера (замените значение именем своего компьютера)|
| Событие</br>&#124; where EventLevelName == "error" and Computer in ((Update &#124; where (Classification == "Security Updates" or Classification == "Critical Updates")</br>&#124; where UpdateState == "Needed" and Optional == false </br>&#124; distinct Computer)) |События ошибок для компьютеров, на которых отсутствовали обязательные критические обновления или обновления для системы безопасности |
| Блокировка изменений</br>&#124; where UpdateState == "Needed" and Optional == false</br>&#124; distinct Title |Отдельные недостающие обновления на всех компьютерах |
| UpdateRunProgress</br>&#124; where InstallationStatus == "failed" </br>&#124; summarize AggregatedValue = count() by Computer, Title, UpdateRunName |Компьютеры с обновлениями, завершившимися сбоем при выполнении</br>Для применения ограничений к операционной системе введите один из типов ниже:</br>OSType = "Windows"</br>OSType == "Linux" |
| Блокировка изменений</br>&#124; where OSType == "Linux"</br>&#124; where UpdateState != "Not needed" and (Classification == "Critical Updates" or Classification == "Security Updates")</br>&#124; summarize AggregatedValue = count() by Computer |Список всех компьютеров Linux, для которых доступно обновление пакетов, позволяющее устранить критическую уязвимость или уязвимость системы безопасности. |
| UpdateRunProgress</br>&#124; where UpdateRunName == "DeploymentName"</br>&#124; summarize AggregatedValue = count() by Computer|Компьютеры, обновленные при этом запуске обновления (замените значение именем развертывания обновлений) |

## <a name="integrate-with-system-center-configuration-manager"></a>Интеграция с System Center Configuration Manager

Клиенты, которые инвестировали в System Center Configuration Manager для управления компьютерами, серверами и мобильными устройствами, также полагаются на его надежность и зрелость при управлении обновлениями программного обеспечения в рамках цикла управления обновлениями программного обеспечения (SUM).

Сведения об интеграции решения по управлению с Sytem Center Configuration Manager см. в статье [Интеграция Integrate System Center Configuration Manager с решением "Управление обновлениями"](oms-solution-updatemgmt-sccmintegration.md).

## <a name="patching-linux-machines"></a>Установка исправлений для компьютеров Linux

В следующих разделах объясняются возможные проблемы, которые могут возникнуть при установке исправлений Linux.

### <a name="package-exclusion"></a>Исключение пакета

В некоторых вариантах Linux, таких как Red Hat Enterprise Linux, обновления на уровне ОС можно реализовывать через пакеты. Это может привести к запуску управления обновлениями, когда изменяется номер версии операционной системы. Так как решение "Управление обновлениями" использует те же методы для обновления пакетов, что и администратор на компьютерах Linux в локальной среде, такое поведение является преднамеренным.

Чтобы избежать обновления версии ОС при запуске решения "Управление обновлениями", нужно использовать функцию **исключения**.

В Red Hat Enterprise Linux именем пакета для исключения должно быть имя redhat-release-server.x86_64.

![Исключаемые пакеты для Linux](./media/automation-update-management/linuxpatches.png)

### <a name="security-patches-not-being-applied"></a>Исправления безопасности, которые не применяются

При развертывании обновлений на компьютер Linux вы можете выбрать категории обновлений. Это позволит отфильтровать обновления до тех, которые соответствуют указанным критериям. Этот фильтр применяется локально на компьютере при развертывании обновления. Так как решение "Управление обновлениями" добавляет новые функции к обновлениям в облаке, некоторые обновления могут быть помечены в таком решении как обновления, влияющие на безопасность, хотя на локальном компьютере эти сведения отсутствуют. В результате, если вы применяете критические обновления для компьютера Linux, вы можете столкнуться с обновлениями, которые не помечены как влияющие на безопасность на таком компьютере, но при этом они не будут применены. Тем не менее, решение "Управление обновлениями" может по-прежнему сообщать о том, что обновления не совместимы с этим компьютером, так как оно содержит дополнительные сведения о соответствующем обновлении.

Развертывание обновлений по категории может не работать на openSUSE Linux из-за использования другой модели установки исправлений.

## <a name="troubleshooting"></a>Устранение неполадок

В этом разделе представлены сведения об устранении неполадок с помощью решения для управления обновлениями.

Если при попытке подключить решение или виртуальную машину возникли проблемы, проверьте журнал событий **журналов приложения и служб Operations Manager** для событий с идентификатором 4502, а также сообщение события, содержащее **Microsoft.EnterpriseManagement.HealthService.AzureAutomation.HybridAgent**. В таблице ниже выделены отдельные сообщения об ошибках и возможные решения этих ошибок.

| Сообщение | Причина | Решение |
|----------|----------|----------|
| Не удалось зарегистрировать компьютер для управления обновлениями.</br>Сбой регистрации с исключением</br>System.InvalidOperationException: {"Message":"Machine is already</br>registered to a different account. "} ("Message": "Компьютер уже зарегистрирован для другой учетной записи") | Компьютер уже подключен к другой рабочей области для управления обновлениями | Выполните очистку старых артефактов путем [удаления группы гибридных модулей](automation-hybrid-runbook-worker.md#remove-hybrid-worker-groups)|
| Не удалось зарегистрировать компьютер для управления исправлениями, сбой регистрации с исключением</br>System.Net.Http.HttpRequestException: произошла ошибка при отправке запроса. ---></br>System.Net.WebException: базовое соединение</br>закрыто. Непредвиденная ошибка</br>при приеме. ---> System.ComponentModel.Win32Exception:</br>взаимодействие клиента и сервера невозможно,</br>т. к. у них разный алгоритм работы. | Связь блокируется прокси-сервером, шлюзом или брандмауэром | [Ознакомьтесь с требованиями к сети](automation-hybrid-runbook-worker.md#network-planning)|
| Не удалось зарегистрировать компьютер для управления обновлениями.</br>Сбой регистрации с исключением</br>Newtonsoft.Json.JsonReaderException: ошибка при анализе положительного значения бесконечности. | Связь блокируется прокси-сервером, шлюзом или брандмауэром | [Ознакомьтесь с требованиями к сети](automation-hybrid-runbook-worker.md#network-planning)|
| Сертификат, представленный службой \<wsid\>.oms.opinsights.azure.com</br>не был выдан центром сертификации</br>для служб Майкрософт. Контакт</br>работает ли прокси, перехватывающий взаимодействие по протоколам TLS и SSL,</br>обратитесь к администратору сети. |Связь блокируется прокси-сервером, шлюзом или брандмауэром | [Ознакомьтесь с требованиями к сети](automation-hybrid-runbook-worker.md#network-planning)|
| Не удалось зарегистрировать компьютер для управления обновлениями.</br>Сбой регистрации с исключением</br>AgentService.HybridRegistration.</br>PowerShell.Certificates.CertificateCreationException:</br>не удалось создать самозаверяющий сертификат. ---></br>System.UnauthorizedAccessException: в доступе отказано. | Сбой создания самозаверяющего сертификата | У системной учетной записи должен быть</br>доступ на чтение к папке:</br>**C:\ProgramData\Microsoft\**</br>** Crypto\RSA**|

## <a name="next-steps"></a>Дополнительная информация

Ознакомьтесь с руководством ниже, чтобы узнать, как управлять обновлениями для виртуальных машин Windows.

> [!div class="nextstepaction"]
> [Устранение неполадок при изменениях в среде](automation-tutorial-update-management.md)

* Используйте поиск по журналам в [Log Analytics](../log-analytics/log-analytics-log-searches.md), чтобы просматривать подробные данные об обновлениях.
* [Создавайте оповещения](../log-analytics/log-analytics-alerts.md) об обнаружении важных критических обновлений, отсутствующих на компьютерах, или отключении автоматических обновлений на компьютере.
