<properties 
   pageTitle="Сертификация активов в службе автоматизации Azure"
   description="Сертификаты можно безопасно сохранить в службе автоматизации Azure, чтобы к ним могли обращаться модули Runbook для прохождения аутентификации при доступе к ресурсам Azure и сторонних производителей. В этой статье подробно рассматриваются сертификаты и работа с ними при создании текстовых и графических модулей."
   services="automation"
   documentationCenter=""
   authors="bwren"
   manager="stevenka"
   editor="tysonn" />
<tags 
   ms.service="automation"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="06/14/2015"
   ms.author="bwren" />

# Сертификация активов в службе автоматизации Azure

Сертификаты можно безопасно сохранить в службе автоматизации Azure, чтобы к ним могли обращаться модули Runbook с помощью действия **Get-AutomationCertificate**. Это позволяет создавать модули Runbook, которые используют сертификаты для аутентификации или добавляют их в ресурсы Azure либо сторонних производителей, которые Runbook может создавать или настраивать.

>[AZURE.NOTE]К защищенным ресурсам в службе автоматизации Azure относятся учетные данные, сертификаты, подключения и зашифрованные переменные. Эти ресурсы шифруются и хранятся в службе автоматизации Azure с помощью уникального ключа, который создается для каждой учетной записи службы автоматизации. Ключ шифруется главным сертификатом и хранится в службе автоматизации Azure. Перед сохранением защищенного ресурса ключ учетной записи службы автоматизации дешифруется с помощью главного сертификата и используется для шифрования ресурса.

## Командлеты Windows PowerShell

Командлеты, представленные в следующей таблице, используются для создания ресурсов сертификата службы автоматизации и управления ими с помощью Windows PowerShell. Они входят в состав [модуля Azure PowerShell](../powershell-install-configure.md), доступного в модулях Runbook службы автоматизации.

|Командлеты|Описание|
|:---|:---|
|[Get-AzureAutomationCertificate](http://msdn.microsoft.com/library/dn913765.aspx)|Извлекает сведения о сертификате. Сам сертификат можно извлечь только с помощью действия Get-AutomationCertificate.|
|[New-AzureAutomationCertificate](http://msdn.microsoft.com/library/dn913764.aspx)|Импортирует новый сертификат в службу автоматизации Azure.|
|[Remove-AzureAutomationCertificate](http://msdn.microsoft.com/library/dn913773.aspx)|Удаляет сертификат из службы автоматизации Azure.|
|[Set-AzureAutomationCertificate](http://msdn.microsoft.com/library/dn913763.aspx)|Задает свойства для существующего сертификата, включая отправку файла сертификата и задание пароля для PFX-файла.|

## Действия Runbook

Действия в следующей таблице используются для доступа к сертификатам в модуле Runbook.

|Действия|Описание|
|:---|:---|
|Get-AutomationCertificate|Получает сертификат для использования в модуле Runbook.|

>[AZURE.NOTE]Не следует использовать переменные в параметре –Name в Get-AutomationCertificate, так как это может усложнить обнаружение зависимостей между модулями Runbook и ресурсами сертификата во время разработки.

## Создание нового сертификата

При создании нового сертификата в службу автоматизации Azure передается CER- или PFX-файл. Если пометить сертификат как экспортируемый, его можно будет переместить из хранилища сертификатов службы автоматизации Azure. Если он не экспортируемый, то он будет использоваться только для подписывания в модуле Runbook.

### Создание нового сертификата на портале Azure

1. Из учетной записи службы автоматизации щелкните **Активы** в верхней части окна.
1. Нажмите кнопку **Добавить параметр** в нижней части окна.
1. Щелкните **Добавить учетные данные**.
2. В раскрывающемся списке **Тип учетных данных** выберите **Сертификат**.
3. Введите имя сертификата в поле **Имя** и нажмите кнопку со стрелкой вправо.
4. Перейдите к CER- или PFX-файлу. Если выбран PFX-файл, введите пароль и укажите, разрешен ли экспорт сертификата.
1. Щелкните флажок, чтобы отправить файл сертификата и сохранить новый ресурс сертификата.


### Создание нового сертификата на портале предварительной версии Azure

1. Из учетной записи службы автоматизации щелкните элемент **Активы**, чтобы открыть колонку **Активы**.
1. Щелкните элемент **Сертификаты**, чтобы открыть колонку **Сертификаты**.
1. Щелкните **Добавить сертификат** в верхней части колонки.
2. Введите имя сертификата в поле **Имя**.
2. Щелкните **Выбрать файл** в разделе **Передача файла сертификата** и перейдите к CER- или PFX-файлу. Если выбран PFX-файл, введите пароль и укажите, разрешен ли экспорт сертификата.
1. Щелкните **Создать** для сохранения нового ресурса сертификата.


### Создание нового сертификата с помощью Windows PowerShell

Команды, приведенные ниже в примере, демонстрируют создание нового сертификата службы автоматизации и помечают его как экспортируемый. Выполняется импорт существующего PFX-файла.

	$certName = 'MyCertificate'
	$certPath = '.\MyCert.pfx'
	$certPwd = ConvertTo-SecureString -String 'P@$$w0rd' -AsPlainText -Force
	
	New-AzureAutomationCertificate -AutomationAccountName "MyAutomationAccount" -Name $certName -Path $certPath –Password $certPwd -Exportable

## Использование сертификата в Runbook

Чтобы использовать сертификат в Runbook, необходимо применить действие **Get-AutomationCertificate**. Нельзя использовать командлет [Get-AzureAutomationCertificate](http://msdn.microsoft.com/library/dn913765.aspx), так как он возвращает сведения о ресурсе сертификата, но не сам сертификат.

### Пример текстового Runbook

В следующем примере кода показано, как добавить сертификат из Runbook в облачную службу. В этом примере пароль извлекается из зашифрованной переменной службы автоматизации.

	$serviceName = 'MyCloudService'
	$cert = Get-AutomationCertificate -Name 'MyCertificate'
	$certPwd = Get-AutomationVariable –Name 'MyCertPassword'
	Add-AzureCertificate -ServiceName $serviceName -CertToDeploy $cert

### Пример графического Runbook

Можно добавить **Get-AutomationCerticiate** в графический Runbook, щелкнув правой кнопкой мыши сертификат в области "Библиотека" графического редактора и выбрав пункт **Добавить на холст**.

![](media/automation-certificates/certificate-add-canvas.png)

На следующем рисунке показан пример использования сертификата в графическом Runbook. Этот же пример был показан выше, он добавляет сертификат из текстового Runbook в облачную службу.

В этом примере для действия Send-**TwilioSMS** задан параметр **UseConnectionObject**, использующий объект подключения для аутентификации в службе. Здесь необходимо использовать [конвейерную связь](automation-graphical-authoring-intro.md#links-and-workflow), так как последовательная связь вернет коллекцию, содержащую один объект, который не ожидается параметром Connection.

![](media/automation-certificates/add-certificate.png)


## См. также

- [Использование связей при создании графических модулей](automation-graphical-authoring-intro.md#links-and-workflow) 

<!---HONumber=July15_HO3-->