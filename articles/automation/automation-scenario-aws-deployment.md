<properties
   pageTitle="Автоматизация развертывания виртуальной машины в Amazon Web Services | Microsoft Azure"
   description="В этой статье показано, как автоматизировать создание виртуальной машины Amazon Web Service с помощью службы автоматизации Azure."
   services="automation"
   documentationCenter=""
   authors="mgoedtel"
   manager="jwhit"
   editor="" />
<tags
   ms.service="automation"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="04/13/2016"
   ms.author="tiandert; bwren" />

# Решение службы автоматизации Azure — подготовка виртуальной машины AWS 

В этой статье мы покажем, как с помощью службы автоматизации Azure подготовить виртуальную машину в вашей подписке Amazon Web Service \(AWS\) и присвоить виртуальной машине определенное имя, которое в AWS называется "тегом" виртуальной машины.

## Предварительные требования

Для этой статьи вам понадобится учетная запись службы автоматизации Azure и подписка AWS. Дополнительные сведения о настройке учетной записи службы автоматизации Azure и об указании в ней учетных данных подписки AWS см. в разделе [Настройка проверки подлинности для Amazon Web Services](../automation/automation-sec-configure-aws-account.md). Перед выполнением дальнейших действий необходимо создать эту учетную запись с учетными данными подписки AWS или указать в ней эти учетные данные.


## Развертывание модуля PowerShell для Amazon Web Services

В процессе работы наш модуль Runbook для подготовки виртуальной машины будет использовать модуль PowerShell для AWS. Выполните следующие действия, чтобы добавить в учетную запись службы автоматизации модуль, настроенный с учетными данными подписки AWS.

1. Откройте браузер и перейдите к [коллекции PowerShell](http://www.powershellgallery.com/packages/AWSPowerShell/), затем нажмите **кнопку "Развернуть в службе автоматизации Azure"**.<br> ![Импорт модуля AWS PS](./media/automation-scenario-aws-deployment/powershell-gallery-download-awsmodule.png)

2. Вы перейдете на страницу входа в Azure. После проверки подлинности откроется следующая колонка портала Azure.<br> ![Колонка "Импорт модуля"](./media/automation-scenario-aws-deployment/deploy-aws-powershell-module-parameters.png)

3. Выберите группу ресурсов из раскрывающегося списка **Группы ресурсов** и в колонке "Параметры" укажите следующие сведения:
   * В раскрывающемся списке **Новая или существующая учетная запись службы автоматизации \(строка\)** выберите **Существующая**.  
   * В поле **Имя учетной записи службы автоматизации \(строка\)** введите точное имя учетной записи службы автоматизации, которая включает учетные данные для подписки AWS. Например, если вы создали специальную учетную запись с именем **AWSAutomation**, то именно это имя и нужно ввести в поле.
   * Выберите соответствующий регион из раскрывающегося списка **Расположение учетной записи службы автоматизации**.

4. После ввода необходимых сведений нажмите кнопку **Создать**.

    >[AZURE.NOTE] Во время импорта модуля PowerShell в службе автоматизации Azure также извлекаются командлеты. Эти действия не будут отображаться, пока модуль не завершит импорт и извлечение командлетов. Это может занять несколько минут. <br>
5. На портале Azure выберите свою учетную запись службы автоматизации, указанную в шаге 3.
6. Щелкните элемент **Ресурсы** и в колонке **Ресурсы** выберите элемент **Модули**.
7. В колонке **Модули** вы увидите в списке модуль **AWSPowerShell**.

## Создание модуля Runbook для развертывания виртуальной машины в AWS

После развертывания модуля AWS PowerShell можно создать модуль Runbook для автоматизации подготовки виртуальной машины в AWS с помощью сценария PowerShell. Приведенные ниже шаги показывают, как использовать собственный сценарий PowerShell в службе автоматизации Azure.

>[AZURE.NOTE] Дополнительные параметры и сведения, касающиеся этого сценария, можно найти в [коллекции PowerShell](https://www.powershellgallery.com/packages/New-AwsVM/DisplayScript).


1. Загрузите сценарий PowerShell New-AwsVM из коллекции PowerShell, открыв сеанс PowerShell и введя следующую команду:<br>
   ```
   Save-Script -Name New-AwsVM -Path \<path\>
   ```
<br>
2. На портале Azure откройте свою учетную запись службы автоматизации и щелкните элемент **Модули Runbook**.  
3. В колонке **Модули Runbook** выберите **Добавить модуль Runbook**.
4. В колонке **Добавить модуль Runbook** выберите **Быстрое создание** \(Создать модуль Runbook\).
5. В колонке свойств **Модуля Runbook** введите имя модуля в поле "Имя" для вашего модуля Runbook и выберите **PowerShell** в раскрывающемся списке **Тип модуля Runbook**, затем нажмите кнопку **Создать**.<br> ![Колонка "Импорт модуля"](./media/automation-scenario-aws-deployment/runbook-quickcreate-properties.png)
6. При появлении колонки "Изменение сценария PowerShell для модуля Runbook" скопируйте и вставьте сценарий PowerShell в область создания модуля Runbook.<br> ![Сценарий PowerShell для модуля Runbook](./media/automation-scenario-aws-deployment/runbook-powershell-script.png)<br>

    >[AZURE.NOTE] При работе с примером сценария PowerShell имейте в виду следующее:
    >
    > - Модуль Runbook содержит несколько параметров по умолчанию. Проверьте все значения по умолчанию и при необходимости обновите их.
    > - Если вы сохранили учетные данные AWS как ресурс учетных данных с именем, отличным от **AWScred**, потребуется соответствующим образом обновить скрипт в строке 57.  
    > - При работе с командами AWS в PowerShell, особенно в этом примере модуля Runbook, необходимо указывать регион AWS. В противном случае командлеты завершатся с ошибкой. Для получения дополнительных сведений обратитесь к разделу AWS [Указание региона AWS](http://docs.aws.amazon.com/powershell/latest/userguide/pstools-installing-specifying-region.html) в средствах AWS для документа PowerShell. <br>
7. Чтобы получить список образов из подписки AWS, запустите PowerShell ISE и импортируйте модуль AWS PowerShell. Пройдите проверку подлинности для AWS, заменив **Get-AutomationPSCredential** в среде ISE на **AWScred = Get-Credential**. После этого появится запрос на ввод учетных данных, и вы сможете указать **идентификатор ключа доступа** в качестве имени пользователя и **секретный ключ доступа** в качестве пароля. См. пример ниже.

		#Sample to get the AWS VM available images
		#Please provide the path where you have downloaded the AWS PowerShell module
		Import-Module AWSPowerShell
		$AWSRegion = "us-west-2"
		$AwsCred = Get-Credential
		$AwsAccessKeyId = $AwsCred.UserName
		$AwsSecretKey = $AwsCred.GetNetworkCredential().Password

		# Set up the environment to access AWS
		Set-AWSCredentials -AccessKey $AwsAccessKeyId -SecretKey $AwsSecretKey -StoreAs AWSProfile
		Set-DefaultAWSRegion -Region $AWSRegion

		Get-EC2ImageByName -ProfileName AWSProfile
Возвращается следующий результат:<br> ![Получение образов AWS](./media/automation-scenario-aws-deployment/powershell-ise-output.png)  
8. Скопируйте и вставьте имя одного из образов в переменную службы автоматизации, которая в модуле Runbook указана как **$InstanceType**. Поскольку в этом примере используется подписка AWS уровня "Бесплатный", нужно указать **t2.micro** в примере модуля Runbook.
9. Сохраните модуль Runbook, затем нажмите кнопку **Опубликовать**, чтобы опубликовать модуль Runbook, а затем кнопку **Да** в появившемся запросе.


### Тестирование модуля Runbook для AWS
Прежде чем перейти к тестированию модуля Runbook, необходимо проверить несколько моментов. В частности:

   -  Ресурсы для проверки подлинности в AWS созданы. Им присвоено имя **AWScred** или другое имя, которое было указано в вашем скрипте.  
   -  Модуль PowerShell для AWS импортирован в службу автоматизации Azure.
   -  Создан новый модуль Runbook, а значения параметров проверены и при необходимости обновлены.
   -  Для параметров **Подробные записи в журнале** и **Записи о ходе выполнения** в настройках **Ведения журнала и трассировки** модуля Runbook задано значение **Включено**.<br> ![Ведение журнала и трассировка для модуля Runbook](./media/automation-scenario-aws-deployment/runbook-settings-logging-and-tracing.png)

1. Нам нужно запустить модуль Runbook, поэтому щелкните **Запустить** и затем, когда откроется колонка "Запуск модуля Runbook", нажмите кнопку **ОК**.
2. В колонке "Запуск модуля Runbook" укажите **VMname** \(имя виртуальной машины\). Примите значения по умолчанию для остальных параметров, которые были ранее указаны в скрипте. Щелкните **ОК**, чтобы запустить задание Runbook.<br> ![Запуск модуля Runbook: New-AwsVM](./media/automation-scenario-aws-deployment/runbook-start-job-parameters.png)
3. Откроется область заданий с созданным нами заданием Runbook. Закройте эту область.
4. Ход выполнения задания и **Потоки** вывода можно просмотреть, выбрав элемент **Все журналы** в колонке задания runbook.<br> ![Раздел "Поток": выходные данные](./media/automation-scenario-aws-deployment/runbook-job-streams-output.png)
5. Чтобы убедиться, что виртуальная машина подготавливается, войдите в консоль управления AWS, если вы еще не вошли в систему.<br> ![Консоль AWS: развернутая виртуальная машина](./media/automation-scenario-aws-deployment/aws-instances-status.png)

## Дальнейшие действия
-   Чтобы приступить к работе с графическими модулями Runbook, обратитесь к статье [Мой первый графический модуль Runbook](automation-first-runbook-graphical.md).
-	Чтобы приступить к работе с модулями Runbook рабочих процессов PowerShell, обратитесь к статье [Мой первый модуль Runbook рабочего процесса PowerShell](automation-first-runbook-textual.md).
-	Чтобы получить дополнительные сведения о типах модулей Runbook, их преимуществах и ограничениях, обратитесь к статье [Типы модулей Runbook в службе автоматизации Azure](automation-runbook-types.md).
-	Дополнительные сведения о функции поддержки скриптов PowerShell см. в статье [Нативная поддержка скриптов PowerShell в службе автоматизации Azure](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/).

<!---HONumber=AcomDC_0413_2016-->