---
title: "Выполнение модуля Runbook в службе автоматизации Azure | Документация Майкрософт"
description: "Рассматривается обработка модуля Runbook в службе автоматизации Azure."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: d10c8ce2-2c0b-4ea7-ba3c-d20e09b2c9ca
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 11/02/2016
ms.author: bwren
translationtype: Human Translation
ms.sourcegitcommit: dd6b2fa2a1ca003578eaee82ef42741b9b1bf2a4
ms.openlocfilehash: e8b2bf61313ef88c685e30524bb39da6355ef3ee


---
# <a name="runbook-execution-in-azure-automation"></a>Выполнение модуля Runbook в службе автоматизации Azure
При запуске модуля Runbook в службе автоматизации Azure создается задание. Задание — это одиночный выполняемый экземпляр модуля Runbook. Рабочий процесс службы автоматизации Azure назначается для выполнения каждого задания. Пока рабочие процессы используются несколькими учетными записями Azure, задания от различных учетных записей службы автоматизации изолируются друг от друга. Вы не контролируете, какой рабочий процесс будет обслуживать запрос для вашего задания.  В одном модуле Runbook могут иметься несколько запущенных заданий одновременно. При просмотре списка модулей Runbook на портале Azure в нем отобразится список состояний последнего задания для каждого модуля Runbook. Можно просматривать список заданий для каждого модуля Runbook и отслеживать состояние каждого из них. Описание различных состояний заданий см. в разделе [Состояния заданий](#job-statuses).

На следующей схеме показан жизненный цикл задания Runbook для [графических модулей Runbook](automation-runbook-types.md#graphical-runbooks) и [модулей Runbook рабочих процессов PowerShell](automation-runbook-types.md#powershell-workflow-runbooks).

![Состояния задания — рабочий процесс PowerShell](./media/automation-runbook-execution/job-statuses.png)

На следующей схеме показан жизненный цикл задания Runbook для [модулей Runbook PowerShell](automation-runbook-types.md#powershell-runbooks).

![Состояния задания — сценарий PowerShell](./media/automation-runbook-execution/job-statuses-script.png)

Задания будут иметь доступ к ресурсам Azure за счет подключения к ресурсам подписки Azure. Задания получают доступ к ресурсам в центре обработки данных, если эти ресурсы доступны из общедоступного облака.

## <a name="job-statuses"></a>Состояния заданий
Следующая таблица содержит описание различных состояний задания.

| Состояние | Описание |
|:--- |:--- |
| Завершено |Задание успешно выполнено. |
| Failed |Для [графических модулей Runbook и модулей Runbook рабочих процессов PowerShell](automation-runbook-types.md): не удалось скомпилировать модуль Runbook.  Для [модулей Runbook сценариев PowerShell](automation-runbook-types.md): не удалось запустить Runbook или задание породило исключение. |
| Задание не выполнено. Ожидание ресурсов. |Задание не выполнено, так как задание превысило ограничение [доли](#fairshare) три раза и было запущено с той же контрольной точки или с момента запуска модуля Runbook. |
| Поставлено в очередь |Задание ожидает появления доступных ресурсов в очереди автоматизации, которые позволят запустить задание. |
| Запуск |Задание было назначено рабочему процессу, и система скоро его запустит. |
| Возобновление |Система находится в процессе возобновления задания после его приостановки. |
| Выполнение |Задание выполняется. |
| Задание выполняется. Ожидание ресурсов. |Задание выгружено, поскольку превышено ограничение [доли](#fairshare) . Задание будет возобновлено позже с его последней контрольной точки. |
| Остановка |Задание было остановлено пользователем до его завершения. |
| Остановка |Система находится в процессе остановки задания. |
| Приостановлено |Задание было приостановлено пользователем, системой или с помощью команды в модуле Runbook. Приостановленное задание можно запустить снова, при этом оно возобновится с последней контрольной точки или с запуска модуля Runbook, если задание не имеет контрольных точек. Модуль Runbook будет приостановлен системой только при возникновении исключения. По умолчанию переменная ErrorActionPreference имеет значение **Продолжить** , то есть задание продолжит работу при возникновении ошибки. Если для этой переменной задать значение **Остановить** , задание будет приостановлено при возникновении ошибки.  Применяется только к [графическим модулям Runbook и модулям Runbook рабочих процессов PowerShell](automation-runbook-types.md) . |
| Приостановка |Система пытается приостановить задание по запросу пользователя. Модуль Runbook должен достичь следующей контрольной точки, прежде чем задание может быть приостановлено. Если последняя контрольная точка уже пройдена, задание будет завершено, прежде чем оно будет приостановлено.  Применяется только к [графическим модулям Runbook и модулям Runbook рабочих процессов PowerShell](automation-runbook-types.md) . |

## <a name="viewing-job-status-from-the-azure-portal"></a>Просмотр состояний заданий на портале Azure
Вы можете просматривать сводные данные о состоянии всех заданий Runbook или детализировать сведения об определенном задании на портале Azure. Также можно настроить интеграцию с рабочей областью Log Analytics в Microsoft Operations Management Suite (OMS) для пересылки состояния задания и потоков заданий Runbook.  Дополнительные сведения об интеграции с Log Analytics в OMS см. в статье [Пересылка состояния задания и потоков заданий из службы автоматизации в Log Analytics (OMS)](automation-manage-send-joblogs-log-analytics.md).  

### <a name="automation-runbook-jobs-summary"></a>Сводные данные заданий Runbook службы автоматизации
В колонке "Учетная запись автоматизации" можно посмотреть сводные данные о всех заданиях Runbook для выбранной учетной записи службы автоматизации в элементе **Статистика по заданиям**.<br><br> ![Элемент "Статистика по заданиям"](./media/automation-runbook-execution/automation-account-job-status-summary.png).<br> В этом элементе отображается количество и графическое представление состояний всех выполненных заданий.  

Щелкните плитку, чтобы открылась колонка **Задания**, в которой представлен общий список всех выполненных заданий с указанием их состояния, времени начала и завершения выполнения.<br><br> ![Колонка "Задания" учетной записи службы автоматизации](./media/automation-runbook-execution/automation-account-jobs-status-blade.png)<br><br>  Чтобы отфильтровать список заданий, в колонке **Задания** выберите **Фильтровать задания** и укажите критерий фильтрации. Для этого введите определенное имя модуля Runbook, выберите состояние задания или диапазон дат и времени из раскрывающегося списка.<br><br> ![Фильтрация по состоянию задания](./media/automation-runbook-execution/automation-account-jobs-filter.png)

Кроме того, для просмотра сводных данных о состоянии заданий определенного модуля Runbook можно выбрать этот модуль в колонке **Модули Runbook** учетной записи службы автоматизации, а затем выбрать элемент **Задания**.  Отобразится колонка **Задания**, в которой можно выбрать конкретную запись и просмотреть подробные сведения о задании и его выходные данные.<br><br> ![Колонка "Задания" учетной записи службы автоматизации](./media/automation-runbook-execution/automation-runbook-job-summary-blade.png)<br> 

### <a name="job-summary"></a>Сводные данные задания
Можно просмотреть список всех заданий, которые были созданы для конкретного модуля Runbook, и их последнее состояние. Можно фильтровать список по состоянию заданий и изменять диапазон дат для последнего изменения задания. Щелкните имя задания для просмотра его подробных сведений и результатов выполнения. Подробное представление задания содержит значения параметров Runbook, которые были указаны для этого задания.

Чтобы просмотреть задания для модуля Runbook, выполните следующие шаги.

1. На портале управления Azure выберите **Служба автоматизации** и затем имя учетной записи службы автоматизации.
2. Щелкните имя модуля Runbook.
3. Перейдите на вкладку **Задания** .
4. Щелкните столбец **Созданное задание** , чтобы просмотреть подробные сведения и результаты задания.

## <a name="retrieving-job-status-using-windows-powershell"></a>Получение состояния задания с помощью Windows PowerShell
Чтобы получить сведения о созданных для модуля Runbook заданиях и о конкретном задании, воспользуйтесь командлетом [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx). Если запустить модуль Runbook с помощью Windows PowerShell, то команда [Start-AzureRmAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx) возвращает результирующее задание. Получить выходные данные задания можно с помощью команды [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx).

Приведенные ниже примеры команд получают сведения о последнем задании для примера модуля Runbook и отображают его состояние, значения параметров Runbook, а также выходные данные этого задания.

    $job = (Get-AzureRmAutomationJob –AutomationAccountName "MyAutomationAccount" `
    –RunbookName "Test-Runbook" -ResourceGroupName "ResourceGroup01" | sort LastModifiedDate –desc)[0]
    $job.Status
    $job.JobParameters
    Get-AzureRmAutomationJobOutput -ResourceGroupName "ResourceGroup01" `
    –AutomationAccountName "MyAutomationAcct" -Id $job.JobId –Stream Output

## <a name="fair-share"></a>доли
Для совместного использования ресурсов всеми модулями Runbook в облаке служба автоматизации Azure временно выгружает любое задание после того, как его выполнение продолжалось в течение 3 часов.  [Графические модули](automation-runbook-types.md#graphical-runbooks) Runbook и модули Runbook [рабочего процесса PowerShell](automation-runbook-types.md#powershell-workflow-runbooks) будут возобновлены из последней [контрольной точки](http://technet.microsoft.com/library/dn469257.aspx#bk_Checkpoints). В течение этого времени для задания отображается состояние "Выполнение, ожидание ресурсов". Если модуль Runbook не имеет контрольных точек или задание не дошло до первой контрольной точки перед выгрузкой, то оно будет перезапущено с самого начала.  [PowerShell](automation-runbook-types.md#powershell-runbooks) всегда перезапускаются с самого начала, поскольку не поддерживают контрольные точки.

Если модуль Runbook перезапускается с той же контрольной точки или с самого начала три раза подряд, его работа принудительно завершается и модулю присваивается состояние "Сбой, ожидание ресурсов". Это необходимо, чтобы защитить систему от постоянного перезапуска модулей Runbook без завершения их работы, поскольку они не смогут достигнуть следующей контрольной точки без повторной выгрузки. В этом случае возникает следующее исключение со сбоем.

*Невозможно продолжить выполнение задания, так как оно было несколько раз прекращено до достижения контрольной точки. Убедитесь, что модуль Runbook не выполняет продолжительные операции без сохранения состояния.*

При создании модуля Runbook следует убедиться, что время для выполнения всех действий между двумя контрольными точками не превышает 3 часов. При необходимости добавьте контрольные точки в модуль Runbook, чтобы выполнение задач в нем не превышало 3 часов, или разбейте продолжительные операции. Например, модуль Runbook может выполнять повторную индексацию в крупной базе данных SQL. Если эта одиночная операция не завершится с учетом справедливого распределения ресурсов, то задание будет выгружено и перезапущено с самого начала. В этом случае следует разбить операцию повторного индексирования на несколько шагов, например повторное индексирование одной таблицы, после чего выполняется вставка контрольной точки после каждой операции, чтобы задание могло возобновиться после завершения последней операции.

## <a name="next-steps"></a>Дальнейшие действия
* Дополнительные сведения о разных методах запуска модуля Runbook см. в статье [Запуск модуля Runbook в службе автоматизации Azure](automation-starting-a-runbook.md).




<!--HONumber=Nov16_HO3-->


