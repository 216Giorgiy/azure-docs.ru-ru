---
title: "Обработка ошибок в графических модулях Runbook в службе автоматизации Azure | Документация Майкрософт"
description: "В этой статье описывается, как реализовать логику обработки ошибок в графических модулях Runbook в службе автоматизации Azure."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 12/26/2016
ms.author: magoedte
translationtype: Human Translation
ms.sourcegitcommit: f9b359691122da9e5d93e51f3085cad51e55d8f2
ms.openlocfilehash: 13c3e1693badcf4148738cb63666f34546d1696c

---

# <a name="error-handling-in-azure-automation-graphical-runbooks"></a>Обработка ошибок в графических модулях Runbook в службе автоматизации Azure

При проектировании модулей Runbook крайне важно определить различные состояния и условия, характерные для действий в модуле, например состояние успеха, состояния ожидаемых ошибок и условия непредвиденных ошибок.  Модули Runbook должны содержать логику обработки ошибок, позволяющую обнаруживать соответствующие состояния.  Чтобы проверить выходные данные действия или обработать ошибку соответствующим образом при использовании графических модулей Runbook, применяются такие стандартные методы, как выполнение действия кода PowerShell, определение условной логики в ссылке выходных данных действия и др.          

Зачастую, если при выполнении модулей Runbook с каким-либо действием возникает устранимая ошибка, последующее действие будет обрабатываться обычным образом.  Скорее всего, это вызовет исключение, но суть в том, что последующее действие все равно будет выполнено. Это связано с методом обработки ошибок, реализованном в языке PowerShell.    

Во время выполнения могут возникнуть неустранимые и устранимые ошибки PowerShell.  Ниже изложены их различия.

* Неустранимая ошибка: серьезная ошибка, возникающая во время выполнения, которая полностью останавливает выполнение команды (или скрипта). К примерам можно отнести несуществующие командлеты, синтаксические ошибки, предотвращающие выполнение командлета, и другие критические ошибки.

* Устранимая ошибка: несерьезная ошибка, которая не останавливает выполнение. Примеры включают в себя ошибки из-за отсутствия файла, проблемы с разрешениями и т. д.

В импортированные графические модули Runbook в службе автоматизации Azure можно добавить логику обработки ошибок, позволяющую преобразовывать исключения в устранимые ошибки и создавать ссылки ошибок между действиями. Таким образом автор модуля Runbook может настроить перехват ошибок и управлять реализованными или непредвиденными условиями.  

## <a name="when-to-use"></a>Сценарии использования

Управление выполнением рабочего процесса позволяет предотвратить переход к следующему действию в модуле Runbook и соответствующим образом обработать ошибку при наличии критичного действия, которое вызывает ошибку или исключение.  Это особенно важно, если модули Runbook поддерживают бизнес-процессы или операции, связанные со службами.

Для каждого действия, которое может вызвать ошибку, автор модуля Runbook может добавить ссылку ошибки, указывающую на любое другое действие.  Действие назначения может быть любого типа: действие кода, вызов командлета, вызов другого модуля Runbook или что-нибудь еще. 

Кроме того, действие назначения может иметь исходящие ссылки, обычные или ссылки ошибок. Таким образом автор модуля Runbook может применять сложную логику обработки ошибок, не требующую использования действия кода.  Рекомендуется создать выделенный модуль Runbook для обработки ошибок, обеспечивающий общие возможности. Однако это необязательно, и логика обработки ошибок в действии кода PowerShell — не единственный метод.  

Например, рассмотрим модуль Runbook, который пытается запустить виртуальную машину и установить на нее приложение, но если виртуальная машина запускается неправильно, он выполняет два действия. 

1. Отправляет уведомление об этой проблеме.
2. Запускает другой модуль Runbook, который автоматически подготавливает новую виртуальную машину. 

В этом случае можно создать ссылку ошибки, указывающую на действие для обработки шага 1, например командлет **Write-Warning**, связанный с действием для шага 2, например командлет **Start-AzureRmAutomationRunbook**. 

Можно также обобщить это поведение для нескольких модулей Runbook и поместить эти два действия в отдельные модули для обработки ошибок, следуя рекомендациям, приведенным выше.  Перед вызовом этого модуля Runbook для обработки ошибок можно создать пользовательское сообщение на основе данных в исходном модуле и передать его как параметр в модуль для обработки ошибок. 

## <a name="how-to-use"></a>Использование

Каждое действие настроено для преобразования исключений в устранимые ошибки. Эта функция отключена по умолчанию.  Вам следует включить эту функцию для любого действия, требующего обработки ошибок.  Если вы включите эту конфигурацию, неустранимые и устранимые ошибки в действии будут обрабатываться как устранимые ошибки, а затем к ним может быть применена ссылка ошибки.  После настройки этого параметра нужно создать действия, которые будут обрабатывать ошибку.  Если действие вызовет ошибку, будет выполнен переход только по исходящим ссылкам ошибок, а по обычным — нет, даже если в результате выполнения действия были сформированы стандартные выходные данные.<br><br> ![Пример ссылки ошибки в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/error-link-example.png)

В следующем простом примере у нас есть модуль Runbook, который получает переменную, содержащую имя компьютера виртуальной машины, а затем пытается запустить виртуальную машину в следующем действии.<br><br> ![Пример обработки ошибок в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/runbook-example-error-handling.png)<br><br>      

Действия **Get-AutomationVariable** и **Start-AzureRmVm** настроены для преобразования исключений в ошибки.  Если не удается получить переменную или запустить виртуальную машину, возникнут ошибки.<br><br> ![Параметры действия обработки ошибок в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)

Ссылки ошибок ведут от этих действий к одному действию **управления ошибками** (действие кода), которое можно настроить с помощью простого выражения PowerShell, используя ключевое слово *Throw* для остановки обработки, а также *$Error.Exception.Message* для получения сообщения, описывающего текущее исключение.<br><br> ![Пример кода для обработки ошибок в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)


## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о ссылках в графических модулях Runbook и их типах см. в статье [Графическая разработка в службе автоматизации Azure](automation-graphical-authoring-intro.md#links-and-workflow).

* Чтобы узнать больше о выполнении модулей Runbook, отслеживании заданий Runbook и других технических деталях, ознакомьтесь с [отслеживанием задания Runbook](automation-runbook-execution.md) 


<!--HONumber=Jan17_HO1-->


