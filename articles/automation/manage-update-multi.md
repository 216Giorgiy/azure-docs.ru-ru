---
title: "Управление обновлениями для нескольких виртуальных машин Azure | Документация Майкрософт"
description: "В этой статье описывается управление обновлениями для виртуальных машин Azure."
services: automation
documentationcenter: 
author: eslesar
manager: carmonm
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 10/31/2017
ms.author: magoedte;eslesar
ms.openlocfilehash: 80a6caff51631637825d560d270198be0336e806
ms.sourcegitcommit: 43c3d0d61c008195a0177ec56bf0795dc103b8fa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/01/2017
---
# <a name="manage-updates-for-multiple-azure-virtual-machines"></a>Управление обновлениями для нескольких виртуальных машин Azure

Управление обновлениями позволяет управлять обновлениями и исправлениями виртуальных машин Azure.
С помощью учетной записи [службы автоматизации Azure](automation-offering-get-started.md) можно быстро подключить виртуальные машины, оценить состояния доступных обновлений, запланировать установку необходимых обновлений и просмотреть результаты развертывания для проверки успешности применения обновлений для всех виртуальных машин, для которых было включено управление обновлениями.

## <a name="prerequisites"></a>Предварительные требования

Чтобы использовать решение управления обновлениями, требуется:

* Учетная запись службы автоматизации Azure. Указания по созданию учетной записи службы автоматизации Azure см. в статье [Приступая к работе со службой автоматизации Azure](automation-offering-get-started.md).

* Виртуальная машина или компьютер, где установлена одна из поддерживаемых операционных систем.

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

Решение управления обновлениями поддерживается в следующих операционных системах.

### <a name="windows"></a>Windows

* Windows Server 2008 и более поздние версии и развертывания обновлений в Windows Server 2008 R2 SP1 и более поздних версий.  Параметры установки Server Core и Nano Server не поддерживаются.

    > [!NOTE]
    > Для поддержки развертывания обновлений для Windows Server 2008 R2 с пакетом обновления 1 (SP1) требуется .NET Framework 4.5 и WMF 5.0 или более поздней версии.
    > 
* Операционные системы клиента Windows не поддерживаются.

На агентах Windows необходимо настроить связь с сервером служб Windows Server Update Services (WSUS) или доступ к Центру обновления Майкрософт.

> [!NOTE]
> Агентом Windows нельзя управлять параллельно с помощью System Center Configuration Manager.
>

### <a name="linux"></a>Linux

* CentOS 6 (x86 или x64) и 7 (x64)  
* Red Hat Enterprise 6 (x86 или x64) и 7 (x64)  
* SUSE Linux Enterprise Server 11 (x86 или x64) и 12 (x64)  
* Ubuntu 12.04 LTS и более поздняя версия x86 или x64   

> [!NOTE]  
> Чтобы обновления применялись только в период обслуживания в Ubuntu, повторно настройте пакет unattended-upgrades и отключите автоматическое обновление. Дополнительные сведения о настройке см. в разделе [Автоматические обновления](https://help.ubuntu.com/lts/serverguide/automatic-updates.html) руководства по Ubuntu Server.

У агентов Linux должен быть доступ к репозиторию обновлений.

> [!NOTE]
> Это решение не поддерживает агент OMS для Linux, настроенный для отправки отчетов в несколько рабочих областей OMS.  
>

## <a name="enable-update-management-for-azure-virtual-machines"></a>Включение управления обновлениями для виртуальных машин Azure

1. На портале Azure откройте учетную запись службы автоматизации.
2. В левой части экрана выберите **Управление обновлениями**.
3. В верхней части экрана щелкните **Add Azure VM** (Добавить виртуальную машину Azure).
    ![Подключенные виртуальные машины](./media/manage-update-multi/update-onboard-vm.png)
4. Выберите виртуальную машину для подключения. Появится экран **Enable Update Management** (Включение управления обновлениями).
5. Нажмите **Включить**.

   ![Включение управления обновлениями](./media/manage-update-multi/update-enable.png)

Управление обновлениями включено для виртуальной машины.

## <a name="enable-update-management-for-non-azure-virtual-machines-and-computers"></a>Включение управления обновлениями для виртуальных машин Azure и компьютеров

Инструкции по включению управления обновлениями для компьютеров и виртуальных машин Windows, не относящихся к Azure, см. в статье [Подключение компьютеров Windows к службе Log Analytics в Azure](../log-analytics/log-analytics-windows-agents.md).

Инструкции по включению управления обновлениями для компьютеров и виртуальных машин Linux, не относящихся к Azure, см. в статье [Подключение компьютеров Linux в Operations Management Suite (OMS)](../log-analytics/log-analytics-agent-linux.md).

## <a name="view-update-assessment"></a>Просмотр оценок обновления

После включения решения **Управление обновлениями** отобразится экран **Управление обновлениями**. На вкладке **Отсутствующие обновления** можно просмотреть список отсутствующих обновлений.

## <a name="data-collection"></a>Сбор данных

Агенты, установленные на виртуальных машинах и компьютерах, собирают данные об обновлениях и отправляют их в решение управления обновлениями Azure.

### <a name="supported-agents"></a>Поддерживаемые агенты

В следующей таблице описаны подключенные источники, которые поддерживаются этим решением.

| Подключенный источник | Поддерживаются | Описание |
| --- | --- | --- |
| Агенты Windows |Да |Решение управления обновлениями собирает сведения об обновлениях системы с агентов Windows и запускает установку требуемых обновлений. |
| Агенты Linux |Да |Решение управления обновлениями собирает сведения об обновлениях системы с агентов Linux и запускает установку требуемых обновлений для поддерживаемых дистрибутивов. |
| Группа управления Operations Manager |Да |Решение управления обновлениями собирает сведения о системных обновлениях с агентов, состоящих в подключенной группе обновления. |
| Учетная запись хранения Azure. |Нет |В хранилище Azure не хранятся сведения о системных обновлениях. |

### <a name="collection-frequency"></a>Частота сбора

Дважды в день выполняется проверка каждого управляемого компьютера Windows. Каждые 15 минут вызывается API Windows, чтобы выполнить запрос последнего времени обновления для определения изменения статуса. В случае его изменения запускается проверка на соответствие.  Каждые три часа выполняется проверка всех управляемых компьютеров Linux.

Отображение обновленных данных на управляемых компьютерах на панели мониторинга может занять от 30 минут до 6 часов.

## <a name="schedule-an-update-deployment"></a>Планирование развертывания обновлений

Чтобы установить обновления, составьте план развертывания в рамках графика выпуска и периода обслуживания.
Вы можете выбрать типы обновлений, которые будут включены в развертывание. Например, можно включить только критические обновления или обновления для системы безопасности и исключить накопительные пакеты обновления.

Новое развертывание обновления для одной или нескольких виртуальных машин можно запланировать, щелкнув **Schedule update deployment** (Планирование развертывания обновления) в верхней части экрана **Update management** (Управление обновлениями). На экране **New update deployment** (Новое развертывание обновлений) укажите следующее:

* **Имя.** Введите уникальное имя для идентификации развертывания обновлений.
* **Тип ОС**. Выберите Windows или Linux.
* **Computers to update** (Компьютеры для обновления). Выберите виртуальные машины, которые необходимо обновить.

  ![Выбор виртуальных машин для обновления](./media/manage-update-multi/update-select-computers.png)

* **Категория обновления.** Выберите типы программного обеспечения, которые будут включены в развертывание обновления. Ниже приведены типы классификации:
  * критические обновления;
  * обновления для системы безопасности;
  * накопительные пакеты обновления;
  * пакеты дополнительных компонентов;
  * пакеты обновления;
  * обновления определений;
  * Средства
  * Обновления
* **Параметры расписания.** Вы можете принять дату и время по умолчанию (на 30 минут больше текущего времени) либо указать другое время.
   Кроме того, можно указать, происходит ли развертывание один раз, или настроить расписание повторяющегося развертывания. Щелкните параметр Recurring (Повторяющееся) в разделе "Повторение", чтобы настроить повторяющееся расписание.

   ![Экран параметров обновления расписания](./media/manage-update-multi/update-set-schedule.png)

* **Maintenance window (minutes)** (Период обслуживания (в минутах)). Укажите временной период, в течение которого произойдет обновление развертывания.  Это гарантирует, что изменения выполняются в рамках заданного периода обслуживания.

Завершив настройку расписания, нажмите кнопку **Создать** и вернитесь к панели мониторинга состояния.
Обратите внимание, что таблица **Запланирован** показывает созданное расписание развертываний.

> [!WARNING]
> Для обновлений, требующих перезагрузки, виртуальная машина будет перезапущена автоматически.

## <a name="view-results-of-an-update-deployment"></a>Просмотр результатов развертывания обновлений

После запуска запланированного развертывания его состояние можно просмотреть на экране **Update deployments** (Развертывания обновлений) на вкладке **Update deployments** (Развертывания обновлений).
Если оно выполняется в данный момент, отображается состояние **Выполнение**. При успешном завершении появится состояние **Выполнено**.
В случае сбоя одного или нескольких обновлений в развертывании для состояния будет установлено значение **Частичный сбой**.

![Обновление состояния развертывания ](./media/manage-update-multi/update-view-results.png)

Щелкните завершенное развертывание обновлений, чтобы просмотреть панель мониторинга этого развертывания обновлений.

Плитка **Update results** (Результаты обновления) является сводкой общего количества обновлений и результатов развертывания на виртуальной машине.
В таблице справа представлен подробный разбор каждого обновления и результатов установки, которые могут принимать одно из следующих значений:

* Not attempted (Попытка не предпринималась). Обновление не установлено из-за недостатка времени в связи с заданной длительностью окна обслуживания.
* Выполнено. Обновление было успешно выполнено.
* Сбой. Обновление не удалось выполнить.

Щелкните **Все журналы** для просмотра всех записей журнала, созданных при развертывании.

Щелкните плитку **Вывод** для просмотра потока заданий runbook, отвечающих за управление развертыванием обновления на целевой виртуальной машине.

Щелкните **Ошибки**, чтобы просмотреть подробные сведения о любых ошибках развертывания.

Подробные сведения о журналах, выходных данных и сведения об ошибке см. в статье [Решение для управления обновлениями в OMS](../operations-management-suite/oms-solution-update-management.md).

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения об управлении обновлениями см. в статье [Решение для управления обновлениями в OMS](../operations-management-suite/oms-solution-update-management.md).