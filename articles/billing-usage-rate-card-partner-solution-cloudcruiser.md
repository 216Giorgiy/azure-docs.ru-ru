<properties
   pageTitle="Интеграция Cloud Cruiser и API выставления счетов Microsoft Azure"
   description="В нем описан уникальный опыт Cloud Cruiser — партнера по выставлению счетов Microsoft Azure — по интеграции API выставления счетов Azure в свои продукты. Эти сведения особенно полезны для клиентов Azure и Cloud Cruiser, которые хотели бы использовать Cloud Cruiser для Microsoft Azure Pack или уже рассматривают такой вариант."
   services="billing"
   documentationCenter=""
   authors="BryanLa"
   manager="mbaldwin"
   editor=""/>

<tags
   ms.service="billing"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="billing"
   ms.date="06/17/2015"
   ms.author="mobandyo;sirishap;bryanla"/>

# Интеграция Cloud Cruiser и API выставления счетов Microsoft Azure 

В этой статье описаны способы использования сведений, собранных из новых API выставления счетов Microsoft Azure , в Cloud Cruiser для моделирования и анализа стоимости рабочих процессов.

## API RateCard Azure
API RateCard предоставляет информацию о тарифах в Azure. После прохождения проверки подлинности с помощью подходящих учетных данных вы можете направить в API запрос для сбора метаданных по доступным в Azure службам, а также сведений о тарифах, связанных с вашим идентификатором запроса.

Ниже приведен образец ответа из API, отображающий цены на экземпляр A0 (Windows):

    {       
		"MeterId": "0e59ad56-03e5-4c3d-90d4-6670874d7e29",       
		"MeterName": "Compute Hours",       
		"MeterCategory": "Virtual Machines",       
		"MeterSubCategory": "A0 VM (Windows)",       
		"Unit": "Hours",       
		"MeterRates": 
		{         
			"0": 0.029       
		},       
		"EffectiveDate": "2014-08-01T00:00:00Z",       
		"IncludedQuantity": 0.0     
	}, 

## Интерфейс Cloud Cruiser для API RateCard Azure
Cloud Cruiser может по-разному использовать сведения, полученные API RateCard. В этой статье будет показано, как их использовать для моделирования и анализа стоимости рабочих процессов IaaS.

Для демонстрации данного варианта использования представьте себе рабочую нагрузку нескольких экземпляров, работающих в Microsoft Azure Pack (WAP). Целью является моделирование той же самой рабочей нагрузки в Azure и оценка затрат на осуществление такой миграции. Чтобы обеспечить такое моделирование, необходимо выполнить две основные задачи:

1. **Импорт и обработка информации о службе, собираемой посредством API RateCard** — эта задача также выполняется с книгами, где извлеченные из API RateCard сведения преобразуются и публикуются в новом тарифном плане. Этот новый тарифный план будет использоваться при моделировании для оценки цен Azure.

2. **Нормализация служб WAP и служб Azure для IaaS** — по умолчанию службы WAP основаны на отдельных ресурсах (ЦП, объем памяти, место на диске и т. д.), а службы Azure основаны на размере экземпляра (A0, A1, A2 и т. д.). Первую задачу может выполнить ядро извлечения, преобразования и загрузки Cloud Cruiser, которое называется книгами, где эти ресурсы могут объединяться по размерам экземпляров, аналогично службам экземпляров Azure.

## Импорт данных из API RateCard

Книги Cloud Cruiser предоставляют автоматический метод сбора и обработки информации из API RateCard. Книги извлечения, преобразования и загрузки позволяют настраивать сбор, преобразование и публикацию данных в базе данных Cloud Cruiser.

Каждая книга может иметь одну или несколько коллекций. Это позволяет сопоставлять данные из разных источников для дополнения или расширения данных об использовании. На двух приведенных ниже снимках экрана показано создание новой *коллекции* в существующей книге и импорт данных из API RateCard в эту *коллекцию*:

![Рис. 1. Создание новой коллекции][1]

![Рис. 2. Импорт данных из новой коллекции][2]

После импорта данных в книгу можно создать несколько действий и процессов преобразования для изменения и моделирования данных. В этом примере, поскольку нас интересует только инфраструктура как служба (IaaS), можно использовать действия преобразования для удаления ненужных строк или записей, относящихся к службам, отличным от IaaS.

На следующем снимке экрана показаны действия преобразования, используемые для обработки собранных из API RateCard данных:

![Рис. 3. Действия преобразования для обработки данных, собранных из API RateCard][3]

## Определение новых служб и тарифных планов

В Cloud Cruiser доступны различные способы определения служб. Один из вариантов заключается в импорте служб из данных об использовании. Этот метод широко распространен при работе с общедоступными облаками, где службы уже определены поставщиком.

Тарифный план — это набор тарифов или цен, которые, среди прочего, могут применяться к различным службам в определенные периоды действия или группам клиентов. Тарифные планы в Cloud Cruiser также можно использовать для создания моделей или сценариев "что если", чтобы понять, как изменения в службах могут повлиять на общую стоимость рабочей нагрузки.

В этом примере сведения о службе из API RateCard используются для определения новых служб в Cloud Cruiser. Аналогичным образом можно использовать связанные со службами тарифы для создания нового тарифного плана в Cloud Cruiser.

В конце процесса преобразования можно создать новое действие и публиковать данные из API RateCard в качестве новых служб и тарифов.

![Рис. 4. Публикация данных из API RateCard в качестве новых служб и тарифов][4]

## Проверка служб Azure и тарифов

После публикации служб и тарифов можно проверить список импортированных служб на вкладке *Службы* Cloud Cruiser:

![Рис. 5. Проверка новых служб][5]

На вкладке *Тарифные планы* можно ознакомиться с новым тарифным планом, который называется AzureSimulation и содержит тарифы, импортированные из API RateCard.

![Рис. 6. Проверка нового тарифного плана и связанных с ним тарифов][6]

## Нормализация WAP и служб Azure

По умолчанию WAP предоставляет сведения об использовании на основе уровня использования вычислительных ресурсов, ресурсов памяти и сетевых ресурсов. В Cloud Cruiser можно определить службы непосредственно на основе выделения или измеренного уровня использования этих ресурсов. Например, можно задать базовый тариф за каждый час использования ЦП или ставку за гигабайт памяти, выделенной для экземпляра.

В этом примере для сравнения затрат между WAP и Azure необходимо агрегировать использование ресурсов WAP в пакеты, которые затем можно будет сопоставить со службами Azure. Это преобразование можно легко реализовать в книгах:

![Рис. 7. Преобразование данных WAP для нормализации служб][7]

Последним действием в книге является публикация данных в базе данных Cloud Cruiser. На этом этапе данные об использовании собраны в пакеты (которые сопоставляются со службами Azure) и привязаны к тарифам по умолчанию для формирования расходов.

После завершения книги вы можете автоматизировать обработку данных, добавив новую задачу в планировщик и указав частоту и время выполнения книги.

![Рис. 8. Планирование книги][8]

## Создание отчетов для анализа моделирования стоимости рабочей нагрузки

По мере сбора данных об использовании и загрузке расходов в базу данных Cloud Cruiser можно использовать модуль Cloud Cruiser Insights — средство создания расширенных аналитических отчетов — для обеспечения нужного моделирования стоимости рабочей нагрузки.

Чтобы продемонстрировать этот сценарий, был создан следующий отчет:

![Сравнение стоимости][9]

На верхней диаграмме показано сравнение затрат с разбивкой по отдельным службам, а также сравнивается стоимость выполнения рабочей нагрузки для каждой конкретной между WAP (темно-синий цвет) и Azure (голубой цвет).

На нижней диаграмме показаны те же самые данные, но с разбивкой по отделам. Здесь указаны затраты каждого отдела на выполнение своей рабочей нагрузки в WAP и Azure, а также разница между этими двумя значениями — то есть экономия (зеленый цвет).

## Дальнейшие действия

+ Подробные инструкции по созданию книг и отчетов Cloud Cruiser см. в электронной [документации](http://docs.cloudcruiser.com/) по Cloud Cruiser (требуется действительное имя входа). Для получения дополнительных сведений о Cloud Cruiser обратитесь по адресу [info@cloudcruiser.com](mailto:info@cloudcruiser.com).
+ В статье [Получение ценных сведений о потреблении ресурсов Microsoft Azure](billing-usage-rate-card-overview.md) приведены общие сведения об API использования ресурсов и RateCard в Azure. 
+ В статье [Справочник по API REST выставления счетов в Azure](https://msdn.microsoft.com/library/azure/1ea5b323-54bb-423d-916f-190de96c6a3c) приведены дополнительные сведения о двух API, которые входят в состав набора API, предоставляемого диспетчером ресурсов Azure.
+ Если вы хотите подробнее изучить код примера, посетите страницу [Образцы кода API выставления счетов Microsoft Azure на Github](https://github.com/Azure/BillingCodeSamples).

## Подробнее
+ В статье [Обзор диспетчера ресурсов Azure](resource-group-overview.md) приведены дополнительные сведения о диспетчере ресурсов Azure.

<!--Image references-->
[1]: ./media/billing-usage-rate-card-partner-solution-cloudcruiser/Create-New-Workbook-Collection.png "Рис. 1. Создание новой коллекции"
[2]: ./media/billing-usage-rate-card-partner-solution-cloudcruiser/Import-Data-From-RateCard.png "Рис. 2. Импорт данных из новой коллекции"
[3]: ./media/billing-usage-rate-card-partner-solution-cloudcruiser/Transformation-Steps-Process-RateCard-Data.png "Рис. 3. Действия преобразования для обработки данных, собранных из API RateCard"
[4]: ./media/billing-usage-rate-card-partner-solution-cloudcruiser/Publish-RateCard-Data-New-Services-Rates.png "Рис. 4. Публикация данных из API RateCard в качестве новых служб и тарифов"
[5]: ./media/billing-usage-rate-card-partner-solution-cloudcruiser/Verify-Azure-Services-And-Pricing1.png "Рис. 5. Проверка новых служб"
[6]: ./media/billing-usage-rate-card-partner-solution-cloudcruiser/Verify-Azure-Services-And-Pricing2.png "Рис. 6. Проверка нового тарифного плана и связанных с ним тарифов"
[7]: ./media/billing-usage-rate-card-partner-solution-cloudcruiser/Transforming-WAP-Normalize-Services.png "Рис. 7. Преобразование данных WAP для нормализации служб"
[8]: ./media/billing-usage-rate-card-partner-solution-cloudcruiser/Workbook-Scheduling.png "Рис. 8. Планирование книги"
[9]: ./media/billing-usage-rate-card-partner-solution-cloudcruiser/Workload-Cost-Simulation-Report.png "Рис. 9. Образец отчета для сценария сравнения стоимости рабочей нагрузки"

<!---HONumber=August15_HO6-->