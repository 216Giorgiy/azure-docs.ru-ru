---
title: Создание сложных расписаний и расширенного повторения с помощью планировщика Azure
description: Узнайте, как создавать сложные расписания и расширенное повторение с помощью планировщика Azure.
services: scheduler
documentationcenter: .NET
author: derek1ee
manager: kevinlam1
editor: ''
ms.assetid: 5c124986-9f29-4cbc-ad5a-c667b37fbe5a
ms.service: scheduler
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 08/18/2016
ms.author: deli
ms.openlocfilehash: 4293442e13fc4bae871b1f32a3ed4231d9f32632
ms.sourcegitcommit: c765cbd9c379ed00f1e2394374efa8e1915321b9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/28/2018
ms.locfileid: "29692340"
---
# <a name="build-complex-schedules-and-advanced-recurrence-with-azure-scheduler"></a>Создание сложных расписаний и расширенного повторения с помощью планировщика Azure

Основную роль в любом задании планировщика Azure играет расписание. Именно оно определяет время и способ выполнения каждого задания. 

Планировщик позволяет настроить для задания несколько одноразовых и повторяющихся расписаний. Одноразовые расписания запускаются один раз в указанное время. По сути это повторяющиеся расписания, которые выполняются только один раз. Повторяющиеся расписания запускаются с указанной периодичностью.

Благодаря этой гибкости планировщик можно использовать для самых разнообразных бизнес-сценариев.

* **Периодическая очистка данных**. Например, ежедневное удаление всех твитов старше трех месяцев.
* **Архивация**. Например, ежемесячное создание резервной копии всей истории счетов.
* **Запросы внешних данных**. Например, получение нового прогноза погоды для лыжников от NOAA каждые 15 минут.
* **Обработка изображений**. Например, сжатие всех загруженных за день изображений с помощью системы облачных вычислений каждый день в период пиковой нагрузки.

В этой статье будут рассмотрены примеры заданий, которые можно создавать с помощью планировщика. Для каждого расписания приводятся соответствующие данные JSON. Если вы используете [REST API планировщика](https://msdn.microsoft.com/library/mt629143.aspx), применяйте эти данные JSON для [создания заданий в планировщике](https://msdn.microsoft.com/library/mt629145.aspx).

## <a name="supported-scenarios"></a>Поддерживаемые сценарии использования.
Примеры в этой статье иллюстрируют ряд сценариев, поддерживаемых планировщиком. В следующих примерах широко показаны способы создания расписаний для самых разных моделей поведения, включая следующие:

* Однократное выполнение в определенный день и в конкретное время.
* Выполнение и повтор определенное количество раз.
* Незамедлительное выполнение и повтор.
* Выполнение и повтор через каждые *n* минут, часов, дней, недель или месяцев, начиная с определенного времени.
* Выполнение и повтор на еженедельной или ежемесячной основе, но только в указанные дни недели или месяца.
* Выполнение и повтор несколько раз за период. Например, в последнюю пятницу и понедельник каждого месяца или каждый день в 05:15 и 17:15.

## <a name="date-and-date-time"></a>Значения даты и даты и времени
Ссылки на даты в заданиях планировщика соответствуют [спецификации ISO-8601](http://en.wikipedia.org/wiki/ISO_8601) и содержат только дату.

Ссылки на даты и время в планировщике заданий соответствуют [спецификации ISO 8601](http://en.wikipedia.org/wiki/ISO_8601) и включают как дату, так и время. Предполагается, что даты и время без обозначения часового пояса указаны по UTC.  

## <a name="use-json-and-the-rest-api-to-create-a-schedule"></a>Создание расписаний с помощью JSON и REST API
Чтобы создать простое расписание с помощью [REST API планировщика](https://msdn.microsoft.com/library/mt629143), сначала [зарегистрируйте подписку в поставщике ресурсов](https://msdn.microsoft.com/library/azure/dn790548.aspx). Имя поставщика для планировщика— **Microsoft.Scheduler**. Затем [создайте коллекцию заданий](https://msdn.microsoft.com/library/mt629159.aspx). Наконец, [создайте задание](https://msdn.microsoft.com/library/mt629145.aspx). 

Создавая задание, можно задать расписание и периодичность его выполнения, используя данные JSON как в следующем фрагменте кода:

    {
        "startTime": "2012-08-04T00:00Z", // Optional
         …
        "recurrence":                     // Optional
        {
            "frequency": "week",     // Can be "year", "month", "day", "week", "hour", or "minute"
            "interval": 1,                // How often to fire
            "schedule":                   // Optional (advanced scheduling specifics)
            {
                "weekDays": ["monday", "wednesday", "friday"],
                "hours": [10, 22]                      
            },
            "count": 10,                  // Optional (default to recur infinitely)
            "endTime": "2012-11-04",      // Optional (default to recur infinitely)
        },
        …
    }

## <a name="job-schema-basics"></a>Основные параметры схемы заданий
В приведенной ниже таблице представлен общий обзор основных элементов, которые вы используете, чтобы задать периодичность выполнения и расписание задания.

| Имя JSON | ОПИСАНИЕ |
|:--- |:--- |
| **startTime** |Значение даты и времени. В простых расписаниях **startTime** указывает время первого запуска. В сложных расписаниях задание не запускается раньше, чем **startTime**. |
| **recurrence** |Определяет правила и периодичность повтора задания. Объект recurrence поддерживает следующие элементы: **frequency**, **interval**, **endTime**, **count** и **schedule**. Если задан объект **recurrence**, требуется также элемент **frequency**. Остальные элементы объекта **recurrence** необязательны. |
| **frequency** |Строка, которая определяет частоту повторного выполнения задания. Частота может быть указана в минутах, часах, днях, неделях и месяцах. |
| **interval** |Положительное целое число. Элемент **interval** обозначает интервал для значения **frequency**, которое определяет, как часто выполняется задание. Например, если **interval** равен 3, а в качестве значения элемента **frequency** выбрана неделя, задание выполняется повторно через каждые три недели.<br /><br />Максимальное значение элемента **interval** в планировщике составляет 18 для ежемесячной частоты, 78 для еженедельной частоты и 548 для ежедневной частоты. Для часов и минут поддерживается следующий диапазон: 1 <= **interval** <= 1000. |
| **endTime** |Строка, которая определяет дату и время, после наступления которых задание не выполняется. Значение строки **endTime** не может быть в прошлом. Если параметры **endTime** и **count** не указаны, задание выполняется бесконечно. Одно и то же задание не может иметь одновременно параметры **endTime** и **count**. |
| **count** |Целое положительное число (больше нуля), которое указывает, сколько раз это задание будет запускаться до того, как оно завершится.<br /><br />Параметр **count** определяет, после какого числа повторных выполнений задание будет считаться завершенным. Например, если задание с параметром **count**, значение которого равно 5, начинает выполняться в понедельник, оно будет завершено после выполнения в пятницу. Если начальная дата задания находится в прошлом, за время первого выполнения принимается время создания.<br /><br />Если параметр **endTime** или **count** не указан, задание выполняется бесконечно. Одно и то же задание не может иметь одновременно параметры **endTime** и **count**. |
| **schedule** |Задание с указанной частотой выполняется по расписанию. Значение **schedule** содержит изменения с учетом минут, часов, дней недели, чисел месяца и количества недель. |

## <a name="job-schema-defaults-limits-and-examples"></a>Параметры схемы заданий по умолчанию, ограничения и примеры
Далее в этой статье мы рассмотрим каждый из приведенных ниже элементов более подробно.

| Имя JSON | Тип значения | Обязательный? | Значение по умолчанию | Допустимые значения | Пример |
|:--- |:--- |:--- |:--- |:--- |:--- |
| **startTime** |строка |Нет  |None |Дата и время по спецификации ISO 8601 |`"startTime" : "2013-01-09T09:30:00-08:00"` |
| **recurrence** |object |Нет  |None |Объект recurrence |`"recurrence" : { "frequency" : "monthly", "interval" : 1 }` |
| **frequency** |строка |Yes |None |"minute" (минута), "hour" (час), "day" (день), "week" (неделя), "month" (месяц) |`"frequency" : "hour"` |
| **interval** |number |Yes |Нет |От 1 до 1000 |`"interval":10` |
| **endTime** |строка |Нет  |None |Значение даты и времени, представляющее время в будущем |`"endTime" : "2013-02-09T09:30:00-08:00"` |
| **count** |number |Нет  |Нет |>=1 |`"count": 5` |
| **schedule** |object |Нет  |Нет |Объект schedule |`"schedule" : { "minute" : [30], "hour" : [8,17] }` |

## <a name="deep-dive-starttime"></a>Подробно: startTime
В указанной ниже таблице описано, каким образом параметр **startTime** управляет выполнением заданий.

| Значение startTime | Количество повторов | Повторение без расписания | Повторение с расписанием |
|:--- |:--- |:--- |:--- |
| **Время начала не указано** |Задание выполняется один раз сразу после запуска. |Задание выполняется один раз сразу после запуска. Последующие выполнения производятся с учетом времени предыдущего выполнения. |Задание выполняется один раз сразу после запуска.<br /><br />Последующие выполнения производятся по расписанию повторов. |
| **Время начала в прошлом** |Задание выполняется один раз сразу после запуска. |Время выполнения задания рассчитывается как время первого выполнения после времени начала.<br /><br />Последующие выполнения производятся с учетом времени предыдущего выполнения. <br /><br />Чтобы получить дополнительные сведения, просмотрите пример, представленный после этой таблицы. |Выполнение задания начинается *не раньше* указанного времени начала. Первое выполнение производится по расписанию, которое отсчитывается от времени начала.<br /><br />Последующие выполнения производятся по расписанию повторов. |
| **Время начала в будущем или в настоящем** |Задание выполняется один раз в указанное время начала. |Задание выполняется один раз в указанное время начала.<br /><br />Последующие выполнения производятся с учетом времени предыдущего выполнения.|Выполнение задания начинается *не раньше* указанного времени начала. Первое выполнение производится по расписанию, которое отсчитывается от времени начала.<br /><br />Последующие выполнения производятся по расписанию повторов. |

Рассмотрим, как работает триггер, для которого время **startTime** установлено в прошлом, указан параметр recurrence и отсутствует параметр schedule.  Допустим, текущее время — 2015-04-08 13:00, **startTime** — 2015-04-07 14:00, а повтор (**recurrence**) выполняется раз в два дня (т. е. параметр **frequency** имеет значение day, а **interval** равен 2). Обратите внимание, что время **startTime** находится в прошлом и наступает раньше текущего времени.

В этих условиях первое выполнение задания произойдет 9.04.2015 в 14:00. От времени начала ядро планировщика отсчитывает время повторных выполнений. Выполнения, которые приходятся на прошлое, игнорируются. Ядро берет очередной случай выполнения, который приходится на будущее. В этом случае **startTime**— это 2015-04-07 14:00, поэтому в следующий раз задание будет выполнено через два дня, 09.04.2015 в 14:00.

Обратите внимание, что время первого выполнения будет одинаковым независимо от того, имеет параметр **startTime** значение 2015-04-05 14:00 или 2015-04-01 14:00\.. Все последующие выполнения после первого вычисляются по расписанию (свойство schedule). Они будут выполняться 11.04.2015 в 14:00, 13.04.2015 в 14:00, 15.04.2015 в 14:00 и т. д.

И, наконец, если у задания есть расписание, а часы и минуты в нем не указаны, по умолчанию в качестве значений используются часы и минуты первого случая выполнения данного задания.

## <a name="deep-dive-schedule"></a>Подробный обзор: schedule
С помощью параметра **schedule** можно *ограничить* число выполнений задания. Например, если, согласно параметру schedule, задание с ежемесячной **частотой** должно выполняться только в 31-й день месяца, оно будет выполняться только в те месяцы, в которых есть 31-е число.

Кроме того, с помощью параметра **schedule** можно *увеличить* число выполнений задания. Например, если, согласно параметру schedule, задание с ежемесячной **частотой** должно выполняться в 1 и 2 день месяца, оно будет выполняться первого и второго числа каждого месяца, а не один раз в месяц.

Если для параметра schedule задано несколько элементов, они применяются в порядке от большего к меньшему: номер недели, число месяца, день недели, час и минута.

В следующей таблице элементы параметра schedule описаны подробно.

| Имя JSON | ОПИСАНИЕ | Допустимые значения |
|:--- |:--- |:--- |
| **minutes** |Минуты часа, в которые выполняется задание. |Массив целых чисел. |
| **hours** |Часы дня, в которые выполняется задание. |Массив целых чисел. |
| **weekDays** |Дни недели, в которые выполняется задание. Указываются только при выборе еженедельной частоты. |Массив любого из следующих значений (максимальный размер массива — 7):<br />— monday;<br />— tuesday;<br />— wednesday;<br />— thursday;<br />— friday;<br />— saturday;<br />— sunday.<br /><br />Без учета регистра. |
| **monthlyOccurrences** |Определяет, в какие числа месяца выполняется задание. Указываются только при выборе ежемесячной частоты. |Массив объектов **monthlyOccurrences**:<br /> `{ "day": day, "occurrence": occurrence}`<br /><br /> **day** — это день недели, в который выполняется задание. Например, *{Sunday}* означает каждое воскресенье месяца. Обязательный элемент.<br /><br />**occurrence** — это появление указанного дня в течение месяца. Например, *{Sunday, -1}* означает последнее воскресенье месяца. Необязательный элемент. |
| **monthDays** |День месяца, в который выполняется задание. Указываются только при выборе ежемесячной частоты. |Массив следующих значений:<br />— любое значение <= -1 и >= -31;<br />— любое значение >= 1 и <= 31.|

## <a name="examples-recurrence-schedules"></a>Примеры: расписания повторений
В указанных ниже примерах показаны различные расписания повторений с применением объекта schedule и его подэлементов.

Предполагается, что в этих расписаниях параметр **interval** имеет значение 1\.. Кроме того, в примерах предполагается использование правильных значений параметра **frequency**, соответствующих значениям параметра **schedule**. Например, использовать ежедневную **частоту** и параметр **monthDays** в одном **расписании** нельзя. Эти ограничения описаны ранее в этой статье.

| Пример | ОПИСАНИЕ |
|:--- |:--- |
| `{"hours":[5]}` |Задание выполняется каждый день в 05:00.<br /><br />Планировщик соотносит каждое значение параметра hours с каждым значением параметра minutes и создает список всех моментов, когда выполняется задание. |
| `{"minutes":[15], "hours":[5]}` |Выполняется каждый день в 05:15. |
| `{"minutes":[15], "hours":[5,17]}` |Выполняется каждый день в 05:15 и 16:15. |
| `{"minutes":[15,45], "hours":[5,17]}` |Выполняется каждый день в 05:15, 05:45, 16:15 и 16:45. |
| `{"minutes":[0,15,30,45]}` |Выполнение каждые 15 минут. |
| `{hours":[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]}` |Выполнение каждый час.<br /><br />Это задание выполняется каждый час. Если указано значение параметра **startTime**, оно определяет минуты выполнения задания. Если значение **startTime** не указано, управление минутами осуществляется в соответствии с временем создания. Например, если задание было запущено или создано (в зависимости от того, какой параметр применяется) в 12:25, задание выполняется в 00:25, 01:25, 02:25, ..., 23:25.<br /><br />Это расписание работает так же, как если бы параметр **frequency** имел значение hour, параметр **interval** — значение 1, а параметр **schedule** был не задан. Отличие в том, что вы можете использовать это расписание для создания заданий с другими значениями параметров **frequency** и **interval**. Например, если параметр **frequency** имеет значение month, расписание выполняется раз в месяц, а не каждый день (если параметр **frequency** имеет значение day). |
| `{minutes:[0]}` |Задание выполняется с наступлением каждого часа.<br /><br />Это задание также выполняется каждый час, но ровно в момент его наступления (в 00:00, 01:00, 02:00 и т. д.). Оно эквивалентно заданию, в котором параметр **frequency** имеет значение hour, значение параметра **startTime** указано с нулевыми минутами, а **schedule** не задано (параметр frequency имеет значение day). Однако, если значение **frequency** равно week или month, расписание выполняется только один раз в неделю или один раз в месяц соответственно. |
| `{"minutes":[15]}` |Задание выполняется через 15 минут после наступления каждого часа.<br /><br />Задание выполняется каждый час, начиная с 00:15, 01:15, 02:15 и т. д. и заканчивая 23:15. |
| `{"hours":[17], "weekDays":["saturday"]}` |Задание выполняется в 17:00 каждую субботу. |
| `{hours":[17], "weekDays":["monday", "wednesday", "friday"]}` |Задание выполняется в 17:00 в каждые понедельник, среду и пятницу. |
| `{"minutes":[15,45], "hours":[17], "weekDays":["monday", "wednesday", "friday"]}` |Задание выполняется в 17:15 и 17:45 в каждые понедельник, среду и пятницу. |
| `{"hours":[5,17], "weekDays":["monday", "wednesday", "friday"]}` |Задание выполняется в 05:00 и 17:00 в каждые понедельник, среду и пятницу. |
| `{"minutes":[15,45], "hours":[5,17], "weekDays":["monday", "wednesday", "friday"]}` |Задание выполняется в 05:15, 05:45, 17:15 и 17:45 в каждые понедельник, среду и пятницу. |
| `{"minutes":[0,15,30,45], "weekDays":["monday", "tuesday", "wednesday", "thursday", "friday"]}` |Задание выполняется каждые 15 минут в каждый рабочий день. |
| `{"minutes":[0,15,30,45], "hours": [9, 10, 11, 12, 13, 14, 15, 16] "weekDays":["monday", "tuesday", "wednesday", "thursday", "friday"]}` |Задание выполняется каждые 15 минут в период с 09:00 до 16:45 в каждый рабочий день. |
| `{"weekDays":["sunday"]}` |Задание выполняется по воскресеньям в указанное время начала. |
| `{"weekDays":["tuesday", "thursday"]}` |Задание выполняется по вторникам и четвергам в указанное время начала. |
| `{"minutes":[0], "hours":[6], "monthDays":[28]}` |Задание выполняется в 06:00 28-го числа каждого месяца (при условии, что значение **frequency** — month). |
| `{"minutes":[0], "hours":[6], "monthDays":[-1]}` |Задание выполняется в 6:00 в последний день месяца.<br /><br />Если вы хотите, чтобы задание выполнялось в последний день месяца, используйте -1 вместо значения 28, 29, 30 или 31. |
| `{"minutes":[0], "hours":[6], "monthDays":[1,-1]}` |Задание выполняется в 6:00 в первый и последний день каждого месяца. |
| `{monthDays":[1,-1]}` |Задание выполняется в первый и последний день каждого месяца в указанное время начала. |
| `{monthDays":[1,14]}` |Задание выполняется в первый и 14-й день каждого месяца в указанное время начала. |
| `{monthDays":[2]}` |Задание выполняется во второй день месяца в указанное время начала. |
| `{"minutes":[0], "hours":[5], "monthlyOccurrences":[{"day":"friday", "occurrence":1}]}` |Задание выполняется в первую пятницу каждого месяца в 05:00. |
| `{"monthlyOccurrences":[{"day":"friday", "occurrence":1}]}` |Задание выполняется в первую пятницу каждого месяца в указанное время начала. |
| `{"monthlyOccurrences":[{"day":"friday", "occurrence":-3}]}` |Задание выполняется в третью пятницу с конца каждого месяца в указанное время начала. |
| `{"minutes":[15], "hours":[5], "monthlyOccurrences":[{"day":"friday", "occurrence":1},{"day":"friday", "occurrence":-1}]}` |Задание выполняется в первую и последнюю пятницу каждого месяца в 05:15. |
| `{"monthlyOccurrences":[{"day":"friday", "occurrence":1},{"day":"friday", "occurrence":-1}]}` |Задание выполняется первую и последнюю пятницу каждого месяца в указанное время начала. |
| `{"monthlyOccurrences":[{"day":"friday", "occurrence":5}]}` |Задание выполняется в пятую пятницу каждого месяца в указанное время начала.<br /><br />Оно не выполняется, если пятой пятницы в месяце нет. Если вы хотите, чтобы задание выполнялось в последнюю пятницу месяца, используйте вместо значения 5 значение -1. |
| `{"minutes":[0,15,30,45], "monthlyOccurrences":[{"day":"friday", "occurrence":-1}]}` |Задание выполняется каждые 15 минут в последнюю пятницу месяца. |
| `{"minutes":[15,45], "hours":[5,17], "monthlyOccurrences":[{"day":"wednesday", "occurrence":3}]}` |Задание выполняется в 05:15, 05:45, 17:15, 17:45 в третью среду каждого месяца. |

## <a name="see-also"></a>См. также

- [Что такое планировщик?](scheduler-intro.md)
- [Основные понятия, терминология и иерархия сущностей планировщика Azure](scheduler-concepts-terms.md)
- [Приступая к работе с планировщиком Azure на портале Azure](scheduler-get-started-portal.md)
- [Планы и выставление счетов в планировщике Azure](scheduler-plans-billing.md)
- [Справочник по API REST планировщика Azure](https://msdn.microsoft.com/library/mt629143)
- [Справочник по командлетам PowerShell планировщика Azure](scheduler-powershell-reference.md)
- [Высокая доступность и надежность планировщика](scheduler-high-availability-reliability.md)
- [Ограничения, значения по умолчанию и коды ошибок планировщика Azure](scheduler-limits-defaults-errors.md)
- [Исходящая аутентификация планировщика Azure](scheduler-outbound-authentication.md)

