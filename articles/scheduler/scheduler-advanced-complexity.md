<properties 
 pageTitle="Как создавать сложные расписания и расширенное повторение с помощью планировщика Azure" 
 description="" 
 services="scheduler" 
 documentationCenter=".NET" 
 authors="krisragh" 
 manager="dwrede" 
 editor=""/>
<tags 
 ms.service="scheduler" 
 ms.workload="infrastructure-services" 
 ms.tgt_pltfrm="na" 
 ms.devlang="dotnet" 
 ms.topic="article" 
 ms.date="08/04/2015" 
 ms.author="krisragh"/>

# Как создавать сложные расписания и расширенное повторение с помощью планировщика Azure  

## Обзор

Основополагающую роль в любом задании планировщика Azure играет *расписание*. Именно оно определяет время и способ выполнения каждого задания.

Планировщик Azure позволяет настроить для задания различные одноразовые и повторяющиеся расписания. *Одноразовые* расписания запускаются один раз в указанное время — по сути это *повторяющиеся* расписания, которые выполняются только один раз. Повторяющиеся расписания запускаются с указанной периодичностью.

Благодаря этой гибкости планировщик Azure позволяет поддерживать самые разнообразные бизнес-сценарии.

-	Периодическая очистка данных, например ежедневное удаление всех твитов старше 3 месяцев.
-	Архивация, например ежемесячное создание резервной копии всей истории счетов.
-	Запросы внешних данных, например получение нового прогноза погоды для лыжников от NOAA каждые 15 минут.
-	Обработка образов, например сжатие всех загруженных за день образов с помощью системы облачных вычислений каждый день в период пиковой нагрузки.


В данной статье будут рассмотрены примеры заданий, которые можно создавать с помощью планировщика Azure. Для каждого расписания приводятся соответствующие данные JSON. Если вы используете [API REST планировщика](https://msdn.microsoft.com/library/azure/dn528946.aspx), применяйте эти данные JSON для [создания заданий в планировщике Azure](https://msdn.microsoft.com/library/azure/dn528937.aspx).

## Поддерживаемые сценарии

Многие примеры в этом разделе иллюстрируют спектр сценариев, поддерживаемых планировщиком Azure. Грубо говоря, в следующих примерах показаны способы создания расписаний для самых разных моделей поведения, включая следующие.

-	Однократное выполнение в определенный день и в конкретное время.
-	Выполнение и повтор указанное количество раз.
-	Незамедлительное выполнение и повтор. 
-	Выполнение и повтор через каждые *n* минут, часов, дней, недель или месяцев, начиная с указанного времени.
-	Выполнение и повтор на еженедельной или ежемесячной основе, но только в указанные даты, дни недели или числа месяца.
-	Выполнение и повтор несколько раз за период, например в последнюю пятницу и понедельник каждого месяца или в 05:15 и 17:15 каждого дня.

## Значения даты и даты и времени

Даты в заданиях планировщика Azure соответствуют [спецификации ISO-8601](http://en.wikipedia.org/wiki/ISO_8601) и содержат только дату.

Ссылки на даты и время в планировщике заданий Azure соответствуют [спецификации ISO-8601](http://en.wikipedia.org/wiki/ISO_8601) и включают как дату, так и время. Предполагается, что даты и время без обозначения часового пояса указаны по UTC.

## Практическое руководство: создание расписаний с помощью JSON и API REST

Чтобы создать простое расписание, используя примеры JSON, приведенные в этой статье, и API REST планировщика Azure, [сначала создайте облачную службу](https://msdn.microsoft.com/library/azure/dn528943.aspx), [затем коллекцию заданий](https://msdn.microsoft.com/library/azure/dn528940.aspx), и, [наконец, задание](https://msdn.microsoft.com/library/azure/dn528937.aspx). Создавая задание, можно задать расписание и периодичность его выполнения, используя данные JSON как в представленном ниже фрагменте кода:

	{
	    "startTime": "2012-08-04T00:00Z", // optional
	     …
	    "recurrence":                     // optional
	    {
	        "frequency": "week",     // can be "year" "month" "day" "week" "hour" "minute"
	        "interval": 1,                // optional, how often to fire (default to 1)
	        "schedule":                   // optional (advanced scheduling specifics)
	        {
	            "weekDays": ["monday", "wednesday", "friday"],
	            "hours": [10, 22]                      
	        },
	        "count": 10,                  // optional (default to recur infinitely)
	        "endTime": "2012-11-04",      // optional (default to recur infinitely)
	    },
	    …
	}
	
## Общие сведения: основные параметры схемы заданий

В приведенной ниже таблице представлен общий обзор основных элементов, связанных с периодичностью выполнения и расписанием задания.

|**Имя JSON**|**Описание**|
|:--|:--|
|**_startTime_**|_startTime_ — это дата и время. В простых расписаниях _startTime_ определяет первый случай выполнения задания, а в сложных задание начинает выполняться не раньше, чем наступит время _startTime_.|
|**_recurrence_**|Объект _recurrence_ определяет правила и периодичность повтора задания. Объект recurrence поддерживает следующие элементы: _frequency, interval, endTime, count_ и _schedule_. Если задан объект _recurrence_, требуется также элемент _frequency_; остальные элементы объекта _recurrence_ не являются обязательными.|
|**_frequency_**|Строка _frequency_ определяет частоту повторного выполнения задания. Частота может быть указана в _минутах, часах, днях, неделях_ или _месяцах_.|
|**_interval_**|Элемент _interval_ выражается целым положительным числом и обозначает интервал частоты (_frequency_) выполнения соответствующего задания. Например если _interval_ равен 3, а в качестве значения элемента _frequency_ выбрана неделя, задание выполняется повторно через каждые 3 недели. Максимальное значение элемента _interval_ в планировщике Azure составляет 18 месяцев для ежемесячной частоты, 78 недель для еженедельной частоты и 548 дней для ежедневной частоты. Для часов и минут поддерживается следующий диапазон: 1 <= _interval_ <= 1000.|
|**_endTime_**|Строка _endTime_ определяет дату и время, после наступления которых задание выполняться не должно. Значение строки _endTime_ не может быть в прошлом. Если параметр _endTime_ или count не указан, задание выполняется бесконечно. Одно и то же задание не может иметь одновременно параметры _endTime_ и _count_.|
|**_count_**|<p>Параметр _count_ выражается целым положительным числом (больше нуля) и показывает, сколько раз задание должно быть выполнено прежде, чем будет завершено.</p><p>Параметр _count_ определяет, после какого числа повторных выполнений задание будет считаться завершенным. Например, если задание с параметром _count_, значение которого равно 5, начинает выполняться в понедельник, оно будет завершено после выполнения в пятницу. Если начальная дата задания находится в прошлом, за время первого выполнения принимается время создания.</p><p>Если параметр _endTime_ или _count_ не указан, задание будет выполняться бесконечно. Одно и то же задание не может иметь одновременно параметры _endTime_ и _count_.</p>|
|**_schedule_**|Задание с указанной частотой выполняется по расписанию. Оно определяется объектом _schedule_, который содержит изменения с учетом минут, часов, дней недели, чисел месяца и количества недель.|

## Общие сведения: параметры схемы заданий по умолчанию, ограничения и примеры

Ознакомившись с общими сведениями, рассмотрим эти элементы более подробно.

|**Имя JSON**|**Тип значения**|**Обязательный?**|**Значение по умолчанию**|**Допустимые значения**|**Пример**|
|:---|:---|:---|:---|:---|:---|
|**_startTime_**|Строка|Нет|None|Дата и время по спецификации ISO-8601|<code>"startTime" : "2013-01-09T09:30:00-08:00"</code>|
|**_recurrence_**|Объект|Нет|None|Объект recurrence|<code>"recurrence" : { "frequency" : "monthly", "interval" : 1 }</code>|
|**_frequency_**|Строка|Да|None|"minute" (минута), "hour" (час), "day" (день), "week" (неделя), "month" (месяц)|<code>"frequency" : "hour"</code> |
|**_interval_**|Число|Нет|1|От 1 до 1000|<code>"interval" : 10</code>|
|**_endTime_**|Строка|Нет|None|Значение даты-времени, представляющее время в будущем|<code>"endTime" : "2013-02-09T09:30:00-08:00"</code> |
|**_count_**|Число|Нет|None|>=1|<code>"count" : 5</code>|
|**_schedule_**|Объект|Нет|None|Объект schedule|<code>"schedule" : { "minute" : [30], "hour" : [8,17] }</code>|

## Подробно: _startTime_

В приведенной ниже таблице показано, каким образом параметр _startTime_ управляет выполнением задания.

|**Значение startTime**|**Количество повторов**|**Повторение без расписания**|**Повторение с расписанием**|
|:--|:--|:--|:--|
|**Время начала не указано**|Задание выполняется один раз сразу после запуска|Задание выполняется один раз сразу после запуска. Последующие выполнения производятся, исходя из времени предыдущего выполнения.|<p>Задание выполняется один раз сразу после запуска.</p><p>Последующие выполнения производятся по расписанию повторов.</p>|
|**Время начала в прошлом**|Задание выполняется один раз сразу после запуска|<p>Время выполнения задания рассчитывается как время первого выполнения после времени начала.</p><p>Последующие выполнения производятся с учетом времени предыдущего выполнения.</p><p>См. пример под этой таблицей</p>|<p>Выполнение задания начинается _не раньше_ указанного времени начала. Первое выполнение производится по расписанию с учетом времени начала.</p><p>Последующие выполнения производятся по расписанию повторов.</p>|
|**Время начала в будущем или в настоящем**|Задание выполняется один раз в указанное время начала|<p>Задание выполняется один раз в указанное время начала</p><p>Последующие выполнения производятся с учетом времени предыдущего выполнения.</p>|<p>Выполнение задания начинается _не раньше_ указанного времени начала. Первое выполнение производится по расписанию с учетом времени начала.</p><p>Последующие выполнения производятся по расписанию повторов.</p>|

Рассмотрим пример того, что происходит, когда время _startTime_ находится в прошлом и параметр _recurrence_ установлен, а _schedule_ — нет. Допустим, текущее время — 2015-04-08 13:00, _startTime_ — 2015-04-07 14:00, а повтор (_recurrence_) выполняется раз в 2 дня (т. е. параметр _frequency_ имеет значение day, а _interval_ равен 2). Обратите внимание, что время _startTime_ находится в прошлом и наступает раньше текущего времени.

В этих условиях _первое выполнение_ задания произойдет 2015-04-09 в 14:00. От времени начала ядро планировщика отсчитывает время повторных выполнений. Выполнения, которые приходятся на прошлое, игнорируются. Ядро берет очередной случай выполнения, который приходится на будущее. В данном случае _startTime_ — это 2015-04-07 14:00, поэтому в следующий раз задание будет выполнено через 2 дня, 2015-04-09 в 14:00.

Обратите внимание, что время первого выполнения будет одинаковым независимо от того, имеет ли параметр startTime значение 2015-04-05 14:00 или 2015-04-01 14:00. Время последующих выполнений рассчитывается по расписанию — 2015-04-11 в 14:00, 2015-04-13 в 14:00, 2015-04-15 в 14:00 и т. д.

И, наконец, если у задания есть расписание, а часы и (или) минуты в нем не указаны, по умолчанию используются часы и минуты первого случая выполнения данного задания.

## Подробный обзор: _schedule_

С одной стороны, параметр _schedule_ может _ограничивать_ число выполнений задания. Например, если, согласно параметру _schedule_, задание с ежемесячной частотой должно выполняться в 31-й день месяца, оно будет выполняться только в те месяцы, в которых есть 31-е число.<sup></sup>

С другой стороны: параметр _schedule_ может _увеличивать_ число выполнений задания. Например, если, согласно параметру _schedule_, задание с ежемесячной частотой должно выполняться в 1-й и 2-й день месяца, оно будет выполняться 1-го и 2-го числа каждого месяца, а не один раз в месяц.<sup></sup><sup></sup>

Если для параметра schedule задано несколько элементов, они применяются в порядке от большего к меньшему: номер недели, число месяца, день недели, час и минута.

В следующей таблице элементы параметра _schedule_ описаны подробно.

|**Имя JSON**|**Описание**|**Допустимые значения**|
|:---|:---|:---|
|**minutes**|Минуты часа, в которые будет выполняться задание.|<ul><li>Целое число или</li><li>массив целых чисел</li></ul>|
|**hours**|Часы дня, в которые будет выполняться задание.|<ul><li>Целое число или</li><li>массив целых чисел</li></ul>|
|**weekDays**|Дни недели, в которые будет выполняться задание. Указываются только при выборе еженедельной частоты.|<ul><li>Monday (понедельник), Tuesday (вторник), Wednesday (среда), Thursday (четверг), Friday (пятница), Saturday (суббота) или Sunday (воскресенье)</li><li>Массив любых из указанных выше значений (максимальный размер массива: 7)</li></ul>Регистр значения \_не\_ имеет|
|**monthlyOccurrences**|Определяет, в какие числа месяца будет выполняться задание. Указываются только при выборе ежемесячной частоты.|<ul><li>Массив объектов monthlyOccurence:</li></ul> <pre>{ "day": _day_,<br /> "occurrence": _occurence_<br />}</pre><p> _day_ — это день недели, в который будет выполняться задание, например, {Sunday} означает каждое воскресенье месяца. Обязательный элемент.</p><p>_occurence_ — это появление указанного дня в течение месяца, например, {Sunday, -1} означает последнее воскресенье месяца. Необязательный элемент.</p>|
|**monthDays**|День месяца, в который будет выполняться задание. Указываются только при выборе ежемесячной частоты.|<ul><li>Любое значение <= -1 и >= -31.</li><li>Любое значение >= 1 и <= 31.</li><li>Массив указанных выше значений.</li></ul>|

## Примеры: расписания повторений

Ниже приведены различные примеры расписания повторений с применением объекта schedule и его элементов.

Предполагается, что во всех представленных расписаниях параметр _interval_ имеет значение 1. Кроме того, в каждом случае следует предполагать частоту, соответствующую параметру _schedule_, например использовать ежедневную частоту и параметр monthDays в одном расписании нельзя. Эти ограничения описаны выше.

|**Пример**|**Описание**|
|:---|:---|
|<code>{"hours":[5]}</code>|Задание выполняется каждый день в 05:00. Планировщик Azure соотносит каждое значение параметра hours с каждым значением параметра minutes и создает список всех моментов, в которые нужно будет выполнить задание.|
|<code>{"minutes":[15],"hours":[5]}</code>|Задание выполняется каждый день в 05:15.|
|<code>{"minutes":[15],"hours":[5,17]}</code>|Задание выполняется каждый день в 05:15 и 17:15.|
|<code>{"minutes":[15,45],"hours":[5,17]}</code>|Задание выполняется каждый день в 05:15, 05:45, 17:15 и 17:45.|
|<code>{"minutes":[0,15,30,45]}</code>|Задание выполняется каждые 15 минут.|
|<code>{hours":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]}</code>|Задание выполняется каждый час. Это задание выполняется каждый час. Если указан параметр _startTime_, минуты выполнения задания определяет он, а если нет — время создания. Например, если задание было запущено или создано (в зависимости от того, какой параметр применяется) в 12:25, задание будет выполняться в 00:25, 01:25, 02:25, ...., 23:25. Это расписание работает так же, как если бы параметр _frequency_ имел значение hour, параметр _interval_ — значение 1, а параметр _schedule_ был не задан. Отличие в том, что данное расписание можно также использовать для создания заданий с другими значениями параметров _frequency_ и _interval_. Например, если бы параметр _frequency_ имел значение month, расписание выполнялось бы раз в месяц, а не каждый день, как в данном случае, когда параметр _frequency_ имеет значение day.|
|<code>{minutes:[0]}</code>|Задание выполняется с наступлением каждого часа. Это задание также выполняется каждый час, но ровно в момент его наступления (например, в 00:00, 01:00, 02:00 и т. д.). Оно эквивалентно заданию, в котором параметр frequency имеет значение hour, параметр startTime указан с нулевыми минутами, а расписание не задано (параметр frequency имеет значение day); если же параметр frequency имеет значение week или month, расписание будет выполняться только один раз в неделю или один раз в месяц соответственно.|
|<code>{"minutes":[15]}</code>|Задание выполняется через 15 минут после наступления каждого часа. Задание выполняется каждый час, начиная с 00:15, 01:15, 02:15 и т. д. и заканчивая 22:15 и 23:15.|
|<code>{"hours":[17],"weekDays":["saturday"]}</code>|Задание выполняется в 17:00 каждую субботу.|
|<code>{hours":[17],"weekDays":["monday","wednesday","friday"]}</code>|Задание выполняется в 17:00 в каждый понедельник, среду и пятницу.|
|<code>{"minutes":[15,45],"hours":[17],"weekDays":["monday","wednesday","friday"]}</code>|Задание выполняется в 17:15 и 17:45 в каждый понедельник, среду и пятницу.|
|<code>{"hours":[5,17],"weekDays":["monday","wednesday","friday"]}</code>|Задание выполняется в 05:00 и 17:00 в каждый понедельник, среду и пятницу.|
|<code>{"minutes":[15,45],"hours":[5,17],"weekDays":["monday","wednesday","friday"]}</code>|Задание выполняется в 05:15, 05:45, 17:15 и 17:45 в каждый понедельник, среду и пятницу.|
|<code>{"minutes":[0,15,30,45], "weekDays":["monday","tuesday","wednesday","thursday","friday"]}</code>|Задание выполняется каждые 15 минут в каждый рабочий день.|
|<code>{"minutes":[0,15,30,45], "hours": [9, 10, 11, 12, 13, 14, 15, 16] "weekDays":["monday","tuesday","wednesday","thursday","friday"]}</code>|Задание выполняется каждые 15 минут в период с 09:00 до 16:45 в каждый рабочий день.|
|<code>{"weekDays":["sunday"]}</code>|Задание выполняется по воскресеньям в указанное время начала.|
|<code>{"weekDays":["tuesday", "thursday"]}</code>|Задание выполняется по вторникам и четвергам в указанное время начала.|
|<code>{"minutes":[0],"hours":[6],"monthDays":[28]}</code>|Задание выполняется в 06:00 28-го числа каждого месяца (при ежемесячной частоте).|
|<code>{"minutes":[0],"hours":[6],"monthDays":[-1]}</code>|Задание выполняется в 06:00 в последний день каждого месяца. Если вы хотите, чтобы задание выполнялось в последний день месяца, используйте -1 вместо значения 28, 29, 30 или 31.|
|<code>{"minutes":[0],"hours":[6],"monthDays":[1,-1]}</code>|Задание выполняется в 06:00 в первый и последний день каждого месяца.|
|<code>{monthDays":[1,-1]}</code>|Задание выполняется в первый и последний день каждого месяца в указанное время начала.|
|<code>{monthDays":[1,14]}</code>|Задание выполняется в первый и 14-й день каждого месяца в указанное время начала.|
|<code>{monthDays":[2]}</code>|Задание выполняется во второй день месяца в указанное время начала.|
|<code>{"minutes":[0], "hours":[5], "monthlyOccurrences":[{"day":"friday","occurrence":1}]}</code>|Задание выполняется в первую пятницу каждого месяца в 05:00.|
|<code>{"monthlyOccurrences":[{"day":"friday","occurrence":1}]}</code>|Задание выполняется в первую пятницу каждого месяца в указанное время начала.|
|<code>{"monthlyOccurrences":[{"day":"friday","occurrence":-3}]}</code>|Задание выполняется в третью пятницу с конца месяца, каждый месяц в указанное время начала.|
|<code>{"minutes":[15],"hours":[5],"monthlyOccurrences":[{"day":"friday","occurrence":1},{"day":"friday","occurrence":-1}]}</code>|Задание выполняется первую и последнюю пятницу каждого месяца в 05:15.|
|<code>{"monthlyOccurrences":[{"day":"friday","occurrence":1},{"day":"friday","occurrence":-1}]}</code>|Задание выполняется первую и последнюю пятницу каждого месяца в указанное время начала.|
|<code>{"monthlyOccurrences":[{"day":"friday","occurrence":5}]}</code>|Задание выполняется в пятую пятницу каждый месяц в указанное время начала. Если пятой пятницы в месяце нет, задание не выполняется, поскольку по расписанию оно должно выполняться только по пятым пятницам. Если вы хотите, чтобы задание выполнялось в последнюю пятницу месяца, используйте вместо значения 5 значение -1.|
|<code>{"minutes":[0,15,30,45],"monthlyOccurrences":[{"day":"friday","occurrence":-1}]}</code>|Задание выполняется каждые 15 минут в последнюю пятницу месяца.|
|<code>{"minutes":[15,45],"hours":[5,17],"monthlyOccurrences":[{"day":"wednesday","occurrence":3}]}</code>|Задание выполняется в 05:15, 05:45, 17:15 и 17:45 третьей среды каждого месяца.|

## См. также
 
 [Что такое планировщик?](scheduler-intro.md)
 
 [Основные понятия, терминология и иерархия сущностей планировщика](scheduler-concepts-terms.md)
 
 [Приступая к работе с планировщиком на портале управления](scheduler-get-started-portal.md)
 
 [Планы и выставление счетов в планировщике Azure](scheduler-plans-billing.md)
 
 [Справочник по REST API планировщика](https://msdn.microsoft.com/library/dn528946)
 
 [Справочник по командлетам PowerShell планировщика](scheduler-powershell-reference.md)
 
 [Высокая доступность и надежность планировщика](scheduler-high-availability-reliability.md)
 
 [Ограничения, значения по умолчанию и коды ошибок планировщика](scheduler-limits-defaults-errors.md)
 
 [Исходящая аутентификация планировщика](scheduler-outbound-authentication.md)
 
  

<!---HONumber=August15_HO6-->