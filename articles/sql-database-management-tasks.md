<properties umbracoNaviHide="0" pageTitle="Управление базой данных SQL" metaKeywords="база данных SQL Azure, база данных SQL, управление базой данных sql, добавление имен входа, подключение к базе данных sql" description="Узнайте, как управлять базой данных SQL Azure." linkid="devnav-manage-services-cloud-services" urlDisplayName="Облачные службы" headerExpose="" footerExpose="" disqusComments="1" title="Как управлять базой данных SQL" authors="" />


<h1><a id="swap"></a>Как управлять базой данных SQL</h1>

В этом разделе показано, как выполнять простые задачи управления базой данных SQL Azure. 

##Оглавление##

* [Практическое руководство. Подключение к базе данных SQL в Azure с помощью среды Management Studio](#connect)
* [Практическое руководство. Добавление имен входа и пользователей в базу данных SQL в Azure](#addlogins)


<h2><a id="connect"></a>Практическое руководство. Подключение к базе данных SQL в Azure с помощью среды Management Studio</h2>

Среда Management Studio является средством администрирования, которое позволяет управлять несколькими экземплярами SQL Server и серверами в одной рабочей области. Если у вас уже есть локальный экземпляр SQL Server, можно открыть подключение к локальному экземпляру и логическому серверу в Azure для параллельного выполнения задач.

Среда Management Studio включает в себя функции, которые в настоящее время недоступны на портале управления, например проверку синтаксиса и возможность сохранять скрипты и именованные запросы для повторного использования. База данных SQL является просто конечной точкой потока табличных данных (TDS). Для операций с базой данных SQL подходят любые средства, которые работают с TDS, включая среду Management Studio. Скрипты, разрабатываемые для локального сервера, запускаются на логическом сервере базы данных SQL. 

В следующем шаге вы будете использовать среду Management Studio для подключения к логическому серверу в Azure. Для выполнения этого шага требуется SQL Server Management Studio версии 2008 R2 или 2012. Если вам необходима помощь с загрузкой или подключением к среде Management Studio, см. раздел [Управление базой данных SQL с помощью SQL Server Management Studio][] на этом сайте.

Перед подключением иногда бывает необходимо создать исключение брандмауэра, которое разрешает исходящие запросы через порт 1433 на локальном компьютере. У компьютеров с конфигурацией защиты по умолчанию порт 1433 обычно закрыт. 

##Настройка брандмауэра для локального сервера

1. Создайте в брандмауэре Windows в режиме повышенной безопасности новое правило для исходящего трафика.

2. Выберите **Порт**, укажите "TCP 1433", укажите **Разрешить подключение** и убедитесь, что выбран профиль **Открытый**.

3. Укажите понятное имя, например *WindowsAzureSQLDatabase (tcp-out) port 1433*. 


##Подключение к логическому серверу

1. Убедитесь, что в области "Подключение к серверу" среды Management Studio выбран "Компонент Database Engine", а затем введите имя логического сервера в следующем формате: *имя_сервера*.database.widnows.net.

	Также можно получить полное имя сервера на портале управления, в панели мониторинга сервера, в области "УПРАВЛЕНИЕ URL-АДРЕСАМИ".

2. В поле "Проверка подлинности" выберите **Проверка подлинности SQL Server**, а затем введите имя входа администратора, созданное при настройке логического сервера.

3. Щелкните элемент **Параметры**. 

4. В поле "Подключение к базе данных" укажите **master**.


##Подключение к локальному серверу

1. Убедитесь, что в области "Подключение к серверу" среды Management Studio выбран "Компонент Database Engine", а затем введите имя локального экземпляра в следующем формате: *имя_сервера*\\*имя_экземпляра*. Если сервер является локальным экземпляром по умолчанию, введите *localhost*.

2. В поле "Проверка подлинности" выберите **Проверка подлинности Windows**, а затем введите учетную запись Windows, которая является членом роли sysadmin.


<h2><a id="addlogins"></a>Практическое руководство. Добавление имен входа и пользователей в базу данных SQL в Azure</h2>

После развертывания базы данных необходимо настроить имена входа и назначить разрешения. На следующем шаге выполняются два скрипта.

Для первого скрипта можно подключиться к базе данных "master" и выполнить сценарий, создающий имена входа. Имена входа будут использоваться для поддержки операций чтения и записи и для OLE_LINK5OLE_LINK6 делегирования операционных задач, таких как возможность выполнения запросов системы без разрешений OLE_LINK5OLE_LINK6"sa".

Создаваемые имена входа должны быть именами входа для проверки подлинности SQL Server. Если имеются уже готовые скрипты, использующие удостоверения пользователей Windows или удостоверения утверждений, этот скрипт не будет работать для базы данных SQL.

Второй скрипт присваивает разрешения пользователей базы данных. Для этого скрипта вы будете подключаться к базе данных, уже загруженной в Azure.

##Создание имен входа

1. В среде Management Studio подключитесь к логическому серверу в Azure, разверните папку "Базы данных", щелкните правой кнопкой мыши элемент **master** и выберите **Создать запрос**.

2. Используйте следующие инструкции Transact-SQL для создания имен входа. Замените пароль на действительный пароль. Выберите каждый из элементов по отдельности, а затем щелкните **Выполнить**. Повторите для остальных имен входа.

<div style="width:auto; height:auto; overflow:auto"><pre>
    -- run on master, execute each line separately
    -- use this login to manage other logins on this server
    CREATE LOGIN sqladmin WITH password='&lt;ProvidePassword&gt;'; 
    CREATE USER sqladmin FROM LOGIN sqladmin;
    EXEC sp_addrolemember 'loginmanager', 'sqladmin';

    -- use this login to create or copy a database
    CREATE LOGIN sqlops WITH password='&lt;ProvidePassword&gt;';
    CREATE USER sqlops FROM LOGIN sqlops;
    EXEC sp_addrolemember 'dbmanager', 'sqlops';
</pre></div>


##Создание пользователей базы данных

1. Разверните папку "Базы данных", щелкните правой кнопкой мыши элемент **school** и выберите **Создать запрос**.

2. Используйте следующие инструкции Transact-SQL для добавления пользователей базы данных. Замените пароль на действительный пароль. 

<div style="width:auto; height:auto; overflow:auto"><pre>
    -- run on a regular database, execute each line separately
    -- use this login for read operations
    CREATE LOGIN sqlreader WITH password='&lt;ProvidePassword&gt;';
    CREATE USER sqlreader FROM LOGIN sqlreader;
    EXEC sp_addrolemember 'db_datareader', 'sqlreader';

    -- use this login for write operations
    CREATE LOGIN sqlwriter WITH password='&lt;ProvidePassword&gt;';
    CREATE USER sqlwriter FROM LOGIN sqlwriter;
    EXEC sp_addrolemember 'db_datawriter', 'sqlwriter';

    -- grant DMV permissions on the school database to 'sqlops'
    GRANT VIEW DATABASE STATE to 'sqlops';
</pre></div>

##Представления и тестовые имена входа

1. В окне нового запроса подключитесь к базе данных **master** и выполните следующую инструкцию: 

        SELECT * from sys.sql_logins;

2. В Management Studio щелкните базу данных **school** правой кнопкой мыши и выберите пункт **Создать запрос**.

3. В меню "Запрос" выберите пункт **Подключение** и щелкните элемент **Изменить подключение**.

4. Выполните вход с именем *sqlreader*.

5. Скопируйте и попробуйте запустить следующую инструкцию. Вы должны получить сообщение о том, что объект не существует.

        INSERT INTO dbo.StudentGrade (CourseID, StudentID, Grade)
        VALUES (1061, 30, 9);

6. Откройте второе окно запроса и измените контекст подключения на *sqlwriter*. Теперь этот запрос должен выполняться успешно.

Вы создали и протестировали нескольких имен входа. Дополнительные сведения см. в разделах [Управление базами данных и учетными записями в базе данных SQL][] и [Мониторинг базы данных SQL с помощью динамических административных представлений][].

[Управление базами данных и учетными записями в базе данных SQL]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee336235.aspx
[Мониторинг базы данных SQL с помощью динамических административных представлений]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ff394114.aspx
[Управление базой данных SQL с помощью SQL Server Management Studio]: http://www.windowsazure.com/ru-ru/develop/net/common-tasks/sql-azure-management/






