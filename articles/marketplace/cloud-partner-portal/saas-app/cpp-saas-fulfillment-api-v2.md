---
title: Выполнение API SaaS V2 — Azure Marketplace | Документация Майкрософт
description: Объясняется, как создать предложение SaaS в Azure Marketplace с помощью связанных исполнение V2 API-интерфейсы.
services: Azure, Marketplace, Cloud Partner Portal,
documentationcenter: ''
author: v-miclar
manager: Patrick.Butler
editor: ''
ms.assetid: ''
ms.service: marketplace
ms.workload: ''
ms.tgt_pltfrm: ''
ms.devlang: ''
ms.topic: conceptual
ms.date: 02/27/2019
ms.author: pbutlerm
ms.openlocfilehash: 6d18adfaec965d858bdcb1f74ebcea89f57eea39
ms.sourcegitcommit: a60a55278f645f5d6cda95bcf9895441ade04629
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2019
ms.locfileid: "58878032"
---
# <a name="saas-fulfillment-api"></a>Выполнение SaaS API

В этой статье подробно API, который включает независимые поставщики программного обеспечения (ISV) интегрировать свои приложения SaaS с Azure Marketplace. Этот API позволяет приложениям независимых поставщиков программного обеспечения для участия в всех коммерческих включена каналов: direct, осуществляемое партнерами (торгового посредника) и поле под руководством.  Этот API является обязательным для списка могут быть частью транзакции SaaS предложения в Azure Marketplace.


## <a name="managing-the-saas-subscription-lifecycle"></a>Управление жизненным циклом подписки SaaS

Служба Microsoft SaaS управляет полным жизненным циклом покупки подписки SaaS и использует API выполнения, как механизм для диска фактическое выполнение изменения планов и удаление подписки с независимых поставщиков программного обеспечения. Сумма счета будет рассчитана на основе состояния подписки SaaS, корпорация Майкрософт поддерживает. На следующей схеме показано состояний и операций, которые управляют изменения между состояниями.

![Состояния жизненного цикла подписки SaaS](./media/saas-subscription-lifecycle-api-v2.png)


### <a name="states-of-a-saas-subscription"></a>Состояния подписки SaaS

Ниже перечислены состояния инициализации для подписки SaaS, включая описание и последовательности схема для каждого (если применимо). 

#### <a name="provisioning"></a>Подготовка

Когда покупатель начинает покупки, независимый поставщик получает эти сведения в AuthCode клиента интерактивных веб-страницы с помощью параметра URL-адрес. AuthCode можно проверить и заменены на то, что необходимо подготовить данные.  По завершении подготовки службы SaaS, он отправляет вызов активировать для обозначения завершения его выполнения и может быть выставлен счет клиента.  Следующая диаграмма показывает последовательность вызовов API для подготовки сценария.  

![Для подготовки службы SaaS вызовов API.](./media/saas-post-provisioning-api-v2-calls.png)

#### <a name="provisioned"></a>Подготовлено

Это состояние в рабочем режиме подготовленной службы.

#### <a name="provisioning-for-update"></a>Подготовка для обновления
(из marketplace) 

Это состояние представляет обновление к существующей службы находится в состоянии ожидания. Такое обновление может быть инициировано клиента в marketplace, или в службе SaaS (только для direct для операций клиента). В примере ниже показан действия при инициации обновления из marketplace.

![Вызовы API, когда обновление инициируется из marketplace.](./media/saas-update-api-v2-calls-from-marketplace-a.png)

#### <a name="provisioning-for-update"></a>Подготовка для обновления  
(из службы SaaS) 

В примере ниже показан действия при инициации обновления службой SaaS. (Вызов веб-перехватчика заменяется на обновление подписки, инициированных одной службой SaaS. 

![При инициации обновления службой SaaS вызовов API.](./media/saas-update-api-v2-calls-from-saas-service-a.png) 

#### <a name="suspended"></a>Приостановлено

Это состояние указывает, что платеж пользователя не были получены. С помощью политики мы предоставим клиента льготный период перед unfulfilling подписки. Если подписка находится в этом состоянии: 

- Как ISV вы можете привести к снижению или запретить доступ пользователя к службе. 
- Подписка должна оставаться в состоянии, допускающем восстановление, можно восстановить полную функциональность без потери данных или параметров. 
- Вы сможете получить запрос восстановить для этой подписки с помощью реализации API или отмены подготовки запрос, в конце этого периода. 

#### <a name="unsubscribed"></a>Подписка отменена 

Подписки попадает в эту ситуацию, в ответ на запрос явные клиента или в ответ на неуплаты сборам. От независимых поставщиков программного обеспечения ожидается, что данные клиента сохраняется для восстановления по запросу в течение минимум X дней и затем удаляется. 

## <a name="api-reference"></a>Справочник по API

В данном разделе описываются SaaS *подписки API* и *операций API*.


### <a name="subscription-api"></a>API подписки

Данная подписка API поддерживает следующие операции HTTPS: **Получить**, **Post**, **Patch**, и **удалить**.

#### <a name="list-subscriptions"></a>Список подписок

Список всех подписок SaaS для издателя.

**Получить:<br>`https://marketplaceapi.microsoft.com/api/saas/subscriptions?api-version=<ApiVersion>`**

*Параметры запроса:*

|             |                   |
|  --------   |  ---------------  |
| ApiVersion  |  Версия операции, используемой для этого запроса.  |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
| Content-Type       |  `application/json`  |
| x-ms-requestid     |  Уникальное строковое значение для отслеживания запроса от клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
| x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.  |
| authorization      |  Токен носителя JSON Web Token (JWT).  |

*Коды ответов:*

Код: 200<br>
На основании маркера get auth издателя и соответствующих подписок для предложений издателя.<br> Полезные данные ответа:<br>

```json
{
  "subscriptions": [
      {
          "id": "",
          "name": "CloudEndure for Production use",
          "publisherId": "cloudendure",
          "offerId": "ce-dr-tier2",
          "planId": "silver",
          "quantity": "10",
          "beneficiary": { // Tenant for which SaaS subscription is purchased.
              "tenantId": "cc906b16-1991-4b6d-a5a4-34c66a5202d7"
          },
          "purchaser": { // Tenant that purchased the SaaS subscription. These could be different for reseller scenario
              "tenantId": "0396833b-87bf-4f31-b81c-c67f88973512"
          },
          "allowedCustomerOperations": [
              "Read" // Possible Values: Read, Update, Delete.
          ], // Indicates operations allowed on the SaaS subscription. For CSP initiated purchases, this will always be Read.
          "sessionMode": "None", // Possible Values: None, DryRun (Dry Run indicates all transactions run as Test-Mode in the commerce stack)
          "status": "Subscribed" // Indicates the status of the operation. [Provisioning, Subscribed, Suspended, Unsubscribed]
      }
  ],
  "continuationToken": ""
}
```

Код: 403 <br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, который не принадлежит текущему пользователю. 

Код: 500 — Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}
```

#### <a name="get-subscription"></a>Получение подписки

Возвращает указанную подписку SaaS. Используйте этот вызов для получения сведений о лицензиях и сведения о плане.

**Получить:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
| subscriptionId     |   Уникальный идентификатор подписки SaaS, полученный после устранения токен через разрешения API   |
|  ApiVersion        |   Версию операции, используемой для данного запроса   |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  Content-Type      |  `application/json`  |
|  x-ms-requestid    |  Уникальное строковое значение для отслеживания запроса от клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
|  x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.  |
|  authorization     |  Токен носителя token (JWT) JSON web  |

*Коды ответов:*

Код: 200<br>
Получает из идентификатора подписки saas<br> Полезные данные ответа:<br>

```json
Response Body:
{ 
        "id":"",
        "name":"CloudEndure for Production use",
        "publisherId": "cloudendure",
        "offerId": "ce-dr-tier2",
        "planId": "silver",
        "quantity": "10"",
          "beneficiary": { // Tenant for which SaaS subscription is purchased.
              "tenantId": "cc906b16-1991-4b6d-a5a4-34c66a5202d7"
          },
          "purchaser": { // Tenant that purchased the SaaS subscription. These could be different for reseller scenario
              "tenantId": "0396833b-87bf-4f31-b81c-c67f88973512"
          },
        "allowedCustomerOperations": ["Read"], // Indicates operations allowed on the SaaS subscription. For CSP initiated purchases, this will always be Read.
        "sessionMode": "None", // Dry Run indicates all transactions run as Test-Mode in the commerce stack
        "status": "Subscribed", // Indicates the status of the operation.
}
```

Код: 404<br>
Не найдено<br> 

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, который не принадлежит текущему пользователю.

Код: 500<br>
Внутренняя ошибка сервера<br>

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }  
```

#### <a name="list-available-plans"></a>Список доступных планов

Используйте этот вызов, чтобы узнать, есть ли предложениями закрытого и открытого для текущего пользователя.

**Получить:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>/listAvailablePlans?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |   Версию операции, используемой для данного запроса  |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|   Content-Type     |  `application/json` |
|   x-ms-requestid   |   Уникальное строковое значение для отслеживания запроса от клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
|  x-ms-correlationid  | Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
|  authorization     |  Токен носителя token (JWT) JSON web |

*Коды ответов:*

Код: 200<br>
Получение списка доступных планов для клиента.<br>

```json
Response Body:
[{
    "planId": "silver",
    "displayName": "Silver",
    "isPrivate": false
},
{
    "planId": "silver-private",
    "displayName": "Silver-private",
    "isPrivate": true
}]
```

Код: 404<br>
Не найдено<br> 

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым или запрос пытается получить доступ к приобретения, который не принадлежит текущему пользователю. <br> 

Код: 500<br>
Внутренняя ошибка сервера<br>

```json
{ 
    "error": { 
      "code": "UnexpectedError", 
      "message": "An unexpected error has occurred." 
    } 
```

#### <a name="resolve-a-subscription"></a>Разрешить подписки 

Разрешение конечной точки позволяет разрешить маркер marketplace в постоянный идентификатор ресурса. Идентификатор ресурса — это уникальный идентификатор для подписки SAAS.  Когда пользователь перенаправляется на веб-сайт ISV, URL-адрес содержит токен в параметрах запроса. Ожидается, что ISV будет использовать этот токен и отправит запрос на его разрешение. Ответ содержит уникальный идентификатор подписки SAAS, имя, идентификатор предложения и план для ресурса. Этот токен действителен только в течение часа. 

**Поместить:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/resolve?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |  Версию операции, используемой для данного запроса  |

*Заголовки запроса:*
 
|                    |                   |
|  ---------------   |  ---------------  |
|  Content-Type      | `application/json` |
|  x-ms-requestid    |  Уникальное строковое значение для отслеживания запроса от клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
|  x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
|  authorization     |  Токен носителя token (JWT) JSON web  |
|  x-ms-marketplace-token  |  Параметр маркера запроса в URL-АДРЕСЕ, когда пользователь перенаправляется на веб-сайт SaaS независимого поставщика программного обеспечения из Azure. *Примечание.* URL-адрес декодирует значение токена из браузера перед его использованием. |

*Коды ответов:*

Код: 200<br>
Разрешает непрозрачного токена на подписку SaaS.<br>

```json
Response body:
{
    "subscriptionId": "cd9c6a3a-7576-49f2-b27e-1e5136e57f45",  
    "subscriptionName": "My Saas application",
    "offerId": "ce-dr-tier2",
    "planId": "silver",
    "quantity": "20",
    "operationId": " be750acb-00aa-4a02-86bc-476cbe66d7fa"  
}
```

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, который не принадлежит текущему пользователю.

Код: 500<br>
Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}
```

#### <a name="activate-a-subscription"></a>Активировать подписку

**Поместить:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>/activate?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |  Версию операции, используемой для данного запроса  |
| subscriptionId     | Уникальный идентификатор, полученный после устранения маркер, с помощью API устранения подписки SaaS  |

*Заголовки запроса:*
 
|                    |                   |
|  ---------------   |  ---------------  |
|  Content-Type      | `application/json`  |
|  x-ms-requestid    | Уникальное строковое значение для отслеживания запроса от клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
|  x-ms-correlationid  | Уникальное строковое значение для операции на стороне клиента. Это значение позволяет сопоставить все события клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.  |
|  authorization     |  Токен носителя token (JWT) JSON web |

*Запрос:*

```json
{
    "planId": "gold",
    "quantity": ""
}
```

*Коды ответов:*

Код: 202<br>
Активирует подписку.<br>

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, который не принадлежит текущему пользователю.

Код: 500<br>
Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}
```

#### <a name="update-a-subscription"></a>Обновление подписки

Обновить или изменить план подписки с помощью указанных значений.

**Исправление:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |  Версия операции, используемой для этого запроса.  |
| subscriptionId     | Уникальный идентификатор, полученный после устранения маркер, с помощью API устранения подписки SaaS.  |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  Content-Type      | `application/json` |
|  x-ms-requestid    |   Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
|  x-ms-correlationid  |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.    |
| authorization      |  Токен носителя JSON Web Token (JWT).  |

*Полезные данные запроса:*

```json
Request Body:
{
    "planId": "gold",
    "quantity": ""
}
```

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
| Operation-Location | Ссылки на ресурс, чтобы получить состояние операции.   |

*Коды ответов:*

Код: 202<br>
Независимых поставщиков программного обеспечения запускает изменить план, или изменить количество. <br>

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок.

>[!Note]
>План или количество может быть исправлен за один раз, но не оба. Редактирует на подписки с помощью **обновление** не находится в `allowedCustomerOperations`.

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, который не принадлежит текущему пользователю.

Код: 500<br>
Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}
```

#### <a name="delete-a-subscription"></a>Удаление подписки

Отказаться от подписки и удаление указанной подписки.

**"Delete" (Удалить).<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId> ?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |  Версия операции, используемой для этого запроса.  |
| subscriptionId     | Уникальный идентификатор, полученный после устранения маркер, с помощью API устранения подписки SaaS.  |

*Заголовки запроса:*
 
|                    |                   |
|  ---------------   |  ---------------  |
|   Content-Type     |  `application/json` |
|  x-ms-requestid    |   Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, один будет сгенерирован и в заголовке ответа.   |
|  x-ms-correlationid  |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.   |
|  authorization     |  Токен носителя JSON Web Token (JWT).   |

*Коды ответов:*

Код: 200<br>
Независимых поставщиков программного обеспечения инициируется вызов для указания отказаться от подписки на подписку SaaS.<br>

Код: 404<br>
Не найдено

Код: 400<br>
Удалить на подписки с помощью **удалить** не в `allowedCustomerOperations`.

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, который не принадлежит текущему пользователю.

Код: 500<br>
Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}
```


### <a name="operations-api"></a>Операции API

Операции API поддерживает следующие операции исправления и Get.


#### <a name="update-a-subscription"></a>Обновление подписки

Обновление подписки с помощью указанных значений.

**Исправление:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>/operation/<operationId>?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|   ApiVersion       |  Версия операции, используемой для этого запроса.  |
| subscriptionId     | Уникальный идентификатор, полученный после устранения маркер, с помощью API устранения подписки SaaS.  |
|  operationId       | Операция, которую было выполнено. |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|   Content-Type     | `application/json`   |
|   x-ms-requestid   |   Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа. |
|  x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа. |
|  authorization     |  Токен носителя JSON Web Token (JWT).  |

*Полезные данные запроса:*

```json
{
    "planId": "",
    "quantity": "",
    "status": "Success"    // Allowed Values: Success/Failure. Indicates the status of the operation.
}
```

*Коды ответов:*

Код: 200<br> Вызов для информирования о завершении операции на стороне независимых поставщиков программного обеспечения. Например это может быть изменение рабочих мест и планов.

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым или запрос пытается получить доступ к приобретения, который не принадлежит текущему пользователю.

Код: 409<br>
Конфликт. Например новая транзакция уже выполняется

Код: 500<br> Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}

```

#### <a name="list-outstanding-operations"></a>Список незавершенных операций 

Список незавершенных операций для текущего пользователя. 

**Получить:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>/operations?api-version=<ApiVersion>`**

*Параметры запроса:*

|             |        |
|  ---------------   |  ---------------  |
|    ApiVersion                |   Версия операции, используемой для этого запроса.                |
| subscriptionId     | Уникальный идентификатор, полученный после устранения маркер, с помощью API устранения подписки SaaS.  |

*Заголовки запроса:*
 
|                    |                   |
|  ---------------   |  ---------------  |
|   Content-Type     |  `application/json` |
|  x-ms-requestid    |  Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
|  x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.  |
|  authorization     |  Токен носителя JSON Web Token (JWT).  |

*Коды ответов:*

Код: 200<br> Получает список ожидающих операций для подписки.<br>
Полезные данные ответа:

```json
[{
    "id": "be750acb-00aa-4a02-86bc-476cbe66d7fa",  
    "activityId": "be750acb-00aa-4a02-86bc-476cbe66d7fa",
    "subscriptionId": "cd9c6a3a-7576-49f2-b27e-1e5136e57f45",
    "offerId": "ce-dr-tier2",
    "publisherId": "cloudendure",  
    "planId": "silver",
    "quantity": "20",
    "action": "Convert",
    "timeStamp": "2018-12-01T00:00:00",  
    "status": "NotStarted"  
}]
```

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, который не принадлежит текущему пользователю.

Код: 500<br>
Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}

```

#### <a name="get-operation-status"></a>Получить состояние операции

Позволяет отслеживать состояние операции активированные async (Subscribe и Unsubscribe/изменить план).

**Получить:<br> `https://marketplaceapi.microsoft.com/api/saas/subscriptions/<subscriptionId>/operations/<operationId>?api-version=<ApiVersion>`**

*Параметры запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  ApiVersion        |  Версия операции, используемой для этого запроса.  |

*Заголовки запроса:*

|                    |                   |
|  ---------------   |  ---------------  |
|  Content-Type      |  `application/json`   |
|  x-ms-requestid    |   Уникальное строковое значение для отслеживания запроса клиента, желательно GUID. Если это значение не указано, оно создается случайным образом и возвращается в заголовке ответа.  |
|  x-ms-correlationid |  Уникальное строковое значение для операции на стороне клиента. Этот параметр сопоставляет все события из клиентской операции с событиями на стороне сервера. Если это значение не указано, один будет сгенерирован и в заголовке ответа.  |
|  authorization     | Токен носителя JSON Web Token (JWT).  |

*Коды ответов:* Код: 200<br> Получает список всех ожидающих операций SaaS<br>
Полезные данные ответа:

```json
Response body:
[{
    "id  ": "be750acb-00aa-4a02-86bc-476cbe66d7fa",
    "activityId": "be750acb-00aa-4a02-86bc-476cbe66d7fa",
    "subscriptionId":"cd9c6a3a-7576-49f2-b27e-1e5136e57f45",
    "offerId": "ce-dr-tier2",
    "publisherId": "cloudendure",  
    "planId": "silver",
    "quantity": "20",
    "action": "Convert",
    "timeStamp": "2018-12-01T00:00:00",
    "status": "NotStarted"
}]

```

Код: 404<br>
Не найдено

Код: 400<br>
Неправильный запрос проверки ошибок

Код: 403<br>
Не авторизовано. Не указан. маркер проверки подлинности является недопустимым, или запрос пытается получить доступ к приобретения, который не принадлежит текущему пользователю.
 
Код: 500<br> Внутренняя ошибка сервера

```json
{
    "error": {
      "code": "UnexpectedError",
      "message": "An unexpected error has occurred."
    }
}

```

## <a name="webhook-on-the-saas-service"></a>Веб-перехватчика в службе SaaS

Издатель должен реализовывать веб-перехватчика в эту службу SaaS, чтобы заранее уведомить пользователей об изменениях в свою службу. API должен быть не прошедших проверку подлинности и будет вызываться службой Microsoft SaaS. Ожидается, что служба SaaS вызов операций API для проверки и авторизации перед выполнением действия на веб-перехватчика уведомлений.

```json
{
    "operationId": "be750acb-00aa-4a02-86bc-476cbe66d7fa",
    "activityId": "be750acb-00aa-4a02-86bc-476cbe66d7fa",
    "subscriptionId":"cd9c6a3a-7576-49f2-b27e-1e5136e57f45",
    "offerId": "ce-dr-tier2",
    "publisherId": "cloudendure",
    "planId": "silver",
    "quantity": "20"  ,
    "action": "Activate",   // Activate/Delete/Suspend/Reinstate/Change[new]  
    "timeStamp": "2018-12-01T00:00:00"
}

```

<!-- Review following, might not be needed when this publishes -->


## <a name="mock-api"></a>Макет API

Чтобы помочь вам приступить к работе с разработкой приложений, особенно для создания прототипов и тестирования проектов можно использовать наш макет API. 

Конечная точка узла: https://marketplaceapi.microsoft.com/api Версия API: 2018-09-15 без проверки подлинности требуется образец Uri: https://marketplaceapi.microsoft.com/api/saas/subscriptions?api-version=2018-09-15

Любой из вызовов API в этой статье может быть сделан для конечной точки макет узла. Вы сможете получить фиктивные данные назад в качестве отклика.


## <a name="next-steps"></a>Дальнейшие действия

Разработчикам можно получить программным способом и обработку рабочих нагрузок, предложения и издателе профили с помощью [API-интерфейсов REST портал Cloud Partner](https://docs.microsoft.com/azure/marketplace/cloud-partner-portal-orig/cloud-partner-portal-api-overview).
