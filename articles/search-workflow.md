<properties title="Search Service: workflow for developers" pageTitle="Search Service: workflow for developers" description="Search Service: workflow for developers" metaKeywords="" services="" solutions="" documentationCenter="" authors="heidist" videoId="" scriptId="" />

# Поиск Azure. Поток процесса разработки

[WACOM.INCLUDE [В этой статье используется портал предварительной версии Azure][]]

В этой статье приведен перечень шагов и некоторые советы и рекомендации по созданию и обслуживанию службы поиска и ее индексов.

Мы предполагаем, что служба уже подготовлена вами. Если вы еще не подготовили службу, для начала работы см. раздел [Настройка поиска на портале предварительной версии Azure][].

-   [Шаг 1: Создание индекса][]
-   [Шаг 2: Добавление документов][]
-   [Шаг 3: Запрос индекса][]
-   [Шаг 4: Обновление или удаление индексов и документов][]
-   [Вопросы проектирования хранилища][]

## Шаг 1: Создание индекса

Запросы (по крайней мере кроме системных) используют поисковый индекс, который содержит данные для поиска и атрибуты. На этом шаге вы определите схему индекса в формате JSON и выполните запрос HTTP PUT для создания индекса в службе.

Как правило, индексы создаются в локальной среде разработки. Для определения индексов нет каких-либо специализированных встроенных средств или редакторов. Дополнительные сведения о создании индекса см. в разделе [Создание индекса (API Поиска Azure)][] в MSDN.

## Шаг 2: Добавление документов

После создания поискового индекса можно добавлять документы в индекс путем запроса POST в формате JSON. Каждый документ должен иметь уникальный ключ и набор полей, содержащих данные, по которым можно осуществлять поиск и прочие данные. Данные документа представлены в виде набора пар ключ-значение.

Мы рекомендуем добавлять документы партиями в целях улучшения пропускной способности. Можно одновременно группировать до 10 000 документов при условии, что средний размер документа составляет 1—2 КБ.

Для запроса POST возвращается общий код состояния. Коды состояния могут быть либо HTTP 200 (успех), либо HTTP 207 (многостатусный), если есть успешно обработанные документы и документы с ошибками. Дополнительно к коду состояния запроса POST поиск Azure поддерживает поле состояния для каждого документа. При групповой загрузке вам необходимо получить статус каждого документа, который отображает успешное добавление или ошибку при добавлении каждого документа. Поле состояния обеспечивает такую информацию. Это поле устанавливается в статус «false» при ошибке загрузки документа.

При высокой нагрузке ошибки загрузки могут встречаться часто. При возникновении ошибки общий код состояния будет 207, что говорит о частично успешной загрузке. У документов, при индексировании которых произошла ошибка, будет выставлено свойство «статус» в «false».

> [WACOM.NOTE] Когда служба получает документы, они становятся в очередь для индексирования и не сразу появляются в результатах поиска. В случае отсутствия высокой нагрузки документы, как правило, индексируются за несколько секунд.

## Шаг 3: Запрос индекса

После того, как документы будут проиндексированы, можно выполнять поисковые запросы. За один раз можно запрашивать только один индекс, с использованием OData или простого запроса:

-   [Синтаксис выражения OData для Поиска Azure][]
-   [Синтаксис простого запроса в Поиске Azure][]

## Шаг 4: Обновление или удаление индексов и документов

Дополнительно можно вносить изменения схемы в поисковый индекс, обновлять или удалять документы в индексе и удалять индексы.

При обновлении индекса вы можете сочетать в одной группе несколько действий (вставка, слияние, удаление), что устраняет необходимость в нескольких запросах. В настоящий момент Поиск Azure не поддерживает частичные обновления (HTTP PATCH), поэтому, если вам необходимо обновить индекс, необходимо повторно отправить его определение.

## Вопросы проектирования хранилища

Многие приложения поиска используют разные форматы хранения данных для различных нужд приложений. Внутреннее хранилище, входящее в состав Поиска Azure, должно использоваться для хранения индексов и документов. Текстовый анализ зависит от того, есть ли поля, по которым может вестись поиск, и доступны ли при этом связанные атрибуты.

Поиск может проводиться не по всем полям документа. Например, если ваше приложение представляет собой онлайн-каталог музыки или видео, мы рекомендуем хранить двоичные файлы в BLOB-объектах или в другом хранилище. Поиск по двоичным файлам не производится, поэтому нет смысла в их нахождении в хранилище Поиска Azure. Вы должны хранить изображения, видео и аудиофайл в других службах или местах, сохраняя URL к месту хранения файла в поле документа.

Дополнительные сведения о создании индексов или документов см. в разделе [Rest API Поиска Azure][].

<!--Anchors-->  
<!--Link references-->
<!--Image references-->

  [В этой статье используется портал предварительной версии Azure]: ../includes/preview-portal-note.md
  [Настройка поиска на портале предварительной версии Azure]: ../search-configure/
  [Шаг 1: Создание индекса]: #sub-1
  [Шаг 2: Добавление документов]: #sub-2
  [Шаг 3: Запрос индекса]: #sub-3
  [Шаг 4: Обновление или удаление индексов и документов]: #sub-4
  [Вопросы проектирования хранилища]: #sub-5
  [Создание индекса (API Поиска Azure)]: http://msdn.microsoft.com/en-us/library/dn798941.aspx
  [Синтаксис выражения OData для Поиска Azure]: http://msdn.microsoft.com/en-us/library/dn798921.aspx
  [Синтаксис простого запроса в Поиске Azure]: http://msdn.microsoft.com/en-us/library/dn798920.aspx
  [Rest API Поиска Azure]: http://msdn.microsoft.com/en-us/library/dn798935.aspx
