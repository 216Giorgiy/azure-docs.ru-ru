---
title: "Создание пиринга виртуальных сетей Azure | Документация Майкрософт"
description: "Узнайте, как установить пиринг между двумя виртуальными сетями."
services: virtual-network
documentationcenter: 
author: jimdial
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 026bca75-2946-4c03-b4f6-9f3c5809c69a
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/06/2017
ms.author: jdial;narayan;annahar
ms.translationtype: Human Translation
ms.sourcegitcommit: 245ce9261332a3d36a36968f7c9dbc4611a019b2
ms.openlocfilehash: 666165115e80a39d02386719b0d7e64d7ae17749
ms.contentlocale: ru-ru
ms.lasthandoff: 06/09/2017


---
# <a name="create-a-virtual-network-peering"></a>Создание пиринга виртуальных сетей

В этом руководстве вы узнаете, как установить пиринг между двумя виртуальными сетями. Установление пиринга между двумя виртуальными сетями позволяет ресурсам в разных виртуальных сетях взаимодействовать друг с другом с такими же пропускной способностью и задержкой, как если бы эти ресурсы находились в одной виртуальной сети. Пиринг виртуальных сетей можно создать только между двумя виртуальными сетями, размещенными в одном регионе Azure. Чтобы узнать больше о пиринге виртуальных сетей, ознакомьтесь с обзорной статьей [Пиринг между виртуальными сетями](virtual-network-peering-overview.md). 

Если необходимо подключить виртуальные сети, расположенные в разных регионах Azure, можно использовать [VPN-шлюз](../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json) Azure. 

Для создания пиринга виртуальных сетей можно использовать [портал Azure](#portal), Azure [PowerShell](#powershell), [интерфейс командной строки](#cli) Azure (Azure CLI) или [шаблон Azure Resource Manager](#template). Щелкните любую из предыдущих ссылок на инструмент, чтобы перейти непосредственно к инструкциям по созданию пиринга виртуальных сетей с помощью выбранного инструмента.

## <a name="portal"></a>Создание пиринга с помощью портала Azure

Выполните приведенные ниже действия, чтобы создать пиринг между двумя виртуальными сетями, развернутыми с помощью Resource Manager в одной подписке. Вы можете также установить пиринг [между двумя виртуальными сетями в разных подписках](#different-subscriptions) или [между виртуальной сетью Resource Manager и классической виртуальной сетью](#different-models). 

1. Войдите на [портал Azure](https://portal.azure.com). У учетной записи, используемой для входа, должны быть необходимые разрешения для создания пиринга виртуальных сетей. Дополнительные сведения см. в разделе [Разрешения](#permissions) этой статьи.
2. Щелкните **+ Создать**, выберите **Сети** и щелкните **Виртуальная сеть**.
3. В колонке **Виртуальная сеть** в поле **Выбор модели развертывания** оставьте выбранным пункт **Resource Manager**, а затем щелкните **Создать**.
4. В колонке **Создание виртуальной сети** введите или выберите значения для приведенных ниже параметров и щелкните **Создать**.
    - **Имя**: *myVnet1*.
    - **Адресное пространство**: *10.0.0.0/16*.
    - **Имя подсети**: *по умолчанию*.
    - **Диапазон адресов подсети**: *10.0.0.0/24*.
    - **Подписка**: выберите свою подписку.
    - **Группа ресурсов**: установите флажок **Создать** и введите *myResourceGroup*.
    - **Расположение**: *Восточная часть США*.
5. Повторите шаги 2–4, указав следующие значения на шаге 4.
    - **Имя**: *myVnet2*.
    - **Адресное пространство**: *10.1.0.0/16*.
    - **Имя подсети**: *по умолчанию*.
    - **Диапазон адресов подсети:** *10.1.0.0/24*.
    - **Подписка**: выберите свою подписку.
    - **Группа ресурсов**: установите флажок **Использовать существующий** и выберите *myResourceGroup*.
    - **Расположение**: *Восточная часть США*.
6. В поле **Поиск ресурсов**, находящемся в верхней части портала, введите *myResourceGroup*. Когда группа ресурсов **myResourceGroup** появится в результатах поиска, щелкните ее. Откроется колонка группы ресурсов **myResourceGroup**. Эта группа ресурсов содержит две виртуальные сети, созданные на предыдущих шагах.
7. Щелкните сеть **myVNet1**.
8. В вертикальном списке параметров в левой части отобразившейся колонки **myVnet1** щелкните **Пиринги**.
9. В открывшейся колонке **myVnet1 — пиринги** щелкните **+ Добавить**.
10. В открывшейся колонке **Добавить пиринг** введите или выберите значения приведенных ниже параметров, после чего нажмите кнопку **ОК**.
     - **Имя**: *myVnet1ToMyVnet2*.
     - **Модель развертывания виртуальной сети**: выберите **Resource Manager**. 
     - **Подписка**: выберите свою подписку.
     - **Виртуальная сеть**: щелкните **Выбор виртуальной сети**, затем выберите **myVnet2**.
     - **Разрешить доступ к виртуальным сетям**: убедитесь, что выбрано значение **Включено**.
    Другие параметры в этом руководстве не используются. Чтобы узнать о всех параметрах пиринга, прочитайте раздел [Создание, изменение и удаление пиринга в виртуальной сети](virtual-network-manage-peering.md#create-peering).
11. После нажатия кнопки **ОК** на предыдущем шаге колонка **Добавить пиринг** закроется, и вы снова увидите колонку **myVnet1 — пиринги**. Через несколько секунд созданный пиринг отобразится в этой колонке. В столбце **Состояние пиринга** для созданного пиринга **myVnet1ToMyVnet2** указано состояние **Инициировано**. Вы установили пиринг из myVnet1 в myVnet2, но теперь это нужно сделать из myVnet2 в myVnet1. Пиринг необходимо создать в обоих направлениях, чтобы ресурсы в виртуальных сетях могли взаимодействовать друг с другом.
12. Выполните шаги 6–11 для myVnet2.  Назовите пиринг *myVnet2ToMyVnet1*.
13. Через несколько секунд после нажатия кнопки **ОК** для создания пиринга **myVnet2ToMyVnet1** для myVnet2 он появится в столбце **Состояние пиринга** с состоянием **Подключен**.
14. Выполните шаги 6–8 для myVnet1. Теперь в столбце **Состояние пиринга** для пиринга **myVnet1ToVNet2** также отображается значение **Подключен**. Пиринг будет успешно установлен, когда значение **Подключен** отобразится в столбце **Состояние пиринга** для обеих виртуальных сетей в пиринге.
15. **Необязательно**. Хотя в этом руководстве не рассматривается создание виртуальных машин, можно создать по виртуальной машине в каждой виртуальной сети и подключить их между собой, чтобы проверить связь.
16. **Необязательно**. Чтобы удалить ресурсы, созданные в этом руководстве, выполните инструкции в разделе [Удаление ресурсов](#delete-portal) этой статьи.

Теперь все ресурсы Azure, созданные в любой из виртуальных сетей, могут взаимодействовать друг с другом, используя свои IP-адреса. Если вы используете разрешение имен Azure по умолчанию для виртуальных сетей, то ресурсы в этих виртуальных сетях не смогут разрешать имена между виртуальными сетями. Если требуется разрешение имен между виртуальными сетями в пиринге, необходимо создать собственный DNS-сервер. Узнайте, как настроить [разрешение имен с помощью собственного DNS-сервера](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server).

## <a name="cli"></a>Создание пиринга с помощью Azure CLI

Используйте приведенный ниже сценарий.

- Для его работы требуется Azure CLI 2.0.4 или более поздней версии. Чтобы узнать версию, выполните команду `az --version`. Если вам необходимо выполнить обновление, см. статью [Установка Azure CLI 2.0]( /cli/azure/install-azure-cli?toc=%2fazure%2fvirtual-network%2ftoc.json).
- Этот сценарий работает в оболочке Bash. Сведения о параметрах выполнения скриптов Azure CLI в клиенте Windows см. в статье [Использование Azure CLI в Windows](../virtual-machines/windows/cli-options.md?toc=%2fazure%2fvirtual-network%2ftoc.json).

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

1. Создайте группу ресурсов и две виртуальные сети.
    ```azurecli-interactive
    #!/bin/bash

    # Variables for common values used throughout the script.
    rgName="myResourceGroup"
    location="eastus"

    # Create a resource group.
    az group create \
      --name $rgName \
      --location $location

    # Create virtual network 1.
    az network vnet create \
      --name myVnet1 \
      --resource-group $rgName \
      --location $location \
      --address-prefix 10.0.0.0/16

    # Create virtual network 2.
    az network vnet create \
      --name myVnet2 \
      --resource-group $rgName \
      --location $location \
      --address-prefix 10.1.0.0/16
    #
    ```
2. Создайте пиринг двумя виртуальными сетями.
    ```azurecli-interactive
    # Get the id for VNet1.
    vnet1Id=$(az network vnet show \
      --resource-group $rgName \
      --name myVnet1 \
      --query id --out tsv)

    # Get the id for VNet2.
    vnet2Id=$(az network vnet show \
      --resource-group $rgName \
      --name myVnet2 \
      --query id \
      --out tsv)

    # Peer VNet1 to VNet2.
    az network vnet peering create \
      --name myVnet1ToMyVnet2 \
      --resource-group $rgName \
      --vnet-name myVnet1 \
      --remote-vnet-id $vnet2Id \
      --allow-vnet-access

    # Peer VNet2 to VNet1.
    az network vnet peering create \
      --name myVnet2ToMyVnet1 \
      --resource-group $rgName \
      --vnet-name myVnet2 \
      --remote-vnet-id $vnet1Id \
      --allow-vnet-access
    #
    ```
3. После выполнения сценария просмотрите пиринги для каждой виртуальной сети. Скопируйте приведенную ниже команду, а затем вставьте ее в командное окно.

    ```azurecli-interactive
    az network vnet peering list \
      --resource-group myResourceGroup \
      --vnet-name myVnet1 \
      --output table
    #
    ```
Выполните предыдущую команду еще раз, заменив *myVnet1* на *myVnet2*. В выходных данных обеих команд в столбце **PeeringState** (Состояние пиринга) показано состояние **Connected** (Подключен).
4. **Необязательно**. Хотя в этом руководстве не рассматривается создание виртуальных машин, можно создать по виртуальной машине в каждой виртуальной сети и подключить их между собой, чтобы проверить связь.
5. **Необязательно**. Чтобы удалить ресурсы, созданные в этом руководстве, выполните инструкции, описанные в разделе [Удаление ресурсов](#delete-cli) этой статьи.

Теперь все ресурсы Azure, созданные в любой из виртуальных сетей, могут взаимодействовать друг с другом, используя свои IP-адреса. Если вы используете разрешение имен Azure по умолчанию для виртуальных сетей, то ресурсы в этих виртуальных сетях не смогут разрешать имена между виртуальными сетями. Если требуется разрешение имен между виртуальными сетями в пиринге, необходимо создать собственный DNS-сервер. Узнайте, как настроить [разрешение имен с помощью собственного DNS-сервера](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server).
 
## <a name="powershell"></a>Создание пиринга с помощью PowerShell

1. Установите последнюю версию модуля [AzureRm](https://www.powershellgallery.com/packages/AzureRM/) PowerShell. Если вы еще не работали с Azure PowerShell, ознакомьтесь со статьей [Overview of Azure PowerShell](/powershell/azure/overview?toc=%2fazure%2fvirtual-network%2ftoc.json) (Общие сведения об Azure PowerShell).
2. Чтобы запустить сеанс PowerShell, нажмите кнопку **Пуск**, введите **powershell**, а затем щелкните **PowerShell**.
3. В окне PowerShell выполните вход в Azure, введя команду `login-azurermaccount`. У учетной записи, используемой для входа, должны быть необходимые разрешения для создания пиринга виртуальных сетей. Дополнительные сведения см. в разделе [Разрешения](#permissions) этой статьи.
4. В браузере скопируйте приведенный ниже сценарий, а затем щелкните правой кнопкой мыши в окне PowerShell, чтобы выполнить сценарий, который создает группу ресурсов и две виртуальные сети.
    ```powershell
    # Variables for common values used throughout the script.
    $rgName='myResourceGroup'
    $location='eastus'

    # Create a resource group.
    New-AzureRmResourceGroup `
      -Name $rgName `
      -Location $location

    # Create virtual network 1.
    $vnet1 = New-AzureRmVirtualNetwork `
      -ResourceGroupName $rgName `
      -Name 'myVnet1' `
      -AddressPrefix '10.0.0.0/16' `
      -Location $location

    # Create virtual network 2.
    $vnet2 = New-AzureRmVirtualNetwork `
      -ResourceGroupName $rgName `
      -Name 'myVnet2' `
      -AddressPrefix '10.1.0.0/16' `
      -Location $location
    #
    ```
5. В браузере скопируйте приведенный ниже сценарий, а затем щелкните правой кнопкой мыши в окне PowerShell, чтобы выполнить сценарий, который создает пиринг между двумя виртуальными сетями.
    ```powershell
    # Peer VNet1 to VNet2.
    Add-AzureRmVirtualNetworkPeering `
      -Name 'myVnet1ToMyVnet2' `
      -VirtualNetwork $vnet1 `
      -RemoteVirtualNetworkId $vnet2.Id

    # Peer VNet2 to VNet1.
    Add-AzureRmVirtualNetworkPeering `
      -Name 'myVnet2ToMyVnet1' `
      -VirtualNetwork $vnet2 `
      -RemoteVirtualNetworkId $vnet1.Id
    #
    ```
6. Чтобы просмотреть подсети для виртуальной сети, скопируйте команду ниже, а затем вставьте ее в окно PowerShell.

    ```powershell
    Get-AzureRmVirtualNetworkPeering `
      -ResourceGroupName myResourceGroup `
      -VirtualNetworkName myVnet1 `
      | Format-Table VirtualNetworkName, PeeringState
    #
    ```

Выполните предыдущую команду еще раз, заменив *myVnet1* на *myVnet2*. В выходных данных обеих команд в столбце **PeeringState** (Состояние пиринга) указано состояние **Connected** (Подключен).
7. **Необязательно**. Хотя в этом руководстве не рассматривается создание виртуальных машин, можно создать по виртуальной машине в каждой виртуальной сети и подключить их между собой, чтобы проверить связь.
8. **Необязательно**. Чтобы удалить ресурсы, созданные в этом руководстве, выполните инструкции, описанные в разделе [Удаление ресурсов](#delete-powershell) этой статьи.

Теперь все ресурсы Azure, созданные в любой из виртуальных сетей, могут взаимодействовать друг с другом, используя свои IP-адреса. Если вы используете разрешение имен Azure по умолчанию для виртуальных сетей, то ресурсы в этих виртуальных сетях не смогут разрешать имена между виртуальными сетями. Если требуется разрешение имен между виртуальными сетями в пиринге, необходимо создать собственный DNS-сервер. Узнайте, как настроить [разрешение имен с помощью собственного DNS-сервера](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server).

## <a name="template"></a>Создание пиринга с помощью шаблона Resource Manager

1. В качестве примера используйте шаблон Azure Resource Manager для [создания пиринга виртуальных сетей](https://azure.microsoft.com/resources/templates/201-vnet-to-vnet-peering). Вместе с шаблоном предоставляются инструкции по его развертыванию с помощью портала Azure, PowerShell или Azure CLI. Войдите в один из этих инструментов, который вы выбрали для развертывания шаблона, используя учетную запись с разрешениями, необходимые для создания пиринга виртуальных сетей. Дополнительные сведения см. в разделе [Разрешения](#permissions) этой статьи.
2. **Необязательно**. Хотя в этом руководстве не рассматривается создание виртуальных машин, можно создать по виртуальной машине в каждой виртуальной сети и подключить их между собой, чтобы проверить связь.
3. **Необязательно**. Чтобы удалить ресурсы, созданные в этом руководстве, выполните инструкции в разделе [Удаление ресурсов](#delete) этой статьи. Для этого можно использовать портал Azure, PowerShell или Azure CLI.

## <a name="different-models"></a>Установка пиринга между виртуальными сетями, созданными с использованием разных моделей развертывания

В предыдущих разделах было рассмотрено, как создать пиринг между двумя виртуальными сетями, созданными посредством модели развертывания с помощью Resource Manager. Можно также создать пиринг между виртуальной сетью Resource Manager и классической виртуальной сетью. Невозможно создать пиринг между двумя виртуальными сетями, созданными с помощью классической модели развертывания. Дополнительные сведения о моделях развертывания Azure см. в статье [Развертывание с помощью Azure Resource Manager и классическое развертывание: сведения о моделях развертывания и состоянии ресурсов](../azure-resource-manager/resource-manager-deployment-model.md?toc=%2fazure%2fvirtual-network%2ftoc.json).

Чтобы создать пиринг виртуальный сетей, выполните шаги 1–11 из раздела для [портала](#portal) этого статьи, но выберите **классическую** модель развертывания при создании myVnet2 на шаге 3.

При создании пиринга между виртуальной сетью Resource Manager и классической виртуальной сетью настраивается только пиринговая связь из классической виртуальной сети в виртуальную сеть Resource Manager. После создания пиринг для виртуальной сети Resource Manager находится в состоянии **Обновление**. Его состояние автоматически изменится на **Подключен** через несколько секунд, так как вам не нужно создавать пиринг для классической виртуальной сети. 

> [!NOTE]
> Хотя это и не рассматривается в данном руководстве, вы можете изменить сценарии из разделов для [Azure CLI](#cli) и [PowerShell](#powershell) данной статьи, чтобы отразить в них отличия, описанные в этом разделе.

## <a name="different-subscriptions"></a>Установление пиринга между виртуальными сетями в разных подписках

В предыдущих разделах было рассмотрено, как создать пиринг между двумя виртуальными сетями в одной подписке. Можно также создать пиринг между виртуальными сетями в разных подписках, если эти подписки связаны с одним клиентом Azure Active Directory. Если у вас еще нет клиента AD, можно быстро [создать его](../active-directory/develop/active-directory-howto-tenant.md?toc=%2fazure%2fvirtual-network%2ftoc.json#start-from-scratch). Если подписки связаны с разными клиентами Active Directory, невозможно будет создать пиринг между находящимися в этих подписках виртуальными сетями. Как показано ниже, инструкции по созданию пиринга несколько различаются в зависимости от модели развертывания, с помощью которой были созданы виртуальные сети.

### <a name="different-subscriptions-same-deployment-model"></a>Обе виртуальные сети созданы с помощью Resource Manager

1. Выполните шаги 1–7 из раздела для [портала](#portal) этой статьи, но на шаге 5 выберите для myVnet2 подписку (связанную с тем же клиентом Azure Active Directory), отличную от подписки, выбранной для myVnet1 на шаге 4.
2. В вертикальном списке параметров в левой части отобразившейся колонки **myVnet1** щелкните **Управление доступом (IAM)**.
3. В открывшейся колонке **myVnet1 — управление доступом (IAM)** щелкните **+ Добавить**.
4. В отобразившейся колонке **Добавление разрешений** в поле **Роль** выберите **Участник сетей**.
5. В поле **Выбор** выберите имя пользователя или введите электронный адрес для поиска. Отобразится список пользователей из того же клиента Azure Active Directory, с которым связана виртуальная сеть, с которой вы устанавливаете пиринг.
6. Щелкните **Сохранить**.
7. В вертикальном списке параметров в левой части отобразившейся колонки **myVnet1 — управление доступом (IAM)** щелкните **Свойства**. Скопируйте значение **Идентификатор ресурса**, который выглядит следующим образом: /subscriptions/[ИД]/resourceGroups/myResourceGroup/providers/Microsoft.Network/virtualNetworks/myVnet1.
8. Выполните шаги 1–7 из этого раздела для myVnet2.
9. Чтобы включить авторизацию, выйдите из Azure, а затем снова выполните вход в систему. Если вы использовали разные учетные записи для двух виртуальных сетей, выйдите из них, а затем войдите в обе эти учетные записи.
10. В поле **Поиск ресурсов**, находящемся в верхней части портала, введите *myResourceGroup*. Когда группа ресурсов **myResourceGroup** появится в результатах поиска, щелкните ее. Откроется колонка группы ресурсов **myResourceGroup**. Эта группа ресурсов содержит две виртуальные сети, созданные на предыдущих шагах.
11. Щелкните сеть **myVNet1**.
12. В вертикальном списке параметров в левой части отобразившейся колонки **myVnet1** щелкните **Пиринги**.
13. В открывшейся колонке **myVnet1 — пиринги** щелкните **+ Добавить**.
14. В открывшейся колонке **Добавить пиринг** введите или выберите значения приведенных ниже параметров, после чего нажмите кнопку **ОК**.
     - **Имя**: *myVnet1ToMyVnet2*.
     - **Модель развертывания виртуальной сети**: выберите **Классический**. 
     - **Я знаю идентификатор ресурса**: установите этот флажок.
     - **Идентификатор ресурса**: введите идентификатор ресурса myVnet2. Это поле доступно, только если установлен флажок **Я знаю идентификатор ресурса**.
     - **Разрешить доступ к виртуальным сетям**: убедитесь, что выбрано значение **Включено**.
    Другие параметры в этом руководстве не используются. Чтобы узнать о всех параметрах пиринга, прочитайте раздел [Создание, изменение и удаление пиринга в виртуальной сети](virtual-network-manage-peering.md#create-peering).
15. После нажатия кнопки **ОК** на предыдущем шаге колонка **Добавить пиринг** закроется, и вы снова увидите колонку **myVnet1 — пиринги**. Через несколько секунд созданный пиринг отобразится в этой колонке. В столбце **Состояние пиринга** для созданного пиринга **myVnet1ToMyVnet2** указано состояние **Инициировано**. Вы установили пиринг из myVnet1 в myVnet2, но теперь это нужно сделать из myVnet2 в myVnet1. Пиринг необходимо создать в обоих направлениях, чтобы ресурсы в виртуальных сетях могли взаимодействовать друг с другом.
16. Выполните шаги 10–14 из этого раздела для myVnet2.  Назовите пиринг *myVnet2ToMyVnet1* и введите идентификатор ресурса myVnet1 в поле **Идентификатор ресурса**.
17. Через несколько секунд после нажатия кнопки **ОК** для создания пиринга **myVnet2ToMyVnet1** для myVnet2 он появится в столбце **Состояние пиринга** с состоянием **Подключен**.
18. Выполните шаги 10–11 из этого раздела для myVnet1. Теперь в столбце **Состояние пиринга** для пиринга **myVnet1ToVNet2** также отображается значение **Подключен**. Пиринг будет успешно установлен, когда значение **Подключен** отобразится в столбце **Состояние пиринга** для обеих виртуальных сетей в пиринге.
19. **Необязательно**. Хотя в этом руководстве не рассматривается создание виртуальных машин, можно создать по виртуальной машине в каждой виртуальной сети и подключить их между собой, чтобы проверить связь.
20. **Необязательно**. Чтобы удалить ресурсы, созданные в этом руководстве, выполните инструкции в разделе [Удаление ресурсов](#delete-portal) этой статьи.

### <a name="different-subscriptions-different-deployment-models"></a>Виртуальная сеть Resource Manager и классическая виртуальная сеть
 
[!INCLUDE [virtual-network-create-udr-scenario-include.md](../../includes/virtual-network-preview.md)]

1. Зарегистрируйтесь для использования предварительной версии. Вы не сможете создать пиринг между виртуальными сетями, созданными с помощью разных моделей развертывания в разных подписках, если не зарегистрируетесь для использования предварительной версии. Это невозможно сделать с помощью портала или Azure CLI. Зарегистрироваться для использования предварительной версии можно только с помощью PowerShell. Чтобы зарегистрироваться для использования предварительной версии, выполните следующие задачи.
    - Установите последнюю версию модуля [AzureRm](https://www.powershellgallery.com/packages/AzureRM/) PowerShell. Если вы еще не работали с Azure PowerShell, ознакомьтесь со статьей [Overview of Azure PowerShell](/powershell/azure/overview?toc=%2fazure%2fvirtual-network%2ftoc.json) (Общие сведения об Azure PowerShell).
    - Чтобы запустить сеанс PowerShell на компьютере с Windows, нажмите кнопку **Пуск**, введите **powershell**, а затем щелкните **PowerShell**.
    - В окне PowerShell выполните вход в Azure, введя команду `login-azurermaccount`. У учетной записи, используемой для входа, должны быть необходимые разрешения для создания пиринга виртуальных сетей. Дополнительные сведения см. в разделе [Разрешения](#permissions) этой статьи.
    - Зарегистрируйте возможности предварительной версии для обеих подписок Azure. Для этого введите приведенные ниже команды в PowerShell. 
    
    ```powershell
    Register-AzureRmProviderFeature `
      -FeatureName AllowClassicCrossSubscriptionPeering `
      -ProviderNamespace Microsoft.Network
    Register-AzureRmResourceProvider `
      -ProviderNamespace Microsoft.Network
    #
    ```
    Зарегистрируйтесь для использования предварительной версии, выполнив вход в каждую из подписок. Не приступайте к дальнейшим действиям, пока после выполнения приведенной ниже команды для обеих подписок столбец **RegistrationState** (Состояние регистрации) в выходных данных не будет содержать значение **Registered** (Зарегистрирована).

    ```powershell
    Get-AzureRmProviderFeature `
      -FeatureName AllowClassicCrossSubscriptionPeering `
      -ProviderNamespace Microsoft.Network
    #
    ```

2. Выполните шаги 1–7 из раздела для [портала](#portal) этой статьи, внеся следующие изменения.
    - На шаге 5 выберите для myVnet2 подписку (связанную с тем же клиентом Azure Active Directory), отличную от подписки, выбранной для myVnet1 на шаге 4.
    - При создании myVnet2 на шаге 3 выберите **Классический**.
3. В поле **Поиск ресурсов**, находящемся в верхней части портала, введите *myResourceGroup*. Когда группа ресурсов **myResourceGroup** появится в результатах поиска, щелкните ее. Откроется колонка группы ресурсов **myResourceGroup**. Эта группа ресурсов содержит две виртуальные сети, созданные на предыдущих шагах.
4. Щелкните сеть **myVNet1**.
5. Выполните шаги 2–9 из раздела [Обе виртуальные сети созданы с помощью Resource Manager](#different-subscriptions-same-deployment-model) этой статьи.
6. В поле **Поиск ресурсов**, находящемся в верхней части портала, введите *myResourceGroup*. Когда группа ресурсов **myResourceGroup** появится в результатах поиска, щелкните ее. Откроется колонка группы ресурсов **myResourceGroup**. Эта группа ресурсов содержит две виртуальные сети, созданные на предыдущих шагах.
7. Щелкните сеть **myVNet1**.
8. В вертикальном списке параметров в левой части отобразившейся колонки **myVnet1** щелкните **Пиринги**.
9. В открывшейся колонке **myVnet1 — пиринги** щелкните **+ Добавить**.
10. В открывшейся колонке **Добавить пиринг** введите или выберите значения приведенных ниже параметров, после чего нажмите кнопку **ОК**.
     - **Имя**: *myVnet1ToMyVnet2*.
     - **Модель развертывания виртуальной сети**: выберите **Классический**. 
     - **Я знаю идентификатор ресурса**: установите этот флажок.
     - **Идентификатор ресурса**: введите идентификатор ресурса myVnet2. Это поле доступно, только если установлен флажок **Я знаю идентификатор ресурса**.
     - **Разрешить доступ к виртуальным сетям**: убедитесь, что выбрано значение **Включено**.
    Другие параметры в этом руководстве не используются. Чтобы узнать о всех параметрах пиринга, прочитайте раздел [Создание, изменение и удаление пиринга в виртуальной сети](virtual-network-manage-peering.md#create-peering).

    При создании пиринга между виртуальной сетью Resource Manager и классической виртуальной сетью настраивается только пиринговая связь из классической виртуальной сети в виртуальную сеть Resource Manager. После создания пиринг для виртуальной сети Resource Manager находится в состоянии **Обновление**. Его состояние автоматически изменится на **Подключен** через несколько секунд, так как вам не нужно создавать пиринг для классической виртуальной сети. 
11. **Необязательно**. Хотя в этом руководстве не рассматривается создание виртуальных машин, можно создать по виртуальной машине в каждой виртуальной сети и подключить их между собой, чтобы проверить связь.
12. **Необязательно**. Чтобы удалить ресурсы, созданные в этом руководстве, выполните инструкции в разделе [Удаление ресурсов](#delete-portal) этой статьи.

> [!NOTE]
> Хотя это и не рассматривается в данном руководстве, вы можете изменить сценарии из разделов для [Azure CLI](#cli) и [PowerShell](#powershell) данной статьи, чтобы отразить в них отличия, описанные в этом разделе.

## <a name="permissions"></a>Разрешения

У учетных записей, используемых для создания пиринга виртуальных сетей, должна быть необходимая роль или разрешения. Например, при создании пиринга между двумя виртуальными сетями VNet1 и VNet2 вашей учетной записи должны быть назначены следующие минимальные роли или разрешения для каждой виртуальной сети.
    
|Виртуальная сеть|Модель развертывания|Роль|Разрешения|
|---|---|---|---|
|VNet1|Диспетчер ресурсов|[Участник сети](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor)|Microsoft.Network/virtualNetworks/virtualNetworkPeerings/write|
| |Классический|[Участник классической сети](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#classic-network-contributor)|Недоступно|
|VNet2|Диспетчер ресурсов|[Участник сети](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor)|Microsoft.Network/virtualNetworks/peer|
||Классический|[Участник классической сети](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#classic-network-contributor)|Microsoft.ClassicNetwork/virtualNetworks/peer|

Узнайте больше о [встроенных ролях](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor) и назначении разрешений, определенных для [настраиваемых ролей](../active-directory/role-based-access-control-custom-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json) (только для Resource Manager).

## <a name="delete"></a>Удаление ресурсов
По завершении работы с этим руководством может потребоваться удалить созданные в его рамках ресурсы, чтобы за их использование не взималась плата. При удалении группы ресурсов будут также удалены все ресурсы, содержащиеся в ней.

### <a name="delete-portal"></a>Портал Azure

1. В поле поиска на портале введите **myResourceGroup**. В результатах поиска щелкните **myResourceGroup**.
2. В колонке **myResourceGroup** щелкните значок **Удалить**.
3. Чтобы подтвердить удаление, введите **myResourceGroup** в поле **Введите имя группы ресурсов**, а затем щелкните **Удалить**.

### <a name="delete-cli"></a>Интерфейс командной строки Azure

В командной оболочке Linux, macOS или Windows введите команду, приведенную ниже. Можно также нажать кнопку "Попробовать" в верхнем правом углу приведенного ниже блока кода, чтобы запустить Cloud Shell. Затем скопируйте пример кода с помощью кнопки "Копировать" и вставьте его в Cloud Shell.

```azurecli-interactive
az group delete --name myResourceGroup --yes
```

### <a name="delete-powershell"></a>PowerShell

В командной строке PowerShell введите приведенную ниже команду.

```powershell
Remove-AzureRmResourceGroup -Name myResourceGroup
```

## <a name="next-steps"></a>Дальнейшие действия

- Внимательно ознакомьтесь с важными [ограничениями и особенностями работы пиринга виртуальных сетей](virtual-network-manage-peering.md#about-peering), прежде чем создавать пиринг виртуальных сетей для рабочей среды.
- Узнайте о [параметрах пиринга виртуальных сетей](virtual-network-manage-peering.md#create-peering).
- Узнайте, как [создать звездообразную топологию сети](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json#vnet-peering) с помощью пиринга виртуальных сетей.

