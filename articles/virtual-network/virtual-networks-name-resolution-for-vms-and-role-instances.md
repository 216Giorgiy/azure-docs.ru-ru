<properties 
   pageTitle="Разрешение имен для виртуальных машин и экземпляров ролей"
   description="Сценарии разрешения имен для Azure IaaS, гибридных решений, между различными облачными службами, Active Directory и с помощью DNS-сервера"
   services="virtual-network"
   documentationCenter="na"
   authors="joaoma"
   manager="jdial"
   editor="tysonn" />
<tags 
   ms.service="virtual-network"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="06/30/2015"
   ms.author="joaoma" />

# Разрешение имен для ВМ и экземпляров ролей

В зависимости от того, как Azure используется для размещения IaaS, PaaS и гибридных решений, может потребоваться разрешить созданным виртуальным машинам и экземплярам ролей взаимодействовать с другими виртуальными машинами и экземплярами ролей. Несмотря на то, что это взаимодействие может осуществляться с помощью IP-адресов, гораздо проще использовать имена узлов, которые легко запомнить. Тем не менее эти имена узлов должны разрешаться в IP-адреса для установки связи.

Если для экземпляров ролей и виртуальных машин, размещенных в Azure, требуется разрешение имен узлов и доменных имен во внутренние IP-адреса, это можно сделать с помощью двух методов:

- [разрешение имен Azure;](azure-provided-name-resolution)

- [разрешение имен с помощью собственного DNS-сервера.](name-resolution-using-your-own-DNS-server)

Тип разрешения имен зависит от способа взаимодействия виртуальных машин и экземпляров ролей внутри вашей облачной службы и за ее пределами.

**В следующей таблице представлены сценарии и соответствующие решения для разрешения имен.**

| **Сценарий** | **Тип разрешения имен** | **Дополнительные сведения см. в разделах:** |
|------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Разрешение имен между экземплярами ролей или виртуальными машинами, расположенными в одной облачной службе | разрешение имен Azure; | [разрешение имен Azure;](#azure-provided-name-resolution) |
| Разрешение имен между виртуальными машинами и экземплярами ролей в одной виртуальной сети | Разрешение имен Azure — использование разрешения полных доменных имен или простых имен с помощью собственного DNS-сервера | [разрешение имен Azure](#azure-provided-name-resolution); [Разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server); [требования к DNS-серверу](#dns-server-requirements); |
| Разрешение имен между виртуальными машинами и экземплярами ролей в разных виртуальных сетях | Разрешение имен с помощью собственного DNS-сервера | [разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server); [требования к DNS-серверу](#dns-server-requirements); |
| Между расположениями: разрешение имен между экземплярами ролей или виртуальными машинами в Azure и локальными компьютерами | Разрешение имен с помощью собственного DNS-сервера | [разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server); [требования к DNS-серверу](#dns-server-requirements); |
| Обратный просмотр внутренних IP-адресов | Разрешение имен с помощью собственного DNS-сервера | [разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server); [требования к DNS-серверу](#dns-server-requirements); |
| Разрешение имен для личных доменов (например, доменов Active Directory и доменов, которые вы регистрируете) | Разрешение имен с помощью собственного DNS-сервера | [разрешение имен с помощью собственного DNS-сервера](#name-resolution-using-your-own-dns-server); [требования к DNS-серверу](#dns-server-requirements). |
| Разрешение имен между экземплярами ролей, расположенными не в виртуальной сети, а в различных облачных службах | Не применяется Подключение между виртуальными машинами и экземплярами ролей в разных облачных службах не поддерживается за пределами виртуальной сети. | Не применяется |

> [AZURE.NOTE]Разрешение имен между компьютерами в Интернете и общедоступными конечными точками предоставляется Azure автоматически и не требует настройки.

## разрешение имен Azure;

Кроме разрешения для общедоступных доменов в Интернете, Azure предоставляет разрешение для виртуальных машин и экземпляров ролей, принадлежащих к одной облачной службе, с использованием имен узлов, а также для виртуальных машин и экземпляров ролей в разных облачных службах одной виртуальной сети с использованием полных доменных имен. Несмотря на то что разрешение имен Azure не требует настройки, это не самый лучший выбор для всех сценариев развертывания, как показано в приведенной выше таблице.

> [AZURE.NOTE]Что касается веб-ролей и рабочих ролей, вы можете также получать доступ ко внутренним IP-адресам экземпляров ролей на основе имени роли и номера экземпляра с помощью REST API управления службами Azure. Дополнительную информацию см. в разделе [Справочник по API-интерфейсу управления службами REST](https://msdn.microsoft.com/library/azure/ee460799.aspx).

### Функции и рекомендации

**Функции**

- Простота использования: для использования службы DNS, предоставляемой Azure, дополнительные настройки не нужны.

- Разрешение имен узлов между экземплярами ролей или виртуальными машинами, расположенными в одной облачной службе.

- Разрешение имен между экземплярами ролей и виртуальными машинами, расположенными в одной виртуальной сети, но в разных облачных службах, с использованием полного доменного имени целевого экземпляра роли или виртуальной машины.

- Вместо использования автоматически создаваемых имен вы можете создавать имена узлов, которые понятно описывают ваши развертывания.

- Для разрешения общедоступных доменных имен поддерживается стандартный поиск DNS.

**Рекомендации**

- Разрешение имен между виртуальными сетями недоступно.

- Для виртуальных машин и экземпляров ролей, которые находятся в первых 180 облачных службах, добавленных в виртуальной сети Azure, можно регистрировать только имена узлов и полные доменные имена. При наличии более 180 облачных служб, независимо от количества виртуальных машин и экземпляров ролей в каждой службе, для разрешения имен необходимо предоставить DNS-сервер.

- Использование нескольких имен узлов для одной виртуальной машины или экземпляра роли не поддерживается.

- Разрешение имен между разными расположениями недоступно.

- Созданный Azure DNS-суффикс нельзя изменить.

- Вы не можете вручную регистрировать собственные записи в службе DNS, предоставленной Azure.

- WINS и NetBIOS не поддерживаются. (Вы не можете просмотреть список виртуальных машин в браузере сети в проводнике Windows.)

- Имена узлов должны быть DNS-совместимыми (они могут содержать только символы 0–9, a–z и «-» и не могут начинаться или заканчиваться на «-». См. раздел 2 RFC 3696.)

- Трафик запросов DNS регулируется для каждой виртуальной машины. Если приложение выполняет частые запросы DNS для нескольких целевых имен, время ожидания некоторых запросов может истечь. Чтобы избежать этого, советуем использовать кэширование клиента.

## Разрешение имен с помощью собственного DNS-сервера

Если ваши требования к разрешению имен превышают возможности Azure, вы можете использовать собственный DNS-сервер. При использовании собственного DNS-сервера вы несете ответственность за управление записями, необходимыми для облачных служб.

> [AZURE.NOTE]Мы советуем избегать использования внешнего DNS-сервера, если этого не требует ваш сценарий развертывания.

## Требования к DNS-серверу

Если планируется использовать разрешение имен, не предоставляемое Azure, указанный вами DNS-сервер должен поддерживать следующее. DNS-сервер должен принимать динамическую регистрацию DNS через динамические DNS (DDNS).

- На этом DNS-сервере нужно отключить функцию очистки записей. Аренда IP-адресов Azure долгосрочная, и это может привести к удалению записей на DNS-сервере во время очистки.

- Для разрешения внешних доменных имен на DNS-сервере должна быть включена рекурсия.

- DNS-сервер должен быть доступен (по порту TCP или UDP 53) клиентам, которые запрашивают разрешение имен, а также службам и виртуальным машинам, которые регистрируют их имена.

- Мы советуем также защитить DNS-сервер от доступа из Интернета, так как многие всплывающие окна ищут открытые рекурсивные сопоставители DNS.


## Указание DNS-серверов

Вы можете указать несколько DNS-серверов для использования виртуальными машинами и экземплярами ролей. В таком случае DNS-серверы используются в том порядке, в котором они были указаны в режиме отработки отказа (в отличие от циклического перебора). В каждом запросе DNS клиент сначала использует предпочтительный DNS-сервер и обращается к дополнительным серверам, только если предпочтительный не отвечает. Поэтому ваши DNS-серверы должны быть указаны в правильном порядке для вашей среды.

> [AZURE.NOTE]Если изменить параметры DNS в файле конфигурации развернутой виртуальной сети, потребуется перезапустить каждую виртуальную машину, чтобы изменения вступили в силу.

### Указание DNS-сервера с помощью портала управления

При создании виртуальной сети с помощью портала управления вы можете указать IP-адрес и имена нужных DNS-серверов. После создания виртуальной сети экземпляры ролей и виртуальные машины, которые развертываются в виртуальной сети, автоматически настраиваются в соответствии с указанными параметрами DNS, если вы не указали, какие DNS-серверы следует использовать для развертывания. Дополнительную информацию о настройке параметров виртуальной сети Azure см. в статье [Информация о настройке виртуальной сети на портале управления](https://msdn.microsoft.com/library/azure/jj156074.aspx).

> [AZURE.NOTE]Вы можете использовать не более 9 DNS-серверов.

### Указание DNS-сервера с помощью файлов конфигурации

Можно указать параметры DNS с помощью двух разных файлов конфигурации: файла *конфигурации сети* и файла *конфигурации службы*.

Файл конфигурации сети создается для каждой виртуальной сети, добавленной в Azure. При добавлении экземпляров ролей или виртуальных машин в облачную службу в виртуальной сети параметры DNS из файла конфигурации сети применяются к экземпляру роли или виртуальной машине, если в файле конфигурации службы отсутствуют параметры DNS.

Файл конфигурации службы создается для каждой облачной службы, добавленной в Azure. При добавлении экземпляров ролей или виртуальных машин в облачную службу параметры DNS из файла конфигурации службы применяются к экземпляру роли или виртуальной машине.

> [AZURE.NOTE]Параметры файла конфигурации службы переопределяют параметры файла конфигурации сети. Например, если виртуальная машина добавлена в облачную службу, которая является частью виртуальной сети, а в файлах конфигурации сети и конфигурации службы содержатся параметры DNS, параметры DNS в файле конфигурации службы применяются к виртуальной машине.


## См. также

[Схема конфигурации службы Azure](https://msdn.microsoft.com/library/azure/ee758710) [Схема конфигурации виртуальной сети](https://msdn.microsoft.com/library/azure/jj157100) [О настройке параметров виртуальной сети на портале управления](https://msdn.microsoft.com/library/azure/jj156074.aspx) [Настройка виртуальной сети с помощью файлов конфигурации сети](https://msdn.microsoft.com/library/azure/jj156097.aspx) [Задачи конфигурации виртуальной сети](https://msdn.microsoft.com/library/azure/jj156206.aspx)

<!---HONumber=August15_HO6-->