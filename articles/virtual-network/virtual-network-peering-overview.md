---
title: "Пиринговая связь между виртуальными сетями Azure | Документация Майкрософт"
description: "Сведения о пиринге между виртуальными сетями в Azure."
services: virtual-network
documentationcenter: na
author: NarayanAnnamalai
manager: jefco
editor: tysonn
ms.assetid: eb0ba07d-5fee-4db0-b1cb-a569b7060d2a
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/25/2017
ms.author: narayan;anavin
ms.openlocfilehash: f055f1e87e73733b3f2ecfa87e4d372ade8a7868
ms.sourcegitcommit: c5eeb0c950a0ba35d0b0953f5d88d3be57960180
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/24/2017
---
# <a name="virtual-network-peering"></a>Пиринг между виртуальными сетями

Пиринг виртуальных сетей позволяет эффективно соединить две [виртуальные сети](virtual-networks-overview.md) Azure. После создания пиринговой связи две виртуальные сети выглядят как одна сеть при подключении. Трафик между виртуальными машинами в виртуальных сетях с пиринговой связью направляется через магистральную инфраструктуру Майкрософт, точно так же, как трафик между виртуальными машинами в одной виртуальной сети направляется только через *частные* IP-адреса. 

Преимущества пиринговой связи между виртуальными сетями:

* Сетевой трафик между одноранговыми виртуальными сетями является закрытым. Трафик между виртуальными сетями хранится в магистральной сети Майкрософт. При обмене данными между виртуальными сетями не требуется общий доступ к Интернету, шлюзы или шифрование.
* подключение между ресурсами в разных виртуальных сетях, характеризующееся низкой задержкой и высокой пропускной способностью;
* Возможность взаимодействия ресурсов в одной виртуальной сети с ресурсами в другой виртуальной сети после установки пиринга между виртуальными сетями.
* Эта возможность помогает передавать данные между подписками Azure, моделями развертывания и регионами Azure (предварительная версия).
* Пиринговую связь можно создать между двумя виртуальными сетями, созданными с помощью Azure Resource Manager, или между виртуальной сетью, созданную с помощью Resource Manager, и виртуальной сетью, созданной с помощью классической модели развертывания. Дополнительные сведения о моделях развертывания Azure см. в статье [Развертывание с помощью Azure Resource Manager и классическое развертывание: сведения о моделях развертывания и состоянии ресурсов](../azure-resource-manager/resource-manager-deployment-model.md?toc=%2fazure%2fvirtual-network%2ftoc.json).
* Отсутствие задержки при доступе к ресурсам в любой виртуальной сети при создании пиринга или после его создания.

## <a name="requirements-constraints"></a>Требования и ограничения

* Функция создания пиринговых связей между виртуальными сетями в одном регионе является общедоступной. Функция создания пиринговых связей между виртуальными сетями в разных регионах доступна в предварительной версии в центрально-западной части США, центральной Канаде и западной части США 2. Вы можете [зарегистрировать подписку для использования предварительной версии](virtual-network-create-peering.md).
    > [!WARNING]
    > Пиринги виртуальных сетей, создаваемые в разных регионах, могут не обеспечивать такой же уровень доступности и надежности, как пиринги в общедоступной версии. Пиринги виртуальных сетей могут иметь ограниченные возможности или быть доступными не во всех регионах Azure. Актуальные сведения о доступности и состоянии этой функции см. на странице [обновлений виртуальной сети Azure](https://azure.microsoft.com/updates/?product=virtual-network).

* Для настройки пиринга пространства IP-адресов используемых виртуальных сетей не должны перекрываться.
* Диапазоны адресов нельзя добавить или удалить из адресного пространства или виртуальной сети после установления пиринговой связи с другой виртуальной сетью. Если вам нужно добавить диапазоны адресов в адресное пространство пиринговой виртуальной сети, удалите пиринг, добавьте адресное пространство и добавьте пиринг.
* Пиринговая связь устанавливается между двумя виртуальными сетями. При этом возникновение производной переходной связи не предполагается. Например, если для виртуальной сети A установлена пиринговая связь с виртуальной сетью В, а для виртуальной сети В — с виртуальной сетью С, эта связь *не* преобразуется в пиринговую связь между сетями A и С.
* Пиринговую связь можно установить между виртуальными сетями в двух разных подписках(см. раздел [Разрешения](create-peering-different-deployment-models-subscriptions.md#permissions)), если ее разрешает привилегированный пользователь обеих подписок, а подписки связаны с одним и тем же клиентом Azure Active Directory. С помощью [VPN-шлюза](../vpn-gateway/vpn-gateway-about-vpngateways.md?toc=%2fazure%2fvirtual-network%2ftoc.json#V2V) можно подключать виртуальные сети в подписках, связанных с разными клиентами Active Directory.
* Между виртуальными сетями можно установить пиринговую связь, если обе сети созданы с помощью модели развертывания Resource Manager или в случае, если одна из них создана с помощью модели развертывания Resource Manager, а другая — с помощью классической модели развертывания. Однако установить пиринговую связь между виртуальными сетями, созданными с помощью классической модели развертывания, невозможно. Чтобы связать виртуальные сети, созданные с помощью классической модели развертывания, используйте [VPN-шлюз](../vpn-gateway/vpn-gateway-about-vpngateways.md?toc=%2fazure%2fvirtual-network%2ftoc.json#V2V).
* Для обмена данными между виртуальными машинами в пиринговых виртуальных сетях нет дополнительных ограничений пропускной способности, однако объем передаваемого трафика по-прежнему ограничивается размером виртуальной машины. Дополнительные сведения о максимальной пропускной способности сети для разных размеров виртуальных машин см. в статьях о размерах виртуальных машин для [Windows](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-network%2ftoc.json) или [Linux](../virtual-machines/linux/sizes.md?toc=%2fazure%2fvirtual-network%2ftoc.json).

     ![Базовая пиринговая связь между виртуальными сетями](./media/virtual-networks-peering-overview/figure03.png)

## <a name="connectivity"></a>Соединение

После создания пиринговой связи между виртуальными сетями ресурсы в одной виртуальной сети могут напрямую подключаться к ресурсам в связанной виртуальной сети.

Задержки в сети между виртуальными машинами в пиринговых виртуальных сетях такие же, как и в пределах одной виртуальной сети. Пропускная способность сети зависит от пропускной способности виртуальной машины, которая пропорциональна ее размеру. Дополнительные ограничения пропускной способности при пиринге не применяются.

Трафик между виртуальными машинами в пиринговых виртуальных сетях передается напрямую через магистральную инфраструктуру Майкрософт, а не через шлюз или Интернет.

Виртуальные машины в виртуальной сети могут получать доступ к внутренней подсистеме балансировки нагрузки в пиринговой виртуальной сети, которая находится в том же регионе. Поддержка внутренней подсистемы балансировки нагрузки не распространяется на пиринговые виртуальные сети, которые находятся в разных регионах (этот пиринг доступен в виде предварительной версии). Когда пиринг сетей, находящихся в разных регионах, станет общедоступным, будет реализована поддержка внутренней подсистемы балансировки нагрузки для таких сетей.

Чтобы заблокировать доступ к другим виртуальным сетям или подсетям, в любой виртуальной сети можно использовать группы безопасности сети.
При настройке пиринга можно открыть или закрыть правила группы безопасности сети между виртуальными сетями. При открытии полного подключения между пиринговыми виртуальными сетями (что является параметром по умолчанию) можно применить группы безопасности сети для определенных подсетей или виртуальных машин, чтобы блокировать или запретить доступ к ним. Дополнительные сведения о группах безопасности сети см. в статье [Фильтрация сетевого трафика с помощью групп безопасности сети](virtual-networks-nsg.md).

## <a name="service-chaining"></a>Цепочка служб

Вы можете настроить определяемые пользователем маршруты, указывающие, какие виртуальные машины в пиринговых виртуальных сетях используются для IP-адреса следующего прыжка, чтобы обеспечить цепочку служб. Цепочка служб позволяет направлять трафик из одной виртуальной сети на виртуальное устройство в пиринговой виртуальной сети через определенные пользователем маршруты.

Кроме того, можно создавать среды со звездообразным подключением, в которых в центральной виртуальной сети ("звезде") размещаются инфраструктурные компоненты, например виртуальное сетевое устройство. Все остальные виртуальные сети ("лучи") могут подключаться по пиринговой связи к центральной виртуальной сети. Трафик сможет проходить через виртуальные сетевые устройства, работающие в центральной виртуальной сети. Если вкратце, в определяемой пользователем таблице маршрутизации можно указать для следующего прыжка IP-адрес виртуальной машины, входящей в пиринговую виртуальную сеть. Дополнительные сведения об определяемых пользователем маршрутах см. в статье [Определяемые пользователем маршруты и IP-пересылка](virtual-networks-udr-overview.md). Сведения о создании топологии с центральной и периферийной сетью см. [здесь](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json#virtual network-peering).

## <a name="gateways-and-on-premises-connectivity"></a>Использование шлюзов для локального подключения

Для каждой виртуальной сети, независимо от наличия пиринговой связи с другой виртуальной сетью, можно настроить собственный шлюз, который будет использоваться для подключения к локальной сети. С помощью шлюзов также можно настроить подключение [между виртуальными сетями](../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md), даже если для них установлена пиринговая связь.

Если для виртуальных сетей настроены оба типа подключения, трафик между виртуальными сетями проходит через пиринговую связь (т. е. через магистральную сеть Azure).

Если между виртуальными сетями в одном регионе установлена пиринговая связь, можно также настроить шлюз в одной из этих сетей в качестве транзитного пункта при подключении к локальной сети. В этом случае виртуальная сеть, использующая удаленный шлюз, не может иметь свой собственный. У виртуальной сети может быть только один шлюз. Это может быть локальный или удаленный шлюз (в пиринговой виртуальной сети), как показано на следующем рисунке:

![Транзит в пиринговой виртуальной сети](./media/virtual-networks-peering-overview/figure04.png)

При установке пиринговой связи между виртуальными сетями, которые созданы с помощью разных моделей развертывания или находятся в разных регионах, транзит через шлюз не поддерживается. Транзит через шлюз поддерживается, только если обе пиринговые виртуальные сети созданы с помощью Resource Manager и находятся в одном регионе. Пиринговые виртуальные сети, которые находятся в разных регионах, не поддерживают транзит через шлюз.

Трафик между пиринговыми виртуальными сетями, которые используют одно подключение Azure ExpressRoute, передается по пиринговой связи (т. е. через магистральную сеть Azure). Вы по-прежнему можете использовать в каждой виртуальной сети локальные шлюзы для подключения к локальному каналу. или настроить транзит через общий шлюз для локального подключения.

## <a name="permissions"></a>Разрешения

Пиринговую связь между виртуальными сетями может настроить только привилегированный пользователь. Это отдельная функция в рамках пространства имен виртуальной сети. Пользователю можно предоставить права на авторизацию пиринга. Пользователь, имеющий доступ для чтения и записи к виртуальной сети, автоматически наследует эти права.

Администратор и привилегированный пользователь с правами на настройку пиринговой связи могут инициировать пиринговую связь с другой виртуальной сетью. Минимальный уровень необходимых прав — участник сети. Если на другой стороне есть такой же запрос и другие требования выполняются, пиринговая связь устанавливается.

Например, при создании пиринга между виртуальными сетями myvirtual networkA и myvirtual networkB вашей учетной записи должны быть назначены следующие минимальные роли или разрешения для каждой виртуальной сети:

|Виртуальная сеть|Модель развертывания|Роль|Разрешения|
|---|---|---|---|
|myVirtualNetworkA|Диспетчер ресурсов|[Участник сети](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor)|Microsoft.Network/virtualNetworks/virtualNetworkPeerings/write|
| |Классический|[Участник классической сети](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#classic-network-contributor)|Недоступно|
|myVirtualNetworkB|Диспетчер ресурсов|[Участник сети](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#network-contributor)|Microsoft.Network/virtualNetworks/peer|
||Классический|[Участник классической сети](../active-directory/role-based-access-built-in-roles.md?toc=%2fazure%2fvirtual-network%2ftoc.json#classic-network-contributor)|Microsoft.ClassicNetwork/virtualNetworks/peer|

## <a name="monitor"></a>Монитор

Если пиринговая связь устанавливается между двумя виртуальными сетями, созданными при помощи Resource Manager, ее нужно настроить для каждой из этих виртуальных сетей.
Вы можете отслеживать состояние пирингового подключения. Далее представлены состояния пиринга.

* **Инициировано.** Это состояние отображается при создании пиринговой связи от первой виртуальной сети до второй.

* **Подключено.** Это состояние отображается при создании пиринговой связи от второй виртуальной сети до первой. При этом для первой виртуальной сети значение состояния также изменяется с "Инициировано" на "Подключено". Пиринг не будет установлен, пока его состояние для обеих виртуальных сетей не будет иметь значение "Подключено".

* **Отключено.** Если одна из пиринговых связей удаляется после установки подключения, состояние пиринга принимает это значение.

## <a name="troubleshoot"></a>Устранение неполадок

Чтобы устранить неполадки, связанные с трафиком, который проходит через пиринговое подключение, [проверьте действующие маршруты](virtual-network-routes-troubleshoot-portal.md).

Чтобы устранить неполадки подключения к виртуальной машине в пиринговой виртуальной сети, используйте [проверку подключения](../network-watcher/network-watcher-connectivity-portal.md) службы "Наблюдатель за сетями". Проверка подключения позволяет увидеть, как трафик направляется непосредственно из сетевого интерфейса исходной виртуальной машины в сетевой интерфейс целевой виртуальной машины.

## <a name="limits"></a>Ограничения

Существуют ограничения на число пиринговых связей в одной виртуальной сети. Дополнительные сведения см. в разделе [Ограничения сети — Azure Resource Manager](../azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits).

## <a name="pricing"></a>Цены

За входящий и исходящий трафик по пиринговой связи между виртуальными сетями взимается номинальная плата. Дополнительные сведения см. на [странице с расценками](https://azure.microsoft.com/pricing/details/virtual-network).

## <a name="next-steps"></a>Дальнейшие действия

* Изучите руководство по созданию пиринговой связи между виртуальными сетями. Пиринг виртуальных сетей создается между виртуальными сетями, созданными с помощью тех же или разных моделей развертывания, которые существуют в одной и той же или разных подписках. Изучите руководство одного из следующих сценариев:

    |Модель развертывания Azure  | Подписки  |
    |---------|---------|
    |Обе — диспетчер ресурсов |[Та же](virtual-network-create-peering.md)|
    | |[Разные](create-peering-different-subscriptions.md)|
    |Одна — диспетчер ресурсов, вторая — классическая     |[Та же](create-peering-different-deployment-models.md)|
    | |[Разные](create-peering-different-deployment-models-subscriptions.md)|

* См. сведения о создании [звездообразной топологии сети](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json#virtual network-peering).
* Дополнительные сведения о [параметрах пиринговой связи между виртуальными сетями и о том, как их изменить](virtual-network-manage-peering.md)
