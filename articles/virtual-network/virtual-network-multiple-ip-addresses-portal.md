---
title: "Назначение виртуальным машинам нескольких IP-адресов на портале | Документация Майкрософт"
description: "Сведения о назначении нескольких IP-адресов виртуальной машине с помощью портала Azure."
services: virtual-network
documentationcenter: na
author: anavinahar
manager: narayan
editor: 
tags: azure-resource-manager
ms.assetid: 3a8cae97-3bed-430d-91b3-274696d91e34
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/28/2016
ms.author: annahar
translationtype: Human Translation
ms.sourcegitcommit: 716046d5e23de015da42f25f8a1f674de228efac
ms.openlocfilehash: a04192ffde57ae38d901a78a74724a89f43caedb


---
# <a name="assign-multiple-ip-addresses-to-virtual-machines"></a>Назначение виртуальным машинам нескольких IP-адресов
> [!div class="op_single_selector"]
> * [портале Azure](virtual-network-multiple-ip-addresses-portal.md)
> * [PowerShell](virtual-network-multiple-ip-addresses-powershell.md)
> * [ИНТЕРФЕЙС КОМАНДНОЙ СТРОКИ](virtual-network-multiple-ip-addresses-cli.md)


К виртуальной машине Azure можно подключить один или несколько сетевых интерфейсов. Любой сетевой карте назначается один или несколько общедоступных или частных IP-адресов. Дополнительные сведения об IP-адресах в Azure см. в статье [IP-адреса в Azure](virtual-network-ip-addresses-overview-arm.md). В этой статье объясняется, как с использованием портала Azure назначить виртуальной машине несколько IP-адресов в модели развертывания с помощью Azure Resource Manager.

Назначение нескольких IP-адресов виртуальной машине дает следующие возможности:

* Возможность размещать на одном сервере несколько веб-сайтов или служб с разными IP-адресами и SSL-сертификатами.
* возможность использовать виртуальную машину в качестве виртуального сетевого устройства, такого как брандмауэр или балансировщик нагрузки.
* Возможность добавления любых частных IP-адресов любых сетевых карт во внутренний пул Azure Load Balancer. Раньше во внутренний пул можно было добавить только основной IP-адрес для основной сетевой карты.

[!INCLUDE [virtual-network-preview](../../includes/virtual-network-preview.md)]

Чтобы зарегистрироваться для получения предварительной версии, отправьте сообщение электронной почты с темой [Несколько IP-адресов](mailto:MultipleIPsPreview@microsoft.com?subject=Request%20to%20enable%20subscription%20%3csubscription%20id%3e) , указав идентификатор подписки и описание предполагаемого использования.

## <a name="scenario"></a>Сценарий
В этой статье нужно связать три IP-конфигурации с сетевым интерфейсом.
В следующих примерах конфигурации будут созданы и назначены сетевому интерфейсу с тремя частными IP-адресами и одним назначенным ей общедоступным IP-адресом:

* IPConfig-1 — с динамическим частным IP-адресом (по умолчанию) и общедоступным IP-адресом из ресурса общедоступного IP-адреса с именем PIP1;
* IPConfig-2 — со статическим частным IP-адресом и без общедоступного IP-адреса;
* IPConfig-3 — с динамическим частным IP-адресом и без общедоступного IP-адреса.

    ![Замещающий текст](./media/virtual-network-multiple-ip-addresses-powershell/OneNIC-3IP.png)

В этом сценарии предполагается наличие группы ресурсов под названием *RG1*, в которой есть виртуальная сеть с именем *VNet1* и подсеть с именем *Subnet1*. Кроме того, предполагается наличие виртуальной машины с именем *VM1*, связанного с ней сетевого интерфейса с именем *VM1 NIC1* и общедоступного IP-адреса с именем *PIP1*.

[В этой статье](../virtual-machines/virtual-machines-windows-ps-create.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) рассматривается создание указанных выше ресурсов, если они не были созданы ранее.

## <a name="a-name--createacreate-a-vm-with-multiple-ip-addresses"></a><a name = "create"></a>Создание виртуальной машины с несколькими IP-адресами
Чтобы создать конфигурации с несколькими IP-адресами по описанному выше сценарию, используя портал предварительной версии Azure, выполните описанные ниже действия.

1. В браузере откройте адрес http://portal.azure.com и войдите с помощью учетной записи Azure.
2. Выберите сетевой интерфейс, для которого необходимо добавить IP-конфигурации: **Виртуальные машины** > **VM1** > **Сетевые интерфейсы** > **VM1-NIC1**.
3. В колонке **Сетевой интерфейс** выберите **Конфигурации IP**. Откроется список имеющихся IP-конфигураций.
4. Чтобы связать **PIP1** с **ipconfig1**, в колонке **Конфигурации IP** выберите **ipconfig1**. В колонке **ipconfig1** в разделе **Общедоступный IP-адрес** выберите **Включено**.
5. На вкладке **IP-адрес** выберите **Настроить обязательные параметры**, а затем — **PIP1** или общедоступный IP-адрес, который нужно связать с основной IP-конфигурацией, и щелкните "Сохранить". Вы также можете создать общедоступный IP-адрес и связать его здесь. В этом случае отобразится уведомление о сохранении сетевого интерфейса, по завершении чего **PIP1** будет связан с **ipconfig1**.

    ![Замещающий текст](media\\virtual-network-multiple-ip-addresses-portal\\01-portal.PNG)

    >[!NOTE] 
    > За общедоступные IP-адреса взимается номинальная плата. Дополнительные сведения о ценах на IP-адреса см. на странице [Цены на IP-адреса](https://azure.microsoft.com/pricing/details/ip-addresses).

1. Далее, чтобы добавить IP-конфигурацию, в разделе **Конфигурации IP** сетевого интерфейса щелкните **Добавить**.

   > [!NOTE]
   > Сетевому интерфейсу можно назначить до 250 частных IP-адресов. Количество общедоступных IP-адресов, которые можно использовать в пределах подписки, ограничено. Дополнительные сведения см. в статье [Подписка Azure, границы, квоты и ограничения службы](../azure-subscription-service-limits.md#limits-and-the-azure-resource-manager).
   >
   >
2. В колонке **Добавить IP-конфигурацию** укажите имя IP-конфигурации. В этом случае это **IPConfig-2**. Для параметра **Выделение** укажите значение **Статический** и введите необходимый IP-адрес. В этом случае это 10.0.0.5. Нажмите кнопку **ОК**. После сохранения IP-конфигурации она отобразится в списке.

    ![Замещающий текст](media\\virtual-network-multiple-ip-addresses-portal\\02-portal.PNG)
3. Затем добавьте третью IP-конфигурацию. Для этого в колонке **Конфигурации IP** выберите **Добавить** и заполните необходимые поля, как показано ниже. Нажмите кнопку **ОК**.

    ![Замещающий текст](media\\virtual-network-multiple-ip-addresses-portal\\03-portal.PNG)

    Обратите внимание, что конфигурации IPConfig-2 и IPConfig-3 также можно связать с общедоступным IP-адресом. Для этого в разделе **Общедоступный IP-адрес** колонки **Добавить IP-конфигурацию** выберите **Включено**. С IP-конфигурацией можно связать уже имеющийся общедоступный IP-адрес или новый.
4. Вручную добавьте все частные IP-адреса (включая основные) в конфигурацию TCP/IP в операционной системе, как показано ниже. Чтобы добавить IP-адреса вручную, необходимо подключиться к виртуальной машине и выполнить следующие указания.

**Windows**

1. В командной строке введите *ipconfig /all*.  Отображается только *первичный* частный IP-адрес (через службу DHCP).
2. После этого выполните *ncpa.cpl* в окне командной строки. Откроется новое окно.
3. Откройте свойства **Подключения к локальной сети**.
4. Дважды щелкните "Протокол IP версии 4 (TCP/IPv4)".
5. Выберите **Использовать следующий IP-адрес** и введите следующие значения:

   * **IP-адрес**— *первичный* частный IP-адрес.
   * **Маска подсети**— в зависимости от своей подсети. Например, если подсеть — /24, то маска подсети — 255.255.255.0.
   * **Шлюз по умолчанию**— первый IP-адрес в подсети. Если подсеть — 10.0.0.0/24, то IP-адрес шлюза по умолчанию — 10.0.0.1.
   * Щелкните **Использовать следующие адреса DNS-серверов** и введите следующие значения:
     * **Предпочитаемый DNS-сервер** — 168.63.129.16, если собственный DNS-сервер не используется.  Если используется, введите IP-адрес DNS-сервера.
   * Нажмите кнопку **Дополнительно** и добавьте дополнительные IP-адреса. Добавьте каждый вторичный частный IP-адрес, указанный на шаге 8, для сетевого интерфейса с той же подсетью, которая указана для первичного IP-адреса.
   * Нажмите кнопку **ОК**, чтобы закрыть настройки TCP/IP, а затем нажмите кнопку **ОК** еще раз, чтобы закрыть параметры адаптера. После этого подключение к удаленному рабочему столу будет установлено заново.
6. В командной строке введите *ipconfig /all*. Отобразятся все добавленные IP-адреса, а DHCP будет отключен.

**Linux (Ubuntu)**

1. Откройте окно терминала.
2. Нужно войти с правами привилегированного пользователя. Чтобы стать им, выполните следующую команду:

            sudo -i
3. Обновите файл конфигурации сетевого интерфейса (предполагается "eth0").

   * Сохраните имеющийся элемент строки для DHCP. В результате этого первичный IP-адрес будет настроен так, как он был настроен до этого.
   * Добавьте конфигурацию для дополнительного статического IP-адреса с помощью следующих команд:

               cd /etc/network/interfaces.d/
               ls

       Должен отобразиться CFG-файл.
4. Откройте файл: vi *имя файла*.

    В конце этого файла будут следующие строки:

            auto eth0
            iface eth0 inet dhcp
5. Добавьте следующие строки после имеющихся строк в этом файле:

            iface eth0 inet static
            address <your private IP address here>
6. Сохраните файл с помощью следующей команды:

            :wq
7. Сбросьте сетевой интерфейс, выполнив следующую команду:

           sudo ifdown eth0 && sudo ifup eth0

   > [!IMPORTANT]
   > Если используется удаленное подключение, запустите скрипты ifdown и ifup в одной и той же строке.
   >
   >
8. Проверьте, добавлен ли IP-адрес к сетевому интерфейсу, с помощью следующей команды:

            ip addr list eth0

    Должен отобразиться IP-адрес, добавленный как часть списка.

**Linux (Redhat, CentOS и другие)**

1. Откройте окно терминала.
2. Нужно войти с правами привилегированного пользователя. Чтобы стать им, выполните следующую команду:

            sudo -i
3. Введите пароль и следуйте инструкциям. После того как вы станете привилегированным пользователем, перейдите к сетевой папке скриптов, используя следующую команду:

            cd /etc/sysconfig/network-scripts
4. Выведите список связанных IFCFG-файлов, используя следующую команду:

            ls ifcfg-*

    В списке файлов должен быть файл *ifcfg-eth0* .
5. Скопируйте файл *ifcfg-eth0* и назовите его *ifcfg-eth0:0*, используя следующую команду:

            cp ifcfg-eth0 ifcfg-eth0:0
6. Измените файл *ifcfg-eth0:0* , используя следующую команду:

            vi ifcfg-eth1
7. Измените имя устройства на соответствующее имя в файле, в этом случае на *eth0:0*. Для этого используйте следующую команду:

            DEVICE=eth0:0
8. Измените строку *IPADDR = YourPrivateIPAddress* в соответствии с IP-адресом.
9. Сохраните файл, используя следующую команду:

            :wq
10. Перезапустите сетевые службы и убедитесь, что изменения вступили в силу, выполнив следующие команды:

            /etc/init.d/network restart
            Ipconfig

    В возвращенном списке должен содержаться добавленный IP-адрес — *eth0:0*.

## <a name="a-nameaddaadd-ip-addresses-to-an-existing-vm"></a><a name="add"></a>Добавление IP-адресов в имеющуюся виртуальную машину
Чтобы добавить дополнительные IP-адреса в имеющийся сетевой интерфейс, сделайте следующее:

1. В браузере откройте адрес http://portal.azure.com и войдите с помощью учетной записи Azure.
2. В разделе **Сетевые интерфейсы** выберите сетевой интерфейс, для которого необходимо добавить IP-конфигурации.
3. В колонке **Сетевой интерфейс** выберите **Конфигурации IP**. Откроется список имеющихся IP-конфигураций.
4. Далее, чтобы добавить IP-конфигурацию, в разделе "Конфигурации IP" сетевого интерфейса щелкните **Добавить**.
5. В колонке "Добавить IP-конфигурацию" укажите имя IP-конфигурации. В разделе **Выделение** выберите необходимый тип IP-адреса (статический или динамический). В разделе **Общедоступный IP-адрес** выберите **Включено**, если нужно связать IP-конфигурацию с общедоступным IP-адресом. В противном случае щелкните **Отключено**. Выбрав значение **Включено**, вы сможете связать имеющийся общедоступный IP-адрес со своей конфигурацией. Затем нажмите кнопку "ОК". После сохранения IP-конфигурации она отобразится в списке.



<!--HONumber=Nov16_HO3-->


