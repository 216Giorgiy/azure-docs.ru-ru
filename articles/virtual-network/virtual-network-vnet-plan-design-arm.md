<properties
   pageTitle="Руководство по планированию и проектированию виртуальной сети Azure | Microsoft Azure"
   description="Узнайте, как планировать и проектировать виртуальные сети в Azure на основе требований к изоляции, подключению и расположению."
   services="virtual-network"
   documentationCenter="na"
   authors="jimdial"
   manager="carmonm"
   editor="tysonn" />
<tags
   ms.service="virtual-network"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="02/08/2016"
   ms.author="jdial" />

# Планирование и проектирование виртуальных сетей Azure

Процесс создания виртуальной сети для проведения экспериментов достаточно простой, но, скорее всего, со временем вам понадобится развернуть несколько виртуальных сетей с учетом потребностей вашей организации. Обладая знаниями по планированию и проектированию, вы сможете более эффективно развертывать виртуальные сети и подключать необходимые ресурсы. Если вы не знакомы с работой виртуальных сетей, прежде чем продолжить, рекомендуется прочитать [сведения о виртуальных сетях](virtual-networks-overview.md) и [их развертывании](virtual-networks-create-vnet-arm-pportal.md).

## План

Крайне важно иметь полное представление о подписках, регионах и сетевых ресурсах Azure. В качестве отправной точки можно ознакомиться с общими сведениями ниже. После этого вы сможете определить требования к архитектуре сети.

### Рекомендации

Прежде чем ответить на вопросы по планированию, следует ознакомиться с некоторыми общими сведениями.

- Все, что вы создаете в Azure, состоит из одного или нескольких ресурсов. Виртуальная машина, сетевой адаптер, используемый виртуальной машиной, общедоступный IP-адрес, используемый сетевым адаптером, виртуальная сеть, к которой подключен сетевой адаптер, — это отдельные ресурсы.
- Вы создаете ресурсы в рамках [региона и подписки Azure](https://azure.microsoft.com/regions/#services). Ресурсы можно подключить только к виртуальной сети, которая принадлежит к тому же региону и подписке, что и эти ресурсы.
- Подключить виртуальные сети друг к другу можно с помощью [VPN-шлюза](../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md) Azure. Таким способом можно также подключить виртуальные сети между разными регионами и подписками.
- Подключить виртуальную сеть к локальной сети можно с помощью одного из [вариантов подключения](../vpn-gateway/vpn-gateway-cross-premises-options.md), доступных в Azure.
- Различные ресурсы можно сгруппировать в [группы ресурсов](../resource-group-overview.md#resource-groups), тем самым упрощая управление ресурсами как единым целым. Группа ресурсов может содержать ресурсы из нескольких регионов при условии, что они относятся к одной подписке.

### Определение требований

Используйте вопросы ниже в качестве отправной точки для проектирования сети Azure.

1. Какие расположения Azure будут использоваться для размещения виртуальных сетей?
2. Требуется ли обеспечить обмен данными между этими расположениями Azure?
3. Требуется ли обеспечить обмен данными между вашими виртуальными сетями Azure и локальными центрами обработки данных?
4. Сколько виртуальных машин IaaS, ролей облачных служб и веб-приложений необходимо для вашего решения?
5. Нужно ли изолировать трафик на основе групп виртуальных машин (т. е. интерфейсные веб-серверы и тыловые серверы базы данных)?
6. Нужно ли контролировать поток трафика с помощью виртуальных устройств?
7. Нужны ли пользователям различные наборы разрешений для различных ресурсов Azure?

### Общие сведения о свойствах виртуальных сетей и подсетей

Ресурсы виртуальных сетей и подсетей позволяют определить периметр безопасности для рабочих нагрузок, выполняемых в Azure. Виртуальная сеть характеризуется набором адресных пространств, которые также называются блоками CIDR.

>[AZURE.NOTE] Сетевым администраторам знакомы нотации CIDR. Если вы не знакомы с методом CIDR, [узнайте больше о нем](http://whatismyipaddress.com/cidr).

У виртуальных сетей есть следующие свойства.

|Свойство|Описание|Ограничения|
|---|---|---|
|**name**|Имя виртуальной сети|Строка до 80 символов в длину, которая может содержать буквы, цифры, символы подчеркивания, точки или дефисы. Первый символ — буква или цифра. Последний символ — буква, цифра или символ подчеркивания. Могут использоваться как заглавные, так и строчные буквы.|  
|**location**|Расположение Azure (также называется регионом)|Одно из допустимых расположений Azure.|
|**addressSpace**|Коллекция префиксов адресов, составляющих виртуальную сеть в нотации CIDR.|Массив допустимых блоков адресов CIDR, включая диапазоны общедоступных IP-адресов.|
|**Подсети**|Коллекция подсетей, составляющих виртуальную сеть.|См. таблицу свойств подсети ниже.||
|**dhcpOptions**|Объект, содержащий одно обязательное свойство с именем **dnsServers**.||
|**dnsServers**|Массив DNS-серверов, используемых в виртуальной сети Если сервер не указан, используется внутреннее разрешение имен Azure.|Массив, содержащий не более 10 DNS-серверов, указанных по IP-адресу.| 

Подсеть является дочерним ресурсом виртуальной сети, который помогает определить сегменты адресных пространств в пределах блока CIDR на основе префиксов IP-адресов. Сетевые карты можно добавлять в подсети и подключать к виртуальным машинам, обеспечивая сетевые подключения для различных рабочих нагрузок.

У подсетей есть следующие свойства.

|Свойство|Описание|Ограничения|
|---|---|---|
|**name**|Имя подсети|Строка до 80 символов в длину, которая может содержать буквы, цифры, символы подчеркивания, точки или дефисы. Первый символ — буква или цифра. Последний символ — буква, цифра или символ подчеркивания. Могут использоваться как заглавные, так и строчные буквы.|
|**location**|Расположение Azure (также называется регионом)|Одно из допустимых расположений Azure.|
|**addressPrefix**|Одноадресный префикс, определяющий подсеть в нотации CIDR.|Один блок CIDR, который является частью одного из адресных пространств виртуальной сети.|
|**networkSecurityGroup**|Группа безопасности сети для подсети.|См. раздел [Группы безопасности сети](resource-groups-networking.md#Network-Security-Group).|
|**routeTable**|Таблица маршрутизации подсети.|См. раздел [Определяемый пользователем маршрут](resource-groups-networking.md#Route-table).|
|**ipConfigurations**|Коллекция объектов IP-конфигурации, используемых сетевыми адаптерами, подключенными к подсети|См. раздел [Конфигурации IP](../resource-groups-networking.md#IP-configurations).|

### Разрешение имен

По умолчанию для разрешения имен внутри виртуальной сети и в общедоступном Интернете виртуальная сеть использует [разрешение имен Azure](virtual-networks-name-resolution-for-vms-and-role-instances.md#Azure-provided-name-resolution). Однако при подключении виртуальных сетей к локальным центрам обработки данных для разрешения имен между сетями необходимо указать [собственный DNS-сервер](virtual-networks-name-resolution-for-vms-and-role-instances.md#Name-resolution-using-your-own-DNS-server).

### Ограничения

Перед разработкой решения обязательно ознакомьтесь со всеми [ограничениями, касающимися сетевых служб в Azure](../azure-subscription-service-limits.md#networking-limits). Некоторые ограничения можно увеличить, отправив запрос в службу поддержки.

### Управление доступа на основе ролей

Для управления уровнем доступа отдельных пользователей к различным ресурсам в Azure можно использовать [управление доступа на основе ролей Azure](../active-directory/role-based-access-built-in-roles.md). Таким образом можно разделить работу в команде в зависимости от потребностей ее участников.

Что касается виртуальных сетей, пользователи с ролью **участника сети** имеют полный контроль над ресурсами виртуальной сети диспетчера ресурсов Azure. Аналогичным образом пользователи с ролью **классического участника сети** имеют полный контроль над ресурсами классической виртуальной сети.

>[AZURE.NOTE] Чтобы разделить административные обязанности, можно также [создать свои собственные роли](../active-directory/role-based-access-control-configure.md).

## Проектирование

Так как вы уже знаете ответы на вопросы в разделе [Планирование](#Plan), перед определением ваших виртуальных сетей ознакомьтесь со следующими сведениями.

### Число подписок и виртуальных сетей

В следующих сценариях рекомендуется создание нескольких виртуальных сетей.

- **Виртуальные машины необходимо разместить в разных расположениях в Azure**. Виртуальные сети в Azure являются региональными. Они не могут охватывать несколько расположений. Поэтому для каждого расположения Azure, в котором нужно разместить виртуальные машины, необходима по крайней мере одна виртуальная сеть.
- **Рабочие нагрузки необходимо полностью изолировать друг от друга**. Чтобы изолировать разные рабочие нагрузки друг от друга, можно создать отдельные виртуальные сети. Для них можно использовать одно и то же пространство IP-адресов.
- **Избегайте ограничений платформы**. Как описано в разделе об [ограничениях](#Limits), в одной виртуальной сети может быть не более 2048 виртуальных машин.

Имейте в виду, что ограничения указаны из расчета на один регион и на одну подписку. Это означает, что можно использовать несколько подписок, чтобы увеличить число ресурсов, которые можно хранить в Azure. Для подключения виртуальных сетей в разных подписках можно использовать VPN типа "сеть-сеть" или канал ExpressRoute.

### Шаблоны проектирования для виртуальной сети и подписки

В следующей таблице показано несколько распространенных шаблонов проектирования для использования подписки и виртуальных сетей.

|Сценарий|Схема|Преимущества|Недостатки|
|---|---|---|---|
|Одна подписка, две виртуальные сети на приложение|![Одна подписка](./media/virtual-network-vnet-plan-design-arm/figure1.png)|Всего одна подписка для управления.|Не более 25 приложений на регион Azure. Из-за этого вам нужно больше подписок.|
|Одна подписка и две виртуальные сети на приложение|![Одна подписка](./media/virtual-network-vnet-plan-design-arm/figure2.png)|Используются только две виртуальные сети в рамках одной подписки.|Если приложений слишком много, управление усложняется.|
|Одна подписка на подразделение и две виртуальные сети на приложение|![Одна подписка](./media/virtual-network-vnet-plan-design-arm/figure3.png)|Баланс между числом подписок и виртуальных сетей.|Не более 25 приложений на подразделение (подписку).|
|Одна подписка на подразделение и две виртуальные сети на группу приложений|![Одна подписка](./media/virtual-network-vnet-plan-design-arm/figure4.png)|Баланс между числом подписок и виртуальных сетей.|Приложения должны быть изолированы с помощью подсетей и групп безопасности сети.|


### Количество подсетей

В следующих сценариях рекомендуется создание нескольких подсетей в виртуальной сети.

- **Недостаточно частных IP-адресов для всех сетевых адаптеров в подсети**. Если адресное пространство подсети содержит недостаточно IP-адресов для сетевых адаптеров в подсети, необходимо создать несколько подсетей. Имейте в виду, что в Azure зарезервировано 5 частных IP-адресов в каждой подсети, которые нельзя использовать: первый и последний адреса адресного пространства (для адреса подсети и многоадресной рассылки) и 3 адреса для использования внутри сети (для DHCP и DNS).
- **Безопасность**. Подсети можно использовать для разделения групп виртуальных машин с рабочими нагрузками многоуровневой структуры друг от друга. К этим подсетям можно применить различные [группы сетевой безопасности](virtual-networks-nsg.md#subnets).
- **Гибридное подключение**. VPN-шлюзы и каналы ExpressRoute можно использовать для установки [подключения](../vpn-gateway/vpn-gateway-cross-premises-options.md) между виртуальными сетями, а также для подключения виртуальных сетей к локальным центрам обработки данных. Для VPN-шлюзов и каналов ExpressRoute необходимо создать отдельную подсеть.
- **Виртуальные устройства**. В виртуальной сети Azure можно использовать виртуальные устройства, например брандмауэр, акселератор WAN или VPN-шлюз. При этом необходимо [направлять трафик](virtual-networks-udr-overview.md) в эти устройства и изолировать их в отдельной подсети.

### Шаблоны проектирования для подсети и группы безопасности сети

В следующей таблице приведены некоторые распространенные шаблоны проектирования для использования подсетей.

|Сценарий|Схема|Преимущества|Недостатки|
|---|---|---|---|
|Одна подсеть и группы безопасности сети на один уровень приложения на приложение|![Одна подсеть](./media/virtual-network-vnet-plan-design-arm/figure5.png)|Всего одна подсеть для управления.|Необходимо несколько групп безопасности сети, чтобы изолировать каждое приложение.|
|Одна подсеть на приложение, группы безопасности сети на один уровень приложения|![Подсеть на приложение](./media/virtual-network-vnet-plan-design-arm/figure6.png)|Меньше групп безопасности сети для управления.|Несколько подсетей для управления.|
|Одна подсеть на один уровень приложения, группы безопасности сети на приложение|![Подсеть на один уровень](./media/virtual-network-vnet-plan-design-arm/figure7.png)|Баланс между количеством подсетей и групп безопасности сети.|Не более 100 групп безопасности сети. 50 приложений, если для каждого приложения требуется 2 отдельные группы безопасности сети.|
|Одна подсеть на один уровень приложения на приложение, группы безопасности сети на подсеть|![Подсеть на один уровень на приложение](./media/virtual-network-vnet-plan-design-arm/figure8.png)|Возможно, меньшее количество групп безопасности сети.|Несколько подсетей для управления.|

## Пример проектирования

Чтобы продемонстрировать применение сведений в этой статье на практике, рассмотрим следующий сценарий.

Вы работаете в компании, у которой есть два центра обработки данных в Северной Америке и два — в Европе. Вы определили 6 разных приложений для клиентов, которые требуется перенести в Azure в качестве пилотной программы. Эти приложения поддерживают два различных подразделения. Ниже приведена базовая архитектура для приложений.

- Приложение 1, приложение 2, приложение 3 и приложение 4 — это веб-приложения, размещенные на серверах Linux под управлением Ubuntu. Каждое приложение подключается к отдельному серверу приложений, на котором размещены службы RESTful на серверах Linux. Службы RESTful подключаются к внутренней базе данных MySQL.
- Приложение 5 и приложение 6 — это веб-приложения, размещенные на серверах Windows под управлением Windows Server 2012 R2. Каждое приложение подключается к внутренней базе данных SQL Server.
- Все приложения в настоящее время размещены в одном из центров обработки данных компании в Северной Америке.
- В локальных центрах обработки данных используется адресное пространство 10.0.0.0/8.

Необходимо спроектировать решение виртуальной сети, которое соответствует требованиям ниже.

- Потребление ресурсов в одних подразделениях не должно оказывать влияние на остальные подразделения.
- Следует свести к минимуму количество виртуальных сетей и подсетей, чтобы облегчить управление.
- В каждом подразделении для всех приложений должна использоваться одна виртуальная сеть тестирования и разработки.
- Каждое приложение должно быть размещено в двух центрах обработки данных Azure на разных континентах (Северная Америка и Европа).
- Все приложения должны быть полностью изолированы друг от друга.
- Необходимо, чтобы клиенты могли получать доступ к каждому приложению через Интернет по протоколу HTTP.
- Необходимо, чтобы пользователи, подключенные к локальным центрам обработки данных, могли получать доступ к каждому приложению с помощью зашифрованного туннеля.
- Для подключения к локальным центрам обработки данных следует использовать существующие VPN-устройства.
- Группа сетевых специалистов компании должна иметь полный контроль над конфигурацией виртуальной сети.
- Разработчики в каждом подразделении смогут развертывать виртуальные машины только в существующих подсетях.
- Все приложения будут перенесены в Azure без изменений (извлечение и перемещение).
- Базы данных в каждом расположении необходимо реплицировать в другие расположения Azure один раз в день.
- Каждое приложение должно использовать 5 интерфейсных веб-серверов, два сервера приложений (при необходимости) и два сервера баз данных.

### План

Следует начинать планирование проектирования, ответив на вопросы в разделе [Определение требований](#Define-requirements), как показано ниже.

1. Какие расположения Azure будут использоваться для размещения виртуальных сетей?

	Два расположения в Северной Америке и два — в Европе. Необходимо выбрать их в зависимости от физического расположения существующих локальных центров обработки данных. В этом случае при подключении к Azure из физических расположений задержка будет более низкой.

2. Требуется ли обеспечить обмен данными между этими расположениями Azure?

	Да. Так как необходимо реплицировать базы данных во все расположения.

3. Требуется ли обеспечить обмен данными между вашими виртуальными сетями Azure и локальными центрами обработки данных?

	Да. Так как пользователи, подключенные к локальным центрам обработки данных, должны получать доступ к приложениям через зашифрованный туннель.
 
4. Сколько виртуальных машин IaaS требуется для вашего решения?

	200 виртуальных машин IaaS. Для приложения 1, приложения 2 и приложения 3 требуется по 5 веб-серверов, два сервера приложений и два сервера баз данных. Всего необходимо 9 виртуальных машин IaaS для каждого приложения или 36 виртуальных машин IaaS. Для приложения 5 и приложения 6 требуется по 5 веб-серверов и два сервера баз данных. Всего необходимо 7 виртуальных машин IaaS для каждого приложения или 14 виртуальных машин IaaS. Таким образом, необходимо 50 виртуальных машин IaaS для всех приложений в каждом регионе Azure. Так как нам нужно использовать 4 региона, всего необходимо 200 виртуальных машин IaaS.

	Вам также понадобится указать DNS-серверы в каждой виртуальной сети или в ваших локальных центрах обработки данных для разрешения имен между виртуальными машинами IaaS и локальной сетью Azure.

5. Нужно ли изолировать трафик на основе групп виртуальных машин (т. е. интерфейсные веб-серверы и тыловые серверы базы данных)?

	Да. Все приложения, в том числе все уровни приложений, должны быть полностью изолированы друг от друга.

6. Нужно ли контролировать поток трафика с помощью виртуальных устройств?

	Нет. Виртуальные устройства можно использовать для предоставления большего контроля над потоком трафика, включая подробное ведение журнала данных.

7. Нужны ли пользователям различные наборы разрешений для различных ресурсов Azure?

	Да. Сетевым специалистам необходим полный контроль над параметрами виртуальных сетей, а разработчикам требуется контроль только над развертыванием своих виртуальных машин в уже существующих подсетях.

### Проектирование

При проектировании необходимо указывать подписки, виртуальные сети, подсети и группы безопасности сети. Здесь мы рассмотрим группы безопасности сети, но, прежде чем завершить проектирование, вам необходимо узнать больше о [группах безопасности сети](virtual-networks-nsg.md).

**Число подписок и виртуальных сетей**

Ниже приведены требования, касающиеся подписок и виртуальных сетей.

- Потребление ресурсов в одних подразделениях не должно оказывать влияние на остальные подразделения.
- Следует свести к минимуму количество виртуальных сетей и подсетей.
- В каждом подразделении для всех приложений должна использоваться одна виртуальная сеть тестирования и разработки.
- Каждое приложение должно быть размещено в двух центрах обработки данных Azure на разных континентах (Северная Америка и Европа).

Согласно этим требованиям вам необходима подписка для каждого подразделения. Таким образом, потребление ресурсов в других подразделениях не будет влиять на другие подразделения. Так как требуется свести к минимуму число виртуальных сетей, рекомендуется использовать шаблон **одна подписка на подразделение и две виртуальные сети на группу приложений**, как показано ниже.

![Одна подписка](./media/virtual-network-vnet-plan-design-arm/figure9.png)

Необходимо также указать адресное пространство для каждой виртуальной сети. Так как вам необходимо установить подключение между локальными центрами обработки данных и регионами Azure, адресное пространство, используемое для виртуальных сетей Azure, не может пересекаться с локальной сетью, а адресное пространство, применяемое каждой виртуальной сетью, — с другими существующими виртуальными сетями. Для выполнения этих требований можно использовать адресные пространства, указанные в таблице ниже.

|**Подписка**|**Виртуальная сеть**|**Регион Azure**|**Пространство адресов**|
|---|---|---|---|
|Подразделение 1|ProdBU1US1|Запад США|172\.16.0.0/16|
|Подразделение 1|ProdBU1US2|Восток США|172\.17.0.0/16|
|Подразделение 1|ProdBU1EU1|Северная Европа|172\.18.0.0/16|
|Подразделение 1|ProdBU1EU2|Западная Европа|172\.19.0.0/16|
|Подразделение 1|TestDevBU1|Запад США|172\.20.0.0/16|
|Подразделение 2|TestDevBU2|Запад США|172\.21.0.0/16|
|Подразделение 2|ProdBU2US1|Запад США|172\.22.0.0/16|
|Подразделение 2|ProdBU2US2|Восток США|172\.23.0.0/16|
|Подразделение 2|ProdBU2EU1|Северная Европа|172\.24.0.0/16|
|Подразделение 2|ProdBU2EU2|Западная Европа|172\.25.0.0/16|

**Количество подсетей и групп безопасности сети**

Ниже приведены требования, касающиеся подсетей и групп безопасности сети.

- Следует свести к минимуму количество виртуальных сетей и подсетей.
- Все приложения должны быть полностью изолированы друг от друга.
- Необходимо, чтобы клиенты могли получать доступ к каждому приложению через Интернет по протоколу HTTP.
- Необходимо, чтобы пользователи, подключенные к локальным центрам обработки данных, могли получать доступ к каждому приложению с помощью зашифрованного туннеля.
- Для подключения к локальным центрам обработки данных следует использовать существующие VPN-устройства.
- Базы данных в каждом расположении необходимо реплицировать в другие расположения Azure один раз в день.

Согласно этим требованиям вы можете использовать одну подсеть на каждом уровне приложения и группы безопасности сети для фильтрации трафика в каждом приложении. Таким образом, в каждой виртуальной сети (интерфейсная часть, уровень приложения и уровень данных) есть три подсети, а в каждой подсети — одна группа безопасности сети на приложение. В этом случае рекомендуется использовать шаблон проектирования **одна подсеть на один уровень приложения, группы безопасности сети на приложение**. На рисунке ниже показано использование шаблона проектирования для виртуальной сети **ProdBU1US1**.

![Одна подсеть на один уровень, одна группа безопасности сети на приложение и на уровень](./media/virtual-network-vnet-plan-design-arm/figure11.png)

Тем не менее, вам также потребуется создать дополнительную подсеть для VPN-подключения между виртуальными сетями и локальными центрами обработки данных. Необходимо указать адресное пространство для каждой подсети. На рисунке ниже показан пример решения для виртуальной сети **ProdBU1US1**. Вы будете реплицировать этот сценарий для каждой виртуальной сети. Каждый цвет соответствует одному приложению.

![Пример виртуальной сети](./media/virtual-network-vnet-plan-design-arm/figure10.png)

**Контроль доступа**

Ниже приведены требования, касающиеся подписок и контроля доступа.

- Группа сетевых специалистов компании должна иметь полный контроль над конфигурацией виртуальной сети.
- Разработчики в каждом подразделении смогут развертывать виртуальные машины только в существующих подсетях.

Согласно этим требованиям вы сможете назначать сотрудникам группы сетевых специалистов встроенную роль **участника сети** в рамках каждой подписки, а также создавать пользовательские роли для разработчиков приложений в рамках каждой подписки, предоставляя им права на добавление виртуальных машин в существующую подсеть.

## Дальнейшие действия

- См. дополнительные сведения о [развертывании виртуальной сети](virtual-networks-create-vnet-arm-template-click.md) на основе сценария.
- См. дополнительные сведения о [балансировке нагрузки](../load-balancer/load-balancer-overview.md) виртуальных машин IaaS и [управлении маршрутизацией в нескольких регионах Azure](../traffic-manager/traffic-manager-overview.md).
- См. дополнительные сведения о [группах безопасности сети, а также о планировании и проектировании](virtual-networks-nsg.md) решения NSG.
- См. дополнительные сведения о [возможностях подключения к виртуальной сети и между организациями](../vpn-gateway/vpn-gateway-cross-premises-options.md).

<!---HONumber=AcomDC_0810_2016-->