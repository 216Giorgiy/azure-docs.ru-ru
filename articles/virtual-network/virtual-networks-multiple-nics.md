<properties 
   pageTitle="Создание виртуальной машины с несколькими сетевыми адаптерами"
   description="Создание виртуальных машин с несколькими сетевыми адаптерами"
   services="virtual-network, virtual-machines"
   documentationCenter="na"
   authors="telmosampaio"
   manager="adinah"
   editor="tysonn" />
<tags 
   ms.service="virtual-network"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="04/30/2015"
   ms.author="telmos" />

# Создание виртуальной машины с несколькими сетевыми адаптерами

Поддержка нескольких сетевых адаптеров позволяет создавать и использовать на виртуальных машинах Azure несколько карт сетевого интерфейса. Такая возможность необходима для целого ряда сетевых устройств (например, в составе решений для доставки приложений и оптимизации работы глобальной сети). Поддержка нескольких сетевых адаптеров также обеспечивает доступ к дополнительным функциям управления сетевым трафиком, включая изоляцию трафика между интерфейсным и внутренним адаптерами либо разделение трафика данных и трафика управления.

![Несколько сетевых адаптеров на виртуальной машине](./media/virtual-networks-multiple-nics/IC757773.png)

На иллюстрации выше показана виртуальная машина с тремя сетевыми адаптерами, каждый из которых подключен к отдельной подсети.

## Требования и ограничения

В настоящее время с использованием нескольких сетевых адаптеров связаны перечисленные ниже требования и ограничения.

- Виртуальные машины с несколькими сетевыми адаптерами должны создаваться в виртуальных сетях Azure. Виртуальные машины за пределами таких сетей не поддерживаются. 
- В пределах одной облачной службы доступны только перечисленные ниже возможности. 
	- Для каждой виртуальной машине в облачной службе должна быть включена поддержка нескольких сетевых адаптеров. 
	- На каждой виртуальной машине в облачной службе должен быть только один сетевой адаптер. 

>[AZURE.IMPORTANT]При попытке добавить виртуальную машину с несколькими сетевыми адаптерами в развернутую облачную службу, в которой уже есть виртуальная машина с одним адаптером (или наоборот), появится сообщение о том, что в пределах одной развернутой службы не поддерживается возможность одновременного использования виртуальных машин с дополнительным сетевым интерфейсом и без него, а кроме того, добавить дополнительный интерфейс на виртуальную машину без него или удалить дополнительный интерфейс с машины, на которой он есть, невозможно.
 
- Виртуальные IP-адреса с выходом в Интернет поддерживаются только на сетевых адаптерах, доступных по умолчанию. IP-адресу сетевого интерфейса по умолчанию соответствует только один виртуальный IP-адрес. 
- В настоящее время для виртуальных машин с несколькими сетевыми адаптерами не поддерживаются общедоступные IP-адреса уровня экземпляра. 
- Порядок сетевых адаптеров внутри ВМ определяется случайным образом и может измениться по мере обновления инфраструктуры Azure. При этом соответствие между IP-адресами и MAC-адресами Ethernet не нарушится. Например, предположим, что интерфейсу **Eth1** соответствует IP-адрес 10.1.0.100 и MAC-адрес 00-0D-3A-B0-39-0D; после обновления инфраструктуры Azure и перезагрузки название интерфейса может измениться на Eth2, однако пара IP- и MAC-адреса останется прежней. Если перезагрузка инициируется пользователем, порядок сетевых адаптеров не меняется. 
- Адрес каждого сетевого адаптера на каждой виртуальной машине должен быть расположен в подсети; нескольким сетевым адаптерам на одной виртуальной машине можно назначить адреса из одной подсети. 
- Количество сетевых адаптеров, которые можно создать для виртуальной машины, определяется ее размером. В таблице ниже указано количество сетевых адаптеров, соответствующих каждому из размеров. 

|Размер виртуальной машины (номера SKU уровня Standard)|Сетевые адаптеры (макс. количество на одной машине)|
|---|---|
|Все размеры Basic|1|
|A0\очень малый|1|
|A1\малый|1|
|A2\средний|1|
|A3\большой|2|
|A4\очень большой|4.|
|A5|1|
|A6|2|
|A7|4.|
|A8|2|
|A9|4.|
|A10|2|
|A11|4.|
|D1|1|
|D2|2|
|D3|4.|
|D4|8|
|D11|2|
|D12|4.|
|D13|8|
|D14|16|
|DS1|1|
|DS2|2|
|DS3|4.|
|DS4|8|
|DS11|2|
|DS12|4.|
|DS13|8|
|DS14|16|
|G1|1|
|G2|2|
|G3|4.|
|G4|8|
|G5|16|
|Все остальные размеры|1|

## группы сетевой безопасности;
Любой сетевой адаптер на виртуальной машине может быть связан с группой безопасности сети (NSG), включая адаптеры на виртуальных машинах с поддержкой функции нескольких адаптеров. Если сетевому адаптеру назначен адрес в подсети, которая связана с NSG, правила этой NSG распространяются и на соответствующий адаптер. С NSG можно связывать не только подсети, но и отдельные сетевые адаптеры.

Если подсеть связана с NSG, а сетевой адаптер в этой подсети также связан с NSG, то соответствующие правила NSG применяются «в порядке прохождения» трафика, передаваемого через сетевой адаптер в том или ином направлении.

- **Входящий трафик**, направляемый на соответствующий сетевой адаптер, сначала проходит через подсеть, вызывая срабатывание правил NSG этой подсети, а затем поступает на адаптер, где к нему применяются правила NSG этого адаптера. - **Исходящий трафик**, направляемый с соответствующего сетевого адаптера, сначала выходит из этого адаптера, вызывая срабатывание правил связанной с ним NSG, а затем проходит через подсеть, где к нему применяются правила NSG этой подсети. 

На рисунке выше проиллюстрировано применение правил NSG с учетом направления трафика (с виртуальной машины в подсеть или обратно).

## Настройка виртуальной машины с несколькими сетевыми адаптерами

С помощью приведенных ниже инструкций вы сможете создать виртуальную машину с тремя сетевыми адаптерами: одним по умолчанию и двумя дополнительными. На соответствующих этапах настройки создается виртуальная машина, параметры которой соответствуют приведенному ниже фрагменту файла конфигурации службы.

	<VirtualNetworkSite name="MultiNIC-VNet" Location="North Europe">
	<AddressSpace>
	  <AddressPrefix>10.1.0.0/16</AddressPrefix>
	    </AddressSpace>
	    <Subnets>
	      <Subnet name="Frontend">
	        <AddressPrefix>10.1.0.0/24</AddressPrefix>
	      </Subnet>
	      <Subnet name="Midtier">
	        <AddressPrefix>10.1.1.0/24</AddressPrefix>
	      </Subnet>
	      <Subnet name="Backend">
	        <AddressPrefix>10.1.2.0/23</AddressPrefix>
	      </Subnet>
	      <Subnet name="GatewaySubnet">
	        <AddressPrefix>10.1.200.0/28</AddressPrefix>
	      </Subnet>
	    </Subnets>
	… Skip over the remainder section …
	</VirtualNetworkSite>


Для выполнения команд PowerShell из этого примера необходимы перечисленные ниже компоненты.

- Подписка Azure.
- Настроенная виртуальная сеть. Дополнительные сведения о виртуальных сетях см. в статье [Общие сведения о виртуальных сетях](https://msdn.microsoft.com/library/azure/jj156007.aspx).
- Загруженная и установленная последняя версия Azure PowerShell. См. статью [Установка и настройка Azure PowerShell](../install-configure-powershell).

1. Выберите образ виртуальной машины в коллекции образов Azure. Обратите внимание на то, что образы часто меняются, а их доступность зависит от региона. Образ, указанный в примере ниже, может быть изменен либо недоступен в вашем регионе, поэтому выберите подходящий образ. 

	    $image = Get-AzureVMImage `
	    	-ImageName "a699494373c04fc0bc8f2bb1389d6106__Windows-Server-2012-R2-201410.01-en.us-127GB.vhd"

1. Создайте конфигурацию виртуальной машины.

		$vm = New-AzureVMConfig -Name "MultiNicVM" -InstanceSize "ExtraLarge" `
			-Image $image.ImageName –AvailabilitySetName "MyAVSet"

1. Создайте имя входа по умолчанию для администратора.

		Add-AzureProvisioningConfig –VM $vm -Windows -AdminUserName "<YourAdminUID>" `
			-Password "<YourAdminPassword>"

1. Добавьте в конфигурацию виртуальной машины дополнительные сетевые адаптеры.

		Add-AzureNetworkInterfaceConfig -Name "Ethernet1" `
			-SubnetName "Midtier" -StaticVNetIPAddress "10.1.1.111" -VM $vm 
		Add-AzureNetworkInterfaceConfig -Name "Ethernet2" `
			-SubnetName "Backend" -StaticVNetIPAddress "10.1.2.222" -VM $vm

1. Укажите подсеть и IP-адрес сетевого адаптера по умолчанию.

		Set-AzureSubnet -SubnetNames "Frontend" -VM $vm Set-AzureStaticVNetIP  `
			-IPAddress "10.1.0.100" -VM $vm

1. Создайте виртуальную машину в своей виртуальной сети.

		New-AzureVM -ServiceName "MultiNIC-CS" –VNetName "MultiNIC-VNet" –VMs $vm

>[AZURE.NOTE]Указанная здесь виртуальная сеть должна уже существовать (это оговорено в необходимых условиях). В примере ниже задана виртуальная сеть под названием MultiNIC-VNet.

## См. также

[Обзор виртуальной сети](https://msdn.microsoft.com/library/azure/jj156007.aspx)

[Задачи конфигурации виртуальной сети](https://msdn.microsoft.com/library/azure/jj156206.aspx)

[Запись в блоге: виртуальные машины с несколькими сетевыми адаптерами и виртуальные сети в среде Azure](../multiple-vm-nics-and-network-virtual-appliances-in-azure)

<!---HONumber=58--> 