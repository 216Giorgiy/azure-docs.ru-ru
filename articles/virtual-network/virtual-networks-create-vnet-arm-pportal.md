---
title: Создание виртуальной сети Azure с несколькими подсетями с помощью портала | Документация Майкрософт
description: Сведения о создании виртуальной сети с несколькими подсетями с помощью портала Azure.
services: virtual-network
documentationcenter: ''
author: jimdial
manager: jeconnoc
editor: ''
tags: azure-resource-manager
ms.assetid: ''
ms.service: virtual-network
ms.devlang: na
ms.topic: ''
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/01/2018
ms.author: jdial
ms.custom: ''
ms.openlocfilehash: 898bdef779282d7312c76696f744b97ec2dfcded
ms.sourcegitcommit: a0be2dc237d30b7f79914e8adfb85299571374ec
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2018
ms.locfileid: "29880484"
---
# <a name="create-a-virtual-network-with-multiple-subnets-using-the-azure-portal"></a>Создание виртуальной сети с несколькими подсетями с помощью портала Azure

Виртуальная сеть позволяет разным типам ресурсов Azure обмениваться данными друг с другом в частном порядке и взаимодействовать через Интернет. Создание нескольких подсетей в виртуальной сети помогает сегментировать сеть, чтобы вы могли фильтровать потоки трафика между подсетями и управлять ими. В этой статье раскрываются следующие темы:

> [!div class="checklist"]
> * Создать виртуальную сеть
> * Создание подсети
> * Тестирование взаимодействия по сети между виртуальными машинами

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="log-in-to-azure"></a>Вход в Azure 

Войдите на портал Azure по адресу http://portal.azure.com.

## <a name="create-a-virtual-network"></a>Создать виртуальную сеть

1. Выберите **+ Создать ресурс** в верхнем левом углу окна портала Azure.
2. Щелкните **Сеть** и выберите **Виртуальная сеть**.
3. Как показано на изображении ниже, введите *myVirtualNetwork* в поле **Имя**, *10.0.0.0/16* в поле **Адресное пространство**, **myResourceGroup** в поле **Группа ресурсов**, *Общая* в поле **Имя** для подсети, 10.0.0.0/24 в поле **Диапазон адресов** для подсети, затем укажите **расположение** и **подписку**, выберите оставшиеся значения по умолчанию и щелкните **Создать**:

    ![Создать виртуальную сеть](./media/virtual-networks-create-vnet-arm-pportal/create-virtual-network.png)

    **Адресное пространство** и **диапазон адресов** указываются в нотации CIDR. Указанное **адресное пространство** содержит IP-адреса 10.0.0.0–10.0.255.254. Значение **диапазона адресов**, заданное для подсети, должно быть в пределах **адресного пространства**, определенного для виртуальной сети. Azure DHCP назначает ресурсам, развертываемым в подсети, IP-адреса на основе диапазона адресов подсети. Azure назначает ресурсам, развертываемым в **общей** подсети, только адреса 10.0.0.4–10.0.0.254, так как первые четыре адреса (10.0.0.0–10.0.0.3 для подсети в этом примере) и последний адрес (в этом примере — 10.0.0.255) зарезервированы в каждой подсети.

## <a name="create-a-subnet"></a>Создание подсети

1. В поле **Search resources, services, and docs** (Поиск ресурсов, служб и документов) в верхней части портала введите *myVirtualNetwork*. Когда в результатах поиска появится пункт **myVirtualNetwork**, выберите его.
2. Выберите **Подсети**, а затем выберите **+ Подсеть**, как показано на следующем рисунке:

     ![Добавление подсети](./media/virtual-networks-create-vnet-arm-pportal/add-subnet.png)
     
3. В открывшееся поле **Добавление подсети** введите *Частная* для **имени** и *10.0.1.0/24* — для **диапазона адресов**, а затем нажмите кнопку **ОК**.  Диапазон адресов подсети не должен перекрываться диапазонами адресов других подсетей в виртуальной сети. 

Прежде чем развертывать виртуальные сети и подсети Azure для использования в рабочей среде, мы рекомендуем внимательно ознакомиться с [рекомендациями по использованию адресного пространства](manage-virtual-network.md#create-a-virtual-network) и [ограничениями виртуальной сети](../azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits). После развертывания ресурсов в подсетях для некоторых изменений виртуальной сети и подсети, например изменений диапазонов адресов, может потребоваться повторно развернуть существующие ресурсы Azure, которые были развернуты в подсетях.

## <a name="test-network-communication"></a>Тестирование взаимодействия по сети

Виртуальная сеть позволяет разным типам ресурсов Azure обмениваться данными друг с другом в частном порядке и взаимодействовать через Интернет. Одним из таких ресурсов, который можно развернуть в виртуальной сети, является виртуальная машина. Создайте в виртуальной сети две виртуальные машины, чтобы в дальнейшем можно было проверить обмен данными между ними по сети и через Интернет.

### <a name="create-virtual-machines"></a>Создание виртуальных машин

1. Выберите **+ Создать ресурс** в верхнем левом углу окна портала Azure.
2. Выберите **Вычисления**, а затем — **Windows Server 2016 Datacenter**. Вы можете выбрать другую ОС, однако в оставшейся части этого руководства предполагается, что выбрано **Windows Server 2016 Datacenter**. 
3. Выберите или введите следующие сведения в поле **Основные сведения**, а затем нажмите кнопку **ОК**.
    - **Имя**. Укажите *myVmWeb*.
    - **Группа ресурсов**. Установите флажок **Использовать существующий** и выберите *myResourceGroup*.
    - **Расположение**. Выберите *Восточная часть США*.

    Введенные **имя пользователя** и **пароль** понадобятся позже. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm). Выбранные **расположение** и **подписка** должны совпадать с расположением и подпиской виртуальной сети. Не обязательно выбирать группу ресурсов, в которой была создана виртуальная сеть, но в данном руководстве используется эта группа ресурсов.
4. Выберите размер виртуальной машины в области **Выбор размера**.
5. Выберите или введите следующие сведения в поле **Параметры**, а затем нажмите кнопку **ОК**.
    - **Виртуальная сеть**. Убедитесь, что выбрана сеть **myVirtualNetwork**. В противном случае выберите **Виртуальная сеть**, а затем в разделе **Выбор виртуальной сети** выберите **myVirtualNetwork**.
    - **Подсеть**. Убедитесь, что выбрана **общая** подсеть. В противном случае выберите **Подсеть**, а затем в разделе **Выбор подсети** выберите **Общая**, как показано на следующем рисунке.
    
        ![Параметры виртуальной машины](./media/virtual-networks-create-vnet-arm-pportal/virtual-machine-settings.png)
 
6. В разделе **создания** на странице **Сводка** выберите **Создать**, чтобы начать развертывание виртуальной машины.
7. Снова выполните шаги 1–6. Только в поле **имени** виртуальной машины введите *myVmMgmt* и выберите **Частная** для **подсети**.

Создание виртуальных машин занимает несколько минут. Прежде чем выполнять оставшиеся шаги, обязательно дождитесь создания обеих виртуальных машин.

Виртуальные машины, создаваемые в этой статье, имеют один [сетевой интерфейс](virtual-network-network-interface.md) с одним динамически назначенным IP-адресом. Развернув виртуальную машину, вы можете [добавить несколько общедоступных и частных IP-адресов или изменить способ назначения IP-адреса на статический](virtual-network-network-interface-addresses.md#add-ip-addresses). Вы можете [добавлять сетевые интерфейсы](virtual-network-network-interface-vm.md#vm-add-nic) в количестве, поддерживаемом [размером виртуальной машины](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-network%2ftoc.json), который вы выбрали при ее создании. Вы также можете [включить виртуализацию операций ввода-вывода с единым корнем (SR-IOV)](create-vm-accelerated-networking-powershell.md) для виртуальной машины, но только если размер создаваемой виртуальной машины поддерживает такую возможность.

### <a name="communicate-between-virtual-machines-and-with-the-internet"></a>Обмен данными между виртуальными машинами и через Интернет

1. В поле *поиска* в верхней части портала введите *myVmMgmt*. Когда виртуальная машина **myVmMgmt** появится в результатах поиска, выберите ее.
2. Подключите удаленный рабочий стол к виртуальной машине *myVmMgmt*, выбрав **Подключить**, как показано на следующем рисунке:

    ![Подключение к виртуальной машине](./media/virtual-networks-create-vnet-arm-pportal/connect-to-virtual-machine.png)  

3. Чтобы подключиться к виртуальной машине, откройте скачанный RDP-файл. При появлении запроса выберите **Подключиться**.
4. Введите имя пользователя и пароль, указанный при создании виртуальной машины, а затем нажмите кнопку **ОК**. (Возможно, нужно будет выбрать **Дополнительные варианты** и **Использовать другую учетную запись**, чтобы указать учетные данные, введенные при создании виртуальной машины.)
5. При входе в систему может появиться предупреждение о сертификате. Чтобы продолжить процесс подключения, выберите **Да**.
6. В дальнейшем для обмена данными между виртуальными машинами *myVmMgmt* и *myVmWeb* будет использоваться проверка связи. При проверке связи используется протокол ICMP, который брандамауэр Windows отклоняет по умолчанию. Включите протокол ICMP через брандмауэр Windows, введя в командной строке следующую команду:

    ```
    netsh advfirewall firewall add rule name=Allow-ping protocol=icmpv4 dir=in action=allow
    ```

    Хотя проверка связи используется в этой статье, мы не рекомендуем разрешать протокол ICMP через брандмауэр Windows в рабочей среде.
7. Часто в целях безопасности ограничивается число виртуальных машин, к которым могут устанавливаться удаленные подключения в виртуальной сети. В этом руководстве виртуальная машина *myVmMgmt* используется для управления виртуальной машиной *myVmWeb* в виртуальной сети. Чтобы подключиться к удаленному рабочему столу виртуальной машины *myVmWeb* из виртуальной машины *myVmMgmt*, в командной строке введите следующую команду:

    ``` 
    mstsc /v:myVmWeb
    ```
8. Для обмена данными между виртуальными машинами *myVmMgmt* и *myVmWeb*, введите в командной строке следующую команду:

    ```
    ping myvmmgmt
    ```

    Вы получите результат, аналогичный приведенному ниже.
    
    ```
    Pinging myvmmgmt.dar5p44cif3ulfq00wxznl3i3f.bx.internal.cloudapp.net [10.0.1.4] with 32 bytes of data:
    Reply from 10.0.1.4: bytes=32 time<1ms TTL=128
    Reply from 10.0.1.4: bytes=32 time<1ms TTL=128
    Reply from 10.0.1.4: bytes=32 time<1ms TTL=128
    Reply from 10.0.1.4: bytes=32 time<1ms TTL=128
    
    Ping statistics for 10.0.1.4:
        Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
    Approximate round trip times in milli-seconds:
        Minimum = 0ms, Maximum = 0ms, Average = 0ms
    ```
      
    Как видите, адрес виртуальной машины *myVmMgmt* — 10.0.1.4. Это первый доступный IP-адрес в диапазоне адресов *частной* подсети, в которой вы развернули виртуальную машину *myVmMgmt* на предыдущем шаге.  Как видите, полное доменное имя виртуальной машины — *myvmmgmt.dar5p44cif3ulfq00wxznl3i3f.bx.internal.cloudapp.net*. Хотя часть доменного имени *dar5p44cif3ulfq00wxznl3i3f* отличается для виртуальной машины, остальные части одинаковы. 

    По умолчанию все виртуальные машины Azure используют службу Azure DNS. Все виртуальные машины в виртуальной сети могут разрешать имена других виртуальных машин в той же виртуальной сети, используя службу Azure DNS по умолчанию. Вместо этой службы вы можете использовать свой DNS-сервер или возможность размещения частного домена, которую предоставляет служба Azure DNS. Дополнительные сведения см. в разделе [Разрешение имен с помощью собственного DNS-сервера](virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) или в статье [Использование Azure DNS для частных доменов](../dns/private-dns-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json).

9. Чтобы установить службы Internet Information Services (IIS) для Windows Server на виртуальной машине *myVmWeb*, введите следующую команду в сеансе PowerShell:

    ```powershell
    Install-WindowsFeature -name Web-Server -IncludeManagementTools
    ```

10. Когда установка служб IIS завершится, отключите сеанс удаленного рабочего стола *myVmWeb*, после чего вы останетесь в сеансе удаленного рабочего стола *myVmMgmt*. Откройте веб-браузер и перейдите по адресу http://myvmweb. Появится страница приветствия служб IIS.
11. Отключите сеанс удаленного рабочего стола *myVmMgmt*.
12. Найдите общедоступный IP-адрес виртуальной машины *myVmWeb*. При создании виртуальной машины *myVmWeb* в Azure также был создан и назначен виртуальной машине общедоступный IP-адрес ресурса с именем *myVmWeb*. На рисунке на шаге 2 показано, что для виртуальной машины *myVmMgmt* назначен **общедоступный IP-адрес** 52.170.5.92. Чтобы найти общедоступный IP-адрес, назначенный для виртуальной машины *myVmWeb*, на портале в поле поиска введите *myVmWeb*, а затем выберите этот адрес в результатах поиска.

    Хотя виртуальной машине не обязательно иметь общедоступный IP-адрес, Azure по умолчанию назначает его каждой виртуальной машине, которую вы создаете. Чтобы подключиться к виртуальной машине через Интернет, ей нужно назначить общедоступный IP-адрес. Все виртуальные машины могут устанавливать исходящие подключения к Интернету, независимо от того, назначен ли им общедоступный IP-адрес. См. дополнительные сведения об [исходящих интернет-подключениях в Azure](../load-balancer/load-balancer-outbound-connections.md?toc=%2fazure%2fvirtual-network%2ftoc.json).
13. На своем компьютере перейдите по общедоступному IP-адресу виртуальной машины *myVmWeb*. Попытка просмотреть страницу приветствия служб IIS на вашем компьютере завершится ошибкой. Это происходит потому, что при развертывании виртуальной машины в Azure по умолчанию создается группа безопасности сети для каждой виртуальной машины. 

     В этой группе содержатся правила безопасности, которые разрешают или запрещают исходящий и входящий сетевой трафик по портам или IP-адресам. Сетевая группа безопасности по умолчанию, созданная Azure, поддерживает взаимодействие между ресурсами через все порты в одной виртуальной сети. Для виртуальных машин Windows группа безопасности сети по умолчанию отклоняет весь входящий трафик из Интернета на всех портах, кроме TCP-порта 3389 (RDP). В результате, по умолчанию вы также можете подключиться по протоколу RDP напрямую к виртуальной машине *myVmWeb* из Интернета, даже если порт 3389 может не быть открытым для веб-сервера. Так как для просмотра веб-страниц используется порт 80, подключение через Интернет завершится сбоем из-за того, что в группе безопасности сети по умолчанию нет такого правила, которое разрешает прохождение трафика через порт 80.

## <a name="clean-up-resources"></a>Очистка ресурсов

Удалите группу ресурсов и все содержащиеся в ней ресурсы, когда она станет не нужна. 

1. В поле **Поиск** в верхней части портала введите *myResourceGroup*. Когда группа ресурсов **myResourceGroup** появится в результатах поиска, выберите ее.
2. Выберите **Удалить группу ресурсов**.
3. Введите *myResourceGroup* в поле **TYPE THE RESOURCE GROUP NAME:** (Введите имя группы ресурсов:) и нажмите кнопку **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как развернуть виртуальную сеть с несколькими подсетями. Вы также узнали, что при создании виртуальной машины Windows в Azure создается сетевой интерфейс, который подключается к виртуальной машине, и группа безопасности сети, которая разрешает только тот трафик из Интернета, который проходит через порт 3389. Перейдите к следующему руководству, чтобы узнать, как фильтровать сетевой трафик для подсетей, а не отдельных виртуальных машин.

> [!div class="nextstepaction"]
> [Создание групп безопасности сети с помощью Azure CLI](./virtual-networks-create-nsg-arm-pportal.md)
