---
title: Подключение виртуальных сетей с помощью пиринговой связи на портале Azure | Документация Майкрософт
description: Сведения о том, как подключать виртуальные сети с помощью пиринговой связи.
services: virtual-network
documentationcenter: virtual-network
author: jimdial
manager: jeconnoc
editor: ''
tags: azure-resource-manager
ms.assetid: ''
ms.service: virtual-network
ms.devlang: azurecli
ms.topic: ''
ms.tgt_pltfrm: virtual-network
ms.workload: infrastructure
ms.date: 03/13/2018
ms.author: jdial
ms.custom: ''
ms.openlocfilehash: 0962a917186277a34abbda17b8fea87bcf4ad1e9
ms.sourcegitcommit: 8aab1aab0135fad24987a311b42a1c25a839e9f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2018
---
# <a name="connect-virtual-networks-with-virtual-network-peering-using-the-azure-portal"></a>Подключение виртуальных сетей с помощью пиринговой связи на портале Azure

Виртуальные сети можно подключить друг к другу с помощью пиринговой связи. После установки пиринговой связи ресурсы в обеих виртуальных сетях могут взаимодействовать друг с другом с такой же задержкой и пропускной способностью, как если бы эти ресурсы находились в одной виртуальной сети. В этой статье раскрываются следующие темы:

> [!div class="checklist"]
> * создание двух виртуальных сетей;
> * соединение двух виртуальных сетей с помощью пиринговой связи;
> * развертывание виртуальной машины в каждой из виртуальных сетей;
> * взаимодействие между виртуальными машинами.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="log-in-to-azure"></a>Вход в Azure 

Войдите на портал Azure по адресу https://portal.azure.com.

## <a name="create-virtual-networks"></a>Создание виртуальных сетей

1. Выберите **+ Создать ресурс** в верхнем левом углу окна портала Azure.
2. Щелкните **Сеть** и выберите **Виртуальная сеть**.
3. Введите или выберите следующие значения, примите значения по умолчанию для остальных параметров и нажмите кнопку **Создать**:

    |Параметр|Значение|
    |---|---|
    |ИМЯ|myVirtualNetwork1|
    |Пространство адресов|10.0.0.0/16|
    |Подписка| Выберите свою подписку.|
    |Группа ресурсов| Выберите **Создать новую**, а затем введите *myResourceGroup*.|
    |Расположение| Выберите **Восточная часть США**.|
    |Имя подсети|Подсеть 1|
    |Диапазон адресов подсети|10.0.0.0/24|

      ![Создать виртуальную сеть](./media/tutorial-connect-virtual-networks-portal/create-virtual-network.png)

4. Выполните шаги 1–3 повторно со следующими изменениями.

    |Параметр|Значение|
    |---|---|
    |ИМЯ|myVirtualNetwork2|
    |Пространство адресов|10.1.0.0/16|
    |Группа ресурсов| Щелкните **Use existing** (Использовать существующую), а затем выберите **myResourceGroup**.|
    |Диапазон адресов подсети|10.1.0.0/24|

## <a name="peer-virtual-networks"></a>Установка пиринговой связи между виртуальными сетями

1. В поле "Поиск" в верхней части портала Azure начните вводить *MyVirtualNetwork1*. Когда в результатах поиска появится пункт **myVirtualNetwork1**, выберите его.
2. В разделе **Параметры** выберите **Пиринги**, а затем щелкните **+ Добавить**, как показано на следующем рисунке:

    ![Создание пиринга](./media/tutorial-connect-virtual-networks-portal/create-peering.png)

3. Введите или выберите следующие значения, примите значения по умолчанию для остальных параметров и нажмите кнопку **ОК**.

    |Параметр|Значение|
    |---|---|
    |ИМЯ|myVirtualNetwork1-myVirtualNetwork2|
    |Подписка| Выберите свою подписку.|
    |Виртуальная сеть|myVirtualNetwork2. Чтобы выбрать виртуальную сеть *myVirtualNetwork2*, щелкните **Виртуальная сеть**, а затем — **myVirtualNetwork2**.|

    ![Параметры пиринга](./media/tutorial-connect-virtual-networks-portal/peering-settings.png)

    Параметр **Состояние пиринга** имеет значение *Инициировано*, как показано на следующем рисунке:

    ![Состояние пиринга](./media/tutorial-connect-virtual-networks-portal/peering-status.png)

    Если состояние не отображается, обновите страницу в браузере.

4. В поле **Поиск** в верхней части портала Azure начните вводить *MyVirtualNetwork2*. Когда в результатах поиска появится пункт **myVirtualNetwork2**, выберите его.
5. Выполните шаги 2–3 еще раз со следующими изменениями, а затем нажмите кнопку **ОК**.

    |Параметр|Значение|
    |---|---|
    |ИМЯ|myVirtualNetwork2-myVirtualNetwork1|
    |Виртуальная сеть|myVirtualNetwork1|

    Параметр **Состояние пиринга** имеет значение *Подключено*. Azure также изменяет состояние пиринга *myVirtualNetwork2-myVirtualNetwork1* с *Инициировано* на *Подключено*. Пиринг виртуальных сетей не будет установлен полностью до тех пор, пока его состояние для обеих виртуальных сетей не будет иметь значение *Подключено*. 

## <a name="create-virtual-machines"></a>Создание виртуальных машин

Создайте виртуальную машину в каждой виртуальной сети, чтобы на следующем шаге организовать взаимодействие между такими машинами.

### <a name="create-the-first-vm"></a>Создание первой виртуальной машины

1. Выберите **+ Создать ресурс** в верхнем левом углу окна портала Azure.
2. Выберите **Вычисления**, а затем — **Windows Server 2016 Datacenter**. Вы можете выбрать другую ОС, однако в оставшейся части этого руководства предполагается, что выбрано **Windows Server 2016 Datacenter**. 
3. Введите или выберите следующие значения в разделе **Основные сведения**, примите значения по умолчанию для остальных параметров и нажмите кнопку **Создать**.

    |Параметр|Значение|
    |---|---|
    |ИМЯ|myVm1|
    |Имя пользователя| Введите выбранное имя пользователя.|
    |Пароль| Введите выбранный пароль. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm).|
    |Группа ресурсов| Щелкните **Use existing** (Использовать существующую), а затем выберите **myResourceGroup**.|
    |Расположение| Выберите **Восточная часть США**.|
4. Выберите размер виртуальной машины в области **Выбор размера**.
5. В разделе **Параметры** выберите следующие значения и нажмите кнопку **ОК**.
    |Параметр|Значение|
    |---|---|
    |Виртуальная сеть| myVirtualNetwork1. Если она еще не выбрана, щелкните **Виртуальная сеть**, а затем в разделе **Выбор виртуальной сети** выберите **myVirtualNetwork1**.|
    |Подсеть| Subnet1. Если она еще не выбрана, щелкните **Подсеть**, а затем в разделе **Выбрать подсеть** выберите **Subnet1**.|
    
    ![Параметры виртуальной машины](./media/tutorial-connect-virtual-networks-portal/virtual-machine-settings.png)
 
6. В разделе **создания** на странице **Сводка** выберите **Создать**, чтобы начать развертывание виртуальной машины.

### <a name="create-the-second-vm"></a>Создание второй виртуальной машины

Повторите шаги 1–6 со следующими изменениями.

|Параметр|Значение|
|---|---|
|ИМЯ | myVm2|
|Виртуальная сеть | myVirtualNetwork2|

Создание виртуальных машин может занять несколько минут. Прежде чем выполнять оставшиеся шаги, обязательно дождитесь создания обеих виртуальных машин.

## <a name="communicate-between-vms"></a>Взаимодействие между виртуальными машинами

1. В поле *Поиск* в верхней части портала начните вводить *myVm1*. Когда виртуальная машина **myVm1** появится в результатах поиска, выберите ее.
2. Подключите удаленный рабочий стол к виртуальной машине *myVm1*, выбрав **Подключиться**, как показано на следующем рисунке:

    ![Подключение к виртуальной машине](./media/tutorial-connect-virtual-networks-portal/connect-to-virtual-machine.png)  

3. Чтобы подключиться к виртуальной машине, откройте скачанный RDP-файл. При появлении запроса выберите **Подключиться**.
4. Введите имя пользователя и пароль, которые вы указали при создании виртуальной машины (возможно, для этого придется выбрать **Дополнительные варианты** и **Использовать другую учетную запись**). Теперь нажмите кнопку **ОК**.
5. При входе в систему может появиться предупреждение о сертификате. Чтобы продолжить процесс подключения, выберите **Да**.
6. На следующем шаге будет использоваться проверка связи для обращения к виртуальной машине *myVm2* с виртуальной машины *myVm1*. Для проверки связи используется протокол ICMP, который по умолчанию запрещен в брандмауэре Windows. На виртуальной машине *myVm1* с помощью PowerShell разрешите протокол ICMP в брандмауэре Windows, чтобы на следующем шаге нормально работала проверка связи с виртуальной машины *myVm2*:

    ```powershell
    New-NetFirewallRule –DisplayName “Allow ICMPv4-In” –Protocol ICMPv4
    ```
    
    Хотя проверка связи используется в этой статье для взаимодействия между виртуальными машинами, мы не рекомендуем разрешать протокол ICMP в брандмауэре Windows в рабочей среде.

7. Для подключения к виртуальной машине *myVm2* введите следующую команду в командной строке на виртуальной машине *myVm1*:

    ```
    mstsc /v:10.1.0.4
    ```
    
8. Так как на виртуальной машине *myVm1* включена проверка связи, теперь можно проверить связь по IP-адресу:

    ```
    ping 10.0.0.4
    ```
    
9. Отключите RDP-сеансы с *myVm1* и *myVm2*.

## <a name="clean-up-resources"></a>Очистка ресурсов

Удалите группу ресурсов и все содержащиеся в ней ресурсы, когда она станет не нужна. 

1. В поле **Поиск** в верхней части портала введите *myResourceGroup*. Когда группа ресурсов **myResourceGroup** появится в результатах поиска, выберите ее.
2. Выберите **Удалить группу ресурсов**.
3. Введите *myResourceGroup* в поле **TYPE THE RESOURCE GROUP NAME:** (Введите имя группы ресурсов:) и нажмите кнопку **Удалить**.

**<a name="register"></a>Регистрация для использования предварительной версии функции пиринга между виртуальными сетями в разных регионах**

Функция создания пиринговых связей между виртуальными сетями в одном регионе является общедоступной. Функция пиринга между виртуальными сетями в разных регионах сейчас находится на этапе предварительной версии. Доступные регионы перечислены в разделе [Обновления Azure](https://azure.microsoft.com/updates/?product=virtual-network). Чтобы установить пиринг между виртуальными сетями в разных регионах, необходимо сначала зарегистрироваться для использования предварительной версии. Регистрация на портале невозможна, но можно зарегистрироваться с помощью [PowerShell](tutorial-connect-virtual-networks-powershell.md#register) или [Azure CLI](tutorial-connect-virtual-networks-cli.md#register). Если попытаться установить пиринговую связь между виртуальными сетями в разных регионах до регистрации, попытка завершится с ошибкой.

## <a name="next-steps"></a>Дополнительная информация

Из этой статьи вы узнали, как с помощью пиринговой связи соединить две виртуальные сети в одном расположении Azure. Пиринг можно использовать и для взаимодействия виртуальных сетей из [разных регионов](#register) или [разных подписок Azure](create-peering-different-subscriptions.md#portal), а также для создания [звездообразной топологии сети](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json#vnet-peering). Прежде чем настраивать пиринговую связь между рабочими виртуальными сетями, внимательно ознакомьтесь с [общими сведениями о пиринге](virtual-network-peering-overview.md), [сведениями об управлении пирингом](virtual-network-manage-peering.md) и [ограничениями виртуальных сетей](../azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits). 

Далее вы узнаете, как подключить ваш компьютер к виртуальной сети через VPN и взаимодействовать с ресурсами в виртуальной сети или в виртуальных сетях, соединенных пиринговой связью.

> [!div class="nextstepaction"]
> [Подключение компьютера к виртуальной сети](../vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json)
