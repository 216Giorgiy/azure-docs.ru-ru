---
title: Подключение виртуальных сетей с помощью пиринговой связи на портале Azure | Документация Майкрософт
description: Сведения о том, как подключать виртуальные сети с помощью пиринговой связи.
services: virtual-network
documentationcenter: virtual-network
author: jimdial
manager: jeconnoc
editor: ''
tags: azure-resource-manager
ms.assetid: ''
ms.service: virtual-network
ms.devlang: azurecli
ms.topic: ''
ms.tgt_pltfrm: virtual-network
ms.workload: infrastructure
ms.date: 03/06/2018
ms.author: jdial
ms.custom: ''
ms.openlocfilehash: ac0c1033546758a77b43298a5fa8cba5f5204650
ms.sourcegitcommit: 168426c3545eae6287febecc8804b1035171c048
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2018
---
# <a name="connect-virtual-networks-with-virtual-network-peering-using-the-azure-portal"></a>Подключение виртуальных сетей с помощью пиринговой связи на портале Azure

Виртуальные сети можно подключить друг к другу с помощью пиринговой связи. После установления пиринговой связи ресурсы в обеих виртуальных сетях могут взаимодействовать друг с другом с такой же задержкой и пропускной способностью, как если бы эти ресурсы находились в одной виртуальной сети. В этой статье описано, как создать две виртуальные сети и пиринговую связь между ними. Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание двух виртуальных сетей
> * Создание пиринговой связи между виртуальными сетями
> * Тестирование пиринговой связи

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="log-in-to-azure"></a>Вход в Azure 

Войдите на портал Azure по адресу http://portal.azure.com.

## <a name="create-virtual-networks"></a>Создание виртуальных сетей

1. Выберите **+ Создать ресурс** в верхнем левом углу окна портала Azure.
2. Щелкните **Сеть** и выберите **Виртуальная сеть**.
3. Как показано на изображении ниже, введите *myVirtualNetwork1* в поле **Имя**, *10.0.0.0/16* в поле **Адресное пространство**, **myResourceGroup** в поле **Группа ресурсов**, *Subnet1* в поле **Имя** для подсети, 10.0.0.0/24 в поле **Диапазон адресов** для подсети, затем укажите **расположение** и **подписку**, примите оставшиеся значения по умолчанию и щелкните **Создать**:

    ![Создать виртуальную сеть](./media/tutorial-connect-virtual-networks-portal/create-virtual-network.png)

4. Выполните шаги 1–3 повторно со следующими изменениями.
    - **Имя**: *myVirtualNetwork2*
    - **Группа ресурсов**. Установите флажок **Использовать существующий** и выберите **myResourceGroup**.
    - **Адресное пространство**: *10.1.0.0/16*.
    - **Диапазон адресов подсети**: *10.1.0.0/24*.

    Префикс адреса виртуальной сети *myVirtualNetwork2* не перекрывается с адресным пространством виртуальной сети *myVirtualNetwork1*. Пиринговую связь нельзя установить между виртуальными сетями с перекрывающимися адресными пространствами.

## <a name="peer-virtual-networks"></a>Установка пиринговой связи между виртуальными сетями

1. В поле "Поиск" в верхней части портала Azure начните вводить *MyVirtualNetwork1*. Когда в результатах поиска появится пункт **myVirtualNetwork1**, выберите его.
2. В разделе **Параметры** выберите **Пиринги**, а затем щелкните **+ Добавить**, как показано на следующем рисунке:

    ![Создание пиринга](./media/tutorial-connect-virtual-networks-portal/create-peering.png)

3. Введите или выберите сведения, показанные на рисунке ниже, а затем нажмите кнопку **ОК**. Чтобы выбрать виртуальную сеть *myVirtualNetwork2*, выберите **Виртуальная сеть**, а затем — *myVirtualNetwork2*.

    ![Параметры пиринга](./media/tutorial-connect-virtual-networks-portal/peering-settings.png)

    Параметр **Состояние пиринга** имеет значение *Инициировано*, как показано на следующем рисунке:

    ![Состояние пиринга](./media/tutorial-connect-virtual-networks-portal/peering-status.png)

    Если состояние не отображается, обновите страницу в браузере.

4. Выполните поиск виртуальной сети *myVirtualNetwork2*. Когда она отобразится в результатах поиска, выберите ее.
5. Выполните шаги 1–3 заново со следующими изменениями, а затем нажмите кнопку **ОК**.
    - **Имя**: *myVirtualNetwork2-myVirtualNetwork1*
    - **Виртуальная сеть**: *myVirtualNetwork1*

    Параметр **Состояние пиринга** имеет значение *Подключено*. Azure также изменяет состояние пиринга *myVirtualNetwork2-myVirtualNetwork1* с *Инициировано* на *Подключено*. Пиринг виртуальных сетей не будет установлен полностью до тех пор, пока его состояние для обеих виртуальных сетей не будет иметь значение *Подключено*. 

Пиринговые связи устанавливаются между двумя виртуальными сетями, однако не являются транзитивными. Так, например, если также требуется установить пиринговую связь сети *myVirtualNetwork2* с сетью *myVirtualNetwork3*, необходимо создать дополнительный пиринг между виртуальными сетями *myVirtualNetwork2* и *myVirtualNetwork3*. Несмотря на то что сеть *myVirtualNetwork1* соединена пирингом с *myVirtualNetwork2*, ресурсы в *myVirtualNetwork1* имеют доступ только к ресурсам *myVirtualNetwork3*, если сеть *myVirtualNetwork1* также соединена пирингом с *myVirtualNetwork3*. 

Прежде чем устанавливать пиринговую связь между рабочими виртуальными сетями, рекомендуем внимательно ознакомиться с [общими сведениями о пиринге](virtual-network-peering-overview.md), [управлении пирингом](virtual-network-manage-peering.md) и [ограничениях виртуальных сетей](../azure-subscription-service-limits.md?toc=%2fazure%2fvirtual-network%2ftoc.json#azure-resource-manager-virtual-networking-limits). Хотя в этой статье рассматривается пиринг между двумя виртуальными сетями в одной подписке и расположении, можно также установить пиринговую связь между виртуальными сетями в [разных регионах](#register) и [разных подписках Azure](create-peering-different-subscriptions.md#portal). Также с помощью пиринга можно создавать [звездообразные сетевые схемы](/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?toc=%2fazure%2fvirtual-network%2ftoc.json#vnet-peering).

## <a name="test-peering"></a>Тестирование пиринговой связи

Чтобы протестировать сетевое взаимодействие между виртуальными машинами в разных виртуальных сетях посредством пиринговой связи, разверните виртуальную машину в каждой подсети, а затем проведите обмен данными между виртуальными машинами. 

### <a name="create-virtual-machines"></a>Создание виртуальных машин

Создайте по одной виртуальной машине в каждой виртуальной сети, чтобы в дальнейшем можно было проверить взаимодействие между ними.

### <a name="create-virtual-machines"></a>Создание виртуальных машин

1. Выберите **+ Создать ресурс** в верхнем левом углу окна портала Azure.
2. Выберите **Вычисления**, а затем — **Windows Server 2016 Datacenter**. Вы можете выбрать другую ОС, однако в оставшейся части этого руководства предполагается, что выбрано **Windows Server 2016 Datacenter**. 
3. Выберите или введите следующие сведения в поле **Основные сведения**, а затем нажмите кнопку **ОК**.
    - **Имя**: *myVm1*
    - **Группа ресурсов**. Установите флажок **Использовать существующий** и выберите *myResourceGroup*.
    - **Расположение**. Выберите *Восточная часть США*.

    Введенные **имя пользователя** и **пароль** понадобятся позже. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../virtual-machines/windows/faq.md?toc=%2fazure%2fvirtual-network%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm). Выбранные **расположение** и **подписка** должны совпадать с расположением и подпиской виртуальной сети. Не обязательно выбирать ту же группу ресурсов, в которой была создана виртуальная сеть, но в данной статье используется эта группа ресурсов.
4. Выберите размер виртуальной машины в области **Выбор размера**.
5. Выберите или введите следующие сведения в поле **Параметры**, а затем нажмите кнопку **ОК**.
    - **Виртуальная сеть**. Убедитесь, что выбрана сеть **myVirtualNetwork1**. В противном случае выберите **Виртуальная сеть**, а затем в разделе **Выбор виртуальной сети** выберите **myVirtualNetwork1**.
    - **Подсеть**. Убедитесь, что выбрана подсеть **Subnet1**. В противном случае выберите **Подсеть**, а затем в разделе **Выбор подсети** выберите **Subnet1**, как показано на следующем рисунке:
    
        ![Параметры виртуальной машины](./media/tutorial-connect-virtual-networks-portal/virtual-machine-settings.png)
 
6. В разделе **создания** на странице **Сводка** выберите **Создать**, чтобы начать развертывание виртуальной машины.
7. Снова выполните шаги 1–6. Только в поле **имени** виртуальной машины введите *myVm2* и выберите *myVirtualNetwork2* в качестве значения параметра **Виртуальная сеть**.

Azure назначает *10.0.0.4* в качестве частного IP-адреса виртуальной машины *myVm1*, а 10.1.0.4 — в качестве IP-адреса виртуальной машины *myVm2*, так как это первые доступные IP-адреса в подсети *Subnet1* виртуальных сетей *myVirtualNetwork1* и *myVirtualNetwork2* соответственно.

Создание виртуальных машин занимает несколько минут. Прежде чем выполнять оставшиеся шаги, обязательно дождитесь создания обеих виртуальных машин.

### <a name="test-virtual-machine-communication"></a>Тестирование связи между виртуальными машинами

1. В поле *Поиск* в верхней части портала начните вводить *myVm1*. Когда виртуальная машина **myVm1** появится в результатах поиска, выберите ее.
2. Подключите удаленный рабочий стол к виртуальной машине *myVm1*, выбрав **Подключить**, как показано на следующем рисунке:

    ![Подключение к виртуальной машине](./media/tutorial-connect-virtual-networks-portal/connect-to-virtual-machine.png)  

3. Чтобы подключиться к виртуальной машине, откройте скачанный RDP-файл. При появлении запроса выберите **Подключиться**.
4. Введите имя пользователя и пароль, указанный при создании виртуальной машины, а затем нажмите кнопку **ОК**. (Возможно, нужно будет выбрать **Дополнительные варианты** и **Использовать другую учетную запись**, чтобы указать учетные данные, введенные при создании виртуальной машины.)
5. При входе в систему может появиться предупреждение о сертификате. Чтобы продолжить процесс подключения, выберите **Да**.
6. В дальнейшем для обмена данными между виртуальными машинами *myVm2* и *myVmWeb* будет использоваться проверка связи (ping). При проверке связи используется протокол ICMP, который брандамауэр Windows отклоняет по умолчанию. Включите протокол ICMP через брандмауэр Windows, введя в командной строке следующую команду:

    ```
    netsh advfirewall firewall add rule name=Allow-ping protocol=icmpv4 dir=in action=allow
    ```

    Хотя проверка связи используется в этой статье для тестирования, не рекомендуется разрешать протокол ICMP через брандмауэр Windows в рабочей среде.

7. Для подключения к виртуальной машине *myVm2* введите следующую команду в командной строке виртуальной машины *myVm1*:

    ```
    mstsc /v:10.1.0.4
    ```
    
8. Так как на виртуальной машине *myVm1* включена проверка связи, теперь можно проверить связь по IP-адресу:

    ```
    ping 10.0.0.4
    ```
    
    Вы получите четыре ответа. Если проверить связь, используя имя виртуальной машины (*myVm1*) вместо ее IP-адреса, проверка завершится ошибкой, так как *myVm1* — неизвестное имя узла. Разрешение имен Azure по умолчанию работает между виртуальными машинами в одной виртуальной сети, но не между виртуальными машинами в разных виртуальных сетях. Для разрешения имен между виртуальными сетями необходимо [развернуть собственный DNS-сервер](virtual-networks-name-resolution-for-vms-and-role-instances.md) или использовать [частные домены Azure DNS](../dns/private-dns-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json).

9. Отключите RDP-сеансы с *myVm1* и *myVm2*.

## <a name="clean-up-resources"></a>Очистка ресурсов

Удалите группу ресурсов и все содержащиеся в ней ресурсы, когда она станет не нужна. 

1. В поле **Поиск** в верхней части портала введите *myResourceGroup*. Когда группа ресурсов **myResourceGroup** появится в результатах поиска, выберите ее.
2. Выберите **Удалить группу ресурсов**.
3. Введите *myResourceGroup* в поле **TYPE THE RESOURCE GROUP NAME:** (Введите имя группы ресурсов:) и нажмите кнопку **Удалить**.

**<a name="register"></a>Регистрация для использования предварительной версии функции пиринга между виртуальными сетями в разных регионах**

Функция создания пиринговых связей между виртуальными сетями в одном регионе является общедоступной. Функция пиринга между виртуальными сетями в разных регионах сейчас находится на этапе предварительной версии. Доступные регионы перечислены в разделе [Обновления Azure](https://azure.microsoft.com/updates/?product=virtual-network). Чтобы установить пиринг между виртуальными сетями в разных регионах, необходимо сначала зарегистрироваться для использования предварительной версии. Регистрация на портале невозможна, но можно зарегистрироваться с помощью [PowerShell](tutorial-connect-virtual-networks-powershell.md#register) или [Azure CLI](tutorial-connect-virtual-networks-cli.md#register). Если попытаться установить пиринговую связь между виртуальными сетями в разных регионах до регистрации, попытка завершится с ошибкой.

## <a name="next-steps"></a>Дополнительная информация

Из этой статьи вы узнали, как соединить две виртуальные сети с помощью пиринга.

Далее вы узнаете, как подключить ваш компьютер к виртуальной сети через VPN и взаимодействовать с ресурсами в виртуальной сети или в виртуальных сетях, соединенных пиринговой связью.

> [!div class="nextstepaction"]
> [Подключение компьютера к виртуальной сети](../vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal.md?toc=%2fazure%2fvirtual-network%2ftoc.json)
