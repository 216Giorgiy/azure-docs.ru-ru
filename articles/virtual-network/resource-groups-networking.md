<properties 
   pageTitle="Поставщик сетевых ресурсов"
   description="Поставщик сетевых ресурсов"
   services="virtual-network"
   documentationCenter="na"
   authors="telmosampaio"
   manager="adinah"
   editor="tysonn" />
<tags 
   ms.service="virtual-network"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="04/22/2015"
   ms.author="telmos" />

# Поставщик сетевых ресурсов
В современных условиях для успеха бизнеса необходима возможность быстрого, гибкого, безопасного и воспроизводимого создания и администрирования крупномасштабных сетевых приложений. Диспетчер ресурсов Azure (ARM) позволяет создавать такие приложения в виде единой коллекции ресурсов в группах ресурсов. Для управления такими ресурсами используются различные поставщики ресурсов в ARM.

Диспетчер ресурсов Azure (ARM) позволяет создавать такие приложения и связанную с ними коллекцию сетевых ресурсов в виде единой коллекции ресурсов в группе ресурсов. Приложения и сетевые ресурсы работают как единое целое в группе ресурсов ARM.

Вы можете управлять сетевыми ресурсами с помощью любого из следующих интерфейсов управления:

- API на основе REST
- PowerShell
- ПАКЕТ SDK .NET
- Пакет SDK для Node.js
- Пакет SDK для Java
- Инфраструктура CLI Azure
- Портал Azure
- Язык шаблонов ARM

С появлением поставщиков сетевых ресурсов стали доступны следующие преимущества:

- **Метаданные**: вы можете добавлять сведения к ресурсам с помощью тегов. Эти теги можно применять для отслеживания использования ресурсов в группах ресурсов и подписках.
- **Повышенный контроль над сетью**: сетевые ресурсы нежестко связаны, и ими можно управлять более детально. Это обеспечивает большую гибкость при управлении сетевыми ресурсами.
- **Ускоренная настройка**: так как сетевые ресурсы нежестко связаны, вы можете создавать и организовывать сетевые ресурсы в параллельном режиме. Это значительно сокращает время настройки.
- **Управление доступом на основе ролей (RBAC)**: RBAC предоставляет роли по умолчанию с определенной областью безопасности, а также позволяет создавать пользовательские роли для безопасного управления. 
- **Упрощенное управление и развертывание**: стало проще развертывать приложения и управлять ими, так как вы можете создать весь стек приложений в виде одной коллекции ресурсов в группе ресурсов. Кроме того, развертывание выполняется быстрее, так как для этого достаточно предоставить полезные данные JSON шаблона.
- **Быстрая пользовательская настройка**: вы можете использовать шаблоны в декларативном стиле для быстрой и воспроизводимой настройки развертываний. 
- **Воспроизводимая пользовательская настройка**: вы можете использовать шаблоны в декларативном стиле для быстрой и воспроизводимой настройки развертываний.

## Сетевые ресурсы 
Теперь вы можете управлять сетевыми ресурсам независимо друг от друга, а не через один вычислительный ресурс (виртуальную машину). Это обеспечивает более высокую степень гибкости и динамичности при создании сложной крупномасштабной инфраструктуры в группе ресурсов.
 
На следующей схеме показано общее представление модели сетевых ресурсов и их сопоставлений. Ресурсы верхнего уровня выделены синим контуром. Кроме ресурсов верхнего уровня, на схеме показаны дочерние ресурсы, обозначенные серым контуром. Каждым ресурсом можно управлять по отдельности.

![Модель сетевых ресурсов](./media/resource-groups-networking/Figure1.png)

Ниже показано концептуальное представление примера развертывания, включающего многоуровневое приложение. Все сетевые ресурсы выделены синим контуром.

![Модель сетевых ресурсов](./media/resource-groups-networking/Figure2.png)

## Интерфейс REST API 
Как упоминалось ранее, сетевыми ресурсами можно управлять через разнообразные интерфейсы, включая API REST, пакет SDK для .NET, пакет SDK для Node.JS, пакет SDK для Java, PowerShell, CLI, портал Azure и шаблоны.

API Rest соответствует спецификации протокола HTTP 1.1. Общая структура URI API показана ниже:

	https://management.azure.com/subscriptions/{subscription-id}/providers/{resource-provider-namespace}/locations/{region-location}/register?api-version={api-version}

Параметры в фигурных скобках представляют следующие элементы:

- **subscription-id**: идентификатор вашей подписки на Azure.
- **resource-provider-namespace**: пространство имен используемого поставщика. Значение для поставщика сетевых ресурсов — *Microsoft.Network*.
- **region-name**: имя региона Azure.

При выполнении вызовов к API REST поддерживаются следующие методы HTTP:

- **PUT**: служит для создания ресурса заданного типа, изменения свойства ресурса или изменения сопоставления ресурсов. 
- **GET**: используется для получения сведений о подготовленном ресурсе.
- **DELETE**: позволяет удалить существующий ресурс.

Запрос и ответ соответствуют формату полезных данных JSON. Дополнительные сведения см. в статье [API управления ресурсами Azure](https://msdn.microsoft.com/library/azure/dn948464.aspx).

## Язык шаблонов ARM
Кроме принудительного управления ресурсами (через API или SDK), вы также можете использовать декларативный стиль программирования для создания сетевых ресурсов и управления ими на основе языка шаблонов ARM.

Ниже приведен пример такого шаблона.

	{
	  "$schema": "http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json",
	  "contentVersion": "<version-number-of-template>",
	  "parameters": { <parameter-definitions-of-template> },
	  "variables": { <variable-definitions-of-template> },
	  "resources": [ { <definition-of-resource-to-deploy> } ],
	  "outputs": { <output-of-template> }    
	}

Шаблон — это в первую очередь описание (в формате JSON) ресурсов и значений экземпляров, введенных с помощью параметров. Пример ниже можно использовать для создания виртуальной сети с двумя подсетями.

	{
	    "$schema": "http://schema.management.azure.com/schemas/2014-04-01-preview/VNET.json",
	    "contentVersion": "1.0.0.0",
	    "parameters" : {
	      "location": {
	        "type": "String",
	        "allowedValues": ["East US", "West US", "West Europe", "East Asia", "South East Asia"],
	        "metadata" : {
	          "Description" : "Deployment location"
	        }
	      },
	      "virtualNetworkName":{
	        "type" : "string",
	        "defaultValue":"myVNET",
	        "metadata" : {
	          "Description" : "VNET name"
	        }
	      },
	      "addressPrefix":{
	        "type" : "string",
	        "defaultValue" : "10.0.0.0/16",
	        "metadata" : {
	          "Description" : "Address prefix"
	        }
	
	      },
	      "subnet1Name": {
	        "type" : "string",
	        "defaultValue" : "Subnet-1",
	        "metadata" : {
	          "Description" : "Subnet 1 Name"
	        }
	      },
	      "subnet2Name": {
	        "type" : "string",
	        "defaultValue" : "Subnet-2",
	        "metadata" : {
	          "Description" : "Subnet 2 name"
	        }
	      },
	      "subnet1Prefix" : {
	        "type" : "string",
	        "defaultValue" : "10.0.0.0/24",
	        "metadata" : {
	          "Description" : "Subnet 1 Prefix"
	        }
	      },
	      "subnet2Prefix" : {
	        "type" : "string",
	        "defaultValue" : "10.0.1.0/24",
	        "metadata" : {
	          "Description" : "Subnet 2 Prefix"
	        }
	      }
	    },
	    "resources": [
	    {
	      "apiVersion": "2015-05-01-preview",
	      "type": "Microsoft.Network/virtualNetworks",
	      "name": "[parameters('virtualNetworkName')]",
	      "location": "[parameters('location')]",
	      "properties": {
	        "addressSpace": {
	          "addressPrefixes": [
	            "[parameters('addressPrefix')]"
	          ]
	        },
	        "subnets": [
	          {
	            "name": "[parameters('subnet1Name')]",
	            "properties" : {
	              "addressPrefix": "[parameters('subnet1Prefix')]"
	            }
	          },
	          {
	            "name": "[parameters('subnet2Name')]",
	            "properties" : {
	              "addressPrefix": "[parameters('subnet2Prefix')]"
	            }
	          }
	        ]
	      }
	    }
	    ]
	}

Вы можете указывать значения параметров вручную при использовании шаблона или же применять для этого файл параметров. В примере ниже показан возможный набор значений параметров, который используется для указанного выше шаблона:

	{
	  "location": {
	      "value": "East US"
	  },
	  "virtualNetworkName": {
	      "value": "VNET1"
	  },
	  "subnet1Name": {
	      "value": "Subnet1"
	  },
	  "subnet2Name": {
	      "value": "Subnet2"
	  },
	  "addressPrefix": {
	      "value": "192.168.0.0/16"
	  },
	  "subnet1Prefix": {
	      "value": "192.168.1.0/24"
	  },
	  "subnet2Prefix": {
	      "value": "192.168.2.0/24"
	  }
	}


Основные преимущества использования шаблонов заключаются в следующем:

- Вы можете создать сложную инфраструктуру в группе ресурсов, используя декларативный стиль. За организацию создания ресурсов, включая управление зависимостями, отвечает ARM. 
- Созданную инфраструктуру можно воспроизводить в различных регионах и в пределах одного региона путем простого изменения параметров. 
- Декларативный стиль позволяет сократить время подготовки при создании шаблонов и развертывании инфраструктуры. 

Примеры шаблонов см. в статье [Шаблоны Azure для быстрого начала работы](https://github.com/Azure/azure-quickstart-templates).

Дополнительные сведения о языке шаблонов ARM см. в статье [Язык шаблонов диспетчера ресурсов Azure](https://msdn.microsoft.com/library/azure/dn835138.aspx).

Пример шаблона, приведенный выше, использует виртуальную сеть и ресурсы подсети. Существует и другие сетевые ресурсы, которые вы можете использовать. Они перечислены ниже.

## Сетевая карта
Сетевая карта, или сетевой адаптер, представляет сетевой интерфейс, который может быть связан с виртуальной машиной (VM). У виртуальной машины может быть одна или несколько сетевых карт.

![Сетевая карта на одной виртуальной машине](./media/resource-groups-networking/Figure3.png)

К основным свойствам ресурса сетевой карты относятся следующие:

- Параметры IP-адресов

Сетевая карта также может быть сопоставлена со следующими сетевыми ресурсами:

- Группа безопасности сети (NSG) 
- Подсистема балансировки нагрузки

## Виртуальная сеть и подсеть
Виртуальные сети (VNET) и подсети позволяют определить периметр безопасности для рабочих нагрузок, выполняемых в Azure. Виртуальная сеть характеризуется адресным пространством, которое также называется блоком CIDR.

Подсеть является дочерним ресурсом виртуальной сети, который помогает определить сегменты адресных пространств в пределах блока CIDR на основе префиксов IP-адресов. Виртуальные машины, которые выполняют различные рабочие нагрузки, фактически работают в периметре подсети.

![Сетевая карта на одной виртуальной машине](./media/resource-groups-networking/Figure4.png)

К основным свойствам ресурса виртуальной сети относятся следующие:

- Пространство IP-адресов (блок CIDR) 
- Имя виртуальной сети
- Подсети

Виртуальная сеть также может быть сопоставлена со следующими сетевыми ресурсами:

- VPN-шлюз

К основным свойствам подсети относятся:

- Префикс IP-адреса
- Имя подсети

Подсеть также может быть сопоставлена со следующими сетевыми ресурсами:

- Группа безопасности сети (NSG)

## Подсистема балансировки нагрузки
Подсистема балансировки нагрузки используется, когда необходимо масштабировать приложения. Типичные сценарии развертывания включают приложения, работающие на нескольких экземплярах виртуальной машины. Перед экземплярами виртуальной машины расположена подсистема балансировки нагрузки, которая помогает распределять сетевой трафик между различными экземплярами.

![Сетевая карта на одной виртуальной машине](./media/resource-groups-networking/Figure5.png)

Подсистемы балансировки нагрузки содержат следующие дочерние ресурсы:

- **Конфигурация внешних IP-адресов**: подсистема балансировки нагрузки может включать один или несколько внешних IP-адресов, которые также называются виртуальными IP-адресами. Такие IP-адреса обеспечивают поступление трафика. 
- **Пул внутренних адресов**: это IP-адреса, связанные с сетевыми картами виртуальных машин, между которыми распределяется нагрузка.
- **Правила балансировки нагрузки**: свойство правила сопоставляет указанное сочетание внешнего IP-адреса и порта с набором серверных IP-адресов и портов. С помощью одного определения ресурса подсистемы балансировки нагрузки можно задать несколько правил балансировки нагрузки, каждое из которых отражает сочетание внешнего IP-адреса и порта с серверным IP-адресом и портом, связанными с виртуальными машинами. 
- **Пробы**: пробы позволяют отслеживать работоспособность экземпляров виртуальных машин. В случае сбоя пробы работоспособности экземпляр виртуальной машины автоматически перестает использоваться.
- **Правила NAT для входящего трафика**: правила NAT, определяющие входящий трафик, который проходит через внешний IP-адрес и передается серверному IP-адресу.

## Общедоступный IP-адрес
Ресурс общедоступного IP-адреса предоставляет зарезервированный или динамический общедоступный IP-адрес. Общедоступный IP-адрес можно назначить подсистеме балансировки нагрузки или NAT или же сопоставить с частным IP-адресом сетевой карты виртуальной машины.

К основным свойствам ресурса общедоступного IP-адреса относятся следующие:

- **Метод распределения IP-адресов**: зарезервированные или динамические. 

## Группа безопасности сети (NSG)
Ресурс NSG позволяет создать периметр безопасности для рабочих нагрузок путем реализации разрешающих и запрещающих правил. Эти правила могут применяться на уровне сетевой карты (экземпляра виртуальной машины) или на уровне подсети (группы виртуальных машин).

К основным свойствам ресурса NSG относятся следующие:

- **Правило безопасности**: для NSG можно определить несколько правил безопасности. Каждое правило может разрешать или запрещать различные типы трафика.

## Правило безопасности
Правило безопасности является дочерним ресурсом NSG.

Основные свойства правила безопасности включают:

- **Протокол**: сетевой протокол, к которому применяется правило.
- **Диапазон портов источника**: порт источника или диапазон от 0 до 65 535. Для выбора всех портов можно использовать подстановочный знак. 
- **Диапазон портов назначения**: порт назначения или диапазон от 0 до 65 535. Для выбора всех портов можно использовать подстановочный знак.
- **Префикс адреса источника**: диапазон IP-адресов источника. 
- **Префикс адреса назначения**: диапазон IP-адресов назначения.
- **Доступ**: *разрешить* или *запретить* трафик.
- **Приоритет**: значение в диапазоне от 100 до 4096. Номер приоритета должен быть уникальным для каждого правила в коллекции правил безопасности. Чем ниже номер приоритета, тем выше приоритет правила.
- **Направление**: указывает, будет ли правило применяться для трафика во *входящем* или *исходящем* направлении. 

## VPN-шлюз 
Ресурс VPN-шлюза позволяет создать безопасное подключение между локальным центром обработки данных и Azure. Ресурс VPN-шлюза можно настроить тремя способами:
 
- **Точка — сайт**: для безопасного доступа к ресурсам Azure, размещенным в виртуальной сети, вы можете использовать VPN-клиент на любом компьютере. 
- **Подключение нескольких сайтов**: из локальных центров обработки данных можно безопасно подключаться к ресурсам в виртуальной сети. 
- **Виртуальная сеть — виртуальная сеть**: вы можете безопасно подключаться из одной виртуальной сети Azure к другой в том же или другом регионе, чтобы обеспечить географическую избыточность рабочих нагрузок.

К основным свойствам VPN-шлюза относятся:
 
- **Тип шлюза**: с динамической или статической маршрутизацией. 
- **Префикс пула адресов VPN-клиентов**: IP-адреса, которые должны назначаться клиентам, подключающимся в конфигурации "точка — сайт".

## Профиль диспетчера трафика
Ресурс диспетчера трафика и его дочерней конечной точки позволяет доставлять трафик конечным точкам Azure и за пределы Azure. Такое распределение трафика регулируется политиками. Диспетчер трафика позволяет также отслеживать работоспособность конечных точек и перенаправлять трафик с учетом работоспособности конечной точки.

К основным свойствам профиля диспетчера трафика относятся:

- **Метод маршрутизации трафика**: возможными значениями являются *Производительность*, *Взвешенное* и *Приоритет*.
- **Конфигурация DNS**: полное доменное имя (FQDN) профиля.
- **Протокол**: протокол мониторинга, возможными значениями являются *HTTP* и *HTTPS*.
- **Порт**: порт мониторинга. 
- **Порт**: путь мониторинга.
- **Конечные точки**: контейнер для ресурсов конечных точек.

## Конечная точка 
Конечная точка — это дочерний ресурс профиля диспетчера трафика. Он представляет службу или сетевую конечную точку, на которые распределяется трафик с учетом политики, настроенной в ресурсе профиля диспетчера трафика.

К основным свойствам конечной точки относятся:
 
- **Тип**: тип конечной точки, возможные значения: *Конечная точка Azure*, *Внешняя конечная точка* и *Вложенная конечная точка*. 
- **Идентификатор конечного ресурса**: общедоступный IP-адрес конечной точки службы или сайта. Это может быть конечная точка Azure или внешняя конечная точка.
- **Вес**: вес конечной точки, используемый при управлении трафиком. 
- **Приоритет**: приоритет конечной точки, используемый для определения действия отработки отказа. 

## Использование шаблона

Вы можете развернуть службы в Azure из шаблона с помощью PowerShell или интерфейса командной строки Azure. Кроме этого, их также можно развернуть с GitHub, щелкнув необходимую команду. Чтобы развернуть службы из шаблона на сайте GitHub, сделайте следующее:

1. Откройте файл template3 на GitHub. В качестве примера откройте страницу с шаблоном [Виртуальная сеть с двумя подсетями](https://github.com/Azure/azure-quickstart-templates/tree/master/101-virtual-network).
2. Щелкните **Развертывание в Azure**, а затем войдите на портал Azure под своими учетными данными.
3. Проверьте шаблон и нажмите кнопку **Сохранить**.
4. Щелкните **Изменить параметры** и выберите расположение для виртуальной сети и подсетей, например *Запад США*.
5. При необходимости измените значения параметров **ПРЕФИКС АДРЕСА** и **ПРЕФИКС ПОДСЕТИ** и нажмите кнопку **ОК**.
6. Щелкните **Выбрать группу ресурсов**, а затем выберите группу ресурсов, в которую необходимо добавить виртуальную сеть и подсети. Кроме того, можно создать новую группу ресурсов, щелкнув **Создать новую**.
3. Щелкните **Создать**. Обратите внимание на заголовок **Подготовка развертывания шаблона**. После развертывания появится экран, показанный ниже.

![Пример развертывания шаблона](./media/resource-groups-networking/Figure6.png)

## См. также

[Справочник по сетевому API Azure](https://msdn.microsoft.com/library/azure/dn948464.aspx)

[Справочник по Azure PowerShell для работы в сети](https://msdn.microsoft.com/library/azure/mt163510.aspx)

[Язык шаблонов в диспетчере ресурсов Azure](https://msdn.microsoft.com/library/azure/dn835138.aspx)

[Сеть Azure: часто используемые шаблоны](https://github.com/Azure/azure-quickstart-templates)

[Поставщик вычислительных ресурсов](../virtual-machines-azurerm-versus-azuresm)

[Общие сведения о диспетчере ресурсов Azure](../resource-group-overview)

[Управление доступом на основе ролей в диспетчере ресурсов Azure](https://msdn.microsoft.com/library/azure/dn906885.aspx)

[Использование тегов в диспетчере ресурсов Azure](https://msdn.microsoft.com/library/azure/dn848368.aspx)

[Развертывания шаблонов](https://msdn.microsoft.com/library/azure/dn790549.aspx)

<!---HONumber=July15_HO4-->