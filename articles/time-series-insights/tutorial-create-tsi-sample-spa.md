---
title: Создание одностраничного веб-приложения службы "Аналитика временных рядов Azure"
description: Описание способов создания одностраничного веб-приложения, которое запрашивает и преобразовывает для просмотра данные из среды TSI.
author: ashannon7
ms.service: time-series-insights
ms.topic: tutorial
ms.date: 06/14/2018
ms.author: anshan
manager: cshankar
ms.openlocfilehash: 312e15f976a6782e3f39cfcc5ce0721ac6357a16
ms.sourcegitcommit: 4de6a8671c445fae31f760385710f17d504228f8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/08/2018
ms.locfileid: "39626761"
---
# <a name="tutorial-create-an-azure-time-series-insights-single-page-web-app"></a>Руководство. Создание одностраничного веб-приложения службы "Аналитика временных рядов Azure"

Этот учебник поможет выполнить процесс создания собственного одностраничного веб-приложения (SPA) для доступа к данным TSI, созданных на основе [примера приложения службы "Аналитика временных рядов" (TSI)](https://insights.timeseries.azure.com/clientsample). В этом руководстве описывается, как выполнять следующие задачи.

> [!div class="checklist"]
> * Как спроектировать приложение.
> * Как зарегистрировать приложение с помощью Azure Active Directory.
> * Как построить, опубликовать и протестировать веб-приложение. 

## <a name="prerequisites"></a>Предварительные требования

Зарегистрируйтесь для [бесплатной подписки Azure](https://azure.microsoft.com/free/), если у вас ее еще нет. 

Также потребуется установить Visual Studio, если это еще не сделано. Для работы с этим руководством можно [загрузить и установить бесплатную версию Community или бесплатную пробную версию](https://www.visualstudio.com/downloads/).

## <a name="application-design-overview"></a>Обзор проектирования приложений

Как уже упоминалось, пример приложения TSI, используемого в этом руководстве, обеспечивает основу для проектирования и кодирования. В коде использованы элементы из библиотеки JavaScript клиента TSI. Клиентская библиотека TSI предоставляет абстракцию для двух основных категорий API.

- **Методы программы-оболочки для вызова API-интерфейсов для запросов TSI**. REST API, которые позволяют запрашивать данные TSI с использованием выражений на основе JSON и которые организованы в пространстве имен `TsiClient.server` библиотеки.
- **Методы создания и заполнения нескольких типов элементов управления диаграммами**, которые используются для визуализации данных TSI на веб-странице и которые организованы в пространстве имен `TsiClient.ux` библиотеки.

В этом руководстве также будут использоваться данные из среды TSI для примера приложения. Дополнительные сведения о структуре образца приложения TSI и о его использовании клиентской библиотеки TSI, см. в руководстве [Изучение клиентской библиотеки JavaScript для службы "Аналитика временных рядов Azure"](tutorial-explore-js-client-lib.md).

## <a name="register-the-application-with-azure-ad"></a>Регистрация приложения с помощью Azure AD 

Перед созданием приложения его необходимо зарегистрировать с помощью Azure AD. Регистрация предоставляет приложению конфигурацию идентификатора, что позволяет использовать поддержку OAuth для единого входа. OAuth требует, чтобы одностраничные приложения использовали «неявную» авторизацию, которая будет обновлена в манифесте приложения. Манифест приложения представляет собой конфигурацию идентификатора приложения в виде JSON. 

1. Войдите на [портал Azure](https://portal.azure.com), используя учетную запись подписки Azure.  
1. Выберите ресурс **Azure Active Directory** в левой панели, затем **Регистрация приложений**, затем **Регистрация нового приложения**.  
   
   ![Регистрация приложения Azure AD на портале Azure](media/tutorial-create-tsi-sample-spa/ap-aad-app-registration.png)

1. На странице **Создание** заполните необходимые параметры.
   
   Параметр|ОПИСАНИЕ
   ---|---
   **Имя** | Укажите значимое регистрационное имя.  
   **Тип приложения** | Поскольку создается веб-приложение SPA, оставьте как "Веб-приложение и API"
   **URL-адрес входа** | Введите URL-адрес домашней страницы или страницы входа приложения. Так как приложение будет размещено в Azure App Service (позже), необходимо использовать URL-адрес в домене "https://azurewebsites.net". В этом примере для имени взято регистрационное имя.

   По завершении нажмите кнопку **Создать** для регистрации нового приложения.

   ![Регистрация приложения Azure AD на портале Azure — создание](media/tutorial-create-tsi-sample-spa/ap-aad-app-registration-create.png)

1. Приложения ресурсов предоставляют API REST для использования другими приложениями и также регистрируются с помощью Azure AD. Программные интерфейсы обеспечивают детальный и защищенный доступ к клиентским приложениям, предоставляя "области резервирования". Так как приложение будет вызывать API службы "Аналитика временных рядов Azure", необходимо указать API и область резервирования, для которых во время выполнения будет запрашиваться или предоставляться разрешение. Выберите **Параметры**, затем **Требуемые разрешения**, затем **Добавить**:

   ![Добавление разрешений Azure AD на портале Azure](media/tutorial-create-tsi-sample-spa/ap-aad-app-registration-add-perms.png)

1. На странице **Добавить доступ через API** нажмите **1 Выбор API**, чтобы указать API TSI. На странице **Выбор API** введите в поле поиска "azure time". Затем в списке результатов поиска API-интерфейсов выберите "Azure Time Series Insights" и нажмите **Выбрать**. 

   ![Добавление разрешений Azure AD на портале Azure — API](media/tutorial-create-tsi-sample-spa/ap-aad-app-registration-add-perms-api.png)

1. Теперь можно указать область резервирования API-интерфейса. На странице **Добавить доступ через API** нажмите **2 Выбрать разрешения**. На странице **Включить доступ** выберите область резервирования "Доступ к службе Аналитика временных рядов Azure". Нажмите кнопку **Выбрать**, после возврата на страницу **Добавить доступ через API** нажмите **Готово**.

   ![Добавление разрешений Azure AD на портале Azure — область резервирования](media/tutorial-create-tsi-sample-spa/ap-aad-app-registration-add-perms-api-scopes.png)

1. При возвращении на страницу **Требуемые разрешения** обратите внимание, что API-интерфейс "Azure Time Series Insights" теперь отображается в списке. Также необходимо предварительно дать согласие на доступ приложения к API и области резервирования для всех пользователей. Нажмите наверху кнопку **Предоставление разрешений** и выберите **Да**.

   ![Требуемые разрешения Azure AD на портале Azure — согласие](media/tutorial-create-tsi-sample-spa/ap-aad-app-registration-required-permissions-consent.png)

1. Как упоминалось ранее, также необходимо обновить манифест приложения. Щелкните имя приложения в строке навигатора, чтобы вернуться к странице **Зарегистрированное приложение**. Выберите **Манифест**, измените свойство `oauth2AllowImplicitFlow` на `true`, затем нажмите **Сохранить**.

   ![Обновление манифеста Azure AD на портале Azure](media/tutorial-create-tsi-sample-spa/ap-aad-app-registration-update-manifest.png)

1. Наконец, нажмите в строке навигатора, чтобы еще раз вернуться к странице **Зарегистрированное приложение** и скопируйте такие свойства приложения: URL-адрес **Домашней страницы** и **Идентификатор приложения**. Эти свойства будут использоваться на следующем этапе.

   ![Свойства Azure AD на портале Azure](media/tutorial-create-tsi-sample-spa/ap-aad-app-registration-application.png)

## <a name="build-and-publish-the-web-application"></a>Создание и публикация веб-приложения

1. Создайте каталог для сохранения файлов проекта приложения. Затем перейдите по каждому из ниже указанных URL-адресов, щелкните правой кнопкой мыши ссылку "Raw" в верхней правой области страницы и, когда откроется страница с кодом, сохраните ее в каталог проекта.

   > [!NOTE]
   > В зависимости от браузера перед сохранением файла может потребоваться исправить расширение файла (на HTML или CSS).

   - Файл **index.html** с кодом HTML и JavaScript для страницы https://github.com/Microsoft/tsiclient/blob/tutorial/pages/tutorial/index.html
   - Файл **sampleStyles.css** таблицы стилей CSS: https://github.com/Microsoft/tsiclient/blob/tutorial/pages/tutorial/sampleStyles.css
    
1. Запустите и войдите в Visual Studio, чтобы создать проект для веб-приложения. В меню **Файл** выберите **Открыть** вариант **веб-сайта**. В диалоговом окне **Открыть веб-сайт** выберите рабочий каталог, в котором сохранены файлы HTML и CSS, затем нажмите **Открыть**.

   ![VS — файл открытия веб-сайта](media/tutorial-create-tsi-sample-spa/vs-file-open-web-site.png)

1. Откройте **Обозреватель решений** из меню Visual Studio **Представление**. Вы должны увидеть свое новое решение, содержащее проект веб-сайта (значок глобуса), который содержит файлы HTML и CSS.

   ![VS — новое решение в обозревателе решений](media/tutorial-create-tsi-sample-spa/vs-solution-explorer.png)

1. Прежде чем публиковать приложение, необходимо в файле **index.html** обновить части с кодом JavaScript. 

   a. Сначала измените пути ссылок на файлы JavaScript и таблицы стилей в элементе `<head>`. Откройте файл **index.html** в решении Visual Studio и найдите следующие строки кода JavaScript. Раскомментируйте три строки под заголовком "PROD RESOURCE LINKS" и закомментируйте три строки под заголовком "DEV RESOURCE LINKS".
   
      [!code-javascript[head-sample](~/samples-javascript/pages/tutorial/index.html?range=2-20&highlight=10-13,15-18)]

      Измененный код должен выглядеть примерно следующим образом.

      ```javascript
      <!-- PROD RESOURCE LINKS -->
      <link rel="stylesheet" type="text/css" href="sampleStyles.css"></link>
      <script src="https://unpkg.com/tsiclient@1.1.4/tsiclient.js"></script>
      <link rel="stylesheet" type="text/css" href="https://unpkg.com/tsiclient@1.1.4/tsiclient.css"></link>

      <!-- DEV RESOURCE LINKS -->
      <!-- <link rel="stylesheet" type="text/css" href="pages/samples/sampleStyles.css"></link>
      <script src="dist/tsiclient.js"></script>
      <link rel="stylesheet" type="text/css" href="dist/tsiclient.css"></link> -->
      ```

   b. Затем измените логику маркера доступа для использования новой регистрации приложения Azure AD. Измените следующие переменные `clientID` и `postLogoutRedirectUri` соответственно, чтобы использовать идентификатор приложения и URL-адрес домашней страницы, которые были скопированы на шаге 9 из раздела [Регистрация приложения с помощью Azure AD](#register-the-application-with-azure-ad).

      [!code-javascript[head-sample](~/samples-javascript/pages/tutorial/index.html?range=147-153&highlight=4-5)]

      Измененный код должен выглядеть примерно следующим образом.

      ```javascript
      clientId: '8884d4ca-b9e7-403a-bd8a-366d0ce0d460',
      postLogoutRedirectUri: 'https://tsispaapp.azurewebsites.net',
      ``` 

   c. Сохраните файл **index.html** после окончания редактирования.

1. Теперь можно опубликовать веб-приложение в подписке Azure в качестве службы приложений Azure.  

   > [!NOTE]
   > Некоторые поля в следующих диалоговых окнах заполняются данными из вашей подписки Azure. Таким образом, загрузка каждого диалогового окна может занять несколько секунд, прежде чем можно будет продолжать.  

   a. Щелкните правой кнопкой мыши узел проекта веб-сайта в **обозревателе решений** и выберите **Опубликовать веб-приложение**.  

      ![VS — обозреватель решений публикации веб-приложения](media/tutorial-create-tsi-sample-spa/vs-solution-explorer-publish-web-app.png)

   b. Выберите **Служба приложений Microsoft Azure** для создания целевого объекта публикации.  

      ![VS — профиль публикации](media/tutorial-create-tsi-sample-spa/vs-publish-profile-target.png)  

   c. Выберите подписку, которую необходимо использовать для публикации приложения, а затем нажмите кнопку "Создать". 

      ![VS — опубликовать профиль — служба приложений](media/tutorial-create-tsi-sample-spa/vs-publish-profile-app-service.png)  

   d. Дайте диалоговому окну **Создать App Service** несколько секунд, чтобы загрузить все поля, а затем измените значения следующих полей.
   
      Поле | ОПИСАНИЕ
      ---|---
      **Имя приложения** | Измените регистрационное имя приложения Azure AD, выбранное на шаге 3 в разделе [Регистрация приложения с помощью Azure AD](#register-the-application-with-azure-ad). 
      **Группа ресурсов** | С помощью кнопки **Новая**, измените значение в поле **Имя приложения**.
      **План службы приложений** | С помощью кнопки **Новая**, измените значение в поле **Имя приложения**.

      По завершении нажмите кнопку **Создать**. Через несколько секунд, в течение которых создаются ресурсы Azure, кнопка **Экспорт** в левом нижнем углу заменится на "Развертывание". После создания ресурсов вы вернетесь к предыдущему диалоговому окну. 

      ![VS — профиль публикации — добавление новой службы приложений](media/tutorial-create-tsi-sample-spa/vs-publish-profile-app-service-create.png)  

   д. После возвращения возвращении в диалоговое окно **Опубликовать**, убедитесь, что **Способ публикации** установлен на "Веб-развертывание". Кроме того, измените **URL-адрес назначения** для использования `https` вместо `http`, чтобы соответствовать регистрации приложения Azure AD. Чтобы развернуть веб-приложение, нажмите кнопку "Опубликовать".  

      ![VS — публикации веб-приложения — публикация службы приложений](media/tutorial-create-tsi-sample-spa/vs-publish-publish.png)  

   Е. Вы должны увидеть журнал успешной публикации в окне **Вывод** Visual Studio. После завершения развертывания на вкладке браузера откроется запрос для входа в веб-приложение. После успешного входа в службу вы увидите все элементы управления TSI, заполненные данными.  

      [![VS — публикация веб-приложения — выходные данные журнала публикации](media/tutorial-create-tsi-sample-spa/vs-publish-output.png)](media/tutorial-create-tsi-sample-spa/vs-publish-output.png#lightbox)

      ![Приложение SPA TSI — вход в систему](media/tutorial-create-tsi-sample-spa/tsispaapp-azurewebsites-net.png)  

## <a name="troubleshooting"></a>Устранение неполадок  

Код ошибки и состояние | ОПИСАНИЕ
---------------------| -----------
*AADSTS50011: Для приложения не зарегистрирован адрес ответа.* | В регистрации Azure AD отсутствует свойство "URL-адрес ответа". Перейдите на страницу **Параметры** / **URL-адреса ответа** для регистрации приложения Azure AD. Убедитесь, что присутствует URL-адрес **входа**, указанный в шаге 3 из раздела [Регистрация приложения с помощью Azure AD](#register-the-application-with-azure-ad). 
*AADSTS50011: Указанный в запросе URL-адрес ответа не соответствует URL-адресам ответа, настроенным для приложения: "<Application ID GUID>".* | Параметр `postLogoutRedirectUri`, указанный в шаге 4.b раздела [Создание и публикация веб-приложения](#build-and-publish-the-web-application), должен соответствовать значению, указанному в свойстве **Параметры** / **URL-адреса ответа** в вашей регистрации приложения Azure AD. Необходимо также изменить **URL-адрес назначения** для использования `https` на шаге 5.e раздела [Создание и публикация веб-приложения](#build-and-publish-the-web-application)
Загрузка веб-приложения, но имеет страницу входа только с текстом и белым фоном без стилей. | Убедитесь, что пути, обсуждаемые на шаге 4.а из раздела [Создание и публикация веб-приложения](#build-and-publish-the-web-application) заданы правильно. Если веб-приложение не может найти файлы CSS, страница не будет правильно отображаться.

## <a name="clean-up-resources"></a>Очистка ресурсов

В этом руководстве создано несколько запущенных служб Azure. Если вы не планируете изучать эту серию руководств, рекомендуется удалить все ресурсы, чтобы избежать лишних расходов. 

В меню слева на портале Azure сделайте следующее:

1. Щелкните значок **Группы ресурсов** и выберите группу ресурсов, которую вы создали для среды TSI. В верхней части страницы щелкните **Удалить группу ресурсов**, введите имя группы ресурсов и щелкните **Удалить**. 
1. Щелкните значок **Группы ресурсов**, затем выберите группу ресурсов, автоматически созданную акселератором решений для имитации устройств. В верхней части страницы щелкните **Удалить группу ресурсов**, введите имя группы ресурсов и щелкните **Удалить**. 

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * Как спроектировать приложение.
> * Как зарегистрировать приложение с помощью Azure Active Directory.
> * Как построить, опубликовать и протестировать веб-приложение. 

Это руководство интегрируется с Azure AD, используя удостоверение пользователя, вошедшего в систему для получения маркера доступа. Для получения дополнительных сведений о том, как получить доступ к API TSI, используя удостоверение приложения службы или управляющей программы, см. следующий раздел.

> [!div class="nextstepaction"]
> [Проверка подлинности и авторизация для API службы "Аналитика временных рядов Azure"](time-series-insights-authentication-and-authorization.md)
