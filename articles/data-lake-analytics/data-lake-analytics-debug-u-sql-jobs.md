---
title: "Отладка заданий U-SQL | Документация Майкрософт"
description: "Узнайте, как выполнять отладку заданий U-SQL, завершившихся сбоем, с помощью Visual Studio. "
services: data-lake-analytics
documentationcenter: 
author: mumian
manager: jhubbard
editor: cgronlun
ms.assetid: bcd0b01e-1755-4112-8e8a-a5cabdca4df2
ms.service: data-lake-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 09/02/2016
ms.author: jgao
translationtype: Human Translation
ms.sourcegitcommit: 219dcbfdca145bedb570eb9ef747ee00cc0342eb
ms.openlocfilehash: 4a4cd690645200bc5f208fd0d15fe58537f9b2a4


---
# <a name="debug-c-code-in-u-sql-for-data-lake-analytics-jobs"></a>Отладка кода C# на языке U-SQL для заданий Data Lake Analytics
Узнайте, как отлаживать задания U-SQL, завершившиеся сбоем из-за ошибок в пользовательском коде, используя средства Visual Studio для Azure Data Lake. 

Инструменты Visual Studio позволяют пользователям скачивать скомпилированный код и необходимые данные о вершинах из кластера для трассировки и отладки невыполненных заданий.

Системы для работы с большими данными обычно позволяют использовать расширенные модели с помощью таких языков, как Java, C#, Python и т. д. Многие из этих систем выдают ограниченную информацию об отладке среды выполнения. Поэтому сложно отлаживать ошибки среды выполнения в пользовательском коде. Новые средства Visual Studio содержат функцию отладки сбоев вершин. Она позволяет скачать из службы Azure сведения среды выполнения в локальную рабочую станцию, чтобы можно было отлаживать неудавшийся пользовательский код C# с помощью такой среды выполнения и таких входных данных, которые аналогичны облачным.  Устранив проблемы, вы можете повторно запустить измененный код в службе Azure с помощью упомянутых средств.

Видеопрезентация этой функции доступна на странице [Debug your custom code in Azure Data Lake Analytics](https://mix.office.com/watch/1bt17ibztohcb)(Отладка пользовательского кода в Azure Data Lake Analytics).

> [!NOTE]
> Visual Studio может зависнуть или аварийно завершить работу, если у вас не установлены следующие два обновления для Windows: [Распространяемый компонент Microsoft Visual C++ 2015, обновление 2](https://www.microsoft.com/download/details.aspx?id=51682) и [Универсальная среда выполнения C для Windows](https://www.microsoft.com/download/details.aspx?id=50410&wa=wsignin1.0).
> 
> 

## <a name="prerequisites"></a>Предварительные требования
* Предполагается, что вы ознакомились со статьей [о начале работы](data-lake-analytics-data-lake-tools-get-started.md) .

## <a name="create-and-configure-debug-projects"></a>Создание и настройка проектов отладки
При открытии невыполненного задания в инструменте Visual Studio для Data Lake вы увидите оповещение. Подробные сведения об ошибке отобразятся на вкладке "Ошибка" и в желтой области оповещений в верхней части окна. 

![Azure Data Lake Analytics U-SQL отладка visual studio скачивание вершины](./media/data-lake-analytics-debug-u-sql-jobs/data-lake-analytics-download-vertex.png)

**Скачивание вершин и создание решения отладки**

1. Откройте в Visual Studio задание U-SQL, завершившееся сбоем.
2. Нажмите кнопку **Скачать** , чтобы скачать все необходимые ресурсы и входные потоки. Нажмите кнопку **Повторить** , если не удалось скачать.
3. После завершения скачивания нажмите кнопку **Открыть** , чтобы создать проект локальной отладки. Будет создано решение Visual Studio с именем **VertexDebug**, а в нем будет создан пустой проект **LocalVertexHost**.

Если в коде программной части U-SQL (файл Script.usql.cs) используются определяемые пользователем операторы, то необходимо создать проект библиотеки классов C# с кодом определяемых пользователем операторов и включить проект в решение VertexDebug.

Если вы зарегистрировали DLL-сборки в базе данных Data Lake Analytics, необходимо добавить исходный код сборок в решение VertexDebug.

Если вы создали отдельную библиотеку класса C# для кода U-SQL и зарегистрировали DLL-сборки в базе данных Data Lake Analytics, нужно добавить исходный проект C# сборок в решение VertexDebug.

В некоторых редких случаях нужно использовать пользовательские операторы в файле фонового кода U-SQL (Script.usql.cs) в исходном решении. Чтобы это работало, необходимо создать библиотеку C#, содержащую исходный код, и дать сборке имя, зарегистрированное в кластере. Узнать имя сборки, зарегистрированное в кластере, можно, проверив скрипт, выполняющийся в кластере. Для этого откройте задание U-SQL и щелкните "Скрипт" на панели заданий. 

**Настройка решения**

1. В обозревателе решений щелкните правой кнопкой мыши проект C# и выберите пункт **Свойства**.
2. В качестве выходного пути задайте путь к рабочему каталогу проекта LocalVertexHost. Путь к рабочему каталогу проекта LocalVertexHost можно получить в его свойствах.
3. Создайте проект C#, чтобы поместить PDB-файл в рабочий каталог проекта LocalVertexHost, или вручную скопируйте PDB-файл в эту папку.
4. В окне **Параметры исключений**проверьте исключения среды CLR:

![Azure Data Lake Analytics U-SQL отладка visual studio настройка](./media/data-lake-analytics-debug-u-sql-jobs/data-lake-analytics-clr-exception-setting.png)

## <a name="debug-the-job"></a>Отладка задания
Когда вы скачали вершины, создали решение отладки и настроили среду, можно приступить к отладке кода U-SQL.

1. В обозревателе решений щелкните правой кнопкой мыши созданный проект **LocalVertexHost**, выберите элемент **Отладка** и щелкните **Запустить новый экземпляр**. Проект LocalVertexHost необходимо указать как запускаемый. При первом запуске может отобразиться следующее сообщение, которое можно игнорировать. Прежде чем откроется окно отладки, возможно, потребуется подождать до одной минуты.
   
   ![Azure Data Lake Analytics U-SQL отладка visual studio предупреждение](./media/data-lake-analytics-debug-u-sql-jobs/data-lake-analytics-visual-studio-u-sql-debug-warning.png)
2. Для устранения проблемы воспользуйтесь процедурой отладки на основе Visual Studio (контрольные значения, переменные, и т. д.). 
3. После определения проблемы внесите изменения в код и повторно выполните сборку проекта C#. Затем можно снова выполнить проверку и повторять эти действия, пока не будут устранены все проблемы. Когда отладка будет успешно завершена, в окне вывода отобразится следующее сообщение: 
   
     Программа LocalVertexHost.exe завершила работу с кодом 0 (0x0).

## <a name="resubmit-the-job"></a>Повторная отправка задания
По завершении отладки кода U-SQL можно повторно отправить невыполненное задание.

1. Зарегистрируйте новые DLL-сборки в базе данных ADLA.
   
   1. Из обозревателя сервера или Cloud Explorer в инструменте Visual Studio для Data Lake разверните узел **Базы данных** . 
   2. Щелкните правой кнопкой мыши пункт "Сборки", чтобы зарегистрировать сборки. 
   3. Зарегистрируйте свои новые DLL-сборки в базе данных ADLA.
2. Или скопируйте код C# в Script.usql.cs (файл кода программной части C#).
3. Повторно отправьте задание.

## <a name="next-steps"></a>Дальнейшие действия
* [Учебник. Приступая к работе с языком U-SQL для аналитики озера данных Azure](data-lake-analytics-u-sql-get-started.md)
* [Учебник. Разработка скриптов U-SQL с помощью средств озера данных для Visual Studio](data-lake-analytics-data-lake-tools-get-started.md)
* [Разработка определяемых пользователем операторов U-SQL для заданий аналитики озера данных Azure](data-lake-analytics-u-sql-develop-user-defined-operators.md)




<!--HONumber=Nov16_HO3-->


