<properties 
   pageTitle="Отладка заданий U-SQL | Microsoft Azure" 
   description="Узнайте, как выполнять отладку заданий U-SQL, завершившихся сбоем, с помощью Visual Studio. " 
   services="data-lake-analytics" 
   documentationCenter="" 
   authors="mumian" 
   manager="paulettm" 
   editor="cgronlun"/>
 
<tags
   ms.service="data-lake-analytics"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="big-data" 
   ms.date="07/26/2016"
   ms.author="jgao"/>



#Отладка заданий U-SQL 

Узнайте, как выполнять отладку заданий U-SQL, завершившихся сбоем из-за ошибок в пользовательском коде, используя инструменты Visual Studio для Azure Data Lake. Инструмент Visual Studio для Data Lake позволяет пользователям скачивать скомпилированный код и необходимые данные вершин из кластера для трассировки и отладки невыполненных заданий.

>[AZURE.NOTE] Visual Studio может зависнуть или аварийно завершить работу, если у вас не установлены следующие два обновления для Windows: [Распространяемый компонент Microsoft Visual C++ 2015, обновление 2](https://www.microsoft.com/download/details.aspx?id=51682) и [Универсальная среда выполнения C для Windows](https://www.microsoft.com/download/details.aspx?id=50410&wa=wsignin1.0).


##Предварительные требования
-	Предполагается, что вы ознакомились со статьей [о начале работы](data-lake-analytics-data-lake-tools-get-started.md).

## Создание и настройка проектов отладки

При открытии невыполненного задания в инструменте Visual Studio для Data Lake вы увидите оповещение. Подробные сведения об ошибке отобразятся на вкладке "Ошибка" и в желтой области оповещений в верхней части окна.

![Azure Data Lake Analytics U-SQL отладка visual studio скачивание вершины](./media/data-lake-analytics-debug-u-sql-jobs/data-lake-analytics-download-vertex.png)

**Скачивание вершин и создание решения отладки**

1.	Откройте в Visual Studio задание U-SQL, завершившееся сбоем.
2.	Нажмите кнопку **Скачать**, чтобы скачать все необходимые ресурсы и входные потоки. Нажмите кнопку **Повторить**, если не удалось скачать.
3.	После завершения скачивания нажмите кнопку **Открыть**, чтобы создать проект локальной отладки. Будет создано новое решение Visual Studio с именем **VertexDebug**, а в нем будет создан пустой проект **LocalVertexHost**.

Если в коде программной части U-SQL (файл Script.usql.cs) используются определяемые пользователем операторы, то необходимо создать проект библиотеки классов C# с кодом определяемых пользователем операторов и включить проект в решение VertexDebug. Если вы зарегистрировали DLL-сборки в базе данных Data Lake Analytics, необходимо добавить исходный код сборок в решение VertexDebug.
 

**Настройка проекта**

1.	В обозревателе решений щелкните правой кнопкой мыши **LocalVertexHost** и выберите пункт **Свойства**.
2.	В качестве выходного пути задайте путь к рабочему каталогу проекта LocalVertexHost. Путь к рабочему каталогу проекта LocalVertexHost можно получить в его свойствах.
3.	Создайте проект C#, чтобы поместить PDB-файл в рабочий каталог проекта LocalVertexHost, или вручную скопируйте PDB-файл в эту папку.
4.	В окне **Параметры исключений** проверьте исключения среды CLR:

![Azure Data Lake Analytics U-SQL отладка visual studio настройка](./media/data-lake-analytics-debug-u-sql-jobs/data-lake-analytics-clr-exception-setting.png)
 
##Отладка задания

После того, как вы скачали вершины, создали решение отладки и настроили среду, можно приступить к отладке кода U-SQL.

1.	В обозревателе решений щелкните правой кнопкой мыши проект **LocalVertexHost**, выберите пункт **Отладка**, а затем щелкните **Запустить новый экземпляр**. Проект LocalVertexHost необходимо указать как запускаемый. При первом запуске может отобразиться следующее сообщение, которое можно игнорировать. Прежде чем откроется окно отладки, возможно, потребуется подождать до одной минуты.
 
    ![Azure Data Lake Analytics U-SQL отладка visual studio предупреждение](./media/data-lake-analytics-debug-u-sql-jobs/data-lake-analytics-visual-studio-u-sql-debug-warning.png)

4.	Для устранения проблемы воспользуйтесь процедурой отладки на основе Visual Studio (контрольные значения, переменные, и т. д.).
5.	После определения проблемы внесите изменения в код и повторно выполните сборку проекта C#. Затем можно снова выполнить проверку и повторять эти действия, пока не будут устранены все проблемы. Когда отладка будет успешно завершена, в окне вывода отобразится следующее сообщение:

        The Program ‘LocalVertexHost.exe’ has exited with code 0 (0x0).
 
##Повторная отправка задания

По завершении отладки кода U-SQL можно повторно отправить невыполненное задание.

1. Зарегистрируйте новые DLL-сборки в базе данных ADLA.

    1.	Из обозревателя сервера или Cloud Explorer в инструменте Visual Studio для Data Lake разверните узел **Базы данных**.
    2.	Щелкните правой кнопкой мыши пункт "Сборки", чтобы зарегистрировать сборки.
    3.	Зарегистрируйте свои новые DLL-сборки в базе данных ADLA.
 
2.	Или скопируйте код C# в Script.usql.cs (файл кода программной части C#).
3.	Повторно отправьте задание.

##Дальнейшие действия

- [Учебник. Приступая к работе с языком U-SQL для аналитики озера данных Azure](data-lake-analytics-u-sql-get-started.md)
- [Учебник. Разработка скриптов U-SQL с помощью средств озера данных для Visual Studio](data-lake-analytics-data-lake-tools-get-started.md)
- [Разработка определяемых пользователем операторов U-SQL для заданий аналитики озера данных Azure](data-lake-analytics-u-sql-develop-user-defined-operators.md)

<!---HONumber=AcomDC_0727_2016-->