<properties 
   pageTitle="Разработка скриптов U-SQL с помощью средств озера данных для Visual Studio | Azure" 
   description="Сведения об установке средств озера данных для Visual Studio, разработке и тестировании скриптов U-SQL." 
   services="data-lake-analytics" 
   documentationCenter="" 
   authors="mumian" 
   manager="paulettm" 
   editor="cgronlun"/>
 
<tags
   ms.service="data-lake-analytics"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="big-data" 
   ms.date="10/28/2015"
   ms.author="jgao"/>

# Учебник. Разработка скриптов U-SQL с помощью средств озера данных для Visual Studio

[AZURE.INCLUDE [get-started-selector](../../includes/data-lake-analytics-selector-get-started.md)]


Узнайте, как установить средства озера данных для Visual Studio и как их использовать для создания и тестирования скриптов U-SQL.

U-SQL — это высокомасштабируемый и расширяемый язык для подготовки, преобразования и анализа любых данных в озере данных и не только. Дополнительные сведения см. в [справке по U-SQL](http://go.microsoft.com/fwlink/p/?LinkId=691348).


**Предварительные требования**

- **Visual Studio 2015, Visual Studio 2013 с обновлением 4 или Visual Studio 2012 с установленным Visual C++** 
- **Microsoft Azure SDK для .NET (версии 2.5 или выше)**. Вы можете установить его с помощью [установщика веб-платформы](http://www.microsoft.com/web/downloads/platform.aspx).
- **[Средства озера данных для Visual Studio](http://aka.ms/adltoolsvs)**. 

    После установки средств озера данных для Visual Studio вы увидите меню «Озеро данных» в Visual Studio:
    
    ![Меню U-SQL в Visual Studio](./media/data-lake-analytics-data-lake-tools-get-started/data-lake-analytics-data-lake-tools-menu.png)

- **Ознакомьтесь со следующими разделами в статье [Начало работы с аналитикой озера данных Azure с использованием портала предварительной версии Azure](data-lake-analytics-get-started-portal.md)**.

	- [Создание учетной записи аналитики озера данных Azure](data-lake-analytics-get-started-portal.md#create_adl_analytics_account).
	- [Передача файла SearchLog.tsv в учетную запись хранения озера данных по умолчанию](data-lake-analytics-get-started-portal.md#update-data-to-the-default-adl-storage-account).

	Средства озера данных не поддерживают создание учетных записей аналитики озера данных. Поэтому ее необходимо создать с помощью портала предварительной версии Azure, Azure PowerShell, пакета SDK .NET или интерфейса командной строки Azure. Чтобы выполнить задание аналитики озера данных, потребуются некоторые данные. Несмотря на то что средства озера данных поддерживают передачу данных, чтобы упростить работу с этим учебником, для передачи примера данных мы используем портал.

## Подключение к Azure

**Подключение к аналитике озера данных**

1. Откройте Visual Studio.
2. В меню **U-SQL** выберите **Параметры и настройки**.
4. Выберите **Вход** или **Изменить пользователя**, если кто-то выполнил вход, и выполните инструкции для входа.
5. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно параметров и настроек.

**Просмотр учетных записей аналитики озера данных**

1. В Visual Studio откройте **обозреватель серверов**, нажав клавиши **CTRL + ALT + S**.
2. В **обозревателе серверов** разверните **Azure**, а затем — **Аналитика озера данных**. Будет выведен список учетных записей аналитики озера данных, если они есть. Создавать учетные записи аналитики озера данных из Visual Studio нельзя. Чтобы создать учетную запись, см. раздел [Начало работы с аналитикой озера данных Azure с помощью портала предварительной версии Azure](data-lake-analytics-get-started-portal.md) или [Начало работы с аналитикой озера данных Azure с помощью Azure PowerShell](knoa-get-started-powershell.md).

## Передача исходных файлов данных

Вы уже передали некоторые данные в разделе **Предварительные требования** ранее в этом учебнике.

Если вы хотите использовать собственные данные, ниже приводятся процедуры передачи данных с помощью средств озера данных.

**Передача файла в зависимую учетную запись озера данных Azure**

1. В **обозревателе серверов** разверните узлы **Azure**, **Аналитика озера данных**, учетную запись аналитики озера данных и **учетные записи хранения**. Появятся учетная запись хранения озера данных по умолчанию, связанные учетные записи хранения озера данных и связанные учетные записи хранения Azure. Учетная запись озера данных по умолчанию имеет метку «Учетная запись хранения по умолчанию».
2. Щелкните правой кнопкой мыши учетную запись хранения озера данных по умолчанию и выберите пункт меню **Обозреватель**. Откроется панель средств озера данных для обозревателя Visual Studio. Слева показано дерево, справа — содержимое.
3. Перейдите в папку, в которую нужно передать файлы. 
4. Щелкните правой кнопкой мыши в пустом месте и выберите пункт меню **Передать**. 

	![Проект U-SQL в Visual Studio](./media/data-lake-analytics-data-lake-tools-get-started/data-lake-analytics-data-lake-tools-upload-files.png)

**Передача файла в учетную запись хранения больших двоичных объектов Azure**

1. В **обозревателе серверов** разверните узлы **Azure**, **Аналитика озера данных**, учетную запись аналитики озера данных и **учетные записи хранения**. Появятся учетная запись хранения озера данных по умолчанию, связанные учетные записи хранения озера данных и связанные учетные записи хранения Azure. 
2. Разверните учетную запись хранения Azure.
3. Щелкните правой кнопкой мыши контейнер, в который нужно передать файлы, и нажмите кнопку **Обозреватель**.
4. Перейдите в папку, в которую нужно передать файлы. 
5. Щелкните правой кнопкой мыши в пустом месте и выберите пункт меню **Передать**. 

## Разработка и тестирование скриптов U-SQL 

Задания аналитики озера данных записываются на языке U-SQL. Дополнительные сведения о языке U-SQL см. в статье [Начало работы с языком U-SQL](data-lake-analytics-u-sql-get-started.md) и в [Справочнике по языку U-SQL](http://go.microsoft.com/fwlink/?LinkId=691348).

**Создание и отправка задания аналитики озера данных**

1. В меню **Файл** выберите команду **Создать**, а затем — **Проект**.
2. Выберите тип **Проект U-SQL**.

	![Новый проект U-SQL в Visual Studio](./media/data-lake-analytics-data-lake-tools-get-started/data-lake-analytics-data-lake-tools-new-project.png)

3. Нажмите кнопку **ОК**. Visual Studio создает решение с файлом **Script.usql**.
4. Скопируйте следующий скрипт в файл **Script.usql**:

        @searchlog =
            EXTRACT UserId          int,
                    Start           DateTime,
                    Region          string,
                    Query           string,
                    Duration        int?,
                    Urls            string,
                    ClickedUrls     string
            FROM "/Samples/Data/SearchLog.tsv"
            USING Extractors.Tsv();
        
        OUTPUT @searchlog   
            TO "/Output/SearchLog-from-Data-Lake.csv"
        USING Outputters.Csv();

	Этот скрипт U-SQL считывает файл исходных данных с помощью **Extractors.Tsv()**, а затем создает CSV-файл с помощью **Outputters.Csv()**.
    
    Не меняйте эти два пути, если только исходный файл не был скопирован в другое место. Аналитика озера данных создаст выходную папку, если ее не существует.
	
	Проще использовать относительные пути для файлов, которые хранятся в учетных записях озера данных по умолчанию. Также можно использовать абсолютные пути. Например:
    
        adl://<Data LakeStorageAccountName>.azuredatalakestore.net:443/Samples/Data/SearchLog.tsv
        
    Необходимо использовать абсолютные пути для доступа к файлам в связанных учетных записях хранения. Для файлов, хранящихся в связанной учетной записи хранения Azure, используется следующий синтаксис:
    
        wasb://<BlobContainerName>@<StorageAccountName>.blob.core.windows.net/Samples/Data/SearchLog.tsv

    >[AZURE.NOTE]Контейнер больших двоичных объектов Azure с разрешениями на доступ к общедоступным большим двоичным объектам или общедоступным контейнерам в настоящее время не поддерживается.

	Обратите внимание на следующие возможности.

	- **IntelliSense**
	 
		Автоматическое заполнение имени и отображение членов для наборов строк, классов, баз данных, схем и пользовательских объектов (UDO).
		 
		IntelliSense для сущностей каталога (базы данных, схемы, таблицы, пользовательские объекты и т. д.) связывается с вашей учетной записью вычислений. Узнать текущую активную учетную запись вычислений, базу данных и схему можно в верхней панели инструментов, менять их можно в раскрывающихся списках.
 
	- **Автоформат**
	
		Пользователь может менять отступы в скрипте в соответствии со структурой кода в меню Правка -> Дополнительно:
  
		- Форматировать документ (Ctrl + E, D): форматирует весь документ   
		- Форматировать выделенный фрагмент (Ctrl + K, Ctrl + F): форматирует выделенный фрагмент. Если фрагмент не выделен, будет отформатирована строка, в которой находится курсор.  
		
		Все правила форматирования можно настроить в меню Сервис -> Параметры -> Текстовый редактор - > SIP -> Форматирование.  
	- **Автоматический отступ**
	 
		Средства озера данных для Visual Studio позволяют автоматически вставлять отступы для выражений при написании скриптов. По умолчанию эта функция отключена. Чтобы включить ее, нужно выбрать параметр «Включить автоматический отступ» в меню U-SQL -> Параметры и настройки -> Параметры.

	- **Переход к определению и поиск всех ссылок**
	
		Щелкните правой кнопкой мыши имя набора строк, параметра, столбца, пользовательского объекта и пр. Выберите команду «Перейти к определению» (F12), чтобы перейти к определению объекта. Команда «Найти все ссылки» (Shift + F12) покажет все ссылки.

	- **Вставка пути Azure**
		
		Вместо того чтобы запоминать путь к файлу Azure и вводить его вручную при написании скриптов, средства озера данных для Visual Studio предлагают простой способ. Для этого щелкните правой кнопкой мыши в редакторе и выберите команду «Вставить путь Azure». Перейдите к файлу в диалоговом окне браузера больших двоичных объектов Azure. Нажмите кнопку ОК, путь к файлу будет вставлен в код.

5. Укажите учетную запись аналитики озера данных, базу данных и схему:

	![Отправка проекта U-SQL в Visual Studio](./media/data-lake-analytics-data-lake-tools-get-started/data-lake-analytics-data-lake-tools-submit-job.png)

    Дополнительные сведения см. в разделе [Использование каталога U-SQL](data-lake-analytics-use-u-sql-catalog.md).

5. В **обозревателе решений** щелкните правой кнопкой мыши **Script.usql** и выберите команду **Создать скрипт**. Проверьте результат на панели вывода.
6. В **обозревателе решений** щелкните правой кнопкой мыши **Script.usql** и выберите команду **Отправить сценарий**. Либо можно нажать кнопку **Отправить** на панели Script.usql. См. предыдущий снимок экрана. Щелкните стрелку вниз рядом с кнопкой «Отправить», чтобы отправить с использованием расширенных параметров.
7. Укажите **Имя задания**, проверьте **Учетную запись аналитики** и нажмите кнопку **Отправить**. Результаты отправки и ссылка на задание появятся в окне результатов средств озера данных для Visual Studio после завершения отправки.

	![Отправка проекта U-SQL в Visual Studio](./media/data-lake-analytics-data-lake-tools-get-started/data-lake-analytics-data-lake-tools-submit-job-advanced.png)

8. Чтобы увидеть текущее состояние задания, нажмите кнопку «Обновить». Если задание завершилось успешно, также будут показаны **График задания**, **Операции с метаданными**, **Журнал состояний**, **Диагностика**.

	![График выполнения задания аналитики озера данных U-SQL в Visual Studio](./media/data-lake-analytics-data-lake-tools-get-started/data-lake-analytics-data-lake-tools-performance-graph.png)

	* Обзор задания. Показывает сводку по текущему заданию, например состояние, ход выполнения, время выполнения, имя среды выполнения, отправителя и т. д.   
	* Сведения о задании. Подробные сведения по этому заданию, включая скрипт, ресурсы, представление выполнения вершин.
	* График задания. Предлагается четыре графика для визуализации сведений о задании, включая ход выполнения, считанные данные, записанные данные, время выполнения, среднее время выполнения на каждом узле, пропускную способность ввода, пропускную способность вывода.
	* Операции с метаданными. Показываются все операции с метаданными.
	* Журнал состояний. 
	* Диагностика. Средства озера данных для Visual Studio ведут автоматическую диагностику выполнения задания. При возникновении ошибок или проблем с производительностью в ваших заданиях будут выводиться предупреждения. Дополнительные сведения см. в разделе «Диагностика заданий» (link TBD). 
	
**Проверка состояния задания**

1. В обозревателе серверов разверните узлы **Azure**, **Аналитика озера данных** и учетную запись аналитики озера данных.
2. Дважды щелкните **Задания** для вывода списка заданий.
2. Выберите задание, чтобы показать его состояние.

**Просмотр выходных данных задания**

1. В **обозревателе серверов** разверните узлы **Azure** и **Аналитика озера данных**, разверните учетную запись аналитики озера данных и **Учетные записи хранения**, а затем щелкните правой кнопкой мыши учетную запись хранения озера данных по умолчанию и выберите команду **Обозреватель**. 
2.  Дважды щелкните **выходные данные**, чтобы открыть папку.
3.  Дважды щелкните файл **SearchLog-From-adltools.csv**.


###Воспроизведение задания 

Воспроизведение задания позволяет отслеживать ход выполнения задания и визуально обнаруживать проблемы производительности и узкие места. Эта функция может использоваться до завершения задания (т. е. во время активного выполнения задания), а также после завершения выполнения. Воспроизведение во время выполнения задания позволяет пользователю воспроизвести ход выполнения до текущего времени.

**Просмотр хода выполнения задания**

1. Нажмите кнопку **Загрузить профиль** в правом верхнем углу. См. предыдущий снимок экрана.
2. Нажмите кнопку «Воспроизвести» в левом нижнем углу для просмотра хода выполнения задания. 
3. Воспроизведение можно остановить с помощью кнопки **Пауза**, также можно перетащить ползунок хода выполнения в нужное положение. 


###Тепловая карта 

Средства озера данных для Visual Studio позволяют пользователю выбирать подходящие наложенные цвета в представлении задания для выделения хода выполнения, ввода-вывода данных, времени выполнения, пропускной способности ввода-вывода на каждом этапе. Благодаря этому можно наглядно и напрямую определять потенциальные проблемы и распределение свойств задания. Отображаемый источник данных можно выбрать в раскрывающемся списке.



##См. также

Для начала работы с аналитикой озера данных с использованием различных средств см. следующие статьи:

- [Начало работы с аналитикой озера данных с помощью портала предварительной версии Azure](data-lake-analytics-get-started-portal.md)
- [Начало работы с аналитикой озера данных с помощью Azure PowerShell](data-lake-analytics-get-started-powershell.md)
- [Начало работы с аналитикой озера данных с помощью пакета SDK .NET](data-lake-analytics-get-started-net-sdk.md)

Другие темы по разработке:

- [Анализ журналов веб-сайтов с помощью аналитики озера данных](data-lake-analytics-analyze-weblogs.md)
- [Разработка скриптов U-SQL с помощью средств озера данных для Visual Studio](data-lake-analytics-data-lake-tools-get-started.md)
- [Начало работы с языком U-SQL в аналитике озера данных Azure](data-lake-analytics-u-sql-get-started.md)
- [Разработка пользовательских операторов U-SQL для заданий аналитики озера данных](data-lake-analytics-u-sql-user-defined-operators.md)

<!---HONumber=Nov15_HO1-->