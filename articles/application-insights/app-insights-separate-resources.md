---
title: "Мониторинг среды разработки, среды тестирования и рабочей среды в Azure Application Insights | Документация Майкрософт"
description: "Отслеживание производительности и использования приложения на разных этапах разработки"
services: application-insights
documentationcenter: 
author: alancameronwills
manager: carmonm
ms.assetid: 578e30f0-31ed-4f39-baa8-01b4c2f310c9
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 03/14/2017
ms.author: cfreeman
ms.translationtype: Human Translation
ms.sourcegitcommit: a087df444c5c88ee1dbcf8eb18abf883549a9024
ms.openlocfilehash: 43fb1e764c929be14d42c3d214b051aeb5367d77
ms.contentlocale: ru-ru
ms.lasthandoff: 03/15/2017


---
# <a name="separating-application-insights-resources"></a>Разделение ресурсов Application Insights
Данные телеметрии следует отправлять из различных компонентов и версий приложения в различные ресурсы Application Insights или объединять их в одном? В этой статье рассматриваются практические рекомендации и необходимые методы.

Сначала давайте разберемся, в чем заключается вопрос. Полученные из приложения данные хранятся и обрабатываются службой Application Insights в *ресурсе*Microsoft Azure. Каждый ресурс идентифицируется с помощью *ключа инструментирования* (ikey). В приложении ключ предоставляется пакету SDK службы Application Insights, чтобы тот мог отправлять собранные данные в соответствующий ресурс. Ключ можно указать в коде или в файле ApplicationInsights.config. Изменив ключ в пакете SDK, можно направить данные в другие ресурсы. 

В самом простом случае при регистрации приложения с помощью Application Insights вы можете создать ресурс в Application Insights. В Visual Studio это можно сделать в диалоговом окне *Настройка Application Insights* или *Добавление Application Insights*.

Если это веб-сайт большого объема, его можно развернуть на нескольких экземплярах сервера.

В более сложных сценариях используется система, которая состоит из нескольких компонентов, например веб-сайта и процессора серверной части. 

## <a name="when-to-use-separate-ikeys"></a>В каких случаях следует использовать отдельные ключи инструментирования ikey
Ниже приведены некоторые общие рекомендации.

* При наличии независимо развертываемой единицы приложения, работающей на наборе экземпляров серверов, которые можно масштабировать в большую или меньшую сторону независимо от других компонентов, как правило, она будет сопоставляться с одним ресурсом, т. е. будет один ключ инструментирования.
* В противоположность этому отдельные ключи инструментирования ikey рекомендуется использовать по следующим причинам:
  * легко читаемые отдельные показатели из отдельных компонентов;
  * хранение небольшого и большего объема данных телеметрии отдельно, в результате чего регулирование, квоты и выборка на одном потоке не влияют друг на друга;
  * отдельные конфигурации оповещений, экспорта и рабочих элементов;
  * распределение [ограничений](app-insights-pricing.md#limits-summary) , таких как квота на данные телеметрии, объем регулирования и количество веб-тестов;
  * код в процессе разработки и тестирования следует отправить в ключ инструментирования ikey, отличный от ключа для рабочей метки.  

Многие возможности портала Application Insights разработаны с учетом этих рекомендаций. Например, серверы просматривают сегменты на экземпляре сервера и делают предположение, что данные телеметрии об одном логическом компоненте могут поступать из нескольких экземпляров сервера.

## <a name="single-ikey"></a>Один ключ инструментирования ikey
Данные телеметрии из нескольких компонентов отправляются в один ключ инструментирования ikey.

* Добавьте свойство для всей телеметрии, что позволит сегментировать и фильтровать идентификатор компонента. Идентификатор роли добавляется в данные телеметрии автоматически, но в других случаях для добавления свойства используйте [инициализатор телеметрии](app-insights-api-filtering-sampling.md#add-properties) .
* Обновите пакеты SDK для Application Insights в различных компонентах одновременно. Данные телеметрии для одного ключа инструментирования имеют ту же версию, что и пакет SDK.

## <a name="separate-ikeys"></a>Отдельные ключи инструментирования ikey
Если у вас есть несколько ключей инструментирования ikey для разных компонентов приложений:

* Создайте [панель мониторинга](app-insights-dashboards.md) для просмотра основных данных телеметрии из вашего приложения логики, а также из разных компонентов приложения. Панели мониторинга можно совместно использовать, поэтому разные группы могут использовать одно представление логической системы.
* Систематизируйте [группы ресурсов](app-insights-resources-roles-access-control.md) на уровне группы. Разрешения на доступ назначаются с помощью группы ресурсов. К ним также относятся разрешения на настройку оповещений. 
* Используйте [шаблоны Azure Resource Manager и Powershell](app-insights-powershell.md) , чтобы управлять артефактами, например правилами оповещений и веб-тестами.

## <a name="separate-ikeys-for-devtest-and-production"></a>Отдельные ключи инструментирования ikey для разработки, тестирования и эксплуатации
Чтобы упростить автоматическое изменение ключа после выпуска приложения, задайте ключ инструментирования ikey в коде, а не в файле ApplicationInsights.config.

(Если вы используете облачную службу Azure, есть [другой метод настройки отдельных ключей инструментирования ikey](app-insights-cloudservices.md).)

### <a name="dynamic-ikey"></a> Динамический ключ инструментирования
Задайте ключ в методе инициализации, таком как global.aspx.cs, в службе ASP.NET:

*C#*

    protected void Application_Start()
    {
      Microsoft.ApplicationInsights.Extensibility.
        TelemetryConfiguration.Active.InstrumentationKey = 
          // - for example -
          WebConfigurationManager.AppSettings["ikey"];
      ...

В этом примере ключи инструментирования (ikey) для различных ресурсов приводятся в различных версиях файла веб-конфигурации. При смене файла веб-конфигурации, что можно сделать в рамках сценария выпуска, сменится и целевой ресурс.

### <a name="web-pages"></a>Веб-страницы
Ключ инструментирования iKey также используется в веб-страницах приложения, в [сценарии, который вы получили в колонке быстрого запуска](app-insights-javascript.md). Вместо того чтобы вставлять его в код сценария напрямую, генерируйте его из состояния сервера. Например, в приложении ASP.NET:

*JavaScript в Razor*

    <script type="text/javascript">
    // Standard Application Insights web page script:
    var appInsights = window.appInsights || function(config){ ...
    // Modify this part:
    }({instrumentationKey:  
      // Generate from server property:
      "@Microsoft.ApplicationInsights.Extensibility.
         TelemetryConfiguration.Active.InstrumentationKey"
    }) // ...


## <a name="creating-an-additional-application-insights-resource"></a>Создание дополнительного ресурса Application Insights
Если вы решите разделить данные телеметрии для разных компонентов приложения или для разных меток (разработки, тестирования или эксплуатации) одного и того же компонента, вам понадобится создать новый ресурс Application Insights.

Перейдите по адресу [portal.azure.com](https://portal.azure.com)и добавьте новый ресурс Application Insights.

![Нажмите "Создать" и "Application Insights"](./media/app-insights-separate-resources/01-new.png)

* **Тип приложения** определяет содержимое колонки «Обзор» и свойства, доступные в [обозревателе метрик](app-insights-metrics-explorer.md)Microsoft Azure. Если тип вашего приложения не отображается, выберите тип веб-ресурса для веб-страниц.
* **Группа ресурсов** — удобный способ для управления свойствами наподобие [контроля доступа](app-insights-resources-roles-access-control.md). Для разработки, тестирования и эксплуатации можно использовать отдельные группы ресурсов.
* **Подписка** представляет собой учетную запись для оплаты в Azure.
* **Расположение** – это место, в котором мы храним ваши данные. На данном этапе его нельзя изменить. 
* **Добавить на панель мониторинга** позволяет поместить плитку для быстрого доступа к ресурсу на главную страницу Azure. 

Создание ресурса занимает всего несколько секунд. Как только ресурс будет создан, появится предупреждение.

(Для автоматического создания ресурсов можно написать [сценарий PowerShell](app-insights-powershell-script-create-resource.md) .)

## <a name="getting-the-instrumentation-key"></a>Получение ключа инструментирования
Ключ инструментирования идентифицирует созданный вами ресурс. 

![Щелкните Essentials, выделите ключ инструментирования и нажмите клавиши CTRL + C.](./media/app-insights-separate-resources/02-props.png)

Вам потребуются ключи инструментирования всех ресурсов, в которые приложение будет отправлять данные.


