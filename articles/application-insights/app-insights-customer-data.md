---
title: Руководство по хранению персональных данных в Azure Application Insights | Документация Майкрософт
description: В этой статье объясняется, как управлять персональными данными, которые хранятся в Azure Application Insights, и описываются методы обнаружения и удаления таких данных.
services: application-insights
documentationcenter: ''
author: mrbullwinkle
manager: carmonm
ms.assetid: ea2a28ed-4cd9-4006-bd5a-d4c76f4ec20b
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: conceptual
ms.date: 05/18/2018
ms.reviewer: Evgeny.Ternovsky
ms.author: mbullwin
ms.openlocfilehash: 95e421278b46015e761764792e11dec0351b9785
ms.sourcegitcommit: 6f6d073930203ec977f5c283358a19a2f39872af
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "35294427"
---
# <a name="guidance-for-personal-data-stored-in-application-insights"></a>Руководство по хранению персональных данных в Application Insights

Хранилище данных Application Insights может содержать персональные данные. В этой статье описано, где в Application Insights такие данные встречаются чаще всего, а также перечислены доступные возможности для обработки этих данных.

[!INCLUDE [GDPR-related guidance](../../includes/gdpr-dsr-and-stp-note.md)]

## <a name="strategy-for-personal-data-handling"></a>Стратегия обработки персональных данных

В конечном счете стратегия обработки персональных данных определяется вами и вашей компанией (если она нужна). Мы здесь лишь предлагаем некоторые из возможных подходов. Варианты перечислены в порядке убывания предпочтительности с технической точки зрения.
* Везде, где возможно, старайтесь не собирать данные, маскируйте их, анонимизируйте или изменяйте другим способом так, чтобы они перестали считаться _персональными_. Этот метод является наиболее предпочтительным, и он позволит вам обойтись без разработки дорогостоящей и влияющей на всю работу стратегии обработки данных.
* Если это совершенно невозможно, попробуйте нормализовать данные, чтобы снизить нагрузку на платформу данных и производительность. Например, можно не сохранять в журнале идентификатор пользователя в явном виде, а создать уточняющий запрос к данным, который будет сопоставлять имя пользователя и сведения о нем с внутренним идентификатором, который сохраняется в другом месте. При такой схеме вам будет достаточно удалить одну строку в таблице подстановки, если пользователь потребует удалить его персональные данные. 
* И, наконец, если совершенно необходимо собирать личные данные, основывайте этот процесс на API для очистки и существующем пути через API запросов, чтобы соблюдать любые требования к экспорту и удалению персональных данных, связанных с пользователем.

## <a name="where-to-look-for-private-data-in-application-insights"></a>Где искать персональные данные в Application Insights?

Хранилище Application Insights обеспечивает полную гибкость, позволяя переопределить любое поле пользовательскими значениями в предлагаемой по умолчанию схеме данных. Таким образом, невозможно точно определить, где размещаются персональные данные в конкретном приложении. Но есть несколько типичных расположений, с которых есть смысл начинать поиск:

* *IP-адреса*. По умолчанию Application Insights маскирует все значения в полях IP-адресов, заменяя их строкой 0.0.0.0, но для сохранения сведений о сеансах в них часто сохраняются реальные значения клиентских IP-адресов. Приведенный ниже запрос Analytics позволяет найти все таблицы, в которых содержатся поля IP-адресов со значениями, отличными от 0.0.0.0, за последние 24 часа:
    ```
    search client_IP != "0.0.0.0"
    | where timestamp > ago(1d)
    | summarize numNonObfuscatedIPs_24h = count() by $table
    ```
* *Идентификаторы пользователей*. По умолчанию Application Insights создает случайные идентификаторы для отслеживания пользователей и сеансов. Но эти поля в реальных приложениях часто переопределяются так, чтобы сохранять реальные идентификаторы, имеющие смысл для приложения. Например: имена пользователей, GUID AAD и т. д. Такие идентификаторы часто включаются в категорию персональных данных, а значит требуют соответствующей обработки. Мы рекомендуем всегда маскировать или анонимизировать эти идентификаторы. Чаще всего такие значения сохраняются в полях с такими именами, как session_Id, user_Id, user_AuthenticatedId, user_AccountId или даже customDimensions.
* *Пользовательские данные*. Application Insights позволяет добавлять набор пользовательских измерений к любому типу данных. Эти измерения могут включаться в *любые* данные. Чтобы найти все пользовательские измерения, собранные за последние 24 часа, используйте следующий запрос:
    ```
    search * 
    | where isnotempty(customDimensions)
    | where timestamp > ago(1d)
    | project $table, timestamp, name, customDimensions 
    ```
* *Данные в памяти и в процессе передачи*. Application Insights отслеживает исключения, запросы, вызовы зависимостей и трассировки. Сбор персональных данных часто происходит на уровне вызовов HTTP и кода. Изучите таблицы с информацией об исключениях, запросах, зависимостях и трассировках, чтобы обнаружить подобные данные. Везде, где возможно, используйте [инициализаторы телеметрии](https://docs.microsoft.com/azure/application-insights/app-insights-api-filtering-sampling) для маскировки таких данных.
* *Записи Snapshot Debugger*. Функция [Snapshot Debugger](https://docs.microsoft.com/azure/application-insights/app-insights-snapshot-debugger) в Application Insights позволяет получать моментальные снимки для отладки при возникновении любого исключения в рабочем экземпляре приложения. Моментальные снимки предоставляют полную трассировку стека вызовов, которые привели к исключению, в том числе значения всех локальных переменных на каждом уровне этого стека. К сожалению, эта функция не позволяет выборочно удалять точки копирования или с помощью программных средств обращаться к данным в моментальном снимке. Таким образом, если настроенное по умолчанию время хранения моментальных снимков не согласуется с требованиями по соответствию, мы рекомендуем не использовать эту функцию.

## <a name="how-to-export-and-delete-private-data"></a>Как экспортировать и удалять персональные данные

Мы __настоятельно__ рекомендуем во всех возможных случаях пересмотреть политику сбора данных так, чтобы сбор персональных данных не выполнялся, а также маскировать, анонимизировать или иным образом изменять собираемые данные, чтобы они перестали считаться персональными. Обработка данных после сбора потребует от вас и ваших сотрудников дополнительных затрат на создание и автоматизацию стратегии, на создание клиентского интерфейса для взаимодействия с персональными данными, а также на текущее обслуживание. Кроме того, такие вычисления существенно увеличат нагрузку на Application Insights, а большое количество одновременных вызовов API запросов или очистки может отрицательно повлиять на работу со всеми остальными функциями Application Insights. Но при этом мы понимаем, что в некоторых сценариях невозможно избежать сбора персональных данных. В таких случаях следует обрабатывать эти данные так, как описано в этом разделе.

[!INCLUDE [GDPR-related guidance](../../includes/gdpr-intro-sentence.md)]

### <a name="view-and-export"></a>Просмотр и экспорт

Для всех запросов просмотра и экспорта данных следует использовать [API запросов](https://dev.applicationinsights.io/quickstart). Вам необходимо самостоятельно создать логику преобразования данных в требуемый вид для предоставления пользователям. [Функции Azure](https://azure.microsoft.com/services/functions/) отлично подходят для размещения такой логики.

### <a name="delete"></a>Delete

> [!WARNING]
> Операции удаления в Application Insights являются разрушительными и необратимыми! Соблюдайте особую осторожность при их выполнении.

Для сценариев обработки конфиденциальных данных мы включили в API путь "очистки". Этот путь следует применять ограниченно, поскольку с ним связаны определенные риски, потенциальное влияние на производительность и результаты обобщающих вычислений и измерений, а также на другие аспекты использования Application Insights. Выше в разделе [Стратегия обработки персональных данных](#strategy-for-personal-data-handling) представлены другие подходы к обработке персональных данных.

Операция очистки имеет настолько высокий уровень привилегий, что ни одно приложение или пользователь Azure (даже владелец ресурса) не смогут ее выполнять без явно предоставленной роли в Azure Resource Manager. Соответствующая роль называется _Data Purger_ (Очистка данных). Ее следует назначать осторожно в силу возможных потерь данных.

При назначении роли в Azure Resource Manager становятся доступными два новых пути API, полную документацию разработчика и форматы вызова для которых вы найдете по следующим ссылкам:

* [POST purge](https://docs.microsoft.com/rest/api/application-insights/components/purge) — принимает объект с параметрами удаляемых данных и возвращает идентификатор GUID.
* GET purge status — вызов POST purge возвращает заголовок x-ms-status-location со значением URL-адреса, вызов которого позволяет определить состояние операции очистки. Например: 
   ```
   x-ms-status-location: https://management.azure.com/subscriptions/[SubscriptionId]/resourceGroups/[ResourceGroupName]/providers/microsoft.insights/components/[ComponentName]/operations/purge-[PurgeOperationId]?api-version=2015-05-01
   ```

Хотя большинство операций очистки будут выполняться намного быстрее, чем указано в соглашениях об уровне обслуживания, из-за сильного влияния таких операций на платформу данных, используемую Application Insights, в соглашения об уровне обслуживания включается период 30 дней на завершение операций очистки.

## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения о сборе, обработке и защите данных можно найти в статье [Сбор и хранение данных в Application Insights](app-insights-data-retention-privacy.md).