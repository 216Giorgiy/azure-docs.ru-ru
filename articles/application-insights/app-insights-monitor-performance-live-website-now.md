<properties 
	pageTitle="Диагностика проблем производительности на запущенном веб-сайте" 
	description="Мониторинг производительности веб-сайта без необходимости его повторного развертывания. Для получения телеметрии зависимостей используйте автономно или с пакетом SDK для Application Insights." 
	services="application-insights" 
    documentationCenter=".net"
	authors="alancameronwills" 
	manager="ronmart"/>

<tags 
	ms.service="application-insights" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="ibiza" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="04/27/2015" 
	ms.author="awills"/>
 

# Установка монитора состояний Application Insights для мониторинга производительности веб-сайта

*Доступна только предварительная версия Application Insights.*

Монитор состояний Visual Studio Application Insights позволяет диагностировать исключения и проблемы с производительностью в веб-приложениях, которые работают на любых серверах IIS. Просто установите его на веб-сервере IIS, и он будет инструментировать найденные веб-приложения ASP.NET и отправлять данные на портал Application Insights для поиска и анализа. Монитор состояний можно установить на любом физическом или виртуальном сервере, к которому есть административный доступ.

![примеры диаграмм](./media/app-insights-monitor-performance-live-website-now/10-intro.png)

Вы можете выбрать один из трех указанных ниже вариантов применения Application Insights для веб-приложений IIS.

* **Во время сборки.** [Добавьте пакет SDK для Application Insights][greenbrown] в код вашего веб-приложения и вы получите следующие преимущества:
 * Комплексная стандартная телеметрия диагностики и использования. 
 * Возможность использования [API Application Insights][api] для написания собственной телеметрии для отслеживания проблем использования или диагностики.
* **Во время выполнения.** Используйте монитор состояний для инструментирования веб-приложения на сервере.
 * Мониторинг уже запущенных веб-приложений. При этом нет необходимости повторно их создавать или публиковать.
 * Комплексная стандартная телеметрия диагностики и использования.
 * Диагностика зависимостей. Получайте информацию об ошибках и низкой производительности приложения во время использования других компонентов, таких как базы данных, REST API или другие службы.
 * Устранение неполадок телеметрии.
* **Во время выполнения и во время сборки.** Выполните компиляцию пакета SDK в коде вашего веб-приложения и запустите монитор состояний на веб-сервере. Вы получаете следующие преимущества обоих способов:
 * Стандартная телеметрия диагностики и использования.
 * Диагностика зависимостей.
 * Написание пользовательской телеметрии с помощью API.
 * Устранение неполадок, связанных с пакетом SDK и телеметрией.



> [AZURE.TIP]Вы используете [веб-приложение службы приложений Azure](../app-service-web/websites-learning-map.md)? [Добавьте пакет SDK для Application Insights][greenbrown], а затем [расширение Application Insights](../insights-perf-analytics.md) на панели управления приложения в Azure.


## Установка монитора состояний Application Insights на веб-сервере IIS

1. Вам потребуется подписка на [Microsoft Azure](http://azure.com). 

1. Войдите на веб-сервер IIS с учетными данными администратора.
2. Скачайте и запустите [установщик монитора состояний](http://go.microsoft.com/fwlink/?LinkId=506648).

4. В мастере установки выполните вход в Microsoft Azure.

    ![Войдите в Azure с данными учетной записи Майкрософт.](./media/app-insights-monitor-performance-live-website-now/appinsights-035-signin.png)

5. Выберите установленное веб-приложение или веб-сайт для мониторинга и настройте ресурс, где вы будете просматривать результаты на портале Application Insights.

    ![Выберите приложение и ресурс.](./media/app-insights-monitor-performance-live-website-now/appinsights-036-configAIC.png)

    Как правило, необходимо настроить новый ресурс и [группу ресурсов][roles].

    Существующий ресурс можно использовать, если для вашего сайта настроены [веб-тесты][availability] или [мониторинг веб-клиентов][client].

6. Перезапустите IIS.

    ![Выберите «Перезапустить» в верхней части диалогового окна.](./media/app-insights-monitor-performance-live-website-now/appinsights-036-restart.png)

    Работа вашей веб-службы будет ненадолго прервана.

6. Обратите внимание, что в веб-приложения, для которых планируется мониторинг, вставлен файл ApplicationInsights.config.

    ![Найдите файл .config и файлы кода веб-приложения.](./media/app-insights-monitor-performance-live-website-now/appinsights-034-aiconfig.png)

   Также некоторые изменения вносятся в файл web.config.

### Необходимо выполнить настройку позднее?

После завершения работы мастера можно в любое время выполнить повторную настройку агента. Это можно использовать и в том случае, если агент был установлен, но на начальном этапе возникли какие-либо проблемы.

![Нажатие значка Application Insights в панели задач](./media/app-insights-monitor-performance-live-website-now/appinsights-033-aicRunning.png)

## Просмотр телеметрии производительности

Войдите на [портал предварительной версии Azure](http://portal.azure.com), перейдите в Application Insights и откройте созданный ресурс.

![Выберите «Обзор», Application Insights, а затем свое приложение.](./media/app-insights-monitor-performance-live-website-now/appinsights-08openApp.png)

Откройте колонку производительности, чтобы просмотреть зависимости и другие данные.

![Производительность](./media/app-insights-monitor-performance-live-website-now/21-perf.png)

Щелкните любую диаграмму, чтобы увидеть более подробные данные.


![](./media/app-insights-monitor-performance-live-website-now/appinsights-038-dependencies.png)

#### Зависимости

Диаграммы HTTP, SQL и AZUREBLOB отображают время отклика и количество вызовов зависимостей, т. е. внешних служб, используемых приложением.



#### Счетчики производительности

Щелкните одну из диаграмм счетчика производительности, чтобы изменить отображаемую на ней информацию. Вы также можете добавить новую диаграмму.
 
#### Исключения

![Щелкните диаграмму исключений сервера.](./media/app-insights-monitor-performance-live-website-now/appinsights-039-1exceptions.png)

Вы можете подробно рассмотреть конкретные исключения (за последние семь дней) и получить данные трассировки стека и контекста.


### Отсутствие данных телеметрии

  * С помощью своего сайта создайте данные.
  * Подождите несколько минут, пока поступят данные, а затем щелкните «Обновить».
  * Чтобы просмотреть отдельные события, откройте поиск по журналу диагностики, щелкнув плитку «Поиск». События часто отображаются в поле поиска по журналу диагностики перед появлением статистических данных на диаграммах.
  * Откройте монитор состояний и на левой панели выберите свое приложение. Проверьте, не появились ли в разделе «Уведомления о конфигурации» сообщения с диагностическими сведениями для этого приложения:
  
  ![](./media/app-insights-monitor-performance-live-website-now/appinsights-status-monitor-diagnostics-message.png)

  * Убедитесь, что брандмауэр сервера обеспечивает исходящий трафик через порт 443 по адресу dc.services.visualstudio.com. 
  * Если на сервере отображается сообщение «Недостаточно разрешений», выполните следующее:
  * В диспетчере IIS выберите пул приложений, откройте «Дополнительные параметры» и скопируйте значение параметра «Идентификация» в разделе «Модель процесса».
  * На панели управления компьютера добавьте это значение к группе пользователей монитора производительности.
  * См. раздел [Устранение неполадок][qna].

## Требования к системе

Операционные системы, которые поддерживаются для монитора состояний Application Insights на сервере:

- Windows Server 2008
- Windows Server 2008 R2
- Windows Server 2012
- Windows Server 2012 R2.

На них должны быть установлены последний пакет обновления и платформа .NET Framework 4.0 и 4.5.

На клиентских компьютерах должна быть установлена ОС Windows 7, 8 или 8.1 с платформой .NET Framework 4.0 и 4.5.

Поддерживаются такие версии IIS: 7, 7.5, 8, 8.5 (IIS – обязательный компонент).

## <a name="next"></a>Дальнейшие действия

* [Создайте веб-тесты][availability], чтобы убедиться, что ваш сайт продолжает работать.
* [Поиск событий и журналов][diagnostic] для диагностики неполадок.
* [Добавьте телеметрию веб-клиента][usage], чтобы просматривать исключения в коде веб-страницы и вставлять вызовы трассировки.
* [Добавьте пакет SDK для Application Insights в код веб-службы][greenbrown], чтобы иметь возможность вставлять вызовы трассировки и журналов в серверный код.

## Видео

#### Мониторинг производительности

[AZURE.VIDEO app-insights-performance-monitoring]

<!--Link references-->

[api]: app-insights-api-custom-events-metrics.md
[availability]: app-insights-monitor-web-app-availability.md
[client]: app-insights-javascript.md
[diagnostic]: app-insights-diagnostic-search.md
[greenbrown]: app-insights-start-monitoring-app-health-usage.md
[qna]: app-insights-troubleshoot-faq.md
[roles]: app-insights-resources-roles-access-control.md
[usage]: app-insights-web-track-usage.md

 

<!---HONumber=July15_HO3-->