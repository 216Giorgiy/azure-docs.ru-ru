<properties 
	pageTitle="Application Insights для ASP.NET" 
	description="Анализ использования, доступности и производительности локального приложения или веб-приложения Microsoft Azure с помощью Application Insights." 
	services="application-insights" 
    documentationCenter=".net"
	authors="alancameronwills" 
	manager="douge"/>

<tags 
	ms.service="application-insights" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="ibiza" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="09/23/2015" 
	ms.author="awills"/>


# Application Insights для ASP.NET

*Доступна только предварительная версия Application Insights.*

[AZURE.INCLUDE [app-insights-selector-get-started](../../includes/app-insights-selector-get-started.md)]


[Visual Studio Application Insights][knowUsers] отслеживает действующее приложение, помогая [обнаруживать и диагностировать исключения и проблемы производительности](http://azure.microsoft.com/services/application-insights), а также [исследовать способы использования вашего приложения][detect]. Этот компонент можно использовать с самыми разнообразными типами приложений. Например, с веб-приложениями Azure или приложениями, размещенными на ваших локальных серверах IIS либо виртуальных машинах Azure. ([Также рассматриваются приложения для устройств и серверы Java][start].)

![Пример диаграмм мониторинга производительности](./media/app-insights-asp-net/10-perf.png)


#### Перед началом работы

Вам необходимы:

* подписка на [Microsoft Azure](http://azure.com). Если у вашей группы или организации есть подписка Azure, владелец может добавить вас в нее с помощью вашей [учетной записи Майкрософт](http://live.com).
* Visual Studio 2013 с обновлением 3 или более новая версия.

## <a name="ide"></a> Добавление Application Insights в проект в Visual Studio

#### Добавление в новый проект

При создании нового проекта в Visual Studio установите флажок для компонента Application Insights.


![Создание проекта ASP.NET](./media/app-insights-asp-net/appinsights-01-vsnewp1.png)


#### ... или, если это существующий проект

В обозревателе решений щелкните проект правой кнопкой мыши и выберите пункт Add Application Insights (Добавить Application Insights).

![Выберите пункт Add Application Insights](./media/app-insights-asp-net/appinsights-03-addExisting.png)





#### Параметры настройки

Если вы делаете это впервые, вам будет предложено войти в предварительную версию Microsoft Azure или зарегистрироваться в ней. (При этом создается учетная запись, не связанная с учетной записью Visual Studio Online.)

Если это приложение является частью большего приложения, можно использовать элемент **Настройка параметров**, чтобы поместить его в ту же группу ресурсов, где находятся другие компоненты.


####<a name="land"></a> Что делает команда "Добавить Application Insights"

Эта команда выполняет такие действия (их можно выполнить вручную при необходимости):

* Создает ресурс Application Insights на [портале Azure][portal]. Здесь будут отображаться ваши данные. Команда извлекает *ключ инструментирования*, идентифицирующий ресурс.
* Добавляет в проект пакет NuGet с веб-пакетом SDK для Application Insights. Чтобы увидеть его в Visual Studio, щелкните правой кнопкой мыши проект и выберите пункт "Управление пакетами NuGet".
* Добавляет ключ инструментирования в файл `ApplicationInsights.config`.


## Запуск проекта

Запустите приложение, нажав клавишу F5, и попробуйте открывать разные страницы, чтобы создать некоторый объем данных телеметрии.

В Visual Studio вы увидите число отправленных событий.

![](./media/app-insights-asp-net/appinsights-09eventcount.png)

## <a name="monitor"></a> Открытие Application Insights

Откройте ресурс Application Insights на [портале Azure][portal].

![Щелкните проект правой кнопкой мыши и откройте портал Azure](./media/app-insights-asp-net/appinsights-04-openPortal.png)


Выполните поиск данных в диаграммах "Обзор". Сначала вы увидите только одну или две точки. Например:

![Щелкните плитки, чтобы увидеть больше данных](./media/app-insights-asp-net/12-first-perf.png)

Щелкните любую диаграмму, чтобы увидеть более подробные метрики. [Дополнительные сведения о метриках.][perf]

Теперь разверните свое приложение и наблюдайте за тем, как накапливаются данные.


При работе в режиме отладки телеметрия передается через конвейер, поэтому данные должны появиться в течение нескольких секунд. При развертывании приложения данные накапливаются медленнее.

#### Данные отсутствуют?

* Откройте плитку [Поиск][diagnostic], чтобы просмотреть отдельные события.
* Используйте приложение, открывая различные страницы, чтобы создать некоторый объем данных телеметрии.
* Подождите несколько секунд и нажмите "Обновить".
* См. раздел [Устранение неполадок][qna].

#### Проблемы на сервере сборки?

Изучите [этот элемент устранения неполадок](app-insights-troubleshoot-faq.md#NuGetBuild).


## Добавление мониторинга браузера

Мониторинг браузера или клиента позволяет получать данные по пользователям, сеансам, просмотрам страниц, а также всем возникшим в браузере исключениям или сбоям.

![Последовательно выберите пункты "Создать", "Службы для разработчиков", "Application Insights"](./media/app-insights-asp-net/16-page-views.png)

Вы также можете написать собственный код для отслеживания работы пользователей с вашим приложением вплоть до детализации щелчков мышью и нажатий клавиш.

#### Если ваши клиенты — веб-браузеры

Если ваше приложение отображает веб-страницы, добавьте в каждую страницу фрагмент кода JavaScript. Скопируйте код из ресурса Application Insights:

![В веб-приложении откройте быстрый запуск и щелкните ссылку "Получить код для мониторинга веб-страниц".](./media/app-insights-asp-net/02-monitor-web-page.png)

Обратите внимание, что код содержит ключ инструментирования, идентифицирующий ресурс приложения.

[Дополнительные сведения об отслеживании веб-страниц](app-insights-web-track-usage.md)

#### Если ваши клиенты — приложения для устройств

Если ваше приложение обслуживает такие клиенты, как телефоны и другие устройства, добавьте в приложение для устройств [соответствующий пакет SDK](app-insights-platforms.md).

При настройке клиентского пакета SDK с тем же ключом инструментирования, как у серверного пакета SDK, потоки объединяются и отображаются вместе.

## Отслеживание использования

Реализовав новую пользовательскую историю, вы захотите узнать, активно ли прибегают к ней пользователи и достигают ли они своих целей или сталкиваются с проблемами. Получите подробную картину активности пользователей, вставив TrackEvent() и другие вызовы в код как на клиенте, так и на сервере.

[Отслеживание использования с помощью API][api]


## Журналы диагностики

[Запись трассировки журналов][netlogs] из предпочтительной платформы ведения журналов помогает диагностировать неисправности. Записи журналов будут отображаться в результатах [диагностического поиска][diagnostic] вместе с событиями телеметрии Application Insights.

## Публикация приложения

Если вы еще не опубликовали свое приложения (после добавления Application Insights), сделайте это сейчас. По мере использования приложения схемы будут заполняться данными.


#### Отсутствуют данные после публикации на сервере?

Откройте следующие порты для исходящего трафика в брандмауэре сервера:

+ `dc.services.visualstudio.com:443`
+ `f5.services.visualstudio.com:443`


## Разработка, тестирование и выпуск

Данные телеметрии основного приложения на разных этапах (отладки, тестирования и эксплуатации) рекомендуется отправлять в [отдельные ресурсы](app-insights-separate-resources.md).

## Отслеживание версии приложения

Убедитесь, что в процессе сборки создается `buildinfo.config`. Добавьте в CSPROJ-файл:

```XML

    <PropertyGroup>
      <GenerateBuildInfoConfigFile>true</GenerateBuildInfoConfigFile>    <IncludeServerNameInBuildInfo>true</IncludeServerNameInBuildInfo>
    </PropertyGroup> 
```

При наличии данных сборки веб-модуль Application Insights автоматически добавляет **версию приложения** как свойство для каждого элемента телеметрии. Это позволяет использовать фильтр по версии при [диагностическом поиске][diagnostic] или [изучении метрик][metrics].



## Добавление отслеживания зависимостей и счетчиков производительности системы

[Метрики зависимостей](app-insights-dependencies.md) могут пригодиться при диагностике проблем с производительностью. Они измеряют вызовы баз данных, API REST и внешних компонентов из приложения.

![](./media/app-insights-asp-net/04-dependencies.png)

Эти действия также включают в себя [отчеты о счетчиках производительности](app-insights-web-monitor-performance.md#system-performance-counters), например для ЦП, памяти и сетевой загрузки.

#### Если приложение выполняется на сервере IIS

Войдите на сервер с правами администратора и установите [монитор состояний Application Insights](http://go.microsoft.com/fwlink/?LinkId=506648).

Необходимо убедиться, что [в брандмауэре сервера открыты дополнительные порты](app-insights-monitor-performance-live-website-now.md#troubleshooting).

#### Если приложение является веб-приложением Azure

На панели управления веб-приложения Azure добавьте расширение Application Insights.

![В веб-приложении последовательно выберите пункты "Настройки", "Расширения", "Добавить" и "Application Insights".](./media/app-insights-asp-net/05-extend.png)

(Это расширение подходит только для приложения, созданного с использованием пакета SDK. В отличие от монитора состояния, оно не позволяет оснастить инструментальными средствами уже существующее приложение.)

#### Мониторинг ролей облачных служб Azure

Существует [процедура добавления монитора состояния вручную](app-insights-cloudservices.md).

## Доступность веб-тестов

[Настройте веб-тесты][availability] для дистанционной проверки активности и отклика приложения.


![](./media/app-insights-asp-net/appinsights-10webtestresult.png)






## Обновление до будущих версий пакета SDK

Чтобы выполнить обновление до [нового выпуска пакета SDK](app-insights-release-notes-dotnet.md), еще раз откройте диспетчер пакетов NuGet и выполните фильтрацию по установленным пакетам. Выберите элемент Microsoft.ApplicationInsights.Web, а затем — элемент "Обновление".

Если были выполнены какие-либо настройки файла ApplicationInsights.config, то, прежде чем выполнять обновление, сохраните его копию, а затем объедините изменения в новой версии.



## <a name="video"></a>Видео

> [AZURE.VIDEO getting-started-with-application-insights]


<!--Link references-->

[api]: app-insights-api-custom-events-metrics.md
[apikey]: app-insights-api-custom-events-metrics.md#ikey
[availability]: app-insights-monitor-web-app-availability.md
[azure]: ../insights-perf-analytics.md
[client]: app-insights-javascript.md
[detect]: app-insights-detect-triage-diagnose.md
[diagnostic]: app-insights-diagnostic-search.md
[knowUsers]: app-insights-overview-usage.md
[metrics]: app-insights-metrics-explorer.md
[netlogs]: app-insights-asp-net-trace-logs.md
[perf]: app-insights-web-monitor-performance.md
[portal]: http://portal.azure.com/
[qna]: app-insights-troubleshoot-faq.md
[redfield]: app-insights-monitor-performance-live-website-now.md
[roles]: app-insights-resources-roles-access-control.md
[start]: app-insights-get-started.md

 

<!---HONumber=Sept15_HO4-->