<properties 
	pageTitle="Мониторинг приложений Docker в Application Insights" 
	description="Счетчики производительности, события и исключения Docker могут отображаться в Application Insights вместе с данными телеметрии из контейнерных приложений." 
	services="application-insights" 
    documentationCenter=""
	authors="alancameronwills" 
	manager="douge"/>

<tags 
	ms.service="application-insights" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="ibiza" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="12/01/2015" 
	ms.author="awills"/>
 
# Мониторинг приложений Docker в Application Insights

События жизненного цикла и счетчики производительности из контейнеров [Docker](https://www.docker.com/) можно выводить в виде диаграмм в Application Insights. Установите образ [Application Insights](app-insights-overview.md) в контейнер в узле. Он будет отображать счетчики производительности для этого узла, а также для других образов.

С помощью Docker ваши приложения распространяются в упрощенных контейнерах со всеми зависимостями. Их можно запустить на любом хост-компьютере с модулем Docker.

При запуске [образа Application Insights](https://hub.docker.com/r/microsoft/applicationinsights/) в узле Docker вы получите следующие преимущества:

* Сведения о телеметрии жизненного цикла для всех контейнеров, запущенных на узле, — запуск, остановка и т. д.
* Счетчики производительности для всех контейнеров. ЦП, память, использование сети и многое другое.
* Если вы [установили пакет SDK для Application Insights](app-insights-java-live.md) в приложениях, выполняющихся в контейнерах, все данные телеметрии этих приложений будут иметь дополнительные свойства, идентифицирующие контейнер и хост-компьютер. Например, если имеются экземпляры приложения, запущенные на нескольких узлах, вы легко сможете отфильтровать данные телеметрии приложения по узлу.

![пример](./media/app-insights-docker/00.png)


## Настройка ресурса Application Insights

1. Выполните вход на [портал Microsoft Azure](https://azure.com) и откройте ресурс Application Insights для своего приложения или [создайте новый](app-insights-create-new-resource.md). 

    *Какой ресурс использовать?* Если приложения, которые выполняются на узле, были созданы другим разработчиком, вам потребуется [создать новый ресурс Application Insights](app-insights-create-new-resource.md). Там вы можете просматривать и анализировать данные телеметрии. (Выберите тип приложения "Другой".)

    Но если разработчиком приложений являетесь вы, мы надеемся, что вы [добавили пакет SDK для Application Insights](app-insights-java-live.md) в каждое из них. Если все они действительно являются компонентами одного бизнес-приложения, вы можете настроить их на отправку данных телеметрии в один ресурс, а затем использовать этот ресурс для отображения данных о производительности и жизненном цикле Docker.

    Третий сценарий — вы разработали большинство приложений, но используете отдельные ресурсы для отображения их телеметрии. В этом случае, возможно, вам потребуется создать отдельный ресурс для данных Docker.

2.	Добавьте плитку Docker. Выберите **Добавить плитку**, перетащите плитку Docker из коллекции, а затем нажмите кнопку **Готово**.

    ![пример](./media/app-insights-docker/03.png)


3. Щелкните раскрывающийся список **Основные компоненты** и скопируйте ключ инструментирования. Этот ключ указывает пакету SDK, куда отправлять данные телеметрии.


    ![пример](./media/app-insights-docker/02-props.png)

Не закрывайте это окно браузера: скоро вы будете просматривать в нем данные телеметрии.


## Запуск монитора Application Insights на узле
 
Теперь, когда вы создали ресурс для отображения данных телеметрии, можно настроить контейнерное приложение, которое будет собирать и отправлять их.

1.	Подключитесь к узлу Docker. 
2.	Включите свой ключ инструментирования в следующую команду и выполните ее:
 
    ```

    docker run -v /var/run/docker.sock:/docker.sock -d microsoft/applicationinsights ikey=000000-1111-2222-3333-444444444
    ```

Для каждого узла Docker требуется только один образ Application Insights. Если приложение развертывается на нескольких узлах Docker, выполните эту команду на каждом узле.

## Обновление приложения

Если приложение инструментируется с помощью [пакета SDK Application Insights для Java](app-insights-java-get-started.md), добавьте следующую строку в файл ApplicationInsights.xml в проекте под элементом `<TelemetryInitializers>`:

```xml

    <Add type="com.microsoft.applicationinsights.extensibility.initializer.docker.DockerContextInitializer"/> 
```

Это добавляет сведения телеметрии Docker, такие как контейнер и идентификатор узла, в каждый элемент, отправляемый из приложения.

## Просмотр телеметрии

Вернитесь к ресурсу Application Insights на портале Azure.

Щелкните плитку Docker.

Вскоре вы увидите данные, поступающие из приложения Docker, особенно при наличии других контейнеров, работающих в модуле Docker.


Ниже приведены примеры представлений данных.

### Счетчики производительности узла, активность образа


![пример](./media/app-insights-docker/10.png)


![пример](./media/app-insights-docker/11.png)



Щелкните имя любого узла или образа, чтобы получить подробные данные.



Чтобы настроить представление, щелкните любую диаграмму, заголовок сетки или нажмите кнопку «Добавить диаграмму».

[Ознакомьтесь с дополнительными сведениями об обозревателе метрик](app-insights-metrics-explorer.md).

### События контейнера Docker


![пример](./media/app-insights-docker/13.png)

Для анализа отдельных событий щелкните [Поиск](app-insights-diagnostic-search.md). Найдите и отфильтруйте нужные вам события. Щелкните любое событие, чтобы просмотреть подробные данные.
 
### Исключения по имени контейнера
 

![пример](./media/app-insights-docker/14.png)

### Добавление контекста Docker в телеметрию приложения

Запрос данных телеметрии, отправленный из приложения, инструментированного с помощью пакета SDK AI, с дополнительным контекстом Docker:

![пример](./media/app-insights-docker/16.png)

Счетчики производительности для загруженности процессора и доступной памяти, насыщенные, дополненные и сгруппированные по имени контейнера Docker:


![пример](./media/app-insights-docker/15.png)





## Вопросы и ответы

*Какие возможности Application Insights отсутствуют в Docker?*

* Подробные показатели счетчиков производительности по контейнерам и образам.
* Интегрированные данные контейнера и приложения на одной панели мониторинга.
* [Экспорт данных телеметрии](app-insights-export-telemetry.md) в базу данных, Power BI или другую панель мониторинга для дальнейшего анализа.

*Как получить данные телеметрии из самого приложения?*

* Установите пакет SDK Application Insights в приложении. Узнайте, как это сделать в [веб-приложениях Java](app-insights-java-get-started.md) и [веб-приложениях Windows](app-insights-asp-net.md).

<!---HONumber=AcomDC_1203_2015-->