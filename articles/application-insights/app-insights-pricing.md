---
title: Управление ценами и объемом данных для Azure Application Insights | Документация Майкрософт
description: Управление объемом данных телеметрии и контроль расходов в Application Insights.
services: application-insights
documentationcenter: ''
author: mrbullwinkle
manager: carmonm
ms.assetid: ebd0d843-4780-4ff3-bc68-932aa44185f6
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 04/02/2018
ms.author: mbullwin
ms.openlocfilehash: 42c54509cedf48e9ebabb5b50865ed56e54bee05
ms.sourcegitcommit: 20d103fb8658b29b48115782fe01f76239b240aa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2018
---
# <a name="manage-pricing-and-data-volume-in-application-insights"></a>Управление ценами и объемом данных в Application Insights

Цены на [Azure Application Insights][start] зависят от объема данных для каждого приложения. Каждый ресурс Application Insights оплачивается как отдельная служба и включается в счет за подписку на Azure.

Доступно два тарифных плана. План по умолчанию называется "Базовый". Он включает в себя все функции плана "Корпоративный" без дополнительных затрат и позволяет оплачивать главным образом объем получаемых данных. При использовании Operations Management Suite следует выбрать план "Корпоративный", обеспечивающий оплату за каждый узел и ежедневные квоты данных. В этом случае плата будет взиматься за данные, получаемые свыше предоставленной квоты.

Если у вас возникли вопросы о принципах формирования цен на Application Insights, задайте их на нашем [форуме](https://social.msdn.microsoft.com/Forums/en-US/home?forum=ApplicationInsights).

## <a name="the-price-plans"></a>Тарифные планы

Текущие цены в валюте вашей страны для выбранного региона вы можете узнать на [странице цен на Application Insights][pricing].

### <a name="basic-plan"></a>План "Базовый"

План "Базовый" используется по умолчанию, если создается ресурс Application Insights. Это оптимально для всех клиентов, за исключением тех, которые используют подписку Operations Management Suite.

* В рамках плана "Базовый" плата взимается в зависимости от объема данных, то есть числа байтов телеметрии, полученных службой Application Insights. Объем данных оценивается по размеру несжатых пакетов данных в формате JSON, получаемых службой Application Insights от вашего приложения.
Объем [табличных данных, импортированных в аналитику](https://docs.microsoft.com/azure/application-insights/app-insights-analytics-import), измеряется, как несжатый размер файлов, отправленных в Application Insights.
* Данные [динамического потока метрик](app-insights-live-stream.md) не учитываются при расчете стоимости.
* С апреля 2018 года [непрерывный экспорт](app-insights-export-telemetry.md) и [соединитель Log Analytics](https://go.microsoft.com/fwlink/?LinkId=833039&amp;clcid=0x409) доступны в плане "Базовый" без какой-либо дополнительной платы.

### <a name="enterprise-plan-and-operations-management-suite-subscription-entitlements"></a>План "Корпоративный" и права подписки Operations Management Suite

Как [недавно было объявлено](https://blogs.technet.microsoft.com/msoms/2017/05/19/azure-application-insights-enterprise-as-part-of-operations-management-suite-subscription/), клиенты, покупающие Microsoft Operations Management Suite E1 и Microsoft Operations Management Suite E2, могут получить Application Insights Enterprise в виде дополнительного компонента без дополнительных затрат. Каждая приобретенная единица пакета Operations Management Suite E1 и E2 предоставляет право на использование одного узла Application Insights корпоративного тарифного плана. Как подробнее описано ниже, каждый узел Application Insights включает в себя до 200 МБ ежедневно принимаемых данных (отдельно от принимаемых данных Log Analytics), которые хранятся в течение 90 дней. Дополнительная плата за это не взимается. Так как это значение применимо только для клиентов с подпиской Operations Management Suite, клиенты без такой подписки не будут видеть параметр для выбора этого плана.

> [!NOTE]
> Чтобы получить это право, ресурсы Application Insights должны входить в корпоративный тарифный план. Это право применяется только к узлам, поэтому, при использовании ресурсов Application Insights в базовом плане, вы не сможете воспользоваться какими-либо преимуществами. Обратите внимание, что это право не будет отображаться в расчетной стоимости на странице *Usage and estimated costs* (Данные об использовании и предполагаемые расходы). Кроме того, если перенести подписку в новую ценовую модель службы мониторинга Azure, доступную с апреля 2018 года, то будет доступен только план "Базовый", поэтому данное действие не рекомендуется, если у вас есть подписка Operations Management Suite.

Для получения дополнительных сведений о плане "Корпоративный" посетите [страницу цен на план "Корпоративный"](app-insights-pricing-enterprise-details.md).

### <a name="multi-step-web-tests"></a>Многошаговые веб-тесты

За [многошаговые веб-тесты](app-insights-monitor-web-app-availability.md#multi-step-web-tests) взимается дополнительная плата. Так именуются веб-тесты, в ходе которых выполняется несколько последовательных действий.

За обычную проверку связи на одной странице отдельная плата не взимается. Объем данных, переданных в ходе простого или многошагового теста, оплачивается так же, как другие данные телеметрии из вашего приложения.

## <a name="review-pricing-plans-and-estimate-costs"></a>Просмотр тарифных планов и расчет стоимости

В Applicaition Insights легко разобраться с доступными тарифными планами и расчетной стоимостью на основе последних шаблонов использования. Откройте страницу **Usage and estimated costs** (Данные об использовании и предполагаемые расходы) для ресурса Application Insights на портале Azure.

![Выберите "Цены".](./media/app-insights-pricing/pricing-001.png)

**а.** Просмотрите сведения об объеме данных на месяц. К ним относятся все полученные и сохраненные данные (после любой [выборки](app-insights-sampling.md) с серверных и клиентских приложений, а также с тестов доступности).

**б.** Отдельно плата взимается за [многошаговые веб-тесты](app-insights-monitor-web-app-availability.md#multi-step-web-tests). (К ним не относятся простые тесты доступности, плата за которые взимается при выставлении счетов за используемый объем данных.)

**в.** Просмотр тенденций объемов данных за последний месяц.

**г.** [Выборка](app-insights-sampling.md) при приеме данных. 

**д.** Настройка ежедневного ограничения объема данных.

Оплата за использование Application Insights добавляется в счет Azure. Дополнительную информацию о счете за подписку на Azure можно просмотреть в разделе выставления счетов портала Azure или на [портале выставления счетов Azure](https://account.windowsazure.com/Subscriptions). 

![В боковом меню выберите «Выставление счетов».](./media/app-insights-pricing/02-billing.png)

## <a name="data-rate"></a>Скорость передачи данных
Скорость передачи данных ограничена в трех случаях:

* **Выборка.** Эта технология уменьшает объем данных телеметрии, отправленных с серверных и клиентских приложений, с минимальным искажением метрик. Это основное средство, с помощью которого можно настроить объем данных. Дополнительные сведения см. в статье [Выборка в Application Insights](app-insights-sampling.md). 
* **Ежедневное ограничение.** При создании ресурса Application Insights на портале Azure устанавливается ограничение, которое составляет 100 ГБ в день. Ограничение по умолчанию при создании ресурса Application Insights в Visual Studio небольшое — всего 32,3 МБ в день. Оно предназначено для упрощения проверки. В этом случае предполагается, что пользователь будет повышать ежедневное ограничение перед развертыванием приложения в рабочую среду. Максимальное ограничение составляет 1000 ГБ в день. Вы можете запросить большее ограничение для приложения с большим объемом трафика. Задавайте ежедневное ограничение внимательно. **Мы не рекомендуем достигать ограничения по ежедневному объему**, так как вы можете потерять данные за остаток дня, а также не сможете выполнить мониторинг приложения. Чтобы изменить его, используйте параметр "Ежедневное ограничение объема", доступный на странице "Usage and estimated costs" (Данные об использовании и предполагаемые расходы) (см. ниже). Мы удалили ограничение для некоторых типов подписок с кредитом, который не может использоваться для Application Insights. Ранее, если для подписки была задана предельная сумма расходов, то в колонке ежедневного ограничения отображались инструкции по ее удалению, а также включению возможности повышения этого ограничения свыше 32,3 МБ в день.
* **Регулирование.** Ограничивает скорость передачи данных определенным количеством событий объемом 32 000 событий в секунду, с усреднением за периоды по 1 минуте.

*Что произойдет, если приложение превысит установленную скорость регулирования?*

* Объем данных, отправляемых приложением, оценивается каждую минуту. Если он превышает среднюю минутную частоту, сервер отклоняет часть запросов. Пакет SDK создает буфер данных, а затем пытается повторно отправить их, распределяя пиковую нагрузку на интервал в несколько минут. Если приложение постоянно отправляет данные с частотой, превышающей частоту регулирования, некоторые данные будут пропущены. (Пакеты SDK для ASP.NET, Java и JavaScript пытаются повторно отправлять данные таким способом; другие пакеты SDK могут просто пропускать отрегулированные данные.) Если произошло регулирование, вы увидите соответствующее предупреждение.

*Как узнать объем данных, отправляемых приложением?*

* Откройте страницу **Usage and estimated costs** (Данные об использовании и предполагаемые расходы), чтобы просмотреть диаграмму ежедневного объема данных. 
* Или же в обозревателе метрик добавьте новую диаграмму и в качестве метрики выберите **том точек данных** . Переключитесь на представление "Группировка" и сгруппируйте по **типу данных**.

## <a name="to-reduce-your-data-rate"></a>Снижение скорости передачи данных
Ниже приведены рекомендации по снижению объема данных.

* Используйте [выборку](app-insights-sampling.md). Эта технология уменьшает скорость передачи данных, не искажая значения метрик и не влияя на возможность перехода между связанными элементами в поиске. В серверных приложениях эта технология включена автоматически.
* [Ограничьте число вызовов Ajax, которые могут быть отображены](app-insights-javascript.md#detailed-configuration) на каждом представлении страницы, или отключите формирование отчетов Ajax.
* Отключите модули сбора, которые вы не используете, [отредактировав файл ApplicationInsights.config](app-insights-configuration-with-applicationinsights-config.md). Например, вы можете решить, что счетчики производительности или данные зависимостей не являются необходимыми.
* Разделите данные телеметрии, чтобы разделить ключи инструментирования. 
* Агрегируйте метрики заранее. Если в ваше приложение включены вызовы в адрес TrackMetric, вы можете снизить объем трафика путем перегрузки, которая будет получать ваши вычисления среднего значения и стандартного отклонения замеров пакетов. Кроме того, вы можете использовать [пакет предварительных статистических вычислений](https://www.myget.org/gallery/applicationinsights-sdk-labs).

## <a name="managing-the-maximum-daily-data-volume"></a>Управление максимальным ежедневным объемом данных

Ограничение ежедневного объема можно использовать для ограничения собираемых данных. Но при достижении порогового значения вся телеметрия, отправленная из приложения в течение дня, не сохранится. Мы **не рекомендуем**, чтобы приложение достигало ограничения ежедневного объема, так как после этого вы не сможете отслеживать работоспособность и производительность приложения.

Вместо этого используйте [выборку](app-insights-sampling.md) для настройки требуемого объема данных. Используйте ограничение ежедневного объема только в крайнем случае, если приложение начало неожиданно отправлять гораздо больше данных телеметрии.

Чтобы изменить ежедневное ограничение, в разделе настроек ресурса Application Insihgts на странице **Usage and estimated costs** (Данные об использовании и предполагаемые расходы) выберите **Ежедневное ограничение**.

![Настройка ограничения ежедневного объема данных телеметрии](./media/app-insights-pricing/pricing-003.png)

## <a name="sampling"></a>Выборка
[Выборка](app-insights-sampling.md) позволяет уменьшить скорость отправки данных телеметрии в ваше приложение. Она позволяет искать связанные события при поиске по журналу диагностики, сохраняя правильные значения числа событий.

Выборка — это эффективный способ сократить затраты и оставаться в пределах месячной квоты. Алгоритм выборки сохраняет связанные элементы телеметрии, поэтому, например, при использовании поиска можно найти запрос, относящийся к конкретному исключению. Алгоритм также сохраняет правильные количества, чтобы вы видели в обозревателе метрик правильные значения частоты запросов, частоты исключений и других счетчиков.

Существует несколько видов выборки.

* [Адаптивная выборка](app-insights-sampling.md) (выборка по умолчанию для пакета SDK ASP.NET), которая автоматически настраивается на объем данных телеметрии, отправляемых приложением. Она оперирует данными в пакете SDK в вашем веб-приложении, что позволяет уменьшить сетевой трафик телеметрии. 
* *Выборка приема* — это другая функция, которая работает в точке, где данные телеметрии из приложения поступают в службу Application Insights. Это не влияет на объем данных телеметрии, отправляемых из приложения, но уменьшает объем данных, сохраняемых службой. С помощью этой выборки можно уменьшить квоту, заданную для телеметрии, которая поступает из браузеров и других пакетов SDK.

Чтобы настроить выборку при приеме, задайте параметр в диалоговом окне "Цены".

![В диалоговом окне "Quotas and pricing" (Квоты и цены) щелкните элемент "Выборки" и выберите долю выборки.](./media/app-insights-pricing/pricing-004.png)

> [!WARNING]
> В диалоговом окне "Выборка данных" отражается только значение выборки при приеме. В ней не отражается частота выборки, которую применяет пакет SDK для Application Insights в приложении. Если по входящей телеметрии уже сделана выборка в пакете SDK, выборка приема не применяется.
>

Чтобы узнать фактическую частоту выборки (где бы она ни применялась), выполните такой [запрос аналитики](app-insights-analytics.md) :

    requests | where timestamp > ago(1d)
    | summarize 100/avg(itemCount) by bin(timestamp, 1h)
    | render areachart

Для каждой сохранившейся записи `itemCount` обозначает число исходных записей, которые эта запись представляет (1 + число предыдущих удаленных записей). 

## <a name="automation"></a>Служба автоматизации

Можно написать сценарий для настройки тарифного плана с помощью управления ресурсами Azure. [Подробнее](app-insights-powershell.md#price).

## <a name="limits-summary"></a>Сводная таблица ограничений

[!INCLUDE [application-insights-limits](../../includes/application-insights-limits.md)]

## <a name="next-steps"></a>Дополнительная информация

* [Выборка](app-insights-sampling.md)

[api]: app-insights-api-custom-events-metrics.md
[apiproperties]: app-insights-api-custom-events-metrics.md#properties
[start]: app-insights-overview.md
[pricing]: http://azure.microsoft.com/pricing/details/application-insights/
