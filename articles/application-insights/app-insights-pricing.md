---
title: Управление ценами и объемом данных для Azure Application Insights | Документация Майкрософт
description: Управление объемом данных телеметрии и контроль расходов в Application Insights.
services: application-insights
documentationcenter: ''
author: mrbullwinkle
manager: carmonm
ms.assetid: ebd0d843-4780-4ff3-bc68-932aa44185f6
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: conceptual
ms.reviewer: Dale.Koetke
ms.date: 06/21/2018
ms.author: mbullwin
ms.openlocfilehash: a401bc3ed68dc9273ac14cfd357b9c05111dd54c
ms.sourcegitcommit: 638599eb548e41f341c54e14b29480ab02655db1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/21/2018
ms.locfileid: "36311108"
---
# <a name="manage-pricing-and-data-volume-in-application-insights"></a>Управление ценами и объемом данных в Application Insights

Цены на [Azure Application Insights][start] зависят от объема данных для каждого приложения. Каждый ресурс Application Insights оплачивается как отдельная служба и включается в счет за подписку Azure.

Для службы Application Insights доступны два тарифных плана — "Базовый" и "Корпоративный". По умолчанию используется тарифный план "Базовый". Он включает в себя все возможности плана "Корпоративный", не требуя дополнительных затрат. В плане "Базовый" плата в основном взимается за объем принимаемых данных. 

В плане "Корпоративный" оплачивается каждый узел, и каждому узлу выделяется ежедневная квота данных. При использовании тарифного плана "Корпоративный" плата взимается за данные, полученные свыше предоставленной квоты. Если вы используете Operations Management Suite, следует выбрать план "Корпоративный". 

Если у вас возникли вопросы о принципах формирования цен на Application Insights, вы можете задать их на нашем [форуме](https://social.msdn.microsoft.com/Forums/en-US/home?forum=ApplicationInsights).

## <a name="pricing-plans"></a>Тарифные планы

Текущие цены в валюте вашей страны для выбранного региона вы можете узнать на [странице цен на Application Insights][pricing].

> [!NOTE]
> В апреле 2018 года была [представлена](https://azure.microsoft.com/blog/introducing-a-new-way-to-purchase-azure-monitoring-services/) новая модель ценообразования для служб мониторинга Azure. Эта модель использует простой принцип "с оплатой по мере использования" во всем портфеле служб мониторинга. Узнайте больше о [новой модели ценообразования](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-usage-and-estimated-costs), о том, как [оценить последствия перехода на новую модель](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-usage-and-estimated-costs#assessing-the-impact-of-the-new-pricing-model), исходя из ваших шаблонов использования, и как [перейти на эту модель](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-usage-and-estimated-costs#moving-to-the-new-pricing-model).

### <a name="basic-plan"></a>План "Базовый"

План "Базовый" всегда устанавливается по умолчанию для создаваемых ресурсов Application Insights. Этот план оптимален для всех клиентов, за исключением тех, у кого имеется подписка Operations Management Suite.

* При использовании плана "Базовый" плата взимается за объем данных. Этот объем данных определяется числом байтов телеметрии, полученных службой Application Insights. Объем данных оценивается по размеру несжатых пакетов данных в формате JSON, получаемых службой Application Insights от вашего приложения. Объем [табличных данных, импортированных в Analytics](https://docs.microsoft.com/azure/application-insights/app-insights-analytics-import), измеряется как размер несжатых файлов, отправленных в Application Insights.
* По состоянию на апрель 2018 года плата за объем данных вашего приложения теперь сообщается в новом счетчике выставления счетов, названном **Прием данных**. Этот новый счетчик совместно используется в разных технологиях мониторинга, таких как Application Insights и Log Analytics, и сейчас называется **Службы приложений** (вскоре имя изменится на **Log Analytics**). 
* Данные [динамического потока метрик](app-insights-live-stream.md) не учитываются при расчете стоимости.
* С апреля 2018 года [непрерывный экспорт](app-insights-export-telemetry.md) и [соединитель Azure Log Analytics](https://go.microsoft.com/fwlink/?LinkId=833039&amp;clcid=0x409) доступны в плане "Базовый" без какой-либо дополнительной платы.

### <a name="enterprise-plan-and-operations-management-suite-subscription-entitlements"></a>План "Корпоративный" и права подписки Operations Management Suite

Как [недавно было объявлено](https://blogs.technet.microsoft.com/msoms/2017/05/19/azure-application-insights-enterprise-as-part-of-operations-management-suite-subscription/), клиенты, покупающие Operations Management Suite E1 и Operations Management Suite E2, могут получить Application Insights Enterprise в виде дополнительного компонента без дополнительных затрат. Каждая приобретенная единица пакета Operations Management Suite E1 и Operations Management Suite E2 предоставляет право на использование одного узла плана "Корпоративный" для Application Insights. Каждый узел Application Insights включает до 200 МБ ежедневно обрабатываемых данных (отдельно от получаемых данных Log Analytics), которые хранятся в течение 90 дней. Дополнительная плата за это не взимается. Данный план описан более подробно далее в этой статье. 

Так как этот план доступен только клиентам с подпиской Operations Management Suite, клиенты без такой подписки не будут видеть параметр для выбора этого плана.

> [!NOTE]
> Для получения этой возможности ваши ресурсы Application Insights должны использовать тарифный план "Корпоративный". Эта возможность применяется только к узлам. Ресурсы Application Insights в плане "Базовый" не получают каких-либо преимуществ. Эта возможность не отображается в предполагаемых затратах в области **Usage and estimated costs** (Данные об использовании и предполагаемые расходы). Кроме того, при переводе подписки на новую модель ценообразования для мониторинга Azure в апреле 2018 года будет доступен только план "Базовый". Перевод подписки на новую модель ценообразования для мониторинга Azure не рекомендуется, если у вас есть подписка Operations Management Suite.

Дополнительные сведения о плане "Корпоративный" см. в разделе [Сведения о плане "Корпоративный"](app-insights-pricing-enterprise-details.md).

### <a name="multi-step-web-tests"></a>Многошаговые веб-тесты

За [многошаговые веб-тесты](app-insights-monitor-web-app-availability.md#multi-step-web-tests) взимается дополнительная плата. Это веб-тесты, в ходе которых выполняется несколько последовательных действий.

За обычную *проверку связи* для одной страницы отдельная плата не взимается. Объем данных телеметрии, переданных в ходе проверки связи или многошагового теста, оплачивается так же, как другие данные телеметрии из вашего приложения.

## <a name="review-pricing-plans-and-estimate-costs"></a>Просмотр тарифных планов и расчет стоимости

В Applicaition Insights легко разобраться с доступными тарифными планами и расчетной стоимостью на основе последних шаблонов использования. Чтобы приступить к работе, откройте область **Usage and estimated costs** (Данные об использовании и предполагаемые расходы) для ресурса Application Insights на портале Azure.

![Выбор цен](./media/app-insights-pricing/pricing-001.png)

О. Просмотрите сведения об объеме данных на месяц. К ним относятся все полученные и сохраненные данные (после любой [выборки](app-insights-sampling.md) из серверных и клиентских приложений, а также с тестов доступности).  
B. Отдельно плата взимается за [многошаговые веб-тесты](app-insights-monitor-web-app-availability.md#multi-step-web-tests). (К ним не относятся простые тесты доступности, плата за которые взимается при выставлении счетов за используемый объем данных.)  
C. Просмотр тенденций объемов данных за последний месяц.  
D. [Выборка](app-insights-sampling.md) при приеме данных.   
E. Настройка ежедневного ограничения объема данных.  

Оплата за использование Application Insights добавляется в счет Azure. Дополнительную информацию о счете за подписку на Azure можно просмотреть в разделе **Выставление счетов** портала Azure или на [портале выставления счетов Azure](https://account.windowsazure.com/Subscriptions). 

![В меню слева выберите "Выставление счетов".](./media/app-insights-pricing/02-billing.png)

## <a name="data-rate"></a>Скорость передачи данных
Объем отправляемых данных ограничивается тремя способами.

* **Выборка.** Позволяет уменьшить объем данных телеметрии, отправляемых из серверных и клиентских приложений, с минимальным искажением метрик. Это основное средство, с помощью которого можно настроить объем отправляемых данных. Дополнительные сведения см. в статье [Выборка в Application Insights](app-insights-sampling.md). 
* **Ежедневное ограничение.** При создании ресурса Application Insights на портале Azure устанавливается ограничение, которое составляет 100 ГБ в день. Ограничение по умолчанию при создании ресурса Application Insights в Visual Studio невелико (всего 32,3 МБ в день). Ежедневное ограничение по умолчанию задается для упрощения тестирования. Предполагается, что пользователь повысит ежедневное ограничение перед развертыванием приложения в рабочую среду. 

    Максимальное ограничение составляет 1000 ГБ в день. Вы можете запросить большее ограничение для приложения с большим объемом трафика. 

    Будьте внимательны при задании ежедневного ограничения. Следует предполагать, что вы *никогда не достигнете его*. При достижении ежедневного ограничения вы потеряете данные за остаток дня и не сможете наблюдать за приложением. Чтобы изменить ежедневное ограничение, используйте параметр **Ежедневное ограничение объема**. Этот параметр можно настроить в области **Usage and estimated costs** (Данные об использовании и предполагаемые расходы). Это описано более подробно далее в этой статье.
    Мы удалили ограничение для некоторых типов подписок с кредитом, который не может использоваться для Application Insights. Ранее, если для подписки была задана предельная сумма расходов, то в колонке ежедневного ограничения отображались инструкции по ее удалению, а также включению возможности повышения этого ограничения свыше 32,3 МБ в день.
* **Регулирование.** Ограничивает скорость передачи данных 32 000 событий в секунду на ключ инструментирования, с усреднением за периоды по 1 минуте.

*Что произойдет, если приложение превысит установленную скорость регулирования?*

* Объем данных, отправляемых приложением, оценивается каждую минуту. Если он превышает среднюю минутную частоту, сервер отклоняет часть запросов. Пакет SDK буферизует данные, а затем пытается повторно отправить их. Он распределяет резкое увеличение трафика на несколько минут. Если приложение постоянно отправляет данные с частотой, превышающей частоту регулирования, некоторые данные будут пропущены. (Пакеты SDK для ASP.NET, Java и JavaScript пытаются повторно отправлять данные таким способом; другие пакеты SDK могут просто пропускать отрегулированные данные.) Если произошло регулирование, вы увидите соответствующее предупреждение.

*Как узнать объем данных, отправляемых приложением?*

Чтобы просмотреть объем данных, отправляемых приложением, можно использовать один из следующих параметров.

* Откройте страницу **Usage and estimated costs** (Данные об использовании и предполагаемые расходы), чтобы просмотреть диаграмму ежедневного объема данных. 
* В обозревателе метрик добавьте новую диаграмму. Для метрики диаграммы настройте параметр **Объем точки данных**. Включите параметр **Группировка** и выберите группировку по **типу данных**.

## <a name="reduce-your-data-rate"></a>Снижение скорости передачи данных
Ниже приведены рекомендации по снижению объема данных.

* Используйте [выборку](app-insights-sampling.md). Эта технология снижает скорость передачи данных без искажения метрик. При этом сохраняется возможность перемещаться между связанными элементами при поиске. В серверных приложениях выборка включена автоматически.
* [Ограничьте число вызовов Ajax, которые могут быть отображены](app-insights-javascript.md#detailed-configuration) на каждом представлении страницы, или отключите формирование отчетов Ajax.
* Отключите модули сбора, которые вы не используете, [отредактировав файл ApplicationInsights.config](app-insights-configuration-with-applicationinsights-config.md). Например, вы можете решить, что счетчики производительности или данные зависимостей не являются необходимыми.
* Разделите данные телеметрии, чтобы разделить ключи инструментирования. 
* Агрегируйте метрики заранее. Если в ваше приложение включены вызовы к TrackMetric, вы можете снизить объем трафика путем перегрузки, которая будет получать ваши вычисления среднего значения и стандартного отклонения пакета измерений. Кроме того, вы можете использовать [пакет предварительных статистических вычислений](https://www.myget.org/gallery/applicationinsights-sdk-labs).

## <a name="manage-the-maximum-daily-data-volume"></a>Управление максимальным ежедневным объемом данных

Можно использовать ежедневное ограничение, чтобы ограничить объем собираемых данных. Тем не менее, если это ограничение достигнуто, теряются все данные телеметрии, отправленные из приложения за остаток дня. *Не рекомендуется* допускать достижения приложением ежедневного ограничения. После достижения ежедневного ограничения невозможно отслеживать работоспособность и производительность приложения.

Вместо ежедневного ограничения объема используйте [выборку](app-insights-sampling.md), чтобы настроить объем данных до требуемого уровня. Затем используйте ежедневное ограничение как "крайнюю меру" в случае, если приложение неожиданно начинает отправлять намного большие объемы данных телеметрии.

Чтобы изменить ежедневное ограничение, в разделе **Настройки** ресурса Application Insights в области **Usage and estimated costs** (Данные об использовании и предполагаемые расходы) выберите **Ежедневное ограничение**.

![Настройка ограничения ежедневного объема данных телеметрии](./media/app-insights-pricing/pricing-003.png)

## <a name="sampling"></a>Выборка
[Выборка](app-insights-sampling.md) позволяет уменьшить скорость отправки данных телеметрии в ваше приложение. Она позволяет искать связанные события при поиске по журналу диагностики. Она также позволяет сохранить правильные значения числа событий.

Выборка — это эффективный способ сократить затраты и оставаться в пределах месячной квоты. Алгоритм выборки сохраняет связанные элементы телеметрии, поэтому, например, при использовании поиска можно найти запрос, относящийся к конкретному исключению. Алгоритм также сохраняет правильные количества, чтобы вы видели в обозревателе метрик правильные значения частоты запросов, частоты исключений и других счетчиков.

Существует несколько видов выборки.

* По умолчанию для пакета SDK для ASP.NET используется [адаптивная выборка](app-insights-sampling.md). Адаптивная выборка автоматически настраивается в соответствии с объемом данных телеметрии, отправляемых приложением. Она оперирует данными в пакете SDK в вашем веб-приложении, что позволяет уменьшить сетевой трафик телеметрии. 
* *Выборка приема* — это другая функция, которая работает в точке, где данные телеметрии из приложения поступают в службу Application Insights. Выборка приема не влияет на объем данных телеметрии, отправляемых из приложения, но уменьшает объем данных, сохраняемых службой. С помощью этой выборки можно уменьшить квоту, заданную для данных телеметрии, которые поступают из браузеров и других пакетов SDK.

Чтобы настроить выборку приема, перейдите в область **Цены**.

![В диалоговом окне "Quotas and pricing" (Квоты и цены) щелкните элемент "Выборки" и выберите долю выборки.](./media/app-insights-pricing/pricing-004.png)

> [!WARNING]
> В области **Выборка данных** отражается только значение выборки приема. В ней не отражается частота выборки, которую применяет пакет SDK для Application Insights в приложении. Если по входящей телеметрии уже сделана выборка в пакете SDK, то выборка приема не применяется.
>

Чтобы узнать фактическую частоту выборки (где бы она ни применялась), выполните [запрос Analytics](app-insights-analytics.md). Этот запрос выглядит следующим образом.

    requests | where timestamp > ago(1d)
    | summarize 100/avg(itemCount) by bin(timestamp, 1h)
    | render areachart

Для каждой сохранившейся записи `itemCount` обозначает число исходных записей, которые эта запись представляет. Эта величина равна 1 + число предыдущих удаленных записей. 

## <a name="automation"></a>Служба автоматизации

Можно создать сценарий для настройки тарифного плана с помощью службы управления ресурсами Azure. [Подробнее](app-insights-powershell.md#price).

## <a name="limits-summary"></a>Сводная таблица ограничений

[!INCLUDE [application-insights-limits](../../includes/application-insights-limits.md)]

## <a name="next-steps"></a>Дополнительная информация

* [Выборка](app-insights-sampling.md)

[api]: app-insights-api-custom-events-metrics.md
[apiproperties]: app-insights-api-custom-events-metrics.md#properties
[start]: app-insights-overview.md
[pricing]: http://azure.microsoft.com/pricing/details/application-insights/