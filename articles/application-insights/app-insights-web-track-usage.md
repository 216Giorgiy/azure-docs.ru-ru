---
title: "Анализ использования веб-приложений с помощью Azure Application Insights | Документы Майкрософт"
description: "Общие сведения об анализе использования с помощью Application Insights"
services: application-insights
documentationcenter: 
author: alancameronwills
manager: carmonm
ms.assetid: bbdb8e58-7115-48d8-93c0-f69a1beeea6e
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: multiple
ms.topic: article
ms.date: 04/12/2017
ms.author: awills
translationtype: Human Translation
ms.sourcegitcommit: 0c4554d6289fb0050998765485d965d1fbc6ab3e
ms.openlocfilehash: 2715207e548fc57b1896f5736731be3881256cbf
ms.lasthandoff: 04/13/2017


---
# <a name="usage-analysis-for-web-applications-with-application-insights"></a>Анализ использования для веб-приложений с помощью Application Insights
Знание особенностей работы пользователей с приложением позволяет сосредоточить разработку на сценариях, которые наиболее важны для пользователей, и выявить цели, которые кажутся им простыми или сложными для достижения.

[Azure Application Insights](app-insights-overview.md) обеспечивает два уровня отслеживания использования:

* **Данные по числу пользователей, сеансов и просмотров страниц** предоставляются по умолчанию.  
* **Пользовательская телеметрия** — вы [пишете код](app-insights-api-custom-events-metrics.md) для отслеживания пользователей посредством их взаимодействия с вашим приложением. 


## <a name="get-started"></a>Начало работы

Максимальное удобство работы достигается путем установки Application Insights как в серверном коде приложения, так и на веб-страницах. Клиентские и серверные компоненты приложения отправляют данные телеметрии на портал Azure для анализа.

1. **Серверный код:** установите соответствующий модуль для своего приложения [ASP.NET](app-insights-asp-net.md), [Azure](app-insights-azure.md), [Java](app-insights-java-get-started.md), [Node.js](app-insights-nodejs.md) или приложения [иного типа](app-insights-platforms.md).

    * *Не хотите устанавливать серверный код? Просто [создайте ресурс Azure Application Insights](app-insights-create-new-resource.md).*

2. **Код веб-страницы:** откройте [портал Azure](https://portal.azure.com), откройте ресурс Application Insights для приложения, а затем выберите **Начало работы > Мониторинг и диагностика приложения на стороне клиента**. 

    ![Скопируйте скрипт в заголовок главной веб-страницы.](./media/app-insights-web-track-usage/02-monitor-web-page.png)


3. **Получение данных телеметрии:** запустите проект в режиме отладки на несколько минут, а затем просмотрите результаты в колонке "Обзор" в Application Insights.

    Опубликуйте ваше приложение для отслеживания его производительности и узнайте, что делают с ним пользователи.

## <a name="usage-analysis-out-of-the-box"></a>Анализ использования по умолчанию
Откройте колонку "Использование".

![Диаграммы числа пользователей, сеансов и просмотров страниц](./media/app-insights-web-track-usage/14-usage.png)

Наведите указатель мыши на пустую область над диаграммой для просмотра счетчиков в определенной точке. В иных случаях числа указывают значение, агрегированное за период, например среднее, итоговое или число уникальных пользователей за этот период.

Что отображается на этих диаграммах?

* **Пользователи** — количество уникальных активных пользователей за период времени. В веб-приложениях пользователи подсчитываются с помощью файлов cookie. Пользователь, который использует несколько браузеров, очищает файлы cookie или использует функцию конфиденциальности, будет учитываться несколько раз.
* **Прошедшие проверку подлинности пользователи** подсчитываются, если вы добавили вызов метода [setAuthenticatedUser()](app-insights-api-custom-events-metrics.md#authenticated-users) в код.
* **Сеансы** — количество активных сеансов. Веб-сеанс считается законченным после 30 минут бездействия. 
* **Количество просмотров страницы** — подсчитывается количество вызовов функции trackPageView(), которая обычно вызывается один раз на каждой веб-странице.

Щелкните любую диаграмму, чтобы увидеть более подробные данные. Обратите внимание, что диапазоны времени диаграмм можно менять.

### <a name="where-do-my-users-live"></a>Где живут мои пользователи?
Щелкните в пустой части диаграммы "Пользователи", чтобы открыть еще одну колонку с более подробными сведениями.

![В колонке использования щелкните диаграмму пользователей.](./media/app-insights-web-track-usage/02-sessions.png)

### <a name="what-browsers-or-operating-systems-do-they-use"></a>Какие операционные системы или браузеры они используют?

Щелкните **Изменить** на диаграмме "Пользователи", а затем сгруппируйте (сегментируйте) данные по свойству, например браузеру, операционной системе или городу: 

![Выберите диаграмму, показывающую одну метрику, переключитесь на группировку и выберите какое-либо свойство](./media/app-insights-web-track-usage/03-browsers.png)

Чтобы увидеть полный набор счетчиков, измените тип диаграммы на **Сетка**. Можно также выбрать для отображения дополнительные метрики:

![Диаграмма в виде сетки с несколькими столбцами](./media/app-insights-web-track-usage/multi-column-grid.png)

Для графических диаграмм можно сделать только что-то одно: либо выполнить группировку по свойству, либо выбрать несколько метрик. На этой диаграмме сравниваются две метрики: пользователи и [прошедшие проверку подлинности пользователи](app-insights-api-custom-events-metrics.md#authenticated-users). 

![Выберите диаграмму, найдите метрики и установите или снимите для них флажки.](./media/app-insights-web-track-usage/031-dual.png)



## <a name="page-views"></a>Просмотры страниц
В колонке "Использование" щелкните диаграмму просмотров страниц, чтобы получить более подробные сведения вместе с анализом наиболее популярных страниц:

![В колонке обзора щелкните диаграмму "Просмотры страниц"](./media/app-insights-web-track-usage/05-games.png)

Приведенный выше пример взят с игрового веб-сайта. На диаграммах можно сразу же увидеть следующее:

* Использование не увеличилось за прошлую неделю. Возможно, стоит задуматься о поисковой оптимизации?
* "Теннис" является наиболее популярной игрой. Этой странице следует отдать приоритет в улучшениях.
* В среднем пользователи посещают страницу "Теннис" примерно три раза в неделю. (Сеансов примерно в три раза больше, чем пользователей.)
* Большинство пользователей посещают сайт в рабочие дни и часы. Возможно, следует добавить на веб-страницу кнопку для быстрого ее скрытия.
* В [заметках](app-insights-annotations.md) на диаграмме указывается, когда были развернуты новые версии веб-сайта. Последние развернутые версии не оказали заметного влияния на использование.

## <a name="custom-tracking"></a>Настраиваемое отслеживание
Предположим, что вместо создания отдельной страницы для каждой игры вы решили реорганизовать их все в одностраничное приложение, большинство функций которого реализовано с помощью кода JavaScript на веб-странице. Это позволяет пользователям быстро переключаться между играми или иметь несколько игр на одной странице.

Но вы все равно хотите, чтобы служба Application Insights протоколировала, сколько раз каждая игра была открыта, точно так же, как если бы игры находились на отдельных веб-страницах. Это несложно: просто вставьте вызов модуля телеметрии в код JavaScript в то место, где нужно сделать запись о том, что открыта новая "страница":

```JavaScript
    telemetryClient.trackPageView(game.Name);
```
Этот вызов имитирует регистрацию просмотра страницы для телеметрии.  Однако не всегда нужно смешивать сообщения с просмотрами страниц. Вместо этого используйте настраиваемые события. Их можно отправлять с веб-страниц или веб-сервера:


```JavaScript

    telemetryClient.trackEvent("GameEnd");
```

```C#
    var tc = new Microsoft.ApplicationInsights.TelemetryClient();
    tc.TrackEvent("GameEnd");
```

```VB

    Dim tc = New Microsoft.ApplicationInsights.TelemetryClient()
    tc.TrackEvent("GameEnd")
```

[Пользовательскую телеметрию, добавленную в код веб-страницы или сервера](app-insights-api-custom-events-metrics.md#trackevent), можно использовать различными способами для понимания того, как используется ваше приложение.

Для просмотра событий, отправленных TrackEvent(), откройте обозреватель метрик, добавьте новую диаграмму, а затем измените ее. Ваши метрики приводятся в разделе "Пользовательские метрики". 

![Диаграмма, на которой показаны пользовательские события.](./media/app-insights-web-track-usage/06-eventsSegment.png)

Если в событиях заданы [значения свойств](app-insights-api-custom-events-metrics.md#properties) (также называемые измерениями), по ним можно осуществлять группировку и фильтрацию.

Для корреляции изменений в других метриках и событиях создайте несколько диаграмм. Например, в некоторых случаях, когда играемых игр становится больше, можно также ожидать увеличение числа прерванных игр. Но если увеличение числа прерванных игр является диспропорциональным, необходимо выяснить, не является ли высокая нагрузка причиной неприемлемой для пользователей проблемы.

## <a name="drill-into-specific-events"></a>Детализация определенных событий
Чтобы лучше понимать, как проходит обычный сеанс, может потребоваться сосредоточиться на пользовательском сеансе, который содержит определенный тип события.

В сетке событий щелкните интересующее событие и выберите последний конкретный случай:

![В списке под сводной диаграммой выберите событие](./media/app-insights-web-track-usage/08-searchEvents.png)

Давайте рассмотрим все данные телеметрии для сеанса, в котором произошло конкретное событие "NoGame".

![Щелкните "Все данные телеметрии для сеанса"](./media/app-insights-web-track-usage/09-relatedTelemetry.png)

Исключений не возникало, поэтому пользователю не мешал играть какой-либо сбой.

Для этого сеанса мы можем отфильтровать все типы телеметрии, оставив просмотры страниц:

![](./media/app-insights-web-track-usage/10-filter.png)

И теперь видно, что этот пользователь вошел в систему просто для того, чтобы проверить последний счет игры. Возможно, нам следует учесть рассмотренную пользовательскую историю, упростив эти действия. (И мы можем создать настраиваемое событие, чтобы  отслеживать возникновения этой конкретной истории.)

## <a name="filter-search-and-segment-your-data-with-properties"></a>Фильтрация, поиск и сегментация данных с помощью свойств
Событиям можно присваивать произвольные теги и числовые значения.

*JavaScript на веб-странице*

```JavaScript

    appInsights.trackEvent("WinGame",
        // String properties:
        {Game: currentGame.name, Difficulty: currentGame.difficulty},
        // Numeric measurements:
        {Score: currentGame.score, Opponents: currentGame.opponentCount}
    );
```

*C# на стороне сервера*

```C#

    // Set up some properties:
    var properties = new Dictionary <string, string>
        {{"game", currentGame.Name}, {"difficulty", currentGame.Difficulty}};
    var measurements = new Dictionary <string, double>
        {{"Score", currentGame.Score}, {"Opponents", currentGame.OpponentCount}};

    // Send the event:
    telemetry.TrackEvent("WinGame", properties, measurements);
```

*VB на стороне сервера*

```VB

    ' Set up some properties:
    Dim properties = New Dictionary (Of String, String)
    properties.Add("game", currentGame.Name)
    properties.Add("difficulty", currentGame.Difficulty)

    Dim measurements = New Dictionary (Of String, Double)
    measurements.Add("Score", currentGame.Score)
    measurements.Add("Opponents", currentGame.OpponentCount)

    ' Send the event:
    telemetry.TrackEvent("WinGame", properties, measurements)
```

Таким же образом прикрепите свойства к просмотрам страниц:

*JavaScript на веб-странице*

```JS

    appInsights.trackPageView("Win", 
        url,
        {Game: currentGame.Name}, 
        {Score: currentGame.Score});
```

В колонке поиска по журналу диагностики можно просматривать свойства, щелкая отдельные вхождения события.

![В списке событий откройте событие и нажмите кнопку с многоточием (...), чтобы просмотреть дополнительные свойства](./media/app-insights-web-track-usage/11-details.png)

Используйте поле поиска для просмотра вхождений события с определенным значением свойства.

![Введите значение в поле поиска](./media/app-insights-web-track-usage/12-searchEvents.png)

## <a name="edit-and-create-queries-over-your-telemetry"></a>Создание и изменение запросов к данным телеметрии

Щелкните значок Azure Analytics на любой диаграмме, чтобы открыть эквивалентный запрос, который можно изменить.
Прокрутите область вниз, чтобы узнать, было ли создано несколько запросов. Установите курсор в любом запросе и нажмите кнопку **Вперед**. 

Кроме того, можно открыть приложение Analytics, щелкнув значок в колонке "Обзор", и создать собственные запросы или попробовать использовать образцы запросов, которые приводятся на вкладке "Главная" приложения Analytics.


![Окно Analytics с созданным запросом](./media/app-insights-web-track-usage/open-analytics.png)

[Дополнительные сведения о языке запросов Azure Analytics](app-insights-analytics.md).

Для анализа использования особенно полезными могут быть следующие таблицы:

* `customEvents` — результаты вызовов [TrackEvent()](app-insights-api-custom-events-metrics.md#trackevent).
* `pageViews` — число страниц, открытых в клиентских браузерах, или вызовов [trackPageView()](app-insights-api-custom-events-metrics.md#page-views).


## <a name="a--b-testing"></a>Тестирование A или B 
Если неизвестно, какой вариант функции будет более эффективен, выпустите их оба, чтобы каждый из них был доступен для разных пользователей. Измерьте успешность каждого варианта, а затем перейдите к единой версии.

В рамках этого способа необходимо присвоить разные теги всем данным телеметрии, отправляемым каждой версией приложения. Для этого нужно определить свойства в активном контексте телеметрии TelemetryContext. Эти свойства по умолчанию добавляются к каждому сообщению телеметрии, которое отправляет приложение, — не только к настраиваемым сообщениям, но также к стандартным данным телеметрии.

Затем, чтобы сравнить различные версии, на портале Application Insights можно будет отфильтровать и сгруппировать (сегментировать) данные по тегам.


```C#

    using Microsoft.ApplicationInsights.DataContracts;

    var context = new TelemetryContext();
    context.Properties["Game"] = currentGame.Name;
    var telemetry = new TelemetryClient(context);
    // Now all telemetry will automatically be sent with the context property:
    telemetry.TrackEvent("WinGame");
```


```VB

    Dim context = New TelemetryContext
    context.Properties("Game") = currentGame.Name
    Dim telemetry = New TelemetryClient(context)
    ' Now all telemetry will automatically be sent with the context property:
    telemetry.TrackEvent("WinGame")
```

Некоторые данные телеметрии могут отличаться от значений по умолчанию.

Можно настроить универсальный инициализатор, чтобы все новые клиенты телеметрии TelemetryClient автоматически использовали ваш контекст.

```C#


    // Telemetry initializer class
    public class MyTelemetryInitializer : ITelemetryInitializer
    {
        public void Initialize (ITelemetry telemetry)
        {
            telemetry.Properties["AppVersion"] = "v2.1";
        }
    }
```

В инициализаторе приложения, например Global.asax.cs:

```C#

    protected void Application_Start()
    {
        // ...
        TelemetryConfiguration.Active.TelemetryInitializers
        .Add(new MyTelemetryInitializer());
    }
```


## <a name="build---measure---learn"></a>Создание — измерение — обучение
При использовании аналитики она становится неотъемлемой частью цикла разработки, а не просто поводом поразмышлять над решением проблем. Ниже приведен ряд советов.

* Определите ключевые метрики своего приложения. Необходимо привлечь максимальное число пользователей или лучше немного пользователей, но зато довольных? Необходимо увеличить число посещений или объем продаж?
* Планируйте протоколирование каждой истории. Если создается новый компонент или пользовательская история или их необходимо обновить, всегда думайте о том, как определить успешность изменения. Прежде чем начинать писать код, задайте вопрос: "Как этот код повлияет на метрики, когда он будет работать? Следует ли отслеживать новые события?"
  И, конечно, когда компонент становится рабочим, обязательно просматривайте аналитику и действуйте исходя из результатов.
* Соотносите другие метрики с ключевой метрикой. Например, если вы добавили компонент "Избранное", следует узнать, как часто пользователи добавляют в "Избранное". Но, возможно, еще интереснее узнать, как часто они обращаются к своему избранному. И, самое главное, стали ли пользователи, использующие "Избранное", в конечном счете больше покупать?
* Осторожное тестирование. Настройте переключатель, позволяющий делать новый компонент видимым только некоторым пользователям. С помощью Application Insights узнайте, используется ли новый компонент так, как было предусмотрено. Внесите корректировки, а затем сделайте компонент доступным для более широкого круга пользователей.
* Общайтесь с пользователями! Самой по себе аналитики недостаточно, она дополняет поддержание хороших отношений с клиентами.

## <a name="learn-more"></a>Подробнее
* [Обнаруживайте, исследуйте и диагностируйте случаи непредвиденного сбоя и снижения производительности в вашем приложении](app-insights-detect-triage-diagnose.md)
* [Начните работу с Application Insights на нескольких платформах](app-insights-detect-triage-diagnose.md)
* [Использование API. Обзор](app-insights-api-custom-events-metrics.md)
* [Справочник по JavaScript API](https://github.com/Microsoft/ApplicationInsights-JS/blob/master/API-reference.md)



