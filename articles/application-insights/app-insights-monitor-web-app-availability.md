<properties 
	pageTitle="Отслеживание доступности и скорости реагирования любого веб-сайта" 
	description="Настройка веб-тестов в Application Insights. Получение оповещений, когда веб-сайт становится недоступным или медленно реагирует на запросы." 
	services="application-insights" 
    documentationCenter=""
	authors="alancameronwills" 
	manager="ronmart"/>

<tags 
	ms.service="application-insights" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="ibiza" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="04/21/2015" 
	ms.author="awills"/>
 
# Отслеживание доступности и скорости реагирования любого веб-сайта

[AZURE.INCLUDE [app-insights-selector-get-started](../../includes/app-insights-selector-get-started.md)]

После развертывания своего веб-приложения вы можете настроить веб-тесты для наблюдения за его доступностью и скоростью реагирования. Application Insights отправляет веб-запросы через одинаковые промежутки времени из разных точек по всему миру, и если приложение реагирует медленно или не реагирует вообще, будет отправлять вам оповещения.

![Пример веб-теста](./media/app-insights-monitor-web-app-availability/appinsights-10webtestresult.png)

Веб-тесты можно настроить для любой конечной точки HTTP, достижимой из общедоступного Интернета.

Существует два типа веб-тестов.

* [Тест проверки связи с URL-адресом](#set-up-a-url-ping-test) — простой тест, который вы можете создать на портале Azure.
* [Многошаговый веб-тест](#multi-step-web-tests) — тест, который вы создаете в Visual Studio Ultimate или Visual Studio Enterprise и загружаете на портал.

*Это веб-приложение Azure? Просто [создайте веб-тест в колонке веб-приложения][azure-availability].*



## Настройка теста проверки связи с URL-адресом

### <a name="create"></a>1. Создать новый ресурс?

Пропустите этот шаг, если вы уже [настроили ресурс Application Insights][start] для этого приложения и хотите, чтобы данные о доступности отображались в этом же месте.

Зарегистрируйтесь в [Microsoft Azure](http://azure.com), перейдите на [портал Azure](https://portal.azure.com) и создайте новый ресурс Application Insights.

![Создать > Application Insights](./media/app-insights-monitor-web-app-availability/11-new-app.png)

Откроется колонка «Обзор» для нового ресурса. Чтобы в любой момент найти ее на [портале Azure](https://portal.azure.com), щелкните «Обзор».

### <a name="setup"></a>2. Создание веб-теста

В ресурсе Application Insights найдите плитку «Доступность». Щелкните ее, чтобы открыть колонку «Веб-тесты» для вашего приложения и добавьте веб-тест.

![Укажите хотя бы URL-адрес своего веб-сайта](./media/app-insights-monitor-web-app-availability/13-availability.png)

- **URL-адрес** должен быть видимым из общедоступного Интернета. Он может содержать строку запроса, поэтому вы, например, сможете немного поупражняться в работе с базой данных. Если URL-адрес указывает на перенаправление, мы будем переходить по нему до 10 раз.

- Если выбрано **Разрешить повторную попытку**, то в случае сбоя теста он будет повторятся по истечении короткого промежутка времени. Сообщения об ошибке отобразится только после трех неудачных попыток подряд. Последующие тесты затем будут выполняться с обычным интервалом. Повторные попытки будут временно приостановлены до следующей успешной попытки. Это правило действует в любом расположении тестирования.

- **Расположения тестирования** — это места, из которых наши серверы отправляют веб-запросы на ваш URL-адрес. Выберите несколько расположений, чтобы можно было различать проблемы веб-сайта и сетевые проблемы. Вы можете выбрать до 16 таких расположений.

- **Критерии успешного завершения**.

    **Код состояния HTTP**: обычно 200.

    **Совпадение содержимого**: строка, например «Добро пожаловать!». Проверим, что она содержится в каждом ответе. Это должна быть строка обычного текста без подстановочных знаков. Не забывайте, что если контент страницы изменяется, необходимо обновить эту строку.


- **Оповещения** по умолчанию отправляются при наличии повторяющихся сбоев в течение 15 минут. Но для настройки чувствительности это значение можно изменить; можно также изменять адреса электронной почты, на которые отправляются оповещения.

#### Тестирование дополнительных URL-адресов

Вы можете добавить тесты для любого необходимого количества URL-адресов. Например, при тестировании домашней страницы можно также проверить, запущена ли база данных, путем тестирования URL-адреса поиска.


### <a name="monitor"></a>3. Просмотр отчетов о доступности

Через 1–2 минуты щелкните «Обновить» в колонке «Доступность». (Не обновляется автоматически.)

![Сводка по результатам в домашнем разделе](./media/app-insights-monitor-web-app-availability/14-availSummary.png)

Диаграмма в колонке «Доступность» содержит результаты всех веб-тестов данного приложения.

#### Компоненты страницы

Процесс тестирования включает запрос изображений, таблиц стилей и скриптов, а также других статических компонентов.

Записанное время ответа — это время, затраченное на загрузку всех компонентов.

Если не удается загрузить какой-либо компонент, тест будет помечен, как сбойный.

## <a name="failures"></a>При возникновении сбоев...

В колонке «Веб-тесты» прокрутите вниз и щелкните тест, в котором появилась ошибки.

![Открытие конкретного веб-теста](./media/app-insights-monitor-web-app-availability/15-webTestList.png)

Это показывает результаты теста.

![Открытие конкретного веб-теста](./media/app-insights-monitor-web-app-availability/16-1test.png)

Тест проводится из нескольких расположений. Выберите одно, в котором результаты меньше 100 %.

![Открытие конкретного веб-теста](./media/app-insights-monitor-web-app-availability/17-availViewDetails.png)


Прокрутите вниз до пункта **Неудачные тесты** и выберите результат.

Щелкните результат, чтобы проанализировать его на портале и просмотреть причину сбоя.

![Результат выполнения веб-теста](./media/app-insights-monitor-web-app-availability/18-availDetails.png)


Можно также скачать файл результатов и изучить его в Visual Studio.


*Кажется, что все работает правильно, но выдается отчет об ошибке?* Проверьте все изображения, сценарии, таблицы стилей и любые другие файлы, загружаемые на страницу. Если любой из них дает сбой, отчет о тесте будет выдавать ошибку, даже если главная HTML-страница загружается правильно.



## Многошаговые веб-тесты

Вы можете контролировать сценарий, который содержит последовательность URL-адресов. Например, в случае наблюдения за интернет-магазином вы можете проверить, что добавление товаров в корзину работает исправно.

Для создания многошагового теста необходимо записать сценарий с помощью Visual Studio и затем отправить запись в Application Insights. Application Insights будет периодически воспроизводить сценарий и проверять ответы.

#### 1. Запись сценария

Для записи веб-сеанса используйте Visual Studio Ultimate.

1. Создайте проект веб-теста производительности.

    ![В Visual Studio создайте новый проект на основе шаблона «Веб-тест производительности» и «Нагрузочный тест».](./media/app-insights-monitor-web-app-availability/appinsights-71webtest-multi-vs-create.png)

2. Откройте файл webtest и начните запись.

    ![Откройте WEBTEST-файл и щелкните «Запись».](./media/app-insights-monitor-web-app-availability/appinsights-71webtest-multi-vs-start.png)

3. Выполните действия пользователя, которые нужно смоделировать в тесте: откройте веб-сайт, добавьте продукт в корзину и т. д. Затем остановите тест.

    ![Запись веб-теста выполняется в Internet Explorer.](./media/app-insights-monitor-web-app-availability/appinsights-71webtest-multi-vs-record.png)

    Не делайте слишком длинный сценарий. Ограничение — 100 шагов или 2 минуты.

4. Запустите тест в Visual Studio и убедитесь, что он работает.

    Средство выполнения веб-тестов откроет веб-браузер и повторит записанные действия. Убедитесь, что тест работает правильно.

    ![В Visual Studio откройте WEBTEST-файл и щелкните «Выполнить».](./media/app-insights-monitor-web-app-availability/appinsights-71webtest-multi-vs-run.png)
 

(Не вставляйте циклы в код веб-теста.)

#### 2. Передача веб-теста в Application Insights

1. Создайте новый веб-тест на портале Application Insights.

    ![В колонке «Веб-тесты» нажмите кнопку «Добавить».](./media/app-insights-monitor-web-app-availability/16-another-test.png)

2. Выберите многошаговый тест и загрузите файл .webtest.

    ![Выберите многошаговый веб-тест.](./media/app-insights-monitor-web-app-availability/appinsights-71webtestUpload.png)

Просмотр результатов теста и всех ошибок выполняется так же, как и для тестов с одним URL.

Распространенной причиной ошибок является слишком большое время выполнения теста. Тест должен выполняться не более двух минут.

Не забывайте, что для успешного завершения теста на страницу необходимо корректно загрузить все ресурсы, в том числе сценарии, таблицы стилей, изображения и т. д.


### Вставка времени и случайных чисел в многошаговый тест

Предположим, что вы тестируете инструмент, который получает зависящие от времени данные (например, запасы) от внешнего источника. При записи веб-теста необходимо использовать определенные значения времени, но они должны быть заданы как параметры теста StartTime и EndTime.

![Веб-тест с параметрами.](./media/app-insights-monitor-web-app-availability/appinsights-72webtest-parameters.png)

При запуске теста параметру EndTime следует всегда присваивать текущее время, а параметру StartTime — время за 15 минут до текущего.

Подключаемые модули веб-теста позволяют сделать это.

1. Добавьте подключаемые модули веб-теста для всех необходимых значений переменных параметров. На панели инструментов веб-теста выберите **Добавить подключаемый модуль веб-теста**.

    ![Щелкните «Добавить подключаемый модуль веб-теста» и выберите тип.](./media/app-insights-monitor-web-app-availability/appinsights-72webtest-plugins.png)

    В этом примере мы используем два экземпляра подключаемого модуля даты и времени. Для первого экземпляра будет задано время за 15 минут до текущего, а для второго — текущее время.

2. Откройте свойства каждого подключаемого модуля. Присвойте ему имя и настройте его для использования текущего времени. Для одного из экземпляров задайте для параметра "Добавление минут" значение "-15".

    ![Задайте имя, выберите «Использовать текущее время» и «Добавить минуты».](./media/app-insights-monitor-web-app-availability/appinsights-72webtest-plugin-parameters.png)

3. В веб-параметрах теста используйте {{имя подключаемого модуля}} для ссылки на имя подключаемого модуля.

    ![В параметрах теста используйте {{имя подключаемого модуля}}.](./media/app-insights-monitor-web-app-availability/appinsights-72webtest-plugin-name.png)

Теперь можно загрузить тест на портал. Он будет использовать динамические значения при каждом тестировании.

## <a name="edit"></a>Изменение или отключение теста

Откройте отдельный тест, чтобы изменить или отключить его.

![Изменение или отключение веб-теста](./media/app-insights-monitor-web-app-availability/19-availEdit.png)

Отключение веб-тестов может потребоваться при выполнении обслуживания в службе.

## <a name="video"></a>Видео

> [AZURE.VIDEO monitoring-availability-with-application-insights]

## <a name="next"></a>Дальнейшие действия

[Поиск по журналам диагностики][diagnostic]

[Устранение неполадок][qna]




<!--Link references-->

[azure-availability]: ../insights-create-web-tests.md
[diagnostic]: app-insights-diagnostic-search.md
[qna]: app-insights-troubleshoot-faq.md
[start]: app-insights-get-started.md

 

<!---HONumber=62-->