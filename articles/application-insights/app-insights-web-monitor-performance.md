<properties 
	pageTitle="Отслеживание работоспособности и использования приложения с помощью Application Insights" 
	description="Приступая к работе с Application Insights. Анализ использования, доступности и производительности локальных приложений или веб-приложений Microsoft Azure." 
	services="application-insights" 
    documentationCenter=""
	authors="alancameronwills" 
	manager="keboyd"/>

<tags 
	ms.service="application-insights" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="ibiza" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="04/02/2015" 
	ms.author="awills"/>
 
# Отслеживание производительности в веб-приложениях

*Доступна только предварительная версия Application Insights.*


Она позволяет удостовериться, что приложение работает с хорошей производительностью, и быстро выяснить, были ли сбои. [Application Insights][start] сообщает о любых проблемах с производительностью и исключениях, помогая выявлять и диагностировать их причины.

Служба Application Insights может отслеживать веб-приложения ASP.NET и службы WCF, размещенные в локальной среде или на виртуальных машинах, а также веб-сайты Microsoft Azure.


## <a name="setup"></a>Настройка мониторинга производительности

Если вы еще не добавили Application Insights в проект (т. е. если в нем нет файла ApplicationInsights.config), вы можете приступить к работе с этой службой одним из следующих способов:

* [Добавьте Application Insights в проект своего приложения в среде Visual Studio][greenbrown] (рекомендуется). Кроме пассивного мониторинга производительности, вы можете вести журналы диагностики и отслеживать использование.
* [Отслеживайте производительность работающего веб-сайта][redfield] — для этого не нужно обновлять проект приложения или выполнять повторное развертывание веб-сайта.
* [Для веб-сайтов Microsoft Azure](../insights-how-to-customize-monitoring.md) вы можете просматривать метрики в области веб-сайта «Мониторинг». 

Любой из этих методов позволит быстро просмотреть данные в колонке «Обзор» в Application Insights.


## <a name="view"></a>Изучение метрик

Щелкните любой заголовок, чтобы увидеть результаты более подробно и за больший период. Например, щелкните плитку «Запросы» и выберите временной диапазон.


![Щелкните плитки, чтобы увидеть подробные данные, и выберите временной диапазон](./media/app-insights-web-monitor-performance/appinsights-48metrics.png)

Щелкните диаграмму, чтобы выбрать, какие метрики отображать, а также добавить новую диаграмму и выбрать метрики для нее.

![Щелкните график, чтобы выбрать метрики](./media/app-insights-web-monitor-performance/appinsights-61perfchoices.png)

> [AZURE.NOTE]**Отмените выбор всех метрик**, чтобы увидеть полный набор доступных метрик. Метрики разделены на группы: если выбран один из элементов группы, отображаются только метрики этой группы.


## <a name="metrics"></a>Что все это означает? Плитки и отчеты о производительности

Для просмотра доступны самые разнообразные метрики производительности. Начнем с тех, которые отображаются в колонке приложения по умолчанию.


### Requests (Запросы)

Это число HTTP-запросов, полученных за указанный период. Сравните это значение с результатами в других отчетах, чтобы узнать, как ведет себя приложение при изменении нагрузки.

HTTP-запросы включают в себя все запросы GET и POST для страниц, данных и изображений.

Чтобы просмотреть счетчики для конкретных URL-адресов, щелкните плитку.

### Average response time (Среднее время ответа)

Это время от поступления веб-запроса в приложение до возвращения ответа.

Точки показывают скользящее среднее. Если запросов много, для некоторых из них значения могут отклоняться от среднего, но при этом на графике не будет явных пиков или провалов.

Обращайте внимание на необычные пики. Как правило, время ответа растет с увеличением числа запросов. Если этот рост непропорционален, возможно, приложение исчерпало какой-либо ресурс, например ЦП или емкость используемой службы.

Чтобы просмотреть значения для конкретных URL-адресов, щелкните плитку.

![](./media/app-insights-web-monitor-performance/appinsights-42reqs.png)


### Slowest requests (Самые медленные запросы)

![](./media/app-insights-web-monitor-performance/appinsights-44slowest.png)

Показывает, какие запросы могут потребовать оптимизации производительности.


### Failed requests (Неудачные запросы)

![](./media/app-insights-web-monitor-performance/appinsights-46failed.png)

Это счетчик запросов, которые вызвали не перехваченные исключения.

Чтобы просмотреть подробные сведения о конкретных сбоях, щелкните плитку. Чтобы просмотреть подробные сведения об отдельном запросе, выберите его.

Для детального изучения доступна только репрезентативная выборка сбоев.

### Другие метрики

Чтобы увидеть, какие еще метрики доступны, щелкните график и снимите все флажки метрик. Чтобы просмотреть определение конкретной метрики, щелкните значок (i).

![Снимите все флажки, чтобы увидеть полный набор метрик](./media/app-insights-web-monitor-performance/appinsights-62allchoices.png)


Выбор любой метрики отключит остальные, и они не будут отображаться на этой диаграмме.

## Добавление дополнительных счетчиков производительности

Некоторые метрики, доступные для выбора, представляют собой [счетчики производительности](http://www.codeproject.com/Articles/8590/An-Introduction-To-Performance-Counters). Windows содержит много таких счетчиков. Вы можете также определить свой счетчик.

Если требующиеся счетчики отсутствуют в списке, их можно добавить в набор, который собирает пакет SDK. Откройте файл ApplicationInsights.config и измените директиву сборщика данных производительности:

    <Add Type="Microsoft.ApplicationInsights.Extensibility.PerfCollector.PerformanceCollectorModule, Microsoft.ApplicationInsights.Extensibility.PerfCollector">
      <Counters>
        <Add PerformanceCounter="\Objects\Processes"/>
        <Add PerformanceCounter="\Sales(electronics)# Items Sold" ReportAs="Item sales"/>
      </Counters>
    </Add>

Используется следующий формат: `\Category(instance)\Counter"`, а для категорий без экземпляров — просто `\Category\Counter`.

`ReportAs` требуется для имен счетчиков, которые содержат символы, отличные от букв, круглых скобок, косой черты, дефисов, символов подчеркивания, пробелов и точек.

При указании экземпляра он будет собираться в качестве свойства CounterInstanceName обнаруженной метрики.

Для выполнения той же процедуры при желании можно написать код:

    var perfCollector = new PerformanceCollectorModule();
    perfCollector.Counters = new List<CustomPerformanceCounterCollectionRquest>();
    perfCollector.Counters.Add(new CustomPerformanceCounterCollectionRquest(
      @"\Sales(electronics)# Items Sold", "Items sold"));
    perfCollector.Initialize(TelemetryConfiguration.Active);
    TelemetryConfiguration.Active.TelemetryModules.Add(perfCollector);



## Задайте предупреждения

Чтобы получать уведомления по электронной почте о нетипичных значениях любой метрики, добавьте предупреждение. Можно выбрать отправку либо по электронной почте администраторам учетной записи, либо на указанный электронный адрес.

![](./media/app-insights-web-monitor-performance/appinsights-413setMetricAlert.png)

Выбирайте ресурс прежде других свойств. Не выбирайте ресурсы webtest, если нужно задать предупреждения метрик производительности или использования.

Аккуратно указывайте единицы измерения для пороговых значений.

*Отсутствует кнопка «Добавить оповещение»*. Вы используете учетную запись группы с доступом только для чтения? Обратитесь к администратору учетной записи.

## <a name="diagnosis"></a>Диагностические проблемы

Вот некоторые советы по выявлению и диагностике проблем с производительностью:

* настройте [веб-тесты][availability], чтобы получать оповещения, когда веб-сайт выходит из строя либо отвечает неправильно или медленно; 
* сравните число запросов с другими метриками, чтобы узнать, не связаны ли сбои или медленный ответ с нагрузкой;
* [вставьте в код инструкции трассировки и выполняйте поиск по ним][diagnostic], чтобы упростить выявление проблем.

## <a name="next"></a>Дальнейшие действия

[Веб-тесты][availability] — настройте отправку веб-запросов к приложению через равные интервалы из разных точек мира.

[Сбор данных трассировки диагностики и поиск по ним][diagnostic] — добавьте вызовы трассировки и анализируйте результаты для выявления проблем.

[Отслеживание использования][usage] — получайте информацию о том, как люди используют ваше приложение.

[Устранение неполадок][qna], а также часто задаваемые вопросы.

## Видео

[AZURE.VIDEO performance-monitoring-application-insights]

<!--Link references-->

[availability]: app-insights-monitor-web-app-availability.md
[diagnostic]: app-insights-diagnostic-search.md
[greenbrown]: app-insights-start-monitoring-app-health-usage.md
[qna]: app-insights-troubleshoot-faq.md
[redfield]: app-insights-monitor-performance-live-website-now.md
[start]: app-insights-get-started.md
[usage]: app-insights-web-track-usage.md

 

<!---HONumber=July15_HO3-->