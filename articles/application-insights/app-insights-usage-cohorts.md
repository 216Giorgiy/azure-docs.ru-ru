---
title: Когорты потребления Azure Application Insights | Документация Майкрософт
description: Анализ различных наборов пользователей, сеансов, событий и операций по общему критерию.
services: application-insights
documentationcenter: ''
author: mrbullwinkle
manager: carmonm
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: multiple
ms.topic: article
ms.date: 04/10/2018
ms.author: mbullwin ; daviste
ms.openlocfilehash: 68453499cc6477cc079a342906614e6873938fc8
ms.sourcegitcommit: 9cdd83256b82e664bd36991d78f87ea1e56827cd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="application-insights-cohorts"></a>Когорты Application Insights

Когорта — это набор пользователей, сеансов, событий и операций, имеющих общий критерий. В Azure Application Insights когорты определяются запросом Analytics. Если вы неоднократно анализируете определенный набор пользователей или событий, с помощью когорт можно точно выразить интересующий вас набор.

![Область когорт](.\media\app-insights-usage-cohorts\001.png)

## <a name="cohorts-versus-basic-filters"></a>Сравнение когорт и базовых фильтров

Хотя когорты и фильтры используются схожим образом, определение когорт строится на основе пользовательских запросов Analytics, что позволяет им быть более гибкими и сложными. В отличие от фильтров когорты можно сохранить, чтобы другие участники вашей команды могли повторно их использовать.

Можно определить когорту пользователей, которые пробовали новую функцию в приложении. С помощью этой когорты, сохраненной в ресурсе Application Insights, в будущем можно будет проанализировать определенную группу пользователей одним щелчком мыши.

> [!NOTE]
> После создания когорты будут доступны из средств пользователей, сеансов, событий и маршрутов пользователей.

## <a name="example-engaged-users"></a>Пример: активные пользователи

Команда определяет активных пользователей как тех, кто использует приложение не менее пяти раз в месяц. Давайте определим когорту этих активных пользователей.

1. Откройте средство **Когорты**.

2. Щелкните вкладку **Коллекция шаблонов**. Здесь можно найти коллекцию шаблонов для различных когорт.

3. Выберите **Engaged Users** – by Days Used (Активные пользователи — по дням пользования службой).

    В этой когорте есть три параметра:
      * **Действия**. Позволяют выбрать, какие события и просмотры страницы считаются "использованием".
      * **Период**. Определение месяца.
      * **UsedAtleastCustom**. Количество раз, когда нужно что-то использовать в течение периода, чтобы считаться активным пользователем.

4. Установите для параметра **UsedAtleastCustom** (Использование не менее) значение "5+ дней", а для **периода** оставьте значение по умолчанию — 28 дней.

    ![Образ —](.\media\app-insights-usage-cohorts\003.png)

    Теперь эта когорта представляет все идентификаторы пользователей, отправленные с любым пользовательским событием или просмотром страницы в течение пяти отдельных дней за последние 28 дней.

5. Выберите команду **Сохранить**.

   > [!TIP]
   >  Назовите свою когорту, например "Активные пользователи (5+ дней)" и сохраните ее в "Мои отчеты" или "Общие отчеты", в зависимости от того, хотите ли вы предоставить другим пользователям доступ к ресурсу Application Insights для просмотра этой когорты.

6. Щелкните **Back to Gallery** (Обратно в коллекцию).

### <a name="what-can-you-do-with-this-cohort"></a>Что можно делать с помощью этой когорты

Откройте средство **Пользователи** в раскрывающемся списке **Показать**, выберите созданную когорту в разделе **Users who belong to…** (Пользователи, которые принадлежат...).

Теперь средство "Пользователи" выполнит фильтрацию по этой когорте пользователей:

![Область пользователей, отфильтрованная по определенной когорте](.\media\app-insights-usage-cohorts\004.png)

Обратите внимание на несколько важных моментов:
   * Это набор, который невозможно создать с помощью обычных фильтров. Логика данных более сложная.
   * Вы можете дополнительно фильтровать эту когорту, используя обычные фильтры в средстве "Пользователи". Поэтому, пока когорта определена для 28-дневных окон, диапазон времени можно по прежнему изменить в средстве "Пользователи" на 30, 60 или 90 дней. 

Это позволяет задавать более сложные вопросы, например _"были ли пользователи, которые были активны последние 28 дней, также активны последние 60 дней?"_, которые иначе невозможно было бы выразить через конструктор запросов.

## <a name="example-events-cohort"></a>Пример: когорты событий

Вы также можете создать когорты событий. Давайте определим когорту событий и просмотров страниц, а затем посмотрим, как использовать их в других средствах. Может быть полезно определить набор событий, которые ваша команда считает _активным использованием_, или набор событий, связанных с определенной новой функцией.

1. Откройте средство **Когорты**.

2. Щелкните вкладку **Коллекция шаблонов**. Здесь можно найти коллекцию шаблонов для различных когорт.

3. Выберите **Events Picker** (Средство выбора событий).

    ![Снимок экрана со средством выбора событий](.\media\app-insights-usage-cohorts\006.png)

4. В раскрывающемся списке **Действия** выберите события, которые должны входить в когорту.

5. Сохраните когорту и присвойте ей имя.

## <a name="example-active-users-where-you-modify-query"></a>Пример: активные пользователи (с изменением запроса)

Две предыдущие когорты были определены с помощью раскрывающихся списков. Однако для обеспечения полной гибкости их также можно определить с помощью запросов Analytics. Давайте посмотрим, как создать когорту пользователей из Соединенного Королевства.

![Анимированное пошаговое руководство по использованию средства "Когорты"](.\media\app-insights-usage-cohorts\cohorts0001.gif)

1. Откройте средство **Когорты**, щелкните вкладку **Коллекция шаблонов** и выберите **Blank Users cohort** (Пустая когорта пользователей).

    ![Пустая когорта пользователей](.\media\app-insights-usage-cohorts\001.png)

    Доступно три раздела:
       * Раздел с текстом Markdown, в котором можно более подробно описать когорту для других участников команды.

       * Раздел параметров, где можно создать собственные параметры, например, **Действия**, и другие раскрывающиеся списки из двух предыдущих примеров.

       * Раздел запросов, где можно определить когорту с помощью запроса Analytics.

    В этом разделе мы [напишем запрос Analytics](https://docs.loganalytics.io/index), который выбирает определенный набор строк, описывающих когорту, которую необходимо определить. Затем средство "Когорты" неявно добавляет в запрос предложение "| summarize by user_Id" (| суммировать по ИД_пользователя). Выполнение запроса можно просмотреть под запросом в таблице, чтобы убедиться, что ваш запрос возвращает результаты.

    > [!NOTE]
    > Если вы не видите запрос, попробуйте изменить размер раздела, чтобы сделать его больше. Анимированный GIF-файл в начале этого раздела демонстрирует поведение при изменении размера.

2. Скопируйте, а затем вставьте следующее в редактор запросов:

    ```KQL
    union customEvents, pageViews
    | where client_CountryOrRegion == "United Kingdom"
    ```

3. Щелкните **Выполнить запрос**. В таблице отобразятся идентификаторы пользователей. Если нет, выберите страну, в которой у вашего приложения есть пользователи.

4. Сохраните и назовите когорту.

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

_Я определил когорту пользователей из определенной страны. Когда я в средстве "Пользователи" сравниваю результаты применения этой когорты с применением простого фильтра, я вижу различные результаты. Почему?_

Когорты и фильтры отличаются. Предположим, что у вас есть когорта пользователей из Соединенного Королевства (определена, как в приведенном выше примере) и ее результаты сравниваются с заданным фильтром "Страна или регион = Соединенное Королевство".

* Версия с когортой покажет все события пользователей, которые отправили как минимум одно событие из Соединенного Королевства в текущем временном диапазоне. Если выполнить разделение по стране или региону, скорее всего, отобразится множество стран и регионов.
* В версии с фильтрами будут показаны только события из Соединенного Королевства. Если выполнить разделение по стране или региону, отобразится только Соединенное Королевство.

## <a name="learn-more"></a>Подробнее
- [Язык запросов Analytics](https://go.microsoft.com/fwlink/?linkid=856587)
- [Пользователи, сеансы, события](app-insights-usage-segmentation.md)
- [Средство "Маршруты пользователей"](app-insights-usage-flows.md)
- [Общие сведения об использовании](app-insights-usage-overview.md)