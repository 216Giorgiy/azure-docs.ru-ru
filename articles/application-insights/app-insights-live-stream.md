---
title: "Настраиваемые динамические метрики и диагностика в Azure Application Insights | Документация Майкрософт"
description: "Мониторинг веб-приложения в реальном времени с помощью настраиваемых метрик и диагностика проблем с помощью динамического веб-канала сбоев, трассировок и событий."
services: application-insights
documentationcenter: 
author: SoubhagyaDash
manager: carmonm
ms.assetid: 1f471176-38f3-40b3-bc6d-3f47d0cbaaa2
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: cfreeman
ms.translationtype: Human Translation
ms.sourcegitcommit: 5e92b1b234e4ceea5e0dd5d09ab3203c4a86f633
ms.openlocfilehash: 86e01cf6cb14334e85da4102610fa7feb66cb543
ms.contentlocale: ru-ru
ms.lasthandoff: 05/10/2017

---

# <a name="custom-live-metrics-and-events-monitor--diagnose-with-1-second-latency"></a>Пользовательские метрики и события Live Metrics: мониторинг и диагностика с задержкой в 1 секунду 
Live Metrics Stream показывает метрики и события [Application Insights](app-insights-overview.md) почти в реальном времени, с задержкой в одну секунду. Этот мгновенный мониторинг помогает сократить среднее время обнаружения и диагностики и соблюдать соглашения об уровне обслуживания. Вы можете:
* Осуществлять мониторинг пользовательских ключевых показателей эффективности (КПЭ) в реальном времени: экспериментируйте с фильтрами, разделяя и компонуя существующие данные телеметрии Application Insights, чтобы мгновенно получить наиболее важные КПЭ с портала. Нет необходимости изменять код, конфигурации или развертывания. Кроме того, доступны любые настраиваемые метрики или измерения, отправляемые пользователем.
* Осуществлять обнаружение и диагностику в реальном времени: просматривайте сбои запросов и зависимостей по мере их возникновения, включая подробные трассировки исключений. Отфильтровывайте известные проблемы, чтобы сосредоточиться на действительных или новых проблемах.
* Осуществлять отладку в реальном времени: воспроизведите проблему и просмотрите все связанные данные телеметрии в реальном времени, применив настраиваемый фильтр по конкретному идентификатору сеанса (или любому настраиваемому атрибуту), определяющему взаимодействие при воспроизведении. Собирайте сведения с любого сервера или со всех серверов, чтобы получить преимущество в исправления проблемы.
* Сразу же увидеть, как потребление ресурсов зависит от загрузки: отслеживайте *любой* счетчик производительности Windows в реальном времени, выполняя нагрузочные тесты, или отслеживайте рабочую среду, чтобы принимать меры до возникновения негативных последствий. Не требуется вносить изменения в конфигурации или развертывания.
* Проверять выпуск исправлений. Обеспечьте корректное обновление службы. Проверьте, окончательно ли исправлена произошедшая ошибка.
* Легко определить сервер, на котором возникают проблемы, и с помощью фильтра получить все КПЭ и динамические веб-каналы, относящиеся только к этому серверу.

Данные метрик и событий Live Metrics Stream бесплатны: плата за них не взимается. Эти данные передаются потоком с серверов по требованию при открытии интерфейса портала. Данные сохраняются только на то время, пока они отображаются на диаграмме, а затем удаляются. Полный набор функций доступен для классических приложений ASP.NET, а для приложений .NET Core в настоящее время доступен только фиксированный набор динамических метрик и примеров сбоев. Мы обеспечиваем все поддерживаемые пакеты SDK в нормальном состоянии для возможностей потоковой трансляции. 

Мы собираем данные потоковой трансляции из экземпляров приложения перед любой выборкой или применением каких-либо настраиваемых обработчиков данных телеметрии. 

![Видео о службе Live Metrics Stream](./media/app-insights-live-stream/youtube.png) [видео о службе Live Metrics Stream](https://www.youtube.com/watch?v=zqfHf1Oi5PY)

Чтобы открыть динамические метрики и события, щелкните элемент слева или нажмите кнопку в колонке "Обзор".

![В колонке обзора щелкните Live Stream (Динамический поток).](./media/app-insights-live-stream/live-stream-2.png)

## <a name="custom-live-kpi"></a>Пользовательский динамический КПЭ
Можно отслеживать пользовательский КПЭ в реальном времени, применяя произвольные фильтры к любым данным телеметрии Application Insights на портале. Щелкните элемент управления фильтром, появляющийся при наведении указателя мыши на любую диаграмму. На диаграмме ниже показан пользовательский КПЭ числа запросов с фильтрами по для атрибутам URL-адреса и длительности. Проверьте результат фильтрации в разделе "Просмотр потока", в котором отображается динамический веб-канал телеметрии, соответствующей критериям, которые можно указать в любой момент времени. 

![Пользовательский КПЭ запросов](./media/app-insights-live-stream/live-stream-filteredMetric.png)

Вы можете отслеживать не только количество. Параметры зависят от типа потока. Он может передавать любые данные телеметрии Application Insights: запросы, зависимости, исключения, трассировки, события или метрики. Поток может передавать и ваше [пользовательское измерение](app-insights-api-custom-events-metrics.md#properties).

![Параметры значения](./media/app-insights-live-stream/live-stream-valueoptions.png)

Помимо телеметрии Application Insights, можно также отслеживать любой счетчик производительности Windows, выбрав его в параметрах потока и указав имя счетчика производительности.

Динамические метрики объединяются дважды: локально на каждом сервере, а затем на всех серверах. Можно изменить режим по умолчанию для обоих случаев, выбрав другие параметры в соответствующих раскрывающихся списках.

## <a name="sample-telemetry-custom-live-diagnostic-events"></a>Пример данных телеметрии: пользовательские события динамической диагностики
По умолчанию динамический веб-канал событий отображает примеры завершившихся сбоем запросов и вызовов зависимостей, исключений, событий и трассировок. Щелкните значок фильтра, чтобы просмотреть действующие критерии в любой момент времени. 

![Динамический веб-канал по умолчанию](./media/app-insights-live-stream/live-stream-eventsdefault.png)

Как и для метрик, можно указать любые произвольные критерии для любого типа данных телеметрии Application Insights. В этом примере мы выбираем конкретные сбои запросов, трассировки и события. Мы также выбираем все исключения и сбои зависимостей.

![Пользовательский динамический веб-канал](./media/app-insights-live-stream/live-stream-events.png)

Примечание. В настоящее время для критериев на основе сообщений об исключениях используйте сообщение о внешнем исключении. В предыдущем примере, чтобы отфильтровать неопасные исключения с сообщением о внутреннем исключении (после разделителя "<--") "Клиент отключен", использовался критерий "Message not-contains "Error reading request content"" (Сообщение не содержит "Ошибка при чтении содержимого запроса").

Просмотрите сведения об элементе динамического веб-канала, щелкнув его. Можно приостановить веб-канал, щелкнув **Приостановить**, прокрутив вниз или щелкнув элемент. Работа динамического веб-канала возобновится, когда вы прокрутите его обратно до начала или щелкните счетчик элементов, собранных во время приостановки.

![Выборка динамических ошибок](./media/app-insights-live-stream/live-metrics-eventdetail.png)

## <a name="filter-by-server-instance"></a>Фильтрация по экземпляру сервера

Если требуется отслеживать определенный экземпляр роли сервера, можно применить фильтрацию по серверу.

![Выборка динамических ошибок](./media/app-insights-live-stream/live-stream-filter.png)

## <a name="sdk-requirements"></a>Требования к пакетам SDK
Пользовательские метрики и события Live Metrics Stream доступны при использовании версии 2.4.0-beta2 или более новой версии [пакета SDK для Application Insights для веб-приложений](https://www.nuget.org/packages/Microsoft.ApplicationInsights.Web/). Не забудьте выбрать параметр "Включить предварительные выпуски" в диспетчере пакетов NuGet.

## <a name="authenticated-channel"></a>Аутентифицированный канал
Указываемые вами пользовательские критерии фильтра передаются в компонент Live Metrics в пакете SDK для Application Insights. Фильтры могут содержать конфиденциальные сведения, например идентификаторы клиентов. Помимо ключа инструментирования, канал для их передачи можно защитить секретным ключом API.
### <a name="create-an-api-key"></a>Создание ключа API

![Создание ключа API](./media/app-insights-live-stream/live-metrics-apikeycreate.png)

### <a name="add-api-key-to-configuration"></a>Добавление ключа API в конфигурацию
В файле applicationinsights.config добавьте AuthenticationApiKey в QuickPulseTelemetryModule.
``` XML

<Add Type="Microsoft.ApplicationInsights.Extensibility.PerfCounterCollector.QuickPulse.QuickPulseTelemetryModule, Microsoft.AI.PerfCounterCollector">
      <AuthenticationApiKey>YOUR-API-KEY-HERE</AuthenticationApiKey>
</Add> 

```
Или задайте его в коде для QuickPulseTelemetryModule.

``` C#

    module.AuthenticationApiKey = "YOUR-API-KEY-HERE";

```

Однако, если все подключенные серверы опознаны и надежны, можно использовать настраиваемые фильтры без аутентифицированного канала. Эта возможность доступна в течение шести месяцев. Это переопределение требуется после каждого создания сеанса или подключения нового сервера.

![Параметры аутентификации Live Metrics](./media/app-insights-live-stream/live-stream-auth.png)

>[!NOTE]
>Настоятельно рекомендуется установить аутентифицированный канал перед вводом в критерии фильтра потенциально конфиденциальной информации, например идентификатора клиента.
>

## <a name="troubleshooting"></a>Устранение неполадок

Данные отсутствуют? Если приложение находится в защищенной сети: Live Metrics Stream использует IP-адреса, отличающиеся IP-адресов другой телеметрии Application Insights. Убедитесь, что [эти IP-адреса](app-insights-ip-addresses.md) открыты в брандмауэре.



## <a name="next-steps"></a>Дальнейшие действия
* [Отслеживание использования Application Insights.](app-insights-web-track-usage.md)
* [Использование диагностического поиска](app-insights-diagnostic-search.md)


