<properties 
	pageTitle="Диагностика проблем с зависимостями в Application Insights" 
	description="Найдите сбои и операции с низкой производительностью, вызванные зависимостями." 
	services="application-insights" 
    documentationCenter=""
	authors="alancameronwills" 
	manager="ronmart"/>

<tags 
	ms.service="application-insights" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="ibiza" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="04/16/2015" 
	ms.author="awills"/>
 
# Диагностика проблем с зависимостями в Application Insights


*Зависимость* — это внешний компонент, который вызывается приложением. Как правило, это служба, вызываемая с использованием HTTP, база данных или файловая система. В Visual Studio Application Insights можно легко увидеть то, сколько времени приложение ожидает зависимости и как часто происходит сбой вызова зависимости.

## Возможное применение

Мониторинг зависимостей по умолчанию сейчас доступен для:

* веб-приложений и служб ASP.NET, работающих на сервере IIS или на платформе Azure.

Для других типов приложений, таких как веб-приложения Java или приложения для устройств, можно самостоятельно написать монитор, используя TrackDependency API.

Сейчас монитор зависимостей по умолчанию предоставляет отчеты о вызовах зависимостей таких типов:

* Базы данных SQL
* веб-службы и службы WCF ASP.NET;
* вызовы локальных или удаленных HTTP;
* Azure DocumentDB, очередь, таблица и хранилище больших двоичных объектов.

Напомним, что можно самостоятельно написать вызовы SDK для мониторинга других зависимостей.

## Настройка мониторинга зависимостей

Для выполнения мониторинга зависимостей необходимо выполнить следующее:

* используйте [монитор состояний](app-insights-monitor-performance-live-website-now.md) на сервере IIS и с его помощью включите мониторинг;
* добавьте [расширение Application Insights](../insights-perf-analytics.md) в веб-приложение или виртуальную машину Azure.

(Для добавления в виртуальную машину Azure можно установить расширение с панели управления Azure или установить монитор состояний таким же образом, как на любой другой машине).

Описанные выше действия можно выполнить, если веб-приложение уже развернуто. Нет необходимости добавлять Application Insights в исходный проект, чтобы выполнить стандартный мониторинг зависимостей.

## Диагностика проблем с производительностью зависимостей

Чтобы оценить производительность запросов сервера:

![На странице «Обзор» приложения в Application Insights щелкните плитку «Производительность».](./media/app-insights-dependencies/01-performance.png)

Прокрутите вниз, чтобы увидеть сетку запросов:

![Список запросов со средними значениями и их количеством](./media/app-insights-dependencies/02-reqs.png)

Получение ответа на верхний запрос заняло очень много времени. Давайте посмотрим, можно ли выяснить, на что потрачено время.

Щелкните эту строку, чтобы просмотреть события для отдельного запроса.


![Список вхождений запросов](./media/app-insights-dependencies/03-instances.png)

Щелкните любой длительный экземпляр, чтобы проверить его более детально.

> [AZURE.NOTE]Немного прокрутите вниз, чтобы выбрать экземпляр. Задержка в конвейере может означать неполноту данных верхних экземпляров.

Прокрутите вниз до вызовов удаленных зависимостей, связанных с этим запросом:

![Найдите вызовы удаленных зависимостей и определите необычную продолжительность.](./media/app-insights-dependencies/04-dependencies.png)

По-видимому, большую часть времени обработки этого запроса занял вызов локальной службы.

Выберите эту строку, чтобы получить дополнительную информацию:


![Щелкните эту удаленную зависимость, чтобы определить причину.](./media/app-insights-dependencies/05-detail.png)

Подробности включают в себя достаточно данных для диагностики проблемы.



## Сбои

При наличии неудачных запросов щелкните диаграмму.

![Щелкните диаграмму неудачных запросов.](./media/app-insights-dependencies/06-fail.png)

Щелкните тип и экземпляр запроса, чтобы найти удаленную зависимость, вызов которой не удалось выполнить.


![Щелкните тип запроса, а затем его экземпляр, чтобы открыть этот же экземпляр в другом представлении. Щелкните его еще раз, чтобы просмотреть подробную информацию об исключении.](./media/app-insights-dependencies/07-faildetail.png)


<!--Link references-->

<!---HONumber=62-->