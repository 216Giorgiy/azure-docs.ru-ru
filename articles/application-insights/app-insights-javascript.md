<properties
	pageTitle="Application Insights для веб-приложений JavaScript | Microsoft Azure"
	description="Получайте данные о количестве просмотров страницы и количестве сеансов, данные веб-клиента и отслеживайте закономерности использования. Выявляйте исключения и проблемы с производительностью на веб-страницах JavaScript."
	services="application-insights"
    documentationCenter=""
	authors="alancameronwills"
	manager="douge"/>

<tags
	ms.service="application-insights"
	ms.workload="tbd"
	ms.tgt_pltfrm="ibiza"
	ms.devlang="na"
	ms.topic="get-started-article"
	ms.date="02/19/2016"
	ms.author="awills"/>

# Application Insights для веб-страниц

[AZURE.INCLUDE [app-insights-selector-get-started-dotnet](../../includes/app-insights-selector-get-started-dotnet.md)]

Узнайте о производительности и использовании своей веб-страницы или приложения. Добавьте Visual Studio Application Insights в сценарий страницы, и вы узнаете время загрузки страницы и вызовов AJAX, сведения об исключениях браузера, ошибках AJAX и их количестве, а также количество пользователей и сеансов. Все эти данные можно разбить по страницам, версии клиентской ОС и браузера, географическому расположению и другим показателям. Можно также настроить оповещения для определенного количества сбоев или медленной загрузки страниц.

Application Insights можно использовать с любыми веб-страницами — просто добавьте небольшой фрагмент кода JavaScript. Для веб-службы [Java](app-insights-java-get-started.md) или [ASP.NET](app-insights-asp-net.md) можно интегрировать данные телеметрии, полученные с сервера и клиентских компьютеров.

Вам потребуется подписка на [Microsoft Azure](https://azure.com). Если у вашей группы есть подписка организации, попросите владельца подписки добавить в нее вашу учетную запись Майкрософт. Если выбрать бесплатную ценовую категорию, разработка и использование в небольших масштабах не потребуют никаких денежных затрат.


## Настройка Application Insights для веб-страницы

Возможно, она уже выполнена. Если ваше приложение представляет собой новый проект ASP.NET и вы добавили Application Insights в диалоговом окне "Новый проект" в Visual Studio, сценарий был добавлен именно в этот момент, и все параметры настроились автоматически.

В противном случае необходимо добавить на веб-страницы фрагмент кода следующим образом.

### Открытие ресурса Application Insights

Ресурс Application Insights — это место, где отображаются данные о производительности и об использовании страницы.

Войдите на [портал Azure](https://portal.azure.com).

Если вы уже настроили мониторинг приложения на стороне сервера, то у вас уже есть ресурс:

![Последовательно выберите пункты «Обзор», «Службы для разработчиков» и «Application Insights».](./media/app-insights-javascript/01-find.png)

Если ресурса у вас нет, создайте его.

![Последовательно выберите пункты «Создать», «Службы для разработчиков», «Application Insights»](./media/app-insights-javascript/01-create.png)


*Уже появились вопросы?* [Дополнительная информация о создании ресурса](app-insights-create-new-resource.md).


### Добавление сценария пакета SDK в приложение или на веб-страницу

В разделе «Быстрый запуск» получите сценарий для веб-страниц:

![В колонке обзора приложения последовательно выберите элементы «Быстрый запуск», «Получить код для мониторинга моих веб-страниц». Скопируйте сценарий.](./media/app-insights-javascript/02-monitor-web-page.png)

Вставьте сценарий непосредственно перед тегом `<head>` каждой страницы, которую вы хотите отслеживать. Если на вашем веб-сайте есть главная страница, можно разместить сценарий на ней. Например:

* В проекте ASP.NET MVC разместите сценарий на странице `View\Shared\_Layout.cshtml`.
* На сайте SharePoint на панели управления откройте [Параметры сайта/Главная страница](app-insights-sharepoint.md).

Сценарий содержит ключ инструментирования, который направляет данные к ресурсу Application Insights.

([Подробное объяснение сценария.](http://apmtips.com/blog/2015/03/18/javascript-snippet-explained/))

*(Если вы используете известную платформу веб-страницы, найдите адаптеры Application Insights. Например, [модуль AngularJS](http://ngmodules.org/modules/angular-appinsights).)*


## Подробные сведения

Вы можете задать несколько [параметров](https://github.com/Microsoft/ApplicationInsights-JS/blob/master/API-reference.md#config), хотя в большинстве случаев это не требуется. Например, можно отключить регистрацию вызовов AJAX при каждом просмотре страницы или ограничить их количество (чтобы уменьшить трафик), либо задать режим отладки, чтобы быстрее пропустить данные телеметрии через конвейер, не выполняя пакетные операции.

Чтобы задать эти параметры, найдите следующую строку в фрагменте кода и добавьте после нее несколько элементов, разделенных запятой:

    })({
      instrumentationKey: "..."
      // Insert here
    });

[Доступные параметры](https://github.com/Microsoft/ApplicationInsights-JS/blob/master/API-reference.md#config) включают:

    // Send telemetry immediately without batching.
    // Remember to remove this when no longer required, as it
    // can affect browser performance.
    enableDebug: true,

    // Don't log browser exceptions.
    disableExceptionTracking: true,

    // Limit number of Ajax calls logged, to reduce traffic.
    maxAjaxCallsPerView: 10, // default is 500

    // Set these dynamically for an authenticated user.
    appUserId: string,
    accountId: string,



## <a name="run"></a>Запуск приложения

Запустите веб-приложение, используйте его в течение непродолжительного времени для формирования телеметрии и подождите несколько секунд. Вы также можете запустить приложение на компьютере, на котором ведется разработка, нажав клавишу **F5**, или опубликовать и позволить пользователям его использовать.

Если вам надо проверить телеметрию, отправляемую веб-приложением в Application Insights, используйте инструменты отладки браузера (во многих браузерах это можно сделать нажатием клавиши **F12**). Данные отправляются по адресу dc.services.visualstudio.com.

## Просмотр данных о производительности браузера

Откройте колонку "Браузеры", чтобы отобразить сводные данные о производительности, поступающие из браузеров пользователей.

![На сайте portal.azure.com откройте ресурс приложения и щелкните "Параметры", а затем "Браузер".](./media/app-insights-javascript/03.png)


*Еще нет данных? Нажмите кнопку **Обновить** в верхней части страницы. По-прежнему нет данных? См. раздел [Устранение неполадок](app-insights-troubleshoot-faq.md).*

Колонка "Браузеры" — это [колонка обозревателя метрик](app-insights-metrics-explorer.md) с предустановленными фильтрами и предварительно выбранными параметрами диаграмм. При необходимости можно изменить диапазон времени, фильтры и конфигурацию диаграмм и сохранить результат в избранном. Щелкните **Восстановить значения по умолчанию**, чтобы вернуться к исходной конфигурации колонки.

## Производительность загрузки страниц

Вверху экрана отображается сегментированная диаграмма времени загрузки страницы. Общая высота диаграммы представляет среднее время загрузки и отображения страниц приложения в браузерах пользователей. Время отсчитывается от момента, когда браузер отправляет первоначальный запрос HTTP, до момента, когда завершается обработка всех синхронных событий загрузки, включая макет и выполняющиеся сценарии. Асинхронные задачи, такие как загрузка веб-частей из вызовов AJAX, не учитываются.

На этой диаграмме общее время загрузки страницы разбито на [стандартные отрезки времени, определенные консорциумом W3C](http://www.w3.org/TR/navigation-timing/#processing-model).

![](./media/app-insights-javascript/08-client-split.png)

Обратите внимание, что значение времени *подключения к сети* часто меньше ожидаемого, так как это среднее значение по всем запросам из браузера на сервер. Для множества отдельных запросов значение времени подключения — «0» из-за наличия активного подключения к серверу.

### Медленная загрузка

Медленная загрузка страниц — основная причина недовольства пользователей. Если диаграмма показывает, что страницы загружаются медленно, вы можете выполнить ряд простых диагностических исследований.

На диаграмме показано среднее время загрузки всех страниц в приложении. Чтобы узнать, связана ли проблема с определенными страницами, найдите в колонке таблицу, где данные разбиты по URL-адресам страниц:

![](./media/app-insights-javascript/09-page-perf.png)

Обратите внимание на количество просмотров страниц и стандартное отклонение. Если страниц очень мало, проблема не доставляет пользователям особых неудобств. Высокий уровень стандартного отклонения (относительно среднего уровня) указывает на большие различия между отдельными измерениями.

**Данные для отдельного URL-адреса и отдельного просмотра страницы.** Щелкните имя любой страницы, чтобы отобразить колонку диаграмм браузера, отфильтрованных только для этого URL-адреса. То же самое можно сделать для экземпляра представления страницы.

![](./media/app-insights-javascript/35.png)

Щелкните `...`, чтобы увидеть полный список свойств для данного события или проверить вызовы AJAX и связанные события. Медленные вызовы AJAX влияют на общее время загрузки страницы, если они выполняются синхронно. К связанным событиям относятся запросы сервера для того же URL-адреса (если вы настроили Application Insights на веб-сервере).


**Производительность страниц со временем.** Вернитесь в колонку "Браузеры" и вместо таблицы "Время загрузки страницы" выберите график, на котором отображаются пиковые значения в определенное время:

![Щелкните заголовок таблицы и выберите новый тип диаграммы.](./media/app-insights-javascript/10-page-perf-area.png)

**Сегментация по другим показателям.** Возможно, загрузка страниц происходит медленнее в конкретном браузере, клиентской ОС или расположении пользователя? Добавьте новую диаграмму и поэкспериментируйте с параметром **Группировка по**.

![](./media/app-insights-javascript/21.png)


## Производительность вызовов AJAX

Убедитесь, что все вызовы AJAX на веб-страницах работают нормально. Они часто используются для асинхронного заполнения частей страницы. Иногда вся страница загружается быстро, но остаются пустые веб-части, данные в которых отображаются не сразу. Естественно, это вызывает раздражение пользователей.

Вызовы AJAX, выполняемые с веб-страницы, отображаются в колонке "Браузеры" как зависимости.

В верхней части колонки есть сводные диаграммы:

![](./media/app-insights-javascript/31.png)

Подробные таблицы приводятся ниже:

![](./media/app-insights-javascript/33.png)

Щелкните любую строку для получения подробной информации.


> [AZURE.NOTE] Если удалить фильтр "Браузеры" в колонке, зависимости сервера и зависимости AJAX будут включены в эти диаграммы. Чтобы повторно настроить фильтр, щелкните "Восстановить значения по умолчанию".

**Для быстрого анализа вызовов AJAX, завершившихся сбоем**, прокрутите вниз до таблицы сбоев зависимостей и щелкните строку, чтобы просмотреть конкретные экземпляры.

![](./media/app-insights-javascript/37.png)

Щелкните `...`, чтобы получить полные данные телеметрии для вызова AJAX.

### Вызовы AJAX не регистрируются?

Вызовы AJAX включают все вызовы HTTP из сценария веб-страницы. Если они не регистрируются, проверьте, не заданы ли в фрагменте кода [параметры](https://github.com/Microsoft/ApplicationInsights-JS/blob/master/API-reference.md#config) `disableAjaxTracking` или `maxAjaxCallsPerView`.

## Исключения браузера

В нижней части колонке "Браузеры" есть сводная диаграмма исключений и таблица типов исключений.

![](./media/app-insights-javascript/39.png)

Если исключения браузера не регистрируются, проверьте, не задан ли в фрагменте кода [параметр](https://github.com/Microsoft/ApplicationInsights-JS/blob/master/API-reference.md#config) `disableExceptionTracking`.

## Изучение отдельных событий просмотра страницы

Обычно телеметрия просмотра страниц анализируется службой Application Insights, и вы видите только сводные отчеты со средними значениями для всех пользователей. Однако в целях отладки можно также изучать отдельные события просмотра страниц.

В колонке Diagnostic Search (Поиск данных диагностики) в разделе Filter (Фильтр) установите флажок Page View (Просмотр страниц).

![](./media/app-insights-javascript/12-search-pages.png)

Выберите любое событие, чтобы просмотреть подробные сведения. На странице сведений нажмите кнопку «...», чтобы открыть еще более подробные сведения.

> [AZURE.NOTE] Если вы используете [Поиск](app-insights-diagnostic-search.md), обратите внимание, что вы должны сопоставлять слова целиком: «Пр» и «о» не соответствуют «Про», в отличие от «Пр*». Поисковый запрос нельзя начинать с подстановочного знака. Например, по запросу "*нформаци" не будет найдено слово "Информация".

> [Дополнительная информация о поиске диагностических данных](app-insights-diagnostic-search.md)

### Свойства просмотра страниц

* **Длительность просмотра страницы**. Время, необходимое для загрузки страницы и запуска сценариев. В частности, имеется в виду промежуток времени между началом загрузки страницы и выполнением сценария trackPageView. Если после инициализации сценария trackPageView вы переместили его из обычного положения, значение будет иным.


## Настраиваемые счетчики страниц

По умолчанию счетчик страницы увеличивается на единицу каждый раз, когда страница загружается в клиентском браузере. Однако вам может потребоваться подсчитать дополнительные просмотры страницы. Например, если содержимое страницы разбито на вкладки, возможно, вы захотите, чтобы счетчик увеличивался на единицу при каждом переключении между ними. Другой пример — ситуация, когда код JavaScript на странице загружает новое содержимое, но URL-адрес в браузере при этом не меняется.

Вставьте в соответствующем месте клиентского кода вызов JavaScript наподобие следующего:

    appInsights.trackPageView(myPageName);

Имя страницы может содержать те же символы, что и URL-адрес, но все символы после "#" или "?" игнорируются.



## Отслеживание использования


Хотите узнать, что пользователи делают в вашем приложении?

* [Дополнительные сведения об отслеживании использования](app-insights-web-track-usage.md)
* [Дополнительные сведения об API пользовательских событий и метрик](app-insights-api-custom-events-metrics.md).


#### <a name="video"></a>Видео «Отслеживание использования»

> [AZURE.VIDEO tracking-usage-with-application-insights]

## <a name="next"></a>Дальнейшие действия

* [Отслеживание использования](app-insights-web-track-usage.md)
* [Пользовательские события и метрики](app-insights-api-custom-events-metrics.md)
* [Сборка, измерение и обучение](app-insights-overview-usage.md)

<!------HONumber=AcomDC_0224_2016-->