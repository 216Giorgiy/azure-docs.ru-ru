<properties 
	pageTitle="Использование поиска по журналу диагностики" 
	description="Выполняйте поиск и фильтрацию отдельных событий, запросов и данных трассировки." 
	services="application-insights" 
    documentationCenter=""
	authors="alancameronwills" 
	manager="douge"/>

<tags 
	ms.service="application-insights" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="ibiza" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="07/08/2015" 
	ms.author="awills"/>
 
# Поиск по журналу диагностики в Application Insights

"Поиск по журналу диагностики" — это колонка в [Application Insights][start], которая позволяет искать и изучать отдельные данные телеметрии, например просмотры страниц, исключения и веб-запросы. Также можно просматривать журнал трассировки и события, которые были закодированы.

## Как увидеть колонку поиска по журналу диагностики?

Колонку поиска по журналу диагностики можно открыть явно:

![Откройте поиск по журналу диагностики](./media/app-insights-diagnostic-search/01-open-Diagnostic.png)


Она также открывается при щелчке некоторых диаграмм и элементов сетки. В этом случае ее фильтры предварительно настраиваются так, чтобы сфокусироваться на типе выбранного элемента.

Например, если приложение является веб-службой, в колонке обзора будет отображаться диаграмма объема запросов. Щелкните его и получите более подробную диаграмму с перечислением, показывающим, сколько запросов было выполнено для каждого URL-адреса. Щелкните любую строку и получите список отдельных запросов для данного URL-адреса:

![Откройте поиск по журналу диагностики](./media/app-insights-diagnostic-search/07-open-from-filters.png)


Основная часть колонки поиска по диагностическим данных — это список элементов телеметрии: запросы сервера, просмотры страниц, пользовательские события, которые были закодированы, и т. д. В верхней части списка находится сводная диаграмма, отображающая количество событий в динамике.


## Проверка отдельных элементов

Выберите любой элемент телеметрии для просмотра ключевых полей и связанных элементов. Чтобы увидеть полный набор полей, нажмите кнопку "...".

![Откройте поиск по журналу диагностики](./media/app-insights-diagnostic-search/10-detail.png)

Чтобы просмотреть полный набор полей, используйте обычные строки (без подстановочных знаков). Доступные поля зависят от типа элемента телеметрии.

## Фильтрация по типам событий

Откройте колонку "Фильтр" и выберите типы событий, которые требуется просмотреть. (Если впоследствии потребуется восстановить фильтры, с которыми вы открыли колонку, нажмите кнопку сброса).


![Щелкните "Фильтр" и укажите типы элементов телеметрии](./media/app-insights-diagnostic-search/02-filter-req.png)


Ниже приведены типы событий.

* **Трассировка** — журналы диагностики, включая TrackTrace, log4Net, NLog и вызовы System.Diagnostic.Trace.
* **Запрос** — HTTP-запросы, полученные вашим серверным приложением, включая страницы, скрипты, изображения, файлы стилей и данные. Эти события используются для создания обзорных диаграмм запросов и ответов.
* **Просмотр страницы** — элемент телеметрии, отправленный веб-клиентом и используемый для создания отчетов о просмотрах страниц. 
* **Пользовательское событие** — при вставке в код вызовов TrackEvent() для [отслеживания использования][track], эти вызовы можно найти здесь.
* **Исключение** — неперехваченные исключения на сервере и те, которые запротоколированы с помощью метода TrackException().

## Фильтрация на основе значений свойств

Можно фильтровать события по значениям их свойств. Доступные свойства зависят от выбранных типов событий.

Например, можно выбрать запросы с определенным кодом ответа.

![Разверните свойство и выберите значение](./media/app-insights-diagnostic-search/03-response500.png)

Выбор "ни одно из значений" конкретного свойства имеет тот же эффект, что и выбор всех значений: он отключает фильтрацию по этому свойству.


### Сужение области поиска

Обратите внимание, что счетчики справа от значений фильтра показывают число вхождений в текущем отфильтрованном наборе.

В этом примере ясно, что запрос `Reports/Employees` вернул в большинстве случаев ошибку с кодом 500:

![Разверните свойство и выберите значение](./media/app-insights-diagnostic-search/04-failingReq.png)

Кроме того, если необходимо просмотреть, какие другие события происходили в течение этого времени, можно установить флажок **Включить события с неопределенными свойствами**.

## Исключение программ-роботов и веб-тест трафика

Используйте фильтр **Реальный или искусственный трафик** и установите флажок **Реальный**.

Также можно фильтровать по **источнику искусственного трафика**.

## Проверка отдельных вхождений

Если добавить имя данного запроса к набору фильтров, то затем можно будет проверять отдельные вхождения этого события.

![Выберите значение](./media/app-insights-diagnostic-search/05-reqDetails.png)

Для событий "Запросы" отображаются сведения об исключениях, возникших во время обработки запроса.

Щелкните исключение, чтобы просмотреть его данные, включая трассировку стека.

![Щелкните исключение](./media/app-insights-diagnostic-search/06-callStack.png)

## Поиск событий с одним и тем же свойством

Поиск всех элементов с одинаковым значением свойства:

![Щелкните правой кнопкой мыши свойство](./media/app-insights-diagnostic-search/12-samevalue.png)

## Поиск по значению метрики

Получить все значения времени ответа на запрос, превышающие 5 с. Время отображается в тактах: 10 000 тактов составляют 1 мс.

!["Response time":(threshold TO *)](./media/app-insights-diagnostic-search/11-responsetime.png)



## Поиск данных

В любом из значений свойств можно искать слова. Это особенно полезно, если вы написали [пользовательские события][track] со значениями свойств.

Можно задать временной диапазон, так как поиск в более коротком диапазоне выполняется быстрее.

![Откройте поиск по журналу диагностики](./media/app-insights-diagnostic-search/appinsights-311search.png)

Обратите внимание, что поиск ведется по словам, а не по подстрокам. Слова — это последовательности букв и цифр с определенными знаками пунктуации, например "." и "\_". Например:

Слово|*НЕ* будут найдены|Будут найдены
---|---|---
HomeController.About|about<br/>home|h*about<br/>home*
IsLocal|local<br/>is<br/>*local|isl*<br/>islocal<br/>i*l
New Delay|w d|new<br/>delay<br/>n* AND d*


Вот доступные поисковые выражения:

Пример запроса | Результат 
---|---
медленный|Поиск всех элементов в диапазоне дат, поля которых включают слово "медленный"
database??|Находит database01, databaseAB,...<br/>Подстановочный знак "?" не допускается в начале слова поиска.
database*|Находит database, database01, databaseNNNN<br/>Подстановочный знак "?" не допускается в начале слова поиска.
яблоко AND банан|Находит события, содержащие оба этих слова. Используйте "AND" заглавными буквами, а не "and".
яблоко OR банан<br/>яблоко банан|Находит события, содержащие любое из этих слов. Используйте "OR", а не "or".</br/>Короткая форма.
яблоко NOT банан<br/>яблоко -банан|Находит события, содержащие только одно из этих слов, но не содержащие второе.<br/>Краткая форма.
ябл* AND банан -(виноград груша)|Логические операторы и скобки.
"Метрика": 0 TO 500<br/>"Метрика": 500 TO * | Поиск событий, содержащих именованный показатель в диапазоне значений.


## Сохранение результатов поиска

После задания всех нужных фильтров параметры поиска можно сохранить как избранное. Если вы используете учетную запись организации, можно выбрать, будут ли другие члены команды иметь к ним доступ.

![Щелкните "Избранное", задайте имя и нажмите кнопку "Сохранить"](./media/app-insights-diagnostic-search/08-favorite-save.png)


Чтобы восстановить параметры поиска, **перейдите в колонку обзора ** и откройте избранное:

![Плитка "Избранное"](./media/app-insights-diagnostic-search/09-favorite-get.png)

Если сохранение было выполнено с относительным временным диапазоном, повторно открытая колонка будет содержать самые последние данные. Если сохранение было выполнено с абсолютным временным диапазоном, каждый раз будут отображаться одни и те же данные.


## Передача дополнительных элементов телеметрии в Application Insights

В дополнение к стандартным элементам телеметрии, передаваемым пакетом SDK Application Insights, можно сделать следующее.

* Протоколировать данные, используя избранную платформу ведения журнала в [.NET][netlogs] или [Java][javalogs]. Благодаря этому можно будет выполнить поиск в журнале трассировки и сопоставить результаты с просмотрами страниц, исключениями и другими событиями. 
* [Написать код][track] для отправки пользовательских событий, сведений о просмотрах страниц и исключениях. 

[Подробнее о передаче в Application Insights журналов и пользовательских элементов телеметрии][trace].


## <a name="questions"></a>Вопросы и ответы

### <a name="limits"></a>Какой объем данных сохраняется?

До 500 событий в секунду от каждого приложения. События сохраняются в течение семи дней.

### Как просмотреть данные POST в запросах к серверу?

Мы не заносим в журнал данные POST автоматически, но вы можете использовать [вызовы TrackTrace или журнала][trace]. Поместите данные POST в параметр сообщения. Нельзя отфильтровать сообщения тем способом, как это делается для свойств, но предельный размер больше.

## <a name="add"></a>Дальнейшие действия

* [Передача в Application Insights журналов и пользовательских элементов телеметрии][trace]
* [Настройка тестов доступности и скорости реагирования][availability]
* [Устранение неполадок][qna]



<!--Link references-->

[availability]: app-insights-monitor-web-app-availability.md
[javalogs]: app-insights-java-trace-logs.md
[netlogs]: app-insights-asp-net-trace-logs.md
[qna]: app-insights-troubleshoot-faq.md
[start]: app-insights-get-started.md
[trace]: app-insights-search-diagnostic-logs.md
[track]: app-insights-custom-events-metrics-api.md

 

<!---HONumber=August15_HO6-->