<properties
   pageTitle="Функции шаблонов в диспетчере ресурсов Azure"
   description="Описывает функции, используемые в шаблоне диспетчера ресурсов Azure для извлечения значений, форматирования строк и получения сведений о развертывании."
   services="azure-resource-manager"
   documentationCenter="na"
   authors="tfitzmac"
   manager="wpickett"
   editor=""/>

<tags
   ms.service="azure-resource-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="07/27/2015"
   ms.author="tomfitz"/>

# Функции шаблонов в диспетчере ресурсов Azure

В этом разделе описаны все функции, которые можно использовать в шаблоне диспетчера ресурсов Azure.

## base64

**base64 (входная\_строка)**

Возвращает входную строку в кодировке Base64.

| Параметр | Обязательно | Описание
| :--------------------------------: | :------: | :----------
| входная\_строка | Да | Строковое значение, которое нужно вернуть в кодировке Base64.

В следующем примере показано, как использовать функцию Base64.

    "variables": {
      "usernameAndPassword": "[concat('parameters('username'), ':', parameters('password'))]",
      "authorizationHeader": "[concat('Basic ', base64(variables('usernameAndPassword')))]"
    }

## concat

**concat (аргумент1, аргумент2, аргумент3...)**

Объединяет несколько строковых значений и возвращает строковое значение. Эта функция может принимать любое количество аргументов.

В следующем примере показано объединение нескольких значений для возврата значения.

    "outputs": {
        "siteUri": {
          "type": "string",
          "value": "[concat('http://',reference(resourceId('Microsoft.Web/sites', parameters('siteName'))).hostNames[0])]"
        }
    }

## copyIndex

**copyIndex(offset)**

Возвращает индекс текущего цикла итерации. Примеры использования этой функции см. в статье [Создание нескольких экземпляров ресурсов в диспетчере ресурсов Azure](resource-group-create-multiple.md).

## deployment

**deployment()**

Возвращает сведения о текущей операции развертывания.

Сведения о развертывании возвращаются в виде объекта со следующими свойствами:

    {
      "name": "",
      "properties": {
        "template": {},
        "parameters": {},
        "mode": "",
        "provisioningState": ""
      }
    }

В следующем примере показано, как получить сведения о развертывании в разделе выходных данных.

    "outputs": {
      "exampleOutput": {
        "value": "[deployment()]",
        "type" : "object"
      }
    }

## listKeys

**listKeys (имя\_ресурса или идентификатор\_ресурса, [версия\_API])**

Возвращает ключи учетной записи хранения. Параметр "идентификатор\_ресурса" можно задать с помощью [функции resourceId](./#resourceid) или с использованием формата **пространство\_имен\_поставщика/тип\_ресурса/имя\_ресурса**. Вы можете использовать эту функцию для получения primaryKey и secondaryKey.
  
| Параметр | Обязательно | Описание
| :--------------------------------: | :------: | :----------
| имя\_ресурса или идентификатор\_ресурса | Да | Уникальный идентификатор учетной записи хранения.
| версия\_API | Да | Версия API для состояния среды выполнения ресурса.

В следующем примере показано, как получить ключи из учетной записи хранения в разделе выходных данных.

    "outputs": { 
      "exampleOutput": { 
        "value": "[listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), providers('Microsoft.Storage', 'storageAccounts').apiVersions[0])]", 
        "type" : "object" 
      } 
    } 

## padLeft

**padLeft (строка\_для\_заполнения, общая\_длина, символ\_заполнения)**

Возвращает выровненную по правому краю строку, добавляя символы в левую часть до достижения общее указанной длины.
  
| Параметр | Обязательно | Описание
| :--------------------------------: | :------: | :----------
| строка\_для\_заполнения | Да | Строка, предназначенная для выравнивания по правому краю.
| общая\_длина | Да | Общее число символов в возвращаемой строке.
| символ\_заполнения | Да | Символ, используемый для заполнения левой части до достижения общей длины.

В следующем примере показано, как заполнить предоставленное пользователем значение параметра, добавляя символ нуля, пока длина строки не достигнет 10 символов. Если исходное значение параметра длиннее 10 символов, символы не добавляются.

    "parameters": {
        "appName": { "type": "string" }
    },
    "variables": { 
        "paddedAppName": "[padLeft(parameters('appName'),10,'0')]"
    }


## parameters

**parameters (имя\_параметра)**

Возвращает значение параметра. Указанное имя параметра должно быть определено в разделе параметров шаблона.

| Параметр | Обязательно | Описание
| :--------------------------------: | :------: | :----------
| имя\_параметра | Да | Имя параметра, который требуется вернуть.

В следующем примере показано упрощенное использование функции parameters.

    "parameters": { 
      "siteName": {
          "type": "string"
      }
    },
    "resources": [
       {
          "apiVersion": "2014-06-01",
          "name": "[parameters('siteName')]",
          "type": "Microsoft.Web/Sites",
          ...
       }
    ]

## provider

**provider (пространство\_имен\_поставщика, [тип\_ресурса])**

Возвращает сведения о поставщике ресурсов и поддерживаемых им типах ресурсов. Если тип не указан, возвращаются все поддерживаемые типы.

| Параметр | Обязательно | Описание
| :--------------------------------: | :------: | :----------
| пространство\_имен\_поставщика | Да | Пространство имен поставщика.
| тип\_ресурса | Нет | Тип ресурса в указанном пространстве имен.

Все поддерживаемые типы возвращаются в следующем формате:

    {
        "resourceType": "",
        "locations": [ ],
        "apiVersions": [ ]
    }

Следующий пример показывает, как использовать функцию provider:

    "outputs": {
	    "exampleOutput": {
		    "value": "[providers('Microsoft.Storage', 'storageAccounts')]",
		    "type" : "object"
	    }
    }

## reference

**reference (имя\_ресурса или идентификатор\_ресурса, [версия\_API])**

Позволяет выражению получать значение из состояния среды выполнения другого ресурса.

| Параметр | Обязательно | Описание
| :--------------------------------: | :------: | :----------
| имя\_ресурса или идентификатор\_ресурса | Да | Имя или уникальный идентификатор ресурса.
| версия\_API | Нет | Версия API для состояния среды выполнения ресурса. Этот параметр нужно использовать, если ресурс не предоставляется в рамках того же шаблона.

Функция **reference** получает свое значение из состояния среды выполнения, и поэтому ее невозможно использовать в разделе переменных. Она может использоваться в разделе выходных данных шаблона.

С помощью выражения reference вы прямо объявляете, что один ресурс зависит от другого, если ресурс, на который указывает ссылка, предоставляется в том же шаблоне. При этом свойство **dependsOn** использовать не нужно. Расчет по выражению выполняется только после развертывания ресурса, на который указывает ссылка.

    "outputs": {
      "siteUri": {
          "type": "string",
          "value": "[concat('http://',reference(resourceId('Microsoft.Web/sites', parameters('siteName'))).hostNames[0])]"
      }
    }

## replace

**replace(исходная\_строка, старый\_символ, новый\_символ)**

Возвращает новую строку, где все экземпляры одного символа заменены другим символом.

| Параметр | Обязательно | Описание
| :--------------------------------: | :------: | :----------
| исходная\_строка | Да | Строка, в которой все экземпляры одного символа будут заменены другим символом.
| старый\_символ | Да | Символ, который удаляется из исходной строки.
| новый\_символ | Да | Символ, добавляемый вместо удаляемого символа.

В следующем примере показано, как удалить все тире из предоставленной пользователем строки.

    "parameters": {
        "identifier": { "type": "string" }
    },
    "variables": { 
        "newidentifier": "[replace(parameters('identifier'),'-','')]"
    }

## resourceGroup

**resourceGroup()**

Возвращает структурированный объект, представляющий текущую группу ресурсов. Формат объекта будет следующим:

    {
      "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}",
      "name": "{resourceGroupName}",
      "location": "{resourceGroupLocation}",
    }

В следующем примере расположение группы ресурсов используется для назначения расположения веб-сайту.

    "resources": [
       {
          "apiVersion": "2014-06-01",
          "type": "Microsoft.Web/sites",
          "name": "[parameters('siteName')]",
          "location": "[resourceGroup().location]",
          ...
       }
    ]

## resourceId

**resourceId ([имя\_группы\_ресурсов], тип\_ресурса, имя\_ресурса1, [имя\_ресурса2]...)**

Возвращает уникальный идентификатор ресурса. Используйте эту функцию в том случае, когда имя ресурса является неоднозначным или не было предоставлено в пределах того же шаблона. Идентификатор возвращается в следующем формате:

    /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/{resourceProviderNamespace}/{resourceType}/{resourceName}
      
| Параметр | Обязательно | Описание
| :---------------: | :------: | :----------
| имя\_группы\_ресурсов | Нет | Необязательное имя группы ресурсов. Значение по умолчанию — текущая группа ресурсов. Укажите это значение, если вы получаете ресурс из другой группы ресурсов.
| тип\_ресурса | Да | Тип ресурса, включая пространство имен поставщика ресурсов.
| имя\_ресурса1 | Да | Имя ресурса.
| имя\_ресурса2 | Нет | Имя следующего ресурса, если ресурс является вложенным.

В следующем примере показано, как получить идентификаторы ресурсов для веб-сайта и базы данных. Веб-сайт находится в группе ресурсов с именем **myWebsitesGroup**, а база данных — в текущей группе ресурсов для этого шаблона.

    [resourceId('myWebsitesGroup', 'Microsoft.Web/sites', parameters('siteName'))]
    [resourceId('Microsoft.SQL/servers/databases', parameters('serverName'),parameters('databaseName'))]
    
Эта функция часто необходима при использовании учетной записи хранения или виртуальной сети в альтернативной группе ресурсов. Учетная запись хранения и виртуальная сеть могут использоваться несколькими группами ресурсов, поэтому их не следует удалять при удалении одной группы ресурсов. В следующем примере показано, как можно легко использовать ресурс из внешней группы ресурсов:

    {
      "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
          "virtualNetworkName": {
              "type": "string"
          },
          "virtualNetworkResourceGroup": {
              "type": "string"
          },
          "subnet1Name": {
              "type": "string"
          },
          "nicName": {
              "type": "string"
          }
      },
      "variables": {
          "vnetID": "[resourceId(parameters('virtualNetworkResourceGroup'), 'Microsoft.Network/virtualNetworks', parameters('virtualNetworkName'))]",
          "subnet1Ref": "[concat(variables('vnetID'),'/subnets/', parameters('subnet1Name'))]"
      },
      "resources": [
      {
          "apiVersion": "2015-05-01-preview",
          "type": "Microsoft.Network/networkInterfaces",
          "name": "[parameters('nicName')]",
          "location": "[parameters('location')]",
          "properties": {
              "ipConfigurations": [{
                  "name": "ipconfig1",
                  "properties": {
                      "privateIPAllocationMethod": "Dynamic",
                      "subnet": {
                          "id": "[variables('subnet1Ref')]"
                      }
                  }
              }]
           }
      }]
    }


## подписку

**subscription()**

Возвращает сведения о подписке в следующем формате:

    {
        "id": "/subscriptions/#####"
        "subscriptionId": "#####"
    }

В следующем примере показана функция subscription, вызываемая в разделе выходных данных.

    "outputs": { 
      "exampleOutput": { 
          "value": "[subscription()]", 
          "type" : "object" 
      } 
    } 

## toLower

**toLower(изменяемая\_строка)**

Преобразует указанную строку в нижний регистр.

| Параметр | Обязательно | Описание
| :--------------------------------: | :------: | :----------
| изменяемая\_строка | Да | Строка для преобразования в нижний регистр.

В следующем примере предоставленное пользователем значение параметра преобразуется в нижний регистр.

    "parameters": {
        "appName": { "type": "string" }
    },
    "variables": { 
        "lowerCaseAppName": "[toLower(parameters('appName'))]"
    }

## toUpper

**toUpper(изменяемая\_строка)**

Преобразует указанную строку в верхний регистр.

| Параметр | Обязательно | Описание
| :--------------------------------: | :------: | :----------
| изменяемая\_строка | Да | Строка для преобразования в верхний регистр.

В следующем примере предоставленное пользователем значение параметра преобразуется в верхний регистр.

    "parameters": {
        "appName": { "type": "string" }
    },
    "variables": { 
        "upperCaseAppName": "[toUpper(parameters('appName'))]"
    }


## variables

**variables (имя\_переменной)**

Возвращает значение переменной. Указанное имя переменной должно быть определено в разделе переменных шаблона.

| Параметр | Обязательно | Описание
| :--------------------------------: | :------: | :----------
| имя\_переменной | Да | Имя переменной, которую необходимо вернуть.


## Дальнейшие действия
- Описание разделов в шаблоне диспетчера ресурсов Azure см. в статье [Создание шаблонов диспетчера ресурсов Azure](resource-group-authoring-templates.md).
- Инструкции по объединению нескольких шаблонов см. в статье [Использование связанных шаблонов в диспетчере ресурсов Azure](resource-group-linked-templates.md).
- Инструкции по выполнению заданного количества циклов итерации при создании типа ресурса см. в статье [Создание нескольких экземпляров ресурсов в диспетчере ресурсов Azure](resource-group-create-multiple.md).
- Инструкции по развертыванию созданного шаблона см. в статье [Развертывание приложения с использованием шаблона диспетчера ресурсов Azure](azure-portal/resource-group-template-deploy.md).

<!---HONumber=July15_HO5-->