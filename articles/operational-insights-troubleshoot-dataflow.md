<properties 
	pageTitle="Оперативная аналитика - устранение неполадок с агентами или потоком данных Operations Manager" 
	description="Способы устранения неполадок с напрямую подключенными агентами и потоком данных Operations Manager в службе оперативной аналитики Azure" 
	services="operational-insights" 
	documentationCenter="" 
	authors="dani3l3" 
	manager="jwhit" 
	editor=""/>

<tags 
	ms.service="operational-insights" 
	ms.workload="appservices" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="2/23/2015" 
	ms.author="dmuscett"/>


#Устранение неполадок с агентами или потоком данных Operations Manager в службе оперативной аналитики
Следующий набор процедур следует использовать как руководство, которое поможет устранить неполадки с напрямую подключенными агентами или развертываниями Operations Manager, настроенными для передачи данных в службу оперативной аналитики Azure.

##Процедура 1. Проверка правильности скачанных пакетов управления в среду Operations Manager
*Примечание. Если вы используете только Direct Agent, вы можете перейти к следующей процедуре*.

Количество отображающихся пакетов управления зависит от того, какие пакеты аналитики включены на портале OpInsights. Найдите ключевое слово Advisor или Intelligence в их имени. 
Вы можете искать эти пакеты управления с помощью OpsMgr PowerShell:

      Get-SCOMManagementPack | where {$_.DisplayName -match 'Advisor'} | Select Name,Sealed,Version
      Get-SCOMManagementPack | where {$_.Name -match 'IntelligencePacks'} | Select Name,Sealed,Version
    
Примечание. При устранении неполадок в пакете аналитики емкости проверьте, СКОЛЬКО у вас пакетов управления с именем, включающим 'capacity': в наборе пакетов управления существует два пакета управления с одним отображаемым именем (но разными внутренними идентификаторами); если один из них не импортировать (это часто случается из-за отсутствующей зависимости VMM), другой пакет управления не импортируется и операция не выполняется повторно.

Следует просмотреть следующие три пакета управления, связанные с 'capacity'
1. Пакет аналитики емкости Microsoft System Center Advisor 
1. Пакет аналитики емкости Microsoft System Center Advisor 
1. Данные хранилища емкости Microsoft System Center Advisor 

Если вы видите только один или два, а не все три пакета, подождите 5-10 минут, пока Operations Manager повторно скачает и импортирует их, а тем временем проверьте журналы событий на предмет ошибок в этот период.

##Процедура 2. Проверка правильности скачанных пакетов аналитики в Direct Agent
*Примечание. Если вы используете только Operations Manager, можно пропустить эту процедуру*.

В Direct Agent политика коллекции пакетов аналитики должна кэшироваться в папке **C:\Program Files\Microsoft Monitoring Agent\Agent\Health Service State\Management Packs**


##Процедура 3. Проверка отправки данных в службу Advisor (или попытки отправки)
В зависимости от того, используете ли вы напрямую подключенные агенты или Operations Manager, можно выполнить следующую процедуру на компьютере Direct Agent или на сервере управления Operations Manager.

1. Откройте 'Системный монитор'. 
1. Выберите 'Группы управления службой работоспособности'.
1. Добавьте все счетчики, которые начинаются с 'HTTP'.

Если все настроено правильно, по мере отправки событий и других элементов данных (на основе пакетов аналитики, выставленных на портале, и настроенной политики коллекции журналов) для этих счетчиков должны появиться действия. Эти счетчики не должны быть постоянно 'заняты' - если действия не происходят, возможно, вы выставили немного пакетов аналитики или у вас очень простая политика коллекции. 

##Процедура 4. Проверка ошибок в журналах событий сервера управления или Direct Agent 
Наконец, если вы выполнили все вышеперечисленное, но служба все еще не получает данные, проверьте ошибки в **средстве просмотра событий**.

Откройте **средство просмотра событий** -> **Приложение и службы** -> **Operations Manager** и примените фильтр по источникам событий: **Advisor**, **Модули службы работоспособности**, **HealthService** и **Соединитель служб** (последнее применяется только к Direct Agent). 

Большинство этих событий, а также шаги по устранению неполадок будут аналогичны в Operations Manager и Direct Agent. 
Единственное отличие между Operations Manager и Direct Agent - это процесс регистрации (GUI в Operations Manager; комбинация идентификатора и ключа рабочей области в Direct Agent) но после первоначальной регистрации происходит обмен сертификатами, и все остальное взаимодействие со службой происходит аналогично.

Следовательно, многие из этих событий применяются к обоим типам инфраструктуры отчетности. Далее представлен список наиболее частых из них.

###События из источника  'Модули службы работоспособности'
#####EventID 2138
Это означает, что для прокси-сервера требуется проверка подлинности. Выполните действия по [настройке прокси-серверов](https://msdn.microsoft.com/library/azure/dn884643.aspx)

#####EventID 2137
Operations Manager не может прочитать сертификат проверки подлинности. Повторный запуск мастера регистрации Advisor исправит сертификаты и учетные записи запуска от имени

#####EventID 2132
Это означает **Не авторизовано**. Возможно, возникла проблема с сертификатом или регистрацией в службе; попробуйте перезапустить мастер регистрации, который исправит сертификаты и учетные записи запуска от имени. Кроме того, убедитесь, что на прокси-сервере разрешены исключения. Дополнительные сведения см. в разделе [Настройка прокси-серверов](https://msdn.microsoft.com/library/azure/dn884643.aspx)

#####EventID 2129
Это подключение, завершившееся сбоем из-за сбоя согласования SSL. Настройте системы для использования TLS, а не SSL. На этом сервере могут быть заданы необычные параметры SSL для шифров в меню **Дополнительно** Internet Explorer или в разделе реестра Windows  

    HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL

#####EventID 2127
При отправке данных о сбое был получен код ошибки. Если это происходит редко, возможно, это простой сбой. Обратите внимание на их частоту. Если сбои происходят очень часто (каждые 10 минут в течение продолжительного периода времени), это действительно может быть ошибкой. Проверьте параметры сети и прокси-сервера, описанные выше, и перезапустите мастер регистрации. Но если это происходит только время от времени (т. е. пару раз в день), все должно быть нормально после того, как данные будут поставлены в очередь и повторно переданы. Возможно, время ожидания сети истекло (если это происходит с такой периодичностью).
 
Некоторые коды ошибок HTTP имеют следующие специальные значения: 

- при ПЕРВОЙ отправке данных MMA Direct Agent или сервером управления в службу появится ошибка 500 с внутренним кодом ошибки 404 (404 означает "не найдено"). Это указывает на то, что область хранилища, которая будет использоваться для этой новой рабочей области, еще не готова - идет ее подготовка. Однако при следующей попытке она будет готова и поток начнет работать (в обычных условиях).
- 403 может указывать на проблему с разрешениями или учетными данными и т. д. 

#####EventID 2128
Сбой разрешения DNS-имени. Ваш сервер не может разрешить адрес в Интернете, по которому ему следует отправлять данные. Возможно, неправильно настроены параметры сопоставителя DNS на компьютере, параметры прокси-сервера или возникла (временная) проблема с DNS у поставщика. Как и в предыдущем событии, в зависимости от того, постоянно это происходит или 'время от времени', это может указывать или не указывать на ошибку.

#####EventID 2130
Время ожидания истекло. Как и в предыдущем событии, в зависимости от того, постоянно это происходит или время от времени, это может указывать или не указывать на ошибку.

### События из источника 'HealthService'
#####EventID 4511
Не удается загрузить модуль "System.PublishDataToEndPoint" - не удалось найти файл. Сбой инициализации модуля типа "System.PublishDataToEndPoint" (CLSID "{D407D659-65E4-4476-BF40-924E56841465}") с кодом ошибки. Система не может найти указанный файл.  
Эта ошибка означает, что библиотеки DLL на компьютере устарели и не содержат нужные модули. Чтобы это исправить, обновите серверы управления до последнего накопительного пакета обновления.

#####EventID 4502
Сбой модуля. Если это происходит для рабочих процессов с такими именами, как **CollectInstanceSpace** или **CollectTypeSpace**, возможно, на сервере возникли проблемы с отправкой данных конфигурации. В зависимости от частоты происходящего (постоянно или время от времени) это может указывать или не указывать на ошибку. Если сбой происходит чаще, чем раз в час, это определенно представляет проблему. Если сбой операции происходит один или два раза в день, она будет восстановлена. В зависимости от того, как происходит сбой модуля (в описании содержатся дополнительные сведения), это может быть локальной ошибкой, т. е. при сборе данных в базу данных, или ошибкой отправки в облако. Проверьте параметры сети и прокси-сервера и в крайнем случае попробуйте перезапустить HealthService.

#####EventID 4501
Сбой модуля System.PublishDataToEndPoint. Модуль типа System.PublishDataToEndPoint сообщил об ошибке 87L, запущенной в рамках правила Microsoft.SystemCenter.CollectAlertChangeDataToCloud, выполняющегося для экземпляра "Группа управления Operations Manager" с id:"{6B1D1BE8-EBB4-B425-08DC-2385C5930B04}" в группе управления SCOMTEST. 
Эта ошибка больше НЕ должна появляться в этом рабочем процессе и модуле, так как [ошибка * теперь исправлена*](http://feedback.azure.com/forums/267889-azure-operational-insights/suggestions/6714689-alert-management-intelligence-pack-not-sending-ale). При возникновении сообщите о ней по любому предпочтительному каналу поддержки Майкрософт.


### События из источника 'Service Connector'
#####EventID 4002
Служба вернула код состояния HTTP 403 в ответ на запрос.  Обратитесь к администратору службы, чтобы проверить ее работоспособность. Повторная попытка запроса будет выполнена позже. Вы можете получить ошибку 403 во время первоначальной регистрации агента. Появится следующий URL-адрес: https://<YourWorkspaceID>.oms.opinsights.azure.com/ AgentService.svc/AgentTopologyRequest
Код ошибки 403 означает "запрещено" - обычно он вызывается из-за неправильно скопированного значения идентификатора рабочей области или ключа либо тем, что часы на компьютере не синхронизированы. Попробуйте выполнить синхронизацию с надежным источником времени и используйте проверку подключения в приложении панели управления для Microsoft Monitoring Agent, чтобы убедиться, что у вас есть нужный идентификатор рабочей области и ключ. 





##Процедура 5. Просмотр агентов для отправки данных и индексирования их на портале
Откройте портал OpInsights, со страницы "Обзор" перейдите на маленькую плитку **Серверы и использование** - это покажет, отправляют ли группы управления (и их агенты) и агенты Direct Agent данные в систему поиска. Количество агентов на плитке является производным от данных: если компьютеры не сообщают данные в течение 2 недель, радар будет отключен.

Подробные сведения перенаправят вас в систему поиска и покажут метку времени последних индексированных данных для каждого компьютера. Здесь вы можете просмотреть, что это за данные. В зависимости от количества данных в настроенной коллекции данных и пакетов аналитики расписание отправки данных и скорость могут отличаться.

На этой странице также представлены сведения измерений (здесь используется не индекс поиска, а система выставления счетов, которая обновляется каждые два часа) о количестве данных, отправленных в службу, разделенную пакетом аналитики.

<!--HONumber=52-->