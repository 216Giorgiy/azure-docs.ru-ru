<properties 
	pageTitle="Использование портала управления для создания каналов, выполняющих динамическое кодирование односкоростного потока в мультискоростной" 
	description="В этом руководстве подробно описаны все этапы создания канала, который получает на вход динамический односкоростной поток данных и преобразует его в мультискоростной." 
	services="media-services" 
	documentationCenter="" 
	authors="Juliako" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="media-services" 
	ms.workload="media" 
	ms.tgt_pltfrm="na" 
	ms.devlang="ne" 
	ms.topic="article" 
	ms.date="04/29/2015" 
	ms.author="juliako"/>


#Использование портала управления для создания каналов, выполняющих динамическое кодирование односкоростного потока в мультискоростной \(предварительная версия\)


В этом руководстве подробно описаны все этапы создания **канала**, который получает на вход динамический односкоростной поток данных и преобразует его в мультискоростной.

>[AZURE.NOTE]Более фундаментальную информацию о каналах, способных выполнять динамическое кодирование, см. в статье [Работа с каналами, выполняющими динамическое преобразование односкоростных потоков в мультискоростные](media-services-manage-live-encoder-enabled-channels.md).

##Стандартный сценарий потоковой передачи в режиме реального времени

Ниже описываются основные этапы создания стандартных приложений, предназначенных для потоковой передачи в реальном времени.

1. Подключите видеокамеру к компьютеру. Запустите и настройте локальный динамический кодировщик, который может выдавать односкоростной поток по одному из следующих протоколов: RTMP, Smooth Streaming или RTP \(MPEG-TS\). Дополнительные сведения см. в статье [Поддержка протокола RTMP службами мультимедиа Azure и динамические кодировщики](http://go.microsoft.com/fwlink/?LinkId=532824).
	
	Это действие также можно выполнить после создания канала.

1. Создайте и запустите канал.

1. Получите URL-адрес приема канала.

	URL-адрес приема используется динамическим кодировщиком для отправки потока в канал.
1. Получите URL-адрес предварительного просмотра канала. 

	С его помощью можно убедиться в том, что канал надлежащим образом получает поток.

3. Создайте программу \(при этом также будет создан ресурс\).
1. Опубликуйте программу \(при этом будет создан указатель OnDemand для соответствующего ресурса\).  

	Убедитесь в том, что в конечной точке потоковой передачи, из которой будет передаваться содержимое, есть по крайней мере одна зарезервированная единица потоковой передачи.
1. Когда вы будете готовы начать потоковую передачу и архивацию, запустите программу.
2. При необходимости динамическому кодировщику можно дать сигнал начать объявление. Объявление вставляется в выходной поток.
1. Чтобы остановить потоковую передачу и архивацию содержимого мероприятия, завершите работу программы.
1. Удалите программу \(и при необходимости ресурс\).   

##В этом учебнике рассматриваются следующие темы:

В этом руководстве описано выполнение следующих задач с помощью портала управления Azure:

2.  Настройка конечных точек потоковой передачи данных.
3.  Создание канала, поддерживающего динамического кодирование.
1.  Получение URL-адреса приема для динамического кодировщика. Динамический кодировщик будет использовать этот URL-адрес для приема потока в канале.
1.  Создание программы \(и ресурса\).
1.  Публикация ресурса и получение URL-адресов для потоковой передачи.  
1.  Воспроизведение содержимого 
2.  Очистка.

##Предварительные требования
Ниже перечислены необходимые условия для выполнения действий, описанных в этом учебнике.

- Для работы с этим учебником требуется учетная запись Azure. Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в разделе [Бесплатная пробная версия Azure](azure.microsoft.com).
- Учетная запись служб мультимедиа. Инструкции по созданию учетной записи служб мультимедиа см. в разделе [Создание учетной записи](media-services-create-account.md).
- Веб-камера и кодировщик, который передает динамический односкоростной поток данных.

##Настройка конечной точки потоковой передачи с помощью портала

При работе со службами мультимедиа Azure один из самых частых сценариев — доставка клиентам потоковой передачи с адаптивной скоростью. С помощью потоковой передачи с адаптивным битрейтом клиент может переключаться на потоковую передачу с более высоким или более низким битрейтом, так как видео отображается на основе текущей пропускной способности сети, загрузки ЦП и других факторов. Службы мультимедиа поддерживают следующие технологии потоковой передачи с адаптивной скоростью: потоковая передача данных HTTP \(HLS\), Smooth Streaming, MPEG DASH и HDS \(только для владельцев лицензий Adobe PrimeTime/Access\).

При потоковой передаче данных локальный динамический кодировщик \(в нашем случае это Wirecast\) передает мультискоростной поток данных в режиме реального времени на вход каналу. Когда пользователь запрашивает поток, службы мультимедиа перепаковывают исходный поток с использованием технологии динамической упаковки в поток указанного формата с адаптивной скоростью \(HLS, DASH или Smooth\).

Для использования динамической упаковки потребуется получить по крайней мере одну единицу потоковой передачи для **конечной точки потоковой передачи**, из которой планируется передавать содержимое.

Чтобы изменить число зарезервированных единиц кодирования:

1. Войдите на [Портал управления](https://manage.windowsazure.com/) и щелкните элемент **Службы мультимедиа**. Затем щелкните имя службы мультимедиа.

2. Откройте страницу КОНЕЧНЫЕ ТОЧКИ ПОТОКОВОЙ ПЕРЕДАЧИ. Затем щелкните точку, которую требуется изменить.

3. Чтобы указать число единиц потоковой передачи, перейдите на вкладку МАСШТАБ и переместите ползунок **зарезервированная мощность**.

	![Страница «Масштаб»](./media/media-services-how-to-scale/media-services-origin-scale.png)

4. Нажмите кнопку СОХРАНИТЬ, чтобы сохранить изменения.

	Выделение новых единиц потоковой передачи занимает около 20 минут.

	 
	>[AZURE.NOTE]В настоящее время переход от любого положительного значения единиц потоковой передачи к нулевому может привести к отключению потоковой передачи на период до одного часа.
	>
	> Для расчета затрат используется наибольшее число единиц, указанных для 24-часового периода. Дополнительные сведения о ценах см. в разделе [Сведения о ценах для служб мультимедиа](http://go.microsoft.com/fwlink/?LinkId=275107).

 
##Создание канала

1.	На [портале управления](http://manage.windowsazure.com/) щелкните "Службы мультимедиа", а затем щелкните имя учетной записи служб мультимедиа.
2.	Выберите страницу КАНАЛЫ.
3.	Нажмите кнопку "Добавить +", чтобы добавить новый канал.

Выберите **стандартный** тип кодирования. Он указывает, что необходимо создать канал с поддержкой кодирования в режиме реального времени. Это означает, что входящий односкоростной поток отправляется в канал и преобразуется в мультискоростной поток на основе заданных параметров динамического кодировщика. Дополнительные сведения см. в статье [Работа с каналами, выполняющими динамическое преобразование односкоростного потока в мультискоростной](media-services-manage-live-encoder-enabled-channels.md).

![standard0][standard0]

Для **стандартного** типа допустимыми параметрами протокола приема являются следующие:

- односкоростной фрагментированный MP4 \(Smooth Streaming\);
- односкоростной RTMP;
- RTP \(MPEG-TS\): MPEG-2 TS по RTP.

Подробное объяснение каждого из протоколов см. в статье [Работа с каналами, выполняющими динамическое преобразование односкоростного потока в мультискоростной](media-services-manage-live-encoder-enabled-channels.md).

![standard1][standard1]

Во время работы канала или связанных с ним программ входной протокол изменить невозможно. Если вам нужны другие протоколы, создайте отдельный канал для каждого из них.

На странице **Конфигурация рекламы** можно указать источник для сигналов маркеров рекламы. При использовании портала можно выбрать только значение API. Оно означает, что динамический кодировщик канала должен ожидать передачи данных от асинхронного интерфейса API маркеров рекламы. При использовании портала можно выбрать только API.

Дополнительные сведения см. в статье [Работа с каналами, выполняющими динамическое преобразование односкоростного потока в мультискоростной](media-services-manage-live-encoder-enabled-channels.md).

![standard2][standard2]

На странице **Предустановки кодирования** вы можете выбрать предустановки системы. В настоящее время можно выбрать только значение **По умолчанию 720p**.

![standard3][standard3]

На странице **Создание канала** вы можете определить IP-адреса, с которых разрешено публиковать видео в этом канале. Разрешенные IP-адреса можно указать в виде одного IP-адреса \(например, 10.0.0.1\), диапазона IP-адресов, заданного с помощью IP-адреса и маски подсети CIDR \(например, 10.0.0.1/22\), или диапазона IP-адресов, заданного с помощью IP-адреса и маски подсети в десятичной записи \(например, 10.0.0.1\(255.255.252.0\)\).

Если не указаны IP-адреса и не определено правило, разрешенных IP-адресов нет. Чтобы разрешить любые IP-адреса, создайте правило и задайте адрес 0.0.0.0/0.


![standard4][standard4]

>[AZURE.NOTE]В предварительной версии запуск канала может занять до 30 минут. Сброс канала может занимать до 5 минут.

После создания канала вы можете выбрать вкладку **КОДИРОВЩИК**, где выводятся конфигурации каналов. Вы также можете управлять обычной и статической рекламой.

![standard5][standard5]

Дополнительные сведения см. в статье [Работа с каналами, выполняющими динамическое преобразование односкоростного потока в мультискоростной](media-services-manage-live-encoder-enabled-channels.md).


##Получение URL-адресов приема

После создания канала можно получить URL-адреса приема, которые необходимо передать динамическому кодировщику. Он использует эти адреса для передачи динамического потока на вход.

![readychannel](./media/media-services-managing-channels/media-services-ready-channel.png)


![ingesturls](./media/media-services-managing-channels/media-services-ingest-urls.png)


##Создание программы и управление ею

###Обзор

Канал связан с программами, с помощью которых вы можете управлять публикацией и хранением сегментов динамического потока. Каналы управляют программами. Связь между каналом и программой очень похожа на аналогичную взаимосвязь в традиционной мультимедийной отрасли, где по определенному каналу транслируется постоянный поток информации, а программа связана с определенным временным промежутком — мероприятием на этом канале.

Задать количество часов, в течение которых следует хранить записанное содержимое программы, можно с помощью параметра длины **окна архивирования**. Для него можно задать значение от 5 минут до 25 часов. Длина окна архивирования также определяет максимальный период, в пределах которого клиенты могут перемещаться назад во времени относительно текущей позиции в передаваемом потоке данных. Программы могут длиться в течение определенного времени, однако содержимое, выходящее за пределы окна указанной длины, теряется. Значение этого свойства также определяет максимальный размер манифестов клиентов.

Каждая программа связана с ресурсом. Чтобы опубликовать программу, необходимо создать указатель OnDemand для соответствующего ресурса. С помощью этого указателя можно сформировать URL-адрес потоковой передачи данных, который предоставляется клиентам.

Канал поддерживает одновременную потоковую трансляцию до трех программ, поэтому можно создавать по несколько архивов одного и того же входящего потока. Благодаря этому можно публиковать и архивировать разные части транслируемого мероприятия. Предположим, например, что, согласно существующим нормативам, необходимо архивировать 6 часов программы, а транслировать только последние 10 минут. Для этого необходимо создать две одновременно работающие программы. Для одной из них настроено архивирование 6 часов транслируемого мероприятия, но без публикации. Для второй программы настроено архивирование 10 минут с публикацией.

Не используйте существующие программы повторно для новых мероприятий. Вместо этого создавайте и запускайте новую программу для каждого мероприятия, как описано в разделе "Программирование приложений потоковой передачи данных".

Когда вы будете готовы начать потоковую передачу и архивацию, запустите программу. Чтобы остановить потоковую передачу и архивацию содержимого мероприятия, завершите работу программы.

Чтобы удалить заархивированное содержимое, остановите и удалите программу, а затем удалите связанный с ней ресурс. Ресурс невозможно удалить, пока он используется какой-либо программой: сначала нужно удалить ее.

Даже после остановки и удаления программы пользователи смогут запрашивать потоковую передачу заархивированного видеоконтента, пока не удален соответствующий ресурс.

Если вы хотите сохранить заархивированное содержимое, но при этом заблокировать возможность его потоковой передачи, удалите указатель.

###Создание, запуск и остановка программ

Настроив передачу потока данных в канал, вы можете начать потоковую передачу мероприятия, создав ресурс, программу и указатель потоковой передачи. В результате вы сможете запустить архивирование потока и предложить его зрителям через конечную точку потоковой передачи.

Запустить мероприятие можно двумя способами.

1. На странице **КАНАЛ** нажмите **ДОБАВИТЬ**, чтобы добавить программу.

	Укажите название программы и ресурса, окно архивирования и параметр кодирования.
	
	![createprogram](./media/media-services-managing-channels/media-services-create-program.png)
	
	Если оставить установленным флажок **Опубликовать эту программу**, для нее будут созданы URL-АДРЕСА ПУБЛИКАЦИИ.
	
	Когда вы будете готовы к потоковой передаче программы, нажмите **НАЧАТЬ**.

	После запуска программы нажмите ВОСПРОИЗВЕСТИ, чтобы начать воспроизведение контента.


	![createdprogram](./media/media-services-managing-channels/media-services-created-program.png)

2. Кроме того, можно выполнить сразу все операции, нажав кнопку **НАЧАТЬ ПОТОКОВУЮ ПЕРЕДАЧУ** на странице **КАНАЛ**. В результате будут созданы ресурс, программа и указатель потоковой передачи.

	Программе будет присвоено название DefaultProgram, и для нее будет задано окно архивирования длиной в 1 час.

	Начать воспроизведение опубликованной программы можно на странице КАНАЛ.

	![channelpublish](./media/media-services-managing-channels/media-services-channel-play.png)


При нажатии кнопки **ОСТАНОВИТЬ ПОТОКОВУЮ ПЕРЕДАЧУ** на странице **КАНАЛ** программа по умолчанию останавливается и удаляется. При этом ресурс останется, и вы можете публиковать его и отменять его публикацию на странице **КОНТЕНТ**.

На странице **КОНТЕНТ**можно найти все ресурсы, созданные для ваших программ.

![contentasset](./media/media-services-managing-channels/media-services-content-assets.png)


##Воспроизведение контента

Чтобы предоставить пользователю URL-адрес, по которому будет осуществляться потоковая передача контента, сначала необходимо "опубликовать" ресурс \(эта процедура описана в предыдущем разделе\), создав указатель \(при публикации ресурсов с помощью портала указатели создаются автоматически\). Указатели предоставляют доступ к файлам, содержащимся в активе.

В зависимости от того, какой протокол потоковой передачи используется для воспроизведения контента, вам может потребоваться изменить URL-адрес, доступный по ссылке **URL-АДРЕС ПУБЛИКАЦИИ** для канала или программы.

Технология динамической упаковки обеспечит упаковку динамического потока данных с использованием указанного протокола.

По умолчанию URL-адрес потоковой передачи создается в указанном ниже формате, и его можно использовать для воспроизведения ресурсов Smooth Streaming.

	{streaming endpoint name-media services account name}.streaming.mediaservices.windows.net/{locator ID}/{filename}.ism/Manifest

Чтобы создать URL-адрес для потоковой передачи в формате HLS, добавьте к исходному адресу строку \(format=m3u8-aapl\).

	{streaming endpoint name-media services account name}.streaming.mediaservices.windows.net/{locator ID}/{filename}.ism/Manifest(format=m3u8-aapl)

Чтобы создать URL-адрес для потоковой передачи в формате MPEG DASH, добавьте к исходному адресу строку \(format=mpd-time-csf\).

	{streaming endpoint name-media services account name}.streaming.mediaservices.windows.net/{locator ID}/{filename}.ism/Manifest(format=mpd-time-csf)

Дополнительные сведения о потоковой передаче контента см. в статье [Доставка содержимого](media-services-deliver-content-overview.md).

Для воспроизведения контента в формате Smooth Stream можно использовать проигрыватель [AMS Player](http://amsplayer.azurewebsites.net/azuremediaplayer.html), а для просмотра видео в формате HLS версии 3 вы можете воспользоваться устройствами на платформах iOS и Android.

##Очистка

После завершения потоковой передачи мероприятия вы можете удалить выделенные ранее ресурсы с помощью описанной ниже процедуры.

- Остановите трансляцию потока из кодировщика.
- Остановите работу канала. После остановки канала начисление платы прекращается. Если вам понадобится снова запустить его, вы можете воспользоваться тем же URL-адресом приема \(перенастраивать кодировщик не потребуется\).
- Вы можете остановить конечную точку потоковой передачи, если больше не собираетесь предоставлять доступ к архиву мероприятия в качестве потоковой передачи по требованию. Пока канал остановлен, начисление платы не осуществляется.
  


[standard0]: ./media/media-services-managing-channels/media-services-create-channel-standard0.png
[standard1]: ./media/media-services-managing-channels/media-services-create-channel-standard1.png
[standard2]: ./media/media-services-managing-channels/media-services-create-channel-standard2.png
[standard3]: ./media/media-services-managing-channels/media-services-create-channel-standard3.png
[standard4]: ./media/media-services-managing-channels/media-services-create-channel-standard4.png
[standard5]: ./media/media-services-managing-channels/media-services-create-channel-standard_encode.png
<!--HONumber=52-->
