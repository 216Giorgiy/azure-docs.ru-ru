    <properties 
	pageTitle="Create custom artifacts for your DevTest Lab VM | Microsoft Azure"
	description="Learn how to author your own artifacts for use with DevTest Labs"
	services="devtest-lab,virtual-machines"
	documentationCenter="na"
	authors="tomarcher"
	manager="douge"
	editor=""/>

<tags
	ms.service="devtest-lab"
	ms.workload="na"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="11/01/2015"
	ms.author="tarcher"/>

#Создание пользовательских артефактов для виртуальной машины DevTest Lab

**Артефакты** используются для развертывания и настройки приложения после подготовки виртуальной машины. Артефакт состоит из файла определения артефакта и других файлов скриптов, которые хранятся в папке в репозитории Git. Файлы определения артефактов состоят из JSON и выражений, позволяющих указать, какие компоненты должны быть установлены на виртуальной машине. Например, можно определить имя артефакта, выполняемую команду и параметры, которые станут доступны после запуска команды. В файле определения артефакта можно ссылаться на другие файлы скриптов, используя их имена.

##Формат файла определения артефакта
В следующем примере показаны разделы, составляющие базовую структуру файла определения.

	{
	  "$schema": "https://raw.githubusercontent.com/Azure/azure-devtestlab/master/schemas/2015-01-01/dtlArtifacts.json",
	  "title": "",
	  "description": "",
	  "iconUri": "",
	  "targetOsType": "",
	  "parameters": {
	    "<parameterName>": {
	      "type": "",
	      "displayName": "",
	      "description": ""
	    }
	  },
	  "runCommand": {
	    "commandToExecute": ""
	  }
	}

| Имя элемента | Обязательный? | Описание
| ------------ | --------- | -----------
| $schema | Нет | Расположение файла схемы JSON, позволяющего проверять подлинность файла определения.
| title | Да | Имя артефакта отображается в лаборатории.
| description | Да | Описание артефакта отображается в лаборатории.
| iconUri | Нет | URI значка отображается в лаборатории.
| targetOsType | Да | Операционная система виртуальной машины, на которую будет установлен артефакт. Поддерживаемые параметры: Windows и Linux.
| parameters | Нет | Значения, предоставляемые, когда на компьютере выполняется команда установки артефакта. Помогает при настройке артефакта.
| runCommand | Да | Команда установки артефакта, выполняемая на виртуальной машине.

###Параметры артефакта

В разделе параметров файла определения указываются значения, которые пользователь может вводить при установке артефакта. Это значения можно использовать в команде установки артефакта.

Параметры определяются с помощью следующей структуры:

	"parameters": {
	    "<parameterName>": {
	      "type": "<type-of-parameter-value>",
	      "displayName": "<display-name-of-parameter>",
	      "description": "<description-of-parameter>"
	    }
	  }

| Имя элемента | Обязательный? | Описание
| ------------ | --------- | -----------
| type | Да | Тип значения параметра. Ниже приведен список допустимых типов.
| displayName Yes | Имя параметра, отображаемое для пользователя в лаборатории.
| description | Да | Описание параметра, отображаемого в лаборатории.

Допустимые типы:

- string — любая допустимая строка JSON;
- int — любое допустимое целое число JSON;
- bool — любое допустимое логическое значение JSON;
- array — любой допустимый массив JSON.

##Выражения и функции артефактов

Для ограничения команды установки артефактов можно использовать выражения и функции. Выражения заключаются в квадратные скобки ([ и ]) и вычисляются при установке артефакта. Выражения могут встречаться в любом месте строкового значения JSON и всегда возвращают другое значение JSON. Если нужно использовать строковый литерал, который начинается с квадратной скобки ([), необходимо указать две квадратные скобки ([[). Как правило, для составления значения используются выражения с функциями. Как и в языке JavaScript, вызовы функций форматируются в виде functionName(arg1,arg2,arg3).

Вот список распространенных функции.

- parameters(parameterName) — возвращает значение параметра, предоставляемого при выполнении команды артефакта.
- concat(arg1,arg2,arg3, …..) — объединяет несколько строковых значений. Эта функция может принимать любое количество аргументов.

В следующем примере показано, как составить значение, используя выражение и функции.

	runCommand": {
	     "commandToExecute": "[concat('powershell.exe -File startChocolatey.ps1'
	, ' -RawPackagesList ', parameters('packages')
	, ' -Username ', parameters('installUsername')
	, ' -Password ', parameters('installPassword'))]"
	}

##Создание пользовательского артефакта

Для создания пользовательского артефакта выполните описанные ниже действия.

1. Установите редактор JSON — он потребуется для работы с файлами определения артефакта. Рекомендуем использовать [код Visual Studio](https://code.visualstudio.com/), доступный для Windows, Linux и OS X.

1. Получите пример файла artifactfile.json — изучите артефакты, созданные командой Azure DevTest Labs, в [репозитории GitHub](https://github.com/Azure/azure-devtestlab). Он содержит богатую библиотеку артефактов, которая поможет вам создавать собственные артефакты. Загрузите файл определения артефакта и внесите в него изменения, чтобы создать свои собственные артефакты.

1. Используйте IntelliSense — он позволяет просматривать элементы, которые можно использовать для создания файла определения артефакта. Здесь же можно увидеть различные варианты значений каждого элемента. Например, при редактировании элемента **targetOsType** IntelliSense предлагает два варианта — Windows и Linux.

1. Сохраните артефакт в репозитории Git:
	1. Создайте для каждого артефакта отдельный каталог, имя которого совпадает с именем артефакта.
	1. Сохраните файл определения артефакта (artifactfile.json) в созданный каталог.
	1. Сохранить скрипты, на которые ссылается команда установки артефакта.

	Вот как может выглядеть папка артефакта:

	![Пример репозитория артефактов Git](./media/devtest-lab-artifact-author/git-repo.png)

1. Добавьте хранилище артефактов в лабораторию: см. статью [Добавление репозитория артефактов Git в DevTest Lab](devtest-lab-add-artifact-repo.md).

## Дальнейшие действия

Узнайте, как [добавить репозиторий артефактов Git в DevTest Lab](devtest-lab-add-artifact-repo.md).

<!---HONumber=Nov15_HO4-->