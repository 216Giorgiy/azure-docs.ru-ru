<properties linkid="develop-python-tutorials-web-sites-configuration" urlDisplayName="Configuring Python with Azure Websites" pageTitle="Configuring Python with Azure Websites" metaKeywords="" description="This tutorial describes options for authoring and configuring a basic Web server Gateway Interface (WSGI) compliant Python application on Azure Websites." metaCanonical="" services="web-sites" documentationCenter="Python" title="Configuring Python with Azure Websites" authors="huvalo" solutions="" manager="" editor="" />

<tags ms.service="web-sites" ms.workload="web" ms.tgt_pltfrm="na" ms.devlang="python" ms.topic="article" ms.date="01/01/1900" ms.author="huvalo"></tags>

# Настройка Python для веб-сайтов Azure

В этом учебнике описываются возможности создания и настройки на веб-сайтах Azure базового приложения Python, совместимого с интерфейсом шлюза веб-сервера WSGI. Начать работу с веб-сайтами Azure легко, и у приложения Python будет достаточно возможностей для масштабирования и расширения на другие службы Azure. Платформа веб-сайтов Azure содержит Python (2.7.3 или 3.4.0 по вашему выбору) и универсальный обработчик FastCGI wfastcgi.py для Python. Нужно только настроить веб-сайт для использования обработчика Python.

> [WACOM.ПРИМЕЧАНИЕ] Чтобы выбрать версию Python для использования на портале веб-сайтов Azure, перейдите на вкладку "Настройка" веб-сайта и измените параметр **Версия Python**.

Более сложный пример настройки платформы Django для веб-сайтов Azure можно найти в следующем руководстве:
[][]<http://www.windowsazure.com/ru-ru/develop/python/tutorials/web-sites-with-django></a>.

## Поддержка WSGI

WSGI — это стандарт Python, описываемый в [PEP 3333][PEP 3333] и определяющий интерфейс между веб-сервером и Python. Он предоставляет стандартный интерфейс для написания различных веб-приложений и платформ с использованием Python. Сегодня популярные веб-платформы Python используют WSGI. Веб-сайты Azure предоставляют поддержку таких платформ. Кроме того, опытные пользователи даже могут создавать собственные платформы, если пользовательский обработчик следует правилам спецификации WSGI.

## Создание веб-сайта

В этом учебнике предполагается наличие существующей подписки Azure и доступа к порталу управления Azure. Подробное руководство по созданию веб-сайта находится по адресу [][1]<http://www.windowsazure.com/ru-ru/manage/services/web-sites/how-to-create-websites></a>.

Короче говоря, если нет существующего веб-сайта, можно создать его на портале управления Azure. Выберите компонент "ВЕБ-САЙТЫ" и используйте варианты "БЫСТРОЕ СОЗДАНИЕ", указав URL-адрес своего веб-сайта.

![][]

## Публикация с использованием Git

Используйте вкладки "БЫСТРЫЙ ЗАПУСК" или "ПАНЕЛЬ МОНИТОРИНГА" для вновь созданного веб-сайта, чтобы настроить публикацию с помощью Git. В этом учебнике Git используется для создания, публикации веб-сайта Python и управления им на веб-сайтах Azure.

![][2]

После настройки публикации с помощью Git будет создан репозиторий Git и связан с вашим веб-сайтом. Появится URL-адрес репозитория, который с этого момента может использоваться для передачи данных в облако из локальной среды разработки. Для публикации приложений с помощью Git убедитесь, что клиент Git также установлен, и следуйте предоставленным инструкциям для передачи контента веб-сайта содержимого на веб-сайты Azure.

## Содержимое веб-сайта

В качестве примера используется простое приложение Python с базовым обработчиком WSGI, показывающее минимальный объем работы, необходимый для использования преимуществ поддержки Python в веб-сайтах Azure. Этот скелет приложения Python можно использовать, чтобы начать разработку различных решений разной сложности, начиная от приведенного ниже примера и до полнофункциональных веб-платформ.

Ниже приведен код для базового обработчика WSGI. Он аналогичен обработчику, предлагаемому спецификацией [PEP 3333][PEP 3333] в качестве отправной точки для приложения, совместимого с WSGI. Этот контент сохранен в файле с именем ConfigurePython.py в папке ConfigurePython в корневом каталоге веб-сайта.

    def application(environ, start_response):
        status = '200 OK'
        response_headers = [('Content-type', 'text/plain')]
        start_response(status, response_headers)
        yield 'Hello from Azure Websites\n'

Объект *application* является вызываемым объектом-приложением Python, который будет использоваться в качестве точки входа, вызываемой WSGI-совместимым сервером. Этот вызываемый объект принимает 2 позиционных аргумента.

-   *environ*: словарь с различными переменными среды.
-   *start\_response*: вызываемый объект, предоставляемый веб-сервером для передачи состояния HTTP и заголовка ответа.

Этот обработчик возвращает обычный текст "Hello from Azure Websites" для каждого запроса к нему.

## Варианты настройки

Существует 2 различных варианта настройки приложения Python для работы с веб-сайтами Azure.

### Вариант 1. Портал

1.1. Зарегистрируйте обработчик FastCGI на вкладке "НАСТРОЙКА" на портале.
В данном примере мы используем обработчик FastCGI для Python, входящий в пакет веб-сайтов Azure. Для выполнения этих же действий используйте следующие пути для обработчика скриптов и аргумента обработчика FastCGI:

-   Путь к обработчику скриптов Python: D:\\python27\\python.exe
-   Путь к обработчику Python FastCGI: D:\\python27\\scripts\\wfastcgi.py

![][3]

1.2. Настройте параметры приложения в той же вкладке "НАСТРОЙКА" портала.
 Параметры приложения преобразуются в переменные среды. Это механизм, который можно использовать для значений конфигурации, необходимых приложению Python. Для этого простого примера приложения настроено следующее:

-   PYTHONPATH сообщает Python о каталоге для поиска модулей. В веб-сайтах Azure D:\\home\\site\\wwwroot является синтаксическим обозначением, указывающим на корневой каталог веб-сайта.
-   WSGI\_HANDLER записывает имя модуля или пакета, а также используемый атрибут.

![][4]

### Вариант 2. web.config

Другим вариантом конфигурации является использование файла web.config в корневом каталоге веб-сайта для действий, описанных ниже. Вариант использования web.config потенциально обеспечивает лучшую переносимость веб-приложения. Существует 2 подхода для маршрутизации запросов к веб-приложению: либо определить обработчик, обрабатывающий путь \*, что указывает IIS маршрутизировать все входящие запросы через Python, либо определить конкретный путь, который Python будет обрабатывать, а затем использовать перезапись URL-адресов для перенаправления различных URL-адресов в выбранный путь. Фактически рекомендуется применять последний подход — использовать пустой файл обработчика в корневом каталоге веб-сайта, который будет служить целью запроса (в нашем примере handler.fcgi), — для повышения производительности. В предыдущем сценарии все запросы, включая запросы статического контента (например, файлы изображений и таблицы стилей) должны были проходить через Python, не позволяя применять оптимизацию, обеспечиваемую веб-сервером для доступа к статическим файлам. Использование последнего подхода позволяет эффективно обслуживать статический контент, вызывая Python только при необходимости.

2.1. Задайте переменную PYTHONPATH.

> Это укажет Python, где искать код приложения. D:\\home\\site\\wwwroot также используется как абсолютный путь к веб-сайту.

2.2. Задайте переменную WSGI\_HANDLER.

> В веб-сайтах Azure это значение используется, чтобы указать, что Python должен вызывать наш обработчик WSGI. Значение этой переменной является выражением Python, которое при его выполнении должно возвращать вызываемый объект, представляющий обработчик WSGI.

2.3. Добавьте обработчик для Python.

> Это укажет веб-сайтам Azure, что Python должен обрабатывать запросы к пути handler.fcgi. Важно, чтобы синтаксис обработчика выглядел точно так же, как внутри тега \<handlers\> в приведенном ниже примере, если разработчик не использует собственный обработчик FastCGI или стек разработки Python.

2.4. Перепишите URL-адреса к handler.fcgi.

> Постоянные запросы handler.fcgi могут оказаться не лучшим вариантом. Для выбора пути к файлам, обрабатываемым обработчиком Python, использована перезапись URL-адресов, чтобы все URL-адреса обрабатывались нашим обработчиком Python.

    <configuration>
        <appSettings>
            <add key="pythonpath" value="D:\home\site\wwwroot\ConfigurePython" />
            <add key="WSGI_HANDLER" value="ConfigurePython.application" />
        </appSettings>
        <system.webServer>
            <handlers>
                <add name="PythonHandler" 
                verb="*" path="handler.fcgi" 
                modules="FastCgiModule" 
                scriptProcessor="D:\Python27\Python.exe|D:\Python27\Scripts\wfastcgi.py" 
                resourceType="Either" />
            </handlers>
            <rewrite>
                <rules>
                    <rule name="Configure Python" stopProcessing="true">
                        <match url="(.*)" ignoreCase="false" />
                        <conditions>
                            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                        </conditions>
                        <action type="Rewrite" url="handler.fcgi/{R:1}" appendQueryString="true" />
                    </rule>
                </rules>
            </rewrite>
        </system.webServer>
    </configuration> 

Структура папок в корневом каталоге веб-сайта для этого примера выглядит следующим образом (регистр имен папок и файлов Python является существенным и отражается в файле web.config):

-   ConfigurePython\\ConfigurePython.py
-   web.config
-   handler.fcgi

Так как все URL-адреса перезаписываются, указывая на handler.fcgi, и этот путь передается Python с помощью FastCGI, необходимо создать файл-заполнитель с тем же именем, чтобы IIS не возвращал ошибку HTTP 404. Это обусловлено внутренним поведением модуля FastCGI IIS, который требует, чтобы запрашиваемый файл уже существовал перед его передачей указанному приложению обработчика скриптов.

Перейдите на веб-сайт, чтобы проверить правильность конфигурации. В данном примере при доступе должно появляться сообщение "Hello from Azure Websites".

![][5]

  []: http://www.windowsazure.com/ru-ru/develop/python/tutorials/web-sites-with-django
  [PEP 3333]: http://www.python.org/dev/peps/pep-3333/
  [1]: http://www.windowsazure.com/ru-ru/manage/services/web-sites/how-to-create-websites
  []: ./media/web-sites-python-configure/configure-python-create-website.png
  [2]: ./media/web-sites-python-configure/configure-python-git.png
  [3]: ./media/web-sites-python-configure/configure-python-handler-mapping.png
  [4]: ./media/web-sites-python-configure/configure-python-app-settings.png
  [5]: ./media/web-sites-python-configure/configure-python-result.png
