---
title: Оптимизация времени выполнения запросов на сервере Базы данных Azure для PostgreSQL с помощью стратегии хранения таблицы TOAST
description: В этой статье описывается, как оптимизировать время выполнения запроса на сервере Базы данных Azure для PostgreSQL с помощью стратегии хранения таблицы TOAST.
author: dianaputnam
ms.author: dianas
ms.service: postgresql
ms.topic: conceptual
ms.date: 10/22/2018
ms.openlocfilehash: 96793cb1785a7ffa86331285f401453641b50dac
ms.sourcegitcommit: 359b0b75470ca110d27d641433c197398ec1db38
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/07/2019
ms.locfileid: "55820884"
---
# <a name="optimize-query-time-with-the-toast-table-storage-strategy"></a>Оптимизация времени выполнения запросов с помощью стратегии хранения таблицы TOAST 
В этой статье описывается, как оптимизировать время выполнения запросов, применяя стратегию хранения таблицы TOAST.

## <a name="toast-table-storage-strategies"></a>Стратегии хранения таблицы TOAST
Для хранения столбцов на диске применяются четыре различные стратегии, которые могут использовать методику TOAST. Они представляют различные сочетания сжатия и внешнего хранения. Стратегию можно задать на уровне типа данных и на уровне столбцов.
- **Обычная** стратегия предотвращает сжатие или внешнее хранение. Она отключает использование однобайтовых заголовков для типов varlena. Обычная стратегия возможна только для столбцов с типами данных, которые не поддерживают TOAST.
- **Расширенная** стратегия допускает как сжатие, так и внешнее хранение. Она используется по умолчанию для большинства типов данных, которые поддерживают TOAST. Сначала выполняется попытка сжатия. Если строка является по-прежнему слишком большой, предпринимается попытка использовать внешнее хранение.
- **Внешняя** стратегия допускает внешнее хранение, но не сжатие. При применении внешней стратегии подстрочные операции в больших текстовых и байтовых столбцах выполняются быстрее. Но дисковое пространство будет увеличено, так как эти операции оптимизированы для получения только необходимых частей внешнего значения, когда оно не сжимается.
- **Главная** стратегия допускает сжатие, но не внешнее хранение. Внешнее хранение по-прежнему выполняется для таких столбцов, но только в качестве последнего средства. Это происходит, когда нет другого способа сделать строку достаточно маленькой, чтобы поместить ее на странице.

## <a name="use-toast-table-storage-strategies"></a>Использование стратегий хранения таблицы TOAST
Если ваши запросы получают доступ к типам данных, которые поддерживают TOAST, рассмотрите возможность использования основной стратегии вместо расширенной (по умолчанию), чтобы уменьшить время выполнения запросов. Основная стратегия не исключает внешнее хранение. Если ваши запросы не получают доступ к типам данных, которые поддерживают TOAST, может быть полезно оставить расширенную стратегию. Большая часть строк главной таблицы поместится в общий буферный кэш, что способствует повышению производительности.

При наличии рабочей нагрузки, использующей схему с широкими таблицами и большим количеством символов, рассмотрите возможность применения таблиц TOAST PostgreSQL. Например, таблица клиентов содержит больше чем 350 столбцов с несколькими столбцами, в которых есть 255 знаков. После перехода на основную стратегию таблицы TOAST время выполнения запроса сократилось с 4203 до 467 секунд, что на 89 процентов больше.

## <a name="next-steps"></a>Дополнительная информация
Проверьте рабочую нагрузку с учетом представленных ранее характеристик. 

Ознакомьтесь со следующей документацией PostgreSQL: 
- [раздел 68, "Физическое хранилище базы данных"](https://www.postgresql.org/docs/current/storage-toast.html). 