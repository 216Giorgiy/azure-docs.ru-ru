---
title: Оптимизация времени выполнения запросов на сервере Базы данных Azure для PostgreSQL с помощью стратегии хранения таблицы TOAST
description: В этой статье описывается, как оптимизировать время выполнения запроса на сервере Базы данных Azure для PostgreSQL с помощью стратегии хранения таблицы TOAST.
author: dianaputnam
ms.author: dianas
editor: jasonwhowell
ms.service: postgresql
ms.topic: conceptual
ms.date: 10/22/2018
ms.openlocfilehash: dee8aaaef4b1998a7234a88d07ad5efbc79d050b
ms.sourcegitcommit: 1f9e1c563245f2a6dcc40ff398d20510dd88fd92
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2018
ms.locfileid: "51628840"
---
# <a name="optimizing-query-time-with-toast-table-storage-strategy"></a>Оптимизация времени выполнения запросов с помощью стратегии хранения таблицы TOAST 
В этой статье описывается, как оптимизировать время выполнения запросов, применяя стратегию хранения таблицы TOAST.

## <a name="toast-table-storage-strategies"></a>Стратегии хранения таблицы TOAST
Существует четыре различные стратегии для хранения столбцов таблицы TOAST на диске, представляющие различные комбинации сжатия и внешнего хранения. Стратегию можно задать на уровне типа данных и на уровне столбцов.
- **Обычная** стратегия исключает сжатие и внешнее хранение. Кроме того, она отключает использование однобайтовых заголовков для типов varlena. **Обычная** стратегия возможна только для столбцов с типами данных non-toast-able (не поддерживающие TOAST).
- **Расширенная** стратегия допускает как сжатие, так и внешнее хранение. **Она** используется по умолчанию для большинства типов данных toast-able (с поддержкой TOAST). Сначала будет применено сжатие, а затем, если строка еще слишком большая, внешнее хранение.
- **Внешняя** стратегия допускает внешнее хранение, но не сжатие. При применении **внешней** стратегии подстрочные операции в больших текстовых и байтовых столбцах будут выполняться быстрее, но дисковое пространство будет увеличено, так как эти операции оптимизированы для получения только необходимых частей внешнего значения, когда оно не сжимается.
- **Главная** стратегия допускает сжатие, но не внешнее хранение. Внешнее хранение будет по-прежнему выполняться для таких столбцов, но только в качестве последнего варианта, если отсутствуют другие способы, чтобы строки помещались на странице.

## <a name="using-toast-table-storage-strategies"></a>Использование стратегий хранения таблицы TOAST
Если ваши запросы получают доступ к типам данных с поддержкой TOAST, рассмотрите возможность использования **главной** стратегии вместо **расширенной** (по умолчанию), чтобы уменьшить время выполнения запросов. **Главная** стратегия допускает внешнее хранение. С другой стороны, если запросы не получают доступ к типам данных с поддержкой TOAST, может быть полезно оставить **расширенную** стратегию. Поэтому большая часть строк главной таблицы заполнит общий буферный кэш, что способствует повышению производительности.

При наличии рабочей нагрузки, использующей схему с широкими таблицами и большим количеством символов, рассмотрите возможность использования таблиц TOAST PostgreSQL. Например, таблица клиентов содержит больше чем 350 столбцов с несколькими столбцами, в которых есть 255 символов. После перехода на **главную** стратегию TOAST время выполнения запроса сократилось с 4203 до 467 секунд, что на 89 процентов больше.

## <a name="next-steps"></a>Дополнительная информация
Проверьте рабочую нагрузку с учетом представленных выше характеристик. 

Ознакомьтесь с главой 68 документации PostgreSQL о [физическом хранилище базы данных](https://www.postgresql.org/docs/current/storage-toast.html). 