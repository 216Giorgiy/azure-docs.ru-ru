---
title: Управление репликами чтения в базе данных Azure для PostgreSQL с помощью портала Azure
description: В этой статье описывается управление репликами чтения в базе данных Azure для PostgreSQL с помощью портала Azure.
author: rachel-msft
ms.author: raagyema
ms.service: postgresql
ms.topic: conceptual
ms.date: 01/17/2019
ms.openlocfilehash: 6c1a0a4a13a70daec157ede98f850f87150f8d93
ms.sourcegitcommit: ba9f95cf821c5af8e24425fd8ce6985b998c2982
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/17/2019
ms.locfileid: "54383867"
---
# <a name="how-to-create-and-manage-read-replicas-in-the-azure-portal"></a>Создание реплик чтения и управление ими с помощью портала Azure
В этой статье описано, как создавать реплики чтения и управлять ими в службе "База данных Azure для PostgreSQL" с помощью портала Azure. Дополнительные сведения о репликах чтения см. в [документации с описанием концепций](concepts-read-replicas.md).

## <a name="prerequisites"></a>Предварительные требования
- [Сервер Базы данных Azure для PostgreSQL](quickstart-create-server-database-portal.md) в качестве главного сервера.

## <a name="prepare-the-master-server"></a>Подготовка главного сервера
Эти действия по подготовке главного сервера применяются только к серверам общего назначения и серверам, оптимизированным для операций в памяти.

На главном сервере задайте для параметра **azure.replication_support** значение REPLICA. Чтобы изменение этого параметра вступило в силу, перезапустите сервер.

1. На портале Azure выберите существующий сервер Базы данных Azure для PostgreSQL, который будет главным.

2. В меню слева выберите **Параметры сервера**.

3. Найдите параметр **azure.replication_support**.

   ![База данных Azure для PostgreSQL: azure.replication_support](./media/howto-read-replicas-portal/azure-replication-parameter.png)

4. Задайте для параметра **azure.replication_support** значение REPLICA. **Сохраните** изменения.

   ![База данных Azure для PostgreSQL: выберите REPLICA и сохраните изменения](./media/howto-read-replicas-portal/save-parameter-replica.png)

5. После сохранения вы получите уведомление.

   ![База данных Azure для PostgreSQL: уведомление после сохранения](./media/howto-read-replicas-portal/parameter-save-notification.png)

6. После сохранения перезапустите сервер, чтобы применить изменения. Дополнительные сведения о перезапуске сервера см. в [этой документации](howto-restart-server-portal.md).

## <a name="create-a-read-replica"></a>Создание реплики чтения
Для создания реплик чтения выполните следующие действия:
1.  Выберите существующий сервер Базы данных Azure для PostgreSQL, который будет использоваться в качестве главного сервера. 

2.  В разделе "Параметры" выберите пункт "Репликация".

   Если вы не задали для параметра **azure.replication_support** значение REPLICA на главном сервере общего назначения или с оптимизацией для операций в памяти и не перезапустили сервер, появится соответствующее сообщение. Это нужно сделать, прежде чем перейти к созданию реплики.

3.  Выберите "Добавить реплику".

   ![База данных Azure для PostgreSQL: добавление реплики](./media/howto-read-replicas-portal/add-replica.png)

4.  Введите имя сервера-реплики и нажмите кнопку ОК, чтобы подтвердить создание реплики.

   ![База данных Azure для PostgreSQL: ввод имени реплики](./media/howto-read-replicas-portal/name-replica.png) 

> [!IMPORTANT]
> Реплики чтения создаются с той же конфигурацией сервера, что и у главного сервера. После создания реплики вы можете независимо от главного сервера изменять для нее ценовую категорию (за исключением категории "Базовый"), поколение вычислительных ресурсов, число виртуальных ядер, объем хранилища и период хранения резервных копий.

> [!IMPORTANT]
> Прежде чем изменить параметры конфигурации на главном сервере, установите на каждой реплике такие же или более высокие значения. В противном случае попытка выполнить эту операцию приведет к ошибке. Это нужно для того, чтобы реплики справлялись с нагрузкой, соответствующей новым параметрам главного сервера. 


Созданный сервер-реплику можно просмотреть в окне "Репликация".

![База данных Azure для PostgreSQL: новая реплика](./media/howto-read-replicas-portal/list-replica.png)
 

## <a name="stop-replication"></a>Остановка репликации

> [!IMPORTANT]
> Остановка репликации на сервер является необратимой операцией. Репликацию, остановленную между главным сервером и сервером-репликой, отменить невозможно. Сервер-реплика становится автономным и начинает поддерживает операции чтения и записи. Это сервер нельзя снова преобразовать в реплику.

Чтобы остановить репликацию между главным сервером и репликой на портале Azure, следуйте инструкциям ниже.
1.  На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2.  В разделе "Параметры" выберите пункт "Репликация".

3.  Выберите сервер-реплику, для которого нужно остановить репликацию.

   ![База данных Azure для PostgreSQL: выбор реплики](./media/howto-read-replicas-portal/select-replica.png)
 
4.  Щелкните "Остановить репликацию".

   ![База данных Azure для PostgreSQL: остановка репликации](./media/howto-read-replicas-portal/select-stop-replication.png)
 
5.  Подтвердите остановку репликации, нажав кнопку ОК.

   ![База данных Azure для PostgreSQL: подтверждение остановки репликации](./media/howto-read-replicas-portal/confirm-stop-replication.png)
 

## <a name="delete-a-master"></a>Удаление главного сервера

> [!IMPORTANT]
> Удаление главного сервера приводит к остановке репликации на все серверы-реплики. Серверы-реплики становятся автономными серверами, которые начинают поддерживать операции чтения и записи.
Чтобы удалить главный сервер, выполните те же действия, что и для автономного сервера Базы данных Azure для PostgreSQL. Чтобы удалить сервер с портала Azure, сделайте следующее.

1.  На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2.  На странице "Обзор" выберите "Удалить".

   ![База данных Azure для PostgreSQL: удаление сервера](./media/howto-read-replicas-portal/delete-server.png)
 
3.  Введите имя главного сервера и нажмите кнопку "Удалить", чтобы подтвердить его удаление.

   ![База данных Azure для PostgreSQL: подтверждение удаления](./media/howto-read-replicas-portal/confirm-delete.png)
 

## <a name="delete-a-replica"></a>Удаление реплики
Чтобы удалить реплику чтения, выполните те же действия, что и для удаления главного сервера (см. выше). Сначала откройте страницу обзора реплики, а затем нажмите кнопку "Удалить".

   ![База данных Azure для PostgreSQL: удаление реплики](./media/howto-read-replicas-portal/delete-replica.png)
 
Кроме того, реплику можно удалить из окна репликации.
1.  На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2.  В разделе "Параметры" выберите пункт "Репликация".

3.  Выберите сервер-реплику, который нужно удалить. 

   ![База данных Azure для PostgreSQL: выбор реплики](./media/howto-read-replicas-portal/select-replica.png)
 
4.  Щелкните "Удалить реплику".

   ![База данных Azure для PostgreSQL: удаление реплики](./media/howto-read-replicas-portal/select-delete-replica.png)
 
5.  Введите имя реплики и нажмите кнопку "Удалить", чтобы подтвердить удаление реплики.

   ![База данных Azure для PostgreSQL: подтверждение удаления реплики](./media/howto-read-replicas-portal/confirm-delete-replica.png)
 

## <a name="monitor-a-replica"></a>Мониторинг реплики
### <a name="max-lag-across-replicas"></a>Максимальная задержка между репликами
Метрика **Max lag across replicas** (Максимальная задержка между репликами) показывает время задержки между главным сервером и репликой, которая последней обновила данные. 

1.  На портале Azure выберите **главный сервер** Базы данных Azure для PostgreSQL.

2.  Выберите "Метрики". В окне метрик выберите **Max Lag Across Replicas** (Максимальная задержка между репликами).

    ![База данных Azure для PostgreSQL: мониторинг максимальной задержки между репликами](./media/howto-read-replicas-portal/select-max-lag.png)
 
3.  Выберите **Макс.** для параметра агрегирования. 

### <a name="replica-lag"></a>Задержка реплики
Метрика **Replica Lag** (Задержка реплики) показывает время с момента последнего воспроизведения транзакций по этой реплике. Если на главном сервере не выполняются транзакции, метрика будет отображать соответствующее время задержки.

1.  На портале Azure выберите сервер-**реплику** Базы данных Azure для PostgreSQL.

2.  Выберите "Метрики". В окне метрик выберите **Replica Lag** (Задержка реплики).

   ![База данных Azure для PostgreSQL: мониторинг задержки реплики](./media/howto-read-replicas-portal/select-replica-lag.png)
 
3.  Выберите **Макс.** для параметра агрегирования. 
 
## <a name="next-steps"></a>Дополнительная информация
- См. дополнительные сведения о [репликах чтения в Базе данных Azure для PostgreSQL](concepts-read-replicas.md).