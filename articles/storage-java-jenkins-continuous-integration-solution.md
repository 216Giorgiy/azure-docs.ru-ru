<properties linkid="develop-java-tutorials-jenkins-continuous-integration" urlDisplayName="Непрерывная интеграция Jenkins" pageTitle="Использование хранилища Azure вместе с решением непрерывной интеграции Jenkins | Microsoft Azure" metaKeywords="" description="В этом учебнике показано, как использовать службу BLOB-объектов Azure в качестве репозитория для артефактов построения, созданных решением непрерывной интеграции Jenkins." metaCanonical="" services="storage" documentationCenter="Java" title="Использование хранилища Azure с решением непрерывной интеграции Jenkins" authors="waltpo" solutions="" manager="bjsmith" editor="mollybos" />

#Использование хранилища Azure с решением непрерывной интеграции Jenkins

*[Microsoft Open Technologies Inc.][ms-open-tech]*

Приведенные ниже сведения демонстрируют использование службы BLOB-объектов Azure в качестве репозитория для артефактов построения, созданных решением непрерывной интеграцию Jenkins. Одним из сценариев, где это может оказаться полезным, является программирование в гибкой среде разработки (с помощью Java или других языков), построения выполняются на основе непрерывной интеграции, и вам требуется репозиторий для артефактов построения, чтобы можно было, например, использовать их совместно с другими членами организации, вашими клиентами или вести архив. 

В этом учебнике будет использоваться подключаемый модуль хранилища Azure для решения непрерывной интеграции Jenkins, предоставляемый Microsoft Open Technologies, Inc.

## Оглавление

-   [Общие сведения о Jenkins][]
-   [Преимущества использования службы BLOB-объектов][]
-   [Предварительные требования][]
-   [Использование службы BLOB-объектов с решением непрерывной интеграции Jenkins][]
-   [Установка подключаемого модуля хранилища Azure][]
-   [Настройка подключаемого модуля хранилища Azure для использования вашей учетной записи хранения][]
-   [Создание действия, выполняемого после построения и отправляющего артефакты построения в вашу учетную запись хранения][]
-   [Компоненты, используемые службой BLOB-объектов][]

<h2><a name="overview"></a><span class="short header">Обзор</span>Общие сведения о Jenkins</h2>
Jenkins обеспечивает непрерывную интеграцию программного проекта, позволяя разработчикам легко интегрировать свои изменения кода и автоматизировать процесс построения сборок, что повышает производительность их труда. Для построений осуществляется контроль версий, а артефакты построения можно загрузить в разные репозитории. В этом разделе демонстрируется использование хранилища BLOB-объектов Azure в качестве репозитория артефактов построения.

Дополнительные сведения о Jenkins см. в разделе [Знакомство с Jenkins][].

<h2><a name="benefits"></a><span class="short header">Преимущества</span>Преимущества использования службы BLOB-объектов</h2>

Преимущества использования службы BLOB-объектов для размещения артефактов построения при гибкой разработке включают в себя следующее:

- Высокая доступность артефактов построения.
- Производительность при отправке артефактов построения решением Jenkins.
- Производительность при загрузке артефактов построения клиентами и партнерами.
- Контроль политики доступа пользователей с возможностью выбора между анонимным доступом, общим доступом на основе срока действия, доступом по подписи, закрытым доступом и т. п.

<h2><a name="prerequisites"></a><span class="short header">Предварительные требования</span>Предварительные требования</h2>

Чтобы использовать службу BLOB-объектов с решением Jenkins, необходимо следующее:

- Решение непрерывной интеграции Jenkins.

    Если у вас нет решения Jenkins, его можно запустить следующим образом:

    1. На компьютере с поддержкой Java загрузите файл jenkins.war из <http://jenkins-ci.org>.
    2. В командной строке, открытой на папке с файлом jenkins.war, выполните следующую команду:

        `java -jar jenkins.war`

    3. Откройте в браузере адрес `http://localhost:8080/`. Открывается панель мониторинга Jenkins, которую вы будете использовать для установки и настройки подключаемого модуля хранилища Azure.

        Хотя обычно решение Jenkins настраивается на запуск в качестве службы, в рамках данного учебника будет достаточно запуска WAR-файла Jenkins в командной строке.

- Учетная запись Azure. Зарегистрироваться для получения учетной записи Azure можно по адресу <http://www.windowsazure.com>.

- Учетная запись хранения Azure. Если у вас еще нет учетной записи хранения, ее можно создать с помощью процедуры [Создание учетной записи хранения][].

- Знакомство с решением Jenkins рекомендуется, но не является обязательным, поскольку ниже будет приведен простой пример, показывающий этапы использования службы BLOB-объектов в качестве репозитория для артефактов построения решения Jenkins.

<h2><a name="howtouse"></a><span class="short header">Использование службы BLOB-объектов</span>Использование службы BLOB-объектов с решением непрерывной интеграции Jenkins</h2>

Чтобы использовать службу BLOB-объектов с решением Jenkins, необходимо установить подключаемый модуль хранилища Azure, настроить этот модуль на использование учетной записи хранения, а затем создать действие, выполняемое после построения и отправляющее артефакты построения в вашу учетную запись хранения. Эти действия описаны в следующих разделах.

<h2><a name="howtoinstall"></a><span class="short header">Установка</span>Установка подключаемого модуля хранилища Azure</h2>

1. На панели мониторинга Jenkins щелкните элемент **Manage Jenkins** (Управление Jenkins).
2. На странице **Manage Jenkins** (Управление Jenkins) щелкните **Manage Plugins** (Управление подключаемыми модулями).
3. Откройте вкладку **Available** (Доступно).
4. В разделе **Artifact Uploaders** (Средство отправки артефактов) установите флажок **Azure Storage plugin** (Подключаемый модуль хранилища Azure).
5. Щелкните **Install without restart** (Установить без перезагрузки) или **Download now and install after restart** (Загрузить сейчас и установить позднее).
6. Перезапустите Jenkins.

<h2><a name="howtoconfigure"></a><span class="short header">Настройка</span>Настройка подключаемого модуля хранилища Azure для использования вашей учетной записи хранения</h2>

1. На панели мониторинга Jenkins щелкните элемент **Manage Jenkins** (Управление Jenkins).
2. На странице **Manage Jenkins** (Управление Jenkins) щелкните **Configure System** (Настройка системы).
3. В разделе **Azure Storage Account Configuration** (Конфигурация учетной записи хранения Azure) выполните следующее:
    1. Введите имя своей учетной записи хранения, которое можно получить через портал Azure — <https://manage.windowsazure.com>.
    2. Введите ключ учетной записи хранения, который также можно получить через портал Azure.
    3. Используйте значение по умолчанию для параметра **Blob Service Endpoint URL** (URL-адрес конечной точки службы BLOB-объектов) при использовании общедоступного облака Azure. При использовании другого облака Azure используйте конечную точку, указанную для вашей учетной записи хранения на портале управления Azure. 
    4. Щелкните **Validate Storage Credentials** (Проверить учетные данные хранилища) для проверки вашей учетной записи хранения. 
    5. [Необязательно] Если у вас есть дополнительные учетные записи хранения, которые требуется сделать доступными для решения Jenkins, щелкните **Add more Storage Accounts** (Добавить дополнительные учетные записи хранения).
    6. Нажмите кнопку **Save** (Сохранить), чтобы сохранить изменения.

<h2><a name="howtocreatepostbuild"></a><span class="short header">Создание действия, выполняемого после построения</span>Создание действия, выполняемого после построения и отправляющего артефакты построения в вашу учетную запись хранения</h2>

В учебных целях сначала необходимо создать задание, которое создаст несколько файлов, а затем добавить выполняемое после построения действие для отправки этих файлов в вашу учетную запись хранения.

1. На панели мониторинга Jenkins щелкните элемент **New Job** (Создать задание).
2. Назовите задание **MyJob**, щелкните **Build a free-style software project** (Построение программного проекта в свободном стиле) и нажмите кнопку **ОК**.
3. В разделе **Build** (Построение) конфигурации задания щелкните **Add build step** (Добавить шаг построения) и выберите **Execute Windows batch command** (Выполнить пакетную команду Windows).
4. В поле **Command** (Команда) используйте следующие команды:

        md text
        cd text
        echo Hello Azure Storage from Jenkins > hello.txt
        date /t > date.txt
        time /t >> date.txt
 
5. В разделе конфигурации задания **Post-build Actions** (Действия после построения) щелкните **Add post-build action** (Добавить действие после построения) и выберите **Upload artifacts to Azure Blob storage** (Передать артефакты в хранилище BLOB-объектов Azure).
6. В поле **Storage Account Name** (Имя учетной записи хранения) выберите используемую учетную запись хранения.
7. В поле **Container Name** (Имя контейнера) укажите имя контейнера. (Если этот контейнер не существует, он будет создан при передаче артефактов построения.) Вы можете использовать переменные среды, поэтому для данного примера введите имя контейнера **${JOB_NAME}**.

    **Совет**
    
    Под разделом **Command** (Команда), где вы указали скрипт в поле **Execute Windows batch command** (Выполнить пакетную команду Windows), находится ссылка на переменные среды, которые распознаются в решении Jenkins. Выберите эту ссылку, чтобы узнать имена и описания переменных среды. Обратите внимание, что переменные среды, которые содержат специальные символы, такие как переменная среды **BUILD_URL**, нельзя использовать в качестве имени контейнера или общего виртуального пути.

8. Для данного примера щелкните **Make container public** (Сделать контейнер открытым). (Если вы хотите использовать закрытый контейнер, необходимо создать подпись общего доступа. Это выходит за рамки данного раздела. Дополнительные сведения о подписях общего доступа см. в разделе [Создание подписи общего доступа](http://go.microsoft.com/fwlink/?LinkId=279889)).
9. В поле **List of Artifacts to upload** (Список отправляемых артефактов) введите значение **text/*.txt** (Текст/*.txt).
10. Для параметра **Common virtual path for uploaded artifacts** (Общий виртуальный путь для отправленных артефактов) введите значение **${BUILD\_ID}/${BUILD\_NUMBER}**.
11. Нажмите кнопку **Save** (Сохранить), чтобы сохранить изменения.
12. На панели мониторинга Jenkins щелкните **Build Now** (Построение), чтобы запустить **MyJob**. Изучите выходные данные в консоли для определения состояния. Сообщения о состоянии для хранилища Azure будут включены в выходные данные консоли, когда действие после построения начнет передавать артефакты построения.
13. После успешного завершения задания можно просмотреть артефакты построения, открыв общедоступный BLOB-объект.
    1. Выполните вход на портал управления Azure <https://manage.windowsazure.com>.
    2. Щелкните элемент **Хранилище**.
    3. Щелкните имя учетной записи хранения, используемой для решения Jenkins.
    4. Щелкните элемент **Контейнеры**.
    5. Выберите контейнер с именем **myjob**, которое является копией имени задания Jenkins, написанного в нижнем регистре. Имена контейнеров и BLOB-объектов в хранилище Azure отображаются строчными буквами (и с учетом регистра). В списке BLOB-объектов для контейнера с именем **myjob** вы увидите **hello.txt** и **date.txt**. Скопируйте URL-адрес любого из этих элементов и откройте его в браузере. Вы увидите текстовый файл, который был загружен в качестве артефакта построения.

<h2><a name="components"></a><span class="short header">Компоненты службы BLOB-объектов</span>Компоненты, используемые службой BLOB-объектов</h2>

Ниже приведен обзор компонентов службы BLOB-объектов:

- **Учетная запись хранения**. Весь доступ к хранилищу Azure осуществляется с помощью учетной записи хранения. Это самое высокоуровневое пространство имен для доступа к BLOB-объектам. Учетная запись может содержать неограниченное число контейнеров при условии, что их общий размер не достигает 100 ТБ.
- **Контейнер**. Контейнер обеспечивает группировку набора BLOB-объектов. Все BLOB-объекты должны содержаться в контейнере. Учетная запись может содержать неограниченное число контейнеров. Контейнер может хранить неограниченное количество BLOB-объектов.
- **BLOB-объект**. Файл любого типа и размера. Существует два типа BLOB-объектов, которые могут храниться в хранилище Azure: блоки и страницы. Большинство файлов являются BLOB-блоками. Единичный BLOB-блок может иметь размер до 200 ГБ. В этом учебнике используются BLOB-блоки. BLOB-страницы, другой тип BLOB-объекта, могут иметь размер до 1 ТБ. Они более эффективны, когда диапазоны байтов в файле часто изменяются. Дополнительные сведения о BLOB-объектах см. в разделе [Что такое BLOB-блоки и BLOB-страницы](http://msdn.microsoft.com/ru-ru/library/windowsazure/ee691964.aspx).
- **Формат URL-адреса**. К BLOB-объектам можно обратиться, используя следующий формат URL-адреса:

    `http://storageaccount.blob.core.windows.net/container_name/blob_name`
    
    (Приведенный выше формат применяется для общедоступного облака Azure. При использовании другого облака Azure используйте конечную точку на портале управления Azure, чтобы определить конечную точку URL-адреса.)

    В указанном выше формате `storageaccount` представляет имя вашей учетной записи хранения, `container_name` представляет имя контейнера, а `blob_name` представляет имя BLOB-объекта соответственно. В имени контейнера может использовать несколько путей, разделенных косой чертой — **/**. Образцом имени контейнера в данном учебнике был **MyJob**, а **${BUILD\_ID}/${BUILD\_NUMBER}** использовался в качестве общего виртуального пути, в результате чего BLOB-объект имеет следующий URL-адрес:

    `http://example.blob.core.windows.net/myjob/2013-01-28_15-00-35/2/hello.txt`

  [Общие сведения о Jenkins]: #overview
  [Преимущества использования службы BLOB-объектов]: #benefits
  [Предварительные требования]: #prerequisites
  [Использование службы BLOB-объектов с решением непрерывной интеграции Jenkins]: #howtouse
  [Установка подключаемого модуля хранилища Azure]: #howtoinstall
  [Настройка подключаемого модуля хранилища Azure для использования вашей учетной записи хранения]: #howtoconfigure
  [Создание действия, выполняемого после построения и отправляющего артефакты построения в вашу учетную запись хранения]: #howtocreatepostbuild
  [Компоненты, используемые службой BLOB-объектов]: #components
  [Создание учетной записи хранения]: http://go.microsoft.com/fwlink/?LinkId=279823
  [Знакомство с Jenkins]: https://wiki.jenkins-ci.org/display/JENKINS/Meet+Jenkins
  [ms-open-tech]: http://msopentech.com

