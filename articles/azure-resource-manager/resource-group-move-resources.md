---
title: Перемещение ресурсов Azure в новую подписку или группу ресурсов | Документация Майкрософт
description: Перемещайте ресурсы в новую группу ресурсов или новую подписку с помощью Azure Resource Manager.
services: azure-resource-manager
documentationcenter: ''
author: tfitzmac
manager: timlt
editor: tysonn
ms.assetid: ab7d42bd-8434-4026-a892-df4a97b60a9b
ms.service: azure-resource-manager
ms.workload: multiple
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/29/2018
ms.author: tomfitz
ms.openlocfilehash: 40e79ba584843787ad7744f91e14907deb99ccaa
ms.sourcegitcommit: 20d103fb8658b29b48115782fe01f76239b240aa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2018
---
# <a name="move-resources-to-new-resource-group-or-subscription"></a>Перемещение ресурсов в новую группу ресурсов или подписку

В этой статье показано, как переместить ресурсы в новую подписку или новую группу ресурсов в той же подписке. Для перемещения ресурса можно использовать портал, PowerShell, интерфейс командной строки Azure или REST API. Операции по перемещению, описанные в этой статье, вы можете выполнить самостоятельно, без помощи службы поддержки Azure.

При перемещении ресурсов группа источника и группа назначения блокируются на время операции. Операции записи и удаления для групп ресурсов блокируются до завершения перемещения. Эта блокировка означает, что невозможно добавить, обновить или удалить ресурсы в группах ресурсов, но не означает, что эти ресурсы закреплены. Например, если переместить в новую группу ресурсов экземпляр SQL Server и его базу данных, то приложение, использующее эту базу данных, не будет испытывать простоев в работе. Оно по-прежнему сможет считывать данные из базы данных и записывать их в нее.

Расположение ресурса изменить невозможно. При перемещении ресурс всего лишь перемещается в новую группу ресурсов. Даже если новая группа ресурсов находится в другом расположении, расположение ресурса не меняется.

> [!NOTE]
> В этой статье описывается, как перемещать ресурсы в рамках существующего предложения для учетной записи Azure. Если вы действительно хотите изменить предложение для своей учетной записи Azure (например, перейти с оплаты по мере использования на предоплату), продолжая работать с существующими ресурсами, см. статью [Переключение подписки Azure на другое предложение](../billing/billing-how-to-switch-azure-offer.md).
>
>

## <a name="checklist-before-moving-resources"></a>Рекомендации перед перемещением ресурсов

Вот некоторые важные особенности, которые следует учитывать перед перемещением ресурса. Проверив эти условия, можно избежать ошибок.

1. Исходная и целевая подписка должны существовать в пределах одного [клиента Azure Active Directory](../active-directory/active-directory-howto-tenant.md). Используя Azure PowerShell или командную строку Azure, можно убедиться, что обе подписки имеют один и тот же идентификатор клиента.

  Для Azure PowerShell:

  ```powershell
  (Get-AzureRmSubscription -SubscriptionName <your-source-subscription>).TenantId
  (Get-AzureRmSubscription -SubscriptionName <your-destination-subscription>).TenantId
  ```

  Для интерфейса командной строки Azure:

  ```azurecli-interactive
  az account show --subscription <your-source-subscription> --query tenantId
  az account show --subscription <your-destination-subscription> --query tenantId
  ```

  Если идентификаторы клиентов исходных и целевых подписок не совпадают, используйте следующие методы для выверки идентификаторов клиентов: 

  * [Передача прав владения подпиской Azure другой учетной записи](../billing/billing-subscription-transfer.md)
  * [Как связать или добавить подписку Azure в Azure Active Directory](../active-directory/active-directory-how-subscriptions-associated-directory.md)

2. Служба должна иметь возможность перемещения ресурсов. В этой статье перечислено, какие службы позволяют перемещать ресурсы, а какие — нет.
3. Подписка назначения должна быть зарегистрирована для перемещаемого поставщика ресурсов. В противном случае отображается сообщение о том, что **подписка не зарегистрирована для типа ресурса**. Эта проблема может возникнуть при перемещении ресурса в новую подписку, которая никогда не использовалась с этим типом ресурса.

  Для PowerShell используйте следующие команды, чтобы получить состояние регистрации:

  ```powershell
  Set-AzureRmContext -Subscription <destination-subscription-name-or-id>
  Get-AzureRmResourceProvider -ListAvailable | Select-Object ProviderNamespace, RegistrationState
  ```

  Чтобы зарегистрировать поставщик ресурсов, воспользуйтесь командой:

  ```powershell
  Register-AzureRmResourceProvider -ProviderNamespace Microsoft.Batch
  ```

  Для Azure CLI используйте следующие команды, чтобы получить состояние регистрации:

  ```azurecli-interactive
  az account set -s <destination-subscription-name-or-id>
  az provider list --query "[].{Provider:namespace, Status:registrationState}" --out table
  ```

  Чтобы зарегистрировать поставщик ресурсов, воспользуйтесь командой:

  ```azurecli-interactive
  az provider register --namespace Microsoft.Batch
  ```

4. Учетная запись, используемая для перемещения ресурсов, должна предоставлять по крайней мере следующие разрешения:

   * **Microsoft.Resources/subscriptions/resourceGroups/moveResources/action** для исходной группы ресурсов;
   * **Microsoft.Resources/subscriptions/resourceGroups/write** для целевой группы ресурсов.

## <a name="when-to-call-support"></a>Когда обращаться в службу поддержки

Большинство ресурсов можно самостоятельно переместить с помощью операций, описанных в этой статье. С помощью этих операций можно выполнять такие действия:

* Перемещение ресурсов Resource Manager.
* перемещение классических ресурсов с учетом [ограничений классического развертывания](#classic-deployment-limitations).

Обратитесь в [службу поддержки](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview), если необходимо выполнить такие действия:

* переместить ресурсы в новую учетную запись Azure (и клиент Azure Active Directory) и вам нужна помощь, чтобы выполнить инструкции из предыдущего раздела;
* перемещение классических ресурсов, осложненное проблемами с ограничениями.

## <a name="services-that-can-be-moved"></a>Службы, которые можно переместить

Указанные ниже службы поддерживают перемещение в новую группу ресурсов и подписку.

* Управление API
* Приложения службы приложений (веб-приложения) — см. раздел [Ограничения службы приложений](#app-service-limitations).
* Сертификаты службы приложений.
* Application Insights
* Служба автоматизации
* Azure Cosmos DB
* пакетная служба;
* Карты Bing
* CDN
* Облачные службы — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
* Cognitive Services
* Content Moderator
* Каталог данных
* Фабрика данных
* Data Lake Analytics
* Data Lake Store
* DNS
* Концентраторы событий
* Кластеры HDInsight — см. раздел [Ограничения HDInsight](#hdinsight-limitations).
* Центры Интернета вещей;
* хранилище ключей;
* Подсистемы балансировки нагрузки — см. [ограничения подсистемы балансировки нагрузки](#lb-limitations)
* приложения логики;
* Машинное обучение. Веб-службы Студии машинного обучения Microsoft Azure можно переместить в группу ресурсов, размещенную в той же подписке, но не в другую подписку. Другие ресурсы машинного обучения можно перемещать между подписками.
* Службы мультимедиа
* Службы мобильного взаимодействия
* Центры уведомлений
* Operational Insights;
* Пакет Operations Management
* Power BI
* Общедоступный IP-адрес — см. [ограничения общедоступного IP-адреса](#pip-limitations)
* кэш Redis;
* Планировщик
* поиска
* Управление сервером
* Служебная шина
* Service Fabric
* Хранилище
* Служба хранилища (классическая) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
* Stream Analytics — задание Stream Analytics в состоянии выполнения нельзя переместить.
* Сервер базы данных SQL — база данных и сервер должны находиться в одной группе ресурсов. При перемещении сервера SQL Server все его базы данных также перемещаются.
* Диспетчер трафика
* Виртуальные машины — виртуальные машины с управляемыми дисками переместить нельзя. См. сведения об [ограничениях для виртуальных машин](#virtual-machines-limitations)
* Виртуальные машины (классические) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).
* Масштабируемые наборы виртуальных машин — см. сведения об [ограничениях для виртуальных машин](#virtual-machines-limitations)
* Виртуальные сети — см. сведения об [ограничениях виртуальных сетей](#virtual-networks-limitations)
* VPN-шлюз

## <a name="services-that-cannot-be-moved"></a>Службы, которые невозможно переместить

Службы, которые в настоящее время не поддерживают перемещение ресурсов:

* доменные службы Active Directory;
* служба работоспособности гибридного AD;
* Шлюз приложений
* Службы BizTalk
* Служба контейнеров
* ExpressRoute
* DevTest Labs — переход на новую группу ресурсов в одной подписке включен, но перемещение между подписками не доступно.
* Dynamics LCS.
* Подсистемы балансировки нагрузки — см. [ограничения подсистемы балансировки нагрузки](#lb-limitations)
* Управляемые приложения.
* Управляемые диски — см. сведения об [ограничениях для виртуальных машин](#virtual-machines-limitations).
* Общедоступный IP-адрес — см. [ограничения общедоступного IP-адреса](#pip-limitations)
* Хранилище служб восстановления. Не перемещайте ресурсы хранилища, а также вычислительные и сетевые ресурсы, связанные с хранилищем служб восстановления. См. раздел [Ограничения служб восстановления](#recovery-services-limitations).
* Безопасность
* Диспетчер устройств StorSimple
* Виртуальные сети (классические) — см. раздел [Ограничения классического развертывания](#classic-deployment-limitations).

## <a name="virtual-machines-limitations"></a>Ограничения для виртуальных машин

Управляемые диски не поддерживают перемещение. Это ограничение означает, что несколько связанных ресурсов переместить также нельзя. Нельзя переместить:

* Управляемые диски
* Виртуальные машины с управляемыми дисками.
* Образы, созданные из управляемых дисков.
* Моментальные снимки, созданные из управляемых дисков.
* Группы доступности, содержащие виртуальные машины с управляемыми дисками.

Виртуальные машины, созданные из ресурсов Marketplace с подключенными планами, невозможно переместить между группами ресурсов или подписками. Отзовите виртуальную машину в текущей подписке и разверните ее в новой подписке.

Виртуальные машины с сертификатами, хранящимися в Key Vault, можно переместить в новую группу ресурсов в той же подписке. Между разными подписками их переместить нельзя.

## <a name="virtual-networks-limitations"></a>Ограничения для виртуальных сетей

Чтобы переместить виртуальную сеть с пиринговым подключением, сначала нужно отключить это подключение. После отключения виртуальную сеть можно переместить. После перемещения установите пиринговое подключение виртуальной сети заново.

Виртуальную сеть невозможно переместить в другую подписку, если эта сеть содержит подсеть со ссылками перехода к ресурсам. Например если ресурс кэша Redis развернут в подсети, эта подсеть содержит ссылку перехода к ресурсу.

## <a name="app-service-limitations"></a>Ограничения службы приложений

Ограничения на перемещение ресурсов службы приложений отличаются в зависимости от того, перемещаются ли ресурсы в пределах одной подписки или переносятся в новую подписку. 

Ограничения, описанные в этих разделах, применяются к отправленным сертификатам, а не к сертификатам службы приложений. Сертификаты службы приложений можно без ограничений переместить в новую группу ресурсов или подписку. Если один сертификат службы приложения используется несколькими веб-приложениями, сначала переместите все веб-приложения, а затем — сертификат.

### <a name="moving-within-the-same-subscription"></a>Перемещение в пределах одной подписки

При перемещении веб-приложения _в пределах одной подписки_ невозможно переместить отправленные SSL-сертификаты. Но вы можете переместить веб-приложение в новую группу ресурсов без отправленного SSL-сертификата, и функции SSL в приложении будут по-прежнему работать. 

Чтобы переместить SSL-сертификат с веб-приложением, сделайте следующее:

1.  Удалите отправленный сертификат из веб-приложения.
2.  Переместите веб-приложение.
3.  Добавьте сертификат в перемещенное веб-приложение.

### <a name="moving-across-subscriptions"></a>Перемещение между подписками

При перемещении веб-приложения _между подписками_ применяются следующие ограничения.

- В целевой группе ресурсов не должно быть существующих ресурсов службы приложений. Ресурсы службы приложений:
    - Веб-приложения
    - Планы службы приложений
    - отправленные или импортированные SSL-сертификаты;
    - среда службы приложений.
- Все ресурсы службы приложений в группе ресурсов необходимо перемещать вместе.
- Ресурсы службы приложений можно перемещать только из группы ресурсов, в которой они были созданы. Если ресурс службы приложений не находится в исходной группе ресурсов, сначала его необходимо переместить обратно в эту группу ресурсов, а потом можно перемещать между подписками. 

## <a name="classic-deployment-limitations"></a>Ограничения классического развертывания

Процедуры перемещения ресурсов, развернутых с помощью классической модели, отличаются в зависимости от того, перемещаются ли ресурсы в пределах одной подписки, или они переносятся в новую подписку.

### <a name="same-subscription"></a>Та же подписка

При перемещении ресурсов из одной группы ресурсов в другую в пределах одной подписки действуют следующие ограничения.

* Нельзя перемещать виртуальные сети (классические).
* Виртуальные машины (классические) необходимо перемещать с облачной службой.
* Облачную службу можно перемещать только в тех случаях, когда перемещение включает в себя все виртуальные машины этой службы.
* Одновременно можно перемещать только одну облачную службу.
* Одновременно можно перемещать только одну учетную запись хранения (классическую).
* Нельзя перемещать учетную запись хранения (классическую) в рамках одной операции с виртуальной машиной или облачной службой.

Для перемещения классических ресурсов в новую группу ресурсов в пределах одной подписки используйте стандартные операции перемещения на [портале](#use-portal), в [Azure PowerShell](#use-powershell), [интерфейсе командной строки Azure](#use-azure-cli) или интерфейсе [REST API](#use-rest-api). При этом используются те же операции, что и для перемещения ресурсов Resource Manager.

### <a name="new-subscription"></a>Новая подписка

При перемещении ресурсов в новую подписку действуют следующие ограничения.

* Все классические ресурсы в подписке необходимо переместить в рамках одной операции.
* Целевая подписка не должна содержать никаких других классических ресурсов.
* Перемещение можно запросить только через отдельный интерфейс REST API для классических перемещений. Стандартные команды перемещения Resource Manager не работают, если перемещение классических ресурсов осуществляется в новую подписку.

Для перемещения классических ресурсов в новую подписку используйте операции REST, предназначенные для классических ресурсов. Чтобы воспользоваться REST, выполните следующие действия:

1. Проверьте, может ли исходная подписка участвовать в перемещении между подписками. Выполните такую операцию:

  ```HTTP
  POST https://management.azure.com/subscriptions/{sourceSubscriptionId}/providers/Microsoft.ClassicCompute/validateSubscriptionMoveAvailability?api-version=2016-04-01
  ```

     Включите в текст запроса такой код:

  ```json
  {
    "role": "source"
  }
  ```

     Ответ на операцию проверки имеет следующий формат:

  ```json
  {
    "status": "{status}",
    "reasons": [
      "reason1",
      "reason2"
    ]
  }
  ```

2. Проверьте, может ли целевая подписка участвовать в перемещении между подписками. Выполните такую операцию:

  ```HTTP
  POST https://management.azure.com/subscriptions/{destinationSubscriptionId}/providers/Microsoft.ClassicCompute/validateSubscriptionMoveAvailability?api-version=2016-04-01
  ```

     Включите в текст запроса такой код:

  ```json
  {
    "role": "target"
  }
  ```

     Ответ будет в том же формате, что и проверка исходной подписки.
3. Если обе подписки пройдут проверку, переместите все классические ресурсы из одной подписки в другую, выполнив следующее действие:

  ```HTTP
  POST https://management.azure.com/subscriptions/{subscription-id}/providers/Microsoft.ClassicCompute/moveSubscriptionResources?api-version=2016-04-01
  ```

    Включите в текст запроса такой код:

  ```json
  {
    "target": "/subscriptions/{target-subscription-id}"
  }
  ```

Операция может занять несколько минут.

## <a name="recovery-services-limitations"></a>Ограничения служб восстановления

Перемещение не поддерживается для ресурсов хранилища, сетевых и вычислительных ресурсов, используемых для настройки аварийного восстановления с помощью Azure Site Recovery.

Предположим, что вы настроили репликацию своих локальных компьютеров в учетную запись хранения (Storage1) и хотите, чтобы защищенный компьютер восстанавливался после отработки отказа в Azure как виртуальная машина (VM1), подключенная к виртуальной сети (Network1). Ни один из этих ресурсов Azure (Storage1, VM1 и Network1) нельзя перемещать между группами ресурсов в пределах одной подписки или между подписками.

Чтобы переместить виртуальную машину, зарегистрированную в **Azure Backup**, между группами ресурсов:
 1. Временно остановите резервное копирование и сохраните резервные копии данных.
 2. Переместите виртуальную машину в целевую группу ресурсов.
 3. Повторно защитите ее в том же или другом хранилище. Пользователи могут восстанавливать данные из доступных точек восстановления, созданных до операции перемещения.
Если пользователь перемещает резервную копию виртуальной машины между подписками, шаги 1 и 2 будут теми же. На шаге 3 пользователь должен защитить виртуальную машину в новом хранилище в целевой подписке. Хранилище служб восстановления поддерживает создание резервных копий в нескольких подписках.

## <a name="hdinsight-limitations"></a>Ограничения HDInsight

Кластеры HDInsight можно переместить в новую подписку или группу ресурсов. Однако перемещение между подписками недоступно для сетевых ресурсов, связанных с кластером HDInsight (таких как виртуальная сеть, сетевая карта или балансировщик нагрузки). Также невозможно переместить в новую группу ресурсов сетевую карту, которая подключена к виртуальной машине кластера.

При перемещении кластера HDInsight в новую подписку сначала необходимо переместить другие ресурсы (такие как учетная запись хранения). А затем переместить сам кластер HDInsight.

## <a name="search-limitations"></a>Ограничения поиска

Вы не можете одновременно переместить ресурсы поиска, размещенные в разных регионах.
В этом случае необходимо перемещать их отдельно.

## <a name="lb-limitations"></a> Ограничения подсистемы балансировки нагрузки

Номер SKU "Базовый" подсистемы балансировки нагрузки можно переместить.
Номер SKU "Стандартный" подсистемы балансировки нагрузки нельзя переместить.

## <a name="pip-limitations"></a> Ограничения общедоступного IP-адреса

Номер SKU "Базовый" общедоступного IP-адреса можно переместить.
Номер SKU "Стандартный" общедоступного IP-адреса нельзя переместить.

## <a name="use-portal"></a>С помощью портала

Чтобы переместить ресурсы, выберите группу ресурсов, которая содержит эти ресурсы, а затем нажмите кнопку **Переместить**.

![перемещение ресурсов](./media/resource-group-move-resources/select-move.png)

Укажите, куда будут перемещены ресурсы: в новую группу ресурсов или новую подписку.

Выберите ресурсы, которые необходимо переместить, и целевую группу ресурсов. Подтвердите обновление сценариев для этих ресурсов и нажмите кнопку **ОК**. Если на предыдущем шаге был выбран значок редактирования подписки, то также необходимо выбрать целевую подписку.

![выбор места назначения](./media/resource-group-move-resources/select-destination.png)

В области **уведомлений**вы увидите, что операция перемещения выполняется.

![отображение состояния перемещения](./media/resource-group-move-resources/show-status.png)

После ее завершения отобразится уведомление о результате.

![отображение результата перемещения](./media/resource-group-move-resources/show-result.png)

## <a name="use-powershell"></a>Использование PowerShell

Чтобы переместить существующие ресурсы в другую группу ресурсов или подписку, используйте команду [Move-AzureRmResource](/powershell/module/azurerm.resources/move-azurermresource) . В следующем примере показано, как переместить несколько ресурсов в новую группу ресурсов.

```powershell
$webapp = Get-AzureRmResource -ResourceGroupName OldRG -ResourceName ExampleSite
$plan = Get-AzureRmResource -ResourceGroupName OldRG -ResourceName ExamplePlan
Move-AzureRmResource -DestinationResourceGroupName NewRG -ResourceId $webapp.ResourceId, $plan.ResourceId
```

Чтобы переместить ресурс в новую подписку, добавьте значение параметра `DestinationSubscriptionId`.

## <a name="use-azure-cli"></a>Использование интерфейса командной строки Azure

Чтобы переместить существующие ресурсы в другую группу или подписку, используйте команду [az resource move](/cli/azure/resource?view=azure-cli-latest#az_resource_move). Укажите идентификаторы перемещаемых ресурсов. В следующем примере показано, как переместить несколько ресурсов в новую группу ресурсов. В параметре `--ids` укажите перемещаемый список идентификаторов ресурсов с разделителями-пробелами.

```azurecli
webapp=$(az resource show -g OldRG -n ExampleSite --resource-type "Microsoft.Web/sites" --query id --output tsv)
plan=$(az resource show -g OldRG -n ExamplePlan --resource-type "Microsoft.Web/serverfarms" --query id --output tsv)
az resource move --destination-group newgroup --ids $webapp $plan
```

Для перемещения в новую подписку нужно указать параметр `--destination-subscription-id`.

## <a name="use-rest-api"></a>Использование REST API

Чтобы переместить существующие ресурсы в другую группу ресурсов или подписку, выполните следующую команду:

```HTTP
POST https://management.azure.com/subscriptions/{source-subscription-id}/resourcegroups/{source-resource-group-name}/moveResources?api-version={api-version}
```

В тексте запроса укажите целевую группу ресурсов и ресурсы для перемещения. Дополнительные сведения об операции перемещения в REST см. в статье [Move resources](/rest/api/resources/Resources/MoveResources) (Перемещение ресурсов).

## <a name="next-steps"></a>Дополнительная информация

* Сведения о командлетах PowerShell для управления подпиской см. в статье [Использование Azure PowerShell с Resource Manager](powershell-azure-resource-manager.md).
* Сведения о командах интерфейса командной строки Azure для управления подпиской см. в статье [Управление ресурсами и группами ресурсов Azure с помощью интерфейса командной строки Azure](xplat-cli-azure-resource-manager.md).
* Сведения о функциях портала для управления подпиской см. в статье [Управление ресурсами Azure через портал](resource-group-portal.md).
* Сведения о логической организации ресурсов см. в разделе [Использование тегов для организации ресурсов в Azure](resource-group-using-tags.md).
