<properties 
	pageTitle="Использование расширения виртуальных машин Docker для Linux на Azure" 
	description="Описание механизма Docker и расширений виртуальных машин Azure, а также программного создания виртуальных машин в Azure как узлов Docker с помощью интерфейса командной строки azure-cli." 
	services="virtual-machines" 
	documentationCenter="" 
	authors="squillace" 
	manager="timlt" 
	editor="tysonn"/>

<tags 
	ms.service="virtual-machines" 
	ms.devlang="multiple" 
	ms.topic="article" 
	ms.tgt_pltfrm="vm-linux" 
	ms.workload="infrastructure-services" 
	ms.date="02/02/2015" 
	ms.author="rasquill"/>
# Использование расширения виртуальных машин Docker в межплатформенном интерфейсе Azure (xplat-cli)
В этом разделе описано создание виртуальной машины с расширением Docker в интерфейсе xplat-cli на любой платформе. [Docker](https://www.docker.com/) - один из самых популярных подходов к виртуализации, использующий [контейнеры Linux](http://en.wikipedia.org/wiki/LXC) вместо виртуальных машин как способ изоляции данных и вычислений при использовании общих ресурсов. Можно использовать расширение Docker для виртуальных машин в [агенте Linux для Azure](http://azure.microsoft.com/documentation/articles/virtual-machines-linux-agent-user-guide/), чтобы создать виртуальную машину Docker, в которой будет размещено любое количество контейнеров с приложениями в Azure. Обзорное обсуждение контейнеров и их преимуществ см. на [доске по Docker](http://channel9.msdn.com/Blogs/Regular-IT-Guy/Docker-High-Level-Whiteboard).

+ [Как использовать расширение Docker для виртуальных машин с Azure]
+ [Расширения для виртуальной машины для Linux и Windows] 
+ [Ресурсы для контейнеров и управления ими в Azure]
+ [Дальнейшие действия]



## <a id='How to use the Docker VM Extension with Azure'>Использование расширения виртуальных машин Docker в Azure</a>
Чтобы использовать расширение виртуальных машин Docker в Azure, необходимо установить [межплатформенный интерфейс командной строки Azure](https://github.com/Azure/azure-sdk-tools-xplat) (в этом разделе называется **xplat-cli**) более поздней версии, чем 0.8.6 (текущая версия на момент написания этой статьи - 0.8.10). Вы можете установить xplat-cli на Mac, Linux и Windows. 

> [AZURE.NOTE] Хотя xplat-cli можно установить в Microsoft Windows, расширение Docker создано с зависимостями ядра, характерными для Linux. Поэтому для использования Windows как клиента Docker необходимо разместить полный дистрибутив Linux в виде виртуальной машины в Hyper-V или другом гипервизоре. После этого вы сможете использовать xplat-cli и команды Docker, указанные в данном документе, и вообще все команды Docker. Сам Docker содержит программу установки для Windows, [Boot2Docker](https://docs.docker.com/installation/windows/), которую можно также использовать для автоматизации той же установки.

Процесс использования Docker в Azure прост.

+ Установите средство командной строки xplat-cli и его зависимости на компьютере, с которого вы хотите управлять Azure (в случае Windows это будет дистрибутив Linux, запущенный в виде виртуальной машины)
+ Используйте команды Docker в xplat-cli, чтобы создать узел виртуальных машин Docker в Azure.
+ Используйте команды локального Docker для управления своим контейнерами на узле виртуальных машин Docker в Azure.

> [AZURE.NOTE] xplat-cli (интерфейс командной строки) в настоящее время является единственным способом создания виртуальной машины под управлением Docker в Azure для размещения контейнеров Docker. 

### Установка межплатформенного интерфейса командной строки (xplat-cli)
Информацию об установке и настройке межплатформенного интерфейса командной строки см. в разделе [Установка межплатформенного интерфейса командной строки Azure](http://azure.microsoft.com/documentation/articles/xplat-cli/#install). Чтобы подтвердить установку, введите `azure` в командной строке, и через некоторое время вы должны увидеть вывод xplat-cli в виде ASCII-арта, в котором перечислены основные доступные вам команды. Если установка прошла без ошибок, вы можете ввести `azure help vm` и увидеть в списке команд docker.

> [AZURE.NOTE] При использовании Ubuntu 14.04 LTS, в образе которой используется слегка видоизмененный процесс установки node, могут потребоваться дополнительные действия. В качестве одного из рабочих решений предлагается расположенная [здесь](https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-an-ubuntu-14-04-server) в разделе **Установка с использованием PPA** инструкция, описывающая порядок непосредственной установки самой последней версии nodejs, которая работает для дистрибутива Ubuntu 14.04 LTS. 

### Подключение xplat-cli к учетной записи Azure
Перед тем как вы сможете использовать xplat-cli, необходимо привязать учетные данные записи Azure к xplat-cli для вашей платформы. В разделе [Подключение к подписке Azure](http://azure.microsoft.com/documentation/articles/xplat-cli/#configure) описано, как скачать и импортировать файл **PUBLISHSETTINGS** либо связать интерфейс командной строки xplat-cli с организационным идентификатором. 

> [AZURE.NOTE] Есть некоторые различия в действиях при использовании первого или второго способа аутентификации, так что не забудьте прочитать вышеуказанный документ, чтобы понять различие в функциональности. 

### Установка Docker и использование расширения виртуальных машин Docker для Azure
Следуйте [указаниям по установке Docker](https://docs.docker.com/installation/#installation), чтобы установить Docker локально на вашем компьютере. Для большинства операционных систем и дистрибутивов установка заключается в вводе `apt-get install docker.io`. Убедитесь, что версия Docker не ниже 1.0.

Для использования Docker в виртуальной машине Azure в образе Linux, который используется для нее, необходимо установить [агент виртуальных машин Linux для Azure](http://azure.microsoft.com/documentation/articles/virtual-machines-linux-agent-user-guide/). В настоящее время это обеспечивается только двумя типами образов:

+ образ Ubuntu из коллекции образов Azure или 

+ пользовательский образ Linux, созданный вами, с установленным и настроенным агентом виртуальных машин Linux для Azure. Дополнительную информацию о создании пользовательской виртуальной машины с агентом Azure см. в разделе [Агент виртуальных машин Linux для Azure](http://azure.microsoft.com/documentation/articles/virtual-machines-linux-agent-user-guide/).

### Использование коллекции образов Azure

В сеансе Bash или сеансе терминала используйте следующую команду xplat-cli для поиска последнего образа Ubuntu в коллекции виртуальных машин:

`azure vm image list | grep Ubuntu-14_04`

, выберите одно из имен образов, например `b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-14_04-LTS-amd64-server-20140724-ru-ru-30GB`, и используйте следующую команду для создания новой виртуальной машины с помощью этого образа. 

```
azure vm docker create -e 22 -l "West US" <vm-cloudservice name> "b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-14_04-LTS-amd64-server-20140724-ru-ru-30GB" <username> <password>
``` 

где:

+ *&lt;vm-cloudservice name&gt;* - имя виртуальной машины, которая станет главным компьютером для контейнеров Docker в Azure;

+  *&lt;username&gt;* - имя привилегированного пользователя по умолчанию для виртуальной машины;

+ *&lt;password&gt;* - пароль для учетной записи *username*, который отвечает требованиям к сложности, предъявляемым для Azure. 
 
> [AZURE.NOTE] В настоящий момент пароль должен быть длиной не менее 8 символов, содержать как минимум один символ в нижнем и в верхнем регистре, цифру и один из следующих специальных символов: `!@#$%^&+=`. Точка в конце предыдущего выражения НЕ является специальным символом. 

Если команда прошла успешно, вы увидите нечто вроде следующего, в зависимости от конкретных аргументов и параметров, используемых вами:

![](./media/virtual-machines-docker/dockercreateresults.png)

> [AZURE.NOTE] Создание виртуальной машины может занять несколько минут, но после его подготовки будет запущена управляющая программа Docker (служба Docker), и вы сможете подключиться к компьютеру с контейнерами Docker.

Для проверки виртуальной машины Docker, только что созданной в Azure, введите

`docker --tls -H tcp://<vm-name-you-used>.cloudapp.net:4243 info`

где *vm-name-you-used* - имя виртуальной машины, которое было использовано при вызове `azure vm docker create`. Вы должны увидеть вывод, похожий на пример ниже, который указывает, что виртуальная машина узла Docker в Azure работает и ожидает ваших команд.

![](./media/virtual-machines-docker/connectingtodockerhost.png)

### Проверка подлинности виртуальной машины узла Docker
Помимо создания виртуальной машины Docker, команда `azure vm docker create` также автоматически создает необходимые сертификаты, чтобы клиентский компьютер Docker мог подключиться к основной виртуальной машине Azure с помощью HTTPS. Сертификаты хранятся как на клиенте, так и на узлах, в зависимости от обстоятельств. При последующих запусках существующие сертификаты используются повторно и совместно с новым узлом.

По умолчанию сертификаты помещаются в `~/.docker`, и Docker настраивается для запуска на порту **4243**. Если вы хотите использовать другой порт или каталог, то вы можете использовать один из следующих параметров командной строки `azure vm docker create` для настройки виртуальной машины, в которой размещены контейнеры Docker, на использование другого порта или других сертификатов для подключения клиентов:

```
-dp, --docker-port [port]              Port to use for docker [4243]
-dc, --docker-cert-dir [dir]           Directory containing docker certs [.docker/]
```

Управляющая программа Docker на узле настроена на прослушивание и выполнение аутентификации клиентских подключений на указанном порту, используя сертификаты, созданные с помощью команды `azure vm docker create`. Клиентские компьютеры должны иметь эти сертификаты, чтобы получить доступ к узлу Docker. 

> [AZURE.NOTE] Сетевой узел, работающий без этих сертификатов, будет уязвим для всех, кто может подключиться к компьютеру. Перед тем как изменить конфигурацию по умолчанию, убедитесь, что вы понимаете все риски, которым могут быть подвержены компьютеры и приложения.



<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## Дальнейшие действия

Вы готовы перейти к [руководству пользователя Docker] и использовать виртуальную машину Docker. Информацию о создании виртуальной машины с поддержкой Docker на новом портале см. в статье [Использование расширения виртуальных машин Docker на портале].

<!--Anchors-->
[Подзаголовок 1]: #subheading-1
[Подзаголовок 2]: #subheading-2
[Подзаголовок 3]: #subheading-3
[Дальнейшие действия]: #next-steps

[Использование расширения Docker для виртуальных машин с Azure]: #How-to-use-the-Docker-VM-Extension-with-Azure
[Расширения для виртуальной машины для Linux и Windows]: #Virtual-Machine-Extensions-For-Linux-and-Windows
[Ресурсы для контейнеров и управления ими в Azure]: #Container-and-Container-Management-Resources-for-Azure

<!--Image references-->
[5]: ./media/markdown-template-for-new-articles/octocats.png
[6]: ./media/markdown-template-for-new-articles/pretty49.png
[7]: ./media/markdown-template-for-new-articles/channel-9.png


<!--Link references-->
[Ссылка 1 на другой раздел документации azure.microsoft.com]: ../virtual-machines-windows-tutorial/
[Ссылка 2 на другой раздел документации azure.microsoft.com]: ../web-sites-custom-domain-name/
[Ссылка 3 на другой раздел документации azure.microsoft.com]: ../storage-whatis-account/
[Использование расширения виртуальных машин Docker на портале Azure]: http://azure.microsoft.com/documentation/articles/virtual-machines-docker-with-portal/

[Руководство пользователя Docker]: https://docs.docker.com/userguide/

<!--HONumber=45--> 
