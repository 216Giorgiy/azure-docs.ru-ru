<properties title="Использование расширения виртуальных машин Docker в межплатформенном интерфейсе Azure (xplat-cli)" pageTitle="Использование расширения виртуальных машин Docker для Linux на Azure" description="Описание механизма Docker и расширений виртуальных машин Azure, а также программного создания виртуальных машин в Azure как узлов Docker с помощью интерфейса командной строки azure-cli." metaKeywords="linux, virtual machines, vm, azure, docker, linux containers,  lxc, virtualization" services="virtual-machines" solutions="dev-test" documentationCenter="virtual-machines" authors="rasquill" videoId="" scriptId="" manager="timlt" />

<tags ms.service="virtual-machines" ms.devlang="multiple" ms.topic="article" ms.tgt_pltfrm="vm-linux" ms.workload="infrastructure-services" ms.date="10/21/2014" ms.author="rasquill" />

# Использование расширения виртуальных машин Docker в межплатформенном интерфейсе Azure (xplat-cli)

В этом разделе описано создание виртуальной машины с расширением Docker в интерфейсе xplat-cli на любой платформе. [Docker][Docker] — один из самых популярных подходов к виртуализации, использующий [контейнеры Linux][контейнеры Linux] вместо виртуальных машин как способ изоляции данных и вычислений при использовании общих ресурсов. Можно использовать расширение Docker в [агенте Linux для Azure][агенте Linux для Azure] для создания виртуальной машины, в которой будет размещено любое количество контейнеров с приложениями Azure. Обзорное обсуждение контейнеров и их преимуществ см. на [доске по Docker][доске по Docker].

-   [Использование расширения виртуальных машин Docker в Azure][Использование расширения виртуальных машин Docker в Azure]
-   [Расширения виртуальных машин для Linux и Windows][Расширения виртуальных машин для Linux и Windows]
-   [Ресурсы для контейнеров и управления ими в Azure][Ресурсы для контейнеров и управления ими в Azure]
-   [Дальнейшие действия][Дальнейшие действия]

## <span id="How to use the Docker VM Extension with Azure"></span>Использование расширения виртуальных машин Docker в Azure</a>

Чтобы использовать расширение виртуальных машин Docker в Azure, необходимо установить [межплатформенный интерфейс командной строки Azure][межплатформенный интерфейс командной строки Azure] (в этом разделе называется **xplat-cli**) более поздней версии, чем 0.8.6 (текущая версия на момент написания этой статьи — 0.8.10). Вы можете установить xplat-cli на Mac, Linux и Windows.

> [WACOM.NOTE] Хотя xplat-cli можно установить на Microsoft Windows, расширение Docker создано с зависимостями ядра, характерными для Linux. Поэтому для использования Windows как клиента Docker необходимо разместить полный дистрибутив Linux в виде виртуальной машины в Hyper-V или другом гипервизоре. После этого вы сможете использовать xplat-cli и команды Docker, указанные в данном документе, и вообще все команды Docker. Сам Docker имеет программу установки для Windows, [Boot2Docker][Boot2Docker], которую можно также использовать для автоматизации той же самой установки.

Процесс использования Docker в Azure прост.

-   Установите средство командной строки xplat-cli и его зависимости на компьютере, с которого вы хотите управлять Azure (в случае Windows это будет дистрибутив Linux, запущенный в виде виртуальной машины)
-   Используйте команды Docker в xplat-cli, чтобы создать узел виртуальных машин Docker в Azure.
-   Используйте команды локального Docker для управления своим контейнерами на узле виртуальных машин Docker в Azure.

> [WACOM.NOTE] xplat-cli (интерфейс командной строки) в настоящее время является единственным способом создания виртуальной машины под управлением Docker в Azure для размещения контейнеров Docker.

### Установка межплатформенного интерфейса командной строки (xplat-cli)

Для установки и настройки межплатформенного интерфейса командной строки см. раздел [Установка межплатформенного интерфейса командной строки Azure][Установка межплатформенного интерфейса командной строки Azure]. Чтобы подтвердить установку, введите `azure` в командной строке, и через некоторое время вы должны увидеть вывод xplat-cli в виде ASCII-арта, в котором перечислены основные доступные вам команды. Если установка прошла без ошибок, вы можете ввести `azure help vm` и увидеть в списке команд «docker».

> [WACOM.NOTE] При использовании Ubuntu 14.04 LTS, образ которой имеет слегка видоизмененный процесс установки node, могут потребоваться дополнительные действия. В качестве одного из рабочих решений предлагается расположенная [здесь][здесь] в разделе **Установка с использованием PPA** инструкция, описывающая порядок непосредственной установки самой последней версии nodejs, которая работает для дистрибутива Ubuntu 14.04 LTS.

### Подключение xplat-cli к учетной записи Azure

Перед тем как вы сможете использовать xplat-cli, необходимо привязать учетные данные записи Azure к xplat-cli для вашей платформы. В разделе [Подключение к подписке Azure][Подключение к подписке Azure] описано, как загрузить и импортировать файл **.publishsettings** либо связать интерфейс командной строки xplat-cli с организационным идентификатором.

> [WACOM.NOTE] Есть некоторые различия в действиях при использовании первого или второго способа проверки подлинности, так что не забудьте прочитать вышеуказанный документ, чтобы понять различие в функциональности.

### Установка Docker и использование расширения виртуальных машин Docker для Azure

Следуйте [инструкции по установке Docker][инструкции по установке Docker] для того, чтобы установить Docker локально на вашем компьютере. Для большинства операционных систем и дистрибутивов установка заключается в вводе `apt-get install docker.io`. Убедитесь, что версия Docker не ниже 1.0.

Для использования Docker на виртуальной машине Azure в образе Linux, который используется для нее, необходимо установить [Агент виртуальных машин Linux для Azure][агенте Linux для Azure]. В настоящее время это обеспечивается только двумя типами образов:

-   образ Ubuntu из коллекции образов Azure или

-   пользовательский образ Linux, созданный вами, с установленным и настроенным агентом виртуальных машин Linux для Azure. Дополнительные сведения о создании собственной виртуальной машины с агентом Azure см. в разделе [Агент виртуальных машин Linux для Azure][агенте Linux для Azure].

### Использование коллекции образов Azure

В сеансе Bash или сеансе терминала используйте следующую команду xplat-cli для поиска последнего образа Ubuntu в коллекции виртуальных машин:

`azure vm image list | grep Ubuntu-14_04`

, выберите одно из имен образов, например `b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-14_04-LTS-amd64-server-20140724-ru-ru-30GB`, и используйте следующую команду для создания новой виртуальной машины с помощью этого образа.

    azure vm docker create -e 22 -l "West US" <vm-cloudservice name> "b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-14_04-LTS-amd64-server-20140724-ru-ru-30GB" <username> <password>

где:

-   *\<vm-cloudservice name\>* — имя виртуальной машины, которая станет главным компьютером для контейнеров Docker в Azure

-   *\<username\>* — имя привилегированного пользователя по умолчанию для виртуальной машины

-   *\<password\>* — пароль для *имени пользователя* учетной записи, который отвечает требованиям к сложности, предъявляемым для Azure

> [WACOM.NOTE] В настоящий момент пароль должен быть длиной не менее 8 символов, содержать как минимум один символ в нижнем и в верхнем регистре, цифру и один из следующих специальных символов: `!@#$%^&+=`. Точка в конце предыдущего выражения НЕ является специальным символом.

Если команда прошла успешно, вы увидите нечто вроде следующего, в зависимости от конкретных аргументов и параметров, используемых вами:

![][0]

> [WACOM.NOTE] Создание виртуальной машины может занять несколько минут, но после его подготовки будет запущен демон Docker (служба Docker), и вы можете подключиться к компьютеру с контейнерами Docker.

Для проверки виртуальной машины Docker, только что созданной в Azure, введите

`docker --tls -H tcp://<vm-name-you-used>.cloudapp.net:4243 info`

где *<vm-name-you-used>* — имя виртуальной машины, которое было использовано при вызове `azure vm docker create`. Вы должны увидеть вывод, похожий на пример ниже, который указывает, что виртуальная машина узла Docker в Azure работает и ожидает ваших команд.

![][1]

### Проверка подлинности виртуальной машины узла Docker

Кроме создания виртуальной машины Docker, команда `azure vm docker create` также автоматически создает необходимые сертификаты, чтобы клиентский компьютер Docker мог подключиться к основной виртуальной машине Azure с помощью HTTPS. Сертификаты хранятся как на клиенте, так и на узлах, в зависимости от обстоятельств. При последующих запусках существующие сертификаты используются повторно и совместно с новым узлом.

По умолчанию сертификаты помещаются в `~/.docker`, и Docker настраивается для запуска на порту **4243**. Если вы хотите использовать другой порт или каталог, то вы можете использовать один из следующих параметров командной строки `azure vm docker create` для настройки виртуальной машины, на которой размещены контейнеры Docker, на использование другого порта или других сертификатов для подключения клиентов:

    -dp, --docker-port [port]              Port to use for docker [4243]
    -dc, --docker-cert-dir [dir]           Directory containing docker certs [.docker/]

Демон Docker на узле настроен на прослушивание и проверку подлинности клиентских подключений на указанном порту, используя сертификаты, созданные с помощью команды `azure vm docker create`. Клиентские компьютеры должны иметь эти сертификаты, чтобы получить доступ к узлу Docker.

> [WACOM.NOTE] Сетевой узел, работающий без этих сертификатов, будет уязвим для всех, кто может подключиться к компьютеру. Перед тем как изменить конфигурацию по умолчанию, убедитесь, что вы понимаете все риски, которым могут быть подвержены компьютеры и приложения.

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->

## Дальнейшие действия

Переходите к [Руководству пользователя Docker][Руководству пользователя Docker] и использованию виртуальной машины Docker. Для создания виртуальной машины с поддержкой Docker на новом портале см. раздел [Использование расширения виртуальных машин Docker на портале][Использование расширения виртуальных машин Docker на портале].

<!--Anchors--> <!--Image references--> <!--Link references-->

  [Docker]: https://www.docker.com/
  [контейнеры Linux]: http://en.wikipedia.org/wiki/LXC
  [агенте Linux для Azure]: http://azure.microsoft.com/ru-ru/documentation/articles/virtual-machines-linux-agent-user-guide/
  [доске по Docker]: http://channel9.msdn.com/Blogs/Regular-IT-Guy/Docker-High-Level-Whiteboard
  [Использование расширения виртуальных машин Docker в Azure]: #How-to-use-the-Docker-VM-Extension-with-Azure
  [Расширения виртуальных машин для Linux и Windows]: #Virtual-Machine-Extensions-For-Linux-and-Windows
  [Ресурсы для контейнеров и управления ими в Azure]: #Container-and-Container-Management-Resources-for-Azure
  [Дальнейшие действия]: #next-steps
  [межплатформенный интерфейс командной строки Azure]: https://github.com/Azure/azure-sdk-tools-xplat
  [Boot2Docker]: https://docs.docker.com/installation/windows/
  [Установка межплатформенного интерфейса командной строки Azure]: http://azure.microsoft.com/ru-ru/documentation/articles/xplat-cli/#install
  [здесь]: https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-an-ubuntu-14-04-server
  [Подключение к подписке Azure]: http://azure.microsoft.com/ru-ru/documentation/articles/xplat-cli/#configure
  [инструкции по установке Docker]: https://docs.docker.com/installation/#installation
  [0]: ./media/virtual-machines-docker/dockercreateresults.png
  [1]: ./media/virtual-machines-docker/connectingtodockerhost.png
  [Руководству пользователя Docker]: https://docs.docker.com/userguide/
  [Использование расширения виртуальных машин Docker на портале]: http://azure.microsoft.com/ru-ru/documentation/articles/virtual-machines-docker-with-portal/
