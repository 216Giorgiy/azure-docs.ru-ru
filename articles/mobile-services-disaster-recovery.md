<properties urlDisplayName="Recover your mobile service in the event of a disaster" pageTitle="Восстановление мобильной службы в случае аварии - мобильные службы Azure" metaKeywords="" description="Learn how to recover your mobile service in the event of a disaster." metaCanonical="" services="" documentationCenter="Mobile" title="Recover your mobile service in the event of a disaster" authors="brettsam" solutions="" manager="dwrede" editor="" />

<tags ms.service="mobile-services" ms.workload="mobile" ms.tgt_pltfrm="mobile-multiple" ms.devlang="multiple" ms.topic="article" ms.date="11/11/2014" ms.author="brettsam" />

# Восстановление мобильной службы в случае аварии

При использовании мобильных служб Azure для развертывания приложения можно использовать его встроенные возможности для обеспечения непрерывности бизнес-операций в случае наличия проблем, таких как ошибки сервера, прерывания в работе сети, потеря данных и масштабные сбои в работе вспомогательных средств. При развертывании приложения с помощью мобильных служб Azure вы получаете многочисленные преимущества, связанные с обеспечением отказоустойчивости и возможностями инфраструктуры, которые вам пришлось бы проектировать и реализовывать, а также осуществлять ими управление в случае развертывания традиционных локальных решений. Azure устраняет большую часть потенциальных сбоев при относительно небольших затратах.

<h2><a name="prepare"></a>Подготовка к возможным авариям</h2>

Чтобы упростить восстановление в случае проблем с доступностью, можно подготовиться к ним заранее: 

+ **Создайте резервную копию данных в базе данных SQL мобильных служб Azure**
	<br/>Данные приложения мобильной службы хранятся в базе данных SQL Azure. Корпорация Майкрософт рекомендует создавать их резервную копию, как описано в [руководстве по обеспечению непрерывности бизнеса на основе базы данных SQL].
+ **Создание резервной копии скриптов мобильной службы**
	<br/>Корпорация Майкрософт рекомендует сохранять скрипты мобильной службы в системе управления версиями, такой как [служба Team Foundation] или [GitHub] и не полагаться только на копии в самой мобильной службе. Можно загрузить скрипты через портал Azure с помощью [функции управления версиями] мобильных служб, или [с помощью средства командной строки Azure]. Обратите внимание на возможности, которые помечены как preview на портале, поскольку восстановление для этих скриптов не гарантируется и может потребоваться восстанавливать их с помощью вашей собственной системы управления версиями.
+ **Резервирование дополнительной мобильной службы**
	<br/>В случае наличия проблем с вашей мобильной службой необходимо выполнить ее повторное развертывание в альтернативной области Azure. Чтобы обеспечить наличие необходимых мощностей (например, в таких редких случаях, как потеря всей области), рекомендуется создать дополнительную мобильную службу в альтернативной области и задать для нее такой же режим (или более строгий), как и в основной службе. (Если основная служба работает в режиме общего доступа, можно создать дополнительную службу либо как общую, либо как зарезервированную. Но если основной зарезервирован, то дополнительный также должен быть зарезервирован.)


<h2><a name="watch"></a>Наблюдение за признаками проблемы</h2>

Эти обстоятельства указывают на наличие проблемы, которая может потребовать использования операции восстановления:

+ Приложения, подключенные к вашей мобильной службе, не взаимодействуют с ней в течение продолжительного времени.
+ Состояние мобильной службы отображается как **Неработоспособная** на [портале Azure].
+ Отметка **Неработоспособная** отображается в верхней части каждой вкладки мобильной службы на портале Azure, и операции управления создают сообщения об ошибках.
+  [Панель мониторинга служб Azure] указывает на наличие проблемы.

<h2><a name="recover"></a>Восстановление после сбоя</h2>

При возникновении проблемы используйте панель мониторинга службы, чтобы получить соответствующие рекомендации и обновления.
 
Если появляется панель мониторинга службы, выполните следующие шаги, чтобы восстановить работоспособное состояние мобильной службы в альтернативной области Azure. Если дополнительная служба создана заранее, ее емкость будет использоваться для восстановления основной службы. Поскольку URL-адрес и ключ приложения основной службы остается неизменным после восстановления, не нужно обновлять любые приложения, ссылающиеся на него. 

Для восстановления мобильной службы после сбоя:

1. На портале Azure убедитесь, что состояние службы отображается как **Неработоспособная**.

2. Если вы уже зарезервировали дополнительную мобильную службу, этот шаг можно пропустить.

   Если вы еще не зарезервировали дополнительную мобильную службу, создайте ее в другой области Azure. Установите ее режим как более строгий, чем режим основной службы. (Если основная служба работает в режиме общего доступа, можно создать дополнительную службу либо как общую, либо как зарезервированную. Но если основной зарезервирован, то дополнительный также должен быть зарезервирован.)

3. Настройте средства командной строки Azure для работы с подпиской, как описано в разделе [Автоматизация мобильных служб с помощью средства командной строки].

4. Теперь вы можете использовать дополнительную службу для восстановления своей основной службы.

    <div class="dev-callout"><b>Важно!</b>
	<p>При выполнении команды на этом шаге дополнительная служба удаляется таким образом, чтобы ее емкость могла использоваться для восстановления основной службы. Рекомендуется создавать резервные копии скриптов и параметров перед выполнением данной команды, если вы хотите их сохранить.</p>
    </div>

   Когда вы будете готовы, необходимо выполнить следующую команду:

		azure mobile recover PrimaryService SecondaryService
		info:    Executing command mobile recover
		Warning: this action will use the capacity from the mobile service 'SecondaryService' and delete it. Do you want to recover the mobile service 'PrimaryService'? (y/n): y
		+ Performing recovery
		+ Cleaning up
		info:    Recovery complete
		info:    mobile recover command OK


	<div class="dev-callout"><b>Примечание.</b>
	<p>Увидеть изменения в портале можно будет через несколько минут после завершения выполнения команды.</p>
    </div>

5. Убедитесь, что все скрипты были восстановлены правильно, сравнив их с исходными вариантами в системе управления версиями. В большинстве случаев скрипты автоматически восстанавливаются без потери данных, но, если вы нашли какое-либо несоответствие, этот скрипт можно восстановить вручную.

6. Убедитесь в том, что восстановленная служба взаимодействует с базой данных SQL Azure. Команда восстановления восстанавливает услуг мобильную службу, но сохраняет соединение с исходной базой данных. Если проблема в основной области Azure также влияет на базу данных, восстановленная служба может по-прежнему не выполняться правильно. Панель мониторинга служб Azure можно использовать для проверки состояния базы данных для данной области. Если исходная база данных не работает, ее можно восстановить:
	+ Восстановите базу данных SQL Azure в области Azure, где вы только что восстановили вашу мобильную службу, как описано в [руководстве по обеспечению непрерывности бизнеса на основе базы данных SQL].
	+ На портале Azure на вкладке **Настройка** вашей мобильной службы выберите "Изменить базу данных", а затем выберите только что восстановленную базу данных.

Теперь вы должны получить состояние, при котором ваша мобильная служба была восстановлена в новой области Azure, и теперь она принимает трафик из ваших приложений хранилища с использованием исходного URL-адреса.

<!-- Anchors. -->

<!-- Images. -->

<!-- URLs. -->
[Руководство по обеспечению непрерывности бизнеса на основе базы данных SQL]: http://msdn.microsoft.com/ru-ru/library/windowsazure/hh852669.aspx
[Служба Team Foundation Service]: http://tfs.visualstudio.com/

[функция управления версиями]: http://www.windowsazure.com/ru-ru/develop/mobile/tutorials/store-scripts-in-source-control/
[использование средства командной строки Azure]: http://www.windowsazure.com/ru-ru/develop/mobile/tutorials/command-line-administration/
[Портал Azure]: http://manage.windowsazure.com/
[Панель мониторинга служб Azure]: http://www.windowsazure.com/ru-ru/support/service-dashboard/
[Автоматизация мобильных служб с помощью средств командной строки]: http://www.windowsazure.com/ru-ru/develop/mobile/tutorials/command-line-administration/
