<properties linkid="dev-java-vm-application-server" urlDisplayName="Tomcat на виртуальной машине" pageTitle="Tomcat на виртуальной машине — учебник по Windows Azure" metaKeywords="ВМ Azure, создание ВМ Tomcat, настройка ВМ Tomcat" description="Как создать виртуальную машину Windows и настроить машину для использования сервера приложений Apache Tomcat." metaCanonical="" services="virtual-machines" documentationCenter="Java" title="Как использовать сервер приложений Java на виртуальной машине" authors=""  solutions="" writer="waltpo" manager="" editor=""  />



# Использование сервера приложений Java на виртуальной машине

В Windows Azure можно использовать виртуальную машину для обеспечения возможностей сервера. Например, виртуальную машину, работающую в Windows Azure, можно настроить для размещения сервера приложений Java, такого как Apache Tomcat. После изучения этого руководства вы получите представление о том, как создавать виртуальные машины Windows Azure и настраивать их на выполнение сервера приложений Java.

Вы узнаете следующее:

* Как создать виртуальную машину с уже установленным JDK.
* Как удаленно войти в виртуальную машину.
* Как установить сервер приложений Java на виртуальной машине.
* Как создать конечную точку для виртуальной машины.
* Как открыть порт в брандмауэре для сервера приложений.

Для целей этого учебника на виртуальной машине будет установлен сервер приложений Apache Tomcat. В результате будет установлен сервер Tomcat в следующей конфигурации.

![Виртуальная машина с Apache Tomcat][virtual_machine_tomcat]

[WACOM.INCLUDE [create-account-and-vms-note](../includes/create-account-and-vms-note.md)]

## Для создания виртуальной машины

1. Войдите на [портал управления Windows Azure](https://manage.windowsazure.com).
2. Нажмите **Создать**, **Среда выполнения приложений**, **Виртуальная машина**, а затем **Из галереи**.
3. В диалоге **Выбор образа виртуальной машины** выберите **JDK 7 (Предварительная версия) Windows Server 2012**.
Обратите внимание, что вариант **JDK 6 (Предварительная версия) Windows Server 2012** доступен только в случае использования устаревших приложений, которые не готовы к выполнению JDK 7.
4. Нажмите кнопку **Далее**.
5. В диалоговом окне <strong>Конфигурация виртуальной машины</strong>:
    1. Укажите имя виртуальной машины.
    2. Укажите размер виртуальной машины.
    3. Введите имя администратора в поле **Имя пользователя**. Запомните это имя и пароль, которые вы будете вводить далее. Они понадобятся для удаленного входа в виртуальную машину.
    4. Введите пароль в поле **Новый пароль** и повторно введите его в поле **Подтверждение**. Это пароль учетной записи администратора.
    5. Нажмите кнопку **Далее**.
6. В следующем диалоговом окне <strong>Конфигурация виртуальной машины</strong>:
    1. Для **Облачных служб** используйте значение по умолчанию **Создать новую облачную службу**.
    2. Значение поля **DNS-имя облачной службы** должно быть уникальным для cloudapp.net. При необходимости измените это значение, чтобы Windows Azure показывал его уникальность.
    2. Укажите регион, территориальную группу или виртуальную сеть. Для целей данного учебника укажите регион, например **США, запад**.
    2. В поле **Учетная запись хранения** выберите **Использовать автоматически созданную учетную запись хранения**.
    3. В разделе **Группа доступности** выберите **(Нет)**.
    4. Нажмите кнопку **Далее**.
7. В последнем диалоговом окне <strong>Конфигурация виртуальной машины</strong>:
    1. Примите стандартные параметры для конечной точки.
    2. Нажмите **Завершено**.

## Для удаленного входа в виртуальную машину.

1. Выполните вход в [портал управления](https://manage.windowsazure.com).
2. Нажмите **Виртуальные машины**.
3. Нажмите имя виртуальной машины, в которую нужно войти.
4. Щелкните **Подключить**.
5. Отвечайте на запросы, появляющиеся при подключении к виртуальной машине. При получении запроса на ввод имени и пароля администратора используйте значения, которые были указаны при создании виртуальной машины.

## Чтобы установить сервер приложений Java на виртуальной машине

Можно скопировать сервер приложений Java на виртуальную машину или установить сервер приложений Java через программу установки. 

Для целей этого учебника будет установлен Tomcat.

1. Войдя в систему на виртуальной машине, откройте сеанс обозревателя <http://tomcat.apache.org/download-70.cgi>.
2. Дважды щелкните ссылку на **Установщик службы Windows 32-разрядной и 64-разрядной версии**. С использованием этого метода Tomcat будет установлен как служба Windows.
3. При появлении запроса выберите выполнение установщика.
4. В мастере **Установка Apache Tomcat** следуйте указаниям по установке Tomcat. Для целей данного учебника можно принять значения по умолчанию. При появлении диалогового окна **Завершение работы мастера установки Apache Tomcat** можно при необходимости отметить пункт **Запустить Apache Tomcat** для выполнения Tomcat. Для завершения процесса установки Tomcat нажмите кнопку **Готово**.

## Для запуска Tomcat
Если вы не выбрали запуск Tomcat в диалоговом окне **Завершение работы мастера установки Apache Tomcat**, запустите его, открыв окно командной строки на виртуальной машине и выполнив команду **net start Tomcat7**.

Теперь при запуске браузера в виртуальной машине и при открытии <http://localhost:8080> вы должны увидеть, что Tomcat выполняется.

Для просмотра выполнения Tomcat с внешних машин необходимо создать конечную точку и открыть порт.

## Чтобы создать конечную точку для виртуальной машины
1. Выполните вход в [портал управления](https://manage.windowsazure.com).
2. Нажмите **Виртуальные машины**.
3. Щелкните имя виртуальной машины, на которой выполняется сервер приложений Java.
4. Нажмите кнопку **Конечные точки**.
5. Щелкните **Добавить**.
6. В диалоговом окне **Добавить конечную точку** отметьте пункт **Добавить автономную конечную точку** и затем нажмите **Далее**.
7. В диалоговом окне <strong>Сведения о новой конечной точке</strong>:
    1. Укажите имя конечной точки, например **HttpIn**.
    2. Укажите **TCP** для протокола.
    3. Укажите **80** для общего порта.
    4. Укажите **8080** для частного порта.
    5. Чтобы закрыть диалоговое окно, нажмите кнопку **Завершено**. Теперь конечная точка создана.

## Чтобы открыть порт в брандмауэре для виртуальной машины
1. Войдите в виртуальную машину.
2. Нажмите **кнопку "Пуск" в Windows**.
3. Нажмите **Панель управления**.
4. Нажмите кнопку **Система и безопасность**, **Брандмауэр Windows**, а затем нажмите **Расширенные настройки**.
5. Нажмите кнопку **Правила для входящих подключений**, а затем **Создать правило**.

 ![Новое правило для входящего подключения][NewIBRule]

6. При создании нового правила выберите **Порт** для **Типа правила** и нажмите кнопку **Далее**.

 ![Порт нового правила для входящего подключения][NewRulePort]

7. Выберите **TCP** в качестве протокола и укажите **8080** в качестве порта, затем нажмите **Далее**.

 ![Новое правило для входящего подключения ][NewRuleProtocol]

8. Выберите **Разрешить подключение**, а затем щелкните **Далее**.

 ![Действие нового правила для входящего подключения][NewRuleAction]

9. Убедитесь, что в профиле отмечены пункты **Домен**, **Частный** и **Общий**, а затем щелкните **Далее**.

 ![Профиль нового правила для входящего подключения][NewRuleProfile]

10. Укажите имя правила, например **HttpIn** (при этом имя правила не обязательно должно соответствовать имени конечной точки), и нажмите кнопку **Готово**.  

 ![Имя нового правила для входящего подключения][NewRuleName]

С этого момента ваш веб-сайт Tomcat должен быть доступен для просмотра во внешнем браузере с использованием URL формата **http://*your\_DNS\_name*.cloudapp.net**, где ***your\_DNS\_name*** соответствует DNS-имени, указанному при создании виртуальной машины.

## Вопросы, связанные с жизненным циклом приложения
* Можно создать собственный веб-архив приложения (WAR) и добавить его в папку **webapps**. Например, создайте динамический веб-проект базовой страницы службы Java и экспортируйте его как файл WAR, скопируйте WAR-файл в папку Apache Tomcat **webapps** на виртуальной машине и запустите его в браузере.
* По умолчанию при установке службы Tomcat выбирается ручной запуск. Для переключения на автоматический запуск используйте оснастку служб. Запустите оснастку служб, нажав кнопку **"Пуск" в Windows**, **Администрирование**, а затем **Службы**. Чтобы настроить Tomcat на автоматический запуск, дважды щелкните службу **Apache Tomcat** в оснастке служб и для параметра **Тип запуска** выберите значение **Автоматически**, как показано далее.

    ![Настройка службы для автоматического запуска][service_automatic_startup]

    Преимущество автоматического запуска Tomcat заключается в том, что при перезагрузке виртуальной машины (например, после установки обновлений программного обеспечения, требующих перезагрузки компьютера) Tomcat будет снова запущен.

## Дальнейшие действия
* Узнайте о других службах, таких как хранилища Windows Azure, Service Bus, база данных SQL и т. д., которые можно включить в приложения Java, изучив информацию в <http://www.windowsazure.com/ru-ru/develop/java/>.

[virtual_machine_tomcat]: ./media/virtual-machines-java-run-tomcat-application-server/WA_VirtualMachineRunningApacheTomcat.png

[service_automatic_startup]: ./media/virtual-machines-java-run-tomcat-application-server/WA_TomcatServiceAutomaticStart.png









[NewIBRule]: ./media/virtual-machines-java-run-tomcat-application-server/NewInboundRule.png
[NewRulePort]: ./media/virtual-machines-java-run-tomcat-application-server/NewRulePort.png
[NewRuleProtocol]: ./media/virtual-machines-java-run-tomcat-application-server/NewRuleProtocol.png
[NewRuleAction]: ./media/virtual-machines-java-run-tomcat-application-server/NewRuleAction.png
[NewRuleName]: ./media/virtual-machines-java-run-tomcat-application-server/NewRuleName.png
[NewRuleProfile]: ./media/virtual-machines-java-run-tomcat-application-server/NewRuleProfile.png

