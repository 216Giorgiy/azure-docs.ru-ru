<properties 
	pageTitle="Основные понятия служб мультимедиа Azure" 
	description="В этом разделе приводится обзор понятий служб мультимедиа Azure" 
	services="media-services" 
	documentationCenter="" 
	authors="juliako" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="media-services" 
	ms.workload="media" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="03/02/2015"
	ms.author="juliako"/>

#Основные понятия служб мультимедиа Azure 

В этом разделе приводится обзор наиболее важных понятий служб мультимедиа.

##<a id="assets"></a>Ресурсы, хранилища

###Активы

Сущность [Ресурс](https://msdn.microsoft.com/library/azure/hh974277.aspx) содержит цифровые файлы (в том числе видео, аудио, изображения, коллекции эскизов, текстовые дорожки и файлы титров), а также метаданные об этих файлах. После загрузки цифровых файлов в ресурс их можно использовать в рабочих процессах кодирования и потоковой передачи служб мультимедиа.

Ресурс сопоставлен с контейнером больших двоичных объектов в учетной записи хранилища Azure, а файлы в ресурсе сохранены как большие двоичные объекты в этом контейнере.

При выборе содержимого мультимедиа для отправки и хранения в активе можно руководствоваться следующими соображениями.

- Актив должен содержать только один уникальный экземпляр содержимого мультимедиа. Например, одно изменение серии телепередачи, фильма или рекламы.
- Актив не должен содержать несколько представлений или изменений аудиовизуального файла. Один из примеров неправильного использования актива - попытка сохранить более одной серии телепередачи, рекламы или несколько расположений камеры из одной рабочей среды в активе. Сохранение нескольких представлений или изменений аудиовизуального файла может привести к проблемам при отправке заданий кодирования, потоковой передаче и защите доставки актива позже в рабочем процессе.  

###Файл ресурса 
[AssetFile](https://msdn.microsoft.com/library/azure/hh974275.aspx) представляет собой фактический массив видео или аудио, хранящийся в контейнере больших двоичных объектов. Файл ресурса всегда связан с ресурсом, а ресурс может содержать один или несколько файлов. Задача кодировщика служб мультимедиа завершится с ошибкой, если объект файла ресурса не связан с цифровым файлом в контейнере больших двоичных объектов.

Экземпляр **AssetFile** и фактический файл мультимедиа - это два разных объекта. Экземпляр AssetFile содержит метаданные о файле мультимедиа, а сам файл мультимедиа - фактическое мультимедийное содержимое.

Не следует пытаться изменить содержимое контейнеров BLOB-объектов, созданных службами Media Services, без использования API служб Media Services.

###Параметры шифрования ресурсов

В зависимости от типа содержимого, которое нужно отправить, службы мультимедиа предоставляют разные варианты шифрования.

**None** - шифрование не используется. Это значение по умолчанию. Обратите внимание, что при использовании этого параметра содержимое не защищено при передаче или в хранилище.

Если вы планируете доставить MP4-файл с помощью прогрессивного скачивания, используйте этот параметр для отправки содержимого.

**StorageEncrypted** - используйте этот параметр, чтобы зашифровать содержимое локально с использованием 256-битного шифрования AES, а затем передать его в хранилище Azure, где оно хранится в зашифрованном виде. Ресурсы, защищенные с помощью шифрования хранилища, автоматически расшифровываются и помещаются в систему зашифрованных файлов до кодирования и при необходимости повторно шифруются до отправки в виде нового выходного ресурса. Основная причина использования шифрования хранилища - необходимость защитить входные файлы мультимедиа высокого качества с помощью стойкого шифрования при хранении на диске. 

Для выполнения потоковой трансляции зашифрованного актива хранилища необходимо использовать динамическое шифрование и настроить политику доставки ресурса, чтобы службы мультимедиа получили информацию о способе доставки контента. Перед началом потоковой передачи ресурса сервер потоковой передачи удаляет шифрование хранилища и выполняет потоковую передачу содержимого с использованием определенной политики доставки. 

**CommonEncryption** - используйте этот параметр, если отправляете содержимое, которое уже зашифровано и защищено с помощью обычного шифрования или PlayReady DRM (например, Smooth Streaming с защитой PlayReady DRM).

**EnvelopeEncrypted** - используйте этот параметр, если требуется защитить (или передать уже защищенный) поток HTTP Live Streaming (HLS), зашифрованный с помощью Advanced Encryption Standard (AES). Обратите внимание, что при передаче HLS уже с шифрованием AES, он должен был зашифрован с помощью Transform Manager.

###Политика доступа 

Сущность [AccessPolicy](https://msdn.microsoft.com/library/azure/hh974297.aspx) определяет разрешения (например, на чтение, запись и создание списков) и длительность доступа к ресурсу. Обычно объект AccessPolicy следует передавать в указатель, который затем будет использоваться для доступа к файлам, содержащимся в ресурсе.


###Контейнер BLOB-объектов

Контейнер BLOB-объектов обеспечивает группирование набора BLOB-объектов. Контейнеры BLOB-объектов используются в службах мультимедиа в качестве граничной точки для управления доступом и как указатели на подписанный URL-адрес (SAS) в ресурсах. Учетная запись хранилища Azure может содержать неограниченное количество контейнеров BLOB-объектов. Контейнер может хранить неограниченное количество больших двоичных объектов.

>[AZURE.NOTE]Не следует пытаться изменить содержимое контейнеров BLOB-объектов, созданных службами Media Services, без использования API служб Media Services.

###<a id="locators"></a>Указатели

[Указатели](https://msdn.microsoft.com/library/azure/hh974308.aspx) предоставляют точку входа для доступа к файлам, содержащимся в ресурсе. Политика доступа используется для определения разрешений и длительности доступа клиента к определенному активу. Указатели могут иметь множество или одну связь с политикой доступа таким образом, чтобы разные указатели могли обеспечивать разное время запуска и типы подключения к различным клиентам с использованием одних параметров разрешения и длительности. Однако из-за ограничений общей политики доступа, установленных службами хранилища Azure, невозможно одновременно связать с определенным активом более пяти указателей. 

Службы мультимедиа поддерживают два типа указателей: Указатели OnDemandOrigin, используемые для потоковой передачи мультимедиа (например, MPEG DASH, HLS или Smooth Streaming) или последовательной загрузки мультимедиа и указатели URL-адрес, используемые для отправки или загрузки файлов мультимедиа в или из хранилища Azure. 

Обратите внимание, что разрешение списка (AccessPermissions.List) не следует использовать при создании указателя OrDemandOrigin. 

###Учетная запись хранения

Весь доступ к хранилищу Azure осуществляется с помощью учетной записи хранения. Учетную запись служб мультимедиа можно связать с одной или несколькими учетными записями хранения. Учетная запись может содержать неограниченное количество контейнеров, пока их общий размер составляет менее 500 ТБ на учетную запись хранения.  Службы мультимедиа обеспечивают средства уровня SDK, позволяющие управлять несколькими учетными записями хранения и распределять нагрузку распределения активов во время отправки в эти учетные записи на основе метрик или случайного распределения. Дополнительные сведения см. в разделе [Служба хранилища Azure](https://msdn.microsoft.com/library/azure/dn767951.aspx). 

##Задания и задачи

Объект [Задание](https://msdn.microsoft.com/library/azure/hh974289.aspx) обычно используется для обработки (например, индексирования или кодирования) одного аудио-видео представления. При обработке нескольких видео необходимо создать задание для перекодировки каждого.

Задание включает метаданные о порядке обработки, которую необходимо выполнить. Каждое задание содержит одну или несколько [задач](https://msdn.microsoft.com/library/azure/hh974286.aspx), которые задают неделимую задачу обработки, ее входные ресурсы, выходные ресурсы, обработчик мультимедиа и связанные с ним параметры. Задачи в задании можно соединять между собой в цепочки, в которых выходной ресурс одной задачи является входным ресурсом следующей. Таким образом одно задание может содержать все обработки, необходимые для представления мультимедиа.

##<a id="encoding"></a>Кодирование и упаковка

###Кодирование

Для поставки цифрового видео по Интернету необходимо сжать мультимедиа. Цифровые видеофайлы довольно объемные. Это затрудняет их доставку через Интернет и влияет на качество их отображения на устройствах клиентов. Пользователи смотрят видео на разных устройствах: от телевизоров с абонентской приставкой, настольных компьютеров до планшетов и смартфонов. У каждого из этих устройств разная пропускная способность и требования к сжатию. Кодирование - это процесс сжатия видео и аудио с помощью программ сжатия и распаковки или кодеков. 

Перекодировка - это процесс, когда закодированный видеофайл перекодируется в другой формат. Так как большинство видеокамер кодирует видео в определенной степени, большая часть работы, которая осуществляется в службах мультимедиа Azure, технически является перекодированием.

###Кодеки и форматы файлов 

Кодеки имеют два компонента: один для сжатия цифровых файлов мультимедиа для передачи, а другой для распаковки цифровых файлов мультимедиа для воспроизведения. Аудиокодеки сжимают и распаковывают аудио, а видеокодеки сжимают и распаковывают видео. Кодеки могут использовать сжатие без потерь или сжатие с потерями. Кодеки со сжатием без потерь сохраняют все сведения при сжатии. Распакованный файл идентичен входному файлу мультимедиа, поэтому кодеки со сжатием без потерь хорошо подходят для архивирования и хранения. Кодеки со сжатием с потерями теряют часть сведений при кодировании, уменьшая файл (по сравнению с исходным) за счет качества. Они хорошо подходят для потоковой передачи через Интернет. В кодировщике служб мультимедиа для кодирования используются два основных кодека: H.264 и VC-1. Другие кодеки доступны в нашей партнерской экосистеме кодировщиков. 

###Кодировщики служб мультимедиа

Сведения о поддерживаемых кодировщиках см. в разделе [Кодировщики](../media-services-encode-asset).


##Live Streaming

###Динамический транскодер

Динамический кодировщик (или транскодер) преобразует аудио- и (или) видеоданные, транслируемые с вашей видеокамеры, в формат RTMP или Smooth Streaming с разными скоростями. Транскодер помещает потоки адаптивной скорости RTMP или Smooth Stream в канал служб мультимедиа. После этого службы мультимедиа выполняют трансляцию события.

###Канал

В службах мультимедиа [каналы](https://msdn.microsoft.com/library/azure/dn783458.aspx) отвечают за обработку обновляющегося контента потоковой трансляции. Канал предоставляет входную конечную точку, которая затем передается динамическому кодировщику. Канал получает входные потоковые трансляции от кодировщика и предоставляет их для потоковой передачи по одной или нескольким StreamingEndpoint. Каналы также предоставляют конечную точку предварительного просмотра (URL-адрес предварительного просмотра), используемого для предварительного просмотра и проверки вашего потока перед дальнейшей обработкой и доставкой.

URL-адрес приема и URL-адрес предварительного просмотра можно получить при создании канала. Получить эти URL-адреса можно только тогда, когда канал не запущен. Когда все готово для начала передачи данных из динамического транскодера в канал, канал должен быть запущен. После запуска приема данных динамического транскодера можно выполнить предварительный просмотр потока.

###Программа 

[Программа](https://msdn.microsoft.com/library/azure/dn783463.aspx) позволяет управлять публикацией и хранением сегментов в динамическом потоке. Каналы управляют программами. Отношение между каналом и программой очень похоже на традиционные мультимедиа, где канал передает постоянный поток контента, а программа ограничена временным событием на этом канале.
Можно указать количество часов, в течение которого записанный контент должен сохраняться для программы, установив свойство **ArchiveWindowLength**. Это значение может быть задано в диапазоне от 5 минут до 25 часов. 

Оно также указывает максимальное время, на которое клиенты могут вернуться назад от текущей позиции. Программы могут выходить за указанный промежуток времени, но содержимое за пределами этого промежутка постоянно удаляется. Значение этого свойства также определяет, насколько могут увеличиваться в объеме клиентские манифесты.

Каждая программа связана с ресурсом. Чтобы опубликовать программу, необходимо создать указатель для связанного ресурса. Наличие этого указателя позволит создать URL-адрес потоковой передачи, который можно предоставить клиентам.
Канал поддерживает до трех одновременных программ, за счет чего можно создавать несколько архивов с использованием одного и того же входящего потока. Это позволяет публиковать и архивировать разные части события по необходимости. Например ваш бизнес-требование - архивировать 6 часов программы, но для передачи только оставить последние 10 минут. Для этого необходимо создать две параллельно выполняющиеся программы. Одна программа имеет значение для архивирования 6 часов с момента события, но эта программа не публикуются. Другая программа устанавливается для архивирования на 10 минут и публикации этой программы.

##Защита содержимого

###Динамическое шифрование

Службы мультимедиа Microsoft Azure позволяют обеспечивать доставку содержимого с динамическим шифрованием с помощью AES (с использованием 128-разрядных ключей шифрования) и PlayReady DRM. 

В настоящее время поддерживается шифрование для следующих форматов потоковой передачи: HLS, MPEG DASH и Smooth Streaming. Шифрование формата потоковой передачи HDS и последовательных скачиваний не поддерживается.

Если требуется, чтобы службы мультимедиа зашифровали ресурс, необходимо связать с этим ресурсом ключ шифрования (CommonEncryption или EnvelopeEncryption), а также настроить политики проверки подлинности для ключа.

Необходимо также настроить политику доставки ресурса. Если вы хотите передавать в потоке зашифрованный ресурс хранилища, убедитесь в том был указан способ доставки путем настройки политики доставки ресурсов.  

Когда поток запрашивается проигрыватель, службы мультимедиа используют указанный ключ для динамического шифрования содержимого с помощью шифрования AES или PlayReady. Чтобы расшифровать поток, проигрыватель запросит ключ у службы доставки ключей. Чтобы определить, есть ли у пользователя право на получение ключа, служба оценивает политики авторизации, заданные для ключа.

###Службы доставки лицензий PlayReady DRM и сброшенных ключей AES

Службы мультимедиа предоставляют службы доставки лицензий PlayReady DRM и сброшенных ключей AES клиентам, которые прошли проверку подлинности. Для настройки политики авторизации и проверки подлинности для лицензий и ключей можно использовать портал управления Azure, API-интерфейс REST или пакет SDK служб мультимедиа для .NET.

Обратите внимание, при использовании портала можно настроить одну политику AES (которая будет применяться ко всему содержимому, зашифрованному AES) и одну политику PlayReady (которая будет применяться ко всему содержимому, зашифрованному PlayReady). Если требуется больший контроль над конфигурацией, используйте пакет SDK служб мультимедиа для .NET.

###Шаблон лицензии PlayReady

Службы мультимедиа предоставляют службу доставки лицензий Microsoft PlayReady. При попытке проигрывателя конечного пользователя (например, Silverlight) воспроизвести контент, защищенный с помощью PlayReady, в службу доставки лицензий отправляется запрос на получение лицензии. Если служба лицензий утверждает запрос, она выдает лицензию, которая отправляется клиенту и может быть использована для расшифровки и воспроизведения указанного контента.

Лицензии содержат права и ограничения, которые среда выполнения PlayReady DRM принудительно применяет, когда пользователь пытается воспроизвести защищенный контент. Службы мультимедиа также предоставляют API, которые позволяют настроить лицензии PlayReady. Дополнительные сведения см. в разделе [Обзор шаблона лицензий PlayReady для служб мультимедиа](https://msdn.microsoft.com/library/azure/dn783459.aspx).

###Ограничение "по маркеру"

Политики авторизации ключа содержимого могут иметь одно или несколько ограничений проверки подлинности: открытый, ограничение по маркеру или ограничение по IP-адресу. При ограничении по маркеру к политике должен прилагаться маркер, выданный службой маркеров безопасности (STS). Службы мультимедиа поддерживают маркеры в формате простого веб-маркера (SWT) и формате веб-маркера JSON (JWT). Службы мультимедиа не предоставляют службы маркеров безопасности. Для выдачи маркеров можно создать пользовательскую службу STS или использовать службу Microsoft Azure ACS. Чтобы создать маркер, подписанный указанным ключом, и получить утверждения, указанные в конфигурации ограничения по маркерам, должна быть настроена служба маркеров безопасности. Служба доставки ключей служб мультимедиа возвращает клиенту запрошенный ключ (или лицензию), если маркер является допустимым и утверждения маркера соответствуют утверждениям, настроенным для ключа (или лицензии).
При настройке политики ограничения по маркеру необходимо задать такие параметры, как основной ключ проверки, издатель и аудитория. Основной ключ проверки содержит ключ, которым подписан маркер, а издатель - это служба маркеров безопасности, которая выдает маркер. Аудитория (иногда называется областью) описывает назначение маркера или ресурс, доступ к которому обеспечивает маркер. Служба доставки ключей служб мультимедиа проверяет, соответствуют ли эти значения в маркере значениям в шаблоне.

##Доставка содержимого

###<a id="dynamic_packaging"></a>Динамическая упаковка

Рекомендуется всегда кодировать мезонинные файлы в набор MP4 с адаптивной скоростью, а затем преобразовать их в нужный формат с помощью [динамической упаковки](https://msdn.microsoft.com/library/azure/jj889436.aspx). 


###Конечная точка потоковой трансляции

StreamingEndpoint представляет собой службу потоковой трансляции, способную передавать контент непосредственно в приложение проигрывателя клиента или в сеть доставки содержимого для дальнейшего распределения. Исходящий поток из службы StreamingEndpoint может быть потоком трансляции или активом видео по запросу в учетной записи служб мультимедиа. Кроме того, вы можете управлять емкостью службы StreamingEndpoint для обработки растущих требований к пропускной способности, изменив единицы масштабирования (также известные как единицы потоковой передачи). Рекомендуем выделить одну или несколько единиц масштабирования для приложения в рабочей среде. Единицы масштабирования предоставляют как выделенные мощности исходящего трафика, которые могут быть приобретены с шагом 200 Мбит/с, так и дополнительную функциональность, которая в настоящее время включает возможности динамической упаковки. 

Если планируется использовать динамическую упаковку и (или) динамическое шифрование, то нужна хотя бы одна единица потоковой трансляции для конечной точки, из которой планируется организовать потоковую трансляции. Дополнительную информацию см. в разделе [Масштабирование единиц потоковой трансляции](../media-services-manage-origins#scale_streaming_endpoints).

###Политика доставки ресурсов

Одним из шагов в процессе доставки содержимого службами мультимедиа является настройка [политик доставки для ресурсов](https://msdn.microsoft.com/library/azure/dn799055.aspx), которые необходимо транслировать. Политика доставки ресурсов сообщает службам мультимедиа способ доставки ресурса: какие протоколы передачи следует использовать для динамической упаковки ресурса (например, MPEG DASH, HLS, Smooth Streaming или все), следует ли использовать динамическое шифрование и как (конвертное или общее шифрование).

Перед началом потоковой передачи ресурса сервер потоковой передачи удаляет шифрование хранилища и выполняет потоковую передачу контента с использованием определенной политики доставки. Например, чтобы доставить ресурс, зашифрованный с помощью ключа шифрования AES, установите тип политики DynamicEnvelopeEncryption. Чтобы удалить шифрование хранилища и выполнить незашифрованную потоковую передачу ресурса, установите тип политики NoDynamicEncryption. 

###Прогрессивное скачивание 

Прогрессивное скачивание позволяет начать воспроизведение мультимедиа до окончания скачивания всего файла. Допускается только прогрессивное скачивание MP4-файла. 

Обратите внимание, что зашифрованные ресурсы необходимо расшифровать, если он должны быть доступны для прогрессивного скачивания. 

Чтобы предоставить пользователям URL-адреса прогрессивного скачивания, сначала необходимо создать указатель OnDemandOrigin. При создании указателя будет получен базовый путь к ресурсу. К нему нужно будет добавить имя MP4-файла. Например:

	http://amstest1.streaming.mediaservices.windows.net/3c5fe676-199c-4620-9b03-ba014900f214/BigBuckBunny_H264_650kbps_AAC_und_ch2_96kbps.mp4

###URL-адреса потоковой передачи

Потоковая передача контента клиентам Чтобы предоставить пользователям URL-адреса потоковой передачи, сначала необходимо создать указатель OnDemandOrigin. При создании указателя вы получите базовое значение Path для ресурса, который содержит контент для потоковой передачи. Однако, чтобы получить возможность потоковой передачи контента, необходимо изменить этот путь. Чтобы создать полный URL-адрес к файлу манифеста потоковой передачи, необходимо соединить значение Path указателя и имя файла манифеста (filename.ism). Затем добавьте /Manifest и соответствующий формат (если нужно) в путь указателя источника. 

Также по SSL-соединению можно выполнять потоковую передачу содержимого. Для этого убедитесь, что URL-адреса потоковой передачи начинаются с HTTPS.

Обратите внимание, что потоковую передачу через SSL-соединение можно выполнять, только если конечная точка потоковой передачи, из которой получено содержимое, была создана после 10 сентября 2014 г. Если URL-адреса потоковой передачи основаны на конечных точках потоковой передачи, созданных после 10 сентября, URL-адрес содержит "streaming.mediaservices.windows.net" (новый формат). URL-адреса потоковой передачи, который содержат "origin.mediaservices.windows.net" (старый формат), не поддерживают SSL. Если URL-адрес имеет старый формат и необходимо организовать передачу через SSL, нужно создать новую конечную точку. Используйте URL-адреса, созданные на основе новой конечной точки потоковой передачи, для потоковой передачи содержимого по SSL. 

В следующем списке описываются различные форматы потоковой передачи и приведены примеры:

- Smooth Streaming

	{имя конечной точки потоковой передачи - имя учетной записи служб мультимедиа}.streaming.mediaservices.windows.net/{идентификатор указателя}/{имя файла}.ism/Manifest
		
		http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest


- MPEG DASH

	{имя конечной точки потоковой передачи - имя учетной записи служб мультимедиа}.streaming.mediaservices.windows.net/{идентификатор указателя}/{имя файла}.ism/Manifest(format=mpd-time-csf)
 
		http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=mpd-time-csf)



- Apple HTTP Live Streaming (HLS) V4

	{имя конечной точки потоковой передачи - имя учетной записи служб мультимедиа}.streaming.mediaservices.windows.net/{идентификатор указателя}/{имя файла}.ism/Manifest(format=m3u8-aapl)

		http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=m3u8-aapl)



- Apple HTTP Live Streaming (HLS) V3

	{имя конечной точки потоковой передачи - имя учетной записи служб мультимедиа}.streaming.mediaservices.windows.net/{идентификатор указателя}/{имя файла}.ism/Manifest(format=m3u8-aapl-v3)

		http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=m3u8-aapl-v3)

- HDS (только для пользователей с лицензией Adobe PrimeTime/Access)

	{имя конечной точки потоковой передачи - имя учетной записи служб мультимедиа}.streaming.mediaservices.windows.net/{идентификатор указателя}/{имя файла}.ism/Manifest(format=f4m-f4f)

		http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=f4m-f4f) 


<!--HONumber=47-->
