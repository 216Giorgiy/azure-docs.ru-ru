---
title: "Создание назначения политики для идентификации ресурсов, которые не соответствуют требованиям, в среде Azure с помощью PowerShell | Документация Майкрософт"
description: "Использование PowerShell для создания назначения в службе \"Политика Azure\", позволяющего определить ресурсы, которые не соответствуют требованиям."
services: azure-policy
keywords: 
author: bandersmsft
ms.author: banders
ms.date: 1/17/2018
ms.topic: quickstart
ms.service: azure-policy
ms.custom: mvc
ms.openlocfilehash: 67c779b96dab088d810d22ad3053ade106aec56a
ms.sourcegitcommit: f1c1789f2f2502d683afaf5a2f46cc548c0dea50
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/18/2018
---
# <a name="create-a-policy-assignment-to-identify-non-compliant-resources-in-your-azure-environment-using-powershell"></a>Создание назначения политики для идентификации ресурсов, которые не соответствуют требованиям, в среде Azure с помощью PowerShell

Чтобы понять, соответствуют ли ресурсы требованиям в Azure, прежде всего нужно определить их состояние. В этом кратком руководстве описывается поэтапный процесс создания назначения политики для выявления виртуальных машин, которые не используют управляемые диски.

Этот процесс позволит вам определить, какие виртуальные машины не используют управляемые диски. Они *не соответствуют* назначению политики.

PowerShell используется для создания ресурсов Azure и управления ими из командной строки или с помощью скриптов. В этом руководстве подробно описано использование PowerShell для создания назначения политики, которое позволяет выявить в среде Azure ресурсы, не соответствующие требованиям.

Для работы с этим руководством требуется модуль Azure PowerShell 4.0 или более поздней версии. Чтобы узнать версию, выполните команду  `Get-Module -ListAvailable AzureRM` . Если вам необходимо выполнить установку или обновление, см. статью [об установке модуля Azure PowerShell](/powershell/azure/install-azurerm-ps).

Перед началом работы убедитесь, что установлена последняя версия PowerShell. Дополнительные сведения см. в статье [Общие сведения об Azure PowerShell](/powershell/azureps-cmdlets-docs).

Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.


## <a name="create-a-policy-assignment"></a>Создание назначения политики

В этом кратком руководстве вы создадите назначение политики и назначите определение *Audit Virtual Machines without Managed Disks*. Это определение политики идентифицирует ресурсы, которые не соответствуют условиям, заданным в определении политики.

Чтобы создать назначение политики, следуйте инструкциям ниже.

1. Зарегистрируйте поставщик ресурсов Policy Insights, чтобы связать подписку с поставщиком ресурсов. Чтобы зарегистрировать поставщик ресурсов, необходимо иметь разрешение на действие регистрации для поставщика ресурсов. Эта операция включается в роли участника и владельца.

    Выполните указанную ниже команду для регистрации поставщика ресурсов.

    ```
Register-AzureRmResourceProvider -ProviderNamespace Microsoft.PolicyInsights
```

    Невозможно отменить регистрацию поставщика ресурсов, так как в подписке содержатся связанные с ним типы ресурсов.

    Дополнительные сведения о регистрации и просмотре поставщиков ресурсов см. в статье [Поставщики и типы ресурсов](../azure-resource-manager/resource-manager-supported-services.md).

2. Зарегистрировав поставщика ресурсов, выполните указанную ниже команду, чтобы просмотреть все определения политик и выбрать то, которое нужно назначить.

    ```powershell
$definition = Get-AzureRmPolicyDefinition
```

    Служба "Политика Azure" поставляется с готовыми встроенными определениями политик, которые можно использовать. Примеры встроенных определений политик:

    - принудительно применять тег и его значение;
    - применять тег и его значение;
    - требовать наличия SQL Server версии 12.0.

3. Теперь примените определение политики к требуемой области с помощью командлета `New-AzureRmPolicyAssignment`.

В этом руководстве используйте для этой команды следующие сведения:

- Отображаемое имя (**Name**) назначения политики. В этом случае используйте Audit Virtual Machines without Managed Disks.
- Определение политики (**Policy**), на основе которой вы создаете назначение. В данном случае это определение политики — *Audit Virtual Machines without Managed Disks*.
- Область (**Scope**) определяет, к каким ресурсам или группе ресурсов принудительно применяется назначение политики. Политика может назначаться разным ресурсам: от подписки до групп ресурсов. В этом примере вы назначаете определение политики группе ресурсов **FabrikamOMS**.
- **$definition**. Нужно указать идентификатор ресурса для определения политики. Здесь вы будете использовать для определения политики идентификатор *Audit Virtual Machines without Managed Disks*.

```powershell
$rg = Get-AzureRmResourceGroup -Name "FabrikamOMS"
$definition = Get-AzureRmPolicyDefinition -Id /providers/Microsoft.Authorization/policyDefinitions/e5662a6-4747-49cd-b67b-bf8b01975c4c
New-AzureRMPolicyAssignment -Name Audit Virtual Machines without Managed Disks Assignment -Scope $rg.ResourceId -PolicyDefinition $definition
```

Теперь все готово к выявлению ресурсов, которые не соответствуют требованиям, что позволит оценить состояние соответствия в среде.

## <a name="identify-non-compliant-resources"></a>Выявление несоответствующих ресурсов

1. Вернитесь к целевой странице службы "Политика Azure".
2. Выберите **Соответствие** в области слева и выполните поиск созданного **назначения политики**.

   ![Соответствие политике](media/assign-policy-definition/policy-compliance.png)

   Имеющиеся ресурсы, которые не соответствуют новому назначению, отображаются на вкладке **Non-compliant resources** (Несоответствующие ресурсы).

## <a name="clean-up-resources"></a>Очистка ресурсов

Остальные руководства из этой серии являются продолжением этого документа. Если вы намерены переходить к ним, не удаляйте ресурсы, которые создали при работе с этим руководством. В противном случае удалите созданное назначение, выполнив следующую команду:

```powershell
Remove-AzureRmPolicyAssignment -Name “Audit Virtual Machines without Managed Disks Assignment” -Scope /subscriptions/ bc75htn-a0fhsi-349b-56gh-4fghti-f84852/resourceGroups/FabrikamOMS
```

## <a name="next-steps"></a>Дополнительная информация

В этом кратком руководстве вы назначили определение политики для идентификации ресурсов, не соответствующих требованиям, в среде Azure.

Следующее руководство серии предоставит сведения о назначении политик, обеспечивающих соответствие требованиям для **новых ресурсов**:

> [!div class="nextstepaction"]
> [Создание политик и управление ими](./create-manage-policy.md)
