---
title: "Создание назначения политики для идентификации ресурсов, которые не соответствуют требованиям, в среде Azure с помощью PowerShell | Документация Майкрософт"
description: "Использование PowerShell для создания назначения в службе \"Политика Azure\", позволяющего определить ресурсы, которые не соответствуют требованиям."
services: azure-policy
keywords: 
author: Jim-Parker
ms.author: jimpark
ms.date: 11/02/2017
ms.topic: quickstart
ms.service: azure-policy
ms.custom: mvc
ms.openlocfilehash: 02afe946e5e1ad9730ab07df19676e90485ecf98
ms.sourcegitcommit: 3df3fcec9ac9e56a3f5282f6c65e5a9bc1b5ba22
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2017
---
# <a name="create-a-policy-assignment-to-identify-non-compliant-resources-in-your-azure-environment-using-powershell"></a>Создание назначения политики для идентификации ресурсов, которые не соответствуют требованиям, в среде Azure с помощью PowerShell

Чтобы выяснить соответствие требованиям в Azure, нужно определить состояние текущих ресурсов. В этом кратком руководстве описывается поэтапный процесс создания назначения политики для выявления виртуальных машин, которые не используют управляемые диски.

Этот процесс позволит вам определить, какие виртуальные машины не используют управляемые диски, то есть *не соответствуют требованиям*.


PowerShell используется для создания ресурсов Azure и управления ими из командной строки или с помощью скриптов. В этом руководстве подробно описано использование PowerShell для создания назначения политики, которое позволяет выявить в среде Azure ресурсы, не соответствующие требованиям.

Для работы с этим руководством требуется модуль Azure PowerShell 4.0 или более поздней версии. Чтобы узнать версию, выполните команду  ```Get-Module -ListAvailable AzureRM``` . Если вам необходимо выполнить установку или обновление, см. статью [об установке модуля Azure PowerShell](/powershell/azure/install-azurerm-ps).

Перед началом работы убедитесь, что установлена последняя версия PowerShell. Дополнительные сведения можно узнать в статье [Установка и настройка Azure PowerShell](/powershell/azureps-cmdlets-docs).

Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.

## <a name="opt-in-to-azure-policy"></a>Регистрация в службе "Политика Azure"

Сейчас служба "Политика Azure"находится на этапе общедоступной предварительной версии, поэтому вам необходимо зарегистрироваться, чтобы запросить доступ к ней.

1. Перейдите к службе "Политика Azure" по адресу https://aka.ms/getpolicy, а затем выберите **Зарегистрироваться** в области слева.

   ![Поиск политики](media/assign-policy-definition/sign-up.png)

2. Зарегистрируйтесь для использования службы "Политика Azure", выбрав подписки, с которыми хотите работать, в списке **Подписка**. Затем щелкните **Регистрация**.

   ![Регистрация для использования службы "Политика Azure"](media/assign-policy-definition/preview-opt-in.png)

   Ваш запрос будет автоматически утвержден для использования предварительной версии. Подождите до 30 минут, пока система обработает вашу регистрацию.

## <a name="create-a-policy-assignment"></a>Создание назначения политики

В этом кратком руководстве мы создаем назначение политики и назначаем определение *Audit Virtual Machines without Managed Disks*. Это определение политики будет выявлять ресурсы, которые не соответствуют заданным в нем условиям.

Чтобы создать назначение политики, следуйте инструкциям ниже.

Чтобы просмотреть все определения политик и выбрать то, которое нужно назначить, выполните следующую команду:

```powershell
$definition = Get-AzureRmPolicyDefinition
```

Служба "Политика Azure" поставляется с готовыми встроенными определениями политик, которые можно использовать. Примеры встроенных определений политик:

- принудительно применять тег и его значение;
- применять тег и его значение;
- требовать наличия SQL Server версии 12.0.

Теперь примените определение политики к требуемой области с помощью командлета `New-AzureRmPolicyAssignment`.

В этом руководстве мы предоставим для этой команды следующие сведения:
- Отображаемое имя (**Name**) назначения политики. В этом случае используем "Audit Virtual Machines without Managed Disks".
- Определение политики (**Policy**), на основе которой вы создаете назначение. В данном случае это определение политики — *Audit Virtual Machines without Managed Disks*.
- Область (**Scope**) определяет, к каким ресурсам или группе ресурсов принудительно применяется назначение политики. Политика может назначаться разным ресурсам: от подписки до групп ресурсов. В этом примере мы назначаем определение политики группе ресурсов **FabrikamOMS**.
- **$definition**. Нужно указать идентификатор ресурса для определения политики. Здесь мы используем для определения политики идентификатор *Audit Virtual Machines without Managed Disks*.

```powershell
$rg = Get-AzureRmResourceGroup -Name "FabrikamOMS"
$definition = Get-AzureRmPolicyDefinition -Id /providers/Microsoft.Authorization/policyDefinitions/e5662a6-4747-49cd-b67b-bf8b01975c4c
New-AzureRMPolicyAssignment -Name Audit Virtual Machines without Managed Disks Assignment -Scope $rg.ResourceId -PolicyDefinition $definition
```

Теперь все готово к выявлению ресурсов, которые не соответствуют требованиям, что позволит оценить состояние соответствия в среде.

## <a name="identify-non-compliant-resources"></a>Выявление несоответствующих ресурсов

1. Вернитесь к целевой странице службы "Политика Azure".
2. Выберите **Соответствие** в области слева и выполните поиск созданного **назначения политики**.

   ![Соответствие политике](media/assign-policy-definition/policy-compliance.png)

   Существующие ресурсы, которые не соответствуют новому назначению, отображаются на вкладке **Non-compliant resources** (Несоответствующие ресурсы), как показано выше.

## <a name="clean-up-resources"></a>Очистка ресурсов

Остальные руководства из этой серии являются продолжением этого документа. Если вы намерены переходить к ним, не удаляйте ресурсы, которые создали при работе с этим руководством. В противном случае удалите созданное назначение, выполнив следующую команду:

```powershell
Remove-AzureRmPolicyAssignment -Name “Audit Virtual Machines without Managed Disks Assignment” -Scope /subscriptions/ bc75htn-a0fhsi-349b-56gh-4fghti-f84852/resourceGroups/FabrikamOMS
```

## <a name="next-steps"></a>Дальнейшие действия

В этом кратком руководстве вы назначили определение политики для идентификации ресурсов, которые не соответствуют требованиям, в среде Azure.

Следующее руководство серии предоставит сведения о назначении политик, обеспечивающих соответствие требованиям для **новых ресурсов**:

> [!div class="nextstepaction"]
> [Создание политик и управление ими](./create-manage-policy.md)
