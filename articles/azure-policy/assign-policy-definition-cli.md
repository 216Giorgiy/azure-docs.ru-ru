---
title: "Создание назначения политики с помощью Azure CLI для идентификации ресурсов, не соответствующих требованиям, в среде Azure | Документация Майкрософт"
description: "Использование PowerShell для создания назначения политики Azure для идентификации несоответствующих ресурсов."
services: azure-policy
keywords: 
author: Jim-Parker
ms.author: jimpark
ms.date: 10/06/2017
ms.topic: quickstart
ms.service: azure-policy
ms.custom: mvc
ms.openlocfilehash: 92b532691986e72eca68d9bc3033e20ff8ffef3b
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="create-a-policy-assignment-to-identify-non-compliant-resources-in-your-azure-environment-with-the-azure-cli"></a>Создание назначения политики для идентификации ресурсов, не соответствующих требованиям, в среде Azure с помощью Azure CLI | Документация Майкрософт

Первый шаг к пониманию соответствия требованиям в Azure — определить состояние текущих ресурсов. В этом кратком руководства описывается поэтапный процесс создания назначения политики для идентификации ресурсов, несоответствующих определению политики. *Требуется наличие SQL Server версии 12.0*. В итоге вы определите, какие серверы имеют несоответствующую требованиям версию.

Azure CLI используется для создания ресурсов Azure и управления ими из командной строки или с помощью скриптов. В этом руководстве подробно описано использование Azure CLI для создания назначения политики для определения ресурсов, не соответствующих требованиям, в среде Azure.

Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

Если вы решили установить и использовать CLI локально, для выполнения инструкций в этом руководстве вам понадобится Azure CLI 2.0.4 или более поздней версии. Чтобы узнать версию, выполните команду `az --version`. Если вам необходимо выполнить установку или обновление, см. статью [Установка Azure CLI 2.0]( /cli/azure/install-azure-cli).
 
## <a name="opt-in-to-azure-policy"></a>Участие в политике Azure

Служба "Политика Azure" сейчас доступна в ограниченной предварительной версии, поэтому вам необходимо зарегистрироваться, чтобы подать запрос на доступ.

1. Перейдите к службе "Политика Azure" по адресу https://aka.ms/getpolicy, а затем выберите **Зарегистрироваться** в области слева.

   ![Поиск политики](media/assign-policy-definition/sign-up.png)

2. Согласитесь использовать политику Azure, выбрав подписки, с которыми желаете работать, в списке **Подписка**. Затем щелкните **Регистрация**.

   ![Согласие на использование политики Azure](media/assign-policy-definition/preview-opt-in.png)

   Прием вашего запроса на регистрацию может занять несколько дней, в зависимости от числа запросов. После принятия запроса вы будете уведомлены по электронной почте о том, что можете начать пользоваться службой.

## <a name="create-a-policy-assignment"></a>Создание назначения политики

В этом кратком руководстве мы создадим назначение политики и назначим определение "Требовать наличия SQL Server версии 12.0". Это определение политики идентифицирует ресурсы, которые не соответствуют условиям, заданным в определении политики.

Выполните следующие действия для создания назначения политики.

Просмотрите все определения политик и найдите определение "Требовать наличия SQL Server версии 12.0":

```azurecli
az policy definition list
```

Политика Azure поставляется с готовыми встроенными определениями политик, которые можно использовать. Вы увидите такие встроенные определения политик, как:

- Принудительно применять тег и его значение.
- Применять тег и его значение.
- Требовать наличия SQL Server версии 12.0.

Далее укажите следующие сведения и выполните следующую команду, чтобы назначить определение политики:

- Отображаемое **имя** для назначения политики. В данном случае мы укажем *Требовать наличия SQL Server версии 12.0 — назначение*.
- **Политика** — это определение политики на основе того, что вы используете для создания назначения. В данном случае это определение политики — *Требовать наличия SQL Server версии 12.0*
- Область (**Scope**) определяет, к каким ресурсам или группе ресурсов принудительно применяется назначение политики. Она может варьироваться от подписки до групп ресурсов.

  Используйте подписку (или группу ресурсов), которую вы ранее зарегистрировали при участии в политике Azure. В нашем примере мы используем идентификатор подписки **bc75htn-a0fhsi-349b-56gh-4fghti-f84852** и группу ресурсов с именем **FabrikamOMS**. Не забудьте изменить их на идентификатор подписки и имя группы ресурсов, с которыми вы работаете. 

Команда должна выглядеть следующим образом:

```azurecli
az policy assignment create --name Require SQL Server version 12.0 Assignment --policy Require SQL Server version 12.0 --scope /subscriptions/ 
bc75htn-a0fhsi-349b-56gh-4fghti-f84852/resourceGroups/FabrikamOMS
```

Назначение политики — это политика, которая назначена в рамках определенной области. Эта область также может варьироваться от группы управления до группы ресурсов.

## <a name="identify-non-compliant-resources"></a>Идентификация несоответствующих ресурсов

Чтобы просмотреть ресурсы, которые не соответствуют новому назначению, выполните следующие действия.

1. Вернитесь на страницу политики Azure.
2. Выберите **Соответствие** в области слева и выполните поиск созданного **назначения политики**.

   ![Соответствие политике](media/assign-policy-definition/policy-compliance.png)

   Существующие ресурсы, которые не соответствуют новому назначению, отображаются на вкладке **Несоответствующие ресурсы**, как показано выше.

## <a name="clean-up-resources"></a>Очистка ресурсов

Остальные руководства из этой серии созданы на основе этого документа. Если вы планируете продолжать работу с другими руководствами, не удаляйте созданные в этом кратком руководстве ресурсы. В противном случае удалите созданное назначение, выполнив следующую команду:

```azurecli
az policy assignment delete –name Require SQL Server version 12.0 Assignment --scope /subscriptions/ bc75htn-a0fhsi-349b-56gh-4fghti-f84852 resourceGroups/ FabrikamOMS
```

## <a name="next-steps"></a>Дальнейшие действия

В этом кратком руководстве вы назначили определение политики для идентификации ресурсов, не соответствующих требованиям, в среде Azure.

Дополнительные сведения о назначении политик, для обеспечения соответствия создаваемых в **будущем** ресурсов см. в следующем руководстве:

> [!div class="nextstepaction"]
> [Создание политик и управление ими](./create-manage-policy.md)

