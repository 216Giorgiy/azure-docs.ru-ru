---
title: "Создание назначения политики с помощью Azure CLI для идентификации ресурсов, не соответствующих требованиям, в среде Azure | Документация Майкрософт"
description: "Использование PowerShell для создания назначения политики Azure для идентификации несоответствующих ресурсов."
services: azure-policy
keywords: 
author: bandersmsft
ms.author: banders
ms.date: 12/06/2017
ms.topic: quickstart
ms.service: azure-policy
ms.custom: mvc
ms.openlocfilehash: 88ceb47d46b66e716c6c263098d5b9458e4aff22
ms.sourcegitcommit: cc03e42cffdec775515f489fa8e02edd35fd83dc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/07/2017
---
# <a name="create-a-policy-assignment-to-identify-non-compliant-resources-in-your-azure-environment-with-the-azure-cli"></a>Создание назначения политики для идентификации ресурсов, не соответствующих требованиям, в среде Azure с помощью Azure CLI | Документация Майкрософт

Чтобы выяснить соответствие требованиям в Azure, нужно определить состояние текущих ресурсов. В этом кратком руководстве описывается поэтапный процесс создания назначения политики для выявления виртуальных машин, которые не используют управляемые диски.

Этот процесс позволит вам определить, какие виртуальные машины не используют управляемые диски, то есть *не соответствуют требованиям*.

Если у вас еще нет подписки Azure, создайте [бесплатную](https://azure.microsoft.com/free/) учетную запись Azure, прежде чем начинать работу.

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

Если вы решили установить и использовать CLI локально, для выполнения инструкций в этом руководстве вам понадобится Azure CLI 2.0.4 или более поздней версии. Чтобы узнать версию, выполните команду `az --version`. Если вам необходимо выполнить установку или обновление, см. статью [Установка Azure CLI 2.0]( /cli/azure/install-azure-cli).

## <a name="create-a-policy-assignment"></a>Создание назначения политики

В этом кратком руководстве мы создаем назначение политики и назначаем определение "Audit Virtual Machines without Managed Disks". Это определение политики идентифицирует ресурсы, которые не соответствуют условиям, заданным в определении политики.

Чтобы создать назначение политики, следуйте инструкциям ниже.

Просмотрите все определения политик и найдите определение политики "Audit Virtual Machines without Managed Disks".

```azurecli
az policy definition list
```

Политика Azure поставляется с готовыми встроенными определениями политик, которые можно использовать. Вы увидите такие встроенные определения политик, как:

- принудительно применять тег и его значение;
- применять тег и его значение;
- Требовать наличия SQL Server версии 12.0.

Далее укажите следующие сведения и выполните следующую команду, чтобы назначить определение политики:

- Отображаемое имя (**Name**) назначения политики. В этом случае используем *Audit Virtual Machines without Managed Disks*.
- Определение политики (**Policy**), на основе которой вы создаете назначение. В данном случае это определение политики — *Audit Virtual Machines without Managed Disks*.
- Область (**Scope**) определяет, к каким ресурсам или группе ресурсов принудительно применяется назначение политики. Политика может назначаться разным ресурсам: от подписки до групп ресурсов.

  Использование ранее зарегистрированной подписки (или группы ресурсов). В этом примере мы используем идентификатор подписки **bc75htn-a0fhsi-349b-56gh-4fghti-f84852** и имя группы ресурсов **FabrikamOMS**. Не забудьте изменить их на идентификатор подписки и имя группы ресурсов, с которыми вы работаете.

Команда должна выглядеть следующим образом:

```azurecli
az policy assignment create --name Audit Virtual Machines without Managed Disks Assignment --policy Audit Virtual Machines without Managed Disks --scope /subscriptions/
bc75htn-a0fhsi-349b-56gh-4fghti-f84852/resourceGroups/FabrikamOMS
```

Назначение политики — это политика, которая назначена в рамках определенной области. Эта область также может варьироваться от группы управления до группы ресурсов.

## <a name="identify-non-compliant-resources"></a>Идентификация несоответствующих ресурсов

Чтобы просмотреть ресурсы, которые не соответствуют новому назначению, выполните следующие действия.

1. Вернитесь на страницу политики Azure.
2. Выберите **Соответствие** в области слева и выполните поиск созданного **назначения политики**.

   ![Соответствие политике](media/assign-policy-definition/policy-compliance.png)

   Существующие ресурсы, которые не соответствуют новому назначению, отображаются на вкладке **Несоответствующие ресурсы**, как показано выше.

## <a name="clean-up-resources"></a>Очистка ресурсов

Остальные руководства из этой серии являются продолжением этого документа. Если вы намерены переходить к ним, не удаляйте ресурсы, которые создали при работе с этим руководством. В противном случае удалите созданное назначение, выполнив следующую команду:

```azurecli
az policy assignment delete –name  Assignment --scope /subscriptions/ bc75htn-a0fhsi-349b-56gh-4fghti-f84852 resourceGroups/ FabrikamOMS
```

## <a name="next-steps"></a>Дальнейшие действия

В этом кратком руководстве вы назначили определение политики для идентификации ресурсов, не соответствующих требованиям, в среде Azure.

Дополнительные сведения о назначении политик, для обеспечения соответствия создаваемых в **будущем** ресурсов см. в следующем руководстве:

> [!div class="nextstepaction"]
> [Создание политик и управление ими](./create-manage-policy.md)
