---
title: Необходимые условия для Avere vFXT — Azure
description: Необходимые условия для Avere vFXT для Azure
author: ekpgh
ms.service: avere-vfxt
ms.topic: conceptual
ms.date: 02/20/2019
ms.author: v-erkell
ms.openlocfilehash: 5642f3acd108d0d3f504fc132522936d1b5ab870
ms.sourcegitcommit: 2d0fb4f3fc8086d61e2d8e506d5c2b930ba525a7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/18/2019
ms.locfileid: "58082591"
---
# <a name="prepare-to-create-the-avere-vfxt"></a>Подготовка к созданию Avere vFXT

В этой статье объясняются предварительные задачи для создания кластера Avere vFXT.

## <a name="create-a-new-subscription"></a>Создание подписки

Начните с создания подписки Azure. Используйте отдельную подписку для каждого проекта Avere vFXT, что позволит легко отслеживать все ресурсы проекта и расходы, защитить другие проекты от возможного регулирования во время подготовки и упростить очистку.  

Чтобы создать подписку Azure на портале Azure:

* Перейдите в колонку [Подписки](https://ms.portal.azure.com/#blade/Microsoft_Azure_Billing/SubscriptionsBlade).
* Нажмите кнопку **+ Добавить** вверху.
* Войдите при появлении соответствующего запроса.
* Выберите предложение и выполните действия, чтобы создать подписку.

## <a name="configure-subscription-owner-permissions"></a>Настройка разрешений владельца подписки

Кластер vFXT должен создать пользователь с разрешениями владельца подписки. Эти разрешения требуются для выполнения таких действий, как:

* принятие условий для программного обеспечения Avere vFXT;
* создание роли доступа к узлу кластера; 

Если вы не хотите предоставить доступ владельца пользователям, которые создают vFXT, есть два обходных решения.

* Владелец группы ресурсов может создать кластер, если выполняются такие условия:

  * Владелец подписки должен [принять условия соглашения программного обеспечения Avere vFXT](#accept-software-terms) и [создать роль доступа к узлу кластера](#create-the-cluster-node-access-role). 
  * Все ресурсы Avere vFXT должны быть развернуты в группе ресурсов, включая:
    * контроллер кластера;
    * Узлы кластера
    * Хранилище BLOB-объектов
    * элементы сети.
 
* Пользователь, у которого нет прав владельца, может создавать кластеры vFXT, заблаговременно используя механизм управления доступом на основе ролей (RBAC), чтобы назначить привилегии пользователю. Таким способом можно предоставить пользователям значимые разрешения. [В этой статье](avere-vfxt-non-owner.md) объясняется, как создать роль доступа, чтобы разрешить пользователям без прав владельца создавать кластеры.

## <a name="quota-for-the-vfxt-cluster"></a>Квота для кластера vFXT

Для следующих компонентов Azure необходимо иметь достаточную квоту. При необходимости [подайте запрос на увеличение квоты](https://docs.microsoft.com/azure/azure-supportability/resource-manager-core-quotas-request).

> [!NOTE]
> Виртуальные машины и компоненты SSD, перечисленные здесь, предназначены для самого кластера vFXT. Вам потребуется дополнительная квота для виртуальных машин и SSD, которые будут использоваться для вычислительной фермы.  Убедитесь, что квота включена для региона, где планируется запустить рабочий процесс.

|Компонент Azure|Quota|
|----------|-----------|
|Виртуальные машины|3 или более E32s_v3|
|Хранилище SSD (цен. категория "Премиум")|200 ГБ пространства ОС плюс от 1 до 4 ТБ объема кэша на узел |
|Учетная запись хранения (необязательно) |версия 2|
|Серверное хранилище данных (необязательно) |Один новый контейнер больших двоичных объектов в LRS |

## <a name="accept-software-terms"></a>Принятие условий программного обеспечения

> [!NOTE] 
> Этот шаг не является обязательным, если владелец подписки создает кластер Avere vFXT.

Во время создания кластера необходимо принять условия предоставления услуг для программного обеспечения Avere vFXT. Если вы не являетесь владельцем подписки, он должен принять условия заранее. Этот шаг достаточно выполнить один раз для каждой подписки.

Чтобы принять условия программного обеспечения заранее: 

1. Откройте Cloud Shell на портале Azure или перейдите по адресу <https://shell.azure.com>. Войдите с помощью идентификатора своей подписки.

   ```azurecli
    az login
    az account set --subscription abc123de-f456-abc7-89de-f01234567890
   ```

1. Выполните эту команду, чтобы принять условия предоставления услуг и включить программный доступ для Avere vFXT для образа программного обеспечения в Azure: 

   ```azurecli
   az vm image accept-terms --urn microsoft-avere:vfxt:avere-vfxt-controller:latest
   ```

## <a name="create-access-roles"></a>Создание ролей доступа 

[Управление доступом на основе ролей](../role-based-access-control/index.yml) (RBAC) обеспечивает авторизацию узлов и контроллера кластера vFXT, позволяя им выполнять необходимые задачи.

* Контроллеру кластера необходимо предоставить разрешение на создание и изменение виртуальных машин для создания кластера. 

* Отдельные узлы vFXT должны считывать свойства ресурса Azure, управлять хранилищем, а также параметрами сетевого интерфейса других узлов в рамках обычной работы кластера vFXT.

Перед созданием кластера Avere vFXT необходимо определить настраиваемую роль, которая будет использоваться с узлами кластера. 

Для контроллера кластера можно принять роль по умолчанию из шаблона. Значение по умолчанию предоставляет контроллеру кластера права владельца группы ресурсов. Если вам нужно создать настраиваемую роль для контроллера, ознакомьтесь со статьей [Настраиваемая роль доступа для контроллера](avere-vfxt-controller-role.md).

> [!NOTE] 
> Возможность создания ролей доступна только для владельца подписки, а также ролей владельца и администратора доступа пользователей. Роли можно создать заблаговременно.  

### <a name="create-the-cluster-node-access-role"></a>создание роли доступа к узлу кластера;

<!-- caution - this header is linked to in the template so don't change it unless you can change that -->

Перед созданием кластера Avere vFXT для Azure необходимо создать роль узла кластера.

> [!TIP] 
> Внутренние пользователи корпорации Майкрософт должны использовать существующую роль с именем "Оператор среды выполнения кластеров Avere", вместо того чтобы создавать новую. 

1. Скопируйте этот файл. Добавьте идентификатор подписки в строку AssignableScopes.

   (Текущая версия этого файла с именем [AvereOperator.txt](https://github.com/Azure/Avere/blob/master/src/vfxt/src/roles/AvereOperator.txt) хранится в репозитории github.com/Azure/Avere.)  

   ```json
   {
      "AssignableScopes": [
          "/subscriptions/PUT_YOUR_SUBSCRIPTION_ID_HERE"
      ],
      "Name": "Avere Operator",
      "IsCustom": "true",
      "Description": "Used by the Avere vFXT cluster to manage the cluster",
      "NotActions": [],
      "Actions": [
          "Microsoft.Compute/virtualMachines/read",
          "Microsoft.Network/networkInterfaces/read",
          "Microsoft.Network/networkInterfaces/write",
          "Microsoft.Network/virtualNetworks/subnets/read",
          "Microsoft.Network/virtualNetworks/subnets/join/action",
          "Microsoft.Network/networkSecurityGroups/join/action",
          "Microsoft.Resources/subscriptions/resourceGroups/read",
          "Microsoft.Storage/storageAccounts/blobServices/containers/delete",
          "Microsoft.Storage/storageAccounts/blobServices/containers/read",
          "Microsoft.Storage/storageAccounts/blobServices/containers/write"
      ],
      "DataActions": [
          "Microsoft.Storage/storageAccounts/blobServices/containers/blobs/delete",
          "Microsoft.Storage/storageAccounts/blobServices/containers/blobs/read",
          "Microsoft.Storage/storageAccounts/blobServices/containers/blobs/write"
      ]
   }
   ```

1. Сохраните файл под именем ``avere-operator.json`` или аналогичным запоминающимся именем. 


1. Откройте Azure Cloud Shell и выполните вход, используя собственный идентификатор подписки (описано [ранее в этом документе](#accept-software-terms)). Создайте роль с помощью следующей команды:

   ```bash
   az role definition create --role-definition /avere-operator.json
   ```

Имя роли используется при создании кластера. В этом примере используется имя ``avere-operator``.

## <a name="create-a-storage-service-endpoint-in-your-virtual-network-if-needed"></a>Создать конечную точку службы хранилища в виртуальной сети (при необходимости)

Объект [конечная точка службы](../virtual-network/virtual-network-service-endpoints-overview.md) хранятся локально, вместо маршрутизации его за пределами виртуальной сети трафик BLOB-объектов Azure. Рекомендуется для любого vFXT Avere для кластера Azure, которое использует BLOB-объектов Azure для хранения внутренних данных. 

Если вы предоставляете существующей виртуальной сети и создания нового контейнера больших двоичных объектов Azure для внутреннего хранилища в процессе создания кластера, должен иметь конечную точку службы в виртуальной сети для службы хранилища Microsoft. Эта конечная точка должна существовать перед созданием кластера или создать не удастся. 

Конечная точка службы хранилища рекомендуется для любого vFXT Avere для кластера Azure, которое использует хранилище BLOB-объектов Azure, даже если вы добавили хранилище. 

> [!TIP] 
> * Этот шаг можно пропустите, если вы создаете новую виртуальную сеть в процессе создания кластера. 
> * Этот шаг необязателен, если вы не создаете хранилище BLOB-объектов во время создания кластера. В этом случае конечной точки службы можно создать позже, если вы решили использовать BLOB-объектов Azure.

Создание конечной точки службы хранилища на портале Azure. 

1. На портале слева щелкните **Виртуальные сети**.
1. Выберите виртуальную сеть для кластера. 
1. В области слева щелкните **Конечные точки службы**.
1. В верхней части страницы щелкните **Добавить**.
1. Оставьте в службу как ``Microsoft.Storage`` и выберите подсети кластера.
1. В нижней части страницы щелкните **Добавить**.

   ![Снимок экрана портала Azure с заметками для шагов создания конечной точки службы](media/avere-vfxt-service-endpoint.png)


## <a name="next-step-create-the-vfxt-cluster"></a>Следующий шаг: создание кластера vFXT

После выполнения этих предварительных требований можно переходить к созданию кластера. Инструкции см. в статье [Развертывание кластера vFXT](avere-vfxt-deploy.md).