---
title: Развертывание Avere vFXT для Azure
description: Шаги по развертыванию кластера Avere vFXT в Azure
author: ekpgh
ms.service: avere-vfxt
ms.topic: conceptual
ms.date: 01/29/2019
ms.author: v-erkell
ms.openlocfilehash: 972ba937ad15fa9a6d2eb74e3e4c9e6e8f3923a4
ms.sourcegitcommit: 947b331c4d03f79adcb45f74d275ac160c4a2e83
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2019
ms.locfileid: "55745441"
---
# <a name="deploy-the-vfxt-cluster"></a>Развертывание кластера vFXT

Эта процедура описывает использование мастера развертывания, который предоставляется в Azure Marketplace. Этот мастер автоматически развертывает кластер с помощью шаблона Azure Resource Manager. Когда вы введете в форму параметры и нажмете кнопку **Создать**, Azure автоматически выполнит следующие действия: 

* создаст контроллер кластера, который представляет собой простую виртуальную машину с программным обеспечением для развертывания кластера и управления им;
* настроит группу ресурсов и инфраструктуру виртуальной сети, а при необходимости создаст новые элементы;
* создаст виртуальные машины для узлов кластера и настроит их как кластер Avere;
* если указано в параметрах, создаст контейнер больших двоичных объектов Azure и настроит его в качестве основного фильтра кластера.

Когда вы выполните инструкции в этом документе, у вас будет виртуальная сеть, подсеть, контроллер и кластер vFXT, как показано на следующей схеме:

![схема с виртуальной сетью, содержащей дополнительное хранилище BLOB-объектов, и подсетью, содержащей три сгруппированные виртуальные машины с метками узлов vFXT и кластера vFXT и одну виртуальную машину с меткой контроллера кластера](media/avere-vfxt-deployment.png)

Если вы используете хранилище больших двоичных объектов, после создания кластера следует [создать конечную точку хранилища](#create-a-storage-endpoint-if-using-azure-blob) в виртуальной сети. 

Перед запуском шаблона создания убедитесь, что у вас есть следующие необходимые компоненты:  

1. [Новая подписка](avere-vfxt-prereqs.md#create-a-new-subscription).
1. [Разрешения владельца подписки](avere-vfxt-prereqs.md#configure-subscription-owner-permissions).
1. [Квота для кластера vFXT](avere-vfxt-prereqs.md#quota-for-the-vfxt-cluster).
1. [Настраиваемые роли доступа](avere-vfxt-prereqs.md#create-access-roles). Создайте роль, которая будет назначаться узлам кластера, для управления доступом на основе ролей. Вы можете также создать настраиваемую роль доступа для контроллеров кластера, но большинство пользователей выбирает стандартную роль владельца, которая предоставляет на контроллере привилегии уровня владельца группы ресурсов. См. дополнительные сведения о [встроенных ролях для ресурсов Azure](../role-based-access-control/built-in-roles.md#owner).

Дополнительные сведения о шагах развертывания кластера и планировании см. в статьях [Plan your Avere vFXT system](avere-vfxt-deploy-plan.md) (Планирование системы Avere vFXT) и [Avere vFXT for Azure - deployment overview](avere-vfxt-deploy-overview.md) (Общие сведения о развертывании Avere vFXT для Azure).

## <a name="create-the-avere-vfxt-for-azure"></a>Создание кластера Avere vFXT для Azure

Найдите на портале Azure нужный шаблон создания, выполнив поиск по строке Avere и выбрав Avere vFXT for ARM Deployment (Развертывание Avere vFXT для ARM). 

![В окне браузера отображается портал Azure с выделенными элементами "Создать > Marketplace > Все". На странице "Все" в поле поиска введен термин "avere", а второй результат, Avere vFXT ARM Deployment (Развертывание Avere vFXT для ARM), выделен красным прямоугольником.](media/avere-vfxt-template-choose.png)

Прочитав сведения на странице развертывания Avere vFXT для ARM, щелкните **Создать**, чтобы приступить к работе. 

![Сайт Azure Marketplace, где отображается первая страница шаблона развертывания](media/avere-vfxt-deploy-first.png)

Этот шаблон состоит из четырех шагов — две страницы для сбора информации, а затем шаги проверки и подтверждения. 

* Первая страница посвящена параметрам виртуальной машины для контроллера кластера. 
* На второй странице указываются параметры для создания кластера и связанных с ним ресурсов, таких как подсети и хранилище. 
* Третья страница отображает все введенные параметры и проверяет правильность конфигурации. 
* Четвертая страница описывает условия использования программного обеспечения, позволяя начать создание кластера. 

## <a name="page-one-parameters---cluster-controller-information"></a>Параметры на первой странице для сведений о контроллере кластера

На первой странице шаблона развертывания собираются данные о контроллера кластера. 

![Первая страница шаблона развертывания](media/avere-vfxt-deploy-1.png)

Заполните следующие сведения:

* **Cluster controller name** (Имя контроллера кластера). Введите имя виртуальной машины для контроллера кластера.

* **Controller username** (Имя пользователя контроллера). Введите имя привилегированного пользователя для виртуальной машины контроллера кластера. 

* **Authentication type** (Тип проверки подлинности). Выберите проверку подлинности на основе пароля или открытого ключа SSH, которая будет применяться при подключениях к контроллеру. Мы рекомендуем использовать метод с открытым ключом SSH (см. инструкции по [созданию и использованию ключей SSH](https://docs.microsoft.com/azure/virtual-machines/linux/ssh-from-windows)).

* **Password** (Пароль) или **SSH public key** (Открытый ключ SSH) — в зависимости выбранного типа проверки подлинности в следующих полях нужно предоставить открытый ключ RSA или пароль. Эти учетные данные используются в сочетании с указанным выше именем пользователя.

* **Avere cluster create role ID** (Идентификатор роли для создания кластера Avere). Это поле позволяет указать роль контроллера кластера для контроля доступа. По умолчанию здесь выбирается встроенная роль [Владелец](../role-based-access-control/built-in-roles.md#owner). Права владельца для контроллера кластера ограничены группой ресурсов кластера. 

  Необходимо использовать глобальный уникальный идентификатор, соответствующий этой роли. Для варианта по умолчанию (Владелец) используется идентификатор GUID 8e3af657-a8ff-443c-a75c-2fe8c4bcb635. Чтобы найти идентификатор GUID для пользовательской роли, используйте следующую команду: 

  ```azurecli
  az role definition list --query '[*].{roleName:roleName, name:name}' -o table --name 'YOUR ROLE NAME'
  ```

* **Subscription** (Подписка). Выберите подписку для Avere vFXT. 

* **Группа ресурсов**. Выберите существующую пустую группу ресурсов для кластера Avere vFXT или щелкните "Создать" и введите имя новой группы ресурсов. 

* **Location** (Расположение). Укажите расположение кластера и ресурсов Azure.

Щелкните **OK**, когда все будет готово. 

> [!NOTE]
> Если для контроллера кластера нужно настроить доступный из Интернета IP-адрес, создайте для этого кластера новую виртуальную сеть и не используйте существующие сети. Этот параметр вы найдете на второй странице.

## <a name="page-two-parameters---vfxt-cluster-information"></a>Параметры на второй странице для сведений о кластере vFXT

Вторая страница шаблона развертывания позволяет задать размер кластера, тип узлов, размер кэша, параметры хранилища и еще несколько параметров. 

![Вторая страница шаблона развертывания](media/avere-vfxt-deploy-2.png)

* **Avere vFXT cluster node count** (Количество узлов кластера Avere vFXT). Выберите количество узлов, которое вы намерены использовать в кластере. Допускаются значения в диапазоне от трех до двенадцати узлов. 

* **Cluster administration password** (Пароль для администрирования кластера). Создайте пароль для администрирования кластера. Этот пароль будет использоваться с именем пользователя ```admin``` для входа на панель управления кластером, где доступны функции мониторинга и настройки кластера.

* **Avere cluster operations role** (Роль операций кластера Avere). Укажите имя роли контроля доступа для узлов кластера. Это та пользовательская роль, которую вы создали на предыдущем шаге. 

  Пример из раздела [Создание роли доступа для узла кластера](avere-vfxt-prereqs.md#create-the-cluster-node-access-role) сохраняет файл с именем ```avere-operator.json``` и присваивает соответствующей роли имя ```avere-operator```.

* **Avere vFXT cluster name** (Имя кластера Avere vFXT). Присвойте кластеру уникальное имя. 

* **Size** (Размер). Укажите тип виртуальной машины, который нужно использовать при создании узлов кластера. 

* **Cache size per node** (Размер кэша для каждого узла). Кэш кластера распределяется между узлами кластера, то есть общий размер кэша в кластере Avere vFXT вычисляется как размер кэша для каждого узла, умноженный на количество узлов. 

  Мы рекомендуем использовать для каждого узла 1 ТБ кэша, если используется размер узла Standard_D16s_v3, или 4 ТБ, если используется размер Standard_E32s_v3.

* **Virtual network** (Виртуальная сеть). Выберите для размещения кластера существующую виртуальную сеть или создайте новую. 

  > [!NOTE]
  > Во втором случае контроллеру кластера будет назначен общедоступный IP-адрес для организации доступа к этой новой частной сети. Если вы выберете существующую виртуальную сеть, контроллер кластера настраивается без общедоступного IP-адреса. 
  > 
  > Общедоступный IP-адрес для контроллера кластера обеспечивает более удобный доступ к кластеру vFXT, но создает небольшую угрозу безопасности. 
  >  * Благодаря наличию общедоступного IP-адреса контроллер кластера можно использовать в качестве узла перехода для подключения к кластеру Avere vFXT за пределами частной подсети.
  >  * Если вы не настроили общедоступный IP-адрес в контроллере, для доступа к кластеру необходимо использовать другой узел перехода, подключение VPN или ExpressRoute. Например, создайте контроллер в виртуальной сети, для которой уже настроено VPN-подключение.
  >  * Если вы создаете контроллер с общедоступным IP-адресом, необходимо защитить виртуальную машину контроллера с помощью группы безопасности сети. По умолчанию развертывание Avere vFXT для Azure создает для контроллеров с общедоступными IP-адресами группу безопасности сети и разрешает входящий доступ только к порту 22. Вы можете дополнительно защитить систему, ограничив доступ по выбранному диапазону исходных IP-адресов, то есть разрешая подключения только от тех компьютеров, с которых вам нужен доступ к этому кластеру.

* **Subnet** (Подсеть). Выберите подсеть из существующей виртуальной сети или создайте новую. 

* **Use blob storage** (Использовать хранилище BLOB-объектов). Выберите значение **true**, чтобы создать контейнер больших двоичных объектов Azure и настроить его в качестве серверного хранилища для нового кластера Avere vFXT. Этот параметр также создает учетную запись хранения в той же группе ресурсов, где находится кластер. 

  Задайте этому полю значение **false**, если вы не хотите создавать контейнер. В этом случае необходимо подключить и настроить хранилище после создания кластера. Дополнительные инструкции см. в статье [Настройка хранилища](avere-vfxt-add-storage.md). 

* **Учетная запись хранения**. Если вы создаете новый контейнер больших двоичных объектов Azure, введите здесь имя новой учетной записи хранения. 

## <a name="validation-and-purchase"></a>Проверка и приобретение

Третья страница отображает введенную конфигурацию и проверяет указанные параметры. Если проверка завершится успешно, щелкните кнопку **ОК** для продолжения работы. 

![Третья страница шаблона развертывания, проверка параметров](media/avere-vfxt-deploy-3.png)

На четвертой странице нажмите кнопку **Create** (Создать), чтобы принять условия использования и создать кластер Avere vFXT для Azure. 

![Четвертая страница шаблона развертывания с описанием условий и кнопкой создания](media/avere-vfxt-deploy-4.png)

Развертывание кластера занимает 15–20 минут.

## <a name="gather-template-output"></a>Сбор выходных данных шаблона

Когда шаблон Avere vFXT завершит создание кластера, выводится ряд важных сведений об этом новом кластере. 

> [!TIP]
> Обязательно скопируйте из выходных данных шаблона IP-адрес управления. Этот адрес вам понадобится для администрирования кластера.

Чтобы найти эти сведения, выполните следующие действия:

1. Перейдите к группе ресурсов для контроллера кластера.

1. В левой части страницы щелкните **Развертывания**, а затем — **microsoft-avere.vfxt-template**.

   ![Страница портала для группы ресурсов, где слева выбран пункт "Развертывания", а в таблице для имени развертывания указано значение microsoft-avere.vfxt-template](media/avere-vfxt-outputs-deployments.png)

1. В левой части страницы щелкните **Выходные данные**. Скопируйте значения в каждом из полей. 

   ![Страница выходных значений со значениями SSHSTRING, RESOURCE_GROUP, LOCATION, NETWORK_RESOURCE_GROUP, NETWORK, SUBNET, SUBNET_ID, VSERVER_IPs и MGMT_IP в полях с метками](media/avere-vfxt-outputs-values.png)


## <a name="create-a-storage-endpoint-if-using-azure-blob"></a>Создание конечной точки хранилища (при использовании больших двоичных объектов Azure)

Если вы используете хранилище BLOB-объектов Azure в качестве внутреннего хранилища данных, необходимо создать конечную точку службы хранилища в виртуальной сети. Благодаря этой [конечной точке службы](../virtual-network/virtual-network-service-endpoints-overview.md) трафик больших двоичных объектов Azure остается в локальной среде, а не маршрутизируется за пределами виртуальной сети.

1. На портале слева щелкните **Виртуальные сети**.
1. Выберите виртуальную сеть для своего контроллера. 
1. В области слева щелкните **Конечные точки службы**.
1. В верхней части страницы щелкните **Добавить**.
1. Оставьте службу ``Microsoft.Storage`` без изменений и выберите подсеть контроллера.
1. В нижней части страницы щелкните **Добавить**.

  ![Снимок экрана портала Azure с заметками для шагов создания конечной точки службы](media/avere-vfxt-service-endpoint.png)

## <a name="next-step"></a>Дальнейшие действия

Теперь, когда кластер запущен и вам известен его IP-адрес управления, вы можете [подключиться к средству конфигурации кластера](avere-vfxt-cluster-gui.md), чтобы включить поддержку, добавить хранилище и настроить другие параметры кластера.
