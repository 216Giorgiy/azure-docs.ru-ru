<properties
   pageTitle="Диспетчер ресурсов и классическое развертывание | Microsoft Azure"
   description="Описывает различия между моделью развертывания диспетчера ресурсов и классической моделью развертывания (или моделью управления службами)."
   services="azure-resource-manager"
   documentationCenter="na"
   authors="tfitzmac"
   manager="wpickett"
   editor=""/>

<tags
   ms.service="azure-resource-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="03/23/2016"
   ms.author="tomfitz"/>

# Развертывание с помощью Azure Resource Manager и классическое развертывание: сведения о моделях развертывания и состоянии ресурсов

В этом разделе приводятся сведения о диспетчере ресурсов Azure Resource Manager, классических моделях развертывания, состоянии ресурсов и о том, почему для развертывания ресурсов используется тот или иной метод. Модель развертывания с помощью диспетчера ресурсов имеет важные отличия от классической модели развертывания, и эти две модели не являются полностью совместимыми друг с другом. Чтобы упростить развертывание и управление ресурсами, корпорация Майкрософт рекомендует использовать диспетчер ресурсов для новых ресурсов и, если это возможно, для повторного развертывания существующих ресурсов через диспетчер ресурсов.

Большинство ресурсов можно легко перевести на диспетчер ресурсов безо всяких проблем. Однако некоторые поставщики ресурсов предлагают две версии ресурсов (одну для классической модели и одну для модели диспетчера ресурсов) из-за архитектурных различий между моделями. К поставщикам ресурсов, которые различают две модели, относятся:

- **Вычисления** — поддерживает экземпляры виртуальных машин и дополнительные группы доступности.
- **Служба хранилища** — поддерживает необходимые учетные записи хранения, в которых хранятся виртуальные жесткие диски виртуальных машин, включая диски операционной системы и дополнительные диски данных.
- **Сеть** — поддерживает необходимые сетевые карты, IP-адреса виртуальных машин и подсети в виртуальной сети, а также дополнительные балансировщики нагрузки, их IP-адреса и группы сетевой безопасности.

Для этих типов ресурсов необходимо знать, какую версию вы используете, так как поддерживаемые ими операции будут различаться. Чтобы понять, какая модель использовалась для развертывания ресурсов, рассмотрим обе модели.

## Характеристики диспетчера ресурсов

Ресурсы, созданные с помощью диспетчера ресурсов, имеют следующие характеристики.

- Они создаются с помощью одного из следующих методов:

  - [Портал Azure](https://portal.azure.com/).

   ![Портал Azure](./media/resource-manager-deployment-model/preview-portal.png)

   Для вычислительных, сетевых ресурсов и ресурсов хранения можно выбрать модель развертывания с использованием Resource Manager или классическую модель. Выберите **Диспетчер ресурсов**.

   ![Развертывание с помощью Resource Manager](./media/resource-manager-deployment-model/select-resource-manager.png)

  - Для Azure PowerShell используйте версию команд для диспетчера ресурсов. Эти команды имеют вид *{Глагол}-AzureRm{Имя\_существительное}*, как показано ниже.

            Get-AzureRmResourceGroupDeployment

  - С использованием [API REST диспетчера ресурсов Azure](https://msdn.microsoft.com/library/azure/dn790568.aspx) для операций REST.
  - с использованием команд интерфейса командной строки Azure, запускаемых в режиме **arm**.

            azure config mode arm

- Тип ресурса не содержит **(классический)** в имени. На следующем рисунке тип отображается как **Учетная запись хранения**.

   ![веб-приложение](./media/resource-manager-deployment-model/resource-manager-type.png)

Приложение, изображенное на следующем рисунке, показывает, как ресурсы, развертываемые через диспетчер ресурсов, содержатся в одной группе ресурсов.

  ![](./media/virtual-machines-azure-resource-manager-architecture/arm_arch3.png)

Кроме того, существуют связи между ресурсами в поставщиках ресурсов:

- Виртуальная машина зависит от определенной учетной записи хранения, определенной в SRP для хранения ее дисков в хранилище больших двоичных объектов (обязательном).
- Виртуальная машина ссылается на конкретную сетевую карту, определенную в NRP (обязательную), и группу доступности, определенные в CRP (необязательную).
- Сетевая карта ссылается на назначенный виртуальной машине IP-адрес (обязательный), подсеть виртуальной сети для виртуальной машины (обязательную) и группу сетевой безопасности (необязательную).
- Подсеть в виртуальной сети ссылается на группу сетевой безопасности (необязательную).
- Экземпляр подсистемы балансировки нагрузки ссылается на пул внутренних IP-адресов, который включают сетевую карту виртуальной машины (необязательно), и ссылается на общедоступный или частный IP-адрес (необязательно) подсистемы балансировки нагрузки.

## Характеристики классического развертывания

Возможно, вы знакомы с классической моделью развертывания как с моделью управления службами.

В управлении службами Azure вычислительные, сетевые ресурсы и ресурсы хранения данных для размещения виртуальных машин предоставляются:

- Требуемой облачной службой, которая выступает в роли контейнера для размещения виртуальных машин (вычислений). Виртуальным машинам автоматически предоставляется сетевая карта (NIC) и IP-адрес, назначаемый Azure. Кроме того, облачная служба содержит экземпляр внешней подсистемы балансировки нагрузки, общедоступный IP-адрес и конечные точки по умолчанию, чтобы разрешить трафик удаленного рабочего стола и удаленный трафик PowerShell для виртуальных машин на основе Windows, а также трафик Secure Shell (SSH) для виртуальных машин на основе Linux.
- Обязательной учетной записью хранения, в которой хранятся виртуальные жесткие диски виртуальной машины, включая диск операционной системы, а также временные и дополнительные диски данных (хранилище).
- Необязательной виртуальной сетью, выступающей в качестве дополнительного контейнера, в котором можно создать структуру подсетей и назначить подсеть, в которой находится виртуальная машина (сеть).

Ресурсы, созданные с использованием модели классического развертывания, имеют следующие характеристики.

- Они создаются с помощью одного из следующих методов:

  - [Классический портал.](https://manage.windowsazure.com)

   ![Классический портал.](./media/resource-manager-deployment-model/azure-portal.png)

   Либо портал Azure. Тогда вы указываете **классический** метод развертывания (для вычислительных, сетевых ресурсов и ресурсов хранения )

   ![Классическое развертывание](./media/resource-manager-deployment-model/select-classic.png)

  - Для Azure PowerShell используйте версию команд для управления службами. Эти команды имеют вид *{Глагол}-Azure{Имя\_существительное}*, как показано ниже.

            Get-AzureDeployment

  - С использованием [API REST управления службами](https://msdn.microsoft.com/library/azure/ee460799.aspx) для операций REST.
  - С использованием команд Azure CLI, выполняемых в режиме **asm** или в режиме по умолчанию.
- Тип ресурса включает **(классический)** в названии. На следующем рисунке тип отображается как **Учетная запись хранения (классическая)**.

   ![классический тип](./media/resource-manager-deployment-model/classic-type.png)

Для управления ресурсами, созданными с помощью классического развертывания, по-прежнему можно использовать портал Azure.

Ниже перечислены компоненты управления службами Azure и их связи.

  ![](./media/virtual-machines-azure-resource-manager-architecture/arm_arch1.png)

## Преимущества использования диспетчера ресурсов и групп ресурсов

С появлением диспетчера ресурсов было добавлено понятие группы ресурсов. Каждый ресурс, который создается с помощью диспетчера ресурсов, входит в состав группы ресурсов. Модель развертывания диспетчера ресурсов предоставляет несколько преимуществ.

- Вы можете осуществлять развертывание, управление и мониторинг всех служб вашего решения как единой группы вместо того, чтобы работать с ними по отдельности.
- Вы можете повторно разворачивать приложение на протяжении всего его жизненного цикла и гарантировать, что ресурсы развертываются в согласованном состоянии.
- Вы можете использовать декларативные шаблоны для определения развертывания.
- Вы можете определять зависимости между ресурсами, так чтобы они разворачивались в правильном порядке.
- Вы можете применить контроль доступа ко всем ресурсам, так как контроль доступа на основе ролей (RBAC) изначально интегрирован в платформу управления.
- Вы можете применять к ресурсам теги для логической организации всех ресурсов в вашей подписке.


До появления диспетчера ресурсов каждый ресурс, который создавался с помощью классического развертывания, не являлся членом группы ресурсов. При появлении диспетчера ресурсов все ресурсы были добавлены в группы ресурсов по умолчанию. Теперь при классическом развертывании ресурсы будут автоматически создаваться в группе ресурсов, заданной для этой службы по умолчанию. Указывать ее не нужно. Однако только принадлежность к группе ресурсов не означает, что ресурс был преобразован в модель диспетчера ресурсов. Для виртуальных машин, хранения и виртуальных сетей, если ресурс был создан при помощи классического развертывания, необходимо продолжать работать с ним с помощью классических операций.

Ресурсы можно переместить в другую группу ресурсов; новые ресурсы также можно добавить в существующую группу ресурсов. Таким образом, в одной группе ресурсов могут находиться ресурсы, созданные с помощью диспетчера ресурсов и классического развертывания. Это сочетание ресурсов может привести к непредвиденным результатам, поскольку эти ресурсы не поддерживают одни и те же операции.

С помощью декларативных шаблонов можно упростить сценарии для развертывания. Вместо того чтобы пытаться преобразовать существующие сценарии из модели управления службами к модели диспетчера ресурсов, подумайте о переработке своей стратегии развертывания для определения инфраструктуры и конфигурации в шаблоне.

## Использование тегов

Теги дают возможность логически организовать ресурсы. Теги поддерживаются только ресурсами, созданными с помощью диспетчера ресурсов. К классическим ресурсам теги применить нельзя.

Дополнительные сведения об использовании тегов в диспетчере ресурсов см. в статье [Использование тегов для организации ресурсов Azure](resource-group-using-tags.md).

## Поддерживаемые операции для моделей развертывания

Ресурсы, которые созданы в классической модели развертывания, не поддерживают операции диспетчера ресурсов. В некоторых случаях с помощью команды диспетчера ресурсов можно получить сведения о ресурсе, созданном с помощью классического развертывания, или выполнить административные задачи, такие как перемещение классического ресурса в другую группу ресурсов, но эти случаи не должны создавать впечатление того, что этот тип поддерживает операции диспетчера ресурсов. Например, предположим, что имеется группа ресурсов, содержащих виртуальные машины, которые были созданы с помощью диспетчера ресурсов и классического развертывания. Если выполнить следующую команду PowerShell:

    Get-AzureRmResourceGroup -Name ExampleGroup

она вернет все виртуальные машины:

    Resources :
     Name                 Type                                          Location
     ================     ============================================  ========
     ExampleClassicVM     Microsoft.ClassicCompute/domainNames          eastus
     ExampleClassicVM     Microsoft.ClassicCompute/virtualMachines      eastus
     ExampleResourceVM    Microsoft.Compute/virtualMachines             eastus
    ...

Однако если выполнить команду **Get-AzureRmVM**:

    Get-AzureRmVM -ResourceGroupName ExampleGroup

вы получите только те виртуальные машины, которые были созданы с помощью диспетчера ресурсов.

    Id       : /subscriptions/xxxx/resourceGroups/ExampleGroup/providers/Microsoft.Compute/virtualMachines/ExampleResourceVM
    Name     : ExampleResourceVM
    ...

В общем случае, не следует ожидать, что ресурсы, созданные с помощью классического развертывания, будут работать с командами диспетчера ресурсов.

При работе с ресурсами, созданными с помощью диспетчера ресурсов, необходимо использовать операции диспетчера ресурсов и не возвращаться к операциям управления службами.

## Рекомендации для виртуальных машин

Вот некоторые важные особенности, которые следует учитывать при работе с виртуальными машинами.

- Виртуальные машины, развернутые с помощью классической модели развертывания, нельзя включить в виртуальную сеть, развернутую с помощью диспетчера ресурсов.
- Виртуальные машины, развернутые с помощью модели развертывания диспетчера ресурсов, должны быть включены в виртуальную сеть.
- Виртуальные машины, развернутые с помощью классической модели развертывания, включать в виртуальную сеть необязательно.

Если простой для виртуальных машин является допустимым, можно перенести их из классического развертывания в диспетчер ресурсов с помощью [скриптов PowerShell ASM2ARM](https://github.com/fullscale180/asm2arm).

Список эквивалентных команд Azure CLI при переходе от классического развертывания к развертыванию диспетчера ресурсов см. в разделе [Эквивалентные команды диспетчера ресурсов и управления службами для задач виртуальных машин](./virtual-machines/virtual-machines-linux-cli-manage.md).

Дополнительные сведения о процессе перехода вычислительных, сетевых ресурсов и ресурсов службы хранилища см. в статье [Поставщики вычислительных и сетевых ресурсов, а также ресурсов службы хранилища Azure в диспетчере ресурсов Azure](./virtual-machines/virtual-machines-windows-compare-deployment-models.md).

Сведения о подключении виртуальных сетей с помощью различных моделей развертывания см. в статье [Подключение классических виртуальных сетей к новым виртуальным сетям](./virtual-network/virtual-networks-arm-asm-s2s.md).

## Дальнейшие действия

- Пошаговые инструкции по созданию шаблона, который определяет виртуальную машину, учетную запись хранилища и виртуальную сеть, см. в разделе [Пошаговое руководство по созданию шаблона Resource Manager](resource-manager-template-walkthrough.md).
- Сведения о структуре шаблонов диспетчера ресурсов см. в разделе [Создание шаблонов Azure Resource Manager](resource-group-authoring-templates.md).
- Команды для развертывания шаблонов см. в статье [Развертывание приложения с помощью шаблона диспетчера ресурсов Azure](resource-group-template-deploy.md).

<!---HONumber=AcomDC_0330_2016-->