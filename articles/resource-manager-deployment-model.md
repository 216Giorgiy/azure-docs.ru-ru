<properties
   pageTitle="Диспетчер ресурсов и классическое развертывание | Microsoft Azure"
   description="Описывает различия между моделью развертывания диспетчера ресурсов и классической моделью развертывания (или моделью управления службами)."
   services="azure-resource-manager"
   documentationCenter="na"
   authors="tfitzmac"
   manager="timlt"
   editor="tysonn"/>

<tags
   ms.service="azure-resource-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="07/29/2016"
   ms.author="tomfitz"/>

# Развертывание с помощью Azure Resource Manager и классическое развертывание: сведения о моделях развертывания и состоянии ресурсов

В этом разделе приводятся сведения о диспетчере ресурсов Azure Resource Manager, классических моделях развертывания, состоянии ресурсов и о том, почему для развертывания ресурсов используется тот или иной метод. Модель развертывания с помощью диспетчера ресурсов имеет важные отличия от классической модели развертывания, и эти две модели не являются полностью совместимыми друг с другом. Чтобы упростить развертывание и управление ресурсами, корпорация Майкрософт рекомендует использовать диспетчер ресурсов для новых ресурсов и, если это возможно, для повторного развертывания существующих ресурсов через диспетчер ресурсов.

Если вы еще не работали с Resource Manager, сначала рекомендуется ознакомиться с терминологией в статье [Общие сведения об Azure Resource Manager](resource-group-overview.md).

## История моделей развертывания

Изначально Azure предоставлял только классическую модель развертывания. В этой модели ресурсы использовались отдельно, и их нельзя было сгруппировать. Вместо этого требовалось вручную отслеживать ресурсы, которые использовались для создание решения или приложения, а затем соответствующим образом управлять ими. Чтобы развернуть решение, требовалось либо создать каждый ресурс отдельно с помощью классического портала, либо создать скрипт для развертывания всех ресурсов в установленном порядке. Удаление решения выполнялось путем удаления каждого ресурса по отдельности. Применение и обновление политик контроля доступа также было связано с определенными трудностями. И наконец, к ресурсам нельзя было применять теги и задавать метки, которые позволяют выполнять мониторинг ресурсов и управлять выставлением счетов.

С появлением Resource Manager (в 2014 г.) было добавлено понятие группы ресурсов. Группа ресурсов — это контейнер для ресурсов с общим жизненным циклом. Модель развертывания диспетчера ресурсов предоставляет несколько преимуществ.

- Вы можете осуществлять развертывание, управление и мониторинг всех служб вашего решения как единой группы вместо того, чтобы работать с ними по отдельности.
- Вы можете повторно развертывать решение на протяжении всего его жизненного цикла и гарантировать, что ресурсы развертываются в согласованном состоянии.
- Вы можете применить контроль доступа ко всем ресурсам в группе, и эти политики будут автоматически применяться ко всем новым ресурсам, добавленным в группу.
- Вы можете применять к ресурсам теги для логической организации всех ресурсов в вашей подписке.
- Для определения инфраструктуры решения можно использовать нотацию объектов JavaScript (JSON). Файл JSON представляет собой шаблон Resource Manager.
- Вы можете определять зависимости между ресурсами, так чтобы они разворачивались в правильном порядке.

При появлении диспетчера ресурсов все ресурсы были добавлены в группы ресурсов по умолчанию. Теперь при классическом развертывании ресурсы будут автоматически создаваться в группе ресурсов, заданной для этой службы по умолчанию. Указывать ее не нужно. Однако только принадлежность к группе ресурсов не означает, что ресурс был преобразован в модель диспетчера ресурсов. Обработка службами этих двух моделей развертывания рассматривается в следующем разделе.

## Общие сведения о поддержке моделей развертывания 

При выборе модели развертывания для ресурсов необходимо учитывать следующие три сценария:

1. Служба поддерживает Resource Manager и предоставляет только такие операции.
2. Служба поддерживает Resource Manager, но предоставляет два типа операций: для Resource Manager и для классической модели. Это относится только к виртуальным машинам, учетным записям хранения и виртуальным сетям.
3. Служба не поддерживает Resource Manager.

Список служб, поддерживающих Resource Manager, приведен в статье [Поставщики Resource Manager, регионы, версии API и схемы](resource-manager-supported-services.md).

Если используемая служба не поддерживает Resource Manager, используйте для развертывания классическую модель.

Если служба поддерживает Resource Manager и в качестве нее **не** используется виртуальная машина, учетная запись хранения или виртуальная сеть, вы можете использовать такую модель развертывания.

Для виртуальных машин, учетных записей хранения и виртуальных сетей, если ресурс был создан при помощи классического развертывания, необходимо продолжать работать с ним с помощью классических операций. Если виртуальная машина, учетная запись хранения или виртуальная сеть созданы с помощью модели развертывания Resource Manager, они поддерживают операции Resource Manager. Это различие особенно следует учитывать, если в подписке содержатся как ресурсы, созданные в классической модели развертывания, так и ресурсы, созданные при помощи Resource Manager. Это сочетание ресурсов может привести к непредвиденным результатам, поскольку эти ресурсы не поддерживают одни и те же операции.

В некоторых случаях с помощью команды Resource Manager можно получить сведения о ресурсе, созданном с помощью классического развертывания, или выполнить административные задачи, такие как перемещение классического ресурса в другую группу ресурсов, но эти случаи не должны создавать впечатление того, что этот тип поддерживает операции Resource Manager. Например, предположим, что имеется группа ресурсов, содержащая виртуальную машину, которая была создана с помощью классического развертывания. Если выполнить следующую команду Resource Manager PowerShell:

    Get-AzureRmResource -ResourceGroupName ExampleGroup -ResourceType Microsoft.ClassicCompute/virtualMachines

Она вернет виртуальную машину.
    
    Name              : ExampleClassicVM
    ResourceId        : /subscriptions/{guid}/resourceGroups/ExampleGroup/providers/Microsoft.ClassicCompute/virtualMachines/ExampleClassicVM
    ResourceName      : ExampleClassicVM
    ResourceType      : Microsoft.ClassicCompute/virtualMachines
    ResourceGroupName : ExampleGroup
    Location          : westus
    SubscriptionId    : {guid}

Однако командлет Resource Manager **Get-AzureRmVM** возвращает только виртуальные машины, развернутые с помощью Resource Manager. Следующая команда не вернет виртуальную машину, созданную с помощью классического развертывания.

    Get-AzureRmVM -ResourceGroupName ExampleGroup

Вот некоторые важные особенности, которые следует учитывать при работе с виртуальными машинами.

- Виртуальные машины, развернутые с помощью классической модели развертывания, нельзя включить в виртуальную сеть, развернутую с помощью диспетчера ресурсов.
- Виртуальные машины, развернутые с помощью модели развертывания диспетчера ресурсов, должны быть включены в виртуальную сеть.
- Виртуальные машины, развернутые с помощью классической модели развертывания, включать в виртуальную сеть необязательно.

Сведения о подключении виртуальных сетей с помощью различных моделей развертывания см. в статье [Подключение классических виртуальных сетей к новым виртуальным сетям](./virtual-network/virtual-networks-arm-asm-s2s.md).

Теги поддерживаются только ресурсами, созданными с помощью диспетчера ресурсов. К классическим ресурсам теги применить нельзя. Дополнительные сведения об использовании тегов в диспетчере ресурсов см. в статье [Использование тегов для организации ресурсов Azure](resource-group-using-tags.md).

## Характеристики диспетчера ресурсов

Чтобы разобраться с двумя моделями развертывания, давайте рассмотрим характеристики ресурсов, созданных с использованием Resource Manager.

- Создаются с помощью [портала Azure](https://portal.azure.com/).

     ![Портал Azure](./media/resource-manager-deployment-model/portal.png)

     Для вычислительных, сетевых ресурсов и ресурсов хранения можно выбрать модель развертывания с использованием Resource Manager или классическую модель. Выберите **Диспетчер ресурсов**.

     ![Развертывание с помощью Resource Manager](./media/resource-manager-deployment-model/select-resource-manager.png)

- Создаются с помощью командлетов Azure PowerShell для Resource Manager. Эти команды имеют вид *{глагол}-AzureRm{имя\_существительное}*, как показано ниже.

        New-AzureRmResourceGroupDeployment

- Создаются с помощью [REST API Azure Resource Manager](https://msdn.microsoft.com/library/azure/dn790568.aspx) для операций REST.

- Создаются с помощью команд интерфейса командной строки Azure, запускаемых в режиме **arm**.

        azure config mode arm
        azure group deployment create 

- Тип ресурса не содержит **(классический)** в имени. На следующем рисунке тип отображается как **Учетная запись хранения**.

    ![веб-приложение](./media/resource-manager-deployment-model/resource-manager-type.png)

Приложение, изображенное на следующем рисунке, показывает, как ресурсы, развертываемые через диспетчер ресурсов, содержатся в одной группе ресурсов.

  ![Архитектура Resource Manager](./media/virtual-machines-azure-resource-manager-architecture/arm_arch3.png)

Кроме того, существуют связи между ресурсами в поставщиках ресурсов:

- Виртуальная машина зависит от определенной учетной записи хранения, определенной в SRP для хранения ее дисков в хранилище больших двоичных объектов (обязательном).
- Виртуальная машина ссылается на конкретную сетевую карту, определенную в NRP (обязательную), и группу доступности, определенные в CRP (необязательную).
- Сетевая карта ссылается на назначенный виртуальной машине IP-адрес (обязательный), подсеть виртуальной сети для виртуальной машины (обязательную) и группу сетевой безопасности (необязательную).
- Подсеть в виртуальной сети ссылается на группу сетевой безопасности (необязательную).
- Экземпляр подсистемы балансировки нагрузки ссылается на пул внутренних IP-адресов, который включают сетевую карту виртуальной машины (необязательно), и ссылается на общедоступный или частный IP-адрес (необязательно) подсистемы балансировки нагрузки.

## Характеристики классического развертывания

Возможно, вы знакомы с классической моделью развертывания как с моделью управления службами.

Ресурсы, созданные с использованием модели классического развертывания, имеют следующие характеристики.

- Создаются с помощью [классического портала](https://manage.windowsazure.com).

     ![Классический портал.](./media/resource-manager-deployment-model/classic-portal.png)

     Либо с помощью портала Azure. Тогда вы указываете **классический** метод развертывания (для вычислительных, сетевых ресурсов и ресурсов хранения).

     ![Классическое развертывание](./media/resource-manager-deployment-model/select-classic.png)

- Создаются с помощью командлетов Azure PowerShell для управления службами. Эти команды имеют вид *{глагол}-Azure{имя\_существительное}*, как показано ниже.

        New-AzureVM 

- Создаются с помощью [REST API управления службами](https://msdn.microsoft.com/library/azure/ee460799.aspx) для операций REST.
- Создаются с помощью команд интерфейса командной строки Azure, запускаемых в режиме **asm**.

        azure config mode asm
        azure vm create 

- Тип ресурса включает **(классический)** в названии. На следующем рисунке тип отображается как **Учетная запись хранения (классическая)**.

    ![классический тип](./media/resource-manager-deployment-model/classic-type.png)

Для управления ресурсами, созданными с помощью классического развертывания, по-прежнему можно использовать портал Azure.

В управлении службами Azure вычислительные, сетевые ресурсы и ресурсы хранения данных для размещения виртуальных машин предоставляются:

- Требуемой облачной службой, которая выступает в роли контейнера для размещения виртуальных машин (вычислений). Виртуальным машинам автоматически предоставляется сетевая карта (NIC) и IP-адрес, назначаемый Azure. Кроме того, облачная служба содержит экземпляр внешней подсистемы балансировки нагрузки, общедоступный IP-адрес и конечные точки по умолчанию, чтобы разрешить трафик удаленного рабочего стола и удаленный трафик PowerShell для виртуальных машин на основе Windows, а также трафик Secure Shell (SSH) для виртуальных машин на основе Linux.
- Обязательной учетной записью хранения, в которой хранятся виртуальные жесткие диски виртуальной машины, включая диск операционной системы, а также временные и дополнительные диски данных (хранилище).
- Необязательной виртуальной сетью, выступающей в качестве дополнительного контейнера, в котором можно создать структуру подсетей и назначить подсеть, в которой находится виртуальная машина (сеть).

Ниже перечислены компоненты управления службами Azure и их связи.

  ![классическая архитектура](./media/virtual-machines-azure-resource-manager-architecture/arm_arch1.png)

## Переход с классической модели развертывания на модель Resource Manager

Дополнительные сведения о переходе с классической модели развертывания на модель Resource Manager см. в следующих источниках:

1. [Техническое руководство по поддерживаемому платформой переносу из классической модели в модель Azure Resource Manager](./virtual-machines/virtual-machines-windows-migration-classic-resource-manager-deep-dive.md)
2. [Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager](./virtual-machines/virtual-machines-windows-migration-classic-resource-manager.md)
3. [Перенос ресурсов IaaS из классической модели в модель Azure Resource Manager с помощью Azure PowerShell](./virtual-machines/virtual-machines-windows-ps-migration-classic-resource-manager.md)
4. [Перенос ресурсов IaaS из классического развертывания в развертывание с помощью Azure Resource Manager с использованием Azure CLI](./virtual-machines/virtual-machines-linux-cli-migration-classic-resource-manager.md)

## Дальнейшие действия

- Пошаговые инструкции по созданию шаблона, который определяет виртуальную машину, учетную запись хранения и виртуальную сеть, см. в статье [Пошаговое руководство по созданию шаблона Resource Manager](resource-manager-template-walkthrough.md).
- Сведения о структуре шаблонов Resource Manager см. в разделе [Создание шаблонов Azure Resource Manager](resource-group-authoring-templates.md).
- Команды для развертывания шаблонов см. в статье [Развертывание приложения с помощью шаблона диспетчера ресурсов Azure](resource-group-template-deploy.md).

<!---HONumber=AcomDC_0803_2016-->