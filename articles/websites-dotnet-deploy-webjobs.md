<properties 
	pageTitle="Развертывание веб-заданий с помощью Visual Studio" 
	description="Узнайте, как развернуть веб-задания Azure в веб-приложениях службы приложений Azure с помощью Visual Studio." 
	services="app-service\web" 
	documentationCenter="" 
	authors="tdykstra" 
	manager="wpickett" 
	editor="jimbe"/>

<tags 
	ms.service="app-service-web" 
	ms.devlang="dotnet" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.workload="web" 
	ms.date="03/24/2015" 
	ms.author="tdykstra"/>

# Развертывание веб-заданий с помощью Visual Studio

## Обзор

В этом разделе объясняется, как использовать Visual Studio для развертывания проекта консоли в веб-приложении [службы приложений](http://go.microsoft.com/fwlink/?LinkId=529714) как [веб-задания Azure](http://go.microsoft.com/fwlink/?LinkId=390226). Дополнительную информацию о развертывании веб-заданий с помощью [портала Azure](http://go.microsoft.com/fwlink/?LinkId=529715) см. в разделе [Выполнение фоновых задач с веб-заданий помощью веб-заданий](web-sites-create-web-jobs.md).

При развертывании в Visual Studio проекта приложения консоли с поддержкой веб-заданий выполняются две задачи.

* Копирование файлов среды выполнения в соответствующую папку в веб-приложении (*App_Data/jobs/continuous* - для постоянных веб-заданий, *App_Data/jobs/triggered* - для запланированных веб-заданий и веб-заданий по запросу).
* Настройка [заданий планировщика Azure](#scheduler) для заданий WebJob, выполнение которых запланировано на определенное время. (Это не требуется для постоянных веб-заданий.)

Проект с поддержкой веб-заданий содержит следующие добавленные элементы.

* Пакет NuGet [Microsoft.Web.WebJobs.Publish](http://www.nuget.org/packages/Microsoft.Web.WebJobs.Publish/).
* Файл [webjob-publish-settings.json],(#publishsettings) который содержит параметры развертывания и планировщика. 

![Diagram showing what is added to a Console App to enable deployment as a WebJob](./media/websites-dotnet-deploy-webjobs/convert.png)

Вы можете добавить эти элементы в существующий проект приложения консоли или использовать шаблон для создания нового проекта приложения консоли с поддержкой веб-заданий. 

Можно развернуть проект как веб-задание или связать его с веб-проектом для автоматического развертывания при каждом развертывании веб-проекта. Чтобы связать проекты, Visual Studio включает имя проекта с поддержкой веб-заданий в файле [webjobs-list.json](#webjobslist) веб-проекта.

![Diagram showing WebJob project linking to web project](./media/websites-dotnet-deploy-webjobs/link.png)
 


## Предварительные требования

Функции развертывания веб-заданий доступны в Visual Studio 2013 при установке вами пакета SDK Azure версии 2.4 или более поздней:

* [Пакет SDK Azure для Visual Studio 2013](http://go.microsoft.com/fwlink/p/?linkid=323510&clcid=0x409).

Функции развертывания заданий WebJob также включаются в [Visual Studio 2013 обновление 3](http://go.microsoft.com/fwlink/?linkid=397827&clcid=0x409) и более поздних обновлений.

## <a id="convert"></a>Включение развертывания заданий WebJob для существующего проекта приложений консоли

Существует два варианта.

* [Включение автоматического развертывания с веб-проектом](#convertlink).

	Настройка существующего проекта приложения консоли для автоматического развертывания в качестве веб-приложения при развертывании веб-проекта. Используйте этот параметр, если нужно запустить веб-задание в том же веб-приложении, в котором запущено связанное веб-приложение.

* [Включение развертывания без веб-проекта](#convertnolink).

	Настройка существующего проекта приложения консоли для развертывания в качестве веб-задания без ссылки на веб-проект. Используйте этот параметр, если нужно запустить веб-задание в веб-приложении самостоятельно, без веб-приложения, запущенного в веб-приложении. Это может понадобиться для независимого масштабирования ресурсов веб-заданий ресурсов веб-приложений.

### <a id="convertlink"></a> Включение автоматического развертывания заданий WebJob с веб-проектом
  
1. Щелкните правой кнопкой мыши проект в **обозревателе решений** и нажмите кнопку **Добавить** > **Существующий проект как Azure WebJob**.

	![Existing Project as Azure WebJob](./media/websites-dotnet-deploy-webjobs/eawj.png)
	
	Появится диалоговое окно [Добавление задания Azure WebJob](#configure) .

1. В раскрывающемся списке **Имя проекта** выберите проект приложения консоли для добавления в качестве задания WebJob.

	![Selecting project in Add Azure WebJob dialog](./media/websites-dotnet-deploy-webjobs/aaw1.png)

2. Заполните диалоговое окно [Добавление задания Azure WebJob](#configure) и нажмите кнопку **ОК**. 

### <a id="convertnolink"></a> Включение развертывания заданий WebJob без веб-проекта
  	
1. Щелкните правой кнопкой мыши проект приложения консоли в **обозревателе решений** и нажмите кнопку **Опубликовать как задание Azure WebJob**. 

	![Publish as Azure WebJob](./media/websites-dotnet-deploy-webjobs/paw.png)
	
	Появится диалоговое окно [Добавление задания Azure WebJob](#configure) Azure с проектом, выбранным в поле **Имя проекта**.

2.  Заполните диалоговое окно [Добавление задания Azure WebJob](#configure) и нажмите **ОК**.

	Откроется мастер **веб-публикации**.  Если вы не хотите сразу выполнить публикацию, закройте мастер. Указанные параметры сохраняются до момента [развертывания проекта](#deploy).

## <a id="create"></a>Создание нового проекта с поддержкой заданий WebJob

Чтобы создать проект с поддержкой заданий WebJob, можно использовать шаблон проекта приложения консоли и включить развертывание заданий WebJob, как показано в [предыдущем разделе](#convert). В качестве альтернативы можно использовать шаблон создания проекта с поддержкой веб-заданий:

* [Использование шаблона создания проекта заданий WebJob для отдельного задания WebJob](#createnolink)

	Создайте проект и настройте его для развертывания в качестве веб-задания без ссылки на веб-проект. Используйте этот параметр, если нужно запустить веб-задание в веб-приложении самостоятельно, без веб-приложения, запущенного в веб-приложении. Это может понадобиться для независимого масштабирования ресурсов веб-заданий ресурсов веб-приложений.

* [Использование шаблона создания проекта с поддержкой заданий WebJob для задания WebJob, связанного с веб-проектом](#createlink)

	Создайте проект, настроенный для автоматического развертывания, как веб-задание при развертывании веб-проекта в том же решении. Используйте этот параметр, если нужно запустить веб-задание в том же веб-приложении, в котором запущено связанное веб-приложение.

В выпуске SDK 2.4 шаблон создания проекта с поддержкой веб-заданий является не более простым, чем создание проекта приложения консоли или включение развертывания веб-заданий. В дальнейшем шаблон создания проекта с поддержкой заданий WebJob будет более удобным для разработки [пакета SDK для заданий WebJob](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/getting-started-with-windows-azure-webjobs), поскольку он будет автоматически устанавливать соответствующие пакеты NuGet SDK для заданий WebJob. До этого, чтобы настроить проект для использования пакета SDK для заданий WebJob, можно установить пакеты вручную, как показано в [учебнике по пакету SDK для заданий WebJob](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/getting-started-with-windows-azure-webjobs). 


### <a id="createnolink"></a> Использование шаблона создания проекта заданий WebJob для отдельного задания WebJob
  
1. Щелкните меню **Файл** > **Создать проект**, а затем в диалоговом окне **Новый проект** нажмите кнопку **Облако** > **Задание Microsoft Azure WebJob**.

	![New Project dialog showing WebJob template](./media/websites-dotnet-deploy-webjobs/np.png)
	
2. Следуйте указаниям, показанным ранее, чтобы [сделать проект приложения консоли независимым проектом заданий WebJob.](#convertnolink).

### <a id="createlink"></a>Использование шаблона создания проекта с поддержкой заданий WebJob для задания WebJob, связанного с веб-проектом

1. Щелкните правой кнопкой мыши проект в **обозревателе решений** и нажмите кнопку **Добавить** >**Новый проект Azure WebJob**.

	![New Azure WebJob Project menu entry](./media/websites-dotnet-deploy-webjobs/nawj.png)

	Появится диалоговое окно [Добавление задания Azure WebJob](#configure) .

2. Заполните диалоговое окно [Добавление задания Azure WebJob](#configure) и нажмите **ОК**.

## <a id="configure"></a>Диалоговое окно "Добавление Azure WebJob"

Диалоговое окно **Добавление Azure WebJob** позволяет ввести имя задания WebJob и параметры планирования для задания WebJob. 

![Add Azure WebJob dialog](./media/websites-dotnet-deploy-webjobs/aaw2.png)

Поля в этом диалоговом окне соответствуют полям в диалоговом окне **Новое задание** портала управления Azure. дополнительные сведения содержатся в разделе [Run Background tasks with WebJobs](web-sites-create-web-jobs.md).

Для запланированного веб-задания (не для постоянных веб-заданий) Visual Studio создает коллекцию заданий [планировщика Azure](/services/scheduler/), если она еще не существует, и создает задание в коллекции.

* Коллекция заданий планировщика называется *WebJobs-{regionname}*, где *{regionname}* - регион, в котором размещен веб-сайт. Например: WebJobs-WestUS.
* Задание планировщика называется *{websitename}-{webjobname}*. Например: MyWebSite-MyWebJob. 
 
>[AZURE.NOTE]
> 
>* Дополнительную информацию о развертывании из командной строки см. в разделе [Включение выполнения веб-заданий Azure в непрерывном режиме или в режиме командной строки](/blog/2014/08/18/enabling-command-line-or-continuous-delivery-of-azure-webjobs/).
>* Если вы настраиваете **повторяющееся задание** и задаете частоту повторений в минутах, за службу планировщика Azure будет взиматься плата. Частота в часах, днях и т. д. бесплатна.
>* Если вы развертываете веб-задание, а затем изменяете режим выполнения с постоянного на непостоянный или наоборот, Visual Studio создаст новое веб-задание в Azure при повторном развертывании. При изменении других параметров планирования но сохранении режима выполнения или при переключении между режимами "Запланировано" и "По запросу" Visual Studio обновляет существующее задание, а не создает новое.

## <a id="publishsettings"></a>webjob-publish-settings.json

При настройке консольного приложения для развертывания заданий Visual Studio WebJob устанавливает NuGet-пакет [Microsoft.Web.WebJobs.Publish](http://www.nuget.org/packages/Microsoft.Web.WebJobs.Publish/) 
и сохраняет информацию о планировании в файле *webjob-publish-settings.json* в папке *Properties* проекта WebJobs. Вот пример этого файла:

		{
		  "$schema": "http://schemastore.org/schemas/json/webjob-publish-settings.json",
		  "webJobName": "WebJob1",
		  "startTime": "2014-06-23T00:00:00-08:00",
		  "endTime": "2014-06-27T00:00:00-08:00",
		  "jobRecurrenceFrequency": "Minute",
		  "interval": 5,
		  "runMode": "Scheduled"
		}

Вы можете изменить этот файл напрямую, и Visual Studio предоставит IntelliSense. Схема файла сохранена на сайте [http://schemastore.org](http://schemastore.org/schemas/json/webjob-publish-settings.json), и ее можно просмотреть здесь.  

>[AZURE.NOTE]
>
>* Если вы настраиваете **повторяющееся задание** и задаете частоту повторений в минутах, за службу планировщика Azure будет взиматься плата. Частота в часах, днях и т. д. бесплатна.

## <a id="webjobslist"></a>webjobs-list.json

При связывании проекта с поддержкой заданий WebJob с веб-проектом среда Visual Studio сохраняет имя проекта WebJobs в файле *webjobs-list.json* в папке *Properties*. Список может содержать несколько проектов веб-заданий, как показано в следующем примере:

		{
		  "$schema": "http://schemastore.org/schemas/json/webjobs-list.json",
		  "WebJobs": [
		    {
		      "filePath": "../ConsoleApplication1/ConsoleApplication1.csproj"
		    },
		    {
		      "filePath": "../WebJob1/WebJob1.csproj"
		    }
		  ]
		}

Вы можете изменить этот файл напрямую, и Visual Studio предоставит IntelliSense. Схема файла сохранена на сайте [http://schemastore.org](http://schemastore.org/schemas/json/webjobs-list.json), и ее можно просмотреть здесь.
  
## <a id="deploy"></a>Развертывание проекта заданий WebJob

Проект веб-заданий, связанный с веб-проектом, развертывается автоматически с веб-проектом. Информацию о развертывании веб-проектов см. в разделе [Развертывание веб-приложений](web-sites-deploy.md).

Чтобы развернуть проект заданий WebJob, щелкните правой кнопкой мыши проект в **обозревателе решений** и нажмите **Опубликовать как задание AzureWebJob**. 

![Publish as Azure WebJob](./media/websites-dotnet-deploy-webjobs/paw.png)
	
Для независимого задания WebJob отобразится тот же мастер **веб-публикации**, который использовался для веб-проектов, но некоторые параметры будут недоступны для изменения.

>[AZURE.NOTE] Если вы хотите начать работу со службой приложений Azure еще до создания учетной записи Azure, перейдите на страницу [ознакомительной версии службы приложений](http://go.microsoft.com/fwlink/?LinkId=523751). Там вы сможете сразу создать свое первое веб-приложение, правда срок его службы будет ограничен. Никаких кредитных карт и обязательств.

## <a id="nextsteps"></a>Дальнейшие действия

Дополнительную информацию о развертывании заданий Azure WebJob из Visual Studio и использовании режима непрерывного выполнения см. в разделе [Развертывание статьи "Рекомендуемые ресурсы веб-заданий Azure"](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/azure-webjobs-recommended-resources#deploying).

## Изменения
* Сведения об изменении веб-сайтов на службу приложений см. в статье [Служба приложений Azure и ее влияние на существующие службы Azure](http://go.microsoft.com/fwlink/?LinkId=529714)
* Сведения о переходе со старого портала на новый см. в статье [Справочная информация о навигации по предварительной версии портала](http://go.microsoft.com/fwlink/?LinkId=529715).

<!--HONumber=49-->