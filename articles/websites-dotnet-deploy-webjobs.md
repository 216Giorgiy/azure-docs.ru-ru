<properties linkid="websites-dotnet-deploy-webjobs" urlDisplayName="Deploy Azure WebJobs to Azure Websites" pageTitle="Deploy Azure WebJobs to Azure Websites" metaKeywords="Azure Websites, WebJobs, background tasks" description="Learn how to deploy Azure WebJobs to Azure Websites using Visual Studio." metaCanonical="" services="web-sites" documentationCenter="" title="Deploy Azure WebJobs to Azure Websites" authors="tdykstra"  solutions="" manager="wpickett" editor="mollybos"  />

# Развертывание веб-заданий Azure на веб-сайтах Azure

В этом разделе объясняется, как использовать Visual Studio для развертывания проекта консоли на веб-сайте Azure как [веб-задания Azure][веб-задания Azure]. Другой способ развертывания веб-заданий — использовать портал управления Azure; сведения об этом методе см. в разделе [Использование веб-заданий для запуска фоновых задач в веб-сайтах Microsoft Azure][Использование веб-заданий для запуска фоновых задач в веб-сайтах Microsoft Azure].

## Оглавление

-   [Обзор][Обзор]
-   [Предварительные требования][Предварительные требования]
-   [Включение развертывания веб-заданий для существующего проекта приложений консоли][Включение развертывания веб-заданий для существующего проекта приложений консоли]
-   [Создание нового проекта с поддержкой веб-заданий][Создание нового проекта с поддержкой веб-заданий]
-   [Диалоговое окно "Добавление веб-заданий Azure"][Диалоговое окно "Добавление веб-заданий Azure"]
-   [Файл webjob-publish-settings.json][Файл webjob-publish-settings.json]
-   [Файл webjobs-list.json][Файл webjobs-list.json]
-   [Развертывание проекта веб-заданий][Развертывание проекта веб-заданий]
-   [Дальнейшие действия][Дальнейшие действия]

## <span id="overview"></span></a>Обзор

При развертывании в Visual Studio проекта приложения консоли с поддержкой веб-заданий выполняются две задачи.

-   Копирование файлов среды выполнения в соответствующую папку на веб-сайте Azure (*App\_Data/jobs/continuous* для постоянных веб-заданий, *App\_Data/jobs/triggered* для запланированных веб-заданий и веб-заданий по запросу).
-   Указание [заданий планировщика Azure][заданий планировщика Azure] для веб-заданий, которые запланированы на выполнение в определенное время. (Это не требуется для постоянных веб-заданий.)

Проект с поддержкой веб-заданий содержит следующие добавленные элементы.

-   Пакет NuGet [Microsoft.Web.WebJobs.Publish][Microsoft.Web.WebJobs.Publish].
-   Файл [webjob-publish-settings.json][Файл webjob-publish-settings.json], который содержит параметры развертывания и планировщика.

![Диаграмма, отображающая добавленные элементы в приложение консоли для реализации развертывания как веб-задания][Диаграмма, отображающая добавленные элементы в приложение консоли для реализации развертывания как веб-задания]

Вы можете добавить эти элементы в существующий проект приложения консоли или использовать шаблон для создания нового проекта приложения консоли с поддержкой веб-заданий.

Можно развернуть проект как веб-задание или связать его с веб-проектом для автоматического развертывания при каждом развертывании веб-проекта. Чтобы связать проекты, Visual Studio включает имя проекта с поддержкой веб-заданий в файле [webjobs-list.json][Файл webjobs-list.json] веб-проекта.

![Диаграмма, отображающая проект веб-задания, связанный с веб-проектом][Диаграмма, отображающая проект веб-задания, связанный с веб-проектом]

## Предварительные требования

Функции развертывания веб-заданий доступны в Visual Studio 2013 при установке пакета SDK Azure версии 2.4 или более поздней:

-   [Пакет SDK Azure для Visual Studio 2013][Пакет SDK Azure для Visual Studio 2013].

Функции развертывания веб-заданий также включены в [Обновление 3][Обновление 3].

## <span id="convert"></span></a>Включение развертывания веб-заданий для существующего проекта приложений консоли

Существует два варианта.

-   [Включение автоматического развертывания с веб-проектом][Включение автоматического развертывания с веб-проектом].

    Настройка существующего проекта приложения консоли для автоматического развертывания в качестве веб-приложения при развертывании веб-проекта. Используйте этот параметр, если нужно запустить веб-задание на том же веб-сайте, на котором запущено связанное веб-приложение.

-   [Включение развертывания без веб-проекта][Включение развертывания без веб-проекта].

    Настройка существующего проекта приложения консоли для развертывания в качестве веб-задания без ссылки на веб-проект. Используйте этот параметр, если нужно запустить веб-задание на веб-сайте самостоятельно, без веб-приложения, выполняющегося на веб-сайте. Это может понадобиться для независимого масштабирования ресурсов веб-заданий ресурсов веб-приложений.

### <span id="convertlink"></span></a> Включение автоматического развертывания веб-заданий с веб-проектом

1.  Щелкните правой кнопкой мыши проект в **обозревателе решений** и нажмите кнопку **Добавить** \> **Существующий проект как веб-задание Azure**.

    ![Существующий проект как веб-задание Azure][Существующий проект как веб-задание Azure]

    Откроется диалоговое окно [Добавление веб-задания Azure][Диалоговое окно "Добавление веб-заданий Azure"].

2.  В раскрывающемся списке **Имя проекта** выберите проект приложения консоли для добавления в качестве веб-задания.

    ![Выбор проекта в диалоговом окне "Добавление веб-задания Azure"][Выбор проекта в диалоговом окне "Добавление веб-задания Azure"]

3.  Заполните диалоговое окно [Добавление веб-задания Azure][Диалоговое окно "Добавление веб-заданий Azure"] и щелкните кнопку **ОК**.

### <span id="convertnolink"></span></a> Включение развертывания веб-заданий без веб-проекта

1.  Щелкните правой кнопкой мыши проект приложения консоли в **обозревателе решений** и нажмите кнопку **Опубликовать как веб-задание Azure**.

    ![Публикация в виде веб-задания Azure][Публикация в виде веб-задания Azure]

    Появится диалоговое окно [Добавление веб-задания Azure][Диалоговое окно "Добавление веб-заданий Azure"] с проектом, выбранным в поле **Имя проекта**.

2.  Заполните диалоговое окно [Добавление веб-задания Azure][Диалоговое окно "Добавление веб-заданий Azure"] и щелкните кнопку **ОК**.

    Откроется мастер **веб-публикации**. Если вы не хотите сразу выполнить публикацию, закройте мастер. Указанные параметры сохраняются до момента [развертывания проекта][Развертывание проекта веб-заданий].

## <span id="create"></span></a>Создание нового проекта с поддержкой веб-заданий

Чтобы создать проект с поддержкой веб-заданий, можно использовать шаблон проекта приложения консоли и включить развертывание веб-заданий, как показано в [предыдущем разделе][Включение развертывания веб-заданий для существующего проекта приложений консоли]. В качестве альтернативы можно использовать шаблон создания проекта с поддержкой веб-заданий:

-   [Использование шаблона создания проекта с поддержкой веб-заданий для веб-задания, связанного с веб-проектом][Использование шаблона создания проекта с поддержкой веб-заданий для веб-задания, связанного с веб-проектом]

    Создайте проект, настроенный для автоматического развертывания, как веб-задание при развертывании веб-проекта в том же решении. Используйте этот параметр, если нужно запустить веб-задание на том же веб-сайте, на котором запущено связанное веб-приложение.

-   [Использование шаблона создания проекта веб-заданий для отдельного веб-задания][Использование шаблона создания проекта веб-заданий для отдельного веб-задания]

    Создайте проект и настройте его для развертывания в качестве веб-задания без ссылки на веб-проект. Используйте этот параметр, если нужно запустить веб-задание на веб-сайте самостоятельно, без веб-приложения, выполняющегося на веб-сайте. Это может понадобиться для независимого масштабирования ресурсов веб-заданий ресурсов веб-приложений.

В выпуске SDK 2.4 шаблон создания проекта с поддержкой веб-заданий является не более простым, чем создание проекта приложения консоли или включение развертывания веб-заданий. В дальнейшем шаблон создания проекта с поддержкой веб-заданий будет более удобным для разработки [Пакета SDK веб-заданий][Пакета SDK веб-заданий], поскольку он будет автоматически устанавливать соответствующие пакеты NuGet SDK веб-заданий. До этого, чтобы настроить проект для использования пакета SDK веб-заданий, можно установить пакеты вручную, как показано в [учебнике SDK веб-заданий][Пакета SDK веб-заданий].

### <span id="createlink"></span></a> Использование шаблона создания проекта с поддержкой веб-заданий для веб-задания, связанного с веб-проектом

-   Щелкните правой кнопкой мыши проект в **обозревателе решений** и нажмите кнопку **Добавить** \> **Новый проект веб-задания Azure**.

    ![Запись меню "Новый проект веб-задания Azure"][Запись меню "Новый проект веб-задания Azure"]

    Откроется диалоговое окно [Добавление веб-задания Azure][Диалоговое окно "Добавление веб-заданий Azure"].

-   Заполните диалоговое окно [Добавление веб-задания Azure][Диалоговое окно "Добавление веб-заданий Azure"] и щелкните кнопку **ОК**.

### <span id="createnolink"></span></a> Использование шаблона создания проекта веб-заданий для отдельного веб-задания

1.  Щелкните меню **Файл** \> **Создать проект**, а затем в диалоговом окне **Новый проект** нажмите кнопку **Облако** \> **Веб-задание Microsoft Azure**.

    ![Диалоговое окно "Новый проект", отображающее шаблон веб-заданий][Диалоговое окно "Новый проект", отображающее шаблон веб-заданий]

2.  Следуйте инструкциям, показанным ранее, чтобы [сделать проект приложения консоли независимым проектом веб-заданий][Включение развертывания без веб-проекта].

## <span id="configure"></span></a>Диалоговое окно "Добавление веб-заданий Azure"

Диалоговое окно **Добавление веб-заданий Azure** позволяет ввести имя веб-задания и параметры планирования для веб-задания.

![Диалоговое окно "Добавление веб-заданий Azure"][1]

Поля в этом диалоговом окне соответствуют полям в диалоговом окне **Новое задание** портала управления Azure. Дополнительные сведения см. в разделе [Использование веб-заданий для запуска фоновых задач в веб-сайтах Microsoft Azure][Использование веб-заданий для запуска фоновых задач в веб-сайтах Microsoft Azure].

Для запланированного веб-задания (не для постоянных веб-заданий) Visual Studio создает коллекцию заданий [планировщика Azure][планировщика Azure], если она не существует, и создает задание в коллекции.

-   Коллекция заданий планировщика называется *WebJobs-{regionname}*, где *{regionname}* — регион, в котором размещен веб-сайт. Например: WebJobs-WestUS.
-   Задание планировщика называется *{websitename}-{webjobname}*. Например: MyWebSite-MyWebJob.

> [WACOM.NOTE]
>
> -   Развертывание командной строки с помощью MSBuild не устанавливает расписание для запланированных веб-заданий. Эти функции работают только при развертывании с помощью Visual Studio.
> -   Если вы настраиваете **повторяющееся задание** и задаете частоту повторений в минутах, за службу планировщика Azure будет взиматься плата. Частота в часах, днях и т. д. бесплатна.
> -   Если вы развертываете веб-задание, а затем изменяете режим выполнения с постоянного на непостоянный или наоборот, Visual Studio создаст новое веб-задание в Azure при повторном развертывании. При изменении других параметров планирования но сохранении режима выполнения или при переключении между режимами "Запланировано" и "По запросу" Visual Studio обновляет существующее задание, а не создает новое.

## <span id="publishsettings"></span></a>webjob-publish-settings.json

При настройке приложения консоли для развертывания веб-заданий Visual Studio устанавливает пакет NuGet [Microsoft.Web.WebJobs.Publish][Microsoft.Web.WebJobs.Publish]
и сохраняет сведения о планировании в файле *webjob-publish-settings.json* в папке проекта *Свойства* проекта веб-заданий. Вот пример этого файла:

        {
          "$schema": "http://schemastore.org/schemas/json/webjob-publish-settings.json",
          "webJobName": "WebJob1",
          "startTime": "2014-06-23T00:00:00-08:00",
          "endTime": "2014-06-27T00:00:00-08:00",
          "jobRecurrenceFrequency": "Minute",
          "interval": 5,
          "runMode": "Scheduled"
        }

Вы можете изменить этот файл напрямую, и Visual Studio предоставит IntelliSense. Схема файла сохранена на сайте [][]<http://schemastore.org></a>, и ее можно просмотреть здесь.

> [WACOM.NOTE]
>
> -   Если вы настраиваете **повторяющееся задание** и задаете частоту повторений в минутах, за службу планировщика Azure будет взиматься плата. Частота в часах, днях и т. д. бесплатна.

## <span id="webjobslist"></span></a>webjobs-list.json

При связывании проекта с поддержкой веб-заданий с веб-проектом Visual Studio сохраняет имя проекта веб-заданий в файле *webjobs-list.json* в папке веб-проекта *Свойства*. Список может содержать несколько проектов веб-заданий, как показано в следующем примере:

        {
          "$schema": "http://schemastore.org/schemas/json/webjobs-list.json",
          "WebJobs": [
            {
              "filePath": "../ConsoleApplication1/ConsoleApplication1.csproj"
            },
            {
              "filePath": "../WebJob1/WebJob1.csproj"
            }
          ]
        }

Вы можете изменить этот файл напрямую, и Visual Studio предоставит IntelliSense. Схема файла сохранена на сайте [][2]<http://schemastore.org></a>, и ее можно просмотреть здесь.

## <span id="deploy"></span></a>Развертывание проекта веб-заданий

Проект веб-заданий, связанный с веб-проектом, развертывается автоматически с веб-проектом. Сведения о развертывании веб-проектов см. в разделе [Развертывание веб-сайта Azure][Развертывание веб-сайта Azure].

Чтобы развернуть проект веб-заданий, щелкните правой кнопкой мыши проект в **обозревателе решений** и нажмите **Опубликовать как веб-задание Azure**.

![Публикация в виде веб-задания Azure][Публикация в виде веб-задания Azure]

Для независимого веб-задания отобразится тот же мастер **веб-публикации**, который использовался для веб-проектов, но некоторые параметры будут недоступны для изменения.

## <span id="nextsteps"></span></a> Дальнейшие действия

Дополнительные сведения о веб-заданиях Azure и пакетах SDK веб-заданий см. в разделе [Веб-задания Azure — рекомендуемые ресурсы][Веб-задания Azure — рекомендуемые ресурсы].

  [веб-задания Azure]: http://go.microsoft.com/fwlink/?LinkId=390226
  [Использование веб-заданий для запуска фоновых задач в веб-сайтах Microsoft Azure]: /ru-ru/documentation/articles/web-sites-create-web-jobs/
  [Обзор]: #overview
  [Предварительные требования]: #prerequisites
  [Включение развертывания веб-заданий для существующего проекта приложений консоли]: #convert
  [Создание нового проекта с поддержкой веб-заданий]: #create
  [Диалоговое окно "Добавление веб-заданий Azure"]: #configure
  [Файл webjob-publish-settings.json]: #publishsettings
  [Файл webjobs-list.json]: #webjobslist
  [Развертывание проекта веб-заданий]: #deploy
  [Дальнейшие действия]: #next-steps
  [заданий планировщика Azure]: #scheduler
  [Microsoft.Web.WebJobs.Publish]: http://www.nuget.org/packages/Microsoft.Web.WebJobs.Publish/
  [Диаграмма, отображающая добавленные элементы в приложение консоли для реализации развертывания как веб-задания]: ./media/websites-dotnet-deploy-webjobs/convert.png
  [Диаграмма, отображающая проект веб-задания, связанный с веб-проектом]: ./media/websites-dotnet-deploy-webjobs/link.png
  [Пакет SDK Azure для Visual Studio 2013]: http://go.microsoft.com/fwlink/p/?linkid=323510&clcid=0x409
  [Обновление 3]: http://go.microsoft.com/fwlink/?linkid=397827&clcid=0x409
  [Включение автоматического развертывания с веб-проектом]: #convertlink
  [Включение развертывания без веб-проекта]: #convertnolink
  [Существующий проект как веб-задание Azure]: ./media/websites-dotnet-deploy-webjobs/eawj.png
  [Выбор проекта в диалоговом окне "Добавление веб-задания Azure"]: ./media/websites-dotnet-deploy-webjobs/aaw1.png
  [Публикация в виде веб-задания Azure]: ./media/websites-dotnet-deploy-webjobs/paw.png
  [Использование шаблона создания проекта с поддержкой веб-заданий для веб-задания, связанного с веб-проектом]: #createlink
  [Использование шаблона создания проекта веб-заданий для отдельного веб-задания]: #createnolink
  [Пакета SDK веб-заданий]: http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/getting-started-with-windows-azure-webjobs
  [Запись меню "Новый проект веб-задания Azure"]: ./media/websites-dotnet-deploy-webjobs/nawj.png
  [Диалоговое окно "Новый проект", отображающее шаблон веб-заданий]: ./media/websites-dotnet-deploy-webjobs/np.png
  [1]: ./media/websites-dotnet-deploy-webjobs/aaw2.png
  [планировщика Azure]: /ru-ru/services/scheduler/
  []: http://schemastore.org/schemas/json/webjob-publish-settings.json
  [2]: http://schemastore.org/schemas/json/webjobs-list.json
  [Развертывание веб-сайта Azure]: /ru-ru/documentation/articles/websites-dotnet-deploy/
  [Веб-задания Azure — рекомендуемые ресурсы]: http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/azure-webjobs-recommended-resources
