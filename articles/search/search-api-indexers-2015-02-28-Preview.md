<properties 
pageTitle="Операции с индексаторами (API REST службы ";Поиск Azure";: версия 2015-02-28-Preview)" 
description="Операции с индексаторами (API REST службы ";Поиск Azure";: версия 2015-02-28-Preview)" 
services="search" 
documentationCenter="" 
authors="HeidiSteen" 
manager="mblythe" 
editor="" />

<tags 
ms.service="search" 
ms.devlang="rest-api" 
ms.workload="search" ms.topic="article"  
ms.tgt_pltfrm="na" 
ms.date="09/21/2015" 
ms.author="heidist" />

#Операции с индексаторами (API REST службы "Поиск Azure": версия 2015-02-28-Preview)

> [AZURE.NOTE]В этой статье описываются индексаторы, доступные в версии [2015-02-28-Preview](search-api-2015-02-28-preview.md). В настоящее время единственное различие между версией `2015-02-28`, документация к которой приведена на сайте [MSDN](http://go.mirosoft.com/fwlink/p/?LinkID=528173), и описанной здесь версией `2015-02-28-Preview` состоит в том, что в предварительной версии предоставлено свойство *fieldMappings* (см. раздел [Создание индексатора](#CreateIndexer)).

## Обзор

Служба "Поиск Azure" может интегрироваться непосредственно с некоторыми общими источниками данных, что избавляет вас от необходимости писать код для индексирования данных. Чтобы настроить индексирование данных, можно вызвать интерфейс API службы "Поиск Azure" для создания **индексаторов** и **источников данных**, а также управления ими.

**Индексатор** — это ресурс, соединяющий источники данных с целевыми индексами поиска. Индексатор используется в следующих случаях.

- Для выполнения однократного копирования данных с целью заполнения индекса.
- Для синхронизации индекса с изменениями в источнике данных по расписанию. Расписание является частью определения индексатора.
- Для вызова по запросу с целью обновления индекса. 

**Индексатор** полезно использовать, если требуется регулярно обновлять индекс. Можно настроить встроенное расписание как часть определения индексатора или запустить его по запросу, используя операцию [Запуск индексатора](#RunIndexer).

**Источник данных** определяет, какие данные нужно индексировать, какие учетные данные требуются для доступа к данным и какие политики нужны, чтобы служба "Поиск Azure" могла эффективно выявлять изменения в данных (такие как измененные или удаленные строки в таблице базы данных). Он определяется как независимый ресурс, который могут использовать несколько индексаторов.

В настоящее время поддерживаются следующие источники данных:

- база данных SQL Azure и SQL Server на виртуальных машинах Azure;
- Azure DocumentDB. 

Мы планируем в будущем обеспечить поддержку дополнительных источников данных. Чтобы помочь нам определить приоритеты этих решений, оставьте свой отзыв на [форум отзывов по Поиску Azure](http://feedback.azure.com/forums/263029-azure-search).

В статье [Ограничения службы](search-limits-quotas-capacity.md) приведена информация об ограничениях, связанных с ресурсами индексатора и источника данных.

## Типичные рабочий процесс

Можно создавать индексаторы и источники данных, а также управлять ими через простые HTTP-запросы (POST, GET, PUT, DELETE) к заданному ресурсу `data source` или `indexer`.

Настройка автоматического индексирования обычно состоит из четырех этапов.

1. Определите источник данных, содержащий данные, которые необходимо проиндексировать. Имейте в виду, что Поиск Azure может не поддерживать все типы данных, которые присутствуют в источнике данных. См. список в [статье, в которой рассматриваются поддерживаемые типы данных](https://msdn.microsoft.com/library/azure/dn798938.aspx).

2. Создайте индекс Поиска Azure, схема которого совместима с источником данных.
  
3. Создайте источник данных для Поиска Azure, как описано в разделе [Создание источника данных](#CreateDataSource).
  
4. Создайте индексатор Поиска Azure, как описано в разделе [Создание индексатора](#CreateIndexer).

Для каждой комбинации целевого индекса и источника данных необходимо запланировать создание одного индексатора. Можно использовать несколько индексаторов, записывающих сведения в один и тот же индекс, а также повторно использовать один и тот же источник данных для нескольких индексаторов. Однако индексатор может одновременно использовать только один источник данных и записывать сведения только в один индекс.

После создания индексатора можно получить его состояние выполнения с помощью операции [Получение состояния индексатора](#GetIndexerStatus). Кроме того, индексатор можно запустить в любое время (в дополнение к его периодическому выполнению по расписанию или вместо него), используя операцию [Запуск индексатора](#RunIndexer).

<!-- MSDN has 2 art files plus a API topic link list -->


## Создание источника данных

Для создания источника данных в службе поиска Azure используется запрос HTTP POST.
	
    POST https://[service name].search.windows.net/datasources?api-version=[api-version]
    Content-Type: application/json
    api-key: [admin key]

Вы также можете использовать метод PUT и указать имя источника данных в универсальном коде ресурса (URI). Если такого источника данных не существует, он будет создан.

    PUT https://[service name].search.windows.net/datasources/[datasource name]?api-version=[api-version]

**Примечание.** Максимальное разрешенное количество источников данных зависит от ценовой категории. В бесплатной версии службы можно использовать до трех источников. Стандартная служба позволяет использовать до 50 источников данных. Дополнительные сведения см. в разделе [Пределы и ограничения](https://msdn.microsoft.com/library/azure/dn798934.aspx)

**Запрос**

Все запросы к службе отправляются по протоколу HTTPS. Для отправки запроса на **создание источника данных** можно использовать метод POST или PUT. Для метода POST в тексте запроса необходимо указать имя источника данных вместе с его определением. Для метода PUT имя указывается в составе URL-адреса. Если такого источника данных не существует, он будет создан. Если он уже есть, его определение будет обновлено.

Имя источника данных вводится строчными буквами, должно начинаться с буквы или цифры, не должно содержать символов косой черты и точки, а его максимальная длина составляет 127 знаков. Начиная со второго символа, имя источника данных может содержать буквы, цифры и тире (однако последовательности из двух или большего числа тире запрещены). Подробные сведения приведены в статье [Правила именования (Поиск Azure)](https://msdn.microsoft.com/library/azure/dn857353.aspx).

`api-version` является обязательным элементом. Текущая версия — `2015-02-28`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

**Заголовки запросов**

В списке ниже перечислены обязательные и необязательные заголовки запроса.

- `Content-Type`: обязательный. Для этого заголовка необходимо задать значение `application/json`.
- `api-key`: обязательный. Заголовок `api-key` используется для проверки подлинности запроса в службе поиска. Это уникальное строковое значение, присваиваемое службе. Запрос на **создание источника данных** должен содержать заголовок `api-key` со значением ключа администратора (а не ключа запроса). 
 
Для формирования URL-адреса запроса также понадобится имя службы. Имя и заголовок `api-key` можно найти на панели мониторинга службы на [портале управления Azure ](https://portal.azure.com/). Справку по навигации по страницам см. в [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md).

<a name="CreateDataSourceRequestSyntax"></a> **Синтаксис текста запроса**

Текст запроса содержит определение источника данных, которое включает тип источника данных, учетные данные для чтения данных, а также необязательные политики обнаружения изменения и удаления данных, которые используются для эффективного определения измененных или удаленных данных в источнике данных при использовании совместно с индексатором, работающим по регулярному расписанию.


Ниже описан синтаксис полезных данных запроса. Далее в этом разделе приведен пример запроса.

    { 
		"name" : "Required for POST, optional for PUT. The name of the data source",
    	"description" : "Optional. Anything you want, or nothing at all",
    	"type" : "Required. Must be 'azuresql' or 'documentdb'",
    	"credentials" : { "connectionString" : "Required. Connection string for your data source" },
    	"container" : { "name" : "Required. The name of the table or collection you wish to index" },
    	"dataChangeDetectionPolicy" : { Optional. See below for details }, 
    	"dataDeletionDetectionPolicy" : { Optional. See below for details }
	}

Запрос содержит следующие свойства.

- `name`. Обязательное. Имя источника данных. Имя источника данных должно содержать только строчные буквы, цифры или дефисы, не может начинаться или заканчиваться тире и не должно быть длиннее 128 символов.
- `description`: необязательное описание. 
- `type`. Обязательное. Должно быть одним из поддерживаемых типов источников данных.
	- `azuresql` — база данных SQL Azure или SQL Server на виртуальных машинах Azure.
	- `documentdb` — Azure DocumentDB.
- `credentials`:
	- Обязательное свойство `connectionString` задает строку подключения для источника данных. Формат строки подключения зависит от типа источника данных. 
		- Для SQL Azure это обычная строка подключения SQL Server. На портале управления Azure используйте `ADO.NET connection string` для получения строки подключения.
		- При использовании DocumentDB строка подключения должна быть в следующем формате: `"AccountEndpoint=https://[your account name].documents.azure.com;AccountKey=[your account key];Database=[your database id]"`. Все значения являются обязательными. Эти значения можно найти на [портале управления Azure](https://portal.azure.com/).   
		
- `container`:
	- Обязательное свойство `name` определяет таблицу или представление (для источника данных Azure SQL) или коллекцию (для источника данных DocumentDB), которые будут индексироваться. 
	- Источники данных DocumentDB также поддерживают необязательное свойство `query`, которое позволяет указать запрос, выполняющий сведение произвольного макета документа JSON в плоскую схему, доступную для индексирования с помощью службы "Поиск Azure".   
- Необязательные параметры `dataChangeDetectionPolicy` и `dataDeletionDetectionPolicy` описаны ниже.

<a name="DataChangeDetectionPolicies"></a> **Политики обнаружения изменения данных**

Политика обнаружения изменения данных предназначена для эффективного определения измененных элементов данных. Поддерживаемые политики зависят от типа источника данных. В следующих разделах описывается каждая из политик.

**ПРИМЕЧАНИЕ.** После создания индексатора можно переключить политики обнаружения данных с помощью API [Сброс индексатора](#ResetIndexer).

***Политика обнаружения изменений верхнего предела***

Эта политика используется, если источник данных содержит столбец или свойство, соответствующие следующим критериям:
 
- при каждой вставке указывается значение для столбца; 
- при всех обновлениях элементов также изменяется значение столбца; 
- значение этого столбца растет с каждым изменением;
- могут эффективно выполняться запросы, использующие предложение фильтра, аналогичное предложению `WHERE [High Water Mark Column] > [Current High Water Mark Value]`.

Например, при использовании источников данных Azure SQL индексированный столбец `rowversion` является идеальным претендентом на использование с политикой верхнего предела.

При использовании источников данных DocumentDB необходимо использовать свойство `_ts`, предоставленное в DocumentDB.
 
Эту политику можно указать следующим образом.

	{ 
		"@odata.type" : "#Microsoft.Azure.Search.HighWaterMarkChangeDetectionPolicy",
		"highWaterMarkColumnName" : "[a row version or last_updated column name]" 
	} 

***Встроенная политика определения изменений SQL***

Если база данных SQL поддерживает [отслеживание изменений](https://msdn.microsoft.com/library/bb933875.aspx), мы рекомендуем использовать встроенную политику отслеживания изменений SQL. Эта политика обеспечивает наиболее эффективное отслеживание изменений, а также позволяет Поиску Azure выявлять удаленные строки без необходимости добавлять в схему отдельный столбец обратимого удаления.

Встроенное отслеживание изменений поддерживается, начиная со следующих версий базы данных SQL Server: SQL Server 2008 R2, если используется SQL Server на виртуальных машинах Azure; Azure SQL Database V12, если используется база данных SQL Azure.

При использовании встроенной политики отслеживания изменений SQL не указывайте отдельную политику обнаружения удаления данных, так как она уже поддерживает выявление удаленных строк.

Эту политику можно использовать только с таблицами. Ее невозможно использовать с представлениями. Перед использованием этой политики вам потребуется включить отслеживание изменений для используемой таблицы. Инструкции см. в статье [Включение и отключение отслеживания изменений](https://msdn.microsoft.com/library/bb964713.aspx).
 
При структуризации запроса на **создание источника данных** встроенную политику отслеживания изменений SQL можно задать следующим образом.

	{ 
		"@odata.type" : "#Microsoft.Azure.Search.SqlIntegratedChangeTrackingPolicy" 
	}

<a name="DataDeletionDetectionPolicies"></a> **Политики обнаружения удаления данных**

Политика обнаружения удаления данных предназначена для эффективного определения удаленных элементов данных. В настоящее время поддерживается только политика `Soft Delete`, которая позволяет идентифицировать удаленные данные на основе значения столбца `soft delete` или свойства в источнике данных. Эту политику можно указать следующим образом.

	{ 
		"@odata.type" : "#Microsoft.Azure.Search.SoftDeleteColumnDeletionDetectionPolicy",
		"softDeleteColumnName" : "the column that specifies whether a row was deleted", 
		"softDeleteMarkerValue" : "the value that identifies a row as deleted" 
	}

**Примечание.** Поддерживаются только столбцы, имеющие строковые, целочисленные или логические значения. Значение, используемое в качестве `softDeleteMarkerValue`, должно быть строкой, даже если соответствующий столбец содержит целые или логические значения. Например, если значение, которое появляется в источнике данных, равно 1, используйте `"1"` как `softDeleteMarkerValue`.

<a name="CreateDataSourceRequestExamples"></a> **Примеры текста запроса**

Если планируется использовать источник данных с индексатором, который запускается по расписанию, в этом примере показано, как задать политики обнаружения изменения и удаления данных.

    { 
		"name" : "asqldatasource",
		"description" : "a description",
    	"type" : "azuresql",
    	"credentials" : { "connectionString" : "Server=tcp:....database.windows.net,1433;Database=...;User ID=...;Password=...;Trusted_Connection=False;Encrypt=True;Connection Timeout=30;" },
    	"container" : { "name" : "sometable" },
    	"dataChangeDetectionPolicy" : { "@odata.type" : "#Microsoft.Azure.Search.HighWaterMarkChangeDetectionPolicy", "highWaterMarkColumnName" : "RowVersion" }, 
    	"dataDeletionDetectionPolicy" : { "@odata.type" : "#Microsoft.Azure.Search.SoftDeleteColumnDeletionDetectionPolicy", "softDeleteColumnName" : "IsDeleted", "softDeleteMarkerValue" : "true" }
	}

Если планируется использовать источник данных для разового копирования данных, политики можно опустить.

    { 
		"name" : "asqldatasource",
    	"description" : "anything you want, or nothing at all",
    	"type" : "azuresql",
    	"credentials" : { "connectionString" : "Server=tcp:....database.windows.net,1433;Database=...;User ID=...;Password=...;Trusted_Connection=False;Encrypt=True;Connection Timeout=30;" },
    	"container" : { "name" : "sometable" }
	} 

**Ответ**

Для успешного запроса: "201 — Создан ресурс".

<a name="UpdateDataSource"></a>
## Обновление источника данных

Обновить существующий источник данных можно с помощью HTTP-запроса PUT. Имя источника данных, который необходимо обновить, указывается в универсальном коде ресурса (URI) запроса.

    PUT https://[service name].search.windows.net/datasources/[datasource name]?api-version=[api-version]
    Content-Type: application/json
    api-key: [admin key]

`api-version` является обязательным элементом. Текущая версия — `2015-02-28`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.

**Запрос** Синтаксис текста запроса такой же, как и при [создании источника данных](#CreateDataSourceRequestSyntax).

**Ответ** Для успешного запроса: возвращается код состояния «201 — Создан ресурс», если источник данных был создан, и «204 — Нет содержимого», если был обновлен существующий источник данных.

**ПРИМЕЧАНИЕ.** Некоторые свойства В существующем источнике данных нельзя обновить. Например, невозможно изменить тип существующего источника данных.

<a name="ListDataSource"></a>
## Список источников данных

Операция **отображения списка источников данных** возвращает список источников данных в службе "Поиск Azure".

    GET https://[service name].search.windows.net/datasources?api-version=[api-version]
    api-key: [admin key]

`api-version` является обязательным элементом. Текущая версия — `2015-02-28`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.

**Ответ**

Для успешного запроса: «200 — ОК».

Вот пример тела запроса:

    {
      "value" : [
        {
          "name": "datasource1",
          "type": "azuresql",
		  ... other data source properties
        }]
    }

Обратите внимание на то, что в ответе можно отфильтровать нужные свойства. Например, если необходим только список имен источников данных, задайте параметр запроса OData `$select`.

    GET /datasources?api-version=205-02-28&$select=name

В этом случае ответ из приведенного выше примера будет выглядеть так:

    {
      "value" : [ { "name": "datasource1" }, ... ]
    }

Это удобный способ сократить нагрузку на пропускную способность, если в службе поиска много источников данных.

<a name="GetDataSource"></a>
## Получение источника данных

Операция **получения источника данных** позволяет получить определение источника данных из службы "Поиск Azure".

    GET https://[service name].search.windows.net/datasources/[datasource name]?api-version=[api-version]
    api-key: [admin key]

`api-version` является обязательным элементом. Текущая версия — `2015-02-28`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код "200 — ОК".

Ответ похож на примеры, приведенные в разделе «Примеры тела запроса» статьи [Создание источника данных](#CreateDataSourceRequestExamples).

	{ 
		"name" : "asqldatasource",
		"description" : "a description",
    	"type" : "azuresql",
    	"credentials" : { "connectionString" : "Server=tcp:....database.windows.net,1433;Database=...;User ID=...;Password=...;Trusted_Connection=False;Encrypt=True;Connection Timeout=30;" },
    	"container" : { "name" : "sometable" },
    	"dataChangeDetectionPolicy" : { 
            "@odata.type" : "#Microsoft.Azure.Search.HighWaterMarkChangeDetectionPolicy",
			"highWaterMarkColumnName" : "RowVersion" }, 
    	"dataDeletionDetectionPolicy" : { 
            "@odata.type" : "#Microsoft.Azure.Search.SoftDeleteColumnDeletionDetectionPolicy",
			"softDeleteColumnName" : "IsDeleted", 
			"softDeleteMarkerValue" : "true" }
	}

**ПРИМЕЧАНИЕ.** Не устанавливайте для заголовка запроса `Accept` значение `application/json;odata.metadata=none` при вызове этого интерфейса API, так как это приведет к исключению атрибута `@odata.type` из ответа, и вы не сможете различить политики обнаружения изменения и удаления данных различных типов.

<a name="DeleteDataSource"></a>
## Удаление источника данных

Операция **удаления источника данных** удаляет источник данных из службы поиска Azure.

    DELETE https://[service name].search.windows.net/datasources/[datasource name]?api-version=[api-version]
    api-key: [admin key]

**ПРИМЕЧАНИЕ**. Если какие-либо индексаторы ссылаются на удаляемый источник данных, операция удаления все равно будет продолжена. Однако эти индексаторы перейдут в состояние ошибки при их следующем запуске.

`api-version` является обязательным элементом. Текущая версия — `2015-02-28`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код "204 — Нет содержимого".

<a name="CreateIndexer"></a>
## Создание индексатора

Для создания индекса в службе поиска Azure используется запрос HTTP POST.
	
    POST https://[service name].search.windows.net/indexers?api-version=[api-version]
    Content-Type: application/json
    api-key: [admin key]

Вы также можете использовать метод PUT и указать имя источника данных в универсальном коде ресурса (URI). Если такого источника данных не существует, он будет создан.

    PUT https://[service name].search.windows.net/indexers/[indexer name]?api-version=[api-version]

**Примечание.** Максимальное разрешенное количество индексаторов зависит от ценовой категории. В бесплатной версии службы можно использовать до трех индексаторов. Стандартная служба позволяет использовать до 50 индексаторов. Дополнительные сведения см. в разделе [Пределы и ограничения](https://msdn.microsoft.com/library/azure/dn798934.aspx)

`api-version` является обязательным элементом. Текущая версия — `2015-02-28`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.


<a name="CreateIndexerRequestSyntax"></a> **Синтаксис текста запроса**

Текст запроса содержит определение индексатора, которое указывает на источник данных и целевой индекс для индексирования, а также необязательное расписание индексирования и параметры.


Ниже описан синтаксис полезных данных запроса. Далее в этом разделе приведен пример запроса.

    { 
		"name" : "Required for POST, optional for PUT. The name of the indexer",
    	"description" : "Optional. Anything you want, or null",
    	"dataSourceName" : "Required. The name of an existing data source",
        "targetIndexName" : "Required. The name of an existing index",
        "schedule" : { Optional. See Indexing Schedule below. },
        "parameters" : { Optional. See Indexing Parameters below. },
        "fieldMappings" : { Optional. See Field Mappings below. }
	}

**Расписание индексатора**

Индексатор может дополнительно задавать расписание. Если расписание уже имеется, индексатор будет выполняться согласно расписанию. Расписание имеет следующие атрибуты.

- `interval`. Обязательный. Значение длительности, указывающее интервал или период между запусками индексатора. Наименьший допустимый интервал — 5 минут, наибольший — один день. Значение должно быть отформатировано как значение dayTimeDuration XSD (ограниченное подмножество значения [продолжительности ISO 8601](http://www.w3.org/TR/xmlschema11-2/#dayTimeDuration)). Используется следующий шаблон: `P(nD)(T(nH)(nM))`. Примеры: `PT15M`— каждые 15 минут, `PT2H` — каждые 2 часа. 

- `startTime`. Обязательный. Дата и время начала работы индексатора в формате UTC.

**Параметры индексатора**

При необходимости индексатор может указывать несколько параметров, которые влияют на его поведение. Все параметры являются необязательными.

- `maxFailedItems`. Количество не прошедших индексацию элементов, превышение которого рассматривается как сбой индексатора. Значение по умолчанию — 0. Сведения об ошибочных элементах возвращаются с помощью операции [получения состояния индексатора](#GetIndexerStatus). 

- `maxFailedItemsPerBatch`. Количество не прошедших индексацию элементов в каждом пакете, превышение которого рассматривается как сбой индексатора. Значение по умолчанию — 0.

- `base64EncodeKeys`. Указывает, будут ли ключи документа в кодировке base-64. Поиск Azure накладывает ограничения на символы, которые может содержать ключ документа. Однако данные источника могут содержать недопустимые символы. Если необходимо индексировать такие значения как ключи документов, этому флагу можно задать значение true. Значение по умолчанию — `false`.

**Сопоставления полей**

Сопоставления полей позволяют сопоставить имя поля в источнике данных с другим именем поля в целевом индексе. Например, рассмотрим исходную таблицу с полем `_id`. В службе "Поиск Azure" запрещено использовать имена полей, начинающиеся с символа подчеркивания, поэтому поле необходимо переименовать. Для этого выполните следующие действия с помощью свойства `fieldMappings` индексатора.
	
	"fieldMappings" : [ { "sourceFieldName" : "_id", "targetFieldName" : "id" } ] 

Можно задать несколько сопоставлений полей.

	"fieldMappings" : [ 
		{ "sourceFieldName" : "_id", "targetFieldName" : "id" },
        { "sourceFieldName" : "_timestamp", "targetFieldName" : "timestamp" },
	 ]

В исходных и целевых именах полей не учитывается регистр.

<a name="FieldMappingFunctions"></a> ***Функции сопоставления полей***

Сопоставления полей также можно использовать для преобразования исходных значений полей, используя *функции сопоставления*.

В настоящее время поддерживается только одна такая функция: `jsonArrayToStringCollection`. Она выполняет синтаксический анализ поля, содержащего строку в формате массива JSON в поле Collection(Edm.String) в целевом индексе. В частности, эта функция предназначена для использования с индексатором SQL Azure, поскольку в SQL отсутствует собственные тип данных коллекции. Эта функция используется следующим образом.

	"fieldMappings" : [ { "sourceFieldName" : "tags", "mappingFunction" : { "name" : "jsonArrayToStringCollection" } } ] 

Например, если исходное поле содержит строку `["red", "white", "blue"]`, то целевое поле типа `Collection(Edm.String)` будет заполнено следующими тремя значениями: `"red"`, `"white"` и `"blue"`.

ПРИМЕЧАНИЕ. Свойство `targetFieldName` является необязательным; если не указывать его, используется значение `sourceFieldName`).

<a name="CreateIndexerRequestExamples"></a> **Примеры текста запроса**

В следующем примере создается индексатор, копирующий данные из таблицы, указанной источником данных `ordersds`, в индекс `orders` по расписанию, которое начинается 1 января 2015 г. Индексатор запускается каждый час. Каждый вызов индексатора будет успешным, если происходит сбой при индексировании не более 5 элементов в каждом пакете и всего не удается индексировать не более 10 элементов.

	{
        "name" : "myindexer",
        "description" : "a cool indexer",
        "dataSourceName" : "ordersds",
        "targetIndexName" : "orders",
        "schedule" : { "interval" : "PT1H", "startTime" : "2015-01-01T00:00:00Z" },
        "parameters" : { "maxFailedItems" : 10, "maxFailedItemsPerBatch" : 5, "base64EncodeKeys": false }
	}

**Ответ**

Успешный запрос возвращает код состояния "201 — Создан ресурс".


<a name="UpdateIndexer"></a>
## Обновление индексатора

Обновить существующий индексатор можно с помощью HTTP-запроса PUT. Указать имя обновляемого индексатора можно в универсальном коде ресурса (URI) запроса.

    PUT https://[service name].search.windows.net/indexers/[indexer name]?api-version=[api-version]
    Content-Type: application/json
    api-key: [admin key]

`api-version` является обязательным элементом. Текущая версия — `2015-02-28`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.

**Запрос**

Синтаксис текста запроса такой же, как и при [создании источника данных](#CreateIndexerRequestSyntax).

**Ответ**

Для успешного запроса: возвращается код состояния "201 — Создан ресурс", если индексатор был создан, и "204 — Нет содержимого", если был обновлен существующий индексатор.


<a name="ListIndexers"></a>
## Список индексаторов

Операция **перечисления списка индексаторов** возвращает список индексаторов в службе "Поиск Azure".

    GET https://[service name].search.windows.net/indexers?api-version=[api-version]
    api-key: [admin key]


`api-version` является обязательным элементом. Предварительная версия — `2015-02-28-Preview`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.

**Ответ**

Для успешного запроса: «200 — ОК».

Вот пример тела запроса:

    {
      "value" : [
      {
        "name" : "myindexer",
        "description" : "a cool indexer",
        "dataSourceName" : "ordersds",
        "targetIndexName" : "orders",
        ... other indexer properties
	  }]
    }

Обратите внимание на то, что в ответе можно отфильтровать нужные свойства. Например, если необходим только список имен индексаторов, задайте параметр запроса OData `$select`:

    GET /indexers?api-version=2014-10-20-Preview&$select=name

В этом случае ответ из приведенного выше примера будет выглядеть так:

    {
      "value" : [ { "name": "myindexer" } ]
    }

Это удобный способ сократить нагрузку на пропускную способность, если в службе поиска много индексаторов.


<a name="GetIndexer"></a>
## Получение индексатора

Операция **получения индексатора** возвращает определение индексатора из службы "Поиск Azure".

    GET https://[service name].search.windows.net/indexers/[indexer name]?api-version=[api-version]
    api-key: [admin key]

`api-version` является обязательным элементом. Предварительная версия — `2015-02-28-Preview`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код "200 — ОК".

Ответ похож на примеры, приведенные в разделе "Примеры текста запроса" статьи [Создание индексатора](#CreateIndexerRequestExamples).

	{
        "name" : "myindexer",
        "description" : "a cool indexer",
        "dataSourceName" : "ordersds",
        "targetIndexName" : "orders",
        "schedule" : { "interval" : "PT1H", "startTime" : "2015-01-01T00:00:00Z" },
        "parameters" : { "maxFailedItems" : 10, "maxFailedItemsPerBatch" : 5, "base64EncodeKeys": false }
	}


<a name="DeleteIndexer"></a>
## Удаление индексатора

Операция **удаления индексатора** удаляет индексатор из службы поиска Azure.

    DELETE https://[service name].search.windows.net/indexers/[indexer name]?api-version=[api-version]
    api-key: [admin key]

При удалении индексатора выполняемые в этот момент операции индексатора будут полностью завершены, однако новые выполнения планироваться не будут. Попытки использовать несуществующий индексатор приведут к возвращению кода состояния HTTP "404 — Не найдено".
 
`api-version` является обязательным элементом. Предварительная версия — `2015-02-28-Preview`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код "204 — Нет содержимого".

<a name="RunIndexer"></a>
## Запуск индексатора

Помимо периодического выполнения по расписанию индексатор также можно вызывать по запросу с помощью операции **запуска индексатора**.

	POST https://[service name].search.windows.net/indexers/[indexer name]/run?api-version=[api-version]
    api-key: [admin key]

`api-version` является обязательным элементом. Предварительная версия — `2015-02-28-Preview`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код «202 — Принято».

<a name="GetIndexerStatus"></a>
## Получение состояния индексатора

Операция **получения состояния индексатора** получает текущий журнал состояния и выполнения индексатора.

	GET https://[service name].search.windows.net/indexers/[indexer name]/status?api-version=[api-version]
    api-key: [admin key]


`api-version` является обязательным элементом. Предварительная версия — `2015-02-28-Preview`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код «200 — ОК».

Текст ответа содержит сведения об общем состоянии работоспособности индексатора и последнем его вызове, а также журнал последних вызовов индексатора (при наличии).

Пример текста ответа выглядит следующим образом.

	{
		"status":"running",
		"lastResult": {
			"status":"success",
			"errorMessage":null,
			"startTime":"2014-11-26T03:37:18.853Z",
			"endTime":"2014-11-26T03:37:19.012Z",
			"errors":[],
			"itemsProcessed":11,
			"itemsFailed":0,
			"initialTrackingState":null,
			"finalTrackingState":null
         },
		"executionHistory":[ {
			"status":"success",
         	"errorMessage":null,
			"startTime":"2014-11-26T03:37:18.853Z",
			"endTime":"2014-11-26T03:37:19.012Z",
			"errors":[],
			"itemsProcessed":11,
			"itemsFailed":0,
			"initialTrackingState":null,
			"finalTrackingState":null
		}]
	}

**Состояние индексатора**

Состояние индексатора может принимать одно из перечисленных ниже значений.

- `running` указывает, что индексатор работает нормально. Обратите внимание, что некоторые из запусков индексатора все равно могут быть завершены неудачно, поэтому также рекомендуется проверить свойство `lastResult`. 

- `error` указывает, что в индексаторе возникла ошибка, которую невозможно исправить без вмешательства человека. Например, истек срок действия учетных данных источника данных либо схемы источника данных или целевого индекса изменены так, что перестали работать.

**Результат выполнения индексатора**

Результат выполнения индексатора содержит сведения об одном выполнении индексатора. Последний результат представлен как свойство `lastResult` состояния индексатора. Другие недавние результаты (при их наличии) возвращаются в виде свойства `executionHistory` состояния индексатора.

Результат выполнения индексатора содержит следующие свойства.

- `status`. Состояние выполнения. Подробные сведения см. в разделе [Состояние выполнения индексатора](#IndexerExecutionStatus) ниже. 

- `errorMessage`. Сообщение об ошибке при выполнении.

- `startTime`. Время запуска этого выполнения в формате UTC.

- `endTime`. Время завершения этого выполнения в формате UTC. Это значение не установлено, если операция все еще выполняется.

- `errors`: список ошибок на уровне элементов, если таковые имеются.

- `itemsProcessed`: число элементов в источнике данных (например, строк таблицы), которые индексатор пытался проиндексировать во время этого выполнения.

- `itemsFailed`: число элементов, которые не удалось проиндексировать во время этого выполнения.
 
- `initialTrackingState`: всегда принимает значение `null` для первого выполнения индексатора или в том случае, если политика отслеживания изменений в данных для используемого источника не включена. Если такая политика включена, этот параметр в последующих выполнениях содержит первое (наименьшее) значение отслеживания изменений, обработанных в ходе этого выполнения.

- `finalTrackingState`: всегда принимает значение `null`, если политика отслеживания изменений в данных для используемого источника данных не включена. В противном случае указывает последнее (наибольшее) значение отслеживания изменений, успешно обработанное в ходе этого выполнения.

<a name="IndexerExecutionStatus"></a> **Состояние выполнения индексатора**

Состояние выполнения индексатора регистрирует состояние одного выполнения индексатора. Этот параметр может принимать перечисленные ниже значения.

- `success` указывает на успешное завершение выполнения индексатора.

- `inProgress` указывает, что идет процесс выполнения индексатора.

- `transientFailure` указывает на сбой выполнения индексатора. Подробности см. в свойстве `errorMessage`. Сбой не обязательно требует вмешательства человека для устранения проблемы. Например, устранение несовместимости
- схемы между источником данных и целевым индексом требует действий пользователя, а временный простой источника данных — нет. Вызовы индексатора будут продолжаться по расписанию, если оно установлено. 

- `persistentFailure` указывает на сбой индексатора, который требует вмешательства человека. Запланированные выполнения индексатора останавливаются. После решения проблемы используйте интерфейс API "Сброс индексатора", чтобы перезапустить запланированные выполнения.

- `reset` указывает, что индексатор сброшен путем вызова интерфейса API "Сброс индексатора" (см. ниже).

<a name="ResetIndexer"></a>
## Сброс индексатора

Операция **сброса индексатора** сбрасывает состояние отслеживания изменений, связанное с индексатором. Это позволяет запускать повторную индексацию с нуля (например, если была изменена схема источника данных) или изменять политику обнаружения изменений данных для источника данных, связанного с индексатором.

	POST https://[service name].search.windows.net/indexers/[indexer name]/reset?api-version=[api-version]
    api-key: [admin key]

`api-version` является обязательным элементом. Предварительная версия — `2015-02-28-Preview`. Дополнительные сведения о других версиях см. в статье [Управление версиями службы поиска Azure](https://msdn.microsoft.com/library/azure/dn864560.aspx).

`api-key` должен быть ключом администратора (в отличие от ключа запроса). Подробнее о ключах см. в разделе "Проверка подлинности" статьи [API REST службы поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx). В [статье, посвященной созданию службы поиска на портале](search-create-service-portal.md), приведены инструкции по получению URL-адреса службы и пояснения к важнейшим свойствам, используемым в запросе.

**Ответ**

Код состояния: в качестве успешного ответа возвращается код «204 — Нет содержимого».

## Сопоставление типов данных SQL и типов данных службы "Поиск Azure"

<table style="font-size:12">
<tr>
<td>Тип данных SQL</td>	
<td>Совместимые типы полей целевого индекса</td>
<td>Примечания</td>
</tr>
<tr>
<td>bit</td>
<td>Edm.Boolean, Edm.String</td>
<td></td>
</tr>
<tr>
<td>int, smallint, tinyint</td>
<td>Edm.Int32, Edm.Int64, Edm.String</td>
<td></td>
</tr>
<tr>
<td>bigint</td>
<td>Edm.Int64, Edm.String</td>
<td></td>
</tr>
<tr>
<td>real, float</td>
<td>Edm.Double, Edm.String</td>
<td></td>
</tr>
<tr>
<td>smallmoney, money<br>decimal<br>numeric
</td>
<td>Edm.String</td>
<td>Поиск Azure не поддерживает преобразование десятичных типов в Edm.Double, так как это отрицательно скажется на точности.
</td>
</tr>
<tr>
<td>char, nchar, varchar, nvarchar</td>
<td>Edm.String<br/>Collection(Edm.String)</td>
<td>Сведения о том, как преобразовать строковый столбец в Collection(Edm.String), см. в разделе [Функции сопоставления полей](#FieldMappingFunctions) в этом документе.</td>
</tr>
<tr>
<td>smalldatetime, datetime, datetime2, date, datetimeoffset</td>
<td>Edm.DateTimeOffset, Edm.String</td>
<td></td>
</tr>
<tr>
<td>uniqueidentifer</td>
<td>Edm.String</td>
<td></td>
</tr>
<tr>
<td>geography</td>
<td>Edm.GeographyPoint</td>
<td>Поддерживаются только географические объекты типа POINT с SRID 4326 (значение по умолчанию).</td>
</tr>
<tr>
<td>rowversion</td>
<td>Недоступно</td>
<td>Столбцы версии строк не могут храниться в индексе поиска, но их можно использовать для отслеживания изменений.</td>
</tr>
<tr>
<td>time, timespan<br>binary, varbinary, image,<br>xml, geometry, CLR types</td>
<td>Недоступно</td>
<td>Не поддерживается</td>
</tr>
</table>

## Сопоставление типов данных JSON и типов данных службы поиска Azure

<table style="font-size:12">
<tr>
<td>Тип данных JSON</td>	
<td>Совместимые типы полей целевого индекса</td>
<td>Примечания</td>
</tr>
<tr>
<td>bool</td>
<td>Edm.Boolean, Edm.String</td>
<td></td>
</tr>
<tr>
<td>Целые числа</td>
<td>Edm.Int32, Edm.Int64, Edm.String</td>
<td></td>
</tr>
<tr>
<td>Числа с плавающей запятой</td>
<td>Edm.Double, Edm.String</td>
<td></td>
</tr>
<tr>
<td>string</td>
<td>Edm.String</td>
<td></td>
</tr>
<tr>
<td>Массивы примитивных типов, например ["a", "b", "c"]</td>
<td>Collection(Edm.String)</td>
<td></td>
</tr>
<tr>
<td>Строки, которые выглядят как даты</td>
<td>Edm.DateTimeOffset, Edm.String</td>
<td></td>
</tr>
<tr>
<td>Объекты GeoJSON типа Point</td>
<td>Edm.GeographyPoint</td>
<td>Объекты GeoJSON типа Point — это объекты JSON в следующем формате: {"тип": "точка", "координаты": [долгота, широта]}. </td>
</tr>
<tr>
<td>Другие объекты JSON</td>
<td>Недоступно</td>
<td>Не поддерживаются. В настоящее время служба "Поиск Azure" поддерживает только типы примитивов и коллекции строк.</td>
</tr>
</table>

<!---HONumber=Sept15_HO4-->