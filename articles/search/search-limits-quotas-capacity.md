<properties
	pageTitle="Ограничения Поиска Azure | Microsoft Azure | Размещенная облачная служба поиска"
	description="Ограничения, используемые при планировании загрузки, а также ограничения запросов и ответов на них для Поиска Azure, размещенной облачной службы поиска."
	services="search"
	documentationCenter=""
	authors="HeidiSteen"
	manager="mblythe"
	editor=""
    tags="azure-portal"/>

<tags
	ms.service="search"
	ms.devlang="NA"
	ms.workload="search"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.date="11/19/2015"
	ms.author="heidist"/>

# Ограничения поиска Azure

Ограничения на пространство для хранения, рабочие нагрузки, количество индексов, документов и других объектов зависят от вида вашей подписки на Поиск Azure. Бесплатная подписка предназначена для оценки и экспериментального тестирования. В таких случаях количество объектов и рабочая нагрузка сильно ограничены с целью равномерного распределения ресурсов.

Стандартная подписка обычно выбирается для специальных компьютеров, которые используются только вашей службой. При использовании выделенной службы вы получите гибкость масштабирования за счет увеличенного пространства для хранения и мощностей на всех уровнях, даже при минимальной конфигурации.

## Ограничения бесплатной (общей) подписки на службу поиска

Подписчики Azure могут использовать общую (мультитенантную) службу поиска для разработки или в небольших приложениях поиска. Общая служба включена в подписку Azure. Это бесплатное дополнение, которое позволит вам поэкспериментировать со службой перед приобретением платной подписки. Служба предоставляет:

Объект|Ограничение
------|-----
Максимальное количество индексов|3
Максимальное количество полей на один индекс|1000
Максимальное количество документов|10 000
Максимальный размер хранилища|50 MB
Максимальное количество разделов|Недоступно
Максимальное количество реплик|Недоступно
Максимальное количество единиц поиска|Недоступно
Максимальное количество индексаторов|3
Максимальное количество источников данных индексаторов|3
Максимальное количество индексированных документов на один вызов индексатора|10 000
Максимальное время работы индексатора|3 минуты
Максимальное количество профилей оценки на индекс|16
Максимальное количество функций на профиль|8

Обратите внимание, что квот или ограничений для самих запросов нет. Вместо этого используется параметр «Количество запросов в секунду (QPS)», который зависит от доступной пропускной способности и загруженности системных ресурсов. Ресурсы вычисления и хранения Azure, поддерживающие вашу общую службу, используют несколько подписчиков. Таким образом, значение QPS для вашего решения будет зависеть от количества выполняемых одновременно рабочих нагрузок.

## Ограничения стандартной (выделенной) подписки для службы поиска

В стандартной подписке вы получаете выделенную службу поиска, которая будет хранить только ваши данные и выполнять только ваши рабочие нагрузки. В отличие от общей службы, выделенная служба позволяет управлять распределением ресурсов и масштабировать решение по вашему желанию. Вы можете задавать отдельные уровни ресурсов для разделов (для увеличения масштаба хранилища) и реплик (для обеспечения высокого уровня доступности, увеличения QPS и скорости индексирования). Подробные сведения о различных конфигурациях ресурсов см. в статье [Управление решением поиска](search-manage.md).

Следующая таблица содержит максимальные значения. Для получения полного представления о мощности системы в рамках допустимых [комбинаций разделов и реплик](#chart) см. таблицу далее в этой статье.

Объект|Ограничение
------|----
Максимальное количество индексов|50 на одну службу поиска
Максимальное количество полей на один индекс|1000
Максимальное количество документов|15 млн на раздел
Максимальный размер хранилища|25 ГБ на один раздел
Максимальное количество разделов|12 на одну службу поиска
Максимальное количество реплик|12 на одну службу поиска
Максимальное количество единиц поиска|36 на одну службу поиска
Максимальное количество служб поиска|12 для каждой подписки Azure
Максимальное количество индексаторов|50 на одну службу поиска
Максимальное количество источников данных индексаторов|50 на одну службу поиска
Максимальное количество индексированных документов на один вызов индексатора|Без ограничений
Максимальное количество профилей оценки на индекс|16
Максимальное количество функций на профиль|8

Мощности Поиска Azure можно приобретать отдельными частями, которые называются единицами поиска. Стандартная подписка включает до 36 единиц поиска на одну службу. Это ограничение преобладает над отдельными ограничениями, установленными для разделов и реплик. Например, вы не можете увеличить количество разделов до 12 и реплик — до 6, поскольку для этого потребуется 72 единицы поиска (12 x 6). А это больше, чем доступные 36 единиц поиска.

## Разделы и реплики

**Разделы** служат для хранения и ввода/вывода данных. В одной службе поиска может быть не более 12 разделов. Каждый раздел может хранить не более 15 миллионов документов или 25 ГБ данных (в зависимости от того, какое условие выполнится раньше). При добавлении разделов увеличивается количество документов, обрабатываемых службой поиска. Например, если в службу с одним разделом, позволяющим хранить до 25 ГБ данных, добавить еще один раздел, то доступное пространство увеличится до 50 ГБ.

**Реплики** являются копиями поисковой системы. В одной службе поиска может быть не более 6 реплик. Для обеспечения чтения (обработка запросов) необходимо минимум 2 реплики, а для чтения и записи (обработка запросов, индексирование) — 3 реплики.

Каждая реплика содержит копии всех индексов. При добавлении новых реплик вы подключаете дополнительные копии индексов. В результате увеличивается допустимая рабочая нагрузка и обеспечивается распределение запросов между большим количеством реплик. Если, скажем, у вас есть 6 индексов и 3 реплики, то каждая реплика будет хранить копии всех 6 индексов.

Обратите внимание, что параметр «Количество запросов в секунду (QPS)» не имеет точного значения, поскольку выполнение запроса во многом зависит от его сложности и параллельных рабочих нагрузок. В среднем реплика обслуживает около 15 запросов в секунду, но фактическая пропускная способность будет немного выше или ниже, в зависимости от сложности запросов (фасетные запросы являются более сложными) и задержки сети. Также необходимо учитывать, что зависимость роста мощности и производительности от количества реплик не обязательно является линейной. Например, добавление 3 реплик не гарантирует трехкратный рост пропускной способности. Признаком добавления новых реплик является показатель задержки запроса.

<a id="chart"></a>
## Поддерживаемые сочетания разделов и реплик

Как отмечалось ранее, в основе ограничений на разделы и реплики лежит сочетание выбираемых вами ресурсов, сумма единиц поиска которых не должна превышать 36. Для оценки ресурсов применяются единицы поиска (ЕП). В исходном состоянии выделенная служба поиска содержит одну реплику и один раздел, которые составляют одну единицу поиска.

Дополнительный объем вычисляется умножением количества разделов на количество реплик. Полученное значение соответствует количеству единиц поиска, необходимых для данной конфигурации.

В следующей таблице по вертикальной оси указываются реплики, а по горизонтальной — разделы. В точке пересечения указывается количество единиц поиска, необходимых для такого сочетания. Общее количество единиц поиска в одной службе не может превышать 36. Например, если вам нужно 6 реплик и 2 раздела, то для такой конфигурации потребуется 12 единиц поиска. Для 4 реплик и 2 разделов потребуется 8 единиц поиска. Как правило, большинство приложений поиска требует больше реплик, чем разделов.

<table cellspacing="0" border="1">
<tr><td><b>12&#160;реплик</b></td><td>12&#160;ЕП</td><td>24&#160;ЕП</td><td>36&#160;ЕП</td><td>Недоступно</td><td>Недоступно</td><td>Недоступно</td></tr>
<tr><td><b>6 реплик</b></td><td>6&#160;ЕП</td><td>12&#160;ЕП</td><td>18&#160;ЕП</td><td>24&#160;ЕП</td><td>36&#160;ЕП</td><td>Недоступно</td></tr>
<tr><td><b>5 реплик</b></td><td>5&#160;ЕП</td><td>10&#160;ЕП</td><td>15&#160;ЕП</td><td>20&#160;ЕП</td><td>30&#160;ЕП</td><td>Недоступно</td></tr>
<tr><td><b>4 реплики</b></td><td>4&#160;ЕП</td><td>8&#160;ЕП</td><td>12&#160;ЕП</td><td>16 ЕП</td><td>24&#160;ЕП</td><td>Недоступно </td></tr>
<tr><td><b>3 реплики</b></td><td>3&#160;ЕП</td><td>6&#160;ЕП</td><td>9&#160;ЕП</td><td>12&#160;ЕП</td><td>18&#160;ЕП</td><td>36&#160;ЕП</td></tr>
<tr><td><b>2 реплики</b></td><td>2&#160;ЕП</td><td>4&#160;ЕП</td><td>6&#160;ЕП</td><td>8&#160;ЕП</td><td>12&#160;ЕП</td><td>24&#160;ЕП</td></tr>
<tr><td><b>1 реплика</b></td><td>1&#160;ЕП</td><td>2&#160;ЕП</td><td>3&#160;ЕП</td><td>4&#160;ЕП</td><td>6&#160;ЕП</td><td>12&#160;ЕП</td></tr>
<tr><td>Недоступно</td><td><b>1 раздел</b></td><td><b>2 раздела</b></td><td><b>3 раздела</b></td><td><b>4 раздела</b></td><td><b>6 разделов</b></td><td><b>12 разделов</b></td></tr>
</table>

Подробная информация о единицах поиска, ценах и объемах приведена на веб-сайте Azure. Дополнительные сведения см. в статье [Сведения о ценах](http://azure.microsoft.com/pricing/details/search/).

> [AZURE.NOTE]Количество реплик и разделов должно быть кратным 12 (а именно 1, 2, 3, 4, 6, 12). Это связано с тем, что служба поиска Azure предварительно делит каждый индекс на 12 сегментов, которые распределяются по разделам. Например, если в вашей службе есть три раздела и вы создаете новый индекс, то каждый раздел будет содержать по 4 сегмента индекса. Способ, используемый службой поиска Azure для сегментации индекса, является задачей оптимизации и может быть изменен в будущих выпусках. Несмотря на то, что сегодня это число 12, вам не следует полагаться на то, что в будущем оно не изменится.

## Выбор сочетания разделов и реплик для обеспечения высокой доступности

Поскольку задача масштабирования решается достаточно легко и быстро, на начальном этапе обычно рекомендуется использовать один раздел и одну или две реплики, увеличивая их количество по мере роста запросов. Для многих развертываний места для хранения одного раздела (15 миллионов документов на раздел) будет достаточно.

А вот рабочая нагрузка запросов зависит от реплик. Вам потребуется больше реплик для повышения пропускной способности или обеспечения высокого уровня доступности.

Ниже приведены общие рекомендации для обеспечения высокой доступности.

- 2 реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).
- 3 или более реплики для обеспечения высокой доступности рабочих нагрузок чтения и записи (запросов и индексирования).

В настоящее время встроенного механизма для аварийного восстановления не предусмотрено. Увеличение разделов или реплик для решения задач аварийного восстановления является ошибочной стратегией. Вместо этого вам следует рассмотреть возможность создания избыточности на уровне службы. Подробное описание возможных вариантов см. в [этом сообщении на форуме](https://social.msdn.microsoft.com/Forums/ee108a26-00c5-49f6-b1ff-64c66c8b828a/dr-and-high-availability-for-azure-search?forum=azuresearch).

> [AZURE.NOTE]Помните, что соглашения об уровне обслуживания и масштабируемость являются опциями стандартного пакета. Бесплатная подписка включает фиксированный набор ресурсов и предусматривает совместное использование реплик многими подписчиками. Если вы начинали работать с бесплатной подпиской и переходите на стандартную, то вам потребуется создать новую службу поиска и переместить индексы и данные в новую службу. Инструкции о подготовке службы см. в статье [Создание службы Поиск Azure на портале](search-create-portal.md).

## Ограничения ключа API

Ключи API используются для проверки подлинности в службе. Существует два типа ключей. Ключи администратора указываются в заголовке запроса. Ключи запроса указываются в URL-адресе. Дополнительные сведения об управлении ключами см. в статье [Управление службой поиска в Microsoft Azure](search-manage.md).

- Максимум 2 ключа администратора на одну службу.
- Максимум 50 ключей запросов на одну службу.

## Ограничения запросов

- Максимум 16 МБ на один запрос.
- Максимальная длина URL-адреса — 8 КБ.
- Максимум 1000 документов на одну операцию загрузки индексов, объединения или удаления.
- Максимум 32 поля в предложении $orderby.
- Максимальный размер поискового запроса — 32 766 байт (32 КБ минус 2 байта) текста в кодировке UTF-8.

## Ограничения ответа

- Максимум 1000 документов на одну страницу результатов поиска.
- Максимум 100 предложений на один запрос API предложений.

<!---HONumber=AcomDC_1125_2015-->