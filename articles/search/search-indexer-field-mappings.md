<properties
pageTitle="Сопоставления полей индексатора в поиске Azure устраняют расхождения между источниками данных и индексами поиска"
description="Настройка сопоставлений полей индексатора в поиске Azure для выявления различий в названиях полей и представлениях данных"
services="search"
documentationCenter=""
authors="chaosrealm"
manager="pablocas"
editor="" />

<tags
ms.service="search"
ms.devlang="rest-api"
ms.workload="search" 
ms.topic="article"  
ms.tgt_pltfrm="na"
ms.date="04/30/2016"
ms.author="eugenesh" />

# Сопоставления полей индексатора в поиске Azure устраняют расхождения между источниками данных и индексами поиска

При использовании индексаторов поиска Azure может возникнуть ситуация, когда входные данные не вписываются в схему целевого индекса. В таком случае можно преобразовать данные в желаемый формат, используя **сопоставления полей**.

Примеры ситуаций, в которых могут пригодиться сопоставления полей:
 
- Источник данных содержит поле `_id`, но поиск Azure не допускает, чтобы имена полей начинались с символа подчеркивания. Сопоставление полей позволяет "переименовать" поле. 
- Вам нужно заполнить несколько полей в индексе, указав одни и те же данные источников данных, например, если к этим полям нужно применить разные анализаторы. Сопоставления полей позволяют разветвить поле источника данных.
- Данные необходимо шифровать или расшифровывать в кодировке Base64. Сопоставления полей поддерживают несколько **функций сопоставления**, включая шифрование и расшифровку в кодировке Base64.   


> [AZURE.IMPORTANT] Сейчас функция сопоставления полей доступна в режиме предварительной версии. Она доступна при использовании REST API версии **2015-02-28-Preview**. Помните, что предварительные версии API предназначены для тестирования и ознакомления. Они не должны использоваться в рабочей среде.

## Настройка сопоставлений полей

Сопоставления полей можно добавить при создании нового индексатора с использованием API для [создание индексатора](search-api-indexers-2015-02-28-preview.md#create-indexer). Сопоставлениями полей в индексаторе индексирования можно управлять с помощью API для [обновления индексатора](search-api-indexers-2015-02-28-preview.md#update-indexer).

Сопоставление полей состоит из трех частей:

1. Параметр `sourceFieldName` — представляет поле в источнике данных. Это — обязательное свойство. 

2. Необязательный параметр `targetFieldName` — представляет поле в индексе поиска. Если этот параметр опущен, используется такое же имя, как в источнике данных.

3. Необязательный параметр `mappingFunction` — позволяет преобразовывать данные, используя одну из нескольких предопределенных функций. Полный список функций представлен [ниже](#mappingFunctions).

Сопоставления полей добавляются в массив `fieldMappings` в определении индексатора.

Например, так можно устранить расхождения в именах полей:

```JSON

PUT https://[service name].search.windows.net/indexers/myindexer?api-version=[api-version]
Content-Type: application/json
api-key: [admin key]
{
    "dataSourceName" : "mydatasource",
    "targetIndexName" : "myindex",
    "fieldMappings" : [ { "sourceFieldName" : "_id", "targetFieldName" : "id" } ] 
} 
```

Индексатор может содержать несколько сопоставлений полей. Например, так можно разветвить поле:

```JSON

"fieldMappings" : [ 
	{ "sourceFieldName" : "text", "targetFieldName" : "textStandardEnglishAnalyzer" },
	{ "sourceFieldName" : "text", "targetFieldName" : "textSoundexAnalyzer" }, 
] 
```

> [AZURE.NOTE] В поиске Azure для устранения расхождений между именами полей и функций в сопоставлениях полей используется сравнение без учета регистра. Это удобно (допускаются ошибки в выборе регистра), но означает, что источник данных или индекс не может содержать поля, которые различаются только регистром.

<a name="mappingFunctions"></a>
## Функции сопоставления полей

В настоящее время поддерживаются следующие функции:

- [base64Encode](#base64EncodeFunction)
- [base64Decode](#base64DecodeFunction)
- [extractTokenAtPosition](#extractTokenAtPositionFunction)
- [jsonArrayToStringCollection](#jsonArrayToStringCollectionFunction)

<a name="base64EncodeFunction"></a>
### base64Encode 

Выполняет *безопасное* кодирование строки входных данных в Base64. Входные данные должны быть в кодировке UTF-8.

#### Примеры вариантов использования 

Ключ документа в поиске Azure может содержать только безопасные символы URL (поскольку клиенты должны иметь возможность обращаться к документу, например, через API поиска). Если ваши данные содержат небезопасные символы URL и вы хотите применить их для того, чтобы заполнить поле ключа в индексе поиска, воспользуйтесь этой функцией.

#### Пример 

```JSON

"fieldMappings" : [ 
  { 
    "sourceFieldName" : "Path", 
    "targetFieldName" : "UrlSafePath",
    "mappingFunction" : { "name" : "base64Encode" } 
  }] 
```

<a name="base64DecodeFunction"></a>
### base64Decode

Выполняет декодирование входной строки в Base64. Входные данные поступают в строку в кодировке Base64, *безопасную для URL*.

#### Примеры вариантов использования 

Значения настраиваемых метаданных BLOB-объекта должны быть в кодировке ASCII. Для представления произвольных юникод-строк в настраиваемые метаданные BLOB-объекта можно использовать кодировку Base64. Тем не менее, чтобы поиск был значимым, можно использовать эту функцию для того, чтобы при заполнении индекса поиска снова превратить зашифрованные данные в "обычные" строки.

#### Пример 

```JSON

"fieldMappings" : [ 
  { 
    "sourceFieldName" : "Base64EncodedMetadata", 
    "targetFieldName" : "SearchableMetadata",
    "mappingFunction" : { "name" : "base64Decode" } 
  }] 
```

<a name="extractTokenAtPositionFunction"></a>
### extractTokenAtPosition

Разбивает поле строки, используя заданный разделитель, и выбирает маркер из указанной позиции в результате разбиения.

Например, если входные данные `Jane Doe`, параметр `delimiter` имеет значение `" "` (пробел), а параметр `position` — значение 0, результатом будет `Jane`; если параметр `position` имеет значение 1, результатом будет `Doe`. Если позиция ссылается на несуществующий маркер, выдается ошибка.

#### Примеры вариантов использования 

Источник данных содержит поле `PersonName`, и вам нужно индексировать его как два отдельных поля — `FirstName` и `LastName`. Эта функция позволяет разбить входные данные, используя пробел как разделитель.

#### Параметры

- `delimiter`: строка, которая используемая как разделитель при разбиении входной строки.
- `position`: целочисленная нулевая позиция маркера, которую нужно выбрать после разбиения входной строки.    

#### Пример

```JSON 

"fieldMappings" : [ 
  { 
    "sourceFieldName" : "PersonName", 
    "targetFieldName" : "FirstName",
    "mappingFunction" : { "name" : "extractTokenAtPosition", "parameters" : { "delimiter" : " ", "position" : 0 } } 
  }, 
  { 
    "sourceFieldName" : "PersonName", 
    "targetFieldName" : "LastName",
    "mappingFunction" : { "name" : "extractTokenAtPosition", "parameters" : { "delimiter" : " ", "position" : 1 } } 
  }] 
```

<a name="jsonArrayToStringCollectionFunction"></a>
### jsonArrayToStringCollection

Преобразует строку, отформатированную как массив строк JSON, в массив строк, который можно использовать для заполнения поля `Collection(Edm.String)` в индексе.

Например, если исходной строкой является `["red", "white", "blue"]`, то целевое поле типа `Collection(Edm.String)` будет заполнено следующими тремя значениями: `red`, `white` и `blue`. Если входные значения нельзя проанализировать как массивы строк JSON, выдается ошибка.

#### Примеры вариантов использования

База данных SQL Azure не имеет встроенного типа данных, сопоставленного с полями `Collection(Edm.String)` в поиске Azure естественным образом. Чтобы заполнить поля в коллекции строк, отформатируйте исходные данные как строку JSON и воспользуйтесь этой функцией.

#### Пример 

```JSON

"fieldMappings" : [ 
  { "sourceFieldName" : "tags", "mappingFunction" : { "name" : "jsonArrayToStringCollection" } }
] 
```

## Помогите нам усовершенствовать службу поиска Azure

Если вам нужна какая-либо функция или у вас есть идеи, которые можно было бы реализовать, сообщите об этом на [сайте UserVoice](https://feedback.azure.com/forums/263029-azure-search/).

<!---HONumber=AcomDC_0504_2016-->