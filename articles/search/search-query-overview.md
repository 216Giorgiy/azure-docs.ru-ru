---
title: Основные сведения о запросах в Поиске Azure | Документация Майкрософт
description: Основы создания поисковых запросов в Поиске Azure с помощью параметров для фильтрации, выбора и сортировки результатов.
author: HeidiSteen
manager: cgronlun
ms.author: heidist
services: search
ms.service: search
ms.topic: conceptual
ms.date: 07/27/2018
ms.openlocfilehash: 4650ad89850f32ae5e83a7ac1cd5eac096b180ed
ms.sourcegitcommit: f86e5d5b6cb5157f7bde6f4308a332bfff73ca0f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/31/2018
ms.locfileid: "39366452"
---
# <a name="query-fundamentals-in-azure-search"></a>Основные сведения о запросах в Поиске Azure

Определение запроса в Поиске Azure представляет собой полную спецификацию запроса, которая состоит из следующих частей: URL-адрес конечной точки службы, целевой индекс, ключ API, используемый для аутентификации запроса, значение api-version и строка запроса. 

Строка запроса состоит из параметров, как определено в [API поиска по документам](https://docs.microsoft.com/rest/api/searchservice/search-documents). Наиболее важным является параметр **search=**, который может быть неопределенным (`search=*`), но, скорее всего, состоит из условия, фраз и операторов, как показано в примере ниже.

```
"search": "seattle townhouse +\"lake\""
```

Другие параметры используются для управления обработкой запросов или улучшения ответа. Примеры применения параметров демонстрируют ограничение области поиска конкретными полями, настройку режима поиска для модуляции соотношения точности и полноты результатов, а также добавление счетчика для отслеживания результатов. 

```
{  
    "search": "seattle townhouse* +\"lake\"",  
    "searchFields": "description, city",  
    "searchMode": "all",
    "count": "true", 
    "queryType": "simple" 
 } 
```

Хотя определение запроса является основополагающим, схема индекса не менее важна, так как она указывает допустимые операции с полями. Во время разработки индекса атрибуты полей определяют разрешенные операции. Например, для поддержки полнотекстового поиска и включения в результаты поиска поля должны быть помечены как *поддерживающие поиск* и *поддерживающие извлечение*.

Во время выполнения запроса всегда обрабатывается один индекс, доступ к которому предоставляется после прохождения аутентификации с помощью значения api-key, указанного в запросе. Невозможно объединить индексы или создать пользовательские или временные структуры данных и указать их в качестве цели запроса.  

Результаты запроса передаются потоком в виде документов JSON в API REST, хотя если вы используете интерфейсы API .NET, то функции сериализации будут встроенными. Можно сформировать результаты, задав параметры в запросе, и выбрать определенные поля для отображения в результатах.

Таким образом, запрос указывает область и операции: какие поля необходимо включить в поиск, какие поля следует включить в результирующий набор, требуется ли сортировка или фильтрация и т. д. Если запрос не уточнен, поиск выполняется по всем полям, как операция полнотекстового поиска, и возвращается результирующий набор без оценок в произвольном порядке.

<a name="types-of-queries"></a>

## <a name="types-of-queries-search-and-filter"></a>Типы запросов: поиск и фильтрация

Служба поиска Azure предлагает множество параметров для создания расширенных запросов. Два основных типа запросов, которые вы будете использовать, — это `search` и `filter`. 

+ Запросы `search` ищут как минимум одно вхождение во всех *поддерживающих поиск* полях индекса. Они работают примерно так же, как поисковая система Google или Bing. В примерах во введении используется параметр `search`.

+ Запросы `filter` оценивают логическое выражение во всех *фильтруемых* полях индекса. В отличие от `search`, запрос `filter` сопоставляет точное содержимое поля, учитывая регистр в строковых полях.

Поиск и фильтрацию можно использовать вместе или по отдельности. Автономный фильтр без строки запроса полезен, когда выражение фильтра может полностью определить интересующие документы. Без строки запроса не выполняется лексический или лингвистический анализ, нет оценки и рейтинга. Обратите внимание, что строка поиска пуста.

```
POST /indexes/nycjobs/docs/search?api-version=2017-11-11  
    {  
      "search": "",
      "filter": "salary_frequency eq 'Annual' and salary_range_from gt 90000",
      "count": "true"
    }
```

Если они используются вместе, сначала ко всему индексу применяется фильтр, а затем в результатах фильтрации выполняется поиск. Поэтому фильтры могут повысить производительность запросов, так как они уменьшают количество документов, которые поисковый запрос должен обработать.

Синтаксис выражений фильтра — это подмножество [языка фильтра OData](https://docs.microsoft.com/rest/api/searchservice/OData-Expression-Syntax-for-Azure-Search). Для поисковых запросов можно использовать [упрощенный синтаксис](https://docs.microsoft.com/rest/api/searchservice/Simple-query-syntax-in-Azure-Search) или [синтаксис запросов Lucene](https://docs.microsoft.com/rest/api/searchservice/Lucene-query-syntax-in-Azure-Search) (они описаны ниже).


## <a name="choose-a-syntax-simple-or-full"></a>Выбор синтаксиса: простой или полный

В основе Поиска Azure лежит платформа Apache Lucene, что позволяет выбрать между двумя средствами синтаксического анализа запросов для обработки типичных и специализированных запросов. Типичные поисковые запросы формируются с помощью используемого по умолчанию [простого синтаксиса запросов](https://docs.microsoft.com/rest/api/searchservice/Simple-query-syntax-in-Azure-Search). Этот синтаксис поддерживает ряд общих операторов поиска, включая AND, OR, NOT, а также фразы, суффиксы и операторы приоритета.

[Синтаксис запросов Lucene](https://docs.microsoft.com/rest/api/searchservice/Lucene-query-syntax-in-Azure-Search#bkmk_syntax) (для его включения нужно добавить в запрос параметр **queryType=full**) позволяет использовать широко распространенный и выразительный язык запросов, разработанный как часть библиотеки [Apache Lucene](https://lucene.apache.org/core/4_10_2/queryparser/org/apache/lucene/queryparser/classic/package-summary.html). Этот синтаксис позволяет выполнять специализированные запросы:

+ [запросы по полям](https://docs.microsoft.com/rest/api/searchservice/Lucene-query-syntax-in-Azure-Search#bkmk_fields);
+ [поиск нечетких соответствий](https://docs.microsoft.com/rest/api/searchservice/Lucene-query-syntax-in-Azure-Search#bkmk_fuzzy);
+ [поиск с учетом расположения](https://docs.microsoft.com/rest/api/searchservice/Lucene-query-syntax-in-Azure-Search#bkmk_proximity);
+ [повышение приоритета терминов](https://docs.microsoft.com/rest/api/searchservice/Lucene-query-syntax-in-Azure-Search#bkmk_termboost);
+ [поиск с использованием регулярного выражения](https://docs.microsoft.com/rest/api/searchservice/Lucene-query-syntax-in-Azure-Search#bkmk_regex);
+ [поиск с использованием подстановочных знаков](https://docs.microsoft.com/rest/api/searchservice/Lucene-query-syntax-in-Azure-Search#bkmk_wildcard).

Логические операторы в обоих синтаксисах в основном одинаковые, только в полном синтаксисе Lucene доступны дополнительные форматы:

+ [логические операторы в простом синтаксисе](https://docs.microsoft.com/rest/api/searchservice/simple-query-syntax-in-azure-search#operators-in-simple-search);
+ [логические операторы в полном синтаксисе Lucene](https://docs.microsoft.com/rest/api/searchservice/Lucene-query-syntax-in-Azure-Search#bkmk_boolean).

## <a name="required-and-optional-elements"></a>Обязательные и необязательные элементы

При отправке поисковых запросов в службу поиска Azure нужно не только ввести в поле поиска приложения определенные слова, но и задать ряд параметров. Эти параметры запросов обеспечивают более точное управление при [работе с полнотекстовым поиском](search-lucene-query-architecture.md).

Обязательные элементы в запросе перечислены ниже:

+ конечная точка службы и индекс коллекции документов, указанные как URL-адрес `https://<your-service-name>.search.windows.net/indexes/<your-index-name>/docs`;
+ версия API (только REST), указанная с помощью параметра **api-version=**;
+ значение api-key запроса или администратора, указанное с помощью параметра **api-key=**;
+ строка запроса, указанная с помощью параметра **search=**, которая может быть не указана, если вы хотите выполнить поиск пустого значения; можно также отправить только выражение фильтра, указав параметр **$filter=**;
+ параметр **queryType=** со значением simple или full, который можно опустить, если вы хотите использовать простой синтаксис по умолчанию.

Все остальные параметры поиска являются необязательными.

## <a name="apis-and-tools-for-testing"></a>Интерфейсы API и инструменты для тестирования

В таблице ниже представлены интерфейсы API и методы на основе инструментов для отправки запросов.

| Методика | ОПИСАНИЕ |
|-------------|-------------|
| [SearchIndexClient (.NET)](https://docs.microsoft.com/dotnet/api/microsoft.azure.search.searchindexclient?view=azure-dotnet) | Клиент, который может использоваться для отправки запроса к индексу Поиска Azure.  <br/>[Подробнее.](search-howto-dotnet-sdk.md#core-scenarios)  |
| [Поиск по документам (REST API)](https://docs.microsoft.com/rest/api/searchservice/search-documents) | Методы GET или POST для индекса, допускающие использование параметров запроса для ввода дополнительных данных.  |
| [Fiddler, Postman или другой инструмент тестирования HTTP](search-fiddler.md) | Описывается настройка заголовка и текста запроса для отправки запросов к Поиску Azure.  |
| [Обозреватель поиска на портале Azure](search-explorer.md) | Предоставляет панель поиска и параметры для выбора индекса и значения api-version. Будут возвращены результаты в виде документов JSON. <br/>[Подробнее.](search-get-started-portal.md#query-index) | 

## <a name="manage-search-results"></a>Управление результатами поиска

Параметры запроса можно использовать для структурирования результирующего набора одним из следующих способов.

+ Ограничение числа документов или группирование определенного числа документов в результатах (50 по умолчанию).
+ Выбор полей для включения в результаты.
+ Установка порядка сортировки.
+ Выделение вхождений для привлечения внимания к найденным терминам в тексте результатов поиска.

### <a name="tips-for-unexpected-results"></a>Советы по непредвиденным результатам

В некоторых случаях непредвиденным является содержимое, а не структура результатов. Если результаты запроса не соответствует ожиданиям, можно попробовать изменить запрос и проверить, не улучшились ли результаты, как описано ниже.

+ Измените `searchMode=any` (по умолчанию) на `searchMode=all`, чтобы требовать соответствие всем указанным условиям, а не любому из них. Это особенно важно, если запрос содержит логические операторы.

+ Измените логику запроса, если требуется анализ текста или лексический анализа, но тип запроса исключает лингвистическую обработку. При полнотекстовом поиске алгоритм анализа текста или лексического анализа автоматически исправляет орфографические ошибки, формы множественного и единственного числа слов и даже неправильные глаголы и существительные. Для некоторых запросов, таких как поиск нечетких соответствий или поиск с использованием подстановочных знаков, анализ текста не входит в конвейер анализа запроса. Для некоторых сценариев в качестве временного решения используются регулярные выражения. 

### <a name="paging-results"></a>Разбиение результатов по страницам
Служба поиска Azure позволяет легко разбить результаты поиска по страницам. С помощью параметров `top` и `skip` вы можете отправлять такие поисковые запросы, результаты которых возвращаются в управляемых упорядоченных подмножествах. В них поиск можно выполнять проверенными способами с помощью пользовательского интерфейса. При получении этих маленьких подмножеств вы можете получать также сведения о количестве документов во всех результатах поиска.

Дополнительные сведения о разбивке результатов поиска на страницы см. в статье [Разбивка результатов поиска на страницы в службе поиска Azure](search-pagination-page-layout.md).

### <a name="ordering-results"></a>Упорядочение результатов
Вы можете запросить, чтобы служба поиска Azure упорядочила результаты поискового запроса по значениям в определенном поле. По умолчанию служба поиска Azure упорядочивает результаты поиска, руководствуясь важностью суммы поиска документа. Это значение вычисляется на основании меры [TF-IDF](https://en.wikipedia.org/wiki/Tf%E2%80%93idf).

Если нужно, чтобы служба поиска Azure упорядочивала результаты не по сумме поиска, а по другому значению, вы можете воспользоваться поисковым параметром `orderby` . Вы можете указать значение параметра `orderby`, чтобы включить имена полей и вызовы в [`geo.distance()`функцию ](https://docs.microsoft.com/rest/api/searchservice/OData-Expression-Syntax-for-Azure-Search) для геопространственных значений. После каждого выражения можно поставить символ `asc`, чтобы указать, что результаты требуется представить по возрастанию, или символ `desc`, если результаты нужно упорядочить по убыванию. По умолчанию результаты сортируются по возрастанию.


### <a name="hit-highlighting"></a>Выделение совпадений
В службе поиска Azure вы можете легко выделить конкретную часть результатов поиска, которые соответствуют поисковому запросу. Для этого воспользуйтесь параметрами `highlight`, `highlightPreTag` и `highlightPostTag`. Вы можете указать, в каких *поддерживающих поиск* полях следует выделять вхождения. Кроме того, можно указать конкретные теги строк, которые нужно добавлять к началу и концу вхождений, которые возвращает служба поиска Azure.

## <a name="see-also"></a>См. также

+ [Как работает полнотекстовый поиск в службе поиска Azure (архитектура анализа запросов)](search-lucene-query-architecture.md)
+ [Обозреватель поиска](search-explorer.md)
+ [Выполнение запроса в .NET](search-query-dotnet.md)
+ [Выполнение запроса в REST](search-query-rest-api.md)
