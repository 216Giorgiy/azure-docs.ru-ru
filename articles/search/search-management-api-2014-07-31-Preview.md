<properties pageTitle="Интерфейс управления поисковой службой Azure REST API версии 2014-07-31-Preview" description="API REST управления службой поиска Azure: версия 2014-07-31-Preview" services="search" documentationCenter="" authors="HeidiSteen" manager="mblythe" editor=""/>

<tags ms.service="search" ms.devlang="rest-api" ms.workload="search" ms.topic="article"  ms.tgt_pltfrm="na" ms.date="07/08/2015" ms.author="heidist" />

# API управления: версия 2014-07-31-Preview

В этом документе описывается версия **2014-07-31-Preview** API REST управления службой поиска Azure. Впоследствии ее заменила общедоступная версия, [API REST управления службой поиска Azure 2015-02-28](https://msdn.microsoft.com/library/dn832684.aspx). представленная на сайте MSDN. ________________________________________

## Операции управления службой

API REST управления службой поиска Azure предоставляет программный доступ к большинству функций, доступных на портале, позволяя администраторам автоматизировать следующие операции:

- Создание или удаление службы поиска Azure.
- Создание, изменение или извлечение `api-keys` для автоматизации регулярного изменения административных ключей, используемых для проверки подлинности в операциях поиска данных.
- Масштабирование службы поиска Azure в соответствии с изменениями объема запросов или требований к хранению.

Чтобы полностью администрировать службы программным способом, потребуется два интерфейса API: API REST управления службой поиска Azure и общий [API REST диспетчера ресурсов Azure](https://msdn.microsoft.com/library/azure/dn790568.aspx). API диспетчера ресурсов используется для операций общего назначения, которые не привязаны к службам, например запроса данных подписки, перечисления географических расположений и т. д. Чтобы создавать службы поиска Azure в своей подписке и управлять ими, убедитесь, что ваш запрос HTTP содержит конечную точку диспетчера ресурсов, идентификатор подписки, поставщика (в данном случае службу поиска Azure) и операции, связанные со службой поиска.

Статья [Приступая к работе с Azure Search Management REST API](http://go.microsoft.com/fwlink/p/?linkID=516968) содержит примеры кода, которые демонстрируют настройку приложений и операции управления службой. Образец приложения отправляет запросы API-интерфейсу диспетчера ресурсов Azure, а также API управления поисковой службой Azure, и поможет вам создать целостное приложение, использующее оба API.

### Конечная точка

Конечной точкой для операций администрирования службы является URL-адрес диспетчера ресурсов Azure, `https://management.azure.com`.

Обратите внимание, что все вызовы API управления должны содержать идентификатор подписки и версию API-интерфейса.

### Версии

Текущая версия интерфейса управления поисковой службой Azure REST API — `api-version=2014-07-31-Preview`. Это единственная версия этого API.

### Проверка подлинности и управление доступом

Интерфейс управления поисковой службой Azure REST API является расширением диспетчера ресурсов Azure и использует те же зависимости. Таким образом, для администрирования службы поиска Azure необходимо наличие Active Directory. Все административные запросы из клиентского кода должны проходить проверку подлинности с помощью Azure Active Directory, прежде чем они достигнут диспетчера ресурсов.

Обратите внимание, что если код приложения обрабатывает *операции управления службой* и *операции с данными* для индексов или документов, используются два способа проверки подлинности для каждого из интерфейсов API службы поиска Azure.

- По причине зависимости от диспетчера ресурсов при администрировании служб и ключей для проверки подлинности используется Active Directory.
- Запросы данных для конечной точки службы поиска Azure, например создание индекса или поиск документов, содержат `api-key` в заголовке запроса. В статье [API REST Поиска Azure](https://msdn.microsoft.com/library/azure/dn798935.aspx) приводятся сведения о проверке подлинности запроса данных.

Образец приложения описаны в [Приступая к работе с API REST для управления Поиском Azure](http://go.microsoft.com/fwlink/p/?linkID=516968) демонстрирует методы проверки подлинности для каждого типа операции. Эта статья также включает инструкции по настройке клиентского приложения для использования Active Directory.

Служба управления доступом для диспетчера ресурсов Azure использует встроенные роли владельца, участника и читателя. По умолчанию все администраторы службы имеют роль владельца. Дополнительные сведения см. в статье [Управление доступом на основе ролей в предварительной версии портала Azure](../role-based-access-control-configure.md).


### Сводка API-интерфейсов

Операции включают указанные ниже API-интерфейсы.

- <a name="CreateService">Создание службы поиска</a>

    `PUT	https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]?api-version=2014-07-31-Preview`

- <a name="GetService">Получение службы поиска</a>

    `GET https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]?api-version=2014-07-31-Preview`

- <a name="ListService">Список служб поиска</a>

    `GET https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices?api-version=2014-07-31-Preview`

- <a name="DeleteService">Удаление службы поиска</a>

    `DELETE https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]?api-version=2014-07-31-Preview`

- <a name="UpdateService">Обновление службы поиска</a>

    `PATCH https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]?api-version=2014-07-31-Preview`

- <a name="ListAdminKey">Список ключей администраторов</a>

    `POST https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]/listAdminKeys?api-version=2014-07-31-Preview`

- <a name="RegenAdminKey">Повторное создание ключа администратора</a>

    `POST https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]/regenerateAdminKey/[keyKind]?api-version=2014-07-31-Preview`

- <a name="CreateQueryKey">Создание ключа запроса</a>

    `POST https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]/createQueryKey/[name]?api-version=2014-07-31-Preview`

- <a name="ListQueryKey">Список ключей запросов</a>

    `GET	https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]/listQueryKeys?api-version=2014-07-31-Preview`

- <a name="DeleteQueryKey">Удаление ключей запросов</a>

    `DELETE https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]/deleteQueryKey/[key]?api-version=2014-07-31-Preview`

<a name="ServiceOps"></a>
## Операции со службой

Вы можете подготавливать и отзывать службы поиска Azure, отправляя HTTP-запросы подписке на Azure. Эти операции позволяют, помимо прочего, создавать настраиваемые средства администрирования или даже руководить всем процессом разработки производственной среды (от создания службы и до заполнения индекса). Аналогичным образом, поставщикам решений, которые проектируют и продают облачные решений, может потребоваться автоматизированный и повторяемый подход к подготовке службы для каждого нового клиента.

**Операции со службой**

Параметры, связанные со службой, включают следующие API-интерфейсы:

- <a name="CreateService">Создание службы поиска</a>
- <a name="GetService">Получение службы поиска</a>
- <a name="ListService">Список служб поиска</a>
- <a name="DeleteService">Удаление службы поиска</a>
- <a name="UpdateService">Обновление службы поиска</a>


<a name="CreateService"></a>
## Создание службы поиска

Операция **Создать службу поиска** подготавливает новую службу поиска с указанными параметрами. С помощью этого API также можно обновлять существующее определение службы.

    PUT	https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]?api-version=2014-07-31-Preview

### Параметры URI запроса

`subscriptionId`: обязательный параметр. `subscriptionID` пользователя Azure. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`resourceGroupName`: обязательный параметр. Имя группы ресурсов в рамках подписки пользователя. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`serviceName`: обязательный параметр. Имя службы поиска в указанной группе ресурсов. Имена служб должны содержать только строчные буквы, цифры или дефисы, первые два символа и последний символ не могут быть дефисами, имена не могут содержать последовательные тире и должны иметь длину от 2 до 15 символов. Поскольку все имена имеют вид <name>. search.windows.net, имя службы должно быть глобально уникальным. Ни в рамках подписки, ни между подписками и группами ресурсов не должно быть двух служб с одинаковыми именами. После создания имя службы невозможно изменить.

`api-version`: обязательный параметр. Указывает версию протокола, используемую для данного запроса. По мере выхода новых версий вы сможете выбирать версию с нужным поведением для каждого запроса.


### Заголовки запросов

`Content-Type`: обязательный параметр. Задайте для этого заголовка значение application/json.

`x-ms-client-request-id`: необязательный параметр. Созданное клиентом значение GUID, которое определяет данный запрос. Если это значение указано, оно будет включено в ответное сообщение для сопоставления запроса.


### Текст запроса

{ "расположение": "расположение службы поиска", "теги": { "ключ": "значение", ... }, "свойства": { "sku": { "имя": "free | standard | standard2" }, "replicaCount": 1 | 2 | 3 | 4 | 5 | 6, "partitionCount": 1 | 2 | 3 | 4 | 6 | 12 } }

### Параметры текста запроса

`location`: обязательный параметр. Одна из поддерживаемых и зарегистрированных географических областей Azure (например, запад США, восток США, Юго-Восточная Азия и т. д.). Обратите внимание, что расположение ресурса невозможно изменить после его создания.

`tags`: необязательный параметр. Список пар "ключ-значение", которые описывают ресурс. Эти теги можно использовать при просмотре и группировании ресурсов между группами. Для одного ресурса можно указать до 10 тегов. В каждом теге длина ключа нее должна превышать 128 символов, а длина значения — 256 символов.

`sku`: обязательный параметр. Допустимые значения: `free` и `standard`. `standard2` также является допустимым, но его можно использовать, только если он включен для подписки на Azure службой поддержки Майкрософт. `free` подготавливает службы в общих кластерах. `standard` подготавливает службы в выделенных кластерах. В бесплатной категории можно создать только одну службу поиска. Дополнительные службы можно создавать в стандартной ценовой категории. По умолчанию служба создается с одним разделом и одной репликой. Дополнительные разделы и реплики оцениваются согласно единицам поиска. Дополнительные сведения см. в разделе [Пределы и ограничения](http://msdn.microsoft.com/library/azure/dn798934.aspx) После создания службы невозможно изменить `sku`.

`replicaCount`: необязательный параметр. Значение по умолчанию: 1. Допустимые значения: от 1 до 6. Допустим, только если параметр `sku` имеет значение `standard`.

`partitionCount`: необязательный параметр. Значение по умолчанию: 1. Допустимые значения: 1, 2, 3, 4, 6 или 12. Допустим, только если параметр `sku` имеет значение `standard`.


### Ответ 

После обновления определения службы возвращается код HTTP 200 (ОК). После создания службы возвращается код HTTP 201 (Создание).


### Заголовки откликов 

`Content-Type`: этот заголовок всегда имеет значение application/json.

`x-ms-request-id`: уникальный идентификатор текущей операции, создаваемый службой.


### Текст ответа

Для кодов HTTP 200 и 201 текст ответа содержит определение службы.
    
    { 
      "id": "/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]", 
    
      "name": "service name", 
      "location": "location of search service", 
    "type": " Microsoft.Search/searchServices", 
      "tags": {
        "key": "value",
        ...
      },  
    "properties": { 
    	"sku": { 
          "name": "free | standard | standard2" 
       		 }, 
        "replicaCount": 1 | 2 | 3 | 4 | 5 | 6, 
        "partitionCount": 1 | 2 | 3 | 4 | 6 | 12, 
        "status": "running | provisioning | deleting | degraded | disabled | error", 
        "statusDetails": "details of the status", 
        "provisioningState": "succeeded | provisioning | failed" 
      } 
    } 


### Элементы текста ответа

`id`: идентификатор — это URL-адрес (за исключением имени узла или схемы) данной службы поиска.

`name`: имя службы поиска.

`location`: одна из поддерживаемых и зарегистрированных географических областей Azure (например, запад США, восток США, Юго-Восточная Азия и т. д.).

`tags`: Список пар "ключ-значение", описывающих ресурс, который используется при просмотре и группировании ресурсов в группах.

`sku`: указывает ценовую категорию. Допустимые значения:

- `free`: общий кластер
- `standard`: выделенный кластер
- `standard2`: используйте только по указанию службы поддержки Майкрософт. 

`replicaCount`: количество реплик в службе. Допустимые значения: от 1 до 6.

`partitionCount`: количество разделов в службе. Допустимые значения: 1, 2, 3, 4, 6 или 12.

`status`: состояние службы поиска в момент вызова операции. Допустимые значения:

- `running`: служба поиска создана.
- `provisioning`: идет подготовка службы поиска.
- `deleting`: идет удаление службы поиска.
- `degraded`: функциональность службы поиска ограничена. Это может произойти, если кластер обнаружил ошибку, которая может препятствовать нормальной работе службы.
- `disabled`: служба поиска отключена. В этом состоянии служба отклоняет все запросы API.
- `error`: служба поиска находится в состоянии ошибки. 

**Примечание**: если служба находится в состоянии `degraded`, `disabled`, или `error`, это означает, что команда поиска Azure активно ищет источник проблемы. Выделенные службы в этих состояниях по-прежнему оплачиваются по количеству подготовленных единиц поиска.

`statusDetails`: сведения о состоянии.

`provisioningState`: указывает текущее состояние подготовки службы. Допустимые значения:

- `succeeded`: подготовка выполнена успешно.
- `provisioning`: идет подготовка службы.
- `failed`: ошибка подготовки службы. 

Подготовка — это промежуточное состояние, которое наступает при установке емкости службы. После настройки емкости значение `provisioningState` меняется на "успешно" или "ошибка". Клиентские приложения могут узнавать состояние подготовки (рекомендуемый интервал опроса — от 30 секунд до минуты) с помощью операции **Получить службу поиска**, чтобы узнать о завершении операции. Если используется бесплатная служба, обычно возвращается значение "успешно" непосредственно в вызове для создания службы. Это объясняется тем, что бесплатная служба использует уже настроенную емкость.

<a name="GetService"></a>
## Получение службы поиска

Операция **Получить службу поиска** возвращает свойства указанной службы поиска. Обратите внимание, что ключи администраторов не возвращаются. Чтобы получить ключи администраторов, используйте операцию **Получить ключи администраторов**.

    GET https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]?api-version=2014-07-31-Preview

### URI запроса 

`subscriptionId`: обязательный параметр. Идентификатор подписки пользователя Azure. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`resourceGroupName`: обязательный параметр. Имя группы ресурсов в рамках подписки пользователя. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`serviceName`: обязательный параметр. Имя службы поиска в указанной группе ресурсов. Если вы не знаете имя службы, список можно получить с помощью операции "Список служб поиска" (API поиска Azure).

`api-version`: обязательный параметр. Указывает версию протокола, используемую для данного запроса. По мере выхода новых версий вы сможете выбирать версию с нужным поведением для каждого запроса.

### Заголовки запросов 

`x-ms-client-request-id`: необязательный параметр. Созданное клиентом значение GUID, которое определяет данный запрос. Если это значение указано, оно будет включено в ответное сообщение для сопоставления запроса.


### Текст запроса 

Отсутствует.


### Код состояния отклика 

Код HTTP 200 (ОК) означает успешное выполнение.


### Заголовки откликов 

`Content-Type`: этот заголовок всегда имеет значение application/json.

`x-ms-request-id`: уникальный идентификатор текущей операции, создаваемый службой.

### Текст ответа 

    {
      "id": "/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]",
    
      "name": "service name",
      "location": "location of search service",
    "type": " Microsoft.Search/searchServices",
      "tags": {
        "key": "value",
        ... 
      }, 
    "properties": {
    	"sku": {
          "name": "free | standard | standard2"
    	},
        "replicaCount": 1 | 2 | 3 | 4 | 5 | 6,
        "partitionCount": 1 | 2 | 3 | 4 | 6 | 12,
        "status": "running | provisioning | deleting | degraded | disabled | error",
        "statusDetails": "details of the status",
        "provisioningState": "succeeded | provisioning | failed"
      }
    }

### Элементы текста ответа

`id`: идентификатор — это URL-адрес (за исключением имени узла или схемы) данной службы поиска.

`name`: имя службы поиска.

`location`: расположение ресурса. Это одна из поддерживаемых и зарегистрированных географических областей Azure (например, запад США, восток США, Юго-Восточная Азия и т. д.).

`tags`: список пар "ключ-значение", которые описывают ресурс. Эти теги можно использовать при просмотре и группировании ресурсов между группами.

`sku`: указывает ценовую категорию. Допустимые значения:

- `free`: общий кластер
- `standard`: выделенный кластер
- `standard2`: используйте только по указанию службы поддержки Майкрософт.

`replicaCount`: количество реплик в службе. Допустимые значения: от 1 до 6.

`partitionCount`: количество разделов в службе. Допустимые значения: 1, 2, 3, 4, 6 или 12.

`status`: состояние службы поиска в момент вызова операции. Допустимые значения:

- `running`: служба поиска создана.
- `provisioning`: идет подготовка службы поиска.
- `deleting`: идет удаление службы поиска.
- `degraded`: функциональность службы поиска ограничена. Это может произойти, если кластер обнаружил ошибку, которая может препятствовать нормальной работе службы.
- `disabled`: служба поиска отключена. В этом состоянии служба отклоняет все запросы API.
- `error`: служба поиска находится в состоянии ошибки. 
 
**Примечание**: если служба находится в состоянии `degraded`, `disabled`, или `error`, это означает, что команда поиска Azure активно ищет источник проблемы. Выделенные службы в этих состояниях по-прежнему оплачиваются по количеству подготовленных единиц поиска.
 
`statusDetails`: сведения о состоянии.

`provisioningState`: допускаются следующие значения.

- `succeeded`: подготовка выполнена успешно.
- `provisioning`: идет подготовка службы.
- `failed`: ошибка подготовки.


<a name="ListService"></a>
## Список служб поиска

Операция **Список служб** возвращает список служб поиска в подписке определенной группы ресурсов. Эта операция возвращает определения служб без API-ключей администраторов. Чтобы получить ключи администраторов, используйте операцию **Получить ключи администраторов**.

    GET https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices?api-version=2014-07-31-Preview
    
### Параметры URI запроса 

`subscriptionId`: обязательный параметр. `subscriptionID` пользователя Azure. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`resourceGroupName`: обязательный параметр. Имя группы ресурсов в рамках подписки пользователя. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`api-version`: обязательный параметр. Указывает версию протокола, используемую для данного запроса. По мере выхода новых версий вы сможете выбирать версию с нужным поведением для каждого запроса.

### Заголовки запросов

`x-ms-client-request-id`: необязательный параметр. Созданное клиентом значение GUID, которое определяет данный запрос. Если это значение указано, оно будет включено в ответное сообщение для сопоставления запроса.

###Текст запроса

Отсутствует.

###Ответ

При успешном выполнении возвращается код HTTP 200 (ОК).

### Заголовки откликов

`Content-Type`: этот заголовок всегда имеет значение application/json.

`x-ms-request-id`: уникальный идентификатор текущей операции, создаваемый службой.


### Текст ответа

Текст ответа — это список служб, возвращаемый как массив JSON, где каждая служба имеет такой же формат, как в операции **Получить службу поиска**.

Обратите внимание, что поле `nextLink` всегда имеет значение null, поскольку текущая версия не поддерживает разбиение по страницам. Чтобы сохранить совместимость с будущими версиями, возвращается пустое значение.

    {
      "value": [
     	{
          "id": "id of service 1",
          "name": "service name",
          "location": "location of search service 1",
    	"type": " Microsoft.Search/searchServices",
          "tags": {
            "key": "value",
            ...
          }, 
    	"properties": {
            "sku": {
              "name": "free | standard | standard2"
            },
            "replicaCount": 1 | 2 | 3 | 4 | 5 | 6,
            "partitionCount": 1 | 2 | 3 | 4 | 6 | 12,
            "status": "running | provisioning | deleting | degraded | disabled | error",
            "statusDetails": "details of the status",
            "provisioningState": "succeeded | provisioning | failed"
    	}
      },   
      {
          "id": "id of service 2",
          "name": "service name 2",
          "location": "location of search service 2",
   	 	"type": " Microsoft.Search/searchServices",
          "tags": {
            "key": "value",
            ...
          },
    	"properties": {
            "sku": { 
              "name": "free | standard | standard2"
            },
            "replicaCount": 1 | 2 | 3 | 4 | 5 | 6,
            "partitionCount": 1 | 2 | 3 | 4 | 6 | 12,
            "status": "running | provisioning | deleting | degraded | disabled | error",
            "statusDetails": "details of the status",
            "provisioningState": "succeeded | provisioning | failed"
    	}
      }
    ],
    "nextLink": null
    }


<a name="DeleteService"></a>
## Удаление службы 

Операция **Удалить службу** удаляет службу и данные поиска, включая все индексы и документы.
    
    DELETE https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]?api-version=2014-07-31-Preview

**Примечание:** администраторы и разработчики привыкли к резервному копированию данных приложения перед его удалением с рабочего сервера. Для службы поиска Azure недоступна операция резервного копирования. Если индекс используется в качестве основного хранилища для приложения, необходимо использовать операцию поиска, чтобы вернуть все данные в индекс, который можно хранить отдельно.

###Параметры URI запроса

`subscriptionId`: обязательный параметр. Идентификатор подписки пользователя Azure. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`resourceGroupName`: обязательный параметр. Имя группы ресурсов в рамках подписки пользователя. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`serviceName`: обязательный параметр. Имя службы поиска в указанной группе ресурсов. Если вы не знаете имя службы, список можно получить с помощью операции "Список служб поиска" (API поиска Azure).

`api-version`: обязательный параметр. Указывает версию протокола, используемую для данного запроса. По мере выхода новых версий вы сможете выбирать версию с нужным поведением для каждого запроса.

###Заголовки запросов

`x-ms-client-request-id`: необязательный параметр. Созданное клиентом значение GUID, которое определяет данный запрос. Если это значение указано, оно будет включено в ответное сообщение для сопоставления запроса.

###Текст запроса

Отсутствует.

###Ответ

Для кода HTTP 200 текст ответа будет пустым. HTTP 200 (ОК) — это правильный ответ, если ресурса не существует.

Вы можете использовать операцию **Получить API службы поиска**, чтобы узнать состояние удаления службы. Рекомендуемый интервал опроса: от 30 секунд до минуты.

###Заголовки откликов

`x-ms-request-id`: уникальный идентификатор текущей операции, создаваемый службой.

###Текст ответа

Отсутствует.

<a name="UpdateService"></a>
## Обновление службы

Операция **Обновить службу** изменяет конфигурацию службы поиска. Допустимые изменения включают изменение количества тегов, разделов или реплик, при котором в службе добавляются или удаляются единицы поиска, что подлежит оплате. При попытке снизить количество разделов ниже числа, необходимого для хранения имеющегося собрания поиска, произойдет ошибка, которая заблокирует операцию. Изменение топологии службы может занять некоторое время. Перемещение данных, а также установка или демонтаж кластеров в центре обработки данных занимают некоторое время.

Обратите внимание, что невозможно изменить имя, расположение и SKU. После изменения любого из этих свойств необходимо создать новую службу.

    PATCH https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]?api-version=2014-07-31-Preview

Кроме того, можно использовать PUT.

    PUT https://management.azure.com/subscriptions/[subscriptionId]/resourcegroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]?api-version=2014-07-31-Preview

###Параметры URI запроса

`subscriptionId`: обязательный параметр. `subscriptionID` пользователя Azure. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`resourceGroupName`: обязательный параметр. Имя группы ресурсов в рамках подписки пользователя. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`serviceName`: обязательный параметр. Имя службы поиска в указанной группе ресурсов. Если вы не знаете имя службы, список можно получить с помощью операции "Список служб поиска" (API поиска Azure).

`api-version`: обязательный параметр. Указывает версию протокола, используемую для данного запроса. По мере выхода новых версий вы сможете выбирать версию с нужным поведением для каждого запроса.

###Заголовки запросов

`Content-Type`: обязательный параметр. Задайте для этого заголовка значение application/json.

`x-ms-client-request-id`: необязательный параметр. Созданное клиентом значение GUID, которое определяет данный запрос. Если это значение указано, оно будет включено в ответное сообщение для сопоставления запроса.

###Текст запроса

    {
      "tags": {
        "key": "value",
        ...
      }, 
    	"properties": {
        "replicaCount": 1 | 2 | 3 | 4 | 5 | 6,
        "partitionCount": 1 | 2 | 3 | 4 | 6 | 12
     	}
    }

###Параметры текста запроса

`tags`: необязательный параметр. Список пар "ключ-значение", которые описывают ресурс. Эти теги можно использовать при просмотре и группировании ресурсов (между группами). Для одного ресурса можно указать до 10 тегов. В каждом теге длина ключа нее должна превышать 128 символов, а длина значения — 256 символов.

`replicaCount`: необязательный параметр. Значение по умолчанию: 1. Допустимые значения: от 1 до 6. Допустим, только если параметр `sku` имеет значение `standard`.

`partitionCount`: необязательный параметр. Значение по умолчанию: 1. Допустимые значения: 1, 2, 3, 4, 6 или 12. Допустим, только если параметр `sku` имеет значение `standard`.

###Ответ

Если операция выполнена успешно, возвращается код HTTP 200 (ОК). Вы можете использовать операцию **Получить API службы поиска**, чтобы узнать состояние обновления службы. Рекомендуемый интервал опроса: от 30 секунд до минуты.


### Заголовки откликов 

`Content-Type`: этот заголовок всегда имеет значение application/json.

`x-ms-request-id`: уникальный идентификатор текущей операции, создаваемый службой.

### Текст ответа 

Текст ответа содержит обновленное определение службы. Пример см. в статье **Получение API службы поиска**.


<a name="KeyOps"></a>
## Операции с ключами

Для проверки подлинности в службе поиска Azure необходимы два фрагмента информации: URL-адрес службы поиска и API-ключ. API-ключи создаются при создании службы, и их можно повторно создавать по запросу после подготовки службы. Существует два типа API-ключей:

- ключ администратора: предоставляет доступ ко всем операциям (не более 2 на службу);
- ключа запроса: выполняет проверку подлинности только запросов (не более 50 на службу).

Возможность программно управлять ключами администраторов и запросов службы поиска Azure позволяет вам создавать собственные средства, периодически менять ключи в целях безопасности, менять ключи, когда сотрудник покидает организацию, а также создавать и получать ключи во время подготовки службы, если для развертывания решения используется программный подход или сценарии.

Ключи запросов можно получать, создавать и удалять. Операции с ключами администраторов ограничиваются получением и повторным созданием существующих значений ключей. Удалив ключ администратора, можно полностью потерять доступ к службе, поэтому эта операция недоступна.

Ключи — это строки, состоящие из случайного сочетания цифр и заглавных букв. API-ключ может использовать только служба, для которой он был создан, и ключ может регулярно меняться (если в целях защиты применяется стратегия смены ключей).

API-ключи, особенно ключи администраторов, необходимо хранить как конфиденциальные данные. Каждый, кто получает ключ администратора, имеет возможность удалять или считывать данные из индексов.

**Операции с ключами**

Операции, связанные с ключами, включают следующие API-интерфейсы.

- <a name="ListAdminKey">Список ключей администраторов</a>
- <a name="RegenAdminKey">Повторное создание ключа администратора</a>
- <a name="CreateQueryKey">Создание ключа запроса</a>
- <a name="ListQueryKey">Список ключей запросов</a>
- <a name="DeleteQueryKey">Удаление ключей запросов</a>


<a name="ListAdminKey"></a>
## Список ключей администраторов 

Операция **Список ключей администратора** возвращает первичный и вторичный ключи администраторов для указанной службы поиска. Поскольку это действие возвращает ключи чтения и записи, то используется метод POST.

    POST https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]/listAdminKeys?api-version=2014-07-31-Preview

Ключи администраторов создаются вместе со службой. Этих ключей всегда два, первичный и вторичный. Вы можете заново создавать эти ключи, но их невозможно удалить.

###Параметры URI запроса

`subscriptionId`: обязательный параметр. Идентификатор подписки пользователя Azure. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`resourceGroupName`: обязательный параметр. Имя группы ресурсов в рамках подписки пользователя. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`serviceName`: обязательный параметр. Имя службы поиска в указанной группе ресурсов. Если вы не знаете имя службы, список можно получить с помощью операции "Список служб поиска" (API поиска Azure).

`api-version`: обязательный параметр. Указывает версию протокола, используемую для данного запроса. По мере выхода новых версий вы сможете выбирать версию с нужным поведением для каждого запроса.

`listAdminKeys`: обязательный параметр. Это действие получает первичный и вторичный ключи администраторов для службы поиска.

###Заголовки запросов

`x-ms-client-request-id`: необязательный параметр. Созданное клиентом значение GUID, которое определяет данный запрос. Если это значение указано, оно будет включено в ответное сообщение для сопоставления запроса.

###Текст запроса

Отсутствует.

###Ответ

Если операция выполнена успешно, возвращается код HTTP 200 (ОК).

### Заголовки откликов 

`Content-Type`: этот заголовок всегда имеет значение application/json.

`x-ms-request-id`: уникальный идентификатор текущей операции, создаваемый службой.

###Текст ответа

    {
      "primaryKey": "api key",
      "secondaryKey": "api key"
    }
    

<a name="RegenAdminKey"></a>
## Повторное создание ключей администраторов 

Операция **Заново создать ключи администраторов** удаляет и повторно создает первичный или вторичный ключ. Ключи можно заново создавать только по одному. При повторном создании ключей определите, как сохранить доступ к службе. Вторичный ключ предназначен для использования при смене первичного ключа. У каждой службы всегда есть оба ключа. Вы можете заново создавать ключи, но удалять их и запускать без них службу невозможно.
 
    POST https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]/regenerateAdminKey/[keyKind]?api-version=2014-07-31-Preview

###Параметры URI запроса

`subscriptionId`: обязательный параметр. Идентификатор подписки пользователя Azure. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`resourceGroupName`: обязательный параметр. Имя группы ресурсов в рамках подписки пользователя. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`serviceName`: обязательный параметр. Имя службы поиска в указанной группе ресурсов. Если вы не знаете имя службы, список можно получить с помощью операции "Список служб поиска" (API поиска Azure).

`api-version`: обязательный параметр. Указывает версию протокола, используемую для данного запроса. По мере выхода новых версий вы сможете выбирать версию с нужным поведением для каждого запроса.
	
`regenerateKey`: обязательный параметр. Это действие указывает, что будет заново создан первичный или вторичный ключ администратора.

`keyKind`: обязательный параметр. Указывает, какой ключ следует заново создать. Допустимые значения:

- `primary`
- `secondary`

###Заголовки запросов

`Content-Type`: обязательный параметр. Задайте для этого заголовка значение application/json.

`x-ms-client-request-id`: необязательный параметр. Созданное клиентом значение GUID, которое определяет данный запрос. Если это значение указано, оно будет включено в ответное сообщение для сопоставления запроса.

###Текст запроса

Отсутствует.

###Ответ

Если операция выполнена успешно, возвращается код HTTP 200 (ОК).

### Заголовки откликов 

`Content-Type`: этот заголовок всегда имеет значение application/json.

`x-ms-request-id`: уникальный идентификатор текущей операции, создаваемый службой.

###Текст ответа

    {
      "primaryKey": "api key",
      "secondaryKey": "api key"
    }
    
###Элементы текста ответа

`primaryKey`: первичный ключ администратора, если он был повторно создан.

`secondaryKey`: вторичный ключ администратора, если он был повторно создан.



<a name="CreateQueryKey"></a>
## Создание ключа запроса

Операция **Создать ключ запроса** создает новый ключ запроса для службы поиска. Вы можете создать до 50 ключей запросов на службу.

    POST https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]/createQueryKey/[name]?api-version=2014-07-31-Preview

###Параметры URI запроса###

`subscriptionId`: обязательный параметр. Идентификатор подписки пользователя Azure. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`resourceGroupName`: обязательный параметр. Имя группы ресурсов в рамках подписки пользователя. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`serviceName`: обязательный параметр. Имя службы поиска в указанной группе ресурсов. Если вы не знаете имя службы, список можно получить с помощью операции "Список служб поиска" (API поиска Azure).

`api-version`: обязательный параметр. Указывает версию протокола, используемую для данного запроса. По мере выхода новых версий вы сможете выбирать версию с нужным поведением для каждого запроса.

`createQueryKey`: обязательный параметр. Это действие создает ключ запроса для службы поиска.

`name`: обязательный параметр. Имя нового ключа.

###Заголовки запросов

`x-ms-client-request-id`: необязательный параметр. Созданное клиентом значение GUID, которое определяет данный запрос. Если это значение указано, оно будет включено в ответное сообщение для сопоставления запроса.

###Текст запроса

Отсутствует.

###Ответ

Если операция выполнена успешно, возвращается код HTTP 200 (ОК).

### Заголовки откликов

`Content-Type`: этот заголовок всегда имеет значение application/json.

`x-ms-request-id`: уникальный идентификатор текущей операции, создаваемый службой.

###Текст ответа

    {
      "name": "name of key",
      "key": "api key"
    }


###Элементы текста ответа

`name`: имя ключа запроса.

`key`: значение ключа запроса.

<a name="ListQueryKey"></a>
## Список ключей запросов 


Операция **Список ключей запросов** возвращает ключи запросов для указанной службы поиска. Ключи запросов используются для отправки вызовов API (только для чтения) службе поиска. В каждой службе может быть до 50 ключей.

    GET	https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]/listQueryKeys?api-version=2014-07-31-Preview

###Параметры URI запроса

`subscriptionId`: обязательный параметр. Идентификатор подписки пользователя Azure. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`resourceGroupName`: обязательный параметр. Имя группы ресурсов в рамках подписки пользователя. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`serviceName`: обязательный параметр. Имя службы поиска в указанной группе ресурсов. Если вы не знаете имя службы, список можно получить с помощью операции "Список служб поиска" (API поиска Azure).

`api-version`: обязательный параметр. Указывает версию протокола, используемую для данного запроса. По мере выхода новых версий вы сможете выбирать версию с нужным поведением для каждого запроса.
	
`listQueryKeys`: обязательный параметр. Это действие получает ключи запросов для службы поиска.

###Заголовки запросов

`x-ms-client-request-id`: необязательный параметр. Созданное клиентом значение GUID, которое определяет данный запрос. Если это значение указано, оно будет включено в ответное сообщение для сопоставления запроса.

###Текст запроса

Отсутствует.

###Ответ

Если операция выполнена успешно, возвращается код HTTP 200 (ОК).

### Заголовки откликов 

`Content-Type`: этот заголовок всегда имеет значение application/json.

`x-ms-request-id`: уникальный идентификатор текущей операции, создаваемый службой.

###Текст ответа

    {
      "value": [
    	{
          "name": "name of key 1",
          "key": "key 1"
      	},   
      	{   
          "name": "name of key 2",
          "key": "key 2"
      	}
      ],
    "nextLink": null
    }

###Элементы текста ответа

`name`: имя ключа запроса.

`key`: значение ключа запроса.


<a name="DeleteQueryKey"></a>
## Удаление ключей запросов 

Операция **Удалить ключ запроса** удаляет указанный ключ запроса. Ключи запросов необязательны и используются для запросов только на чтение.

    DELETE https://management.azure.com/subscriptions/[subscriptionId]/resourceGroups/[resourceGroupName]/providers/Microsoft.Search/searchServices/[serviceName]/deleteQueryKey/[key]?api-version=2014-07-31-Preview

В отличие от ключей администраторов, ключи запросов не обновляются. Для обновления кода запроса необходимо удалить и заново создать его.

###Параметры URI запроса

`subscriptionId`: обязательный параметр. Идентификатор подписки пользователя Azure. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`resourceGroupName`: обязательный параметр. Имя группы ресурсов в рамках подписки пользователя. Это значение можно получить от API-интерфейса диспетчера ресурсов Azure или портала.

`serviceName`: обязательный параметр. Имя службы поиска в указанной группе ресурсов. Если вы не знаете имя службы, список можно получить с помощью операции "Список служб поиска" (API поиска Azure).

`api-version`: обязательный параметр. Указывает версию протокола, используемую для данного запроса. По мере выхода новых версий вы сможете выбирать версию с нужным поведением для каждого запроса.

`deleteQueryKey`: обязательный параметр. Это действие удаляет существующий ключ запроса для службы поиска.

`key`: обязательный параметр. Ключ, который нужно удалить.

###Заголовки запросов

`x-ms-client-request-id`: необязательный параметр. Созданное клиентом значение GUID, которое определяет данный запрос. Если это значение указано, оно будет включено в ответное сообщение для сопоставления запроса.

###Текст запроса

Отсутствует.

###Ответ

При успешном выполнении возвращается код состояния отклика HTTP 200 (ОК).

### Заголовки откликов 

`Content-Type`: этот заголовок всегда имеет значение application/json.

`x-ms-request-id`: уникальный идентификатор текущей операции, создаваемый службой.

###Текст ответа

Отсутствует.


 

<!---HONumber=July15_HO3-->