---
title: Руководство по вызову API-интерфейсов когнитивного поиска в службе "Поиск Azure" | Документация Майкрософт
description: Пример извлечения данных, обработки естественного языка и изображений с применением искусственного интеллекта в индексировании службы "Поиск Azure" для извлечения и преобразования данных.
manager: pablocas
author: luiscabrer
services: search
ms.service: search
ms.devlang: NA
ms.topic: tutorial
ms.date: 05/01/2018
ms.author: luisca
ms.openlocfilehash: 0bca64675ed656373d6a73ca772fa713ad36a57e
ms.sourcegitcommit: 4f9fa86166b50e86cf089f31d85e16155b60559f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2018
ms.locfileid: "34757576"
---
# <a name="tutorial-learn-how-to-call-cognitive-search-apis-preview"></a>Руководство по вызову API-интерфейсов когнитивного поиска (предварительная версия)

В этом руководстве вы узнаете о механизме программирования обогащения данных в службе "Поиск Azure" с использованием *когнитивных методик*. Когнитивные методики — это операции обработки естественного языка (NLP) и анализа изображений, которые извлекают текст и текстовые представления изображений, определяют язык, сущности, ключевые фразы и многое другое. Конечным результатом является дополнительное содержимое в индексе службы "Поиск Azure", созданное конвейером индексирования когнитивного поиска. 

В этом руководстве вы сделаете вызовы REST API, чтобы выполнить следующие задачи:

> [!div class="checklist"]
> * Создать конвейер индексирования, который дополняет исходные данные в маршруте к индексу.
> * использовать встроенные функции в примере набора данных, такие как распознавание объектов, распознавание языка, обработка текста и извлечение ключевых слов;
> * Объединять методики, сопоставляя входные данные с результатами в наборе навыков.
> * Выполнить запросы и просмотреть результаты.
> * Сбросить индекс и индексаторы для дальнейшей разработки.

Выходные данные — это полнотекстовый индекс с поддержкой поиска в службе "Поиск Azure". Вы можете улучшить индекс с помощью других стандартных возможностей, таких как [синонимы](search-synonyms.md), [профили оценки](https://docs.microsoft.com/rest/api/searchservice/add-scoring-profiles-to-a-search-index), [анализаторы](search-analyzers.md) и [фильтры](search-filters.md).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>предварительным требованиям

Впервые работаете с когнитивным поиском? Ознакомьтесь с общими сведениями в [этой статье](cognitive-search-concept-intro.md) или перейдите к [быстрому руководству по выполнению действия на портале](cognitive-search-quickstart-blob.md) для практической реализации важных концепций.

Чтобы сделать вызовы REST в службу "Поиск Azure", используйте PowerShell или средство веб-тестирования, например Telerik Fiddler или Postman, для формулировки HTTP-запросов. Если вы не знакомы с этими средствами, см. статью [Работа с REST API службы "Поиск Azure" с помощью Fiddler или Postman](search-fiddler.md).

Используйте [портал Azure](https://portal.azure.com/) для создания служб, используемых в сквозном рабочем процессе. 

### <a name="set-up-azure-search"></a>Настройка службы "Поиск Azure"

Сначала зарегистрируйтесь в службе "Поиск Azure". 

1. Перейдите на [портал Azure](https://portal.azure.com) и войдите в систему, используя свою учетную запись Azure.

1. Щелкните **Создать ресурс**, выполните поиск по запросу "Поиск Azure" и щелкните **Создать**. Ознакомьтесь со статьей [Создание службы "Поиск Azure" на портале](search-create-service-portal.md), если вы настраиваете службу поиска впервые.

  ![Панель мониторинга на портале](./media/cognitive-search-tutorial-blob/create-service-full-portal.png "Создание службы \"Поиск Azure\" на портале")

1. Создайте группу ресурсов, которая будет содержать все ресурсы, созданные в рамках этого руководства. Это упрощает очистку ресурсов после завершения руководства.

1. Для расположения выберите **Юго-центральный регион США** или **Западная Европа**. В настоящее время предварительная версия доступна только в этих регионах.

1. В разделе ценовой категории можно выбрать **бесплатный** уровень, чтобы выполнить инструкции в руководствах. Для более глубокого анализа с использованием собственных данных создайте [платную службу](https://azure.microsoft.com/pricing/details/search/), например с уровнем **Базовый** или **Стандартный**. 

  Бесплатная служба ограничивается 3 индексами, максимальным размером большого двоичного объекта в 16 МБ и 2 минутами индексирования, чего недостаточно для использования всех возможностей когнитивного поиска. Ограничения для разных уровней см. на странице [Ограничения поиска Azure](search-limits-quotas-capacity.md).

  > [!NOTE]
  > Служба "Когнитивный поиск" находится в общедоступной предварительной версии. Выполнение набора навыков в настоящее время доступно на всех уровнях, включая бесплатный. Цена на эту функцию будет объявлена позже.

1. Закрепите службу на панели мониторинга, чтобы получать быстрый доступ к информации о службе.

  ![Страница определения службы на портале](./media/cognitive-search-tutorial-blob/create-search-service.png "Страница определения службы на портале")

1. После создания службы соберите следующую информацию: **URL-адрес** на странице "Обзор" и **ключ API** (первичный или вторичный) на странице "Ключи".

  ![Сведения о конечных точках и ключах на портале](./media/cognitive-search-tutorial-blob/create-search-collect-info.png "Сведения о конечных точках и ключах на портале")

### <a name="set-up-azure-blob-service-and-load-sample-data"></a>Настройка службы BLOB-объектов Azure и загрузка примера данных

Конвейер обогащения извлекает данные из источников данных Azure. Исходные данные должны поступать из поддерживаемого типа источника данных [индексатора службы "Поиск Azure"](search-indexer-overview.md). В этом упражнении используется хранилище BLOB-объектов, чтобы продемонстрировать несколько типов содержимого.

1. [Загрузите демонстрационные данные](https://1drv.ms/f/s!As7Oy81M_gVPa-LCb5lC_3hbS-4). Пример данных, который состоит из небольшого набора файлов различных типов. 

1. Зарегистрируйтесь в хранилище BLOB-объектов Azure, создайте учетную запись хранения, войдите в Обозреватель службы хранилища и создайте контейнер с именем `basicdemo`. Дополнительные инструкции по всем шагам см. в статье [Краткое руководство по передаче, скачиванию и составлению списка больших двоичных объектов с помощью Обозревателя службы хранилища Azure](../storage/blobs/storage-quickstart-blobs-storage-explorer.md).

1. Используя Обозреватель службы хранилища Azure, в созданном контейнере `basicdemo` щелкните **Отправить**, чтобы отправить примеры файлов.

1. После загрузки примеров файлов введите имя контейнера и строку подключения для хранилища BLOB-объектов. Это можно сделать, перейдя в вашу учетную запись хранения на портале Azure. На вкладке **Ключи доступа** скопируйте поле **Строка подключения**.

  Строка подключения должна быть URL-адресом, аналогичным следующему примеру:

      ```http
      DefaultEndpointsProtocol=https;AccountName=cogsrchdemostorage;AccountKey=<your account key>;EndpointSuffix=core.windows.net
      ```

Существуют и другие способы указать строку подключения, например предоставить подписанный URL-адрес. Дополнительные сведения об учетных данных источника данных см. в статье [Индексирование документов в хранилище BLOB-объектов Azure с помощью службы поиска Azure](search-howto-indexing-azure-blob-storage.md#Credentials).

## <a name="create-a-data-source"></a>Создание источника данных

Теперь, когда службы и исходные файлы подготовлены, начните сборку компонентов конвейера индексирования. Начните с [объекта источника данных](https://docs.microsoft.com/rest/api/searchservice/create-data-source), который указывает службе "Поиск Azure", как извлекать данные из внешнего источника.

В этом руководстве вы используете REST API и средство, которое может формулировать и отправлять HTTP-запросы, такое как PowerShell, Postman или Fiddler. В заголовке запроса укажите имя службы, которое вы использовали при создании службы "Поиск Azure", и ключ API, созданный для службы поиска. В тексте запроса укажите имя контейнера BLOB-объектов и строку подключения.

### <a name="sample-request"></a>Пример запроса
```http
POST https://[service name].search.windows.net/datasources?api-version=2017-11-11-Preview
Content-Type: application/json  
api-key: [admin key]  
```
#### <a name="request-body-syntax"></a>Синтаксис текста запроса
```json
{   
    "name" : "demodata",  
    "description" : "Demo files to demonstrate cognitive search capabilities.",  
    "type" : "azureblob",
    "credentials" :
    { "connectionString" :
      "DefaultEndpointsProtocol=https;AccountName=<your account name>;AccountKey=<your account key>;"
    },  
    "container" : { "name" : "<your blob container name>" }
}  
```
Отправьте запрос. Средство веб-тестирования должно вернуть код состояния 201, подтверждающий успешное выполнение. 

Так как это ваш первый запрос, на портале Azure убедитесь, что источник данных был создан в службе "Поиск Azure". На странице панели мониторинга службы поиска проверьте наличие нового элемента на плитке "Источники данных". Возможно, вам придется подождать несколько минут, пока обновится страница портала. 

  ![Плитка источников данных на портале](./media/cognitive-search-tutorial-blob/data-source-tile.png "Плитка источников данных на портале")

Если вы получили ошибку 403 или 404, проверьте структуру запроса: `api-version=2017-11-11-Preview` должен находиться в конечной точке, `api-key` должен находиться в заголовке после `Content-Type`, и его значение должно быть действительным для службы поиска. Вы можете повторно использовать заголовок для остальных шагов этого руководства.

> [!TIP]
> Теперь, прежде чем проделать большой объем работы, самое время проверить, что служба поиска работает в одном из поддерживаемых расположений, в которых предоставляется функция предварительной версии: юго-центральный регион США или Западная Европа.

## <a name="create-a-skillset"></a>Создание набора навыков

На этом этапе вы определяете набор шагов обогащения, которые хотите применить к данным. Каждый шаг обогащения называется *навыком*, а набор шагов обогащения — *набором навыков*. В этом руководстве для набора навыков используются [предопределенные когнитивные навыки](cognitive-search-predefined-skills.md):

+ [Распознавание языка](cognitive-search-skill-language-detection.md) для определения языка содержимого.

+ [Разделение текста](cognitive-search-skill-textsplit.md) для разбиения большого объема содержимого на более мелкие фрагменты данных перед вызовом метода извлечения ключевой фразы. Этот метод принимает входные данные объемом 50 000 символов или меньше. Некоторые примеры файлов следует разделить, чтобы удовлетворить это ограничение.

+ [Распознавание именованных сущностей](cognitive-search-skill-named-entity-recognition.md) для извлечения названий организаций из содержимого в контейнере больших двоичных объектов.

+ [Извлечение ключевых фраз](cognitive-search-skill-keyphrases.md) для получения основных ключевых фраз. 

### <a name="sample-request"></a>Пример запроса
Прежде чем выполнить этот вызов REST, не забудьте заменить имя службы и ключ администратора в запросе ниже, если ваше средство не сохраняет заголовок запроса между вызовами. 

Этот запрос создает набор навыков. Укажите имя набора навыков ```demoskillset```, который будет использоваться до конца этого руководства.

```http
PUT https://[servicename].search.windows.net/skillsets/demoskillset?api-version=2017-11-11-Preview
api-key: [admin key]
Content-Type: application/json
```
#### <a name="request-body-syntax"></a>Синтаксис текста запроса
```json
{
  "description": 
  "Extract entities, detect language and extract key-phrases",
  "skills":
  [
    {
      "@odata.type": "#Microsoft.Skills.Text.NamedEntityRecognitionSkill",
      "categories": [ "Organization" ],
      "defaultLanguageCode": "en",
      "inputs": [
        {
          "name": "text", "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "organizations", "targetName": "organizations"
        }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Text.LanguageDetectionSkill",
      "inputs": [
        {
          "name": "text", "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "languageCode",
          "targetName": "languageCode"
        }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Text.SplitSkill",
      "textSplitMode" : "pages", 
      "maximumPageLength": 4000,
      "inputs": [
      {
        "name": "text",
        "source": "/document/content"
      },
      { 
        "name": "languageCode",
        "source": "/document/languageCode"
      }
    ],
    "outputs": [
      {
            "name": "textItems",
            "targetName": "pages"
      }
    ]
  },
  {
      "@odata.type": "#Microsoft.Skills.Text.KeyPhraseExtractionSkill",
      "context": "/document/pages/*",
      "inputs": [
        {
          "name": "text", "source": "/document/pages/*"
        },
        {
          "name":"languageCode", "source": "/document/languageCode"
        }
      ],
      "outputs": [
        {
          "name": "keyPhrases",
          "targetName": "keyPhrases"
        }
      ]
    }
  ]
}
```

Отправьте запрос. Средство веб-тестирования должно вернуть код состояния 201, подтверждающий успешное выполнение. 

#### <a name="about-the-request"></a>Сведения о запросе

Обратите внимание, что для каждой страницы применяется навык извлечения ключевых фраз. Если установить контекст ```"document/pages/*"```, средство обогащения будет выполнено для каждого элемента массива документов или страниц (для каждой страницы в документе).

Каждый навык выполняется в содержимом документа. Во время обработки служба "Поиск Azure" разбивает каждый документ для чтения содержимого из разных форматов файлов. Найденный текст в исходном файле помещается в созданное поле ```content```, по одному для каждого документа. Таким образом, установите входные данные как ```"/document/content"```.

Графическое представление набора навыков показано ниже. 

![Общие сведения о наборе навыков](media/cognitive-search-tutorial-blob/skillset.png "Общие сведения о наборе навыков")

Выходные данные могут быть сопоставлены с индексом, используемым в качестве входных данных для нисходящего навыка, или к обоим, как в случае с кодом языка. В индексе код языка полезен для фильтрации. В качестве входных данных код языка используется навыками анализа текста, чтобы указать лингвистические правила для разбивки слов.

Общие сведения о наборах навыков см. в статье [How to create a skillset in an enrichment pipeline](cognitive-search-defining-skillset.md) (Способ создания набора навыков в конвейере обогащения).

## <a name="create-an-index"></a>Создание индекса

В этом разделе вы определите схему индекса, указав поля для включения в индекс поиска, а также атрибуты поиска для каждого поля. Поля имеют тип и могут принимать атрибуты, определяющие их использование (поиск, сортировка и т. д.). Имена полей в индексе не обязательно должны точно соответствовать именам полей в источнике. На более позднем этапе вы добавите сопоставления полей в индексаторе для подключения полей "источник — назначение". Для этого шага определите индекс, используя соглашения об именовании полей, относящиеся к вашему поисковому приложению.

В этом упражнении используются следующие поля и типы полей:

| имена полей: | id       | Содержимое   | languageCode | keyPhrases         | organizations     |
|--------------|----------|-------|----------|--------------------|-------------------|
| типы полей: | Edm.String|Edm.String| Edm.String| List<Edm.String>  | List<Edm.String>  |


### <a name="sample-request"></a>Пример запроса
Прежде чем выполнить этот вызов REST, не забудьте заменить имя службы и ключ администратора в запросе ниже, если ваше средство не сохраняет заголовок запроса между вызовами. 

Этот запрос создает индекс. Используйте имя индекса ```demoindex```, которое будет использоваться до конца этого руководства.

```http
PUT https://[servicename].search.windows.net/indexes/demoindex?api-version=2017-11-11-Preview
api-key: [api-key]
Content-Type: application/json
```
#### <a name="request-body-syntax"></a>Синтаксис текста запроса

```json
{
  "fields": [
    {
      "name": "id",
      "type": "Edm.String",
      "key": true,
      "searchable": true,
      "filterable": false,
      "facetable": false,
      "sortable": true
    },
    {
      "name": "content",
      "type": "Edm.String",
      "sortable": false,
      "searchable": true,
      "filterable": false,
      "facetable": false
    },
    {
      "name": "languageCode",
      "type": "Edm.String",
      "searchable": true,
      "filterable": false,
      "facetable": false
    },
    {
      "name": "keyPhrases",
      "type": "Collection(Edm.String)",
      "searchable": true,
      "filterable": false,
      "facetable": false
    },
    {
      "name": "organizations",
      "type": "Collection(Edm.String)",
      "searchable": true,
      "sortable": false,
      "filterable": false,
      "facetable": false
    }
  ]
}
```
Отправьте запрос. Средство веб-тестирования должно вернуть код состояния 201, подтверждающий успешное выполнение. 

Дополнительные сведения об определении индекса см. в статье [Create Index (Azure Search Service REST API)](https://docs.microsoft.com/rest/api/searchservice/create-index) (Создание индексов (REST API службы поиска Azure)).


## <a name="create-an-indexer-map-fields-and-execute-transformations"></a>Создание индексатора, сопоставление полей и выполнение преобразования

Пока вы создали источник данных, набор навыков и индекс. Эти три компонента становятся частью [индексатора](search-indexer-overview.md), который объединяет каждую часть в единую многофазную операцию. Чтобы связать их вместе в индексаторе, необходимо определить сопоставления полей. Сопоставления полей являются частью определения индексатора и выполняют преобразования при отправке запроса.

Для индексации без обогащения определение индексатора предоставляет необязательный раздел *fieldMappings*, если имена полей или типы данных не совпадают точно или если вы хотите использовать функцию.

Для рабочих нагрузок с когнитивным поиском, имеющих конвейер обогащения, индексатору требуется *outputFieldMappings*. Эти сопоставления используются, когда внутренний процесс (конвейер обогащения) является источником значений полей. Поведения, уникальные для *outputFieldMappings*, включают в себя способность обрабатывать сложные типы, созданные как часть обогащения (посредством навыка формирователя). Кроме того, в документе может быть много элементов (например, несколько организаций). Конструкция *outputFieldMappings* может указать системе преобразовать набор элементов в одну запись с плоской структурой.

### <a name="sample-request"></a>Пример запроса

Прежде чем выполнить этот вызов REST, не забудьте заменить имя службы и ключ администратора в запросе ниже, если ваше средство не сохраняет заголовок запроса между вызовами. 

Также укажите имя вашего индексатора. Укажите имя ```demoindexer```, которое будет использоваться до конца этого руководства.

```http
PUT https://[servicename].search.windows.net/indexers/demoindexer?api-version=2017-11-11-Preview
api-key: [api-key]
Content-Type: application/json
```
#### <a name="request-body-syntax"></a>Синтаксис текста запроса

```json
{
  "name":"demoindexer", 
  "dataSourceName" : "demodata",
  "targetIndexName" : "demoindex",
  "skillsetName" : "demoskillset",
  "fieldMappings" : [
        {
          "sourceFieldName" : "metadata_storage_path",
          "targetFieldName" : "id",
          "mappingFunction" : 
            { "name" : "base64Encode" }
        },
        {
          "sourceFieldName" : "content",
          "targetFieldName" : "content"
        }
   ],
  "outputFieldMappings" : 
  [
        {
          "sourceFieldName" : "/document/organizations", 
          "targetFieldName" : "organizations"
        },
        {
          "sourceFieldName" : "/document/pages/*/keyPhrases/*", 
          "targetFieldName" : "keyPhrases"
        },
        {
            "sourceFieldName": "/document/languageCode",
            "targetFieldName": "languageCode"
        }      
  ],
  "parameters":
  {
    "maxFailedItems":-1,
    "maxFailedItemsPerBatch":-1,
    "configuration": 
    {
        "dataToExtract": "contentAndMetadata",
        "imageAction": "generateNormalizedImages"
        }
  }
}
```

Отправьте запрос. Средство веб-тестирования должно вернуть код состояния 201, подтверждающий успешную обработку. 

Выполнение этого действия может занять несколько минут. Несмотря на то что набор данных невелик, аналитические навыки выполняют интенсивные вычисления. Некоторые навыки, такие как анализ изображений, долго выполняются.

> [!TIP]
> Создание индексатора вызывает конвейер. Если есть проблемы с получением данных, сопоставлением входных и выходных данных или порядком операций, они появятся на этом этапе. Чтобы повторно запустить конвейер с изменениями кода или скрипта, вам может потребоваться сначала удалить объекты. Дополнительные сведения см. в статье [Руководство по вызову API-интерфейсов когнитивного поиска (предварительная версия)](#reset).

### <a name="explore-the-request-body"></a>Просмотр текста запроса

Скрипт устанавливает значение -1 для ```"maxFailedItems"```, которое инструктирует механизм индексирования игнорировать ошибки во время импорта данных. Это полезно, потому что в демонстрационном источнике данных мало документов. Для большего источника данных необходимо установить значение больше 0.

Также обратите внимание на оператор ```"dataToExtract":"contentAndMetadata"``` в параметрах конфигурации. Этот оператор указывает индексатору автоматически извлекать содержимое из разных форматов файлов, а также метаданные, относящиеся к каждому файлу. 

Когда содержимое будет извлечено, вы можете установить ```ImageAction``` для извлечения текста из изображений, найденных в источнике данных. ```"ImageAction":"generateNormalizedImages"``` инструктирует индексатор извлекать текст из изображений (например, слово "стоп" из знака остановки движения) и вставлять его как часть поля содержимого. Это относится как к изображениям, встроенным в документы (например, изображение внутри PDF-файлов), так и к изображениям, найденным в источнике данных, например к файлу JPG.

В предварительной версии ```"generateNormalizedImages"``` является единственным допустимым значением для ```"ImageAction"```.

## <a name="check-indexer-status"></a>Проверка состояния индексатора

После того как индексатор будет определен, он будет выполняться автоматически при отправке запроса. В зависимости от того, какие когнитивные навыки вы определили, индексирование может занять больше времени, чем вы ожидаете. Чтобы узнать, работает ли индексатор, отправьте следующий запрос для получения сведений о состоянии.

```http
GET https://[servicename].search.windows.net/indexers/demoindexer/status?api-version=2017-11-11-Preview
api-key: [api-key]
Content-Type: application/json
```

В ответе вернутся сведения о том, что индексатор работает. После завершения индексирования используйте другой HTTP-метод GET для конечной точки STATUS (как указано выше), чтобы просмотреть отчеты об ошибках и предупреждениях, которые произошли во время обогащения.  

Предупреждения часто возникают с некоторыми исходными файлами и комбинациями навыков и не всегда указывают на проблему. В этом руководстве предупреждения являются неопасными (например, нет текстовых входных данных из файлов JPEG). Вы можете просмотреть ответ о состоянии, чтобы получить подробную информацию о предупреждениях, выдаваемых при индексировании.
 
## <a name="verify-content"></a>Проверка содержимого

После завершения индексации выполните запросы, возвращающие содержимое отдельных полей. По умолчанию служба "Поиск Azure" возвращает 50 лучших результатов. Примеры данных малы, поэтому параметр по умолчанию работает нормально. Однако при работе с большими наборами данных вам может потребоваться включить параметры в строку запроса, чтобы вернуть больше результатов. Инструкции см. в статье [Разбивка результатов поиска на страницы в службе поиска Azure](search-pagination-page-layout.md).

Для проверки запросите индекс для всех полей.

```http
GET https://[servicename].search.windows.net/indexes/demoindex?api-version=2017-11-11-Preview
api-key: [api-key]
Content-Type: application/json
```

В результате будет возвращена схема индекса с именем и типом, а также атрибуты каждого поля.

Отправьте второй запрос с `"*"`, чтобы вернуть все содержимое одного поля, например `organizations`.

```http
GET https://[servicename].search.windows.net/indexes/demoindex/docs?search=*&$select=organizations&api-version=2017-11-11-Preview
api-key: [api-key]
Content-Type: application/json
```

Повторите запрос для дополнительных полей: содержимое, язык, ключевые фразы и организации в этом упражнении. Вы можете возвратить несколько полей с помощью `$select`, используя разделенный запятыми список.

Можно использовать методы GET или POST, в зависимости от сложности и длины строки запроса. Дополнительные сведения см. в статье [Отправка запросов в индекс службы поиска Azure с помощью REST API](https://docs.microsoft.com/azure/search/search-query-rest-api).

<a name="access-enriched-document"></a>

## <a name="accessing-the-enriched-document"></a>Доступ к обогащенному документу

Когнитивный поиск позволяет увидеть структуру обогащенного документа. Обогащенные документы — это временные структуры, которые создаются во время обогащения и удаляются после завершения процесса.

Чтобы сделать снимок обогащенного документа, созданного во время индексирования, добавьте в индекс поле ```enriched```. Индексатор автоматически помещает в поле строковое представление всех экземпляров обогащения этого документа.

Поле ```enriched``` будет содержать строку, которая является логическим представлением обогащенного документа в JSON, находящегося в памяти.  Значение поля является допустимым документом JSON. Кавычки экранируются, поэтому вам нужно заменить `\"` на `"`, чтобы просмотреть документ в формате JSON.  

Поле ```enriched``` предназначено для целей отладки, чтобы помочь вам понять логическую форму содержимого, используемого для обработки выражений. Это может быть полезным средством для понимания и отладки набора навыков.

Повторите предыдущее упражнение, в том числе поле `enriched`, чтобы сохранить содержимое обогащенного документа:

### <a name="request-body-syntax"></a>Синтаксис текста запроса
```json
{
  "fields": [
    {
      "name": "id",
      "type": "Edm.String",
      "key": true,
      "searchable": true,
      "filterable": false,
      "facetable": false,
      "sortable": true
    },
    {
      "name": "content",
      "type": "Edm.String",
      "sortable": false,
      "searchable": true,
      "filterable": false,
      "facetable": false
    },
    {
      "name": "languageCode",
      "type": "Edm.String",
      "searchable": true,
      "filterable": false,
      "facetable": false
    },
    {
      "name": "keyPhrases",
      "type": "Collection(Edm.String)",
      "searchable": true,
      "filterable": false,
      "facetable": false
    },
    {
      "name": "organizations",
      "type": "Collection(Edm.String)",
      "searchable": true,
      "sortable": false,
      "filterable": false,
      "facetable": false
    },
    {
      "name": "enriched",
      "type": "Edm.String",
      "searchable": false,
      "sortable": false,
      "filterable": false,
      "facetable": false
    }
  ]
}
```
<a name="reset"></a>

## <a name="reset-and-rerun"></a>Сброс и повторный запуск

На ранних экспериментальных этапах разработки конвейера наиболее практичным подходом к итерации проектирования является удаление объектов из службы "Поиск Azure" и их восстановление. Имена ресурсов являются уникальными. Удаление объекта позволяет воссоздать его с использованием того же имени.

Чтобы повторно проиндексировать документы с использованием новых определений:

1. Удалите индекс, чтобы удалить сохраненные данные. Удалите индексатор для его восстановления в службе.
2. Измените определение набора навыков и индекса.
3. Заново создайте индекс и индексатор в службе для запуска конвейера. 

Для удаления индексов и индексаторов можно использовать портал. Если вам понадобится удалить навыки, это можно сделать только с помощью команды HTTP.

```http
DELETE https://[servicename].search.windows.net/skillsets/demoskillset?api-version=2017-11-11-Preview
api-key: [api-key]
Content-Type: application/json
```

При успешном удалении возвращается код состояния 204.

По мере оптимизации кода вам может потребоваться уточнить стратегию восстановления. Дополнительные сведения см. в статье [How to rebuild an Azure Search index](search-howto-reindex.md) (Как восстановить индекс для службы "Поиск Azure").

## <a name="takeaways"></a>Общие выводы

В этом руководстве показаны основные шаги для построения обогащенного конвейера индексирования посредством создания компонентов: источника данных, набора навыков, индекса и индексатора.

Вы получили сведения о [предопределенных навыках](cognitive-search-predefined-skills.md), а также определении набора навыков и механизме построения цепочек навыков путем сопоставления входных и выходных данных. Вы также узнали, что `outputFieldMappings` в определении индексатора требуется для маршрутизации обогащенных значений из конвейера в индекс для поиска в службе "Поиск Azure".

Наконец, вы узнали, как тестировать результаты и выполнять сброс системы для дальнейших итераций. Вы узнали, что отправка запросов к индексу возвращает результат, созданный обогащенным конвейером индексирования. В этом выпуске существует механизм просмотра внутренних конструкций (обогащенные документы, созданные системой). Вы также узнали, как проверить состояние индексатора, и какие объекты нужно удалить перед повторным запуском конвейера.

## <a name="clean-up-resources"></a>Очистка ресурсов

Самый быстрый способ очистки после завершения работы с руководством — удалить группу ресурсов, содержащую службу "Поиск Azure" и службу BLOB-объектов Azure. Предположим, обе службы находятся в одной группе, в этом случае удалите группу ресурсов, чтобы окончательно удалить все ее содержимое, включая службы и любое хранимое содержимое, созданное для этого руководства. На портале имя группы ресурсов находится на странице "Обзор" каждой службы.

## <a name="next-steps"></a>Дополнительная информация

Настройте или расширьте конвейер, добавив пользовательские навыки. Создание пользовательского навыка и добавление его в набор навыков позволяет вам внедрять анализ текста или изображения, который вы пишете сами. 

> [!div class="nextstepaction"]
> [Пример создания пользовательского навыка с помощью API перевода текста](cognitive-search-create-custom-skill-example.md)
