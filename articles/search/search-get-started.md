<properties 
	pageTitle="Начало работы со службой поиска Azure | Microsoft Azure" 
	description="Приступайте к работе с Поиском Azure, размещенной облачной службой поиска в Microsoft Azure." 
	services="search" 
	documentationCenter="" 
	authors="HeidiSteen" 
	manager="mblythe" 
	editor=""
    tags="azure-portal"/>

<tags 
	ms.service="search" 
	ms.devlang="rest-api" 
	ms.workload="search" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.date="11/04/2015" 
	ms.author="heidist"/>

# Начало работы со службой поиска Azure

Поиск Microsoft Azure — это размещенная облачная служба поиска, позволяющая встраивать поисковые функции в пользовательские приложения. Она предоставляет поисковую систему и хранилище данных, к которым можно обращаться и которыми можно управлять посредством библиотеки .NET или API REST.

Эта статья познакомит вас с API REST службы поиска Azure.

Разработчики .NET могут также использовать SDK .NET службы поиска Azure. Дополнительные сведения см. в разделе [Начало работы с поиском Azure в .NET](search-get-started-dotnet.md) или [Использование SDK .NET службы поиска Azure](search-howto-dotnet-sdk.md).


> [AZURE.NOTE]Для изучения этого руководства требуется [подписка на Azure](../includes/free-trial-note.md). Если вы не хотите регистрироваться и получать пробную подписку, пропустите это руководство и обратитесь вместо него к [службе ознакомления с приложениями Azure](https://tryappservice.azure.com/). Выбрав этот альтернативный вариант, вы сможете пользоваться поиском Azure с веб-приложением ASP.NET бесплатно (в течение одного часа за один сеанс); подписка в таком случае не требуется.
 
<a id="sub-1"></a>
## Начало работы с бесплатной службой

Как администратор, вы можете бесплатно добавить службу Поиска в существующую подписку при выборе общей службы либо по сниженной цене при выборе службы для выделенных ресурсов.

Подписчики автоматически получают бесплатный доступ к общей мультитенантной службе поиска, которую можно использовать в целях обучения, экспериментального тестирования или для разработки небольших проектов поиска. Для того чтобы подписаться на бесплатную версию, выполните нижеуказанные действия.

1. Войдите на [портал Azure](https://portal.azure.com) с помощью существующей подписки. Обратите внимание, что по ссылке производится переход на портал предварительной версии. Использование предварительной версии портала является обязательным. 

2. В верхней части страницы нажмите **Создать**.
 
  	![][6]

3. Выберите пункт **Данные + хранилище** | **Поиск**.

	- Введите имя службы строчными буквами для использования в URL-адресе службы, не используйте пробелы, максимальная длина не должна превышать 15 символов.

	- Нажмите на стрелку в **Уровень ценообразования**, чтобы выбрать вариант ценообразования. Выберите **БЕСПЛАТНО**, затем нажмите **ВЫБРАТЬ** в нижней части страницы. Бесплатная версия предоставляет достаточный объем для прохождения учебного курса и написания экспериментального кода, однако она не предназначена для промышленной эксплуатации.

	- Нажмите на стрелку в **Группа ресурса** и выберите существующую группу, либо создайте новую. Группы ресурсов — это контейнеры для служб и ресурсов, используемых для одной и той же цели. Например, если вы создаете пользовательские приложения поиска на основе Поиска Azure, веб-сайтов Azure, хранилища BLOB-объектов Azure, то можно создать группу ресурсов, которая будет объединять все эти службы вместе на страницах портала управления.

	- Нажмите на стрелку в **Подписка**, если у вас имеется несколько подписок и вы хотите использовать другую подписку для этой службы.

	- Нажмите на стрелку в **Расположение**, чтобы выбрать регион центра обработки данных. Для данной предварительной версии регион можно выбрать из Запада США, Востока США, Северной Европы и Юго-Восточной Азии. Позднее будут включены прочие регионы. Выберите один регион для создаваемой службы. Распределение ресурсов между несколькими центрами обработки данных может быть недоступно для конфигурации для общедоступный предварительный версии.

4. Нажмите кнопку **Создать**, чтобы подготовить службу. Обратите внимание, что кнопка **CREATE** становится доступна только после заполнения всех необходимых полей.

Через несколько минут служба будет создана. Можете вернуться к настройкам конфигурации, чтобы получить ссылки URL или ключи API. Для подключения к службе Поиска необходимо иметь как URL, так и ключ API, чтобы проверить подлинность при вызове. Эти значения можно получить следующим образом:

14. Перейдите на вкладку **Главная**, чтобы открыть панель мониторинга. Щелкните службу поиска, чтобы открыть панель мониторинга службы. 

  	![][13]

15.	На панели мониторинга вы увидите заголовки для **СВОЙСТВ** **КЛЮЧЕЙ**, а также информацию об использовании, которая показывает использование ресурсов.

Перейдите к разделу [Операции тестирования службы](#sub-3), чтобы получить инструкции по подключению к службе с использованием этих значений.

<a id="sub-2"></a>
## Обновление до стандартного поиска

Стандартный Поиск предоставляет выделенные ресурсы в центре обработки данных Azure, которые могут использоваться только вами. Рабочие нагрузки поиска требуют реплики как хранилищ, так и служб. После подписки на стандартный Поиск вы можете оптимизировать конфигурацию службы, чтобы получить максимальную отдачу в зависимости от того, какой ресурс является наиболее важным для вашего сценария.

Наличие выделенных ресурсов даст вам большую возможность масштабирования и лучшую производительность, но не дополнительные функции. Функции общего и стандартного поиска совпадают.

Чтобы пользоваться стандартным поиском, создайте новую службу Поиска, выбрав уровень ценообразования «Стандартный». Обратите внимание, что это обновление не является замещением для бесплатной версии. Для того чтобы перейти к стандартной версии с ее возможностью масштабирования, необходимо создать новую службу. Вам потребуется повторно загрузить индексы и документы, которые используются приложением поиска.

Настройка выделенных ресурсов может занять некоторое время (15 минут и более).

**Шаг 1. Создание новой службы стандартной ценовой категории**

1. Войдите на [портал Azure](https://portal.azure.com) с помощью существующей подписки. 

2. В нижней части страницы щелкните **Создать**.

4. Из галерее выберите **Данные + хранилище** | **Поиск**.

7. Заполните параметры конфигурации службы и нажмите кнопку **СОЗДАТЬ**.

8. В поле **Ценовая категория** выберите ценовую категорию. Выберите **СТАНДАРТНЫЙ**, затем нажмите **ВЫБРАТЬ** в нижней части страницы.

**Шаг 2. Настройка единиц поиска на основе требований к масштабируемости**

Стандартный поиск создается с одной репликой и одним разделом, но легко может быть отмасштабирован на более высоких уровнях ресурсов.

1.	После создания службы вернитесь в панель мониторинга службы и выберите заголовок **Масштабирование**.

2.	Воспользуйтесь ползунками для добавления реплик, разделов или того и другого.

Счета за дополнительные реплики и разделы выставляются в единицах поиска. Итоговое количество единиц поиска, которое требуется для поддержки определенной конфигурации ресурсов, отображается на странице по мере добавления ресурсов.

Для получения информации по стоимости единицы можно воспользоваться разделом [Сведения о ценах](http://go.microsoft.com/fwlink/p/?LinkID=509792). В статье [Ограничения (служба поиска Azure)](search-limits-quotas-capacity.md) можно найти справочные сведения, которые помогут в настройке сочетаний разделов и реплик.

 ![][15]

<a id="sub-3"></a>
## Операции тестирования службы

Подтверждение того, что ваша служба находится в рабочем состоянии и доступна из клиентского приложения, является заключительным этапом в настройке Поиска. В данной процедуре для формирования HTTP-запросов и просмотра ответов используется отладчик Fiddler, его можно [бесплатно загрузить с Telerik](http://www.telerik.com/fiddler). Используя Fiddler, можно тестировать API непосредственно, без необходимости написания кода.

Ниже приведена процедура, она работает как для общего, так и для стандартного поиска. Выполнив приведенные ниже шаги, вы создадите индекс, загрузите документы, выполните запрос к индексу, а затем запросите у системы служебную информацию.

### Создание индекса

1. Запустите Fiddler. В меню File выключите **Capture Traffic (Захватывать трафик)**, чтобы не показывать постороннюю активность HTTP, не связанную с текущей задачей. На вкладке Composer сформулируйте запрос, который выглядит как: 

  	![][16]

2. Выберите **PUT**.

3. Введите URL, который задает URL службы (его можно найти на странице «Свойства»), атрибуты запроса и версию API. Не забывайте:
   + Используйте префикс HTTPS.
   + Атрибут запроса: "/indexes/hotels". В этом случае Поиск создает индекс с именем hotels.
   + Версия API вводится строчными буквами, в виде "?api-version=2015-02-28". Версии API имеют важное значение, так как обновления Поиска Azure разворачиваются на регулярной основе. В редких случаях обновление службы может привести к нарушению функционирования API. При использовании версий API вы можете продолжать использовать выбранную версию и обновить ее, когда будет удобно.

    Полный URL должен выглядеть подобно этому примеру:

         https://my-app.search.windows.net/indexes/hotels?api-version=2015-02-28

4.	Укажите заголовок запроса, заменив адрес узла и ключ API значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

5.	В теле запроса скопируйте их в поля, формирующие определение индекса.

         {
        "name": "hotels",  
        "fields": [
          {"name": "hotelId", "type": "Edm.String", "key":true, "searchable": false},
          {"name": "baseRate", "type": "Edm.Double"},
          {"name": "description", "type": "Edm.String", "filterable": false, "sortable": false, "facetable": false},
          {"name": "hotelName", "type": "Edm.String", "suggestions": true},
          {"name": "category", "type": "Edm.String"},
          {"name": "tags", "type": "Collection(Edm.String)"},
          {"name": "parkingIncluded", "type": "Edm.Boolean"},
          {"name": "smokingAllowed", "type": "Edm.Boolean"},
          {"name": "lastRenovationDate", "type": "Edm.DateTimeOffset"},
          {"name": "rating", "type": "Edm.Int32"},
          {"name": "location", "type": "Edm.GeographyPoint"}
         ] 
        }

6.	Нажмите **Execute (Выполнить)**.

Через несколько секунд появится ответ HTTP 201. Это значит, что индекс успешно создан.

Если вы получите код HTTP 504, проверьте, что в URL указан протокол HTTPS. Если возникают сообщения об ответных кодах 400 или 404 протокола HTTP, следует удостовериться в отсутствии ошибок при копировании. Код HTTP 403, как правило, означает, что возникла ошибка с ключом API (либо он недействительный, либо имеется ошибка синтаксиса при указании ключа).

### Загрузка документов

На вкладке Composer запрос на добавление документов будет выглядеть примерно так: Тело запроса содержит данные поиска для четырех отелей.

   ![][17]

1. Выберите **POST**.

2.	Введите URL-адрес, начинающийся с HTTPS, далее URL-адрес вашей службы, а затем "/indexes/<'indexname'>/docs/index?api-version=2015-02-28". Полный URL должен выглядеть подобно этому примеру:

        https://my-app.search.windows.net/indexes/hotels/docs/index?api-version=2015-02-28

3.	Заголовок запроса должен остаться таким же, как прежде. Не забывайте, что вы заменили адрес узла и ключ API (строчные буквы) значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

4.	Тело запроса содержит четыре документа, которые нужно добавить в индекс отелей.

        {
        "value": [
        {
        	"@search.action": "upload",
        	"hotelId": "1",
        	"baseRate": 199.0,
        	"description": "Best hotel in town",
        	"hotelName": "Fancy Stay",
        	"category": "Luxury",
        	"tags": ["pool", "view", "wifi", "concierge"],
        	"parkingIncluded": false,
        	"smokingAllowed": false,
        	"lastRenovationDate": "2010-06-27T00:00:00Z",
        	"rating": 5,
        	"location": { "type": "Point", "coordinates": [-122.131577, 47.678581] }
          },
          {
        	"@search.action": "upload",
        	"hotelId": "2",
        	"baseRate": 79.99,
        	"description": "Cheapest hotel in town",
        	"hotelName": "Roach Motel",
        	"category": "Budget",
        	"tags": ["motel", "budget"],
        	"parkingIncluded": true,
        	"smokingAllowed": true,
        	"lastRenovationDate": "1982-04-28T00:00:00Z",
        	"rating": 1,
        	"location": { "type": "Point", "coordinates": [-122.131577, 49.678581] }
          },
          {
        	"@search.action": "upload",
        	"hotelId": "3",
        	"baseRate": 279.99,
        	"description": "Surprisingly expensive",
        	"hotelName": "Dew Drop Inn",
        	"category": "Bed and Breakfast",
        	"tags": ["charming", "quaint"],
        	"parkingIncluded": true,
        	"smokingAllowed": false,
        	"lastRenovationDate": null,
        	"rating": 4,
        	"location": { "type": "Point", "coordinates": [-122.33207, 47.60621] }
          },
          {
        	"@search.action": "upload",
        	"hotelId": "4",
        	"baseRate": 220.00,
        	"description": "This could be the one",
        	"hotelName": "A Hotel for Everyone",
        	"category": "Basic hotel",
        	"tags": ["pool", "wifi"],
        	"parkingIncluded": true,
        	"smokingAllowed": false,
        	"lastRenovationDate": null,
        	"rating": 4,
        	"location": { "type": "Point", "coordinates": [-122.12151, 47.67399] }
          }
         ]
        }

8.	Нажмите **Execute (Выполнить)**.

Через несколько секунд в списке сеансов появится ответ HTTP 200. Это означает, что документы были успешно созданы. Код 207 говорит об ошибке загрузки хотя бы одного из документов. Код 404 говорит о синтаксической ошибке в заголовке или в теле запроса.

### Запрос индекса

После загрузки индекса и документов можно формировать запросы к ним. На вкладке Composer команда GET, которая запрашивает вашу службу, будет выглядеть примерно так:

   ![][18]

1.	Выберите **GET**.

2.	Введите URL, начинающийся с HTTPS, далее URL вашей службы, далее "/indexes/<'indexname'>/docs?", далее параметры запроса. В качестве примера используйте этот URL, заменив имя узла на имя, соответствующее вашей службе.

        https://my-app.search.windows.net/indexes/hotels/docs?search=motel&facet=category&facet=rating,values:1|2|3|4|5&api-version=2015-02-28

    Запрос ищет термин "мотель" и возвращает плоский список категорий для рейтинга.

3.	Заголовок запроса должен остаться таким же, как прежде. Не забывайте, что вы заменили адрес узла и ключ API (строчные буквы) значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

Код ответа должен быть 200 и сам ответ должен выглядеть похожим на приведенный на рисунке.
 
   ![][19]

Ниже приведен пример запроса из [Работа с поисковым индексом (API Поиска Azure)](http://msdn.microsoft.com/library/dn798927.aspx) на MSDN. Многие примеры запросов в данном разделе включают пробелы, что является недопустимым в Fiddler. Замените все пробелы символом + перед вставкой в строку запроса и его выполнением в Fiddler:

**До замены пробелов:**

        GET /indexes/hotels/docs?search=*&$orderby=lastRenovationDate desc&api-version=2015-02-28

**После замены пробелов символом +:**

        GET /indexes/hotels/docs?search=*&$orderby=lastRenovationDate+desc&api-version=2015-02-28
### Запрос к системе

Также можно формировать запросы к системе для получения количества документов и занятого объема хранилища. На вкладке Composer ваш запрос будет выглядеть примерно так, как показано ниже. Ответ вернет количество документов и объем занятого пространства.

   ![][20]

1.	Выберите **GET**.

2.	Введите URL, включающий URL-адрес вашей службы, а затем "/indexes/hotels/stats?api-version=2015-02-28":

        https://my-app.search.windows.net/indexes/hotels/stats?api-version=2015-02-28 

3.	Укажите заголовок запроса, заменив адрес узла и ключ API значениями, соответствующими вашей службе.

        User-Agent: Fiddler
        host: my-app.search.windows.net
        content-type: application/json
        api-key: 1111222233334444

4.	Не заполняйте тело запроса.

5.	Нажмите **Execute (Выполнить)**. Через несколько секунд в списке сеансов появится ответ HTTP 200. Выберите запись, которая сопровождается вашей командой.

6.	Щелкните вкладку Inspectors | Headers, затем выберите JSON format. Вы увидите количество документов и занятый ими размер (в килобайтах).

 	![][21]

<a id="sub-4"></a>
## Обзор панели мониторинга службы поиска

Если вы хотите освежить в памяти сведения о том, где найти страницы конфигурации, выполните следующие действия, чтобы найти панель мониторинга службы.

1.	Войдите на [портал Azure](https://portal.azure.com) с помощью существующей подписки. 
2.	Перейдите на вкладку **Главная**, а затем щелкните плитку службы поиска.

 	![][22]

4.	При этом откроется панель мониторинга службы. Обратите внимание на команды **Запустить**, **Остановить** и **Удалить** в верхней части страницы.

5.	Обратите внимание, что URL-адрес службы находится в верхней части страницы. Этот URL-адрес потребуется для подключения к службе поиска Azure.
	
7.	Щелкните значок **КЛЮЧЕЙ**, чтобы просмотреть ключи API. Для прохождения проверки подлинности в службе потребуется ключ администратора. Можно использовать первичный или вторичный ключ. Дополнительно можно создать ключи запросов для получения доступа только для чтения к службе.


<!--Next steps and links -->
<a id="next-steps"></a>
## Попробуйте сейчас

Вы готовы к следующему шагу? Следующие ссылки содержат дополнительный материал, который расскажет вам о том, как создавать и управлять приложениями поиска, использующих Поиск Azure.

- [Пример создания геопространственного поиска Azure](search-create-geospatial.md)

- [Управление решением поиска в Microsoft Azure](search-manage.md)

- [Что такое поиск Azure?](search-what-is-azure-search.md)

- [REST API службы поиска Azure](http://msdn.microsoft.com/library/dn798935.aspx)

- [SDK .NET службы поиска Azure](https://msdn.microsoft.com/library/azure/dn951165.aspx)

- [Видео Channel 9. Введение в Поиск Azure](http://channel9.msdn.com/Shows/Data-Exposed/Introduction-To-Azure-Search)

- [Видео Channel 9. Поиск Azure и геопространственные данные](http://channel9.msdn.com/Shows/Data-Exposed/Azure-Search-and-Geospatial-Data)

- [Видеоролик № 152 об облачном покрытии. Создание индекса в службе поиска Azure](http://channel9.msdn.com/Shows/Cloud+Cover/Cloud-Cover-152-Azure-Search-with-Liam-Cavanagh)

<!--Anchors-->
[Start with the free service]: #sub-1
[Upgrade to standard search]: #sub-2
[Test service operations]: #sub-3
[Explore Search service dashboard]: #sub-4
[Try it out]: #next-steps

<!--Image references-->
[6]: ./media/search-get-started/AzureSearch_Configure1_1_New.PNG
[7]: ./media/search-get-started/AzureSearch_Configure1_2_Everything.PNG
[8]: ./media/search-get-started/Azuresearch_Configure1_3a_Gallery.PNG
[9]: ./media/search-get-started/AzureSearch_Configure1_4_GallerySeeAll.PNG
[10]: ./media/search-get-started/AzureSearch_Configure1_5_SearchTile.PNG
[11]: ./media/search-get-started/AzureSearch_Configure1_6_URL.PNG
[12]: ./media/search-get-started/AzureSearch_Configure1_7a_Free.PNG
[13]: ./media/search-get-started/AzureSearch_Configure1_17_HomeDashboard.PNG
[14]: ./media/search-get-started/AzureSearch_Configure1_9_Standard.PNG
[15]: ./media/search-get-started/AzureSearch_Configure1_10_ScaleUp.PNG
[16]: ./media/search-get-started/AzureSearch_Configure1_11_PUTIndex.PNG
[17]: ./media/search-get-started/AzureSearch_Configure1_12_POSTDocs.PNG
[18]: ./media/search-get-started/AzureSearch_Configure1_13_GETQuery.PNG
[19]: ./media/search-get-started/AzureSearch_Configure1_14_GETQueryResponse.PNG
[20]: ./media/search-get-started/AzureSearch_Configure1_15_Stats.PNG
[21]: ./media/search-get-started/AzureSearch_Configure1_16_StatsResponse.PNG
[22]: ./media/search-get-started/AzureSearch_Configure1_17_HomeDashboard.PNG
[23]: ./media/search-get-started/AzureSearch_Configure1_18_Explore.PNG


<!--Link references-->
[Manage your search solution in Microsoft Azure]: search-manage.md
[Azure Search development workflow]: search-workflow.md
[Create your first azure search solution]: search-create-first-solution.md
[Create a geospatial search app using Azure Search]: search-create-geospatial.md

<!---HONumber=Nov15_HO2-->