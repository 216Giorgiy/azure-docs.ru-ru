---
title: "Начало работы с REST API управления службы поиска Azure | Документация Майкрософт"
description: "Администрирование размещенной облачной службы Поиск Azure с помощью API REST управления"
services: search
documentationcenter: 
author: HeidiSteen
manager: jhubbard
editor: 
ms.assetid: cd4c41d8-81bd-4609-9a37-e112ddf1f21f
ms.service: search
ms.devlang: rest-api
ms.workload: search
ms.topic: article
ms.tgt_pltfrm: na
ms.date: 10/17/2016
ms.author: heidist
translationtype: Human Translation
ms.sourcegitcommit: 503f5151047870aaf87e9bb7ebf2c7e4afa27b83
ms.openlocfilehash: 4fe0db2a5fb9b7798d8583721ac35b2e02435d7d
ms.lasthandoff: 03/29/2017


---
# <a name="get-started-with-azure-search-management-rest-api"></a>Приступая к работе с Azure Search Management REST API
> [!div class="op_single_selector"]
> * [Портал](search-manage.md)
> * [PowerShell](search-manage-powershell.md)
> * [ИНТЕРФЕЙС REST API](search-get-started-management-api.md)
>
>

Azure Search management REST API является программной альтернативой выполнению административных задач на портале. К операциям по управлению службами относится создание или удаление службы, ее масштабирование и управление ключами. В этом учебнике предоставлен образец клиентского приложения, демонстрирующего работу API управления службами. Он также содержит настройки, которые необходимые сделать для запуска образца в локальной среде разработки.

Для работы с этим учебником требуется:

* Visual Studio 2012 или 2013
* скачанный пример клиентского приложения.

Во процессе изучения данного руководства будут подготовлены две службы: поиск Azure и Azure Active Directory (AD). Кроме того вы создадите AD приложение, которое установит доверительное отношение между клиентским приложением и конечной точкой диспетчера ресурсов в Azure.

Для работы с этим руководством требуется учетная запись Azure.

## <a name="download-the-sample-application"></a>Загрузка примера приложения
Этот учебник основан на консольном приложении, построенном на языке C#, которое можно отредактировать и запустить в Visual Studio 2012 или 2013

Клиентское приложение можно найти на сайте GitHub в разделе [Azure Search .NET Management API Demo](https://github.com/Azure-Samples/search-dotnet-management-api/) (Демонстрационная версия API управления .NET для Поиска Azure).

## <a name="configure-the-application"></a>Настройка приложения
Перед запуском примера приложения, необходимо включить проверку подлинности, чтобы запросы, отправленные из клиентского приложения к конечной точке диспетчера ресурсов, могли быть приняты. Требование проведения проверки подлинности исходит от [диспетчера ресурсов Azure](https://msdn.microsoft.com/library/azure/dn790568.aspx), который служит основой для всех операций на портале, запрашиваемых через API-интерфейс, в том числе относящиеся к управлению службой поиска. API управления службами для поиска Azure это просто расширение диспетчера ресурсов Azure и таким образом наследует все его зависимости.  

Диспетчеру ресурсов Azure требуется служба Azure Active Directory в качестве поставщика удостоверений.

Чтобы получить маркер доступа, который позволит запросам дойти до диспетчера ресурсов, клиентское приложение имеет сегмент кода, который вызывает Active Directory. Этот сегмент кода, а также все действия, необходимые для его понимания и написания, позаимствованы из следующей статьи: [Проверка подлинности запросов к диспетчеру ресурсов Azure](http://msdn.microsoft.com/library/azure/dn790557.aspx).

Следуйте инструкциям в приведенной выше ссылке или выполните действия, описанные в данном документе, если вы предпочитаете проходить учебник шаг за шагом.

В этом разделе мы выполним следующие задачи:

1. Создание службы AD
2. Создание приложения AD
3. Настройка приложения AD путем регистрации сведений о примере загруженного клиентского приложения
4. Загрузить в пример клиентского приложения значения, которые будут использоваться для авторизации его запросов

> [!NOTE]
> Эти ссылки ведут к материалам с описанием использования Azure Active Directory для аутентификации клиентских запросов к диспетчеру ресурсов: [Диспетчер ресурсов Azure](http://msdn.microsoft.com/library/azure/dn790568.aspx), [Проверка подлинности запросов к диспетчеру ресурсов Azure](http://msdn.microsoft.com/library/azure/dn790557.aspx) и [Azure Active Directory](http://msdn.microsoft.com/library/azure/jj673460.aspx).
>
>

### <a name="create-an-active-directory-service"></a>Создание службы Active Directory
1. Войдите на [портал Azure](https://manage.windowsazure.com).
2. Прокрутите вниз содержимое левой области навигации и выберите **Active Directory**.
3. Щелкните **Создать**, чтобы открыть **Службы приложений** | , и выберите **Active Directory**. На этом шаге вы создаете новую службу Active Directory. В этой службе будет размещаться приложение AD, которое мы определим через несколько шагов. Создание новой службы помогает изолировать учебное приложение от других приложений, которые могли быть размещены в Azure ранее.
4. Щелкните **Каталог** | **Настраиваемое создание**.
5. Введите имя службы, домен и географическое расположение. Имя домена должно быть уникальным. Чтобы создать службу, установите флажок.

### <a name="create-a-new-ad-application-for-this-service"></a>Создание нового приложения AD для этой службы
1. Выберите только что созданную службу Active Directory "SearchTutorial".
2. В верхнем меню щелкните **Приложения**.
3. Щелкните **Добавить приложение**. AD приложение хранит сведения о клиентских приложениях, которые будут использовать его в качестве поставщика удостоверений.  
4. Выберите пункт **Добавить приложение, разрабатываемое моей организацией**. Этот вариант обеспечивает параметры регистрации для приложений, которые не публикуются в коллекции приложений. Поскольку клиентское приложение не является частью коллекции приложений, это правильный выбор в данном случае.
5. Введите имя, например "Azure-Search-Manager".
6. Выберите в качестве типа приложения параметр **Собственное клиентское приложение** . Это верно для примера приложения; это клиентское приложение Windows (консольное), а не веб-приложение.
7. Для URI-адреса перенаправления введите "http://localhost/Azure-Search-Manager-App". Это URI-адрес, на которой Azure Active Directory будет перенаправлять агент пользователя в ответ на запрос авторизации OAuth 2.0. Значение не обязательно должно быть физической конечной точкой, но должно быть допустимым URI-адресом.

    В рамках этого учебника значение может быть любым, но введенные сведения будут требоваться для административного соединения в примере приложения.
8. Установите флажок, чтобы создать приложение Active Directory. Вы увидите Azure-Search-Manager-App в левой области навигации.

### <a name="configure-the-ad-application"></a>Настройка приложения AD
1. Щелкните приложение AD Azure-Search-Manager-App, созданное вами. Оно должно быть приведено в левой области навигации.
2. В верхнем меню выберите пункт **Настроить** .
3. Прокрутите экран вниз до разрешений и выберите **API управления Azure**. На этом шаге укажите API (в данном случае API диспетчера ресурсов Azure), к которому требуется доступ клиентского приложения, а также уровень нужного доступа.
4. В разделе "Делегированные разрешения" щелкните раскрывающийся список и выберите **Доступ к управлению службами Azure (Предварительная версия)**.
5. Сохраните изменения.

Не закрывайте страницу настройки приложения. На следующем шаге нужно будет скопировать значения с этой страницы и ввести их в пример приложения.

### <a name="load-the-sample-application-program-with-registration-and-subscription-values"></a>Загрузите программу примера приложения со значениями регистрации и подписки.
В этом разделе требуется изменить решение в среде Visual Studio, подставив допустимые значения, полученные на портале.
Значения, которые будут добавлены, находится почти в самом верху файла Program.cs:

        private const string TenantId = "<your tenant id>";
        private const string ClientId = "<your client id>";
        private const string SubscriptionId = "<your subscription id>";
        private static readonly Uri RedirectUrl = new Uri("<your redirect url>");

Если вы еще не [скачали пример приложения с сайта GitHub](https://github.com/Azure-Samples/search-dotnet-management-api/), то следует это сделать перед выполнением данного шага руководства.

1. Откройте решение **ManagementAPI.sln** в среде Visual Studio.
2. Откройте файл Program.cs.
3. Укажите `ClientId`. Скопируйте со страницы конфигурации приложения AD (открытую ранее на портале) скопируйте идентификатор клиента и вставьте его в файл Program.cs.
4. Укажите `RedirectUrl`. Скопируйте URI-адрес перенаправления с той же страницы портала и вставьте его в файл Program.cs.
5. Укажите `TenantID.`

   * Вернитесь к Active Directory | SearchTutorial (служба).
   * Щелкните **Приложения** в верхней панели.
   * Щелкните **Просмотреть конечные точки** в нижней части страницы.
   * Скопируйте конечную точку авторизации OAUTH 2.0 в нижней части списка.
   * Вставьте конечную точку в TenantID, убрав значения всех параметров URI, за исключением идентификатора клиента (tenant ID).

     Если задан адрес https://login.windows.net/55e324c7-1656-4afe-8dc3-43efcd4ffa50/oauth2/authorize?api-version=1.0, то удалите все символы, кроме 55e324c7-1656-4afe-8dc3-43efcd4ffa50.

6. Укажите `SubscriptionID`.

   * Перейдите на главную страницу портала.
   * Щелкните **Параметры** в нижней части левой области навигации.
   * На вкладке "Подписки" скопируйте идентификатор подписки и вставьте его в файл Program.cs.
7. Сохраните и выполните построение решения.

## <a name="explore-the-application"></a>Обзор приложения
Добавьте точку останова в месте вызова первого метода, чтобы провести пошаговое выполнение программы. Нажмите клавишу **F5**, чтобы запустить приложение, а затем клавишу **F11**, чтобы пошагово выполнить код.

Пример приложения создает бесплатную службу поиска Azure для существующей подписки Azure. Если бесплатная служба в подписке уже есть, то пример приложения работать не будет. Допускается наличие только одной бесплатной службы поиска на подписку.

1. Откройте файл Program.cs в обозревателе решений и перейдите к функции Main(string[] void).
2. Обратите внимание, что **ExecuteArmRequest** используется для выполнения запросов к конечной точке Azure Resource Manager (`https://management.azure.com/subscriptions` для указанного `subscriptionID`). Этот метод используется в программе для выполнения операций с использованием API-интерфейса диспетчера ресурсов Azure или API-Интерфейс управления поиском.
3. Запросы к диспетчеру ресурсов Azure должны проходить проверку подлинности и авторизацию. Это выполняется с помощью метода **GetAuthorizationHeader**, который вызывается методом **ExecuteArmRequest**, как показано в разделе об [аутентификации запросов к Azure Resource Manager](http://msdn.microsoft.com/library/azure/dn790557.aspx). Обратите внимание, что **GetAuthorizationHeader** вызывает `https://management.core.windows.net` для получения маркера доступа.
4. Будет предложено выполнить вход с именем пользователя и паролем, допустимым для вашей подписки.
5. Затем новая служба поиска Azure будет зарегистрирована в поставщике диспетчера ресурсов Azure. Для этого также используется метод **ExecuteArmRequest**, который создает службу поиска в Azure для вашей подписки, обращаясь к адресу `providers/Microsoft.Search/register`.
6. Остальная часть программы использует [API REST управления службы поиска Azure](http://msdn.microsoft.com/library/dn832684.aspx). Обратите внимание, что `api-version` данного API отличается от api-version диспетчера ресурсов Azure. Например, `/listAdminKeys?api-version=2014-07-31-Preview` указывает на `api-version` API REST управления службы поиска Azure.

    В ходе следующих операций выполняется получение определения службы, только что созданной вами, ключей API администрирования, повторное создание и извлечение ключей, изменение реплики и секции и, наконец, удаление службы.

    При изменении реплики службы или счетчика разделов, ожидается, что это действие завершится ошибкой, при использовании бесплатного выпуска. Только выпуск standard позволяет использовать дополнительные разделы и реплики.

    Удаление службы будет последней операцией.

## <a name="next-steps"></a>Дальнейшие действия
Завершив изучение этого учебника, вы можете узнать больше о службе управления или проверки подлинности с помощью службы Active Directory в следующих материалах.

* Дополнительные сведения об интеграции клиентского приложения с Active Directory. Ознакомьтесь со статьей [Интеграция приложений в Azure Active Directory](http://msdn.microsoft.com/library/azure/dn151122.aspx).
* Дополнительные сведения о других операциях управления службами в Azure. Ознакомьтесь со статьей [Управление службами](http://msdn.microsoft.com/library/azure/dn578292.aspx).

<!--Anchors-->
[Download the sample application]: #Download
[Configure the application]: #config
[Explore the application]: #explore
[Next Steps]: #next-steps

<!--Image references-->

<!--Link references-->
[Manage your search solution in Microsoft Azure]: search-manage.md
[Azure Search development workflow]: search-workflow.md
[Create your first azure search solution]: search-create-first-solution.md
[Create a geospatial search app using Azure Search]: search-create-geospatial.md

