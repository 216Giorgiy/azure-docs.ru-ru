---
title: Начало работы с REST API управления поиском Azure | Microsoft Docs
description: Администрирование размещенной облачной службы Поиск Azure с помощью API REST управления
services: search
documentationcenter: ''
author: HeidiSteen
manager: jhubbard
editor: ''

ms.service: search
ms.devlang: rest-api
ms.workload: search
ms.topic: article
ms.tgt_pltfrm: na
ms.date: 08/08/2016
ms.author: heidist

---
# Приступая к работе с Azure Search Management REST API
> [!div class="op_single_selector"]
> * [Портал](search-manage.md)
> * [PowerShell](search-manage-powershell.md)
> * [ИНТЕРФЕЙС REST API](search-get-started-management-api.md)
> 
> 

Azure Search management REST API является программной альтернативой выполнению административных задач на портале. К операциям по управлению службами относится создание или удаление службы, ее масштабирование и управление ключами. В этом учебнике предоставлен образец клиентского приложения, демонстрирующего работу API управления службами. Он также содержит настройки, которые необходимые сделать для запуска образца в локальной среде разработки.

Для работы с этим учебником требуется:

* Visual Studio 2012 или 2013
* загрузить образец клиентского приложения

Во процессе изучения данного руководства будут подготовлены две службы: поиск Azure и Azure Active Directory (AD). Кроме того вы создадите AD приложение, которое установит доверительное отношение между клиентским приложением и конечной точкой диспетчера ресурсов в Azure.

Для работы с этим руководством требуется учетная запись Azure.

## Загрузка примера приложения
Этот учебник основан на консольном приложении, построенном на языке C#, которое можно отредактировать и запустить в Visual Studio 2012 или 2013

Клиентское приложение можно найти на сайте Github в разделе [Azure Search .NET Management API Demo](https://github.com/Azure-Samples/search-dotnet-management-api/) (Демонстрационная версия API управления .NET для Поиска Azure).

## Настройка приложения
Перед запуском примера приложения, необходимо включить проверку подлинности, чтобы запросы, отправленные из клиентского приложения к конечной точке диспетчера ресурсов, могли быть приняты. Требование проведения проверки подлинности исходит от [диспетчера ресурсов Azure](https://msdn.microsoft.com/library/azure/dn790568.aspx), который служит основой для всех операций на портале, запрашиваемых через API-интерфейс, в том числе относящиеся к управлению службой поиска. API управления службами для поиска Azure это просто расширение диспетчера ресурсов Azure и таким образом наследует все его зависимости.

Диспетчеру ресурсов Azure требуется служба Azure Active Directory в качестве поставщика удостоверений.

Чтобы получить маркер доступа, который позволит запросам дойти до диспетчера ресурсов, клиентское приложение имеет сегмент кода, который вызывает Active Directory. Этот сегмент кода, а также все действия, необходимые для его понимания и написания, позаимствованы из следующей статьи: [Проверка подлинности запросов к диспетчеру ресурсов Azure](http://msdn.microsoft.com/library/azure/dn790557.aspx).

Следуйте инструкциям в приведенной выше ссылке или выполните действия, описанные в данном документе, если вы предпочитаете проходить учебник шаг за шагом.

В этом разделе мы выполним следующие задачи:

1. Создание службы AD
2. Создание приложения AD
3. Настройка приложения AD путем регистрации сведений о примере загруженного клиентского приложения
4. Загрузить в пример клиентского приложения значения, которые будут использоваться для авторизации его запросов

> [!NOTE]
> Эти ссылки ведут к материалам с описанием использования Azure Active Directory для проверки подлинности клиентских запросов к диспетчеру ресурсов: [Диспетчер ресурсов Azure](http://msdn.microsoft.com/library/azure/dn790568.aspx), [Проверка подлинности запросов к диспетчеру ресурсов Azure](http://msdn.microsoft.com/library/azure/dn790557.aspx) и [Azure Active Directory](http://msdn.microsoft.com/library/azure/jj673460.aspx).
> 
> 

### Создание службы Active Directory
1. Войдите на [портал Azure](https://manage.windowsazure.com).
2. Прокрутите вниз содержимое левой области навигации и выберите **Active Directory**.
3. Нажмите кнопку **СОЗДАТЬ**, чтобы открыть **Службы приложений**, и выберите **Active Directory**. На этом шаге вы создаете новую службу Active Directory. В этой службе будет размещаться приложение AD, которое мы определим через несколько шагов. Создание новой службы помогает изолировать учебное приложение от других приложений, которые могли быть размещены в Azure ранее.
4. Щелкните **Каталог** и выберите **Настраиваемое создание**.
5. Введите имя службы, домена и географическое расположение. Имя домена должно быть уникальным. Чтобы создать службу, установите флажок.
   
     ![][5]

### Создание нового приложения AD для этой службы
1. Выберите только что созданную службу Active Directory "SearchTutorial".
2. В верхнем меню щелкните **Приложения**.
3. Щелкните **Добавить приложение**. AD приложение хранит сведения о клиентских приложениях, которые будут использовать его в качестве поставщика удостоверений.
4. Выберите пункт **Добавить приложение, разрабатываемое моей организацией**. Этот вариант обеспечивает параметры регистрации для приложений, которые не публикуются в коллекции приложений. Поскольку клиентское приложение не является частью коллекции приложений, это правильный выбор в данном случае.
   
     ![][6]
5. Введите имя, например "Azure-Search-Manager".
6. Выберите в качестве типа приложения параметр **Собственное клиентское приложение**. Это верно для примера приложения; это клиентское приложение Windows (консольное), а не веб-приложение.
   
     ![][7]
7. Для URI-адреса перенаправления введите "http://localhost/Azure-Search-Manager-App". Это URI-адрес, на которой Azure Active Directory будет перенаправлять агент пользователя в ответ на запрос авторизации OAuth 2.0. Значение не обязательно должно быть физической конечной точкой, но должно быть допустимым URI-адресом.
   
    В рамках этого учебника значение может быть любым, но введенные сведения будут требоваться для административного соединения в примере приложения.
8. Установите флажок, чтобы создать приложение Active Directory. Вы увидите Azure-Search-Manager-App в левой области навигации.

### Настройка приложения AD
1. Щелкните приложение AD Azure-Search-Manager-App, созданное вами. Оно должно быть приведено в левой области навигации.
2. В верхнем меню выберите пункт **Настроить**.
3. Прокрутите экран вниз до разрешений и выберите **API управления Azure**. На этом шаге укажите API (в данном случае API диспетчера ресурсов Azure), к которому требуется доступ клиентского приложения, а также уровень нужного доступа.
4. В разделе "Делегированные разрешения" щелкните раскрывающийся список и выберите **Доступ к управлению службами Azure (Предварительная версия)**.
   
    ![][8]
5. Сохраните изменения.

Не закрывайте страницу настройки приложения. На следующем шаге нужно будет скопировать значения с этой страницы и ввести их в пример приложения.

### Загрузите программу примера приложения со значениями регистрации и подписки.
В этом разделе требуется изменить решение в среде Visual Studio, подставив допустимые значения, полученные на портале. Значения, которые будут добавлены, находится почти в самом верху файла Program.cs:

        private const string TenantId = "<your tenant id>";
        private const string ClientId = "<your client id>";
        private const string SubscriptionId = "<your subscription id>";
        private static readonly Uri RedirectUrl = new Uri("<your redirect url>");

Если вы еще не [скачали пример приложения с сайта GitHub](https://github.com/Azure-Samples/search-dotnet-management-api/), то следует это сделать перед выполнением данного шага руководства.

1. Откройте решение **ManagementAPI.sln** в среде Visual Studio.
2. Откройте файл Program.cs.
3. Укажите `ClientId`. Скопируйте со страницы конфигурации приложения AD (открытую ранее на портале) скопируйте идентификатор клиента и вставьте его в файл Program.cs.
4. Укажите `RedirectUrl`. Скопируйте URI-адрес перенаправления с той же страницы портала и вставьте его в файл Program.cs.
   
    ![][9]
5. Укажите `TenantID.`.
   
   * Вернитесь к Active Directory | SearchTutorial (служба).
   * Щелкните **Приложения** в верхней панели.
   * Щелкните **Просмотреть конечные точки** в нижней части страницы.
   * Скопируйте конечную точку авторизации OAUTH 2.0 в нижней части списка.
   * Вставьте конечную точку в TenantID, убрав значения всех параметров URI, за исключением идентификатора клиента (tenant ID).
     
     Если задан адрес https://login.windows.net/55e324c7-1656-4afe-8dc3-43efcd4ffa50/oauth2/authorize?api-version=1.0, то удалите все символы, кроме 55e324c7-1656-4afe-8dc3-43efcd4ffa50.
     
     ![][10]
6. Укажите `SubscriptionID`.
   
   * Перейдите на главную страницу портала.
   * Щелкните **Параметры** в нижней части левой области навигации.
   * На вкладке "Подписки" скопируйте идентификатор подписки и вставьте его в файл Program.cs.
7. Сохраните и выполните построение решения.

## Обзор приложения
Добавьте точку останова в месте вызова первого метода, чтобы провести пошаговое выполнение программы. Нажмите клавишу **F5**, чтобы запустить приложение, а затем клавишу **F11**, чтобы пройти по коду.

Пример приложения создает бесплатную службу поиска Azure для существующей подписки Azure. Если бесплатная служба в подписке уже есть, то пример приложения работать не будет. Допускается наличие только одной бесплатной службы поиска на подписку.

1. Откройте файл Program.cs в обозревателе решений и перейти к функции Main (строка void).
2. Обратите внимание, что **ExecuteArmRequest** используется для выполнения запросов к конечной точке диспетчера ресурсов Azure (`https://management.azure.com/subscriptions` для указанного `subscriptionID`). Этот метод используется в программе для выполнения операций с использованием API-интерфейса диспетчера ресурсов Azure или API-Интерфейс управления поиском.
3. Запросы к диспетчеру ресурсов Azure должны проходить проверку подлинности и авторизацию. Это выполняется с помощью метода **GetAuthorizationHeader**, который вызывается методом **ExecuteArmRequest**, как показано в статье [Проверка подлинности запросов к диспетчеру ресурсов Azure](http://msdn.microsoft.com/library/azure/dn790557.aspx). Обратите внимание, что **GetAuthorizationHeader** вызывает `https://management.core.windows.net` для получения маркера доступа.
4. Будет предложено выполнить вход с именем пользователя и паролем, допустимым для вашей подписки.
5. Затем новая служба поиска Azure будет зарегистрирована в поставщике диспетчера ресурсов Azure. Для этого также используется метод **ExecuteArmRequest**, который создает службу поиска в Azure для вашей подписки обращением к адресу `providers/Microsoft.Search/register`.
6. Остальная часть программы использует [API REST управления службы поиска Azure](http://msdn.microsoft.com/library/dn832684.aspx). Обратите внимание, что `api-version` данного API отличается от api-version диспетчера ресурсов Azure. Например, `/listAdminKeys?api-version=2014-07-31-Preview` указывает на `api-version` API REST управления службы поиска Azure.
   
    Следующий ряд операций получает определение службы, только что созданную вами, администраторские ключи api, повторно создает и извлекает ключи, изменяет реплику и разделы, а в конце, удаляет службу.
   
    При изменении реплики службы или счетчика разделов, ожидается, что это действие завершится ошибкой, при использовании бесплатного выпуска. Только выпуск standard позволяет использовать дополнительные разделы и реплики.
   
    Удаление службы будет последней операцией.

## Дальнейшие действия
Завершив изучение этого учебника, вы можете узнать больше о службе управления или проверки подлинности с помощью службы Active Directory в следующих материалах.

* Дополнительные сведения об интеграции клиентского приложения с Active Directory. См. статью [Интеграция приложений в Azure Active Directory](http://msdn.microsoft.com/library/azure/dn151122.aspx).
* Дополнительные сведения о других операциях управления службами в Azure. См. статью [Управление службами](http://msdn.microsoft.com/library/azure/dn578292.aspx).

<!--Anchors-->
[Download the sample application]: #Download
[Configure the application]: #config
[Explore the application]: #explore
[Next Steps]: #next-steps

<!--Image references-->
[5]: ./media/search-get-started-management-api/Azure-Search-MGMT-AD-Service.PNG
[6]: ./media/search-get-started-management-api/Azure-Search-MGMT-AD-App.PNG
[7]: ./media/search-get-started-management-api/Azure-Search-MGMT-AD-App-prop.PNG
[8]: ./media/search-get-started-management-api/Azure-Search-MGMT-AD-ConfigPermissions.PNG
[9]: ./media/search-get-started-management-api/Azure-Search-MGMT-AD-ConfigPage.PNG
[10]: ./media/search-get-started-management-api/Azure-Search-MGMT-AD-OAuthEndpoint.PNG

<!--Link references-->
[Manage your search solution in Microsoft Azure]: search-manage.md
[Azure Search development workflow]: search-workflow.md
[Create your first azure search solution]: search-create-first-solution.md
[Create a geospatial search app using Azure Search]: search-create-geospatial.md




<!---HONumber=AcomDC_0914_2016-->