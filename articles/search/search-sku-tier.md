---
title: Выбор номера SKU или ценовой категории службы "Поиск Azure" | Документация Майкрософт
description: 'Выполнять подготовку службы поиска Azure можно в рамках таких SKU: "Бесплатный", "Базовый" и "Стандартный" (последний уровень доступен с разными конфигурациями ресурсов и уровнями производительности).'
services: search
author: HeidiSteen
manager: cgronlun
tags: azure-portal
ms.service: search
ms.topic: conceptual
ms.date: 06/19/2018
ms.author: heidist
ms.openlocfilehash: f7cf471a69395cef0aef7d5dd2e3c77218bf97a3
ms.sourcegitcommit: d16b7d22dddef6da8b6cfdf412b1a668ab436c1f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/08/2018
ms.locfileid: "39715286"
---
# <a name="choose-a-pricing-tier-for-azure-search"></a>Выбор ценовой категории службы "Поиск Azure"

В Поиске Azure [служба подготавливается](search-create-service-portal.md) согласно конкретной ценовой категории или SKU. Доступны такие уровни: **Бесплатный**, **Базовый** и **Стандартный** (уровень **Стандартный** доступен для нескольких конфигураций и емкостей). 

Эта статья поможет вам выбрать подходящий уровень. Она дополняет страницу [расценок](https://azure.microsoft.com/pricing/details/search/) и страницу [ограничения служб](search-limits-quotas-capacity.md). Кроме того, здесь приведены сведения о концепциях выставления счетов и моделях потребления, связанных с различными уровнями. В ней также рекомендуется использовать итеративный подход, чтобы понять, какой уровень лучше всего соответствует вашим потребностям. 

Уровни определяют емкость, а не функции. Если емкости уровня окажется недостаточно, вам понадобится подготовить новую службу на более высоком уровне, а затем [перезагрузить индексы](search-howto-reindex.md). Обновление SKU службы на месте не поддерживается.

Доступность функций не является преимуществом первичного уровня. Все уровни, в том числе **бесплатный**, имеют одинаковые функции, за исключением поддержки индексатора S3HD. Тем не менее нехватка ресурсов и отсутствие возможности индексирования ограничивают объем использования функций. Например, конвейер индексирования [когнитивного поиска](cognitive-search-concept-intro.md) поддерживает продолжительные операции, срок действия которых истекает в бесплатной службе (это не касается небольших наборов данных).

> [!TIP]
> Большинство клиентов начинают с оценки **бесплатного** уровня, а затем переходят к разработке на уровне **Стандартный**. После выбора уровня и [подготовки службы поиска](search-create-service-portal.md) в ней можно [увеличить число реплик и секций](search-capacity-planning.md), чтобы настроить производительность. Дополнительные сведения о настройке емкости в статье [Рекомендации по производительности и оптимизации Поиска Azure](search-performance-optimization.md).
>

## <a name="billing-concepts"></a>Основные понятия выставления счетов

При выборе уровня нужно принять во внимание такие понятия, как определения емкости, ограничения службы и единицы обслуживания. 

### <a name="capacity"></a>Capacity

Емкость структурирована в виде *реплик* и *секций*. 

+ Реплики — это экземпляры службы поиска. Каждая реплика содержит одну копию индекса с балансировкой нагрузки. Например, в службу с 6 репликами загружено 6 копий каждого индекса. 

+ Секции хранят индексы и автоматически разделяют данные для поиска: два раздела разбивают индекс пополам, три раздела на трети и т. д. С точки зрения емкости *размер раздела* — это основной отличительный признак на разных уровнях.

> [!NOTE]
> Все **стандартные** уровни поддерживают [гибкие сочетания реплик и секций](search-capacity-planning.md#chart). Это позволяет [балансировать нагрузку, изменяя при этом производительность и скорость системы](search-performance-optimization.md). Уровень **Базовый** предлагает три реплики, что обеспечивает высокую доступность, но имеет только одну секцию. **Бесплатные** уровни не имеют выделенных ресурсов: вычислительные ресурсы общие в нескольких бесплатных службах.

### <a name="search-units"></a>Единицы поиска

Наиболее важное понятие при выставлении счетов за службу "Поиск Azure" — это *единица поиска* (ЕП). Так как работа службы "Поиск Azure" зависит от реплик и секций, нет смысла выставлять счет на основе одного из этих компонентов. Вместо этого выставление счетов основано на всех частях. Формально единица поиска представляет собой продукт реплик и секций, используемых службой: (Р X С = ЕП). Как минимум каждая служба имеет одну единицу поиска (одна реплика умноженная на одну секцию), но чаще используются 3 реплики и 3 секции, что соответствует девяти единицам поиска. 

Хотя каждый уровень предлагает все более высокую пропускную способность, вы можете использовать часть полной емкости в сети, удерживая остальные ресурсы в резерве. Что касается выставления счетов, то количество используемых секций и реплик рассчитывается на основе формулы ЕП, которая определяет фактическую стоимость.

Условия оплаты изменяются ежечасно. Каждый уровень имеет разную ставку за единицу поиска. Расценки для каждого уровня см. в разделе [Сведения о ценах](https://azure.microsoft.com/pricing/details/search/).

### <a name="limits"></a>Ограничения

Службы размещают ресурсы, например индексы, индексаторы и т. д. Каждый уровень налагает [ограничения](search-limits-quotas-capacity.md) на количество ресурсов, которые можно создать в службе. Таким образом, ограничение количества индексов (и других объектов) является второй отличительной особенностью на разных уровнях. При просмотре каждого варианта на портале обратите внимание на ограничения количества индексов. Другие ресурсы, такие как индексаторы, источники данных и наборы навыков, привязаны к ограничениям индекса.

## <a name="consumption-patterns"></a>Шаблоны потребления

Большинство клиентов, которые начинают работать с **бесплатной службой**, затем переходят на один из **стандартных** уровней с более серьезными рабочими нагрузками разработки. 

![Уровни службы "Поиск Azure"](./media/search-sku-tier/tiers.png "Ценовые категории службы \"Поиск Azure\"")

Уровни **Базовый** и **S3 HD** при важных, но нетипичных моделях потребления. Уровень **Базовый** предназначен для небольших рабочих нагрузок: он предлагает SLA, выделенные ресурсы, высокую доступность, но скромное хранилище размером 2 ГБ. Этот уровень разработан для клиентов, которые постоянно использовали доступную емкость. С другой стороны, уровень **S3 HD** предназначен для рабочих нагрузок, типичных для независимых поставщиков программного обеспечения, партнеров, [многопользовательских решений](search-modeling-multitenant-saas-applications.md) или любой конфигурации, требующей большого количества небольших индексов. Часто уровень **Базовый** или **S3 HD** предоставляет все необходимые возможности, но если вы хотите убедиться в этом, отправьте сообщение на сайт [StackOverflow](https://stackoverflow.com/questions/tagged/azure-search) или обратитесь [в службу поддержки Azure](https://azure.microsoft.com/support/options/), чтобы получить дальнейшие указания.

Более часто используемые стандартные уровни **S1–S3** предоставляют большую емкость, отличную по размеру и максимальному количеству секций и индексов, индексаторов и исходных ресурсов:

|  | S1 | S2 | S3 |  |  |  |  |
|--|----|----|----|--|--|--|--|
| Размер секции|  25 ГБ | 100 ГБ | 250 ГБ |  |  |  |  |
| Ограничения индекса и индексатора| 50 | 200 | 200 |  |  |  |  |

**S1** — стандартный выбор, когда требуются выделенные ресурсы и несколько секций. При разбиении объема 25 ГБ на 12 секций предел каждой службы на уровне **S1** составляет 300 ГБ, если вы развертываете разделы по репликам (о более сбалансированных структурах см. в разделе [Уровень "Стандартный": сочетания разделов и реплик](search-capacity-planning.md#chart)).

На портале и страницах расценок внимание фокусируется на размере секций и хранилище, но на каждом уровне цена на все вычислительные возможности (емкость диска, скорость, процессоры) растет линейно. Реплика **S2** быстрее, чем **S1**, а **S3** быстрее, чем **S2**. Уровни **S3** не следуют линейной схеме расчета цены и имеют непропорционально более быструю скорость операций ввода-вывода. Если вы рассматриваете скорость операций ввода-вывода как узкое место, уровень **S3** обеспечивает гораздо большую скорость, чем нижние уровни.

Уровни **S3** и **S3 HD** основаны на идентичной инфраструктуре, но в каждом из них максимальное ограничение достигается по-разному. Уровень **S3** предназначен для небольшого числа очень больших индексов. Таким образом его максимальный предел ограничивается ресурсами (2,4 TB для каждой службы). Уровень **S3 HD** предназначен для большого числа очень небольших индексов. При 1000 индексов достигается предел уровня **S3 HD**, определяемый ограничениями индексов. Если вы приобрели уровень **S3 HD**, но вам нужно использовать более 1000 индексов, обратитесь в службу поддержки Майкрософт, чтобы получить инструкции о дальнейших действиях.

> [!NOTE]
> Ограничения по количеству документов больше не применяются к большинству служб "Поиск Azure", подготовленных после января 2018 года. Дополнительные сведения об условиях применения ограничения по количеству документов см. в [этом разделе](search-limits-quotas-capacity.md#document-limits).
>

## <a name="evaluate-capacity"></a>Оценка емкости

Емкость и расходы на запуск службы взаимосвязаны. Уровни налагают ограничения на хранилище и ресурсы, поэтому вы должны подумать о том, какого предела вы достигнете первым. 

Бизнес-требования обычно влияют на требуемое количество индексов. Например, глобальный индекс требуется при наличии большого хранилища документов, а в зависимости от региона, приложения или бизнес-ниши может потребоваться несколько индексов.

Чтобы определить размер индекса, необходимо [создать его](search-create-index-portal.md). Структура данных в службе "Поиск Azure" в первую очередь представляет собой [инвертированный индекс](https://en.wikipedia.org/wiki/Inverted_index), который имеет отличные характеристики от исходных данных. Размер и сложность инвертированного индекса определяются содержимым, а не количеством данных, которые вы ему передаете. Большой источник данных с большой избыточностью может привести к созданию меньшего индекса, чем для меньшего набора данных, который содержит сильно изменяемое содержимое.  Таким образом, редко бывает возможным определить размер индекса на основе размера исходного набора данных.

### <a name="step-1-develop-rough-estimates-using-the-free-tier"></a>Шаг 1. Приблизительная оценка ресурсов для разработки на основе уровня "Бесплатный"

Один из способов оценки емкости — начать с **бесплатного** уровня. Напомним, что **бесплатная** служба предлагает до трех индексов, 50 МБ памяти и 2 минуты времени индексирования. С этими ограничениями сложно оценить прогнозируемый размер индекса, но следующий пример иллюстрирует сам подход:

+ [Создайте бесплатную службу.](search-create-service-portal.md)
+ Подготовьте небольшой репрезентативный набор данных (предположим, пять тысяч документов и десять процентов размера выборки).
+ [Создайте начальный индекс](search-create-index-portal.md) и запишите его размер на портале (предположим 30 МБ).

Предполагая, что репрезентативный образец составлял десять процентов от всего источника данных, размер индекса 30 МБ становится приблизительно 300 МБ (если все документы индексируются). Это предварительное число можно удвоить для двух индексов (разработки и рабочего). В общем их размер составит 600 МБ. Эту потребность легко покрывает уровень **Базовый**, так что начните с него.

### <a name="step-2-develop-refined-estimates-using-a-billable-tier"></a>Шаг 2. Точная оценка ресурсов для разработки на основе платного уровня

Некоторые клиенты предпочитают начинать с выделенных ресурсов, которые могут вместить большую выборку и обеспечить более быструю обработку, а затем рассчитать реалистичное количество, объем и объем запросов в ходе разработки. Первоначально служба подготавливается на основе предполагаемой оценки, а затем, когда проект развивается, разработчики обычно знают, может ли имеющаяся служба обрабатывать прогнозируемые рабочие нагрузки. 

1. [Просмотрите ограничения служб на каждом уровне](https://docs.microsoft.com/en-us/azure/search/search-limits-quotas-capacity#index-limits), чтобы определить, могут ли нижние уровни поддерживать количество необходимых индексов. На уровнях **Базовый**-**S1**- **S2** индексы ограничиваются 15, 50 и 200 соответственно.

1. [Создайте службу на платном уровне](search-create-service-portal.md):

    + Начните с уровня **Базовый** или **S1**, если вы приступили к обучению.
    + Начните с уровня **S2** или даже **S3**, если предполагается широкомасштабная индексация и загрузка запросов.

1. [Создайте начальный индекс](search-create-index-portal.md), чтобы определить, как исходные данные преобразуются в индекс. Это единственный способ оценки размера индекса.

1. [Отслеживайте хранилище, ограничения служб, объем запросов и задержку](search-monitor-usage.md) в портале. На портале отображаются запросы в секунду, регулируемые запросы и задержки поиска, которые могут помочь определить, находитесь ли вы на правильном уровне. Помимо метрик на портале вы можете настроить глубокий мониторинг, например анализ щелчков, включив [аналитику поискового трафика](search-traffic-analytics.md). 

Номер и размер индекса одинаково важны при анализе, так максимальные предельные значения достигаются за счет полного использования хранилищ (секций) или максимальных ограничений на ресурсы (индексы, индексаторы и т. д.) в зависимости от того, что наступит раньше. Портал помогает отслеживать и то, и другое, показывая текущее использование и максимальные ограничения на странице "Обзор".

> [!NOTE]
> Требования к хранилищу могут стать непомерными, если документы содержат лишние данные. В идеале документы содержат только данные, необходимые для поиска. Двоичные данные недоступны для поиска и должны храниться отдельно (возможно, в таблицах или хранилищах BLOB-объектов Azure) с URL-адресом на внешние данные, содержащимся в поле в индексе. Максимальный размер отдельного документа составляет 16 МБ (или меньше при выполнении массовой отправки нескольких документов в одном запросе). Дополнительные сведения см. в статье [Ограничения поиска Azure](search-limits-quotas-capacity.md).
>

**Рекомендации по объему запросов**

Запросы в секунду (QPS) — это метрика, которая приобретает особое значение во время настройки производительности, но обычно не относится к уровню, если только вы не ожидаете очень высокого объема запросов в самом начале.

Все стандартные уровни могут обеспечивать баланс между репликами и секциями, поддерживая ускорение запросов за счет дополнительных реплик для балансировки нагрузки и дополнительных секций для параллельной обработки. Вы можете настроить производительность после подготовки службы.

Клиент, который с самого начала ожидает постоянно высоких объемов запросов, должен учитывать более высокие уровни, поддерживаемые более мощным оборудованием. Затем вы можете переключить разделы и реплики в автономный режим или даже переключиться на службу более низкого уровня, если эти объемы запросов не будут реализованы. Дополнительные сведения о том, как вычислить пропускную способность запросов, см. в статье [Рекомендации по производительности и оптимизации Поиска Azure](search-performance-optimization.md).


**Соглашения об уровне обслуживания**

Для **бесплатной** и предварительной версий не предусмотрены [соглашения об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/search/v1_0/). Для всех оплачиваемых уровней соглашения об уровне обслуживания вступают в силу, если для службы обеспечена достаточная избыточность. Для соглашения об уровне обслуживания, предусматривающего создание запросов (чтение), требуется не менее двух реплик. Для соглашения об уровне обслуживания, предусматривающего создание запросов и индексацию (чтение и запись), требуется не менее трех реплик. Число секций для соглашения об уровне обслуживания не учитывается. 

## <a name="tips-for-tier-evaluation"></a>Советы по оценке уровня

+ Узнайте, как создавать эффективные индексы и какие методологии обновления являются наименее эффективными. Мы рекомендуем [аналитику поискового трафика](search-traffic-analytics.md) для получения информации о деятельности запроса.

+ Включите метрики на основе запросов и собирайте данные о закономерностях (запросы в рабочее время, индексирование в часы с наименьшей загрузкой) и используйте эти данные при подготовке службы в будущем. Хотя это не всегда удобно, вы можете динамически настраивать секции и ресурсы для размещения запланированных изменений в объемах запросов или незапланированных, но устойчивых изменений, если это оправдано.

+ Помните, что единственным минусом недостаточной подготовки является то, что вам, возможно, придется удалить службу, если фактические требования превысят вашу оценку. Чтобы избежать сбоев в работе службы, вы должны создать новую службу в одной и той же подписке на более высоком уровне и запустить ее параллельно, пока все приложения и запросы не будут направлены на новую конечную точку.

## <a name="next-steps"></a>Дополнительная информация

Начните с **бесплатного** уровня и создайте начальный индекс, используя подмножество ваших данных, чтобы понять их характеристики. Структура данных в службе "Поиск Azure" является инвертированным индексом, в котором размер и сложность инвертированного индекса определяется содержимым. Помните, что высокоизбыточное содержимое имеет тенденцию приводить к созданию индекса меньшего объема, чем более неоднородное содержимое. Таким образом, характеристика содержимого, а не размер набора данных определяет требования к хранилищу индексов.

После того, как у вас есть начальное представление о размере индекса, [подготовьте оплачиваемую службу](search-create-service-portal.md) на одном из уровней, обсуждаемых в этой статье, либо **базовом**, либо **стандартном**. Ослабьте любые искусственные ограничения для подмножеств данных и [пересоздайте индекс](search-howto-reindex.md), чтобы включить все данные, которые вы действительно хотите использовать для поиска.

[Выделите секции и реплики](search-capacity-planning.md) по мере необходимости, чтобы получить требуемую производительность и масштабирование.

Если производительность и емкость вас устраивают, все готово. В противном случае повторно создайте службу поиска на другом уровне, более точно соответствующем вашим потребностям.

> [!NOTE]
> Для получения дополнительной помощи по вашим вопросам отправьте сообщение на сайте [StackOverflow](https://stackoverflow.com/questions/tagged/azure-search) или обратитесь в [службу поддержки Azure](https://azure.microsoft.com/support/options/).