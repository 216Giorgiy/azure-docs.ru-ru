<properties
	pageTitle="Масштабирование уровней ресурсов для рабочих нагрузок запросов и индексирования в Поиске Azure | Microsoft Azure"
	description="Планирование загрузки в Поиске Azure основано на сочетаниях вычислительных ресурсов секций и реплик, в которых каждый ресурс оценивается в оплачиваемых единицах поиска."
	services="search"
	documentationCenter=""
	authors="HeidiSteen"
	manager="paulettm"
	editor=""
    tags="azure-portal"/>

<tags
	ms.service="search"
	ms.devlang="NA"
	ms.workload="search"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.date="05/25/2016"
	ms.author="heidist"/>

# Масштабирование уровней ресурсов для рабочих нагрузок запросов и индексирования в Поиске Azure

В Поиске Azure можно добавочно настраивать загрузку конкретных вычислительных ресурсов, увеличивая число секций, если требуются дополнительные ресурсы хранилища и ввода-вывода, или число реплик, чтобы повысить производительность запросов и индексирования.

Масштабируемость становится доступной при подготовке службы на уровне [Базовый](http://aka.ms/azuresearchbasic) или на одном из уровней [Стандартный](search-limits-quotas-capacity.md).

Для всех платных уровней объем приобретается в *единицах поиска* (ЕП), где каждая секция и реплика принимается за одну единицу поиска.

- На уровне "Базовый" предоставляется до 3 SU для каждой службы.
- На уровне "Стандартный" предоставляется до 36 SU для каждой службы.

Необходимо выбрать такое сочетание секций и реплик, которое останется ниже предела для вашего уровня. При использовании портала для увеличения масштаба он принудительно применит ограничения для допустимых сочетаний.

Как правило, приложениям поиска нужно больше реплик, чем секций. В следующем разделе о [высоком уровне доступности](#HA) объясняется, почему это так.

<a id="HA"></a>
## Выделение ресурсов для обеспечения высокого уровня доступности

Поскольку задача масштабирования решается достаточно легко и быстро, на начальном этапе обычно рекомендуется использовать один раздел и одну или две реплики, увеличивая их количество по мере роста запросов. Для многих развертываний места для хранения одного раздела (15 миллионов документов на раздел) будет достаточно.

А вот рабочие нагрузки запросов в основном выполняются с репликами. Вам потребуется больше реплик для повышения пропускной способности или обеспечения высокого уровня доступности.

Ниже приведены общие рекомендации для обеспечения высокой доступности.

- 2 реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).
- 3 или более реплики для обеспечения высокой доступности рабочих нагрузок чтения и записи (запросов и индексирования).

## Аварийное восстановление

В настоящее время встроенного механизма для аварийного восстановления не предусмотрено. Увеличение разделов или реплик для решения задач аварийного восстановления является ошибочной стратегией. Наиболее распространенным подходом является добавление избыточности на уровне службы за счет подготовки второй службы поиска в другом регионе.

> [AZURE.NOTE] Помните, что соглашения об уровне обслуживания и масштабируемость являются возможностями служб уровня "Базовый" и "Стандартный". Бесплатная подписка включает фиксированный набор ресурсов и предусматривает совместное использование реплик многими подписчиками. Если вы начинали работать со службой уровня "Бесплатный" и теперь хотите перейти на более высокий уровень, то вам потребуется создать новую службу Поиска Azure уровня "Базовый" или "Стандартный", а затем перегрузить индексы и данные в эту новую службу. Инструкции о подготовке службы см. в статье [Создание службы Поиск Azure на портале](search-create-service-portal.md).

## Терминология: секции и реплики

**Разделы** служат для хранения и ввода/вывода данных. В одной службе поиска может быть не более 12 разделов. Каждый раздел может хранить не более 15 миллионов документов или 25 ГБ данных (в зависимости от того, какое условие выполнится раньше). При добавлении разделов увеличивается количество документов, обрабатываемых службой поиска. Например, если в службу с одним разделом, позволяющим хранить до 25 ГБ данных, добавить еще один раздел, то доступное пространство увеличится до 50 ГБ.

**Реплики** являются копиями поисковой системы. В одной службе поиска может быть не более 12 реплик. Для обеспечения чтения (обработка запросов) необходимо минимум 2 реплики, а для чтения и записи (обработка запросов, индексирование) — 3 реплики.

## Увеличение производительности запросов с помощью реплик

Признаком добавления новых реплик является показатель задержки запроса. Как правило, первым шагом к повышению производительности запросов является добавление нескольких реплик.

Каждая реплика содержит копии всех индексов. При добавлении новых реплик вы подключаете дополнительные копии индексов. В результате увеличивается допустимая рабочая нагрузка и обеспечивается распределение запросов между большим количеством реплик. Если, скажем, у вас есть 6 индексов и 3 реплики, то каждая реплика будет хранить копии всех 6 индексов.

Обратите внимание, что количество запросов в секунду (QPS) не имеет точного значения, так как выполнение запроса во многом зависит от его сложности и конкурирующих рабочих нагрузок. В среднем реплика обслуживает около 15 запросов в секунду, но фактическая пропускная способность будет немного выше или ниже, в зависимости от сложности запросов (фасетные запросы являются более сложными) и задержки сети. Также необходимо учитывать, что зависимость роста мощности и производительности от количества реплик не обязательно является линейной. Например, добавление 3 реплик не гарантирует трехкратный рост пропускной способности.

Дополнительные сведения о количестве запросов в секунду (QPS), включая способы оценки QPS для рабочих нагрузок, см. в разделе [Управление службой поиска](search-manage.md).

## Увеличение производительности индексирования с помощью секций

Приложениям поиска, которым требуется обновления данных в режиме, близком к реальному времени, понадобится пропорционально больше секций, чем реплик. Добавление секций распределяет операции чтения-записи среди большего количества вычислительных ресурсов. Оно также обеспечивает больше дискового пространства для хранения дополнительных индексов и документов.

Запрос больших индексов выполняется дольше. Поэтому может оказаться, что каждое добавочное увеличение числа секций потребует меньшего, но пропорционального увеличения числа реплик. Как отмечалось ранее, сложность запросов и их объем обуславливают скорость выполнения запросов.

## Уровень "Базовый": сочетания разделов и реплик

На уровне "Базовый" служба может иметь 1 раздел и до 3 реплик, таким образом, максимальное количество единиц поиска составляет 3.

<a id="chart"></a>
## Уровень "Стандартный": сочетания разделов и реплик

В этой таблице показаны единицы поиска, необходимые для поддержки сочетаний реплик и разделов, с предельным значением в 36 единиц поиска (SU).

- |- |- |- |- |- |- |
---|----|---|---|---|---|---|
**12 реплик**|12 ЕП|24 ЕП|36 ЕП|Недоступно|Недоступно|Недоступно|
**6 реплик**|6 ЕП|12 ЕП|18 ЕП|24 ЕП|36 ЕП|Недоступно|
**5 реплик**|5 ЕП|10 ЕП|15 ЕП|20 ЕП|30 ЕП|Недоступно|
**4 реплики**|4 ЕП|8 ЕП|12 ЕП|16 ЕП|24 ЕП|Нет|
**3 реплики**|3 ЕП|6 ЕП|9 ЕП|12 ЕП|18 ЕП|36 ЕП|
**2 реплики**|2 ЕП|4 ЕП|6 ЕП|8 ЕП|12 ЕП|24 ЕП|
**1 реплика**|1 ЕП|2 ЕП|3 ЕП|4 ЕП|6 ЕП|12 ЕП|
Недоступно|**1 раздел**|**2 раздела**|**3 секции**|**4 раздела**|**6 разделов**|**12 разделов**|


Подробная информация о единицах поиска, ценах и объемах приведена на веб-сайте Azure. Дополнительные сведения см. в статье [Сведения о ценах](https://azure.microsoft.com/pricing/details/search/).

> [AZURE.NOTE] Количество реплик и разделов должно быть кратным 12 (а именно 1, 2, 3, 4, 6, 12). Это связано с тем, что служба поиска Azure предварительно делит каждый индекс на 12 сегментов, которые распределяются по разделам. Например, если в вашей службе есть три раздела и вы создаете новый индекс, то каждый раздел будет содержать по 4 сегмента индекса. Способ, используемый службой поиска Azure для сегментации индекса, является задачей оптимизации и может быть изменен в будущих выпусках. Несмотря на то, что сегодня это число 12, вам не следует полагаться на то, что в будущем оно не изменится.

## Расчет единиц поиска для конкретных сочетаний ресурсов производится по следующей формуле: R X P = SU

Для получения количества единиц поиска по этой формуле необходимо умножить количество реплик на количество разделов. Например, 3 реплики, умноженные на 3 раздела, дадут 9 единиц поиска.

Оба уровня начинаются с одной реплики и одного раздела, что дает одну единицу поиска (SU). Это единственный случай, в котором как реплика, так и раздел считаются одной единицей поиска. Каждый дополнительный ресурс, будь то реплика или раздел, считается собственной единицей поиска.

Стоимость каждой единицы поиска определяется в зависимости от уровня. Стоимость каждой единицы поиска меньше для уровня "Базовый", чем для уровня "Стандартный". Расценки для каждого уровня можно найти в разделе [Сведения о ценах](https://azure.microsoft.com/pricing/details/search/).

<!---HONumber=AcomDC_0601_2016-->