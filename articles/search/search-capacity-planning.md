<properties
	pageTitle="Планирование емкости в поиске Azure | Microsoft Azure | Размещенная облачная служба поиска"
	description="Емкость в поиске Azure состоит из разделов и реплик, каждая из которых является тарифицируемой единицей поиска."
	services="search"
	documentationCenter=""
	authors="HeidiSteen"
	manager="mblythe"
	editor=""
    tags="azure-portal"/>

<tags
	ms.service="search"
	ms.devlang="NA"
	ms.workload="search"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.date="02/28/2016"
	ms.author="heidist"/>

# Планирование емкости в поиске Azure

В поиске Azure можно регулировать объем конкретных вычислительных ресурсов. Можно увеличить разделы, если вам нужно дополнительное место для хранения и дополнительные операции ввода/вывода или реплики для повышения производительности запросов и индексирования.

Масштабируемость становится доступной при подготовке службы на уровне [Базовый](http://aka.ms/azuresearchbasic) или на одном из уровней [Стандартный](search-limits-quotas-capacity.md).

Для обоих уровней объем приобретается в *единицах поиска* (SU), где каждый раздел и каждая реплика принимаются за одну SU.

- На уровне "Базовый" предоставляется до 3 SU для каждой службы.
- На уровне "Стандартный" предоставляется до 36 SU для каждой службы.

Вам необходимо выбрать такое сочетание разделов и реплик, которое останется ниже предела для вашего уровня. Например, на уровне "Стандартный" вы не можете увеличить количество разделов до 12 и реплик до 6, поскольку для этого потребуется 72 единицы поиска (12 x 6). А это больше, чем доступные 36 единиц поиска.

Как правило, большинству приложений поиска необходимо больше реплик, чем разделов. Подробные сведения см. в разделе [высокой доступности](#HA).

**Расчет единиц поиска для конкретных сочетаний ресурсов производится по следующей формуле: R X P = SU**

Для получения количества единиц поиска по этой формуле необходимо умножить количество реплик на количество разделов. Например, 3 реплики, умноженные на 3 раздела, дадут 9 единиц поиска.

Оба уровня начинаются с одной реплики и одного раздела, что дает одну единицу поиска (SU). Это единственный случай, в котором как реплика, так и раздел считаются одной единицей поиска. Каждый дополнительный ресурс, будь то реплика или раздел, считается собственной единицей поиска.

Стоимость каждой единицы поиска определяется в зависимости от уровня. Стоимость каждой единицы поиска меньше для уровня "Базовый", чем для уровня "Стандартный". Расценки для каждого уровня можно найти в разделе [Сведения о ценах](https://azure.microsoft.com/pricing/details/search/).

## Уровень "Базовый": сочетания разделов и реплик

На уровне "Базовый" служба может иметь 1 раздел и до 3 реплик, таким образом, максимальное количество единиц поиска составляет 3.

<table cellspacing="0" border="1">
<tr><td><b>3 реплики</b></td><td>3&#160;ЕП</td></tr>
<tr><td><b>2 реплики</b></td><td>2&#160;ЕП</td></tr>
<tr><td><b>1 реплика</b></td><td>1&#160;ЕП</td></tr>
<tr><td></td><td><b>1 раздел</b></td></tr>
</table>

<a id="chart"></a>
## Уровень "Стандартный": сочетания разделов и реплик

В этой таблице показаны единицы поиска, необходимые для поддержки сочетаний реплик и разделов, с предельным значением в 36 единиц поиска (SU).

<table cellspacing="0" border="1">
<tr><td><b>12&#160;реплик</b></td><td>12&#160;ЕП</td><td>24&#160;ЕП</td><td>36&#160;ЕП</td><td>Недоступно</td><td>Недоступно</td><td>Недоступно</td></tr>
<tr><td><b>6 реплик</b></td><td>6&#160;ЕП</td><td>12&#160;ЕП</td><td>18&#160;ЕП</td><td>24&#160;ЕП</td><td>36&#160;ЕП</td><td>Недоступно</td></tr>
<tr><td><b>5 реплик</b></td><td>5&#160;ЕП</td><td>10&#160;ЕП</td><td>15&#160;ЕП</td><td>20&#160;ЕП</td><td>30&#160;ЕП</td><td>Недоступно</td></tr>
<tr><td><b>4 реплики</b></td><td>4&#160;ЕП</td><td>8&#160;ЕП</td><td>12&#160;ЕП</td><td>16 ЕП</td><td>24&#160;ЕП</td><td>Недоступно </td></tr>
<tr><td><b>3 реплики</b></td><td>3&#160;ЕП</td><td>6&#160;ЕП</td><td>9&#160;ЕП</td><td>12&#160;ЕП</td><td>18&#160;ЕП</td><td>36&#160;ЕП</td></tr>
<tr><td><b>2 реплики</b></td><td>2&#160;ЕП</td><td>4&#160;ЕП</td><td>6&#160;ЕП</td><td>8&#160;ЕП</td><td>12&#160;ЕП</td><td>24&#160;ЕП</td></tr>
<tr><td><b>1 реплика</b></td><td>1&#160;ЕП</td><td>2&#160;ЕП</td><td>3&#160;ЕП</td><td>4&#160;ЕП</td><td>6&#160;ЕП</td><td>12&#160;ЕП</td></tr>
<tr><td>Недоступно</td><td><b>1 раздел</b></td><td><b>2 раздела</b></td><td><b>3 раздела</b></td><td><b>4 раздела</b></td><td><b>6 разделов</b></td><td><b>12 разделов</b></td></tr>
</table>

Подробная информация о единицах поиска, ценах и объемах приведена на веб-сайте Azure. Дополнительные сведения см. в статье [Сведения о ценах](https://azure.microsoft.com/pricing/details/search/).

> [AZURE.NOTE] Количество реплик и разделов должно быть кратным 12 (а именно 1, 2, 3, 4, 6, 12). Это связано с тем, что служба поиска Azure предварительно делит каждый индекс на 12 сегментов, которые распределяются по разделам. Например, если в вашей службе есть три раздела и вы создаете новый индекс, то каждый раздел будет содержать по 4 сегмента индекса. Способ, используемый службой поиска Azure для сегментации индекса, является задачей оптимизации и может быть изменен в будущих выпусках. Несмотря на то, что сегодня это число 12, вам не следует полагаться на то, что в будущем оно не изменится.

<a id="HA"></a>
## Выбор сочетания разделов и реплик для обеспечения высокой доступности

Поскольку задача масштабирования решается достаточно легко и быстро, на начальном этапе обычно рекомендуется использовать один раздел и одну или две реплики, увеличивая их количество по мере роста запросов. Для многих развертываний места для хранения одного раздела (15 миллионов документов на раздел) будет достаточно.

А вот рабочая нагрузка запросов зависит от реплик. Вам потребуется больше реплик для повышения пропускной способности или обеспечения высокого уровня доступности.

Ниже приведены общие рекомендации для обеспечения высокой доступности.

- 2 реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).
- 3 или более реплики для обеспечения высокой доступности рабочих нагрузок чтения и записи (запросов и индексирования).

В настоящее время встроенного механизма для аварийного восстановления не предусмотрено. Увеличение разделов или реплик для решения задач аварийного восстановления является ошибочной стратегией. Вместо этого вам следует рассмотреть возможность создания избыточности на уровне службы. Подробное описание возможных вариантов см. в [этом сообщении на форуме](https://social.msdn.microsoft.com/Forums/ee108a26-00c5-49f6-b1ff-64c66c8b828a/dr-and-high-availability-for-azure-search?forum=azuresearch).

> [AZURE.NOTE] Помните, что соглашения об уровне обслуживания и масштабируемость являются опциями стандартного пакета. Бесплатная подписка включает фиксированный набор ресурсов и предусматривает совместное использование реплик многими подписчиками. Если вы начинали работать с бесплатной подпиской и переходите на стандартную, то вам потребуется создать новую службу поиска и переместить индексы и данные в новую службу. Инструкции о подготовке службы см. в статье [Создание службы Поиск Azure на портале](search-create-service-portal.md).

## Разделы и реплики

**Разделы** служат для хранения и ввода/вывода данных. В одной службе поиска может быть не более 12 разделов. Каждый раздел может хранить не более 15 миллионов документов или 25 ГБ данных (в зависимости от того, какое условие выполнится раньше). При добавлении разделов увеличивается количество документов, обрабатываемых службой поиска. Например, если в службу с одним разделом, позволяющим хранить до 25 ГБ данных, добавить еще один раздел, то доступное пространство увеличится до 50 ГБ.

**Реплики** являются копиями поисковой системы. В одной службе поиска может быть не более 6 реплик. Для обеспечения чтения (обработка запросов) необходимо минимум 2 реплики, а для чтения и записи (обработка запросов, индексирование) — 3 реплики.

Каждая реплика содержит копии всех индексов. При добавлении новых реплик вы подключаете дополнительные копии индексов. В результате увеличивается допустимая рабочая нагрузка и обеспечивается распределение запросов между большим количеством реплик. Если, скажем, у вас есть 6 индексов и 3 реплики, то каждая реплика будет хранить копии всех 6 индексов.

Обратите внимание, что параметр «Количество запросов в секунду (QPS)» не имеет точного значения, поскольку выполнение запроса во многом зависит от его сложности и параллельных рабочих нагрузок. В среднем реплика обслуживает около 15 запросов в секунду, но фактическая пропускная способность будет немного выше или ниже, в зависимости от сложности запросов (фасетные запросы являются более сложными) и задержки сети. Также необходимо учитывать, что зависимость роста мощности и производительности от количества реплик не обязательно является линейной. Например, добавление 3 реплик не гарантирует трехкратный рост пропускной способности. Признаком добавления новых реплик является показатель задержки запроса. Дополнительные сведения о количестве запросов в секунду (QPS), включая способы оценки QPS для рабочих нагрузок, см. в разделе [Управление службой поиска](search-manage.md).

<!---HONumber=AcomDC_0302_2016-->