---
title: Масштабирование уровней ресурсов для рабочих нагрузок запросов и индексирования в Поиске Azure | Microsoft Docs
description: Планирование загрузки в Поиске Azure основано на сочетаниях вычислительных ресурсов разделов и реплик, в которых каждый ресурс оценивается в оплачиваемых единицах поиска.
services: search
documentationcenter: ''
author: HeidiSteen
manager: jhubbard
editor: ''
tags: azure-portal

ms.service: search
ms.devlang: NA
ms.workload: search
ms.topic: article
ms.tgt_pltfrm: na
ms.date: 08/29/2016
ms.author: heidist

---
# Масштабирование уровней ресурсов для рабочих нагрузок запросов и индексирования в Поиске Azure
После [выбора SKU](search-sku-tier.md) и [подготовки службы поиска](search-create-service-portal.md) вы можете дополнительно настроить ресурсы службы.

В Поиске Azure для службы поиска изначально выделяется минимальный уровень ресурсов, состоящий из одного раздела и одной реплики. Для уровней, которые поддерживают службу, вы можете постепенно корректировать вычислительные ресурсы, увеличивая количество разделов, если вам нужно больше места для хранения и операций ввода-вывода, или увеличивая количество реплик, чтобы увеличить объем запросов или повысить производительность. Одна служба должна иметь достаточно ресурсов для обработки всех рабочих нагрузок (индексирования и запросов). Нельзя разделить рабочие нагрузки между несколькими службами.

Параметры масштабирования становятся доступными при подготовке платной службы на уровне [Базовый](http://aka.ms/azuresearchbasic) или на одном из уровней [Стандартный](search-limits-quotas-capacity.md). Для платных SKU объем приобретается в *единицах поиска* (ЕП), где каждый раздел и реплика считается как одна единица поиска. Если объем не превышает верхний предел, используется меньше ЕП и пропорционально уменьшается плата за использование. Оплата осуществляется на протяжении всего периода подготовки службы. Чтобы не платить за службу, которую вы временно не используете, вам нужно удалить ее, а затем при необходимости создать ее снова.

Для увеличения или изменения количества выделенных реплик или разделов мы рекомендуем использовать портал. Он принудительно применит ограничения для допустимых сочетаний, которые не превышают верхний предел.

1. Войдите на [портал Azure](https://portal.azure.com/) и выберите службу поиска.
2. В параметрах откройте колонку "Масштаб" и с помощью ползунков укажите количество разделов и реплик.

Как правило, приложениям поиска требуется больше реплик, чем разделов, особенно если операции службы смещаются в сторону рабочей нагрузки запросов. В разделе, посвященном [высокой доступности](#HA), объясняется, почему так происходит.

> [!NOTE]
> После подготовки службы ее невозможно обновить до более высокого SKU. Вам нужно будет создать службу поиска на новом уровне и перезагрузить индексы. Инструкции по подготовке службы см. в статье [Создание службы Поиска Azure с помощью портала Azure](search-create-service-portal.md).
> 
> 

## Терминология: секции и реплики
Разделы и реплики — это основные ресурсы, на которых работает служба поиска.

**Разделы** служат для хранения индексов и ввода-вывода данных для операций чтения и записи (например, при повторном создании или обновлении индексов).

**Реплики** — это экземпляры службы поиска, используемые главным образом для распределения операций запросов. На каждой реплике всегда размещается одна копия индекса. Если у вас есть 12 реплик, в службу будет загружено 12 копий каждого индекса.

> [!NOTE]
> Невозможно напрямую выбрать или определить, какие индексы будут запущены в реплике. Одна копия каждого индекса в каждой реплике является частью архитектуры службы.
> 
> 

<a id="HA"></a>

## высокую доступность;
Так как масштабирование выполнить достаточно просто, на начальном этапе обычно рекомендуется использовать один раздел и одну или две реплики, увеличивая их количество по мере роста запросов, пока не будет достигнуто максимально допустимое количество реплик и разделов. Для многих служб уровня "Базовый" или S1 будет достаточно места для хранения одного раздела и операций ввода/вывода (15 миллионов документов на раздел).

Рабочие нагрузки запросов в основном выполняются с репликами. Вам, скорее всего, потребуется больше реплик для повышения пропускной способности или обеспечения высокого уровня доступности.

Ниже приведены общие рекомендации для обеспечения высокой доступности.

* 2 реплики для обеспечения высокой доступности рабочих нагрузок для чтения (запросов).
* Три или более реплик для обеспечения высокого уровня доступности рабочих нагрузок чтения и записи (запросов и индексирования по мере добавления, обновления или удаления отдельных документов).

Соглашения об уровне обслуживания (SLA) для Поиска Azure используются для операций запросов и обновления индекса, которые состоят из добавления, обновления или удаления документов.

**Доступность индексов во время повторного создания**

Высокий уровень доступности для Поиска Azure относится к запросам и обновлению индексов, не требующих повторного создания индексов. Если индекс требует повторного создания, например при добавлении или удалении поля, изменении типа данных или переименовании поля, вы можете удалить индекс, создать его заново и загрузить данные еще раз.

Чтобы обеспечить доступность индекса во время повторного создания, необходимо иметь вторую копию индекса (с другим именем) в рабочей среде той же службы или индекс с таким же именем в другой службе, а затем обеспечить перенаправление или логику отработки отказа в коде.

## Аварийное восстановление
В настоящее время встроенного механизма для аварийного восстановления не предусмотрено. Увеличение разделов или реплик для решения задач аварийного восстановления является ошибочной стратегией. Наиболее распространенным подходом является добавление избыточности на уровне службы за счет подготовки второй службы поиска в другом регионе. Как и в случае с доступностью при повторном создании индекса, перенаправление и логику отработки отказа должен обеспечивать ваш код.

## Увеличение производительности запросов с помощью реплик
Признаком необходимости добавления дополнительных реплик является задержка обработки запросов. Как правило, первым шагом к повышению производительности запросов является добавление этого ресурса. При добавлении новых реплик вы подключаете дополнительные копии индексов. В результате увеличивается допустимая рабочая нагрузка и обеспечивается распределение запросов между большим количеством реплик.

Обратите внимание, что мы не можем указать точное количество запросов в секунду (QPS), так как выполнение запроса во многом зависит от его сложности и конкурирующих рабочих нагрузок. В среднем реплика на SKU уровня "Базовый" или S1 обслуживает около 15 запросов в секунду, но фактическая пропускная способность будет немного выше или ниже в зависимости от сложности запросов (фасетные запросы являются более сложными) и задержки сети. Также необходимо учитывать, что зависимость роста мощности и производительности от количества реплик не обязательно является линейной. Например, добавление 3 реплик не гарантирует трехкратный рост пропускной способности.

Дополнительные сведения о количестве запросов в секунду (QPS), включая способы оценки QPS для рабочих нагрузок, см. в статье [Управление службой поиска в Microsoft Azure](search-manage.md).

## Увеличение производительности индексирования с помощью секций
Приложениям поиска, которым требуется обновления данных в режиме, близком к реальному времени, понадобится пропорционально больше секций, чем реплик. Добавление секций распределяет операции чтения-записи среди большего количества вычислительных ресурсов. Оно также обеспечивает больше дискового пространства для хранения дополнительных индексов и документов.

Запрос больших индексов выполняется дольше. Поэтому может оказаться, что каждое добавочное увеличение числа секций потребует меньшего, но пропорционального увеличения числа реплик. Как отмечалось ранее, сложность запросов и их объем обуславливают скорость выполнения запросов.

## Уровень "Базовый": сочетания разделов и реплик
На уровне "Базовый" служба может иметь только один раздел и до трех реплик. Таким образом, максимальное количество единиц поиска составляет три. Единственным ресурсом, который можно изменять, являются реплики. Как отмечалось ранее, требуется не менее двух реплик, чтобы обеспечить высокий уровень доступности при обработке запросов.

<a id="chart"></a>

## Уровень "Стандартный": сочетания разделов и реплик
В этой таблице показаны единицы поиска, необходимые для поддержки сочетаний реплик и разделов, с предельным значением в 36 единиц поиска (ЕП) (кроме уровней "Базовый" и S3 HD).

| - | - | - | - | - | - | - |
| --- | --- | --- | --- | --- | --- | --- |
| **12 реплик** |12 ЕП |24 ЕП |36 ЕП |Недоступно |Недоступно |Недоступно |
| **6 реплик** |6 ЕП |12 ЕП |18 ЕП |24 ЕП |36 ЕП |Недоступно |
| **5 реплик** |5 ЕП |10 ЕП |15 ЕП |20 ЕП |30 ЕП |Недоступно |
| **4 реплики** |4 ЕП |8 ЕП |12 ЕП |16 ЕП |24 ЕП |Нет |
| **3 реплики** |3 ЕП |6 ЕП |9 ЕП |12 ЕП |18 ЕП |36 ЕП |
| **2 реплики** |2 ЕП |4 ЕП |6 ЕП |8 ЕП |12 ЕП |24 ЕП |
| **1 реплика** |1 ЕП |2 ЕП |3 ЕП |4 ЕП |6 ЕП |12 ЕП |
| Недоступно |**1 раздел** |**2 раздела** |**3 раздела**< |**4 раздела** |**6 разделов** |**12 разделов** |

Подробная информация о единицах поиска, ценах и объемах приведена на веб-сайте Azure. Дополнительные сведения см. в статье [Сведения о ценах](https://azure.microsoft.com/pricing/details/search/).

> [!NOTE]
> Количество реплик и разделов должно быть кратным 12 (а именно 1, 2, 3, 4, 6, 12). Это связано с тем, что Поиск Azure предварительно делит каждый индекс на 12 сегментов, которые можно распределить равными частями по разделам. Например, если в вашей службе есть три раздела и вы создаете новый индекс, то каждый раздел будет содержать по 4 сегмента индекса. Способ, используемый службой поиска Azure для сегментации индекса, является задачей оптимизации и может быть изменен в будущих выпусках. Несмотря на то, что сегодня это число 12, вам не следует полагаться на то, что в будущем оно не изменится.
> 
> 

## Высокая плотность уровня S3: сочетания разделов и реплик
На уровне S3 HD служба может иметь один раздел и до 12 реплик, при этом максимальное количество единиц поиска составляет 12. Единственным ресурсом, который можно изменять, являются реплики.

## Расчет единиц поиска для конкретных сочетаний ресурсов производится по следующей формуле: R X P = SU
Для получения количества единиц поиска по этой формуле необходимо умножить количество реплик на количество разделов. Например, 3 реплики, умноженные на 3 раздела, дадут 9 единиц поиска.

Оба уровня начинаются с одной реплики и одного раздела, что дает одну единицу поиска (SU). Это единственный случай, в котором как реплика, так и раздел считаются одной единицей поиска. Каждый дополнительный ресурс, будь то реплика или раздел, считается собственной единицей поиска.

Стоимость каждой единицы поиска определяется в зависимости от уровня. Стоимость каждой единицы поиска меньше для уровня "Базовый", чем для уровня "Стандартный". Расценки для каждого уровня см. в разделе [Сведения о ценах](https://azure.microsoft.com/pricing/details/search/).

<!---HONumber=AcomDC_0914_2016-->