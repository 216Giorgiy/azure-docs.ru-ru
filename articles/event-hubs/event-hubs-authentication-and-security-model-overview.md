---
title: Обзор проверки подлинности концентраторов событий и модели безопасности | Microsoft Docs
description: Обзор проверки подлинности концентраторов событий и модели безопасности.
services: event-hubs
documentationcenter: na
author: sethmanheim
manager: timlt
editor: ''

ms.service: event-hubs
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/16/2016
ms.author: sethm;clemensv

---
# <a name="event-hubs-authentication-and-security-model-overview"></a>Обзор проверки подлинности концентраторов событий и модели безопасности
Модель безопасности концентраторов событий соответствует следующим требованиям.

* Только устройства, предоставляющие действительные учетные данные, могут передать данные концентратору событий.
* Устройство не может действовать от имени другого устройства.
* Постороннему устройству можно запретить отправку данных в концентратор событий.

## <a name="device-authentication"></a>Проверка подлинности устройства
В основе модели безопасности концентраторов событий лежит сочетание [издателей событий](../service-bus/service-bus-shared-access-signature-authentication.md) и маркеров *подписанных URL-адресов (SAS)*. Издатель событий определяет виртуальную конечную точку для концентратора событий. Издатель можно использовать только для отправки сообщений в концентратор событий. Получать сообщения от издателя невозможно.

Как правило концентратор событий использует один издатель на устройство. Все сообщения, отправленные любому из издателей концентратора событий, добавляются в очередь этого концентратора событий. Издатели обеспечивают точный контроль доступа и регулирование.

Каждому устройству назначается уникальный маркер, который загружается на устройство. Маркеры созданы таким образом, что каждый уникальный маркер предоставляет доступ к одному уникальному издателю. Устройство, обладающее маркером, может отправлять данные только одному издателю, но не другим издателям. Если несколько устройств совместно используют тот же маркер, каждое из этих устройств совместно использует издатель.

Хотя это и не рекомендуется, можно предоставить устройствам маркеры, которые дают прямой доступ к концентратору событий. Любое устройство с этим маркером может отправлять сообщения непосредственно в концентратор событий. Такие устройства не подвергаются регулированию. Кроме того, устройство нельзя внести в черный список, чтобы запретить отправку данных в концентратор событий.

Все маркеры подписаны с помощью ключа SAS. Как правило, все маркеры должны быть подписаны тем же ключом. Устройства не имеют сведений о ключе. Это не дает устройствам создавать маркеры.

### <a name="create-the-sas-key"></a>Создание ключа SAS
При создании пространства имен концентраторы событий создают 256-битный ключ SAS с именем **RootManageSharedAccessKey**. Этот ключ дает пространству имен право на отправку, прослушивание и управление. Можно создать дополнительные ключи. Рекомендуется создать ключ, дающий разрешения на отправку в конкретный концентратор событий. Далее в этом разделе предполагается, что вы дали ключу имя `EventHubSendKey`.

В следующем примере при создании концентратора событий создается ключ только для отправки:

```
// Create namespace manager.
string serviceNamespace = "YOUR_NAMESPACE";
string namespaceManageKeyName = "RootManageSharedAccessKey";
string namespaceManageKey = "YOUR_ROOT_MANAGE_SHARED_ACCESS_KEY";
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", serviceNamespace, string.Empty);
TokenProvider td = TokenProvider.CreateSharedAccessSignatureTokenProvider(namespaceManageKeyName, namespaceManageKey);
NamespaceManager nm = new NamespaceManager(namespaceUri, namespaceManageTokenProvider);

// Create Event Hub with a SAS rule that enables sending to that Event Hub
EventHubDescription ed = new EventHubDescription("MY_EVENT_HUB") { PartitionCount = 32 };
string eventHubSendKeyName = "EventHubSendKey";
string eventHubSendKey = SharedAccessAuthorizationRule.GenerateRandomKey();
SharedAccessAuthorizationRule eventHubSendRule = new SharedAccessAuthorizationRule(eventHubSendKeyName, eventHubSendKey, new[] { AccessRights.Send });
ed.Authorization.Add(eventHubSendRule); 
nm.CreateEventHub(ed);
```

### <a name="generate-tokens"></a>Создание маркеров
Маркеры можно создать с помощью ключа SAS. Следует создавать только один маркер на устройство. Маркеры можно создать с помощью следующего метода. Все маркеры создаются с помощью ключа **EventHubSendKey** . Каждому маркеру назначается уникальный URI.

```
public static string SharedAccessSignatureTokenProvider.GetSharedAccessSignature(string keyName, string sharedAccessKey, string resource, TimeSpan tokenTimeToLive)
```

При вызове этого метода URI должен быть указан как `//<NAMESPACE>.servicebus.windows.net/<EVENT_HUB_NAME>/publishers/<PUBLISHER_NAME>`. URI идентичен для всех маркеров за исключением класса `PUBLISHER_NAME`, который должен быть уникальным для каждого маркера. В идеальном случае `PUBLISHER_NAME` представляет идентификатор устройства, которое получает маркер.

Этот метод создает маркер со следующей структурой:

```
SharedAccessSignature sr={URI}&sig={HMAC_SHA256_SIGNATURE}&se={EXPIRATION_TIME}&skn={KEY_NAME}
```

Срок действия маркера указывается в секундах от 1 января 1970 г. Ниже приведен пример маркера:

```
SharedAccessSignature sr=contoso&sig=nPzdNN%2Gli0ifrfJwaK4mkK0RqAB%2byJUlt%2bGFmBHG77A%3d&se=1403130337&skn=RootManageSharedAccessKey
```

Как правило, срок существования маркера соответствует времени существования устройства или превышает его. Если устройство имеет возможность получить новый маркер, можно использовать маркеры с более коротким временем существования.

### <a name="devices-sending-data"></a>Отправка данных устройств
После создания маркеров каждому устройству присваивается свой собственный уникальный маркер.

Если устройство отправляет данные в концентратор событий, устройство прикрепляет свой маркер к запросу на отправку. Во избежание перехвата и кражи маркера злоумышленником связь между устройством и концентратором событий должна выполняться по зашифрованному каналу.

### <a name="blacklisting-devices"></a>Добавление устройств в черный список
Если маркер украден злоумышленником, злоумышленник может действовать от имени устройства, маркер которого был украден. При занесении устройства в черный список пользоваться устройством невозможно, пока оно не получит новый маркер, использующий другой издатель.

## <a name="authentication-of-back-end-applications"></a>Проверка подлинности серверных приложений
Для аутентификации серверных приложений, которые используют данные, созданные устройствами, концентраторы событий применяют модель безопасности, похожую на модель, используемую для разделов служебной шины. Группа потребителей концентраторов событий соответствует подписке на раздел служебной шины. Клиент может создать группы потребителей, если запрос на создание группы потребителей сопровождается маркером, который предоставляет право управления для концентратора событий или для пространства имен, к которому принадлежит концентратор событий. Клиент может получать данные от группы потребителей, если запрос на получение сопровождается маркером, который предоставляет права на получение для этой группы потребителей, концентратора событий или пространства имен, к которому принадлежит концентратор событий.

Текущая версия служебной шины не поддерживает правила SAS для отдельных подписок. Это же справедливо и для групп потребителей концентраторов событий. В будущем планируется добавить поддержку SAS для обоих компонентов.

В отсутствие проверки подлинности SAS для отдельных групп потребителей можно использовать ключи SAS для защиты всех групп потребителей общим ключом. Такой подход позволяет приложению получать данные от любых групп потребителей концентратора событий.

## <a name="next-steps"></a>Дальнейшие действия
Чтобы узнать больше о концентраторах событий, посетите следующие разделы:

* [Обзор концентраторов событий]
* [Решение для обмена сообщениями в очереди] при помощи очередей служебной шины.
* Полный [пример приложения, использующего концентраторы событий].

[Обзор концентраторов событий]: event-hubs-overview.md
[пример приложения, использующего концентраторы событий]: https://code.msdn.microsoft.com/Service-Bus-Event-Hub-286fd097
[решение для обмена сообщениями в очереди]: ../service-bus-messaging/service-bus-dotnet-multi-tier-app-using-service-bus-queues.md




<!--HONumber=Oct16_HO2-->


