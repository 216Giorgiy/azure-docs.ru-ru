---
title: Извлечение общедоступных данных в концентраторы событий Azure | Microsoft Docs
description: Общие сведения об импорте концентраторов событий из веб-примера
services: event-hubs
documentationcenter: na
author: spyrossak
manager: timlt
editor: ''

ms.service: event-hubs
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/25/2016
ms.author: spyros;sethm

---
# Извлечение общедоступных данных в концентраторы событий Azure
Типовые сценарии Интернета вещей (IoT) включают устройства, которые можно запрограммировать на передачу данных в концентратор событий Azure или в центр IoT. Оба направления представляют собой точки входа в Azure и предназначены для хранения, анализа и визуализации множества средств, доступных в Microsoft Azure. При этом данные в концентратор событий Azure или в центр IoT необходимо передавать в формате JSON и с определенной защитой. В связи с этим возникает вопрос: что делать, если нужно использовать данные из общедоступных или частных источников, представленные в виде веб-службы или канала, но изменить формат публикации этих данных нельзя? Например, нельзя потребовать от NOAA, WSDOT или NASDAQ, чтобы те настроили передачу прогнозов погоды, данных о пробках или биржевых сводок в ваш концентратор событий. Чтобы решить эту проблему, мы написали небольшой пример облака с открытым исходным кодом, изменив и развернув который, вы сможете извлекать данные из подобных источников и передавать их в концентратор событий. Вы можете делать с ним все что угодно при условии соблюдения условий лицензионного соглашения с разработчиком. Форму заявки вы найдете [здесь](https://azure.microsoft.com/documentation/samples/event-hubs-dotnet-importfromweb/).

Обратите внимание на то, что код в этом примере демонстрирует только извлечение данных из типовых веб-каналов и запись этих данных в концентратор событий Azure. Он НЕ является рабочим приложением, не разрабатывался для применения в подобных средах и предназначен исключительно для использования в качестве основы для разработки собственного кода. Более того, существование этого примера НЕ означает, что данные в Azure следует только **извлекать**, но не **передавать**. Прежде чем настраивать архитектуру, изучите все факторы, связанные с безопасностью, эффективностью, функциональностью и стоимостью такого решения.

## Структура приложений
Приложение создается на языке C#, а [описание примера](https://azure.microsoft.com/documentation/samples/event-hubs-dotnet-importfromweb/) содержит все сведения, необходимые для его изменения, создания и публикации. Общие сведения о том, как работает приложение, см. в следующих разделах.

Допустим, у вас есть доступ к каналу данных. Например, вам нужно извлекать данные Транспортного департамента Вашингтона (WSDOT) о движении на дорогах или прогнозы погоды NOAA, чтобы отображать индивидуализированные отчеты или комбинировать их с другими данными в вашем приложении. Кроме того, вам нужно настроить концентратор событий Azure и знать соответствующую строку подключения.

При запуске решение GenericWebToEH считывает из файла конфигурации (App.config) следующие данные:

1. URL-адрес или список URL-адресов сайтов, на которых публикуются данные. В идеале это веб-узел, на котором данные публикуются в формате JSON, как, например, узлы, указанные WSDOT [здесь](http://www.wsdot.wa.gov/Traffic/api/).
2. Учетные данные для доступа к URL-адресу (если нужно). Многие общедоступные источники не требуют учетных данных или позволяют вставить их в строку URL-адреса. Некоторые требуют, чтобы учетные данные указывались отдельно. (Обратите внимание на то, что в данном приложении можно указать только один набор учетных данных, которые будут работать, только если задан один URL-адрес, а не список URL-адресов.)
3. Строка подключения и имя концентратора событий в пространстве имен концентраторов событий, куда будут передаваться данные. Эти данные можно найти на портале Azure.
4. Интервал ожидания между опросами общедоступного сайта данных в миллисекундах. Эту настройку необходимо продумать. Если сайт будет опрашиваться слишком редко, вы можете пропустить данные, а при слишком высокой частоте опросов можете получить слишком много повторяющихся данных или, что еще хуже, попасть в черный список как злостный бот. Обратите внимание на то, как часто обновляется источник данных. Например, данные о погоде или движении на дорогах могут обновляться каждые 15 минут, а биржевые сводки — с периодичностью в несколько секунд в зависимости от того, откуда вы их получаете.
5. Флаг, сообщающий приложению о поступлении данных, в формате JSON или XML. Поскольку данные необходимо передавать в концентратор событий, приложение включает модуль, конвертирующий данные перед отправкой из формата XML в JSON.

Прочитав файл конфигурации, приложение запускает цикл: обращение к общедоступному веб-сайту, преобразование данных (если нужно), запись данных в концентратор событий, ожидание в течение заданного интервала, а затем повторение всех этих действий. В частности:

* Чтение общедоступного веб-сайта. Для получения готовых к отправке данных используется экземпляр класса RawXMLWithHeaderToJsonReader из файла Azure/GenericWebToEH/ApiReaders/RawXMLWithHeaderToJsonReader.cs. Он считывает исходный поток в методе GetData(), а затем разбивает его на части (т. е. записи) с помощью команды GetXmlFromOriginalText. Этот метод считывает XML, а также правильно сформированный JSON или JSON-массив. После этого начинается обработка данных с использованием конфигурации MergeToXML из файла App.config (default=empty).
* Прием и отправка данных осуществляются как цикл в методе Process() из файла Program.cs. Получив выходные данные метода GetData(), он добавляет разделенные значения в очередь концентратора событий.

## Дальнейшие действия
Чтобы развернуть решение, клонируйте или загрузите приложение [GenericWebToEH](https://azure.microsoft.com/documentation/samples/event-hubs-dotnet-importfromweb/), измените файл App.config, выполните сборку и опубликуйте приложение. Опубликованное приложение появится на классическом портале Azure в разделе облачных служб, где вы сможете изменить некоторые параметры конфигурации (такие как целевой объект концентратора событий и период ожидания) на вкладке **Настройка**.

Дополнительные примеры концентраторов событий см. в [коллекции примеров Azure](https://azure.microsoft.com/documentation/samples/?service=event-hubs) и на сайте [MSDN](https://code.msdn.microsoft.com/site/search?query=event%20hubs&f%5B0%5D.Value=event%20hubs&f%5B0%5D.Type=SearchText&ac=5).

<!---HONumber=AcomDC_0831_2016-->