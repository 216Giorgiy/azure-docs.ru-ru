---
title: "Географическое аварийное восстановление в концентраторах событий Azure | Документация Майкрософт"
description: "Способы использования географических регионов для отработки отказа и аварийного восстановления в концентраторах событий Azure"
services: event-hubs
documentationcenter: 
author: ShubhaVijayasarathy
manager: timlt
editor: 
ms.service: event-hubs
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/13/2017
ms.author: sethm
ms.openlocfilehash: 94c2782b3166fbc65ae755291a82a2a14556b96f
ms.sourcegitcommit: ccb84f6b1d445d88b9870041c84cebd64fbdbc72
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/14/2017
---
# <a name="azure-event-hubs-geo-disaster-recovery-preview"></a>Географическое аварийное восстановление в концентраторах событий Azure (предварительная версия)

При простое региональных центров обработки данных крайне важно, чтобы обработка данных продолжала работать в другом регионе или центре обработки данных. Таким образом *географическое аварийное восстановление* и *георепликация* являются важными функциями для любого предприятия. Концентраторы событий Azure поддерживают географическое аварийное восстановления и георепликацию на уровне пространства имен. 

Функция географического аварийного восстановления концентраторов событий Azure — это решение для аварийного восстановления. Основные понятия и рабочий процесс, описанные в этой статье, относятся к сценариям восстановления после аварий, но не временных сбоев.

Дополнительные сведения об аварийном восстановлении в Microsoft Azure см. в статье [Аварийное восстановление для приложений на платформе Azure](/azure/architecture/resiliency/disaster-recovery-azure-applications). 

## <a name="terminology"></a>Терминология

**Связывание**. Основное пространство имен является *активным* и получает сообщения. Пространство имен отработки отказа является *пассивным* и не получает сообщений. Метаданные между ними синхронизированы, поэтому они могут беспрепятственно принимать сообщения без каких-либо изменений кода приложения. Настройка аварийного восстановления между активным и пассивным регионами известна как *связывание* регионов.

**Псевдоним**. Имя настроенной конфигурации аварийного восстановления. Псевдоним предоставляет единую стабильную строку подключения полного доменного имени (FQDN). Приложения используют ее для подключения к пространству имен.

**Метаданные**. Сюда относятся имена концентраторов событий, группы объектов-получателей, секции, единицы пропускной способности, сущности и свойства, связанные с пространством имен.

## <a name="enable-geo-disaster-recovery"></a>Включение географического аварийного восстановления

Географическое аварийное восстановление в концентраторах событий Azure можно включить, выполнив 3 шага: 

1. Выполните геосвязывание, в результате чего создается строка подключения псевдонима и становится возможной динамическая репликация метаданных. 
2. Обновите имеющиеся строки подключения клиента в соответствии с псевдонимом, созданным на шаге 1.
3. Инициируйте отработку отказа. Геосвязь разрывается, а псевдоним указывает на дополнительное пространство имен в качестве нового основного пространства имен.

Пример этого рабочего процесса показан на приведенном ниже рисунке.

![Поток геосвязывания][1] 

### <a name="step-1-create-a-geo-pairing"></a>Шаг 1. Создание геосвязи

Чтобы создать связь между двумя регионами, понадобится основное и дополнительное пространства имен. Затем создайте псевдоним для формирования геосвязи. Когда пространства имен связаны с псевдонимом, метаданные периодически реплицируются в обоих пространствах имен. 

В следующем коде показано, как это сделать.

```csharp
ArmDisasterRecovery adr = await client.DisasterRecoveryConfigs.CreateOrUpdateAsync(
                                    config.PrimaryResourceGroupName,
                                    config.PrimaryNamespace,
                                    config.Alias,
                                    new ArmDisasterRecovery(){ PartnerNamespace = config.SecondaryNamespace});
```

### <a name="step-2-update-existing-client-connection-strings"></a>Шаг 2. Обновление имеющихся строк подключения клиента

Когда геосвязь будет установлена, строки подключения, указывающие на основные пространства имен, должны указывать на строку подключения псевдонима. Получите строки подключения, как показано в следующем примере:

```csharp
var accessKeys = await client.Namespaces.ListKeysAsync(config.PrimaryResourceGroupName,
                                                       config.PrimaryNamespace, "RootManageSharedAccessKey");
var aliasPrimaryConnectionString = accessKeys.AliasPrimaryConnectionString;
var aliasSecondaryConnectionString = accessKeys.AliasSecondaryConnectionString;
```

### <a name="step-3-initiate-a-failover"></a>Шаг 3. Запуск отработки отказа

Если произойдет авария или вы решите инициировать отработку отказа в дополнительное пространство имен, метаданные и данные начнут передаваться в дополнительное пространство имен. Так как приложения используют строки подключения псевдонима, дальнейшие действия не требуются. Они автоматически начинают считывание и запись в концентраторы событий в дополнительном пространстве имен. 

В коде ниже показано, как активировать отработку отказа:

```csharp
await client.DisasterRecoveryConfigs.FailOverAsync(config.SecondaryResourceGroupName,
                                                   config.SecondaryNamespace, config.Alias);
```

Когда отработка отказа будет завершена, вам понадобятся данные в основном пространстве имен. Для этого нужно использовать явную строку подключения для концентраторов событий в основном пространстве имен.

### <a name="other-operations-optional"></a>Другие операции (необязательно)

Вы можете разорвать геосвязь или удалить псевдоним, как показано в следующем коде. Обратите внимание, что для удаления строки подключения псевдонима сначала необходимо разорвать геосвязь.

```csharp
// Break pairing
await client.DisasterRecoveryConfigs.BreakPairingAsync(config.PrimaryResourceGroupName,
                                                       config.PrimaryNamespace, config.Alias);

// Delete alias connection string
// Before the alias is deleted, pairing must be broken
await client.DisasterRecoveryConfigs.DeleteAsync(config.PrimaryResourceGroupName,
                                                 config.PrimaryNamespace, config.Alias);
```

## <a name="considerations-for-public-preview"></a>Сведения, касающиеся общедоступной предварительной версии

Обратите внимание на следующие моменты для этого выпуска:

1. Сейчас географическое аварийное восстановление доступно только в северо-центральном и юго-центральном регионах США. 
2. Эта функция поддерживается только для новых пространств имен.
3. В предварительной версии поддерживается репликация только метаданных. Фактические данные не реплицируются.
4. В предварительной версии плата за использование этой возможности не взимается. Однако как для основного, так и для дополнительного пространства имен будут взиматься накладные расходы за зарезервированные единицы пропускной способности.

## <a name="next-steps"></a>Дальнейшие действия

* В разделе с [примером на сайте GitHub](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/GeoDRClient) рассматривается простой рабочий процесс, который создает геосвязь и инициирует отработку отказа для сценария аварийного восстановления.
* В [справочнике для REST API](/rest/api/eventhub/disasterrecoveryconfigs) описываются программные интерфейсы, позволяющие настроить географическое аварийное восстановление.

Дополнительные сведения о концентраторах событий см. по следующим ссылкам:

* Начните работу с [руководства по концентраторам событий](event-hubs-dotnet-standard-getstarted-send.md)
* [Часто задаваемые вопросы о концентраторах событий](event-hubs-faq.md)
* [Примеры приложений, использующих концентраторы событий](https://github.com/Azure/azure-event-hubs/tree/master/samples)

[1]: ./media/event-hubs-geo-dr/eh-geodr1.png

