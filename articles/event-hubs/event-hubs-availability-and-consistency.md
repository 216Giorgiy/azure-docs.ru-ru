---
title: "Доступность и согласованность в концентраторах событий Azure | Документация Майкрософт"
description: "Узнайте, как обеспечить максимальную доступность и согласованность в концентраторах событий Azure с помощью секций."
services: event-hubs
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 8f3637a1-bbd7-481e-be49-b3adf9510ba1
ms.service: event-hubs
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 02/21/2017
ms.author: sethm;jotaub
translationtype: Human Translation
ms.sourcegitcommit: 7587b1bed2f809fa2c4bab78c54396eed778b9ef
ms.openlocfilehash: df2d79fdb4a26509f3c7c1f8f3a8adcaa6b24f9d
ms.lasthandoff: 02/21/2017

---

# <a name="availability-and-consistency-in-event-hubs"></a>Доступность и согласованность в концентраторах событий

## <a name="overview"></a>Обзор
Концентраторы событий Azure используют [ модель секционирования](event-hubs-what-is-event-hubs.md#partitions) для повышения доступности и распараллеливания в пределах одного концентратора событий. Например, если концентратор событий состоит из четырех секций и одна из них перемещается с одного сервера на другой в рамках операции балансировки нагрузки, то вы можете по-прежнему выполнять отправку и получение из трех оставшихся секций. Кроме того, большее число секций обеспечивает большее количество параллельных модулей чтения для обработки данных, повышая тем самым суммарную пропускную способность. Понимание основных принципов и последствий секционирования и упорядочения в распределенной системе является критически важным аспектом разработки решений.

Чтобы лучше понять компромисс между упорядочением и доступностью, давайте рассмотрим [теорему CAP](https://en.wikipedia.org/wiki/CAP_theorem) (известную также как теорема Брюера). В ней утверждается, что выбор между согласованностью, доступностью и устойчивостью к разделению неизбежен.

В теореме согласованность и доступность определяются следующим образом:
* Устойчивость к разделению — это способность системы обработки данных продолжать обработку, даже если в одной из секций происходит сбой.
* Доступность — защищенный от сбоев узел возвращает обоснованный ответ в течение приемлемого времени (без ошибок и простоев).
* Согласованность — при операциях чтения гарантируется получение результатов самых поздних операций записи для данного клиента.

## <a name="partition-tolerance"></a>Устойчивость к разделению
В основе концентраторов событий лежит секционированная модель. Количество секций в концентраторе событий можно настроить во время установки, и это значение невозможно изменить позднее. Поскольку в концентраторах событий необходимо использовать секции, вам требуется принять решение только о доступности и согласованности для своего приложения.

## <a name="availability"></a>Доступность
Самый простой способ начать работу с концентраторами событий — применить поведение по умолчанию. Если вы создаете новый объект `EventHubClient` и используете функцию отправки, то события автоматически распределяются между секциями в концентраторе событий. Такое поведение обеспечивает наивысший показатель времени непрерывной работы.

Для вариантов использования, требующих максимального времени работы, эта модель является предпочтительной.

## <a name="consistency"></a>Целостность
В определенных сценариях важным может быть упорядочение событий. Например, вам может потребоваться, чтобы серверная система обрабатывала команду обновления перед командой удаления. В данном случае можно задать ключ секции для события или использовать `PartitionSender`, чтобы отправлять события только в определенную секцию. Такое действие гарантирует, что при считывании этих события из секции они будут считываться по порядку.

Применяя такой тип конфигурации, учитывайте, что в случае недоступности определенной секции, в которую выполняется отправка, вы получите сообщение на ошибке. Для сравнения: если не привязывать отправку к одной секции, то служба концентраторов событий отправляет событие в следующую доступную секцию.

Одним из возможных решений обеспечения упорядочения, сохраняя при этом максимальное время работы, является объединение событий в рамках приложения обработки событий. Самый простой способ это сделать — пометить событие пользовательским свойством SequenceNumber (Порядковый номер). Ниже приведен пример такой разметки.

```csharp
// Get the latest sequence number from your application
var sequenceNumber = GetNextSequenceNumber();
// Create a new EventData object by encoding a string as a byte array
var data = new EventData(Encoding.UTF8.GetBytes("This is my message..."));
// Set a custom sequence number property
data.Properties.Add("SequenceNumber", sequenceNumber);
// Send single message async
await eventHubClient.SendAsync(data);
```

В предыдущем примере событие будет отправляется в одну из доступных секций в концентраторе событий и ему задается соответствующий порядковый номер из приложения. Для этого решения требуется, чтобы обрабатывающее приложение сохраняло состояние, но отправителям предоставлялась конечная точка, которая скорее всего будет доступна.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о концентраторах событий см. в следующих источниках:

* [Обзор концентраторов событий](event-hubs-what-is-event-hubs.md)
* [Создание концентратора событий](event-hubs-create.md)

