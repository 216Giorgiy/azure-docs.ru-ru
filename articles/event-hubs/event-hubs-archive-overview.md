---
title: "Обзор архивации данных телеметрии с помощью архива концентраторов событий Azure | Документация Майкрософт"
description: "Общие сведения об архиве концентраторов событий Azure."
services: event-hubs
documentationcenter: 
author: djrosanova
manager: timlt
editor: 
ms.assetid: e53cdeea-8a6a-474e-9f96-59d43c0e8562
ms.service: event-hubs
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/22/2017
ms.author: darosa;sethm
ms.translationtype: Human Translation
ms.sourcegitcommit: 17c4dc6a72328b613f31407aff8b6c9eacd70d9a
ms.openlocfilehash: 03756c15d0cd46731e66df3d81c97099f13dcd17
ms.contentlocale: ru-ru
ms.lasthandoff: 05/16/2017


---
# <a name="azure-event-hubs-archive"></a>Архив концентраторов событий Azure
Архив концентраторов событий Azure позволяет автоматически доставлять определенный объем потоковых данных из концентраторов событий в учетную запись хранилища BLOB-объектов с указанным интервалом. Настройка архива выполняется быстро, его использование не влечет дополнительных административных расходов, а масштабирование осуществляется автоматически на основе [единиц пропускной способности](event-hubs-features.md#capacity) концентратора событий. Архив концентраторов событий — это самый удобный способ передачи потоковых данных в Azure. Он позволяет сосредоточиться на обработке данных, а не на их записи.

Кроме того, архив концентраторов событий обеспечивает обработку конвейеров в режиме реального времени и на основе пакетов в одном потоке, благодаря чему вы можете создавать решения, масштабируемые по мере необходимости. Независимо от того, что вам нужно (создать системы на основе пакетов с учетом будущих потребностей в обработке данных в режиме реального времени или добавить эффективный холодный путь к имеющемуся решению для обработки в режиме реального времени), архив концентраторов событий упрощает работу с потоковыми данными.

## <a name="how-event-hubs-archive-works"></a>Принцип работы архива концентраторов событий
Концентраторы событий — это устойчивый буфер для хранения входящих данных телеметрии в течение определенного времени, подобный распределенному журналу. Масштабирование в концентраторах событий выполняется в рамках [модели секционированных потребителей](event-hubs-features.md#partitions). Каждая секция — это независимый сегмент данных, потребление которого осуществляется отдельно. По истечении настроенного срока хранения эти данные устаревают, поэтому определенный концентратор событий никогда не заполняется полностью.

Архив концентраторов событий позволяет указать собственную учетную запись хранилища BLOB-объектов Azure и контейнер, используемые для хранения архивированных данных. Эта учетная запись может находиться в том же регионе, что и концентратор событий, или в другом. Это расширяет гибкость архива концентраторов событий.

Архивированные данные записываются в формате [Apache Avro][Apache Avro] — сжатый быстрый двоичный формат, обеспечивающий эффективную структуру данных за счет встроенной схемы. Этот формат широко используется в экосистеме Hadoop, а также в Stream Analytics и фабрике данных Azure. Работа с Avro более подробно описана далее в этой статье.

### <a name="archive-windowing"></a>Управление окнами в архиве
В архиве концентраторов событий можно настроить окно управления архивацией. Это окно с минимальным размером и продолжительностью, для которого предусмотрена политика "побеждает первый". Это означает, что первый обнаруженный триггер активирует операцию архивации. При наличии окна архива размером в 100 МБ и продолжительностью 15 минут для отправки данных со скоростью 1 МБ/с сначала используется окно размера, а затем — окно времени. Архивация каждой секции выполняется отдельно, а запись выполненного блочного BLOB-объекта осуществляется в процессе архивации. Имя блочного BLOB-объекта зависит от времени создания архива. Соглашение об именовании выглядит следующим образом:

```
[Namespace]/[EventHub]/[Partition]/[YYYY]/[MM]/[DD]/[HH]/[mm]/[ss]
```

### <a name="scaling-to-throughput-units"></a>Масштабирование единиц пропускной способности
Трафик концентраторов событий контролируется с помощью [единиц пропускной способности](event-hubs-features.md#capacity). Одна единица пропускной способности разрешает передачу до 1 МБ/с или 1000 событий/с для входящих данных или до 2 МБ/с или 2000 событий/с для исходящих данных. Для концентраторов событий (цен. категория "Стандартный") можно настроить от 1 до 20 единиц пропускной способности. Кроме того, можно отправить запрос на увеличение квоты в [службу поддержки][support request]. Использование единиц пропускной способности свыше приобретенного количества регулируется. Данные копируются в архив концентраторов событий непосредственно из внутреннего хранилища концентраторов событий. При этом выполняется обход квоты на единицы пропускной способности для исходящего трафика, а этот трафик сохраняется для других средств обработки, например Stream Analytics или Spark.

Настроенный архив концентраторов событий автоматически запускается в момент отправки первого события и выполняется на постоянной основе. Чтобы позволить операции последующей обработки установить, что процесс выполняется, при отсутствии данных концентраторы событий записывают пустые файлы. Это обеспечивает прогнозируемую периодичность и позволяет получить маркер, необходимый для пакетных обработчиков.

## <a name="setting-up-event-hubs-archive"></a>Настройка архива концентраторов событий
Архив можно настроить во время создания концентратора событий на портале или с помощью Azure Resource Manager. Чтобы включить архив, необходимо просто нажать кнопку **Вкл.** . Учетную запись хранения и контейнер можно настроить, щелкнув в колонке раздел **Контейнер** . Так как между архивом концентраторов событий и хранилищем используется проверка подлинности с взаимодействием между службами, указывать строку подключения к хранилищу не нужно. Средство выбора ресурсов автоматически выбирает универсальный код ресурса (URI) для вашей учетной записи хранения. При использовании Azure Resource Manager этот универсальный код ресурса необходимо явным образом указать как строку.

Продолжительность времени окна по умолчанию составляет 5 минут. Минимальное значение равно 1, а максимальное — 15. Диапазон **окна размера** составляет 10–500 МБ.

![][1]

## <a name="adding-archive-to-an-existing-event-hub"></a>Добавление архива в имеющийся концентратор событий
Архив можно настроить в имеющихся концентраторах событий, расположенных в соответствующем пространстве имен. Эта возможность недоступна в пространствах имен **обмена сообщениями** или **смешанного типа**. Чтобы включить архив в имеющемся концентраторе событий или изменить параметры архива, щелкните пространство имен. Откроется колонка **Основные компоненты**. Затем щелкните концентратор событий, для которого необходимо включить архив или изменить его параметры. Наконец, щелкните в отобразившейся колонке раздел **Свойства**, как показано на следующем рисунке.

![][2]

Архив концентраторов событий можно также настроить с помощью шаблонов Azure Resource Manager. Дополнительные сведения см. в [этой статье](event-hubs-resource-manager-namespace-event-hub-enable-archive.md).

## <a name="exploring-the-archive-and-working-with-avro"></a>Просмотр архива и работа с Avro
Настроенный архив концентраторов событий создает файлы в учетной записи хранения Azure и контейнере, указанных в настроенном окне времени. Эти файлы можно просмотреть в любом инструменте, например в [Azure Storage Explorer][Azure Storage Explorer]. Чтобы выполнить определенные действия с этими файлами, их можно скачать локально.

Файлы, созданные архивом концентраторов событий, имеют следующую схему Avro.

![][3]

Файлы Avro можно легко просмотреть с помощью [инструментов Avro][Avro Tools] (JAR-файла) из Apache. После того как вы скачали этот JAR-файл, чтобы просмотреть схему определенного файла Avro, выполните следующую команду:

```
java -jar avro-tools-1.8.1.jar getschema \<name of archive file\>
```

Эта команда возвращает следующее:

```
{

    "type":"record",
    "name":"EventData",
    "namespace":"Microsoft.ServiceBus.Messaging",
    "fields":[
                 {"name":"SequenceNumber","type":"long"},
                 {"name":"Offset","type":"string"},
                 {"name":"EnqueuedTimeUtc","type":"string"},
                 {"name":"SystemProperties","type":{"type":"map","values":["long","double","string","bytes"]}},
                 {"name":"Properties","type":{"type":"map","values":["long","double","string","bytes"]}},
                 {"name":"Body","type":["null","bytes"]}
             ]
}
```

Средства Avro можно также использовать для преобразования файлов в формат JSON и выполнения других задач обработки.

Чтобы выполнить более расширенную обработку, скачайте и установите Avro для определенной платформы. На момент написания статьи средства Avro доступны для следующих платформ: C, C++, C\#, Java, NodeJS, Perl, PHP, Python и Ruby.

Apache Avro предоставляет руководства по началу работы для платформ [Java][Java] и [Python][Python]. Дополнительные сведения см. в статье [Getting Started with Event Hubs Archive](event-hubs-archive-python.md) (Начало работы с архивом концентраторов событий).

## <a name="how-event-hubs-archive-is-charged"></a>Выставление счета за архив концентраторов событий
Выставление счета за архив концентраторов событий осуществляется подобно тарификации за единицы пропускной способности, то есть каждый час. Размер платы прямо пропорционален количеству единиц пропускной способности, приобретенных для пространства имен. Так же как и с единицами пропускной способности, размер архива концентраторов событий можно регулировать, чтобы обеспечить соответствующую производительность. Единицы измерения действуют совместно. За одну единицу пропускной способности в архиве концентраторов событий взимается 0,10 долл. США в час. На предварительную версию предоставляется скидка в размере 50 %.

Архив концентраторов событий — это самый быстрый способ передать данные в Azure. С помощью знакомых средств и платформ (Azure Data Lake, фабрики данных Azure и Azure HDInsight) можно выполнять необходимую пакетную обработку и другие операции анализа в любом масштабе.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о концентраторах событий см. в следующих источниках:

* полный [пример приложения, использующего концентраторы событий][sample application that uses Event Hubs];
* пример [развертывания обработки событий с помощью концентраторов событий][Scale out Event Processing with Event Hubs];
* [Обзор концентраторов событий Azure][Event Hubs overview].

[Apache Avro]: http://avro.apache.org/
[support request]: https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade
[1]: ./media/event-hubs-archive-overview/event-hubs-archive1.png
[2]: media/event-hubs-archive-overview/event-hubs-archive2.png
[Azure Storage Explorer]: http://azurestorageexplorer.codeplex.com/
[3]: ./media/event-hubs-archive-overview/event-hubs-archive3.png
[Avro Tools]: http://www-us.apache.org/dist/avro/avro-1.8.1/java/avro-tools-1.8.1.jar
[Java]: http://avro.apache.org/docs/current/gettingstartedjava.html
[Python]: http://avro.apache.org/docs/current/gettingstartedpython.html
[Event Hubs overview]: event-hubs-what-is-event-hubs.md
[sample application that uses Event Hubs]: https://code.msdn.microsoft.com/Service-Bus-Event-Hub-286fd097
[Scale out Event Processing with Event Hubs]: https://code.msdn.microsoft.com/Service-Bus-Event-Hub-45f43fc3

