<properties linkid="manage-services-hdinsight-hbase-provision-on-vnet" urlDisplayName="Provision HBase clusters on Azure Virtual Network" pageTitle="Provision HBase clusters on Azure Virtual Network | Azure" metaKeywords="" description="Learn how to create HDInsight clusters on Azure Virtual Network." metaCanonical="" services="hdinsight" documentationCenter="" title="Provision HBase clusters on Azure Virtual Network" authors="jgao" solutions="big-data" manager="paulettm" editor="cgronlun" />

<tags ms.service="hdinsight" ms.workload="big-data" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="08/21/2014" ms.author="jgao"></tags>

# Подготовка кластеров HBase в виртуальной сети Azure

Узнайте, как создать кластеры HDInsight в виртуальной сети Azure.

Благодаря интеграции виртуальной сети кластеры HBase могут быть развернуты в той же виртуальной сети, что и приложения. Это позволяет приложениям взаимодействовать с HBase непосредственно. К преимуществам относятся:

-   прямое подключение веб-приложения к узлам кластера HBase, который обеспечивает обмен данными с помощью API-интерфейсов HBase Java RPC;
-   повышение производительности без необходимости организации пропуска трафика через множество шлюзов и балансировки нагрузки;
-   обработка конфиденциальной информации более безопасным способом, без необходимости организации общедоступной конечной точки.

> [WACOM.NOTE] В настоящее время в виртуальных сетях Azure могут быть подготовлены только кластеры HBase. Кластеры Hadoop не поддерживаются.

## Содержание

-   [Предварительные требования][]
-   [Подготовка кластеров HBase в виртуальной сети Azure][]
-   [Подключайтесь к подготовленному в виртуальной сети кластеру HBase с помощью интерфейсов API Java RPC для HBase.][]
-   [Дальнейшие действия][]

## <span id="prerequisites"></span></a>Предварительные требования

Перед началом работы с этим учебником необходимо иметь следующее:

-   **Подписка Azure.**. Azure — это платформа на основе подписок. Дополнительные сведения о получении подписки см. в разделах [Варианты приобретения][], [Предложения для участников][] или [Бесплатное пробное использование][].

-   **Рабочая станция, на которой установлена и настроена среда Azure PowerShell**. Инструкции см. в разделе [Установка и настройка Azure PowerShell][]. Для выполнения скриптов PowerShell необходимо запустить Azure PowerShell с правами администратора и задать политику выполнения *RemoteSigned*. См. раздел [Выполнение скриптов Windows PowerShell][].

    Перед выполнением скриптов PowerShell убедитесь, что вы подключены к подписке Azure, с помощью следующего командлета:

        Add-AzureAccount

    При наличии нескольких подписок Azure используется следующий командлет для установки текущей подписки:

        Select-AzureSubscription <AzureSubscriptionName>

## <span id="hbaseprovision"></span></a>Подготовка кластера HBase в виртуальной сети Azure.

**Чтобы создать виртуальную сеть с помощью портала управления:**

1.  Выполните вход на [портал управления Azure][].
2.  В нижней части страницы щелкните **НОВЫЙ**, щелкните **СЕТЕВЫЕ СЛУЖБЫ**, щелкните **ВИРТУАЛЬНАЯ СЕТЬ** и затем **БЫСТРОЕ СОЗДАНИЕ**.
3.  Введите или выберите следующие значения:

    -   **Имя**: Название виртуальной сети.
    -   **Адресное пространство**: Выберите адресное пространство виртуальной сети таким образом, чтобы оно было достаточно большим для обеспечения адресов для всех узлов в кластере. В противном случае подготовка завершится с ошибкой.
    -   **Максимальное количество виртуальных машин**: Выберите максимальное количество виртуальных машин.
    -   **Location**: Расположение должно совпадать с расположением кластера HBase, который вы будете создавать.
    -   **Сервер DNS**: В этой статье используется внутренний сервер DNS, предоставленный Azure, поэтому вы можете выбрать **Нет**. Также поддерживаются более продвинутые сетевые конфигурации с другими серверами DNS. Подробное руководство см. по адресу [][]<http://msdn.microsoft.com/library/azure/jj156088.aspx></a>.

4.  Щелкните **Создать виртуальную сеть**. В списке появится имя новой виртуальной сети. Подождите, пока в столбце «Состояние» не появится значение **Создано**.
5.  В основной области щелкните только что созданную виртуальную сеть.
6.  В верхней части страницы щелкните **ПАНЕЛЬ МОНИТОРИНГА**.
7.  В разделе **Сводка** узнайте и запишите **ИДЕНТИФИКАТОР ВИРТУАЛЬНОЙ СЕТИ**. Он вам понадобится в процессе подготовки кластера HBase.
8.  В верхней части страницы щелкните **КОНФИГУРАЦИЯ**.
9.  В нижней части страницы указано имя подсети по умолчанию **Subnet-1**. При желании вы можете переименовать подсеть или добавить новую подсеть для кластера HBase. Запишите имя подсети, оно вам понадобится в процессе подготовки кластера.
10. Проверьте **CIDR(КОЛИЧЕСТВО АДРЕСОВ)** для подсети, которая будет использоваться в кластере. Количество адресов должен быть больше, чем количество рабочих узлов плюс семь (шлюзов: 2, головной узел: 2, узел Zookeeper: 3). Например, если вам нужен кластер HBase на 10 узлов, количество адресов для подсети должно быть больше 17 (10 + 7). В противном случае подготовка завершится с ошибкой.

    > [WACOM.NOTE] Настоятельно рекомендуется назначать одну подсеть для одного кластера.

11. Нажмите **Сохранить** в нижней части страницы в том случае, если вы изменяли значения для подсети.

> [WACOM.NOTE] Кластеры HDInsight используют хранилища BLOB-объектов Azure для хранения данных. Дополнительные сведения см. в разделе [Использование хранилища BLOB-объектов Azure с Hadoop в HDInsight][]. Вам понадобится учетная запись хранения и контейнер для хранения BLOB-объектов. Расположение учетной записи хранения должно соответствовать расположению виртуальной сети и кластера.

**Чтобы создать учетную запись хранения Azure Storage и контейнер для хранения BLOB-объектов:**

1.  Выполните вход на [портал управления Azure][].
2.  Щелкните **СОЗДАТЬ** в левом нижнем углу, выберите **СЛУЖБЫ ДАННЫХ**, **ХРАНИЛИЩЕ**, а затем щелкните **БЫСТРО СОЗДАТЬ**.

3.  Введите или выберите следующие значения:

    -   **URL-адрес**: имя учетной записи хранения
    -   **Location**: расположение учетной записи хранения. Убедитесь, что оно совпадает с расположением виртуальной сети. Территориальные группы не поддерживаются.
    -   **РЕПЛИКАЦИЯ**: В целях тестирования используйте **Локально избыточная** для снижения затрат.

4.  Щелкните **СОЗДАТЬ УЧЕТНУЮ ЗАПИСЬ ХРАНЕНИЯ**. Вы увидите новую учетную запись хранения в списке хранилищ.
5.  Дождитесь, пока **СОСТОЯНИЕ** новой учетной записи хранения не изменится на **В сети**.
6.  Щелкните новую учетную запись хранения в списке, чтобы выбрать ее.
7.  Щелкните **УПРАВЛЕНИЕ КЛЮЧАМИ ДОСТУПА** в нижней части страницы.
8.  Запишите **ИМЯ УЧЕТНОЙ ЗАПИСИ ХРАНЕНИЯ** и **ПЕРВИЧНЫЙ КЛЮЧ ДОСТУПА**(или **ВТОРИЧНЫЙ КЛЮЧ ДОСТУПА**. Будет работать любой из ключей). Они потребуются позже в данном руководстве.
9.  В верхней части страницы щелкните **КОНТЕЙНЕР**.
10. В нижней части страницы щелкните **ДОБАВИТЬ**.
11. Введите имя контейнера. Этот контейнер будет использоваться в качестве контейнера по умолчанию для кластера HBase. По умолчанию имя контейнера по умолчанию соответствует имени кластера. Значение поля **ДОСТУП** оставьте **Частный**.
12. Чтобы создать контейнер, поставьте галочку.

**Чтобы подготовить кластер HBase с использованием Azure PowerShell:**

1.  Откройте интегрированную среду сценариев PowerShell.
2.  Скопируйте следующую команду и вставьте ее в окно запроса.

        $hbaseClusterName = "<HBaseClusterName>"
        $hadoopUserName = "<HBaseClusterUsername>"
        $hadoopUserPassword = "<HBaseClusterUserPassword>"
        $location = "<HBaseClusterLocation>"  #i.e. "West US"
        $clusterSize = <HBaseClusterSize>  
        $vnetID = "<AzureVirtualNetworkID>"
        $subNetName = "<AzureVirtualNetworkSubNetName>"
        $storageAccountName = "<AzureStorageAccountName>" # Do not use the full name here
        $storageAccountKey = "<AzureStorageAccountKey>"
        $storageContainerName = "<AzureBlobStorageContainer>"

        $password = ConvertTo-SecureString $hadoopUserPassword -AsPlainText -Force
        $creds = New-Object System.Management.Automation.PSCredential ($hadoopUserName, $password) 

        New-AzureHDInsightCluster -Name $hbaseClusterName `
                                  -ClusterType HBase `
                                  -Version 3.1 `
                                  -Location $location `
                                  -ClusterSizeInNodes $clusterSize `
                                  -Credential $creds `
                                  -VirtualNetworkId $vnetID `
                                  -SubnetName $subNetName `
                                  -DefaultStorageAccountName "$storageAccountName.blob.core.windows.net" `
                                  -DefaultStorageAccountKey $storageAccountKey `
                                  -DefaultStorageContainerName $storageContainerName

3.  Щелкните **Запустить сценарий** или нажмите клавишу **F5**.
4.  Вы можете либо проверить кластер через портал управления, либо запустить в нижней панели следующий командлет PowerShell:

    Get-AzureHDInsightCluster

Для тестирования нового кластера HBase вы можете использовать процедуры, указанные в разделе [Приступая к использованию HBase с Hadoop в HDInsight][].

## <span id="connect"></span></a>Подключайтесь к подготовленному в виртуальной сети кластеру HBase с помощью интерфейсов API Java RPC для HBase.

1.  Подготовка виртуальной машины IaaS в той же виртуальной сети Azure и той же подсети. Поэтому виртуальная машина и кластер HBase будут использовать один и тот же внутренний сервер DNS для разрешения имен узлов. Чтобы сделать это, необходимо вызвать выбор вариантов из коллекции и выбрать виртуальную сеть вместо центра обработки данных. Инструкции см. в разделе [Создание виртуальной машины под управлением Windows Server][]. Достаточно стандартного образа Windows Server 2012 с виртуальной машиной небольшого размера.

2.  Получите для кластера HBase суффикс DNS, зависящий от подключения. Для этого подключитесь к кластеру HBase с помощью удаленного рабочего стола (вы подключитесь к головному узлу) и запустите команду **ipconfig** в командной строке. Для получения инструкций по включению удаленного рабочего стола и подключению к кластеру, см. раздел [Управление кластерами Hadoop в HDInsight с помощью портала управления Azure][].

    ![hdinsight.hbase.dns.surffix][]

3.  Измените настройку «Основной DNS-суффикс» виртуальной машины. Это позволяет виртуальной машине автоматически разрешить имя узла кластера HBase без явного задания суффикса. Например, имя узла *workernode0* будет корректно разрешено в workernode0 кластера HBase.
    Для изменения настройки:

    1.  подключитесь с помощью удаленного рабочего стола к виртуальной машине.
    2.  Откройте **Редактор локальной групповой политики**. Он запускается командой gpedit.msc.
    3.  Раскройте **Конфигурация компьютера**, раскройте **Административные шаблоны**, раскройте **Сеть** и выберите**Клиент DNS**.
    4.  Установите для **Основной DNS-суффикс** значение, полученное на втором шаге:

        ![hdinsight.hbase.primary.dns.suffix][]

    1.  Нажмите кнопку **ОК**.
    2.  Перезапустите виртуальную машину.

    Теперь виртуальная машина может обмениваться информацией с кластером HBase. Для того чтобы проверить подключение, запустите команду ping headnode0 из виртуальной машины.

## <span id="nextsteps"></span></a> Дальнейшие действия

В этом учебнике мы изучили способ подготовки кластера HBase. Дополнительные сведения см. на следующих ресурсах:

-   [Приступая к работе с HDInsight][]
-   [Подготовка кластеров Hadoop в HDInsight][]
-   [Приступая к использованию HBase с Hadoop в HDInsight][]
-   [Анализ мнений пользователей Twitter с использованием HBase в HDInsight][]
-   [Обзор виртуальной сети][].

  [Предварительные требования]: #prerequisites
  [Подготовка кластеров HBase в виртуальной сети Azure]: #hbaseprovision
  [Подключайтесь к подготовленному в виртуальной сети кластеру HBase с помощью интерфейсов API Java RPC для HBase.]: #connect
  [Дальнейшие действия]: #nextsteps
  [Варианты приобретения]: http://azure.microsoft.com/en-us/pricing/purchase-options/
  [Предложения для участников]: http://azure.microsoft.com/en-us/pricing/member-offers/
  [Бесплатное пробное использование]: http://azure.microsoft.com/en-us/pricing/free-trial/
  [Установка и настройка Azure PowerShell]: ../install-configure-powershell
  [Выполнение скриптов Windows PowerShell]: http://technet.microsoft.com/en-us/library/ee176949.aspx
  [портал управления Azure]: https://manage.windowsazure.com
  []: http://msdn.microsoft.com/library/azure/jj156088.aspx
  [Использование хранилища BLOB-объектов Azure с Hadoop в HDInsight]: ../hdinsight-use-blob-storage/
  [Приступая к использованию HBase с Hadoop в HDInsight]: ../hdinsight-hbase-get-started/
  [Создание виртуальной машины под управлением Windows Server]: ../virtual-machines-windows-tutorial/
  [Управление кластерами Hadoop в HDInsight с помощью портала управления Azure]: ../hdinsight-administer-use-management-portal/#rdp
  [hdinsight.hbase.dns.surffix]: ./media/hdinsight-hbase-provision-vnet/DNSSuffix.png
  [hdinsight.hbase.primary.dns.suffix]: ./media/hdinsight-hbase-provision-vnet/PrimaryDNSSuffix.png
  [Приступая к работе с HDInsight]: ../hdinsight-get-started/
  [Подготовка кластеров Hadoop в HDInsight]: ../hdinsight-provision-clusters/
  [Анализ мнений пользователей Twitter с использованием HBase в HDInsight]: ../hdinsight-hbase-twitter-sentiment/
  [Обзор виртуальной сети]: http://msdn.microsoft.com/library/azure/jj156007.aspx
