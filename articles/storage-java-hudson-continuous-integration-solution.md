<properties urlDisplayName="Hudson Continuous Integration" pageTitle="Вы узнаете, как использовать Hundson со службой BLOB-объектов для хранилища Microsoft Azure" metaKeywords="Hudson, Azure storage, Azure Blob service, Azure storage, Azure hudson" description="В данном уроке подробно описывается использование Hudson с хранилищем BLOB-объектов Azure в качестве хранилища артефактов построения." metaCanonical="" services="storage" documentationCenter="Java" title="Использование хранилища Azure с решением непрерывной интеграции Hudson" authors="robmcm" solutions="" manager="wpickett" editor="mollybos" scriptId="" videoId="" />

<tags ms.service="storage" ms.workload="storage" ms.tgt_pltfrm="na" ms.devlang="Java" ms.topic="article" ms.date="01/01/1900" ms.author="robmcm" />

# Использование хранилища Azure с решением непрерывной интеграции Hudson

*Автор [сотрудник Microsoft Open Technologies Inc.][сотрудник Microsoft Open Technologies Inc.]*

Приведенные ниже сведения демонстрируют использование службы BLOB-объектов Azure в качестве репозитория для артефактов построения, созданных решением непрерывной интеграцию Hudson, или как источник загружаемых файлов для процесса построения. Одним из сценариев, где это может оказаться полезным, является программирование в гибкой среде разработки (с помощью Java или других языков), построения выполняются на основе непрерывной интеграции, и вам требуется репозиторий для артефактов построения, чтобы можно было, например, использовать их совместно с другими членами организации, вашими клиентами или вести архив. Еще один сценарий связан с ситуацией, когда задание построения само требует других файлов, например, зависимостей для загрузки в качестве входа построения.

В этом учебнике будет использоваться подключаемый модуль хранилища Azure для решения непрерывной интеграции Hudson, предоставляемый Microsoft Open Technologies, Inc.

## Оглавление

-   [Общие сведения о Hudson][Общие сведения о Hudson]
-   [Преимущества использования службы BLOB-объектов][Преимущества использования службы BLOB-объектов]
-   [Предварительные требования][Предварительные требования]
-   [Использование службы BLOB-объектов с решением непрерывной интеграции Hudson][Использование службы BLOB-объектов с решением непрерывной интеграции Hudson]
-   [Установка подключаемого модуля хранилища Azure][Установка подключаемого модуля хранилища Azure]
-   [Настройка подключаемого модуля хранилища Azure для использования вашей учетной записи хранения][Настройка подключаемого модуля хранилища Azure для использования вашей учетной записи хранения]
-   [Создание действия, выполняемого после построения и отправляющего артефакты построения в вашу учетную запись хранения][Создание действия, выполняемого после построения и отправляющего артефакты построения в вашу учетную запись хранения]
-   [Создание шага построения для загрузки blob-объектов из хранилища Azure][Создание шага построения для загрузки blob-объектов из хранилища Azure]
-   [Компоненты, используемые службой BLOB-объектов][Компоненты, используемые службой BLOB-объектов]

## <span id="overview"></span></a><span class="short header">Обзор</span>Общие сведения о Hudson

Hudson обеспечивает непрерывную интеграцию программного проекта, позволяя разработчикам легко интегрировать свои изменения кода и автоматизировать процесс построения сборок, что повышает производительность их труда. Для построений осуществляется контроль версий, а артефакты построения можно загрузить в разные репозитории. В этом разделе демонстрируется использование хранилища BLOB-объектов Azure в качестве репозитория артефактов построения. Здесь также рассматривается загрузка зависимостей из хранилища blob-объектов Azure.

Дополнительные сведения о Hudson см. в разделе [Знакомство с Hudson][Знакомство с Hudson].

## <span id="benefits"></span></a><span class="short header">Преимущества</span>Преимущества использования службы BLOB-объектов

Преимущества использования службы BLOB-объектов для размещения артефактов построения при гибкой разработке включают в себя следующее:

-   Высокая доступность артефактов построения и (или) загружаемых зависимостей.
-   Производительность при отправке артефактов построения решением Hudson CI.
-   Производительность при загрузке артефактов построения клиентами и партнерами.
-   Контроль политики доступа пользователей с возможностью выбора между анонимным доступом, общим доступом на основе срока действия, доступом по подписи, закрытым доступом и т. п.

## <span id="prerequisites"></span></a><span class="short header">Предварительные требования</span>Предварительные требования

Чтобы использовать службу BLOB-объектов с решением Hudson, необходимо следующее:

-   Решение непрерывной интеграции Hudson.

    Если у вас нет решения Hudson, его можно запустить следующим образом:

    1.  На компьютере с поддержкой Java загрузите WAR-файл Hudson из <http://hudson-ci.org/>.
    2.  В командной строке, открытой на папке с WAR-файлом Hudson, запустите этот файл. Например, если вы загрузили версию 3.1.2:

        `java -jar hudson-3.1.2.war`

    3.  В браузере откройте `http://localhost:8080/`. При этом открывается панель мониторинга Hudson.

    4.  При первом использовании Hudson выполните первоначальную настройку на `http://localhost:8080/`.

    5.  После завершения процесса начальной настройки отмените запущенный экземпляр Hudson WAR, снова запустите WAR-файл Hudson и снова откройте панель мониторинга Hudson по адресу `http://localhost:8080/`, которая будет использоваться для установки и настройки подключаемого модуля хранилища Azure.

        Хотя обычно решение Hudson настраивается на запуск в качестве службы, в рамках данного учебника будет достаточно запуска WAR-файла Hudson в командной строке.

-   Учетная запись Azure. Зарегистрироваться для получения учетной записи Azure можно по адресу <http://www.windowsazure.com>.

-   Учетная запись хранения Azure. Если у вас еще нет учетной записи хранения, ее можно создать с помощью процедуры [Создание учетной записи хранения][Создание учетной записи хранения].

-   Знакомство с решением Hudson CI рекомендуется, но не является обязательным, поскольку ниже будет приведен простой пример, показывающий этапы использования службы BLOB-объектов в качестве репозитория для артефактов построения решения Hudson CI.

## <span id="howtouse"></span></a><span class="short header">Использование службы BLOB-объектов</span>Использование службы BLOB-объектов с решением непрерывной интеграции Hudson CI

Чтобы использовать службу BLOB-объектов с решением Hudson, необходимо установить подключаемый модуль хранилища Azure, настроить этот модуль на использование учетной записи хранения, а затем создать действие, выполняемое после построения и отправляющее артефакты построения в вашу учетную запись хранения. Эти действия описаны в следующих разделах.

## <span id="howtoinstall"></span></a><span class="short header">Установка</span>Установка подключаемого модуля хранилища Azure

1.  На панели мониторинга Hudson щелкните элемент **Manage Hudson** (Управление Hudson).
2.  На странице **Manage Hudson** щелкните **Manage Plugins** (Управление подключаемыми модулями).
3.  Перейдите на вкладку **Available** (Доступный).
4.  Нажмите кнопку **Others** (Другие).
5.  В разделе **Artifact Uploaders** (Средство отправки артефактов) установите флажок **Microsoft Azure Storage plugin** (Подключаемый модуль хранилища Azure).
6.  Нажмите **Install** (Установить).
7.  После завершения установки перезапустите Hudson.

## <span id="howtoconfigure"></span></a><span class="short header">Настройка</span>Настройка подключаемого модуля хранилища Azure для использования вашей учетной записи хранения

1.  На панели мониторинга Hudson щелкните элемент **Manage Hudson** (Управление Hudson).
2.  На странице **Manage Hudson** щелкните **Configure System** (Настройка системы).
3.  В разделе **Microsoft Azure Storage Account Configuration** (Настройка учетной записи хранения Azure):

    1.  Введите имя своей учетной записи хранения, которое можно получить через портал Azure — <https://manage.windowsazure.com>.
    2.  Введите ключ учетной записи хранения, который также можно получить через портал Azure.
    3.  Используйте значение по умолчанию для параметра **Blob Service Endpoint URL** (URL-адрес конечной точки службы BLOB-объектов) при использовании общедоступного облака Azure. При использовании другого облака Azure используйте конечную точку, указанную для вашей учетной записи хранения на портале управления Azure.
    4.  Щелкните **Validate storage credentials** (Проверить учетные данные хранилища) для проверки вашей учетной записи хранения.
    5.  [Необязательно] Если у вас есть дополнительные учетные записи хранения, которые требуется сделать доступными для решения Hudson CI, щелкните **Add more Storage Accounts** (Добавить дополнительные учетные записи хранения).
    6.  Нажмите кнопку **Save** (Сохранить), чтобы сохранить настройки.

## <span id="howtocreatepostbuild"></span></a><span class="short header">Создание действия, выполняемого после построения</span>Создание действия, выполняемого после построения и отправляющего артефакты построения в вашу учетную запись хранения

В учебных целях сначала необходимо создать задание, которое создаст несколько файлов, а затем добавить выполняемое после построения действие для отправки этих файлов в вашу учетную запись хранения.

1.  На панели мониторинга Hudson щелкните элемент **New Job** (Создать задание).
2.  Назовите задание **MyJob**, щелкните **Build a free-style software job** (Построение программного задания в свободном стиле) и нажмите кнопку **OK**.
3.  В разделе **Build** (Построение) конфигурации задания щелкните **Add build step** (Добавить шаг построения) и выберите **Execute Windows batch command** (Выполнить пакетную команду Windows).
4.  В поле **Command** (Команда) используйте следующие команды:

        md text
        cd text
        echo Hello Azure Storage from Hudson > hello.txt
        date /t > date.txt
        time /t >> date.txt

5.  В разделе конфигурации задания **Post-build Actions** (Действия после построения) щелкните **Upload artifacts to Microsoft Azure Blob storage** (Передать артефакты в хранилище BLOB-объектов Azure).
6.  В поле **Storage Account Name** (Имя учетной записи хранения) выберите используемую учетную запись хранения.
7.  В поле **Container Name** (Имя контейнера) укажите имя контейнера. (Если этот контейнер не существует, он будет создан при передаче артефактов построения.) Вы можете использовать переменные среды, поэтому для данного примера введите имя контейнера **${JOB\_NAME}**.

    **Подсказка**

    Под разделом **Command** (Команда), где вы указали скрипт в поле **Execute Windows batch command** (Выполнить пакетную команду Windows), находится ссылка на переменные среды, которые распознаются в решении Hudson. Выберите эту ссылку, чтобы узнать имена и описания переменных среды. Обратите внимание, что переменные среды, которые содержат специальные символы, такие как переменная среды **BUILD\_URL**, нельзя использовать в качестве имени контейнера или общего виртуального пути.

8.  Щелкните **Make new container public by default** (Сделать новый контейнер открытым по умолчанию) для этого примера. (Если вы хотите использовать закрытый контейнер, необходимо создать подпись общего доступа. Это выходит за рамки данного раздела. Дополнительные сведения о подписях общего доступа см. в разделе [Создание подписи общего доступа][Создание подписи общего доступа]).
9.  [Необязательно] Щелкните **Clean container before uploading** (Очистить контейнер перед отправкой), если хотите, чтобы контейнер был перед отправкой артефактов построения (не устанавливайте этот флажок, если не хотите очищать содержимое контейнера).
10. В поле **List of Artifacts to upload** (Список отправляемых артефактов) введите значение \*\*text/\*.txt\*\*.
11. Для параметра **Common virtual path for uploaded artifacts** (Общий виртуальный путь для отправленных артефактов) введите значение **${BUILD\_ID}/${BUILD\_NUMBER}**.
12. Нажмите кнопку **Save** (Сохранить), чтобы сохранить настройки.
13. На панели мониторинга Hudson щелкните **Build Now** (Построение), чтобы запустить **MyJob**. Изучите выходные данные в консоли для определения состояния. Сообщения о состоянии для хранилища Azure будут включены в выходные данные консоли, когда действие после построения начнет передавать артефакты построения.
14. После успешного завершения задания можно просмотреть артефакты построения, открыв общедоступный BLOB-объект.

    1.  Войдите на портал управления Azure <https://manage.windowsazure.com>.
    2.  Щелкните **Хранилище**.
    3.  Щелкните имя учетной записи хранения, используемой для решения Hudson.
    4.  Щелкните **Контейнеры**.
    5.  Выберите контейнер с именем **myjob**, которое является копией имени задания Hudson, написанного в нижнем регистре. Имена контейнеров и BLOB-объектов в хранилище Azure отображаются строчными буквами (и с учетом регистра). В списке BLOB-объектов для контейнера с именем **myjob** вы увидите **hello.txt** и **date.txt**. Скопируйте URL-адрес любого из этих элементов и откройте его в браузере. Вы увидите текстовый файл, который был загружен в качестве артефакта построения.

На каждое задание может быть создано только одно действие после построения, которое отправляет артефакты в хранилище blob-объектов Azure. Обратите внимание, что одно действие после построения по загрузке артефактов в хранилище blob-объектов Azure может определять различные файлы (в том числе подстановочные знаки) и пути для файлов в **List of Artifacts to upload** (Список артефактов для отправки) с использованием точки с запятой в качестве разделителя. Например, если построение Hudson производит JAR-файлы и файлы TXT в папке **build** рабочей области, а нужно отправить их оба в хранилище blob-объектов Azure, используйте для параметра **List of Artifacts to upload** следующее значение: **build/\*.jar;build/\*.txt**. Чтобы задать путь для использования в имени blob-объекта, можно также использовать синтаксис с двойным двоеточием. Например, если необходимо отправить JAR-файлы с использованием **двоичных файлов** в пути blob-объекта, а файлы TXT — с использованием **уведомлений** в пути blob-объекта, используйте для параметра **List of Artifacts to upload** следующее значение: **build/\*.jar::binaries;build/\*.txt::notices**.

## <a name="howtocreatebuildstep"></a><span class="short header">Создание шага построения</span>Создание шага построения для загрузки blob-объектов из хранилища Azure

В последующих шагах показана настройка шага построения для загрузки blob-объектов из хранилища Azure. Это может оказаться полезным при необходимости включить элементы в построение, например, JAR-файлы, которые хранятся в хранилище blob-объектов Azure.

1.  В разделе **Build** (Построение) конфигурации задания щелкните **Add build step** (Добавить шаг построения) и выберите **Download from Azure Blob storage** (Загрузить из хранилища blob-объектов Azure).
2.  В поле **Storage Account Name** (Имя учетной записи хранения) выберите используемую учетную запись хранения.
3.  Для поля **Container name** (Имя контейнера) задайте имя контейнера с blob-объектами, которое нужно загрузить. Можно использовать переменные среды.
4.  Для поля **Blob name** задайте имя blob-объекта. Можно использовать переменные среды. В то же время можно использовать звездочку как подстановочный символ после задания начальной буквы (букв) имени blob-объекта. Например, имя **project\*** будет определять все blob-объекты, имя которых начинается с **project**.
5.  [Необязательно] Для поля **Download path** (Путь загрузки) задайте путь компьютера с Hudson, на который вы хотите загрузить файлы из хранилища blob-объектов Azure. Переменные среды также могут использоваться. (Если не задать значения для поля **Download path**, файлы из хранилища blob-объектов Azure будут загружаться в рабочую область задания.)

При наличии дополнительных элементов, которые нужно загрузить из хранилища blob-объектов Azure можно создать дополнительные шаги построения.

После выполнения построения можно проверить выход консоли истории построения или взглянуть на местоположение для загрузки и удостовериться, успешно ли загрузились необходимы blob-объекты.

## <span id="components"></span></a><span class="short header">Компоненты службы BLOB-объектов</span>Компоненты, используемые службой BLOB-объектов

Ниже приведен обзор компонентов службы BLOB-объектов:

-   **Учетная запись хранения**: Весь доступ к хранилищу Azure осуществляется с помощью учетной записи хранения. Это самое высокоуровневое пространство имен для доступа к BLOB-объектам. Учетная запись может содержать неограниченное число контейнеров при условии, что их общий размер не достигает 100 ТБ.
-   **Контейнер**: Контейнер обеспечивает группировку набора BLOB-объектов. Все BLOB-объекты должны содержаться в контейнере. Учетная запись может содержать неограниченное число контейнеров. Контейнер может хранить неограниченное количество BLOB-объектов.
-   **BLOB-объект**: файл любого типа и размера. Существует два типа BLOB-объектов, которые могут храниться в хранилище Azure: блочные и страничные BLOB-объекты. Большинство файлов являются BLOB-блоками. Единичный BLOB-блок может иметь размер до 200 ГБ. В этом учебнике используются BLOB-блоки. BLOB-страницы, другой тип BLOB-объекта, могут иметь размер до 1 ТБ. Они более эффективны, когда диапазоны байтов в файле часто изменяются. Дополнительные сведения о BLOB-объектах см. в разделе [Что такое BLOB-блоки и BLOB-страницы][Что такое BLOB-блоки и BLOB-страницы].
-   **Форматы URL-адреса**: Для адресации BLOB-объектов используется следующий формат URL-адресов:

    `http://storageaccount.blob.core.windows.net/container_name/blob_name`

    (Приведенный выше формат применяется для общедоступного облака Azure. При использовании другого облака Azure используйте конечную точку на портале управления Azure, чтобы определить конечную точку URL-адреса.)

    В указанном выше формате `storageaccount` представляет имя вашей учетной записи хранения, `container_name` представляет имя контейнера, а `blob_name` представляет имя BLOB-объекта соответственно. В имени контейнера может использовать несколько путей, разделенных косой чертой — **/**. Образцом имени контейнера в данном учебнике был **MyJob**, а **${BUILD\_ID}/${BUILD\_NUMBER}** использовался в качестве общего виртуального пути, в результате чего BLOB-объект имеет следующий URL-адрес:

    `http://example.blob.core.windows.net/myjob/2014-05-01_11-56-22/1/hello.txt`

  [сотрудник Microsoft Open Technologies Inc.]: http://msopentech.com
  [Общие сведения о Hudson]: #overview
  [Преимущества использования службы BLOB-объектов]: #benefits
  [Предварительные требования]: #prerequisites
  [Использование службы BLOB-объектов с решением непрерывной интеграции Hudson]: #howtouse
  [Установка подключаемого модуля хранилища Azure]: #howtoinstall
  [Настройка подключаемого модуля хранилища Azure для использования вашей учетной записи хранения]: #howtoconfigure
  [Создание действия, выполняемого после построения и отправляющего артефакты построения в вашу учетную запись хранения]: #howtocreatepostbuild
  [Создание шага построения для загрузки blob-объектов из хранилища Azure]: #howtocreatebuildstep
  [Компоненты, используемые службой BLOB-объектов]: #components
  [Знакомство с Hudson]: http://wiki.eclipse.org/Hudson-ci/Meet_Hudson
  [Создание учетной записи хранения]: http://go.microsoft.com/fwlink/?LinkId=279823
  [Создание подписи общего доступа]: http://go.microsoft.com/fwlink/?LinkId=279889
  [Что такое BLOB-блоки и BLOB-страницы]: http://msdn.microsoft.com/ru-ru/library/windowsazure/ee691964.aspx
