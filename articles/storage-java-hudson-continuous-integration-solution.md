<properties 
	pageTitle="Вы узнаете, как использовать Hundson со службой BLOB-объектов для хранилища Microsoft Azure" 
	description="В данном уроке подробно описывается использование Hudson с хранилищем BLOB-объектов Azure в качестве хранилища артефактов построения." 
	services="storage" 
	documentationCenter="java" 
	authors="rmcmurray" 
	manager="wpickett" 
	editor="mollybos"/>

<tags 
	ms.service="storage" 
	ms.workload="storage" 
	ms.tgt_pltfrm="na" 
	ms.devlang="Java" 
	ms.topic="article" 
	ms.date="09/25/2014" 
	ms.author="robmcm"/>

#Использование хранилища Azure с решением непрерывной интеграции Hudson

*Автор [сотрудник Microsoft Open Technologies Inc.][ms-open-tech]*

Приведенные ниже сведения демонстрируют использование службы BLOB-объектов Azure в качестве репозитория для артефактов построения, созданных решением непрерывной интеграцию Hudson, или как источник загружаемых файлов для процесса построения. Одним из сценариев, где это может оказаться полезным, является программирование в гибкой среде разработки (с помощью Java или других языков), построения выполняются на основе непрерывной интеграции, и вам требуется репозиторий для артефактов построения, чтобы можно было, например, использовать их совместно с другими членами организации, вашими клиентами или вести архив.  Еще один сценарий связан с ситуацией, когда задание построения само требует других файлов, например, зависимостей для загрузки в качестве входа построения.

В этом учебнике будет использоваться подключаемый модуль хранилища Azure для решения непрерывной интеграции Hudson, предоставляемый Microsoft Open Technologies, Inc.

## Оглавление

-   [Общая информация о Hudson][]
-   [Преимущества использования службы BLOB-объектов][]
-   [Предварительные требования][]
-   [Использование службы BLOB-объектов с решением непрерывной интеграции Hudson][]
-   [Как установить подключаемый модуль службы хранилища Azure][]
-   [Как настроить подключаемый модуль службы хранилища Azure для использования своей учетной записи хранения][]
-   [Как создать действие, выполняемое после сборки и отправляющее артефакты сборки в вашу учетную запись хранения][]
-   [Как создать шаг сборки для скачивания больших двоичных объектов из хранилища Azure][]
-   [Компоненты, используемые службой больших двоичных объектов][]

## <a id="overview"></a>Общая информация о Hudson ##
Hudson обеспечивает непрерывную интеграцию программного проекта, позволяя разработчикам легко интегрировать свои изменения кода и автоматизировать процесс построения сборок, что повышает производительность их труда. Для построений осуществляется контроль версий, а артефакты построения можно загрузить в разные репозитории. В этом разделе демонстрируется использование хранилища BLOB-объектов Azure в качестве репозитория артефактов построения. Здесь также рассматривается загрузка зависимостей из хранилища blob-объектов Azure.

Дополнительную информацию о Hudson см. в разделе [Знакомство с Hudson][].

## <a id="benefits"></a>Преимущества использования службы BLOB-объектов ##

Преимущества использования службы BLOB-объектов для размещения артефактов построения при гибкой разработке включают в себя следующее:

- Высокая доступность артефактов построения и (или) загружаемых зависимостей.
- Производительность при отправке артефактов построения решением Hudson CI.
- Производительность при загрузке артефактов построения клиентами и партнерами.
- Контроль политики доступа пользователей с возможностью выбора между анонимным доступом, общим доступом на основе срока действия, доступом по подписи, закрытым доступом и т. п.

## <a id="prerequisites"></a>Предварительные требования ##

Чтобы использовать службу BLOB-объектов с решением Hudson, необходимо следующее:

- Решение непрерывной интеграции Hudson.

    Если у вас нет решения Hudson, его можно запустить следующим образом:

    1. На компьютере с поддержкой Java загрузите WAR-файл Hudson из http://hudson-ci.org/.
    2. В командной строке, открытой на папке с WAR-файлом Hudson, запустите этот файл. Например, если вы загрузили версию 3.1.2:

        `java -jar hudson-3.1.2.war`

    3. Откройте в браузере `http://localhost:8080/`. При этом открывается панель мониторинга Hudson.

    4. При первом использовании Hudson выполните первоначальную настройку по адресу `http://localhost:8080/`. 

    5. После завершения процесса начальной настройки отмените запущенный экземпляр Hudson WAR, снова запустите WAR-файл Hudson и снова откройте панель мониторинга Hudson по адресу `http://localhost:8080/`, которая будет использоваться для установки и настройки подключаемого модуля хранилища Azure.

        Хотя обычно решение Hudson настраивается на запуск в качестве службы, в рамках данного учебника будет достаточно запуска WAR-файла Hudson в командной строке.

- Учетная запись Azure. Зарегистрироваться для получения учетной записи Azure можно по адресу <http://www.windowsazure.com>.

- Учетная запись хранения Azure. Если у вас еще нет учетной записи хранения, ее можно создать с помощью процедуры [Создание учетной записи хранения][].

- Знакомство с решением Hudson CI рекомендуется, но не является обязательным, поскольку ниже будет приведен простой пример, показывающий этапы использования службы BLOB-объектов в качестве репозитория для артефактов построения решения Hudson CI.

## <a id="howtouse"></a>Использование службы BLOB-объектов с решением непрерывной интеграции Hudson ##

Чтобы использовать службу BLOB-объектов с решением Hudson, необходимо установить подключаемый модуль хранилища Azure, настроить этот модуль на использование учетной записи хранения, а затем создать действие, выполняемое после построения и отправляющее артефакты построения в вашу учетную запись хранения. Эти действия описаны в следующих разделах.

## <a id="howtoinstall"></a>Как установить подключаемый модуль службы хранилища Azure ##

1. На панели мониторинга Hudson щелкните элемент **Управление Hudson**.
2. На странице **Управление Hudson** щелкните **Управление подключаемыми модулями**.
3. Откройте вкладку **Доступно**.
4. Нажмите кнопку **Другие**.
5. В разделе **Средства отправки артефактов** установите флажок **Подключаемый модуль службы хранилища Microsoft Azure**.
6. Нажмите **Установить**.
7. После завершения установки перезапустите Hudson.

## <a id="howtoconfigure"></a>Как настроить подключаемый модуль службы хранилища Azure для использования своей учетной записи хранения ##

1. На панели мониторинга Hudson щелкните элемент **Управление Hudson**.
2. На странице **Управление Hudson** щелкните **Настройка системы**.
3. В разделе **Настройка учетной записи хранения Microsoft Azure**:
    1. Введите имя своей учетной записи хранения, которое можно получить на портале Azure: https://manage.windowsazure.com.
    2. Введите ключ учетной записи хранения, который также можно получить через портал Azure.
    3. Используйте значение по умолчанию для параметра **URL-адрес конечной точки службы больших двоичных объектов** при использовании общедоступного облака Azure. При использовании другого облака Azure используйте конечную точку, указанную для вашей учетной записи хранения на портале управления Azure. 
    4. Щелкните **Проверить учетные данные хранилища**, чтобы проверить свою учетную запись хранения. 
    5. [Необязательно] Если у вас есть дополнительные учетные записи хранения, которые требуется сделать доступными для решения Hudson, щелкните **Добавить дополнительные учетные записи хранения**.
    6. Нажмите кнопку **Сохранить**, чтобы сохранить параметры.

## <a id="howtocreatepostbuild"></a>Как создать действие, выполняемое после сборки и отправляющее артефакты сборки в вашу учетную запись хранения ##

В учебных целях сначала необходимо создать задание, которое создаст несколько файлов, а затем добавить выполняемое после построения действие для отправки этих файлов в вашу учетную запись хранения.

1. На панели мониторинга Hudson щелкните **Создать задание**.
2. Назовите задание **MyJob**, щелкните **Сборка программного задания в свободном стиле** и нажмите кнопку **OK**.
3. В разделе **Сборка** конфигурации задания щелкните **Добавить шаг сборки** и выберите **Выполнить пакетную команду Windows**.
4. В поле **Команда** используйте следующие команды:

        md text
        cd text
        echo Hello Azure Storage from Hudson > hello.txt
        date /t > date.txt
        time /t >> date.txt
 
5. В разделе конфигурации задания **Действия после сборки** щелкните **Передать артефакты в хранилище больших двоичных объектов Microsoft Azure**.
6. В поле **Имя учетной записи хранения** выберите учетную запись для использования.
7. В поле **Имя контейнера** укажите имя контейнера. (Если этот контейнер не существует, он будет создан при передаче артефактов построения.) Вы можете использовать переменные среды, поэтому для данного примера введите имя контейнера **${JOB_NAME}**.

    ***Совет**
    
    В разделе **Команда**, где вы указали сценарий в поле **Выполнить пакетную команду Windows**, находится ссылка на переменные среды, которые распознаются в решении Hudson. Выберите эту ссылку, чтобы узнать имена и описания переменных среды. Обратите внимание, что переменные среды, которые содержат специальные символы, такие как переменная среды **BUILD_URL**, нельзя использовать в качестве имени контейнера или общего виртуального пути.

8. Щелкните **Сделать новый контейнер общедоступным по умолчанию** для этого примера. (Если вы хотите использовать закрытый контейнер, необходимо создать подпись общего доступа. Это выходит за рамки данного раздела. Дополнительную информацию о подписанных URL-адресах см. в разделе [Создание подписанного URL-адреса](http://go.microsoft.com/fwlink/?LinkId=279889).)
9. [Необязательно] Щелкните **Очистить контейнер перед отправкой**, если хотите, чтобы контейнер был очищен перед отправкой артефактов сборки (не устанавливайте этот флажок, если не хотите очищать содержимое контейнера).
10. В поле **Список отправляемых артефактов** введите значение **text/*.txt**.
11. Для параметра **Общий виртуальный путь для отправленных артефактов** введите значение **${BUILD\_ID}/${BUILD\_NUMBER}**.
12. Нажмите кнопку **Сохранить**, чтобы сохранить параметры.
13. На панели мониторинга Hudson щелкните **Выполнить сборку**, чтобы запустить **MyJob**. Изучите выходные данные в консоли для определения состояния. Сообщения о состоянии для хранилища Azure будут включены в выходные данные консоли, когда действие после построения начнет передавать артефакты построения.
14. После успешного завершения задания можно просмотреть артефакты построения, открыв общедоступный BLOB-объект.
    1. Выполните вход на портал управления Azure, <https://manage.windowsazure.com>.
    2. Щелкните **Хранилище**.
    3. Щелкните имя учетной записи хранения, используемой для решения Hudson.
    4. Щелкните **Контейнеры**.
    5. Выберите контейнер с именем **myjob**, которое является копией имени задания Hudson, написанной в нижнем регистре. Имена контейнеров и BLOB-объектов в хранилище Azure отображаются строчными буквами (и с учетом регистра). В списке BLOB-объектов для контейнера с именем **myjob** вы увидите **hello.txt** и **date.txt**. Скопируйте URL-адрес любого из этих элементов и откройте его в браузере. Вы увидите текстовый файл, который был загружен в качестве артефакта построения.

На каждое задание может быть создано только одно действие после построения, которое отправляет артефакты в хранилище blob-объектов Azure. Обратите внимание, что одно действие после сборки по отправке артефактов в хранилище больших двоичных объектов Azure позволяет определять различные файлы (в том числе подстановочные знаки) и пути для файлов в **списке отправляемых артефактов** с использованием точки с запятой в качестве разделителя. Например, если операция сборки Hudson создает JAR-файлы и TXT-файлы в папке **build** рабочей области, при этом их нужно отправить в хранилище больших двоичных объектов Azure, укажите в поле **Список отправляемых артефактов** следующее значение: **build/\*.jar;build/\*.txt**. Чтобы задать путь для использования в имени blob-объекта, можно также использовать синтаксис с двойным двоеточием. Например, если необходимо отправить JAR-файлы с использованием **двоичных файлов** в пути большого двоичного объекта, а TXT-файлы - с использованием **уведомлений** в пути большого двоичного объекта, используйте для параметра **Список отправляемых артефактов** следующее значение: **build/\*.jar::binaries;build/\*.txt::notices**.

## <a name="howtocreatebuildstep"></a>Как создать шаг сборки для скачивания больших двоичных объектов из хранилища Azure ##

В последующих шагах показана настройка шага построения для загрузки blob-объектов из хранилища Azure. Это может оказаться полезным при необходимости включить элементы в построение, например, JAR-файлы, которые хранятся в хранилище blob-объектов Azure.

1. В разделе **Сборка** конфигурации задания щелкните **Добавить шаг сборки** и выберите **Скачать из хранилища больших двоичных объектов Azure**.
2. В поле **Имя учетной записи хранения** выберите учетную запись для использования.
3. Для поля **Имя контейнера** задайте имя контейнера с большими двоичными объектами, который нужно скачать. Можно использовать переменные среды.
4. В поле **Имя большого двоичного объекта** укажите имя большого двоичного объекта. Можно использовать переменные среды. В то же время можно использовать звездочку как подстановочный символ после задания начальной буквы (букв) имени blob-объекта. Например, имя **project\*** будет определять все большие двоичные объекты, имя которых начинается с **project**.
5. [Необязательно] В поле **Папка для загрузки** задайте путь к компьютеру с Hudson, на который нужно скачать файлы из хранилища больших двоичных объектов Azure. Переменные среды также могут использоваться. (Если не задать значения для поля **Папка для скачивания**, файлы из хранилища больших двоичных объектов Azure будут скачиваться в рабочую область задания.)

При наличии дополнительных элементов, которые нужно загрузить из хранилища blob-объектов Azure можно создать дополнительные шаги построения.

После выполнения построения можно проверить выход консоли истории построения или взглянуть на местоположение для загрузки и удостовериться, успешно ли загрузились необходимы blob-объекты. 

## <a id="components"></a>Компоненты, используемые службой BLOB-объектов ##

Ниже приведен обзор компонентов службы BLOB-объектов:

- **Учетная запись хранения**: Весь доступ к хранилищу Azure осуществляется с помощью учетной записи хранения. Это самое высокоуровневое пространство имен для доступа к большим двоичным объектам. Учетная запись может содержать неограниченное число контейнеров при условии, что их общий размер не достигает 100 ТБ.
- **Контейнер**: Контейнер обеспечивает группировку набора BLOB-объектов. Все BLOB-объекты должны содержаться в контейнере. Учетная запись может содержать неограниченное число контейнеров. Контейнер может хранить неограниченное количество больших двоичных объектов.
- **Большой двоичный объект**: файл любого типа и размера. Существует два типа BLOB-объектов, которые могут храниться в хранилище Azure: блоки и страницы. Большинство файлов являются блоками больших двоичных объектов. Единичный BLOB-блок может иметь размер до 200 ГБ. В этом учебнике используются BLOB-блоки. Страницы больших двоичных объектов являются другим типом больших двоичных объектов и могут иметь размер до 1 ТБ. Они более эффективны, когда диапазоны байтов в файле часто изменяются. Дополнительную информацию о больших двоичных объектах см. в разделе [Основные сведения о блочных и страничных больших двоичных объектов](http://msdn.microsoft.com/library/windowsazure/ee691964.aspx).
- **Формат URL-адреса**: Для адресации BLOB-объектов используется следующий формат URL-адресов:

    `http://storageaccount.blob.core.windows.net/container_name/blob_name`
    
    (Приведенный выше формат применяется для общедоступного облака Azure. При использовании другого облака Azure используйте конечную точку на портале управления Azure, чтобы определить конечную точку URL-адреса.)

    В указанном выше формате  `storageaccount` представляет имя вашей учетной записи хранения,  `container_name` представляет имя контейнера, а  `blob_name` представляет имя большого двоичного объекта, соответственно. В имени контейнера может использовать несколько путей, разделенных косой чертой - **/**. Образцом имени контейнера в данном учебнике был **MyJob**, а **${BUILD\_ID}/${BUILD\_NUMBER}** использовался в качестве общего виртуального пути, в результате чего большой двоичный объект получил следующий URL-адрес:

    `http://example.blob.core.windows.net/myjob/2014-05-01_11-56-22/1/hello.txt`

  [Общая информация о Hudson]: #overview
  [Преимущества использования службы BLOB-объектов]: #benefits
  [Предварительные требования]: #prerequisites
  [Использование службы BLOB-объектов с решением непрерывной интеграции Hudson]: #howtouse
  [Как установить подключаемый модуль службы хранилища Azure]: #howtoinstall
  [Как настроить подключаемый модуль службы хранилища Azure для использования своей учетной записи хранения]: #howtoconfigure
  [Как создать действие, выполняемое после сборки и отправляющее артефакты сборки в вашу учетную запись хранения]: #howtocreatepostbuild
  [Как создать шаг сборки для скачивания больших двоичных объектов из хранилища Azure]: #howtocreatebuildstep
  [Компоненты, используемые службой больших двоичных объектов]: #components
  [Как создать учетную запись хранения]: http://go.microsoft.com/fwlink/?LinkId=279823
  [Знакомство с Hudson]: http://wiki.eclipse.org/Hudson-ci/Meet_Hudson
  [ms-open-tech]: http://msopentech.com


<!--HONumber=42-->
