<properties urlDisplayName="Publishing with Visual Studio Online" pageTitle="Непрерывная доставка с использованием Visual Studio Online в Azure" metaKeywords="" description="В данном разделе приводится информация о том, как настроить командные проекты Visual Studio Online для автоматического создания и развертывания веб-сайтов или облачных служб Azure." metaCanonical="" services="web-sites" documentationCenter=".NET" title="Непрерывная доставка в Azure с использованием Visual Studio Online и Git" authors="ghogen" solutions="" manager="douge" editor="" />

<tags ms.service="cloud-services" ms.workload="tbd" ms.tgt_pltfrm="na" ms.devlang="dotnet" ms.topic="article" ms.date="09/24/2014" ms.author="ghogen" />

# Непрерывная доставка в Azure с использованием Visual Studio Online и Git

С помощью командных проектов Visual Studio Online можно размещать репозиторий Git для исходного кода и выполнять автоматическое построение и развертывание на веб-сайтах Azure или в облачных службах при каждой операции фиксации в репозитории.

В данном учебнике требуются установленные Visual Studio 2013 и пакет SDK Azure. Чтобы загрузить Visual Studio 2013, щелкните ссылку **Начните работу бесплатно** на сайте [www.visualstudio.com][www.visualstudio.com]. Пакет SDK Azure можно установить по [этой ссылке][этой ссылке].

<div class="wa-note">
  <span class="wa-icon-bulb"></span>
  <h5><a name="note"></a>Для работы с этим учебником необходима учетная запись Visual Studio Online:</h5>
<p>Вы можете <a href="http://go.microsoft.com/fwlink/p/?LinkId=512979">бесплатно зарегистрировать учетную запись Visual Studio Online</a>.</p>
</div>

Чтобы настроить облачную службу для автоматического построения и развертывания в Azure с использованием Visual Studio Online, выполните следующие действия:

-   [Шаг 1: Создание Git-репозитория][Шаг 1: Создание Git-репозитория]

-   [Шаг 2: создание проекта и отправка его в репозиторий Git.][Шаг 2: создание проекта и отправка его в репозиторий Git.]

-   [Шаг 3: подключение проекта к Azure.][Шаг 3: подключение проекта к Azure.]

-   [Шаг 4: внесение необходимых изменений и запуск процессов повторного построения и развертывания.][Шаг 4: внесение необходимых изменений и запуск процессов повторного построения и развертывания.]

-   [Шаг 5: повторное развертывание предыдущей сборки (необязательно)][Шаг 5: повторное развертывание предыдущей сборки (необязательно)]

-   [Шаг 6: изменение развертывания в рабочей среде.][Шаг 6: изменение развертывания в рабочей среде.]

-   [Шаг 7: развертывание из рабочей ветви.][Шаг 7: развертывание из рабочей ветви.]

## <a name="step1"></a><span class="short-header">Шаг 1: Создание Git-репозитория.</span>Шаг 1: создание Git-репозитория

1.  Если у вас еще нет учетной записи Visual Studio Online, выполните инструкции из [этой статьи][этой статьи]. При создании командного проекта выберите Git в качестве системы управления версиями. Выполните следующие инструкции для подключения Visual Studio к командному проекту.

2.  В Team Explorer нажмите ссылку **Клонировать этот репозиторий**.
    ![][0]

3.  Укажите расположение локальной копии и нажмите кнопку **Клонировать**.

## <a name="step2"> </a><span class="short-header">Создание проекта и сохранение его в репозитории</span>Шаг 2: создание проекта и сохранение его в репозитории

1.  В Team Explorer в разделе "Решения" нажмите ссылку "Создать", чтобы создать новый проект в локальном репозитории.
    ![][1]

2.  Чтобы развернуть веб-сайт или облачную службу (приложение Azure), выполните действия из этого пошагового руководства.
    Создайте новый проект облачной службы Microsoft Azure
    или новый проект приложения MVC ASP.NET. Убедитесь, что в проекте используется платформа .NET Framework 4 или 4.5, и если создается проект облачной службы, добавьте рабочую роль и веб-роль MVC ASP.NET.
    Если требуется создать веб-сайт, выберите шаблон проекта веб-приложения ASP.NET, а затем выберите MVC. См. раздел [Начало работы с Azure и ASP.NET][Начало работы с Azure и ASP.NET].

3.  Откройте контекстное меню для решения и выберите пункт **Зафиксировать**.
    ![][2]

4.  Если вы впервые используете Git в Visual Studio Online, то необходимо предоставить некоторые сведения для вашей идентификации в Git. В области **ожидающих изменений** укажите свое имя пользователя и адрес электронной почты. Введите комментарий для фиксации и нажмите **Зафиксировать**.
    ![][3]

5.  Обратите внимание на параметры, позволяющие включить или исключить отдельные изменения при регистрации. Если нужные изменения исключены, выберите **Включить все**.

6.  Теперь изменения зафиксированы в локальной копии репозитория. Далее следует синхронизировать эти изменения с сервером. Нажмите ссылку **Синхронизация**.

## <a name="step3"> </a><span class="short-header">Подключение проекта к Azure</span>Шаг 3: подключение проекта к Azure

1.  Теперь, когда имеется репозиторий Git в Visual Studio Online, содержащий некоторый исходный код, можно подключить этот репозиторий к Azure. На [портале Azure][портале Azure] выберите существующую облачную службу или веб-сайт либо создайте новую, нажав значок "+" в нижнем левом углу, выбрав **Облачная служба** или **Веб-сайт** и нажав **Быстрое создание**.<br.>
    ![][4]

2.  Для облачных служб нажмите ссылку **Настройка публикации в Visual Studio Online**. Для веб-сайтов нажмите ссылку **Настроить развертывание из системы управления версиями**.
    ![][5]

3.  В мастере введите имя учетной записи Visual Studio Online в соответствующем поле и нажмите ссылку **Авторизовать сейчас**. Может появиться запрос на вход в систему.
    ![][6]

4.  Во всплывающем диалоговом окне OAuth нажмите **Принять**, чтобы предоставить Azure полномочия для настройки командного проекта в Visual Studio Online.
    ![][7]

5.  После успешной авторизации появится раскрывающийся список, содержащий ваши командные проекты Visual Studio Online. Щелкните имя созданного на предыдущих шагах командного проекта и нажмите кнопку с галочкой в мастере.
    ![][8]

При следующей фиксации в репозитории Visual Studio Online будет выполнять построение и развертывание проекта в Azure.

## <a name="step4"> </a><span class="short-header">Запуск процесса повторного построения</span>Шаг 4: запуск процессов повторного построения и развертывания проекта

1.  Откройте файл в Visual Studio и измените его. Например, измените файл \_Layout.cshtml в папке Views\\Shared веб-роли MVC.
    ![][9]

2.  Измените текст нижнего колонтитула для сайта и сохраните файл.
    ![][10]

3.  В обозревателе решений откройте контекстное меню для узла решения, узла проекта или файла, который был изменен, и выберите пункт **Зафиксировать**.

4.  Введите комментарий и нажмите **Зафиксировать**.
    ![][3]

5.  Нажмите ссылку **Синхронизация**.
    ![][11]

6.  Нажмите ссылку **Отправить**, чтобы отправить фиксацию в репозиторий в Visual Studio Online. (Можно также использовать кнопку **Синхронизация**, чтобы скопировать фиксации в репозиторий. Разница в том, что **синхронизация** также запрашивает последние изменения в репозитории.)
    ![][12]

7.  Нажмите кнопку "Главная", чтобы вернуться на главную страницу Team Explorer.
    ![][13]

8.  Нажмите **Построения**, чтобы просмотреть выполняющиеся построения.
    ![][14]
    В обозревателе Team Explorer будут показаны сведения о том, что для вашей регистрации был запущен процесс построения.
    ![][15]

9.  Дважды щелкните имя выполняемого построения, чтобы просмотреть подробный журнал процесса построения.

10. В процессе построения вы можете просмотреть определение сборки, созданное во время привязки к Azure с помощью мастера. Откройте контекстное меню для определения сборки и выберите пункт **Редактировать определение сборки**.
    ![][16]
    На вкладке **запуска** можно видеть, что для определения сборки по умолчанию задано построение при каждой регистрации. (Для облачной службы Visual Studio Online автоматически выполняет построение и развертывание главной ветви в промежуточной среде. Развертывание на рабочем сайте необходимо будет выполнить вручную. Для веб-сайта, который не имеет промежуточную среду, Visual Studio Online развертывает главную ветвь непосредственно на рабочем сайте.
    ![][17]
    На вкладке **хода выполнения** можно видеть, что для среды развертывания установлено имя облачной службы или веб-сайта.
    ![][18]
    Укажите значения для свойств, если не хотите использовать значения по умолчанию. Свойства для публикации Azure находятся в разделе развертывания, и может также потребоваться установка параметров MSBuild. Например, чтобы указать в проекте облачной службы конфигурацию, отличную от "Cloud", установите для параметров MSbuild значение /p:TargetProfile=*Ваш\_профиль*, где *Ваш\_профиль* соответствует файлу конфигурации службы с именем типа ServiceConfiguration.*Ваш\_профиль*.cscfg.
    В следующей таблице приведены доступные свойства из раздела развертывания.

    <table>

    <tr>
    <td>
    **Свойство**

    </td>
    <td>
    **Значение по умолчанию**

    </td>
    </tr>
    </p>
    > <tr>
    > <td>
    > Разрешить недоверенные сертификаты
    >
    > </td>
    > <td>
    > Если установлено значение false, то SSL-сертификаты должны быть подписаны корневым центром сертификации.
    >
    > </td>
    > </tr>
    > <tr>
    > <td>
    > Разрешить обновление
    >
    > </td>
    > <td>
    > Разрешает обновление существующего развертывания вместо создания нового. Сохраняет IP-адрес.
    >
    > </td>
    > </tr>
    > <tr>
    > <td>
    > Не удалять
    >
    > </td>
    > <td>
    > Если установлено значение true, не разрешена перезапись существующего несвязанного развертывания (обновление разрешено).
    >
    > </td>
    > </tr>
    > <tr>
    > <td>
    > Путь к параметрам развертывания
    >
    > </td>
    > <td>
    > Путь к PUBXML-файлу для веб-сайта относительно корневой папки репозитория. Для облачных служб игнорируется.
    >
    > </td>
    > </tr>
    > <tr>
    > <td>
    > Среда развертывания Sharepoint
    >
    > </td>
    > <td>
    > Совпадает с именем службы.
    >
    > </td>
    > </tr>
    > <tr>
    > <td>
    > Среда развертывания Microsoft Azure
    >
    > </td>
    > <td>
    > Имя веб-сайта или облачной службы
    >
    > </td>
    > </tr>
    > </table>

11. К этому моменту процесс построения должен быть успешно завершен.
    ![][19]

12. Если дважды щелкнуть имя построения, Visual Studio отобразит **сводку построения**, включающую все результаты тестирования из соответствующих проектов модульного теста.
    ![][20]

13. На [портале Azure][портале Azure] можно увидеть соответствующее развертывание на вкладке развертываний, выбрав промежуточную среду.
    ![][21]

14. Перейдите по URL-адресу вашего сайта. Для веб-сайта достаточно нажать на портале кнопку **Обзор**. Для облачной службы выберите URL-адрес в разделе **Quick Glance** (Сводка) страницы **Панель мониторинга**, показывающей промежуточную среду. Развертывания из решений непрерывной интеграции для облачных служб по умолчанию публикуются в промежуточной среде. Чтобы изменить это поведение, присвойте свойству "Альтернативная среда облачной службы" значение "Рабочая". На этом снимке экрана показано местонахождение URL-адреса сайта на странице "Панель мониторинга" облачной службы:
    ![][22]
    Сайт откроется на новой вкладке браузера.
    ![][23]

15. При внесении других изменений в проект запускаются дополнительные процессы построения, в результате чего создается несколько развертываний. Последнее из них отмечается как активное.
    ![][24]

## <a name="step5"> </a><span class="short-header">Повторное развертывание предыдущей сборки</span>Шаг 5: повторное развертывание предыдущей сборки

Этот шаг не является обязательным. На портале управления выберите предыдущее развертывание и нажмите **Повторить развертывание**, чтобы вернуть сайт в предыдущую версию. Обратите внимание, что в результате этого действия будет запущен новый процесс построения в TFS и в журнале развертываний будет создана новая запись.
![][25]

## <a name="step6"> </a><span class="short-header">Изменение развертывания в рабочей среде</span>Шаг 6: изменение развертывания в рабочей среде

Выполнив все необходимые действия, вы можете повысить промежуточную среду до рабочей с помощью кнопки **Переключить** на портале управления. Вновь развернутая промежуточная среда повышается до уровня рабочей, а ранее установленная рабочая среда становится промежуточной. Рабочая и промежуточная среды могут использовать разные активные развертывания, однако история развертывания последних сборок будет содержать одинаковые записи независимо от выбранной среды.
![][26]

## <a name="step7"> </a><span class="short-header">Развертывание из рабочей ветви</span>Шаг 6: развертывание из рабочей ветви

При использовании Git изменения обычно вносятся в рабочей ветви и интегрируются в главную ветвь, когда развертывание достигает завершенного состояния. На этапе развертывания проекта можно выполнить построение и развертывание рабочей ветви в Azure.

1.  В Team Explorer нажмите кнопку **домашней страницы**, а затем нажмите кнопку **Ветви**.
    ![][27]

2.  Нажмите ссылку **Новая ветвь**.
    ![][28]

3.  Введите имя ветви, например "working", и нажмите кнопку **Создать ветвь**. Будет создана новая локальная ветвь.
    ![][29]

4.  Опубликуйте эту ветвь. Выберите имя ветви в разделе **неопубликованных ветвей** и нажмите **Опубликовать**.
    ![][30]

5.  По умолчанию только изменения главной ветви вызывают непрерывное построение. Чтобы настроить непрерывное построение для рабочей ветви, перейдите на страницу построений в Team Explorer и нажмите **Редактировать определение построения**.

6.  Перейдите на вкладку **исходных параметров**. В разделе **Отслеживаемые ветви для непрерывной интеграции и прокрутки построений** нажмите пункт **Щелкните здесь, чтобы добавить строку**.
    ![][31]

7.  Укажите созданную ветвь, например, refs/heads/working.
    ![][32]

8.  Внесите изменения в код, откройте контекстное меню для измененного файла и выберите пункт **Зафиксировать**.
    ![][3]

9.  Нажмите ссылку **Несинхронизированные фиксации** и нажмите кнопку **Синхронизировать** или ссылку **Отправить**, чтобы скопировать изменения в копию рабочей ветви в Visual Studio Online.
    ![][11]

10. Перейдите в представление **построений** и найдите построение, которое только что было вызвано для рабочей ветви.

Дополнительные сведения см. в разделе [Visual Studio Online][Visual Studio Online]. Дополнительные советы по использованию Git в Visual Studio Online см. в статье [Совместный доступ к коду с помощью Git][Совместный доступ к коду с помощью Git], а сведения об использовании для публикации в Azure репозитория Git, не управляемого Visual Studio, см. в статье [Публикация на веб-сайтах Azure с помощью Git][Публикация на веб-сайтах Azure с помощью Git].

  [www.visualstudio.com]: http://www.visualstudio.com
  [этой ссылке]: http://go.microsoft.com/fwlink/?LinkId=239540
  [Шаг 1: Создание Git-репозитория]: #step1
  [Шаг 2: создание проекта и отправка его в репозиторий Git.]: #step2
  [Шаг 3: подключение проекта к Azure.]: #step3
  [Шаг 4: внесение необходимых изменений и запуск процессов повторного построения и развертывания.]: #step4
  [Шаг 5: повторное развертывание предыдущей сборки (необязательно)]: #step5
  [Шаг 6: изменение развертывания в рабочей среде.]: #step6
  [Шаг 7: развертывание из рабочей ветви.]: #step7
  [этой статьи]: http://go.microsoft.com/fwlink/?LinkId=397665
  [0]: ./media/cloud-services-continuous-delivery-use-vso-git/CloneThisRepository.PNG
  [1]: ./media/cloud-services-continuous-delivery-use-vso-git/CreateNewSolutionInClonedRepo.PNG
  [Начало работы с Azure и ASP.NET]: http://www.windowsazure.com/ru-ru/documentation/articles/web-sites-dotnet-get-started/
  [2]: ./media/cloud-services-continuous-delivery-use-vso-git/CommitMenuItem.PNG
  [3]: ./media/cloud-services-continuous-delivery-use-vso-git/CommitAChange2.PNG
  [портале Azure]: http://manage.windowsazure.com
  [4]: ./media/cloud-services-continuous-delivery-use-vso-git/CreateCloudService.PNG
  [5]: ./media/cloud-services-continuous-delivery-use-vso-git/SetUpPublishingWithVSO.PNG
  [6]: ./media/cloud-services-continuous-delivery-use-vso-git/AuthorizeConnection.PNG
  [7]: ./media/cloud-services-continuous-delivery-use-vso-git/ConnectionRequest.PNG
  [8]: ./media/cloud-services-continuous-delivery-use-vso-git/ChooseARepo3.PNG
  [9]: ./media/cloud-services-continuous-delivery-use-vso/tfs17.png
  [10]: ./media/cloud-services-continuous-delivery-use-vso-git/MakeACodeChange.PNG
  [11]: ./media/cloud-services-continuous-delivery-use-vso-git/SyncChanges2.PNG
  [12]: ./media/cloud-services-continuous-delivery-use-vso-git/PushCurrentBranch.PNG
  [13]: ./media/cloud-services-continuous-delivery-use-vso-git/TeamExplorerHome.png
  [14]: ./media/cloud-services-continuous-delivery-use-vso-git/TeamExplorerBuilds.PNG
  [15]: ./media/cloud-services-continuous-delivery-use-vso-git/BuildInQueue.png
  [16]: ./media/cloud-services-continuous-delivery-use-vso/tfs25.png
  [17]: ./media/cloud-services-continuous-delivery-use-vso/tfs26.png
  [18]: ./media/cloud-services-continuous-delivery-use-vso-git/ProcessTab.PNG
  [19]: ./media/cloud-services-continuous-delivery-use-vso/tfs28.png
  [20]: ./media/cloud-services-continuous-delivery-use-vso/tfs29.png
  [21]: ./media/cloud-services-continuous-delivery-use-vso/tfs30.png
  [22]: ./media/cloud-services-continuous-delivery-use-vso/tfs31.png
  [23]: ./media/cloud-services-continuous-delivery-use-vso/tfs32.png
  [24]: ./media/cloud-services-continuous-delivery-use-vso/tfs33.png
  [25]: ./media/cloud-services-continuous-delivery-use-vso/tfs34.png
  [26]: ./media/cloud-services-continuous-delivery-use-vso/tfs35.png
  [27]: ./media/cloud-services-continuous-delivery-use-vso-git/BranchesInTeamExplorer.PNG
  [28]: ./media/cloud-services-continuous-delivery-use-vso-git/NewBranch.PNG
  [29]: ./media/cloud-services-continuous-delivery-use-vso-git/CreateBranch.PNG
  [30]: ./media/cloud-services-continuous-delivery-use-vso-git/PublishBranch.PNG
  [31]: ./media/cloud-services-continuous-delivery-use-vso-git/SourceSettingsPage.PNG
  [32]: ./media/cloud-services-continuous-delivery-use-vso-git/IncludeWorkingBranch.PNG
  [Visual Studio Online]: http://go.microsoft.com/fwlink/?LinkId=253861
  [Совместный доступ к коду с помощью Git]: http://www.visualstudio.com/get-started/share-your-code-in-git-vs.aspx
  [Публикация на веб-сайтах Azure с помощью Git]: http://www.windowsazure.com/ru-ru/documentation/articles/web-sites-publish-source-control
