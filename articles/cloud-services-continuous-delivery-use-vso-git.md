<properties urlDisplayName="Publishing with Visual Studio Online" pageTitle="Непрерывная доставка с использованием Visual Studio Online в Azure" metaKeywords="" description="Learn how to configure your Visual Studio Online team projects to automatically build and deploy to Azure websites or cloud services." metaCanonical="" services="web-sites" documentationCenter=".NET" title="Continuous delivery to Azure using Visual Studio Online and Git" authors="ghogen" solutions="" manager="douge" editor="" />

<tags ms.service="cloud-services" ms.workload="tbd" ms.tgt_pltfrm="na" ms.devlang="dotnet" ms.topic="article" ms.date="09/24/2014" ms.author="ghogen" />




# Непрерывная доставка в Azure с использованием Visual Studio Online и Git

С помощью командных проектов Visual Studio Online можно размещать репозиторий Git для исходного кода и выполнять автоматическое построение и развертывание на веб-сайтах Azure или в облачных службах при каждой операции фиксации в репозитории.

В данном учебнике требуются установленные Visual Studio 2013 и пакет SDK Azure. Чтобы скачать Visual Studio 2013, щелкните ссылку **Начните работу бесплатно** на сайте [www.visualstudio.com](http://www.visualstudio.com). Пакет SDK Azure можно установить по [этой ссылке](http://go.microsoft.com/fwlink/?LinkId=239540).


<div class="wa-note">
  <span class="wa-icon-bulb"></span>
  <h5><a name="note"></a>Для работы с этим учебником необходима учетная запись Visual Studio Online:</h5>
<p>Вы можете <a href="http://go.microsoft.com/fwlink/p/?LinkId=512979">бесплатно зарегистрировать учетную запись Visual Studio Online</a>.</p>
</div>

Чтобы настроить облачную службу для автоматического построения и развертывания в Azure с использованием Visual Studio Online, выполните следующие действия:

-   [Шаг 1. Создание репозитория Git.][]

-   [Шаг 2. Создание проекта и отправка его в репозиторий Git.][]

-   [Шаг 3. Подключение проекта к Azure.][]

-   [Шаг 4. Внесение необходимых изменений и запуск процессов повторного построения и развертывания.][]

-   [Шаг 5. Повторное развертывание предыдущей сборки (необязательно)][]

-   [Шаг 6. Изменение развертывания в рабочей среде][]

-	[Шаг 7. Развертывание из рабочей ветви][]

<h2> <a name="step1"></a>Шаг 1. Создание репозитория Git</h2>


1. Если у вас еще нет учетной записи Visual Studio Online, выполните инструкции из [этой статьи](http://go.microsoft.com/fwlink/?LinkId=397665). При создании командного проекта выберите Git в качестве системы управления версиями. Выполните следующие инструкции для подключения Visual Studio к командному проекту.

2. В Team Explorer щелкните ссылку **Клонировать этот репозиторий**. 
![][3]

3. Укажите расположение локальной копии и нажмите кнопку **Клонировать**.
 
<h2><a name="step2"> </a>Шаг 2. Создание проекта и сохранение его в репозитории</h2>

1. В Team Explorer в разделе "Решения" щелкните ссылку "Создать", чтобы создать новый проект в локальном репозитории.<br/>
![][4]

2. В этом пошаговом руководстве представлены указания по развертыванию веб-сайта или облачной службы (приложения Azure).
Создайте новый проект облачной службы Microsoft Azure или новый проект ASP.NET MVC. Убедитесь, что в проекте используется платформа .NET Framework 4 или 4.5 и создается проект облачной службы, добавьте рабочую роль и веб-роль ASP.NET MVC.
Чтобы создать веб-сайт, выберите шаблон проекта "Веб-приложение ASP.NET" и затем выберите MVC. См. раздел [Начало работы с Azure и ASP.NET](http://www.windowsazure.com/ru-ru/documentation/articles/web-sites-dotnet-get-started/).

3. Откройте контекстное меню для решения и выберите пункт **Зафиксировать**.<br/>
![][7]

4. Если вы впервые используете Git в Visual Studio Online, то необходимо предоставить некоторые сведения для вашей идентификации в Git. В области **ожидающих изменений** укажите свое имя пользователя и адрес электронной почты. Введите комментарий для фиксации и выберите **Зафиксировать**.<br/>
![][8]

5. Обратите внимание на параметры, позволяющие включить или исключить отдельные изменения при регистрации. Если нужные изменения исключены, выберите **Включить все**.<br/>

6. Теперь изменения зафиксированы в локальной копии репозитория. Далее следует синхронизировать эти изменения с сервером. Щелкните ссылку **Синхронизация**.

<h2> <a name="step3"> </a>Шаг 3. Подключение проекта к Azure</h2>

1. Теперь, когда имеется репозиторий Git в Visual Studio Online, содержащий некоторый исходный код, можно подключить этот репозиторий к Azure.  На [портале Azure](http://manage.windowsazure.com) выберите существующую облачную службу или веб-сайт либо создайте новую с помощью значка "+" в нижнем левом углу, после чего выберите **Облачная служба** или **Веб-сайт** и щелкните **Быстрое создание**.<br.>
![][9]

3. Для облачных служб щелкните ссылку **Настройка публикации в Visual Studio Online**. Для веб-сайтов щелкните ссылку **Настроить развертывание из системы управления версиями**.<br/>
![][10]

2. В мастере введите имя учетной записи Visual Studio Online в соответствующем поле и щелкните ссылку **Авторизовать сейчас**. Может появиться запрос на вход в систему.<br/>
![][11]

3. Во всплывающем диалоговом окне OAuth нажмите **Принять**, чтобы предоставить Azure полномочия для настройки командного проекта в Visual Studio Online.<br/>
![][12]

4. После успешной авторизации появится раскрывающийся список, содержащий ваши командные проекты Visual Studio Online.  Щелкните имя созданного на предыдущих шагах командного проекта и нажмите кнопку с галочкой в мастере.<br/>
![][13]

При следующей фиксации в репозитории Visual Studio Online будет выполнять построение и развертывание проекта в Azure.<br/>


<h2><a name="step4"> </a>Шаг 4. запуск процессов повторного построения и развертывания проекта</h2>

1. Откройте файл в Visual Studio и измените его. Например, измените файл _Layout.cshtml в папке Views\Shared веб-роли MVC.<br/>
![][17]

2. Измените текст нижнего колонтитула для сайта и сохраните файл.<br/>
![][18]

3. В обозревателе решений откройте контекстное меню для узла решения, узла проекта или файла, который был изменен, и выберите пункт **Зафиксировать**.<br/>

4. Введите комментарий и нажмите **Зафиксировать**.<br/>
![][20]

5. Щелкните ссылку **Синхронизация**.<br/>
![][38]

6. Щелкните ссылку **Отправить**, чтобы отправить фиксацию в репозиторий в Visual Studio Online. (Можно также использовать кнопку **Синхронизация**, чтобы скопировать фиксации в репозиторий. Разница в том, что **синхронизация** также запрашивает последние изменения в репозитории.)<br/>
![][39]

7. Нажмите кнопку "Главная", чтобы вернуться на главную страницу Team Explorer.<br/>
![][21]

8. Щелкните **Сборки**, чтобы просмотреть выполняющиеся сборки.<br/>
![][22]
<br/>
В обозревателе Team Explorer будет показана информация о том, что для вашей регистрации был запущен процесс сборки.<br/>
![][23]

9. Дважды щелкните имя выполняемого построения, чтобы просмотреть подробный журнал процесса построения.<br/>

10. В процессе построения вы можете просмотреть определение сборки, созданное во время привязки к Azure с помощью мастера.  Откройте контекстное меню определения сборки и выберите **Редактировать определение сборки**.<br/>
![][25]
<br/>
На вкладке **Триггер** указывается, что в определении сборки по умолчанию настроено выполнение сборки при каждой регистрации. (Для облачной службы Visual Studio Online автоматически выполняет построение и развертывание главной ветви в промежуточной среде. Развертывание на рабочем сайте необходимо будет выполнить вручную. Для веб-сайта, который не имеет промежуточной среды, развертывание главной ветви выполняется непосредственно на работающем сайте.<br/>
![][26]
<br/>
На вкладке **Процесс** указывается, что в среде разработки настроено имя вашей облачной веб-службы или веб-сайта.<br/>
![][27]
<br/>
При необходимости измените установленные по умолчанию значения свойств. Свойства для публикации Azure находятся в разделе развертывания, и может также потребоваться установка параметров MSBuild. Например, чтобы указать в проекте облачной службы конфигурацию, отличную от "Cloud", установите для параметров MSbuild значение /p:TargetProfile=*Ваш_профиль*, где *Ваш_профиль* соответствует файлу конфигурации службы с именем типа ServiceConfiguration.*Ваш_профиль*.cscfg.
В следующей таблице приводятся доступные свойства в разделе "Развертывание":
	<table>
<tr><td><b>Свойство</b></td><td><b>Значение по умолчанию</b></td></tr>
><tr><td>Разрешить недоверенные сертификаты</td><td>Если установлено значение false, то SSL-сертификаты должны быть подписаны корневым центром сертификации.</td></tr>
<tr><td>Разрешить обновление</td><td>Разрешает обновление существующего развертывания вместо создания нового. Сохраняет IP-адрес.</td></tr>
><tr><td>Не удалять</td><td>Если установлено значение true, не разрешена перезапись существующего несвязанного развертывания (обновление разрешено).</td></tr>
<tr><td>Путь к параметрам развертывания</td><td>Путь к PUBXML-файлу для веб-сайта относительно корневой папки репозитория. Для облачных служб игнорируется.</td></tr>
<tr><td>Среда развертывания SharePoint</td><td>Совпадает с именем службы.</td></tr>
<tr><td>Среда развертывания Microsoft Azure</td><td>Имя веб-сайта или облачной службы</td></tr>
</table>
<br/>

11. К этому моменту процесс построения должен быть успешно завершен.<br/>
![][28]

12. Чтобы открыть окно **Сводка сборки** в Visual Studio и просмотреть результаты проверки из связанных проектов модульного тестирования, дважды щелкните имя сборки.<br/>
![][29]

13. На [портале Azure](http://manage.windowsazure.com)вы можете видеть соответствующее развертывание на вкладке развертываний, выбрав промежуточную среду.<br/>
![][30]

14.	Перейдите по URL-адресу вашего сайта. Для веб-сайта достаточно нажать на портале кнопку **Обзор**. Для облачной службы выберите URL-адрес в разделе **Сводка** страницы **Панель мониторинга**, показывающей промежуточную среду. Развертывания из решений непрерывной интеграции для облачных служб по умолчанию публикуются в промежуточной среде. Чтобы изменить это поведение, присвойте свойству "Альтернативная среда облачной службы" значение "Рабочая". На этом снимке экрана показано местонахождение URL-адреса сайта на странице "Панель мониторинга" облачной службы: <br/>
![][31]
<br/>
Сайт откроется на новой вкладке браузера.<br/>
![][32]

15.	При внесении других изменений в проект запускаются дополнительные процессы построения, в результате чего создается несколько развертываний. Последнее из них отмечается как активное.<br/>
![][33]

<h2> <a name="step5"> </a>Шаг 5. Повторное развертывание предыдущей сборки</h2>

Этот шаг не является обязательным. На портале управления выберите предыдущее развертывание и нажмите **Повторить развертывание**, чтобы вернуть сайт в предыдущую версию. Обратите внимание, что в результате этого действия будет запущен новый процесс построения в TFS и в журнале развертываний будет создана новая запись.<br/>
![][34]

<h2> <a name="step6"> </a>Шаг 6. Изменение развертывания в рабочей среде</h2>

 Выполнив все необходимые действия, вы можете повысить промежуточную среду до рабочей с помощью кнопки **Переключить** на портале управления. Вновь развернутая промежуточная среда повышается до уровня рабочей, а ранее установленная рабочая среда становится промежуточной. Рабочая и промежуточная среды могут использовать разные активные развертывания, однако история развертывания последних сборок будет содержать одинаковые записи независимо от выбранной среды.<br/>
![][35]

<h2> <a name="step7"> </a>Шаг 6. Развертывание из рабочей ветви</h2>

При использовании Git изменения обычно вносятся в рабочей ветви и интегрируются в главную ветвь, когда развертывание достигает завершенного состояния. На этапе развертывания проекта можно выполнить построение и развертывание рабочей ветви в Azure.

1. В Team Explorer нажмите кнопку **домашней страницы**, а затем нажмите кнопку **Ветви**.<br/>
![][40]

2. Щелкните ссылку **Новая ветвь**.<br/>
![][41]

3. Введите имя ветви, например "working", и нажмите кнопку **Создать ветвь**. Будет создана новая локальная ветвь.<br/>
![][42]

4. Опубликуйте эту ветвь. Выберите имя ветви в разделе **неопубликованных ветвей** и нажмите **Опубликовать**.<br/>
![][44]

6. По умолчанию только изменения главной ветви вызывают непрерывное построение. Чтобы настроить непрерывное построение для рабочей ветви, перейдите на страницу построений в Team Explorer и нажмите **Редактировать определение построения**.

7. Перейдите на вкладку **исходных параметров**. В разделе **Отслеживаемые ветви для непрерывной интеграции и прокрутки построений** нажмите пункт **Щелкните здесь, чтобы добавить строку**.<br/>
![][47]

8. Укажите созданную ветвь, например, refs/heads/working.
![][48]

9. Внесите изменения в код, откройте контекстное меню для измененного файла и выберите пункт **Зафиксировать**.<br/>
![][43]

10. Щелкните ссылку **Несинхронизированные фиксации** и нажмите кнопку **Синхронизировать** или ссылку **Отправить**, чтобы скопировать изменения в копию рабочей ветви в Visual Studio Online.
![][45]

11. Перейдите в представление **построений** и найдите построение, которое только что было вызвано для рабочей ветви.

Дополнительную информацию см. в разделе [Visual Studio Online](http://go.microsoft.com/fwlink/?LinkId=253861). Дополнительную информацию об использовании Git с Visual Studio Online см. в разделе [Совместный доступ к коду с помощью Git](http://www.visualstudio.com/get-started/share-your-code-in-git-vs.aspx) , а информацию об использовании репозитория Git, не управляемого с помощью Visual Studio Online, для публикации в Azure см. в разделе [Публикация из системы управления версиями на веб-сайты Azure](http://www.windowsazure.com/ru-ru/documentation/articles/web-sites-publish-source-control).

[Шаг 1. Создание репозитория Git.]: #step1
[Шаг 2. Создание проекта и отправка его в репозиторий Git.]: #step2
[Шаг 3. Подключение проекта к Azure.]: #step3
[Шаг 4. Внесение необходимых изменений и запуск процессов повторного построения и развертывания.]: #step4
[Шаг 5. Повторное развертывание предыдущей сборки (необязательно)]: #step5
[Шаг 6. Изменение развертывания в рабочей среде]: #step6
[Шаг 7. Развертывание из рабочей ветви]: #step7
[0]: ./media/cloud-services-continuous-delivery-use-vso/tfs0.PNG
[1]: ./media/cloud-services-continuous-delivery-use-vso-git/CreateTeamProjectInGit.PNG
[2]: ./media/cloud-services-continuous-delivery-use-vso/tfs2.png
[3]: ./media/cloud-services-continuous-delivery-use-vso-git/CloneThisRepository.PNG
[4]: ./media/cloud-services-continuous-delivery-use-vso-git/CreateNewSolutionInClonedRepo.PNG
[7]: ./media/cloud-services-continuous-delivery-use-vso-git/CommitMenuItem.PNG
[8]: ./media/cloud-services-continuous-delivery-use-vso-git/CommitAChange2.PNG
[9]: ./media/cloud-services-continuous-delivery-use-vso-git/CreateCloudService.PNG
[10]: ./media/cloud-services-continuous-delivery-use-vso-git/SetUpPublishingWithVSO.PNG
[11]: ./media/cloud-services-continuous-delivery-use-vso-git/AuthorizeConnection.PNG
[12]: ./media/cloud-services-continuous-delivery-use-vso-git/ConnectionRequest.PNG
[13]: ./media/cloud-services-continuous-delivery-use-vso-git/ChooseARepo3.PNG
[14]: ./media/cloud-services-continuous-delivery-use-vso/tfs14.png
[15]: ./media/cloud-services-continuous-delivery-use-vso/tfs15.png
[16]: ./media/cloud-services-continuous-delivery-use-vso/tfs16.png
[17]: ./media/cloud-services-continuous-delivery-use-vso/tfs17.png
[18]: ./media/cloud-services-continuous-delivery-use-vso-git/MakeACodeChange.PNG
[20]: ./media/cloud-services-continuous-delivery-use-vso-git/CommitAChange2.PNG
[21]: ./media/cloud-services-continuous-delivery-use-vso-git/TeamExplorerHome.png
[22]: ./media/cloud-services-continuous-delivery-use-vso-git/TeamExplorerBuilds.PNG
[23]: ./media/cloud-services-continuous-delivery-use-vso-git/BuildInQueue.png
[24]: ./media/cloud-services-continuous-delivery-use-vso/tfs24.png
[25]: ./media/cloud-services-continuous-delivery-use-vso/tfs25.png
[26]: ./media/cloud-services-continuous-delivery-use-vso/tfs26.png
[27]: ./media/cloud-services-continuous-delivery-use-vso-git/ProcessTab.PNG
[28]: ./media/cloud-services-continuous-delivery-use-vso/tfs28.png
[29]: ./media/cloud-services-continuous-delivery-use-vso/tfs29.png
[30]: ./media/cloud-services-continuous-delivery-use-vso/tfs30.png
[31]: ./media/cloud-services-continuous-delivery-use-vso/tfs31.png
[32]: ./media/cloud-services-continuous-delivery-use-vso/tfs32.png
[33]: ./media/cloud-services-continuous-delivery-use-vso/tfs33.png
[34]: ./media/cloud-services-continuous-delivery-use-vso/tfs34.png
[35]: ./media/cloud-services-continuous-delivery-use-vso/tfs35.png
[36]: ./media/cloud-services-continuous-delivery-use-vso/tfs36.PNG
[37]: ./media/cloud-services-continuous-delivery-use-vso-git/CreateANewAccount.PNG
[38]: ./media/cloud-services-continuous-delivery-use-vso-git/SyncChanges2.PNG
[39]: ./media/cloud-services-continuous-delivery-use-vso-git/PushCurrentBranch.PNG
[40]: ./media/cloud-services-continuous-delivery-use-vso-git/BranchesInTeamExplorer.PNG
[41]: ./media/cloud-services-continuous-delivery-use-vso-git/NewBranch.PNG
[42]: ./media/cloud-services-continuous-delivery-use-vso-git/CreateBranch.PNG
[43]: ./media/cloud-services-continuous-delivery-use-vso-git/CommitAChange2.PNG
[44]: ./media/cloud-services-continuous-delivery-use-vso-git/PublishBranch.PNG
[45]: ./media/cloud-services-continuous-delivery-use-vso-git/SyncChanges2.PNG
[47]: ./media/cloud-services-continuous-delivery-use-vso-git/SourceSettingsPage.PNG
[48]: ./media/cloud-services-continuous-delivery-use-vso-git/IncludeWorkingBranch.PNG

<!--HONumber=35.1-->
