<properties urlDisplayName="Attach a disk" pageTitle="Присоединение диска к виртуальной машине Linux в Azure" metaKeywords="disk VM Azure, initialize new disk Azure, initialize disk Azure Linux, attaching empty disk Azure" description="Узнайте, как присоединить диск данных к виртуальной машине Azure и инициализировать, чтобы подготовить к использованию." metaCanonical="http://www.windowsazure.com/ru-ru/manage/windows/how-to-guides/attach-a-disk/" services="virtual-machines" documentationCenter="" title="" authors="kathydav" solutions="" manager="timlt" editor="tysonn" />

<tags ms.service="virtual-machines" ms.workload="infrastructure-services" ms.tgt_pltfrm="vm-linux" ms.devlang="na" ms.topic="article" ms.date="7/29/2014" ms.author="kathydav" />

# Как присоединить диск данных к виртуальной машине Linux

Можно присоединять пустые диски и диски с данными. В обоих случаях это фактически файлы .vhd, которые размещаются в вашей учетной записи хранения Azure. Также в обоих случаях после присоединения диска необходимо его инициализировать, чтобы подготовить к использованию.

> [WACOM.NOTE] Рекомендуется использовать один или несколько отдельных дисков для хранения данных виртуальной машины. При создании виртуальной машины Azure у нее есть диск для операционной системы и временный диск. **Не используйте временный диск для хранения данных.** Как и предполагает его имя, он предназначен только для временного хранения. Этот диск не обеспечивает избыточности или резервного копирования, поскольку он не размещается в службе хранилища Azure.
> Временный диск обычно управляется агентом Linux Azure, и он автоматически подключается к **/mnt/resource** (или **/mnt** на образах Ubuntu). С другой стороны, диск данных Linux можно назвать по ядру, например, `/dev/sdc`. В этом случае вам потребуется разделять, форматировать и подключать этот ресурс. Дополнительную информацию см. в [руководстве пользователя агента Linux Azure][руководстве пользователя агента Linux Azure].

-   [Практическое руководство. Присоединение пустого диска][Практическое руководство. Присоединение пустого диска]
-   [Практическое руководство. Присоединение существующего диска][Практическое руководство. Присоединение существующего диска]
-   [Практическое руководство. Инициализация нового диска данных в Linux][Практическое руководство. Инициализация нового диска данных в Linux]

[WACOM.INCLUDE [руководство-присоединение-диск-windows-linux](../includes/howto-attach-disk-windows-linux.md)]

## <span id="initializeinlinux"></span></a>Практическое руководство. Инициализация нового диска данных в Linux

1.  Подключитесь к виртуальной машине, выполнив действия, описанные в разделе [Как войти в систему на виртуальной машине, работающей под управлением Linux][Как войти в систему на виртуальной машине, работающей под управлением Linux].

2.  В окне SSH введите следующую команду, а затем введите пароль для учетной записи, которую вы создали для управления виртуальной машиной:

        # sudo grep SCSI /var/log/messages

    Идентификатор последнего добавленного диска данных можно найти в отображаемых сообщениях.

    ![Получение сообщений диска][Получение сообщений диска]

3.  В окне SSH введите следующую команду для создания нового устройства, а затем введите пароль учетной записи:

        # sudo fdisk /dev/sdc

    > [WACOM.NOTE] В этом примере в некоторых дистрибутивах, возможно, потребуется использовать `sudo -i`, если /sbin или /usr/sbin находятся не в `$PATH`.

4.  Введите **n** для создания нового раздела.

    ![Создание нового устройства][Создание нового устройства]

5.  Введите **p**, чтобы сделать раздел основным, введите **1**, чтобы сделать его первым разделом, а затем нажмите клавишу ВВОД, чтобы принять значение по умолчанию для цилиндра.

    ![Создание раздела][Создание раздела]

6.  Введите **p**, чтобы просмотреть сведения о диске, на котором создаются разделы.

    ![Просмотр сведений о диске][Просмотр сведений о диске]

7.  Введите **w**, чтобы записать параметры данного диска.

    ![Запись изменений на диске][Запись изменений на диске]

8.  Создайте файловую систему на новом разделе. Например, введите следующую команду, а затем введите пароль данной учетной записи:

        # sudo mkfs -t ext4 /dev/sdc1

    ![Создание файловой системы][Создание файловой системы]

    > [WACOM.NOTE] Обратите внимание, что системы SUSE Linux Enterprise 11 поддерживают доступ только для чтения в файловых системах ext4. Для этих систем рекомендуется форматировать новую файловую систему ext3, а не ext4.

9.  Создайте каталог для подключения новой файловой системы. Например, введите следующую команду, а затем введите пароль данной учетной записи:

        # sudo mkdir /datadrive

10. Введите следующую команду, чтобы установить диск:

        # sudo mount /dev/sdc1 /datadrive

    Диск данных теперь готов для использования как **/datadrive**.

11. Добавьте новый диск в /etc/fstab:

    Чтобы обеспечить автоматическую переустановку диска после перезагрузки, его необходимо добавить в файл /etc/fstab. Кроме того, для ссылки на диск настоятельно рекомендуется использовать идентификатор UUID (глобально уникальный идентификатор) в /etc/fstab, а не просто имя устройства (т. е. /dev/sdc1). Чтобы найти идентификатор UUID нового диска, можно использовать программу **blkid**:

        # sudo -i blkid

    Вывод будет выглядеть примерно следующим образом:

        /dev/sda1: UUID="11111111-1b1b-1c1c-1d1d-1e1e1e1e1e1e" TYPE="ext4"
        /dev/sdb1: UUID="22222222-2b2b-2c2c-2d2d-2e2e2e2e2e2e" TYPE="ext4"
        /dev/sdc1: UUID="33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e" TYPE="ext4"

    > [WACOM.NOTE] Некорректное изменение файла **/etc/fstab** может привести к невозможности загрузить систему. Если не уверены, обратитесь к документации дистрибутива за сведениями о том, как правильно изменить этот файл. Также рекомендуется перед внесением изменений создать резервную копию файла /etc/fstab.

    Затем откройте файл **/etc/fstab** в текстовом редакторе. Обратите внимание, что /etc/fstab является системным файлом, поэтому для его редактирования необходимо воспользоваться `sudo`, например:

        # sudo vi /etc/fstab

    В этом примере мы используем значение UUID для нового устройства **/dev/sdc1**, созданного в предыдущих шагах, и точку подключения **/datadrive**. Добавьте следующую строку в конец файла **/etc/fstab**:

        UUID=33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /datadrive   ext4   defaults   1   2

    Или в системах на основе SUSE Linux может потребоваться использовать другой формат:

        /dev/disk/by-uuid/33333333-3b3b-3c3c-3d3d-3e3e3e3e3e3e   /   ext3   defaults   1   2

    Теперь можно проверить, правильно ли подключена файловая система, просто отключив и повторно подключив файловую систему, т. е. используя типовую точку подключения `/datadrive`, созданную на предыдущих этапах:

        # sudo umount /datadrive
        # sudo mount /datadrive

    Если команда `mount` приводит к ошибке, проверьте правильность синтаксиса в файле /etc/fstab. При создании дополнительных дисков данных и разделов нужно будет также ввести их в файл /etc/fstab отдельно.

    > [WACOM.NOTE] Последующее удаление диска данных без редактирования fstab может привести к тому, что виртуальная машина не загрузится. Если это происходит часто, то большинство дистрибутивов предоставляют варианты `nofail` и (или) fstab `nobootwait`, которые позволяют системе загружаться, даже если диск не подключится во время загрузки. Дополнительные сведения об этих параметрах см. в документации по вашему дистрибутиву.

  [руководстве пользователя агента Linux Azure]: http://www.windowsazure.com/ru-ru/manage/linux/how-to-guides/linux-agent-guide/
  [Практическое руководство. Присоединение пустого диска]: #attachempty
  [Практическое руководство. Присоединение существующего диска]: #attachexisting
  [Практическое руководство. Инициализация нового диска данных в Linux]: #initializeinlinux
  [Как войти в систему на виртуальной машине, работающей под управлением Linux]: ../virtual-machines-linux-how-to-log-on/
  [Получение сообщений диска]: ./media/virtual-machines-linux-how-to-attach-disk/DiskMessages.png
  [Создание нового устройства]: ./media/virtual-machines-linux-how-to-attach-disk/DiskPartition.png
  [Создание раздела]: ./media/virtual-machines-linux-how-to-attach-disk/DiskCylinder.png
  [Просмотр сведений о диске]: ./media/virtual-machines-linux-how-to-attach-disk/DiskInfo.png
  [Запись изменений на диске]: ./media/virtual-machines-linux-how-to-attach-disk/DiskWrite.png
  [Создание файловой системы]: ./media/virtual-machines-linux-how-to-attach-disk/DiskFileSystem.png
