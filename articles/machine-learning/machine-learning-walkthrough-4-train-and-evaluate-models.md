<properties
	pageTitle="Шаг 4. Обучение и анализ моделей прогнозирующей аналитики | Microsoft Azure"
	description="Четвертый этап пошагового руководства по разработке прогнозного решения: обучение и оценка нескольких моделей в студии машинного обучения Azure."
	services="machine-learning"
	documentationCenter=""
	authors="garyericson"
	manager="paulettm"
	editor="cgronlun"/>

<tags
	ms.service="machine-learning"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="09/08/2015"
	ms.author="garye"/>


# Шаг 4. Обучение и анализ моделей прогнозирующей аналитики

Это четвертый шаг пошагового руководства [Разработка прогнозирующего решения с помощью Azure ML](machine-learning-walkthrough-develop-predictive-solution.md).


1.	[Создание рабочей области машинного обучения](machine-learning-walkthrough-1-create-ml-workspace.md)
2.	[Отправка существующих данных](machine-learning-walkthrough-2-upload-data.md)
3.	[Создание нового эксперимента](machine-learning-walkthrough-3-create-new-experiment.md)
4.	**Обучение и анализ моделей**
5.	[Развертывание веб-службы](machine-learning-walkthrough-5-publish-web-service.md)
6.	[Доступ к веб-службе](machine-learning-walkthrough-6-access-web-service.md)

----------

В этом эксперименте мы планируем испытать разные алгоритмы для нашей прогнозирующей модели. Мы создадим два разных типа модели и сравним результаты их оценки, чтобы решить, какой алгоритм мы хотим использовать в нашем финальном эксперименте.

Существует множество моделей, которые можно выбрать. Чтобы просмотреть доступные модели, разверните узел **Машинное обучение** в палитре модулей, а затем разверните узел **Инициализация модели** и узлы под ним. Для данного эксперимента мы выберем метод опорных векторов (SVM) и двухклассовые увеличивающиеся деревья решений. Мы будем использовать соответствующие модули для инициализации алгоритмов обучения, а затем использовать модули [обучения модели][train-model] для обучения моделей.

##Обучение моделей
Сначала давайте настроим модель увеличивающегося дерева решений.

1.	Найдите модуль [Двухклассовое увеличивающееся дерево решений][two-class-boosted-decision-tree] в палитре модулей и перетащите его на полотно.
2.	Найдите модуль [Обучение модели][train-model], перетащите его на холст, а затем подключите точку вывода модуля увеличивающегося дерева решений к левому порту ввода ("Необученная модель") модуля [Обучение модели][train-model].
3.	Соедините левый выход левого модуля [Выполнение скрипта R][execute-r-script] с правым входным портом ("Набор данных") модуля [Обучение модели][train-model].

	> [AZURE.TIP]Для этого эксперимента нам не нужны два входа и один выход модуля [Выполнение скрипта R][execute-r-script], и мы просто оставим их неподключенными. Это не редкость для некоторых модулей.


4.	Выберите модуль [Обучение модели][train-model]. На панели **Свойства** щелкните **Запустить средство выбора столбцов**, в первом раскрывающемся списке выберите параметр **Включить**, во втором раскрывающемся списке выберите параметр **Индексы столбцов** и введите значение "21" в текстовом поле (можно также выбрать **Имя столбца** и ввести "Кредитный риск"). Столбец 21, содержащий значение кредитного риска, будет задан в качестве столбца, значение которого должна прогнозировать модель.


Теперь эта часть эксперимента выглядит следующим образом:

![Обучение модели][1]

Теперь настроим модель SVM.

Увеличивающиеся деревья решений хорошо работают с атрибутами любого типа. Однако, поскольку модуль SVM создает линейный классификатор, формируемая им модель имеет наименьшую ошибку при проверке среди всех атрибутов одного масштаба. Для преобразования всех числовых атрибутов в один масштаб мы используем модуль [Нормализация данных][normalize-data] с преобразованием Tanh, позволяющим привести атрибуты в диапазон [0,1]. Обратите внимание, что строковые атрибуты преобразуются модулем SVM в категориальные атрибуты, а затем в бинарные атрибуты 0/1, поэтому вручную их преобразовывать не нужно. Кроме того, мы не хотим преобразовывать столбец кредитного риска (столбец 21) — он числовой, но мы обучаем модель прогнозировать именно его значение, поэтому нам не нужно его трогать.

1.	Найдите модуль [Двухклассовый метод опорных векторов][two-class-support-vector-machine] в палитре модулей и перетащите его на холст.
2.	Щелкните правой кнопкой мыши модуль [Обучение модели][train-model], выберите команду **Копировать**, а затем щелкните правой кнопкой мыши полотно и выберите **Вставить**. Обратите внимание, что копия модуля [Обучение модели][train-model] имеет тот же набор выбранных столбцов, что и оригинал.
3.	Соедините вывод модуля SVM с левым портом ввода ("Необученная модель") модуля [Обучение модели][train-model].
4.	Найдите модуль [Нормализация данных][normalize-data] и перетащите его на полотно.
5.	Соедините ввод модуля преобразования с выводом левого модуля [Выполнение скрипта R][execute-r-script].
6.	Соедините левый порт вывода ("Преобразованный набор данных") модуля преобразования с правым портом ввода ("Набор данных") модуля [Обучение модели][train-model].
7.	На панели **Свойства** для модуля преобразования выберите значение **Tanh** для параметра **Метод преобразования**.
8.	Щелкните **Запустить средство выбора столбцов**, укажите для параметра **Начальное состояние** значение "Без столбцов"; в первом раскрывающемся списке выберите параметр **Включить**, во втором — параметр **Тип столбца**, а в третьем — параметр **Числовой**. Это указывает, что будут преобразованы все числовые столбцы (и только числовые).
9.	Нажмите знак "плюс" (+), чтобы создать новую строку раскрывающегося списка. Выберите **Исключить** в первом раскрывающемся списке, выберите **Индексы столбцов** во втором раскрывающемся списке и введите "21" в текстовом поле. Это указывает, что столбец 21 (столбец "Кредитный риск") будет игнорироваться.
10.	Нажмите кнопку **ОК**.  


Теперь модуль [Нормализация данных][normalize-data] настроен для выполнения преобразования Tanh во всех числовых столбцах, за исключением столбца "Кредитный риск".

Теперь эта часть эксперимента должна выглядеть следующим образом:

![Обучение второй модели][2]

##Оценка и анализ моделей
Мы будем использовать данные оценки, которые были отделены модулем **разделения** для оценки обученных моделей. Затем можно сравнить результаты двух моделей, чтобы увидеть, которая модель создает лучший результат.

1.	Найдите модуль [Оценка модели][score-model] и перетащите его на холст.
2.	Соедините левый порт ввода этого модуля с моделью увеличивающегося дерева решений (т. е. соедините его с портом вывода модуля [Обучение модели][train-model], который соединен с модулем [Двухклассовое увеличивающееся дерево решений][two-class-boosted-decision-tree]).
3.	Соедините правую точку ввода модуля [Оценка модели][score-model] с выводом правого модуля [Выполнение скрипта R][execute-r-script].
4.	Скопируйте и вставьте модуль [Оценка модели][score-model], чтобы создать вторую копию, или перетащите новый модуль на холст.
5.	Соедините левый порт ввода этого модуля с моделью SVM (т. е. соедините его с портом вывода модуля [Обучение модели][train-model], который соединен с модулем [Двухклассовый метод опорных векторов][two-class-support-vector-machine]).
6.	Для модели SVM необходимо выполнить то же самое преобразование тестовых данных, которое делалось для обучающих данных. Поэтому скопируйте и вставьте модуль [Нормализация данных][normalize-data], чтобы создать вторую копию, и подключите ее к выходу правого модуля [Выполнение скрипта R][execute-r-script].
7.	Подключите правый входной порт модуля [Оценка модели][score-model] к выходу правого модуля [Нормализация данных][normalize-data].  

Для сравнения двух результатов оценки мы будем использовать модуль [Анализ модели][evaluate-model].

1.	Найдите модуль [Анализ модели][evaluate-model] и перетащите его на холст.
2.	Соедините левый порт ввода с портом вывода модуля [Оценка модели][score-model], связанного с моделью увеличивающегося дерева решений.
3.	Соедините правый порт ввода с другим модулем [Оценка модели][score-model].  

Теперь наш эксперимент должен выглядеть следующим образом:

![Сравнение обеих моделей][3]

Нажмите кнопку **ВЫПОЛНИТЬ** внизу холста, чтобы запустить эксперимент. Это может занять несколько минут. В каждом модуле будет отображаться вращающийся индикатор, показывающий, что модуль выполняется, а когда модуль завершит работу, появится зеленая галочка.

Если эта галочка появилась во всех модулях, значит эксперимент завершил выполнение. Чтобы проверить результаты, щелкните порт вывода модуля [Анализ модели][evaluate-model] и выберите параметр **Показать результаты**.

Модуль [Анализ модели][evaluate-model] создает пару кривых и метрики, позволяющие сравнить результаты двух оцененных моделей. Результаты можно видеть в виде кривых ROC (рабочих характеристик приемника), кривых точности/полноты или кривых точности прогноза. Дополнительные отображаемые данные включают матрицу несоответствий, накопительные значения для области под кривой (AUC) и другие метрики. Вы можете изменить пороговое значение, перемещая ползунок влево или вправо, чтобы посмотреть, как это влияет на набор метрик.

Щелкните **Оцененный набор данных** или **Оцененный набор данных для сравнения**, чтобы выделить соответствующую кривую и отобразить внизу соответствующие метрики. В условных обозначениях для кривых "Scored dataset" (оцененный набор данных) соответствует левому порту ввода модуля [Оценка модели][evaluate-model] — в нашем случае это модель увеличивающегося дерева решений. "Оцененный набор данных для сравнения" соответствует правому входному порту — в нашем случае это модель SVM. Щелкните одну из этих меток, чтобы выделить кривую для этой модели и отобразить внизу соответствующие метрики.

![Кривые ROC для моделей][4]

Изучив эти значения, можно решить, какая модель ближе к тому, чтобы давать нужные результаты. Можно вернуться назад и выполнить итерацию в эксперименте, изменяя значения в разных моделях.

> [AZURE.TIP]При каждом выполнении эксперимента запись об этой итерации сохраняется в журнале выполнения. Эти итерации можно просмотреть и вернуться к любой из них, нажав кнопку ** ПРОСМОТР ЖУРНАЛА ВЫПОЛНЕНИЯ** под холстом. Можно также нажать **Предыдущее выполнение** в панели **Свойств**, чтобы вернуться в итерацию, которая выполнялась непосредственно перед той, что в текущий момент открыта. Подробнее: [Управление итерациями экспериментов в Студии машинного обучения Azure](machine-learning-manage-experiment-iterations.md).

Можно сделать копию любой итерации эксперимента, нажав кнопку **СОХРАНИТЬ КАК** под холстом. Таким образом создается дубликат эксперимента и новый журнал выполнения для отслеживания итераций этой версии. Новая копия отображается в списке **экспериментов** наряду с исходной. Это удобно, если планируется начать новую ветвь итераций эксперимента.

Чтобы облегчить отслеживание изменений параметров модуля, можно добавлять примечания к любому модулю на холсте эксперимента. Просто дважды щелкните модуль или щелкните его правой кнопкой мыши и выберите пункт **Изменить примечание**. Эти примечания сохраняются с итерациями эксперимента и помогают делать заметки по выполненной работе.


----------

**Дальнейшие действия: [Развертывание веб-службы](machine-learning-walkthrough-5-publish-web-service.md)**

[1]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train1.png
[2]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train2.png
[3]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train3.png
[4]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train4.png


<!-- Module References -->
[evaluate-model]: https://msdn.microsoft.com/library/azure/927d65ac-3b50-4694-9903-20f6c1672089/
[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/
[normalize-data]: https://msdn.microsoft.com/library/azure/986df333-6748-4b85-923d-871df70d6aaf/
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/
[train-model]: https://msdn.microsoft.com/library/azure/5cc7053e-aa30-450d-96c0-dae4be720977/
[two-class-boosted-decision-tree]: https://msdn.microsoft.com/library/azure/e3c522f8-53d9-4829-8ea4-5c6a6b75330c/
[two-class-support-vector-machine]: https://msdn.microsoft.com/library/azure/12d8479b-74b4-4e67-b8de-d32867380e20/

<!---HONumber=Oct15_HO3-->