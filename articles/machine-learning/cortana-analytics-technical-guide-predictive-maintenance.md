<properties
	pageTitle="Сборник тренировочных заданий для шаблонов решений Cortana Analytics для прогнозируемого обслуживания в аэрокосмических и других компаниях | Microsoft Azure | Microsoft Azure"
	description="Техническое руководство по шаблону решения с использованием Microsoft Cortana Analytics для прогнозируемого обслуживания в аэрокосмических, транспортных и обслуживающих компаниях."
	services="cortana-analytics"
	documentationCenter=""
	authors="fboylu"
	manager="paulettm"
	editor="cgronlun"/>

<tags
	ms.service="cortana-analytics"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="01/29/2016"
	ms.author="fboylu" />

# Техническое руководство по шаблонам решений Cortana Analytics для прогнозируемого обслуживания в аэрокосмических и других компаниях

## **Благодарности**
Авторами этой статьи являются специалисты по обработке и анализу данных Ян Цанг (Yan Zhang), Гаухер Шахин (Gauher Shaheen), Фидан Бойлу Юз (Fidan Boylu Uz) и инженер по программному обеспечению в корпорации Майкрософт Дэн Греко (Dan Grecoe).

## **Обзор**

Шаблоны решений позволяют ускорить процесс создания демонстрации E2E поверх Cortana Analytics Suite. Развернутый шаблон подготовит подписку с необходимыми компонентами Cortana Analytics и создаст связи между ними. Он также заполняет конвейер данных образцами данных, созданными из приложения генератора данных, которое будет скачано и установлено на локальном компьютере после развертывания шаблона решения. Данные, созданные из генератора, будут заполнять конвейер данных и начнут создавать прогнозы машинного обучения, которые можно визуализировать на панели мониторинга Power BI. Процесс развертывания поможет выполнить несколько шагов, чтобы настроить учетные данные решения. Убедитесь, что записали учетные данные, такие как имя решения, имя пользователя и пароль, предоставленные во время развертывания.

Цель данного документа — объяснить эталонную архитектуру и различные компоненты, подготовленные в подписке в рамках этого шаблона решения. Документ также рассказывает о том, как заменить образец данных вашими реальными данными, чтобы видеть мнения и прогнозы на основе ваших данных. Кроме того, в этом документе рассматриваются части шаблона решения, которые необходимо изменить, если вы хотите настроить решение с собственными данными. Инструкции по созданию панели мониторинга Power BI для этого шаблона решения приведены в конце.

>[AZURE.TIP] Можно скачать и распечатать [PDF-версию этого документа](http://download.microsoft.com/download/F/4/D/F4D7D208-D080-42ED-8813-6030D23329E9/cortana-analytics-technical-guide-predictive-maintenance.pdf).

## **Общая картина**

![](media/cortana-analytics-technical-guide-predictive-maintenance\predictive-maintenance-architecture.png)

При развертывании решения активируются различные службы Azure в Cortana Analytics Suite (*т. е.* концентратор событий, Stream Analytics, HDInsight, фабрика данных, машинное обучение *и т. д.*). Схема архитектуры выше на высоком уровне демонстрирует создание шаблона решения для прогнозируемого обслуживания в аэрокосмических компаниях от начала до конца. Вы сможете изучить эти службы на портале Azure. Для этого следует щелкнуть их на схеме шаблона решения, созданной с развертыванием решения. Исключением является HDInsight, так как эта служба подготавливается по требованию, когда после выполнения связанные действия конвейера удаляются. Можно скачать [полноразмерную схему](http://download.microsoft.com/download/1/9/B/19B815F0-D1B0-4F67-AED3-A40544225FD1/ca-topologies-maintenance-prediction.png).

В следующих разделах описан каждый фрагмент.

## **Источник данных и прием**

### Источник искусственных данных

Для этого шаблона используется источник данных, созданный настольным приложением, которое вы загрузите и запустите локально после успешного развертывания. Вы найдете инструкции по загрузке и установке этого приложения на панели свойств при выборе первого узла, который на схеме шаблонов решений называется генератором данных диагностического обслуживания. Это приложение передает [концентратору событий Azure](#azure-event-hub) точки данных или события, которые будут использоваться в оставшейся части потока решения. Этот источник данных состоит или извлекается из общедоступных данных из [репозитория данных NASA](http://ti.arc.nasa.gov/tech/dash/pcoe/prognostic-data-repository/) с помощью [набора данных для симуляции деградации турбореактивного двигателя](http://ti.arc.nasa.gov/tech/dash/pcoe/prognostic-data-repository/#turbofan).

Приложение для создания событий будет заполнять концентратор событий Azure только при выполнении на компьютере.

### Концентратор событий Azure

Служба [Концентратор событий Azure](https://azure.microsoft.com/services/event-hubs/) является получателем входных данных, предоставленных искусственным источником данных, описанным выше.

## **Подготовка и анализ данных**


### Azure Stream Analytics

Служба [Azure Stream Analytics](https://azure.microsoft.com/services/stream-analytics/) используется для предоставления аналитики практически в режиме реального времени для входного потока службы [Концентратор событий Azure](#azure-event-hub) и публикации результатов на панели мониторинга [Power BI](https://powerbi.microsoft.com), а также для архивирования всех входящих событий службы [Хранилище Azure](https://azure.microsoft.com/services/storage/) для последующей обработки службой [Фабрика данных Azure](https://azure.microsoft.com/documentation/services/data-factory/).

### Пользовательская агрегация HD Insights

Служба Azure HD Insight используется для запуска сценариев [Hive](http://blogs.msdn.com/b/bigdatasupport/archive/2013/11/11/get-started-with-hive-on-hdinsight.aspx) (оркестрация с помощью фабрики данных Azure) и предоставления сводных данных необработанных событий, которые были заархивированы с помощью службы Azure Stream Analytics.

### Машинное обучение Azure

Служба [Машинное обучение Azure](https://azure.microsoft.com/services/machine-learning/) используется (оркестрация с помощью фабрики данных Azure) для создания прогнозов на оставшийся период эксплуатации (RUL) конкретного двигателя самолета с учетом полученных входных данных.

## **Публикация данных**


### Служба базы данных SQL Azure

Служба [База данных SQL Azure](https://azure.microsoft.com/services/sql-database/) используется для хранения (управляется фабрикой данных Azure) прогнозов, полученных службой машинного обучения Azure, которая будет использоваться на панели мониторинга [Power BI](https://powerbi.microsoft.com).

## **Использование данных**

### Power BI

Служба [Power BI](https://powerbi.microsoft.com) используется для отображения панели мониторинга, которая содержит сводные данные и предупреждения, предоставляемые службой [Azure Stream Analytics](https://azure.microsoft.com/services/stream-analytics/), а также прогнозов сроков эксплуатации, хранящихся в [базе данных SQL Azure](https://azure.microsoft.com/services/sql-database/) и полученных с помощью службы [машинного обучения Azure](https://azure.microsoft.com/services/machine-learning/). Инструкции по созданию панели мониторинга Power BI для этого шаблона решения приведены в следующем разделе.

## **Способы добавления собственных данных**

В этом разделе описывается, как внести свои данные в Azure и какие области потребуют изменения в случае данных, которые вы добавляете в эту архитектуру.

Маловероятно, что любой добавленный вами набор данных будет соответствовать [набору данных для симуляции деградации турбореактивного двигателя](http://ti.arc.nasa.gov/tech/dash/pcoe/prognostic-data-repository/#turbofan), используемому в этом шаблоне решения. Понимание данных и требований очень важно для того, чтобы изменить этот шаблон для работы с собственными данными. Если это ваш первый опыт работы со службой машинного обучения Azure, введение к ней можно получить с помощью примера в разделе [Создание первого эксперимента](machine-learning-create-experiment.md).

В следующих разделах описываются части шаблона, которые потребуется изменить, когда появится новый набор данных.

### Концентратор событий Azure

Служба концентратора событий Azure весьма универсальна, поэтому данные можно внести в концентратор в формате CSV или JSON. В концентраторе событий Azure никакой специальной обработки не происходит, но важно понимать суть поступающих в него данных.

В этом документе не рассматривается способ ввода данных, но вы легко можете отправлять события или данные в концентратор событий Azure с помощью API концентратора событий.

### Azure Stream Analytics

Служба Azure Stream Analytics используется для обеспечения аналитики практически в режиме реального времени путем чтения из потоков данных и вывода данных в любое количество источников.

В случае шаблона решения для прогнозируемого обслуживания в аэрокосмических компаниях запрос Azure Stream Analytics состоит из четырех вложенных запросов, каждый из которых потребляет события из концентратора событий Azure и записывает выходные данные в четыре различных места. Эти выходные данные состоят из трех наборов данных Power BI и одного места хранения Azure.

Чтобы найти запрос Azure Stream Analytics, необходимо сделать следующее.

-   Войти на портал Azure

-   Найти задания Stream Analytics ![](media\cortana-analytics-technical-guide-predictive-maintenance\icon-stream-analytics.png), созданные при развертывании решения (*например* **maintenancesa02asapbi** и **maintenancesa02asablob** в случае решения для прогнозируемого обслуживания)

-   Выбрать

    -   ***INPUTS*** для просмотра входных данных запроса

    -   ***QUERY*** для просмотра самого запроса

    -   ***OUTPUTS*** для просмотра разных выходных данных

Сведения о построении запросов Azure Stream Analytics можно найти в [справочнике по запросам Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx) на сайте MSDN.

В этом решении запросы выводят три набора данных с собранной практически в режиме реального времени аналитической информацией о потоках входящих данных на панель мониторинга Power BI, которая предоставляется как часть этого шаблона решения. Поскольку есть неявные сведения о формате входящих данных, эти запросы потребуется изменить в зависимости от вашего формата данных.

Запрос во втором задании Stream Analytics **maintenancesa02asablob** просто выводит все события [концентратора событий](https://azure.microsoft.com/services/event-hubs/) в [хранилище Azure](https://azure.microsoft.com/services/storage/) и поэтому не требует изменения вне зависимости от вашего формата данных, так как все данные о событии передаются в хранилище.

### Фабрика данных Azure

Служба [Фабрика данных Azure](https://azure.microsoft.com/documentation/services/data-factory/) управляет перемещением и обработкой данных. В шаблоне решения для прогнозируемого обслуживания в аэрокосмических компаниях фабрика данных состоит из трех [конвейеров](../data-factory/data-factory-create-pipelines.md) для перемещения и обработки данных с помощью различных технологий. Чтобы получить доступ к своей фабрике данных, необходимо открыть узел фабрики данных в нижней части на схеме шаблона решения, созданной в ходе развертывания решения. Откроется фабрика данных на портале Azure. При появлении ошибок в наборах данных можно пропустить их, так как они возникают из-за фабрики данных, развернутой до запуска генератора данных. Эти ошибки не мешают работе фабрики данных.

![](media/cortana-analytics-technical-guide-predictive-maintenance/data-factory-dataset-error.png)

В этом разделе рассматриваются необходимые [конвейеры](../data-factory/data-factory-create-pipelines.md) и [действия](../data-factory/data-factory-create-pipelines.md) в [фабрике данных Azure](https://azure.microsoft.com/documentation/services/data-factory/). Ниже представлена схема решения.

![](media/cortana-analytics-technical-guide-predictive-maintenance/azure-data-factory.png)

Два конвейера этой фабрики содержат сценарии [Hive](http://blogs.msdn.com/b/bigdatasupport/archive/2013/11/11/get-started-with-hive-on-hdinsight.aspx), которые используются для секционирования и агрегирования данных. Если указано, сценарии будут находиться в учетной записи [хранения Azure](https://azure.microsoft.com/services/storage/), созданной во время установки. Их расположение: maintenancesascript\\\script\\\hive\\\ (или имя решения https://[Your].blob.core.windows.net/maintenancesascript).

Аналогично запросам [Azure Stream Analytics](#azure-stream-analytics-1) сценарии [Hive](http://blogs.msdn.com/b/bigdatasupport/archive/2013/11/11/get-started-with-hive-on-hdinsight.aspx) имеют неявные сведения о формате входящих данных. Эти запросы потребуется изменить в зависимости от вашего формата данных и требований [проектирования характеристик](machine-learning-feature-selection-and-engineering.md) .

#### *AggregateFlightInfoPipeline*

Этот [конвейер](../data-factory/data-factory-create-pipelines.md) содержит одно действие — действие [HDInsightHive](../data-factory/data-factory-hive-activity.md) с использованием службы [HDInsightLinkedService](https://msdn.microsoft.com/library/azure/dn893526.aspx), которая выполняет сценарий [Hive](http://blogs.msdn.com/b/bigdatasupport/archive/2013/11/11/get-started-with-hive-on-hdinsight.aspx) для секционирования данных в [хранилище Azure](https://azure.microsoft.com/services/storage/) во время задания [Azure Stream Analytics](https://azure.microsoft.com/services/stream-analytics/).

Сценарий [Hive](http://blogs.msdn.com/b/bigdatasupport/archive/2013/11/11/get-started-with-hive-on-hdinsight.aspx) для этой задачи секционирования — ***AggregateFlightInfo.hql***

#### *MLScoringPipeline*

Этот [конвейер](../data-factory/data-factory-create-pipelines.md) содержит несколько действий, и его конечным результатом является оцененный прогноз из эксперимента [машинного обучения Azure](https://azure.microsoft.com/services/machine-learning/), связанного с этим шаблоном решения.

Ниже перечислены действия, которые содержатся в этом конвейере.

-   Действие [HDInsightHive](../data-factory/data-factory-hive-activity.md) с использованием службы [HDInsightLinkedService](https://msdn.microsoft.com/library/azure/dn893526.aspx), которая выполняет сценарий [Hive](http://blogs.msdn.com/b/bigdatasupport/archive/2013/11/11/get-started-with-hive-on-hdinsight.aspx) для агрегирования и проектирования характеристик, необходимых для эксперимента [машинного обучения Azure](https://azure.microsoft.com/services/machine-learning/). Сценарий [Hive](http://blogs.msdn.com/b/bigdatasupport/archive/2013/11/11/get-started-with-hive-on-hdinsight.aspx) для этой задачи секционирования — ***PrepareMLInput.hql***.

-   Действие [Copy](https://msdn.microsoft.com/library/azure/dn835035.aspx), которое перемещает результаты действия [HDInsightHive](../data-factory/data-factory-hive-activity.md) в единое [хранилище BLOB-объектов Azure](https://azure.microsoft.com/services/storage/), к которому может получить доступ действие [AzureMLBatchScoring](https://msdn.microsoft.com/library/azure/dn894009.aspx).

-   Действие [AzureMLBatchScoring](https://msdn.microsoft.com/library/azure/dn894009.aspx), которое вызывает эксперимент [машинного обучения Azure](https://azure.microsoft.com/services/machine-learning/), приводящий к результатам , размещаемым в одном BLOB-объекте [хранилища Azure](https://azure.microsoft.com/services/storage/).

#### *CopyScoredResultPipeline*

Этот [конвейер](../data-factory/data-factory-create-pipelines.md) содержит одно действие — действие [Copy](https://msdn.microsoft.com/library/azure/dn835035.aspx), которое перемещает результаты эксперимента [машинного обучения Azure](#azure-machine-learning) из ***MLScoringPipeline*** в [базу данных SQL Azure](https://azure.microsoft.com/services/sql-database/), которая была создана в процессе установки шаблона решений.

### Машинное обучение Azure

Эксперимент [машинного обучения Azure](https://azure.microsoft.com/services/machine-learning/), используемый для этого шаблона решения, предоставляет оставшийся период эксплуатации двигателя самолета. Эксперимент относится к потребляемому набору данных и поэтому потребует изменения или замены в зависимости от вводимых данных.

Сведения о создании эксперимента машинного обучения Azure см. в разделе [Прогнозируемое обслуживание: шаг 1 из 3, подготовка данных и проектирование характеристик](http://gallery.cortanaanalytics.com/Experiment/Predictive-Maintenance-Step-1-of-3-data-preparation-and-feature-engineering-2).

## **Отслеживание хода выполнения**
 После запуска генератора данных начинается расконсервация конвейера, и различные компоненты решения вводят в действие следующие команды, выданные фабрикой данных. Существует два способа мониторинга конвейера.

1. Одно из заданий Stream Analytics записывает необработанные входные данные в хранилище BLOB-объектов. После щелчка компонента "Хранилище BLOB-объектов" решения на экране, где успешно развернуто решение, и нажатия кнопки "Открыть" на правой панели откроется [портал управления](https://portal.azure.com/). На портале щелкните "BLOB-объекты". На следующей панели появится список контейнеров. Щелкните **maintenancesadata**. На следующей панели появится папка **rawdata**. В папке rawdata вы hour=17, hour=18 и т. д. Если вы видите эти папки, это значит, что на вашем компьютере успешно формируются необработанные данные, которые затем сохраняются в хранилище BLOB-объектов. Вы должны увидеть CSV-файлы, которые должны иметь в этих папках ограничение по размерам (в МБ).

2. На последнем шаге конвейера выполняется запись данных (например, прогнозов из системы машинного обучения) в базу данных SQL. Появление данных в базе данных SQL может занять не более трех часов. Одним из способов мониторинга объема данных, доступных в базе данных SQL, является использование [портала Azure](https://manage.windowsazure.com/). На левой панели найдите компонент "Базы данных SQL" ![](media\cortana-analytics-technical-guide-predictive-maintenance\icon-SQL-databases.png) и щелкните его. Затем найдите базу данных **pmaintenancedb** и щелкните ее. На следующей странице в нижней части щелкните "УПРАВЛЕНИЕ"

	![](media\cortana-analytics-technical-guide-predictive-maintenance\icon-manage.png).

	Здесь можно щелкнуть "Создать запрос" и создать запрос на количество строк (например, select count(*) из PMResult). По мере роста базы данных количество строк в таблице должно увеличиваться.


## **Панель мониторинга Power BI**

### Обзор

В этом разделе описывается настройка панели мониторинга Power BI для визуализации данных реального времени из Azure Stream Analytics (горячий путь), а также результатов прогноза пакета машинного обучения Azure (холодный путь).

### Настройка холодного пути панели мониторинга

В случае конвейера данных холодного пути основной целью является получение прогнозируемого оставшегося срока эксплуатации каждого двигателя самолета после завершения рейса (цикла). Результат прогноза обновляется каждые 3 часа для оценки двигателя самолета, который завершил рейс за последние 3 часа.

Power BI подключается к базе данных Azure SQL в качестве источника данных, где хранятся результаты прогноза. Примечание. 1) При развертывании решения реальный прогноз будет отображаться в базе данных в течение 3 часов. PBIX-файл, поставляемый с загрузкой генератора, содержит некоторые начальные данные, поэтому можно сразу создать панель мониторинга Power BI. 2) На этом шаге необходимо скачать и установить бесплатное программное обеспечение [Power BI Desktop](https://powerbi.microsoft.com/documentation/powerbi-desktop-get-the-desktop/).

Следующие шаги помогут вам подключить PBIX-файл к базе данных SQL, которая развертывается во время развертывания решения, содержащего данные (*например* результаты прогноза) для визуализации.

1.  Получите учетные данные базы данных.

    Прежде чем перейти к следующим действиям, вам потребуются **имя сервера базы данных, имя базы данных, имя пользователя и пароль**. Ниже приведены шаги, которые помогут вам их найти.

    -   Когда **База данных SQL Azure** на схеме шаблона решения станет зеленой, щелкните ее и нажмите кнопку **Открыть**.

    -   Появится новая вкладка или окно браузера со страницей портала Azure. Щелкните **Группы ресурсов** на левой панели.

    -   Выберите подписку, которую вы используете для развертывания решения, а затем — **YourSolutionName\_ResourceGroup**.

    -   На новой всплывающей панели щелкните значок ![](media\cortana-analytics-technical-guide-predictive-maintenance\icon-sql.png) для доступа к базе данных. Имя базы данных отображается рядом с этим значком (*например* **pmaintenancedb**), а **имя сервера базы данных** указано в свойстве имени сервера и будет выглядеть аналогично **YourSoutionName.database.windows.net**.

	-   Параметры **username** и **password** соответствуют имени пользователя и паролю, ранее записанным во время развертывания решения.

2.  Обновите источник данных файла отчета холодного пути с помощью Power BI Desktop.

    -   В папке вашего компьютера, в которую был скачан и распакован файл генератора, дважды щелкните файл **PowerBI\\PredictiveMaintenanceAerospace.pbix**. Если вы видите какие-либо предупреждающие сообщения при открытии файла, их можно пропустить. В верхней части файла нажмите кнопку **Запросы на изменение**.

	    ![](media\cortana-analytics-technical-guide-predictive-maintenance\edit-queries.png)

	-	Вы увидите две таблицы — **RemainingUsefulLife** и **PMResult**. Выберите первую таблицу и щелкните ![](media\cortana-analytics-technical-guide-predictive-maintenance\icon-query-settings.png) рядом с пунктом **Источник** в разделе **ПРИМЕНЕННЫЕ ДЕЙСТВИЯ** на правой панели **Параметры запроса**. Игнорируйте все предупреждающие сообщения, которые отображаются.

    -   Во всплывающем окне замените **Сервер** и **База данных** на собственные имена сервера и базы данных и нажмите кнопку **ОК**. Убедитесь, что для имени сервера указан порт 1433 (**YourSoutionName.database.windows.net, 1433**). В поле базы данных оставьте **pmaintenancedb**. Игнорируйте предупреждения, которые отображаются на экране.

    -   В следующем всплывающем окне вы увидите два варианта на левой панели (**Windows** и **База данных**). Щелкните **База данных**, введите свое **Имя пользователя** и **Пароль** (это имя пользователя и пароль, введенные при первом развертывании решения и создании базы данных Azure SQL). В разделе ***Выбор уровня для применения этих параметров*** выберите уровень базы данных. Щелкните **Подключить**.

    -   Щелкните вторую таблицу **PMResult**, щелкните ![](media\cortana-analytics-technical-guide-predictive-maintenance\icon-navigation.png) рядом с пунктом **Источник** в разделе **ПРИМЕНЕННЫЕ ДЕЙСТВИЯ** на правой панели **Параметры запроса** и измените имена сервера и базы данных, как в описанных выше шагах, а затем нажмите кнопку "ОК".

    -   Когда вы будете направлены на предыдущую страницу, закройте окно. В появившемся сообщении нажмите кнопку **Применить**. Наконец, нажмите кнопку **Сохранить**, чтобы сохранить изменения. Теперь файл Power BI установил подключение к серверу. Если представления пусты, убедитесь, что очистили выбранные элементы для визуализации, чтобы отобразить все данные, щелкнув значок резинки в правом верхнем углу условных обозначений. Используйте кнопку "Обновить" для отображения новых данных в представлении. Сначала вы увидите в представлениях только начальные данные, так как фабрика данных обновляется каждые 3 часа. Через 3 часа вы увидите в представлении новые прогнозы при обновлении данных.

3.  (Необязательно) Опубликуйте панель мониторинга холодного пути в [Power BI Online](http://www.powerbi.com/). Обратите внимание, что этот шаг требует учетной записи Power BI (или учетной записи Office 365).

    -   Щелкните **Опубликовать**, и через несколько секунд откроется окно "Публикация Power BI прошла успешно!" с зеленой галочкой. Щелкните ссылку "Открыть PredictiveMaintenanceAerospace.pbix в Power BI". Подробные инструкции см. в разделе [Публикация из Power BI Desktop](https://support.powerbi.com/knowledgebase/articles/461278-publish-from-power-bi-desktop).

    -   Для создания новой панели мониторинга щелкните знак **+** рядом с разделом **Панель мониторинга** на левой панели. Введите имя "Демонстрация прогнозируемого обслуживания" для этой новой панели мониторинга.

    -   После открытия отчета нажмите кнопку ![](media\cortana-analytics-technical-guide-predictive-maintenance\icon-pin.png), чтобы закрепить все представления на панели мониторинга. Подробные инструкции см. в разделе [Закрепление плитки на панели мониторинга Power BI из отчета](https://support.powerbi.com/knowledgebase/articles/430323-pin-a-tile-to-a-power-bi-dashboard-from-a-report). Перейдите на страницу панели мониторинга и измените размер и расположение представлений, а также отредактируйте их заголовки. Подробные инструкции по изменению плиток см. в разделе [Редактирование плитки — изменение размера, перемещение, переименование, закрепление, удаление, добавление гиперссылки](https://powerbi.microsoft.com/documentation/powerbi-service-edit-a-tile-in-a-dashboard/#rename). Ниже приведен пример панели мониторинга с представлениями холодного пути, прикрепленными к ней. В зависимости от того, как долго работает ваш генератор данных, эти номера на представлениях могут быть различными. <br/> ![](media\cortana-analytics-technical-guide-predictive-maintenance\final-view.png) <br/>
    -   Чтобы запланировать обновление данных, наведите указатель мыши на набор данных **PredictiveMaintenanceAerospace**, щелкните ![](media\cortana-analytics-technical-guide-predictive-maintenance\icon-elipsis.png) и выберите **Запланировать обновление**. <br/> **Примечание.** При появлении предупреждения нажмите кнопку **Изменить учетные данные** и убедитесь, что учетные данные базы данных являются такими же, как описано в шаге 1. <br/> ![](media\cortana-analytics-technical-guide-predictive-maintenance\schedule-refresh.png) <br/>
    -   Разверните раздел **Запланировать обновление**. Включите параметр "Поддерживать актуальность данных". <br/>
    -   Запланируйте обновления в зависимости от потребностей. Дополнительные сведения см. в разделе [Обновление данных в Power BI](https://support.powerbi.com/knowledgebase/articles/474669-data-refresh-in-power-bi).

### Настройка панели мониторинга горячего пути

Следующее пошаговое руководстве поможет вам реализовать визуализацию в реальном времени выходных данных заданий Stream Analytics, созданных во время развертывания решения. Для выполнения следующих действий требуется учетная запись [Power BI Online](http://www.powerbi.com/). Если у вас нет учетной записи, вы можете [создать ее](https://powerbi.microsoft.com/pricing).

1.  Добавьте выходные данные Power BI в Azure Stream Analytics (ASA).

    -  Чтобы настроить выходные данные задания Azure Stream Analytics в качестве панели мониторинга Power BI, следуйте инструкциям, приведенным в разделе [Azure Stream Analytics и Power BI: панель мониторинга аналитики в режиме реального времени для просмотра потоковой передачи данных в реальном времени](stream-analytics-power-bi-dashboard.md).
	- Настройте три варианта выходных данных запроса ASA: **aircraftmonitor**, **aircraftalert** и **flightsbyhour**. Запрос можно просмотреть, щелкнув вкладку запроса. Согласно каждой из этих таблиц потребуется добавить выходные данные в ASA. При добавлении первых выходных данных (*например* **aircraftmonitor**) убедитесь, что **Псевдоним выходных данных**, **Имя набора данных** и **Имя таблицы** такие же (**aircraftmonitor**). Повторите шаги, чтобы добавить выходные данные для **aircraftalert** и **flightsbyhour**. После добавления всех трех таблиц выходных данных и запуска задания ASA вы должны получить сообщение с подтверждением (*например* "Успешный запуск задания Stream Analytics maintenancesa02asapbi").

2. Войдите в [Power BI Online](http://www.powerbi.com).

    -   На левой панели раздела "Наборы данных" в области "Моя рабочая область" должны отображаться имена **aircraftmonitor**, **aircraftalert** и **flightsbyhour** ***НАБОРА ДАННЫХ***. Это потоковые данные, переданные из Azure Stream Analytics на предыдущем шаге. Набор данных **flightsbyhour** может не отображаться одновременно с другими двумя наборами из-за характера связанного SQL-запроса. Однако он должен появиться через час.
    -   Убедитесь, что область ***Визуализации*** открыта и отображается в правой части экрана.

3. После получения данных, поступающих в Power BI, можно начать визуализацию потоковых данных. Ниже приведен пример панели мониторинга с визуализациями горячего пути, прикрепленными к ней. На основе соответствующих наборов данных можно создать другие плитки панели мониторинга. В зависимости от того, как долго работает ваш генератор данных, на визуализациях могут отображаться другие значения.


    ![](media\cortana-analytics-technical-guide-predictive-maintenance\dashboard-view.png)

4. Ниже приведен ряд действий по созданию одной из приведенных выше плиток — "Fleet View of Sensor 11 vs Threshold 48.26":

    -   Щелкните набор данных **aircraftmonitor** на левой панели раздела "Наборы данных".

    -   Щелкните значок **График**.

    -   Щелкните **Обработанные** в области **Поля**, чтобы они отображались в разделе "Ось" области **Визуализации**.

    -   Нажмите кнопку "s11" и "s11\_alert", чтобы они отображались в группе "Значения". Щелкните маленькую стрелку рядом с **s11** и **s11\_alert**, измените "Сумма" на "Среднее".

    -   В верхней части нажмите кнопку **Сохранить** сверху и назовите отчет "aircraftmonitor". Отчет с именем "aircraftmonitor" будет отображаться в разделе **Отчеты** в области **навигатора** слева.

    -   Щелкните значок **Закрепить визуальный элемент** в правом верхнем углу этого графика. Может отобразиться окно "ПИН-код для панели мониторинга" для выбора панели мониторинга. Выберите "Демонстрация прогнозируемого обслуживания", а затем нажмите кнопку "Закрепить".

    -   Наведите указатель мыши на эту плитку на панели мониторинга, щелкните значок "изменить" в правом верхнем углу, чтобы изменить ее название на "Fleet View of Sensor 11 vs. Threshold 48.26" и подзаголовок на "Average across fleet over time".

## **Удаление решения**
Убедитесь, что генератор данных остановлен, если решение используется неактивно, так как работа генератора данных связана с высокими расходами. Если вы не используете решение, удалите его. При удалении решения будут удалены все компоненты, подготовленные в подписке при развертывании решения. Чтобы удалить решение, правой кнопкой мыши щелкните имя решения на левой панели шаблона решения и нажмите кнопку "Удалить".

## **Средства для оценки затрат**

Следующие два средства помогут вам лучше оценить общие затраты, задействованные в выполнении шаблона решения для прогнозируемого обслуживания в аэрокосмических компаниях в вашей подписке:

-   [Средство оценки затрат Azure Microsoft (в сети)](https://azure.microsoft.com/pricing/calculator/)

-   [Средство оценки затрат Azure Microsoft (на рабочем столе)](http://www.microsoft.com/download/details.aspx?id=43376)

<!---HONumber=AcomDC_0204_2016-->