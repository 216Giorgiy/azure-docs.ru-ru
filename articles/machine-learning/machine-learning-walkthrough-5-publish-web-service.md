<properties
	pageTitle="Шаг 5. Развертывание веб-службы машинного обучения | Microsoft Azure"
	description="Шаг 5 пошагового руководства по разработке прогностического решения. Развертывание прогностического эксперимента в студии машинного обучения в качестве веб-службы."
	services="machine-learning"
	documentationCenter=""
	authors="garyericson"
	manager="paulettm"
	editor="cgronlun"/>

<tags
	ms.service="machine-learning"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="09/08/2015"
	ms.author="garye"/>


# Шаг 5. Развертывание веб-службы машинного обучения Azure

Это пятый шаг из пошагового руководства [Разработка прогнозирующего решения с помощью Azure ML](machine-learning-walkthrough-develop-predictive-solution.md).


1.	[Создание рабочей области машинного обучения](machine-learning-walkthrough-1-create-ml-workspace.md)
2.	[Отправка существующих данных](machine-learning-walkthrough-2-upload-data.md)
3.	[Создание нового эксперимента](machine-learning-walkthrough-3-create-new-experiment.md)
4.	[Обучение и анализ моделей](machine-learning-walkthrough-4-train-and-evaluate-models.md)
5.	**Развертывание веб-службы**
6.	[Доступ к веб-службе](machine-learning-walkthrough-6-access-web-service.md)

----------

Чтобы эту модель прогнозирования могли использовать другие пользователи, мы развернем ее как веб-сервис на Azure.

Вплоть до этого момента мы экспериментировали с обучением нашей модели. Но развернутая служба больше не будет выполнять обучение — она будет создавать прогнозы на основе ввода пользователя. Поэтому мы выполним определенную подготовку, а затем развернем этот эксперимент как доступную пользователям рабочую веб-службу. Пользователи смогут отправлять службе набор данных по заявке на кредит, а служба будет возвращать прогноз рисков по кредиту.

Для этого необходимо выполнить следующие действия:

- Преобразование *обучающего эксперимента* в *прогностический эксперимент*
- Развертывание прогностического эксперимента в качестве веб-службы

Но сначала необходимо немного усечь этот эксперимент. В настоящее время у нас в эксперименте две различные модели, но для развертывания нужно выбрать одну модель.

Допустим, мы решили, что нам лучше подходит модель ускоренного дерева. Поэтому сначала мы удалим модуль [Двухклассовая машина опорных векторов][two-class-support-vector-machine] и модули, которые использовались для его обучения. Сначала создайте копию эксперимента, нажав кнопку **Сохранить как** в нижней части полотна эксперимента.

Необходимо удалить следующие модули:

1.	[Двухклассовая машина опорных векторов][two-class-support-vector-machine];
2.	модули [Обучение модели][train-model] и [Оценка модели][score-model], которые были к нему подключены;
3.	[Нормализовать данные][normalize-data] (оба варианта);
4.	[Модель оценки][evaluate-model].

Теперь мы готовы к развертыванию модели.

## Преобразование обучающего эксперимента в прогностический эксперимент

Преобразование в прогностический эксперимент состоит из трех этапов:

1. сохранение обученной модели и замена обучающих модулей;
2. удаление из эксперимента модулей, которые были необходимы только для обучения;
3. определение расположения входных и выходных узлов веб-службы.

К счастью, можно выполнить все три шага, просто нажав **Развернуть веб-службу** в нижней части области эксперимента (см. параметр **Прогностическая веб-служба**).

При нажатии кнопки **Развернуть веб-службу** происходит следующее.

- Обученная нами модель сохраняется как модуль **Обученная модель** в палитре модулей слева от полотна эксперимента (ее можно найти в палитре в разделе **Обученные модели**).
- Модули, которые мы использовали для обучения, удаляются. В частности:
  - [Двухклассовое увеличивающееся дерево принятия решений][two-class-boosted-decision-tree];
  - [Модель обучения][train-model];
  - [Разделение][split];
  - второй модуль [Выполнить скрипт R][execute-r-script], который был использован для тестовых данных.
- Сохраненная обученная модель добавляется в эксперимент.
- Добавляются модули **Входные данные веб-службы** и **Выходные данные веб-службы**.

> [AZURE.NOTE]Эксперимент был сохранен в двух частях: исходный обучающий эксперимент и новый прогностический эксперимент. Можно открыть любой из них с помощью вкладок в верхней части полотна эксперимента.

Нам нужно выполнить дополнительные действия с экспериментом. Студия машинного обучения удалила один модуль [Выполнить скрипт R][execute-r-script] при удалении модуля [Разделение][split], но оставила другой модуль [Выполнить скрипт R][execute-r-script]. Поскольку этот модуль используется только для обучения и проверки (он предоставляет функцию взвешивание образца данных), теперь мы можем удалить его и подключить [редактор метаданных][metadata-editor] к модулю [Оценка модели][score-model].

Теперь наш эксперимент должен выглядеть следующим образом:

![Оценка обученной модели][4]


Возможно, вас удивляет, почему мы оставили набор данных UCI German Credit Card Data в прогностическом эксперименте. Служба будет использовать данные пользователя, а не изначальный набор данных — так зачем оставлять их неподключенными?

Действительно, службе не нужны исходные данные кредитных карт. Но по-прежнему нужна схема для этих данных, включающая такие сведения, как общее число столбцов, а также какие столбцы являются числовыми. Эти данные схемы необходимы для интерпретации пользовательских данных. Мы оставили эти компоненты подключенными, чтобы модуль оценки имел схему набора данных при запуске службы. Данные не используются, используется только схема.

Запустите эксперимент в последний раз (нажмите **Выполнить**). Чтобы убедиться в том, что модуль по-прежнему работает, щелкните по выходным данным модуля [Оценка модели][score-model] и выберите **Показать результаты**. Вы увидите, что изначальные данные отображаются вместе со значением кредитного риска ("Расчетные метки") и оценочным значением вероятности ("Расчетные вероятности").

##
Развертывание веб-службы

Чтобы развернуть веб-службу, полученную из нашего эксперимента, нажмите кнопку **Развернуть веб-службу**, расположенную под областью эксперимента. Студия машинного обучения развернет эксперимент как веб-службу и откроет панель мониторинга службы.

> [AZURE.TIP]После развертывания веб-службы ее можно обновить. Например, если требуется скорректировать модель, просто измените обучающий эксперимент, настройте параметры модели и нажмите кнопку **Развернуть веб-службу**. При повторном развертывании эксперимента он заменит веб-службу, используя на этот раз обновленную модель.

Службу можно настраивать на вкладке **КОНФИГУРАЦИЯ**. На этой вкладке можно изменить имя службы (по умолчанию она получает имя эксперимента) и предоставить ее описание. Можно также задать более удобочитаемые названия для входных и выходных столбцов.

## Тестирование веб-службы
На странице **ПАНЕЛЬ МОНИТОРИНГА** щелкните ссылку **Тестирование** в разделе **Конечная точка по умолчанию**. Появится диалоговое окно, где предлагается ввести входные данные для службы. Это те же столбцы, которые были в изначальном наборе данных по кредитным рискам для немецкого языка.

Введите набор данных и нажмите кнопку **ОК**.

Результаты, созданные веб-службой, отображаются внизу панели мониторинга. Заданная конфигурация службы привела к тому, что результаты сгенерированы модулем оценки.


----------

**Далее: [доступ к веб-службе](machine-learning-walkthrough-6-access-web-service.md)**

[1]: ./media/machine-learning-walkthrough-5-publish-web-service/publish1.png
[2]: ./media/machine-learning-walkthrough-5-publish-web-service/publish2.png
[3]: ./media/machine-learning-walkthrough-5-publish-web-service/publish3.png
[4]: ./media/machine-learning-walkthrough-5-publish-web-service/publish4.png


<!-- Module References -->
[evaluate-model]: https://msdn.microsoft.com/library/azure/927d65ac-3b50-4694-9903-20f6c1672089/
[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/
[metadata-editor]: https://msdn.microsoft.com/library/azure/370b6676-c11c-486f-bf73-35349f842a66/
[normalize-data]: https://msdn.microsoft.com/library/azure/986df333-6748-4b85-923d-871df70d6aaf/
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/
[split]: https://msdn.microsoft.com/library/azure/70530644-c97a-4ab6-85f7-88bf30a8be5f/
[train-model]: https://msdn.microsoft.com/library/azure/5cc7053e-aa30-450d-96c0-dae4be720977/
[two-class-boosted-decision-tree]: https://msdn.microsoft.com/library/azure/e3c522f8-53d9-4829-8ea4-5c6a6b75330c/
[two-class-support-vector-machine]: https://msdn.microsoft.com/library/azure/12d8479b-74b4-4e67-b8de-d32867380e20/

<!----HONumber=Sept15_HO2-->