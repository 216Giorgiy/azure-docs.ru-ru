<properties
    pageTitle="Шаг 5. Развертывание веб-службы машинного обучения | Microsoft Azure"
    description="Шаг 5 пошагового руководства по разработке прогнозного решения. Развертывание прогнозного эксперимента в студии машинного обучения в качестве веб-службы."
    services="machine-learning"
    documentationCenter=""
    authors="garyericson"
    manager="jhubbard"
    editor="cgronlun"/>

<tags
    ms.service="machine-learning"
    ms.workload="data-services"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/05/2016"
    ms.author="garye"/>



# <a name="walkthrough-step-5:-deploy-the-azure-machine-learning-web-service"></a>Шаг 5. Развертывание веб-службы машинного обучения Azure

Это пятый этап пошагового руководства [Разработка решения для прогнозной аналитики в машинном обучении Azure](machine-learning-walkthrough-develop-predictive-solution.md)


1.  [Создание рабочей области машинного обучения](machine-learning-walkthrough-1-create-ml-workspace.md)
2.  [Отправка существующих данных](machine-learning-walkthrough-2-upload-data.md)
3.  [Создание нового эксперимента](machine-learning-walkthrough-3-create-new-experiment.md)
4.  [Обучение и анализ моделей](machine-learning-walkthrough-4-train-and-evaluate-models.md)
5.  **Развертывание веб-службы**
6.  [Доступ к веб-службе](machine-learning-walkthrough-6-access-web-service.md)

----------

Мы разработали это руководство, чтобы другие смогли воспользоваться прогнозной моделью. Мы развернем ее как веб-службу в Azure.

Вплоть до этого момента мы экспериментировали с обучением нашей модели. Но развернутая служба больше не будет выполнять обучение — она создает прогнозы на основе оценки пользовательского ввода на основе нашей модели. Поэтому мы собираемся выполнить некоторую подготовку для преобразования этого эксперимента из ***обучающего*** в ***прогнозный***. 

Этот процесс состоит из двух этапов.  

1. Преобразование *обучающего эксперимента* в *прогнозный эксперимент*
2. Развертывание прогнозного эксперимента в качестве веб-службы

Но сначала необходимо немного усечь этот эксперимент. В настоящее время в эксперименте есть две различные модели. Но для развертывания нужно выбрать одну модель, которую мы хотим развернуть в качестве веб-службы.  

Допустим, мы решили, что нам лучше подходит модель градиентного бустинга деревьев. Поэтому сначала мы удалим модуль [Двухклассовая машина опорных векторов][two-class-support-vector-machine] и модули, которые использовались для его обучения. Сначала создайте копию эксперимента, нажав кнопку **Сохранить как** в нижней части полотна эксперимента.

Необходимо удалить следующие модули:  

- [Двухклассовая машина опорных векторов][two-class-support-vector-machine]
- Модули [Обучение модели][train-model] и [Оценка модели][score-model], которые были к нему подключены
- [Нормализация данных][normalize-data] (оба варианта)
- [Анализ модели][evaluate-model]

Выберите модуль и нажмите клавишу Delete или щелкните модуль правой кнопкой мыши и выберите **Удалить**.

Теперь мы готовы к развертыванию этой модели с помощью [двухклассового повышенного дерева принятия решений][two-class-boosted-decision-tree].

## <a name="convert-the-training-experiment-to-a-predictive-experiment"></a>Преобразование обучающего эксперимента в прогностический эксперимент

Преобразование в прогностический эксперимент состоит из трех этапов:

1. Сохраните обученную модуль и замените обучающие модули.
2. удаление из эксперимента модулей, которые были необходимы только для обучения;
3. Укажите, где веб-служба будет принимать входные данные и где формировать выходные данные.

К счастью, можно выполнить все три шага, щелкнув **Set Up Web Service** (Настроить веб-службу) в нижней части области эксперимента (см. параметр **Predictive Web Service** (Прогнозная веб-служба)).

При щелчке **Set Up Web Service** (Настроить веб-службу) происходит следующее.

- Обученная нами модель сохраняется как одиночный модуль **Обученная модель** в палитре модулей слева от холста эксперимента (ее можно найти в палитре в разделе **Обученные модели**).
- Модули, которые мы использовали для обучения, удаляются. В частности:
  - [Двухклассовое повышенное дерево принятия решений][two-class-boosted-decision-tree];
  - [Обучение модели][train-model];
  - [Разделение данных][split];
  - второй модуль [Выполнение скрипта R][execute-r-script], который был использован для тестовых данных.
- Сохраненная обученная модель добавляется обратно в эксперимент.
- Добавляются модули **Входные данные веб-службы** и **Выходные данные веб-службы**.

> [AZURE.NOTE] Эксперимент был сохранен в виде двух частей на вкладках, которые были добавлены в верхней части холста эксперимента: исходный обучающий эксперимент — на вкладке **Обучающий эксперимент**, а только что созданный прогнозный эксперимент — на вкладке **Прогнозный эксперимент**.

С этим экспериментом необходимо выполнить одно дополнительное действие.
Мы добавили два модуля [Выполнение скрипта R][execute-r-script], чтобы реализовать функцию взвешивания данных для обучения и тестирования. В конечной модели этого делать не нужно.

Студия машинного обучения удалила один модуль [Выполнение скрипта R][execute-r-script] при удалении модуля [Разделение][split]. Теперь можно удалить другой модуль и подключить [Редактор метаданных][metadata-editor] непосредственно к модулю [Оценка модели][score-model].    

Теперь наш эксперимент должен выглядеть следующим образом:  

![Оценка обученной модели][4]  

> [AZURE.NOTE] Возможно, вас удивляет, почему мы оставили набор данных UCI German Credit Card Data в прогностическом эксперименте. Служба будет использовать данные пользователя, а не изначальный набор данных — так зачем оставлять в модели исходный набор данных?
>
>Действительно, службе не нужны исходные данные кредитных карт. Но по-прежнему нужна схема для этих данных, включающая такие сведения, как общее число столбцов, а также какие столбцы являются числовыми. Эти данные схемы необходимы для интерпретации пользовательских данных. Мы оставили эти компоненты подключенными, чтобы модуль оценки имел схему набора данных при запуске службы. Данные не используются, используется только схема.  

Запустите эксперимент в последний раз (нажмите **Выполнить**). Чтобы убедиться в том, что модуль по-прежнему работает, щелкните выходные данные модуля [Оценка модели][score-model] и выберите **Показать результаты**. Вы увидите, что изначальные данные отображаются вместе со значением кредитного риска ("Расчетные метки") и оценочным значением вероятности ("Расчетные вероятности"). 

## <a name="deploy-the-web-service"></a>Развертывание веб-службы

Эксперимент можно развернуть в виде классической веб-службы или новой веб-службы на основе Azure Resource Manager.

### <a name="deploy-as-a-classic-web-service"></a>Развертывание в виде классической веб-службы ###

Чтобы развернуть классическую веб-службу, порожденную из нашего эксперимента, щелкните **Deploy Web Service** (Развернуть веб-службу) под холстом и выберите пункт **Deploy Web Service [Classic]** (Развернуть веб-службу [классическую]). Студия машинного обучения развернет эксперимент как веб-службу и откроет панель мониторинга для этой веб-службы. На ней можно вернуться к эксперименту (**View snapshot** (Просмотр снимка) или **View latest** (Просмотр последних)) и выполнить простой тест веб-службы (см. раздел **Тестирование веб-службы** ниже). На этой панели также приведены сведения о создании приложений, которые могут обращаться к веб-службе (дополнительные сведения см. в следующем шаге пошагового руководства).

![Панель мониторинга веб-службы][6]

Службу можно настраивать на вкладке **КОНФИГУРАЦИЯ** . На этой вкладке можно изменить имя службы (по умолчанию она получает имя эксперимента) и предоставить ее описание. Можно также задать более удобочитаемые названия для входных и выходных столбцов.  

![Настройка веб-службы][5]  

### <a name="deploy-as-a-new-web-service"></a>Развертывание в качестве новой веб-службы

Чтобы развернуть новую веб-службу, созданную из нашего эксперимента, щелкните **Deploy Web Service** (Развернуть веб-службу) под холстом и выберите пункт **Deploy Web Service [New]** (Развернуть веб-службу [новую]). Студия машинного обучения откроет страницу развертывания эксперимента в веб-службах машинного обучения Azure.

Введите имя веб-службы и выберите ценовой план. Если у вас уже имеется ценовой план, то можно выбрать его. В противном случае необходимо создать ценовой план для службы. 

1.  Из раскрывающегося списка **Price Plan** (Ценовой план) выберите существующий план или параметр **Select new plan** (Выбрать новый план).
2.  В поле **Имя плана** введите имя для идентификации плана в счете.
3.  Выберите один из вариантов **Monthly Plan Tier**(Уровень ежемесячного плана). По умолчанию указаны уровни плана для вашего региона по умолчанию, и веб-служба развертывается именно в этом регионе.

Щелкните **Deploy** (Развернуть). Откроется **страница быстрого запуска веб-службы**.

Службу можно настроить, щелкнув пункт меню **Configure** (Настроить). На этой вкладке можно изменить имя службы (по умолчанию она получает имя эксперимента) и предоставить ее описание. 

Для тестирования веб-службы выберите пункт меню **Test** (Тестировать) (см. раздел **Тестирование веб-службы** ниже). Чтобы получить сведения о создании приложений, которые могут обращаться к веб-службе, щелкните пункт меню **Consume** (Использовать) (дополнительные сведения см. в следующем шаге данного пошагового руководства).

> [AZURE.TIP] После развертывания веб-службы ее можно обновить. Например, если требуется скорректировать модель, измените обучающий эксперимент, настройте параметры модели и нажмите кнопку **Deploy Web Service** (Развернуть веб-службу). Затем выберите **Deploy Web Service [Classic]** (Развернуть веб-службу [классическую]) или **Deploy Web Service [New]** (Развернуть веб-службу [новую]). При повторном развертывании эксперимента он заменит веб-службу, используя на этот раз обновленную модель.  

## <a name="test-the-web-service"></a>Тестирование веб-службы

### <a name="test-a-classic-web-service"></a>Тестирование классической веб-службы

Службу можно протестировать в студии машинного обучения или на портале веб-служб машинного обучения Azure. Тестирование на портале веб-служб машинного обучения Azure дает преимущество, позволяя включить следующие возможности. 

**Тестирование в студии машинного обучения**

На странице **ПАНЕЛЬ МОНИТОРИНГА** нажмите кнопку **Тестирование** в разделе **Конечная точка по умолчанию**. Появится диалоговое окно, где предлагается ввести входные данные для службы. Это те же столбцы, которые были в исходном немецком наборе данных для кредитного риска.  

Введите набор данных и нажмите кнопку **ОК**. 

**Тестирование на портале веб-служб машинного обучения Azure**

На странице **ПАНЕЛЬ МОНИТОРИНГА** щелкните ссылку предварительной функции **Тестирование** в разделе **Конечная точка по умолчанию**. Откроется тестовая страница на портале веб-служб машинного обучения Azure для конечной точки веб-службы, где будет предложено ввести входные данные для службы. Это те же столбцы, которые были в исходном немецком наборе данных для кредитного риска.

Щелкните **Test Request-Response** (Тестировать "запрос-ответ"). 

Данные в веб-службу поступают через модуль **Web service input** (Входные данные веб-службы), проходят через модуль [Metadata Editor][metadata-editor] (Редактор метаданных) и поступают в модуль [Score Model][score-model] (Оценка модели). Затем результаты выводятся из веб-службы через модуль **Web service output**(Выходные данные веб-службы).

**Тестирование новой веб-службы**

На портале веб-служб машинного обучения Azure щелкните **Test** (Тестировать) в верхней части страницы. Откроется страница **Test** (Тестирование), на которой можно ввести данные для службы. Отображенные поля ввода соответствуют столбцам, которые были в изначальном наборе данных по кредитным рискам для немецкого языка. 

Введите набор данных и щелкните **Test Request-Response**(Тестировать "запрос-ответ").

Результаты теста отобразятся в правой части страницы, в столбце выходных данных. 

При тестировании на портале веб-служб машинного обучения Azure можно включить образец данных, с помощью которого можно протестировать службу "запрос-ответ". Если вы создали веб-службу в студии машинного обучения, то образец данных берется из данных, с помощью которых вы обучали модель.

> [AZURE.TIP] С нашими настройками прогнозного эксперимента возвращаются все результаты из модуля [Score Model][score-model] (Оценка модели). Они включают все входные данные, а также значение кредитного риска и оценку вероятности. Если вы хотите возвращать другие результаты, например только значение кредитного риска, то можно вставить модуль [Project Columns][project-columns] (Столбцы проекта) между модулями [Score Model][score-model] (Оценка модели) и **Web service output** (Выходные данные веб-службы), чтобы исключить столбцы, которые не должны возвращаться веб-службой. 

## <a name="manage-the-web-service"></a>Управление веб-службой

**Управление классической веб-службой**

После развертывания классической веб-службой можно управлять с помощью [классического портала Azure](https://manage.windowsazure.com).

1. Перейдите на [классический портал Azure](https://manage.windowsazure.com).
2. На панели служб Microsoft Azure выберите **МАШИННОЕ ОБУЧЕНИЕ**.
3. Щелкните рабочую область.
4. Щелкните вкладку **Веб-службы** .
5. Щелкните созданную нами веб-службу.
6. Щелкните конечную точку "по умолчанию".

Здесь можно отслеживать работу веб-службы и изменять настройки производительности путем изменения количества одновременных вызовов, которые может обрабатывать веб-служба.
Вы можете даже опубликовать свою веб-службу в Azure Marketplace.

Дополнительные сведения см. в статье

- [Создание конечных точек](machine-learning-create-endpoint.md)
- [Масштабирование веб-службы](machine-learning-scaling-webservice.md)
- [Публикация веб-службы машинного обучения Azure в Azure Marketplace](machine-learning-publish-web-service-to-azure-marketplace.md)

**Управление веб-службой на портале веб-служб машинного обучения Azure**

После развертывания веб-службой (классической или новой) можно управлять с помощью [портала веб-служб машинного обучения Azure](https://servics.azureml.net).

Вот как можно отслеживать производительность веб-службы.

1. Войдите на [портал веб-служб машинного обучения Azure](https://servics.azureml.net).
2. Щелкните **Веб-службы**.
3. Щелкните свою веб-службу.
4. Щелкните **Dashboard**(Панель мониторинга).

----------

**Далее: [доступ к веб-службе](machine-learning-walkthrough-6-access-web-service.md)**

[1]: ./media/machine-learning-walkthrough-5-publish-web-service/publish1.png
[2]: ./media/machine-learning-walkthrough-5-publish-web-service/publish2.png
[3]: ./media/machine-learning-walkthrough-5-publish-web-service/publish3.png
[4]: ./media/machine-learning-walkthrough-5-publish-web-service/publish4.png
[5]: ./media/machine-learning-walkthrough-5-publish-web-service/publish5.png
[6]: ./media/machine-learning-walkthrough-5-publish-web-service/publish6.png


<!-- Module References -->
[evaluate-model]: https://msdn.microsoft.com/library/azure/927d65ac-3b50-4694-9903-20f6c1672089/
[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/
[metadata-editor]: https://msdn.microsoft.com/library/azure/370b6676-c11c-486f-bf73-35349f842a66/
[normalize-data]: https://msdn.microsoft.com/library/azure/986df333-6748-4b85-923d-871df70d6aaf/
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/
[split]: https://msdn.microsoft.com/library/azure/70530644-c97a-4ab6-85f7-88bf30a8be5f/
[train-model]: https://msdn.microsoft.com/library/azure/5cc7053e-aa30-450d-96c0-dae4be720977/
[two-class-boosted-decision-tree]: https://msdn.microsoft.com/library/azure/e3c522f8-53d9-4829-8ea4-5c6a6b75330c/
[two-class-support-vector-machine]: https://msdn.microsoft.com/library/azure/12d8479b-74b4-4e67-b8de-d32867380e20/
[project-columns]: https://msdn.microsoft.com/en-us/library/azure/1ec722fa-b623-4e26-a44e-a50c6d726223/


<!--HONumber=Oct16_HO2-->


