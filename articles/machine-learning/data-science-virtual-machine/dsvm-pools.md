---
title: Пулы виртуальных машин для обработки и анализа данных в Azure | Документы Майкрософт
description: Развертывание пулов виртуальных машин для обработки и анализа данных в качестве общего ресурса для команды.
keywords: deep learning, AI, data science tools, data science virtual machine, geospatial analytics, team data science process
services: machine-learning
documentationcenter: ''
author: gopitk
manager: cgronlun
ms.assetid: ''
ms.service: machine-learning
ms.component: data-science-vm
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2018
ms.author: gokuma
ms.openlocfilehash: 0740ff7542d066442146b8e80e188ad5ba49a2b5
ms.sourcegitcommit: 638599eb548e41f341c54e14b29480ab02655db1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/21/2018
ms.locfileid: "36309404"
---
# <a name="create-a-shared-pool-of-data-science-virtual-machines"></a>Создание общего пула виртуальных машин для обработки и анализа данных

Эта статья описывает, как создать для команды общий пул из виртуальных машин для обработки и анализа данных (DSVM). К преимуществам общего пула относятся более эффективное использование ресурсов, упрощение общего доступа и совместной работы, а также более эффективное управление ресурсами DSVM. 

Для создания пула DSVM можно использовать множество методик и технологий. В этой статье основное внимание уделяется пулам для виртуальных машин пакетной обработки и интерактивных виртуальных машин.

## <a name="batch-processing-pool"></a>Пул пакетной обработки
Если вы хотите настроить пул DSVM главным образом для пакетного выполнения заданий вне сети, то можно использовать службу [Azure Batch AI](https://docs.microsoft.com/azure/batch-ai/) или [пакетную службу Azure](https://docs.microsoft.com/azure/batch/). В этой статье основное внимание уделено Azure Batch AI.

В Azure Batch AI поддерживается образ с выпуском DSVM на основе Ubuntu. При создании кластера Azure Batch AI в Azure CLI или пакете SDK для Python можно указать параметр `image` и присвоить ему значение `UbuntuDSVM`. Можно выбрать тип узлов обработки (экземпляры на основе GPU или только на основе ЦП, количество ЦП, объем памяти) из [широкого набора экземпляров виртуальных машин](https://azure.microsoft.com/pricing/details/virtual-machines/linux/), предлагаемых в Azure. 

При использовании образа DSVM на основе Ubuntu в Batch AI для узлов на основе GPU все необходимые драйверы GPU и платформы для глубинного обучения установлены в образе предварительно. Это значительно экономит время при подготовке узлов пакетной обработки. Фактически, при интерактивной разработке на виртуальных машинах DSVM на основе Ubuntu можно заметить, что параметры и конфигурация узлов Batch AI абсолютно не отличаются от среды. 

Обычно при создании кластера Batch AI вы также создаете общую папку, к которой подключаются все узлы. Эта общая папка используется для ввода и вывода данных, а также для хранения кода/сценариев пакетного задания. 

После создания кластера Batch AI можно использовать тот же интерфейс командной строки или пакет SDK для Python, чтобы отправлять задания для выполнения. Вы платите только за время, затрачиваемое на выполнение пакетных заданий. 

Дополнительные сведения можно найти в разделе 
* Пошаговое руководство по использованию [Azure CLI](https://docs.microsoft.com/azure/batch-ai/quickstart-cli) для управления Batch AI
* Пошаговое руководство по использованию [Python](https://docs.microsoft.com/azure/batch-ai/quickstart-python) для управления Batch AI
* [Инструкции Batch AI](https://github.com/Azure/BatchAI), описывающие использование различных платформ искусственного интеллекта и глубинного обучения вместе с Batch AI

## <a name="interactive-vm-pool"></a>Пул интерактивных виртуальных машин

При использовании пула интерактивных виртуальных машин, с которыми совместно работает вся команда разработчиков решений на основе ИИ или обработки и анализа данных, пользователи могут входить на доступный экземпляр DSVM, а не на выделенный экземпляр, назначаемый каждому набору пользователей. Это помогает повысить уровень доступности и эффективность использования ресурсов. 

Технологией, применяемой для создания пулов интерактивных виртуальных машин, являются [масштабируемые наборы виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machine-scale-sets/). Масштабируемые наборы позволяют создавать и администрировать группы идентичных виртуальных машин с автоматическим масштабированием и балансировкой нагрузки. 

Пользователь выполняет вход по IP-адресу или DNS-адресу основного пула. Масштабируемый набор автоматически перенаправляет сеанс доступной DSVM. Так как пользователь предпочитает использовать единую среду независимо от виртуальной машины, на которую он вошел, ко всем экземплярам виртуальных машин в масштабируемом наборе подключен общий сетевой диск, например общий ресурс службы файлов Azure или общий ресурс NFS. Как правило, общая рабочая область пользователя размещается в общем хранилище файлов, которое подключается к каждому из экземпляров. 

Пример шаблона Azure Resource Manager, который создает масштабируемый набор с экземплярами DSVM на основе Ubuntu, можно найти на сайте [GitHub](https://raw.githubusercontent.com/Azure/DataScienceVM/master/Scripts/CreateDSVM/Ubuntu/dsvm-vmss-cluster.json). Там же находится и пример [файла параметров](https://raw.githubusercontent.com/Azure/DataScienceVM/master/Scripts/CreateDSVM/Ubuntu/dsvm-vmss-cluster.parameters.json) для шаблона Azure Resource Manager. 

Вы можете создать масштабируемый набор с помощью шаблона Azure Resource Manager, указав значения в файле параметров с помощью Azure CLI. 

```
az group create --name [[NAME OF RESOURCE GROUP]] --location [[ Data center. For eg: "West US 2"]
az group deployment create --resource-group  [[NAME OF RESOURCE GROUP ABOVE]]  --template-uri https://raw.githubusercontent.com/Azure/DataScienceVM/master/Scripts/CreateDSVM/Ubuntu/dsvm-vmss-cluster.json --parameters @[[PARAMETER JSON FILE]]
```
В приведенных выше командах предполагается, что у вас есть следующее:
* Копия файла параметров со значениями, указанными для вашего экземпляра масштабируемого набора.
* Требуемое число экземпляров виртуальных машин.
* Указатели на общий ресурс службы файлов Azure.
* Учетные данные для учетной записи хранения, которая будет подключена к каждой виртуальной машине. 

На файл параметров указывают локальные ссылки в командах. Вы также можете передать встроенные параметры или запросить их в сценарии.  

Приведенный выше шаблон позволяет использовать протокол SSH и порт JupyterHub из интерфейсного масштабируемого набора во внутреннем пуле DSVM на основе Ubuntu. Пользователь может просто войти на виртуальную машину с помощью SSH или JupyterHub, используя обычную процедуру. Так как экземпляры виртуальных машин могут масштабироваться динамически, любое состояние должно быть сохранено в подключенном общем ресурсе службы файлов Azure. Тот же подход можно использовать для создания пула DSVM на основе Windows. 

В репозитории Azure DataScienceVM на сайте GitHub можно также найти [сценарий, который подключает общий ресурс службы файлов Azure](https://raw.githubusercontent.com/Azure/DataScienceVM/master/Extensions/General/mountazurefiles.sh). Этот сценарий подключает общий ресурс службы файлов Azure в заданной точке подключения внутри файла параметров. Кроме того, он создает гибкие связи с подключенным диском в домашнем каталоге начального пользователя. Каталог записных книжек для конкретного пользователя в общем ресурсе службы файлов Azure гибко связан с каталогом `$HOME/notebooks/remote`, поэтому пользователь может обращаться к записным книжкам Jupyter, запускать и сохранять их. Это же соглашение можно использовать при создании дополнительных пользователей на виртуальной машине, чтобы добавить указатель на рабочую область Jupyter каждого пользователя в общий ресурс службы файлов Azure. 

Масштабируемые наборы виртуальных машин поддерживают автомасштабирование. Вы можете задать правила, определяющие, когда следует создавать дополнительные экземпляры и когда нужно уменьшить их масштаб. Например, вы можете уменьшить масштаб до нуля экземпляров, чтобы сэкономить на использовании облачного оборудования, когда виртуальные машины простаивают. Подробное описание процедуры [автомасштабирования](https://docs.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview) приведено в документации по масштабируемым наборам виртуальных машин.

## <a name="next-steps"></a>Дополнительная информация

* [Настройка общего удостоверения](dsvm-common-identity.md)
* [Безопасное хранение учетных данных для доступа на виртуальной машине для обработки и анализа данных](dsvm-secure-access-keys.md)















