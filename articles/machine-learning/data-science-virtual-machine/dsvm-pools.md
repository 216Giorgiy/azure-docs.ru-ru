---
title: Пулы виртуальных машин для обработки и анализа данных в Azure | Документация Майкрософт
description: Развертывание пулов виртуальных машин для обработки и анализа данных в качестве общего ресурса для команды.
keywords: глубинное обучение, ИИ, инструменты обработки и анализа данных, виртуальная машина для обработки и анализа данных, геопространственный анализ
services: machine-learning
documentationcenter: ''
author: gopitk
manager: cgronlun
ms.assetid: ''
ms.service: machine-learning
ms.component: data-science-vm
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2018
ms.author: gokuma
ms.openlocfilehash: c7aab0435ecbd0aee57a15008ac0270159ec2eb3
ms.sourcegitcommit: 944d16bc74de29fb2643b0576a20cbd7e437cef2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2018
ms.locfileid: "34837088"
---
# <a name="creating-a-shared-pool-of-data-science-virtual-machines"></a>Создание общего пула виртуальных машин для обработки и анализа данных

В этой статье описывается, как можно создать общий пул из виртуальных машин для обработки и анализа данных (DSVM) для команды. Преимуществом общего пула является более эффективное использование ресурсов, упрощение общего доступа и совместной работы, а также предоставление ИТ-специалистам возможности более эффективно управлять ресурсами DSVM. 

Существует много способов и различных технологий, которые можно использовать для создания пула DSVM.  Ниже приведены основные сценарии:

* пул для пакетной обработки;
* пул для интерактивных виртуальных машин.

## <a name="batch-processing-pool"></a>Пул пакетной обработки
Если вы хотите настроить пул DSVM главным образом для пакетного выполнения заданий вне сети, то можно использовать службу [Azure Batch AI](https://docs.microsoft.com/azure/batch-ai/) или [пакетную службу Azure](https://docs.microsoft.com/azure/batch/). 

### <a name="azure-batch-ai"></a>Azure Batch AI
В Azure Batch AI поддерживается образ с выпуском DSVM на основе Ubuntu. При создании кластера Azure Batch AI в Azure CLI или пакете SDK для Python можно указать параметр ```image``` и присвоить ему значение ```UbuntuDSVM```. Можно выбрать тип узлов обработки (экземпляры на основе GPU или только на основе ЦП, количество ЦП, объем памяти) из [широкого набора экземпляров виртуальных машин](https://azure.microsoft.com/pricing/details/virtual-machines/linux/), предлагаемых в Azure. При использовании образа DSVM на основе Ubuntu в Batch AI для узлов на основе GPU все необходимые драйверы GPU и платформы для глубинного обучения установлены в образе предварительно, что значительно сэкономит значительное подготовки узлов пакетной обработки. Фактически при интерактивной разработке на виртуальных машинах DSVM на основе Ubuntu можно заметить, что параметры и конфигурация узлов Batch AI абсолютно не отличается от среды. Обычно при создании кластера Batch AI также создается файловый ресурс, подключаемый ко всем узлам и используемый для ввода и вывода данных, а также для хранения кода или сценариев пакетных заданий. 

После создания кластера Batch AI можно использовать тот же интерфейс командной строки или пакет SDK для Python, чтобы отправлять задания для выполнения. Вы платите только за время, затрачиваемое на выполнение пакетных заданий. 

#### <a name="more-information"></a>Дополнительные сведения
* Пошаговое руководство по использованию [Azure CLI](https://docs.microsoft.com/azure/batch-ai/quickstart-cli) для управления Batch AI.
* Пошаговое руководство по использованию [Python](https://docs.microsoft.com/azure/batch-ai/quickstart-python) для управления Batch AI.
* Вы можете ознакомиться с [рецептами для Batch AI](https://github.com/Azure/BatchAI), демонстрирующими, как использовать различные платформы ИИ и глубинного обучения с Batch AI.

## <a name="interactive-vm-pool"></a>Пул интерактивных виртуальных машин

Пр использовании пула интерактивных виртуальных машин DSVM, с которыми работает совместно команда разработчиков решений на основе ИИ или обработки и анализ данных, пользователи могут входить на доступный экземпляр DSVM, а не на выделенный экземпляр, назначаемый каждому набору пользователей. Это помогает повысить уровень доступности и эффективность использования ресурсов. 

Технология, используемая для создания пула интерактивных виртуальных Машин — служба [Масштабируемые наборы виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machine-scale-sets/) (VMSS), которая позволяет создавать группы идентичных виртуальных машин с функциями балансировки нагрузки и автомасштабирования и управлять этими группами. Пользователь выполняет вход по IP-адресу или DNS-адресу основного пула. Масштабируемый набор автоматически направляет сеанс к доступному экземпляру DSVM. Так как пользователь предпочитает использовать единую среду независимо от виртуальной машины, на которую он вошел, ко всем экземплярам виртуальных машин в масштабируемом наборе подключен общий сетевой диск, например общий ресурс службы файлов Azure или общий ресурс NFS. Как правило, общая рабочая область пользователя размещается в общем хранилище файлов, которое подключается к каждому из экземпляров. 

Пример шаблона Azure Resource Manager, который создает масштабируемый набор виртуальных машин с экземплярами DSVM на основе Ubuntu, можно найти на сайте [GitHub](https://raw.githubusercontent.com/Azure/DataScienceVM/master/Scripts/CreateDSVM/Ubuntu/dsvm-vmss-cluster.json). В этом расположении также предоставляется пример [файла параметров](https://raw.githubusercontent.com/Azure/DataScienceVM/master/Scripts/CreateDSVM/Ubuntu/dsvm-vmss-cluster.parameters.json) шаблона Azure Resource Manager. 

Можно создать масштабируемый набор виртуальных машин с помощью шаблона Azure Resource Manager, указав подходящие значения в файле параметров с помощью Azure CLI. 

```
az group create --name [[NAME OF RESOURCE GROUP]] --location [[ Data center. For eg: "West US 2"]
az group deployment create --resource-group  [[NAME OF RESOURCE GROUP ABOVE]]  --template-uri https://raw.githubusercontent.com/Azure/DataScienceVM/master/Scripts/CreateDSVM/Ubuntu/dsvm-vmss-cluster.json --parameters @[[PARAMETER JSON FILE]]
```
В командах выше предполагается, что вы скопировали файл параметров со значениями, указанными для экземпляра масштабируемого набора виртуальных машин, количества экземпляров виртуальных машин, а также с указателями на общий ресурс службы файлов Azure с данными учетной записи хранения, который будет подключен к каждой виртуальной машине. В команде, приведенной выше, файл параметров указывается локально. Можно также передать встроенные параметры или запросить их из сценария.  

Приведенный выше шаблон разрешает использовать протокол SSH и порт Jupyterhub из интерфейсного масштабируемого набора виртуальных машин во внутреннем пуле DSVM на основе Ubuntu.  Пользователь может просто войти на виртуальную машину с помощью SSH или JupyterHub, используя обычную процедуру. Так как экземпляры виртуальных машин могут масштабироваться динамически, любое состояние должно быть сохранено в подключенном общем ресурсе службы файлов Azure. Тот же подход можно использовать для создания пула DSVM на основе Windows. 

В репозитории Azure DataScienceVM на сайте Github можно также найти [сценарий, который подключает общий ресурс службы файлов Azure](https://raw.githubusercontent.com/Azure/DataScienceVM/master/Extensions/General/mountazurefiles.sh). Помимо подключения общего ресурса службы файлов Azure к указанной в файле параметров точке подключения он также создает дополнительные гибкие ссылки на подключенный диск в домашнем каталоге исходного пользователя, и каталог Notebook пользователя в общей службе файлов Azure гибко связан с каталогом ```$HOME/notebooks/remote```, что позволяет пользователю открыть, запустить и сохранить свои элементы Jupyter Notebook.  Это же соглашение может использоваться при создании дополнительных пользователей на виртуальной машине, чтобы добавить указатель на рабочую область Jupyter каждого пользователя в общую службу файлов Azure. 

Масштабируемый набор виртуальных машин Azure поддерживает автомасштабирование, то есть можно задать правила создания дополнительных экземпляров и их удаления, включая уменьшение числа экземпляров до нуля для сокращения затрат на использование облачного оборудования в случае, когда виртуальные машины вообще не используются. Подробное описание процедуры [автомасштабирования](https://docs.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview) приведено в документации по масштабируемым наборам виртуальных машин.

## <a name="next-steps"></a>Дополнительная информация

* [Настройка общего удостоверения](dsvm-common-identity.md)
* [Безопасное хранение учетных данных для доступа к облачным ресурсам](dsvm-secure-access-keys.md)















