---
title: Настройка общего удостоверения для виртуальной машины для обработки и анализа данных в Azure | Документация Майкрософт
description: Настройка общего удостоверения в командной корпоративной среде на основе виртуальной машины для обработки и анализа данных.
keywords: deep learning, AI, data science tools, data science virtual machine, geospatial analytics, team data science process
services: machine-learning
documentationcenter: ''
author: gopitk
manager: cgronlun
ms.assetid: ''
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2018
ms.author: gokuma
ms.openlocfilehash: 431d3079c0d942c15ccbc8352261ccfe1f5f6e47
ms.sourcegitcommit: 909469bf17211be40ea24a981c3e0331ea182996
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/10/2018
---
# <a name="setup-common-identity-on-the-data-science-vm"></a>Настройка общего удостоверения на виртуальной машине для обработки и анализа данных

По умолчанию локальные учетные записи создаются во время подготовки виртуальной машины Azure, включая виртуальную машину для обработки и анализа данных, и пользователи используют эти учетные данные для проверки подлинности на этой машине. Если у вас несколько виртуальных машин, к которым вам нужен доступ, при применении такого подхода управление учетными данными становится затруднительным. При использовании общих учетных записей пользователей и управлении с помощью поставщиков удостоверений на основе стандартов вы можете получать доступ к нескольким ресурсам в Azure, включая несколько ВМ для обработки и анализа данных, используя один набор учетных данных. 

Active Directory (AD) — это популярный поставщик удостоверений, который поддерживается в Azure в качестве службы, а также в локальной среде. Вы можете использовать AD или Azure AD для проверки подлинности пользователей на автономной виртуальной машине для обработки и анализа данных (DSVM) и в кластере таких машин в масштабируемом наборе виртуальных машин Azure. Это делается путем присоединения экземпляров DSVM к домену AD. Если у вас уже настроен Active Directory для управления удостоверениями, его можно использовать как общий поставщик удостоверений. При отсутствии AD вы можете запустить управляемый AD в Azure через [доменные службы Azure Active Directory](https://docs.microsoft.com/azure/active-directory-domain-services/) (Azure AD DS). 

В документации по [Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/) содержатся подробные [инструкции](https://docs.microsoft.com/azure/active-directory/choose-hybrid-identity-solution#synchronized-identity) по управляемой службе Active Directory, включая подключение Azure AD к локальному каталогу, если таковой имеется. 

Далее в этой статье описывается настройка полностью управляемой службы домена AD в Azure с использованием Azure AD DS и присоединение вашей виртуальной машины для обработки и анализа данных к управляемому домену AD, чтобы пользователи могли получить доступ к пулу DSVM (и другим ресурсам Azure) с помощью общей учетной записи пользователя и учетных данных. 

##  <a name="set-up-a-fully-managed-active-directory-domain-on-azure"></a>Настройка полностью управляемого домена Active Directory в Azure

Azure AD DS упрощает управление вашими удостоверениями, предоставляя полностью управляемую службу в Azure. В данном домене Active Directory пользователи и группы управляемы.  Ниже приведены шаги для настройки размещенного в Azure домена AD и учетных записей пользователей в вашем каталоге.

1. Добавьте пользователей в Active Directory на портале. 

    a. Войдите в [Центр администрирования Azure Active Directory](https://aad.portal.azure.com) с помощью учетной записи глобального администратора каталога.
    
    Б. Выберите **Azure Active Directory**, а затем щелкните **Пользователи и группы**.
    
    c. В колонке **Пользователи и группы** выберите **Все пользователи** и щелкните **Новый пользователь**.
   
   ![Выбор команды "Добавить"](./media/add-user.png)
    
    d. Введите сведения о пользователе в соответствующих полях, например **Имя** и **Имя пользователя**. Частью имени пользователя, представляющей собой доменное имя, должно быть доменное имя по умолчанию, [domain name].onmicrosoft.com, или проверенное доменное имя, не являющееся федеративным, например [настроить доменное имя](../../active-directory/add-custom-domain.md) contoso.com.
    
    д. Скопируйте или иным способом запишите созданный пароль пользователя, чтобы после завершения этого процесса его можно было предоставить пользователю.
    
    f. При необходимости можно указать сведения, открыв колонку **Профиль**, **Группы** или **Роль каталога** для пользователя. 
    
    ж. В разделе **Пользователь** выберите **Создать**.
    
    h. Безопасным способом передайте созданный пароль новому пользователю, чтобы он мог войти в систему.

2.  Создайте доменные службы Azure AD.

    Инструкции по созданию Azure AD DS см. в статье [Включение доменных служб Azure Active Directory с помощью портала Azure](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-getting-started) (задачи от 1 до 5). Очень важно, чтобы существующие пароли пользователей в Active Directory обновлялись для синхронизации паролей в Azure AD DS. Также важно добавить DNS в Azure AD DS, как описано в задаче № 4 указанной выше статьи. 

3.  Создайте отдельную подсеть DSVM в виртуальной сети, созданной в задаче № 2 предыдущего шага.
4.  Создайте один или несколько экземпляров виртуальной машины для обработки и анализа данных в подсети DSVM. 
5.  Выполните [инструкции](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-join-ubuntu-linux-vm ) по добавлению DSVM в AD. 
6.  Затем подключите общие файлы Azure, чтобы разместить ваш домашний каталог или каталог Notebook для подключения рабочей области на любом компьютере. (Если вам необходимы узкие разрешения на уровне файлов, вам потребуется система NFS, выполняющаяся на одной или нескольких виртуальных машинах.)

    a. [Создайте файловый ресурс Azure](../../storage/files/storage-how-to-create-file-share.md).
    
    Б. Подключите его к Linux DSVM. Когда вы нажмете кнопку "Подключиться" для файлов Azure в вашей учетной записи хранения на портале Azure, отобразится команда для выполнения в оболочке Bash на Linux DSVM. Команда будет выглядеть следующим образом:
```
sudo mount -t cifs //[STORAGEACCT].file.core.windows.net/workspace [Your mount point] -o vers=3.0,username=[STORAGEACCT],password=[Access Key or SAS],dir_mode=0777,file_mode=0777,sec=ntlmssp
```
7.  Например, вы подключили ваши файлы Azure в каталоге /data/workspace. Теперь создайте каталоги для всех ваших пользователей в общей папке: /data/workspace/user1, /data/workspace/user2 и т. д. Создайте каталог ```notebooks``` в рабочей области каждого пользователя. 
8. Создайте символьные ссылки для ```notebooks``` в ```$HOME/userx/notebooks/remote```.   

Теперь в вашем размещенном в Azure каталоге Active Directory установлены пользователи, и они могут входить в систему любой DSVM (SSH, Jupyterhub), присоединенной к Azure AD DS, используя учетные данные AD. Так как рабочая область пользователя находится в общих файлах Azure, у пользователя будет доступ к записным книжкам и другим ресурсам из любой DSVM при использовании Jupyterhub. 

Для автоматического масштабирования вы можете использовать масштабируемый набор виртуальных машин, чтобы создать пул виртуальных машин, которые все подключены к домену таким образом и имеют установленный общий диск. Теперь пользователи могут входить в систему любой доступной виртуальной машины в масштабируемом наборе и имеют доступ к общему диску, где сохранены их записные книжки. 

## <a name="next-steps"></a>Дополнительная информация

* [Безопасное хранение учетных данных для доступа на виртуальной машине для обработки и анализа данных](dsvm-secure-access-keys.md)



