<properties 
	pageTitle="Использование службы контроля доступа (Java) — руководство по компонентам Azure" 
	description="Узнайте, как разрабатывать и применять контроль доступа с использованием Java в Azure." 
	services="active-directory" 
	documentationCenter="java" 
	authors="rmcmurray" 
	manager="wpickett" 
	editor="jimbe"/>

<tags 
	ms.service="active-directory" 
	ms.workload="identity" 
	ms.tgt_pltfrm="na" 
	ms.devlang="Java" 
	ms.topic="article" 
	ms.date="02/20/2015" 
	ms.author="robmcm"/>

# Проверка подлинности веб-пользователей с помощью службы контроля доступа Azure и Eclipse

В этом руководстве показано, как использовать службу Azure Access Control Service (ACS) в подключаемом модуле Azure для Eclipse с Java (с использованием технологий Microsoft Open Technologies). Дополнительные сведения об ACS см. в разделе [Дальнейшие действия](#next_steps).

> [AZURE.NOTE]Фильтр служб Azure Access Control (от Microsoft Open Technologies) — это CTP-версия. Эта предварительная версия программного обеспечения не располагает официальной поддержкой со стороны Microsoft Open Technologies, Inc. и корпорации Майкрософт.

## Оглавление

-   [Что такое ACS?][]
-   [Основные понятия][]
-   [Предварительные требования][]
-   [Создание пространства имен ACS][]
-   [Добавление поставщиков удостоверений][]
-   [Добавление приложения проверяющей стороны][]
-   [Создание правил][]
-   [Отправка сертификата в пространство имен ACS][]
-   [Просмотр страницы интеграции приложений][]
-   [Создание веб-приложения Java][]
-   [Добавление библиотеки фильтров ACS в приложение][]
-   [Развертывание в эмуляторе среды выполнения приложений][]
-   [Развертывание в Azure][]
-   [Дальнейшие действия][]

## <a name="what-is"></a>Что такое ACS?

Большинство разработчиков не являются экспертами в области идентификации, и обычно не нужно тратить механизмы проверки подлинности и авторизации разработка времени для своих приложений и служб. ACS — это служба Azure, предоставляющая простой способ проверки подлинности пользователей, которым требуется доступ к вашим веб-приложениям и службам без необходимости учитывать в коде сложную логику проверки подлинности.

В ACS доступны следующие возможности:

-   Интеграция с Windows Identity Foundation (WIF).
-   Поддержка популярных поставщиков удостоверений в Интернете, в том числе Windows Live ID, Google, Yahoo! и Facebook.
-   Поддержка служб федерации Active Directory (AD FS) 2.0.
-   Служба управления на основе Open Data Protocol (OData), предоставляющая программный доступ к параметрам ACS.
-   Портал управления, предоставляющий административный доступ к параметрам ACS.

Дополнительные сведения о службе ACS см. в разделе [Служба Access Control 2.0][].

## <a name="concepts"></a>Основные понятия

Служба Azure ACS построена по принципу идентификации на основе утверждений и обеспечивает согласованный подход к созданию механизмов проверки подлинности для приложений, выполняющихся локально или в облаке. Удостоверение на основе утверждений предоставляет общий способ для приложений и служб для получения идентификатора информации о пользователях в своей организации, в других организациях и в Интернете.

Для выполнения задач в данном руководстве необходимо понимать следующие концепции.

**Клиент** — в контексте данного руководства это браузер, который пытается получить доступ к веб-приложению.

**Приложение проверяющей стороны** — веб-сайт или служба, привлекающая внешний полномочный орган для проверки подлинности. Применительно к идентификации мы говорим, что проверяющая сторона доверяет этому органу. В этом руководстве объясняется, как настроить приложение на доверие ACS.

**Маркер** — набор данных безопасности, который обычно выдается после успешной проверки подлинности пользователя. Он содержит набор *утверждений*, атрибутов пользователя, прошедшего проверку подлинности. Утверждение может представлять имя пользователя, идентификатор связанной с пользователем роли, возраст пользователя и т. д. Маркер обычно имеет цифровую подпись, то есть его источник всегда можно проследить и его содержимое нельзя подделать. Пользователь получает доступ к приложению проверяющей стороны, предоставляя действительный маркер, выданный полномочным органом, которому доверяет приложение.

**Поставщик удостоверений** — полномочный орган, который проверяет подлинность идентификационных данных пользователя и выдает маркеры безопасности. Фактическая работа по выдаче маркеров осуществляется специальной службой, которая называется службой маркеров безопасности (Security Token Service, STS). Типичными примерами поставщиков удостоверений являются Windows Live ID, Facebook, репозитории бизнес-пользователей (например, Active Directory) и т. д. Если служба ACS настроена на доверие поставщику удостоверений, система будет принимать и проверять маркеры, выданные этим поставщиком. ACS может доверять сразу нескольким поставщикам, это означает, что, если ваше приложение доверяет ACS, можно мгновенно предложить приложение для всех пользователей, прошедших проверку подлинности всех IP-адресов, которым доверяет ACS от вашего имени.

**Поставщик федерации** — поставщики удостоверений располагают непосредственными знаниями о пользователях, осуществляют проверку их подлинности, используя их учетные данные, и выдают утверждения о том, что они знают об этих пользователях. Поставщик федерации — это другой вид полномочного органа: вместо непосредственной проверки подлинности пользователей он действует как промежуточное звено и выступает посредником при проверке подлинности между одной проверяющей стороной и одним или несколькими поставщиками удостоверений. И поставщики удостоверений, и поставщики федерации выдают маркеры безопасности, поэтому и те и другие используют службу маркеров безопасности (Security Token Services, STS). ACS — это один поставщик федерации.

**Обработчик правил ACS** — логика, которая используется для преобразования входящих маркеров от доверенных поставщиков удостоверений в маркеры, предназначенные для использования проверяющей стороной, и кодифицируется в форме простых правил преобразования утверждений. В ACS имеется обработчик правил, который следит за применением любой логики преобразования, указанной для вашей проверяющей стороны.

**Пространство имен ACS** — пространство имен представляет собой раздел ACS верхнего уровня, который используется для систематизации параметров. В пространстве имен размещается список поставщиков удостоверений, которым вы доверяете, приложений проверяющей стороны, которые нужно обслуживать, правил, которые будут применяться для обработки входящих маркеров, и т. д. Пространство имен предоставляет различные конечные точки, которые будут использоваться приложением и разработчиком для обеспечения выполнения функции службы ACS.

На следующем рисунке показано, как работает проверка подлинности ACS с веб-приложением:

![Рабочая схема ACS][acs_flow]

1.  Клиент (в данном случае браузер) запрашивает страницу у проверяющей стороны.
2.  Поскольку запрос еще не прошел проверку подлинности, проверяющая сторона перенаправляет пользователя в полномочный орган, которому она доверяет, то есть в ACS. ACS предлагает пользователю на выбор поставщики удостоверений, указанные для этой проверяющей стороны. Пользователь выбирает поставщика удостоверений.
3.  Клиент переходит на страницу проверки подлинности поставщика удостоверений и предлагает пользователю войти в систему.
4.  После проверки подлинности клиента (например, введенных учетных данных) поставщик удостоверений выдает маркер безопасности.
5.  После выдачи маркера безопасности поставщик удостоверений перенаправляет клиент в ACS и клиент отправляет маркер безопасности, выданный поставщиком, в ACS.
6.  ACS проверяет маркер безопасности, выданный поставщиком удостоверений, вводит идентификационные утверждения из этого маркера в обработчик правил ACS, вычисляет выходные идентификационные утверждения и выдает новый маркер безопасности, содержащий эти выходные утверждения.
7.  ACS перенаправляет клиент к проверяющей стороне. Клиент отправляет новый маркер безопасности, выданный службой ACS, проверяющей стороне. Проверяющая сторона проверяет подпись маркера безопасности, выданного службой ACS, проверяет утверждения в этом маркере и возвращает первоначально запрошенную страницу.

## <a name="pre"></a>Предварительные требования

Для выполнения задач в этом руководстве вам потребуется следующее:

- Java Developer Kit (JDK), версия 1.6 или более поздняя.
- Интегрированная среда разработки Eclipse для разработчиков Java EE, версия Indigo или более поздняя. Среду также можно загрузить с веб-страницы <http://www.eclipse.org/downloads/>. 
- Дистрибутив веб-сервера или сервера приложений на основе Java, например Apache Tomcat, GlassFish, сервера приложений JBoss или Jetty.
- Подписка на Azure, которую можно получить на веб-странице http://www.microsoft.com/windowsazure/offers/.
- Подключаемый модуль Azure для Eclipse с Java (на основе Microsoft Open Technologies), выпуск от апреля 2014 г. Дополнительные сведения см. в разделе [Установка подключаемого модуля Azure для Eclipse с Java (от Microsoft Open Technologies)](http://msdn.microsoft.com/library/windowsazure/hh690946.aspx).
- Сертификат X.509 для использования с приложением. Этот сертификат потребуется в обоих форматах: открытый сертификат (CER) и файл обмена личной информацией (PFX). (Возможности для создания этого сертификата будут описаны далее в этом руководстве.)
- Знакомство с эмулятором среды выполнения приложений Azure и методами развертывания, которые обсуждаются в разделе [Создание приложения Hello World для Azure в Eclipse](http://msdn.microsoft.com/library/windowsazure/hh690944.aspx).

## <a name="create-namespace"></a>Создание пространства имен ACS

Чтобы начать использование службы Access Control Service (ACS) в Azure, необходимо создать пространство имен ACS. Пространство имен предоставляет уникальную область для адресации ресурсов ACS из приложения.

1. Выполните вход на [портал управления Azure][].
2. Щелкните **Active Directory**. 
3. Чтобы создать новое пространство имен Access Control, последовательно щелкните **Создать**, **Службы приложений**, **Access Control** и **Быстро создать**. 
4. Введите имя для пространства имен. Azure проверяет, является ли имя уникальным.
5. Выберите регион, в котором используется пространство имен. Для максимальной эффективности используйте регион, в котором развертывается приложение.
6. Если у вас имеется несколько подписок, выберите ту, которую следует использовать для пространства имен ACS.
7. Щелкните **Создать**.

Azure создает и активирует пространство имен. Прежде чем продолжить, дождитесь, когда пространство имен перейдет в состояние **Активно**.

## <a name="add-IP"></a>Добавление поставщиков удостоверений

В этой задаче добавляются поставщики удостоверений, которые будут использоваться с приложением проверяющей стороны для проверки подлинности. Для демонстрационных целей в этой задаче показано, как добавить Windows Live в качестве поставщика удостоверений, но вы можете использовать любой из поставщиков, перечисленных на портале управления ACS.


1.  На [портале управления Azure][] щелкните **Active Directory**, выберите пространство имен Access Control и щелкните **Управление**. Откроется портал управления ACS.
2.  В левой области навигации портала управления ACS щелкните **Поставщики удостоверений**.
3.  Windows Live ID включен по умолчанию и не может быть удален. В данном учебнике используется только Windows Live ID. Однако на этом экране можно добавлять и другие поставщики удостоверений нажатием кнопки **Добавить**.

Теперь Windows Live ID используется в качестве поставщика удостоверений для вашего пространства имен ACS. Далее необходимо указать веб-приложение Java (будет создано позже) в качестве проверяющей стороны.

## <a name="add-RP"></a>Добавление приложения проверяющей стороны

В этой задаче ACS настраивается для распознавания веб-приложения Java как допустимого приложения проверяющей стороны.

1.  На портале управления ACS щелкните **Приложения проверяющей стороны**.
2.  На странице **Приложения проверяющей стороны** щелкните **Добавить**.
3.  На странице **Добавить приложение проверяющей стороны** выполните следующие действия.
    1.  В поле **Имя** введите имя проверяющей стороны. Для целей данного учебника введите **Azure Web App**.
    2.  В поле **Режим** выберите **Ввод параметров вручную**.
    3.  В поле **Область** введите URI, к которому применяется маркер безопасности, выданный ACS. Для данной задачи введите **http://localhost:8080/**. ![Область действия проверяющей стороны для использования в эмуляторе среды выполнения приложений][relying_party_realm_emulator] 4.  В поле **URL возврата** введите URL-адрес, по которому ACS возвращает маркер безопасности. Для данной задачи введите **http://localhost:8080/MyACSHelloWorld/index.jsp** ![URL-адрес возврата проверяющей стороны для использования в эмуляторе среды выполнения приложений][relying_party_return_url_emulator] 5.  Примите значения по умолчанию в остальных полях.

4.  Щелкните **Сохранить**.

Вы успешно настроили веб-приложение Java, чтобы при запуске в эмуляторе среды выполнения приложений Azure (на http://localhost:8080/) оно выступало в роли проверяющей стороны в пространстве имен ACS. Теперь необходимо создать правила, которые будет использовать ACS при обработке утверждений для проверяющей стороны.

## <a name="create-rules"></a>Создание правил

В этой задаче задаются правила, которые определяют способ передачи проверяющей стороне утверждений от поставщиков удостоверений. В данном руководстве мы просто настроим ACS для копирования типов и значений входных утверждений прямо в выходной маркер без фильтрации или изменения.

1.  На главной странице портала управления ACS щелкните **Группы правил**.
2.  На странице **Группы правил** щелкните **Группа правил по умолчанию для Azure Web App**.
3.  На странице **Изменить группу правил** щелкните **Создать**.
4.  На странице **Создать правила: группа правил по умолчанию для Azure Web App** убедитесь, что установлен флажок для Windows Live ID, затем щелкните **Создать**.	
5.  На странице **Изменить группу правил** щелкните **Сохранить**.

## <a name="upload-certificate"></a>Отправка сертификата в пространство имен ACS

В этой задаче отправляется PFX-сертификат, который будет использоваться для подписи запросов маркера, созданных пространством имен ACS.

1.  На главной странице портала управления ACS щелкните **Сертификаты и ключи**.
2.  На странице **Сертификаты и ключи** щелкните **Добавить** над полем **Подпись маркеров**.
3.  На странице **Добавить сертификат или ключ для подписи маркера** сделайте следующее.
    1. В разделе **Используется для** щелкните **Приложение проверяющей стороны** и выберите **Azure Web App** (указано ранее в качестве имени приложения проверяющей стороны).
    2. В разделе **Тип** выберите **Сертификат X.509**.
    3. В разделе **Сертификат** нажмите кнопку обзора и перейдите к файлу сертификата X.509, который нужно использовать. Это будет PFX-файл. Выберите файл, щелкните **Открыть**, затем введите пароль сертификата в поле **Пароль**. Имейте в виду, что для целей тестирования можно использовать самозаверяющий сертификат. Чтобы создать самозаверяющий сертификат, используйте кнопку **Создать** в диалоговом окне **Библиотека фильтров ACS** (описывается далее) или программу **encutil.exe** из [веб-сайта проекта][] для Azure Starter Kit for Java (от Microsoft Open Technologies).
    4. Убедитесь, что установлен флаг **Назначить основным**. Страница **Добавить сертификат или ключ для подписи маркера** должна выглядеть следующим образом: ![Добавление сертификата для подписи маркера][add_token_signing_cert]
    5. Щелкните **Сохранить**, чтобы сохранить настройки и закрыть страницу **Добавить сертификат или ключ для подписи маркера**.

Теперь просмотрите сведения на странице интеграции приложений и скопируйте URI, который потребуется для настройки веб-приложения Java на использование ACS.

## <a name="review-app-int"></a>Просмотр страницы интеграции приложений

Все необходимые сведения и код, чтобы настроить веб-приложение Java (приложение проверяющей стороны) для работы с ACS, вы найдете на странице интеграции приложений на портале управления ACS. Эти сведения понадобятся при настройке веб-приложения Java для федеративной проверки подлинности.

1.  На портале управления ACS щелкните **Интеграция приложений**.  
2.  На странице **Интеграция приложений** щелкните **Страницы входа**.
3.  На странице **Интеграция страниц входа** щелкните **Azure Web App**.

На странице **Интеграция страниц входа: Azure Web App** URL-адрес, указанный в поле **Параметр 1: ссылка на страницу входа, размещаемую в ACS**, будет использоваться в вашем веб-приложении Java. Это значение потребуется при добавлении библиотеки фильтров служб Azure Access Control в приложение Java.

## <a name="create-java-app"></a>Создание веб-приложения Java
1. В меню Eclipse выберите **Файл**, щелкните **Создать**, затем щелкните **Динамический веб-проект**. (Если элемента **Динамический веб-проект** нет в списке доступных проектов после выбора пунктов **Файл**, **Создать**, то выполните следующие действия: щелкните последовательно **Файл**, **Создать**, **Проект**, разверните узел **Интернет**, щелкните **Динамический веб-проект** и нажмите кнопку **Далее**.) Для целей данного учебника присвойте проекту имя **MyACSHelloWorld**. (Обязательно используйте это имя, на последующих шагах в учебнике предполагается, что WAR-файл должен называться MyACSHelloWorld.) Экран будет выглядеть следующим образом:

    ![Пример создания проекта Hello World для ACS][create_acs_hello_world]

    Нажмите кнопку **Готово**
2. В окне обозревателя проектов в Eclipse разверните узел **MyACSHelloWorld**. Щелкните правой кнопкой мыши **WebContent**, выберите **Создать**, затем щелкните **JSP-файл**.
3. В диалоговом окне **Новый JSP-файл** укажите для файла имя **index.jsp**. Сохраните родительскую папку как MyACSHelloWorld/WebContent, как показано в следующем примере:

    ![Пример добавления JSP-файла для ACS][add_jsp_file_acs]

    Нажмите кнопку **Далее**.

4. В диалоговом окне **Выберите шаблон JSP** выберите **Новый JSP-файл (html)** и нажмите кнопку **Готово**.
5. При открытии файла index.jsp в Eclipse добавьте в текст для отображения фразу **Hello ACS World!** в существующем элементе `<body>`. Обновленное содержимое элемента `<body>` должно иметь следующий вид:

        <body>
          <b><% out.println("Hello ACS World!"); %></b>
        </body>
    
    Сохраните index.jsp.
  
## <a name="add_acs_filter_library"></a>Добавление библиотеки фильтров ACS в приложение

1. В обозревателе проектов Eclipse щелкните правой кнопкой мыши **MyACSHelloWorld**, выберите **Путь построения**, затем щелкните **Настроить путь построения**.
2. В диалоговом окне **Путь построения Java** перейдите на вкладку **Библиотеки**.
3. Щелкните **Добавить библиотеку**.
4. Щелкните **Фильтр служб Azure Access Control (от MS Open Tech)** и нажмите кнопку **Далее**. Откроется диалоговое окно **Фильтр служб Azure Access Control**. (В поле **Расположение** может быть указан другой путь в зависимости от того, где установлен Eclipse, и номер версии тоже может отличаться в зависимости от обновлений программного обеспечения.)

    ![Добавление библиотеки фильтров ACS][add_acs_filter_lib]

5. С помощью браузера откройте страницу **Интеграция страниц входа** на портале управления, скопируйте URL-адрес, указанный в поле **Параметр 1: ссылка на страницу входа, размещаемую в ACS**, и вставьте его в поле **Конечная точка проверки подлинности ACS** в диалоговом окне Eclipse.
6. С помощью браузера откройте страницу **Изменение приложения проверяющей стороны** на портале управления, скопируйте URL-адрес, указанный в поле **Область**, и вставьте его в поле **Область проверяющей стороны** в диалоговом окне Eclipse.
7. В разделе **Безопасность** диалогового окна Eclipse, если хотите использовать существующий сертификат, щелкните **Обзор**, перейдите к нужному сертификату, выберите его и щелкните **Открыть**. Если же вы хотите создать новый сертификат, щелкните **Создать** для отображения диалогового окна **Новый сертификат**, затем укажите пароль, имя CER-файла и имя PFX-файла для нового сертификата.
8. Установите флажок **Внедрить сертификат в WAR-файл**. При таком внедрении сертификат включается в ваше развертывание и его не требуется вручную добавлять в качестве компонента. (В противном случае необходимо сохранить сертификат вне WAR-файла, а затем можно добавить сертификат в качестве компонента роли и снять флажок **Внедрить сертификат в WAR-файл**.)
9. [Необязательно] Оставьте установленный флажок **Требовать соединения HTTPS**. Если этот флажок установлен, для доступа к приложению необходимо использовать протокол HTTPS. Если вы не собираетесь требовать соединения HTTPS, снимите этот флажок.
10. Для развертывания в эмуляторе среды выполнения приложений ваши параметры **фильтра Azure ACS** будут выглядеть следующим образом.

    ![Параметры фильтра Azure ACS для развертывания в эмуляторе среды выполнения приложений][add_acs_filter_lib_emulator]

11. Нажмите кнопку **Готово**
12. Щелкните **Да** при появлении диалогового окна с сообщением о создании файла web.xml.
13. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Путь построения Java**.

## <a name="deploy_compute_emulator"></a>Развертывание в эмуляторе среды выполнения приложений

1. В обозревателе проектов Eclipse щелкните правой кнопкой мыши **MyACSHelloWorld**, выберите **Azure**, затем щелкните **Пакет для Azure**.
2. В поле **Имя проекта** введите **MyAzureACSProject** и нажмите кнопку **Далее**.
3. Выберите JDK и сервер приложений. (Эти шаги подробно описаны в учебнике [Создание приложения Hello World для Azure в Eclipse](http://msdn.microsoft.com/library/windowsazure/hh690944.aspx).)
4. Нажмите кнопку **Готово**
5. Нажмите кнопку **Запуск в эмуляторе Azure**.
6. После запуска веб-приложения Java в эмуляторе среды выполнения приложений закройте все экземпляры браузера (чтобы все текущие сеансы браузера не мешали тестированию входа в ACS).
7. Запустите приложение, открыв в браузере <http://localhost:8080/MyACSHelloWorld/> (или <https://localhost:8080/MyACSHelloWorld/>, если установлен флажок **Требовать соединения HTTPS**). Вам будет предложено войти в Windows Live ID, а затем следует использовать URL-адрес возврата, указанный для приложения проверяющей стороны.
99.  По завершении просмотра приложения нажмите кнопку **Сброс эмулятора Azure**.

## <a name="deploy_azure"></a>Развертывание в Azure

Для развертывания в Azure необходимо изменить область действия проверяющей стороны и URL-адрес возврата для пространства имен ACS.

1. На портале управления Azure на странице **Изменение приложения проверяющей стороны** измените значение **Область** на URL-адрес развернутого сайта. Замените **example** DNS-именем, указанным для вашего развертывания.

    ![Область действия проверяющей стороны для использования в рабочей среде][relying_party_realm_production]

2. Измените **URL-адрес возврата** на URL-адрес приложения. Замените **example** DNS-именем, указанным для вашего развертывания.

    ![URL-адрес возврата проверяющей стороны для использования в рабочей среде][relying_party_return_url_production]

3. Щелкните **Сохранить**, чтобы сохранить обновленную область действия проверяющей стороны и изменение URL-адреса возврата.
4. Оставьте в браузере открытой страницу **Интеграция страниц входа**, вам скоро потребуется копировать с нее данные.
5. В обозревателе проектов Eclipse щелкните правой кнопкой мыши **MyACSHelloWorld**, выберите **Путь построения**, затем щелкните **Настроить путь построения**.
6. Перейдите на вкладку **Библиотеки**, щелкните **Фильтр служб Azure Access Control** и нажмите кнопку **Изменить**.
7. С помощью браузера откройте страницу **Интеграция страниц входа** на портале управления, скопируйте URL-адрес, указанный в поле **Параметр 1: ссылка на страницу входа, размещаемую в ACS**, и вставьте его в поле **Конечная точка проверки подлинности ACS** в диалоговом окне Eclipse.
8. С помощью браузера откройте страницу **Изменение приложения проверяющей стороны** на портале управления, скопируйте URL-адрес, указанный в поле **Область**, и вставьте его в поле **Область проверяющей стороны** в диалоговом окне Eclipse.
9. В разделе **Безопасность** диалогового окна Eclipse, если хотите использовать существующий сертификат, щелкните **Обзор**, перейдите к нужному сертификату, выберите его и щелкните **Открыть**. Если же вы хотите создать новый сертификат, щелкните **Создать** для отображения диалогового окна **Новый сертификат**, затем укажите пароль, имя CER-файла и имя PFX-файла для нового сертификата.
10. Оставьте установленный флажок **Внедрить сертификат в WAR-файл**, исходя из предположения, что вы хотите внедрить сертификат в WAR-файл.
11. [Необязательно] Оставьте установленный флажок **Требовать соединения HTTPS**. Если этот флажок установлен, для доступа к приложению необходимо использовать протокол HTTPS. Если вы не собираетесь требовать соединения HTTPS, снимите этот флажок.
12. Для развертывания в Azure ваши параметры фильтра Azure ACS будут выглядеть следующим образом.

    ![Параметры фильтра Azure ACS для развертывания в рабочей среде][add_acs_filter_lib_production]

13. Нажмите кнопку **Готово**, чтобы закрыть диалоговое окно **Изменить библиотеку**.
14. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Свойства MyACSHelloWorld**.
15. В Eclipse нажмите кнопку **Опубликовать в облаке Azure**. На запросы отвечайте примерно так, как это сделано в подразделе **Развертывание приложения в Azure** раздела [Создание приложения Hello World для Azure в Eclipse](http://msdn.microsoft.com/library/windowsazure/hh690944.aspx). 

После развертывания веб-приложения закройте все открытые сеансы браузера и запустите веб-приложение. Вам будет предложено выполнить вход с учетными данными Windows Live ID, а затем произойдет отправка на URL-возврата приложения проверяющей стороны.

После применения приложения ACS Hello World не забудьте удалить развертывание (сведения об удалении развертывания см. в разделе [Создание приложения Hello World для Azure в Eclipse](http://msdn.microsoft.com/library/windowsazure/hh690944.aspx)).


## <a name="next_steps"></a>Дальнейшие действия

Сведения о языке SAML (Security Assertion Markup Language), возвращаемом службой ACS в приложение, см. в разделе [Как просматривать SAML, возвращенный службой Azure Access Control][]. Чтобы продолжить изучение функций ACS и поэкспериментировать с более сложными сценариями, см. раздел [Служба Access Control 2.0][].

Кроме того, в этом примере используется параметр **Внедрить сертификат в WAR-файл**. Этот параметр упрощает развертывание сертификата. Если вместо этого вы хотите подписать сертификат отдельно от WAR-файла, можно использовать следующий способ:

1. В разделе **Безопасность** диалогового окна **Фильтр служб Azure Access Control** введите **${env.JAVA_HOME}/mycert.cer** и снимите флажок **Встроить сертификат в WAR-файл**. (Если имя вашего файла сертификата отличается, настройте mycert.cer.) Нажмите кнопку **Готово**, чтобы закрыть диалоговое окно.
2. Скопируйте сертификат как компонент развертывания: в обозревателе проектов Eclipse разверните узел **MyAzureACSProject**, щелкните правой кнопкой мыши **WorkerRole1**, выберите **Свойства**, разверните узел **Роль Azure** и щелкните **Компоненты**.
3. Щелкните **Добавить**.
4. В диалоговом окне **Добавить компонент** выполните следующие действия.
    1. В разделе **Импорт**:
        1. С помощью кнопки **Файл** перейдите к нужному сертификату. 
        2. Для параметра **Метод** выберите **copy**.
    2. Для параметра **Как имя** щелкните текстовое поле и примите имя по умолчанию.
    3. В разделе **Развертывание**:
        1. Для параметра **Метод** выберите **copy**.
        2. Для параметра **В каталог** введите **%JAVA_HOME%**.
    4. Ваше диалоговое окно **Добавить компонент** должно выглядеть следующим образом.

        ![Добавление сертификата как компонента][add_cert_component]

    5. Нажмите кнопку **ОК**.

На этом этапе ваш сертификат должен быть включен в развертывание. Обратите внимание, что независимо от того, внедряется ли сертификат в WAR-файл или добавляется в качестве компонента в развертывание, необходимо отправить сертификат в пространство имен, как описано в разделе [Отправка сертификата в пространство имен ACS][].

[Что такое ACS?]: #what-is
[Основные понятия]: #concepts
[Предварительные требования]: #pre
[Создание веб-приложения Java]: #create-java-app
[Создание пространства имен ACS]: #create-namespace
[Добавление поставщиков удостоверений]: #add-IP
[Добавление приложения проверяющей стороны]: #add-RP
[Создание правил]: #create-rules
[Отправка сертификата в пространство имен ACS]: #upload-certificate
[Просмотр страницы интеграции приложений]: #review-app-int
[Configure Trust between ACS and Your ASP.NET Web Application]: #config-trust
[Добавление библиотеки фильтров ACS в приложение]: #add_acs_filter_library
[Развертывание в эмуляторе среды выполнения приложений]: #deploy_compute_emulator
[Развертывание в Azure]: #deploy_azure
[Дальнейшие действия]: #next_steps
[веб-сайта проекта]: http://wastarterkit4java.codeplex.com/releases/view/61026
[Как просматривать SAML, возвращенный службой Azure Access Control]: /develop/java/how-to-guides/view-saml-returned-by-acs/
[Служба Access Control 2.0]: http://go.microsoft.com/fwlink/?LinkID=212360
[Windows Identity Foundation]: http://www.microsoft.com/download/en/details.aspx?id=17331
[Windows Identity Foundation SDK]: http://www.microsoft.com/download/en/details.aspx?id=4451
[портал управления Azure]: https://manage.windowsazure.com
[портале управления Azure]: https://manage.windowsazure.com
[acs_flow]: ./media/active-directory-java-authenticate-users-access-control-eclipse/ACSFlow.png

<!-- Eclipse-specific -->
[add_acs_filter_lib]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddACSFilterLibrary.png
[add_acs_filter_lib_emulator]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddACSFilterLibraryEmulator.png
[add_acs_filter_lib_production]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddACSFilterLibraryProduction.png

[relying_party_realm_emulator]: ./media/active-directory-java-authenticate-users-access-control-eclipse/RelyingPartyRealmEmulator.png
[relying_party_return_url_emulator]: ./media/active-directory-java-authenticate-users-access-control-eclipse/RelyingPartyReturnURLEmulator.png
[relying_party_realm_production]: ./media/active-directory-java-authenticate-users-access-control-eclipse/RelyingPartyRealmProduction.png
[relying_party_return_url_production]: ./media/active-directory-java-authenticate-users-access-control-eclipse/RelyingPartyReturnURLProduction.png
[add_cert_component]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddCertificateComponent.png
[add_jsp_file_acs]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddJSPFileACS.png
[create_acs_hello_world]: ./media/active-directory-java-authenticate-users-access-control-eclipse/CreateACSHelloWorld.png
[add_token_signing_cert]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddTokenSigningCertificate.png

<!---HONumber=58-->