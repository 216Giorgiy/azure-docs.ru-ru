<properties 
	pageTitle="Использование службы контроля доступа (Java) — руководство по компонентам Azure" 
	description="Узнайте, как разрабатывать и применять контроль доступа с использованием Java в Azure." 
	services="active-directory" 
	documentationCenter="java" 
	authors="rmcmurray" 
	manager="wpickett" 
	editor="mollybos"/>

<tags 
	ms.service="active-directory" 
	ms.workload="identity" 
	ms.tgt_pltfrm="na" 
	ms.devlang="Java" 
	ms.topic="article" 
	ms.date="09/25/2014" 
	ms.author="robmcm"/>

# Проверка подлинности веб-пользователей с помощью службы контроля доступа Azure и Eclipse

В данном руководстве рассматривается, как использовать службу Azure Access Control Service (ACS) в подключаемом модуле Azure для Eclipse с Java (от Microsoft Open Technologies). Подробнее об ACS см. в разделе [Дальнейшие действия](#next_steps).

> [WACOM.NOTE]
> Фильтр служб Azure Access Control (от Microsoft Open Technologies) - это CTP-версия. Эта предварительная версия программного обеспечения не располагает официальной поддержкой со стороны Microsoft Open Technologies, Inc. и корпорации Майкрософт.

## Оглавление

-   [Что такое ACS?][]
-   [Основные понятия][]
-   [Предварительные требования][]
-   [Создание пространства имен ACS][]
-   [Добавление поставщиков удостоверений][]
-   [Добавление приложения проверяющей стороны][]
-   [Создание правил][]
-   [Отправка сертификата в пространство имен ACS][]
-   [Просмотр страницы интеграции приложений][]
-   [Создание веб-приложения Java][]
-   [Добавление библиотеки фильтров ACS в приложение][]
-   [Развертывание в эмуляторе среды выполнения приложений][]
-   [Развертывание в Azure][]
-   [Дальнейшие действия][]

## <a name="what-is"></a>Что такое ACS?

Большинство разработчиков не являются экспертами в области удостоверений и, как правило, не хотят
тратить время на разработку алгоритмов проверки подлинности и авторизации для
своих приложений и служб. ACS - это службы Azure,
предоставляющие простой способ проверки подлинности пользователей, которым требуется доступ к
веб-приложениям и службам, без необходимости добавлять сложный
алгоритм проверки в ваш код.

В ACS доступны следующие возможности:

-   Интеграция с Windows Identity Foundation (WIF).
-   Поддержка популярных поставщиков удостоверений в Интернете, в том числе Windows Live ID, Google, Yahoo! и Facebook.
-   Поддержка служб федерации Active Directory (AD FS) 2.0.
-   Служба управления на основе Open Data Protocol (OData), предоставляющая программный доступ к параметрам ACS.
-   Портал управления, предоставляющий административный доступ к параметрам ACS.

Подробнее об ACS см. в разделе [Служба Access Control 2.0][].

## <a name="concepts"></a>Основные понятия

Служба Azure ACS построена по принципу удостоверений на основе утверждений -
это согласованный подход к созданию механизмов проверки подлинности
приложений, работающих локально или в облаке. Удостоверение на основе утверждений
предоставляет единый способ, с помощью которого приложения и службы получают
необходимые сведения об удостоверении пользователей внутри своей организации,
в других организациях и в сети Интернет.

Для выполнения задач, описанных в данном руководстве, необходимо ознакомиться со следующими
основными понятиями.

**Клиент** - в контексте данного руководства это браузер,
который пытается получить доступ к вашему веб-приложению.

**Приложение проверяющей стороны (RP)** - веб-сайт или
служба, передающая проверку подлинности одному из внешних полномочных органов. В
терминах удостоверений это можно сформулировать так: проверяющая сторона доверяет этому органу. В этом руководстве
объясняется, как настроить приложение так, чтобы оно доверяло ACS.

**Маркер** - это набор данных безопасности, который обычно
выдается после успешной проверки подлинности пользователя. Он содержит набор *утверждений*, атрибутов пользователя, прошедшего проверку подлинности. Утверждение может представлять
собой имя пользователя, идентификатор для роли, к которой принадлежит пользователь, возраст пользователя
и т. д. Маркер обычно содержит цифровую подпись. Это означает, что всегда можно
установить его источник выдачи, а его содержимое не может быть
подделано. Пользователь получает доступ к приложению проверяющей стороны путем предоставления действительного
маркера, выданного органом, которому доверяет приложение.

**Поставщик удостоверений (IP)** - орган, который проверяет подлинность
удостоверений пользователя и выдает маркеры безопасности. Фактически выдачу удостоверений
выполняет специальная служба - служба маркеров
безопасности (STS). В качестве поставщика удостоверений могут выступать Windows Live ID,
Facebook, репозитории бизнес-пользователей (например Active Directory) и т. д.
Если служба ACS настроена на доверие поставщику удостоверений, система будет принимать и
подтверждать маркеры, выданные этим поставщиком удостоверений. ACS может быть настроена на доверие нескольким поставщикам удостоверений.
Это означает, что, если ваше приложение доверяет ACS, вы можете одновременно
от своего имени предложить приложение всем пользователям, прошедшим проверку подлинности, от всех поставщиков удостоверений,
которым доверяет ACS.

**Поставщик федерации (FP)** - поставщик удостоверений, который обладает достоверными данными о пользователях,
выполняет проверку подлинности пользователей, используя их учетные данные, и выдает утверждения о том, что
ему известно о пользователях. Поставщик федерации (FP) - это другой тип
полномочного органа. Вместо непосредственной проверки подлинности пользователей он выступает в качестве
посредника при проверке подлинности между одной проверяющей стороной и одним или более
поставщиками утверждений. И поставщики утверждений, и поставщики федерации используют
службы маркеров безопасности (STS). ACS - это один из поставщиков федерации.

**Обработчик правил ACS** - алгоритм, применяемый для преобразования входящих маркеров
от доверенных поставщиков удостоверений в маркеры, предназначенные для использования проверяющей стороной. Обработчик представляет
собой набор простых правил преобразования утверждений. Обработчик правил в ACS выполняет функцию
контроля за тем, чтобы была применена логика преобразования, которую вы указали для
вашей проверяющей стороны.

**Пространство имен ACS** - раздел верхнего уровня служб ACS, который
используется для систематизации ваших параметров. Пространство имен содержит список поставщиков удостоверений, которым вы
доверяете, приложений проверяющей стороны, которые вы намерены обслуживать, правил, по которым обработчик правил
должен обрабатывать входящие маркеры, и т. д. Пространство имен
предоставляет различные конечные точки, которые будут использоваться приложением и
разработчиком для доступа к функциям ACS.

На следующем рисунке показано, как работает проверка подлинности ACS для веб-
приложения.

![ACS flow diagram][acs_flow]

1.  Клиент (в данном случае браузер) запрашивает страницу у проверяющей стороны.
2.   Поскольку запрос еще не прошел проверку подлинности, проверяющая сторона перенаправляет пользователя в полномочный орган, которому она доверяет, то есть в ACS. ACS предлагает пользователю на выбор поставщики удостоверений, указанные для этой проверяющей стороны. Пользователь выбирает соответствующего поставщика удостоверений.
3.  Клиент переходит на страницу проверки подлинности поставщика удостоверений и предлагает пользователю войти в систему.
4.  После проверки подлинности клиента (например, введенных учетных данных) поставщик удостоверений выдает маркер безопасности.
5.  После выдачи маркера безопасности поставщик удостоверений перенаправляет клиент в ACS и клиент отправляет маркер безопасности, выданный поставщиком, в ACS.
6.  ACS проверяет маркер безопасности, выданный поставщиком удостоверений, вводит идентификационные утверждения из этого маркера в обработчик правил ACS, вычисляет выходные идентификационные утверждения и выдает новый маркер безопасности, содержащий эти выходные утверждения.
7.   ACS перенаправляет клиент к проверяющей стороне. Клиент отправляет новый маркер безопасности, выданный службой ACS, проверяющей стороне. Проверяющая сторона проверяет подпись маркера безопасности, выданного службой ACS, также проверяет утверждения в этом маркере и возвращает первоначально запрошенную страницу.

## <a name="pre"></a>Предварительные требования

Для выполнения задач в этом руководстве вам потребуется следующее:

- Java Developer Kit (JDK), версия 1.6 или более поздняя.
- Интегрированная среда разработки Eclipse для разработчиков Java EE, версия Indigo или более поздняя. Ее можно загрузить с веб-страницы <http://www.eclipse.org/downloads/>. 
- Дистрибутив веб-сервера или сервера приложений на основе Java, например Apache Tomcat, GlassFish, сервера приложений JBoss или Jetty.
- Подписка на Azure, которую можно получить на веб-странице http://www.microsoft.com/windowsazure/offers/.
- Подключаемый модуль Azure для Eclipse с Java (на основе Microsoft Open Technologies), выпуск от апреля 2014 г. Подробнее см. в разделе [Установка подключаемого модуля Azure для Eclipse с Java (от Microsoft Open Technologies)](http://msdn.microsoft.com/library/windowsazure/hh690946.aspx).
- Сертификат X.509 для использования с приложением. Этот сертификат потребуется в обоих форматах: открытый сертификат (CER) и файл обмена личной информацией (PFX). (Возможности для создания этого сертификата будут описаны далее в этом руководстве.)
- Знакомство с эмулятором среды выполнения приложений Azure и методами развертывания, которые обсуждаются в разделе [Создание приложения Hello World для Azure в Eclipse](http://msdn.microsoft.com/library/windowsazure/hh690944.aspx).

## <a name="create-namespace"></a>Создание пространства имен ACS

Чтобы начать пользоваться службой Access Control (ACS) в Azure, необходимо
создать пространство имен ACS. Пространство имен предоставляет уникальную область для
адресации ресурсов ACS из вашего приложения.

1. Выполните вход на [портал управления Azure](https://manage.windowsazure.com).
2. Щелкните **Active Directory**. 
3. Чтобы создать новое пространство имен Access Control, последовательно щелкните **Создать**, **Службы приложений**, **Access Control** и **Быстрое создание**. 
4. Введите имя для пространства имен. Служба Azure проверит, является ли имя уникальным.
5. Выберите регион, в котором используется пространство имен. Для максимальной эффективности используйте регион, в котором развертывается приложение.
6. Если у вас имеется несколько подписок, выберите ту, которую следует использовать для пространства имен ACS.
7. Щелкните **Создать**.

Azure создает и активирует пространство имен. Прежде чем продолжить, дождитесь, когда пространство имен перейдет в состояние **Активно**. 

## <a name="add-IP"></a>Добавление поставщиков удостоверений

В этой задаче вы добавляете поставщиков удостоверений, которые будут использоваться с приложением проверяющей стороны для
проверки подлинности. В качестве примера в этой задаче рассматривается, как добавить
Windows Live IP в качестве поставщика удостоверений , но вы можете использовать любого поставщика удостоверений из списка на портале
управления службы ACS.


1.   На [портале управления Azure][] щелкните **Active Directory**, выберите пространство имен Access Control и щелкните **Управление**. Откроется портал управления ACS.
2.   В левой области навигации портала управления ACS щелкните **Поставщики удостоверений**.
3.   Windows Live ID включен по умолчанию и не может быть удален. В данном учебнике используется только Windows Live ID. Однако на этом экране можно добавлять и других поставщиков удостоверений, нажав кнопку **Добавить**.

Теперь Windows Live ID используется в качестве поставщика удостоверений для вашего пространства имен ACS. Далее вы должны
указать ваше веб-приложение Java (будет создано позже) в качестве проверяющей стороны.

## <a name="add-RP"></a>Добавление приложения проверяющей стороны

В этой задаче ACS настраивается для распознавания вашего веб-приложения
Java как допустимого приложения проверяющей стороны.

1.  На портале управления ACS щелкните **Приложения проверяющей стороны**.
2.   На странице **Приложения проверяющей стороны** щелкните **Добавить**.
3.   На странице **Добавить приложение проверяющей стороны** выполните следующие действия.
    1.   В поле **Имя** введите имя проверяющей стороны. Для рассматриваемого примера необходимо ввести **Azure Web
        App**.
    2.   В поле **Режим** выберите **Ввод параметров вручную**.
    3.   В поле **Область**, введите URI, к которому применяется маркер безопасности, выданный ACS. Для рассматриваемой задачи введите **http://localhost:8080/**.

        ![Relying party realm for use in compute emulator][relying_party_realm_emulator]
    4.   В поле **URL возврата** введите URL-адрес, по которому ACS возвращает маркер безопасности. Для данной задачи введите **http://localhost:8080/MyACSHelloWorld/index.jsp**

        ![Relying party return URL for use in compute emulator][relying_party_return_url_emulator]
    5.  Примите значения по умолчанию в остальных полях.

4.  Щелкните **Сохранить**.

Вы сконфигурировали ваше веб-приложение Java, работающее в эмуляторе вычислений Azure (на
http://localhost:8080/), в качестве поставщика удостоверений в вашем пространстве имен ACS. Теперь необходимо создать
правила, которые будут использоваться ACS при обработке утверждений для проверяющей стороны.

## <a name="create-rules"></a>Создание правил

В этой задаче задаются правила, которые определяют способ передачи
проверяющей стороне утверждений от поставщиков удостоверений. В данном руководстве мы рассмотрим упрощенный вариант настройки
ACS для копирования типов и значений входящих утверждений непосредственно в исходящий
маркер без их фильтрации или изменения.

1.   На главной странице портала управления ACS щелкните **Группы правил**.
2.   На странице **Группы правил** щелкните **Группа правил по умолчанию для Azure Web App**.
3.   На странице **Изменить группу правил** щелкните **Создать**.
4.  На странице **Создать правила: группа правил по умолчанию для Azure Web App** убедитесь, что установлен флажок для Windows Live ID, затем щелкните **Создать**.	
5.   На странице **Изменить группу правил** щелкните **Сохранить**.

## <a name="upload-certificate"></a>Отправка сертификата в пространство имен ACS

В этой задаче отправляется PFX-сертификат, который будет использоваться для подписи запросов маркера, созданных пространством имен ACS.

1.   На главной странице портала управления ACS щелкните **Сертификаты и ключи**.
2.   На странице **Сертификаты и ключи** щелкните **Добавить** над полем **Подпись маркеров**.
3.   На странице **Добавить сертификат или ключ для подписи маркера** сделайте следующее.
    1. В разделе **Используется для** щелкните **Приложение проверяющей стороны** и выберите **Azure Web App** (которое было указано ранее в качестве имени вашего приложения проверяющей стороны).
    2. В разделе **Тип** выберите **Сертификат X.509**.
    3. В разделе **Сертификат** нажмите кнопку обзора и перейдите к файлу сертификата X.509, который нужно использовать. Это будет PFX-файл. Выберите файл, щелкните **Открыть**,   затем введите пароль сертификата в поле **Пароль**. Имейте в виду, что для целей тестирования можно использовать самозаверяющий сертификат. Чтобы создать самозаверяющий сертификат, нажмите кнопку **Создать** в диалоговом окне **Библиотека фильтров ACS** (описывается далее) или программу **encutil.exe** из [веб-сайта проекта][] для Azure Starter Kit for Java (от Microsoft Open Technologies).
    4. Убедитесь, что установлен флажок **Назначить основным**. Страница **Добавить сертификат или ключ для подписи маркера** должна выглядеть следующим образом.

        ![Add token-signing certificate][add_token_signing_cert]
    5. Щелкните **Сохранить**, чтобы сохранить настройки и закрыть страницу **Добавить сертификат или ключ для подписи маркера**.

Затем просмотрите сведения на странице интеграции приложений и
скопируйте URL-адрес, который потребуется для настройки вашего веб-
приложения Java на использование ACS.

## <a name="review-app-int"></a>Просмотр страницы интеграции приложений

Всю информацию и программный код, необходимые для настройки
вашего веб-приложения Java для работы с ACS,
можно найти на странице интеграции приложений на портале управления ACS. Эта информация
необходима для настройки вашего веб-приложения Java для
федеративной проверки подлинности.

1.   На портале управления ACS щелкните **Интеграция приложений**.  
2.   На странице **Интеграция приложений** щелкните **Страницы входа**.
3.   На странице **Интеграция страниц входа** щелкните **Azure Web App**.

На странице **Интеграция страниц входа: Azure Web App** URL-адрес, указанный в поле **Параметр 1: ссылка на страницу входа, размещаемую в ACS**, будет использоваться в веб-приложении Java. Это значение потребуется при добавлении библиотеки фильтров служб Azure Access Control в приложение Java.

## <a name="create-java-app"></a>Создание веб-приложения Java
1. В меню Eclipse выберите **Файл**, щелкните **Создать**, затем щелкните **Динамический веб-проект**. (Если элемента **Динамический веб-проект** нет в списке доступных проектов после выбора пунктов **Файл**, **Создать**, выполните следующие действия. Щелкните **Файл**, **Создать**, **Проект**, разверните вложенный список **Интернет**, щелкните **Динамический веб-проект** и нажмите кнопку **Далее**.) Для целей данного учебника присвойте проекту имя **MyACSHelloWorld**. (Обязательно используйте это имя, на последующих шагах в учебнике предполагается, что WAR-файл должен называться MyACSHelloWorld.) Экран будет примерно выглядеть так.

    ![Create a Hello World project for ACS exampple][create_acs_hello_world]

    Нажмите кнопку **Готово**.
2. В окне обозревателя проектов в Eclipse разверните узел **MyACSHelloWorld**. Щелкните правой кнопкой мыши **WebContent**, выберите **Создать**, затем щелкните **JSP-файл**.
3. В диалоговом окне **Новый JSP-файл** укажите для файла имя **index.jsp**. Сохраните родительскую папку под именем MyACSHelloWorld/WebContent, как показано далее.

    ![Add a JSP file for ACS example][add_jsp_file_acs]

    Щелкните **Далее**.

4. В диалоговом окне **Выберите шаблон JSP** выберите **Новый JSP-файл (html)** и нажмите кнопку **Готово**.
5. При открытии файла index.jsp в Eclipse добавьте в текст для отображения фразу **Hello ACS World!** в существующем элементе `<body>`. Обновленное содержимое элемента `<body>` должно иметь следующий вид.

        <body>
          <b><% out.println("Hello ACS World!"); %></b>
        </body>
    
    Сохраните index.jsp.
  
## <a name="add_acs_filter_library"></a>Добавление библиотеки фильтров ACS в приложение

1. В обозревателе проектов Eclipse щелкните правой кнопкой мыши **MyACSHelloWorld**, выберите **Путь построения**, затем щелкните **Настроить путь построения**.
2. В диалоговом окне **Путь построения Java** перейдите на вкладку **Библиотеки**.
3. Щелкните **Добавить библиотеку**.
4. Щелкните **Фильтр служб Azure Access Control (от MS Open Tech)** и нажмите кнопку **Далее**. Появится диалоговое окно **Фильтр служб Azure Access Control**.  (Путь, указанный в поле **Расположение**, зависит от места, в которое вы установили Eclipse, а номер версии зависит от установленных обновлений.)

    ![Add ACS Filter library][add_acs_filter_lib]

5. С помощью браузера откройте страницу **Интеграция страниц входа** на портале управления, скопируйте URL-адрес, указанный в поле **Параметр 1: ссылка на страницу входа, размещаемую в ACS**, и вставьте его в поле **Конечная точка проверки подлинности ACS** в диалоговом окне Eclipse.
6. С помощью браузера откройте страницу **Изменение приложения проверяющей стороны** на портале управления, скопируйте URL-адрес, указанный в поле **Область**, и вставьте его в поле **Область проверяющей стороны** в диалоговом окне Eclipse.
7. В разделе **Безопасность** диалогового окна Eclipse, если хотите использовать существующий сертификат, щелкните **Обзор**, перейдите к нужному сертификату, выберите его и щелкните **Открыть**. Если же вы хотите создать новый сертификат, щелкните **Создать** для отображения диалогового окна **Новый сертификат**, затем укажите пароль, имя CER-файла и имя PFX-файла для нового сертификата.
8. Установите флажок **Внедрить сертификат в WAR-файл**. При таком внедрении сертификат включается в ваше развертывание и его не требуется вручную добавлять в качестве компонента. (Если же вам необходимо сохранить сертификат вне WAR-файла, вы можете добавить сертификат в качестве компонента роли и снять флажок **Внедрить сертификат в WAR-файл**.)
9. [Необязательно] Оставьте установленный флажок **Требовать соединения HTTPS**. Если этот флажок установлен, для доступа к приложению необходимо использовать протокол HTTPS. Если вы не собираетесь запрашивать подключения HTTPS, снимите этот флажок.
10. Для развертывания в эмуляторе среды выполнения приложений ваши параметры **фильтра Azure ACS** будут выглядеть примерно следующим образом.

    ![Azure ACS Filter settings for a deployment to the compute emulator][add_acs_filter_lib_emulator]

11. Нажмите кнопку **Готово**.
12. Щелкните **Да** при появлении диалогового окна с сообщением о создании файла web.xml.
13. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Путь построения Java**.

## <a name="deploy_compute_emulator"></a>Развертывание в эмуляторе среды выполнения приложений

1. В обозревателе проектов Eclipse щелкните правой кнопкой мыши **MyACSHelloWorld**, выберите **Azure**, затем щелкните **Пакет для Azure**.
2. В поле **Имя проекта** введите **MyAzureACSProject** и нажмите кнопку **Далее**.
3. Выберите JDK и сервер приложений. (Эти шаги подробно описаны в руководстве [Создание приложения Hello World для Azure в Eclipse](http://msdn.microsoft.com/library/windowsazure/hh690944.aspx).)
4. Нажмите кнопку **Готово**.
5. Нажмите кнопку **Запуск в эмуляторе Azure**.
6. После запуска веб-приложения Java в эмуляторе среды выполнения приложений закройте все экземпляры браузера (чтобы все текущие сеансы браузера не мешали тестированию входа в ACS).
7. Запустите приложение, открыв ссылку <http://localhost:8080/MyACSHelloWorld/> в браузере (или <https://localhost:8080/MyACSHelloWorld/>, если установлен флажок **Требуются HTTPS-подключения**). Вам будет предложено войти в Windows Live ID, а затем вы будет перенаправлены на URL-адрес возврата, указанный для приложения проверяющей стороны.
99.   По завершении просмотра приложения нажмите кнопку **Сброс эмулятора Azure**.

## <a name="deploy_azure"></a>Развертывание в Azure

Для развертывания в Azure необходимо изменить область действия проверяющей стороны и URL-адрес возврата для пространства имен ACS.

1. На портале управления Azure на странице **Изменение приложения проверяющей стороны** измените значение **Область** на URL-адрес развернутого сайта. Замените **example** DNS-именем, указанным для вашего развертывания.

    ![Relying party realm for use in production][relying_party_realm_production]

2. Измените **URL-адрес возврата** на URL-адрес приложения. Замените **example** DNS-именем, указанным для вашего развертывания.

    ![Relying party return URL for use in production][relying_party_return_url_production]

3. Щелкните **Сохранить**, чтобы сохранить обновленную область действия проверяющей стороны и изменение URL-адреса возврата.
4. Оставьте в браузере открытой страницу **Интеграция страниц входа** - вам скоро потребуется копировать с нее данные.
5. В обозревателе проектов Eclipse щелкните правой кнопкой мыши **MyACSHelloWorld**, выберите **Путь построения**, затем щелкните **Настроить путь построения**.
6. Перейдите на вкладку **Библиотеки**, щелкните **Фильтр служб Azure Access Control** и нажмите кнопку **Изменить**.
7. С помощью браузера откройте страницу **Интеграция страниц входа** на портале управления, скопируйте URL-адрес, указанный в поле **Параметр 1: ссылка на страницу входа, размещаемую в ACS**, и вставьте его в поле **Конечная точка проверки подлинности ACS** в диалоговом окне Eclipse.
8. С помощью браузера откройте страницу **Изменение приложения проверяющей стороны** на портале управления, скопируйте URL-адрес, указанный в поле **Область**, и вставьте его в поле **Область проверяющей стороны** в диалоговом окне Eclipse.
9. В разделе **Безопасность** диалогового окна Eclipse, если хотите использовать существующий сертификат, щелкните **Обзор**, перейдите к нужному сертификату, выберите его и щелкните **Открыть**. Если же вы хотите создать новый сертификат, щелкните **Создать** для отображения диалогового окна **Новый сертификат**, затем укажите пароль, имя CER-файла и имя PFX-файла для нового сертификата.
10. Оставьте установленный флажок **Внедрить сертификат в WAR-файл**, если вы хотите внедрить сертификат в WAR-файл.
11. [Необязательно] Оставьте установленный флажок **Требовать соединения HTTPS**. Если этот флажок установлен, для доступа к приложению необходимо использовать протокол HTTPS. Если вы не собираетесь запрашивать подключения HTTPS, снимите этот флажок.
12. Для развертывания в Azure ваши параметры фильтра Azure ACS будут выглядеть следующим образом.

    ![Azure ACS Filter settings for a production deployment][add_acs_filter_lib_production]

13. Нажмите **Готово** для закрытия диалогового окна **Изменить библиотеку**.
14. Нажмите кнопку **ОК** для закрытия диалогового окна **Свойства MyACSHelloWorld**.
15. В Eclipse нажмите кнопку **Опубликовать в облаке Azure**. На запросы отвечайте примерно так, как это сделано в подразделе **Развертывание приложения в Azure** раздела [Создание приложения Hello World для Azure в Eclipse](http://msdn.microsoft.com/library/windowsazure/hh690944.aspx). 

После развертывания веб-приложения закройте все открытые сеансы браузера и запустите веб-приложение. Вам будет предложено выполнить вход с учетными данными Windows Live ID, а затем произойдет отправка на URL-возврата приложения проверяющей стороны.

После применения приложения ACS Hello World не забудьте удалить развертывание (сведения об удалении развертывания см. в разделе [Создание приложения Hello World для Azure в Eclipse](http://msdn.microsoft.com/library/windowsazure/hh690944.aspx)).


## <a name="next_steps"></a>Дальнейшие действия

Сведения о языке SAML (Security Assertion Markup Language), возвращаемом службой ACS в приложение, см. в разделе [Как просматривать SAML, возвращенный службой Azure Access Control][]. Чтобы продолжить изучение функций ACS и поэкспериментировать с более сложными сценариями, см. раздел [Служба Access Control 2.0][].

Кроме того, в этом примере используется параметр **Внедрить сертификат в WAR-файл**. Этот параметр упрощает развертывание сертификата. Если вместо этого вы хотите подписать сертификат отдельно от WAR-файла, можно использовать следующий способ.

1. В разделе **Безопасность** диалогового окна **Фильтр служб Azure Access Control** введите **$env.JAVA_HOME/mycert.cer** и снимите флажок **Встроить сертификат в WAR-файл**. (Если имя вашего файла сертификата отличается, настройте mycert.cer.) Нажмите кнопку **Готово**, чтобы закрыть диалоговое окно.
2. Скопируйте сертификат как компонент развертывания. В обозревателе проектов Eclipse разверните узел **MyAzureACSProject**, щелкните правой кнопкой мыши **WorkerRole1**, выберите **Свойства**, разверните узел **Роль Azure** и щелкните **Компоненты**.
3. Щелкните **Добавить**.
4. В диалоговом окне **Добавить компонент** выполните следующие действия.
    1. В разделе **Импорт**:
        1. с помощью кнопки **Файл** перейдите к нужному сертификату; 
        2. для параметра **Метод** выберите **copy**;
    2. для параметра **Как имя** щелкните текстовое поле и примите имя по умолчанию.
    3. В разделе **Развертывание**:
        1. для параметра **Метод** выберите **copy**;
        2. в поле **Каталог назначения** введите **%JAVA**HOME%.
    4. Ваше диалоговое окно **Добавить компонент** должно выглядеть следующим образом.

        ![Add certificate component][add_cert_component]

    5.  Нажмите кнопку **ОК**.

На этом этапе ваш сертификат должен быть включен в развертывание. Обратите внимание, что независимо от того, внедряется ли сертификат в WAR-файл или добавляется в качестве компонента в развертывание, необходимо отправить сертификат в пространство имен, как описано в разделе [Отправка сертификата в пространство имен ACS][].

[Что такое ACS?]: #what-is
[Основные понятия]: #concepts
[Предварительные требования]: #pre
[Создание веб-приложения Java]: #create-java-app
[Создание пространства имен ACS]: #create-namespace
[Добавление поставщиков удостоверений]: #add-IP
[Добавление приложения проверяющей стороны]: #add-RP
[Создание правил]: #create-rules
[Отправка сертификата в пространство имен ACS]: #upload-certificate
[Просмотр страницы интеграции приложений]: #review-app-int
[Настройка доверия между службой ACS и веб-приложением ASP.NET]: #config-trust
[Добавление библиотеки фильтров ACS в приложение]: #add_acs_filter_library
[Развертывание в эмуляторе среды выполнения приложений]: #deploy_compute_emulator
[Развертывание в Azure]: #deploy_azure
[Дальнейшие действия]: #next_steps
[веб-сайта проекта]: http://wastarterkit4java.codeplex.com/releases/view/61026
[Как просматривать SAML, возвращенный службой Azure Access Control]: /ru-ru/develop/java/how-to-guides/view-saml-returned-by-acs/
[Служба Access Control 2.0]: http://go.microsoft.com/fwlink/?LinkID=212360
[Windows Identity Foundation]: http://www.microsoft.com/download/en/details.aspx?id=17331
[Windows Identity Foundation (SDK)]: http://www.microsoft.com/download/en/details.aspx?id=4451
[Портал управления Azure]: https://manage.windowsazure.com
[портале управления Azure]: https://manage.windowsazure.com
[acs_flow]: ./media/active-directory-java-authenticate-users-access-control-eclipse/ACSFlow.png

<!-- Eclipse-specific -->
[add_acs_filter_lib]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddACSFilterLibrary.png
[add_acs_filter_lib_emulator]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddACSFilterLibraryEmulator.png
[add_acs_filter_lib_production]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddACSFilterLibraryProduction.png

[relying_party_realm_emulator]: ./media/active-directory-java-authenticate-users-access-control-eclipse/RelyingPartyRealmEmulator.png
[relying_party_return_url_emulator]: ./media/active-directory-java-authenticate-users-access-control-eclipse/RelyingPartyReturnURLEmulator.png
[relying_party_realm_production]: ./media/active-directory-java-authenticate-users-access-control-eclipse/RelyingPartyRealmProduction.png
[relying_party_return_url_production]: ./media/active-directory-java-authenticate-users-access-control-eclipse/RelyingPartyReturnURLProduction.png
[add_cert_component]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddCertificateComponent.png
[add_jsp_file_acs]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddJSPFileACS.png
[create_acs_hello_world]: ./media/active-directory-java-authenticate-users-access-control-eclipse/CreateACSHelloWorld.png
[add_token_signing_cert]: ./media/active-directory-java-authenticate-users-access-control-eclipse/AddTokenSigningCertificate.png

<!--HONumber=46--> 
