---
title: Настройка токена, сеанса и единого входа в Azure Active Directory B2C | Документация Майкрософт
description: Конфигурация токена, сеанса и единого входа в Azure Active Directory B2C.
services: active-directory-b2c
author: davidmu1
manager: mtillman
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 11/30/2018
ms.author: davidmu
ms.component: B2C
ms.openlocfilehash: c93bc018aea92a63adac4889d9496356543c1e52
ms.sourcegitcommit: 11d8ce8cd720a1ec6ca130e118489c6459e04114
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2018
ms.locfileid: "52842736"
---
# <a name="token-session-and-single-sign-on-configuration-in-azure-active-directory-b2c"></a>Конфигурация токена, сеанса и единого входа в Azure Active Directory B2C

Эта возможность обеспечивает более точный контроль [для каждого потока пользователя](active-directory-b2c-reference-policies.md) над следующими параметрами.

- Время существования маркеров безопасности, выдаваемых Azure Active Directory (Azure AD) B2C.
- Время существования сеансов веб-приложения, управляемых Azure AD B2C.
- Форматы важных утверждений в маркерах безопасности, создаваемых Azure AD B2C.
- Поведение единого входа (SSO) в нескольких приложениях и потоках пользователя в арендаторе Azure AD B2C.

Эту функцию можно использовать с любым типом политики, но здесь мы демонстрируем только работу с потоком пользователя для входа или регистрации. Для встроенных политик можно применить эту функцию в каталоге Azure AD B2C следующим образом:

1. Щелкните **Потоки пользователя**.
2. Откройте нужный поток пользователя, щелкнув его. Например, щелкните **B2C_1_SiUpIn**.
3. Щелкните **Свойства**.
4. В разделе **Параметры совместимости маркеров** внесите нужные изменения. Сведения о доступных свойствах см. в последующих разделах.
5. Нажмите кнопку **Сохранить** в верхней части меню.

## <a name="token-lifetimes-configuration"></a>Конфигурация времени существования маркеров

Azure AD B2C поддерживает [протокол авторизации OAuth 2.0](active-directory-b2c-reference-protocols.md) для включения безопасного доступа к защищенным ресурсам. Для реализации этой поддержки Azure AD B2C выдает различные [маркеры безопасности](active-directory-b2c-reference-tokens.md). 

Для управления временем существования маркеров безопасности, выдаваемых Azure AD B2C, используются следующие свойства.

- **Время существования маркера доступа и маркера идентификатора (в минутах)**. Время существования маркера носителя OAuth 2.0, используемого для получения доступа к защищенному ресурсу.
    - Значение по умолчанию — 60 минут.
    - Минимум (включительно) — 5 минут.
    - Максимум (включительно) — 1440 минут.
- **Время существования маркера обновления (в днях)**. Максимальный период времени, до наступления которого маркер обновления может использоваться для получения нового маркера доступа или маркера идентификатора (и при необходимости для получения нового маркера обновления, если приложению была предоставлена область `offline_access`).
    - Значение по умолчанию — 14 дней.
    - Минимум (включительно) — 1 день.
    - Максимум (включительно) — 90 дней.
- **Скользящее время существования маркера обновления (в днях)**. По истечении этого периода времени пользователь должен будет повторно пройти проверку подлинности независимо от срока действия самого последнего маркера обновления, полученного приложением. Он предоставляется, только если установлен переключатель **Ограничено**. Значение должно быть больше или равно значению **времени существования маркера обновления (в днях)**. Если установлен переключатель **Не ограничено**, указать конкретное значение нельзя.
    - Значение по умолчанию — 90 дней.
    - Минимум (включительно) — 1 день.
    - Максимум (включительно) — 365 дней.

Если использовать свойства, которые приведены ниже, будут включены следующие варианты использования.

- Предоставление пользователю возможности находиться в мобильном приложении сколь угодно долго до тех пор, пока он активно его использует. Можно установить переключатель **Скользящее время существования маркера обновления (в днях)** в положение **Не ограничено** в свойствах потока пользователя для входа.
- Обеспечение соответствия нормам и требованиям безопасности путем задания соответствующих значений времени существования маркера доступа.

Эти параметры недоступны в потоке пользователя для сброса пароля. 

## <a name="token-compatibility-settings"></a>Параметры маркеров совместимости

Чтобы разрешить клиентам что-либо настраивать (по их требованию), воспользуйтесь следующими свойствами.

- **Утверждение издателя (iss)**. Это свойство определяет клиента Azure AD B2C, выдавшего маркер.
    - `https://<domain>/{B2C tenant GUID}/v2.0/`. Это значение по умолчанию.
    - `https://<domain>/tfp/{B2C tenant GUID}/{Policy ID}/v2.0/`. Это значение включает идентификаторы для арендатора B2C и потока пользователя, которые используются в запросе маркера. Если приложению или библиотеке требуется Azure AD B2C для соответствия [спецификации OpenID Connect Discovery 1.0](https://openid.net/specs/openid-connect-discovery-1_0.html), используйте это значение.
- **Утверждение субъекта (sub)**. Это свойство определяет сущность, для которой маркер подтверждает информацию.
    - **ObjectID**. Значение этого свойства является значением по умолчанию. Добавляет идентификатор объекта пользователя из каталога в утверждение `sub` в маркере.
    - **Не поддерживается**. Это свойство указывается только для обратной совместимости. Мы рекомендуем переключиться на свойство **ObjectID**, как только это станет возможно.
- **Идентификатор политики, представляющей утверждения** Это свойство определяет тип утверждения, в котором заполняется идентификатор политики, используемый в запросе маркера.
    - **tfp**. Значение этого свойства является значением по умолчанию.
    - **acr**. Это свойство указывается только для обратной совместимости.

## <a name="session-behavior"></a>Режим работы сеанса

Azure AD B2C поддерживает [протокол проверки подлинности OpenID Connect](active-directory-b2c-reference-oidc.md) для включения безопасного входа в веб-приложения. Следующие свойства можно использовать для управления сеансами веб-приложения.

- **Время существования сеанса веб-приложения (в минутах)**. Время существования файла cookie сеанса Azure AD B2C, сохраненного в браузере пользователя после успешной проверки подлинности.
    - Значение по умолчанию — 1440 минут.
    - Минимум (включительно) — 15 минут.
    - Максимум (включительно) — 1440 минут.
- **Время ожидания сеанса веб-приложения**. Если этот переключатель установлен в положение **Абсолютное**, пользователь вынужден повторно пройти проверку подлинности по истечении периода времени, заданного параметром **Время существования сеанса веб-приложения (в минутах)**. Если этот переключатель установлен в положение **Скользящее** (по умолчанию), пользователь может находиться в веб-приложении сколь угодно долго до тех пор, пока он активно его использует.

Если использовать свойства, которые приведены ниже, будут включены следующие варианты использования.

- Обеспечение соответствия нормам и требованиям безопасности путем задания соответствующих значений времени существования сеанса веб-приложения.
- Применение принудительной проверки подлинности по истечении заданного периода во время взаимодействия пользователя с высокозащищенной частью веб-приложения. 

Эти параметры недоступны в потоке пользователя для сброса пароля.

## <a name="single-sign-on-sso-configuration"></a>Конфигурация единого входа (SSO)

Если в арендаторе B2C используются несколько приложений и потоков пользователя, для управления взаимодействиями между ними можно использовать свойство **Конфигурация единого входа**. Этому свойству можно задать одно из указанных далее значений.

- **Клиент**. Это значение по умолчанию. Если выбрано это значение, несколько приложений и потоков пользователя в клиенте B2C могут совместно использовать один и тот же сеанс пользователя. Например, когда пользователь входит в приложение, он также может легко войти в другое приложение, например, Contoso Pharmacy, непосредственно во время доступа к нему.
- **Приложение**. Значение этого параметра позволяет поддерживать сеанс пользователя исключительно для одного приложения и независимо от других приложений. Например, если требуется, чтобы пользователь выполнял вход в приложение Contoso Pharmacy (с теми же учетными данными), даже если пользователь уже выполнил вход в Contoso Shopping, другое приложение на том же клиенте B2C. 
- **Политика**. Этот параметр позволяет поддерживать эксклюзивный сеанс пользователя для определенного потока пользователя, независимо от использующих его приложений. Например, если пользователь уже выполнил вход и прошел этап многофакторной проверки подлинности (MFA), он может получить доступ к более защищенным частям нескольких приложений, который будет действовать, пока не истечет срок действия сеанса, связанного с потоком пользователя.
- **Отключено**. Если для параметра задано это значение, то пользователь должен осуществлять весь поток пользователя при каждом выполнении политики. Например, несколько пользователей могут зарегистрироваться в приложении (в сценарии с использованием общего рабочего стола), даже если все это время с приложением работает один пользователь.

Эти параметры недоступны в потоке пользователя для сброса пароля. 

