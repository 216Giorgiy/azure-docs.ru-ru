---
title: "Azure Active Directory B2C: запрос маркеров доступа | Документация Майкрософт"
description: "В этой статье описывается, как настроить клиентское приложение и получить маркер доступа."
services: active-directory-b2c
documentationcenter: android
author: parakhj
manager: krassk
editor: 
ms.assetid: 1c75f17f-5ec5-493a-b906-f543b3b1ea66
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/16/2017
ms.author: parakhj
ms.translationtype: Human Translation
ms.sourcegitcommit: 80be19618bd02895d953f80e5236d1a69d0811af
ms.openlocfilehash: 7a28c92e921354cd4a623af29098a40e1c8b56b0
ms.contentlocale: ru-ru
ms.lasthandoff: 06/07/2017


---
# <a name="azure-ad-b2c-requesting-access-tokens"></a>Azure AD B2C: запрос маркеров доступа

Маркер доступа (обозначается как **access\_token**) является разновидностью маркеров безопасности, с помощью которого клиенты могут получить доступ к ресурсам, защищенным [сервером авторизации](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-reference-protocols#the-basics), таким как веб-API. Они представлены в виде [маркеров JWT](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-reference-tokens#types-of-tokens) и содержат сведения о целевом сервере ресурсов и предоставленных разрешениях для сервера. При вызове сервера ресурсов маркер доступа должен присутствовать в HTTP-запросе.

В этой статье описывается, как настроить клиентское приложение и выполнить запрос, чтобы получить **access\_token** из конечных точек `authorize` и `token`.

> [!NOTE]
> **Цепочки веб-API ("от имени") не поддерживаются в Azure AD B2C.**
>
> Многие архитектуры включают в себя веб-API, которому требуется вызывать другой нисходящий веб-API. При этом Azure AD B2C защищает оба интерфейса. Этот сценарий характерен для собственных клиентов с внутренним веб-API, который в свою очередь вызывает службу Microsoft Online, например API Graph Azure AD.
>
> Этот сценарий веб-API с цепочками может поддерживаться с помощью предоставления учетных данных носителя маркера JWT OAuth 2.0 или потока On-Behalf-Of. Однако в Azure AD B2C поток On-Behalf-Of еще не реализован.

## <a name="prerequisite"></a>Предварительные требования

Прежде чем запрашивать маркер доступа, сначала необходимо зарегистрировать веб-API и опубликовать разрешения, которые могут быть предоставлены клиентскому приложению. Сначала выполните действия, приведенные в разделе [Регистрация веб-API](active-directory-b2c-app-registration.md#register-a-web-api).

## <a name="granting-permissions-to-a-web-api"></a>Предоставление разрешений для веб-API

Воспользуйтесь порталом Azure, чтобы предоставить клиентскому приложению соответствующие разрешения для API. Сделайте следующее:

1. Перейдите к меню **Приложения** в колонке функций B2C.
1. Зарегистрируйте клиентское приложение ([веб-приложение](active-directory-b2c-app-registration.md#register-a-web-application) или [собственный клиент](active-directory-b2c-app-registration.md#register-a-mobilenative-application)), если у вас еще его нет.
1. В колонке "Параметры" вашего приложения выберите **Доступ к API**.
1. Щелкните **Добавить**.
1. Выберите веб-API и области (разрешения), которые нужно предоставить.
1. Нажмите кнопку **ОК**.

> [!NOTE]
> Для Azure AD B2C не нужно предоставлять согласие пользователей клиентского приложения. Вместо этого требуется согласие администратора, которое определяется на основе разрешений, настроенных для приложений, как описано выше. Если отозвать разрешение для приложения, все пользователи, которые могли получить это разрешение, больше не смогут его использовать.

## <a name="requesting-a-token"></a>Запрос маркера

Чтобы получить маркер доступа для приложения ресурсов, для клиентского приложения нужно указать необходимые разрешения в параметре **scope** запроса. Например, чтобы получить разрешение на чтение для приложения ресурсов с URI идентификатора приложения `https://contoso.onmicrosoft.com/notes`, нужно задать область `https://contoso.onmicrosoft.com/notes/read`. Ниже приведен пример запроса кода авторизации к конечной точке `authorize`.

> [!NOTE]
> На этом этапе пользовательские домены и маркеры доступа не поддерживаются. В URL-адресе запроса следует использовать домен yourtenantId.onmicrosoft.com.

```
https://login.microsoftonline.com/<yourTenantId>.onmicrosoft.com/oauth2/v2.0/authorize?p=<yourPolicyId>&client_id=<appID_of_your_client_application>&nonce=anyRandomValue&redirect_uri=<redirect_uri_of_your_client_application>&scope=https%3A%2F%2Fcontoso.onmicrosoft.com%2Fnotes%2Fread&response_type=code 
```

Чтобы получить несколько разрешений в одном запросе, можно добавить несколько записей в одном параметре **scope**, разделив их пробелами. Например:

Декодированный URL-адрес:

```
scope=https://contoso.onmicrosoft.com/notes/read openid offline_access
```

Закодированный URL-адрес:

```
scope=https%3A%2F%2Fcontoso.onmicrosoft.com%2Fnotes%2Fread%20openid%20offline_access
```

Для ресурса можно запросить больше областей или разрешений, чем предоставлено для клиентского приложения. В таком случае вызов будет успешным, если будет предоставлено хотя бы одно разрешение. Утверждение scp полученного маркера **access\_token** будет заполнено только успешно предоставленными разрешениями.

> [!NOTE] 
> Запросы разрешений для двух разных веб-ресурсов не поддерживаются в одном и том же запросе. Такой запрос завершится ошибкой.

### <a name="special-cases"></a>Особые случаи

Стандартное утверждение OpenID Connect определяет несколько специальных значений scope. Следующие специальные области представляют право доступа к профилю пользователя:

* **openid** — запрашивает маркер идентификатора;
* **offline\_access** — запрашивает маркер обновления с помощью потоков кода проверки подлинности.

Если параметр response\_type в запросе `authorize` содержит token, параметр scope должен включать по крайней мере одно разрешение для предоставленного ресурса (отличное от openid и offline\_access). В противном случае запрос `authorize` завершится ошибкой.

## <a name="the-returned-token"></a>Возвращаемый маркер

Успешно созданный **access\_token** (из конечной точки `authorize` или `token`) будет содержать следующие утверждения:

| Имя | Утверждение | Описание |
| --- | --- | --- |
|Аудитория |`aud` |\*Идентификатор приложения\* одного ресурса, к которому предоставляет доступ маркер. |
|Область |`scp` |Разрешения, предоставляемые ресурсу. Несколько предоставленных разрешений разделяются пробелами. |
|Авторизованная сторона |`azp` |\*Идентификатор приложения\* клиентского приложения, инициировавшего запрос. |

Когда API получает **access\_token**, он [проверяет маркер](active-directory-b2c-reference-tokens.md), чтобы подтвердить его подлинность и убедиться, что он имеет правильные утверждения.

Мы всегда рады вашим отзывам и предложениям! Если у вас возникли трудности с выполнением действий, описанных в этой статье или у вас есть рекомендации по улучшению этого материала, поделитесь с нами своими наблюдениями, воспользовавшись формой в нижней части страницы. Запросы функций оставляйте на форуме [UserVoice](https://feedback.azure.com/forums/169401-azure-active-directory/category/160596-b2c).

