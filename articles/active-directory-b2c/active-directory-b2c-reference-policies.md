<properties
	pageTitle="Azure Active Directory B2C: расширяемая инфраструктура политик | Microsoft Azure"
	description="В разделе описывается инфраструктура расширяемых политик Azure Active Directory B2C и создание различных типов политик."
	services="active-directory-b2c"
	documentationCenter=""
	authors="swkrish"
	manager="msmbaldwin"
	editor="bryanla"/>

<tags
	ms.service="active-directory-b2c"
	ms.workload="identity"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="07/24/2016"
	ms.author="swkrish"/>

# Azure Active Directory B2C: расширяемая инфраструктура политик

## Основные сведения

Инфраструктура расширяемых политик Azure Active Directory (Azure AD) B2C — это основное преимущество службы. Политики полностью описывают процесс идентификации пользователей: регистрацию, вход и редактирование профиля. К примеру, политика регистрации позволяет управлять поведением с помощью таких параметров:

- типы учетных записей (учетные записи в социальных сетях, например Facebook, или локальные учетные записи, например адрес электронной почты), которые пользователи могут использовать для регистрации в приложении;
- атрибуты (например имя, почтовый индекс и размер обуви), которые нужно получить от пользователя во время регистрации;
- многофакторная проверка подлинности;
- внешний вид и удобство использования всех страниц регистрации;
- сведения (объявляемые в качестве утверждений в маркере), которые получает приложение после завершения выполнения политики.

В своем клиенте вы можете создать несколько политик различных типов и при необходимости использовать их в приложениях. Политики могут повторно использоваться в разных приложениях. Это позволяет разработчикам определять и изменять процесс идентификации пользователя, внося лишь незначительные изменения в код или совсем не изменяя его.

Работа с политиками выполняется через простой интерфейс разработчика. Приложение запускает политику с помощью стандартного HTTP-запроса на проверку подлинности (передавая в запросе параметр политики) и в ответ получает настроенный маркер. Например, единственное различие между запросами, которые вызывают политику регистрации и политику входа, заключается в имени политики, которое используется в качестве строкового параметра "p" в запросе.

```

https://login.microsoftonline.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siup                                       // Your sign-up policy

```

```

https://login.microsoftonline.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siin                                       // Your sign-in policy

```

Дополнительные сведения об инфраструктуре политик см. [в этой записи блога](http://blogs.technet.com/b/ad/archive/2015/11/02/a-look-inside-azuread-b2c-with-kim-cameron.aspx).

## Создание политики регистрации

Чтобы добавить возможность регистрации в приложение, необходимо создать политику регистрации. Эта политика описывает действия, которые пользователь должен выполнить во время регистрации, и содержимое маркеров, которые должно получить приложение при успешной регистрации.

1. [Выполните эти действия, чтобы перейти к колонке функций B2C на портале Azure](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade).
2. Щелкните **Политики регистрации**.
3. Щелкните **+Добавить** в верхней части колонки.
4. **Имя** определяет имя политики регистрации, используемое приложением. Например, введите SiUp.
5. Щелкните **Поставщики удостоверений** и выберите регистрацию по электронной почте. При необходимости можно также выбрать поставщиков удостоверений в социальных сетях, если они уже настроены. Нажмите кнопку **ОК**.
6. Щелкните **Атрибуты регистрации**. Здесь следует выбрать атрибуты, которые пользователь должен предоставить во время регистрации. Например, выберите "Город", "Страна или регион" и "Почтовый индекс". Нажмите кнопку **ОК**.
7. Щелкните **Утверждения приложения**. Здесь вы можете выбрать утверждения, которые необходимо возвращать в маркерах, отправляемых приложению после успешной регистрации. Например, выберите "Отображаемое имя", "Поставщик удостоверений", "Почтовый индекс", "Новый пользователь" и "Идентификатор объекта пользователя".
8. Щелкните **Создать**. Обратите внимание, что в колонке **политик регистрации** только что созданная политика отображается как **B2C\_1\_SiUp** (фрагмент **B2C\_1\_** добавляется автоматически).
9. Откройте политику, щелкнув **B2C\_1\_SiUp**.
10. В раскрывающемся списке **Приложения** выберите пункт "Приложение Contoso B2C", а в списке **URL-адрес ответа и URI перенаправления** — `https://localhost:44321/`.
11. Щелкните **Запустить сейчас**. Откроется новая вкладка браузера, и вы сможете пройти процесс регистрации в своем приложении.

    > [AZURE.NOTE]
    Создание, обновление и вступление политики в силу занимает около минуты.

## Создание политики входа в систему

Чтобы добавить функцию входа в приложение, необходимо создать политику входа. Эта политика описывает действия, которые пользователь должен выполнить во время входа, и содержимое маркеров, которые должно получить приложение при успешном входе.

1. [Выполните эти действия, чтобы перейти к колонке функций B2C на портале Azure](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade).
2. Щелкните **Политики входа**.
3. Нажмите **+Добавить** в верхней части колонки.
4. **Имя** определяет имя политики входа, используемое приложением. Например, введите SiIn.
5. Щелкните **Поставщики удостоверений** и выберите пункт Local Account SignIn (Локальная учетная запись для входа). При необходимости можно также выбрать поставщиков удостоверений в социальных сетях, если они уже настроены. Нажмите кнопку **ОК**.
6. Щелкните **Утверждения приложения**. Здесь вы можете выбрать утверждения, которые необходимо возвращать в маркерах, отправляемых приложению после успешного входа. Например, выберите "Отображаемое имя", "Поставщик удостоверений", "Почтовый индекс" и "Идентификатор объекта пользователя". Нажмите кнопку **ОК**.
7. Щелкните **Создать**. Обратите внимание, что в колонке **Политики регистрации** только что созданная политика отображается в следующем виде: **B2C\_1\_SiIn** (фрагмент **B2C\_1\_** добавляется автоматически).
8. Откройте политику, щелкнув **B2C\_1\_SiIn**.
9. В раскрывающемся списке **Приложения** выберите пункт "Приложение Contoso B2C", а в списке **URL-адрес ответа и URI перенаправления** — `https://localhost:44321/`.
10. Щелкните **Запустить сейчас**. Откроется новая вкладка браузера, и вы сможете взглянуть на процесс входа в ваше приложение глазами пользователя.

    > [AZURE.NOTE]
    Создание, обновление и вступление политики в силу занимает около минуты.

## Создание политики регистрации или входа в систему

Эта политика регулирует процедуры регистрации и входа в систему в рамках одной конфигурации. Потребители проводятся через соответствующую процедуру (регистрации или входа в систему) в зависимости от контекста. В ней также описывается содержимое токенов, которые приложение будет получать при успешной регистрации или входе в систему. Пример кода для политики регистрации или входа в систему см. [здесь](active-directory-b2c-devquickstarts-web-dotnet-susi.md).

1. [Выполните эти действия, чтобы перейти к колонке функций B2C на портале Azure](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade).
2. Щелкните **Sign-up or sign-in policies** (Политики регистрации или входа в систему).
3. Нажмите **+Добавить** в верхней части колонки.
4. **Имя** определяет имя политики регистрации, используемое приложением. Например, введите "SiUpIn".
5. Щелкните **Поставщики удостоверений** и выберите регистрацию по электронной почте. При необходимости можно также выбрать поставщиков удостоверений в социальных сетях, если они уже настроены. Нажмите кнопку **ОК**.
6. Щелкните **Атрибуты регистрации**. Здесь следует выбрать атрибуты, которые пользователь должен предоставить во время регистрации. Например, выберите "Город", "Страна или регион" и "Почтовый индекс". Нажмите кнопку **ОК**.
7. Щелкните **Утверждения приложения**. Здесь вы можете выбрать утверждения, которые необходимо возвращать в токенах, отправляемых приложению после успешной регистрации или входа. Например, выберите "Отображаемое имя", "Поставщик удостоверений", "Почтовый индекс", "Новый пользователь" и "Идентификатор объекта пользователя".
8. Щелкните **Создать**. Обратите внимание, что в колонке **политик регистрации или входа в систему** только что созданная политика отображается в следующем виде: **B2C\_1\_SiUpIn** (фрагмент **B2C\_1\_** добавляется автоматически).
9. Откройте политику, щелкнув **B2C\_1\_SiUpIn**.
10. В раскрывающемся списке **Приложения** выберите пункт "Приложение Contoso B2C", а в списке **URL-адрес ответа и URI перенаправления** — `https://localhost:44321/`.
11. Щелкните **Запустить сейчас**. Откроется новая вкладка браузера, и вы сможете взглянуть на процесс регистрации или входа глазами пользователя.

    > [AZURE.NOTE]
    Создание, обновление и вступление политики в силу занимает около минуты.

## Создание политики изменения профиля

Чтобы добавить в приложение возможность изменения профиля, необходимо создать политику изменения профиля. Эта политика описывает действия, которые необходимо выполнить пользователю для изменения профиля, и содержимое маркеров, которые должно получить приложение при успешном изменении.

1. [Выполните эти действия, чтобы перейти к колонке функций B2C на портале Azure](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade).
2. Щелкните **Политики изменения профиля**.
3. Нажмите **+Добавить** в верхней части колонки.
4. **Имя** определяет имя политики изменения профиля, используемое приложением. Например, введите SiPe.
5. Щелкните **Поставщики удостоверений** и выберите пункт "Электронный адрес". При необходимости можно также выбрать поставщиков удостоверений в социальных сетях, если они уже настроены. Нажмите кнопку **ОК**.
6. Щелкните **Атрибуты профиля**. Здесь можно выбрать атрибуты, которые пользователь может просматривать и изменять. Например, выберите "Страна или регион", "Отображаемое имя" и "Почтовый индекс". Нажмите кнопку **ОК**.
7. Щелкните **Утверждения приложения**. Здесь вы можете выбрать утверждения, которые необходимо возвращать в маркерах, отправляемых приложению после успешного изменения профиля. Например, выберите "Отображаемое имя" и "Почтовый индекс".
8. Щелкните **Создать**. Обратите внимание, что в колонке **политик изменения профилей** только что созданная политика отображается в следующем виде: **B2C\_1\_SiPe** (фрагмент **B2C\_1\_** добавляется автоматически).
9. Откройте политику, щелкнув **B2C\_1\_SiPe**.
10. В раскрывающемся списке **Приложения** выберите пункт "Приложение Contoso B2C", а в списке **URL-адрес ответа и URI перенаправления** — `https://localhost:44321/`.
11. Щелкните **Запустить сейчас**. Откроется новая вкладка браузера, и вы сможете взглянуть на процесс изменения профиля в вашем приложении глазами пользователя.

    > [AZURE.NOTE]
    Создание, обновление и вступление политики в силу занимает около минуты.
    
## Создание политики сброса паролей

Чтобы обеспечить детально настроенный сброс паролей для приложения, необходимо создать политику сброса паролей. Обратите внимание, что возможность сброса паролей в рамках клиента, указанная [здесь](active-directory-b2c-reference-sspr.md), по-прежнему применима для политик входа в систему. Эта политика описывает действия, которые необходимо выполнить потребителям для сброса пароля, и содержимое маркеров, которые должно получить приложение при успешном изменении.

1. [Выполните эти действия, чтобы перейти к колонке функций B2C на портале Azure](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade).
2. Щелкните **Политики сброса паролей**.
3. Нажмите **+Добавить** в верхней части колонки.
4. **Имя** определяет имя политики сброса паролей, используемой приложением. Например, введите "SSPR".
5. Щелкните **Поставщики удостоверений** и выберите сброс пароля с помощью электронного адреса. Нажмите кнопку **ОК**.
6. Щелкните **Утверждения приложения**. Здесь вы можете выбрать утверждения, которые необходимо возвращать в маркерах, отправляемых приложению после успешного сброса пароля. Например, выберите "User's Object ID" (Идентификатор объекта пользователя).
7. Щелкните **Создать**. Обратите внимание, что в колонке **Политики сброса паролей** только что созданная политика отображается в следующем виде: **B2C\_1\_SSPR** (фрагмент **B2C\_1\_** добавляется автоматически).
8. Откройте политику, щелкнув **B2C\_1\_SSPR**.
9. В раскрывающемся списке **Приложения** выберите пункт "Приложение Contoso B2C", а в списке **URL-адрес ответа и URI перенаправления** — `https://localhost:44321/`.
10. Щелкните **Запустить сейчас**. Откроется новая вкладка браузера, и вы сможете взглянуть на процесс сброса пароля в приложении глазами потребителя.

    > [AZURE.NOTE]
    Создание, обновление и вступление политики в силу занимает около минуты.

## Дополнительные ресурсы

- [Предварительная версия Azure Active Directory B2C: конфигурация маркера, сеанса и единого входа](active-directory-b2c-token-session-sso.md).

<!---HONumber=AcomDC_0727_2016-->