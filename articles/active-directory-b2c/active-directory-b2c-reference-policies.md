---
title: "Azure Active Directory B2C: встроенные политики | Документы Майкрософт"
description: "В разделе описывается инфраструктура расширяемых политик Azure Active Directory B2C и создание различных типов политик."
services: active-directory-b2c
documentationcenter: 
author: sama
manager: mbaldwin
editor: bryanla
ms.assetid: 0d453e72-7f70-4aa2-953d-938d2814d5a9
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/26/2017
ms.author: sama
ms.translationtype: HT
ms.sourcegitcommit: c3ea7cfba9fbf1064e2bd58344a7a00dc81eb148
ms.openlocfilehash: 2b92d8343918075f1469c5b8cc0b042e5f418382
ms.contentlocale: ru-ru
ms.lasthandoff: 07/19/2017

---
# <a name="azure-active-directory-b2c-built-in-policies"></a>Azure Active Directory B2C: встроенные политики


Инфраструктура расширяемых политик Azure Active Directory (Azure AD) B2C — это основное преимущество службы. Политики полностью описывают процесс идентификации пользователей: регистрацию, вход и редактирование профиля. К примеру, политика регистрации позволяет управлять поведением с помощью таких параметров:

* типы учетных записей (учетные записи в социальных сетях, например Facebook, или локальные учетные записи, например адреса электронной почты), которые пользователи могут применять для регистрации в приложении;
* атрибуты (например, имя, почтовый индекс и размер обуви), которые нужно получить от пользователя во время регистрации;
* использование Многофакторной Идентификации Azure;
* внешний вид и удобство использования всех страниц регистрации;
* сведения (объявляемые в качестве утверждений в токене), которые получает приложение после завершения выполнения политики.

В своем клиенте вы можете создать несколько политик различных типов и при необходимости использовать их в приложениях. Политики могут повторно использоваться в разных приложениях. Такая гибкость позволяет разработчикам определять и изменять процесс идентификации пользователя, внося лишь незначительные изменения в код или совсем не изменяя его.

Работа с политиками выполняется через простой интерфейс разработчика. Приложение запускает политику с помощью стандартного HTTP-запроса на проверку подлинности (передавая в запросе параметр политики) и в ответ получает настроенный токен. Например, единственное различие между запросами, которые вызывают политику регистрации и политику входа, заключается в имени политики, которое используется в качестве строкового параметра "p" в запросе.

```

https://login.microsoftonline.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siup                                       // Your sign-up policy

```

```

https://login.microsoftonline.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siin                                       // Your sign-in policy

```

Дополнительные сведения об инфраструктуре политики см. в [этой записи, посвященной Azure AD B2C, в блоге по Enterprise Mobility and Security](http://blogs.technet.com/b/ad/archive/2015/11/02/a-look-inside-azuread-b2c-with-kim-cameron.aspx).

## <a name="create-a-sign-up-or-sign-in-policy"></a>Создание политики регистрации или входа в систему
Эта политика регулирует процедуры регистрации и входа в систему в рамках одной конфигурации. Потребители проводятся через соответствующую процедуру (регистрации или входа в систему) в зависимости от контекста. 

В этой политике также описывается содержимое токенов, которые приложение получает при успешной регистрации или входе в систему. Пример кода для политики регистрации или входа см. в [этой статье](active-directory-b2c-devquickstarts-web-dotnet-susi.md).  Мы рекомендуем использовать эту политику вместо политики регистрации и политики входа в систему.  

1. [Сначала выполните эти действия, чтобы перейти к колонке функций B2C на портале Azure](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade).

2. Выберите **Политики регистрации или входа**.

3. Вверху колонки щелкните **+Добавить**.

4. **Имя** определяет имя политики регистрации, используемое приложением. Например, введите **SiUpIn**.

5. Щелкните **Поставщики удостоверений** и выберите **Регистрация по электронной почте**. При необходимости можно также выбрать поставщиков удостоверений в социальных сетях, если они уже настроены. Нажмите кнопку **ОК**.

6. Выберите элемент **Атрибуты регистрации**. Здесь следует выбрать атрибуты, которые пользователь должен предоставить во время регистрации. Например, выберите **Страна или регион**, **Отображаемое имя** и **Почтовый индекс**. Нажмите кнопку **ОК**.

7. Выберите элемент **Утверждения приложения**. Здесь вы можете выбрать утверждения, которые необходимо возвращать в токенах, отправляемых приложению после успешной регистрации или входа. Например, выберите **Отображаемое имя**, **Поставщик удостоверений**, **Почтовый индекс**, **Новый пользователь** и **Идентификатор объекта пользователя**.

8. Нажмите кнопку **Создать**. Обратите внимание, что в колонке **Политики регистрации или входа** созданная политика отображается в следующем виде: **B2C_1_SiUpIn** (фрагмент **B2C\_1\_** добавляется автоматически).

9. Откройте политику, выбрав **B2C_1_SiUpIn**.

10. В раскрывающемся меню **Приложения** выберите **Приложение B2C Contoso**. В раскрывающемся меню **URL-адрес ответа / URI перенаправления** выберите `https://localhost:44321/`.

11. Выберите **Запустить сейчас**. Откроется новая вкладка браузера, и вы сможете выполнить процесс регистрации или входа пользователя.
    
    > [!NOTE]
    > Создание, обновление и вступление политики в силу занимает около минуты.
    > 
    > 

## <a name="create-a-sign-up-policy"></a>Создание политики регистрации
Чтобы добавить возможность регистрации в приложение, необходимо создать политику регистрации. Эта политика описывает действия, которые пользователь должен выполнить во время регистрации, и содержимое токенов, которые приложение получает при успешной регистрации.

1. [Сначала выполните эти действия, чтобы перейти к колонке функций B2C на портале Azure](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade).

2. Выберите элемент **Политики регистрации**.

3. Щелкните **+Добавить** в верхней части колонки.

4. **Имя** определяет имя политики регистрации, используемой приложением. Например, введите **SiUp**.

5. Щелкните **Поставщики удостоверений** и выберите **Регистрация по электронной почте**. При необходимости можно также выбрать поставщиков удостоверений в социальных сетях, если они уже настроены. Нажмите кнопку **ОК**.

6. Выберите элемент **Атрибуты регистрации**. Здесь следует выбрать атрибуты, которые пользователь должен предоставить во время регистрации. Например, выберите **Страна или регион**, **Отображаемое имя** и **Почтовый индекс**, а затем нажмите кнопку **ОК**.

7. Выберите элемент **Утверждения приложения**. Здесь вы можете выбрать утверждения, которые необходимо возвращать в токенах, отправляемых приложению после успешной регистрации. Например, выберите **Отображаемое имя**, **Поставщик удостоверений**, **Почтовый индекс**, **Новый пользователь** и **Идентификатор объекта пользователя**.

8. Нажмите кнопку **Создать**. Обратите внимание, что в колонке **Политики регистрации** созданная политика отображается как **B2C_1_SiUp** (фрагмент **B2C\_1\_** добавляется автоматически).

9. Откройте политику, выбрав **B2C_1_SiUp**.

10. В раскрывающемся списке **Приложения** выберите пункт **Приложение B2C Contoso**, а в списке **URL-адрес ответа / URI перенаправления** — `https://localhost:44321/`.

11. Выберите **Запустить сейчас**. Откроется новая вкладка браузера, и вы сможете пройти процесс регистрации в своем приложении.
    
    > [!NOTE]
    > Создание, обновление и вступление политики в силу занимает около минуты.
    > 
    > 

## <a name="create-a-sign-in-policy"></a>Создание политики входа в систему
Чтобы добавить функцию входа в приложение, необходимо создать политику входа. Эта политика описывает действия, которые пользователь должен выполнить во время входа в систему, и содержимое токенов, которые приложение получает при успешном входе.

1. [Сначала выполните эти действия, чтобы перейти к колонке функций B2C на портале Azure](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade).

2. Выберите элемент **Политики входа**.

3. Щелкните **+Добавить** в верхней части колонки.

4. **Имя** определяет имя политики входа, используемой приложением. Например, введите **SiIn**.

5. Щелкните **Поставщики удостоверений** и выберите элемент **Локальная учетная запись для входа**. При необходимости можно также выбрать поставщиков удостоверений в социальных сетях, если они уже настроены. Нажмите кнопку **ОК**.

6. Выберите элемент **Утверждения приложения**. Здесь вы можете выбрать утверждения, которые необходимо возвращать в токенах, отправляемых приложению после успешного входа. Например, выберите **Отображаемое имя**, **Поставщик удостоверений**, **Почтовый индекс** и **Идентификатор объекта пользователя**, а затем нажмите кнопку **ОК**.

7. Нажмите кнопку **Создать**. Обратите внимание, что в колонке **Политики входа** созданная политика отображается в следующем виде: **B2C_1_SiIn** (фрагмент **B2C\_1\_** добавляется автоматически).

8. Откройте политику, выбрав **B2C_1_SiIn**.

9. В раскрывающемся меню **URL-адрес ответа / URI перенаправления** выберите **Приложение B2C Contoso** и `https://localhost:44321/`.

10. Выберите **Запустить сейчас**. Откроется новая вкладка браузера, и вы сможете взглянуть на процесс входа в ваше приложение глазами пользователя.
    
    > [!NOTE]
    > Создание, обновление и вступление политики в силу занимает около минуты.
    > 
    > 

## <a name="create-a-profile-editing-policy"></a>Создание политики изменения профиля
Чтобы добавить в приложение возможность изменения профиля, необходимо создать политику изменения профиля. Эта политика описывает действия, которые необходимо выполнить пользователю для изменения профиля, и содержимое токенов, которые приложение получает при успешном изменении.

1. [Сначала выполните эти действия, чтобы перейти к колонке функций B2C на портале Azure](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade).

1. Выберите элемент **Политики редактирования профиля**.

2. Щелкните **+Добавить** в верхней части колонки.

3. **Имя** определяет имя политики изменения профиля, используемой приложением. Например, введите **SiPe**.

4. Щелкните **Поставщики удостоверений** и выберите элемент **Локальная учетная запись для входа**. При необходимости можно также выбрать поставщиков удостоверений в социальных сетях, если они уже настроены. Нажмите кнопку **ОК**.

5. Выберите элемент **Атрибуты профиля**. Здесь можно выбрать атрибуты, которые пользователь может просматривать и изменять. Например, выберите **Страна или регион**, **Отображаемое имя** и **Почтовый индекс**, а затем нажмите кнопку **ОК**.

6. Выберите элемент **Утверждения приложения**. Здесь вы можете выбрать утверждения, которые необходимо возвращать в токенах, отправляемых приложению после успешного изменения профиля. Например, выберите **Отображаемое имя** и **Почтовый индекс**.

8. Нажмите кнопку **Создать**. Обратите внимание, что в колонке **Политики редактирования профиля** созданная политика отображается в следующем виде: **B2C_1_SiPe** (фрагмент **B2C\_1\_** добавляется автоматически).

9. Откройте политику, выбрав **B2C_1_SiPe**.

10. В раскрывающемся меню **Приложения** выберите **Приложение B2C Contoso**. В раскрывающемся меню **URL-адрес ответа / URI перенаправления** выберите `https://localhost:44321/`.

11. Выберите **Запустить сейчас**. Откроется новая вкладка браузера, и вы сможете взглянуть на процесс изменения профиля в вашем приложении глазами пользователя.
    
    > [!NOTE]
    > Создание, обновление и вступление политики в силу занимает около минуты.
    > 
    > 

## <a name="create-a-password-reset-policy"></a>Создание политики сброса паролей
Чтобы обеспечить детально настроенный сброс паролей для приложения, необходимо создать политику сброса паролей. Обратите внимание, что возможность сброса паролей в рамках клиента, описанная в статье [Azure Active Directory B2C: настройка самостоятельного сброса пароля для потребителей](active-directory-b2c-reference-sspr.md), по-прежнему применима для политик входа. 

Эта политика описывает действия, которые необходимо выполнить пользователям для сброса пароля, и содержимое токенов, которые приложение получает при успешном сбросе пароля.

1. [Сначала выполните эти действия, чтобы перейти к колонке функций B2C на портале Azure](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade).

2. Выберите элемент **Политики сброса пароля**.

3. Щелкните **+Добавить** в верхней части колонки.

4. **Имя** определяет имя политики сброса паролей, используемой приложением. Например, введите **SSPR**.

5. Щелкните **Поставщики удостоверений** и выберите **Использовать проверку по электронной почте для сброса пароля**. Нажмите кнопку **ОК**.

6. Выберите элемент **Утверждения приложения**. Здесь вы можете выбрать утверждения, которые необходимо возвращать в токенах, отправляемых приложению после успешного сброса пароля. Например, выберите **Отображаемое имя** и **ИД объекта пользователя**.

7. Нажмите кнопку **Создать**. Обратите внимание, что в колонке **Политики сброса паролей** созданная политика отображается в следующем виде: **B2C_1_SSPR** (фрагмент **B2C\_1\_** добавляется автоматически).

8. Откройте политику, выбрав **B2C_1_SSPR**.

9. В раскрывающемся меню **Приложения** выберите **Приложение B2C Contoso**. В раскрывающемся меню **URL-адрес ответа / URI перенаправления** выберите `https://localhost:44321/`.

10. Выберите **Запустить сейчас**. Откроется новая вкладка браузера, и вы сможете взглянуть на процесс сброса пароля в приложении глазами потребителя.
    
    > [!NOTE]
    > Создание, обновление и вступление политики в силу занимает около минуты.
    > 
    > 

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

### <a name="how-do-i-link-a-sign-up-or-sign-in-policy-with-a-password-reset-policy"></a>Как связать политику регистрации или входа с политикой сброса паролей?
При создании политики регистрации или входа (с помощью локальных учетных записей) на первой странице отображается ссылка **Забыли пароль?**. При переходе по этой ссылке политика сброса паролей не активируется автоматически. 

Вместо этого в приложение возвращается код ошибки **`AADB2C90118`**. Приложение должно обработать этот код, вызвав определенную политику сброса паролей. Дополнительные сведения см. в [примере, демонстрирующем подход к связыванию политик](https://github.com/AzureADQuickStarts/B2C-WebApp-OpenIDConnect-DotNet-SUSI).

### <a name="should-i-use-a-sign-up-or-sign-in-policy-or-a-sign-up-policy-and-a-sign-in-policy"></a>Следует ли использовать политику регистрации или входа либо две политики: политику регистрации и политику входа?
Мы рекомендуем использовать политику регистрации или входа вместо политики регистрации и политики входа.  

Политика регистрации или входа обеспечивает больше возможностей, чем политика входа. Она также позволяет настраивать пользовательский интерфейс страницы и лучше поддерживает локализацию. 

Политика входа рекомендуется, если вам не нужно локализовать политики либо если вам требуются ограниченные возможности для настройки фирменного оформления и встроенные возможности сброса паролей.

## <a name="next-steps"></a>Дальнейшие действия
* [Настройка токена, сеанса и единого входа](active-directory-b2c-token-session-sso.md)
* [Azure Active Directory B2C: отключение проверки адреса электронной почты во время регистрации потребителя](active-directory-b2c-reference-disable-ev.md)


