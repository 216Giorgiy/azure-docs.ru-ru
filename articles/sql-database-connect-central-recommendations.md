<properties 
	pageTitle="Подключение к базе данных Azure SQL: основные рекомендации" 
	description="Основная статья, в которой предоставлены ссылки на более конкретные статьи о различных технологиях, например ADO.NET и PHP, для подключения к базе данных Azure SQL. "
	services="sql-database" 
	documentationCenter="" 
	authors="MightyPen" 
	manager="jeffreyg" 
	editor=""/>


<tags 
	ms.service="sql-database" 
	ms.workload="sql-database" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="03/19/2015" 
	ms.author="genemi"/>


#Подключение к базе данных SQL: основные рекомендации


<!--
GeneMi , 2015-March-19 Thursday 15:41pm
sql-database-connect-central-recommendations.md
sql-database-connect-*.md

Re SqlException, not .HResult, rather .Number.
-->


В этой статье предоставлены ссылки на образцы кодов для различных технологий, которые можно использовать для подключения к базе данных Azure SQL и взаимодействия с ней. К таким технологиям относятся Enterprise Library, JDBC и PHP. Приведенные здесь рекомендации являются универсальными и применяются независимо от технологии подключения.


##Универсальные рекомендации


Приведенные в этом разделе сведения не зависят от технологий подключения к базе данных SQL.


- [Рекомендации по программному подключению к базе данных SQL Azure](http://msdn.microsoft.com/library/azure/ee336282.aspx). В статье обсуждаются такие вопросы:
 - порты;
 - брандмауэры;
 - строки подключения.
- [Управление ресурсами в базе данных SQL Azure](https://msdn.microsoft.com/library/azure/dn338083.aspx). Здесь обсуждаются такие вопросы:
 - управление ресурсами;
 - принудительные ограничения;
 - регулирование.


Независимо от используемой технологии подключения некоторые настройки брандмауэра для сервера базы данных SQL и даже для отдельных баз данных все же имеют значение.


- [Брандмауэр базы данных SQL Azure](https://msdn.microsoft.com/library/azure/ee621782.aspx)


###Короткие рекомендации


####Подключение


- В логике подключения к клиенту задайте для времени ожидания по умолчанию 30 секунд.
 - Установленных изначально 15 секунд недостаточно, если подключение зависит от Интернета.
- Если вы используете [пул подключений](http://msdn.microsoft.com/library/8xx3tyca.aspx), закройте экземпляр подключения, который программа активно не использует и не собирается использовать повторно.
 - Если программа сразу же, без задержки, не инициирует повторное подключение для выполнения другой операции, рекомендуем вам выполнить следующие действия.
<br/><br/>Откройте подключение.
<br/>Выполните одну операцию за время подключения.
<br/>Закройте подключение.<br/><br/>
- Используйте логический алгоритм повтора для логики подключений, но только в отношении временных ошибок. Если используется база данных SQL, попытка открыть подключение или отправить запрос может завершиться ошибкой. Причины могут быть разные.
 - Одна из основных - неправильный формат строки подключения.
 - Одной из временных причин сбоев может быть то, что системе базы данных Azure SQL нужно сбалансировать общую нагрузку. Временная причина исчезает сама по себе, а это означает, что программа успешно выполнит повторную попытку подключения.
 - При повторной попытке отправки запроса сперва закройте подключение, а затем откройте его снова.
- Убедитесь, что [брандмауэр базы данных Azure SQL](http://msdn.microsoft.com/library/ee621782.aspx) пропускает исходящие подключения TCP через порт 1433.
 - Параметры [брандмауэра](http://msdn.microsoft.com/library/azure/ee621782.aspx) можно настроить на сервере базы данных SQL или для отдельной базы данных.


####Аутентификация


- Используйте аутентификацию базы данных SQL, а не Windows.
- Укажите конкретную базу данных, а не базу данных  *master* по умолчанию.
- В некоторых случаях к имени пользователя необходимо добавить суффикс *@имя_сервера*, но обычно этот суффикс можно не использовать. Все зависит от того, как написано ваше средство или API.
 - Проверьте информацию для каждой технологии.
- Для подключения укажите пользователя в [автономной базе данных](http://msdn.microsoft.com/library/ff929071.aspx).
 - Это даст более высокую производительность и масштабируемость, так как вход в базу данных master будет исключен.
 - Вы не можете использовать инструкцию Transact-SQL **USE myDatabaseName;** в базе данных SQL.


###Временные ошибки


Некоторые ошибки подключения к базе данных SQL являются постоянными, поэтому не нужно сразу же пытаться подключиться еще раз. Другие ошибки - временны. Для таких случаев в программе рекомендуется настроить автоматическое выполнение повторного подключения. Примеры:


- *Постоянные* Если при попытке подключения неправильно указать имя сервера базы данных SQL, повторные попытки будут лишены смысла.
- *Временные* Если подключение к базе данных SQL принудительно разрывают системы регулировки или балансировки нагрузки Аzure, рекомендуется подключиться еще раз.


Исключение [SqlException](https://msdn.microsoft.com/library/system.data.sqlclient.sqlexception.aspx), возникшее в результате вызова базы данных SQL, содержит числовой код ошибки в свойстве **Number**. Если код ошибки указан в списке временных ошибок, программа должна повторить вызов.


- [Сообщения об ошибках (база данных SQL Azure)](http://msdn.microsoft.com/library/azure/ff394106.aspx). Здесь, в разделе **Ошибки, связанные с потерей подключения**, приводится список временных ошибок, после которых следует выполнять повторную попытку подключения.
 - Например, попытку следует повторить, если возникает ошибка с номером 40613, в которой говорится примерно следующее:<br/>*База данных 'mydatabase' на сервере 'theserver' в настоящий момент недоступна.*


Дополнительные сведения о том, что делать при возникновении постоянных или временных ошибок подключения, см. в следующей статье:


- [Устранение неполадок подключения к базе данных SQL Microsoft Azure](http://support.microsoft.com/ru-ru/kb/2980233/ru-ru)


##Технологии


В этом разделе приведены ссылки на образцы кода для нескольких технологий подключения.


- [Разработка в базе данных SQL Azure: инструкции](http://msdn.microsoft.com/library/azure/ee621787.aspx)


Сведения об ADO.NET с Enterprise Library и классах Transient Fault Handling см. в следующей статье:


- [Практическое руководство. Надежное подключение к базе данных SQL Azure](http://msdn.microsoft.com/library/azure/dn864744.aspx)


Сведения об эластичном масштабировании см. в таких статьях:


- [Начало работы с эластичным масштабированием базы данных Azure SQL (предварительная версия)](sql-database-elastic-scale-get-started.md)
- [Маршрутизация, зависящая от данных](sql-database-elastic-scale-data-dependent-routing.md)


##Неполные или устаревшие публикации


В этом разделе приведены ссылки на публикации в блогах или на других ресурсах, поэтому они могут содержать неполные или устаревшие сведения. Тем не менее в них можно найти некоторую полезную информацию.


- [Логика повторных выполнений для временных ошибок в базе данных SQL](http://social.technet.microsoft.com/wiki/contents/articles/4235.retry-logic-for-transient-failures-in-windows-azure-sql-database.aspx)

<!-- -->


<!--HONumber=49-->