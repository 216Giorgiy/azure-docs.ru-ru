<properties
   pageTitle="Факторы, которые необходимо учитывать при использовании Operations Manager с Operational Insights"
   description="Если служба Microsoft Azure Operational Insights используется с Operations Manager, конфигурация использует распространение агентов Operations Manager и групп управления, чтобы собирать и отправлять данные в службу Operational Insights для анализа."
   services="operational-insights"
   documentationCenter=""
   authors="bandersmsft"
   manager="jwhit"
   editor="tysonn" />
<tags
   ms.service="operational-insights"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/10/2015"
   ms.author="banders" />

# Факторы, которые необходимо учитывать при использовании Operations Manager с Operational Insights

[AZURE.INCLUDE [operational-insights-note-moms](../../includes/operational-insights-note-moms.md)]

Если служба Microsoft Azure Operational Insights используется с Operations Manager, конфигурация использует распространение агентов Operations Manager и групп управления, чтобы собирать и отправлять данные в службу Operational Insights для анализа. При использовании агентов с прямым подключением к веб-службе компонент Operations Manager не требуется. При использовании службы Operational Insights с Operations Manager рекомендуется принять во внимание следующие вопросы.

Необходимо также указать учетные данные запуска от имени для рабочих нагрузок, отслеживаемых Operations Manager в Operational Insights.

## Функции и требования к программному обеспечению Operational Insights

Operational Insights состоит из веб-службы в облаке и либо агентов с прямым подключением к веб-службе, либо агентов и групп управления Operations Manager, управляющих компьютерами в вашей среде.

Перед выбором агентов (для сбора данных) и групп управления Operations Manager (для управления агентами и передачи данных в службу Operational Insights service) убедитесь, что вы понимаете следующие моменты.

- Агент Operations Manager устанавливается на любом сервере, с которого будет выполняться сбор данных и их последующий анализ.

- Группа управления Operations Manager передает данные из агентов в веб-службу Operational Insights. Она не анализирует данные.

- Группа управления Operations Manager должна иметь доступ к Интернету, чтобы отправлять данные в веб-службу.

- Для получения наилучших результатов не следует устанавливать сервер управления Operations Manager на компьютере, который является контроллером домена.

- Агент Operations Manager должен иметь сетевое подключение к группе управления Operations Manager, чтобы передавать данные.

Служба Operational Insights может использовать службу работоспособности System Center для сбора и анализа данных. Operations Manager зависит от службы работоспособности System Center. При просмотре программ, установленных на сервере, программное обеспечение агента System Center Operations Manager отображается в компоненте «Установка и удаление программ». Не удаляйте это ПО, поскольку от него зависит служба Operational Insights. После удаления программного обеспечения агента Operations Manager служба Operational Insights работать не будет.

## Сосуществование с Operations Manager

При использовании Operations Manager служба Operational Insights поддерживается только с агентом Operations Manager в System Center Operations Manager 2012 R2 или System Center Operations Manager 2012 с пакетом обновления 1 (SP1). Она не поддерживается в предыдущих версиях System Center Operations Manager. Поскольку агент Operations Manager используется для сбора данных, для поддержки некоторых анализируемых рабочих нагрузок, например SharePoint 2012, он применяет определенные учетные данные (учетные записи действий или учетные записи запуска от имени).

## Operational Insights и SQL Server 2012

При использовании Operations Manager служба работоспособности System Center выполняется под учетной записью Local System. В версиях SQL Server, более ранних чем SQL Server 2008 R2, учетная запись Local System была включена по умолчанию и входила в серверную роль системного администратора. В SQL Server 2012 учетная запись Local System не входит в серверную роль системного администратора. В результате служба Operational Insights не может полностью отслеживать экземпляр SQL Server 2012 и не все правила могут создавать оповещения.

## Подключение к Интернету и внутренней сети

Агентам с прямым подключением к веб-службе требуется доступ к Интернету для отправки данных в веб-службу и получения обновленных сведений о конфигурации из веб-службы.

При использовании Operations Manager серверам управления требуется доступ к Интернету для отправки данных в веб-службу и получения обновленных сведений о конфигурации из веб-службы. Однако агентам не требуется доступ к Интернету. Если агенты Operations Manager находятся на серверах, которые не подключены к Интернету, можно использовать веб-службу для взаимодействия с сервером управления, подключенным к Интернету.

## Поддержка кластеров

Агент Operations Manager поддерживается на компьютерах под управлением Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008, входящих в состав отказоустойчивого кластера Windows. Просмотреть кластеры можно на портале Operational Insights. На странице «Серверы» кластеры определены как TYPE=CLUSTER (в отличие от TYPE=AGENT, который используется для определения физических компьютеров).

Правила обнаружения и настройки выполняются на активных и резервных узлах кластера, но все оповещения, создаваемые на резервных узлах, игнорируются. Если резервный узел становится активным, оповещения для этого узла отображаются автоматически без вмешательства со стороны пользователя.

В зависимости от правила, генерирующего оповещение, некоторые оповещения могут создаваться дважды. Например, правило, которое обнаруживает неправильный драйвер путем проверки операционной системы, создает оповещение для физического сервера и для кластера.

Анализ конфигурации резервных узлов не поддерживается.

Служба Operational Insights не поддерживает группирование или связывание компьютеров под управлением Windows Server, которые входят в один отказоустойчивый кластер.

## Масштабирование среды Operational Insights

При планировании развертывания Operational Insights (особенно при анализе количества агентов Operations Manager, которое требуется для переноса данных с помощью одной группы управления) рекомендуется принять во внимание емкость сервера с точки зрения файлового пространства.

Учтите следующие переменные.

- Количество агентов в каждой группе управления

- Средний объем данных, ежедневно передаваемых от агента в группу управления. По умолчанию каждый агент передает CAB-файлы в группу управления дважды в день. Размер CAB-файлов зависит от конфигурации сервера (например, количество ядер SQL Server и число баз данных) и работоспособности сервера (например, количество созданных оповещений). В большинстве случаев ежедневный размер загрузки не превышает 100 КБ.

- Срок хранения данных в группе управления (по умолчанию — 5 дней)

Например, если предполагается, что ежедневный размер отправки для каждого агента будет составлять 100 КБ и будет использоваться период архивирования по умолчанию, для группы управления потребуется хранилище со следующими характеристиками.

Количество агентов|Предполагаемое пространство, необходимое для группы управления
---|---
5|~2,5 МБ (5 агентов x 100 КБ данных в день x 5 дней = 2 500 КБ)
50|~25 МБ (50 агентов x 100 КБ данных в день x 5 дней = 25 000 КБ)

## Учетные записи запуска от имени в Operations Manager для службы Operational Insights

Operational Insights использует агент Operations Manager и группу управления для сбора и отправки данных в службу. С целью предоставления ценных услуг служба Operational Insights строится на пакетах управления для рабочих нагрузок. Каждой рабочей нагрузке требуются права, относящиеся к конкретным рабочим нагрузкам, для запуска пакетов управления в другом контексте безопасности, например в учетной записи домена. Необходимо предоставить учетные данные, настроив учетную запись запуска от имени для Operations Manager.

В следующих разделах содержатся сведения о настройке учетных записей запуска от имени для Operations Manager для следующих рабочих нагрузок.

- Оценка SQL
- Virtual Machine Manager
- Lync Server
- SharePoint

### Настройка учетной записи запуска от имени для оценки SQL

 Если пакет управления SQL Server уже используется, следует использовать эту учетную запись запуска от имени.

#### Настройка учетной записи SQL запуска от имени в консоли управления

1. В Operations Manager откройте консоль управления и щелкните **Администрирование**.

2. В разделе **Настройка запуска от имени** щелкните **Профили** и откройте **Профиль запуска от имени для оценки SQL в Operational Insights**.

3. На странице **Учетные записи запуска от имени** нажмите кнопку **Добавить**.

4. Выберите учетную запись Windows запуска от имени, которая содержит учетные данные, необходимые для SQL Server, или нажмите кнопку **Создать** для ее создания.
	>[AZURE.NOTE]Тип учетной записи «Запуск от имени» должен быть указан как Windows. Учетная запись запуска от имени также должна входить в группу локальных администраторов на всех серверах Windows Server, на которых размещены экземпляры SQL Server.

5. Щелкните **Сохранить**.

6. Измените, а затем выполните следующий пример T-SQL на каждом экземпляре SQL Server, чтобы предоставить минимальные разрешения, необходимые учетной записи запуска от имени для выполнения оценки SQL. Но это не требуется делать в том случае, если учетная запись запуска от имени уже является частью серверной роли sysadmin в экземплярах SQL Server.

```
---
    -- Replace <UserName> with the actual user name being used as Run As Account.
    USE master

    -- Create login for the user, comment this line if login is already created.
    CREATE LOGIN [<UserName>] FROM WINDOWS

    -- Grant permissions to user.
    GRANT VIEW SERVER STATE TO [<UserName>]
    GRANT VIEW ANY DEFINITION TO [<UserName>]
    GRANT VIEW ANY DATABASE TO [<UserName>]

    -- Add database user for all the databases on SQL Server Instance, this is required for connecting to individual databases.
    -- NOTE: This command must be run anytime new databases are added to SQL Server instances.
    EXEC sp_msforeachdb N'USE [?]; CREATE USER [<UserName>] FOR LOGIN [<UserName>];'

```
#### To configure the SQL Run As account using Windows PowerShell

Open a PowerShell window and run the following script after you’ve updated it with your information:

```

    import-module OperationsManager
    New-SCOMManagementGroupConnection "<your management group name>"
     
    $profile = Get-SCOMRunAsProfile -DisplayName "Operational Insights SQL Assessment Run As Profile"
    $account = Get-SCOMrunAsAccount | Where-Object {$_.Name -eq "<your run as account name>"}
    Set-SCOMRunAsProfile -Action "Add" -Profile $Profile -Account $Account
```


### Настройка учетной записи запуска от имени для Virtual Machine Manager

Убедитесь, что учетная запись запуска от имени имеет права для следующих действий:

- использование модуля VMM Windows;

- отправка запроса к базе данных VMM;

- удаленное администрирование агентов VMM, работающих на узлах виртуализации.

Выполните следующие действия, чтобы настроить учетную запись при подключении Operational Insights к Operations Manager.

#### Настройка учетных данных для VMM

1. В Operations Manager откройте консоль управления и щелкните **Администрирование**.

2. В разделе **Настройка запуска от имени** щелкните **Профили** и откройте **Учетная запись VMM запуска от имени для Operational Insights**.

3. На странице **Учетные записи запуска от имени** нажмите кнопку **Добавить**.

4. Выберите учетную запись Windows запуска от имени, которая содержит учетные данные, необходимые для VMM, или нажмите кнопку **Создать** для ее создания.
	>[AZURE.NOTE]Тип учетной записи «Запуск от имени» должен быть указан как Windows.

5. Щелкните **Сохранить**.


### Настройка учетной записи запуска от имени для Lync Server

 Учетная запись запуска от имени должна входить в группу локальных администраторов и группу безопасности Lync RTCUniversalUserAdmins.

#### Настройка учетных данных для учетной записи Lync

1. В Operations Manager откройте консоль управления и щелкните **Администрирование**.

2. В разделе **Настройка запуска от имени** щелкните **Профили** и откройте **Учетная запись Lync запуска от имени для Operational Insights**.

3. На странице **Учетные записи запуска от имени** нажмите кнопку **Добавить**.

4. Выберите учетную запись Windows запуска от имени, которая входит в группу локальных администраторов и группу безопасности Lync RTCUniversalUserAdmins.
	>[AZURE.NOTE]Тип учетной записи «Запуск от имени» должен быть указан как Windows.

5. Щелкните **Сохранить**.


### Настройка учетной записи запуска от имени для SharePoint


#### Настройка учетных данных для учетной записи SharePoint

1. В Operations Manager откройте консоль управления и щелкните **Администрирование**.

2. В разделе **Настройка запуска от имени** щелкните **Профили** и откройте **Учетная запись SharePoint запуска от имени для Operational Insights**.

3. На странице **Учетные записи запуска от имени** нажмите кнопку **Добавить**.

4. Выберите учетную запись Windows запуска от имени, которая содержит учетные данные, необходимые для SharePoint, или нажмите кнопку **Создать** для ее создания.
	>[AZURE.NOTE]Тип учетной записи «Запуск от имени» должен быть указан как Windows.

5. Щелкните **Сохранить**.



## Географические местоположения

Если требуется анализировать данные с серверов в разных географических местоположениях, рассмотрите возможность установки по одной группе управления в каждом месте. Это может повысить производительность передачи данных от агента в группу управления.

<!---HONumber=Sept15_HO3-->