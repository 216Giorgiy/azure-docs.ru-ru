<properties 
   pageTitle="Приступая к работе с Hadoop с использованием Hive в HDInsight — Azure" 
   description="Приступите к работе с Hadoop в HDInsight, решением для обработки данных большого размера в облаке. Узнайте, как подготавливать кластеры, запрашивать данные с помощью Hive и выводить данные в Excel для анализа." 
   services="hdinsight" 
   documentationCenter="" 
   authors="nitinme" 
   manager="paulettm" 
   editor="cgronlun"/>

<tags
   ms.service="hdinsight"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="big-data" 
   ms.date="03/16/2015"
   ms.author="nitinme"/>


# Приступая к работе с Hadoop с использованием Hive в HDInsight на платформе Windows

> [AZURE.SELECTOR]
- [Windows](hdinsight-get-started.md)
- [Linux](hdinsight-hadoop-linux-get-started.md)

Чтобы помочь вам быстро начать работу с HDInsight, в этом учебнике показано, как выполнить запрос Hive для извлечения полезной информации об использовании мобильного телефона из неструктурированных данных в кластере Hadoop. Затем вы сможете проанализировать результаты в Microsoft Excel.


> [AZURE.NOTE]Если вы не знакомы с Hadoop и программами обработки данных большого размера, ознакомьтесь с такими терминами, как [Apache Hadoop][apache-hadoop], [MapReduce][apache-mapreduce], [HDFS][apache-hdfs] и [Hive][apache-hive]. Чтобы разобраться, как HDInsight поддерживает Hadoop в Azure, см. [Введение для Hadoop в HDInsight][hadoop-hdinsight-intro].

Наряду с выпуском общедоступной версии Azure HDInsight корпорация Майкрософт выпустила также эмулятор HDInsight для Azure, ранее известный как *Microsoft HDInsight Developer Preview*. Этот продукт предназначен для сценариев разработки и поэтому поддерживает только развертывания на одном узле. Дополнительную информацию об использовании эмулятора HDInsight см. в статье [Приступая к работе с эмулятором HDInsight][hdinsight-emulator].

> [AZURE.NOTE]Инструкции по подготовка кластера HBase см. в разделе [Подготовка кластера HBase в HDInsight][hdinsight-hbase-custom-provision]. Различия баз данных, учитываемые при их выборе, см. в статье <a href="http://go.microsoft.com/fwlink/?LinkId=510237">В чем разница между Hadoop и HBase?</a>.

## Цели учебника ##

Предположим, что у вас есть большой набор неструктурированных данных, и необходимо выполнить запросы для извлечения из него содержательной информации. Именно этим мы и собираемся заняться в этом учебнике. Вот как это делается:

   ![Описаны шаги учебника «Приступая к работе с Hadoop с использованием Hive в HDInsight»: создание учетной записи, подготовка кластера, запрашивание данных и выполнение анализа в Excel.][image-hdi-getstarted-flow]

Вы также можете [посмотреть видео этого учебника](https://www.youtube.com/watch?v=Y4aNjnoeaHA&list=PLDrz-Fkcb9WWdY-Yp6D4fTC1ll_3lU-QS).

![HDI.getstarted.video][img-hdi-getstarted-video]


**Предварительные требования**

Перед началом работы с этим учебником необходимо иметь следующее:


- Подписка Azure. Дополнительные сведения о получении подписки см. в разделах [Варианты приобретения][azure-purchase-options], [Предложения для участников][azure-member-offers] или [Бесплатное пробное использование][azure-free-trial].
- Компьютер с Office 2013 профессиональный плюс, Office 365 профессиональный плюс, Excel 2013 автономный или Office 2010 профессиональный плюс.

**Предполагаемое время выполнения заданий этого учебника:** 30 минут.

##В этом учебнике рассматриваются следующие темы:

* [Создание учетной записи хранения Azure](#storage)
* [Подготовка кластера HDInsight](#provision)
* [Запуск примеров с портала](#sample)
* [Выполнение задания Hive](#hivequery)
* [Дальнейшие действия](#nextsteps)

##<a name="storage"></a>Создание учетной записи хранения Azure

HDInsight использует для хранения данных хранилище BLOB-объектов Azure. Дополнительную информацию см. в статье [Использование хранилища больших двоичных объектов Azure с HDInsight][hdinsight-storage].

При подготовке кластера HDInsight указывается учетная запись хранения Azure Storage. Конкретный контейнер больших двоичных объектов из этой учетной записи назначается в качестве файловой системы по умолчанию, так же как и в HDFS. По умолчанию подготовка кластера HDInsight выполняется в том же центре обработки данных, в котором находится указанная учетная запись хранения.

>[AZURE.NOTE]Не используйте контейнер хранилища больших двоичных объектов по умолчанию для нескольких кластеров HDInsight.

Помимо этой учетной записи хранения, в процессе настройки кластера HDInsight можно добавить дополнительные учетные записи хранения. Эти дополнительные учетные записи хранения могут быть из той же подписки Azure или из других подписок Azure. Указания см. в разделе [Подготовка кластеров HDInsight с использованием настраиваемых параметров][hdinsight-provision].

Чтобы упростить этот учебник, используются только большой двоичный объект и учетная запись хранения по умолчанию. На практике файлы данных обыкновенно хранятся в заданной учетной записи хранения.

**Создание учетной записи хранения Azure**

1. Войдите на портал [Azure][azure-management-portal].
2. Щелкните **СОЗДАТЬ** в левом нижнем углу, последовательно выберите **СЛУЖБЫ ДАННЫХ**, **ХРАНИЛИЩЕ**, а затем щелкните **БЫСТРОЕ СОЗДАНИЕ**.

	![Портал Azure, на котором можно использовать функцию быстрого создания для настройки новой учетной записи хранения.][image-hdi-storageaccount-quickcreate]

3. Введите значения в поля **URL-АДРЕС**, **РАСПОЛОЖЕНИЕ** и **РЕПЛИКАЦИЯ**, а затем щелкните **СОЗДАТЬ УЧЕТНУЮ ЗАПИСЬ ХРАНЕНИЯ**. (Территориальные группы не поддерживаются.) Вы увидите новую учетную запись хранения в списке хранилищ.

	>[AZURE.NOTE]Если для подготовки кластера HDInsight используется параметр «БЫСТРОЕ СОЗДАНИЕ», как в этом учебнике, то расположение при подготовке кластера не указывается. Вместо этого кластер по умолчанию размещается в том же центре обработки данных, что и учетная запись хранения. Таким образом, необходимо создать учетную запись хранения в том расположении, где поддерживается кластер, а именно: **Восточная Азия**, **Юго-Восточная Азия**, **Северная Европа**, **Западная Европа**, **Восток США**, **Запад США**, **Северо-центральный регион США**, **Южно-центральный регион США**.

4. Дождитесь, пока **СОСТОЯНИЕ** новой учетной записи хранения не изменится на **В сети**.
5. Выберите новую учетную запись хранения в списке и щелкните **УПРАВЛЕНИЕ КЛЮЧАМИ ДОСТУПА** в нижней части страницы.
7. Запишите значения в полях **ИМЯ УЧЕТНОЙ ЗАПИСИ ХРАНЕНИЯ** и **ПЕРВИЧНЫЙ КЛЮЧ ДОСТУПА** (или **ВТОРИЧНЫЙ КЛЮЧ ДОСТУПА**). (Любой из ключей будет работать.) Они потребуются позже в данном руководстве.


Дополнительную информацию см. в разделе [Как создать учетную запись хранения][azure-create-storageaccount] и статье [Использование хранилища больших двоичных объектов Azure с HDInsight][hdinsight-storage].
	
##<a name="provision"></a>Подготовка кластера HDInsight

При подготовке кластера HDInsight происходит подготовка вычислительных ресурсов Azure, содержащих Hadoop и соответствующие приложения. В этом разделе подготавливается кластер HDInsight версии 3.1 на базе Hadoop версии 2.4. Кроме этого, можно создать кластеры Hadoop для других версий, используя портал Azure, командлеты HDInsight PowerShell или пакет SDK для HDInsight .NET. Указания см. в разделе [Подготовка кластеров HDInsight с использованием настраиваемых параметров][hdinsight-provision]. Дополнительную информацию о различных версиях HDInsight и их соглашениях об уровне обслуживания см. в статье [Версии компонентов НDInsight](hdinsight-component-versioning.md).

[AZURE.INCLUDE [provisioningnote](../includes/hdinsight-provisioning.md)]


**Подготовка кластера HDInsight**

1. Войдите на [портал Azure][azure-management-portal]. 

2. В области слева щелкните **HDInsight**, чтобы просмотреть состояние кластеров в вашей учетной записи. На следующем снимке экрана кластеры HDInsight отсутствуют.

	![Состояние кластеров HDInsight на портале Azure.][image-hdi-clusterstatus]

3. Щелкните **СОЗДАТЬ** в левом нижнем углу, выберите **Службы данных**, **HDInsight**, а затем щелкните **Hadoop**.

	![Создание кластера Hadoop в HDInsight.][image-hdi-quickcreatecluster]

4. Введите или выберите следующие значения:

	<table border="1">
<tr><th>Имя</th><th>Значение</th></tr>
<tr><td>Имя кластера,</td><td>Имя кластера.</td></tr>
<tr><td>Размер кластера</td><td>Число узлов данных, которые требуется развернуть. Значение по умолчанию&#160;— 4. Но в раскрывающемся списке также доступны кластеры с 1 и 2 узлами данных. С помощью параметра <strong>Настраиваемое создание</strong> может быть указано любое количество узлов кластера. Вы также можете просмотреть информацию о тарифах, на основе которых выставляются счета, на использование кластеров различных размеров. Щелкните символ <strong>?</strong> над раскрывающимся списком и перейдите по отобразившейся ссылке.</td></tr>
<tr><td>Пароль</td><td>Пароль для учетной записи <i>admin</i>. Имя пользователя кластера "admin" (администратор) указывается в том случае, когда параметр <strong>Настраиваемое создание</strong> не используется. Обратите внимание, что это НЕ учетная запись администратора Windows для ВМ, на которых происходит подготовка кластеров. Имя учетной записи можно изменить с помощью мастера <strong>Настраиваемое создание</strong>.</td></tr>
<tr><td>Учетная запись хранения</td><td>Щелкните раскрывающийся список и выберите созданную учетную запись хранения. <br/>

Выбрав, ее уже невозможно изменить. Если удалить учетную запись хранения, кластер будет недоступен для использования. Кластер HDInsight размещается в том же центре обработки данных, что и учетная запись хранения. 
</td></tr>
</table>Сохраните копию имени кластер. Они потребуются позже в данном руководстве.

	
5. Щелкните **Создать кластер HDInsight**. После завершения процесса подготовки в столбце состояния будет отображаться **Работает**.

	>[AZURE.NOTE]В предыдущей процедуре кластер создавался с помощью HDInsight версии 3.1. Чтобы создать кластер с другой версией, используйте метод **Настраиваемое создание** на портале или Azure PowerShell. Информацию о различиях между версиями кластеров см. в статье [Новые возможности версий кластеров Hadoop, предоставляемых HDInsight][hdinsight-versions]. Дополнительную информацию об использовании параметра **НАСТРАИВАЕМОЕ СОЗДАНИЕ** см. в статье [Подготовка кластеров HDInsight с использованием настраиваемых параметров][hdinsight-provision].


##<a name="sample"></a>Запуск примеров с портала

Успешно подготовленный кластер HDInsight предоставляет консоль запросов, содержащую коллекцию материалов для начала работы, которая предназначена для запуска примеров непосредственно с портала. Образцы могут использоваться для обучения работе с HDInsight путем пошагового прохождения некоторых базовых сценариев. Эти образцы поставляются вместе со всеми необходимыми компонентами, такими как данные для анализа и запросы для их запуска на основе этих данных. Дополнительную информацию о примерах в коллекции материалов для начала работы см. в статье [Изучение Hadoop с помощью коллекции материалов для начала работы с HDInsight](hdinsight-learn-hadoop-use-sample-gallery.md).

Для **запуска примера** с портала Azure щелкните имя кластера, в котором необходимо запустить пример, а затем нажмите кнопку **Консоль запросов** в нижней части страницы. На открывшейся веб-странице выберите вкладку **Коллекция материалов для начала работы**, а затем в категории **Примеры** щелкните пример, который необходимо запустить. Следуйте указаниям на веб-странице, чтобы завершить выполнение примера. В следующей таблице содержится несколько примеров, а также дополнительная информация о функциях каждого из них.

Образец | Функция
------ | ---------------
[Анализ данных датчика][hdinsight-sensor-data-sample] | С помощью этого примера можно узнать об использовании HDInsight для обработки исторических данных, полученных системами отопления, вентиляции и кондиционирования воздуха, чтобы определить системы, которые не в состоянии надежно поддерживать заданную температуру.
[Анализ журнала веб-сайта][hdinsight-weblogs-sample] | С помощью этого примера можно узнать об использовании HDInsight для анализа файлов журнала веб-сайта, позволяющего получить представление о дневной частоте посещений веб-сайта с внешних сайтов, а также сводку об ошибках веб-сайта, с которыми столкнулись пользователи.
[Анализ тенденций Twitter](hdinsight-analyze-twitter-data.md) | С помощью этого примера можно узнать об использовании HDInsight для анализа тенденций в Twitter.



##<a name="hivequery"></a>Запуск запроса HIVE с портала
Теперь, когда у вас есть подготовленный кластер HDInsight, на следующем шаге выполняется задание Hive для запроса примера таблицы Hive. Мы используем таблицу *hivesampletable*, которая поставляется с кластерами HDInsight. Эта таблица содержит данные о производителях мобильных устройств, платформах и моделях. Мы запрашиваем таблицу, чтобы извлечь данные для мобильных устройств определенного производителя.

> [AZURE.NOTE]Инструменты HDInsight для Visual Studio поставляются с пакетом SDK для Azure для .NET версии 2.5 или более поздней. Используя инструменты Visual Studio, вы можете подключить кластер HDInsight, создать таблицы Hive и выполнить Hive-запросы. Дополнительную информацию см. в статье [Начало работы со средствами HDInsight Hadoop для Visual Studio][1].



**Выполнение задания Hive с панели мониторинга кластера**

1. Войдите на [портал Azure][azure-management-portal]. 
2. На левой панели щелкните **HDINSIGHT**. Вы увидите список кластеров, включая кластер, который вы только что создали в предыдущем разделе.
3. Щелкните имя кластера, в котором необходимо запустить задание Hive, а затем нажмите кнопку **КОНСОЛЬ ЗАПРОСОВ** в нижней части страницы. 
4. В новой вкладке браузера откроется веб-страница. Введите учетную запись и пароль пользователя Hadoop. Имя по умолчанию — **admin**; пароль тот же, который вы ввели при подготовке кластера. Панель мониторинга выглядит следующим образом:

	![Вкладка «Редактор Hive» на панели мониторинга кластера HDInsight.][img-hdi-dashboard]

	В верхней части страницы содержится несколько вкладок: вкладка по умолчанию — **Редактор Hive** и остальные вкладки — **Журнал заданий** и **Браузер файлов**. С помощью панели мониторинга можно отправлять запросы Hive, проверять журналы заданий Hadoop и просматривать файлы в хранилище.

	> [AZURE.NOTE]Обратите внимание, что у веб-страницы следующий URL-адрес: *&lt;имя_кластера&gt;.azurehdinsight.net*. Таким образом, вместо открывания панели мониторинга на портале, можно открыть ее в веб-браузере, используя этот URL-адрес.

6. На вкладке **Редактор Hive** в поле **Имя запроса**ведите **HTC20**. Имя запроса представляет собой название задания.

7. В панели запросов введите следующий запрос:

		SELECT * FROM hivesampletable
			WHERE devicemake LIKE "HTC%"
			LIMIT 20;

	![Запрос, введенный в области запроса на вкладке «Редактор Hive».][img-hdi-dashboard-query-select]

4. Нажмите кнопку **Submit** (Отправить). На получение результатов уходит несколько минут. Экран обновляется каждые 30 секунд. Чтобы обновить экран, можно также нажать кнопку **Обновить**.

    После завершения задания экран будет выглядеть следующим образом:

	![Результаты запроса Hive, указанные в нижней части панели инструментов кластера.][img-hdi-dashboard-query-select-result]

5. Чтобы увидеть выходные данные, щелкните имя запроса на экране. Отметьте **Время запуска задания (формат UTC)**. Оно понадобится вам позднее.

    ![Строка «Время запуска задания», указанная на вкладке «Журнал заданий» на панели мониторинга кластера HDInsight.][img-hdi-dashboard-query-select-result-output]

    На странице также отображаются **Выходные данные задания** и **Журнал заданий**. Кроме этого, можно также загрузить выходной файл (_stdout) и файл журнала (_stderr).


	> [AZURE.NOTE]Пока открыта вкладка **Редактор Hive**, в таблице **Сеанс задания** на этой вкладке приведены завершенные или выполняемые задания. В таблице не перечисляются задания, если перейти с этой страницы. Таблица **Журнал заданий** поддерживает список всех завершенных или выполняемых заданий.
 

**Переход к выходному файлу**

1. На панели мониторинга кластера щелкните **Браузер файлов**. 
2. Последовательно щелкните имя учетной записи, имя контейнера (совпадает с именем кластера) и **пользователь**.
3. Щелкните **admin**, а затем щелкните GUID, время последнего изменения которого немного позднее ранее отмеченного времени запуска задания. Скопируйте этот GUID. Он понадобится в следующем разделе.


   	![GUID выходного файла, указанный на вкладке «Браузер файлов».][img-hdi-dashboard-query-browse-output]


###<a name="powerquery"></a>Подключение к инструментам бизнес-аналитики Microsoft 

С помощью надстройки Power Query для Microsoft Excel можно импортировать выходные данные задания из HDInsight в Excel, где для дальнейшего анализа результатов могут использоваться инструменты бизнес-аналитики Microsoft.

Для выполнения действий из этой части учебника требуется Excel 2013 или Excel 2010.

**Скачивание Microsoft Power Query для Excel**

- Загрузите Microsoft Power Query для Excel из [Центра загрузки Майкрософт](http://www.microsoft.com/download/details.aspx?id=39379) и установите.

**Импорт данных HDInsight**

1. Откройте Excel и создайте новую книгу.
3. Щелкните меню **Power Query**, выберите **Из других источников**, а затем щелкните **Из Windows Azure HDInsight**.

	![Меню «Импорт» в Power Query для Excel, открытое для Azure HDInsight.][image-hdi-gettingstarted-powerquery-importdata]

3. В поле **Имя учетной записи** введите имя учетной записи хранилища больших двоичных объектов Azure, связанной с вашим кластером, и нажмите кнопку **ОК**. (Это учетная запись хранения, которую вы ранее создали в этом учебнике.)
4. В поле **Ключ учетной записи** введите ключ для учетной записи хранилища больших двоичных объектов Azure, а затем нажмите кнопку **Сохранить**. 
5. В области справа дважды щелкните имя большого двоичного объекта. По умолчанию имя большого двоичного объекта совпадает с именем кластера. 

6. Найдите **stdout** в столбце **Имя**. Проверьте, чтобы GUID в соответствующем столбце **Путь к папке** совпадал с GUID, который вы скопировали ранее. Совпадение предполагает, что выходные данные соответствуют отправленному заданию. Щелкните **Двоичный** в столбце слева от **stdout**.

	![Поиск выходных данных в списке содержимого по GUID.][image-hdi-gettingstarted-powerquery-importdata2]

9. В верхнем левом углу щелкните **Закрыть и загрузить** для импорта результатов задания Hive в Excel.


##<a name="nextsteps"></a>Дальнейшие действия
Из этого учебника вы узнали, как подготовить кластер с помощью HDInsight, запустить на нем задание MapReduce и импортировать результаты в Excel для дальнейшей обработки и отображения с использованием инструментов бизнес-аналитики. Для получения дополнительных сведений ознакомьтесь со следующими статьями:

- [Приступая к работе с инструментами HDInsight Hadoop для Visual Studio][1]
- [Приступая к работе с эмулятором HDInsight][hdinsight-emulator]
- [Использование хранилища больших двоичных объектов Azure с HDInsight][hdinsight-storage]
- [Администрирование HDInsight с использованием PowerShell][hdinsight-admin-powershell]
- [Отправка данных в HDInsight][hdinsight-upload-data]
- [Использование MapReduce с HDInsight][hdinsight-use-mapreduce]
- [Использование Hive с HDInsight][hdinsight-use-hive]
- [Использование Pig с HDInsight][hdinsight-use-pig]
- [Использование Oozie с HDInsight][hdinsight-use-oozie]
- [Разработка программ потоковой передачи Hadoop на C# для HDInsight][hdinsight-develop-streaming]
- [Разработка программ MapReduce на Java для HDInsight][hdinsight-develop-mapreduce]


[1]: hdinsight-hadoop-visual-studio-tools-get-started.md

[hdinsight-versions]: hdinsight-component-versioning.md

[hdinsight-get-started-30]: hdinsight-get-started-30.md
[hdinsight-provision]: hdinsight-provision-clusters.md
[hdinsight-admin-powershell]: hdinsight-administer-use-powershell.md
[hdinsight-upload-data]: hdinsight-upload-data.md
[hdinsight-use-mapreduce]: hdinsight-use-mapreduce.md
[hdinsight-use-hive]: hdinsight-use-hive.md
[hdinsight-use-pig]: hdinsight-use-pig.md
[hdinsight-use-oozie]: hdinsight-use-oozie.md
[hdinsight-storage]: hdinsight-use-blob-storage.md
[hdinsight-emulator]: hdinsight-get-started-emulator.md
[hdinsight-develop-streaming]: hdinsight-hadoop-develop-deploy-streaming-jobs.md
[hdinsight-develop-mapreduce]: hdinsight-develop-deploy-java-mapreduce.md
[hadoop-hdinsight-intro]: hdinsight-hadoop-introduction.md
[hdinsight-weblogs-sample]: hdinsight-hive-analyze-website-log.md
[hdinsight-sensor-data-sample]: hdinsight-hive-analyze-sensor-data.md

[azure-purchase-options]: http://azure.microsoft.com/pricing/purchase-options/
[azure-member-offers]: http://azure.microsoft.com/pricing/member-offers/
[azure-free-trial]: http://azure.microsoft.com/pricing/free-trial/
[azure-management-portal]: https://manage.windowsazure.com/
[azure-create-storageaccount]: storage-create-storage-account.md

[apache-hadoop]: http://go.microsoft.com/fwlink/?LinkId=510084
[apache-hive]: http://go.microsoft.com/fwlink/?LinkId=510085
[apache-mapreduce]: http://go.microsoft.com/fwlink/?LinkId=510086
[apache-hdfs]: http://go.microsoft.com/fwlink/?LinkId=510087
[hdinsight-hbase-custom-provision]: http://azure.microsoft.com/documentation/articles/hdinsight-hbase-get-started/


[powershell-download]: http://go.microsoft.com/fwlink/p/?linkid=320376&clcid=0x409
[powershell-install-configure]: install-configure-powershell.md
[powershell-open]: install-configure-powershell.md#Install


[img-hdi-dashboard]: ./media/hdinsight-get-started/HDI.dashboard.png
[img-hdi-dashboard-query-select]: ./media/hdinsight-get-started/HDI.dashboard.query.select.png
[img-hdi-dashboard-query-select-result]: ./media/hdinsight-get-started/HDI.dashboard.query.select.result.png
[img-hdi-dashboard-query-select-result-output]: ./media/hdinsight-get-started/HDI.dashboard.query.select.result.output.png
[img-hdi-dashboard-query-browse-output]: ./media/hdinsight-get-started/HDI.dashboard.query.browse.output.png

[img-hdi-getstarted-video]: ./media/hdinsight-get-started/HDI.GetStarted.Video.png


[image-hdi-storageaccount-quickcreate]: ./media/hdinsight-get-started/HDI.StorageAccount.QuickCreate.png
[image-hdi-clusterstatus]: ./media/hdinsight-get-started/HDI.ClusterStatus.png
[image-hdi-quickcreatecluster]: ./media/hdinsight-get-started/HDI.QuickCreateCluster.png
[image-hdi-getstarted-flow]: ./media/hdinsight-get-started/HDI.GetStartedFlow.png

[image-hdi-gettingstarted-powerquery-importdata]: ./media/hdinsight-get-started/HDI.GettingStarted.PowerQuery.ImportData.png
[image-hdi-gettingstarted-powerquery-importdata2]: ./media/hdinsight-get-started/HDI.GettingStarted.PowerQuery.ImportData2.png

<!--HONumber=54-->