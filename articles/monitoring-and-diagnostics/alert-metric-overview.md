---
title: Узнайте о работе оповещений о метриках в Azure Monitor.
description: Ознакомьтесь с обзором действий, применимых к оповещениям о метриках, а также узнайте о том, как они работают в Azure Monitor.
author: snehithm
ms.author: snmuvva
ms.date: 9/18/2018
ms.topic: conceptual
ms.service: azure-monitor
ms.component: alerts
ms.openlocfilehash: 1ec47ddf5769dd8ed624277a86db57f449581b90
ms.sourcegitcommit: 32d218f5bd74f1cd106f4248115985df631d0a8c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46948695"
---
# <a name="understand-how-metric-alerts-work-in-azure-monitor"></a>Сведения о работе оповещений о метриках в Azure Monitor

Оповещения о метриках в Azure Monitor работают для основных многомерных метрик. Это могут быть метрики платформы, пользовательские метрики (предварительная версия), популярные журналы из Log Analytics, преобразованные в метрики, стандартные метрики Application Insights. Оповещения о метриках выполняют анализ с регулярными интервалами для проверки соответствия условий временного ряда метрик и отправки оповещений при наличии правильных значений. Оповещения о метриках являются оповещениями с отслеживанием состояния, то есть уведомления отправляются только при изменении состояния.

## <a name="how-do-metric-alerts-work"></a>Как работают оповещения о метриках

Вы можете определить правило генерации оповещений метрики, указав целевой ресурс, который нужно отслеживать, имя метрики и условие (оператор и порог), а также группу действий, которую нужно активировать при срабатывании правила генерации оповещений.
Предположим, что вы создали простое правило генерации оповещений метрики следующим образом:

- Целевой ресурс (ресурс Azure, который требуется отслеживать): myVM.
- Метрика: загрузка ЦП.
- Агрегат времени (Статистический показатель, который выполняется в необработанных значениях метрик. Поддерживаемые агрегаты времени: Min, Max, Avg, Total): среднее.
- Период (окно, с помощью которого проверяются значения метрик):      за последние 5 минут
- Частота (частота, с которой оповещение о метрике проверяет, соблюдены ли условия): 1 мин
- Оператор:     GreaterThan
- Пороговое значение:      70

С момента создания правила генерации оповещений мониторинг выполняется каждую минуту, просматриваются значения метрики за последние 5 минут и проверяется, превышает ли среднее значение этих значений 70. Если условие выполняется, то есть средняя загрузка ЦП за последние 5 минут превышает 70, правило генерации оповещений запускает активированное уведомление. Если вы настроили действие электронной почты или веб-перехватчика в группе действий, связанной с правилом генерации оповещений, вы получите активированное уведомление для настроенных параметров.

Этот конкретный пример выполнения правила генерации оповещений можно также просмотреть на портале Azure или в колонке всех оповещений.

Скажем, если показатели использования в ресурсе myVM продолжает превышать порог при последующих проверках, правило генерации оповещений не сработает повторно, пока не будет устранено условие.

Если позже показатели использования в ресурсе myVM вернутся к нормальному состоянию, значение будет ниже указанного порога. Правило генерации оповещений отслеживает это условие еще два раза, чтобы отправить уведомление об устранении. Правило генерации оповещений отправляет сообщение об устранении или деактивации, когда условие оповещения не выполняется в течение трех последовательных периодов для сокращения отправки нежелательных оповещений в случае нестабильности условий.

По мере того как уведомление об устранении отправляется через веб-перехватчик или электронную почту, на портале Azure также обновляется состояние экземпляра оповещения ("Монитор состояния") на "Разрешено".

## <a name="monitoring-at-scale-using-metric-alerts-in-azure-monitor"></a>Мониторинг в масштабе с помощью оповещений о метриках в Azure Monitor

### <a name="using-dimensions"></a>Использование измерений

Оповещения о метриках в Azure Monitor также поддерживают отслеживание комбинаций значений нескольких измерений с одним правилом. Поясним на примере, почему вы можете использовать комбинации нескольких измерений.

Предположим, что у вас есть план службы приложений для веб-сайта. Вы хотите отследить использование ЦП на нескольких экземплярах, на которых запущен веб-сайт или приложение. Это можно сделать следующим образом, используя правило генерации оповещений о метрике.

- Целевой ресурс: myAppServicePlan
- Метрика: загрузка ЦП
- Измерения
  - Экземпляр = InstanceName1, InstanceName2
- Агрегат времени: среднее
- Период: за последние 5 минут
- Частота: 1 мин
- Оператор: GreaterThan
- Пороговое значение: 70

Как и раньше, это правило отслеживает, превышает ли среднее потребление ЦП за последние 5 минут 70 %. Тем не менее с помощью того же правила вы можете отслеживать два экземпляра, на которых запущен сайт. Каждый экземпляр будет отслеживаться индивидуально, и вы будете получать уведомления отдельно.

Скажем, у вас есть веб-приложение, которое очень часто используется, и вам нужно добавить больше экземпляров. Правило выше по-прежнему отслеживает только два экземпляра. Тем не менее можно создать правило следующим образом.

- Целевой ресурс: myAppServicePlan
- Метрика: загрузка ЦП
- Измерения
  - Экземпляр = *
- Агрегат времени: среднее
- Период: за последние 5 минут
- Частота: 1 мин
- Оператор: GreaterThan
- Пороговое значение: 70

Это правило будет автоматически отслеживать все значения для экземпляра, например вы можете отслеживать экземпляры по мере их появления без необходимости снова изменять правило генерации оповещений о метрике.

### <a name="monitoring-multiple-resource-using-metric-alerts"></a>Мониторинг нескольких ресурсов с помощью оповещений о метриках

Как видно из предыдущего раздела, можно настроить одно правило генерации оповещений о метрике, отслеживающее каждую отдельную комбинацию измерений (например, временные ряды метрик). Тем не менее вы по-прежнему ограничены одним ресурсом за раз. Оповещения о метриках теперь также поддерживают мониторинг нескольких ресурсов с одним правилом в предварительной версии. При наличии сотен виртуальных машин в подписке эта новая функция помогает быстро настроить их мониторинг. 

Эта функция в настоящее время находится на стадии предварительной версии. Создание правил генерации оповещений о метрике, которые отслеживают несколько ресурсов, через портал Azure в настоящее время не поддерживается. Эти правила можно создать, используя шаблоны Azure Resource Manager.

## <a name="typical-latency"></a>Обычная задержка

Для оповещений о метриках, как правило можно получить уведомление в течение 5 минут, если задать частоту правила генерации оповещений в 1 минуту. В случае серьезных нагрузок для систем отправки уведомлений может наблюдаться более длительная задержка.

## <a name="supported-resource-types-for-metric-alerts"></a>Поддерживаемые типы ресурсов оповещений о метриках

Полный список поддерживаемых типов ресурсов можно найти в этой [статье](monitoring-near-real-time-metric-alerts.md#metrics-and-dimensions-supported).

## <a name="next-steps"></a>Дополнительная информация

- [Сведения о создании, просмотре и администрировании оповещений о метриках в Azure](alert-metric.md)
- [Сведения о развертывании оповещений о метриках с помощью шаблонов Azure Resource Manager](monitoring-create-metric-alerts-with-templates.md)
- [Дополнительные сведения о группах действий](monitoring-action-groups.md)
