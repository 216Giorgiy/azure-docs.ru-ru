---
title: Создание и просмотр оповещений, а также управление ими с помощью Azure Monitor
description: Используйте новые унифицированные возможности оповещений Azure для централизованного создания и просмотра метрик и правил оповещений журналов, а также для управления ими.
author: msvijayn
services: azure-monitor
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 02/05/2018
ms.author: vinagara
ms.component: alerts
ms.openlocfilehash: 51912bab0a038e99ecf77b8012c4087b029d4508
ms.sourcegitcommit: 1b8665f1fff36a13af0cbc4c399c16f62e9884f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2018
ms.locfileid: "35264346"
---
# <a name="create-view-and-manage-alerts-using-azure-monitor"></a>Создание и просмотр оповещений, а также управление ими с помощью Azure Monitor  

## <a name="overview"></a>Обзор
В этой статье показано, как настроить оповещения с помощью нового интерфейса оповещений на портале Azure. Определение правила оповещений состоит из трех частей:
- Цель: определенный ресурс Azure, который следует отслеживать.
- Критерий: определенное условие или логика в сигнале, которые должны вызывать действие.
- Действие: конкретный вызов, отправленный получателю уведомления — электронное сообщение, текстовое сообщение, веб-перехватчик и т. д.

Служба "Оповещения Azure" также обеспечивает единое представление обо всех правилах оповещений и предоставляет возможность централизованного управления ими, включая просмотр любых неразрешенных оповещений. Дополнительные сведения о функциях см. в статье [Новые возможности оповещений в Azure Monitor](monitoring-overview-unified-alerts.md).

В интерфейсе оповещений используется термин **оповещения журнала**. Это оповещения, для которых сигналом выступает пользовательский запрос на основе [Log Analytics](../log-analytics/log-analytics-tutorial-viewdata.md) или [Application Insights](../application-insights/app-insights-analytics.md). [Новая функция оповещения на основе метрик](monitoring-near-real-time-metric-alerts.md) предоставляет возможность оповещения на основе [многомерных метрик](monitoring-metric-charts.md) для определенных ресурсов Azure. Оповещения для таких ресурсов могут использовать дополнительные фильтры по измерениям, создавая **оповещения на основе многомерных метрик**.


> [!NOTE]
> Служба "Оповещения Azure" предлагает новые улучшенные возможности для создания оповещений в Azure. Имеющийся интерфейс [оповещений (классическая версия)](monitoring-overview-alerts.md) остается доступным.
>

Ниже приводится пошаговое руководство по использованию интерфейса оповещений Azure.

## <a name="create-an-alert-rule-with-the-azure-portal"></a>Создание правила оповещений с помощью портала Azure
1. На [портале](https://portal.azure.com/) выберите **Мониторинг**, а затем в разделе "Мониторинг" выберите **Оповещения**.  
    ![Мониторинг](./media/monitor-alerts-unified/AlertsPreviewMenu.png)

2. Нажмите кнопку **Новое правило генерации оповещений**, чтобы создать оповещение в Azure.
    ![Добавление оповещения](./media/monitor-alerts-unified/AlertsPreviewOption.png)

3. Появится раздел "Создать оповещение" с тремя элементами: *Define alert condition* (Определите условие оповещения), *Define alert details* (Определите сведения об оповещении) и *Define action group* (Определите группу действий).

    ![Создание правила](./media/monitor-alerts-unified/AlertsPreviewAdd.png)

4.  Определите условие оповещения, используя ссылку **Выбор ресурса** и указав ресурс. Отфильтруйте и выберите *подписку, *тип ресурса, а затем выберите требуемый *ресурс*.

    >[!NOTE]

    > Прежде чем продолжить, проверьте доступные сигналы для выбранного ресурса.

    ![Выбор ресурса](./media/monitor-alerts-unified/Alert-SelectResource.png)

 Пользовательский интерфейс позволяет централизованно создавать различные типы оповещений. На основе типа требуемого оповещения выберите следующий шаг:

    - Для **оповещения метрик**: выполните шаги с 5 по 7, а затем перейдите к шагу 11.
    - Для **оповещения журналов**: перейдите к шагу 8.

    > [!NOTE]

    > Оповещения журнала действий также поддерживаются, но находятся на этапе предварительной версии. [Узнайте больше](monitoring-activity-log-alerts-new-experience.md).

5. *Оповещения метрики: Для параметра **Тип ресурса** следует выбрать тип сигнала **Метрика**. Выбрав соответствующий **ресурс**, нажмите кнопку *Готово*, чтобы вернуться к созданию оповещений. Затем нажмите кнопку **Добавить критерии**, чтобы выбрать конкретный сигнал из списка параметров сигнала, службу мониторинга и тип, доступный для ресурса, выбранного ранее.

    ![Выбор ресурса](./media/monitor-alerts-unified/AlertsPreviewResourceSelection.png)

    > [!NOTE]

    >  Для всех ресурсов с поддержкой [оповещений в режиме близком к реальному времени](monitoring-near-real-time-metric-alerts.md) в качестве службы мониторинга указано значение **Платформа**, а для типа сигнала — **Метрика**.

6. *Оповещения метрик*. Выбрав сигнал, можно указать логику оповещения. Для справки отображаются исторические данные сигнала с возможностью настройки временного окна от последних шести часов до последней недели с помощью кнопки **Show History** (Показать журнал). После настройки визуализации можно выбрать **логику оповещений** из показанных параметров "Условие", "Агрегирование" и "Пороговое значение". В окне предпросмотра логики отображаются условия в визуализации вместе с историей сигнала, чтобы указать, когда было вызвано оповещение. Затем укажите, за какой период времени оповещение должно искать заданное условие, выбрав параметр **Period** (Период), а также частоту вызова оповещения, выбрав параметр **Frequency** (Частота).

    ![Настройка логики сигналов для метрик](./media/monitor-alerts-unified/AlertsPreviewCriteria.png)

7. *Метрики оповещений*. Если сигнал является метрикой, в окне оповещений можно выполнять фильтрацию с использованием нескольких точек данных или измерений для указанного ресурса Azure. 

    a. В раскрывающемся списке **Показать журнал** выберите длительность для визуализации другого периода времени. Вы можете выбрать измерения поддерживаемых метрик (необязательно) для фильтрации по временным рядам. Может использоваться до пяти измерений. 

    Б. **Логику оповещений** можно выбрать в одном из показанных параметров *Условие*, *Агрегирование и *Пороговое значение*. В окне предпросмотра логики отображаются условия визуализации вместе с историей сигнала, чтобы указать, когда оповещение было вызвано в прошлом. 

    c. Чтобы указать период времени, выберите **Период** и частоту выполнения оповещения, выбрав параметр **Частота**.

    ![Настройка логики сигнала многомерной метрики](./media/monitor-alerts-unified/AlertsPreviewCriteriaMultiDim.png)

8. *Оповещения журналов.* В качестве **типа ресурса** выберите источник данных аналитики, например *Log Analytics* или *Application Insights*, а в качестве типа сигнала — **Журнал**. Выбрав соответствующий **ресурс**, нажмите кнопку *Готово*. Затем нажмите кнопку **Добавить условие**, чтобы просмотреть список доступных параметров сигнала для ресурса. В списке сигналов выберите **Custom log search** (Пользовательский поиск по журналам) для выбранной службы мониторинга журналов, например *Log Analytics* или *Application Insights*.

   ![Выбор ресурса: пользовательский поиск по журналам](./media/monitor-alerts-unified/AlertsPreviewResourceSelectionLog.png)

   > [!NOTE]

   > Списки интерфейса оповещений могут импортировать запрос аналитических данных как тип сигнала — **Log (Saved Query)** (Журнал (сохраненный запрос)), как показано на приведенном выше изображении. Таким образом, пользователи могут усовершенствовать ваш запрос в Analytics, а затем сохранить его для дальнейшего использования в оповещениях. Дополнительные сведения о сохранении запросов см. в статьях об [использовании поиска по журналам в Log Analytics](../log-analytics/log-analytics-log-searches.md) или [совместном использовании запроса аналитических данных Application Insights](../log-analytics/log-analytics-overview.md). 

9.  *Оповещения журналов*. После выбора запрос для оповещения можно указать в поле **Search Query** (Поисковой запрос). Если синтаксис запроса неверен, в поле отображается ошибка, выделенная красным цветом. Если синтаксис запроса верен, появятся исторические данные указанного запроса для справки в виде графика с возможностью настройки временного интервала от последних шести часов до последней недели.

 ![Настройка правил оповещений](./media/monitor-alerts-unified/AlertsPreviewAlertLog.png)

 > [!NOTE]

    > Визуализация исторических данных может отображаться, только если в результатах запроса есть данные о времени. Если при выполнении запроса появляются обобщенные данные или значения конкретных столбцов, то они отображаются как отдельный график.

    >  Для оповещений журнала типа "Измерения метрик" с использованием Application Insights вы можете указать конкретную переменную для группирования данных, используя параметр **Агрегация по**, как показано ниже:

    ![параметр "Агрегация по"](./media/monitor-alerts-unified/aggregate-on.png)

10.  *Оповещения журналов*. После настройки визуализации можно выбрать **логику оповещений**из показанных параметров "Условие", "Агрегирование" и "Пороговое значение". В логике укажите время для оценки заданного условия с помощью параметра **Period** (Период). Кроме того, укажите частоту запуска оповещений, выбрав параметр **Frequency** (Частота).
**Оповещения журналов** могут создаваться на основе таких данных:
   - *Число записей*. Оповещение создается, если количество записей, возвращаемых запросом, больше или меньше указанного вами значения.
   - *Измерение метрик*. Оповещение создается, если каждое *статистическое значение* в результатах превышает указанное пороговое значение, которое *группируется* в соответствии с выбранным значением. Количество нарушений для оповещения — это количество превышений порогового значения в течение выбранного периода времени. Можно указать значение свойства Всего брешей, чтобы учитывать любое сочетание нарушений в наборе результатов, или значение свойства Последовательные бреши, чтобы учитывать только нарушения, следующие подряд. Дополнительные сведения см. в статье [Log alerts in Azure Monitor — Alerts (Preview)](monitor-alerts-unified-log.md) (Журнал оповещений в Azure Monitor ("Оповещения (предварительная версия)")).

    > [!TIP]
    > В настоящее время в службе "Оповещения" оповещения о поиске по журналам могут принимать пользовательские значения *периода* и *частоты* в минутах. Значения могут находиться в диапазоне от 5 до 1440 минут (24 часа). Если требуется, чтобы период оповещения был в диапазоне трех часов, преобразуйте его в минуты (180 минут), прежде чем использовать.

11. В качестве второго шага в параметрах задайте имя оповещения в поле **Имя правила генерации оповещений**, а также введите подробные сведения в поле **Описание** и **Severity** (Серьезность). Эти данные повторно используются во всех оповещениях по электронной почте, уведомлениях или push-уведомлениях Azure Monitor. Кроме того, пользователь может сразу же активировать правило оповещения при создании, переключив параметр **Включить правило при создании**.

    Для параметра **Оповещения журналов** доступны только некоторые дополнительные функции в разделе "Детали оповещения":

    - **Отключить оповещения**. При включении подавления для правила генерации оповещений действия для этого правила отключаются на заданный промежуток времени после создания оповещения. Правило по прежнему выполняется и создает записи оповещений при соблюдении критериев. Это дает вам время устранить проблему без запуска повторяющихся действий.

        ![Отключение оповещений в оповещениях журналов](./media/monitor-alerts-unified/AlertsPreviewSuppress.png)

        > [!TIP]
        > Укажите значение предупреждения, превышающее частоту предупреждения, чтобы гарантировать, что уведомления прекращаются без перекрытия

12. В качестве третьего и последнего шага укажите, нужно ли запускать **группу действий** для правила оповещения, если выполняется условие. Вы можете выбрать любую имеющуюся группу действий с оповещением или создать новую. Согласно выбранной группе действий при срабатывании оповещения Azure отправит электронное письмо, текстовое сообщение, вызовет веб-перехватчик, устранит проблему с помощью модуля Runbook Azure, отправит push-уведомление в инструмент ITSM и т. д. Дополнительные сведения о группах действий см. в статье [Create and manage action groups in the Azure portal](monitoring-action-groups.md) (Создание групп действий и управление ими на портале Azure).

    Для **оповещений журналов** доступны дополнительные функции для переопределения действий по умолчанию:

    - **Уведомление по электронной почте**: Переопределяет *тему в письме*, отправленном через группу действия, если в указанной группе существует одно или несколько действий электронного сообщения. Основной текст сообщения нельзя изменить, и в этом поле вы **не можете** указать адрес электронной почты.
    - **Включить настраиваемые полезные данные JSON.** Переопределяет JSON веб-перехватчика, используемый группами действий, если в указанной группе существует одно или несколько действий веб-перехватчика. Вы можете задать формат JSON, который будет использоваться для всех веб-перехватчиков в связанной группе действий. Дополнительные сведения о форматах веб-перехватчиков см. в статье [Действия веб-перехватчика для правил оповещений журнала](monitor-alerts-unified-log-webhook.md). Параметр "Проверить веб-перехватчик" позволяет проверить форматирование и обработку по назначению с использованием примера JSON. Этот параметр (согласно метке) предназначен только для **тестирования**.

        ![Переопределение действий оповещений журналов](./media/monitor-alerts-unified/AlertsPreviewOverrideLog.png)

        > [!NOTE]
        > Для работы параметра **"Тестирование веб-перехватчика"**, конечная точка должна поддерживать [Cross Origin Resource Sharing (CORS)](https://www.w3.org/TR/cors/), а также пользователь может использовать прокси-серверы CORS для устранения проблем, "No Access-Control-Allow-Origin header"

13. Если все поля действительны и выделены зеленым цветом, нажмите кнопку **Создать правило оповещения**, чтобы создать оповещение в Azure Monitor ("Оповещения "). Все оповещения можно просмотреть с помощью панели мониторинга службы "Оповещения".

    ![Создание правила](./media/monitor-alerts-unified/AlertsPreviewCreate.png)

    Через несколько минут оповещение включится и будет активироваться, как было описано выше.

## <a name="view-your-alerts-in-azure-portal"></a>Просмотр оповещений на портале Azure

1. На [портале](https://portal.azure.com/) выберите **Мониторинг**, а затем в разделе "Мониторинг" выберите **Оповещения**.  

2. Отображается **панель мониторинга службы "Оповещения"**, в которой все оповещения Azure объединены и отображаются в единственной панели мониторинга. ![Панель мониторинга оповещений](./media/monitoring-alerts-unified-usage/alerts-preview-overview.png)
3. В верхнем левом углу щелкните панель мониторинга, чтобы просмотреть подробный список:
    - *Сработавшие оповещения.* Количество запущенных оповещений, которые соответствовали условиям логики.
    - *Всего правил генерации оповещений*. Количество активных созданных правил оповещений.
4. Отображается список всех оповещений, которые можно щелкнуть, чтобы просмотреть сведения.
5. Чтобы отфильтровать определенные оповещения, можно использовать параметры раскрывающегося списка *Подписка, Группы ресурсов или Ресурс*. Для неразрешенных оповещений выберите параметр *Filter alert* (Оповещение фильтра) для поиска ключевого слова: *имя, критерии оповещения, группа ресурсов и целевой ресурс*.

## <a name="managing-your-alerts-in-azure-portal"></a>Управление оповещениями на портале Azure
1. На [портале](https://portal.azure.com/) выберите **Мониторинг**, а затем в разделе "Мониторинг" выберите **Оповещения**.  
2. Нажмите кнопку **​​Управление правилами** на верхней панели, чтобы перейти к разделу управления правилами, в котором перечислены все созданные правила оповещений, включая отключенные оповещения.
3. Чтобы найти определенные правила оповещений, можно либо использовать раскрывающиеся фильтры в верхней части, позволяющие отобразить короткий список правил оповещений для определенной *подписки, группы ресурсов или ресурса*. Помимо этого при использовании панели поиска *Фильтрация оповещений* можно указать ключевое слово, которое сопоставляется с *именем оповещения, условием и целевым ресурсом* для отображения только совпадающих правил.
   ![Правило управления правилами](./media/monitoring-alerts-unified-usage/alerts-preview-rules.png)
4. Чтобы просмотреть или изменить определенное правило оповещения, щелкните его имя, которое будет отображаться в виде ссылки.
5. Оповещение отображается следующим образом в виде трехступенчатой структуры: 1. Определение условия оповещения; 2. Сведения о предупреждении; 3. Группа действий. **Целевые условия**. Щелкните, чтобы изменить логику оповещений или добавить новый критерий с помощью значка "Корзина", чтобы удалить предыдущую логику. В разделе сведений об оповещении можно изменить параметры **Описание** и **Серьезность**. Кроме того, можно изменить группу действий или создать новую с помощью кнопки **Новая группа действий**.

   ![Изменение правил генерации оповещений](./media/monitor-alerts-unified/AlertsPreviewEdit.png)

6. Используя верхнюю панель, щелкните **Сохранить**, чтобы внести изменения, **Отменить**, чтобы не вносить изменения, или **Отключить**, чтобы отключить оповещения. Кроме того, можно выбрать **Удалить**, чтобы удалить все правила создания оповещений в Azure.

## <a name="next-steps"></a>Дополнительная информация

- Узнайте больше об [оповещениях на основе метрик практически в реальном времени](monitoring-near-real-time-metric-alerts.md).
- Прочитайте [обзор сбора метрики](insights-how-to-customize-monitoring.md) и узнайте, как можно обеспечить, чтобы служба была доступна и отвечала на запросы.
- Дополнительные сведения см. в статье [Оповещения журнала в Azure Monitor. Интерфейс оповещений](monitor-alerts-unified-log.md).
- [Создание оповещений журнала действий с помощью новой функции "Оповещения (предварительная версия)"](monitoring-activity-log-alerts-new-experience.md)
