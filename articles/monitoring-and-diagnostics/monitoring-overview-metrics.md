---
title: Обзор метрик в Microsoft Azure
description: Обзор метрик и их использования в Microsoft Azure
author: anirudhcavale
services: azure-monitor
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 06/05/2018
ms.author: ancav
ms.component: metrics
ms.openlocfilehash: d61ac48aa7c51bc4b215a7d56b1bbedfdc613f9f
ms.sourcegitcommit: f94f84b870035140722e70cab29562e7990d35a3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/30/2018
ms.locfileid: "43287562"
---
# <a name="overview-of-metrics-in-microsoft-azure"></a>Обзор метрик в Microsoft Azure
Из этой статьи вы узнаете, что такое метрики в Microsoft Azure, какими преимуществами они обладают и как ими пользоваться.  

## <a name="what-are-metrics"></a>Что такое метрики
Azure Monitor позволяет использовать данные телеметрии, чтобы получать сведения о производительности и работоспособности рабочих нагрузок в Azure. Наиболее важным типом данных телеметрии Azure являются метрики (также называемые счетчиками производительности), создаваемые большинством ресурсов Azure. Azure Monitor предоставляет несколько способов настройки и использования этих метрик для мониторинга и устранения неполадок.

## <a name="what-are-the-characteristics-of-metrics"></a>Характеристики метрик
Метрики обладают следующими характеристиками.

* Все метрики обновляются **один раз в минуту** (если в определении метрики не указано иное). Вы получаете значение метрики от ресурса каждую минуту, что позволяет в близком к реальному времени отслеживать его состояние и работоспособность.
* Метрики **доступны сразу же**. Вам не нужно что-либо настраивать или устанавливать дополнительные средства диагностики.
* Для каждой метрики доступен **журнал за последние 93 дня**. Можно быстро взглянуть на последние и ежемесячные тенденции производительности и работоспособности ресурса.
* Некоторые метрики могут иметь атрибуты в виде пары "имя — значение", называемые **измерениями**. Это позволяет дополнительно разделить и изучить метрику более конструктивным образом.

## <a name="what-can-you-do-with-metrics"></a>Что можно делать с помощью метрик
Метрики позволяют выполнять следующие задачи:


- Настраивать для метрик **правила генерации оповещений, которые отправляют уведомления или выполняют автоматизированные действия**, когда значение метрики достигает определенного порогового значения. Действиями можно управлять через [группы действий](monitoring-action-groups.md). Пример действий включает: сообщение электронной почты, телефонный вызов и SMS-уведомление, вызов веб-перехватчика, запуск runbook и др. **Автомасштабирование** — специальное автоматическое действие, которое позволяет масштабировать ресурсы для работы с нагрузкой, не повышая затрат. Для автомасштабирования можно настроить правило, которое будет масштабировать ресурсы при достижении определенного порогового значения метрики.
- Все метрики можно **Направлять** в *Application Insights* или *Log Analytics*, чтобы использовать возможности мгновенной аналитики, поиска и пользовательских оповещений на основе данных метрик, поступающих от ресурсов. Вы также можете использовать потоковую передачу метрик в *Концентратор событий*. Это позволяет перенаправлять их в службу Azure Stream Analytics или в пользовательские приложения для оперативного анализа. Потоковую передачу в концентратор событий можно настроить с помощью параметров диагностики.
- **Архивация** журнала производительности и работоспособности ресурса в целях соответствия требованиям, аудита или автономной отчетности.  При настройке параметров диагностики ресурса можно настроить отправку метрик в хранилище BLOB-объектов.
- Используйте **портал Microsoft Azure** чтобы находить, открывать и просматривать все метрики, выбрав ресурс и отобразив данные на диаграмме. Вы можете отслеживать производительность ресурса (например, виртуальной машины, веб-сайта или приложения логики). Эту диаграмму можно закрепить на панели мониторинга.  
- **Выполнять расширенную аналитику** или создавать подробные отчеты о производительности ресурсов или тенденциях их использования.
- **Запрашивать** метрики, используя командлеты PowerShell или кроссплатформенный интерфейс REST API.
- **Использовать** метрики через новые интерфейсы REST API в Azure Monitor.

  ![Перенаправление метрик в Azure Monitor](./media/monitoring-overview-metrics/Metrics_Overview_v4.png)

## <a name="access-metrics-via-the-portal"></a>Доступ к метрикам через портал
Ниже мы вкратце рассмотрим, как создать диаграмму метрик на портале Azure.

### <a name="to-view-metrics-after-creating-a-resource"></a>Просмотр метрик после создания ресурса
1. Перейдите на портал Azure.
2. Создайте веб-сайт службы приложений Azure.
3. Создав веб-сайт, откройте колонку **Обзор**.
4. Новые метрики можно просмотреть на плитке **Мониторинг**. Эту плитку можно изменить и добавить на нее дополнительные метрики.

   ![Метрики ресурсов в Azure Monitor](./media/monitoring-overview-metrics/MetricsOverview1.png)

### <a name="to-access-all-metrics-in-a-single-place"></a>Централизованный доступ ко всем метрикам
1. Перейдите на портал Azure.
2. Перейдите на новую вкладку **Монитор** и щелкните **Метрики**.
3. В раскрывающемся списке выберите свою подписку, группу ресурсов и имя ресурса.
4. Просмотрите список доступных метрик. Выберите интересующую вас метрику и добавьте ее на график.
5. Диаграмму можно закрепить на панели мониторинга, щелкнув значок булавки в правом верхнем углу.

   ![Доступ ко всем метрикам в одной области в Azure Monitor](./media/monitoring-overview-metrics/MetricsOverview2.png)

> [!NOTE]
> Без дополнительных настроек диагностики доступны метрики уровня узла, передаваемые виртуальными машинами (на основе Azure Resource Manager) и масштабируемыми наборами виртуальных машин. Эти новые метрики доступны для экземпляров Windows и Linux. Эти метрики не следует путать с метриками уровня гостевой ОС, которые вам доступны при включении системы диагностики Azure в виртуальных машинах или масштабируемых наборах виртуальных машин. Дополнительные сведения о настройке системы диагностики Microsoft Azure см. [здесь](../azure-diagnostics.md).
>
>

Azure Monitor также имеет новые метрики построения диаграмм, которые сейчас находятся в предварительной версии. Это позволяет пользователям накладывать метрики разных типов ресурсов на одной диаграмме. Пользователи также могут создавать, разделять и фильтровать многомерные метрики с помощью метрик построения диаграмм. Для получения дополнительных сведений щелкните [здесь](https://aka.ms/azuremonitor/new-metrics-charts).

## <a name="access-metrics-via-the-rest-api"></a>Доступ к метрикам через REST API
К метрикам Azure можно обращаться через API-интерфейсы Azure Monitor. Есть два API-интерфейса для поиска метрик и доступа к ним:

* [REST API определений метрик Azure Monitor](https://docs.microsoft.com/rest/api/monitor/metricdefinitions) используется для доступа к списку метрик и любых измерений, которые доступны для службы.
* [REST API метрик Azure Monitor](https://docs.microsoft.com/rest/api/monitor/metrics) используется для сегментирования и фильтрации данных метрик, а также для доступа к ним.

> [!NOTE]
> В этой статье описывается работа с метриками с помощью [нового API для метрик](https://docs.microsoft.com/rest/api/monitor/) ресурсов Azure. Версия нового API метрик и определений метрик — 2018-01-01. Для доступа к устаревшим метрикам и их определениям используйте API версии 2014-04-01.
>
>

Подробные инструкции см. в [пошаговом руководстве по REST API Azure Monitor](monitoring-rest-api-walkthrough.md).

## <a name="export-metrics"></a>Экспорт метрик
Откройте колонку **Параметры системы диагностики** на вкладке **Монитор** и просмотрите варианты экспорта метрик. Метрики (и журналы диагностики) можно перенаправлять в хранилище BLOB-объектов, Центры событий Azure или консоль Log Analytics, где их можно использовать, как описано выше.

 ![Параметры экспорта метрик в Azure Monitor](./media/monitoring-overview-metrics/MetricsOverview3.png)

Экспорт метрик можно настроить с помощью шаблонов Resource Manager, [PowerShell](insights-powershell-samples.md), [интерфейса командной строки Azure](insights-cli-samples.md) или [интерфейсов REST API](https://msdn.microsoft.com/library/dn931943.aspx).

> [!NOTE]
> Отправка многомерных метрик с помощью параметров диагностики сейчас не поддерживается. Метрики с измерениями экспортируются как преобразованные в плоскую структуру одномерные метрики, агрегированные по значениям измерений.
>
> *Пример.* Метрику "Входящие сообщения" в концентраторе событий можно изучить и вывести в виде диаграммы на уровне очереди. Но при экспорте с помощью параметров диагностики метрика будет представлена в виде всех входящих сообщений для всех очередей концентратора событий.
>
>

## <a name="take-action-on-metrics"></a>Действия с метриками
Чтобы получать уведомления или выполнять автоматизированные действия на основе полученных данных метрик, можно настроить правила генерации оповещений или параметры автомасштабирования.

### <a name="configure-alert-rules"></a>Настройка правил генерации оповещений
На основе метрик можно настроить правила генерации оповещений. Эти правила проверяют, достигла ли та или иная метрика определенного порогового значения. Azure Monitor предлагает две возможности оповещений на основе метрик.

Оповещения на основе метрик. Они могут отправлять вам на электронную почту уведомления или активировать объект webhook, который может запускать пользовательские скрипты. Объект webhook может также использоваться для настройки интеграции с продуктами сторонних производителей.

 ![Метрики и правила генерации оповещений в Azure Monitor](./media/monitoring-overview-metrics/MetricsOverview4.png)

Новые оповещения на основе метрик могут отслеживать несколько метрик и пороговые значения ресурса, а затем отправлять вам уведомления с помощью [группы действий](monitoring-action-groups.md). Дополнительные сведения см. в статье [Использование новых оповещений метрик для служб Azure на портале Azure](https://aka.ms/azuremonitor/near-real-time-alerts).


### <a name="autoscale-your-azure-resources"></a>Автомасштабирование ресурсов Azure
Некоторые ресурсы Azure поддерживают разворачивание и сворачивание экземпляров для обработки рабочих нагрузок. Автомасштабирование применяется к службе приложений (веб-приложения), масштабируемым наборам виртуальных машин и классическим облачным службам Azure. Вы можете настроить правила автомасштабирования, которые будут разворачивать или сворачивать ресурсы, когда определенная метрика, влияющая на рабочую нагрузку, достигает заданного порогового значения. Дополнительные сведения см. в статье [Обзор автомасштабирования в виртуальных машинах, облачных службах и веб-приложениях Microsoft Azure](monitoring-overview-autoscale.md).

 ![Метрики и автомасштабирование в Azure Monitor](./media/monitoring-overview-metrics/MetricsOverview5.png)

## <a name="learn-about-supported-services-and-metrics"></a>Поддерживаемые службы и метрики
Подробный список поддерживаемых служб и их метрики см. в статье [Метрики, поддерживаемые Azure Monitor](monitoring-supported-metrics.md).

## <a name="next-steps"></a>Дополнительная информация
Перейдите по ссылкам в этой статье. Кроме того, ознакомьтесь со следующими материалами:  

* [Общие метрики автомасштабирования Azure Monitor](insights-autoscale-common-metrics.md)
* [Создание оповещений для служб Azure с помощью портала Azure](insights-alerts-portal.md)
* [Сбор журналов и метрик для служб Azure для использования в Log Analytics](../log-analytics/log-analytics-azure-storage.md)
