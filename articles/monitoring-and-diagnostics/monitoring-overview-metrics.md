<properties
    pageTitle="Обзор метрик в Microsoft Azure | Microsoft Azure"
    description="Обзор метрик и их использования в Microsoft Azure."
    authors="kamathashwin"
    manager=""
    editor=""
    services="monitoring-and-diagnostics"
    documentationCenter="monitoring-and-diagnostics"/>

<tags
    ms.service="monitoring-and-diagnostics"
    ms.workload="na"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="09/26/2016"
    ms.author="ashwink"/>


# <a name="overview-of-metrics-in-microsoft-azure"></a>Обзор метрик в Microsoft Azure 

В этой статье объясняется, что такое метрики в Microsoft Azure, каковы их преимущества и как начать их использовать.  

## <a name="what-are-metrics?"></a>Что такое метрики?

Azure Monitor позволяет использовать данные телеметрии, чтобы получать сведения о производительности и работоспособности рабочих нагрузок в Azure. Наиболее важным типом данных телеметрии Azure являются метрики (также называемые счетчиками производительности), выдаваемые большинством ресурсов Azure. Azure Monitor предоставляет несколько способов настройки и использования этих метрик для мониторинга и устранения неполадок.


## <a name="what-can-you-do-with-metrics?"></a>Что можно делать с помощью метрик?

Метрики — ценный источник данных телеметрии. Ниже перечислены их возможности.

- **Отслеживание производительности** ресурса (например, виртуальной машины, веб-сайта или приложения логики) путем построения его метрик на диаграмме портала, которую можно закрепить на панели мониторинга.
- **Получение уведомлений о проблеме** , влияющей на производительность ресурса, когда значение метрики выходит за определенное пороговое значение.
- **Настройка автоматизированных действий**, в том числе автомасштабирования ресурса или запуска модуля Runbook, когда значение метрики выходит за определенное пороговое значение.
- **Выполнение расширенной аналитики** или создание отчетов о производительности или тенденциях использования ресурсов.
- **Архивация** журнала производительности и работоспособности ресурса в целях **соответствия требованиям или аудита**.

##  <a name="metric-characteristics"></a>Характеристики метрик
Метрики обладают следующими характеристиками.

- Частота показаний всех метрик составляет **1 минуту**. Вы получаете значение метрики от ресурса каждую минуту, что позволяет в близком к реальному времени отслеживать его состояние и работоспособность.
- Метрики **предоставляются в готовом виде и не требуют явного согласия на использование** или настройки дополнительной диагностики.
- Для каждой метрики доступен **журнал за последние 30 дней** . Можно быстро взглянуть на последние и ежемесячные тенденции производительности и работоспособности ресурса.

Вы можете:

- Легко обнаружить, открыть и **просмотреть все метрики** на портале Azure, выбрав ресурс и отобразив их на диаграмме. 
- Настроить для метрики **правило генерации оповещений, которое отправляет уведомление или выполняет автоматизированное действие** , когда значение метрики выходит за определенное пороговое значение. Автомасштабирование — это специальные автоматизированное действие, которое позволяет развернуть ресурс для обработки дополнительных входящих запросов или возросшей нагрузки на веб-сайт или вычислительные ресурсы. Можно настроить правило настройки автомасштабирования для разворачивания и сворачивания ресурсов в зависимости от выхода значения метрики за пороговое значение.
- **Архивировать** метрики для длительного хранения или использования в автономных отчетах. Во время настройки параметров диагностики ресурса можно направить метрики в хранилище BLOB-объектов.
- **Передавать поток** метрик в концентратор событий, что позволит затем перенаправлять их в Azure Stream Analytics или пользовательские приложения для анализа в близком к реальному времени. Это можно сделать при помощи параметров диагностики.
- **Направлять** все метрики в OMS Log Analytics, чтобы получить возможности мгновенной аналитики, поиска и пользовательских оповещений на основе данных метрик ресурсов.
- **Использовать** метрики посредством новых интерфейсов REST API Azure Monitor.
- **Запрашивать** метрики, используя командлеты PowerShell или кроссплатформенный REST API.

 ![Перенаправление метрик в Azure Monitor](./media/monitoring-overview-metrics/MetricsOverview0.png)

## <a name="access-metrics-via-portal"></a>Доступ к метрикам через портал
Ниже приведено краткое пошаговое руководство по созданию диаграммы метрики на портале Azure.

### <a name="view-metrics-after-creating-a-resource"></a>Просмотр метрик после создания ресурса
1. Откройте портал Azure.
2. Создайте службу приложений типа "Веб-сайт".
3. После создания веб-сайта перейдите к его колонке "Обзор".
4. Новые метрики можно просмотреть в элементе "Мониторинг". Этот элемент можно изменить и выбрать дополнительные метрики.

 ![Метрики ресурсов в Azure Monitor](./media/monitoring-overview-metrics/MetricsOverview1.png)    

### <a name="access-all-metrics-in-a-single-place"></a>Доступ ко всем метрикам в одной области
1. Откройте портал Azure. 
2. Перейдите на новую вкладку "Мониторинг" и щелкните "Метрики" под ней. 
3. Из раскрывающегося списке можно выбрать подписку, группу ресурсов и имя ресурса. 
4. Теперь можно просмотреть список доступных метрик. 
5. Выберите интересующую вас метрику и постройте ее диаграмму. 
6. Ее можно закрепить на панели мониторинга, щелкнув "Закрепить" в правом верхнем углу.

 ![Доступ ко всем метрикам в одной области в Azure Monitor](./media/monitoring-overview-metrics/MetricsOverview2.png) 


>[AZURE.NOTE] Без дополнительных настроек диагностики доступны метрики уровня узла, передаваемые виртуальными машинами (на основе Azure Resource Manager) и наборами масштабирования виртуальных машин. Эти новые метрики уровня узла доступны для экземпляров Windows и Linux. Не следует путать эти метрики с метриками уровня гостевой ОС, к которым вы получаете доступ при включении системы диагностики Azure в виртуальных машинах или наборах масштабирования виртуальных машин. Чтобы узнать больше о настройке системы диагностики Azure, ознакомьтесь с разделом [Что такое система диагностики Microsoft Azure](../azure-diagnostics.md).

## <a name="access-metrics-via-rest-api"></a>Доступ к метрикам с помощью REST API
К метрикам Azure можно обращаться посредством интерфейсов API Azure Monitor. Существует два API для обнаружения метрик и доступа к ним. Вы можете использовать: 

- [REST API определений метрик Azure Monitor](https://msdn.microsoft.com/library/mt743621.aspx) для доступа к списку метрик, доступных для службы;
- [REST API метрик Azure Monitor](https://msdn.microsoft.com/library/mt743622.aspx) для доступа к фактическим данным метрик.

>[AZURE.NOTE] В этой статье описывается работа с метриками с помощью [нового API для метрик](https://msdn.microsoft.com/library/dn931930.aspx) ресурсов Azure. Версия нового API определений метрик — 2016-03-01, а версия API метрик — 2016-09-01. Для доступа к прежним определениям метрик и метрикам можно использовать api-version 2014-04-01.

Более подробные пошаговые инструкции по использованию REST API Azure Monitor см. в статье [Пошаговое руководство по REST API Azure Monitor](monitoring-rest-api-walkthrough.md).

## <a name="export-options-for-metrics"></a>Параметры экспорта метрик
Можно перейти к колонке "Журналы диагностики" на вкладке "Мониторинг" и просмотреть параметры экспорта для метрик. Можно выбрать метрики (и журналы диагностики), которые будут направлены в хранилище BLOB-объектов, концентраторы событий или OMS Log Analytics для различных вариантов использования, упомянутых ранее в этой статье. 

 ![Параметры экспорта метрик в Azure Monitor](./media/monitoring-overview-metrics/MetricsOverview3.png)   

Это можно настроить с помощью шаблонов Resource Manager, [PowerShell](insights-powershell-samples.md), [интерфейса командной строки](insights-cli-samples.md) или [интерфейсов REST API](https://msdn.microsoft.com/library/dn931943.aspx). 

## <a name="take-action-on-metrics"></a>Выполнение действия на основе метрики
На основе данных метрики можно получать уведомления или выполнять автоматизированные действия. Для этого можно настроить правила генерации оповещений или параметры автомасштабирования.

### <a name="alert-rules"></a>Правила генерации оповещений
На основе метрик можно настроить правила генерации оповещений. Они могут проверять, превышает ли значение метрики заданное пороговое значение, и отправлять вам уведомление по электронной почте или вызывать webhook, который может быть использован для выполнения любого пользовательского сценария. Webhook может также использоваться для настройки интеграции с продуктами сторонних производителей.

 ![Метрики и правила генерации оповещений в Azure Monitor](./media/monitoring-overview-metrics/MetricsOverview4.png)

### <a name="autoscale"></a>Autoscale
Некоторые ресурсы Azure могут использовать несколько экземпляров, которые можно разворачивать и сворачивать, чтобы обрабатывать рабочие нагрузки. Автомасштабирование применяется к службам приложений (веб-приложениям), наборам масштабирования виртуальных машин (VMSS) и классическим облачным службам. Можно настроить правила автомасштабирования для разворачивания или сворачивания ресурсов в случае, когда значение определенной метрики, влияющей на рабочую нагрузку, выходит за заданное пороговое значение. Дополнительные сведения см. в статье [Обзор автомасштабирования в виртуальных машинах, облачных службах и веб-приложениях Microsoft Azure](monitoring-overview-autoscale.md).

 ![Метрики и автомасштабирование в Azure Monitor](./media/monitoring-overview-metrics/MetricsOverview5.png)

## <a name="supported-services-and-metrics"></a>Поддерживаемые службы и метрики
Azure Monitor является новой инфраструктурой метрик. Он обеспечивает поддержку следующих служб Azure на портале Azure и в новой версии API Azure Monitor:

- виртуальные машины (на основе Azure Resource Manager);
- наборы масштабирования виртуальных машин;
- Пакетная служба
- пространство имен концентратора событий; 
- пространство имен служебной шины (только в SKU "Премиум");
- SQL (версии 12);
- пул эластичных баз данных SQL;
- Веб-сайты
- фермы веб-серверов;
- Приложения логики
- Центры Интернета вещей;
- Кэш Redis
- сети: шлюзы приложений;
- Поиск

Подробный список поддерживаемых служб и их метрики можно просмотреть на странице [Метрики, поддерживаемые Azure Monitor](monitoring-supported-metrics.md). 


## <a name="next-steps"></a>Дальнейшие действия

Перейдите по ссылкам в этой статье. Кроме того, узнайте:  

- о [распространенных метриках для автомасштабирования](insights-autoscale-common-metrics.md)
- как [создавать правила генерации оповещений](insights-alerts-portal.md)







<!--HONumber=Oct16_HO2-->


