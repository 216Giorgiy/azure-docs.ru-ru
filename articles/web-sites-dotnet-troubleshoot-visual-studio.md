<properties 
	pageTitle="Устранение неполадок, связанных с веб-сайтами Azure, в Visual Studio" 
	description="Узнайте, как устранять неполадки в работе веб-сайта Azure с помощью удаленной отладки, трассировки и средств ведения журналов, которые встроены Visual Studio 2013." 
	services="web-sites" 
	documentationCenter=".net" 
	authors="tdykstra" 
	manager="wpickett" 
	editor=""/>

<tags 
	ms.service="web-sites" 
	ms.workload="web" 
	ms.tgt_pltfrm="na" 
	ms.devlang="dotnet" 
	ms.topic="article" 
	ms.date="11/13/2014" 
	ms.author="tdykstra"/>

# Устранение неполадок, связанных с веб-сайтами Azure, в Visual Studio

В этом учебнике показано, как использовать средства Visual Studio, которые позволяют отлаживать работу приложения во время его работы на веб-сайте Azure, выполняя это приложение удаленно в [режиме отладки](http://www.visualstudio.com/ru-ru/get-started/debug-your-app-vs.aspx) или путем просмотра журналов как самого приложения, так и веб-сервера.

Вы узнаете:

* Какие функции управления сайтом Azure доступны в среде Visual Studio.
* Как использовать удаленное представление Visual Studio для быстрого изменения удаленного веб-сайта.
* Как работать удаленно в среде отладки, если проект выполняется в Azure.
* Как создать журналы трассировки приложения и просматривать их непосредственно во время создания.
* Как просматривать журналы веб-сервера, включая подробные сообщения об ошибках и трассировку неудачно завершившихся запросов.
* Как отправлять диагностические журналы в учетную запись хранения Azure и просматривать их там.

При наличии Visual Studio Ultimate, для отладки также можно использовать [IntelliTrace](http://msdn.microsoft.com/library/vstudio/dd264915.aspx). Использование IntelliTrace не рассматривается в этом учебнике.

### Сегменты учебника

- [Необходимые условия](#prerequisites)
- [Конфигурация и управление веб-сайтом](#sitemanagement)
- [Доступ к файлам веб-сайта в обозревателе сервера](#remoteview)
- [Удаленная отладка](#remotedebug)
	- Удаленная отладка веб-сайтов
	- Удаленная отладка веб-заданий
	- Примечания о режиме удаленной отладки 
- [Обзор журналов диагностики](#logsoverview)
- [Создание и просмотр журналов трассировки приложения](#apptracelogs)
- [Просмотр журналов веб-сервера](#webserverlogs)
- [Просмотр подробных журналов сообщений об ошибках](#detailederrorlogs)
- [Загрузка журналов файловой системы](#downloadlogs)
- [Просмотр журналов хранилища](#storagelogs)
- [Просмотр журналов неудачно завершенных запросов](#failedrequestlogs)
- [Дальнейшие действия](#nextsteps)

<h2><a name="prerequisites"></a>Предварительные требования</h2>

Этот учебник работает со средой разработки, веб-проектом и веб-сайтом Azure, который вы настроили в учебнике [Начало работы с веб-сайтами Azure и ASP.NET][GetStarted]. Для разделов заданий WebJob вам понадобится приложение, созданное в учебнике [Приступаем к работе с пакетом SDK для Azure WebJobs][GetStartedWJ].

В этом учебнике приводятся примеры кода для веб-приложения C# MVC, однако в приложениях Visual Basic и веб-форм применяются те же процедуры устранения неполадок.

Для удаленной отладки требуется Visual Studio 2013 или Visual Studio 2012 с обновлением 4. Для использования функций удаленной отладки и **Обозревателя сервера** для веб-заданий требуется [Visual Studio 2013 обновление 4](http://go.microsoft.com/fwlink/?LinkID=510314) или более поздней версии. Другие функции, демонстрируемые в этом учебнике, также работают в Visual Studio 2013 Express для Web и Visual Studio 2012 Express для Web. 

Журналы потоковой передачи работают только для приложений, которые предназначены для .NET Framework 4 и выше.

<h2><a name="sitemanagement"></a>Конфигурация и управление веб-сайтом</h2>

Visual Studio предоставляет доступ к подмножеству функций управления сайтом и параметров конфигурации, доступных на портале управления. В этом разделе вы узнаете, какие функции доступны.

1. Если вы еще не выполнили вход в Azure в Visual Studio, нажмите кнопку **Подключиться к Azure** в **Обозревателе сервера**.

	Также вы можете установить сертификат управления, обеспечивающий доступ к вашей учетной записи. Сертификат управления предоставляет **Обозревателю сервера** доступ к дополнительным службам Azure (база данных SQL и мобильные службы). Чтобы установить сертификат, щелкните правой кнопкой мыши узел **Azure** в **обозревателе сервера** и выберите пункт **Управление подписками** в контекстном меню. В диалоговом окне **Управление подписками Azure** откройте вкладку **Сертификаты**, а затем щелкните **Импорт**. Следуя указаниям, загрузите и импортируйте файл подписки (также называемый *.publishsettings*) для вашей учетной записи Azure.

	> [AZURE.NOTE]
	> Если вы скачиваете файл подписки, сохраните его в папку, не входящую в структуру каталогов с исходными кодами (например, в папку "Загрузки"), а затем удалите его сразу после завершения импорта. Злоумышленник, получивший доступ к файлу подписки, сможет изменять, создавать и удалять ваши службы Azure.

	Дополнительные сведения о подключении к ресурсам Azure из Visual Studio см. в разделе [Управление учетными записями, подписками и административными ролями](http://go.microsoft.com/fwlink/?LinkId=324796#BKMK_AccountVCert).

2. В **Обозревателе сервера** разверните **Azure**, а затем разверните **Веб-сайты**.

3. Щелкните правой кнопкой мыши узел веб-сайта, созданный в разделе [Начало работы с Azure и ASP.NET][GetStarted], и щелкните **Параметры просмотра**.

	![View Settings in Server Explorer](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-viewsettings.png)

	Появится вкладка **Веб-сайт Azure**, где можно просмотреть задачи по управлению и конфигурации, доступные в Visual Studio.

	![Azure Website window](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-configtab.png)

	В этом учебнике используются раскрывающиеся списки ведения журналов и трассировки.	Для удаленной отладки вы будете использовать другой метод.
   
	Информацию о полях параметров приложения и строк подключения в этом окне см. в разделе [Веб-сайты Azure: как работают параметры приложения и строки подключения](http://blogs.msdn.com/b/windowsazure/archive/2013/07/17/windows-azure-web-sites-how-application-strings-and-connection-strings-work.aspx).

	Если вам необходимо выполнить задачу по управлению сайтом, которую невозможно выполнить в этом окне, можете щелкнуть пункт **Полные параметры веб-сайта**, чтобы открыть в окне браузера портал управления. Дополнительную информацию см. в разделе [Настройка веб-сайтов](/ru-ru/manage/services/web-sites/how-to-configure-websites/#howtochangeconfig).

<h2><a name="remoteview"></a>Доступ к файлам веб-сайта в обозревателе сервера</h2>

Как правило, при развертывании сайта флагу `customErrors` в файле Web.config присваивается значение `On` или `RemoteOnly`, из-за которого вы не видите сообщения о возникающих ошибках. В большинстве случаев при ошибке отображается страница следующего вида.

**Ошибка сервера в приложении "/":**

![Unhelpful error page](./media/web-sites-dotnet-troubleshoot-visual-studio/genericerror.png)

**Произошла ошибка:**

![Unhelpful error page](./media/web-sites-dotnet-troubleshoot-visual-studio/genericerror1.png)

**Не удается отобразить страницу веб-сайта**

![Unhelpful error page](./media/web-sites-dotnet-troubleshoot-visual-studio/genericerror2.png)

Подробное сообщение об ошибке, как правило, содержит полезную информацию для ее устранения. На предыдущих снимках экрана показано, как включить эту функцию. Для этого необходимо внести изменения в развернутый файл Web.config. Вы можете изменить файл *Web.config* в проекте и повторно развернуть проект, либо создать [преобразование Web.config](http://www.asp.net/mvc/tutorials/deployment/visual-studio-web-deployment/web-config-transformations) и развернуть отладочную сборку. Однако вы можете значительно упростить этот процесс с помощью **обозревателя решения**, напрямую просматривая и редактируя файлы на удаленном сайте с использованием функции *remote view*.

1. В **Обозревателе сервера**, разверните узел **Azure**, затем узел **Веб-сайты** и узел для веб-сайта, на который вы выполняете развертывание.

	Откроются узлы, обеспечивающие доступ к файлам содержимого и журналов веб-сайта.

	![File and log files](./media/web-sites-dotnet-troubleshoot-visual-studio/fileandlogfiles.png)

2. Разверните узел **Файлы** и дважды щелкните файл  *Web.config*.

	![Open Web.config](./media/web-sites-dotnet-troubleshoot-visual-studio/webconfig.png)

	В Visual Studio откроется файл Web.config удаленного сайта, а в строке заголовка к его имени будет добавлен суффикс [Удаленный].

3. Добавьте следующую строку в элемент  `system.web`:

	`<customErrors mode="off"></customErrors>`

	![Edit Web.config](./media/web-sites-dotnet-troubleshoot-visual-studio/webconfigedit.png)

4. Обновите окно браузера, в котором отображается неинформативное сообщение. Вы увидите подробную информацию об ошибке, как в следующем примере:

	![Detailed error messaeg](./media/web-sites-dotnet-troubleshoot-visual-studio/detailederror.png)

	Для создания отображаемой ошибки в файл *Views\Home\Index.cshtml* была добавлена показанная красным строка.

Изменение файла Web.config является одним из нескольких способов упростить устранение неполадок путем считывания и редактирования файлов на вашем веб-сайте Azure.

<h2><a name="remotedebug"></a>Удаленная отладка</h2>

Если в подробном сообщении об ошибке содержится недостаточно сведений и вы не можете воспроизвести ошибку в локальной системе, попробуйте выполнить отладку в удаленном режиме. В этом режиме вы можете задавать точки останова, обращаться к памяти напрямую, осуществлять пошаговое выполнение кода и даже изменять путь кода. 

Удаленная отладка не поддерживается в выпусках Visual Studio Express.

### Удаленная отладка веб-сайтов

В этом разделе демонстрируется удаленная отладка с использованием проекта, созданного в разделе [Приступая к работе с Azure и ASP.NET][GetStarted].

1. Откройте веб-проект, созданный в разделе [Приступая к работе с Azure и ASP.NET][GetStarted].

1. Открыть *Controllers\HomeController.cs*.

2. Удалите метод  `About()` и вставьте вместо него следующий код.

        public ActionResult About()
        {
            string currentTime = DateTime.Now.ToLongTimeString();
            ViewBag.Message = "The current time is " + currentTime;
            return View();
        }

2. [Задайте точку останова](http://www.visualstudio.com/ru-ru/get-started/debug-your-app-vs.aspx) в строке `ViewBag.Message`.

1. В **обозревателе решений** щелкните правой кнопкой мыши проект и выберите **Опубликовать**.

2. В раскрывающемся списке **Профиль** выберите тот же профиль, который вы использовали в разделе [Начало работы с Azure и ASP.NET][GetStarted].

3. Щелкните вкладку **Параметры** и измените значение **Конфигурация** на **Отладка**, затем щелкните пункт **Опубликовать**.

	![Publish in debug mode](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-publishdebug.png)

4. После завершения развертывания и открытия URL-адреса вашего сайта Azure закройте браузер.

5. Для Visual Studio 2013: В **Обозревателе сервера** разверните пункт **Azure**, разверните **Веб-сайты**, щелкните правой кнопкой мыши веб-сайт и выберите пункт **Подключить отладчик**. 

	![Attach debugger](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-attachdebugger.png)

	В браузере автоматически откроется ваша главная страница, размещенная в Azure. Возможно, придется подождать около 20 секунд, пока Azure настраивает сервер для отладки. Эта задержка возникает только при первом выполнении в режиме отладки на веб-сайте. При последующих отладках в течение 48 часов задержки не будет.

6. Для Visual Studio 2012 с обновлением 4:<a id="vs2012"></a>

	* На портале управления Azure перейдите на вкладку **Настройки** для вашего веб-сайта, затем прокрутите вниз до раздела **Диагностика сайта**.

	* Установите для параметра **Удаленная отладка** значение **Включено**, а для параметра **Удаленная отладка: версия Visual Studio** - значение **2012**.

	![Set remote debugging in management portal](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-debuginportal.png)
   
	* В меню Visual Studio **Отладка** щелкните пункт **Присоединение к процессу**.

	* В поле **Квалификатор** введите URL-адрес для вашего веб-сайта без префикса `http://`. 

	* Выберите пункт **Отображать процессы всех пользователей**.

	* Когда появится запрос на ввод учетных данных, введите имя и пароль пользователя, который имеет разрешения на публикацию веб-сайта. Чтобы получить эти учетные данные, перейдите на вкладку "Панель мониторинга" для вашего веб-сайта на портале управления и щелкните пункт **Загрузить профиль публикации**. Откройте файл в текстовом редакторе; имя и пароль пользователя будут располагаться после первого вхождения соответственно **userName=** и **userPWD=**. 

	* Когда процессы отобразятся в таблице **Доступные процессы**, выберите **w3wp.exe** и щелкните **Присоединить**.

	* Откройте URL-адрес своего сайта в браузере.

	Возможно, придется подождать около 20 секунд, пока Azure настраивает сервер для отладки. Эта задержка возникает только при первом выполнении в режиме отладки на веб-сайте. При последующих отладках в течение 48 часов задержки не будет.

6. Выберите пункт **О программе** в меню.

	Visual Studio прерывается в точке останова, при этом код выполняется в Azure, а не на локальном компьютере.

7. Наведите указатель мыши на переменную `currentTime`, чтобы просмотреть значение времени.

	![View variable in debug mode running in Azure](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-debugviewinwa.png)

	Время, которое отображается здесь, является временем сервера Azure, который может находиться в другом часовом поясе, отличном от часового пояса локального компьютера.

8. Введите новое значение переменной  `currentTime`, например "Теперь выполняется в Azure".

5. Нажмите клавишу F5, чтобы продолжить работу.

	На странице "О программе" в Azure отображается новое значение, введенное в переменной currentTime.

	![About page with new value](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-debugchangeinwa.png)

### <a name="remotedebugwj"></a> Удаленная отладка заданий WebJob

В этом разделе демонстрируется удаленная отладка с использованием проекта и веб-сайта, созданного в разделе [Начало работы с пакетом SDK для заданий Azure WebJob](../websites-dotnet-webjobs-sdk). Функции, приведенные в этом разделе, доступны только в Visual Studio 2013 с обновлением 4.

1. Откройте веб-проект, созданный в разделе [Приступая к работе с пакетом SDK для Azure WebJobs][GetStartedWJ].

1. Откройте проект ContosoAdsWebJob и файл *Functions.cs*.

2. [Установите точку останова](http://www.visualstudio.com/ru-ru/get-started/debug-your-app-vs.aspx) в первом операторе метода `GnerateThumbnail`.

	![Set breakpoint](./media/web-sites-dotnet-troubleshoot-visual-studio/wjbreakpoint.png)

1. В **Обозревателе решений** щелкните правой кнопкой мыши веб-проект (не проект веб-задания) и выберите пункт **Опубликовать**.

2. В раскрывающемся списке **Профиль** выберите тот же профиль, который вы использовали в разделе [Начало работы с пакетом SDK для заданий Azure WebJob](../websites-dotnet-webjobs-sdk).

3. Щелкните вкладку **Параметры** и измените значение **Конфигурация** на **Отладка**, затем щелкните пункт **Опубликовать**.

	Visual Studio развертывает веб-проекты и проекты веб-заданий и открывает в браузере URL-адрес Azure вашего веб-сайте.

5. В **Обозревателе сервера** разверните **Azure** > **Веб-сайты** > ваш веб-сайт > **Веб-задания** > **Непрерывные** и щелкните правой кнопкой мыши **ContosoAdsWebJob**.

7. Щелкните **Присоединить отладчик**. 

	![Attach debugger](./media/web-sites-dotnet-troubleshoot-visual-studio/wjattach.png)

	В браузере автоматически откроется ваша главная страница, размещенная в Azure. Возможно, придется подождать около 20 секунд, пока Azure настраивает сервер для отладки. Эта задержка возникает только при первом выполнении в режиме отладки на веб-сайте. В следующий раз, когда вы присоедините отладчик, задержки не будет, если режим отладки запускался на протяжении последних 48 часов.

6. В веб-браузере на главной странице Contoso Ads создайте новое объявление. 

	Создание рекламы приводит к созданию сообщения очереди, которое забирается и обрабатывается веб-заданиями. Когда пакет SDK веб-заданий вызывает функцию для обработки сообщения очереди, выполнение кода прерывается в точке останова.

7. Когда отладчик останавливается в точке останова, вы можете проверить и изменить значения переменных, пока программа выполняется в облаке. На следующем рисунке отладчик показывает содержимое объекта blobInfo, который был передан в метод GenerateThumbnail.

	![blobInfo object in debugger](./media/web-sites-dotnet-troubleshoot-visual-studio/blobinfo.png)
 
5. Нажмите клавишу F5, чтобы продолжить работу.

	Метод GenerateThumbnail завершается создание эскиза.

6. Обновите страницу Index в браузере, и вы увидите эскиз.

6. В Visual Studio нажмите клавиши SHIFT+F5, чтобы остановить отладку.

7. В **Обозревателе сервера**, щелкните правой кнопкой мыши узел ContosoAdsWebJob и щелкните **Просмотр панели мониторинга**.

8. Выполните вход с использованием ваших учетных данных Azure и щелкните имя веб-задания, чтобы перейти к странице вашего веб-задания. 

	![Click ContosoAdsWebJob](./media/web-sites-dotnet-troubleshoot-visual-studio/clickcaw.png)

	Панель мониторинга показывает, что функция GenerateThumbnail была выполнена недавно.

	(В следующий раз при нажатии кнопки **Просмотр панели мониторинга** вам не нужно выполнять вход, и браузер переходит непосредственно на страницу вашего веб-задания.)

9. Щелкните имя функции, чтобы просмотреть подробные сведения о ее выполнении.

	![Function details](./media/web-sites-dotnet-troubleshoot-visual-studio/funcdetails.png)

Если функция [записала журналы](../websites-dotnet-webjobs-sdk-storage-queues-how-to/#logs), для их просмотра щелкните пункт**ToggleOutput**.

### Примечания о режиме удаленной отладки

* В рабочей среде выполнение в режиме отладки не рекомендуется. Если ваш производственный сайт не масштабирован до нескольких экземпляров сервера, отладка не позволит веб-серверу отвечать на другие запросы. Если имеется несколько экземпляров веб-сервера, при присоединении отладчика будет использован случайно выбранный экземпляр и не будет никакой возможности убедиться в том, что запросы браузера передаются именно на этот экземпляр. Кроме того, как правило, отладочная сборка не развертывается в производственной среде, а оптимизации компилятора для разворачиваемых сборок делают невозможным построковое отображение действий в исходном коде. Для устранения неполадок в рабочей среде лучше всего использовать журналы веб-сервера и трассировки приложения.

* Во время удаленной отладки избегайте длинных остановок на точках останова. Azure обрабатывает процесс, остановленный дольше, чем на несколько минут, как процесс, не отвечающий на запросы, и закрывает его.

* Во время отладки сервер отправляет данные в среду Visual Studio, что может повлиять на расходы, связанные с пропускной способностью. Информацию о тарифах на пропускную способность см. в разделе [Цены Azure](/ru-ru/pricing/calculator/).

* Убедитесь, что атрибут `debug` элемента `compilation` в файле *Web.config* имеет значение true. По умолчанию при публикации отладочной конфигурации сборки для него задано значение true.

        <system.web>
          <compilation debug="true" targetFramework="4.5" />
          <httpRuntime targetFramework="4.5" />
        </system.web>

* Если вы обнаружите, что отладчик не выполняет пошаговое прохождение кода, который требуется отладить, может потребоваться изменить параметр "Только мой код".  Дополнительные сведения см. в разделе [Ограничение выполнения шагов только моим кодом](http://msdn.microsoft.com/ru-ru/library/vstudio/y740d9d3.aspx#BKMK_Restrict_stepping_to_Just_My_Code).

* При активации функции удаленной отладки на сервере запускается таймер, который автоматически отключает эту функцию по истечении 48 часов в целях повышения безопасности и производительности. Вы можете в любое время снова активировать эту функцию. Если вы не ведете отладку, эту функцию рекомендуется оставить отключенной.

* Вы можете вручную присоединить отладчик к любому процессу, а не только к процессу веб-сайта (w3wp.exe). Дополнительные сведения о том, как использовать режим отладки в Visual Studio, см. в разделе [Отладка в Visual Studio](http://msdn.microsoft.com/ru-ru/library/vstudio/sc65sadd.aspx).

<h2><a name="logsoverview"></a>Обзор журналов диагностики</h2>

Приложения ASP.NET, которое работает на веб-сайте Azure, может создавать следующие виды журналов:

* **Журналы трассировки приложения**<br/>
  Приложение создает эти журналы, вызывая методы класса [System.Diagnostics.Trace](http://msdn.microsoft.com/ru-ru/library/system.diagnostics.trace.aspx).
* **Журналы веб-сервера**<br/>
  Веб-сервер создает запись журнала для каждого HTTP-запроса, адресованного сайту.
* **Подробные журналы сообщений об ошибках**<br/>
  Веб-сервер создает страницу HTML с некоторыми дополнительными сведениями об ошибочных HTTP-запросах (те запросы, которые приводят к появлению кода состояния 400 и выше). 
* **Журналы трассировки неудачно завершенных запросов**<br/>
  Веб-сервер создает XML-файл с подробными сведениями трассировки ошибочных HTTP-запросов. Веб-сервер также предоставляет XSL-файл для форматирования XML-кода в браузере.
  
Ведение журнала влияет на производительность веб-сайта, поэтому Azure предоставляет возможность при необходимости включить или отключить каждый тип журнала. Для журналов приложений можно указать, что следует писать только журналы с уровнем серьезности выше заданного. При создании нового веб-сайта все ведение журналов по умолчанию отключено.

Журналы записываются в файлы, содержащиеся в папке *LogFiles* файловой системы вашего веб-сайта, и они доступны через FTP. Журналы приложений и журналы веб-сервера также могут записываться в учетную запись хранения Azure. В учетной записи хранения можно держать больший объем журналов, чем в файловой системе. При использовании файловой системы на журналы отводится 100 мегабайтов. Журналы файловой системы хранятся в течение короткого срока. При достижении установленного ограничения Azure удаляет старые файлы журналов, чтобы освободить место под новые.  

<h2><a name="apptracelogs"></a>Создание и просмотр журналов трассировки приложения</h2>

В этом разделе предстоит выполнить следующие задачи:

* Добавьте оператор трассировки в веб-проект, созданный в разделе [Начало работы с веб-сайтами Azure и ASP.NET][GetStarted].
* Просмотр журналов при локальном выполнении проекта.
* Просмотр журналов, создаваемых во время работы приложения в Azure. 

Информацию о создании журналов приложения в заданиях WebJob см. в разделе [Использование пакета SDK для заданий WebJob для работы с хранилищем очередей Azure - запись журналов](../websites-dotnet-webjobs-sdk-storage-queues-how-to/#logs). следующие указания для просмотра журналов и управления их хранением в Azure также применимы к журналам приложения, созданным заданиями WebJob. 

### Добавление инструкций трассировки в приложение

1. Откройте *Controllers\HomeController.cs* и замените содержимое файла на следующий код, чтобы добавить операторы `Trace` и `using` для `System.Diagnostics`:

		using System;
		using System.Collections.Generic;
		using System.Configuration;
		using System.Diagnostics;
		using System.Linq;
		using System.Web;
		using System.Web.Configuration;
		using System.Web.Mvc;
		namespace MyExample.Controllers
		{
		    public class HomeController : Controller
		    {
		        public ActionResult Index()
		        {
		            Trace.WriteLine("Entering Index method");
		            ViewBag.Message = "Modify this template to jump-start your ASP.NET MVC application.";
		            Trace.TraceInformation("Displaying the Index page at " + DateTime.Now.ToLongTimeString());
		            Trace.WriteLine("Leaving Index method");
		            return View();
		        }
		
		        public ActionResult About()
		        {
		            Trace.WriteLine("Entering About method");
		            ViewBag.Message = "Your app description page.";
		            Trace.TraceWarning("Transient error on the About page at " + DateTime.Now.ToShortTimeString());
		            Trace.WriteLine("Leaving About method");
		            return View();
		        }
		
		        public ActionResult Contact()
		        {
		            Trace.WriteLine("Entering Contact method");
		            ViewBag.Message = "Your contact page.";
		            Trace.TraceError("Fatal error on the Contact page at " + DateTime.Now.ToLongTimeString());
		            Trace.WriteLine("Leaving Contact method");
		            return View();
		        }
		    }
		}
		
				
### Просмотр результатов трассировки локально

3. Нажмите F5, чтобы выполнить приложение в режиме отладки.

	Прослушиватель трассировки по умолчанию записывает весь вывод трассировки в окно **Вывод** вместе со всем остальным выводом отладки. На следующем рисунке показан вывод операторов трассировки, добавленных в метод  `Index`.

	![Tracing in Debug window](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-debugtracing.png)

	Ниже показано, как просмотреть выходные данные трассировки на веб-странице без компиляции в режиме отладки.

2. Откройте файл Web.config приложения (находится в папке проекта) и добавьте элемент `<system.diagnostics>` в конец файла непосредственно перед закрывающим элементом `</configuration>`:

  		<system.diagnostics>
		    <trace>
		      <listeners>
		        <add name="WebPageTraceListener"
                    type="System.Web.WebPageTraceListener, 
                    System.Web, 
                    Version=4.0.0.0, 
                    Culture=neutral,
                    PublicKeyToken=b03f5f7f11d50a3a" />
		      </listeners>
		    </trace>
		  </system.diagnostics>

	 `WebPageTraceListener`позволяет просматривать результаты трассировки, открыв `/trace.axd`.

3. Добавьте <a href="http://msdn.microsoft.com/ru-ru/library/vstudio/6915t83k(v=vs.100).aspx">элемент трассировки</a> под строкой <system.web> в файле Web.config, например следующим образом.

		<trace enabled="true" writeToDiagnosticsTrace="true" mostRecent="true" pageOutput="false" />

3. Для запуска приложения нажмите сочетание клавиш CTRL+F5.

4. В адресной строке окна браузера добавьте *trace.axd* к URL-адресу и нажмите клавишу ВВОД (URL-адрес должен быть аналогичен http://localhost:53370/trace.axd).

5. На странице **Трассировка приложения** щелкните **Просмотр сведений** в первой строке (не в строке BrowserLink).

	![trace.axd](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-traceaxd1.png)

	Откроется страница **Сведения о запросе**, где в разделе **Сведения о трассировке** отображаются выходные данные операторов трассировки, добавленных в метод `Index`.

	![trace.axd](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-traceaxd2.png)

	По умолчанию `trace.axd` доступен только локально. Если он должен быть доступен также на удаленном сайте, можно добавить в элемент `trace` файла *Web.config* строку "localOnly="false"", как показано в следующем примере:

		<trace enabled="true" writeToDiagnosticsTrace="true" localOnly="false" mostRecent="true" pageOutput="false" />

	Однако включение `trace.axd` на рабочем сайте обычно не рекомендуется по соображениям безопасности, и в следующих разделах будет приведен более простой способ чтения журналов трассировки веб-сайта Azure.

### Просмотр результатов трассировки в Azure

1. В **Обозревателе решений** щелкните правой кнопкой веб-проект и выберите пункт **Опубликовать**.

2. В диалоговом окне **Публикации веб-сайта** щелкните **Опубликовать**.

	После того как Visual Studio опубликует обновление, главная страница открывается в окне браузера (если не снят флажок **URL-адрес назначения** на вкладке **Подключение**).

3. В **Обозревателе сервера** щелкните правой кнопкой мыши веб-сайт и выберите **Просмотр журналов потоковой передачи**. 

	![View Streaming Logs in context menu](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-viewlogsmenu.png)

	В окне **Вывод** показано, что вы подключены к службе потоковой передачи журналов; каждую минуту, когда отсутствует журнал для отображения, появляется строка уведомления.

	![View Streaming Logs in context menu](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-nologsyet.png)

4. В окне браузера с открытой главной страницей щелкните пункт **Contact**.

	Через несколько секунд в окне **Вывод** появятся результаты трассировки уровня ошибки, добавленные в метод `Contact`.

	![Error trace in Output window](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-errortrace.png)

	Visual Studio отображает только трассировки уровня ошибок, так как это настройка выставляется по умолчанию при включении службы мониторинга журналов. При создании нового веб-сайта Azure ведение всех журналов по умолчанию отключено, что вы видели ранее при открытии страницы параметров сайта.

	![Application Logging off](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-apploggingoff.png)


	Однако при выборе **Просмотра журналов потоковой передачи** Visual Studio автоматически изменяет значение параметра **Ведение журнала приложения (файловая система)** на **Ошибка**, что означает представление только журналов уровня ошибок. Чтобы просмотреть все журналы трассировки, следует изменить значение этого параметра на **Подробно**. Если выбран уровень серьезности меньше уровня ошибок, начинают предоставляться и все журналы с более высокими уровнями серьезности. Поэтому при выборе подробного уровня вы также сможете просматривать журналы информационных сообщений, предупреждений и ошибок.  

4. В **Обозревателе сервера** щелкните правой кнопкой мыши веб-сайт, затем щелкните **Просмотреть параметры**, как и раньше.

5. Измените значение параметра **Ведение журнала приложения (файловая система)** на **Подробно**, затем нажмите кнопку **Сохранить**.
 
	![Setting trace level to Verbose](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-applogverbose.png)

6. В окне браузера, в котором теперь отображается страница **Связь**, нажмите кнопку **Главная**, затем **О программе** и щелкните **Контакт**.

	Через несколько секунд в окне **Вывод** появятся все результаты трассировки.

	![Verbose trace output](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-verbosetraces.png)

	В этом разделе вы включили и отключили ведение журналов с помощью параметров веб-сайта Azure. Можно также включить и отключить прослушиватели трассировки, изменив содержимое файла Web.config. Однако изменение файла Web.config приводит к перезапуску домена приложения, тогда как включение ведения журналов через веб-сайт не приводит к аналогичным результатам. Если воспроизведение проблемы занимает много времени или проблема возникает только периодически, перезапуск домена приложения может устранить неполадку, так что вам придется ждать следующего ее возникновения. Включение диагностики в Azure не приводит к подобным результатам, поэтому сбор сведений об ошибках можно начать незамедлительно.

### Функции окна вывода

На вкладке **Журналы Azure** окна **Вывод** содержатся несколько кнопок и текстовое поле.

![Logs tab buttons](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-icons.png)

Служат для выполнения следующих функций:

* Очистка окна **Вывод**.
* Включение или отключение переноса слов.
* Запуск или остановка журналов мониторинга.
* Определение журналов мониторинга.
* Скачивание журналов.
* Фильтрация журналов на основе регулярного выражения или строки поиска.
* Закрытие окна **Вывод**.

Если ввести строку поиска или регулярное выражение, Visual Studio фильтрует сведения в журналах на стороне клиента. Это означает, что можно ввести критерии после отображения журналов в окне  **Вывод**, а также изменить критерии фильтрации без необходимости повторного создания журналов.

<h2><a name="webserverlogs"></a>Просмотр журналов веб-сервера</h2>

Журналы веб-сервера регистрируют все действия по протоколу HTTP на сайте. Чтобы увидеть их в окне **Вывод**, следует включить их на сайте и оповестить Visual Studio о необходимости их мониторинга. 

1. На вкладке **Конфигурация веб-сайта Azure**, открытой в окне **Обозреватель сервера**, измените значение параметра "Ведение журналов веб-сервера" на **Включено** и щелкните пункт **Сохранить**.

	![Enable web server logging](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-webserverloggingon.png)

2. В окне **Вывод** нажмите кнопку **Укажите, какие журналы Azure отслеживать**.
	
	![Specify which Azure logs to monitor](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-specifylogs.png)

3. В диалоговом окне **Параметры ведения журналов Azure** выберите **Журналы веб-сервера**, а затем нажмите кнопку **ОК**.

	![Monitor web server logs](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-monitorwslogson.png)

4. В окне браузера, в котором отображается веб-сайт, щелкните **Главная**, затем **О программе** и, наконец, **Связь**.

	Как правило, первыми отображаются журналы приложений, за которыми следуют журналы веб-сервера. Подождите некоторое время, чтобы дождаться отображения журналов. 

	![Web server logs in Output window](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-wslogs.png)


По умолчанию при первом включении журналов веб-сервера с помощью Visual Studio Azure записывает журналы в файловой системе. В качестве альтернативы можно использовать портал управления для указания, что журналы веб-сервера должны записываться в контейнер blob, содержащийся в учетной записи хранения. Дополнительную информацию см. в разделе **Диагностика сайта** статьи [Настройка веб-сайтов](/ru-ru/manage/services/web-sites/how-to-configure-websites/#howtochangeconfig). 

Если включить ведение журналов веб-сервера для учетной записи хранения Azure с помощью портала управления, а затем отключить ведение журналов в Visual Studio, то при повторном включении ведения журналов в Visual Studio восстанавливаются параметры учетной записи хранения. 

<h2><a name="detailederrorlogs"></a>Просмотр подробных журналов сообщений об ошибках</h2>

Подробные журналы сообщений об ошибках представляют некоторые дополнительные сведения о HTTP-запросах, которые завершаются с кодом ошибки (400 или выше). Чтобы увидеть их в окне **Вывод**, следует включить их на сайте и оповестить Visual Studio о необходимости их мониторинга.

1. На вкладке **Конфигурации веб-сайта Azure**, открытой в окне **Обозреватель сервера**, измените значение параметра **Подробные сообщения об ошибках** на **Включено**, затем щелкните **Сохранить**.

	![Enable detailed error messages](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-detailedlogson.png)

2. В окне **Вывод** нажмите кнопку **Укажите, какие журналы Azure отслеживать**.

3. В диалоговом окне **Параметры ведения журналов Azure** выберите **Все журналы** и нажмите кнопку **ОК**.

	![Monitor all logs](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-monitorall.png)

4. В адресной строке окна браузера добавьте дополнительный символ в URL-адрес, чтобы вызвать ошибку 404 (например,  `http://localhost:53370/Home/Contactx`), и нажмите клавишу ВВОД.

	После нескольких секунд в окне Visual Studio **Вывод** появится подробный журнал ошибок.

	![Detailed error log in Output window](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-detailederrorlog.png)

	Щелкните ссылку, удерживая нажатой клавишу CTRL, чтобы просмотреть форматированные выходные данные журнала в браузере:

	![Detailed error log in browser window](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-detailederrorloginbrowser.png)

<h2><a name="downloadlogs"></a>Закачка журналов файловой системы</h2>

Все журналы, которые можно отслеживать в окне **Вывод**, также можно скачать в виде *ZIP*-файла. 

1. В окне **Вывод** щелкните пункт **Загрузить журналы потоковой передачи**.

	![Logs tab buttons](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-downloadicon.png)

	В проводнике открывается папка *Downloads* с выбранным скачанным файлом.

	![Downloaded file](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-downloadedfile.png)

2. Извлеките содержимое *ZIP*-файла. Вы увидите структуру папки, аналогичную следующей:

	![Downloaded file](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-logfilefolders.png)

	* Журналы трассировки приложения содержатся в TXT-файлах в папке *LogFiles\Application*.
	* Журналы веб-сервера содержатся в LOG-файлах в папке *LogFiles\http\RawLogs*. Можно использовать средство, аналогичное [Log Parser](http://www.microsoft.com/ru-ru/download/details.aspx?displaylang=en&id=24659) для просмотра и обработки этих файлов.
	* Подробные журналы сообщений об ошибках содержатся в *HTML*-файлах в папке *LogFiles\DetailedErrors*.

	(Папка *deployments* предназначена для файлов, созданных при публикации системы управления версиями; она никак не связана с публикациями Visual Studio. Папка *Git* предназначена для трассировок, относящихся к публикациям системы управления версиями и службы потоковой передачи файлов журналов.)  

<h2><a name="storagelogs"></a>Просмотр журналов хранилища</h2>

Журналы трассировки приложения также могут быть переданы в учетную запись хранения Azure, после чего их можно просмотреть в Visual Studio. Для этого необходимо создать учетную запись хранения, включить журналы службы хранилища на портале управления и просмотреть их на вкладке  **Журналы** окна **Веб-сайты Azure**.

Журналы можно отправить в любое из трех мест назначения:

* Файловая система.
* Таблицы учетной записи хранения.
* Большие двоичные объекты учетной записи хранения.

Для каждого места назначения вы можете задать отдельный уровень серьезности. 

Таблицы удобны для просмотра данных журналов в Интернете и поддерживают потоковую передачу. Это позволяет запрашивать новые журналы из таблиц по мере их создания. Используя BLOB-объекты, вы можете загрузить журналы в файл для последующего анализа в средстве HDInsight, которое поддерживает такой формат данных. Дополнительную информацию см. в разделе **Hadoop и MapReduce** статьи [Варианты хранения данных (создание реальных облачных приложений в Azure)](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/data-storage-options).

На данный момент вы настроили подробное ведение журналов файловой системы. Далее вы настроите журналы информационного уровня, которые будут передаваться в таблицы учетной записи хранения. Информационный уровень означает, что все журналы, созданные вызовом методов `Trace.TraceInformation`, `Trace.TraceWarning` и  `Trace.TraceError`, будут отображаться, однако не будут отображаться журналы, созданные при вызове `Trace.WriteLine`.

Учетные записи хранения, в отличие от файловой системы, обеспечивают длительное хранение больших объемов данных журналов. Еще одним преимуществом отправки журналов трассировки приложений в систему хранения является получение некоторых дополнительных сведений вместе с каждым журналом, которые недоступны при использовании журналов из файловой системы.

5. Щелкните правой кнопкой мыши на **Хранилище** в узле Azure и выберите пункт **Создать учетную запись хранения**.

![Create Storage Account](./media/web-sites-dotnet-troubleshoot-visual-studio/createstor.png)

3. В диалоговом окне **Создание учетной записи хранения** введите имя учетной записи хранения. 

	Имя должно быть уникальным (не допускается существование учетных записей хранения Azure с одинаковыми именами). Если введенное имя уже используется, вы получите возможность изменить его.

	URL-адрес для доступа к вашей учетной записи хранения будет следующим: *{name}*.core.windows.net. 

5. Выберите в раскрывающемся списке **Регион или территориальная группа** ближайший к вам регион.

	Этот параметр указывает, в каком центре обработки данных Azure будет размещаться учетная запись хранения. При работе с учебником это не окажет существенного влияния, но для рабочего сайта веб-сервер и учетная запись хранения должны находиться в одном регионе, чтобы минимизировать задержку и стоимость исходящих данных. Веб-сайт (который будет создан позже) должен находиться как можно ближе к браузерам, получившим доступ к сайту, чтобы максимально уменьшить задержку.

6. В раскрывающемся списке **Репликация** установите значение **Локально избыточное**. 

	При включении георепликации для учетной записи хранения хранящиеся данные реплицируются в дополнительный центр обработки данных для обеспечения возможности отработки отказа в это расположение в случае крупной аварии в основном расположении. Георепликация может потребовать дополнительных затрат. Для учетных записей тестирования и разработки оплачивать георепликацию обычно не требуется. Дополнительные сведения см. в разделе [Создание, управление или удаление учетной записи хранения](../storage-create-storage-account/#replication-options).

5. Щелкните **Создать**. 

	![New storage account](./media/web-sites-dotnet-troubleshoot-visual-studio/newstorage.png)	

1. В окне Visual Studio **Веб-сайт Azure** перейдите на вкладку **Журналы**, а затем щелкните **Настроить ведение журналов на портале управления**.

	![Configure logging](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-configlogging.png)

	Это приведет к открытию вкладки **Настройки** на портале управления вашим веб-сайтом. Другим способом открытия этой вкладки является переход на вкладку **Веб-сайты** с последующим щелчком вкладки **Настройки**.

2. На вкладке портале управления **Настройки**, прокрутите вниз до раздела диагностики приложения и задайте для параметра **Ведение журнала приложения (табличное хранилище)** значение **Включено**.

3. Измените значение параметра **Уровень ведения журнала** на **Сведения**.

4. Щелкните **Управление табличным хранилищем**.

	![Click Manage TableStorage](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-stgsettingsmgmtportal.png)

	В поле **Управление табличным хранилищем для диагностики приложений** можно выбрать учетную запись хранения, если у вас их несколько. Вы можете как создать новую, так и использовать существующую таблицу.

	![Manage table storage](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-choosestorageacct.png)

6. В поле **Управление табличным хранилищем для диагностики приложений** щелкните флажок, чтобы закрыть окно.

6. На вкладке **Настройки** портала управления щелкните **Сохранить**.

7. В окне браузера, в котором отображается веб-сайт приложения, щелкните **Главная**, затем **О программе** и, наконец, **Связь**.

	Ведение журнала сведений, полученных при просмотре веб-страниц, будут записаны в учетную запись хранения.

8. На вкладке **Журналы** окна **Веб-сайт Azure** в Visual Studio щелкните пункт **Обновить** в разделе **Сводка по диагностике**.

	![Click Refresh](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-refreshstorage.png)

	В разделе **Сводка по диагностике** по умолчанию отображаются журналы за последние 15 минут. Можно изменить период для просмотра дополнительных журналов. 

	(При появлении ошибки "Таблица не найдена" убедитесь, что вы перешли к страницам, которые выполняют трассировку, после включения параметра **Ведение журналов приложения (хранилище)** и нажатия кнопки **Сохранить**.)

	![Storage logs](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-storagelogs.png)

	Обратите внимание, что в этом представлении отображаются **ИД процесса** и **ИД потока** для каждого журнала, что отсутствует в журналах файловой системы. Дополнительные поля можно увидеть, напрямую просмотрев таблицу хранилища Azure.

8. Щелкните **Просмотреть все журналы приложений**

	Таблица журнала трассировки отображается в средстве просмотра таблицы хранилища Azure.
   
	(Если возникает ошибка "последовательность не содержит элементов", откройте **Обозреватель сервера**, разверните узел для вашей учетной записи хранения в разделе **Azure**, а затем щелкните правой кнопкой мыши пункт **Таблицы** и нажмите кнопку **Обновить**.)

	![Таблица трассировки в обозревателе сервера](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-tracetableinse.png)

	![Storage logs in table view](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-tracelogtableview.png)

	Это представление показывает дополнительные поля, которые не отображаются в других представлениях. Это представление также позволяет фильтровать журналы, используя для создания запроса специальный пользовательский интерфейс построителя запросов. Дополнительную информацию см. в разделе "Работа с ресурсами таблиц - фильтрация сущностей" учебника [Обзор ресурсов хранения и управление ими в обозревателе серверов](http://msdn.microsoft.com/ru-ru/library/windowsazure/ff683677.aspx).

7. Чтобы просмотреть подробные сведения по отдельной строке, дважды щелкните одну из строк.

	![Trace table in Server Explorer](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-tracetablerow.png)

<h2><a name="failedrequestlogs"></a>Просмотр журналов трассировки неудачно завершенных запросов</h2>

Журналы трассировки неудачно завершенных запросов полезны при просмотре подробных сведений по обработке IIS HTTP-запроса в таких сценариях, как перезапись URL-адреса, или при возникновении проблем, связанных с проблемами проверки подлинности. 

Веб-сайты Azure используют те же функциональные возможности трассировки неудачно завершенных запросов, которые доступны в IIS, начиная с версии 7.0. Однако у вас нет доступа к параметрам IIS, которые определяют, какие ошибки будут регистрироваться. При включении трассировки неудачно завершенных запросов захватываются все ошибки. 

Можно включить трассировку неудачно завершенных запросов с помощью Visual Studio, однако эту трассировку невозможно просмотреть в Visual Studio. Эти журналы представляют собой XML-файлы. Служба потоковой передачи журналов только отслеживает файлы, которые могут быть прочтены в режиме обычного текста: это  Файлы с расширением *TXT*, *HTML* и *LOG*.

Журналы трассировки неудачно завершенных запросов можно просматривать напрямую в браузере через FTP или локально после загрузки их на локальный компьютер с помощью средства для работы с FTP. В этом разделе они будут просматриваться непосредственно в браузере.

1. На вкладке **Конфигурация** окна **Веб-сайт Azure**, которое было открыто из окна **Обозреватель сервера**, измените значение параметра **Трассировка неудачно завершенных запросов** на **Включено**, затем щелкните **Сохранить**.

	![Enable failed request tracing](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-failedrequeston.png)

4. В адресной строке окна браузера, в котором отображается веб-сайт, добавьте дополнительный символ в URL-адрес, чтобы вызвать ошибку 404, и нажмите клавишу ВВОД.

	Это приведет к созданию журнала трассировки неудачно завершенных запросов. Ниже приведены действия, демонстрирующие, как просмотреть или загрузить журнал.

2. На вкладке Visual Studio **Настройки** окна **Веб-сайт Azure** щелкните  **Открыть на портале управления**.

3. На портале управления щелкните **Панель мониторинга**, затем щелкните **Сброс учетных данных развертывания** в разделе **Краткое описание**.

	![Reset FTP credentials link in Dashboard](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-resetftpcredentials.png)

4. Введите новое имя пользователя и пароль.

	![New FTP user name and password](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-enterftpcredentials.png)

5. На вкладке портала управления **Панель мониторинга** нажмите клавишу F5, чтобы обновить страницу, затем прокрутите вниз до места **Пользователь /ftp развертывания**. Обратите внимание, что префиксом для имени пользователя служит имя сайта. **При выполнении входа необходимо использовать это полное имя пользователя с префиксом в виде имени сайта, как показано ниже.**

5. В новом окне браузера перейдите на URL-адрес, который отображается в разделе **Имя узла FTP** на вкладке **Панель мониторинга** страницы портала управления для вашего веб-сайта. **Пункт Имя узла FTP** расположен рядом с пунктом **Пользователь /FTP развертывания** в разделе **Краткое описание**.

6. Выполните вход с использованием учетных данных FTP, созданных ранее (включая имя сайта в виде префикса к имени пользователя).

	В браузере отображается корневая папка сайта.

6. Откройте папку  *LogFiles*.

	![Open LogFiles folder](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-logfilesfolder.png)

7. Откройте папку с именем W3SVC плюс числовое значение.

	![Open W3SVC folder](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-w3svcfolder.png)

	Папка содержит XML-файлы, связанные с любыми ошибками, которые были зарегистрированы после включения трассировки неудачно завершенных запросов, а также XSL-файл, который может использоваться браузером для форматирования XML.

	![W3SVC folder](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-w3svcfoldercontents.png)

8. Щелкните XML-файл, связанный с неудачно завершенным запросом, данные трассировки которого необходимо просмотреть.

	На следующем рисунке показана часть сведений трассировки примерной ошибки.

	![Failed request tracing in browser](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-failedrequestinbrowser.png)


<h2><a name="nextsteps"></a>Дальнейшие действия</h2>

Вы видели, как Visual Studio позволяет без труда просматривать журналы, созданные веб-сайтом Azure. В следующих разделах содержатся ссылки на дополнительные ресурсы на связанные темы:

* Устранение неполадок веб-сайтов Azure
* Отладка в Visual Studio 
* Удаленная отладка в Azure
* Трассировка в приложениях ASP.NET
* Анализ журналов веб-сервера
* Анализ журналов трассировки неудачно завершенных запросов
* Отладка облачных служб

### Устранение неполадок веб-сайтов Azure

Дополнительную информацию об устранении неполадок, связанных с веб-сайтами Azure, см. на следующих ресурсах:

* [Мониторинг веб-сайтов](/ru-ru/manage/services/web-sites/how-to-monitor-websites/)
* [Исследование проблемы утечки памяти на веб-сайтах Azure с использованием Visual Studio 2013](http://blogs.msdn.com/b/visualstudioalm/archive/2013/12/20/investigating-memory-leaks-in-azure-web-sites-with-visual-studio-2013.aspx). Запись блога Microsoft ALM о функциях Visual Studio для анализа проблем с управляемой памятью.
* [Интерактивные средства веб-сайтов Microsoft Azure, о которых вам следует знать](/blog/2014/03/28/windows-azure-websites-online-tools-you-should-know-about-2/) Запись в блоге Амита Эппла (Amit Apple).

Справочные данные об определенном вопросе, связанном с устранением неполадок, можно получить, начав беседу на одном из следующих форумов:

* [Форум Azure на веб-сайте ASP.NET](http://forums.asp.net/1247.aspx/1?Azure+and+ASP+NET).
* [Форум Azure на портале MSDN](http://social.msdn.microsoft.com/Forums/windowsazure/).
* [StackOverflow.com](http://www.stackoverflow.com).

### Отладка в Visual Studio 

Дополнительную информацию об использовании режима отладки в Visual Studio см. в разделе MSDN [Отладка в Visual Studio](http://msdn.microsoft.com/ru-ru/library/vstudio/sc65sadd.aspx) и статье [Рекомендации по отладке в Visual Studio 2010](http://weblogs.asp.net/scottgu/archive/2010/08/18/debugging-tips-with-visual-studio-2010.aspx).

### Удаленная отладка в Azure

Для получения дополнительных сведений об удаленной отладке для веб-сайтов Azure и веб-заданий см. следующие ресурсы:

* [Введение в удаленную отладку на веб-сайтах Azure](/blog/2014/05/06/introduction-to-remote-debugging-on-azure-web-sites/).
* [Введение в удаленную отладку на веб-сайтах Azure (часть 2) - подробней об удаленной отладке](/blog/2014/05/07/introduction-to-remote-debugging-azure-web-sites-part-2-inside-remote-debugging/)
* [Введение в удаленную отладку на веб-сайтах Azure (часть 3) - среда с несколькими экземплярами и GIT](/blog/2014/05/08/introduction-to-remote-debugging-on-azure-web-sites-part-3-multi-instance-environment-and-git/)
* [Отладка веб-заданий (видео)](https://www.youtube.com/watch?v=ncQm9q5ZFZs&list=UU_SjTh-ZltPmTYzAybypB-g&index=1)

Если на вашем веб-сайте используется веб-API Azure или серверная часть мобильных служб, дополнительные сведения об отладке см. в разделе [Отладка серверной части .NET в Visual Studio](http://blogs.msdn.com/b/azuremobile/archive/2014/03/14/debugging-net-backend-in-visual-studio.aspx).

### Трассировка в приложениях ASP.NET

В Интернете отсутствуют обновленные и подробные вводные данные по трассировке ASP.NET. Лучшее, что можно сделать, это начать со старых вводных материалов, написанных для Web Forms, так как тогда MVC еще не существовало. А также дополнить эти сведения новыми постами из блогов, посвященных тем или иным конкретным вопросам. Можно также продуктивно начать изучение со следующих ресурсов:

* [Мониторинг и телеметрия (создание реальных облачных приложений в Azure)](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry).<br> 
  Глава электронной книги с рекомендациями по трассировке в облачных приложениях Azure.
* [Трассировка ASP.NET](http://msdn.microsoft.com/ru-ru/library/ms972204.aspx)<br/>
  Старый, но по-прежнему хороший ресурс для введения в тему.
* [Прослушиватели трассировки](http://msdn.microsoft.com/ru-ru/library/4y5y10s7.aspx)<br/>
  Сведения о прослушивателях трассировки, но без упоминания [WebPageTraceListener](http://msdn.microsoft.com/ru-ru/library/system.web.webpagetracelistener.aspx).
* [Пошаговое руководство: интеграция трассировки ASP.NET с трассировкой System.Diagnostics](http://msdn.microsoft.com/ru-ru/library/b0ectfxd.aspx)<br/>
  Это также старый ресурс, который однако содержит некоторые дополнительные сведения, которые не освещаются во вводной статье.
* [Трассировка в представлениях ASP.NET MVC Razor](http://blogs.msdn.com/b/webdev/archive/2013/07/16/tracing-in-asp-net-mvc-razor-views.aspx)<br/>
  Помимо трассировки в представлениях Razor в этом посте также описывается, как создать фильтр ошибок, чтобы регистрировать все необработанные исключения в приложении MVC. Сведения о записи в журнал всех необработанных исключений в приложении веб-форм см. в примере Global.asax в разделе [Полный пример для обработчиков ошибок](http://msdn.microsoft.com/ru-ru/library/bb397417.aspx) на портале MSDN. Если в MVC или Web Forms понадобится зарегистрировать определенные исключения, но позволить платформе их обрабатывать, можно перехватить и повторно создать элементы, как показано на следующем примере:

        try
        {
           // Your code that might cause an exception to be thrown.
        }
        catch (Exception ex)
        {
            Trace.TraceError("Exception: " + ex.ToString());
            throw;
        } 

* [Потоковая передача диагностических журналов трассировки из командной строки Azure (включая Glimpse!)](http://www.hanselman.com/blog/StreamingDiagnosticsTraceLoggingFromTheAzureCommandLinePlusGlimpse.aspx)<br/>
  Как использовать командную строку, чтобы сделать все действия этого руководства, выполнение которые показано на примере Visual Studio. [Glimpse](http://www.hanselman.com/blog/IfYoureNotUsingGlimpseWithASPNETForDebuggingAndProfilingYoureMissingOut.aspx) - это средство для отладки приложений ASP.NET. 
* [Использование функций диагностики и ведения журнала для веб-сайта Azure Дэвид Эббо (David Ebbo)](http://www.windowsazure.com/ru-ru/documentation/videos/azure-web-site-logging-and-diagnostics/) и [Потоковая передача журналов с веб-сайтов Azure Дэвид Эббо](http://www.windowsazure.com/ru-ru/documentation/videos/log-streaming-with-azure-web-sites/)<br>
  Авторы видео: Скотт Хансельман (Scott Hanselman) и Дэвид Эббо (David Ebbo).

Для ведения журнала ошибок вместо написания своего кода трассировки можно использовать платформу ведения журналов с открытым исходным кодом, например [ELMAH](http://nuget.org/packages/elmah/). Дополнительные сведения см. в [постах блога Скотта Хансельмана (Scott Hanselman), посвященных ELMAH](http://www.hanselman.com/blog/NuGetPackageOfTheWeek7ELMAHErrorLoggingModulesAndHandlersWithSQLServerCompact.aspx).

Обратите внимание, что не нужно использовать трассировку ASP.NET или System.Diagnostics для получения потоковых журналов из Azure. Служба потоковой передачи журналов веб-сайта Azure будет передавать любые файлы с расширением TXT, HTML или LOG, которые будут найдены в папке *LogFiles*. Поэтому вы можете создать собственную систему ведения журналов, которая записывает данные в файловую систему или на веб-сайт, а файлы будут автоматически передаваться и скачиваться. Все, что нужно сделать, - это написать код приложения, который создает файлы в папке *d:\home\logfiles*. 

### Анализ журналов веб-сервера

Дополнительные сведения об анализе журналов веб-сервера см. на следующих ресурсах:

* [LogParser](http://www.microsoft.com/ru-ru/download/details.aspx?id=24659)<br/>
  Средство, которое предназначено для просмотра данных в журналах веб-сервера (файлы с расширением LOG).
* [Устранение неполадок, связанных с производительностью IIS, или ошибок приложений с помощью LogParser](http://www.iis.net/learn/troubleshoot/performance-issues/troubleshooting-iis-performance-issues-or-application-errors-using-logparser)<br/>
  Введение в средство LogParser, которое можно использовать для анализа журналов веб-сервера.
* [Посты блога Роберта Макмюррея (Robert McMurray), посвященные использованию LogParser](http://blogs.msdn.com/b/robert_mcmurray/archive/tags/logparser/)<br/>
* [Код состояния HTTP в IIS 7.0, IIS 7.5 и IIS 8.0](http://support.microsoft.com/kb/943891)

### Анализ журналов трассировки неудачно завершенных запросов

Веб-сайт Microsoft TechNet содержит раздел [Использование трассировки неудачно завершенных запросов](http://www.iis.net/learn/troubleshoot/using-failed-request-tracing) который может оказаться полезным для понимания того, как используются эти журналы. Однако эта документация посвящена преимущественно настройке трассировки неудачно завершенных запросов в IIS, которую невозможно выполнить на веб-сайтах Azure.

### Отладка облачных служб

Если вас интересует отладка облачной службы Azure, а не веб-сайта, ознакомьтесь с разделом [Отладка облачных служб](http://msdn.microsoft.com/ru-ru/library/windowsazure/ee405479.aspx).




[GetStarted]: ../web-sites-dotnet-get-started/
[GetStartedWJ]: ../websites-dotnet-webjobs-sdk/



<!--HONumber=42-->
