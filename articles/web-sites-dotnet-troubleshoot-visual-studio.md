<properties title="Устранение неполадок, связанных с веб-сайтами Azure, в Visual Studio" pageTitle="Устранение неполадок, связанных с веб-сайтами Azure, в Visual Studio" metaKeywords="устранение неполадок, отладка, веб-сайты Azure, ведение журнала, трассировка" description="Сведения об устранении неполадок, связанных с веб-сайтами Azure, с помощью удаленной отладки, трассировки и средств ведения журналов, которые встроены в Visual Studio 2013." metaCanonical="" services="web-sites" documentationCenter="Web Sites" authors="tdykstra" solutions="" />


# Устранение неполадок, связанных с веб-сайтами Azure, в Visual Studio

Во время разработки и тестирования веб-приложения можно устранять неполадки с помощью [выполнения в режиме отладки](http://www.visualstudio.com/ru-ru/get-started/debug-your-app-vs.aspx) или с помощью [IntelliTrace](http://msdn.microsoft.com/library/vstudio/dd264915.aspx). Приложение можно запускать в режиме отладки локально в IIS Express или удаленно на веб-сайте Azure. Однако лучший способ отладки ошибок, возникающих в рабочей среде, это просмотр журналов, создаваемых кодом приложения или веб-сервером. В этом учебнике показано, как использовать средства Visual Studio, которые позволяют отлаживать работу приложения во время его работы на веб-сайте Azure, выполняя это приложение удаленно в режиме отладки или путем просмотра журналов как самого приложения, так и веб-сервера.

Вы узнаете:

* Какие функции управления сайтом Azure доступны в среде Visual Studio.
* Как использовать удаленное представление Visual Studio для быстрого изменения удаленного веб-сайта.
* Как работать удаленно в среде отладки, если проект выполняется на веб-сайте Azure.
* Как создать журналы трассировки приложения и просматривать их непосредственно во время создания.
* Как просматривать журналы веб-сервера, включая подробные сообщения об ошибках и трассировку неудачно завершившихся запросов.
* Как отправлять диагностические журналы в учетную запись хранения Azure и просматривать их там.


### Сегменты учебника

1. [Предварительные требования](#prerequisites)
2. [Конфигурация и управление сайтом](#sitemanagement)
3. [Удаленное представление](#remoteview)
5. [Удаленная отладка](#remotedebug)
3. [Обзор журналов диагностики](#logsoverview)
4. [Создание и просмотр журналов трассировки приложения](#apptracelogs)
5. [Просмотр журналов веб-сервера](#webserverlogs)
5. [Просмотр подробных журналов сообщений об ошибках](#detailederrorlogs)
5. [Загрузка журналов файловой системы](#downloadlogs)
5. [Просмотр журналов хранилища](#storagelogs)
5. [Просмотр журналов неудачно завершенных запросов](#failedrequestlogs)
5. [Дальнейшие действия](#nextsteps)

<h2><a name="prerequisites"></a><span class="short-header">Предварительные требования</span></h2>

При работе с этим учебником следует использовать среду разработки, веб-проект и веб-сайт Azure, которые были настроены в разделе [Начало работы с Azure и ASP.NET][GetStarted]. В этом учебнике приводятся примеры кода для веб-приложения C# MVC, однако в приложениях Visual Basic и веб-форм применяются те же процедуры устранения неполадок.

Для удаленной отладки требуется Visual Studio 2013 или Visual Studio 2012 с обновлением 4. Другие функции, демонстрируемые в этом учебнике, также работают в Visual Studio Express 2013 for Web и Visual Studio 2012 for Web. 

Журналы потоковой передачи работают только для приложений, которые предназначены для .NET Framework 4 и выше.

<h2><a name="sitemanagement"></a>Конфигурация и управление сайтом</h2>

Visual Studio предоставляет доступ к подмножеству функций управления сайтом и параметров конфигурации, доступных на портале управления. В этом разделе вы узнаете, какие функции доступны.

1. Если вы еще не выполнили вход в Azure в Visual Studio, нажмите кнопку **Подключиться к Azure** в **обозревателе сервера**.

	Также вы можете установить сертификат управления, обеспечивающий доступ к вашей учетной записи. Сертификат управления предоставляет обозревателю сервера доступ к дополнительным службам Azure (база данных SQL и мобильные службы). Чтобы установить сертификат, щелкните правой кнопкой мыши узел **Azure** в **обозревателе сервера** и выберите пункт **Управление подписками** в контекстном меню. В диалоговом окне **Управление подписками Azure** откройте вкладку **Сертификаты**, а затем щелкните **Импорт**. Следуя указаниям, загрузите и импортируйте файл подписки (файл *.publishsettings*) для вашей учетной записи Azure.

	> [WACOM.NOTE]
	> Если вы загружаете файл подписки, сохраните его в папку, не входящую в структуру каталогов с исходными кодами (например, в папку "Загрузки"), а затем удалите его сразу после завершения импорта. Злоумышленник, получивший доступ к файлу подписки, сможет изменять, создавать и удалять ваши службы Azure.

	Дополнительные сведения о подключении к ресурсам Azure из Visual Studio см. в разделе [Управление учетными записями, подписками и административными ролями](http://go.microsoft.com/fwlink/?LinkId=324796#BKMK_AccountVCert).

2. В **обозревателе сервера** разверните узел **Azure** и затем узел **Веб-сайты**.

3. Щелкните правой кнопкой мыши узел веб-сайта, созданного в разделе [Начало работы с Azure и ASP.NET][GetStarted], и выберите пункт **Просмотреть параметры**.

	![Просмотр параметров в обозревателе сервера](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-viewsettings.png)

	Появляется вкладка **Веб-сайт Azure**, где можно просмотреть задачи по управлению и конфигурации, доступные в Visual Studio.

	![Окно веб-сайта Azure](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-configtab.png)

	В этом руководстве используются раскрывающиеся списки ведения журналов и трассировки.	Для удаленной отладки вы будете использовать другой метод.
   
	Сведения о полях параметров приложения и строк подключения в этом окне см. в разделе [Веб-сайты Azure: как работают параметры приложения и строки подключения](http://blogs.msdn.com/b/windowsazure/archive/2013/07/17/windows-azure-web-sites-how-application-strings-and-connection-strings-work.aspx).

	Если необходимо выполнить задачу по управлению сайтом, которую невозможно выполнить в этом окне, можно щелкнуть пункт **Полные параметры веб-сайта**, чтобы открыть в окне браузера портал управления. Дополнительные сведения см. в статье [Настройка веб-сайтов](/ru-ru/manage/services/web-sites/how-to-configure-websites/#howtochangeconfig).

<h2><a name="remoteview"></a>Удаленное представление</h2>

Как правило, при развертывании сайта флагу `customErrors` в файле Web.config присваивается значение `On` или `RemoteOnly`, из-за которого вы не видите информативные сообщения о возникающих ошибках. В большинстве случаев при ошибке отображается страница следующего вида.

**Ошибка сервера в приложении "/":**
![Неинформативная страница ошибки](./media/web-sites-dotnet-troubleshoot-visual-studio/genericerror.png)

**Произошла ошибка:**
![Неинформативная страница ошибки](./media/web-sites-dotnet-troubleshoot-visual-studio/genericerror1.png)

**Не удается отобразить страницу веб-сайта**
![Неинформативная страница ошибки](./media/web-sites-dotnet-troubleshoot-visual-studio/genericerror2.png)

Подробное сообщение об ошибке, как правило, содержит полезные сведения для ее устранения. На предыдущих снимках экрана показано, как включить эту функцию. Для этого необходимо внести изменения в развернутый файл Web.config. Вы можете изменить файл *Web.config* в проекте и повторно развернуть проект, либо создать [преобразование Web.config](http://www.asp.net/mvc/tutorials/deployment/visual-studio-web-deployment/web-config-transformations) и развернуть отладочную сборку. Однако вы можете значительно упростить этот процесс с помощью **обозревателя решения**, напрямую просматривая и редактируя файлы на удаленном сайте с использованием функции *удаленного представления*.

1. В **обозревателе сервера** разверните узел **Azure**, затем узел **Веб-сайты** и узел веб-сайта, на который вы выполняете развертывание.

	Откроются узлы, обеспечивающие доступ к файлам содержимого и журналов веб-сайта.

	![Файлы содержимого и журналов](./media/web-sites-dotnet-troubleshoot-visual-studio/fileandlogfiles.png)

2. Разверните узел **Файлы** и дважды щелкните файл *Web.config*.

	![Открытие файла Web.config](./media/web-sites-dotnet-troubleshoot-visual-studio/webconfig.png)

	В Visual Studio откроется файл Web.config удаленного сайта, а в строке заголовка к его имени будет добавлен суффикс [Удаленный].

3. Добавьте следующую строку в элемент `system.web`:

	`<customErrors mode="off"></customErrors>`

	![Изменение файла Web.config](./media/web-sites-dotnet-troubleshoot-visual-studio/webconfigedit.png)

4. Обновите окно браузера, в котором отображается неинформативное сообщение. Вы увидите подробные сведения об ошибке, как в следующем примере:

	![Подробное сообщение об ошибке](./media/web-sites-dotnet-troubleshoot-visual-studio/detailederror.png)

	Для создания отображаемой ошибки в файл *Views\Home\Index.cshtml* была добавлена показанная красным строка.

Изменение файла Web.config является одним из нескольких способов упростить устранение неполадок путем считывания и редактирования файлов на вашем веб-сайте Azure.

<h2><a name="remotedebug"></a>Удаленная отладка</h2>

Если в подробном сообщении об ошибке содержится недостаточно сведений и вы не можете воспроизвести ошибку в локальной системе, попробуйте выполнить отладку в удаленном режиме. В этом режиме вы можете задавать точки останова, обращаться к памяти напрямую, осуществлять пошаговое выполнение кода и даже изменять путь кода. 

Удаленная отладка не поддерживается в выпусках Visual Studio Express.

В этом разделе демонстрируется удаленная отладка с использованием проекта, созданного в разделе [Начало работы с Azure и ASP.NET][GetStarted].

1. Откройте веб-проект, созданный в разделе [Начало работы с Azure и ASP.NET][GetStarted].

1. Откройте файл *Controllers\HomeController.cs*.

2. Удалите метод `About()` и вставьте вместо него следующий код.

        public ActionResult About()
        {
            string currentTime = DateTime.Now.ToLongTimeString();
            ViewBag.Message = "The current time is " + currentTime;
            return View();
        }

2. [Задайте точку останова](http://www.visualstudio.com/ru-ru/get-started/debug-your-app-vs.aspx) в строке `ViewBag.Message`.

1. В **обозревателе решений** щелкните правой кнопкой мыши проект и выберите пункт **Опубликовать**.

2. В раскрывающемся списке **Профиль** выберите тот же профиль, который вы использовали в разделе [Начало работы с Azure и ASP.NET][GetStarted].

3. Откройте вкладку **Настройки** и измените значение **Конфигурация** на **Отладка**, затем выберите пункт **Опубликовать**.

	![Публикация в режиме отладки](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-publishdebug.png)

4. После завершения развертывания и открытия URL-адреса вашего сайта Azure закройте браузер.

5. Только в Visual Studio 2013: в **обозревателе сервера** разверните узел **Azure**, затем узел **Веб-сайты**, щелкните правой кнопкой мыши веб-сайт и выберите пункт **Подключить отладчик**. 

	![Подключение отладчика](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-attachdebugger.png)

	В браузере автоматически откроется ваша главная страница, размещенная в Azure. Возможно, придется подождать около 20 секунд, пока Azure настраивает сервер для отладки. Эта задержка возникает только при первом выполнении в режиме отладки на веб-сайте. При последующих отладках в течение 48 часов задержки не будет.

6. Для Visual Studio 2012 с обновлением 4:

	* На портале управления Azure перейдите на вкладку **Настройки** для вашего веб-сайта, затем прокрутите вниз до раздела **Диагностика сайта**.

	* Установите для параметра **Удаленная отладка** значение **Включено**, а для параметра **Удаленная отладка: версия Visual Studio** — значение **2012**.

	![Установка удаленной отладки на портале управления](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-debuginportal.png)
   
	* В меню Visual Studio **Отладка** щелкните пункт **Присоединение к процессу**.

	* В поле **Квалификатор** введите URL-адрес для вашего веб-сайта без префикса `http://`. 

	* Выберите пункт **Отображать процессы всех пользователей**.

	* Когда появится запрос на ввод учетных данных, введите имя и пароль пользователя, который имеет разрешения на публикацию веб-сайта. Чтобы получить эти учетные данные, перейдите на вкладку "Панель мониторинга" для вашего веб-сайта на портале управления и щелкните пункт **Загрузить профиль публикации**. Откройте файл в текстовом редакторе; имя и пароль пользователя будут располагаться после первого вхождения соответственно **userName=** и **userPWD=**. 

	* Когда процессы отображаются в таблице **Доступные процессы**, выберите **w3wp.exe** и щелкните **Присоединить**.

	* Откройте URL-адрес вашего сайта в браузере.

	Возможно, придется подождать около 20 секунд, пока Azure настраивает сервер для отладки. Эта задержка возникает только при первом выполнении в режиме отладки на веб-сайте. При последующих отладках в течение 48 часов задержки не будет.

6. Снова выберите пункт **О программе** в меню.

	Visual Studio прерывается в точке останова, при этом код выполняется в Azure, а не на локальном компьютере.

7. Наведите указатель мыши на переменную `currentTime`, чтобы просмотреть значение времени.

	![Просмотр переменной в режиме отладки в Azure](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-debugviewinwa.png)

	Время, которое отображается здесь, является временем сервера Azure, который может находиться в другом часовом поясе, отличном от часового пояса локального компьютера.

8. Введите новое значение переменной `currentTime`, например "Теперь выполняется в Azure".

5. Нажмите клавишу F5, чтобы продолжить работу.

	На странице "О программе" в Azure отображается новое значение, введенное в переменной currentTime.

	![Страница "О программе" с новым значением](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-debugchangeinwa.png)

### Примечания о режиме удаленной отладки

* В рабочей среде выполнение в режиме отладки не рекомендуется. Если производственный сайт не масштабирован до нескольких экземпляров сервера, отладка приведет к привязке трафика только к текущему экземпляру веб-сервера. Если имеется несколько экземпляров веб-сервера, при присоединении отладчика будет использован случайно выбранный экземпляр и не будет никаких возможностей убедиться в том, что запросы браузера передаются именно на этот экземпляр. Кроме того, как правило, отладочная сборка не развертывается в производственной среде, а оптимизации компилятора для разворачиваемых сборок делают невозможным построковое отображения действий в исходном коде. Для устранения неполадок в рабочей среде лучше всего использовать журналы веб-сервера и трассировки приложения.

* Во время удаленной отладки избегайте длинных остановок на точках останова. Azure обрабатывает процесс, остановленный дольше, чем на несколько минут, как процесс, не отвечающий на запросы, и закрывает его.

* Во время отладки сервер отправляет данные в среду Visual Studio, что может повлиять на расходы, связанные с пропускной способностью. Сведения о тарифах на пропускную способность см. в разделе [Цены на Azure](/ru-ru/pricing/calculator/).

* Убедитесь, что атрибут `debug` элемента `compilation` в файле *Web.config* имеет значение true. По умолчанию при публикации отладочной конфигурации сборки для него задано значение true.

        <system.web>
          <compilation debug="true" targetFramework="4.5" />
          <httpRuntime targetFramework="4.5" />
        </system.web>

* Если вы обнаружите, что отладчик не выполняет пошаговое прохождение кода, который следует отладить, возможно необходимо изменить параметр пошаговую отладку кода, который требуется отладить, может потребоваться изменить параметр "Только мой код".  Дополнительные сведения см. в разделе [Ограничение выполнения шагов только моим кодом](http://msdn.microsoft.com/ru-ru/library/vstudio/y740d9d3.aspx#BKMK_Restrict_stepping_to_Just_My_Code)

* При активации функции удаленной отладки на сервере запускается таймер, который автоматически отключает эту функцию по истечении 48 часов в целях повышения безопасности и производительности. Вы можете в любое время снова активировать эту функцию. Если вы не ведете отладку, эту функцию рекомендуется оставить отключенной.

* Вы можете вручную присоединить отладчик к любому процессу. При этом для отладки доступен не только процесс веб-сайта (w3wp.exe), но и другие процессы, в том числе [веб-задания](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/getting-started-with-windows-azure-webjobs). Дополнительные сведения о том, как использовать режим отладки в Visual Studio, см. в разделе [Отладка в Visual Studio](http://msdn.microsoft.com/ru-ru/library/vstudio/sc65sadd.aspx).

<h2><a name="logsoverview"></a><span class="short-header">Обзор журналов</span>Обзор журналов диагностики</h2>

Приложения ASP.NET, которое работает на веб-сайте Azure, может создавать следующие виды журналов:

* **Журналы трассировки приложения**<br/>
  Приложение создает эти журналы, вызывая методы класса [System.Diagnostics.Trace](http://msdn.microsoft.com/ru-ru/library/system.diagnostics.trace.aspx).
* **Журналы веб-сервера**<br/>
  Веб-сервер создает запись журнала для каждого HTTP-запроса, адресованного сайту.
* **Подробные журналы сообщений об ошибках**<br/>
  Веб-сервер создает страницу HTML с некоторыми дополнительными сведениями об ошибочных HTTP-запросах (те запросы, которые приводят к появлению кода состояния 400 и выше). 
* **Журналы трассировки неудачно завершенных запросов**<br/>
  Веб-сервер создает XML-файл с подробными сведениями трассировки ошибочных HTTP-запросов. Веб-сервер также предоставляет XSL-файл для форматирования XML-кода в браузере.
  
Ведение журнала влияет на производительность веб-сайта, поэтому Azure предоставляет возможность при необходимости включить или отключить каждый тип журнала. Для журналов приложений можно указать, что следует писать только журналы с уровнем серьезности выше заданного. При создании нового веб-сайта все ведение журналов по умолчанию отключено.

Журналы записываются в файлы, содержащиеся в папке *LogFiles* файловой системы вашего веб-сайта. Журналы приложений и журналы веб-сервера также могут записываться в учетную запись хранения Azure. В учетной записи хранения можно держать больший объем журналов, чем в файловой системе. При использовании файловой системы на журналы отводится 100 мегабайтов. Журналы файловой системы хранятся в течение короткого срока. При достижении установленного ограничения Azure удаляет старые файлы журналов, чтобы освободить место под новые.  

<h2><a name="apptracelogs"></a><span class="short-header">Журналы приложения</span>Создание и просмотр журналов трассировки приложения</h2>

В этом разделе предстоит выполнить следующие задачи:

* Добавление инструкций трассировки в веб-проект, созданный в [предыдущем учебном курсе][GetStarted].
* Просмотр журналов при локальном выполнении проекта.
* Просмотр журналов, создаваемых во время работы приложения в Azure. 

###Добавление инструкций трассировки в приложение

1. Откройте файл *Controllers\HomeController.cs* и замените его содержимое на следующий код, чтобы добавить инструкции `Trace` и `using` для `System.Diagnostics`:

		using System;
		using System.Collections.Generic;
		using System.Configuration;
		using System.Diagnostics;
		using System.Linq;
		using System.Web;
		using System.Web.Configuration;
		using System.Web.Mvc;
		namespace MyExample.Controllers
		{
		    public class HomeController : Controller
		    {
		        public ActionResult Index()
		        {
		            Trace.WriteLine("Entering Index method");
		            ViewBag.Message = "Modify this template to jump-start your ASP.NET MVC application.";
		            Trace.TraceInformation("Displaying the Index page at " + DateTime.Now.ToLongTimeString());
		            Trace.WriteLine("Leaving Index method");
		            return View();
		        }
		
		        public ActionResult About()
		        {
		            Trace.WriteLine("Entering About method");
		            ViewBag.Message = "Your app description page.";
		            Trace.TraceWarning("Transient error on the About page at " + DateTime.Now.ToShortTimeString());
		            Trace.WriteLine("Leaving About method");
		            return View();
		        }
		
		        public ActionResult Contact()
		        {
		            Trace.WriteLine("Entering Contact method");
		            ViewBag.Message = "Your contact page.";
		            Trace.TraceError("Fatal error on the Contact page at " + DateTime.Now.ToLongTimeString());
		            Trace.WriteLine("Leaving Contact method");
		            return View();
		        }
		    }
		}
		
				
### Просмотр результатов трассировки локально

3. Нажмите F5, чтобы запустить приложение в режиме отладки.

	Прослушиватель трассировки по умолчанию записывает весь вывод трассировки в окно **Вывод** вместе со всем остальным выводом отладки. На следующем рисунке показан вывод инструкций трассировки, добавленных в метод `Index`.

	![Трассировка в окне отладки](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-debugtracing.png)

	Ниже показано, как просмотреть выходные данные трассировки на веб-странице без компиляции в режиме отладки.

2. Откройте файл Web.config приложения (находится в папке проекта) и добавьте элемент `<system.diagnostics>` в конец файла непосредственно перед закрывающим элементом `</configuration>`:

  		<system.diagnostics>
		    <trace>
		      <listeners>
		        <add name="WebPageTraceListener"
                    type="System.Web.WebPageTraceListener, 
                    System.Web, 
                    Version=4.0.0.0, 
                    Culture=neutral,
                    PublicKeyToken=b03f5f7f11d50a3a" />
		      </listeners>
		    </trace>
		  </system.diagnostics>

	`WebPageTraceListener` позволяет просматривать результаты трассировки, открыв `/trace.axd`.

3. Добавьте <a href="http://msdn.microsoft.com/ru-ru/library/vstudio/6915t83k(v=vs.100).aspx">элемент трассировки</a> в раздел `<system.web>` в файле Web.config, например следующим образом:

		<trace enabled="true" writeToDiagnosticsTrace="true" mostRecent="true" pageOutput="false" />

3. Нажмите сочетание клавиш CTRL+F5 для запуска приложения.

4. В адресной строке окна браузера добавьте *trace.axd* к URL-адресу и нажмите клавишу ВВОД (URL-адрес должен быть аналогичен http://localhost:53370/trace.axd).

5. На странице **Трассировка приложения** щелкните пункт **Просмотр сведений**.

	![trace.axd](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-traceaxd1.png)

	Откроется страница **Сведения о запросе**, где в разделе **Сведения о трассировке** отображаются выходные данные инструкций трассировки, добавленных в метод `Index`.

	![trace.axd](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-traceaxd2.png)

	По умолчанию `trace.axd` доступен только локально. Если он должен быть доступен также на удаленном сайте, можно добавить строку `localOnly="false"` в элемент `trace` файла *Web.config*, как показано в следующем примере:

		<trace enabled="true" writeToDiagnosticsTrace="true" localOnly="false" mostRecent="true" pageOutput="false" />

	Однако включение `trace.axd` на рабочем сайте, как правило, не рекомендуется по соображениям безопасности, и в следующих разделах будет приведен более простой способ чтения журналов трассировки веб-сайта Azure.

### Просмотр результатов трассировки в Azure

1. В **обозревателе решений** щелкните правой кнопкой веб-проект и выберите пункт **Опубликовать**.

2. В диалоговом окне **Публикации веб-сайта** щелкните **Опубликовать**.

	После того как Visual Studio опубликует обновление, главная страница открывается в окне браузера (если не снят флажок **URL-адрес назначения** на вкладке **Подключение**).

3. В **обозревателе сервера** щелкните правой кнопкой мыши веб-сайт и выберите **Просмотр журналов потоковой передачи в окне вывода**. 

	![Просмотр журналов потоковой передачи в контекстном меню](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-viewlogsmenu.png)

	В окне **Вывод** показано, что вы подключены к службе потоковой передачи журналов; каждую минуту, когда отсутствует журнал для отображения, появляется строка уведомления.

	![Просмотр журналов потоковой передачи в контекстном меню](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-nologsyet.png)

4. В окне браузера с открытой главной страницей щелкните пункт **Contact**.

	Через несколько секунд в окне **Вывод** появятся результаты трассировки уровня ошибки, добавленные в метод `Contact`.

	![Трассировка ошибок в окне вывода](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-errortrace.png)

	Visual Studio отображает только трассировки уровня ошибок, так как это настройка выставляется по умолчанию при включении службы мониторинга журналов. При создании нового веб-сайта Azure ведение всех журналов по умолчанию отключено, что вы видели ранее при открытии страницы параметров сайта.

	![Выключение ведение журнала приложения](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-apploggingoff.png)


	Однако при выборе **Просмотр журналов потоковой передачи в окне вывода** Visual Studio автоматически изменяет значение параметра **Ведение журнала приложения (файловая система)** на **Ошибка**, что означает представление только журналов уровня ошибок. Чтобы просмотреть все журналы трассировки, следует изменить значение этого параметра на **Подробно**. Если выбран уровень серьезности меньше уровня ошибок, начинают предоставляться и все журналы с более высокими уровнями серьезности. Поэтому при выборе подробного уровня вы также сможете просматривать журналы информационных сообщений, предупреждений и ошибок.  

4. В **обозревателе сервера** щелкните правой кнопкой мыши веб-сайт, затем щелкните **Просмотреть параметры**, как и раньше.

5. Измените значение параметра **Ведение журнала приложения (файловая система)** на **Подробно**, затем нажмите кнопку **Сохранить**.
 
	![Уровень трассировки "Подробно"](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-applogverbose.png)

6. В окне браузера, в котором теперь отображается страница **Связь**, нажмите кнопку **Главная**, затем выберите **О программе** и щелкните **Связь**.

	Через несколько секунд в окне **Вывод** появятся все результаты трассировки.

	![Подробные результаты трассировки](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-verbosetraces.png)

	В этом разделе вы включили и отключили ведение журналов с помощью параметров веб-сайта Azure. Можно также включить и отключить прослушиватели трассировки, изменив содержимое файла Web.config. Однако изменение файла Web.config приводит к перезапуску домена приложения, тогда как включение ведения журналов через веб-сайт не приводит к аналогичным результатам. Если воспроизведение проблемы занимает много времени или проблема возникает только периодически, перезапуск домена приложения может устранить неполадку, так что вам придется ждать следующего ее возникновения. Включение диагностики в Azure не приводит к подобным результатам, поэтому сбор сведений об ошибках можно начать незамедлительно.

###Функции окна вывода

На вкладке **Журналы Azure** окна **Вывод** содержатся несколько кнопок и текстовое поле.

![Кнопки вкладки журналов](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-icons.png)

Служат для выполнения следующих функций:

* Очистка окна **Вывод**.
* Включение или отключение переноса слов.
* Запуск или остановка журналов мониторинга.
* Определение журналов мониторинга.
* Загрузка журналов.
* Фильтрация журналов на основе регулярного выражения или строки поиска.
* Закрытие окна **Вывод**.

Если ввести строку поиска или регулярное выражение, Visual Studio фильтрует сведения в журналах на стороне клиента. Это означает, что можно ввести критерии после отображения журналов в окне  **Вывод**, а также изменить критерии фильтрации без необходимости повторного создания журналов.

<h2><a name="webserverlogs"></a><span class="short-header">Журналы веб-сервера</span>Просмотр журналов веб-сервера</h2>

Журналы веб-сервера регистрируют все действия по протоколу HTTP на сайте. Чтобы увидеть их в окне **Вывод**, следует включить их на сайте и оповестить Visual Studio о необходимости их мониторинга. 

1. На вкладке **Конфигурация веб-сайта Azure**, открытой в окне **Обозреватель сервера**, измените значение параметра "Ведение журналов веб-сервера" на **Включено** и щелкните **Сохранить**.

	![Включение ведения журналов веб-сервера](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-webserverloggingon.png)

2. В окне **Вывод** нажмите кнопку **Укажите, какие журналы Azure отслеживать**.
	
	![Укажите, какие журналы Azure отслеживать](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-specifylogs.png)

3. В диалоговом окне **Параметры ведения журналов Azure** выберите **Журналы веб-сервера** и нажмите кнопку **ОК**.

	![Мониторинг журналов веб-сервера](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-monitorwslogson.png)

4. В окне браузера, в котором отображается веб-сайт, щелкните **Главная**, затем **О программе** и, наконец, **Связь**.

	Как правило, первыми отображаются журналы приложений, за которыми следуют журналы веб-сервера. Подождите некоторое время, чтобы дождаться отображения журналов. 

	![Журналы веб-сервера в окне вывода](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-wslogs.png)


По умолчанию при первом включении журналов веб-сервера с помощью Visual Studio Azure записывает журналы в файловой системе. В качестве альтернативы можно использовать портал управления для указания, что журналы веб-сервера должны записываться в контейнер blob, содержащийся в учетной записи хранения. Дополнительные сведения см. в разделе **диагностика сайта** в разделе [Как настроить веб-сайты](/ru-ru/manage/services/web-sites/how-to-configure-websites/#howtochangeconfig). 

Если включить ведение журналов веб-сервера для учетной записи хранения Azure с помощью портала управления, а затем отключить ведение журналов в Visual Studio, то при повторном включении ведения журналов в Visual Studio восстанавливаются параметры учетной записи хранения. 

<h2><a name="detailederrorlogs"></a><span class="short-header">Журналы ошибок</span>Просмотр подробных журналов сообщений об ошибках</h2>

Подробные журналы сообщений об ошибках представляют некоторые дополнительные сведения о HTTP-запросах, которые завершаются с кодом ошибки (400 или выше). Чтобы увидеть их в окне **Вывод**, следует включить их на сайте и оповестить Visual Studio о необходимости их мониторинга.

1. На вкладке **Конфигурация веб-сайта Azure**, открытой в окне **Обозреватель сервера**, измените значение параметра **Подробные сообщения об ошибках** на **Включено**, затем щелкните **Сохранить**.

	![Включение подробных сообщений об ошибках](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-detailedlogson.png)

2. В окне **Вывод** нажмите кнопку **Укажите, какие журналы Azure отслеживать**.

3. В диалоговом окне **Параметры ведения журналов Azure** выберите **Все журналы** и нажмите кнопку **ОК**.

	![Отслеживание всех журналов](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-monitorall.png)

4. В адресной строке окна браузера добавьте дополнительный символ в URL-адрес, чтобы вызвать ошибку 404 (например, `http://localhost:53370/Home/Contactx`), и нажмите клавишу ВВОД.

	После нескольких секунд в окне Visual Studio **Вывод** появится подробный журнал ошибок.

	![Подробный журнал ошибок в окне вывода](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-detailederrorlog.png)

	Щелкните ссылку, удерживая нажатой клавишу CTRL, чтобы просмотреть форматированные выходные данные журнала в браузере:

	![Подробный журнал ошибок в окне браузера](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-detailederrorloginbrowser.png)

<h2><a name="downloadlogs"></a><span class="short-header">Загрузка журналов</span>Загрузка журналов файловой системы</h2>

Все журналы, которые можно отслеживать в окне **Вывод**, также можно загрузить в виде файла *ZIP*. 

1. В окне **Вывод** щелкните **Загрузить журналы потоковой передачи**.

	![Кнопки вкладки журналов](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-downloadicon.png)

	В проводнике открывается папка *Загрузки* с выбранным загруженным файлом.

	![Загруженный файл](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-downloadedfile.png)

2. Извлеките содержимое *ZIP*-файла. Вы увидите структуру папки, аналогичную следующей:

	![Загруженный файл](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-logfilefolders.png)

	* Журналы трассировки приложения содержатся в *TXT*-файлах в папке *LogFiles\Application*.
	* Журналы веб-сервера содержатся в *LOG*-файлах в папке *LogFiles\http\RawLogs*. Можно использовать средство, аналогичное [Log Parser](http://www.microsoft.com/ru-ru/download/details.aspx?displaylang=en&id=24659) для просмотра и обработки этих файлов.
	* Подробные журналы сообщений об ошибках содержатся в *HTML*-файлах в папке *LogFiles\DetailedErrors*.

	(Папка *deployments* предназначена для файлов, созданных при публикации системы управления версиями; она никак не связана с публикациями Visual Studio. Папка *Git* предназначена для трассировок, относящихся к публикациям системы управления версиями и службы потоковой передачи файлов журналов.)  

<h2><a name="storagelogs"></a><span class="short-header">Журналы хранилища</span>Просмотр журналов хранилищ</h2>

Журналы трассировки приложения также могут быть переданы в учетную запись хранения Azure, после чего их можно просмотреть в Visual Studio. Для этого необходимо создать учетную запись хранения, включить журналы хранилища на портале управления и просмотреть их на вкладке **Журналы** окна **Веб-сайт Azure**.

Журналы можно отправить в любое из трех мест назначения:

* Файловая система.
* Таблицы учетной записи хранения.
* BLOB-объекты учетной записи хранения.

Для каждого места назначения вы можете задать отдельный уровень серьезности. 

Таблицы удобны для просмотра данных журналов в Интернете и поддерживают потоковую передачу. Это позволяет запрашивать новые журналы из таблиц по мере их создания. Используя BLOB-объекты, вы можете загрузить журналы в файл для последующего анализа в средстве HDInsight, которое поддерживает такой формат данных. Дополнительные сведения см. в разделе **Hadoop и MapReduce** статьи [Варианты хранения данных (создание реальных облачных приложений в Azure)](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/data-storage-options).

На данный момент вы настроили подробное ведение журналов файловой системы. Далее вы настроите журналы информационного уровня, которые будут передаваться в таблицы учетной записи хранения. Информационный уровень означает, что все журналы, созданные вызовом методов `Trace.TraceInformation`, `Trace.TraceWarning` и `Trace.TraceError`, будут отображаться, однако не будут отображаться журналы, созданные при вызове `Trace.WriteLine`.

Учетные записи хранения, в отличие от файловой системы, обеспечивают длительное хранение больших объемов данных журналов. Еще одним преимуществом отправки журналов трассировки приложений в систему хранения является получение некоторых дополнительных сведений вместе с каждым журналом, которые недоступны при использовании журналов из файловой системы.

1. В **обозревателе сервера** щелкните правой кнопкой мыши веб-сайт, затем щелкните **Открыть на портале управления**.

2. На портале управления щелкните вкладку **Хранилище**, затем щелкните **Создать учетную запись хранения**.

	![Создание учетной записи хранения](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-createstorage.png)

2. Введите уникальный URL-адрес для учетной записи хранения и выберите пункт **Создать учетную запись хранения**.

	![Введите URL-адрес](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-storageurl.png)

1. В окне Visual Studio **Веб-сайт Azure** перейдите на вкладку **Журналы**, а затем щелкните **Настроить ведение журналов**.

	![Загруженный файл](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-configlogging.png)

	Это приведет к открытию вкладки **Настройки** на портале управления вашим веб-сайтом. Другим способом открытия этой вкладки является переход на вкладку **Веб-сайты** с последующим щелчком вкладки **Настройки**.

2. На вкладке портала управления **Настройки** прокрутите вниз до раздела диагностики приложения и задайте для параметра **Ведение журнала приложения (табличное хранилище)** значение **Включено**.

3. Измените значение параметра **Уровень ведения журнала** на **Сведения**.

4. Щелкните **Управление табличным хранилищем**.

	![Щелкните "Управление табличным хранилищем"](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-stgsettingsmgmtportal.png)

	В поле **Управление табличным хранилищем для диагностики приложений** можно выбрать учетную запись хранения, если у вас их несколько. Вы можете как создать новую, так и использовать существующую таблицу.

	![Управление табличным хранилищем](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-choosestorageacct.png)

6. В поле **Управление табличным хранилищем для диагностики приложений** щелкните флажок, чтобы закрыть окно.

6. На вкладке **Настройка** портала управления щелкните **Сохранить**.

7. В окне браузера, в котором отображается веб-сайт приложения, щелкните **Главная**, затем **О программе** и, наконец, **Связь**.

	Ведение журнала сведений, полученных при просмотре веб-страниц, будут записаны в учетную запись хранения.

8. На вкладке **Журналы** окна **Веб-сайт Azure** в Visual Studio щелкните **Обновить** в разделе **Сводка по диагностике**.

	![Щелкните "Обновить"](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-refreshstorage.png)

	В разделе **Сводка по диагностике** по умолчанию отображаются журналы за последние 15 минут. Можно изменить период для просмотра дополнительных журналов. 

	(При появлении ошибки "Таблица не найдена" убедитесь, что вы перешли к страницам, которые выполняют трассировку, после включения параметра **Ведение журналов приложения (хранилище)** и нажатия кнопки **Сохранить**.)

	![Журналы хранилища](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-storagelogs.png)

	Обратите внимание, что в этом представлении отображаются **ИД процесса** и **ИД потока** для каждого журнала, что отсутствует в журналах файловой системы. Дополнительные поля можно увидеть, напрямую просмотрев таблицу хранилища Azure.

8. Щелкните **Просмотреть все журналы приложений**.

	Таблица журнала трассировки отображается в средстве просмотра таблицы хранилища Azure.
   
	(Если возникает ошибка "последовательность не содержит элементов", откройте **Обозреватель сервера**, разверните узел для вашей учетной записи хранения в разделе **Azure**, а затем щелкните правой кнопкой мыши пункт **Таблицы** и нажмите кнопку **Обновить**.)

	![Таблица трассировки в обозревателе сервера](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-tracetableinse.png)

	![Журналы хранилища в табличном представлении](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-tracelogtableview.png)

	Это представление показывает дополнительные поля, которые не отображаются в других представлениях. Это представление также позволяет фильтровать журналы, используя для создания запроса специальный пользовательский интерфейс построителя запросов. Дополнительные сведения см. в разделе "Работа с ресурсами таблицы - фильтрация объектов" учебника [Обзор ресурсов хранилища с помощью обозревателя сервера](http://msdn.microsoft.com/ru-ru/library/windowsazure/ff683677.aspx).

7. Чтобы просмотреть сведения по отдельной строке, щелкните правой кнопкой мыши одну из строк, затем выберите **Изменить**.

	![Таблица трассировки в обозревателе сервера](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-tracetablerow.png)

<h2><a name="failedrequestlogs"></a><span class="short-header">Журналы ошибочных запросов</span> Просмотр журналов трассировки неудачно завершенных запросов</h2>

Журналы трассировки неудачно завершенных запросов полезны при просмотре подробных сведений по обработке IIS HTTP-запроса в таких сценариях, как перезапись URL-адреса, или при возникновении проблем, связанных с проблемами проверки подлинности. 

Веб-сайты Azure используют те же функциональные возможности трассировки неудачно завершенных запросов, которые доступны в IIS, начиная с версии 7.0. Однако у вас нет доступа к параметрам IIS, которые определяют, какие ошибки будут регистрироваться. При включении трассировки неудачно завершенных запросов захватываются все ошибки. 

Можно включить трассировку неудачно завершенных запросов с помощью Visual Studio, однако эту трассировку невозможно просмотреть в Visual Studio. Эти журналы представляют собой XML-файлы. Служба потоковой передачи журналов только отслеживает файлы, которые могут быть прочтены в режиме обычного текста: это файлы *.txt*, *.html* и *.log*.

Журналы трассировки неудачно завершенных запросов можно просматривать напрямую в браузере через FTP или локально после загрузки их на локальный компьютер с помощью средства для работы с FTP. В этом разделе они будут просматриваться непосредственно в браузере.

1. На вкладке **Конфигурация** окна **Веб-сайт Azure**, которое было открыто в окне **Обозреватель сервера**, измените значение параметра **Трассировка неудачно завершенных запросов** на **Включено**, затем щелкните **Сохранить**.

	![Включение трассировки неудачно завершенных запросов](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-failedrequeston.png)

4. В адресной строке окна браузера, в котором отображается веб-сайт, добавьте дополнительный символ в URL-адрес, чтобы вызвать ошибку 404, и нажмите клавишу ВВОД.

	Это приведет к созданию журнала трассировки неудачно завершенных запросов. Ниже приведены действия, демонстрирующие, как просмотреть или загрузить журнал.

2. На вкладке Visual Studio **Настройка** окна **Веб-сайт Azure** щелкните **Открыть на портале управления**.

3. На портале управления щелкните **Панель мониторинга**, затем щелкните **Сброс учетных данных развертывания** в разделе **Краткое описание**.

	![Сброс ссылки на учетные данные FTP на панели мониторинга](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-resetftpcredentials.png)

4. Введите новое имя пользователя и пароль.

	![Новое имя пользователя и пароль FTP](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-enterftpcredentials.png)

5. На вкладке портала управления **Панель мониторинга** нажмите клавишу F5, чтобы обновить страницу, затем прокрутите вниз до раздела **Пользователь /ftp развертывания**. Обратите внимание, что префиксом для имени пользователя служит имя сайта. **При выполнении входа необходимо использовать это полное имя пользователя с префиксом в виде имени сайта, как показано ниже.**

5. В новом окне браузера перейдите на URL-адрес, который отображается в разделе **Имя узла FTP** на вкладке **Панель мониторинга** страницы портала управления для вашего веб-сайта. Пункт **Имя узла FTP** расположен рядом с пунктом **Пользователь /FTP развертывания** в разделе **Краткое описание**.

6. Выполните вход с использованием учетных данных FTP, созданных ранее (включая имя сайта в виде префикса к имени пользователя).

	В браузере отображается корневая папка сайта.

6. Откройте папку *LogFiles*.

	![Откройте папку LogFiles](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-logfilesfolder.png)

7. Откройте папку с именем W3SVC плюс числовое значение.

	![Откройте папку W3SVC](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-w3svcfolder.png)

	Папка содержит XML-файлы, связанные с любыми ошибками, которые были зарегистрированы после включения трассировки неудачно завершенных запросов, а также XSL-файл, который может использоваться браузером для форматирования XML.

	![Папка W3SVC](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-w3svcfoldercontents.png)

8. Щелкните XML-файл, связанный с неудачно завершенным запросом, данные трассировки которого необходимо просмотреть.

	На следующем рисунке показана часть сведений трассировки примерной ошибки.

	![Трассировка неудачно завершенных запросов в браузере](./media/web-sites-dotnet-troubleshoot-visual-studio/tws-failedrequestinbrowser.png)


<h2><a name="nextsteps"></a><span class="short-header">Дальнейшие действия</span>Дальнейшие действия</h2>

Вы видели, как Visual Studio позволяет без труда просматривать журналы, созданные веб-сайтом Azure. Возможно, вы захотите узнать больше об устранении неполадок, связанных с веб-сайтами Azure, о трассировке приложений ASP.NET и анализе журналов веб-сервера.

### Устранение неполадок, связанных с веб-сайтом Azure

Дополнительные сведения об устранении неполадок, связанных с веб-сайтами Azure, см. на следующих ресурсах:

* [Устранение неполадок в Azure](/ru-ru/develop/net/best-practices/troubleshooting/)<br/>
  Базовый технический документ вводного уровня, в котором содержится краткий раздел, посвященный веб-сайтам Azure.
* [Устранение неполадок веб-сайта](/ru-ru/develop/net/best-practices/troubleshooting-web-sites/)<br/>
  Введение, в котором основное внимание уделяется веб-сайтам Azure.
* [Включение ведения журналов диагностики для веб-сайтов Azure](/ru-ru/develop/net/common-tasks/diagnostics-logging-and-instrumentation/)<br/>
  Во многом охватывает те же сведения, которые предоставляются в этом учебнике, но больше внимание уделяется получению журналов диагностики без использования Visual Studio. 
* [Как отслеживать веб-сайты](/ru-ru/manage/services/web-sites/how-to-monitor-websites/)<br/>
  Раздел [Настройка диагностики и журналов загрузки](/ru-ru/manage/services/web-sites/how-to-monitor-websites/#howtoconfigdiagnostics) содержит ценные сведения, которые не содержатся в документах по устранению неполадок.

Справочные данные об определенном вопросе, связанном с устранением неполадок, можно получить, начав беседу на одном из следующих форумов:

* [Форум Azure на веб-сайте ASP.NET](http://forums.asp.net/1247.aspx/1?Azure+and+ASP+NET).
* [Форум Azure на портале MSDN](http://social.msdn.microsoft.com/Forums/windowsazure/).
* [StackOverflow.com](http://www.stackoverflow.com).

### Отладка в Visual Studio 

Дополнительные сведения об использовании режима отладки в Visual Studio см. в теме MSDN [Отладка в Visual Studio](http://msdn.microsoft.com/ru-ru/library/vstudio/sc65sadd.aspx) и статье [Рекомендации по отладке в Visual Studio 2010](http://weblogs.asp.net/scottgu/archive/2010/08/18/debugging-tips-with-visual-studio-2010.aspx).

Если на вашем веб-сайте используется веб-интерфейс API Azure или серверная часть мобильных служб, дополнительные сведения об отладке см. в разделе [Отладка серверной части .NET в Visual Studio](http://blogs.msdn.com/b/azuremobile/archive/2014/03/14/debugging-net-backend-in-visual-studio.aspx).


### Трассировка в приложениях ASP.NET

В Интернете отсутствуют обновленные и подробные вводные данные по трассировке ASP.NET. Лучшее, что можно сделать, это начать со старых вводных материалов, написанных для Web Forms, так как тогда MVC еще не существовало. А также дополнить эти сведения новыми постами из блогов, посвященных тем или иным конкретным вопросам. Можно также продуктивно начать изучение со следующих ресурсов:

* [Мониторинг и телеметрия (создание реальных облачных приложений в Azure)](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry).<br> 
  Глава электронной книги с рекомендациями по трассировке в облачных приложениях Azure.
* [Трассировка ASP.NET](http://msdn.microsoft.com/ru-ru/library/ms972204.aspx)<br/>
  Старый, но по-прежнему хороший ресурс для введения в тему.
* [Прослушиватели трассировки](http://msdn.microsoft.com/ru-ru/library/4y5y10s7.aspx)<br/>
  Сведения о прослушивателях трассировки, но без упоминания [WebPageTraceListener](http://msdn.microsoft.com/ru-ru/library/system.web.webpagetracelistener.aspx)
* [Пошаговое руководство: интеграция трассировки ASP.NET с трассировкой System.Diagnostics](http://msdn.microsoft.com/ru-ru/library/b0ectfxd.aspx)<br/>
  Это также старый ресурс, который однако содержит некоторые дополнительные сведения, которые не освещаются во вводной статье.
* [Трассировка в представлениях ASP.NET MVC Razor](http://blogs.msdn.com/b/webdev/archive/2013/07/16/tracing-in-asp-net-mvc-razor-views.aspx)<br/>
  Помимо трассировки в представлениях Razor в этом посте также описывается, как создать фильтр ошибок, чтобы регистрировать все необработанные исключения в приложении MVC. Сведения о записи в журнал всех необработанных исключений в приложении Web Forms см. в примере Global.asax в разделе [Полный пример для обработчиков ошибок](http://msdn.microsoft.com/ru-ru/library/bb397417.aspx) на MSDN. Если в MVC или Web Forms понадобится зарегистрировать определенные исключения, но позволить платформе их обрабатывать, можно перехватить и повторно создать элементы, как показано на следующем примере:

        try
        {
           // Your code that might cause an exception to be thrown.
        }
        catch (Exception ex)
        {
            Trace.TraceError("Exception: " + ex.ToString());
            throw;
        } 

* [Потоковая передача диагностических журналов трассировки из командной строки Azure (включая Glimpse!)](http://www.hanselman.com/blog/StreamingDiagnosticsTraceLoggingFromTheAzureCommandLinePlusGlimpse.aspx)<br/>
  Как использовать командную строку, чтобы сделать все действия этого руководства, выполнение которые показано на примере Visual Studio. [Glimpse](http://www.hanselman.com/blog/IfYoureNotUsingGlimpseWithASPNETForDebuggingAndProfilingYoureMissingOut.aspx) – это средство для отладки приложений ASP.NET. 
* [Использование функций диагностики и ведения журнала для веб-сайта Azure - Дэвид Эббо (David Ebbo)](http://www.windowsazure.com/ru-ru/documentation/videos/azure-web-site-logging-and-diagnostics/) и [Потоковая передача журналов с веб-сайтов Azure - Дэвид Эббо](http://www.windowsazure.com/ru-ru/documentation/videos/log-streaming-with-azure-web-sites/)<br>
  Авторы видео: Скотт Хансельман (Scott Hanselman) и Дэвид Эббо (David Ebbo).

Для ведения журнала ошибок вместо написания своего кода трассировки можно использовать платформу ведения журналов с открытым исходным кодом, например[ELMAH](http://nuget.org/packages/elmah/). Дополнительные сведения см. в [постах блога Скотта Хансельмана (Scott Hanselman), посвященных ELMAH](http://www.hanselman.com/blog/NuGetPackageOfTheWeek7ELMAHErrorLoggingModulesAndHandlersWithSQLServerCompact.aspx).

Обратите внимание, что не нужно использовать трассировку ASP.NET или System.Diagnostics для получения потоковых журналов из Azure. Служба потоковой передачи журналов веб-сайта Azure будет передавать любые файлы с расширением *.txt*, *.html* или *.log*, которые будут найдены в папке *LogFiles*. Поэтому можно создать собственную систему ведения журналов, которая записывает данные в файловую систему или на веб-сайт, а файлы будут автоматически передаваться и загружаться. Все, что нужно сделать, — это написать код приложения, который создает файлы в папке *d:\home\logfiles*. 

###Анализ журналов веб-сервера

Дополнительные сведения об анализе журналов веб-сервера см. на следующих ресурсах:

* [LogParser](http://www.microsoft.com/ru-ru/download/details.aspx?id=24659)<br/>
  Средство, которое предназначено для просмотра данных в журналах веб-сервера (файлы *.log*).
* [Устранение неполадок, связанных с производительностью IIS, или ошибок приложений с помощью LogParser ](http://www.iis.net/learn/troubleshoot/performance-issues/troubleshooting-iis-performance-issues-or-application-errors-using-logparser)<br/>
  Введение в средство LogParser, которое можно использовать для анализа журналов веб-сервера.
* [Посты блога Роберта МакМюррея (Robert McMurray), посвященные использованию LogParser](http://blogs.msdn.com/b/robert_mcmurray/archive/tags/logparser/)<br/>
* [Код состояния HTTP в IIS 7.0, IIS 7.5 и IIS 8.0](http://support.microsoft.com/kb/943891)

### Анализ журналов трассировки неудачно завершенных запросов

Веб-сайт Microsoft TechNet содержит раздел [Использование трассировки неудачно завершенных запросов](http://www.iis.net/learn/troubleshoot/using-failed-request-tracing), который может оказаться полезным для понимания использования этих журналов. Однако эта документация посвящена преимущественно настройке трассировки неудачно завершенных запросов в IIS, которую невозможно выполнить на веб-сайтах Azure.

### Отладка облачных служб

Если вас интересует отладка облачной службы Azure, а не веб-сайта, ознакомьтесь с разделом [Отладка облачных служб](http://msdnstage.redmond.corp.microsoft.com/ru-ru/library/windowsazure/ee405479.aspx).




[GetStarted]: /ru-ru/develop/net/tutorials/get-started/



