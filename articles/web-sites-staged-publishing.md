<properties linkid="web-sites-staged-publishing" urlDisplayName="Создание промежуточных сайтов в Microsoft Azure" pageTitle="Промежуточное развертывание на веб-сайтах Microsoft Azure" metaKeywords="Веб-сайты Microsoft Azure, промежуточная область" description="Узнайте, как использовать промежуточное развертывание на веб-сайтах Microsoft Azure." metaCanonical="" services="web-sites" documentationCenter="" title="Промежуточное развертывание на веб-сайтах Microsoft Azure" authors="timamm"  solutions="" writer="timamm" manager="paulettm" editor="mollybos"  />

#Промежуточное развертывание на веб-сайтах Microsoft Azure#

## Оглавление ##
- [Обзор](#Overview)
- [Добавление области развертывания на веб-узел](#Add)
- [О конфигурации областей развертывания](#AboutConfiguration)
- [Переключение областей развертывания](#Swap)
- [Откат сайта из производственной среды в промежуточную область](#Rollback)
- [Удаление области сайта](#Delete)
- [Командлеты Azure PowerShell для областей сайта](#PowerShell)
- [Команды кросс-платформенного интерфейса командной строки CLI Azure (xplat-cli) для областей сайта](#CLI)

<a name="Overview"></a>
##Обзор##
Возможность создания нескольких областей сайтов в стандартном режиме в среде Microsoft Azure позволяет применять промежуточное развертывание. Создайте развертывание или промежуточную область сайта для каждого производственного сайта по умолчанию (которая становится производственной областью) и переключайтесь между этими областями без возникновения простоев. Промежуточное развертывание имеет неоценимое значение для следующих сценариев:

- **Проверка перед развертыванием** - после развертывания контента или конфигурации в промежуточной области сайта можно проверить изменения до их перевода в производственную область.

- **Создание и интеграция контента сайта** - можно последовательно обновлять контент в промежуточной области сайта, а после завершения обновлений переключаться в производственную область.

- **Откат сайта производственной среды** - если изменения в производственной среде не соответствуют ожиданиям, можно мгновенно переключить производственную среду на исходный контент сайта. 

Переключение областей сайтов Microsoft Azure подготавливает все экземпляры исходной области перед переключением в производственную область, что исключает "холодный" запуск при развертывании контента. Перенаправление трафика не вызывает затруднений, а запросы не теряются в результате операций подкачки. В настоящее время для веб-сайта в режиме "Стандартный" в дополнение к производственной области, используемой по умолчанию, поддерживается только одна область сайта.   

<a name="Add"></a>
##Добавление области развертывания на веб-узел##

Для создания области сайта этот сайт должен работать в режиме "Стандартный".

1. На странице быстрого запуска или в разделе "Сводка" панели мониторинга веб-сайта нажмите кнопку **Добавить новый слот развернутого приложения**. 
	
	![Добавить новый слот развернутого приложения][QGAddNewDeploymentSlot]
	
	> [WACOM.NOTE]
	> Если веб-сайт еще не работает в режиме "Стандартный", появится сообщение **Вы должны находиться в стандартном режиме, чтобы включить промежуточную публикацию**. На этом этапе можно выбрать **Обновить** и перейти на вкладку **Масштаб**, чтобы обновить веб-сайт перед продолжением.
	
2. Откроется диалоговое окно **Добавить новый слот развернутого приложения**.
	
	![Диалоговое окно "Добавить новый слот развернутого приложения"][AddNewDeploymentSlotDialog]
	
	Укажите имя области развертывания. Имя не может содержать более 60 алфавитно-цифровых символов. Использование специальных символов и пробелов запрещено.
	
3. В списке веб-сайтов разверните значок слева от имени веб-сайта, чтобы открыть область развертывания. Именем области будет имя производственного сайта, за которым в скобках указывается введенное вами имя области развертывания. 
	
	![Список сайтов с областью развертывания][SiteListWithStagedSite]
	
4. При выборе имени области развертывания сайта открывается страница с набором вкладок, как и для любого другого веб-сайта. В верхней части страницы портала появится <strong><i>имя-вашего-веб-сайта</i>(<i>имя-области-развертывания</i>)</strong>, напоминая о том, что просматривается область развертывания сайта.
	
	![Название области развертывания][StagingTitle]
	
Теперь можно обновить содержимое и конфигурацию для области развертывания сайта. Для обновлений контента используйте профиль публикации или учетные данные развертывания, связанные с областью развертывания сайта. 

<a name="AboutConfiguration"></a>
##О конфигурации областей развертывания##
При создании области развертывания ее конфигурация клонируется из производственной области сайта по умолчанию. Можно менять настройки всех областей сайта.

**Конфигурация, которая изменяется при переключении сайтов**:

- Общие параметры
- Строки подключения
- Сопоставления обработчиков
- Настройки диагностики и мониторинга

**Конфигурация, которая не изменяется при переключении сайтов**:

- Конечные точки публикации
- Имена пользовательских доменов
- SSL-сертификаты и SSL-привязки
- Параметры масштабирования

**Примечания**

- Области развертывания доступны только для веб-сайтов в стандартном режиме.

- Если изменить режим сайта на "Бесплатный", "В общем доступе" или "Базовый" переключение станет невозможным.

- Область развертывания, которую планируется переключить в производственное состояние, должна быть настроена точно так же, как требуется для производственной среды.

- По умолчанию область развертывания будет указывать на ту же базу данных, что и производственный сайт. Но, изменив строку (строки) подключения для области развертывания, можно настроить область развертывания так, чтобы она указывала на альтернативную базу данных. Затем можно восстановить исходную строку (строки) подключения к базе данных для области развертывания непосредственно перед ее переключением в производственную среду.


<a name="Swap"></a>
##Переключение областей развертывания##

1. Для переключения областей развертывания выберите область развертывания в списке веб-сайтов и нажмите кнопку **Переключить** на панели команд. 
	
	![Кнопка "Переключить"][SwapButtonBar]
	
2. Появится диалоговое окно "Переключить развертывания". Оно позволяет выбрать, какая область сайта должна стать источником и какой сайт должен быть назначением.
	
	![Диалоговое окно "Переключить развертывания"][SwapDeploymentsDialog]
	
3. Щелкните галочку, чтобы выполнить операцию. По завершении операции области сайта поменяются местами.


<a name="Rollback"></a>
##Откат сайта из производственной среды в промежуточную область##
В случае обнаружения ошибок в контенте или в конфигурации производственного сайта можно просто переключить область развертывания сайта (которая ранее была производственной) снова в производственную область и внести требуемые изменения в новую версию сайта в режиме промежуточной публикации. 

> [WACOM.NOTE]
> Для успешного отката контент и конфигурация области развертывания сайта должны совпадать с контентом и конфигурацией предыдущего производственного сайта.

<a name="Delete"></a>
##Удаление области сайта##

На панели команд в нижней части страницы портала веб-сайтов Azure нажмите кнопку **Удалить**. Можно будет выбрать вариант удаления веб-сайта и всех областей развертывания или удалить только область развертывания. 

![Удаление области сайта][DeleteStagingSiteButton]

После выбора варианта **Да** в сообщении подтверждения будут удалены одна или все области сайта, в зависимости от выбранного варианта.

**Примечания**

- Масштабирование для веб-сайтов, не находящихся в производственной среде, недоступно. Эта функция доступна только для сайтов в производственной среде.

- Для сайтов, не находящихся в производственной среде, управление связанными ресурсами недоступно. 

- При необходимости можно публиковать непосредственно в производственную область сайта.

- В данный момент времени области развертывания (сайты) используют те же ресурсы, что и производственные области (сайты), и работают на тех же виртуальных машинах. При запуске нагрузочного тестирования в промежуточной области в рабочей среде будут действовать аналогичные нагрузки. 

<!-- ======== AZURE POWERSHELL CMDLETS =========== -->

<a name="PowerShell"></a>
##Командлеты Azure PowerShell для областей сайта 

Azure PowerShell — это модуль, предоставляющий командлеты для управления Azure, используя Windows PowerShell, включая поддержку управления областями развертывания для веб-сайтов Azure. 

- Сведения об установке и настройке Azure PowerShell и о проверке подлинности для Azure PowerShell с подпиской Windows Azure см. в разделе [Установка и настройка Windows Azure PowerShell](http://www.windowsazure.com/ru-ru/documentation/articles/install-configure-powershell).  

- Чтобы получить список командлетов PowerShell, доступных для веб-сайтов Azure, вызовите `help AzureWebsite`. 

----------

###Get-AzureWebsite
Командлет **Get-AzureWebsite** выводит сведения о веб-сайтах Azure для текущей подписки, как в следующем примере. 

`Get-AzureWebsite siteslotstest`

----------

###New-AzureWebsite
Область сайта для любого веб-сайта в стандартном режиме можно создать с помощью командлета **New-AzureWebsite**, указав имена сайта и области. Кроме того, укажите ту же область, как сайт для создания области развертывания, как в следующем примере. 

`New-AzureWebsite siteslotstest –Slot staging –Location “West US”`

----------

###Publish-AzureWebsiteProject
Для развертывания контента можно использовать командлет **Publish-AzureWebsiteProject**, как в следующем примере. 

`Publish-AzureWebsiteProject -Name siteslotstest -Slot staging -Package [path].zip`

----------

###Show-AzureWebsite
После применения обновлений контента и конфигурации к новой области можно проверить обновления, просмотрев область с помощью командлета **Show-AzureWebsite**, как в следующем примере.

`Show-AzureWebsite -Name siteslotstest -Slot staging`

----------

###Switch-AzureWebsiteSlot
Командлет **Switch-AzureWebsiteSlot** может выполнить операцию переключения, чтобы обновленная область развертывания стала производственным сайтом, как в следующем примере. Производственный сайт при этом не окажется ни в состоянии простоя, ни в состоянии "холодного запуска". 

`Switch-AzureWebsiteSlot -Name siteslotstest`

----------

###Remove-AzureWebsite
Если область развертывания больше не нужна, ее можно удалить с помощью командлета **Remove-AzureWebsite**, как в следующем примере.

`Remove-AzureWebsite -Name siteslotstest -Slot staging` 

----------

<!-- ======== XPLAT-CLI =========== -->

<a name="CLI"></a>
##Команды кросс-платформенного интерфейса командной строки CLI Azure (xplat-cli) для областей сайта

Кросс-платформенный интерфейс командной строки Azure (xplat-cli) предоставляет набор кросс-платформенных команд для работы с платформой Azure, включая поддержку управления областями развертывания для веб-сайтов Azure. 

- Инструкции по установке, настройке и использованию xplat-cli, включая сведения о подключении xplat-cli к подписке Azure, см. в разделе [Установка и настройка кросс-платформенного интерфейса командной строки Azure](http://www.windowsazure.com/ru-ru/documentation/articles/xplat-cli). 

-  Чтобы получить список командлетов xplat-cli, доступных для веб-сайтов Azure, вызовите `azure site -h`. 

----------
###azure site list
Для получения сведений о веб-сайтах Azure в текущей подписке вызовите **azure site list**, как в следующем примере.
 
`azure site list siteslotstest`

----------
###azure site create
Чтобы создать область сайта для любого веб-сайта в стандартном режиме, вызовите **azure site create** и укажите имя существующего веб-сайта и имя создаваемой области, как показано в следующем примере.

`azure site create siteslotstest --slot staging`

Чтобы включить управление версиями для новой области, используйте параметр **--git**, как показано в следующем примере.
 
`azure site create â€“-git siteslotstest --slot staging`

----------
###azure site swap
Чтобы сделать обновленную область развертывания производственным сайтом, используйте для переключения команду **azure site swap**, как показано в следующем примере. Производственный сайт при этом не окажется ни в состоянии простоя, ни в состоянии "холодного запуска". 

`azure site swap siteslotstest`

----------
###azure site delete
Чтобы удалить область развертывания, которая больше не нужна, используйте команду **azure site delete**, как в следующем примере.

`azure site delete siteslotstest --slot staging`

----------


<!-- IMAGES -->
[QGAddNewDeploymentSlot]:  ./media/web-sites-staged-publishing/QGAddNewDeploymentSlot.png
[AddNewDeploymentSlotDialog]: ./media/web-sites-staged-publishing/AddNewDeploymentSlotDialog.png
[SiteListWithStagedSite]: ./media/web-sites-staged-publishing/SiteListWithStagedSite.png
[StagingTitle]: ./media/web-sites-staged-publishing/StagingTitle.png
[SwapButtonBar]: ./media/web-sites-staged-publishing/SwapButtonBar.png
[SwapConfirmationDialog]:  ./media/web-sites-staged-publishing/SwapConfirmationDialog.png
[DeleteStagingSiteButton]: ./media/web-sites-staged-publishing/DeleteStagingSiteButton.png
[SwapDeploymentsDialog]: ./media/web-sites-staged-publishing/SwapDeploymentsDialog.png

