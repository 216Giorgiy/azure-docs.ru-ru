<properties urlDisplayName="How to stage sites on Microsoft Azure" pageTitle="Промежуточное развертывание на веб-сайтах Microsoft Azure" metaKeywords="Веб-сайты Microsoft Azure, промежуточное развертывание, области для сайтов" description="Узнайте, как использовать поэтапную публикацию на веб-сайтах Microsoft Azure." metaCanonical="" services="web-sites" documentationCenter="" title="Staged Deployment on Microsoft Azure Websites" authors="cephalin"  solutions="" writer="cephalin" manager="wpickett" editor="mollybos"  />

<tags ms.service="web-sites" ms.workload="web" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="9/9/2014" ms.author="cephalin" />

<a name="Overview"></a>
#Промежуточное развертывание на веб-сайтах Microsoft Azure#
При развертывании приложения на веб-сайтах Azure вы можете развернуть отдельную область развертывания вместо производственной области по умолчанию, которой фактически являются действующие сайты с собственными именами узлов. Эта возможность доступна в плане размещения веб-сайтов **Стандартный**. Более того, вы можете переключать сайты и конфигурации сайтов между двумя областями развертывания, включая производственную область. Развертывание приложения в области развертывания дает следующие преимущества.

- Вы можете проверять изменения веб-сайта в промежуточной области развертывания, прежде чем переключиться в производственную область.

- После переключения в области с ранее созданным промежуточным сайтом теперь находится предыдущий производственный сайт. Если изменения в производственной области не соответствуют вашим ожиданиям, вы можете мгновенно переключиться назад к своему "последнему удачному сайту". 
 
- Развертывание сайта в промежуточной области и его последующий перевод в производственную область обеспечивает подготовку всех экземпляров области перед их переключением в рабочую среду. Это позволит вам избежать простоя при развертывании своего сайта. Перенаправление трафика не вызывает затруднений, а запросы не теряются в результате операций подкачки. 

В дополнение к производственной области для каждого веб-сайта в плане **Стандартный** поддерживается еще четыре области развертывания. 

## Оглавление ##
- [Добавление области развертывания на веб-узел](#Add)
- [О конфигурации областей развертывания](#AboutConfiguration)
- [Переключение областей развертывания](#Swap)
- [Откат сайта из производственной среды в промежуточную область](#Rollback)
- [Удаление области сайта](#Delete)
- [Командлеты Azure PowerShell для областей сайта](#PowerShell)
- [Команды кросс-платформенного интерфейса командной строки CLI Azure (xplat-cli) для областей сайта](#CLI)

<a name="Add"></a>
##Добавление области развертывания на веб-сайт##

Чтобы включить возможность использования нескольких областей развертывания, веб-сайт должен быть запущен в плане размещения **Стандартный**. 

1. На странице быстрого запуска или в разделе "Сводка" панели мониторинга веб-сайта щелкните **Добавить новую область развертывания**. 
	
	![Add a new deployment slot][QGAddNewDeploymentSlot]
	
	> [WACOM.NOTE]
	Если веб-сайт еще не работает в режиме **Стандартный**, появится сообщение **Вы должны находиться в стандартном режиме, чтобы включить промежуточную публикацию.**. На этом этапе вы можете выбрать **Обновить** и перейти на вкладку **Масштаб**, чтобы обновить веб-сайт перед продолжением.
	
2. В диалоговом окне **Добавить новую область развертывания** введите имя области и укажите, копировать ли конфигурацию веб-сайта из другой существующей области развертывания. Установите флажок для продолжения. 
	
	![Configuration Source][ConfigurationSource1]
	
	При первом создании области у вас будет только два варианта на выбор: клонировать конфигурацию из производственной области по умолчанию или совсем не копировать. 
	
	После создания нескольких областей у вас уже будет выбор для копирования конфигураций помимо производственной области:
	
	![Configuration sources][MultipleConfigurationSources]

5. В списке веб-сайтов разверните значок слева от имени веб-сайта, чтобы открыть область развертывания. За именем веб-сайта будет указано имя области развертывания. 
	
	![Site List with Deployment Slot][SiteListWithStagedSite]
	
4. Если щелкнуть по имени области развертывания сайта, откроется страница с набором вкладок, как и для любого другого веб-сайта. В верхней части страницы портала будет отображаться <strong><i>имя-вашего-веб-сайта</i>(<i>имя-области-развертывания</i>)</strong>, напоминая о том, что вы просматриваете область развертывания сайта.
	
	![Deployment Slot Title][StagingTitle]
	
5. В представлении панели мониторинга щелкните URL-адрес сайта. Обратите внимание, что область развертывания имеет собственное имя узла, а также является действующим сайтом. Чтобы ограничить общий доступ к области развертывания, см. раздел [Веб-сайты Azure: блокирование веб-доступа к непроизводственным областям развертывания](http://ruslany.net/2014/04/azure-web-sites-block-web-access-to-non-production-deployment-slots/).

	-	 

Содержимое отсутствует. Вы можете выполнить развертывание в область из другой ветви репозитория или вообще из другого репозитория. Вы также можете изменить конфигурацию области. Для обновлений содержимого используйте профиль публикации или учетные данные развертывания, связанные с областью развертывания.  Например, можно выполнить [публикацию в эту область с помощью Git](http://azure.microsoft.com/ru-ru/documentation/articles/web-sites-publish-source-control/).

<a name="AboutConfiguration"></a>
##О конфигурации областей развертывания##
При клонировании конфигурации из другой области развертывания вы можете изменять клонированную конфигурацию. Ниже приведена конфигурация, которая изменится при переключении сайтов.

**Конфигурация, которая изменяется при переключении сайтов**.

- Общие параметры
- Строки подключения
- Сопоставления обработчиков
- Настройки диагностики и мониторинга

**Конфигурация, которая не изменяется при переключении сайтов**.

- Конечные точки публикации
- Имена пользовательских доменов
- SSL-сертификаты и SSL-привязки
- Параметры масштабирования

**Примечания**

- Возможность использования нескольких областей развертывания доступна только для веб-сайтов в плане размещения **Стандартный**.

- Если ваш сайт имеет несколько областей развертывания, то смена плана размещения недоступна.

- Область, которую вы планируете переключить в производственное состояние, необходимо настроить точно так же, как требуется для рабочей среды.

- По умолчанию область развертывания будет указывать на ту же базу данных, что и производственный сайт. Но, изменив строку (строки) подключения для области развертывания, можно настроить область развертывания так, чтобы она указывала на альтернативную базу данных. Затем можно восстановить исходную строку (строки) подключения к базе данных для области развертывания непосредственно перед ее переключением в производственную среду.


<a name="Swap"></a>
##Переключение областей развертывания##

1. Чтобы переключить области развертывания, выберите область развертывания в списке веб-сайтов, которую хотите переключить, и нажмите кнопку **Переключить** на панели команд. 
	
	![Swap Button][SwapButtonBar]
	
2. Появится диалоговое окно "Переключить развертывания". Оно позволяет выбрать, какая область сайта должна стать источником и какой сайт должен быть назначением.
	
	![Swap Deployments Dialog][SwapDeploymentsDialog]
	
3. Щелкните флажок, чтобы выполнить операцию. По завершении операции области сайта поменяются местами.


<a name="Rollback"></a>
##Откат сайта из производственной среды в промежуточную область##
В случае обнаружения ошибок в производственной области вы можете выполнить откат сайтов до состояния, предшествующего их переключению, выполнив мгновенное обратное переключение тех же двух областей. 

<a name="Delete"></a>
##Удаление области сайта##

На панели команд в нижней части страницы портала веб-сайтов Azure нажмите кнопку **Удалить**. У вас будет возможность выбрать вариант удаления веб-сайта и всех областей развертывания или удалить только область развертывания. 

![Delete a Site Slot][DeleteStagingSiteButton]

**Примечания**

- Масштабирование для веб-сайтов, не находящихся в производственной области, недоступно. Эта функция доступна только для производственных областей.

- Для непроизводственных областей управление связанными ресурсами недоступно. 

- При необходимости вы можете публиковать непосредственно в производственную область.

- По умолчанию области развертывания (сайты) используют те же ресурсы, что и производственные области (сайты), и работают на тех же виртуальных машинах. При запуске нагрузочного тестирования в промежуточной области в рабочей среде будут действовать аналогичные нагрузки. 
	
	> [WACOM.NOTE] Только на [портале предварительной версии Azure](https://portal.azure.com) можно избежать потенциального воздействия на производственную область, временно переведя непроизводственную область на другой план размещения веб-сайтов. Обратите внимание, что для последующего переключения из тестовой области в производственную вам нужно снова объединить эти две области в одном плане размещения веб-сайтов.

<!-- ======== AZURE POWERSHELL CMDLETS =========== -->

<a name="PowerShell"></a>
##Командлеты Azure PowerShell для областей сайта 

Azure PowerShell - это модуль, предоставляющий командлеты для управления Azure с помощью Windows PowerShell, включая поддержку управления областями развертывания для веб-сайтов Azure. 

- Сведения об установке и настройке Azure PowerShell и о проверке подлинности для Azure PowerShell с подпиской Windows Azure см. в разделе [Установка и настройка Windows Azure PowerShell](http://www.windowsazure.com/ru-ru/documentation/articles/install-configure-powershell).  

- Чтобы получить список командлетов PowerShell, доступных для веб-сайтов Azure, вызовите команду "help AzureWebsite". 

----------

###Get-AzureWebsite
Командлет **Get-AzureWebsite** выводит информацию о веб-сайтах Azure для текущей подписки, как в следующем примере. 

"Get-AzureWebsite siteslotstest"

----------

###New-AzureWebsite
Можно создать область сайта для любого веб-сайта в стандартном режиме с помощью командлета **New-AzureWebsite**, указав имена сайта и области. Кроме того, укажите ту же область, как сайт для создания области развертывания, как в следующем примере. 

New-AzureWebsite siteslotstest -Slot staging -Location "West US"

----------

###Publish-AzureWebsiteProject
Для развертывания контента можно использовать командлет **Publish-AzureWebsiteProject**, как в следующем примере. 

"Publish-AzureWebsiteProject -Name siteslotstest -Slot staging -Package [path].zip"

----------

###Show-AzureWebsite
После применения обновлений контента и конфигурации к новой области можно проверить обновления, просмотрев область с помощью командлета **Show-AzureWebsite**, как в следующем примере.

"Show-AzureWebsite -Name siteslotstest -Slot staging"

----------

###Switch-AzureWebsiteSlot
Командлет **Switch-AzureWebsiteSlot** может выполнить операцию переключения, чтобы обновленная область развертывания стала производственным сайтом, как в следующем примере. Производственный сайт при этом не окажется ни в состоянии простоя, ни в состоянии "холодного запуска". 

"Switch-AzureWebsiteSlot -Name siteslotstest"

----------

###Remove-AzureWebsite
Если область развертывания больше не нужна, ее можно удалить с помощью командлета **Remove-AzureWebsite**, как в следующем примере.

"Remove-AzureWebsite -Name siteslotstest -Slot staging" 

----------

<!-- ======== XPLAT-CLI =========== -->

<a name="CLI"></a>
##Команды кросс-платформенного интерфейса командной строки CLI Azure (xplat-cli) для областей сайта

Межплатформенный интерфейс командной строки Azure (xplat-cli) предоставляет набор межплатформенных команд для работы с платформой Azure, включая поддержку управления областями развертывания для веб-сайтов Azure. 

- Инструкции по установке, настройке и использованию xplat-cli, включая сведения о подключении xplat-cli к подписке Azure, см. в разделе [Установка и настройка кросс-платформенного интерфейса командной строки Azure](http://www.windowsazure.com/ru-ru/documentation/articles/xplat-cli). 

-  Чтобы получить список команд xplat-cli, доступных для веб-сайтов Azure, вызовите команду "azure site -h". 

----------
###azure site list
Чтобы получить информацию о веб-сайтах Azure в текущей подписке, вызовите команду **azure site list**, как в примере ниже.
 
"azure site list siteslotstest"

----------
###azure site create
Чтобы создать область сайта для любого веб-сайта в стандартном режиме, вызовите команду **azure site create** и укажите имя существующего сайта, а также имя области, которую необходимо создать, как в следующем примере.

"azure site create siteslotstest --slot staging"

Чтобы включить систему управления версиями для новой области, используйте параметр **--git**, как показано в следующем примере.
 
"azure site create --git siteslotstest --slot staging"

----------
###azure site swap
Чтобы сделать обновленную область развертывания производственным сайтом, используйте для переключения команду **azure site swap**, как показано в следующем примере. Производственный сайт при этом не окажется ни в состоянии простоя, ни в состоянии "холодного запуска". 

"azure site swap siteslotstest"

----------
###azure site delete
Чтобы удалить область развертывания, которая больше не нужна, используйте команду **azure site delete**, как в следующем примере.

"azure site delete siteslotstest --slot staging"

----------
## Дальнейшие действия ##
[Веб-сайты Azure: блокирование веб-доступа к непроизводственным областям развертывания](http://ruslany.net/2014/04/azure-web-sites-block-web-access-to-non-production-deployment-slots/)

[Бесплатная пробная версия Microsoft Azure](http://azure.microsoft.com/ru-ru/pricing/free-trial/)


<!-- IMAGES -->
[QGAddNewDeploymentSlot]:  ./media/web-sites-staged-publishing/QGAddNewDeploymentSlot.png
[AddNewDeploymentSlotDialog]: ./media/web-sites-staged-publishing/AddNewDeploymentSlotDialog.png
[ConfigurationSource1]: ./media/web-sites-staged-publishing/ConfigurationSource1.png
[MultipleConfigurationSources]: ./media/web-sites-staged-publishing/MultipleConfigurationSources.png
[SiteListWithStagedSite]: ./media/web-sites-staged-publishing/SiteListWithStagedSite.png
[StagingTitle]: ./media/web-sites-staged-publishing/StagingTitle.png
[SwapButtonBar]: ./media/web-sites-staged-publishing/SwapButtonBar.png
[SwapConfirmationDialog]:  ./media/web-sites-staged-publishing/SwapConfirmationDialog.png
[DeleteStagingSiteButton]: ./media/web-sites-staged-publishing/DeleteStagingSiteButton.png
[SwapDeploymentsDialog]: ./media/web-sites-staged-publishing/SwapDeploymentsDialog.png
