---
title: "Веб-служба мобильного приложения сервера Azure MFA | Документация Майкрософт"
description: "Приложение Microsoft Authenticator предлагает возможность дополнительной внешней аутентификации.  Это позволяет серверу Azure Multi-Factor Authentication отправлять push-уведомления пользователям."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 6c8d6fcc-70f4-4da4-9610-c76d66635b8b
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/15/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: H1Hack27Feb2017,it-pro
ms.translationtype: Human Translation
ms.sourcegitcommit: 20afeb3ba290ddf728d2b52c076c7a57fadc77c6
ms.openlocfilehash: 4014bf0217e25ea9bc8473ef2383279e5eb79b87
ms.contentlocale: ru-ru
ms.lasthandoff: 02/28/2017

---
# <a name="enable-mobile-app-authentication-with-azure-multi-factor-authentication-server"></a>Включение аутентификации мобильных приложений с помощью сервера Многофакторной идентификации Azure

Приложение Microsoft Authenticator предлагает возможность дополнительной внешней проверки. Вместо автоматического телефонного вызова или отправки SMS пользователю при входе в систему служба Многофакторной идентификации Azure отправляет push-уведомление в приложение Microsoft Authenticator, которое установлено на смартфоне или планшете пользователя. Чтобы выполнить вход, пользователю в приложении нужно просто коснуться элемента **Проверить** (или ввести ПИН-код и коснуться элемента "Проверить подлинность").

Использование мобильного приложения для двухфакторной проверки используется является предпочтительным, когда телефонная связь ненадежна. При использовании такого приложения, как генератор OATH-токенов, не требуется подключение к сети или Интернету.

Чтобы установить пользовательский портал на сервере, отличном от сервера Многофакторной идентификации Azure, нужно выполнить следующее.

1. Установить пакет SDK веб-службы.
2. Установить веб-службу мобильного приложения.
3. Настроить параметры мобильного приложения на сервере Azure Multi-Factor Authentication.
4. Активация приложения Microsoft Authenticator для пользователей

## <a name="requirements"></a>Требования

Чтобы использовать приложение Microsoft Authenticator и чтобы оно успешно взаимодействовало с веб-службой мобильного приложения, необходимо выполнить следующие условия.

* Требуется использовать сервер Многофакторной идентификации Azure&6;.0 или более поздней версии.
* Необходимо установить веб-службу мобильного приложения на веб-сервере с выходом в Интернет, на котором выполняются службы Microsoft® [Internet Information Services (IIS) 7.x или более поздней версией](http://www.iis.net/).
* Необходимо установить и зарегистрировать компонент ASP.NET&4;.0.30319, а также установить для него значение "Разрешено".
* К обязательным службам роли относятся ASP.NET и совместимость с метабазой IIS 6.
* Веб-служба мобильного приложения должна быть доступна через общедоступный URL-адрес.
* Веб-служба мобильного приложения должна быть защищена сертификатом SSL.
* Требуется установить пакет SDK веб-службы для Многофакторной идентификации Azure в IIS 7.x или более поздней версии на том же сервере, на котором установлен сервер Многофакторной идентификации Azure.
* Безопасность пакета SDK веб-службы для Многофакторной идентификации Azure должен обеспечивать сертификат SSL.
* Веб-служба мобильного приложения должна иметь возможность подключиться к пакету SDK веб-службы для Многофакторной идентификации Azure по протоколу SSL.
* Веб-служба мобильного приложения должна иметь возможность пройти аутентификацию для пакета SDK веб-службы для Многофакторной идентификации Azure с использованием данных учетной записи службы, которая входит в группу безопасности PhoneFactor Admins. Эта учетная запись службы и группа существуют в Active Directory, если сервер Многофакторной идентификации Azure установлен на сервере, присоединенном к домену. Эта учетная запись службы и группа существуют локально на сервере Azure Multi-Factor Authentication, если он не присоединен к домену.


## <a name="install-the-web-service-sdk"></a>Установить пакет SDK веб-службы.
Если пакет SDK веб-службы для Многофакторной идентификации Azure еще не установлен на сервере Многофакторной идентификации Azure (MFA), перейдите на этот сервер и откройте сервер Azure MFA.

1. Щелкните значок пакета SDK веб-службы.
2. Щелкните **Установить SDK веб-службы** и следуйте отображаемым инструкциям.

Пакет SDK веб-службы должен быть защищен сертификатом SSL. Для этой цели подходит самозаверяющий сертификат. Импортируйте сертификат в хранилище "Доверенные корневые центры сертификации" учетной записи локального компьютера на веб-сервере пользовательского портала, чтобы этот сертификат был доверенным при открытии подключения SSL.

![Настройка](./media/multi-factor-authentication-get-started-server-webservice/sdk.png)

## <a name="install-the-mobile-app-web-service"></a>Установить веб-службу мобильного приложения.
Перед установкой веб-службы мобильного приложения необходимо учитывать следующее.

* Если пользовательский портал Azure MFA уже установлен на сервере с выходом в Интернет, то имя пользователя, пароль и URL-адрес пакета SDK веб-службы можно скопировать из файла web.config на пользовательском портале.
* Рекомендуется открыть веб-браузер на веб-сервере с выходом в Интернет и перейти по URL-адресу пакета SDK веб-службы, указанному в файле web.config. Если веб-служба успешно откроется в браузере, у вас будут запрошены учетные данные для входа. Введите имя пользователя и пароль, которые были введены в файл web.config, в точности так, как они отображены в файле. Убедитесь, что не отображаются предупреждения или ошибки сертификата.
* Если обратный прокси-сервер или брандмауэр размещен перед веб-сервером веб-службы мобильного приложения и выполняет разгрузку SSL, то вы можете изменить файл web.config веб-службы мобильного приложения, чтобы веб-служба мобильного приложения могла использовать протокол HTTP вместо HTTPS. Для подключения мобильного приложения брандмауэру или обратному прокси-серверу по-прежнему требуется протокол SSL. Добавьте приведенный ключ в раздел \<appSettings\>.

        <add key="SSL_REQUIRED" value="false"/>

### <a name="install-the-service"></a>Установка службы

1. Откройте проводник на сервере Многофакторной идентификации Azure и перейдите в папку установки сервера Azure MFA (например, C:\Program Files\Azure Multi-Factor Authentication). Выберите 32- или 64-разрядную версию файла установки Многофакторной идентификации (Azure Multi-Factor AuthenticationMobileAppWebServiceSetup). Скопируйте файл установки на сервер с выходом в Интернет.

2. На веб-сервере с выходом в Интернет запустите файл установки с правами администратора. Откройте командную строку от имени администратора и перейдите в расположение, куда был скопирован файл установки.

3. Запустите файл установки Multi-Factor AuthenticationMobileAppWebServiceSetup и при необходимости измените сайт и замените имя виртуального каталога коротким именем, например PA.

  Рекомендуется использовать короткое имя виртуального каталога, так как пользователи должны вводить URL-адрес веб-службы мобильного приложения в мобильное устройство во время активации.

4. После завершения установки файла Azure Multi-Factor AuthenticationMobileAppWebServiceSetup перейдите в расположение C:\inetpub\wwwroot\PA (или в соответствующий каталог на основе имени виртуального каталога) и измените файл web.config.

5. Найдите ключи WEB_SERVICE_SDK_AUTHENTICATION_USERNAME и WEB_SERVICE_SDK_AUTHENTICATION_PASSWORD. Укажите значения для имени пользователя и пароля учетной записи, которая является участником группы безопасности PhoneFactor Admins. Это может быть та же учетная запись, которая используется как удостоверение на пользовательском портале Azure Multi-Factor Authentication (если этот портал был установлен заранее). Обязательно поместите имя пользователя и пароль в кавычки в конце строки (значение = "" / >). Используйте полное имя пользователя (например, домен\имя_пользователя или компьютер\имя_пользователя).  

6. Найдите параметр pfMobile App Web service_pfwssdk_pfwssdk. Измените его значение, указав вместо ссылки *http://localhost:4898/PfWsSdk.asmx* URL-адрес пакета SDK веб-службы, который выполняется на сервере Многофакторной идентификации Azure (например, https://computer1.domain.local/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx).

  Так как для этого подключения используется протокол SSL, в ссылке на пакет SDK веб-службы нужно указать имя сервера, а не IP-адрес. SSL-сертификат выдается для имени сервера, и используемый URL-адрес должен соответствовать имени в сертификате. Имя сервера может не быть связано с IP-адресом на сервере с выходом в Интернет. В этом случае добавьте запись в файл hosts на этом сервере, чтобы сопоставить имя сервера Многофакторной идентификации Azure и его IP-адрес. Сохраните файл web.config после внесения изменений.

7. Если веб-сайт, на котором установлена веб-служба мобильного приложения, еще не привязан к публично подписанному сертификату, установите сертификат на сервере, затем откройте диспетчер IIS и привяжите сертификат к этому веб-сайту.

8. Откройте веб-браузер на любом компьютере и перейдите по URL-адресу установки веб-службы мобильного приложения (например, https://www.publicwebsite.com/PA). Убедитесь, что не отображаются предупреждения или ошибки сертификата.

### <a name="configure-the-mobile-app-settings-in-the-azure-multi-factor-authentication-server"></a>Настроить параметры мобильного приложения на сервере Azure Multi-Factor Authentication.
Теперь, когда веб-служба мобильного приложения установлена, необходимо настроить сервер Azure Multi-Factor Authentication для работы с порталом.

1. На сервере Azure MFA щелкните значок пользовательского портала. Если пользователям разрешено управлять своими методами аутентификации, на вкладке "Параметры" в группе **Разрешить пользователям выбирать метод** установите флажок **Мобильное приложение**. Если не включить эту функцию, конечным пользователям придется обращаться в вашу службу поддержки для завершения активации мобильного приложения.
2. Установите флажок **Разрешить пользователям активировать мобильное приложение**.
3. Установите флажок **Разрешить регистрацию пользователей**.
4. Щелкните значок мобильного приложения.
5. Введите URL-адрес, который используется с виртуальным каталогом, созданным при установке файла Azure Multi-Factor AuthenticationMobileAppWebServiceSetup. В соответствующем поле можно ввести имя учетной записи. Это название организации будет отображаться в мобильном приложении. Если оставить это поле пустым, в нем будет отображаться имя поставщика Многофакторной идентификации, созданного на классическом портале Azure.

<center>![Настройка](./media/multi-factor-authentication-get-started-server-webservice/mobile.png)</center>

