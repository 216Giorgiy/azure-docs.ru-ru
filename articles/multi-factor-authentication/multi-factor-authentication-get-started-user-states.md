---
title: "Состояние пользователей в службе Многофакторной идентификации Azure Microsoft Azure"
description: "Сведения о состоянии пользователей в Azure MFA."
services: multi-factor-authentication
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
ms.assetid: 0b9fde23-2d36-45b3-950d-f88624a68fbd
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/26/2017
ms.author: joflore
ms.reviewer: richagi
ms.custom: it-pro
ms.openlocfilehash: 6a0f8cb76684a6efcc5e2d4be05493f18d5d4c76
ms.sourcegitcommit: 9a61faf3463003375a53279e3adce241b5700879
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2017
---
# <a name="how-to-require-two-step-verification-for-a-user-or-group"></a>Как настроить требование двухфакторной проверки подлинности пользователя или группы

Существует два подхода, с помощью которых можно требовать двухфакторную проверку подлинности. Первый способ — включить Многофакторную идентификацию Azure (MFA) для каждого отдельного пользователя. В этом случае пользователи всегда выполняют двухфакторную проверку подлинности (за некоторыми исключениями, например, если они входят с доверенных IP-адресов или если включена функция запоминания устройств). Второй способ — настроить политику условного доступа, которая требует прохождения двухфакторной проверки подлинности при определенных условиях.

>[!TIP] 
>Выберите один из этих методов, чтобы требовать прохождения двухфакторной проверки подлинности, но не оба. Включение Azure MFA для пользователя переопределяет любые политики условного доступа.

## <a name="which-option-is-right-for-you"></a>Какой способ подходит для вас

**Включение Azure MFA путем изменения состояния пользователя** — традиционный подход к применению двухфакторной проверки подлинности. Он подходит и для Azure MFA в облаке, и для сервера Azure MFA. Все пользователи, для которых включена такая аутентификация, проходят одинаковую процедуру, выполняя двухфакторную проверку подлинности при каждом входе. Включение такой аутентификации для пользователя переопределяет любые политики условного доступа, которые могут действовать для него. 

**Включение Azure MFA с политикой условного доступа** — более гибкий подход к применению двухфакторной проверки подлинности. Он подходит только для Azure MFA в облаке, и условный доступ — [платная функция Azure Active Directory](https://www.microsoft.com/cloud-platform/azure-active-directory-features). Можно создать политики условного доступа, применяемые как к группам, так и к отдельным пользователям. Для групп с высоким риском можно задать больше ограничений, чем для групп с низким риском. Или вы можете сделать двухфакторную проверку подлинности обязательной только для облачных приложений с высоким риском, пропуская ее для приложений с низким риском. 

В обоих случаях при первом входе пользователей после включения обязательной проверки подлинности им предлагается зарегистрироваться в службе Многофакторной идентификации Azure. Оба варианта также позволяют настроить [параметры Многофакторной идентификации Azure](multi-factor-authentication-whats-next.md).

## <a name="enable-azure-mfa-by-changing-user-status"></a>Включение Azure MFA путем изменения состояния пользователя

Учетные записи пользователей в службе Многофакторной идентификации Azure имеют три различных состояния:

| Состояние | Описание | Затронутые приложения, не использующие браузер |
|:---:|:---:|:---:|
| Отключено |Состояние по умолчанию для нового пользователя, не указанного в службе Многофакторной идентификации Azure (MFA). |Нет |
| Включено |Пользователь указан в Azure MFA, но не зарегистрирован. Ему будет предложено зарегистрироваться при следующем входе в систему. |Нет.  Они будут продолжать работать, пока не завершится регистрация. |
| Принудительно |Пользователь указан и зарегистрирован для использования Azure MFA. |Да.  Для приложений нужны пароли приложений. |

Состояние пользователя отражает, указал ли администратор его в Azure MFA и завершил ли пользователь процесс регистрации.

Все пользователи начинают с состояния *Отключено*. При указании пользователей в Azure MFA их состояние меняется на *Включено*. После включения пользователи входят в систему и завершают процесс регистрации, затем их состояние меняется на *Применено*.  

### <a name="view-the-status-for-a-user"></a>Просмотр состояния пользователя

Чтобы открыть страницу, на которой можно просмотреть состояние пользователей и управлять им, выполните следующее.

1. Войдите на [портал Azure](https://portal.azure.com) с использованием учетной записи администратора.
2. Последовательно выберите **Azure Active Directory** > **Пользователи и группы** > **Все пользователи**.
3. Выберите **Многофакторная идентификация**.
   ![Выберите Многофакторную идентификации](./media/multi-factor-authentication-get-started-user-states/selectmfa.png)
4. Откроется новая страница, отображающая состояние пользователя.
   ![Состояние пользователя Многофакторной идентификации (снимок экрана)](./media/multi-factor-authentication-get-started-user-states/userstate1.png)

### <a name="change-the-status-for-a-user"></a>Изменение состояния пользователя

1. Используйте описанные выше шаги, чтобы перейти на страницу пользователей Многофакторной идентификации.
2. Найдите пользователя, для которого требуется включить Azure MFA. Возможно, потребуется изменить представление в верхней части страницы. 
   ![Поиск пользователя (снимок экрана)](./media/multi-factor-authentication-get-started-cloud/enable1.png)
3. Установите флажок рядом с именем пользователя.
4. Справа, в разделе быстрых действий, щелкните **Включить** или **Отключить**.
   ![Включение MFA для выбранного пользователя (снимок экрана)](./media/multi-factor-authentication-get-started-cloud/user1.png)

   >[!TIP]
   >*Включенные* пользователи автоматически перейдут в состояние *Применено* при регистрации в службе Azure MFA. Не следует вручную изменять состояние пользователя на "Применено". 

5. Подтвердите свой выбор во всплывающем окне, которое откроется. 

После включения рекомендуется уведомить пользователей по электронной почте. Сообщите, что им будет предложено зарегистрироваться при следующем входе. Кроме того, если ваша организация использует небраузерные приложения, не поддерживающие современную аутентификацию, потребуется создать пароли приложений. Можно также добавить ссылку на наше [руководство для пользователей Azure MFA](./end-user/multi-factor-authentication-end-user.md), чтобы им было проще приступить к работе.

### <a name="use-powershell"></a>Использование PowerShell
Чтобы изменить значение состояния пользователя с помощью [Azure AD PowerShell](/powershell/azure/overview), измените `$st.State`. Существуют три возможных состояния:

* Включено
* Принудительно
* Отключено  

Не переводите пользователей непосредственно в состояние *Применено*. Приложения, не использующие браузер, перестанут работать, так как пользователь не прошел регистрацию многофакторной идентификации и не получил [пароль приложения](multi-factor-authentication-whats-next.md#app-passwords). 

PowerShell — удобный инструмент для массового включения пользователей. Создайте сценарий PowerShell, который обходит список пользователей и включает их.

        $st = New-Object -TypeName Microsoft.Online.Administration.StrongAuthenticationRequirement
        $st.RelyingParty = "*"
        $st.State = “Enabled”
        $sta = @($st)
        Set-MsolUser -UserPrincipalName bsimon@contoso.com -StrongAuthenticationRequirements $sta

Пример:

    $users = "bsimon@contoso.com","jsmith@contoso.com","ljacobson@contoso.com"
    foreach ($user in $users)
    {
        $st = New-Object -TypeName Microsoft.Online.Administration.StrongAuthenticationRequirement
        $st.RelyingParty = "*"
        $st.State = “Enabled”
        $sta = @($st)
        Set-MsolUser -UserPrincipalName $user -StrongAuthenticationRequirements $sta
    }

## <a name="enable-azure-mfa-with-a-conditional-access-policy"></a>Включение Azure MFA с политикой условного доступа

Условный доступ является платной функцией Azure Active Directory, предлагающей множество вариантов конфигурации. Ниже описан один из способов создания политики. Дополнительные сведения см. в разделе [Условный доступ в Azure Active Directory](../active-directory/active-directory-conditional-access-azure-portal.md).

1. Войдите на [портал Azure](https://portal.azure.com) с использованием учетной записи администратора.
2. Выберите **Azure Active Directory** > **Условный доступ**.
3. Выберите **Новая политика**.
4. В разделе **Назначения** выберите **Пользователи и группы**. На вкладках **Включить** и **Исключить** укажите, какими пользователями и группами будет управлять политика.
5. В разделе **Назначения** выберите **Облачные приложения**. Выберите параметр **Все облачные приложения**, чтобы включить все облачные приложения.
6. В разделе **Элементы управления доступом** выберите **Предоставление**. Выберите **Требовать многофакторную проверку подлинности**.
7. Задайте для параметра **Включить политику** значение **Вкл.**, а затем щелкните **Сохранить**.

Другие параметры в политике условного доступа позволяют точно указать, когда требуется применять двухфакторную проверку подлинности. Например, можно создать политику для следующей ситуации: когда подрядчики пытаются обратиться к нашему приложению для закупок из ненадежных сетей на устройствах, не присоединенных к домену, им требуется пройти двухфакторную проверку подлинности. 

## <a name="next-steps"></a>Дальнейшие действия

- Получите советы в разделе [Рекомендации по работе с условным доступом в Azure Active Directory](../active-directory/active-directory-conditional-access-best-practices.md).

- Управляйте параметрами Многофакторной идентификации для [пользователей и их устройств](multi-factor-authentication-manage-users-and-devices.md).