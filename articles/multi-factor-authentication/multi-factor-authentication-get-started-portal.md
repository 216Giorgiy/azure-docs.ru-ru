<properties 
	pageTitle="Развертывание пользовательского портала для сервера Azure Multi-Factor Authentication" 
	description="Эта страница посвящена службе Azure Multi-Factor Authentication. Она содержит сведения по началу работы с Azure Multi-Factor Authentication и пользовательским порталом." 
	services="multi-factor-authentication" 
	documentationCenter="" 
	authors="billmath" 
	manager="terrylan" 
	editor="bryanla"/>

<tags 
	ms.service="multi-factor-authentication" 
	ms.workload="identity" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="06/02/2015" 
	ms.author="billmath"/>

# Развертывание пользовательского портала для сервера Azure Multi-Factor Authentication

С помощью пользовательского портала администратор может установить и настроить пользовательский портал Azure Multi-Factor Authentication. Пользовательский портал — это веб-сайт IIS, с помощью которого пользователи могут зарегистрироваться в службе Azure Multi-Factor Authentication и управлять своими учетными записями. Пользователь может изменить свой номер телефона, ПИН-код или обойти проверку Azure Multi-Factor Authentication при следующем входе в систему.

Пользователям предстоит входить на пользовательский портал с помощью привычного имени пользователя и пароля, а затем либо отвечать на телефонный вызов службы Azure Multi-Factor Authentication, либо отвечать на вопросы безопасности, чтобы пройти проверку подлинности. Если регистрация пользователей разрешена, пользователям предстоит настраивать свой номер телефона и ПИН-код при первом входе на пользовательский портал.

Для администраторов пользовательского портала можно настроить и предоставить разрешение на добавление новых и обновление существующих пользователей.

<center>![Setup](./media/multi-factor-authentication-get-started-portal/install.png)</center>

## Развертывание пользовательского портала на сервере, на котором расположен сервер Azure Multi-Factor Authentication

Чтобы установить пользовательский портал на тот же сервер, на котором установлен сервер Azure Multi-Factor Authentication, нужно выполнить такие условия:

- Необходимо установить службы IIS, включая ASP.NET и роль совместимости метабазы IIS 6 (для IIS 7 или более поздней версии). 
- Вошедший в систему пользователь должен иметь права администратора для компьютера и домена, если это применимо. Это обусловлено тем, что, чтобы создать группы безопасности Active Directory, учетной записи требуются разрешения.

### Развертывание пользовательского портала на сервере Azure Multi-Factor Authentication

<ol>
<li>На сервере Azure Multi-Factor Authentication: щелкните значок пользовательского портала в меню слева, а затем нажмите кнопку «Установить пользовательский портал». <li>Нажмите кнопку «Далее». <li>Нажмите кнопку «Далее». <li>Если компьютер присоединен к домену, но в Active Directory не закончена настройка защиты подключений между пользовательским порталом и службой Azure Multi-Factor Authentication, отобразится запрос на настройку Active Directory. Чтобы выполнить настройку автоматически, нажмите кнопку «Далее». <li>Нажмите кнопку «Далее». <li>Нажмите кнопку «Далее». <li>Нажмите кнопку «Закрыть». <li>Откройте веб-браузер с любого компьютера и перейдите по URL-адресу установки пользовательского портала (например, https://www.publicwebsite.com/MultiFactorAuth). Убедитесь, что не отображаются предупреждения сертификата или ошибки.</li>

<center>![Setup](./media/multi-factor-authentication-get-started-portal/portal.png)</center>

## Развертывание пользовательского портала Azure Multi-Factor Authentication на отдельном сервере

Для использования приложения Azure Multi-Factor Authentication и его успешного взаимодействия с пользовательским порталом должны выполняться приведенные ниже условия.

Требования к оборудованию и программному обеспечению см. в разделе «Требования к оборудованию и программному обеспечению».

- Необходимо использовать версию 6.0 или более позднюю версию сервера Azure Multi-Factor Authentication.
- Необходимо установить пользовательский портал на веб-сервере с выходом в Интернет под управлением Microsoft® Internet Information Services (IIS), начиная с версии 6.x или IIS 7.x.
- В случае использования IIS 6.x убедитесь, что версия ASP.NET 2.0.50727 установлена и зарегистрирована и для нее установлено значение «Разрешено».
- В случае использования IIS 7.x или более поздней версии требуются службы роли ASP.NET и совместимость с метабазой IIS 6.
- Пользовательский портал должен быть защищен сертификатом SSL.
- Для IIS 6.x, IIS 7.x или более поздней версии требуется установить пакет SDK веб-службы Azure Multi-Factor Authentication на сервере, на котором установлен сервер Azure Multi-Factor Authentication.
- Безопасность пакета SDK веб-службы Azure Multi-Factor Authentication должен обеспечивать сертификат SSL.
- Пользовательский портал должен иметь возможность подключения к пакету SDK веб-службы Azure Multi-Factor Authentication по протоколу SSL.
- Пользовательский портал должен иметь возможность выполнить проверку подлинности для пакета SDK веб-службы Azure Multi-Factor Authentication с использованием учетных данных учетной записи службы, которая входит в группу безопасности PhoneFactor Admins. Эта учетная запись службы и группа существуют в Active Directory, если сервер Azure Multi-Factor Authentication установлен на сервере, присоединенном к домену. Эта учетная запись службы и группа существуют локально на сервере Azure Multi-Factor Authentication, если он не присоединен к домену.

Чтобы установить пользовательский портал на сервере, отличном от сервера Azure Multi-Factor Authentication, нужно выполнить такие три действия:

1. Установить пакет SDK веб-службы.
2. Установить пользовательский портал.
3. Настроить параметры пользовательского портала на сервере Azure Multi-Factor Authentication.


### Установка пакета SDK веб-службы

Если пакет SDK веб-службы Azure Multi-Factor Authentication еще не установлен на сервере Azure Multi-Factor Authentication, перейдите на этот сервер и откройте сервер Azure Multi-Factor Authentication. Щелкните значок пакета SDK веб-службы, затем нажмите кнопку «Установить SDK веб-службы…» и следуйте указанным инструкциям. Пакет SDK веб-службы должен быть защищен сертификатом SSL. Для этой цели подходит самозаверяющий сертификат, но он должен быть импортирован в хранилище «Доверенные корневые центры сертификации» учетной записи локального компьютера на веб-сервере пользовательского портала, чтобы этот сертификат был доверенным при запуске SSL-подключения.

<center>![Setup](./media/multi-factor-authentication-get-started-portal/sdk.png)</center>

### Установка пользовательского портала

Перед установкой пользовательского портала на отдельный сервер необходимо такие факторы:

- Рекомендуется открыть веб-браузер на веб-сервере с выходом в Интернет и перейти по URL-адресу пакета SDK веб-службы, указанному в файле web.config. Если веб-служба успешно откроется в браузере, у вас будут запрошены учетные данные для входа. Введите имя пользователя и пароль, которые были введены в файл web.config, в точности так, как они отображены в файле. Убедитесь, что не отображаются предупреждения или ошибки сертификата.
- Если обратный прокси-сервер или брандмауэр размещен перед веб-сервером веб-службы мобильного приложения и выполняет разгрузку SSL, вы можете изменить файл web.config веб-сервиса мобильного приложения и добавить следующий ключ в раздел <appSettings>, чтобы пользовательский портал мог использовать протокол http вместо https. <add key="SSL_REQUIRED" value="false"/>

#### Установка пользовательского портала

<ol>




<li>Откройте проводник на сервере, на котором установлен сервер Azure Multi-Factor Authentication, и перейдите в папку установки сервера Azure Multi-Factor Authentication (например, C:\Program Files\Multi-Factor Authentication Server). Выберите соответствующий файл установки MultiFactorAuthenticationUserPortalSetup для 32- или 64-разрядной версии сервера, на который будет установлен пользовательский портал. Скопируйте файл установки на сервер с выходом в Интернет.</li>

<li>На веб-сервере с выходом в Интернет файл установки необходимо запускать с правами администратора. Самый простой способ сделать это&#160;— открыть командную строку от имени администратора и перейти в расположение, в которое был скопирован файл установки.</li>

<li>Запустите файл установки MultiFactorAuthenticationUserPortalSetup64 и при необходимости измените имя сайта и виртуального каталога.</li>

<li>По завершении установки пользовательского портала перейдите в расположение C:\inetpub\wwwroot\MultiFactorAuth (или в соответствующий каталог на основе имени виртуального каталога) и измените файл web.config.</li>

<li>Найдите ключ USE_WEB_SERVICE_SDK и измените значение с false на true. Найдите ключи WEB_SERVICE_SDK_AUTHENTICATION_USERNAME и WEB_SERVICE_SDK_AUTHENTICATION_PASSWORD и задайте значения имени пользователя и пароля для учетной записи службы, которая входит в группу безопасности PhoneFactor Admins (см. раздел требований выше). Обязательно поместите имя пользователя и пароль в кавычки в конце строки (значение = "" / >). Рекомендуется использовать полное имя пользователя (например, домен\имя_пользователя или компьютер\имя_пользователя).</li>

<li>Найдите параметр pfup_pfwssdk_PfWsSdk и измените его значение, указав вместо ссылки http://localhost:4898/PfWsSdk.asmx URL-адрес пакета SDK веб-службы, который выполняется на сервере Azure Multi-Factor Authentication (например, https://computer1.domain.local/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx). Так как для этого подключения используется протокол SSL, необходимо ссылаться на пакет SDK веб-службы по имени сервера, а не по IP-адресу, потому что SSL-сертификат выдан для имени сервера и URL-адрес должен соответствовать имени в сертификате. Если имя сервера не связано с IP-адресом на сервере с выходом в Интернет, добавьте запись в файл hosts на этом сервере, чтобы сопоставить имя сервера Azure Multi-Factor Authentication и его IP-адрес. Сохраните файл web.config после внесения изменений.</li>

<li>Если веб-сайт, с которого выполнялась установка пользовательского портала (например, «веб-сайт по умолчанию»), еще не связан с публично подписанным сертификатом, установите сертификат на сервере, если он на нем еще не установлен, затем откройте диспетчер IIS и привяжите сертификат к веб-сайту.</li>

<li>Откройте веб-браузер на любом компьютере и перейдите по URL-адресу на страницу, с которой был установлен пользовательский портал (например https://www.publicwebsite.com/MultiFactorAuth). Убедитесь, что не отображаются предупреждения или ошибки сертификата.</li>

## Настройка параметров пользовательского портала на сервере Azure Multi-Factor Authentication
Теперь, когда портал установлен, необходимо настроить сервер Azure Multi-Factor Authentication для работы с порталом.

### Настройка параметров пользовательского портала на сервере Azure Multi-Factor Authentication Server




1. На сервере Azure Multi-Factor Authentication щелкните значок пользовательского портала. На вкладке «Параметры» в текстовом поле «URL-адрес пользовательского портала» введите URL-адрес пользовательского портала. Если включена функция электронной почты, этот URL-адрес будет вставляться в сообщения электронной почты, отправляемые пользователям в процессе их импорта на сервер Azure Multi-Factor Authentication.
2. Выберите параметры, которые необходимо использовать на пользовательском портале. Например, если пользователям разрешено управлять своими методами проверки подлинности, убедитесь, что установлен флажок «Разрешить пользователям выбирать метод» и что указаны методы, из которых пользователи могут выбирать.
3. Щелкните ссылку «Справка» в верхнем правом углу — это поможет вам разобраться во всех отображаемых параметрах.

<center>![Setup](./media/multi-factor-authentication-get-started-portal/config.png)</center>

<!---HONumber=July15_HO2-->