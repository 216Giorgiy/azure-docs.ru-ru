---
title: "Пользовательский портал на сервере MFA Azure | Документация Майкрософт"
description: "Эта страница посвящена службе Azure Multi-Factor Authentication. Она содержит сведения по началу работы с Azure Multi-Factor Authentication и пользовательским порталом."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 06b419fa-3507-4980-96a4-d2e3960e1772
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 04/24/2017
ms.author: kgremban
ms.translationtype: Human Translation
ms.sourcegitcommit: 54b5b8d0040dc30651a98b3f0d02f5374bf2f873
ms.openlocfilehash: 97845748ef44469d1ec6a91ff8184288dc6350d9
ms.contentlocale: ru-ru
ms.lasthandoff: 04/28/2017


---
# <a name="deploy-the-user-portal-for-the-azure-multi-factor-authentication-server"></a>Развертывание пользовательского портала на сервере Многофакторной идентификации Azure
Пользовательский портал — это веб-сайт IIS, с помощью которого пользователи могут зарегистрироваться в службе Многофакторной идентификации Azure и управлять своими учетными записями. Пользователь может изменить свой номер телефона, ПИН-код или обойти двухфакторную проверку подлинности при следующем входе в систему.

Пользователи входят на пользовательский портал, используя привычное имя пользователя и пароль, а затем отвечают на телефонный вызов при двухфакторной проверке подлинности или на секретные вопросы, чтобы пройти проверку подлинности. Если регистрация пользователей разрешена, они настраивают свой номер телефона и ПИН-код при первом входе на пользовательский портал.

Для администраторов пользовательского портала можно настроить и предоставить разрешение на добавление новых и обновление существующих пользователей.

<center>![Настройка](./media/multi-factor-authentication-get-started-portal/install.png)</center>

>[!NOTE] 
>Пользовательский портал доступен только на сервере Многофакторной идентификации. При использовании Многофакторной идентификации в облаке ознакомьте пользователей со статьей [Настройка учетной записи для двухфакторной проверки подлинности](./end-user/multi-factor-authentication-end-user-first-time.md) или [Управление параметрами двухфакторной проверки подлинности](./end-user/multi-factor-authentication-end-user-manage-settings.md).


## <a name="deploy-the-user-portal-on-the-same-server-as-the-azure-multi-factor-authentication-server"></a>Развертывание пользовательского портала на сервере, на котором расположен сервер Многофакторной идентификации Azure
Чтобы установить пользовательский портал на тот же сервер, на котором установлен сервер Многофакторной идентификации Azure, нужно выполнить такие условия:

* Необходимо установить службы IIS, включая ASP.NET и роль совместимости метабазы IIS 6 (для IIS 7 или более поздней версии).
* Иметь учетную запись с правами администратора для компьютера и домена, если это применимо. Чтобы создать группы безопасности Active Directory для учетной записи, необходимо иметь разрешения.

Чтобы развернуть пользовательский портал, сделайте следующее:

1. На сервере Многофакторной идентификации Azure в меню слева щелкните значок **Пользовательский портал**, а затем щелкните **Install User Portal** (Установить пользовательский портал).
2. Нажмите кнопку **Далее**.
3. Нажмите кнопку **Далее**.
4. Если компьютер присоединен к домену, но в Active Directory не настроена защита подключений между пользовательским порталом и службой Многофакторной идентификации Azure, появится окно настройки Active Directory. Чтобы выполнить настройку автоматически, нажмите кнопку **Далее**.
5. Нажмите кнопку **Далее**.
6. Нажмите кнопку **Далее**.
7. Нажмите кнопку **Закрыть**
8. Откройте веб-браузер на любом компьютере и перейдите по URL-адресу на страницу, с которой был установлен пользовательский портал (например, https://www.publicwebsite.com/MultiFactorAuth). Убедитесь, что не отображаются предупреждения или ошибки сертификата.

<center>![Настройка](./media/multi-factor-authentication-get-started-portal/portal.png)</center>

## <a name="deploy-the-user-portal-on-a-separate-server"></a>Развертывание пользовательского портала на отдельном сервере
Если сервер, на котором выполняется сервер Многофакторной идентификации Azure, недоступен в Интернете, необходимо установить пользовательский портал на отдельном сервере с выходом в Интернет. 

Если организация использует приложение Microsoft Authenticator в качестве одного из методов проверки и необходимо развернуть пользовательский портал на отдельном сервере, выполните следующие требования: 

* Используйте версию 6.0 или более позднюю версию сервера Многофакторной идентификации Azure.
* Установите пользовательский портал на веб-сервере с выходом в Интернет под управлением Microsoft IIS, начиная с версии 6.x и выше.
* Если используется IIS 6.x, убедитесь, что версия ASP.NET 2.0.50727 установлена и зарегистрирована и для нее задано значение **Разрешено**.
* В случае использования IIS 7.x или более поздней версии требуются службы роли ASP.NET и совместимость с метабазой IIS 6.
* Защитите пользовательский портал с помощью SSL-сертификата.
* Защитите пакет SDK веб-службы для Многофакторной идентификации Azure с помощью сертификата SSL.
* Пользовательский портал должен иметь возможность подключаться к пакету SDK веб-службы Многофакторной идентификации Azure по протоколу SSL.
* Пользовательский портал должен иметь возможность выполнить проверку подлинности для пакета SDK веб-службы Многофакторной идентификации Azure с использованием учетных данных учетной записи службы, которая входит в группу безопасности PhoneFactor Admins. Эта учетная запись службы и группа существуют в Active Directory, если сервер Azure Multi-Factor Authentication установлен на сервере, присоединенном к домену. Эта учетная запись службы и группа существуют локально на сервере Azure Multi-Factor Authentication, если он не присоединен к домену.

Чтобы установить пользовательский портал на сервере, отличном от сервера Azure Multi-Factor Authentication, нужно выполнить такие три действия:

1. Установить пакет SDK веб-службы на сервере, на котором расположен сервер Многофакторной идентификации Azure.
2. Установить пользовательский портал.
3. Настроить параметры пользовательского портала на сервере Azure Multi-Factor Authentication.

### <a name="step-1-install-the-web-service-sdk"></a>Шаг 1. Установка пакета SDK веб-службы
Если пакет SDK веб-службы Azure Multi-Factor Authentication еще не установлен на сервере Azure Multi-Factor Authentication, перейдите на этот сервер и откройте сервер Azure Multi-Factor Authentication. Щелкните значок **SDK веб-службы**, а затем **Установить SDK веб-службы**. Следуйте инструкциям на экране. 

Пакет SDK веб-службы должен быть защищен сертификатом SSL. Для этой цели подходит самозаверяющий сертификат, но он должен быть импортирован в хранилище "Доверенные корневые центры сертификации" учетной записи локального компьютера на сервере. Теперь пакет SDK веб-службы может доверять этому сертификату при установке SSL-подключения.

<center>![Настройка](./media/multi-factor-authentication-get-started-portal/sdk.png)</center>

### <a name="step-2-install-the-user-portal"></a>Шаг 2. Установка пользовательского портала
Перед установкой пользовательского портала на отдельный сервер необходимо учесть следующие факторы:

* Рекомендуется открыть веб-браузер на веб-сервере с выходом в Интернет и перейти по URL-адресу пакета SDK веб-службы, указанному в файле web.config. Если веб-служба успешно откроется в браузере, у вас будут запрошены учетные данные для входа. Введите имя пользователя и пароль, которые были введены в файл web.config, в точности так, как они отображены в файле. Убедитесь, что не отображаются предупреждения или ошибки сертификата.
* Если обратный прокси-сервер или брандмауэр размещен перед веб-сервером пользовательского портала и выполняет разгрузку SSL, вы можете изменить файл web.config пользовательского портала, добавив следующий ключ в раздел `<appSettings>`, чтобы пользовательский портал мог использовать протокол HTTP вместо HTTPS.

    `<add key="SSL_REQUIRED" value="false"/>`

#### <a name="to-install-the-user-portal"></a>Установка пользовательского портала
1. Откройте проводник на сервере, на котором установлен сервер Azure MFA, и перейдите в папку установки сервера Многофакторной идентификации Azure (например, C:\Program Files\Multi-Factor Authentication Server). Скопируйте соответствующий файл установки MultiFactorAuthenticationUserPortalSetup для 32- или 64-разрядной версии на сервер с выходом в Интернет.
2. На веб-сервере с выходом в Интернет запустите файл с правами администратора. Самый простой способ сделать это — открыть командную строку от имени администратора и перейти в расположение, в которое был скопирован файл установки.
3. Запустите файл установки MultiFactorAuthenticationUserPortalSetup64 и при необходимости измените имя сайта и виртуального каталога.
4. По завершении установки пользовательского портала перейдите в расположение C:\inetpub\wwwroot\MultiFactorAuth (или в соответствующий каталог на основе имени виртуального каталога) и измените файл web.config.
5. Найдите ключ USE_WEB_SERVICE_SDK и измените значение с **false** на **true**. 
6. Найдите ключ WEB_SERVICE_SDK_AUTHENTICATION_USERNAME и задайте значение имени пользователя для учетной записи группы безопасности PhoneFactor Admins. Используйте полное имя пользователя (например, домен\имя_пользователя или компьютер\имя_пользователя). 
7. Найдите ключ WEB_SERVICE_SDK_AUTHENTICATION_PASSWORD и задайте значение пароля для учетной записи группы безопасности PhoneFactor Admins.
8. Найдите параметр pfup_pfwssdk_PfWsSdk и измените его значение, указав вместо ссылки http://localhost:4898/PfWsSdk.asmx URL-адрес пакета SDK веб-службы, который выполняется на сервере Azure Multi-Factor Authentication (например, https://computer1.domain.local/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx). Так как для этого подключения используется протокол SSL, необходимо ссылаться на пакет SDK веб-службы по имени сервера, а не по IP-адресу, потому что SSL-сертификат выдан для имени сервера. Если имя сервера не связано с IP-адресом на сервере с выходом в Интернет, добавьте запись в файл hosts на этом сервере, чтобы сопоставить имя сервера Многофакторной идентификации Azure и его IP-адрес. Сохраните файл web.config после внесения изменений.

    Дополнительные сведения о редактировании файла конфигурации см. в статье [Защита облачных и локальных ресурсов с помощью сервера Многофакторной идентификации Azure со службами федерации Active Directory в Windows Server 2012 R2](multi-factor-authentication-get-started-adfs-w2k12.md#edit-the-multifactorauthenticationadfsadapterconfig-file).

7. Если веб-сайт, с которого выполнялась установка пользовательского портала (например, веб-сайт по умолчанию), еще не связан с публично подписанным сертификатом, установите сертификат на сервере, откройте диспетчер IIS и привяжите сертификат к веб-сайту.
8. Откройте веб-браузер на любом компьютере и перейдите по URL-адресу на страницу, с которой был установлен пользовательский портал (например, https://www.publicwebsite.com/MultiFactorAuth). Убедитесь, что не отображаются предупреждения или ошибки сертификата.

### <a name="step-3-configure-the-user-portal-settings-in-the-azure-multi-factor-authentication-server"></a>Шаг 3. Настройка параметров пользовательского портала на сервере Многофакторной идентификации Azure
Теперь, когда пользовательский портал установлен, необходимо настроить сервер Многофакторной идентификации Azure для работы с порталом.

Сервер Azure Multi-Factor Authentication предоставляет несколько параметров для пользовательского портала.  Следующая таблица содержит список этих параметров и объяснение их использования.

| Параметры пользовательского портала | Описание |
|:--- |:--- |
| URL-адрес пользовательского портала | Введите URL-адрес размещения портала. |
| Основная проверка подлинности | Укажите тип проверки подлинности при входе в систему на портале.  Проверка подлинности Windows, Radius или LDAP. |
| Разрешить пользователям входить в систему | Позволяет пользователю ввести имя пользователя и пароль на странице входа для пользовательского портала.  Если этот параметр не выбран, поля будут недоступны. |
| Разрешить регистрацию пользователей | Позволяет пользователю зарегистрироваться в службе Многофакторной идентификации, открывая окно настройки, которое запрашивает у него дополнительные сведения, например номер телефона. Запрос дополнительного номера телефона позволяет пользователям указать второй номер телефона. Запрос OATH-токена сторонних производителей позволяет пользователям указать его. |
| Разрешить пользователям инициировать одноразовый обход проверки | Позволяет пользователям инициировать одноразовый обход проверки.  Выбранный параметр вступит в силу при следующем входе пользователя в систему. Запрос времени действия обхода проверки позволяет пользователю изменить время действия обхода проверки по умолчанию в 300 секунд. Если пользователь не изменил время действия, обход проверки действителен только в течение 300 секунд. |
| Разрешить пользователям выбирать способ связи | Позволяет пользователю выбрать свой основной способ связи.  Это может быть телефонный звонок, текстовое сообщение, мобильное приложение или OATH-токен. |
| Разрешить пользователям выбирать язык | Позволяет пользователям изменить язык для телефонного вызова, текстового сообщения, мобильного приложения или OATH-токена. |
| Разрешить пользователям активировать мобильное приложение | Позволяет пользователям создать код активации для завершения процесса активации мобильного приложения, используемого с сервером.  Кроме того, можно задать количество устройств, на которых можно активировать приложение (от 1 до 10). |
| Использовать секретные вопросы для резервного входа | Позволяет использовать секретные вопросы при сбое двухфакторной проверки подлинности.  Можно указать количество секретных вопросов, на которые нужно дать верные ответы. |
| Разрешить пользователям привязывать OATH-токены сторонних производителей | Позволяет пользователю указать OATH-токен сторонних производителей. |
| Использовать OATH-токен для резервного входа | Позволяет использовать OATH-токен при сбое двухфакторной проверки подлинности. Также можно указать время ожидания сеанса в минутах. |
| Включение ведения журналов | Включает ведение журнала на пользовательском портале. Файлы журнала расположены в папке: C:\Program Files\Multi-Factor Authentication Server\Logs. |

Большинство из этих параметров доступны пользователю, если они активны и пользователь вошел на пользовательский портал.

![Параметры пользовательского портала](./media/multi-factor-authentication-get-started-portal/portalsettings.png)

### <a name="to-configure-the-user-portal-settings-in-the-azure-multi-factor-authentication-server"></a>Настройка параметров пользовательского портала на сервере Azure Multi-Factor Authentication Server
1. На сервере Многофакторной идентификации Azure щелкните значок **Пользовательский портал**. На вкладке "Параметры" в текстовом поле **User Portal URL** (URL-адрес пользовательского портала) введите URL-адрес пользовательского портала. Если включена функция электронной почты, этот URL-адрес будет вставляться в сообщения, отправляемые пользователям в процессе их импорта на сервер Многофакторной идентификации Azure.
2. Выберите параметры, которые необходимо использовать на пользовательском портале. Например, если пользователям разрешено выбирать методы проверки подлинности, убедитесь, что установлен флажок **Разрешить пользователям выбирать метод** и что указаны методы для выбора.
3. Щелкните ссылку **Справка** в верхнем правом углу. Это поможет вам разобраться во всех отображаемых параметрах.

<center>![Настройка](./media/multi-factor-authentication-get-started-portal/config.png)</center>


## <a name="administrators-tab"></a>Вкладка «Администраторы»
Используйте вкладку **Администраторы**, чтобы добавить пользователей, обладающих правами администратора.  При добавлении администратора можно настроить разрешения, которые он получает. Нажмите кнопку **Добавить**, выберите пользователя и его разрешения, а затем снова нажмите кнопку **Добавить**.

![Администраторы пользовательского портала](./media/multi-factor-authentication-get-started-portal/admin.png)

## <a name="security-questions"></a>Секретные вопросы
Используйте вкладку **Контрольные вопросы**, чтобы указать секретные вопросы, на которые пользователи должны будут ответить, если выбран параметр **Использовать контрольные вопросы для резервной проверки подлинности**.  На сервере Многофакторной идентификации Azure есть секретные вопросы по умолчанию, которые можно использовать. Корме того, можно изменить их порядок или добавить собственные вопросы.  При добавлении собственных вопросов также можно указать язык, на котором должны отображаться эти вопросы.

![Секретные вопросы пользовательского портала](./media/multi-factor-authentication-get-started-portal/secquestion.png)

## <a name="saml"></a>SAML
Используйте вкладку **SAML**, чтобы настроить пользовательский портал для приема утверждений от поставщика удостоверений с использованием SAML.  Вы можете указать сеанс времени ожидания, сертификат проверки и URL-адрес перенаправления при выходе из системы.

![SAML](./media/multi-factor-authentication-get-started-portal/saml.png)

## <a name="trusted-ips"></a>Надежные IP-адреса
Используйте вкладку **Надежные IP-адреса**, чтобы указать один IP-адрес или диапазоны IP-адресов, при входе с которых двухфакторная проверка подлинности для пользователя не выполняется.

![Доверенные IP-адреса пользовательского портала](./media/multi-factor-authentication-get-started-portal/trusted.png)

## <a name="self-service-user-enrollment"></a>Самостоятельная регистрация пользователей
Если вы хотите, чтобы пользователи входили в систему и регистрировались, необходимо выбрать параметры **Разрешить пользователям входить в систему** и **Разрешить регистрацию пользователей** на вкладке "Параметры". Помните, что выбранные параметры повлияют на процесс входа пользователя в систему.

Например, когда пользователь открывает пользовательский портал впервые, он перенаправляется на страницу настройки Многофакторной идентификации Azure.  В зависимости от того, как вы настроили многофакторную проверку подлинности Azure, пользователь сможет выбрать свой способ проверки подлинности.  

Если в качестве метода проверки подлинности был выбран или предварительно настроен голосовой звонок, пользователю будет предложено ввести свой основной номер телефона и, при необходимости, добавочный номер.  Пользователю также можно разрешить ввести дополнительный номер телефона.  

![Доверенные IP-адреса пользовательского портала](./media/multi-factor-authentication-get-started-portal/backupphone.png)

Если при проверке подлинности пользователю нужно использовать ПИН-код, ему также будет предложено создать ПИН-код.  После ввода номеров телефонов и ПИН-кода (если используется) пользователь нажимает кнопку **Позвоните мне для проверки подлинности**.  После этого для Многофакторной идентификации Azure будет осуществлен телефонный вызов на основной телефонный номер пользователя.  Пользователь должен ответить на звонок, ввести свой ПИН-код (если используется) и нажать кнопку # для перехода к следующему этапу процесса самостоятельной регистрации.   

Если в качестве метода проверки подлинности была выбрана или предварительно настроена проверка подлинности с помощью текстовых сообщений, пользователю будет предложено ввести номер мобильного телефона.  Если пользователь должен использовать ПИН-код при проверке подлинности, ему также будет предложено ввести ПИН-код.  После ввода номера телефона и ПИН-кода (если используется) пользователь нажимает кнопку **Отправьте мне SMS для проверки подлинности**.  После этого для Многофакторной идентификации Azure на основной телефонный номер пользователя будет отправлено текстовое сообщение.  Пользователь получит текстовое сообщение с одноразовым паролем. Затем он отвечает на сообщение, указав этот пароль и ПИН-код (если используется).

![Текстовые сообщения пользовательского портала](./media/multi-factor-authentication-get-started-portal/text.png)   

Если был выбран метод проверки с помощью мобильного приложения, пользователю будет предложено установить приложение Microsoft Authenticator на устройство и создать код активации.  После установки приложения пользователь нажимает кнопку "Создать код активации".    

> [!NOTE]
> Чтобы использовать приложение Microsoft Authenticator, пользователь должен включить push-уведомления для своего устройства.

На странице будут отображены код активации и URL-адрес, а также картинка со штрихкодом.  Если пользователь должен использовать ПИН-код при проверке подлинности, ему также будет предложено ввести ПИН-код.  Пользователь вводит код активации и URL-адрес в приложение Microsoft Authenticator или сканирует штрихкод с помощью сканера штрихкодов и нажимает кнопку "Активировать".    

После завершения активации пользователь нажимает кнопку **Проверить мою подлинность**.  После этого будет выполнена Многофакторная идентификация Azure с помощью мобильного приложения.  Пользователь должен ввести свой ПИН-код (если используется) и нажать кнопку «Выполнить проверку подлинности» в своем мобильном приложении для перехода к следующему этапу процесса самостоятельной регистрации.  

Если администраторы настроили использование секретных вопросов и ответов на сервере Azure Multi-Factor Authentication, пользователь будет перенаправлен на страницу «Секретные вопросы».  Пользователю необходимо выбрать секретные вопросы и указать ответы на выбранные вопросы.    

![Секретные вопросы пользовательского портала](./media/multi-factor-authentication-get-started-portal/secq.png)  

На этом самостоятельная регистрация пользователя завершена. Пользователь вошел на пользовательский портал.  В будущем пользователи могут в любой момент войти на портал для изменения своих номеров телефонов, ПИН-кодов, методов проверки подлинности и секретных вопросов, если это разрешено администраторами.


