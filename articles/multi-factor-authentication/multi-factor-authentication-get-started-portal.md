<properties 
	pageTitle="Развертывание пользовательского портала для сервера Azure Multi-Factor Authentication"
	description="Эта страница посвящена службе Azure Multi-Factor Authentication. Она содержит сведения по началу работы с Azure Multi-Factor Authentication и пользовательским порталом."
	services="multi-factor-authentication"
	documentationCenter=""
	authors="kgremban"
	manager="femila"
	editor="curtand"/>

<tags
	ms.service="multi-factor-authentication"
	ms.workload="identity"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="get-started-article"
	ms.date="08/15/2016"
	ms.author="kgremban"/>

# Развертывание пользовательского портала для сервера Azure Multi-Factor Authentication

С помощью пользовательского портала администратор может установить и настроить пользовательский портал Azure Multi-Factor Authentication. Пользовательский портал — это веб-сайт IIS, с помощью которого пользователи могут зарегистрироваться в службе Azure Multi-Factor Authentication и управлять своими учетными записями. Пользователь может изменить свой номер телефона, ПИН-код или обойти проверку Azure Multi-Factor Authentication при следующем входе в систему.

Пользователям предстоит входить на пользовательский портал с помощью привычного имени пользователя и пароля, а затем либо отвечать на телефонный вызов службы Azure Multi-Factor Authentication, либо отвечать на вопросы безопасности, чтобы пройти проверку подлинности. Если регистрация пользователей разрешена, пользователям предстоит настраивать свой номер телефона и ПИН-код при первом входе на пользовательский портал.

Для администраторов пользовательского портала можно настроить и предоставить разрешение на добавление новых и обновление существующих пользователей.

<center>![Setup](./media/multi-factor-authentication-get-started-portal/install.png)</center>

## Развертывание пользовательского портала на сервере, на котором расположен сервер Azure Multi-Factor Authentication

Чтобы установить пользовательский портал на тот же сервер, на котором установлен сервер Azure Multi-Factor Authentication, нужно выполнить такие условия:

- Необходимо установить службы IIS, включая ASP.NET и роль совместимости метабазы IIS 6 (для IIS 7 или более поздней версии).
- Вошедший в систему пользователь должен иметь права администратора для компьютера и домена, если это применимо. Это обусловлено тем, что, чтобы создать группы безопасности Active Directory, учетной записи требуются разрешения.

### Развертывание пользовательского портала на сервере Azure Multi-Factor Authentication

1. На сервере Azure Multi-Factor Authentication: щелкните значок пользовательского портала в меню слева, затем нажмите кнопку «Установить пользовательский портал».
1. Нажмите кнопку Далее.
1. Нажмите кнопку Далее.
1. Если компьютер присоединен к домену, но в Active Directory не закончена настройка защиты подключений между пользовательским порталом и службой Azure Multi-Factor Authentication, появится окно настройки Active Directory. Чтобы выполнить настройку автоматически, нажмите кнопку «Далее».
1. Нажмите кнопку Далее.
1. Нажмите кнопку Далее.
1. Нажмите кнопку Закрыть.
1. Откройте веб-браузер с любого компьютера и перейдите по URL-адресу установки пользовательского портала (например, https://www.publicwebsite.com/MultiFactorAuth). Убедитесь, что не отображаются предупреждения или ошибки сертификата.

<center>![Setup](./media/multi-factor-authentication-get-started-portal/portal.png)</center>

## Развертывание пользовательского портала Azure Multi-Factor Authentication на отдельном сервере

Для использования приложения Azure Multi-Factor Authentication и его успешного взаимодействия с пользовательским порталом должны выполняться приведенные ниже условия.

Требования к оборудованию и программному обеспечению см. в разделе «Требования к оборудованию и программному обеспечению».

- Необходимо использовать версию 6.0 или более позднюю версию сервера Azure Multi-Factor Authentication.
- Необходимо установить пользовательский портал на веб-сервере с выходом в Интернет под управлением Microsoft® Internet Information Services (IIS), начиная с версии 6.x или IIS 7.x.
- В случае использования IIS 6.x убедитесь, что версия ASP.NET 2.0.50727 установлена и зарегистрирована и для нее установлено значение «Разрешено».
- В случае использования IIS 7.x или более поздней версии требуются службы роли ASP.NET и совместимость с метабазой IIS 6.
- Пользовательский портал должен быть защищен сертификатом SSL.
- Для IIS 6.x, IIS 7.x или более поздней версии требуется установить пакет SDK веб-службы Azure Multi-Factor Authentication на сервере, на котором установлен сервер Azure Multi-Factor Authentication.
- Безопасность пакета SDK веб-службы Azure Multi-Factor Authentication должен обеспечивать сертификат SSL.
- Пользовательский портал должен иметь возможность подключения к пакету SDK веб-службы Azure Multi-Factor Authentication по протоколу SSL.
- Пользовательский портал должен иметь возможность выполнить проверку подлинности для пакета SDK веб-службы Azure Multi-Factor Authentication с использованием учетных данных учетной записи службы, которая входит в группу безопасности PhoneFactor Admins. Эта учетная запись службы и группа существуют в Active Directory, если сервер Azure Multi-Factor Authentication установлен на сервере, присоединенном к домену. Эта учетная запись службы и группа существуют локально на сервере Azure Multi-Factor Authentication, если он не присоединен к домену.

Чтобы установить пользовательский портал на сервере, отличном от сервера Azure Multi-Factor Authentication, нужно выполнить такие три действия:

1. Установить пакет SDK веб-службы.
2. Установить пользовательский портал.
3. Настроить параметры пользовательского портала на сервере Azure Multi-Factor Authentication.


### Установка пакета SDK веб-службы

Если пакет SDK веб-службы Azure Multi-Factor Authentication еще не установлен на сервере Azure Multi-Factor Authentication, перейдите на этот сервер и откройте сервер Azure Multi-Factor Authentication. Щелкните значок пакета SDK веб-службы, затем нажмите кнопку «Установить SDK веб-службы…» и следуйте указанным инструкциям. Пакет SDK веб-службы должен быть защищен сертификатом SSL. Для этой цели подходит самозаверяющий сертификат, но он должен быть импортирован в хранилище «Доверенные корневые центры сертификации» учетной записи локального компьютера на веб-сервере пользовательского портала, чтобы этот сертификат был доверенным при запуске SSL-подключения.

<center>![Setup](./media/multi-factor-authentication-get-started-portal/sdk.png)</center>

### Установка пользовательского портала

Перед установкой пользовательского портала на отдельный сервер необходимо такие факторы:

- Рекомендуется открыть веб-браузер на веб-сервере с выходом в Интернет и перейти по URL-адресу пакета SDK веб-службы, указанному в файле web.config. Если веб-служба успешно откроется в браузере, у вас будут запрошены учетные данные для входа. Введите имя пользователя и пароль, которые были введены в файл web.config, в точности так, как они отображены в файле. Убедитесь, что не отображаются предупреждения или ошибки сертификата.
- Если обратный прокси-сервер или брандмауэр размещен перед веб-сервером пользовательского портала и выполняет разгрузку SSL, вы можете изменить файл web.config пользовательского портала, добавив в раздел <appSettings> ключ <add key="SSL\_REQUIRED" value="false"/>. Это позволит пользовательскому порталу использовать протокол http вместо https.

#### Установка пользовательского портала

1. Откройте проводник на сервере, на котором установлен сервер Azure Multi-Factor Authentication, и перейдите в папку установки сервера Azure Multi-Factor Authentication (например, C:\\Program Files\\Multi-Factor Authentication Server). Выберите соответствующий файл установки MultiFactorAuthenticationUserPortalSetup для 32- или 64-разрядной версии сервера, на который будет установлен пользовательский портал. Скопируйте файл установки на сервер с выходом в Интернет.
2. На веб-сервере с выходом в Интернет файл установки необходимо запускать с правами администратора. Самый простой способ сделать это — открыть командную строку от имени администратора и перейти в расположение, в которое был скопирован файл установки.
3. Запустите файл установки MultiFactorAuthenticationUserPortalSetup64 и при необходимости измените имя сайта и виртуального каталога.
4. По завершении установки пользовательского портала перейдите в расположение C:\\inetpub\\wwwroot\\MultiFactorAuth (или в соответствующий каталог на основе имени виртуального каталога) и измените файл web.config.
5. Найдите ключ USE\_WEB\_SERVICE\_SDK и измените значение с false на true. Найдите ключи WEB\_SERVICE\_SDK\_AUTHENTICATION\_USERNAME и WEB\_SERVICE\_SDK\_AUTHENTICATION\_PASSWORD и задайте значения имени пользователя и пароля для учетной записи службы, которая входит в группу безопасности PhoneFactor Admins (см. раздел требований выше). Обязательно поместите имя пользователя и пароль в кавычки в конце строки (значение = "" / >). Рекомендуется использовать полное имя пользователя (например, домен\\имя\_пользователя или компьютер\\имя\_пользователя).
6. Найдите параметр pfup\_pfwssdk\_PfWsSdk и измените его значение с http://localhost:4898/PfWsSdk.asmx на URL-адрес пакета SDK веб-службы, которая работает на сервере Azure Multi-Factor Authentication (например, https://computer1.domain.local/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx). Так как для этого подключения используется протокол SSL, необходимо ссылаться на пакет SDK веб-службы по имени сервера, а не по IP-адресу, потому что SSL-сертификат выдан для имени сервера и URL-адрес должен соответствовать имени в сертификате. Если имя сервера не связано с IP-адресом на сервере с выходом в Интернет, добавьте запись в файл hosts на этом сервере, чтобы сопоставить имя сервера Azure Multi-Factor Authentication и его IP-адрес. Сохраните файл web.config после внесения изменений.
7. Если веб-сайт, с которого выполнялась установка пользовательского портала (например, «веб-сайт по умолчанию»), еще не связан с публично подписанным сертификатом, установите сертификат на сервере, если он на нем еще не установлен, затем откройте диспетчер IIS и привяжите сертификат к веб-сайту.
8. Откройте веб-браузер с любого компьютера и перейдите по URL-адресу установки пользовательского портала (например, https://www.publicwebsite.com/MultiFactorAuth). Убедитесь, что не отображаются предупреждения или ошибки сертификата.



## Настройка параметров пользовательского портала на сервере Azure Multi-Factor Authentication
Теперь, когда портал установлен, необходимо настроить сервер Azure Multi-Factor Authentication для работы с порталом.

Сервер Azure Multi-Factor Authentication предоставляет несколько параметров для пользовательского портала. Следующая таблица содержит список этих параметров и объяснение их использования.

Параметры пользовательского портала|Описание|
:------------- | :------------- |
URL-адрес пользовательского портала| Позволяет ввести URL-адрес размещения портала.
Основная проверка подлинности| Позволяет указать тип проверки подлинности при входе в систему на портале. Проверка подлинности Windows, Radius или LDAP.
Разрешить пользователям входить в систему|Позволяет пользователю ввести имя пользователя и пароль на странице входа для пользовательского портала. Если этот параметр не выбран, поля будут недоступны.
Разрешить регистрацию пользователей|Позволяет пользователю зарегистрироваться в многофакторной проверке подлинности, открывая окно настройки, которое запрашивает у него дополнительную информацию, например номер телефона. Запрос дополнительного номера телефона позволяет пользователям указать второй номер телефона. Запрос OATH-токена сторонних производителей позволяет пользователям указать OATH-токен сторонних производителей.
Разрешить пользователям инициировать одноразовый обход проверки| Позволяет пользователям инициировать одноразовый обход проверки. При выборе этого параметра он вступит в силу при следующем входе пользователя в систему. Запрос времени действия обхода проверки позволяет пользователю изменить время действия обхода проверки по умолчанию в 300 секунд. Если пользователь не изменил время действия, обход проверки действителен только в течение 300 секунд.
Разрешить пользователям выбирать способ связи| Позволяет пользователю выбрать свой основной способ связи. Это может быть телефонный звонок, текстовое сообщение, мобильное приложение или OATH-токен.
Разрешить пользователям выбирать язык| Пользователь может изменить язык, используемый для телефонного звонка, текстового сообщения, мобильного приложения или OATH-токена.
Разрешить пользователям активировать мобильное приложение| Позволяет пользователям создать код активации для завершения процесса активации мобильного приложения, используемого с сервером. Также можно задать количество устройств, на которых можно активировать приложение. От 1 до 10.
Использовать секретные вопросы для резервного входа|Позволяет использовать секретные вопросы, если многофакторная проверка подлинности завершилась неудачно. Можно указать количество секретных вопросов, на которые нужно дать верные ответы.
Разрешить пользователям привязывать OATH-токены сторонних производителей| Позволяет пользователю указать OATH-токен сторонних производителей.
Использовать OATH-токен для резервного входа|Позволяет использовать OATH-токен, если многофакторная проверка подлинности завершилась неудачно. Также можно указать время ожидания сеанса в минутах.
Включение ведения журналов|Включает ведение журнала на пользовательском портале. Файлы журнала расположены в папке: C:\\Program Files\\Multi-Factor Authentication Server\\Logs.

Большинство из этих параметров доступны пользователю, если они активны и пользователь вошел в пользовательский портал.

![Параметры пользовательского портала](./media/multi-factor-authentication-get-started-portal/portalsettings.png)



### Настройка параметров пользовательского портала на сервере Azure Multi-Factor Authentication Server




1. На сервере Azure Multi-Factor Authentication щелкните значок пользовательского портала. На вкладке «Параметры» в текстовом поле «URL-адрес пользовательского портала» введите URL-адрес пользовательского портала. Если включена функция электронной почты, этот URL-адрес будет вставляться в сообщения электронной почты, отправляемые пользователям в процессе их импорта на сервер Azure Multi-Factor Authentication.
2. Выберите параметры, которые необходимо использовать на пользовательском портале. Например, если пользователям разрешено управлять своими методами проверки подлинности, убедитесь, что установлен флажок «Разрешить пользователям выбирать метод» и что указаны методы, из которых пользователи могут выбирать.
3. Щелкните ссылку «Справка» в верхнем правом углу — это поможет вам разобраться во всех отображаемых параметрах.

<center>![Setup](./media/multi-factor-authentication-get-started-portal/config.png)</center>


## Вкладка «Администраторы»
Эта вкладка позволяет добавить пользователей, обладающих правами администратора. При добавлении администратора можно настроить права, которые он получает. Таким образом можно быть уверенным в том, что администратор получит только необходимые права доступа. Нажмите кнопку «Добавить», выберите пользователя и его права доступа и нажмите кнопку «Добавить».

![Администраторы пользовательского портала](./media/multi-factor-authentication-get-started-portal/admin.png)


## Секретные вопросы
На этой вкладке можно указать секретные вопросы, на которые пользователи должны будут ответить, если выбран параметр «Использовать секретные вопросы для резервного входа». На сервере Azure Multi-Factor Authenticaton есть секретные вопросы по умолчанию, которые можно использовать. Также можно изменить их порядок или добавить собственные вопросы. При добавлении собственных вопросов также можно указать язык, на котором должны отображаться эти вопросы.

![Секретные вопросы пользовательского портала](./media/multi-factor-authentication-get-started-portal/secquestion.png)


## Передаваемые сеансы

## SAML
Позволяет настроить пользовательский портал для приема утверждений от поставщика удостоверений с помощью SAML. Можно указать время ожидания сеанса, сертификат проверки и выход URL-адрес перенаправления при выходе из системы.

![SAML](./media/multi-factor-authentication-get-started-portal/saml.png)

## Надежные IP-адреса
На этой вкладке можно указать один IP-адрес или диапазоны IP-адресов, при входе с которых многофакторная проверка подлинности для пользователя не выполняется.

![Доверенные IP-адреса пользовательского портала](./media/multi-factor-authentication-get-started-portal/trusted.png)

## Самостоятельная регистрация пользователей
Если вы хотите, чтобы пользователи входили в систему и регистрировались, необходимо выбрать параметры «Разрешить пользователям вход в систему» и «Разрешить регистрацию пользователей». Помните, что выбранные параметры повлияют на процесс входа пользователя в систему.

Например, когда пользователь открывает пользовательский портал и нажимает кнопку «Вход», он перенаправляется на страницу настройки многофакторной проверки подлинности Azure. В зависимости от того, как вы настроили многофакторную проверку подлинности Azure, пользователь сможет выбрать свой способ проверки подлинности.

Если в качестве метода проверки подлинности был выбран или предварительно настроен голосовой звонок, пользователю будет предложено ввести свой основной номер телефона и, при необходимости, добавочный номер. Пользователю также можно разрешить ввести дополнительный номер телефона.

![Доверенные IP-адреса пользовательского портала](./media/multi-factor-authentication-get-started-portal/backupphone.png)

Если пользователь должен использовать ПИН-код при проверке подлинности, ему также будет предложено ввести ПИН-код. После ввода номера телефона или номеров телефонов и ПИН-кода (если используется) пользователь нажимает кнопку «Позвонить мне сейчас для проверки подлинности». После этого для проверки подлинности будет выполнен телефонный звонок на основной телефонный номер пользователя. Пользователь должен ответить на звонок, ввести свой ПИН-код (если используется) и нажать кнопку # для перехода к следующему этапу процесса самостоятельной регистрации.

Если в качестве метода проверки подлинности была выбрана или предварительно настроена проверка подлинности с помощью текстовых сообщений, пользователю будет предложено ввести номер мобильного телефона. Если пользователь должен использовать ПИН-код при проверке подлинности, ему также будет предложено ввести ПИН-код. После ввода номера телефона и ПИН-кода (если используется) пользователь нажимает кнопку «Отправить мне текстовое сообщение сейчас для проверки подлинности». После этого для проверки подлинности на основной телефонный номер пользователя будет отправлено текстовое сообщение. Пользователь должен получить текстовое сообщение с одноразовым паролем и ответить на него, указав этот одноразовый пароль и ПИН-код (если используется), для перехода к следующему этапу процесса самостоятельной регистрации.

![Текстовые сообщения пользовательского портала](./media/multi-factor-authentication-get-started-portal/text.png)

Если в качестве метода проверки подлинности была выбрана или предварительно настроена проверка подлинности с помощью мобильного приложения, пользователю будет предложено установить приложение многофакторной проверки подлинности Azure на мобильное устройство и создать код активации. После установки приложения Azure Multi-Factor Authentication пользователь нажимает кнопку «Создать код активации».

>[AZURE.NOTE]Для использования приложения Azure Multi-Factor Authentication пользователь должен включить push-уведомления для своего устройства.

На странице будут отображены код активации и URL-адрес, а также картинка со штрихкодом. Если пользователь должен использовать ПИН-код при проверке подлинности, ему также будет предложено ввести ПИН-код. Пользователь вводит код активации и URL-адрес в приложение Azure Multi-Factor Authentication или сканирует штрихкод с помощью сканера штрихкодов и нажимает кнопку «Активировать».

После завершения активации пользователь нажимает кнопку «Выполнить проверку подлинности сейчас». После этого будет выполнена многофакторная проверка подлинности с помощью мобильного приложения. Пользователь должен ввести свой ПИН-код (если используется) и нажать кнопку «Выполнить проверку подлинности» в своем мобильном приложении для перехода к следующему этапу процесса самостоятельной регистрации.


Если администраторы настроили использование секретных вопросов и ответов на сервере Azure Multi-Factor Authentication, пользователь будет перенаправлен на страницу «Секретные вопросы». Пользователю необходимо выбрать секретные вопросы и указать ответы на выбранные вопросы.

![Секретные вопросы пользовательского портала](./media/multi-factor-authentication-get-started-portal/secq.png)

На этом самостоятельная регистрация пользователя завершена. Пользователь вошел в пользовательский портал. В будущем пользователи могут войти на портал в любой момент для изменения своих номеров телефонов, ПИН-кодов, методов проверки подлинности и секретных вопросов, если это разрешено администраторами.

<!---HONumber=AcomDC_0921_2016-->