<properties 
	pageTitle="Переход с агента PhoneFactor на сервер Azure Multi-Factor Authentication" 
	description="В этом документе описывается, как приступить к работе с сервером Azure MFA и заменить старую версию агента PhoneFactor." 
	services="multi-factor-authentication" 
	documentationCenter="" 
	authors="billmath" 
	manager="stevenpo" 
	editor="curtland"/>

<tags 
	ms.service="multi-factor-authentication" 
	ms.workload="identity" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="08/24/2015" 
	ms.author="billmath"/>

# Переход с агента PhoneFactor на сервер Azure Multi-Factor Authentication

Чтобы перейти с агента PhoneFactor (до версии 5.x включительно) на сервер Azure Multi-Factor Authentication, необходимо сначала удалить агент PhoneFactor и все его компоненты. После этого можно устанавливать сервер Multi-Factor Authentication Server со всеми необходимыми компонентами.

## Переход с агента PhoneFactor на сервер Azure Multi-Factor Authentication
<ol>
<li>Сначала создайте резервную копию файла данных PhoneFactor. По умолчанию файл хранится в расположении C:\\Program Files\\PhoneFactor\\Data\\Phonefactor.pfdata.


<li>Если установлен пользовательский портал, сделайте вот что:</li>
<ol>
<li>Перейдите в папку установки и создайте резервную копию файла web.config. По умолчанию файл хранится в расположении C:\inetpub\wwwroot\PhoneFactor.</li>


<li>Если вы добавили на портал настраиваемые темы, создайте резервную копию настраиваемой папки, которая хранится в каталоге C:\inetpub\wwwroot\PhoneFactor\App_Themes.</li>


<li>Удалите пользовательский портал с помощью агента PhoneFactor (если портал установлен на том же сервере, что и агент PhoneFactor) или с помощью компонента «Программы и компоненты» в ОС Windows.</li></ol>




<li>Если установлена веб-служба мобильного приложения, сделайте вот что: <ol> <li>Перейдите в папку установки и создайте резервную копию файла web.config. По умолчанию файл хранится в расположении C:\\inetpub\\wwwroot\\PhoneFactorPhoneAppWebService.</li> <li>Удалите веб-службу мобильного приложения с помощью компонента «Программы и компоненты» в ОС Windows.</li></ol>

<li>Если установлен пакет SDK для веб-службы, удалите его либо с помощью агента PhoneFactor, либо с помощью компонента «Программы и компоненты» в ОС Windows.

<li>Удалите агент PhoneFactor с помощью компонента «Программы и компоненты» в ОС Windows.

<li>Установите сервер Multi-Factor Authentication. Обратите внимание, что путь установки берется из реестра предыдущей установки агента PhoneFactor, поэтому сервер должен установиться в то же расположение (например, C:\\Program Files\\PhoneFactor). В случае новой установки будет создан другой путь (например, C:\\Program Files\\Multi-Factor Authentication Server). Файл данных, оставшийся от агента PhoneFactor, будет обновлен во время установки, поэтому после установки нового сервера Multi-Factor Authentication ваши пользователи и параметры будут в сохранности.

<li>При появлении запроса активируйте сервер Multi-Factor Authentication и убедитесь, что он назначен правильной группе репликации.

<li>Если ранее был установлен пакет SDK для веб-службы, установите новый пакет SDK через пользовательский интерфейс сервера Multi-Factor Authentication. Обратите внимание, что теперь у виртуального каталога по умолчанию будет имя MultiFactorAuthWebServiceSdk, а не PhoneFactorWebServiceSdk. Если вы хотите использовать предыдущее имя, измените имя виртуального каталога на этапе установки. Если во время установки не изменять имя каталога по умолчанию, вам придется изменить URL-адрес во всех приложениях, которые ссылаются на пакет SDK для веб-службы (например, пользовательский портал и веб-служба мобильного приложения). Новый URL-адрес должен ссылаться на правильное расположение.

<li>Если пользовательский портал был ранее установлен на сервере с агентом PhoneFactor, установите новый пользовательский портал Multi-Factor Authentication через пользовательский интерфейс сервера Multi-Factor Authentication. Обратите внимание, что теперь у виртуального каталога по умолчанию будет имя MultiFactorAuth, а не PhoneFactor. Если вы хотите использовать предыдущее имя, измените имя виртуального каталога на этапе установки. Если во время установки не изменять имя каталога по умолчанию, щелкните значок пользовательского портала на сервере Multi-Factor Authentication и измените URL-адрес пользовательского портала на вкладке «Параметры».

<li>Если пользовательский портал и (или) веб-служба мобильного приложения были ранее установлены на сервере, отличном от PhoneFactor, сделайте вот что: <ol> <li>Перейдите в расположение установки (например, C:\\Program Files\\PhoneFactor) и скопируйте соответствующие установщики на другой сервер. Для пользовательского портала и веб-службы мобильного приложения существуют 32- и 64-разрядные установщики. Они называются MultiFactorAuthenticationUserPortalSetupXX.msi и MultiFactorAuthenticationMobileAppWebServiceSetupXX.msi соответственно.</li> <li>Чтобы установить пользовательский портал на веб-сервере, откройте командную строку от имени администратора и запустите файл MultiFactorAuthenticationUserPortalSetupXX.msi. Обратите внимание, что теперь у виртуального каталога по умолчанию будет имя MultiFactorAuth, а не PhoneFactor. Если вы хотите использовать предыдущее имя, измените имя виртуального каталога на этапе установки. Если во время установки не изменять имя каталога по умолчанию, щелкните значок пользовательского портала на сервере Multi-Factor Authentication и измените URL-адрес пользовательского портала на вкладке «Параметры». Новый URL-адрес следует сообщить всем существующим пользователям.</li> <li>Перейдите в расположение установки пользовательского портала (например, C:\\inetpub\\wwwroot\\MultiFactorAuth) и измените файл web.config. Скопируйте значения в разделах appSettings и applicationSettings из исходного файла web.config, резервная копия которого была создана до появления нового файла web.config. Если при установке пакета SDK для веб-службы вы оставили новое имя виртуального каталога по умолчанию, измените URL-адрес в разделе applicationSettings так, чтобы он указывал на правильное расположение. Если в предыдущем файле web.config были изменены еще какие-то значения по умолчанию, внесите такие же изменения в новый файл web.config.</li> <li>Чтобы установить веб-службу мобильного приложения на веб-сервер, откройте командную строку от имени администратора и запустите файл MultiFactorAuthenticationUserPortalSetupXX.msi. Обратите внимание, что теперь у виртуального каталога по умолчанию будет имя MultiFactorAuthMobileAppWebService, а не PhoneFactorPhoneAppWebService. Если вы хотите использовать предыдущее имя, измените имя виртуального каталога на этапе установки. Вы можете выбрать более короткое имя. Так пользователям было проще вводить его на своих мобильных устройствах. Если во время установки не изменять имя каталога по умолчанию, щелкните значок мобильного приложения на сервере Multi-Factor Authentication и измените URL-адрес веб-службы мобильного приложения на вкладке «Параметры».</li> <li>Перейдите в расположение установки веб-службы мобильного приложения (например, C:\\inetpub\\wwwroot\\MultiFactorAuthMobileAppWebService) и измените файл web.config. Скопируйте значения в разделах appSettings и applicationSettings из исходного файла web.config, резервная копия которого была создана до появления нового файла web.config. Если при установке пакета SDK для веб-службы вы оставили новое имя виртуального каталога по умолчанию, измените URL-адрес в разделе applicationSettings так, чтобы он указывал на правильное расположение. Если в предыдущем файле web.config были изменены еще какие-то значения по умолчанию, внесите такие же изменения в новый файл web.config.</li></ol>


 


 

<!---HONumber=Oct15_HO3-->