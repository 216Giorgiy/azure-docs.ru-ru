<properties
	pageTitle="Политики диспетчера ресурсов Azure | Microsoft Azure"
	description="В этом разделе описывается, как предотвращать нарушения в различных областях, таких как подписки, ресурсы и группы ресурсов, с помощью политик диспетчера ресурсов Azure."
	services="azure-resource-manager"
	documentationCenter="na"
	authors="ravbhatnagar"
	manager="ryjones"
	editor=""/>

<tags
	ms.service="azure-resource-manager"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="na"
	ms.date="10/06/2015"
	ms.author="gauravbh;tomfitz"/>

# Применение политик для управления ресурсами и контроля доступа

Теперь диспетчер ресурсов Azure позволяет управлять доступом с помощью пользовательских политик. Политика — это одно или несколько нарушений, которые можно предотвратить в определенной области. В данном случае областью может быть подписка, ресурс или группа ресурсов.

Политика — это система разрешений по умолчанию. Политика выполняется в соответствии с ее определением и назначением. Назначение политики позволяет указать, к какой области она должна будет применяться.

В этой статье мы продемонстрируем базовую структуру языка, который используется для создания политик. Затем мы рассмотрим применение этих политик в различных областях и, наконец, приведем несколько примеров решения этой задачи с помощью API REST. В ближайшем будущем будет также добавлена поддержка PowerShell.

## Распространенные сценарии

Один из распространенных сценариев — запрос тегов подразделений для осуществления взимания средств за использование. Организация может разрешить выполнение операций только при указании соответствующего места возникновения затрат; в противном случае запрос будет отклонен. Это позволит организации взимать оплату за произведенные операции по месту возникновения соответствующих затрат.

Другой типичный сценарий — это контроль за местами создания ресурсов. Кроме того, организация может контролировать доступ к ресурсам, разрешая подготовку только определенного типа ресурсов.

Таким же образом организации могут управлять каталогом услуг или применять желаемые соглашения об именовании ресурсов.

Политики позволяют легко реализовать эти сценарии, как описано ниже.

## Структура определения политики

Определение политики создается с использованием JSON. Оно состоит из одного или нескольких условий или логических операторов, определяющих действия и результат, который будет достигнут при выполнении этих условий.

Как правило, политика содержит следующие элементы.

**Условие или логические операторы** — содержит набор условий, которые могут управляться с помощью набора логических операторов.

**Результат** — описание результата, который будет получен при удовлетворении заданного условия — отказ или проверка. В случае проверки откроется журнал службы событий предупреждений. Например, администратор может создать политику, которая включает аудит, если какой-то пользователь создал большую виртуальную машину. После этого администратор может просмотреть журналы.

    {
      "if" : {
        <condition> | <logical operator>
      },
      "then" : {
        "effect" : "deny | audit"
      }
    }


## Логические операторы

Поддерживаются следующие логические операторы и синтаксис.

| Имя оператора | Синтаксис |
| :------------- | :------------- |
| Not | "not" : {&lt;condition&gt;} |
| И | "allOf" : [ {&lt;condition1&gt;},{&lt;condition2&gt;}] |
| Или | "anyOf" : [ {&lt;condition1&gt;},{&lt;condition2&gt;}] |


## Условия

Ниже перечислены поддерживаемые условия и синтаксис.

| Имя условия | Синтаксис |
| :------------- | :------------- |
| Равно | "equals" : "&lt;value&gt;" |
| Like | "like" : "&lt;value&gt;" |
| Содержит | "contains" : "&lt;value&gt;"|
| В | "in" : [ "&lt;value1&gt;","&lt;value2&gt;" ]|
| ContainsKey | "containsKey" : "&lt;keyName&gt;" |


## Поля и источники

Условия формируются с помощью полей и источников. Поддерживаются следующие поля и источники.

Поля: **name**, **kind**, **type**, **location**, **tags**, **tags.** *.

Источники: **action**.

## Примеры определения политик

Теперь посмотрим, как определить политику для реализации описанных выше сценариев.

### Взимание средств за использование: требовать теги отделов

Представленная ниже политика отклоняет все запросы без тега costCenter.

    {
      "if": {
        "not" : {
          "field" : "tags",
          "containsKey" : "costCenter"
        }
      },
      "then" : {
        "effect" : "deny"
      }
    }


### Соблюдение географических границ: контроль расположения ресурсов

Приведенный ниже пример показывает политику, которая отклоняет все запросы с размещением, отличным от Северной или Западной Европы.

    {
      "if" : {
        "not" : {
          "field" : "location",
          "in" : ["north europe" , "west europe"]
        }
      },
      "then" : {
        "effect" : "deny"
      }
    }

### Контроль служб: выбор каталога служб

В представленном ниже примере показано, как использовать источник. В нем указано, что допускаются только службы типа Microsoft.Resources/*, Microsoft.Compute/*, Microsoft.Storage/*, Microsoft.Network/*. Остальные службы не отклоняются.

    {
      "if" : {
        "not" : {
          "anyOf" : [
            {
              "source" : "action",
              "like" : "Microsoft.Resources/*"
            },
            {
              "source" : "action",
              "like" : "Microsoft.Compute/*"
            },
            {
              "source" : "action",
              "like" : "Microsoft.Storage/*"
            },
            {
              "source" : "action",
              "like" : "Microsoft.Network/*"
            }
          ]
        }
      },
      "then" : {
        "effect" : "deny"
      }
    }

### Соглашение об именовании

В приведенном ниже примере показано, как использовать знак подстановки, который поддерживается условием like. Это условие означает, что, в случае если имя не соответствует заданному шаблону (namePrefix*nameSuffix), запрос будет отклонен.

    {
      "if" : {
        "not" : {
          "field" : "name",
          "like" : "namePrefix*nameSuffix"
        }
      },
      "then" : {
        "effect" : "deny"
      }
    }

## Назначение политики

Политики могут применяться к различным областям, включая подписки, ресурсы и группы ресурсов. Политики наследуются всеми дочерними ресурсами. Это значит, что политики, применяемые к группе ресурсов, применяются также ко всем ресурсам в этой группе.

## Создание политики

В этом разделе подробно описано, как создавать политики с использованием API REST.

### Создание определения политики с использованием API REST

Для создания политики можно использовать [API REST для определения политик](https://msdn.microsoft.com/library/azure/mt588471.aspx). API REST позволяет создавать и удалять определения политик и получать сведения о существующих определениях.

Чтобы создать новую политику, выполните следующую команду:

    PUT https://management.azure.com/subscriptions/{subscription-id}/providers/Microsoft.authorization/policydefinitions/{policyDefinitionName}?api-version={api-version}

Тело запроса будет похоже на следующее:

    {
      "properties":{
        "policyType":"Custom",
        "description":"Test Policy",
        "policyRule":{
          "if" : {
            "not" : {
              "field" : "tags",
              "containsKey" : "costCenter"
            }
          },
          "then" : {
            "effect" : "deny"
          }
        }
      },
      "id":"/subscriptions/########-####-####-####-############/providers/Microsoft.Authorization/policyDefinitions/testdefinition",
      "type":"Microsoft.Authorization/policyDefinitions",
      "name":"testdefinition"
    }


Определение политики может быть задано как в показанном выше примере. В качестве версии API укажите *2015-10-01-preview*. Примеры и дополнительные сведения см. в разделе [API REST для определения политик](https://msdn.microsoft.com/library/azure/mt588471.aspx).

## Применение политики

### Назначение политики с использованием API REST

Определение политики можно применить к требуемой области с помощью [API REST для назначения политик](https://msdn.microsoft.com/library/azure/mt588466.aspx). API REST позволяет создавать и удалять назначения политик и получать сведения о существующих назначениях.

Чтобы создать назначение политики, выполните следующую команду:

    PUT https://management.azure.com /subscriptions/{subscription-id}/providers/Microsoft.authorization/policyassignments/{policyAssignmentName}?api-version={api-version}

{policy-assignment} — это имя назначения политики. В качестве версии API укажите *2015-10-01-preview*.

Тело запроса будет похоже на следующее:

    {
      "properties":{
        "displayName":"VM_Policy_Assignment",
        "policyDefinitionId":"/subscriptions/########/providers/Microsoft.Authorization/policyDefinitions/testdefinition",
        "scope":"/subscriptions/########-####-####-####-############"
      },
      "id":"/subscriptions/########-####-####-####-############/providers/Microsoft.Authorization/policyAssignments/VMPolicyAssignment",
      "type":"Microsoft.Authorization/policyAssignments",
      "name":"VMPolicyAssignment"
    }

Примеры и дополнительные сведения см. в разделе [API REST для назначения политик](https://msdn.microsoft.com/library/azure/mt588466.aspx).

<!---HONumber=Oct15_HO2-->