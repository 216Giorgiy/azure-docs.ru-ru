<properties linkid="develop-nodejs-common-tasks-working-with-node-modules" urlDisplayName="Работа с модулями Node.js" pageTitle="Работа с модулями Node.js" metaKeywords="" description="" metaCanonical="" services="" documentationCenter="Node.js" title="Использование модулей Node.js с приложениями Azure" authors="larryfr" solutions="" manager="paulettm" editor="mollybos" />





# Использование модулей Node.js с приложениями Azure

Этот документ содержит указания по использованию модулей Node.js с приложениями, размещенными в Azure. В нем описывается, как обеспечить использование конкретной версии модуля приложением и как использовать собственные модули вместе с Azure.

Если вы уже знакомы с использованием модулей Node.js, файлов **package.json** и **npm-shrinkwrap.json**, ниже приводится краткая сводка по тем вопросам, которые рассматриваются в данной статье:

* Веб-сайты Azure могут считывать файлы **package.json** и **npm-shrinkwrap.json** и устанавливать модули на основании записей в этих файлах.
* Облачные службы Azure ожидают, что все модули должны быть установлены в среде разработки, а каталог **node\_modules** должен быть включен в пакет развертывания.

<div class="dev-callout">
<strong>Примечание.</strong>
<p>В данной статье не рассматриваются виртуальные машины Azure, так как процедура развертывания в виртуальной машине будет зависеть от операционной системы, размещенной в этой виртуальной машине.</p>
</div>

<div class="dev-callout">
<strong>Примечание.</strong>
<p>Можно включить поддержку установки модулей с помощью файлов <b>package.json</b> или <b>npm-shrinkwrap.json</b> в Azure, однако для этого требуется настройка скриптов по умолчанию, используемых проектами облачных служб. Пример того, как это сделать, см. в разделе <a href="http://nodeblog.azurewebsites.net/startup-task-to-run-npm-in-azure">Задача запуска Azure для выполнения установки npm во избежание развертывания модулей узла </a></p>
</div>

##Модули Node.js

Модули — это загружаемые пакеты JavaScript, предоставляющие вашему приложению определенные функциональные возможности. Модуль обычно устанавливается с помощью средства командной строки **npm**, однако некоторые из них (например, HTTP-модуль) предоставляются в составе основного пакета Node.js.

При установке модулей они сохраняются в каталоге **node\_modules**, находящемся в корне структуры каталогов приложения. Каждый модуль в каталоге **node\_modules** использует свой собственный каталог **node\_modules**, в котором содержатся все модули, от которых он зависит, и это снова повторяется для каждого модуля до самого конца цепочки зависимостей. Это позволяет каждому установленному модулю иметь собственные требования к версиям модулей, от которых он зависит, однако это может привести к слишком большому размеру структуры каталогов.

При развертывании каталога **node\_modules** в составе приложения он увеличивает размер развертывания по сравнению с использованием файла **package.json** или **npm-shrinkwrap.json**; однако это гарантирует, что в рабочей среде используются те же версии модулей, что и в среде разработки.

###Собственные модули

Хотя большинство модулей представляют собой просто текстовые файлы JavaScript, некоторые модули являются двоичными образами, предназначенными для конкретной платформы. Такие модули обычно компилируются во время установки, обычно для этого используется Python и node-gyp. Одно ограничение компонента веб-сайтов Azure заключается в том, что хотя он изначально понимает, как установить указанные в файле **package.json** или **npm-shrinkwrap.json** модули, он не предоставляет Python или node-gyp и поэтому не может создавать собственные модули.

Поскольку облачные служб Azure полагаются на развертывание папки **node\_modules** в составе приложения, любой собственный модуль, входящей в состав установленных модулей, должен работать в облачной службе при условии, что он был установлен и скомпилирован на системе разработки Windows. 

Собственные модули не поддерживаются для веб-сайтов Azure. Некоторые модули, например JSDOM и MongoDB имеют дополнительные собственные зависимости и будут работать с приложениями, размещенными на веб-сайтах Azure.

###Использование файла package.json

Файл **package.json** — это способ указать зависимости верхнего уровня, необходимые вашему приложению для того, чтобы платформа размещения могла установить зависимости, а не требовать от вас включить папку **node\_packages** в состав развертывания. После развертывания приложения используется команда **npm install**, чтобы проанализировать файл **package.json** и установить все указанные зависимости.

Во время разработки можно использовать параметры **--save**, **--save-dev** или **--save-optional** при установке модулей, чтобы автоматически добавить запись для модуля в файл **package.json**. Дополнительные сведения см. в разделе с описанием [npm-install](https://npmjs.org/doc/install.html).

Одна потенциальная проблема с файлом **package.json** заключается в том, что он указывает версию только для зависимостей верхнего уровня. Каждый установленный модуль может указать или не указывать версию модулей, от которых он зависит, поэтому в результате вы можете получить иную цепочку зависимостей, чем в среде разработки. 

> [WACOM.NOTE]
> Если при развертывании на веб-сайте Azure ваш файл <b>package.json</b> ссылается на собственный модуль, при публикации приложения с использованием Git появится сообщение об ошибке следующего вида:

>		npm ERR! module-name@0.6.0 install: 'node-gyp configure build'

>		npm ERR! 'cmd "/c" "node-gyp configure build"' failed with 1	


###Использование файла npm-shrinkwrap.json

Файл **npm-shrinkwrap.json** представляет собой попытку устранения ограничений управления версиями модуля для файла **package.json**. Хотя файл **package.json** содержит только версии модулей верхнего уровня, файл **npm-shrinkwrap.json** содержит требования версиям для всей цепочки зависимостей модулей.

Когда приложение будет готово к перемещению в рабочую среду, можно заблокировать требования к версии и создать файл **npm-shrinkwrap.json** с помощью команды **npm shrinkwrap**. При этом будут использоваться версии, установленные в папке **node\_modules**, а их запись будет производиться в файл **npm-shrinkwrap.json**. После развертывания приложения в среде внешнего размещения используется команда **npm install**, чтобы проанализировать файл **npm-shrinkwrap.json** и установить все указанные зависимости. Дополнительные сведения см. в разделе с описанием [npm-install](https://npmjs.org/doc/install.html).

> [WACOM.NOTE]
>Если при развертывании на веб-сайте Azure ваш файл <b>npm-shrinkwrap.json</b> ссылается на собственный модуль, при публикации приложения с использованием Git появится сообщение об ошибке следующего вида:
		
>		npm ERR! module-name@0.6.0 install: 'node-gyp configure build'

>		npm ERR! 'cmd "/c" "node-gyp configure build"' failed with 1


##Дальнейшие действия

Теперь, когда вы научились использовать модули Node.js с Azure, узнайте, как [указать версию Node.js], [построить и развернуть веб-сайт Node.js] и [использовать средства командной строки Azure для Mac и Linux].

[указать версию Node.js]: /ru-ru/develop/nodejs/common-tasks/specifying-a-node-version/
[использовать средства командной строки Azure для Mac и Linux]: /ru-ru/develop/nodejs/how-to-guides/command-line-tools/
[Построение и развертывание веб-сайта Node.js]: /ru-ru/develop/nodejs/tutorials/create-a-website-(mac)/
[Веб-приложение Node.js с хранилищем в MongoDB (MongoLab)]: /ru-ru/develop/nodejs/tutorials/website-with-mongodb-mongolab/
[Публикация с Git]: /ru-ru/develop/nodejs/common-tasks/publishing-with-git/
[построить и развернуть веб-сайт Node.js]: /ru-ru/develop/nodejs/tutorials/getting-started/



