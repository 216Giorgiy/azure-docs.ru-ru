<properties pageTitle="Работа с модулями Node.js" description="Узнайте, как работать с модулями Node.js при использовании службы приложений или облачных служб Azure." services="" documentationCenter="nodejs" authors="rmcmurray" manager="wpickett" editor=""/>

<tags ms.service="multiple" ms.workload="na" ms.tgt_pltfrm="na" ms.devlang="nodejs" ms.topic="article" ms.date="06/24/2016" ms.author="robmcm"/>





# Использование модулей Node.js с приложениями Azure

Этот документ содержит указания по использованию модулей Node.js с приложениями, размещенными в Azure. В нем описывается, как обеспечить использование конкретной версии модуля приложением и как использовать собственные модули вместе с Azure.

Если вы уже знакомы с использованием модулей Node.js, файлов **package.json** и **npm-shrinkwrap.json**, ниже приводится краткая сводка по тем вопросам, которые рассматриваются в данной статье:

* Служба приложений Azure может считывать файлы **package.json** и **npm-shrinkwrap.json** и устанавливать модули на основании записей в этих файлах.
* Облачные службы Azure ожидают, что все модули должны быть установлены в среде разработки, а каталог **node\_modules** должен быть включен в пакет развертывания. Можно включить поддержку установки модулей с помощью файлов **package.json** или **npm-shrinkwrap.json** в облачных службах, однако для этого требуется настройка сценариев по умолчанию, используемых проектами облачных служб. Пример того, как это сделать, см. в разделе [Задача запуска Azure для выполнения установки npm во избежание развертывания модулей узла](https://github.com/woloski/nodeonazure-blog/blob/master/articles/startup-task-to-run-npm-in-azure.markdown).

> [AZURE.NOTE] В данной статье не рассматриваются виртуальные машины Azure, так как процедура развертывания в виртуальной машине будет зависеть от операционной системы, размещенной в этой виртуальной машине.

##Модули Node.js

Модули — это загружаемые пакеты JavaScript, предоставляющие вашему приложению определенные функциональные возможности. Модуль обычно устанавливается с помощью средства командной строки **npm**, однако некоторые из них (например, HTTP-модуль) предоставляются в составе основного пакета Node.js.

При установке модулей они сохраняются в каталоге **node\_modules**, находящемся в корне структуры каталогов приложения. У каждого модуля в каталоге **node\_modules** есть собственный каталог **node\_modules**, который содержит все модули, от которых он зависит. Такие каталоги есть у каждого модуля в цепочке зависимостей. Это позволяет каждому установленному модулю иметь свои требования к версии модулей, от которых он зависит, но в то же время может привести к большому разрастанию структуры каталогов.

При развертывании каталога **node\_modules** в составе приложения он увеличивает размер развертывания по сравнению с использованием файла **package.json** или **npm-shrinkwrap.json**, однако это гарантирует, что в рабочей среде используются те же версии модулей, что и в среде разработки.

###Собственные модули

Хотя большинство модулей представляют собой просто текстовые файлы JavaScript, некоторые модули являются двоичными образами, предназначенными для конкретной платформы. Такие модули обычно компилируются во время установки, обычно для этого используется Python и node-gyp. Поскольку облачные службы Azure полагаются на развертывание папки **node\_modules** в составе приложения, любой собственный модуль, входящий в состав установленных модулей, должен работать в облачной службе при условии, что он был установлен и скомпилирован на системе разработки Windows.

Служба приложений Azure не поддерживает все собственные модули и может сообщать об ошибках при компиляции модулей с очень специфическими предварительными требованиями. Хотя у некоторых популярных модулей, например MongoDB, имеются дополнительные собственные зависимости, и они прекрасно работают без них, было найдено два обходных решения, подходящих почти для всех собственных модулей, доступных в настоящее:

* Выполните **npm install** на компьютере под управлением Windows, на котором установлены все необходимые компоненты собственного модуля. Затем разверните созданную папку **node\_modules** как часть приложения в службе приложений Azure.
* Службу приложений Azure можно настроить для выполнения пользовательских сценариев Bash или сценариев оболочки во время развертывания, что дает возможность выполнять пользовательские команды и точно настроить способ выполнения **npm install**. Видео о том, как это сделать: [Пользовательские сценарии развертывания веб-сайтов с использованием Kudu].

###Использование файла package.json

Файл **package.json** — это способ указать зависимости верхнего уровня, необходимые вашему приложению для того, чтобы платформа размещения могла установить зависимости, а не требовать от вас включить папку **node\_packages** в состав развертывания. После развертывания приложения используется команда **npm install**, чтобы проанализировать файл **package.json** и установить все указанные зависимости.

Во время разработки можно использовать параметры **--save**, **--save-dev** или **--save-optional** при установке модулей, чтобы автоматически добавить запись для модуля в файл **package.json**. Дополнительные сведения см. в разделе с описанием [npm-install](https://docs.npmjs.com/cli/install).

Одна потенциальная проблема с файлом **package.json** заключается в том, что он указывает версию только для зависимостей верхнего уровня. Каждый установленный модуль может указать или не указывать версию модулей, от которых он зависит, поэтому в результате вы можете получить иную цепочку зависимостей, чем в среде разработки.

> [AZURE.NOTE]
Если при развертывании приложения в службе приложений Azure ваш файл <b>package.json</b> ссылается на собственный модуль, вы увидите ошибку, аналогичную той, что возникает при публикации приложения с помощью Git.

>		npm ERR! module-name@0.6.0 install: 'node-gyp configure build'

>		npm ERR! 'cmd "/c" "node-gyp configure build"' failed with 1


###Использование файла npm-shrinkwrap.json

Файл **npm-shrinkwrap.json** представляет собой попытку устранения ограничений управления версиями модуля для файла **package.json**. Хотя файл **package.json** содержит только версии модулей верхнего уровня, файл **npm-shrinkwrap.json** содержит требования версиям для всей цепочки зависимостей модулей.

Когда приложение будет готово к перемещению в рабочую среду, можно заблокировать требования к версии и создать файл **npm-shrinkwrap.json** с помощью команды **npm shrinkwrap**. При этом будут использоваться версии, установленные в папке **node\_modules**, а их запись будет производиться в файл **npm-shrinkwrap.json**. После развертывания приложения в среде внешнего размещения используется команда **npm install**, чтобы проанализировать файл **npm-shrinkwrap.json** и установить все указанные зависимости. Дополнительные сведения см. в разделе [npm-shrinkwrap](https://docs.npmjs.com/cli/shrinkwrap).

> [AZURE.NOTE]
Если при развертывании приложения в службе приложений Azure ваш файл <b>npm-shrinkwrap.json</b> ссылается на собственный модуль, вы увидите ошибку, аналогичную той, что возникает при публикации приложения с помощью Git.

>		npm ERR! module-name@0.6.0 install: 'node-gyp configure build'

>		npm ERR! 'cmd "/c" "node-gyp configure build"' failed with 1


##Дальнейшие действия

Теперь, когда вы научились использовать модули Node.js с Azure, узнайте, как [указать версию Node.js], [создать и развернуть веб-приложение Node.js] и [использовать интерфейс командной строки Azure для Mac и Linux].

Дополнительную информацию см. в [Центре разработчика Node.js](/develop/nodejs/).

[указать версию Node.js]: nodejs-specify-node-version-azure-apps.md
[использовать интерфейс командной строки Azure для Mac и Linux]: xplat-cli-install.md
[создать и развернуть веб-приложение Node.js]: web-sites-nodejs-develop-deploy-mac.md
[Node.js Web Application with Storage on MongoDB (MongoLab)]: store-mongolab-web-sites-nodejs-store-data-mongodb.md
[Build and deploy a Node.js application to an Azure Cloud Service]: cloud-services-nodejs-develop-deploy-app.md
[Пользовательские сценарии развертывания веб-сайтов с использованием Kudu]: /documentation/videos/custom-web-site-deployment-scripts-with-kudu/

<!---HONumber=AcomDC_0803_2016-->