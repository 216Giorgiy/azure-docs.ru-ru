<properties urlDisplayName="Working with Node.js Modules" pageTitle="Работа с модулями Node.js" metaKeywords="" description="" metaCanonical="" services="" documentationCenter="nodejs" title="Using Node.js Modules with Azure applications" authors="larryfr" solutions="" manager="wpickett" editor="mollybos" />

<tags ms.service="na" ms.workload="na" ms.tgt_pltfrm="na" ms.devlang="nodejs" ms.topic="article" ms.date="09/17/2014" ms.author="larryfr" />





# Использование модулей Node.js с приложениями Azure

В этом документе описано использование модулей Node.js с приложениями, размещенными на Azure. Здесь рассказано, как убедиться, что ваше приложение использует конкретную версию модуля, а также использовать собственные модули вместе с Azure.

Если вы уже знакомы с принципами использования модулей Node.js и файлов **package.json** и **npm-shrinkwrap.json**, обратите внимание на общий обзор этой статьи, приведенный ниже:

* Веб-сайты Azure распознают файлы **package.json** и **npm-shrinkwrap.json**, и могут устанавливать модули, основываясь на записях в этих файлах.
* Облачные службы Azure ожидают, что в среде разработки будут установлены все модули, а каталог **node\_modules** будет включен в пакет развертывания.

<div class="dev-callout">
<strong>Примечание.</strong>
<p>В данной статье не рассматриваются виртуальные машины Azure, так как процедура развертывания в виртуальной машине будет зависеть от операционной системы, размещенной в этой виртуальной машине.</p>
</div>

<div class="dev-callout">
<strong>Примечание.</strong>
<p>Можно включить поддержку установки модулей с помощью файлов <b>package.json</b> или <b>npm-shrinkwrap.json</b> в Azure, однако для этого требуется настройка скриптов по умолчанию, используемых проектами облачных служб. Пример того, как это сделать, см. в разделе <a href="http://nodeblog.azurewebsites.net/startup-task-to-run-npm-in-azure">Задача запуска Azure для выполнения установки npm во избежание развертывания модулей узла </a></p>
</div>

##Модули Node.js

Модули - это загружаемые пакеты JavaScript, дающую приложению определенную функциональность. Модуль обычно устанавливается с помощью программы командной строки **npm**, но некоторые из них (например, модуль http) входят в состав главного пакета Node.js.

После установки модули хранятся в каталоге **node\_modules** в корне структуры каталогов вашего приложения. В каждом модуле в каталоге **node\_modules** содержится свой каталог **node\_modules**, в котором находятся модули-зависимости, и этот процесс повторяется дальше по всей цепочке зависимостей. Это позволяет каждому установленному модулю иметь свои требования к версии модулей, от которых он зависит, но в то же время может привести к большому разрастанию структуры каталогов.

При развертывании каталога **node\_modules** как части вашего приложения размер развертывания будет увеличен по сравнению с вариантом при использовании файла **package.json** или **npm-shrinkwrap.json**, но такой метод гарантирует, что в производстве будут использованы те же версии модулей, что и в разработке.

###Собственные модули

Большинство модулей - обычные текстовые файлы JavaScript, но встречаются бинарные образы, специфичные для некоторых платформ. Такие модули обычно компилируются во время установки, обычно для этого используется Python и node-gyp. У веб-сайтов Azure имеется одно ограничение: несмотря на то, что они изначально знают, как устанавливать модули, указанные в файле **package.json** или **npm-shrinkwrap.json**, в них нет Python и node-gyp и собирать собственные модули они не могут.

Поскольку облачные службы Azure требуют, чтобы для приложения была развернута папка **node\_modules**, любой собственный модуль, включенный как часть установленных модулей, должен работать в облачной службе, если он был установлен и скомпилирован в системе разработки под Windows. 

Собственные модули веб-сайтами Azure не поддерживаются. Некоторые модули, такие как JSDOM и MongoDB, имеют необязательные собственные зависимости и будут работать с приложениями, размещенными на веб-сайтах Azure.

###Использование файла package.json

Файл **package.json** позволяет определить зависимости верхнего уровня, требуемые вашему приложению для того, чтобы платформа размещения могла установить зависимости, а не требовала от вас включить в комплект развертывания приложения папку **node\_packages**. После того, как приложение развернуто, используется команда **npm install**для анализа файла **package.json** и установки всех перечисленных зависимостей.

В ходе разработки при установке модулей можно использовать параметры **--save**, **--save-dev** и **--save-optional**, чтобы автоматически добавлять строку для модуля в файл **package.json**. Подробную информацию см. в разделе [npm-install](https://npmjs.org/doc/install.html).

В особенностях формата файла **package.json** скрыта потенциальная проблема: он задает версии только для зависимостей верхнего уровня. Каждый установленный модуль может указать или не указывать версию модулей, от которых он зависит, поэтому в результате вы можете получить иную цепочку зависимостей, чем в среде разработки. 

> [WACOM.NOTE]
> Если при развертывании приложения на веб-сайтах Azure Webite ваш файл <b>package.json</b> ссылается на собственный модуль, вы увидите ошибку, аналогичную той, что возникает при публикации приложения с помощью Git:

>		npm ERR! module-name@0.6.0 install: 'node-gyp configure build'

>		npm ERR! 'cmd "/c" "node-gyp configure build"' failed with 1	


###Использование файла npm-shrinkwrap.json

Файл **npm-shrinkwrap.json** - попытка справиться с ограничениями на номера версий в файле **package.json**. Хотя в файл **package.json** включены только версии для модулей верхнего уровня, в файле **npm-shrinkwrap.json** содержатся требования к версиям для всей цепочки зависимостей модуля.

Когда будет готова рабочая версия вашего приложения, вы сможете зафиксировать требования к версиям и создать файл **npm-shrinkwrap.json**, используя команду **npm shrinkwrap**. При этом будут использованы версии, установленные в данный момент в папке **node\_modules**, они будут записаны в файл **npm-shrinkwrap.json**. После развертывания приложения в среде внешнего размещения используется команда **npm install**, чтобы проанализировать файл **npm-shrinkwrap.json** и установить все указанные зависимости. Подробную информацию см. в разделе [npm-install](https://npmjs.org/doc/install.html).

> [WACOM.NOTE]
>Если при развертывании приложения на веб-сайтах Azure Webite ваш файл <b>npm-shrinkwrap.json</b> ссылается на собственный модуль, вы увидите ошибку, аналогичную той, что возникает при публикации приложения с помощью Git:
		
>		npm ERR! module-name@0.6.0 install: 'node-gyp configure build'

>		npm ERR! 'cmd "/c" "node-gyp configure build"' failed with 1


##Дальнейшие действия

Теперь, когда вы знаете, как использовать модули Node.js с Azure, вам следует узнать, как [задавать версию Node.js], [собирать и развертывать веб-сайт на Node.js] и [использовать инструментарий командной строки Azure для Mac и Linux].

[Указание версии Node.js]: /ru-ru/documentation/articles/nodejs-specify-node-version-azure-apps/
[Использование средств командной строки Azure для Mac и Linux]: /ru-ru/documentation/articles/xplat-cli/
[Построение и развертывание веб-сайта Node.js]: /ru-ru/documentation/articles/web-sites-nodejs-develop-deploy-mac/
[Веб-приложение Node.js с хранилищем в MongoDB (MongoLab)]: /ru-ru/documentation/articles/store-mongolab-web-sites-nodejs-store-data-mongodb/
[Публикация с Git]: /ru-ru/documentation/articles/web-sites-publish-source-control/
[Построение и развертывание приложения Node.js в облачной службе Azure]: /ru-ru/documentation/articles/cloud-services-nodejs-develop-deploy-app/


