<properties 
	pageTitle="Использование межплатформенного интерфейса командной строки Microsoft Azure совместно с диспетчером ресурсов" 
	description="Использование кроссплатформенного интерфейса командной строки Microsoft Azure совместно с диспетчером ресурсов" 
	editor="tysonn" 
	manager="timlt" 
	documentationCenter="" 
	authors="squillace" 
	services=""/>

<tags 
	ms.service="multiple" 
	ms.workload="multiple" 
	ms.tgt_pltfrm="command-line-interface" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="02/05/2015" 
	ms.author="rasquill"/>

#Использование межплатформенного интерфейса командной строки Microsoft Azure совместно с диспетчером ресурсов

<div class="dev-center-tutorial-selector sublanding"><a href="/documentation/articles/powershell-azure-resource-manager.md" title="Windows PowerShell">Windows PowerShell</a><a href="/documentation/articles/xplat-cli-azure-resource-manager.md" title="Cross-Platform CLI" class="current">Межплатформенный интерфейс командной строки</a></div>

Из этой статьи вы узнаете, как использовать межплатформенный интерфейс командной строки (xplat-cli) Azure для работы с диспетчером ресурсов. 

>[AZURE.NOTE] Диспетчер ресурсов находится в режиме предварительного просмотра, а не предоставляют широкие возможности управления управления службами Azure. 
>
> Если еще не установлен и настроен xplat-cli, см. раздел [Установка и настройка интерфейса командной строки Microsoft Azure межплатформенный][xplatsetup] дополнительные шаги по установке, настройке и использованию xplat-cli.


##Диспетчер ресурсов

Диспетчер ресурсов позволяет управлять группой _ресурсов_ (управляемые пользователем сущности, такие как сервер базы данных, база данных или веб-сайт) как одной логической единицей или _группой ресурсов_. Например группа ресурсов может содержать веб-сайта и базы данных SQL как ресурсы.

Для поддержки более декларативного способа описания изменений ресурсов в группе ресурсов, диспетчер ресурсов использует *templates*, представляющие собой документы JSON. Язык шаблонов также позволяет описывать параметры, которые могут заполняться, будучи встроенными, при выполнении команды либо могут храниться в отдельном файле JSON. Это позволяет легко создавать новые ресурсы с помощью одного и того же шаблона, просто предоставляя различные параметры. Например, шаблон, создающий веб-сайт, будет иметь параметры для имени сайта, области размещения веб-сайта и другие общие параметры.

>[AZURE.NOTE] Особенности языка шаблонов не документированы в данный момент. При появлении соответствующей документации этот раздел будет обновлен для указания ссылки на справочную документацию.
>
> Тем не менее, можно использовать `azure group template download` для загрузки и изменения шаблонов, предоставляемых корпорацией Майкрософт и партнерами из коллекции шаблонов.

Когда шаблон используется для изменения или создания группы, создается _deployment_, которое затем применяется к этой группе.

##Проверка подлинности

В настоящее время работы с диспетчером ресурсов через интерфейс xplat-cli требует проверки подлинности в Microsoft Azure с помощью рабочей или школьной учетной записи. Проверка подлинности с использованием учетной записи Майкрософт или сертификата, установленного через файл с расширением PUBLISHSETTINGS, работать не будет.

Дополнительные сведения о проверке подлинности с использованием учетной записи организации см. в разделе [Установка и настройка интерфейса командной строки Microsoft Azure межплатформенный][xplatsetup].

##Поиск и настройка шаблона группы ресурсов

1. Поскольку режим диспетчера ресурсов не включен по умолчанию, необходимо использовать следующую команду для включения команд диспетчера ресурсов xplat-cli.

		azure config mode arm

	>[AZURE.NOTE] Режим диспетчера ресурсов и режим управления службами Azure являются взаимоисключающими. То есть ресурсами, созданными в одном из режимов, нельзя управлять из другого режима.

2. При работе с шаблонами можно создавать собственные шаблоны или использовать шаблоны из коллекции шаблонов. В этом случае воспользуемся одним из коллекции шаблонов. Чтобы получить список доступных шаблонов в коллекции, введите следующую команду. (Так как имеются тысячи шаблонов, убедитесь, что для разбиения по страницам результаты или использовать **grep** или **findstr**[в Windows] или избранные команде строку поиска, чтобы найти интересующие шаблоны. Кроме того, можно использовать **--json** параметр и загрузить весь список в формате JSON для упрощения поиска. В следующем примере используется шаблон называется **предварительного просмотра Microsoft.WebSiteSQLDatabase.0.2.6**.)	

		azure group template list

	Ответ будет содержать издателя и имя шаблона и появится следующее (хотя будет гораздо более).

		data:    Publisher               Name
		data:    ----------------------------------------------------------------------------
		data:    Microsoft               Microsoft.WebSite.0.1.0-preview1
		data:    Microsoft               Microsoft.PHPStarterKit.0.1.0-preview1
		data:    Microsoft               Microsoft.HTML5EmptySite.0.1.0-preview1
		data:    Microsoft               Microsoft.ASPNETEmptySite.0.1.0-preview1
		data:    Microsoft               Microsoft.WebSiteMySQLDatabase.0.1.0-preview1

3. Для просмотра сведений о шаблон, который будет создан на веб-сайт Azure, используйте следующую команду.

		azure group template show Microsoft.WebSiteSQLDatabase.0.2.6-Предварительный просмотр

	Возвращается описательная информация о шаблоне. 

4. После выбора шаблона (**Microsoft.WebSiteSQLDatabase.0.2.6 Предварительный просмотр шаблона azure группы**), его можно загрузить с помощью следующей команды.

		azure group template download Microsoft.WebSiteSQLDatabase.0.2.6-preview

	Загрузка шаблона позволяет настраивать его в соответствии с актуальными требованиями. Например, можно добавить в шаблон другой ресурс.

	>[AZURE.NOTE] Если изменить шаблон, используйте `azure group template validate` команду, чтобы проверить шаблон перед его использованием для создания или изменения существующей группы ресурсов.

5. Чтобы настроить шаблон группы ресурсов для использования, откройте файл шаблона в текстовом редакторе. Примечание **параметры** коллекции JSON в верхней. Она содержит список параметров, которые необходимы шаблону для создания описанных в нем ресурсов. Некоторые параметры, такие как **sku**, имеют значения по умолчанию, другие просто указывают тип значения, например **siteName**. 
	
	При использовании шаблона можно задать параметры в составе параметров командной строки либо указать файл со значениями параметров. В любом случае параметры должны быть в формате JSON и необходимо предоставить свои собственные значения для этих клавиш, которые не имеют значения по умолчанию.

	Например, чтобы создать файл, содержащий параметры для **Microsoft.WebSiteSQLDatabase.0.2.6 просмотра** шаблон, используйте следующие данные для создания файла с именем **params.json**. Замените значения ниже, начиная с **_My_** например **_MyWebSite_** собственными значениями. Значение **siteLocation** должно описывать ближний к вам регион Azure, например **Северная Европа** или **Юго-Центральный регион США**. (В этом примере используется **Запад США**)

		{
		  "siteName": {
		    "value": "MyWebSite"
		  },
		  "hostingPlanName": {
		    "value": "MyHostingPlan"
		  },
		  "siteLocation": {
		    "value": "West US"
		  },
		  "serverName": {
		    "value": "MySQLServer"
		  },
		  "serverLocation": {
		    "value": "West US"
		  },
		  "administratorLogin": {
		    "value": "MySQLAdmin"
		  },
		  "administratorLoginPassword": {
		    "value": "MySQLAdminPassword"
		  },
		  "databaseName": {
		    "value": "MySQLDB"
		  }
		}


1. После сохранения **params.json** файл, используйте следующую команду, чтобы создать новую группу ресурсов на основе шаблона. "-E" указывает **params.json** файла, созданного на предыдущем шаге. Замените **MyGroupName** с именем группы, которые вы хотите использовать, и **MyDataCenter** с **siteLocation** значения, указанного в вашей **params.json** файла параметров шаблона.

		azure group create MyGroupName "West US" -f Microsoft.WebSiteSQLDatabase.0.2.6-preview.json -d MyDeployment -e params.json

	>[AZURE.NOTE] Эта команда возвращает значение ОК после развертывания был загружен, но перед развертыванием были применены к ресурсам в группе. Чтобы проверить состояние развертывания, используйте следующую команду.
	>
	> `azure group deployment show MyGroupName MyDeployment`
	> 
	> **ProvisioningState** показывает состояние развертывания.
	> 
	> Если выясняется, что ваша конфигурация неправильная, и требуется остановить длительное развертывание, используйте следующую команду.
	> 
	> `azure group deployment stop MyGroupName MyDeployment`
	> 
	> Если не указать имя развертывания, оно будет создано автоматически на основе имени файла шаблона. Он возвращается как часть выходных данных `azure group create` команды.

3. Для просмотра группы используйте следующую команду.

		azure group show MyGroupName

	Эта команда возвращает сведения о ресурсах в группе. При наличии нескольких групп, можно использовать `azure group list` команду, чтобы получить список имен групп, а затем использовать `azure group show` для просмотра сведений о конкретной группе.

##Работа с ресурсами

Хотя шаблоны позволяют объявлять изменения в конфигурации для всей группы, иногда требуется работать исключительно с определенным ресурсом. Это можно сделать с помощью `azure resource` команды.

> [AZURE.NOTE] При использовании `azure resource` отличных от команды `list` команду, необходимо указать версию API ресурса, вы работаете с помощью "-о параметра. Если вы не уверены, какая именно версия API используется, обратитесь к файлу шаблона и найдите поле **apiVersion** для этого ресурса.

1. Чтобы получить список всех ресурсов в группе, используйте следующую команду.

		azure resource list MyGroupName

1. Для просмотра отдельных ресурсов, таких как веб-сайт, в группе используйте следующую команду.

		azure resource show MyGroupName MyWebSiteName Microsoft.Web/sites -o "2014-04-01"

	Обратите внимание на параметр **Microsoft.Web/sites**. Он указывает тип ресурса, для которого вы запрашиваете информацию. Если посмотреть на загруженный ранее файл шаблона, можно заметить, что это же значение используется для определения типа ресурса веб-сайта, описанного в шаблоне.

	Эта команда возвращает сведения, связанные с веб-сайтом. Например **имена узлов** поле должно содержать URL-адрес веб-сайта. Используйте его в браузере, чтобы убедиться в работоспособности веб-сайта.

2. При просмотре сведений о ресурса, часто бывает полезно использовать '--json' параметра, как это делает выходные данные более удобочитаемыми, поскольку некоторые значения являются вложенными структурами или коллекциями. Ниже показано возвращение результатов команды show в виде документа JSON.

		azure resource show MyGroupName MyWebSite Microsoft.Web/sites -o "2014-04-01" --json

	>[AZURE.NOTE] Данные JSON можно сохранить в файл с помощью &gt; по конвейеру выходные данные в файл. Например:
	>
	> `azure resource show MyGroupName MyWebSite Micrsoft.Web/sites --json > myfile.json`

3. Чтобы удалить существующий ресурс, используйте следующую команду.

		azure resource delete MyGroupName MyWebSite Microsoft.Web/sites -o "2014-04-01"

##Ведение журналов

Для просмотра сведений журнала на операции, выполняемые над группой, используйте `azure group log show` команды. По умолчанию при этом выводится последняя операция, выполненная с группой. Чтобы просмотреть все операции, используйте дополнительный параметр --all. Для последнего развертывания используйте параметр --last-deployment. Для конкретного развертывания используйте параметр --deployment и укажите имя развертывания. В следующем примере возвращается журнал всех операций, выполненных с группой 'MyGroup'.

	azure group log show mygroup --all

##Дальнейшие действия

* Дополнительные сведения об использовании интерфейса командной строки между различными платформами Azure см. [Установка и настройка интерфейса командной строки Microsoft Azure межплатформенный][xplatsetup].
* Сведения о работе с диспетчером ресурсов с помощью Windows Azure PowerShell см. в разделе [Приступая к работе с диспетчером ресурсов с помощью Windows PowerShell][psrm]

[signuporg]: http://www.windowsazure.com/documentation/articles/sign-up-organization/
[adtenant]: http://technet.microsoft.com/library/jj573650#createAzureTenant
[portal]: https://manage.windowsazure.com/
[xplatsetup]: /documentation/articles/xplat-cli/
[psrm]: http://go.microsoft.com/fwlink/?LinkId=394760

<!--HONumber=47-->
