<properties linkid="script-xplat-intro" urlDisplayName="Microsoft Azure Cross-Platform Command-Line Interface" pageTitle="Using Microsoft Azure Cross-Platform Command-Line Interface with the Resource Manager" title="Using Microsoft Azure Cross-Platform Command-Line Interface with the Resource Manager" metaKeywords="windows azure cross-platform command-line interface Resource Manager, windows azure command-line resource manager, azure command-line resource manager, azure cli resource manager" description="Use the Microsoft Azure Cross-Platform Command-Line Interface with the Resource Manager" metaCanonical="http://www.windowsazure.com/ru-ru/script/xplat-cli-intro" umbracoNaviHide="0" disqusComments="1" editor="mollybos" manager="paulettm" documentationCenter="" solutions="" authors="larryfr" services="" />

<tags ms.service="multiple" ms.workload="multiple" ms.tgt_pltfrm="command-line-interface" ms.devlang="na" ms.topic="article" ms.date="09/17/2014" ms.author="larryfr" />

# Использование межплатформенного интерфейса командной строки Microsoft Azure совместно с диспетчером ресурсов

<div class="dev-center-tutorial-selector sublanding"><a href="/ru-ru/documentation/articles/powershell-azure-resource-manager.md" title="PowerShell">PowerShell</a><a href="/ru-ru/documentation/articles/xplat-cli-azure-resource-manager.md" title="Межплатформенный интерфейс командной строки" class="current">Межплатформенный интерфейс командной строки</a></div>

Недавно мы представили предварительную версию диспетчера ресурсов, которая предоставляет новый способ управления Microsoft Azure. Из этой статьи вы узнаете, как использовать межплатформенный интерфейс командной строки (xplat-cli) Azure для работы с диспетчером ресурсов.

> [WACOM.NOTE] Диспетчер ресурсов находится на стадии предварительной версии и не обеспечивает того уровня управления, который доступен в компоненте управления службами Azure.

> [WACOM.NOTE] Если вы еще не установили и не настроили интерфейс xplat-cli, см. дополнительные инструкции по установке, настройке и использованию xplat-cli в разделе [Установка и настройка межплатформенного интерфейса командной строки Microsoft Azure][Установка и настройка межплатформенного интерфейса командной строки Microsoft Azure].

## Диспетчер ресурсов

Диспетчер ресурсов позволяет управлять группой *ресурсов* (управляемые пользователем сущности, такие как сервер базы данных, база данных или веб-сайт) как одной логической единицей или *группой ресурсов*. Например, группа ресурсов может содержать ресурсы веб-сайта и базы данных SQL.

Для поддержки более декларативного способа описания изменений ресурсов в группе ресурсов диспетчер ресурсов использует *шаблоны*, представляющие собой документы JSON. Язык шаблонов также позволяет описывать параметры, которые могут заполняться, будучи встроенными, при выполнении команды либо могут храниться в отдельном файле JSON. Это позволяет легко создавать новые ресурсы с помощью одного и того же шаблона, просто предоставляя различные параметры. Например, шаблон, создающий веб-сайт, будет иметь параметры для имени сайта, области размещения веб-сайта и другие общие параметры.

> [WACOM.NOTE] В настоящее время конкретные особенности языка шаблонов не задокументированы. При появлении соответствующей документации этот раздел будет обновлен для указания ссылки на справочную документацию.
>
> Тем не менее можно использовать команду `azure group template download` для загрузки и изменения шаблонов, предоставляемых корпорацией Майкрософт и партнерами, из коллекции шаблонов.

Когда шаблон используется для изменения или создания группы, создается *развертывание*, которое затем применяется к этой группе.

## Проверка подлинности

В настоящее время для работы с диспетчером ресурсов через интерфейс xplat-cli требуется пройти проверку подлинности в Microsoft Azure, используя учетную запись организации. Проверка подлинности с использованием учетной записи Майкрософт или сертификата, установленного через файл с расширением PUBLISHSETTINGS, работать не будет.

Дополнительные сведения о проверке подлинности с использованием учетной записи организации см. в разделе [Установка и настройка межплатформенного интерфейса командной строки Microsoft Azure][Установка и настройка межплатформенного интерфейса командной строки Microsoft Azure].

## Работа с группами и шаблонами

1.  Диспетчер ресурсов находится на стадии предварительной версии, поэтому предназначенные для работы с ним команды интерфейса xplat-cli по умолчанию выключены. Для включения этих команд воспользуйтесь следующей командой.

        azure config mode arm

    > [WACOM.NOTE] Режим диспетчера ресурсов и режим управления службами Azure являются взаимоисключающими. То есть ресурсами, созданными в одном из режимов, нельзя управлять из другого режима.

2.  При работе с шаблонами можно создавать собственные шаблоны или использовать шаблоны из коллекции шаблонов. Чтобы получить список доступных шаблонов в коллекции, введите следующую команду.

        azure group template list

    Ответ будет содержать издателя и имя шаблона и будет иметь следующий вид.

        data:    Publisher               Name
        data:    ----------------------------------------------------------------------------
        data:    Microsoft               Microsoft.WebSite.0.1.0-preview1
        data:    Microsoft               Microsoft.PHPStarterKit.0.1.0-preview1
        data:    Microsoft               Microsoft.HTML5EmptySite.0.1.0-preview1
        data:    Microsoft               Microsoft.ASPNETEmptySite.0.1.0-preview1
        data:    Microsoft               Microsoft.WebSiteMySQLDatabase.0.1.0-preview1

3.  Для просмотра сведений о шаблоне, на основе которого будет создан веб-сайт Azure, используйте следующую команду.

        azure group template show Microsoft.WebSiteSQLDatabase.0.1.0-preview1

    Возвращается описательная информация о шаблоне.

4.  После выбора шаблона его можно загрузить с помощью следующей команды.

        azure group template download Microsoft.WebSiteSQLDatabase.0.1.0-preview1

    Загрузка шаблона позволяет настраивать его в соответствии с актуальными требованиями. Например, можно добавить в шаблон другой ресурс.

    > Если вы изменяете шаблон, используйте команду `azure group template validate`, чтобы проверить шаблон перед его использованием для создания или изменения существующей группы ресурсов.

5.  Откройте файл шаблона в текстовом редакторе. Обратите внимание на расположенную вверху коллекцию **параметров**. Она содержит список параметров, которые необходимы шаблону для создания описанных в нем ресурсов. Некоторые параметры, такие как **sku**, имеют значения по умолчанию, другие просто указывают тип значения, например **siteName**. При использовании шаблона можно задать параметры в составе параметров командной строки либо указать файл со значениями параметров. В любом случае параметры должны быть в формате JSON.

    Чтобы создать файл с параметрами для шаблона Microsoft.WebSiteSQLDatabase.0.1.0-preview1, используйте следующие данные и создайте файл с именем **params.json**. Замените значения, начинающиеся с **My**, например **MyWebSite**, на свои собственные значения. Значение **siteLocation** должно описывать ближний к вам регион Azure, например **Северная Европа** или **Юго-Центральный регион США**.

        {
          "siteName": {
            "value": "MyWebSite"
          },
          "hostingPlanName": {
            "value": "MyHostingPlan"
          },
          "siteLocation": {
            "value": "North Europe"
          },
          "serverName": {
            "value": "MySQLServer"
          },
          "serverLocation": {
            "value": "North Europe"
          },
          "administratorLogin": {
            "value": "MySQLAdmin"
          },
          "administratorLoginPassword": {
            "value": "MySQLAdminPassword"
          },
          "databaseName": {
            "value": "MySQLDB"
          }
        }

6.  После сохранения файла **params.json** используйте следующую команду, чтобы создать новую группу ресурсов на основе шаблона. Параметр `-e` указывает файл **params.json**, созданный на предыдущем шаге.

        azure group create MyGroupName "MyDataCenter" -y Microsoft.WebSiteSQLDatabase.0.1.0-preview1 -d MyDeployment -e params.json

    Замените **MyGroupName** на имя группы, которое вы хотите использовать, а **MyDataCenter** на указанное в шаблоне значение **siteLocation**.

    > [WACOM.NOTE] Эта команда возвращает значение "ОК" после загрузки развертывания, но до его применения к ресурсам в группе. Чтобы проверить состояние развертывания, используйте следующую команду.
    >
    > `azure group deployment show MyGroupName MyDeployment`
    >
    > **ProvisioningState** показывает состояние развертывания.
    >
    > Если выясняется, что ваша конфигурация неправильная, и требуется остановить длительное развертывание, используйте следующую команду.
    >
    > `azure group deployment stop MyGroupName MyDeployment`
    >
    > Если не указать имя развертывания, оно будет создано автоматически на основе имени файла шаблона. Оно будет возвращено в составе выходных данных команды `azure group create`.

7.  Для просмотра группы используйте следующую команду.

        azure group show MyGroupName

    Эта команда возвращает сведения о ресурсах в группе. Если имеется несколько групп, можно использовать команду `azure group list`, чтобы получить список имен групп, а затем использовать `azure group list` для просмотра сведений о конкретной группе.

## Работа с ресурсами

Хотя шаблоны позволяют объявлять изменения в конфигурации для всей группы, иногда требуется работать исключительно с определенным ресурсом. Это можно сделать с помощью команды `azure resource`.

> [WACOM.NOTE] При использовании команд `azure resource`, отличных от команды `list`, вам необходимо указать версию API ресурса, с которым вы работаете при помощи параметра `-o`. Если вы не уверены, какая именно версия API используется, обратитесь к файлу шаблона и найдите поле **apiVersion** для этого ресурса.

1.  Чтобы получить список всех ресурсов в группе, используйте следующую команду.

        azure resource list MyGroupName

2.  Для просмотра отдельных ресурсов, таких как веб-сайт, в группе используйте следующую команду.

        azure resource show MyGroupName MyWebSiteName Microsoft.Web/sites -o "2014-04-01"

    Обратите внимание на параметр **Microsoft.Web/sites**. Он указывает тип ресурса, для которого вы запрашиваете информацию. Если посмотреть на загруженный ранее файл шаблона, можно заметить, что это же значение используется для определения типа ресурса веб-сайта, описанного в шаблоне.

    Эта команда возвращает сведения, связанные с веб-сайтом. Например, поле **hostNames** должно содержать URL-адрес веб-сайта. Используйте его в браузере, чтобы убедиться в работоспособности веб-сайта.

3.  При просмотре сведений о ресурсе часто бывает полезно использовать параметр `--json`, так как это делает выходные данные более удобочитаемыми, поскольку некоторые значения являются вложенными структурами или коллекциями. Ниже показано возвращение результатов команды show в виде документа JSON.

        azure resource show MyGroupName MyWebSite Microsoft.Web/sites -o "2014-04-01" --json

    > [WACOM.NOTE] Данные JSON можно сохранить в виде файла, используя знак для вывода выходных сведений в файл. Например:
    >
    > `azure resource show MyGroupName MyWebSite Micrsoft.Web/sites --json > myfile.json`

4.  Чтобы удалить существующий ресурс, используйте следующую команду.

        azure resource delete MyGroupName MyWebSite Microsoft.Web/sites -o "2014-04-01"

## Ведение журналов

Для просмотра сведений журнала по выполненным в группе операциям, используйте команду `azure group log show`. По умолчанию при этом выводится последняя операция, выполненная с группой. Чтобы просмотреть все операции, используйте дополнительный параметр `--all`. Для последнего развертывания используйте параметр `--last-deployment`. Для конкретного развертывания используйте параметр `--deployment` и укажите имя развертывания. В следующем примере возвращается журнал всех операций, выполненных с группой "MyGroup".

    azure group log show mygroup --all

## Дальнейшие действия

-   Дополнительные сведения об использовании межплатформенного интерфейса командной строки Azure см. в разделе [Установка и настройка межплатформенного интерфейса командной строки Microsoft Azure][Установка и настройка межплатформенного интерфейса командной строки Microsoft Azure].
-   Информацию о работе с диспетчером ресурсов с помощью Windows Azure PowerShell см. в разделе [Начало работы с Windows PowerShell совместно с диспетчером ресурсов][Начало работы с Windows PowerShell совместно с диспетчером ресурсов].

  [Установка и настройка межплатформенного интерфейса командной строки Microsoft Azure]: /ru-ru/documentation/articles/xplat-cli/
  [Начало работы с Windows PowerShell совместно с диспетчером ресурсов]: http://go.microsoft.com/fwlink/?LinkId=394760
