---
title: Коллективная разработка с помощью Azure Dev Spaces, .NET Core и Visual Studio | Документация Майкрософт
titleSuffix: Azure Dev Spaces
services: azure-dev-spaces
ms.service: azure-dev-spaces
ms.custom: vs-azure
ms.workload: azure-vs
ms.subservice: azds-kubernetes
author: zr-msft
ms.author: zarhoads
ms.date: 07/09/2018
ms.topic: tutorial
description: Быстрая разработка в Kubernetes с использованием контейнеров и микрослужб в Azure
keywords: Docker, Kubernetes, Azure, AKS, Azure Kubernetes Service, containers
ms.openlocfilehash: ecacb7d3d4576b18eee3faf88c2a598d6acf94a0
ms.sourcegitcommit: 698a3d3c7e0cc48f784a7e8f081928888712f34b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2019
ms.locfileid: "55465373"
---
# <a name="team-development-with-azure-dev-spaces"></a>Коллективная разработка с помощью Azure Dev Spaces

В этом руководстве описано, как использовать несколько пространств разработки для параллельной работы в разных средах разработки, когда отдельные проекты выполняются в отдельных пространствах в пределах одного кластера.

## <a name="call-another-container"></a>Вызов другого контейнера
В этом разделе вы создадите вторую службу, `mywebapi`, к которой будет обращаться `webfrontend`. Каждая служба будет выполняться в отдельных контейнерах. Затем вы выполните отладку в обоих контейнерах.

![](media/common/multi-container.png)

### <a name="download-sample-code-for-mywebapi"></a>Скачайте пример кода для *mywebapi*.
Ради экономии времени давайте загрузим образец кода из репозитория GitHub. Перейдите к https://github.com/Azure/dev-spaces и выберите **Clone or download** (Клонировать или скачать), чтобы скачать репозиторий GitHub. Код для этого раздела находится в папке `samples/dotnetcore/getting-started/mywebapi`.

### <a name="run-mywebapi"></a>Запуск *mywebapi*
1. Откройте проект `mywebapi` в *отдельном окне Visual Studio*.
1. Выберите **Azure Dev Spaces** в раскрывающемся списке параметров запуска, как вы это делали ранее для проекта `webfrontend`. Вместо того, чтобы создавать новый кластер AKS, в этот раз выберите уже созданный. Как и ранее, для поля "Пространство" оставьте значение по умолчанию (`default`) и нажмите кнопку **ОК**. В окне выходных данных можно заметить, что Visual Studio начинает подготавливать эту новую службу в пространстве разработки, чтобы ускорить процессы при запуске отладки.
1. Нажмите клавишу F5 и подождите, пока выполнится сборка и развертывание службы. Вы узнаете, что служба готова, когда строка состояния Visual Studio станет оранжевой.
1. Обратите внимание на URL-адрес конечной точки, отображаемый на панели **Azre Dev Spaces for AKS** (Azre Dev Spaces для AKS) в окне **Выходные данные**. Он должен иметь примерно следующий вид: http://localhost:\<portnumber\>. Может показаться, что контейнер работает локально, но на самом деле он выполняется в пространстве разработки в Azure.
2. Когда контейнер `mywebapi` готов, откройте в браузере адрес localhost и добавьте `/api/values` к URL-адресу, чтобы вызвать API GET по умолчанию для `ValuesController`. 
3. Если все шаги были успешными, вы должны увидеть ответ от службы `mywebapi`, который выглядит так:

    ![](media/get-started-netcore-visualstudio/WebAPIResponse.png)

### <a name="make-a-request-from-webfrontend-to-mywebapi"></a>Запрос из *webfrontend* к *mywebapi*
Давайте теперь напишем код в `webfrontend`, который отправляет запрос к `mywebapi`. Переключитесь в окно Visual Studio, в котором есть проект `webfrontend`. В файле `HomeController.cs` *замените* код метода About следующим кодом:

   ```csharp
   public async Task<IActionResult> About()
   {
      ViewData["Message"] = "Hello from webfrontend";

      using (var client = new System.Net.Http.HttpClient())
            {
                // Call *mywebapi*, and display its response in the page
                var request = new System.Net.Http.HttpRequestMessage();
                request.RequestUri = new Uri("http://mywebapi/api/values/1");
                if (this.Request.Headers.ContainsKey("azds-route-as"))
                {
                    // Propagate the dev space routing header
                    request.Headers.Add("azds-route-as", this.Request.Headers["azds-route-as"] as IEnumerable<string>);
                }
                var response = await client.SendAsync(request);
                ViewData["Message"] += " and " + await response.Content.ReadAsStringAsync();
            }

      return View();
   }
   ```

В предыдущем примере код перенаправляет заголовок `azds-route-as` из входящего запроса в исходящий. Позже вы увидите, как это повышает эффективность разработки в сценариях командной работы.

### <a name="debug-across-multiple-services"></a>Отладка в нескольких службах
1. На этом этапе служба `mywebapi` по-прежнему должна выполняться с подключенным отладчиком. Если это не так, нажмите клавишу F5 в проекте `mywebapi`.
1. Установите точку останова в методе `Get(int id)` в файле `Controllers/ValuesController.cs`, который обрабатывает запросы GET `api/values/{id}`.
1. В проекте `webfrontend`, куда вы вставили код выше, установите точку останова до отправки запроса GET к `mywebapi/api/values`.
1. Нажмите клавишу F5 в проекте `webfrontend`. Visual Studio снова откроет в браузере соответствующий порт localhost, и появится веб-приложение.
1. Перейдите по ссылке **About** (Сведения) в верхней части страницы, чтобы вызвать точку останова в проекте `webfrontend`. 
1. Нажмите клавишу F10, чтобы продолжить. Точка останова запустится в проекте `mywebapi`.
1. Нажмите клавишу F5, чтобы продолжить и вернуться в код проекта `webfrontend`.
1. Повторное нажатие клавиши F5 завершит запрос и вернет страницу в браузере. В веб-приложении на странице About (Сведения) будет отображаться объединенное сообщение от двух служб: "Hello from webfrontend and Hello from mywebapi".

Все готово! Теперь у вас есть многоконтейнерное приложение, где каждый контейнер можно разрабатывать и развертывать отдельно.

## <a name="learn-about-team-development"></a>Сведения о коллективной разработке

До сих пор вы запускали код приложения, как если бы вы были единственным разработчиком, работающим над этим приложением. В этом разделе вы узнаете, как Azure Dev Spaces упрощает разработку в команде:
* По мере необходимости для работы в одной среде можно объединить команды разработчиков, которые работают в общем пространстве разработки или в различных пространствах.
* Поддерживает изолированную итерацию кода каждым разработчиком без воздействия на работу команды.
* Позволяет выполнять комплексное тестирование кода перед его фиксацией без необходимости создавать макеты или моделировать зависимости.

### <a name="challenges-with-developing-microservices"></a>Сложности при разработке микрослужб
На данный момент пример вашего приложения не очень сложный. Но в реальном мире проблемы появятся по мере увеличения количества служб и участников команды разработки.

Представьте процесс разработки службы, которая взаимодействует с десятками других служб.

- Выполнение всей разработки в локальной среде может показаться нереальным. У вашего компьютера разработки может не хватить ресурсов для запуска всего приложения. Или, возможно, конечные точки вашего приложения должны быть публично доступными (например, ваше приложение отвечает веб-перехватчику из приложения SaaS).
- Вы можете попытаться запустить только те службы, от которых вы зависите, но это означает, что вам нужно знать все перекрытие зависимостей (например, зависимости зависимостей). Сложность в создании и запуске зависимостей может возникнуть по причине того, что их разрабатывали не вы.
- Некоторые разработчики прибегают к моделированию или макетированию многих зависимостей служб. Иногда это может помочь, но управление этими макетами вскоре может начать отнимать время и ресурсы. Это также приводит к тому, что ваша среда разработки не только будет отличаться от рабочей среды, но и может содержать небольшие ошибки.
- По этой причине выполнение любого типа сквозного тестирования становится затруднительным. Фактически интеграционное тестирование можно выполнить только после фиксации, что означает, что вы обнаружите проблемы позже в цикле разработки.

    ![](media/common/microservices-challenges.png)

### <a name="work-in-a-shared-dev-space"></a>Работа в общей среде разработки
С помощью Azure Dev Spaces можно настроить *общую среду разработки* в Azure. Каждый разработчик может сосредоточиться только на своей части приложения и может итеративно разрабатывать *код до фиксации* в среде разработки, в которой уже содержатся все другие службы и облачные ресурсы, от которых зависят сценарии. Зависимости всегда актуальны, и разработчикам следует работать также, как в рабочей среде.

### <a name="work-in-your-own-space"></a>Работа в собственном пространстве
При разработке кода для службы и перед его фиксацией он будет содержать большое количество ошибок. Вы будете итеративно корректировать, тестировать его и экспериментировать с решениями. Azure Dev Spaces предоставляет концепцию **пространства**, которое позволяет работать изолированно, не мешая работе участников вашей команды.

Выполните следующую команду, чтобы убедиться, что службы `webfrontend` и `mywebapi` выполняются **в пространстве разработки `default`**.
1. Закройте все сеансы отладки (F5) для обеих служб, но оставьте проекты открытыми в окнах Visual Studio.
2. Переключитесь в окно Visual Studio с проектом `mywebapi` и нажмите клавиши CTRL+F5, чтобы запустить службу без присоединенного отладчика.
3. Переключитесь в окно Visual Studio с проектом `webfrontend` и нажмите клавиши CTRL+F5, чтобы запустить его также.

> [!Note]
> Иногда необходимо обновить браузер после того, как веб-страница изначально отобразится после нажатия клавиш CTRL+F5.

Любой, кто открывает общедоступный URL-адрес и переходит к веб-приложению, будет вызывать написанный вами путь кода, который проходит через обе службы, используя пространство по умолчанию `default`. Предположим, вы хотите продолжить разработку `mywebapi`. Как это можно сделать, не вмешиваясь в работу других разработчиков, которые используют это же пространство разработки? Чтобы сделать это, настройте собственное пространство.

### <a name="create-a-new-dev-space"></a>Создание пространства разработки
В среде Visual Studio можно создать дополнительные пространства, которые будут использоваться при нажатии клавиш CTRL+F5 или F5 при работе со службой. Вы можете назвать пространство любым именем (например, `sprint4` или `demo`).

Для создания пространства выполните следующие действия:
1. Переключитесь в окно Visual Studio, в котором есть проект `mywebapi`.
2. В **обозревателе решений** щелкните проект правой кнопкой мыши и выберите **Свойства**.
3. Выберите вкладку **Отладка** слева, чтобы отобразить параметры Azure Dev Spaces.
4. Здесь можно изменить или создать кластер и/или пространство, которое будет использоваться при нажатии клавиш CTRL+F5 или F5. *Убедитесь, что выбрано ранее созданное пространство Azure Dev Space*.
5. В раскрывающемся списке пространства выберите **<Create New Space…>** (Создать новое пространство…).

    ![](media/get-started-netcore-visualstudio/Settings.png)

6. В диалоговом окне **Добавление рабочей среды** задайте для родительского пространства значение **По умолчанию** и введите имя нового пространства. Вы можете использовать свое имя (например, "scott") для нового пространства, чтобы люди, которые работают в одной среде с вами, могли идентифицировать ваше пространство. Последовательно выберите **ОК**.

    ![](media/get-started-netcore-visualstudio/AddSpace.png)

7. Теперь вы должны увидеть свой кластер AKS и новое пространство, выбранное на странице свойств проекта.

    ![](media/get-started-netcore-visualstudio/Settings2.png)

### <a name="update-code-for-mywebapi"></a>Обновление кода *mywebapi*

1. В проекте `mywebapi` измените код на метод `string Get(int id)` в файле `Controllers/ValuesController.cs` следующим образом:
 
    ```csharp
    [HttpGet("{id}")]
    public string Get(int id)
    {
        return "mywebapi now says something new";
    }
    ```

2. Установите точку останова в этом обновленном блоке кода (это может быть точка, созданная ранее).
3. Нажмите клавишу F5 для запуска службы `mywebapi`. В вашем кластере будет запущена служба, использующая выбранное пространство, в данном случае — `scott`.

Ниже приведена схема, которая поможет вам понять, как работают разные пространства. Путь фиолетового цвета отображает запрос через пространство `default`, которое используется по умолчанию, если к URL-адресу не добавлено пространство. Путь розового цвета отображает запрос через пространство `default/scott`.

![](media/common/Space-Routing.png)

Эта встроенная возможность Azure Dev Spaces позволяет выполнять комплексное тестирование кода в общей среде, не требуя от каждого разработчика повторно создавать множество служб в своем пространстве. Для такой маршрутизации требуется, чтобы заголовки распространения передавались в код приложения, как показано на предыдущем шаге этого руководства.

### <a name="test-code-running-in-the-defaultscott-space"></a>Тестирование кода, выполняемого в пространстве `default/scott`
Чтобы проверить свою новую версию `mywebapi` в сочетании с `webfrontend`, откройте в браузере URL-адрес общедоступной точки доступа `webfrontend` (например, http://webfrontend.123456abcdef.eastus.aksapp.io)) и перейдите на страницу About (Сведения). Вы увидите исходное сообщение "Hello from webfrontend and Hello from mywebapi".

Теперь добавьте часть "scott.s" в URL-адрес, чтобы получилось http://scott.s.webfrontend.123456abcdef.eastus.aksapp.io, и обновите браузер. Должна сработать точка останова, заданная в проекте `mywebapi`. Нажмите клавишу F5, чтобы продолжить. В браузере вы должны увидеть новое сообщение "Hello from webfrontend and mywebapi now says something new". Это происходит, так как путь к обновленному коду в `mywebapi` используется в пространстве `default/scott`.

### <a name="well-done"></a>Все готово!
Вы выполнили руководство по началу работы. Вы научились выполнять следующие задачи:

> [!div class="checklist"]
> * Настройка Azure Dev Spaces с помощью управляемого кластера Kubernetes в Azure.
> * итеративная разработка кода в контейнерах;
> * независимая разработка двух отдельных служб и вызов другой службы с помощью обнаружения службы DNS Kubernetes;
> * эффективная разработка и тестирование кода в среде командной работы.

Теперь, после ознакомления с Azure Dev Spaces, [предоставьте доступ к пространству разработки своему сотруднику](how-to/share-dev-spaces.md) и покажите ему, как просто работать вместе.

## <a name="clean-up"></a>Очистка
Чтобы полностью удалить экземпляр Azure Dev Spaces из кластера, включая все среды разработки и работающие службы, используйте команду `az aks remove-dev-spaces`. Не забывайте, что это действие необратимо. Позднее вы сможете снова добавить в кластер поддержку Azure Dev Spaces, но в этом случае вам придется начать работу с нуля. Прежние службы и среды не будут восстановлены.

С помощью приведенного ниже примера кода можно вывести список контроллеров Azure Dev Spaces в активной подписке, а затем удалить контроллер Azure Dev Spaces, связанный с кластером AKS myaks в группе ресурсов myaks-rg.

```cmd
    azds controller list
    az aks remove-dev-spaces --name myaks --resource-group myaks-rg
```
