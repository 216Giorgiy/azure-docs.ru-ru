<properties pageTitle="Веб-приложение Ruby on Rails на виртуальной машине Azure с ОС Linux" description="Размещение веб-сайта на основе Ruby on Rails в Azure с помощью виртуальной машины Linux." services="virtual-machines" documentationCenter="ruby" authors="blackmist" manager="wpickett" editor=""/>

<tags ms.service="virtual-machines" ms.workload="web" ms.tgt_pltfrm="vm-linux" ms.devlang="ruby" ms.topic="article" ms.date="09/17/2014" ms.author="larryfr"/>





#Веб-приложение Ruby on Rails на виртуальной машине Azure

В этом учебнике описывается, как разместить веб-сайт на платформе Ruby on Rails в Azure с помощью виртуальной машины Linux. В данном учебнике предполагается, что у вас нет опыта использования платформы Azure. По завершении изучения этого учебника вы получите приложение на основе Ruby on Rails, выполняемое в облаке.

Вы научитесь:

* настраивать среду разработки;

* настраивать виртуальную машину Azure для размещения Ruby on Rails;

* создавать новое приложение Rails;

* копировать файлы на виртуальную машину с использованием scp. 

Далее представлен снимок экрана завершенного приложения:

![a browser displaying Listing Posts][blog-rails-cloud]

##Содержание

* [Настройка среды разработки](#setup)

* [Создание приложения Rails](#create)

* [Тестирование приложения](#test)

* [Создание виртуальной машины Azure](#createvm)

* [Копирование приложения на виртуальную машину](#copy)

* [Установка пакетов и запуск приложения](#start)

* [Дальнейшие действия](#next)

##<a id="setup"></a>Настройка среды разработки

1. Установка Ruby в среде разработки. Действия, необходимые для установки, зависят от операционной системы.

	* **Apple OS X** - Для OS X существует несколько выпусков Ruby. Данный учебник был проверен на OS X с использованием [Homebrew](http://brew.sh/) для установки **rbenv** и **ruby-build**. Информацию об установке можно найти на веб-сайте [https://github.com/sstephenson/rbenv/](https://github.com/sstephenson/rbenv/).

	* **Linux** - Используйте собственную систему управления пакетами распространения. Данное руководство было проверено на системе Ubuntu 12.10 с использованием пакетов ruby1.9.1 и ruby1.9.1-dev.

	* **Windows** - Для Windows доступно несколько дистрибутивов Ruby. Данное руководство было проверено с использованием [RailsInstaller](http://railsinstaller.org/) 1.9.3-p392.

2. Откройте новое окно командной строки или сеанс терминала и введите следующую команду для установки Ruby on Rails:

		gem install rails --no-rdoc --no-ri

	> [AZURE.NOTE] Для выполнения этой команды в некоторых операционных системах могут потребоваться привилегии администратора или корня. Если при выполнении этой команды возникла ошибка, попробуйте использовать  'sudo' следующим образом:
	>
	>````` 
	sudo gem install rails
	`````

	> [AZURE.NOTE] Для этого руководства использовался пакет Rails версии 3.2.12.

3. Кроме того, необходимо установить интерпретатор JavaScript, который будет использоваться Rails для компиляции активов CoffeeScript, используемых приложением Rails. Список поддерживаемых интерпретаторов доступен на веб-сайте [https://github.com/sstephenson/execjs#readme](https://github.com/sstephenson/execjs#readme).
	
	При проверке этого учебника использовалась библиотека [Node.js](http://nodejs.org/), так как она доступна для OS X, Linux и Windows.

##<a id="create"></a>Создание приложения Rails

1. В командной строке или в сеансе терминала создайте новое приложение Rails с именем "blog_app", используя следующую команду:

		rails new blog_app

	Эта команда создает новый каталог **blog_app** и заполняет его файлами и подкаталогами, необходимыми приложению Rails.

	> [AZURE.NOTE] Для выполнения этой команды может потребоваться от одной до нескольких минут. Она выполняет автоматическую установку пакетов, необходимых для приложения по умолчанию. В это время может показаться, что система перестала отвечать на запросы.

2. Измените каталоги на **blog_app**, а затем используйте следующую команду, чтобы создать базовый шаблон блога:

		rails generate scaffold Post name:string title:string content:text

	Будут созданы контроллер, представление, модель и переносы базы данных, используемые для хранения записей блога. У каждой записи будет имя автора, заголовок и текстовый контент.

3. Для создания базы данных, в которой будут храниться записи блога, используйте следующую команду:

		rake db:migrate

	Эта команда использует поставщик базы данных по умолчанию для Rails, т. е. [Базу данных SQLite3][sqlite3]. Вы можете использовать другую базу данных для рабочего приложения, однако для этого руководства SQLite вполне достаточно.

##<a id="test"></a>Тестирование приложения

Выполните следующие действия, чтобы запустить сервер Rails в среде разработки.

1. В окне командной строки или сеансе терминала запустите сервер Rails с помощью следующей команды:

		rails s

	Вы должны увидеть результат, аналогичный приведенному ниже. Обратите внимание на порт, который прослушивает веб-сервер. В примере ниже это порт 3000.

		=> Booting WEBrick
		=> Rails 3.2.12 application starting in development on http://0.0.0.0:3000
		=> Call with -d to detach
		=> Ctrl-C to shutdown server
		[2013-03-12 19:11:31] INFO  WEBrick 1.3.1
		[2013-03-12 19:11:31] INFO  ruby 1.9.3 (2012-04-20) [x86_64-linux]
		[2013-03-12 19:11:31] INFO  WEBrick::HTTPServer#start: pid=9789 port=3000

2. Откройте браузер и перейдите по адресу http://localhost:3000/. Вы должны увидеть страницу, аналогичную показанной ниже:

	![default rails page][default-rails]

	Это статическая страница приветствия. Чтобы просмотреть формы, создаваемые командой формирования шаблонов, перейдите по адресу http://localhost:3000/posts. Вы должны увидеть страницу, аналогичную показанной ниже:

	![a page listing posts][blog-rails]

	Чтобы остановить серверный процесс, введите CTRL+C в командной строке.

##<a id="createvm"></a>Создание виртуальной машины Azure

Следуйте инструкциям, указанным [здесь][vm-instructions], чтобы создать виртуальную машину Azure с операционной системой Linux.

> [AZURE.NOTE] Шаги в этом учебнике были выполнены на виртуальной машине Azure с размещенной ОС Ubuntu 12.10. При использовании другого дистрибутива Linux для выполнения тех же задач могут потребоваться другие действия.

> [AZURE.IMPORTANT] Вам нужно **только** создать виртуальную машину. Остановитесь, когда узнаете, как подключиться к виртуальной машине с помощью SSH.

После создания виртуальной машины Azure выполните следующие действия, чтобы установить Ruby and Rails на виртуальной машине:

1. В окне командной строки или терминальном сеансе выполните следующую команду, чтобы подключиться к виртуальной машине с помощью SSH:

		ssh username@vmdns -p port

	Замените имя пользователя, указанное во время создания виртуальной машины, DNS-адрес виртуальной машины и порт конечной точки SSH. Например:

		ssh railsdev@railsvm.cloudapp.net -p 61830

	> [AZURE.NOTE] Если вы используете Windows как среду разработки, для применения функций SSH можно воспользоваться служебной программой, например **PuTTY**. PuTTY можно скачать на [странице скачивания PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).

2. В сеансе SSH выполните следующие команды, чтобы установить Ruby на виртуальной машине:

		sudo apt-get update -y
		sudo apt-get upgrade -y
		sudo apt-get install ruby1.9.1 ruby1.9.1-dev build-essential libsqlite3-dev nodejs -y

	После установки используйте следующую команду, чтобы проверить установку Ruby:

		ruby -v

	Эта команда должна вернуть версию Ruby, установленную на виртуальной машине, которая может отличаться от 1.9.1. Например, **ruby 1.9.3p194 (2012-04-20 revision 35410) [x86_64-linux]**.

2. Используйте следующую команду для установки Bundler:

		sudo gem install bundler --no-rdoc --no-ri

	Bundler используется для установки пакетов, необходимых приложению Rails, после его копирования на сервер.

##<a id="copy"></a>Копирование приложения на виртуальную машину

В среде разработки откройте новое окно командной строки или сеанс терминала и выполните команду **scp**, чтобы скопировать каталог **blog_app** на виртуальную машину. Для этой команды используется следующий формат:

	scp -r -P 54822 -C directory-to-copy user@vmdns:

Например:

	scp -r -P 54822 -C ~/blog_app railsdev@railsvm.cloudapp.net:

> [AZURE.NOTE] Если вы используете Windows как среду разработки, для применения функций scp можно воспользоваться служебной программой, например **pscp**. Pscp можно скачать на [странице скачивания PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).

Параметры, используемые для этой команды, приводят к получению следующих результатов:

* **-r**: рекурсивное копирование содержимого указанного каталога и всех вложенных каталогов.

* **-P**: использование указанного порта для взаимодействия по протоколу SSH.

* **-C**: включение сжатия.

* **directory-to-copy**: локальный каталог, который необходимо скопировать.

* **user@vmdns**: адрес компьютера, на который копируются файлы, а также учетная запись пользователя для входа в систему.

После завершения копирования каталог **blog_app** будет расположен в домашнем каталоге пользователей. Используйте следующие команды в сеансе SSH-подключения к виртуальной машине для просмотра скопированных файлов:

	cd ~/blog_app
	ls

Список возвращенных файлов должен соответствовать файлам в каталоге **blog_app** в вашей среде разработки.

##<a id="start"></a>Установка GEM-файлов и запуск Rails

1. На виртуальной машине измените каталоги на **blog_app** и выполните следующую команду, чтобы установить GEM-файлы, определенные в файле **Gemfile**:

		sudo bundle install

2. Используйте следующую команду для создания базы данных:

		rake db:migrate

3. Используйте следующую команду для запуска сервера:
	
		rails s

	Вы должны увидеть результат, аналогичный приведенному ниже. Обратите внимание на порт, который прослушивает веб-сервер. В примере ниже это порт 3000.

		=> Booting WEBrick
		=> Rails 3.2.12 application starting in development on http://0.0.0.0:3000
		=> Call with -d to detach
		=> Ctrl-C to shutdown server
		[2013-03-12 19:11:31] INFO  WEBrick 1.3.1
		[2013-03-12 19:11:31] INFO  ruby 1.9.3 (2012-04-20) [x86_64-linux]
		[2013-03-12 19:11:31] INFO  WEBrick::HTTPServer#start: pid=9789 port=3000

2. В браузере перейдите на [портал управления Azure][management-portal] и выберите свою виртуальную машину.

	![virtual machine list][vmlist]

3. Выберите **КОНЕЧНЫЕ ТОЧКИ** в верхней части страницы, а затем щелкните **+ ДОБАВИТЬ КОНЕЧНУЮ ТОЧКУ** в нижней части страницы.

	![endpoints page][endpoints]

4. В диалоговом окне **ДОБАВЛЕНИЕ КОНЕЧНОЙ ТОЧКИ** щелкните стрелку в нижнем левом углу, чтобы перейти на вторую страницу, и введите следующие данные в форме:

	* **ИМЯ**: HTTP

	* **ПРОТОКОЛ**: TCP

	* **ОБЩИЙ ПОРТ**: 80

	* **ЧАСТНЫЙ ПОРТ**: &lt;информация о порте из шага 3&gt;.

	После этого будет создан общий порт 80, который применяется для маршрутизации трафика на частный порт 3000, который прослушивает сервер Rails.

	![new endpoint dialog][new-endpoint]

5. Щелкните значок галочки, чтобы сохранить конечную точку.

6. Должно появиться сообщение **ВЫПОЛНЯЕТСЯ ОБНОВЛЕНИЕ**. После того как сообщение исчезнет, конечная точка будет активирована. Теперь вы можете протестировать приложение, перейдя к имени DNS виртуальной машины. Веб-сайт должен выглядеть аналогично следующему:

	![default rails page][default-rails-cloud]

	Если добавить **/posts** в URL-адрес, вы увидите страницы, созданные командой формирования шаблонов.

	![posts page][blog-rails-cloud]

##<a id="next"></a>Дальнейшие действия

В этой статье вы изучили, как создать и опубликовать базовое приложение Rails на основе форм на виртуальной машине Azure. Большинство действий, описанных здесь, были выполнены вручную. В рабочей среде этот процесс желательно автоматизировать. Кроме того, большинство рабочих сред размещают приложение Rails вместе с другим серверным процессом, например Apache или NginX, который обрабатывает маршрутизацию запросов к нескольким экземплярам приложения Rails и обслуживает статические ресурсы.

Информацию об автоматизации развертывания приложения Rails, а также об использовании веб-сервера Unicorn и NginX см. в разделе [Unicorn+NginX+Capistrano с виртуальной машиной Azure][unicorn-nginx-capistrano].

Дополнительную информацию о Ruby on Rails см. на веб-сайте [руководства по Ruby on Rails][rails-guides].

Сведения об использовании пакета Azure SDK для Ruby для доступа к службам Azure из приложения Ruby см. в статьях:

* [Хранение неструктурированных данных с использованием больших двоичных объектов][blobs]

* [Хранение пар "ключ-значение" с использованием таблиц][tables]

* [Обслуживание содержимого для каналов с высокой пропускной способностью с помощью сети CDN][cdn-howto]



<!-- WA.com links -->
[blobs]: /ru-ru/documentation/articles/storage-ruby-how-to-use-blob-storage

[cdn-howto]: /ru-ru/develop/ruby/app-services/

[management-portal]: https://manage.windowsazure.com/

[tables]: /ru-ru/develop/ruby/how-to-guides/table-service/

[unicorn-nginx-capistrano]: /ru-ru/documentation/articles/virtual-machines-ruby-deploy-capistrano-host-nginx-unicorn/

[vm-instructions]: /ru-ru/documentation/articles/virtual-machines-linux-tutorial


<!-- External Links -->
[rails-guides]: http://guides.rubyonrails.org/

[sqlite3]: http://www.sqlite.org/

<!-- Images -->
[blog-rails]: ./media/virtual-machines-ruby-rails-web-app-linux/blograilslocal.png

[blog-rails-cloud]: ./media/virtual-machines-ruby-rails-web-app-linux/blograilscloud.png 

[default-rails]: ./media/virtual-machines-ruby-rails-web-app-linux/basicrailslocal.png

[default-rails-cloud]: ./media/virtual-machines-ruby-rails-web-app-linux/basicrailscloud.png

[vmlist]: ./media/virtual-machines-ruby-rails-web-app-linux/vmlist.png

[endpoints]: ./media/virtual-machines-ruby-rails-web-app-linux/endpoints.png

[new-endpoint]: ./media/virtual-machines-ruby-rails-web-app-linux/newendpoint.png



<!--HONumber=42-->
