<properties linkid="dev-ruby-web-app-with-linux-vm" urlDisplayName="Веб-приложение Ruby on Rails в Azure с использованием виртуальной машины Linux" pageTitle="Веб-приложение Ruby on Rails в Azure с использованием виртуальной машины Linux" metaKeywords="Веб-приложение Ruby в Azure, приложение Ruby в Azure, приложение Ruby Azure, виртуальная машина Ruby Azure, виртуальная машина ruby, вм ruby linux" description="Размещение веб-сайта Ruby on Rails в Azure с использованием виртуальной машины Linux. " metaCanonical="" services="virtual-machines" documentationCenter="Ruby" title="Веб-приложение Ruby on Rails на виртуальной машине Azure" authors=""  solutions="" writer="larryfr" manager="" editor=""  />





#Веб-приложение Ruby on Rails на виртуальной машине Azure

В этом руководстве описывается, как разместить веб-сайт на платформе Ruby on Rails в Azure с помощью виртуальной машины Linux. В данном учебнике предполагается, что у читателя нет опыта использования платформы Azure. По завершении изучения этого учебника вы получите приложение на основе Ruby on Rails, выполняемое в облаке.

Вы научитесь:

* Настройка среды разработки

* Настройка виртуальной машины Azure для размещения Ruby on Rails.

* Создание нового приложения Rails

* Копирование файлов на виртуальную машину с использованием scp 

Далее представлен снимок экрана завершенного приложения:

![записи с описанием приложения в браузере][blog-rails-cloud]

##Содержание

* [Настройка среды разработки](#setup)

* [Создание приложения Rails](#create)

* [Тестирование приложения](#test)

* [Создание виртуальной машины Azure](#createvm)

* [Копирование приложения на виртуальную машину](#copy)

* [Установка пакетов и запуск приложения](#start)

* [Дальнейшие действия](#next)

##<a id="setup"></a>Настройка среды разработки

1. Установка Ruby в среде разработки. Действия, необходимые для установки, зависят от операционной системы.

	* **Apple OS X** — для OS X существует несколько выпусков Ruby. Данное руководство было проверено на OS X с использованием [Homebrew](http://brew.sh/) для установки **rbenv** и **ruby-build**. Сведения об установке можно найти в [https://github.com/sstephenson/rbenv/](https://github.com/sstephenson/rbenv/).

	* **Linux** — используйте собственную систему управления пакетами распространения. Данное руководство было проверено на системе Ubuntu 12.10 с использованием пакетов ruby1.9.1 и ruby1.9.1-dev.

	* **Windows** — для Windows доступно несколько выпусков Ruby. Данный учебный курс был проверен с использованием [RailsInstaller](http://railsinstaller.org/) 1.9.3-p392.

2. Откройте новое окно командной строки или сеанс терминала и введите следующую команду для установки Ruby on Rails:

		gem install rails --no-rdoc --no-ri

	<div class="dev-callout">
	<strong>Примечание.</strong>
	<p>Для выполнения этой команды в некоторых операционных системах могут потребоваться права администратора или учетной записи root. Если при выполнении этой команды возникла ошибка, попробуйте использовать 'sudo' следующим образом:</p>
	<pre class="prettyprint">sudo gem install rails</pre>
	</div>

	<div class="dev-callout">
	<strong>Примечание.</strong>
	<p>Для этого руководства использовался пакет Rails версии 3.2.12.</p>

	</div>

3. Кроме того, необходимо установить интерпретатор JavaScript, который будет использоваться Rails для компиляции активов CoffeeScript, используемых приложением Rails. Список поддерживаемых интерпретаторов доступен на веб-сайте [https://github.com/sstephenson/execjs#readme](https://github.com/sstephenson/execjs#readme).
	
	[Node.js](http://nodejs.org/) использовалась при проверке этого руководства, поскольку она доступна для OS X, Linux и Windows.

##<a id="create"></a>Создание приложения Rails

1. В командной строке или в сеансе терминала создайте новое приложение Rails с именем "blog_app", используя следующую команду:

		rails new blog_app

	Эта команда создает новый каталог **blog_app** и заполняет его файлами и вложенными каталогами, необходимыми приложению Rails.

	<div class="dev-callout">
	<strong>Примечание.</strong>
	<p>Для выполнения этой команды может потребоваться одна или несколько минут. Она выполняет автоматическую установку пакетов, необходимых для приложения по умолчанию. В это время может показаться, что система зависла.</p>
	</div>

2. Измените каталоги на **blog_app** blog_app, а затем используйте следующую команду, чтобы создать базовый шаблон блога:

		rails generate scaffold Post name:string title:string content:text

	Будет создан контроллер, представление, модель и переносы базы данных, используемые для хранения записей блога. У каждой записи будет имя автора, заголовок и текстовый контент.

3. Для создания базы данных, в которой будут храниться записи блога, используйте следующую команду:

		rake db:migrate

	Эта команда использует поставщика базы данных по умолчанию для Rails, т. е. [базу данных SQLite3][sqlite3]. Вы можете использовать другую базу данных для рабочего приложения, однако для этого руководства SQLite вполне достаточно.

##<a id="test"></a>Тестирование приложения

Выполните следующие действия, чтобы запустить сервер Rails в среде разработки.

1. В окне командной строки или сеансе терминала запустите сервер Rails с помощью следующей команды:

		rails s

	Вы должны увидеть результат, аналогичный приведенному ниже. Обратите внимание на порт, который прослушивает веб-сервер. В примере ниже это порт 3000.

		=> Booting WEBrick
		=> Rails 3.2.12 application starting in development on http://0.0.0.0:3000
		=> Call with -d to detach
		=> Ctrl-C to shutdown server
		[2013-03-12 19:11:31] INFO  WEBrick 1.3.1
		[2013-03-12 19:11:31] INFO  ruby 1.9.3 (2012-04-20) [x86_64-linux]
		[2013-03-12 19:11:31] INFO  WEBrick::HTTPServer#start: pid=9789 port=3000

2. Откройте браузер и перейдите по адресу http://localhost:3000/. Вы должны увидеть страницу, аналогичную показанной ниже:

	![страница Rails по умолчанию][default-rails]

	Это статическая страница приветствия. Чтобы просмотреть формы, создаваемые командой формирования шаблонов, перейдите по адресу http://localhost:3000/posts. Вы должны увидеть страницу, аналогичную показанной ниже:

	![страница со списком записей][blog-rails]

	Чтобы остановить серверный процесс, введите CTRL+C в командной строке.

##<a id="createvm"></a>Создание виртуальной машины Azure

Следуйте инструкциям, указанным [здесь][vm-instructions], чтобы создать виртуальную машину Azure с операционной системой Linux.

<div class="dev-callout">
<strong>Примечание.</strong>
<p>Инструкции в этом руководстве были выполнены на виртуальной машине Azure с ОС Ubuntu 12.10. При использовании другого выпуска Linux для выполнения тех же задач могут потребоваться другие действия.</p>
</div>

<div class="dev-callout">
<strong>Примечание.</strong>
<p>Необходимо <strong>только</strong> создать виртуальную машину. Остановитесь, когда узнаете, как подключиться к виртуальной машине с помощью SSH.</p>
</div> 

После создания виртуальной машины Azure выполните следующие действия, чтобы установить Ruby and Rails на виртуальной машине:

1. В окне командной строки или терминальном сеансе выполните следующую команду, чтобы подключиться к виртуальной машине с помощью SSH:

		ssh username@vmdns -p port

	Замените имя пользователя, указанное во время создания виртуальной машины, DNS-адрес виртуальной машины и порт конечной точки SSH. Например:

		ssh railsdev@railsvm.cloudapp.net -p 61830

	<div class="dev-callout">
	<strong>Примечание.</strong>
	<p>Если вы используете Windows как среду разработки, для применения функций SSH можно воспользоваться служебной программой, например <b>PuTTY</b>. PuTTY можно загрузить на <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">странице загрузки PuTTY</a>.</p>
	</div>

2. В сеансе SSH выполните следующие команды, чтобы установить Ruby на виртуальной машине:

		sudo apt-get update -y
		sudo apt-get upgrade -y
		sudo apt-get install ruby1.9.1 ruby1.9.l-dev build-essential libsqlite3-dev nodejs -y

	После установки используйте следующую команду, чтобы проверить установку Ruby:

		ruby -v

	Эта команда должна вернуть версию Ruby, установленную на данной виртуальной машине, которая может отличаться от 1.9.1. Например, **ruby 1.9.3p194 (2012-04-20 revision 35410) [x86_64-linux]**.

2. Используйте следующую команду для установки Bundler:

		sudo gem install bundler --no-rdoc --no-ri

	Bundler используется для установки пакетов, необходимых приложению Rails после его копирования на сервер.

##<a id="copy"></a>Копирование приложения на виртуальную машину

В среде разработки откройте новое окно командной строки или сеанс терминала и выполните команду **scp**, чтобы скопировать каталог **blog_app** на виртуальную машину. Для этой команды используется следующий формат:

	scp -r -P 54822 -C directory-to-copy user@vmdns:

Например:

	scp -r -P 54822 -C ~/blog_app railsdev@railsvm.cloudapp.net:

<div class="dev-callout">
<strong>Примечание.</strong>
<p>Если вы используете Windows как среду разработки, для применения функций scp можно воспользоваться служебной программой, например <b>pscp</b>. Pscp можно загрузить на <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">странице загрузки PuTTY</a>.</p>
</div>

Параметры, используемые для этой команды, приводят к получению следующих результатов:

* **-r**: рекурсивное копирование содержимого указанного каталога и всех вложенных каталогов.

* **-P**: использование указанного порта для обмена данными SSH

* **-C**: включение сжатия

* **directory-to-copy**: локальный каталог для копирования

* **user@vmdns**: адрес компьютера, на который копируются файлы, а также учетная запись пользователя для входа в систему

После завершения копирования каталог **blog_app** будет расположен в домашнем каталоге пользователей. Используйте следующие команды в сеансе SSH-подключения к виртуальной машине для просмотра скопированных файлов:

	cd ~/blog_app
	ls

Список возвращенных файлов должен соответствовать файлам в каталоге **blog_app** в вашей среде разработки.

##<a id="start"></a>Установка пакетов и запуск Rails

1. На виртуальной машине измените каталоги на **blog_app** и выполните следующую команду, чтобы установить пакеты, определенные в файле **Gemfile**:

		sudo bundle install

2. Чтобы создать базу данных, воспользуйтесь следующей командой:

		rake db:migrate

3. Используйте следующую команду для запуска сервера:
	
		rails s

	Вы должны увидеть результат, аналогичный приведенному ниже. Обратите внимание на порт, который прослушивает веб-сервер. В примере ниже это порт 3000.

		=> Booting WEBrick
		=> Rails 3.2.12 application starting in development on http://0.0.0.0:3000
		=> Call with -d to detach
		=> Ctrl-C to shutdown server
		[2013-03-12 19:11:31] INFO  WEBrick 1.3.1
		[2013-03-12 19:11:31] INFO  ruby 1.9.3 (2012-04-20) [x86_64-linux]
		[2013-03-12 19:11:31] INFO  WEBrick::HTTPServer#start: pid=9789 port=3000

2. В браузере перейдите на [портал управления Azure][management-portal] и выберите свою виртуальную машину.

	![список виртуальных машин][vmlist]

3. Выберите **КОНЕЧНЫЕ ТОЧКИ** в верхней части страницы, а затем щелкните **+ ДОБАВИТЬ КОНЕЧНУЮ ТОЧКУ** в нижней части страницы.

	![страница конечных точек][endpoints]

4. В диалоговом окне **ДОБАВЛЕНИЕ КОНЕЧНОЙ ТОЧКИ** щелкните стрелку в нижнем левом углу для перехода на вторую страницу и введите следующие данные в форме:

	* **ИМЯ**: HTTP

	* **ПРОТОКОЛ**: TCP

	* **ОБЩИЙ ПОРТ**: 80

	* **ЧАСТНЫЙ ПОРТ**: &lt;сведения о порте из шага 3&gt;

	После этого будет создан общий порт 80, который применяется для маршрутизации трафика на частный порт 300, который прослушивает сервер Rails.

	![диалоговое окно добавления конечной точки][new-endpoint]

5. Щелкните значок галочки, чтобы сохранить конечную точку.

6. Должно появиться сообщение **ВЫПОЛНЯЕТСЯ ОБНОВЛЕНИЕ**. После того как сообщение исчезнет, конечная точка будет активирована. Теперь вы можете протестировать приложение, перейдя к имени DNS виртуальной машины. Веб-сайт должен выглядеть аналогично следующему рисунку:

	![страница Rails по умолчанию][default-rails-cloud]

	Если добавить **/posts** к URL-адресу, вы увидите страницы, созданные командой формирования шаблонов.

	![страница записей][blog-rails-cloud]

##<a id="next"></a>Дальнейшие действия

В этой статье вы изучили, как создать и опубликовать базовое приложение Rails на основе форм на виртуальной машине Azure. Большинство действий, описанных здесь, были выполнены вручную. В рабочей среде этот процесс желательно автоматизировать. Кроме того, большинство рабочих сред размещают приложение Rails вместе с другим серверным процессом, например Apache или NginX, который обрабатывает маршрутизацию запросов к нескольким экземплярам приложения Rails и обслуживает статические ресурсы.

Сведения об автоматизации развертывания приложения Rails, а также об использовании веб-сервера Unicorn и NginX см. в разделе [Unicorn+NginX+Capistrano с виртуальной машиной Azure][unicorn-nginx-capistrano].

Дополнительные сведения о Ruby on Rails см. на веб-сайте [Руководства по Ruby on Rails][rails-guides].

Сведения об использовании пакета Azure SDK для Ruby для доступа к службам Azure из приложения Ruby см. в статьях:

* [Хранение неструктурированных данных с использованием BLOB-объектов][blobs]

* [Хранение пар "ключ/значение" с использованием таблиц][tables]

* [Обслуживание контента, передаваемого по каналам с высокой пропускной способностью, с помощью сети CDN][cdn-howto]



<!-- WA.com links -->
[blobs]: http://windowsazure.com/ru-ru/documentation/articles/storage-ruby-how-to-use-blob-storage

[cdn-howto]: http://www.windowsazure.com/ru-ru/develop/ruby/app-services/

[management-portal]: https://manage.windowsazure.com/

[tables]: http://www.windowsazure.com/ru-ru/develop/ruby/how-to-guides/table-service/

[unicorn-nginx-capistrano]: http://windowsazure.com/ru-ru/documentation/articles/virtual-machines-ruby-deploy-capistrano-host-nginx-unicorn/

[vm-instructions]: http://windowsazure.com/ru-ru/documentation/articles/virtual-machines-linux-tutorial


<!-- External Links -->
[rails-guides]: http://guides.rubyonrails.org/

[sqlite3]: http://www.sqlite.org/

<!-- Images -->
[blog-rails]: ./media/virtual-machines-ruby-rails-web-app-linux/blograilslocal.png

[blog-rails-cloud]: ./media/virtual-machines-ruby-rails-web-app-linux/blograilscloud.png 

[default-rails]: ./media/virtual-machines-ruby-rails-web-app-linux/basicrailslocal.png

[default-rails-cloud]: ./media/virtual-machines-ruby-rails-web-app-linux/basicrailscloud.png

[vmlist]: ./media/virtual-machines-ruby-rails-web-app-linux/vmlist.png

[endpoints]: ./media/virtual-machines-ruby-rails-web-app-linux/endpoints.png

[new-endpoint]: ./media/virtual-machines-ruby-rails-web-app-linux/newendpoint.png


