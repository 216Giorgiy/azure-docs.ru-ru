<properties linkid="biztalk-backup-restore" urlDisplayName="Службы BizTalk: резервное копирование и восстановление" pageTitle="Службы BizTalk: резервное копирование и восстановление | Azure" metaKeywords="" description="Службы BizTalk предоставляют функции резервного копирования и восстановления. При создании резервной копии выполняется снимок конфигурации служб BizTalk." metaCanonical="" services="" documentationCenter="" title="Службы BizTalk: резервное копирование и восстановление" authors=""  solutions="" writer="mandia" manager="paulettm" editor="cgronlun"  />


# Службы BizTalk: резервное копирование и восстановление

Службы Azure BizTalk предоставляют функции резервного копирования и восстановления. При создании резервной копии выполняется снимок конфигурации служб Azure BizTalk.

Рассмотрим следующие сценарии.


- Портал управления Azure позволяет создать резервную копию конфигурации служб BizTalk двумя способами: - по запросу и по расписанию.

- Содержимое резервной копии может быть восстановлено как в исходную, так и в новую службу BizTalk. Перед восстановлением службы BizTalk под тем же именем необходимо удалить существующую службу BizTalk. В противном случае восстановление завершается ошибкой.

- Службы BizTalk можно восстанавливать только в выпуски того же или более высокого уровня. Восстановление служб BizTalk в выпуски более низкого уровня не поддерживается.

	Например, резервную копию, созданную с помощью выпуска Basic, можно восстановить в выпуске Premium, но не наоборот.

- Чтобы обеспечить непрерывность, применяются контрольные номера EDI. Если сообщения обрабатываются после последнего резервного копирования, восстановление такого содержимого может привести к созданию повторяющихся контрольных номеров.

- В выпуске Developer служб BizTalk функции резервного копирования и восстановления не предусмотрены. 

В этом разделе описывается резервное копирование и восстановление служб BizTalk с помощью портала управления Azure. Кроме этого, вы можете создавать резервные копии служб BizTalk с помощью API REST. Дополнительные сведения об этом см. в разделе [API REST служб BizTalk](http://msdn.microsoft.com/library/windowsazure/dn232347.aspx). 

[Что включается в резервную копию?](#budata)

[Создание резервной копии](#createbu)

[Восстановление](#restore)


##<a name="budata"></a>Что включается в резервную копию?

В резервную копию включаются следующие элементы.

<table border="1"> 
<TR bgcolor="FAF9F9">
<th> </th>
<TH>Элементы, включаемые в резервную копию</TH> 
</TR> 
<TR>
<td colspan="2">
 <strong>Портал служб Azure BizTalk</strong></td>
</TR> 
<TR>
<TD>Конфигурация и среда выполнения</TD> 
<TD><bl>
<li>Сведения о партнере и данные профиля</li>
<li>Партнерские соглашения</li>
<li>Развернутые пользовательские сборки</li>
<li>Развернутые мосты</li>
<li>Сертификаты</li>
<li>Развернутые преобразования</li>
<li>Конвейеры</li>
<li>Шаблоны, созданные и сохраненные на портале служб BizTalk</li>
<li>Сопоставления X12 ST01 и GS01</li>
<li>Контрольные номера (EDI)</li>
<li>Значения MIC сообщения AS2</li>
</bl></TD>
</TR> 
 
<TR>
<td colspan="2">
 <strong>Служба Azure BizTalk</strong></td>
</TR> 
<TR>
<TD>Сертификат SSL</TD> 
<TD>
<bl>
<li>Данные сертификата SSL</li>
<li>Пароль сертификата SSL</li>
</bl>
</TD>
</TR> 
<TR>
<TD>Параметры службы BizTalk</TD> 
<TD>
<bl>
<li>Число модулей масштабирования</li>
<li>Выпуск</li>
<li>Версия продукта</li>
<li>Регион и центр обработки данных</li>
<li>Ключ и пространство имен службы контроля доступа (ACS)</li>
<li>Строка подключения для базы данных отслеживания</li>
<li>Строка подключения учетной записи хранения для архивации</li>
<li>Строка подключения учетной записи хранения для мониторинга</li>
</bl></TD>
</TR> 
<TR>
<td colspan="2">
 <strong>Дополнительные элементы</strong></td>
</TR> 
<TR>
<TD>База данных отслеживания</TD> 
<TD>При подготовке службы BizTalk вводятся сведения о базе данных отслеживания, включая ее имя и сервер базы данных SQL Azure. Автоматическое резервное копирование базы данных отслеживания не выполняется.<br/><br/>
<strong>Важно!</strong><br/>
Восстановление случайно удаленной базы данных отслеживания возможно только в том случае, если создана ее резервная копия. В противном случае восстановить эти данные не получится. В такой ситуации вам потребуется создать новую базу данных отслеживания с тем же именем. Рекомендуется использовать георепликацию.</TD>
</TR> 
</table>

##<a name="createbu"></a>Создание резервной копии

Процесс резервного копирования может выполняться в любое время и полностью управляется вами. Резервные копии можно создавать с помощью портала управления Azure или API REST служб BizTalk. Дополнительные сведения о создании резервных копий с помощью API REST служб BizTalk см. в разделе <a HREF="http://go.microsoft.com/fwlink/p/?LinkID=325584">Резервное копирование службы BizTalk</a>

В этом разделе описывается процедура резервного копирования с использованием портала управления. Таким образом вы можете создавать резервные копии по запросу или по расписанию через заданные интервалы.

##<a name="beforebackup"></a>Подготовка к созданию резервной копии

Прежде чем создавать резервную копию, выполните следующие рекомендации.

1. Перед запуском резервного копирования выполните обработку активных сообщений в пакете. Это позволит предотвратить потерю сообщений <i>в случае</i> восстановления резервной копии. В процессе резервного копирования сообщения с пакете не сохраняются. Если резервное копирование осуществляется по расписанию, проконтролировать обработку сообщений на момент его запуска не всегда возможно.
	<div class="dev-callout"><b>Примечание.</b>
<p>Если на момент начала резервного копирования в пакете присутствуют активные сообщения, они не копируются и будут утрачены.</p></div>
2. Необязательно. Остановите все операции управления на портале BizTalk.
4. Создайте резервную копию учетной записи хранения с использованием команд <a HREF="http://go.microsoft.com/fwlink/p/?LinkID=325584">резервного копирования службы BizTalk</a>, доступных в API REST.

[Резервное копирование по запросу](#backupnow)

[Планирование резервного копирования](#backupschedule)

###<a name="backupnow"></a>Резервное копирование по запросу
1. На портале управления Azure выберите «Службы BizTalk» и щелкните имя службы BizTalk, для которой вы хотите создать резервную копию.
2. На вкладке <b>Панель мониторинга</b> службы BizTalk выберите команду <b>Создать резервную копию</b> внизу страницы.
3. Укажите имя создаваемой копии в диалоговом окне <b>Создать резервную копию службы BizTalk</b>.
4. Выберите учетную запись хранения BLOB-объектов и щелкните значок галочки, чтобы начать резервное копирование.


По завершении резервного копирования в учетной записи хранения создается контейнер с указанным именем резервной копии. В этом контейнере содержится резервная копия конфигурации службы BizTalk.


###<a name="backupschedule"></a>Планирование резервного копирования

1. На портале управления Azure выберите «Службы BizTalk», щелкните имя службы BizTalk, для которой вы хотите запланировать автоматическое резервное копирование, и откройте вкладку **Настройка**.
2. Если вы не хотите планировать автоматическое резервное копирование, в разделе **Состояние резервного копирования** выберите **Нет**. Чтобы запланировать автоматическое резервное копирование, выберите **Автоматически**.
3. В разделе **Учетная запись хранения** выберите учетную запись хранения Azure, в которой будут создаваться резервные копии.
4. В разделе **Частота** укажите дату и время начала первого резервного копирования, а также интервал, с которым создаются резервные копии, в днях.
5. В разделе **Хранение (дни)** укажите период времени, в течение которого будут храниться резервные копии, в днях. Период хранения должен превышать заданную частоту резервного копирования.
6. Чтобы хранить как минимум одну резервную копию даже в тех случаях, когда истек период хранения, установите флажок **Всегда сохранять по крайней мере одну резервную копию**.
7. Нажмите кнопку **Сохранить**.

При выполнении задания резервного копирования по расписанию в указанной учетной записи хранения создается контейнер, в котором хранятся данные резервной копии. Имя контейнера формируется следующим образом: *имя службы BizTalk-дата-время*. 

Если выполнить резервное копирование не удается, на странице панели мониторинга службы BizTalk отображается статус **Ошибка**.

![Состояние последней запланированной архивации][BackupStatus] 

Щелкните эту ссылку, чтобы перейти на страницу «Журналы операций» службы управления, где будет представлено подробное описание ошибки. Дополнительные сведения о журналах операций для служб BizTalk см. в разделе [Службы BizTalk: устранение неполадок с помощью журналов операций](http://go.microsoft.com/fwlink/?LinkId=391211).

##<a name="restore"></a>Восстановление

Резервные копии можно восстанавливать с помощью портала управления Azure или API REST служб BizTalk. В этом разделе описывается процедура восстановления с использованием портала управления. Дополнительные сведения о восстановлении с использованием API REST см. в разделе [Восстановление служб BizTalk из резервной копии](http://go.microsoft.com/fwlink/p/?LinkID=325582).

###Подготовка к восстановлению из резервной копии

При восстановлении из резервной копии учитывайте следующие моменты.

- При восстановлении службы BizTalk можно указать новые хранилища отслеживания, архивации и мониторинга.

- Перед восстановлением службы BizTalk под тем же именем необходимо удалить существующую службу BizTalk. В противном случае восстановление завершается ошибкой.

- Восстанавливаются те же данные среды выполнения EDI. В резервной копии среды выполнения EDI хранятся контрольные номера. Последовательность восстановленных контрольных номеров соответствует моменту резервного копирования. Если сообщения обрабатываются после последнего резервного копирования, восстановление такого содержимого может привести к созданию повторяющихся контрольных номеров.

####Восстановление из резервной копии

1. На портале управления Azure выберите <b>Создать</b>, наведите указатель мыши на элемент <b>Службы приложений</b>, выберите <b>Служба BizTalk</b>, а затем щелкните <b>Восстановить</b>.

	![Восстановление из резервной копии][Restore]

2. В мастере «Новая служба BizTalk - восстановление» на странице <b>Восстановить службу BizTalk</b> щелкните значок папки в текстовом поле <b>URL-адрес резервной копии</b>. Откроется диалоговое окно <b>Обзор облачного хранилища</b>, в котором будет представлен список ваших учетных записей хранения Azure.

	Разверните учетную запись хранения, указанную при создании или планировании резервного копирования, после чего выберите имя контейнера, из которого вы хотите восстановить конфигурацию службы BizTalk.

	В правой области выберите TXT-файл, соответствующий резервной копии, из которой вы хотите восстановить данные, а затем нажмите кнопку <b>Открыть</b>.

3. Укажите следующие данные на странице <b>Восстановить службу BizTalk</b>.
- Введите имя службы BizTalk. По умолчанию используется имя службы BizTalk, для которой была создана резервная копия.
- Проверьте URL-адрес домена, выпуск и регион восстановленной службы BizTalk.
- Укажите, что необходимо создать новый экземпляр базы данных SQL для базы данных отслеживания, и нажмите кнопку со стрелкой вправо.

4. 	На странице <b>Указать параметры базы данных</b> проверьте имя базы данных SQL, укажите физический сервер, на котором будет создана база данных SQL, а также введите имя пользователя и пароль для этого сервера.

	Чтобы настроить дополнительные параметры базы данных SQL, установите флажок <b>Настройка дополнительных параметров базы данных</b> и нажмите кнопку со стрелкой вправо.

	Если настраивать дополнительные параметры базы данных не нужно, нажмите кнопку со стрелкой вправо и перейдите к шагу 6.
5. На странице <b>Дополнительные параметры базы данных</b> выберите выпуск базы данных, который вы хотите использовать (<b>Web</b> или <b>Business</b>), укажите ее максимальный размер, а также определите правила сортировки. Щелкните стрелку вправо.

6. На странице <b>Задать параметры мониторинга и архивации</b> создайте новую или укажите существующую учетную запись хранения, в которой будут храниться данные мониторинга службы BizTalk.

7. Щелкните значок галочки, чтобы начать процесс восстановления</b>.

8. В случае успешного восстановления новая служба BizTalk будет представлена на странице «Службы BizTalk» портала управления Azure со статусом «Приостановлено».

###<a name="postrestore"></a>Действия после восстановления из резервной копии

Восстановленные службы BizTalk всегда имеют статус **Приостановлено**. Это позволяет вам вносить любые изменения в конфигурацию приложений службы BizTalk до того, как новая среда будет переведена в рабочий режим. Ниже перечислены некоторые действия, которые рекомендуется выполнить перед запуском восстановленной службы BizTalk.

- Если для создания приложений службы BizTalk вы использовали пакет SDK служб Azure BizTalk, для работы в восстановленной среде вам может потребоваться обновить учетные данные службы ACS в этих приложениях.

- Возможно, вам потребуется восстановить службу BizTalk, чтобы реплицировать существующую рабочую среду службы BizTalk. В таком случае, если у вас настроены соглашения для исходного портала служб BizTalk, использующего в качестве источников общие папки FTP, вам может потребоваться обновить соглашения в восстановленной среде для работы с другими источниками или общими папками FTP. Если этого не сделать, возможны ситуации, когда одно и то же сообщение будут пытаться извлечь одновременно два соглашения.

- Если вы прибегли к операции восстановления для создания нескольких сред BizTalk, убедитесь, что вы задаете ссылки на нужную среду в приложениях Visual Studio, командлетах PowerShell, API REST и API объектной модели управления торговыми партнерами.

- Также рекомендуется настроить автоматическое резервное копирование в восстановленной среде службы BizTalk.

После выполнения этих и других рекомендаций перейдите на страницу службы BizTalk на портале управления Azure, выберите восстановленную службу BizTalk со статусом «Приостановлено» и щелкните **Продолжить** внизу страницы, чтобы запустить ее.

## Далее

Чтобы подготовить службы BizTalk Azure на портале управления Azure, перейдите по ссылке [Службы BizTalk: подготовка с использованием портала управления Azure](http://go.microsoft.com/fwlink/p/?LinkID=302280). Чтобы приступить к созданию приложений, перейдите по ссылке [Службы BizTalk Azure](http://go.microsoft.com/fwlink/p/?LinkID=235197).

## См. также
- [Резервное копирование службы BizTalk](http://go.microsoft.com/fwlink/p/?LinkID=325584)
- [Восстановление службы BizTalk из резервной копии](http://go.microsoft.com/fwlink/p/?LinkID=325582)
- [Службы BizTalk: диаграмма выпусков Developer, Basic, Standard и Premium](http://go.microsoft.com/fwlink/p/?LinkID=302279)
- [Службы BizTalk: подготовка с использованием портала управления Azure](http://go.microsoft.com/fwlink/p/?LinkID=302280)
- [Службы BizTalk: диаграмма состояния подготовки](http://go.microsoft.com/fwlink/p/?LinkID=329870)
- [Службы BizTalk: вкладки "Панель мониторинга", "Монитор" и "Масштаб"](http://go.microsoft.com/fwlink/p/?LinkID=302281)
- [Службы BizTalk: регулирование](http://go.microsoft.com/fwlink/p/?LinkID=302282)
- [Службы BizTalk: имя и ключ издателя](http://go.microsoft.com/fwlink/p/?LinkID=303941)
- [Как приступить к работе с пакетом SDK для служб BizTalk Azure](http://go.microsoft.com/fwlink/p/?LinkID=302335)

[BackupStatus]: ./media/biztalk-backup-restore/status-last-backup.png
[Restore]: ./media/biztalk-backup-restore/restore-ui.png

