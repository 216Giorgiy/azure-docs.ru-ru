<properties urlDisplayName="BizTalk Services: Backup and Restore" pageTitle="Службы BizTalk: Резервное копирование и восстановление | Azure" metaKeywords="" description="BizTalk Services includes Backup and Restore capabilities. When creating a Backup, a snapshot of the BizTalk Services configuration is taken." metaCanonical="" services="" documentationCenter="" title="BizTalk Services: Backup and Restore" authors="mandia"  solutions="" writer="mandia" manager="dwrede" editor="cgronlun"  />

<tags ms.service="biztalk-services" ms.workload="integration" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="10/14/2014" ms.author="mandia" />


# Службы BizTalk: архивация и восстановление

Службы Azure BizTalk предоставляют функции резервного копирования и восстановления. В этом разделе описывается процесс резервного копирования и восстановления служб BizTalk с помощью портала управления Azure, включая следующие темы. 

- [Перед началом работы](#beforebackup)
- [Создание резервной копии](#createbu)
- [Восстановление из резервной копии](#restore)
- [Что включается в резервную копию](#budata)

Выполнять резервное копирование служб BizTalk также можно с помощью [API REST служб BizTalk](http://go.microsoft.com/fwlink/p/?LinkID=325584). 

##<a name="beforebackup"></a>Перед началом работы

- Резервное копирование и восстановление доступны не во всех выпусках. См. [Службы BizTalk: диаграмма выпусков](http://azure.microsoft.com/ru-ru/documentation/articles/biztalk-editions-feature-chart/).

	**Примечание.** Вне зависимости от выпуска создавать резервные копии гибридных подключений невозможно.

- С помощью портала управления Azure можно осуществлять запланированное резервное копирование или по запросу. 

- Содержимое резервной копии может быть восстановлено как в исходную, так и в новую службу BizTalk. Перед восстановлением службы BizTalk под тем же именем необходимо удалить существующую службу BizTalk, и это имя должно быть доступно. После удаления службы BizTalk может понадобиться больше времени, чем хотелось бы, для освобождения этого имени. Если вы не можете ждать освобождения этого имени, выполните восстановление в новую службу BizTalk.

- Службы BizTalk можно восстанавливать только в выпуски того же или более высокого уровня. Восстановление служб BizTalk в выпуски более низкого уровня, из которых выполнялось резервное копирование, не поддерживается.

	Например, резервную копию, созданную с помощью выпуска Basic, можно восстановить в выпуске Premium, но не наоборот.

- Чтобы обеспечить непрерывность, применяются контрольные номера EDI. Если сообщения обрабатываются после последнего резервного копирования, восстановление такого содержимого может привести к созданию повторяющихся контрольных номеров.

- Если в пакете имеются активные сообщения, запустите обработку пакета **перед** резервным копированием. При создании резервной копии (запланированной или по требованию) сообщения в пакетах не сохраняются. 

	**Если на момент начала резервного копирования в пакете присутствуют активные сообщения, они не копируются и будут утрачены.**

- Необязательно: остановите все операции управления на портале служб BizTalk.


##<a name="createbu"></a>Создание резервной копии

Резервное копирование может выполняться в любое время - вы полностью управляете этим процессом. В этом разделе приведены инструкции по созданию резервных копий с помощью портала управления Azure, включая следующие темы.

[Резервное копирование по запросу](#backupnow)

[Планирование резервного копирования](#backupschedule)

####<a name="backupnow"></a>Резервное копирование по запросу
1. Выберите на портале управления Azure пункт **Службы BizTalk**, а затем соответствующую службу BizTalk для резервного копирования.
2. На вкладке **Панель мониторинга** в нижней части страницы выберите **Резервное копирование**.
3. Задайте имя резервной копии. Например, введите *моя_служба_BizTalk*РК*Дата*.
4. Выберите учетную запись хранения BLOB-объектов и щелкните по значку галочки, чтобы начать резервное копирование.

По завершении резервного копирования в учетной записи хранения создается контейнер с указанным именем резервной копии. В этом контейнере содержится резервная копия конфигурации службы BizTalk.

####<a name="backupschedule"></a>Планирование резервного копирования

1. На портале управления Azure выберите пункт **Службы BizTalk**, имя службы BizTalk, с помощью которой необходимо запланировать резервное копирование, а затем перейдите на вкладку **Настройка**.
2. Для параметра **Состояние резервного копирования** установите значение **Автоматически**. 
3. Выберите **учетную запись хранения**, в которой будет сохранена резервная копия, задайте параметр **Частота** резервного копирования и время хранения резервных копий (**Хранение (дни)**).

	![][AutomaticBU]

	**Примечания** 	
- Указанный в поле **Хранение (дни)** период хранения должен превышать заданную частоту резервного копирования.
- Выберите пункт **Всегда сохранять по крайней мере одну резервную копию**, чтобы копия хранилась даже по истечении заданного периода хранения.
	

4. Нажмите кнопку **Сохранить**.


При выполнении запланированного задания на резервное копирование в указанной учетной записи хранения создается контейнер, в котором хранятся данные резервной копии. Имя контейнера формируется следующим образом: *служба BizTalk имя-дата-время*. 

Если на панели мониторинга службы BizTalk отображается состояние **Не удалось**, потребуется следующее.

![Last scheduled backup status][BackupStatus] 

После перехода по ссылке отображаются журналы операций службы управления для устранения неполадки. См. [Службы BizTalk: устранение неполадок с помощью журналов операций](http://go.microsoft.com/fwlink/?LinkId=391211).

##<a name="restore"></a>Восстановление

Резервные копии можно создавать с помощью портала управления Azure или [API REST восстановления служб BizTalk](http://go.microsoft.com/fwlink/p/?LinkID=325582). В этом разделе приведены инструкции по восстановлению с помощью портала управления.

####Подготовка к восстановлению из резервной копии

- При восстановлении службы BizTalk можно указать новые хранилища отслеживания, архивации и мониторинга.

- Восстанавливаются те же данные среды выполнения EDI. В резервной копии среды выполнения EDI хранятся контрольные номера. Последовательность восстановленных контрольных номеров соответствует моменту резервного копирования. Если сообщения обрабатываются после последнего резервного копирования, восстановление такого содержимого может привести к созданию повторяющихся контрольных номеров.

####Восстановление из резервной копии

1. На портале управления Azure выберите **Создать** > **Службы приложений** > **Служба BizTalk** > **Восстановить**.

	![Restore a backup][Restore]

2. В поле **URL-адрес резервной копии** выберите значок папки и разверните учетную запись хранилища Azure, в которой сохранена резервная копия конфигурации службы BizTalk. Разверните контейнер и на панели справа выберите TXT-файл для соответствующей резервной копии. 
<br/><br/>
Нажмите **Открыть**.

3. На странице **Восстановить службу BizTalk** введите **Имя службы BizTalk** и проверьте **URL-адрес домена**, **Выпуск** и **Регион** восстановленной службы BizTalk. **Создайте новый экземпляр базы данных SQL** для базы данных отслеживания.

	![][RestoreBizTalkService]


	Выберите стрелку "Далее".

4. 	Проверьте имя базы данных SQL, укажите физический сервер для создания базы данных SQL и введите имя пользователя/пароль к этому серверу.


	Если необходимо настроить выпуск, размер и другие свойства базы данных SQL, выберите пункт **Настройка дополнительных параметров базы данных**. 

	Выберите стрелку "Далее".

5. Создайте новую или укажите существующую учетную запись хранения для службы BizTalk.

7. Установите флажок, чтобы запустить восстановление.

В случае успешного восстановления новая служба BizTalk будет представлена на странице "Службы BizTalk" портала управления Azure со статусом "Приостановлено".



###<a name="postrestore"></a>Действия после восстановления из резервной копии

Восстановленные службы BizTalk всегда имеют статус **Приостановлено**. В этом состоянии можно вносить любые изменения в конфигурацию до того, как новая среда будет переведена в рабочий режим, включая следующие изменения.

- Если для создания приложений службы BizTalk вы использовали пакет SDK служб Azure BizTalk, то для работы в восстановленной среде вам может потребоваться обновить учетные данные службы ACS в этих приложениях.

- Возможно, вам потребуется восстановить службу BizTalk, чтобы реплицировать существующую рабочую среду службы BizTalk. В таком случае, если у вас настроены соглашения для исходного портала служб BizTalk, использующего в качестве источников папку FTP, вам может потребоваться обновить соглашения в восстановленной среде для работы с другой исходной папкой FTP. Если нет, возможны ситуации, когда два соглашения будут одновременно пытаться извлечь одно и то же сообщение.

- Если вы выполнили восстановление для создания нескольких сред BizTalk, убедитесь, что вы задаете ссылки на нужную среду в приложениях Visual Studio, командлетах PowerShell, API REST и API объектной модели управления торговыми партнерами.

- Также рекомендуется настроить автоматическое резервное копирование в восстановленной среде службы BizTalk.

Для запуска службы BizTalk из портала управления Azure выберите восстановленную службу BizTalk, затем выберите **Продолжить** на панели задач. 



##<a name="budata"></a>Что включается в резервную копию

В резервную копию включаются следующие элементы.

<table border="1"> 
<tr bgcolor="FAF9F9">
<th> </th>
<TH>Архивированные элементы</TH> 
</tr> 
<tr>
<td colspan="2">
 <strong>Портал служб Azure BizTalk</strong></td>
</tr> 
<tr>
<td>Конфигурация и среда выполнения</td> 
<td>
<ul>
<li>Сведения о партнере и данные профиля</li>
<li>Партнерские соглашения</li>
<li>Развернутые пользовательские сборки</li>
<li>Развернутые мосты</li>
<li>Сертификаты</li>
<li>Развернутые преобразования</li>
<li>Конвейеры</li>
<li>Шаблоны, созданные и сохраненные на портале служб BizTalk</li>
<li>Сопоставления X12 ST01 и GS01</li>
<li>Контрольные номера (EDI)</li>
<li>Значения MIC сообщения AS2</li>
</ul>
</td>
</tr> 
 
<tr>
<td colspan="2">
 <strong>Служба Azure BizTalk</strong></td>
</tr> 
<tr>
<td>Сертификат SSL</td> 
<td>
<ul>
<li>Данные сертификата SSL</li>
<li>Пароль сертификата SSL</li>
</ul>
</td>
</tr> 
<tr>
<td>Параметры службы BizTalk</td> 
<td>
<ul>
<li>Число модулей масштабирования</li>
<li>Выпуск</li>
<li>Версия продукта</li>
<li>Регион и центр обработки данных</li>
<li>Ключ и пространство имен службы контроля доступа (ACS)</li>
<li>Строка подключения к базе данных отслеживания</li>
<li>Строка подключения учетной записи хранения для архивации</li>
<li>Строка подключения учетной записи хранения для мониторинга</li>
</ul>
</td>
</tr> 
<tr>
<td colspan="2">
 <strong>Дополнительные элементы</strong></td>
</tr> 
<tr>
<td>База данных отслеживания</td> 
<td>При создании службы BizTalk вводятся сведения о базе данных отслеживания, включая ее имя и сервер базы данных SQL Azure. Автоматическое резервное копирование базы данных отслеживания не выполняется.
<br/><br/>
<strong>Важно!</strong><br/>
Восстановление удаленной базы данных отслеживания возможно только в том случае, если создана ее резервная копия. В противном случае восстановить эти данные не получится. В такой ситуации вам потребуется создать новую базу данных отслеживания с тем же именем. Рекомендуется использовать георепликацию.</td>
</tr> 
</table>

## Далее

Сведения о создании служб BizTalk Windows Azure на портале управления Windows Azure см. в разделе [Службы BizTalk: подготовка с использованием портала управления Azure](http://go.microsoft.com/fwlink/p/?LinkID=302280). Чтобы приступить к созданию приложений, перейдите в раздел [Службы BizTalk Azure](http://go.microsoft.com/fwlink/p/?LinkID=235197).

## См. также
- [Резервное копирование службы BizTalk](http://go.microsoft.com/fwlink/p/?LinkID=325584)
- [Восстановление службы BizTalk из резервной копии](http://go.microsoft.com/fwlink/p/?LinkID=325582)
- [Службы BizTalk: диаграмма выпусков Developer, Basic, Standard и Premium](http://go.microsoft.com/fwlink/p/?LinkID=302279)
- [Службы BizTalk: подготовка с использованием портала управления Azure](http://go.microsoft.com/fwlink/p/?LinkID=302280)
- [Службы BizTalk: диаграмма состояния подготовки](http://go.microsoft.com/fwlink/p/?LinkID=329870)
- [Службы BizTalk: вкладки "Панель мониторинга", "Монитор" и "Масштаб"](http://go.microsoft.com/fwlink/p/?LinkID=302281)
- [Службы BizTalk: регулирование](http://go.microsoft.com/fwlink/p/?LinkID=302282)
- [Службы BizTalk: имя и ключ издателя](http://go.microsoft.com/fwlink/p/?LinkID=303941)
- [Как приступить к работе с пакетом SDK для служб BizTalk Azure](http://go.microsoft.com/fwlink/p/?LinkID=302335)

[BackupStatus]: ./media/biztalk-backup-restore/status-last-backup.png
[Restore]: ./media/biztalk-backup-restore/restore-ui.png
[AutomaticBU]: ./media/biztalk-backup-restore/AutomaticBU.png
[RestoreBizTalkService]: ./media/biztalk-backup-restore/RestoreBizTalkServiceWindow.png
