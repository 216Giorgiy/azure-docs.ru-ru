<properties 
	pageTitle="Шаг 4. Обучение и анализ моделей прогнозирующей аналитики | Azure" 
	description="Шаг 4 пошагового руководства решения. Обучение, оценка и анализ нескольких моделей в Студии машинного обучения Azure" 
	services="machine-learning" 
	documentationCenter="" 
	authors="garyericson" 
	manager="paulettm" 
	editor="cgronlun"/>

<tags 
	ms.service="machine-learning" 
	ms.workload="data-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/29/2015" 
	ms.author="garye"/>


Это четвертый шаг из пошагового руководства [Разработка прогнозирующего решения с помощью Azure ML][develop]:

[develop]: ../machine-learning-walkthrough-develop-predictive-solution/

1.	[Создание рабочей области ML][create-workspace]
2.	[Отправка существующих данных][upload-data]
3.	[Создание нового эксперимента][create-new]
4.	**Обучение и анализ моделей**
5.	[Публикация веб-службы][publish]
6.	[Доступ к веб-службе][access-ws]

[create-workspace]: ../machine-learning-walkthrough-1-create-ml-workspace/
[upload-data]: ../machine-learning-walkthrough-2-upload-data/
[create-new]: ../machine-learning-walkthrough-3-create-new-experiment/
[train-models]: ../machine-learning-walkthrough-4-train-and-evaluate-models/
[publish]: ../machine-learning-walkthrough-5-publish-web-service/
[access-ws]: ../machine-learning-walkthrough-6-access-web-service/

----------

# Шаг 4. Обучение и анализ моделей прогнозирующей аналитики


В этом эксперименте мы планируем испытать разные алгоритмы для нашей прогнозирующей модели. Мы создадим два разных типа моделей и сравним результаты их оценки, чтобы решить, какой алгоритм мы хотим использовать в нашем финальном эксперименте.  

Существует ряд моделей, которые можно выбрать. Чтобы просмотреть доступные модели, разверните узел **Машинное обучение** в палитре модулей, а затем разверните узел **Инициализация модели** и узлы под ним. Для данного эксперимента мы выберем метод опорных векторов (SVM) и двухклассовые увеличивающиеся деревья решений. Мы будем использовать соответствующие модули для инициализации алгоритмов обучения и модули **Обучение модели** для обучения моделей.   

##Обучение моделей
Сначала давайте настроим модель увеличивающегося дерева решений.  

1.	Найдите модуль **Двухклассовое увеличивающееся дерево решений** в палитре модулей и перетащите его на полотно.
2.	Найдите модуль **Обучение модели**, перетащите его на полотно, а затем подключите выход модуля увеличивающегося дерева решений к левому входному порту ("Необученная модель") модуля **Обучение модели**.
3.	Подключите выход левого модуля **Выполнение скрипта R** к правому входному порту ("Набор данных") модуля **Обучение модели**.

	>Подсказка. Для данного эксперимента нам не нужны два входа и один выход модуля **Выполнение скрипта R**, и мы просто оставим их неподключенными. Это не редкость для некоторых модулей.


4.	Выберите модуль **Обучение модели**. На панели **Свойства** выберите **Запустить средство выбора столбцов**, в первом раскрывающемся списке выберите "Включить", во втором раскрывающемся списке выберите "Индексы столбцов" и введите "21" в текстовом поле (можно также выбрать "Имя столбца" и ввести "Кредитный риск"). Столбец 21, содержащий значение кредитного риска, будет задан в качестве столбца, значение которого должна прогнозировать модель.


Теперь эта часть эксперимента выглядит следующим образом:  

![Training a model][1]
 
Теперь настроим модель SVM.  

Увеличивающиеся деревья решений хорошо работают с атрибутами любого типа. Однако, поскольку модуль SVM создает линейный классификатор, формируемая им модель имеет наименьшую ошибку при проверке среди всех атрибутов одного масштаба. Для преобразования всех числовых атрибутов в один масштаб мы используем модуль **Нормализация данных** с преобразованием Tanh, позволяющим привести атрибуты в диапазон [0,1]. Обратите внимание, что строковые атрибуты преобразуются модулем SVM в категориальные атрибуты, а затем в бинарные атрибуты 0/1, поэтому вручную их преобразовывать не нужно. Кроме того, мы не хотим преобразовывать столбец кредитного риска (столбец 21) - он числовой, но мы обучаем модель прогнозировать именно его значение, поэтому нам не нужно его трогать.  

1.	Найдите модуль **Двухклассовый метод опорных векторов** в палитре модулей и перетащите его на полотно.
2.	Щелкните правой кнопкой мыши модуль **Обучение модели**, выберите **Копировать**, а затем щелкните правой кнопкой мыши полотно и выберите **Вставить**. Обратите внимание, что копия модуля **Обучение модели** имеет тот же набор столбцов, что и оригинал.
3.	Подключите выход модуля SVM к левому входному порту ("Необученная модель") модуля **Обучение модели**.
4.	Найдите модуль **Нормализация данных** и перетащите его на полотно.
5.	Подключите вход модуля преобразования к выходу левого модуля **Выполнение скрипта R**.
6.	Подключите левый выходной порт ("Преобразованный набор данных") модуля преобразования к правому входному порту ("Набор данных") модуля **Обучение модели**.
7.	На панели **Свойства** для модуля преобразования выберите значение "Tanh" для параметра **Метод преобразования**.
8.	Нажмите **Запустить средство выбора столбцов**, в первом раскрывающемся списке выберите "Включить", во втором раскрывающемся списке выберите "Тип столбца" и в третьем раскрывающемся списке выберите "Числовой". Это указывает, что будут преобразованы все числовые столбцы (и только числовые).
9.	Нажмите знак "плюс" (+), чтобы создать новую строку раскрывающегося списка. Выберите "Исключить" в первом раскрывающемся списке, выберите "Индексы столбцов" во втором раскрывающемся списке и введите "21" в текстовом поле. Это указывает, что столбец 21 (столбец "Кредитный риск") будет игнорироваться.
10.	Нажмите кнопку **ОК**.  


Теперь модуль **Нормализация данных** настроен для выполнения преобразования tanh во всех числовых столбцах, за исключением столбца "Кредитный риск".  

Теперь эта часть эксперимента должна выглядеть следующим образом:  

![Training the second model][2]  

##Оценка и анализ моделей
Мы будем использовать данные оценки, которые были отделены модулем **Разделение**, для оценки обученных моделей. Затем можно сравнить результаты двух моделей, чтобы увидеть, которая модель создает лучший результат.  

1.	Найдите модуль **Оценка модели** и перетащите его на полотно.
2.	Подключите левый входной порт этого модуля к модели увеличивающегося дерева решений (то есть подключите его к выходному порту модуля **Обучение модели**, который подключен к модулю **Двухклассовое увеличивающееся дерево решений**).
3.	Подключите правый входной порт модуля **Оценка модели** к выходу правого модуля **Выполнение скрипта R**. Обратите внимание, что выход модуля может быть подключен к нескольким местам. Это нормально.
4.	Скопируйте и вставьте модуль **Оценка модели**, чтобы создать вторую копию, или перетащите новый модуль на полотно.
5.	Подключите левый входной порт этого модуля к модели SVM (то есть подключите его к выходному порту модуля **Обучение модели**, который подключен к модулю **Двухклассовый метод опорных векторов**).
6.	Для модели SVM необходимо выполнить то же самое преобразование тестовых данных, которое делалось для обучающих данных. Поэтому скопируйте и вставьте модуль **Нормализация данных**, чтобы создать вторую копию, и подключите ее к выходу правого модуля **Выполнение скрипта R**.
7.	Подключите правый входной порт модуля **Оценка модели** к выходу правого модуля **Нормализация данных**.  

Для анализа двух результатов оценки мы будем использовать модуль **Анализ модели**.  

1.	Найдите модуль **Анализ модели** и перетащите его на полотно.
2.	Подключите левый входной порт к выходному порту модуля **Оценка модели**, связанного с моделью увеличивающегося дерева решений.
3.	Подключите правый входной порт к другому модулю **Оценка модели**.  

Теперь наш эксперимент должен выглядеть следующим образом:  

![Evaluating both models][3]
 
Нажмите кнопку **ВЫПОЛНИТЬ** под полотном, чтобы запустить эксперимент. Это может занять несколько минут. В каждом модуле будет отображаться вращающийся индикатор, показывающий, что модуль выполняется, а по окончании выполнения модуля появится зеленая галочка.   

Если эта галочка появилась во всех модулях, значит выполнение эксперимента завершено. Чтобы проверить результаты, щелкните правой кнопкой мыши выходной порт модуля **Анализ модели** и выберите **Визуализировать**.  

Модуль **Анализ модели** создает пару кривых и метрики, позволяющие сравнить результаты двух оцененных моделей. Результаты можно видеть в виде кривых ROC (рабочих характеристик приемника), кривых точности/полноты или кривых точности прогноза. Дополнительные отображаемые данные включают матрицу несоответствий, накопительные значения AUC и другие метрики. Вы можете изменить пороговое значение, перемещая ползунок влево или вправо, чтобы посмотреть, как это влияет на набор метрик.  

Щелкните "Оцененный набор данных" или "Оцененный набор данных для сравнения", чтобы выделить соответствующую кривую и отобразить внизу соответствующие метрики. В условных обозначениях для кривых "Оцененный набор данных" соответствует левому входному порту модуля **Анализ модели** - в нашем случае это модель увеличивающегося дерева решений. "Оцененный набор данных для сравнения" соответствует правому входному порту - в нашем случае это модель SVM. Щелкните одну из этих меток, чтобы выделить кривую для этой модели и отобразить внизу соответствующие метрики.  

![ROC curves for models][4]
 
Изучив эти значения, можно решить, какая модель ближе к тому, чтобы давать нужные результаты. Можно вернуться назад и выполнить итерацию в эксперименте, изменяя значения в разных моделях.  

>Подсказка. При каждом выполнении эксперимента запись об этой итерации сохраняется в журнале выполнения. Эти итерации можно просмотреть и вернуться к любой из них, выбрав **ПРОСМОТР ЖУРНАЛА ВЫПОЛНЕНИЯ** под полотном. Можно также выбрать **Предыдущее выполнение** на панели **Свойства**, чтобы вернуться к итерации, которая выполнялась непосредственно перед той, которая открыта в текущий момент.  

Вы также можете сделать копию любой итерации эксперимента, нажав кнопку **СОХРАНИТЬ КАК** под полотном. Таким образом создается дубликат эксперимента и новый журнал выполнения для отслеживания итераций этой версии. Новая копия отображается в списке **ЭКСПЕРИМЕНТЫ** наряду с исходной. Это удобно, если планируется начать новую ветвь итераций эксперимента.  

Чтобы облегчить отслеживание изменений параметров модуля, можно добавлять примечания к любому модулю на полотне эксперимента. Просто дважды щелкните модуль или щелкните его правой кнопкой мыши и выберите пункт **Изменить примечание**. Эти примечания сохраняются с итерациями эксперимента и помогают делать заметки по выполненной работе.


----------

**Далее: [Публикация веб-службы][publish]**

[1]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train1.png
[2]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train2.png
[3]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train3.png
[4]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train4.png

<!--HONumber=46--> 
