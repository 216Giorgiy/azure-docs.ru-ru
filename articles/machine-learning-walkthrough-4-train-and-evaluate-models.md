<properties title="Step 4: Train and evaluate the predictive analytic models" pageTitle="Step 4: Train and evaluate the predictive analytic models | Azure" description="Step 4: Train, score, and evaluate multiple models in Azure Machine Learning Studio" metaKeywords="" services="" solutions="" documentationCenter="" authors="garye" videoId="" scriptId="" />

<tags ms.service="machine-learning" ms.workload="tbd" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="garye"></tags>

Это четвертый шаг из пошагового руководства [Разработка прогнозирующего решения с помощью Azure ML][Разработка прогнозирующего решения с помощью Azure ML].

1.  [Создание рабочего пространства ML][Создание рабочего пространства ML]
2.  [Отправка существующих данных][Отправка существующих данных]
3.  [Создание нового эксперимента][Создание нового эксперимента]
4.  **Подготовка и оценка моделей**
5.  [Публикация веб-службы][Публикация веб-службы]
6.  [Доступ к веб-службе][Доступ к веб-службе]

------------------------------------------------------------------------

# Шаг 4. Обучение и анализ моделей прогнозной аналитики

В этом эксперименте мы планируем испытать разные алгоритмы для нашей прогнозной модели. Мы создадим два разных типа модели и сравним результаты их оценки, чтобы решить, какой алгоритм мы хотим использовать в нашем финальном эксперименте.

Существует множество моделей, которые можно выбрать. Чтобы просмотреть доступные модели, разверните узел **Машинное обучение** в палитре модулей, а затем разверните узел **Инициализация модели** и узлы под ним. Для данного эксперимента мы выберем метод опорных векторов (SVM) и двухклассовые увеличивающиеся деревья решений. Мы будем использовать соответствующие модули для инициализации алгоритмов обучения, а затем использовать модули **обучения модели** для обучения моделей.

## Обучение моделей

Сначала давайте настроим модель увеличивающегося дерева решений.

1.  Найдите модуль **Двухклассовое увеличивающееся дерево решений** в палитре модулей и перетащите его на холст.
2.  Найдите модуль **Обучение модели**, перетащите его на холст, а затем подключите точку вывода модуля увеличивающегося дерева решений к левому порту ввода ("Необученная модель") модуля **Обучение модели**.
3.  Соедините левую точку вывода модуля **Выполнение скрипта R** с правым портом ввода ("Набор данных") модуля **Обучение модели**.

    > Совет. Для данного эксперимента две точки ввода и одна точка вывод модуля **Выполнение скрипта R** не нужны, и мы просто оставим их неподключенными. Это не редкость для некоторых модулей.

4.  Выберите модуль **Обучение модели**. В панели **Свойства** щелкните **Запустить средство выбора столбцов**, в первом раскрывающемся списке выберите "Индексы столбцов" и введите "21" в текстовом поле (можно также выбрать "Имя столбца" и ввести "Credit risk"). Это задает столбец 21, содержащий значение кредитного риска, в качестве столбца, значение которого должна прогнозировать модель.

Теперь эта часть эксперимента выглядит следующим образом.

![Обучение модели][Обучение модели]

Теперь настроим модель SVM.

Увеличивающиеся деревья решений хорошо работают с функциями любого типа. Однако поскольку модуль SVM создает линейный классификатор, генерируемая им модель имеет наименьшую ошибку при проверке среди всех атрибутов одного масштаба. Для преобразования всех атрибутов в один масштаб используем модуль **Преобразование данных масштабированием** с преобразованием Tanh. Обратите внимание, что строковые атрибуты преобразуются модулем SVM в категорийные атрибуты, а затем в бинарные атрибуты 0/1, поэтому вручную их преобразовывать не нужно. Кроме того, мы не хотим преобразовывать столбец кредитного риска (столбец 21) — он числовой, но мы обучаем модель прогнозировать именно его значение, поэтому нам не нужно его трогать.

1.  Найдите модуль **Двухклассовый метод опорных векторов** в палитре модулей и перетащите его на холст.
2.  Щелкните правой кнопкой мыши модуль **Обучение модели**, выберите команду **Копировать**, затем щелкните правой кнопкой мыши холст и выберите команду **Вставить**. Обратите внимание, что копия модуля **Обучение модели** имеет тот же набор выбранных столбцов, что и оригинал.
3.  Соедините вывод модуля SVM с левым портом ввода ("Необученная модель") модуля **Обучение модели**.
4.  Найдите модуль **Преобразование данных масштабированием** и перетащите его на холст.
5.  Соедините ввод модуля преобразования с выводом левого модуля **Выполнение скрипта R**.
6.  Соедините левый порт вывода ("Преобразованный набор данных") модуля преобразования с правым портом ввода ("Набор данных") модуля **Обучение модели**.
7.  В панели **Свойства** для модуля преобразования выберите значение "Tanh" для параметра **Метод преобразования**.
8.  Нажмите **Запустить средство выбора столбцов**. В первом раскрывающемся списке выберите "Типы столбцов", а во втором раскрывающемся списке выберите "Числовой" (в третьем раскрывающемся списке оставьте выбранным значение "Все"). Это указывает, что будут преобразованы все числовые столбцы (и только числовые).
9.  Нажмите знак "плюс" (+), чтобы создать новую строку раскрывающегося списка. Выберите "Исключить индексы столбцов" в первом раскрывающемся списке и введите "21" в текстовом поле. Это указывает, что столбец 21 (столбец кредитного риска) будет игнорироваться.
10. Нажмите кнопку **ОК**.

Теперь модуль **Преобразование данных масштабированием** настроен для выполнения преобразования tanh во всех числовых столбцах, кроме столбца кредитного риска (Credit Risk).

Теперь эта часть эксперимента должна выглядеть следующим образом.

![Обучение второй модели][Обучение второй модели]

## Оценка и анализ моделей

Мы будем использовать данные оценки, которые были отделены модулем **разделения** для оценки обученных моделей. Затем можно сравнить результаты двух моделей, чтобы увидеть, которая модель создает лучший результат.

1.  Найдите модуль **Оценка модели** и перетащите его на холст.
2.  Соедините левый порт ввода этого модуля с моделью увеличивающегося дерева решений (т. е. соедините его с портом вывода модуля **Обучение модели**, который соединен с модулем **Двухклассовое увеличивающееся дерево решений**).
3.  Соедините правую точку ввода модуля **Оценка модели** с выводом правого модуля **Выполнение скрипта R**. Обратите внимание, что вывод модуля может передаваться в несколько мест.
4.  Скопируйте и вставьте модуль **Оценка модели**, чтобы создать вторую копию, или перетащите новый модуль на холст.
5.  Соедините левый порт ввода этого модуля с моделью SVM (т. е. соедините его с портом вывода модуля **Обучение модели**, который соединен с модулем **Двухклассовый метод опорных векторов**).
6.  В модели SVM необходимо выполнить то же самое преобразование для данных тестирования, которое делалось для данных обучения. Поэтому скопируйте и вставьте модуль **Преобразование данных масштабированием**, чтобы создать вторую копию и подключить ее к выводу правого модуля **Выполнение скрипта R**.
7.  Соедините правую точку ввода модуля **Оценка модели** с выводом модуля **Преобразование данных масштабированием**.

Для сравнения двух результатов оценки мы будем использовать модуль **Анализ модели**.

1.  Найдите модуль **Анализ модели** и перетащите его на холст.
2.  Соедините левый порт ввода с портом вывода модуля **Оценка модели**, связанного с моделью увеличивающегося дерева решений.
3.  Соедините правый порт ввода с другим модулем **Оценка модели**.

Теперь наш эксперимент должен выглядеть следующим образом:

![Сравнение обеих моделей][Сравнение обеих моделей]

Нажмите кнопку **ВЫПОЛНИТЬ** внизу холста, чтобы запустить эксперимент. Это может занять несколько минут. В каждом модуле будет отображаться вращающийся индикатор, показывающий, что модуль выполняется, а когда модуль завершит работу, появится зеленая галочка.

Если эта галочка появилась во всех модулях, значит эксперимент завершил выполнение. Чтобы проверить результаты, щелкните правой кнопкой мыши порт вывода модуля **Анализ модели** и выберите **Визуализировать**.

Модуль **Анализ модели** создает пару кривых и метрики, позволяющие сравнить результаты двух оцененных моделей. Результаты можно видеть в виде кривых ROC (рабочих характеристик приемника), кривых точности/полноты или кривых точности прогноза. Дополнительные отображаемые данные включают матрицу несоответствий, накопительные значения AUC и другие метрики. Можно изменять пороговое значение, перемещая ползунок влево или вправо и наблюдая, как это влияет на набор метрик.

Щелкните "Scored dataset" (Оцененный набор данных) или "Scored dataset to compare" (Оцененный набор данных для сравнения), чтобы выделить соответствующую кривую и отобразить внизу соответствующие метрики. В условных обозначениях для кривых "Scored dataset" (оцененный набор данных) соответствует левому порту ввода модуля **Оценка модели** — в нашем случае это модель увеличивающегося дерева решений. "Scored dataset to compare" (оцененный набор данных для сравнения) соответствует правому порту ввода — в нашем случае это модель SVM. Щелкая одну из этих меток, можно выделить кривую для этой модели и отобразить внизу соответствующие метрики.

![Кривые ROC для моделей][Кривые ROC для моделей]

Изучая эти значения, можно решить, какая модель ближе к тому, чтобы давать нужные результаты. Можно вернуться обратно и выполнить итерацию в эксперименте, изменяя значения в разных моделях.

> Совет. При каждом выполнении эксперимента запись об этой итерации сохраняется в журнале выполнения. Эти итерации можно просмотреть и вернуться к любой из них, нажав кнопку **ПРОСМОТР ЖУРНАЛА ВЫПОЛНЕНИЯ** под холстом. Можно также нажать **Предыдущее выполнение** в панели **Свойств**, чтобы вернуться в итерацию, которая выполнялась непосредственно перед той, что в текущий момент открыта.

Можно сделать копию любой итерации эксперимента, нажав кнопку **СОХРАНИТЬ КАК** под холстом. Таким образом создается дубликат эксперимента и новый журнал выполнения для отслеживания итераций этой версии. Новая копия отображается в списке **экспериментов** наряду с исходной. Это удобно, если планируется начать новую ветвь итераций эксперимента.

Чтобы облегчить отслеживание изменений параметров модуля, можно добавлять примечания к любому модулю на холсте эксперимента. Просто дважды щелкните модуль или щелкните его правой кнопкой мыши и выберите пункт **Изменить примечание**. Эти примечания сохраняются с итерациями эксперимента и помогают делать заметки по выполненной работе.

------------------------------------------------------------------------

**Далее: [Публикация веб-службы][Публикация веб-службы]**

  [Разработка прогнозирующего решения с помощью Azure ML]: ../machine-learning-walkthrough-develop-predictive-solution/
  [Создание рабочего пространства ML]: ../machine-learning-walkthrough-1-create-ml-workspace/
  [Отправка существующих данных]: ../machine-learning-walkthrough-2-upload-data/
  [Создание нового эксперимента]: ../machine-learning-walkthrough-3-create-new-experiment/
  [Публикация веб-службы]: ../machine-learning-walkthrough-5-publish-web-service/
  [Доступ к веб-службе]: ../machine-learning-walkthrough-6-access-web-service/
  [Обучение модели]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train1.png
  [Обучение второй модели]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train2.png
  [Сравнение обеих моделей]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train3.png
  [Кривые ROC для моделей]: ./media/machine-learning-walkthrough-4-train-and-evaluate-models/train4.png
