<properties 
	pageTitle="Блокировка ресурсов с помощью диспетчера ресурсов Azure" 
	description="Заблокируйте ресурсы, чтобы предотвратить обновление или удаление некоторых ресурсов." 
	services="azure-resource-manager" 
	documentationCenter="" 
	authors="tfitzmac" 
	manager="wpickett" 
	editor=""/>

<tags 
	ms.service="azure-resource-manager" 
	ms.workload="multiple" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="07/15/2015" 
	ms.author="tomfitz"/>

# Блокировка ресурсов с помощью диспетчера ресурсов Azure

Как администратору в некоторых сценариях вам нужно будет заблокировать ресурс или группу ресурсов, чтобы другие пользователи организации не смогли совершить действие записи или случайно удалить важный ресурс.

Диспетчер ресурсов Azure позволяет ограничивать операции с ресурсами с помощью блокировки управления ресурсами. Блокировки ресурсов — это политики, которые принудительно применяют уровень блокировки в определенной области. Уровень блокировки определяет тип применения политики, который в настоящее время имеет два значения — **CanNotDelete** и **ReadOnly**. Область выражается в виде URI и может быть ресурсом или группой ресурсов.

Блокировка отличается от назначения разрешений пользователя для разрешения выполнения определенных действий. Дополнительную информацию о задании разрешений для пользователей и ролей см. в статьях [Управление доступом на основе ролей на портале предварительной версии](role-based-access-control-configure.md) и [Управление доступом к ресурсам и его аудит](resource-group-rbac.md).

## Распространенные сценарии

Один из типичных сценариев — у вас есть группа ресурсов с некоторыми ресурсами, которые используются время от времени. Ресурсы виртуальной машины периодически включаются для обработки данных в течение заданного интервала времени, а затем выключаются. В этом сценарии нужно будет завершить работу виртуальных машин, при этом не удаляя учетную запись хранения. Здесь нужно использовать блокировку ресурсов уровня **CanNotDelete** для учетной записи хранения.

Второй сценарий — у вашей организации могут быть периоды, когда не требуется обновление рабочей среды. Уровень блокировки **ReadOnly** предотвращает операции создания или обновления. Компании розничной торговли может понадобиться, чтобы обновления не выполнялись в сезон праздничных покупок. Компании, предоставляющие финансовые услуги, могут вводить ограничения на развертывания в течение определенных рыночных часов. Для блокировки ресурсов можно назначить соответствующую политику. Ее можно применить только к определенным ресурсам или ко всей группе ресурсов.

## Создание блокировки в шаблоне

В приведенном ниже примере показан шаблон, который создает блокировку для учетной записи хранения. Учетная запись хранения, к которой следует применить блокировку, предоставляется в качестве параметра и используется в сочетании с функцией concat(). Затем следует имя ресурса с дополнением Microsoft.Authorization и именем блокировки (в этом случае — **myLock**).

Используемый тип зависит от типа ресурса. Тип для хранилища — Microsoft.Storage/storageaccounts/providers/locks.

Уровень области задается с помощью свойства **level** определенного ресурса. Так как этот пример призван предотвратить случайное удаление, задается уровень **CannotDelete**.

    {
        "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
        "contentVersion": "1.0.0.0",
        "parameters": {
            "lockedResource": {
                "type": "string"
            }
        },
        "resources": [
            {
                "name": "[concat(parameters('lockedResource'), '/Microsoft.Authorization/myLock')]",
                "type": "Microsoft.Storage/storageAccounts/providers/locks",
                "apiVersion": "2015-01-01",
                "properties": {
	                "level": "CannotDelete"
                }
            }
        ]
    }

## Создание блокировки с помощью REST API

Можно заблокировать развернутые ресурсы с помощью [REST API для блокировки управления](https://msdn.microsoft.com/library/azure/mt204563.aspx). REST API позволяет создавать и удалять блокировки и получать информацию о существующих блокировках.

Чтобы создать блокировку, выполните следующую команду:

    PUT https://management.azure.com/{scope}/providers/Microsoft.Authorization/locks/{lock-name}?api-version={api-version}

Областью может быть подписка, группа ресурсов или ресурс. Вы можете назначить блокировке любое имя. Используйте версию API **2015-01-01**.

В запросе включите объект JSON, который задает свойства блокировки.

    {
        "properties": {
            "level": {lock-level},
            "notes": "Optional text notes."
        }
    } 

Для уровня блокировки задайте **CanNotDelete** или **ReadOnly**.

Примеры см. в разделе [REST API для управления блокировками](https://msdn.microsoft.com/library/azure/mt204563.aspx).

## Создание блокировки с помощью Azure PowerShell

Вы можете заблокировать развернутые ресурсы с помощью Azure PowerShell, используя командлет **New-AzureResourceLock**, как показано ниже.

    PS C:\> New-AzureResourceLock -LockLevel CanNotDelete -LockName LockSite -ResourceName examplesite -ResourceType Microsoft.Web/sites -ResourceGroupName ExampleGroup

PowerShell предоставляет другие команды для рабочих блокировок, такие как **Set-AzureResourceLock**, чтобы обновить блокировку, и **Remove-AzureResourceLock**, чтобы удалить ее.

## Дальнейшие действия

- [Использование тегов для организации ресурсов](resource-group-using-tags.md)
- [Перемещение ресурсов в новую группу ресурсов](resource-group-move-resources.md)

<!---HONumber=August15_HO6-->