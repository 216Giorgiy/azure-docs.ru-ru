<properties 
	pageTitle="Отладка приложения API в службе приложений Azure" 
	description="Узнайте, как отлаживать приложение API, когда оно выполняется в службе приложений Azure, с помощью Visual Studio." 
	services="app-service\api" 
	documentationCenter=".net" 
	authors="bradygaster" 
	manager="wpickett" 
	editor="jimbe"/>

<tags 
	ms.service="app-service-api" 
	ms.workload="web" 
	ms.tgt_pltfrm="dotnet" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="02/19/2015" 
	ms.author="bradyg;tarcher"/>

# Отладка приложения API в службе приложений Azure 

## Обзор

В этом учебнике выполняется отладка кода веб-API ASP.NET во время его выполнения в [приложении API](app-service-api-apps-why-best-platform.md) в [службе приложений Azure](app-service-value-prop-what-is.md). Учебник работает с приложением API, которое вы [создавали](app-service-dotnet-create-api-app.md) и [развертывали](app-service-dotnet-deploy-api-app.md) в предыдущих учебниках этой серии.

Мы начнем с использования компонента **клиента приложения API** Visual Studio для создания клиентского кода, который вызывает развернутое приложение API. Затем будет выполняться одновременная отладка клиентского приложения и приложения API во время выполнения приложения API в облаке.

## Создание клиента приложения API 

Средства приложения API в Visual Studio упрощают написание кода на C#, который вызывает приложения API Azure с рабочего стола, из хранилища и мобильных приложений.

1. В Visual Studio откройте решение, которое содержит приложение API из раздела [Создание приложения API](app-service-dotnet-create-api-app.md). 

2. В **обозревателе решений** щелкните решение правой кнопкой мыши и последовательно выберите пункты **Добавить** > **Новый проект**.

	![Добавление нового проекта](./media/app-service-dotnet-remotely-debug-api-app/01-add-new-project-v3.png)

3. В диалоговом окне **Добавление нового проекта** выполните следующие действия.

	1. Выберите категорию **Классические приложения Windows**.
	
	2. Выберите шаблон проекта **Консольное приложение**.
	
	3. Дайте проекту имя.
	
	4. Нажмите кнопку **ОК**, чтобы создать новый проект в существующем решении.
	
	![Добавление нового проекта](./media/app-service-dotnet-remotely-debug-api-app/02-contact-list-console-project-v3.png)

4. Щелкните правой кнопкой мыши только что созданный проект консольного приложения и последовательно выберите пункты **Добавить** > **Клиент приложения API Azure**.

	![Добавление нового клиента](./media/app-service-dotnet-remotely-debug-api-app/03-add-azure-api-client-v3.png)
	
5. В диалоговом окне **Добавление клиента приложения API Microsoft Azure** выполните следующие действия.

	1. Выберите пункт **Загрузка**. 
	
	2. В раскрывающемся списке щелкните приложение API, созданное ранее.
	
	3. Нажмите кнопку **ОК**.

	![Экран создания](./media/app-service-dotnet-remotely-debug-api-app/04-select-the-api-v3.png)

	Мастер скачает файл метаданных API и создаст типизированный интерфейс для вызова приложения API.

	![Процесс создания](./media/app-service-dotnet-remotely-debug-api-app/05-metadata-downloading-v3.png)

	После создания кода вы увидите новую папку в обозревателе решений с именем приложения API. В этой папке содержится код, который реализует модели клиента и данных.

	![Создание завершено](./media/app-service-dotnet-remotely-debug-api-app/06-code-gen-output-v3.png)

6. Откройте файл **Program.cs** из корня проекта и замените метод **Main** следующим кодом:

		static void Main(string[] args)
	    {
	        var client = new ContactsList();
	
	        // Send GET request.
	        var contacts = client.Contacts.Get();
	        foreach (var c in contacts)
	        {
	            Console.WriteLine("{0}: {1} {2}",
	                c.Id, c.Name, c.EmailAddress);
	        }
	
	        // Send POST request.
			client.Contacts.Post(new Models.Contact
		    {
		        EmailAddress = "lkahn@contoso.com",
		        Name = "Loretta Kahn",
		        Id = 4
		    });
	
	        Console.WriteLine("Finished");
	        Console.ReadLine();
	    }

## Тестирование клиента приложения API

После кодирования приложения API пришло время проверить код в браузере.

1. Откройте **обозреватель решений**.

2. Щелкните правой кнопкой мыши консольное приложение, созданное в предыдущем разделе.

3. В контекстном меню этого консольного приложения выберите **Отладка > Запустить новый экземпляр**.

4. Должно открыться окно консоли, отображающее все контакты.

	![Запуск консольного приложения](./media/app-service-dotnet-remotely-debug-api-app/running-console-app.png)

5. Нажмите клавишу **ВВОД** чтобы закрыть окно консоли.

## Отладка приложения API. 

Теперь, когда код приложения API и его клиента создан и протестирован, давайте посмотрим, как его отлаживать.

1. В Visual Studio в меню **Вид** выберите пункт **Обозреватель сервера**. 

2. В **обозревателе сервера** разверните узел **Azure > Служба приложений**.

3. Найдите группу ресурсов, созданную при развертывании приложения API.

4. В этой группе ресурсов щелкните правой кнопкой мыши узел вашего приложения API и выберите пункт **Подключить отладчик**.

	![Подключение отладчика](./media/app-service-dotnet-remotely-debug-api-app/08-attach-debugger-v3.png)

	Удаленный отладчик попытается подключиться. В некоторых случаях может потребоваться повторно щелкнуть пункт **Подключить отладчик**, чтобы установить подключение, поэтому при сбое повторите попытку.

	![Подключение отладчика](./media/app-service-dotnet-remotely-debug-api-app/09-attaching-v3.png)

16. После установки подключения откройте файл **ContactsController.cs** в проекте приложения API и добавьте точки останова в методах `Get` и `Post`. Сначала они могут не отображаться как активные, но, если удаленный отладчик подключен, вы можете начать отладку.

	![Применение точек останова к контроллеру](./media/app-service-dotnet-remotely-debug-api-app/10-breakpoints-v3.png)

17. Для отладки щелкните правой кнопкой мыши консольное приложение в **обозревателе решений** и последовательно выберите пункты **Отладка** > **Запустить новый экземпляр**. Теперь вы можете отладить приложение API удаленно, а клиентское приложение — локально и увидеть весь поток данных.

	На следующем снимке экрана показан отладчик, достигший точки останова для метода `Post`. Вы увидите, что была выполнена десериализация контактных данных из клиента в строго типизированный объект `Contact`.

	![Отладка локального клиента для соответствия API](./media/app-service-dotnet-remotely-debug-api-app/12-debugging-live-v3.png)

## Дальнейшие действия

Удаленная отладка для приложений API упрощает просмотр выполнения кода в службе приложений Azure. Подробные данные диагностики и отладки доступны непосредственно в IDE Visual Studio для приложений API Azure.

Приложения API службы приложений — это веб-приложения службы приложений, которые имеют дополнительные возможности для размещения веб-служб, поэтому вы можете использовать для приложений API те же средства отладки и устранения неполадок, которые использовали для веб-приложений. Дополнительные сведения см. в разделе [Устранение неполадок веб-приложения в службе приложений Azure с помощью Visual Studio](web-sites-dotnet-troubleshoot-visual-studio.md).

Приложение API, созданное в этой серии учебников, является общедоступным для вызова любого пользователя. Сведения о защите приложения API, чтобы его могли вызывать только прошедшие проверку подлинности пользователи, см. в разделе [Защита приложения API: добавление проверки подлинности Azure Active Directory или поставщика социальных сетей](app-service-api-dotnet-add-authentication.md).

<!--HONumber=54-->