<properties linkid="develop-php-website-with-sql-database-and-webmatrix" urlDisplayName="Web w/ SQL + WebMatrix" pageTitle="PHP website with SQL Database and WebMatrix - Azure" metaKeywords="" description="A tutorial that demonstrates how to use the free WebMatrix IDE to create and deploy a PHP website that stores data in SQL Database." metaCanonical="" services="" documentationCenter="" title="Create and Deploy a PHP Website and SQL Database using WebMatrix" authors="cephalin" solutions="" manager="wpickett" editor="mollybos" />

<tags ms.service="web-sites" ms.workload="web" ms.tgt_pltfrm="na" ms.devlang="PHP" ms.topic="article" ms.date="01/01/1900" ms.author="cephalin" />





# Создание и развертывание веб-сайта на PHP и базы данных SQL с использованием WebMatrix

В этом учебном руководстве показано, как с помощью WebMatrix разработать и развернуть приложение PHP, которое использует базу данных SQL Azure, на веб-сайте Azure. WebMatrix представляет собой бесплатное средство веб-разработки от корпорации Майкрософт, которое содержит все необходимое для разработки веб-сайта. WebMatrix поддерживает PHP, а также intellisense для разработки PHP.

В этом учебном курсе предполагается, что на компьютере установлен [SQL Server Express][SQL Server Express], что позволит тестировать приложение локально. Тем не менее, этот учебный курс можно пройти без установленного сервера SQL Server Express. Вместо этого можно развернуть приложение непосредственно на веб-сайтах Azure.

После завершения работы с этим учебным курсом у вас будет веб-сайт PHP-SQL в Windows Azure.

Вы узнаете:

-   Как создать веб-сайт Azure и базу данных SQL с помощью портала управления. Поскольку PHP для веб-сайтов Azure включен по умолчанию, никаких дополнительных действий для выполнения PHP-кода не требуется.
-   Как разработать приложение PHP с использованием WebMatrix.
-   Как опубликовать и повторно опубликовать приложение в Azure с помощью WebMatrix.

Руководствуясь этим учебником, вы создадите простое веб-приложение списка задач Tasklist на PHP. Приложение будет размещаться на веб-сайте Azure. Снимок экрана работающего приложения приведен ниже:

![Веб-сайт Azure на PHP][Веб-сайт Azure на PHP]

[WACOM.INCLUDE [создать-учетная запись-и-веб-сайт-примечание](../includes/create-account-and-websites-note.md)]

## Предварительные требования

1.  [Загрузите][Загрузите] файлы приложения Tasklist. Приложение Tasklist представляет простое приложение на PHP, которое позволяет добавлять элементы в список задач, отмечать их как выполненные, а также удалять их из списка. Элементы списка задач хранятся в базе данных SQL (SQL Server Express для локального тестирования). Приложение состоит из следующих файлов:

-   **index.php**: отображает задачи и предоставляет форму для добавления элемента в список.
-   **additem.php**: добавляет элемент в список.
-   **getitems.php**: получает все элементы в базе данных.
-   **markitemcomplete.php**: изменяет состояние элемента на «Выполненный».
-   **deleteitem.php**: удаляет элемент.
-   **taskmodel.php**: содержит функции, которые добавляют, возвращают, обновляют и удаляют элементы в базе данных.
-   **createtable.php**: создает таблицу SQL для приложения. Этот файл будет использоваться только один раз.

1.  Создайте базу данных SQL Server под названием `tasklist`. Это можно сделать в командной строке `sqlcmd` с помощью следующих команд:

        >sqlcmd -S <server name>\sqlexpress -U <user name> -P <password>
        1> create database tasklist
        2> GO

    Этот шаг необходим только в том случае, если нужно протестировать приложение локально.

## Создайте веб-сайт и базу данных SQL

1.  Войдите на [портал управления][портал управления].
2.  Щелкните значок **+ Создать** в нижнем левом углу портала.

    ![Создание нового веб-сайта Azure][Создание нового веб-сайта Azure]

3.  Щелкните **ВЕБ-САЙТ**, затем **НАСТРАИВАЕМОЕ СОЗДАНИЕ**.

    ![Настраиваемое создание нового веб-сайта][Настраиваемое создание нового веб-сайта]

    Введите значение в поле **URL-адрес**, выберите **Создать новую базу данных SQL** в раскрывающемся списке **БАЗА ДАННЫХ** и выберите центр обработки данных для вашего веб-сайта в раскрывающемся списке **РЕГИОН**. Щелкните стрелку в нижней части диалогового окна.

    ![Заполните сведения о веб-сайте][Заполните сведения о веб-сайте]

4.  Введите значение для параметра базы данных **ИМЯ** и выберите **Создать сервер базы данных SQL**. Введите имя для входа и пароль (и подтвердите пароль). Выберите регион, в котором будет создан новый сервер базы данных SQL.

    ![Заполните параметры базы данных SQL][Заполните параметры базы данных SQL]

    После создания веб-сайта вы увидите текст **Веб-сайт [ИМЯ\_САЙТА] успешно создан**. Затем будут выведены сведения о подключении к базе данных.

5.  Нажмите кнопку **СВЯЗАННЫЕ РЕСУРСЫ**, затем щелкните по имени базы данных.

    ![Связанные ресурсы][Связанные ресурсы]

6.  Щелкните **Просмотреть строки подключения**.

    ![Строка подключения][Строка подключения]

В разделе **PHP** открывшегося диалогового окна обратите внимание на значения `UID`, `PWD`, `Database` и `$serverName`. Эти сведения будут использоваться позже.

## Установка WebMatrix

WebMatrix можно установить на [портале управления][портал управления]

1.  После входа перейдите на страницу «Быстрый запуск» своего веб-сайта и щелкните значок WebMatrix в нижней части страницы:

    ![Установка WebMatrix][Установка WebMatrix]

    Следуйте инструкциям на экране для установки WebMatrix.

2.  После установки WebMatrix будет предпринята попытка открыть сайт как проект WebMatrix. Можно непосредственно редактировать активный сайт или загрузить локальную копию. В данном учебном курсе следует выбрать "Изменить локальную копию".

3.  Когда появится запрос на скачивание веб-сайта, выберите **Да, установить из коллекции шаблонов**.

    ![Загрузка веб-сайта][Загрузка веб-сайта]

4.  Выберите в списке доступных шаблонов **PHP**.

    ![Веб-сайт на основе шаблона][Веб-сайт на основе шаблона]

5.  Выберите шаблон **Пустой сайт**. Укажите имя сайта и нажмите кнопку **ДАЛЕЕ**.

    ![Ввод имени сайта][Ввод имени сайта]

Веб-сайт будет открыт в WebMatrix с некоторыми файлами по умолчанию.

## Разработка приложения

В следующих шагах вам предстоит разработать приложение Tasklist, добавив загруженные ранее файлы и внеся некоторые изменения. Тем не менее, можно добавить собственные существующие файлы или создать новые файлы.

1.  При открытом в WebMatrix своем веб-сайте добавьте свои файлы приложения, нажав кнопку **Добавить существующие**.

    ![WebMatrix — добавить существующие файлы][WebMatrix — добавить существующие файлы]

    В открывшемся диалоговом окне перейдите к загруженным ранее файлам, выделите их все и нажмите кнопку "Открыть". В ответ на запрос выберите замену файла `index.php`.

2.  Далее необходимо добавить сведения о подключении к локальной базе данных SQL в файл `taskmodel.php`. Откройте файл `taskmodel.php`, дважды щелкнув его, а затем обновите сведения о подключении к базе данных в функции `connect`. (**Примечание**. Если не требуется тестировать приложение локально и вместо этого нужно опубликовать его непосредственно на веб-сайтах Azure, перейдите к разделу [Публикация приложения][Публикация приложения].)

        // DB connection info
        $host = "localhost\sqlexpress";
        $user = "your user name";
        $pwd = "your password";
        $db = "tasklist";

    Сохраните файл `taskmodel.php`.

3.  Чтобы запустить приложение, необходимо создать таблицу `items`. Щелкните правой кнопкой мыши файл `createtable.php` и выберите **Запустить в браузере**. Это запустит `createtable.php` в браузере и выполнит код, который создает таблицу `items` в базе данных `tasklist`.

    ![WebMatrix — запуск файла createtable.php в браузере][WebMatrix — запуск файла createtable.php в браузере]

4.  Теперь можно перейти к локальному тестированию приложения. Щелкните правой кнопкой мыши файл `index.php` и выберите **Запустить в браузере**. Протестируйте приложение, добавляя элементы, отмечая их как выполненные и удаляя их.

## <span id="Publish"></span></a>Публикация приложения

Перед публикацией приложения на веб-сайтах Azure сведения о подключении базы данных в `taskmodel.php` необходимо обновить, указав сведения о подключении, полученные ранее (в разделе [Создание веб-сайта Azure и базы данных SQL][Создание веб-сайта Azure и базы данных SQL]).

1.  Откройте файл `taskmodel.php`, дважды щелкнув его, а затем обновите сведения о подключении к базе данных в функции `connect`.

        // DB connection info
        $host = "value of $serverName";
        $user = "value of UID";
        $pwd = "the SQL password you created when creating the website";
        $db = "value of Database";

    Сохраните файл `taskmodel.php`.

2.  Нажмите кнопку **Опубликовать** в WebMatrix, а затем — кнопку **Продолжить** в диалоговом окне **Просмотр публикации**.

    ![WebMatrix — опубликовать][WebMatrix — опубликовать]

3.  Перейдите по адресу http://[имя вашего веб-сайта].azurewebsites.net/createtable.php, чтобы создать таблицу `items`.

4.  Наконец, перейдите по адресу http://[имя вашего веб-сайта].azurewebsites.net/index.php, чтобы использовать приложение.

## Изменение и повторная публикация приложения

Можно с легкостью изменить приложение путем изменения загруженной ранее локальной копии сайта и его повторной публикации либо путем редактирования непосредственно в удаленном режиме. Внесите здесь простое изменение в заголовок файла `index.php` и сохраните его непосредственно на работающем сайте.

1.  Перейдите на вкладку «Удаленный режим» своего веб-сайта в WebMatrix и выберите команду **Открыть удаленное представление**. Это действие сделает доступным непосредственное редактирование удаленного веб-сайта.
     ![WebMatrix — открыть удаленное представление][WebMatrix — открыть удаленное представление]

2.  Откройте файл `index.php`, дважды щелкнув его.
    ![WebMatrix — открытие файла индекса][WebMatrix — открытие файла индекса]

3.  Измените **Мой список дел** на **Мой список задач** в тегах **title** и **h1**, а затем сохраните файл.

4.  После сохранения нажмите кнопку «Запустить», чтобы увидеть изменения на действующем сайте.
    ![ WebMatrix — удаленный запуск сайта][ WebMatrix — удаленный запуск сайта]

## Дальнейшие действия

Теперь вы увидели, как создать и развернуть веб-сайт из WebMatrix в Azure. Для получения дополнительных сведений о WebMatrix посетите перечисленные ниже ресурсы:

-   [WebMatrix для Azure][WebMatrix для Azure]

-   [Веб-сайт WebMatrix][Веб-сайт WebMatrix]

  [SQL Server Express]: http://www.microsoft.com/ru-ru/download/details.aspx?id=29062
  [Веб-сайт Azure на PHP]: ./media/web-sites-php-sql-database-use-webmatrix/tasklist_app_windows.png
  [Загрузите]: http://go.microsoft.com/fwlink/?LinkId=252504
  [портал управления]: https://manage.windowsazure.com
  [Создание нового веб-сайта Azure]: ./media/web-sites-php-sql-database-use-webmatrix/NewWebSite1.jpg
  [Настраиваемое создание нового веб-сайта]: ./media/web-sites-php-sql-database-use-webmatrix/NewWebSite2.png
  [Заполните сведения о веб-сайте]: ./media/web-sites-php-sql-database-use-webmatrix/NewWebSite3_SQL.png
  [Заполните параметры базы данных SQL]: ./media/web-sites-php-sql-database-use-webmatrix/NewWebSite4_SQL.png
  [Связанные ресурсы]: ./media/web-sites-php-sql-database-use-webmatrix/NewWebSite6_SQL.png
  [Строка подключения]: ./media/web-sites-php-sql-database-use-webmatrix/NewWebSite7.png
  [Установка WebMatrix]: ./media/web-sites-php-sql-database-use-webmatrix/InstallWebMatrix.png
  [Загрузка веб-сайта]: ./media/web-sites-php-sql-database-use-webmatrix/download-site-1.png
  [Веб-сайт на основе шаблона]: ./media/web-sites-php-sql-database-use-webmatrix/site-from-template.png
  [Ввод имени сайта]: ./media/web-sites-php-sql-database-use-webmatrix/site-from-template-2.png
  [WebMatrix — добавить существующие файлы]: ./media/web-sites-php-sql-database-use-webmatrix/edit_addexisting.png
  [Публикация приложения]: #Publish
  [WebMatrix — запуск файла createtable.php в браузере]: ./media/web-sites-php-sql-database-use-webmatrix/edit_run.png
  [Создание веб-сайта Azure и базы данных SQL]: #CreateWebsite
  [WebMatrix — опубликовать]: ./media/web-sites-php-sql-database-use-webmatrix/edit_publish.png
  [WebMatrix — открыть удаленное представление]: ./media/web-sites-php-sql-database-use-webmatrix/OpenRemoteView.png
  [WebMatrix — открытие файла индекса]: ./media/web-sites-php-sql-database-use-webmatrix/Remote_editIndex.png
  [ WebMatrix — удаленный запуск сайта]: ./media/web-sites-php-sql-database-use-webmatrix/Remote_run.png
  [WebMatrix для Azure]: http://go.microsoft.com/fwlink/?LinkID=253622&clcid=0x409
  [Веб-сайт WebMatrix]: http://www.microsoft.com/click/services/Redirect2.ashx?CR_CC=200106398
