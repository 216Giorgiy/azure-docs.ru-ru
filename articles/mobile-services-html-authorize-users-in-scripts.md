<properties pageTitle="Авторизация пользователей на стороне службы (HTML) | Центр разработчиков для мобильных устройств" description="Узнайте, как осуществить авторизацию пользователей в серверной части JavaScript мобильных служб Azure." services="mobile-services" documentationCenter="" authors="ggailey777" manager="dwrede" editor=""/>

<tags ms.service="mobile-services" ms.workload="mobile" ms.tgt_pltfrm="mobile-html" ms.devlang="javascript" ms.topic="article" ms.date="09/29/2014" ms.author="glenga"/>

# Авторизация пользователей мобильных служб на стороне службы

[AZURE.INCLUDE [mobile-services-selector-service-auth-users](../includes/mobile-services-selector-service-auth-users.md)]	


В этом разделе показано, как использовать серверные скрипты для авторизации пользователей, прошедших проверку подлинности, для доступа к данным в мобильных службах Azure из приложения HTML.  В этом учебнике вы зарегистрируете скрипты с помощью мобильных служб для фильтрации запросов по userId пользователя, прошедшего проверку подлинности, удостоверяясь, чтобы каждый пользователь мог просматривать только свои собственные данные.

Этот учебник описывает быстрый запуск мобильных служб и основан на материале предыдущего учебника [Приступая к работе с аутентификацией]. Перед началом работы с учебником необходимо пройти задания учебника [Приступая к работе с аутентификацией].  

## <a name="register-scripts"></a>Регистрация скриптов
Поскольку данное приложение быстрого запуска считывает и вставляет данные, необходимо зарегистрировать скрипты для этих операций в таблице TodoItem.

1. Войдя на [портал управления Azure], щелкните элемент **Мобильные службы** и выберите нужное приложение. 

   	![][0]

2. Щелкните вкладку **Данные**, затем щелкните таблицу **TodoItem**

   	![][1]

3. Выберите элемент **Скрипт**, а затем - операцию **Вставить**.

   	![][2]

4. Замените существующий скрипт указанной ниже функцией и нажмите кнопку **Сохранить**.

        function insert(item, user, request) {
          item.userId = user.userId;    
          request.execute();
        }

    Этот скрипт добавляет в элемент значение userId, которое является идентификатором пользователя, прошедшего проверку подлинности, до его вставки в таблицу TodoItem. 

    > [AUZRE.IMPORTANT] При первом выполнении этого сценария вставки должна быть включена динамическая схема. После включения динамической схемы мобильные службы автоматически добавляют столбец **userId** в таблицу **TodoItem** при первом выполнении. Для новой мобильной службы динамическая схема включена по умолчанию, и перед публикацией приложения ее следует отключить.

5. Повторите шаги 3 и 4, заменив существующую операцию **Read** такой функцией:

        function read(query, user, request) {
           query.where({ userId: user.userId });    
           request.execute();
        }

   	Этот скрипт фильтрует возвращаемые объекты TodoItem, чтобы каждый пользователь получил только элементы, которые он вставил.

## Тестирование приложения

1. В браузере перейдите на страницу index.html приложения, а затем войдите с помощью выбранного поставщика удостоверений. 

   	Обратите внимание, что несмотря на наличие элементов, уже сохраненных в таблице TodoItem после прохождения предыдущих учебников, возврат элементов не происходит. Это вызвано тем, что предыдущие элементы были вставлены без столбца userId и теперь имеют значения NULL.

3. В приложении введите текст в поле **Введите новую задачу** и нажмите кнопку **Добавить**.

   	![][3]

   	При этом в таблицу TodoItem мобильной службы вставляется текст и userId. Так как новый элемент имеет правильное значение userId, он возвращается мобильной службой и отображается во втором столбце.

5. Вернувшись к таблице **todoitem** на [портале управления][портал управления Azure], нажмите кнопку **Обзор** и проверьте, имеет ли каждый вновь добавленный элемент соответствующее значение userId.

6. (Необязательно.) При наличии дополнительных учетных записей вы можете проверить, что пользователи могут просмотреть только свои собственные данные. Для этого можно закрыть приложение (Alt+F4) и затем запустить его снова. Когда появится диалоговое окно учетных данных входа, введите другое имя входа и убедитесь, что элементы, введенные с использованием предыдущей учетной записи, не отображаются. 

## Дальнейшие действия

Это заключительный раздел учебников, в которых демонстрируются основные принципы работы с проверкой подлинности. Просмотрите следующие разделы, посвященные мобильным службам:

* [Приступая к работе с данными]
  <br/>Дополнительные сведения о хранении данных и запросах к ним с помощью мобильных служб.

* [Справочник серверных скриптов мобильных служб]
  <br/>Дополнительная информация о регистрации и использовании серверных сценариев.

* [Справочник принципов использования мобильных служб HTML/JavaScript]
  <br/>Дополнительные сведения об использовании мобильных служб с HTML/JavaScript.
  
<!-- Anchors. -->
[Регистрация серверных скриптов]: #register-scripts
[Дальнейшие действия]:#next-steps

<!-- Images. -->
[0]: ./media/mobile-services-html-authorize-users-in-scripts/mobile-services-selection.png
[1]: ./media/mobile-services-html-authorize-users-in-scripts/mobile-portal-data-tables.png
[2]: ./media/mobile-services-html-authorize-users-in-scripts/mobile-insert-script-users.png
[3]: ./media/mobile-services-html-authorize-users-in-scripts/mobile-quickstart-startup-html.png

<!-- URLs. -->
[Справочник серверных скриптов мобильных служб]: http://go.microsoft.com/fwlink/p/?LinkId=262293
[Панель мониторинга "Мои приложения"]: http://go.microsoft.com/fwlink/p/?LinkId=262039
[Приступая к работе с мобильными службами]: /ru-ru/develop/mobile/tutorials/get-started-html
[Приступая к работе с данными]: /ru-ru/develop/mobile/tutorials/get-started-with-data-html
[Приступая к работе с проверкой подлинности]: /ru-ru/develop/mobile/tutorials/get-started-with-users-html

[Портал управления Azure]: https://manage.windowsazure.com/
[Справочник принципов использования мобильных служб HTML/JavaScript]: /ru-ru/develop/mobile/how-to-guides/work-with-html-js-client


<!--HONumber=42-->
