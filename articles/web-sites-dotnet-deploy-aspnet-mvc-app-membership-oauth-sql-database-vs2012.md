<properties linkid="dev-net-tutorials-web-app-with-sql-azure" urlDisplayName="" pageTitle="" metaKeywords="" description="" metaCanonical="" services="" documentationCenter="" title=" OAuth" authors="riande" solutions="" manager="wpickett" editor="mollybos" />

<tags ms.service="web-sites" ms.workload="web" ms.tgt_pltfrm="na" ms.devlang="dotnet" ms.topic="article" ms.date="01/01/1900" ms.author="riande" />

# Развертывание безопасного приложения ASP.NET MVC с членством, OAuth и базой данных SQL на веб-сайте Azure.

***Обновление: 15 октября 2013 г.***

<div class="dev-center-tutorial-selector sublanding"><a href="/ru-ru/develop/net/tutorials/web-site-with-sql-database/" title="Visual Studio 2013">Visual Studio 2013</a><a href="/ru-ru/develop/net/tutorials/web-site-with-sql-database-vs2012/" title="Visual Studio 2012" class="current">Visual Studio 2012</a></div>

<div class="dev-callout"><strong>Примечание.</strong><p>Доступна <a href="/ru-ru/develop/net/tutorials/web-site-with-sql-database/">новая версия этого учебника</a>. Этой версией можно продолжать пользоваться, если планируется использовать Visual Studio 2012, но работать с новой версией намного проще.</p></div>

В этом учебнике показано, как создать безопасное веб-приложение ASP.NET MVC 4, которое позволяет пользователям входить в систему, используя учетные данные из Facebook, Yahoo и Google. Вы также узнаете, как развернуть приложение в Azure.

Можно бесплатно создать учетную запись Azure, а если у вас еще нет Visual Studio 2012, пакет SDK автоматически установит Visual Studio 2012 for Web Express. Вы можете приступить к разработке приложений для Azure совершенно бесплатно.

В данном учебнике предполагается, что у читателя нет опыта использования платформы Azure. По завершении изучения этого учебника вы создадите безопасное приложение на основе данных, выполняемое в облаке и использующее облачную базу данных.

Вы узнаете:

-   Как подготовить компьютер к разработке для Azure путем установки пакета Azure SDK.
-   Создание безопасного проекта ASP.NET MVC 4 и его публикация на веб-сайте Azure.
-   Использование OAuth и базы данных членства ASP.NET для защиты приложения.
-   Развертывание базы данных членства в Azure.
-   Как использовать базу данных SQL для хранения данных в Azure.
-   Использование Visual Studio для обновления базы данных членства и управления ею.

Вы создадите простое веб-приложение для списка контактов, основанное на платформе ASP.NET MVC 4 и использующее ADO.NET Entity Framework для доступа к базе данных. На следующем рисунке показана страница входа для готового приложения:

![Страница входа][Страница входа]

[WACOM.INCLUDE [создать-учетная запись-и-веб-сайт-примечание](../includes/create-account-and-websites-note.md)]

В этом учебнике рассматриваются следующие темы:

-   [Настройка среды разработки][Настройка среды разработки]
-   [Настройка среды Azure][Настройка среды Azure]
-   [Создание приложения ASP.NET MVC 4][Создание приложения ASP.NET MVC 4]
-   [Развертывание приложения в Azure][Развертывание приложения в Azure]
-   [Добавление базы данных в приложение][Добавление базы данных в приложение]
-   [Добавление поставщика OAuth][Добавление поставщика OAuth]
-   [Добавление ролей в базу данных членства][Добавление ролей в базу данных членства]
-   [Создание скрипта развертывания данных][Создание скрипта развертывания данных]
-   [Развертывание приложения в Azure][1]
-   [Обновление базы данных членства][Обновление базы данных членства]
-   [Дальнейшие действия][Дальнейшие действия]

## <a name="bkmk_setupdevenv"></a>Настройка среды разработки

Для начала работы настройте среду разработки, установив пакет Azure SDK для платформы .NET Framework.

1.  Чтобы установить пакет Azure SDK для .NET, щелкните приведенную ниже ссылку. Если среда Visual Studio 2012 еще не установлена, ее можно установить по ссылке. Для этого учебника требуется Visual Studio 2012.
    [Пакет Azure SDK для Visual Studio 2012][Пакет Azure SDK для Visual Studio 2012]
2.  При появлении запроса на выполнение или сохранение исполняемой установки нажмите **Выполнить**.
3.  Щелкните в окне установщика веб-платформы **Установить** и продолжайте установку.

![Установщик веб-платформы — Azure SDK для .NET][Установщик веб-платформы — Azure SDK для .NET]

После завершения установки вы получите все компоненты, необходимые для разработки.

## <a name="bkmk_setupwindowsazure"></a>Настройка среды Azure

Затем настройте среду Azure, создав веб-сайт Azure и базу данных SQL.

### Создание веб-сайта и базы данных SQL в Azure

Ваш веб-сайт Azure будет работать в общей среде размещения, а это означает, что он работает на виртуальных машинах, используемых совместно с другими клиентами Azure. Общая среда размещения — недорогой способ начать работу в облаке. Если позднее ваш веб-трафик увеличится, приложение можно масштабировать по необходимости, запуская его на выделенных виртуальных машинах. Если требуется более сложная архитектура, можно перейти в облачную службу Azure. Облачные службы работают на выделенных виртуальных машинах, которые можно настроить в соответствии с конкретными потребностями.

База данных SQL в Azure — это облачная служба реляционной базы данных, построенная на основе технологий SQL Server. Средства и приложения, работающие с SQL Server, работают и с базой данных SQL.

1.  На [портале управления Azure][портале управления Azure] щелкните **Веб-сайты** на левой вкладке, а затем щелкните **Создать**.

 ![Кнопка "Создать" на портале управления][Кнопка "Создать" на портале управления]

1.  Щелкните **НАСТРАИВАЕМОЕ СОЗДАНИЕ**.

    ![Ссылка "Создать с базой данных" на портале управления][Ссылка "Создать с базой данных" на портале управления]

Откроется мастер **Новый веб-сайт — настраиваемое создание**.

1.  На шаге **Создать веб-сайт** в мастере введите в поле **URL-адрес** строку, которая будет использоваться как уникальный URL-адрес для приложения. Полный URL-адрес будет состоять из введенной здесь строки и суффикса, который отображается рядом с текстовым полем. На рисунке показана строка "contactmgr2", однако этот URL-адрес может быть занят, так что понадобится выбрать другое значение.

    ![Ссылка "Создать с базой данных" на портале управления][2]

2.  В раскрывающемся списке **База данных** выберите параметр **Создать базу данных SQL**.

3.  В раскрывающемся списке **Область** выберите ту же область, которую выбрали для веб-сайта. Этот параметр определяет центр обработки данных, в котором будет выполняться ваша виртуальная машина. Для параметра **ИМЯ СТРОКИ ПОДКЛЮЧЕНИЯ К БАЗЕ ДАННЫХ** введите *connectionString1*.

    ![Шаг создания нового веб-сайта в мастере «Новый веб-сайт — создать с базой данных»][2]

4.  Щелкните стрелку, указывающую вправо, в нижней части окна. Мастер перейдет к шагу **Параметры базы данных**.

5.  В поле **Имя** введите *ContactDB*.

6.  В поле **Сервер** выберите **Создать сервер базы данных SQL**. Если же вы ранее создали базу данных SQL Server, можно выбрать в раскрывающемся списке этот SQL Server.

7.  Введите **ИМЯ ДЛЯ ВХОДА** и **ПАРОЛЬ** администратора. Если выбрано действие **Создать сервер базы данных SQL**, не используйте здесь существующие имя и пароль, введите новые, которые в дальнейшем будут использоваться при обращении к базе данных. Если выбран созданный ранее SQL Server, появится запрос на ввод пароля для ранее созданной учетной записи SQL Server. В этом учебнике поле **Дополнительно** не отмечается. Поле **Дополнительно** позволяет задавать размер БД (по умолчанию 1 ГБ, однако его можно увеличить до 150 ГБ), а также сортировку.

8.  Щелкните флажок снизу от поля, чтобы указать завершение работы.

    ![Шаг настройки параметров базы данных в мастере «Новый веб-сайт — создать с базой данных»][Шаг настройки параметров базы данных в мастере «Новый веб-сайт — создать с базой данных»]

    На следующем изображении показано использование существующего SQL Server и входа в систему.
    ![Шаг настройки параметров базы данных в мастере «Новый веб-сайт — создать с базой данных»][3]

    Портал управления возвращается на страницу веб-сайтов, и в столбце **Состояние** указывается, что веб-сайт создается. Через какое-то время (обычно меньше минуты) в столбце **Состояние** указывается, что сайт успешно создан. В строке навигации слева число сайтов вашей учетной записи отображается рядом со значком **Веб-сайты**, а число баз данных — рядом со значком **Базы данных SQL**.

## <a name="bkmk_createmvc4app"></a>Создание приложения ASP.NET MVC 4

Веб-сайт Azure создан, но его контент еще отсутствует. Следующим шагом будет создание проекта веб-приложения Visual Studio, которое будет опубликовано в Azure.

### Создание проекта

1.  Откройте Visual Studio 2012.
2.  В меню **Файл** выберите **Новый проект**.
3.  В диалоговом окне **Новый проект** разверните узел **Visual C\#** и выберите **Интернет** в разделе **Установленные шаблоны**, а затем выберите **Веб-приложение ASP.NET MVC 4**. Оставьте значение по умолчанию **.NET Framework 4.5**. Присвойте приложению имя **ContactManager** и нажмите кнопку **ОК**.

    ![Диалоговое окно "Новый проект"][Диалоговое окно "Новый проект"]

4.  В диалоговом окне **Новый проект ASP.NET MVC 4** выберите шаблон **Веб-приложение**. Оставив **Обработчик представлений** Razor по умолчанию, нажмите кнопку **ОК**.

    ![Диалоговое окно "Новый проект ASP.NET MVC 4"][Диалоговое окно "Новый проект ASP.NET MVC 4"]

### Задание верхнего и нижнего колонтитула страницы

1.  В **обозревателе решений** разверните папку Views\\Shared и откройте файл \*\_Layout.cshtml\*.

    ![\_Layout.cshtml в обозревателе решений][\_Layout.cshtml в обозревателе решений]

2.  Замените все вхождения элемента «Мое приложение ASP.NET MVC» на «Contact Manager».
3.  Замените элемент «Ваша эмблема» на текст «CM Demo».

### Локальный запуск приложения

1.  Для запуска приложения нажмите сочетание клавиш CTRL+F5. Главная страница приложения откроется в браузере, используемом по умолчанию.
    ![Главная страница списка дел][Главная страница списка дел]

Это все, что требуется для создания приложения, которое будет развернуто в Azure. Далее вы добавите функции работы с базой данных.

## <a name="bkmk_deploytowindowsazure1"></a> Развертывание приложения в Azure

1.  В браузере откройте [управления Azure][управления Azure].

2.  На вкладке **Веб-сайты** щелкните имя ранее созданного сайта.

    ![Приложение диспетчера контактов на вкладке веб-сайтов портала управления][Приложение диспетчера контактов на вкладке веб-сайтов портала управления]

3.  В правой части окна щелкните **Загрузить профиль публикации**.

    ![Вкладка быстрого запуска и кнопка "Загрузить профиль публикации"][Вкладка быстрого запуска и кнопка "Загрузить профиль публикации"]

    Это действие загружает файл, содержащий все параметры, необходимые для развертывания приложения на веб-сайте. Этот файл будет импортирован в Visual Studio, поэтому вводить эти сведения вручную не понадобится.

4.  Сохраните файл .*publishsettings* в папке, доступной из Visual Studio.

    ![сохранение файла .publishsettings][сохранение файла .publishsettings]

    [WACOM.INCLUDE [publishsettingsfilewarningchunk](../includes/publishsettingsfilewarningchunk.md)]

5.  В Visual Studio щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Опубликовать** в контекстном меню.

    !["Опубликовать" в контекстном меню проекта]["Опубликовать" в контекстном меню проекта]

    Откроется мастер **Публикация веб-сайта**.

6.  На вкладке **Профиль** мастера **Публикация веб-сайта** щелкните **Импорт**.

    ![Параметры импорта публикации][Параметры импорта публикации]

    Появится диалоговое окно **Импорт профиля публикации**.

7.  Если подписка Azure еще не добавлена в Visual Studio, выполните следующие действия. После добавления существующей подписки в раскрывающемся списке в разделе **Импорт с веб-сайта Azure** появится и ваш веб-сайт.

    a. В диалоговом окне **Импорт профиля публикации** щелкните **Добавить подписку Azure**.

    ![add win az sub][add win az sub]

    b. В диалоговом окне **Импорт подписок Azure** щелкните **Загрузить файл подписки**.

    ![загрузка файла подписки][загрузка файла подписки]

    c. В окне браузера сохраните файл *.publishsettings*.

    ![download pub file][download pub file]

    > [WACOM.NOTE]
    >  Файл .publishsettings содержит учетные данные (без кодировки), используемые для администрирования подписок и служб Azure. В целях безопасности для этого файла рекомендуется временно хранить его за пределами исходных каталогов (например, в папке Libraries\\Documents), а затем удалять после завершения импорта. Злоумышленник, получивший доступ к PUBLISHSETTINGS-файлу, сможет изменять, создавать и удалять ваши службы Azure.

    d. В диалоговом окне **Импорт подписок Azure** нажмите кнопку **Обзор** и перейдите к файлу *.publishsettings*.

    ![загрузка файла подписки][загрузка файла подписки]

    e. Щелкните **Импорт**.

    ![импорт][импорт]

8.  В диалоговом окне **Импорт профиля публикации** выберите **Импорт с веб-сайта Windows Azure**, выберите свой веб-сайт в раскрывающемся списке, затем нажмите кнопку **ОК**.

    ![Импорт профиля публикации][Импорт профиля публикации]

    Созданное вами приложение теперь выполняется в облаке. При следующем развертывании приложения будут развернуты только измененные (или новые) файлы.

    ![Главная страница списка дел на ресурсе Azure][Главная страница списка дел на ресурсе Azure]

## <a name="bkmk_addadatabase"></a>Добавление базы данных в приложение

Теперь вы обновите приложение MVC, чтобы добавить возможности для отображения и обновления контактов и сохранения данных в базе данных. Приложение будет использовать компонент Entity Framework для создания базы данных, а также чтения и обновления данных в базе данных.

### Добавление классов модели данных для контактов

Начните с создания простой модели данных в коде.

1.  В **обозревателе решений** щелкните правой кнопкой мыши папку "Модели" и выберите **Добавить**, а затем щелкните **Класс**.

 ![Контекстное меню добавления класса в папке "Модели"][Контекстное меню добавления класса в папке "Модели"]

1.  В диалоговом окне **Добавление нового элемента** присвойте новому файлу класса имя *Contact.cs*, затем щелкните **Добавить**.

 ![Диалоговое окно "Добавление нового элемента"][Диалоговое окно "Добавление нового элемента"]

1.  Замените содержимое файла Contacts.cs на код, приведенный ниже.

        using System.ComponentModel.DataAnnotations;
        using System.Globalization;
        namespace ContactManager.Models
        {
            public class Contact
            {
                public int ContactId { get; set; }
                public string Name { get; set; }
                public string Address { get; set; }
                public string City { get; set; }
                public string State { get; set; }
                public string Zip { get; set; }
                [DataType(DataType.EmailAddress)]
                public string Email { get; set; }
            }
        }

Класс **Contacts** определяет данные, которые будут храниться для каждого контакта, а также первичный ключ, *ContactID*, необходимый для базы данных.

### Создание веб-страниц, позволяющих пользователям приложений работать с контактами

Компонент формирования шаблонов в ASP.NET MVC может автоматически создавать код, выполняющий операции создания, чтения, обновления и удаления.

## <a name="bkmk_addcontroller"></a>Добавление контроллера и представления для данных

1.  Создайте проект **(Ctrl + Shift + B)** Проект необходимо создать перед использованием механизма формирования шаблонов.
2.  В **обозревателе решений** щелкните правой кнопкой мыши папку "Контроллеры" и выберите **Добавить**, а затем щелкните **Контроллер**.

    ![Контекстное меню добавления контроллера в папке "Контроллеры"][Контекстное меню добавления контроллера в папке "Контроллеры"]

3.  В диалоговом окне **Добавление контроллера** введите "Главный\_контроллер" в качестве имени контроллера.
4.  Задайте для пункта **Шаблон параметров формирования шаблонов** значение **Контроллер MVC с действиями чтения и записи и представлениями с использованием Entity Framework**.
5.  Выберите **Контакт** как класс модели и **\<Новый контекст данных... \>** как класс контекста данных.

    ![Диалоговое окно "Добавление контроллера"][Диалоговое окно "Добавление контроллера"]

6.  В диалоговом окне **Новый контекст данных** примите значение по умолчанию *ContactManager.Models.ContactManagerContext*.
    ![Диалоговое окно Добавление контроллера][Диалоговое окно Добавление контроллера]

7.  Нажмите кнопку **ОК**, затем **Добавить** в диалоговом окне **Добавление контроллера**.
8.  В диалоговом окне переопределения **Добавить контроллер** убедитесь, что все параметры выбраны и нажмите кнопку **ОК**.

    ![Окно сообщения «Добавить контроллер» ][Окно сообщения «Добавить контроллер» ]

Visual Studio создает методы и представления контроллера для операций создания, чтения, обновления и удаления в базе данных для объектов **Контакт**.

## Включение Migrations, создание базы данных, добавление примера данных и инициализатора данных

Следующая задача заключается в активации компонента [Code First Migrations][Code First Migrations] для создания базы данных на основе созданной модели данных.

1.  В меню **Сервис** выберите **Диспетчер пакетов библиотеки**, а затем **Консоль диспетчера пакетов**.

    !["Консоль диспетчера пакетов" в меню "Сервис"]["Консоль диспетчера пакетов" в меню "Сервис"]

2.  В окне **Консоль диспетчера пакетов** введите следующую команду:

        enable-migrations -ContextTypeName ContactManagerContext

    ![enable-migrations][enable-migrations]
    Необходимо задать имя типа контекста (**ContactManagerContext**), так как проект содержит два производных класса [DbContext][DbContext]: один, который только что добавлен **ContactManagerContext**, и **UsersContext**, который используется для базы данных членства. Класс **ContactManagerContext** был добавлен в мастер формирования шаблонов Visual Studio.

    Команда **enable-migrations** создает папку *Migrations* и размещает в этой папке файл *Configuration.cs*, который можно использовать для настройки миграций.

3.  В окне **Консоль диспетчера пакетов** введите следующую команду:

        add-migration Initial

    Команда **add-migration Initial** создает файл с именем **\<date\_stamp\>Initial** в папке *Migrations*, которая создает базу данных. Первый параметр (**Initial**) является произвольным и используется для создания имени файла. Новые файлы классов можно просмотреть в **обозревателе решений**.

    В классе **Initial** метод **Up** создает таблицу Contacts, а метод **Down** (используется при возвращении к предыдущему состоянию) удаляет эту таблицу.

4.  Откройте файл *Migrations\\Configuration.cs*.
5.  Добавьте следующее пространства имен.

         using ContactManager.Models;

6.  Замените метод *Seed* следующим кодом:

        protected override void Seed(ContactManager.Models.ContactManagerContext context)
        {
            context.Contacts.AddOrUpdate(p => p.Name,
               new Contact
               {
                   Name = "Debra Garcia",
                   Address = "1234 Main St",
                   City = "Redmond",
                   State = "WA",
                   Zip = "10999",
                   Email = "debra@example.com",
               },
                new Contact
                {
                    Name = "Thorsten Weinrich",
                    Address = "5678 1st Ave W",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "thorsten@example.com",
                },
                new Contact
                {
                    Name = "Yuhong Li",
                    Address = "9012 State st",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "yuhong@example.com",
                },
                new Contact
                {
                    Name = "Jon Orton",
                    Address = "3456 Maple St",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "jon@example.com",
                },
                new Contact
                {
                    Name = "Diliana Alexieva-Bosseva",
                    Address = "7890 2nd Ave E",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "diliana@example.com",
                }
                );
        }

    Приведенный выше код инициализирует базу данных с контактной информацией. Дополнительные сведения об инициализации базы данных см. в разделе [Инициализация и отладка баз данных Entity Framework (EF)][Инициализация и отладка баз данных Entity Framework (EF)].

7.  В окне **Консоль диспетчера пакетов** введите команду:

        update-database

    ![Команды консоли диспетчера пакетов][Команды консоли диспетчера пакетов]

    Команда **update-database** выполняет первую миграцию, при которой создается база данных. По умолчанию база данных создается как база данных LocalDB в SQL Server Express. (Если решение SQL Server Express не установлено, база данных создается с помощью экземпляра SQL Server Express.)

8.  Для запуска приложения нажмите сочетание клавиш CTRL+F5.

Приложение показывает начальные данные и предоставляет ссылки для изменения, удаления и просмотра подробных сведений.

![Представление MVC для данных][Представление MVC для данных]

## <a name="addOauth"></a><span class="short-header">OAuth</span>Добавление поставщика OAuth

[OAuth][OAuth] — это открытый протокол, обеспечивающий безопасную авторизацию простым и стандартным способом из веб-приложений, мобильных и настольных приложений. В интернет-шаблоне ASP.NET MVC для предоставления Facebook, Twitter, Google, Yahoo и Microsoft в качестве поставщиков проверки подлинности используются OAuth и OpenID. В этом учебнике в качестве поставщиков проверки подлинности используются только Facebook, Google и Yahoo, но можно легко изменить код, чтобы использовался любой другой поставщик. Шаги по реализации других поставщиков очень похожи на шаги, представленные в этом учебнике.

Помимо проверки подлинности в учебнике будут использоваться роли для реализации авторизации. Только пользователи, добавленные в роль canEdit, смогут создавать, изменять и удалять контакты.

## Регистрация у внешнего поставщика

Для проверки подлинности пользователей, использующих учетные данные некоторых внешних поставщиков, необходимо зарегистрировать веб-сайт у соответствующего поставщика, а также получить ключ и секретный код для подключения. Google и Yahoo не требуют регистрации и получения ключей.

В этом учебнике приведены не все действия, необходимые для регистрации у этих поставщиков. Эти действия обычно не являются трудными. Для успешной регистрации веб-сайта следуйте инструкциям, приведенным на сайтах поставщиков. Чтобы начать работу с регистрации веб-сайта, см. сведения на сайте разработчика:

-   [Facebook][Facebook]
-   [Microsoft][Microsoft]
-   [Twitter][Twitter]

Перейдите на страницу [][]<https://developers.facebook.com/apps></a> и при необходимости войдите в систему. Нажмите кнопку **Зарегистрироваться в качестве разработчика** и выполните процесс регистрации. После завершения регистрации нажмите кнопку **Создать новое приложение**. Введите имя конечной точки для приложения. Введение пространства имен для приложения не требуется.

![Создание нового приложения FB][Создание нового приложения FB]

Введите «localhost» для параметра **Домен приложения** и <http://localhost/> для параметра **URL-адрес сайта**. Щелкните **Включено** для параметра **Режим изолированной среды**, а затем нажмите кнопку **Сохранить изменения**.

Для реализации OAuth в этом приложении понадобятся **Идентификатор приложения** и **Секретный код приложения**.
 ![Новое приложение FB][Новое приложение FB]

## Создание тестовых пользователей

На левой панели в разделе **Параметры** щелкните **Роли разработчика**. Щелкните ссылку **Создать** для строки **Тестовые пользователи** (а не для строки **Инженеры-испытатели**).

![Инженеры-испытатели FB][Инженеры-испытатели FB]

Щелкните ссылку **Изменить**, чтобы получить электронную почту тестовых пользователей (которая будет использоваться для входа в приложение). Щелкните ссылку **Дополнительно**, а затем выберите **Изменить**, чтобы задать пароль тестовых пользователей.

## Добавление идентификатора приложения и секретного кода поставщика

Откройте файл *App\_Start\\AuthConfig.cs*. Удалите символы комментариев из метода *RegisterFacebookClient* и добавьте идентификатор приложения и секретный код приложения. Используйте полученные значения, приведенные ниже значения работать не будут. Удалите символы комментариев из вызова *OAuthWebSecurity.RegisterGoogleClient* и добавьте *OAuthWebSecurity.RegisterYahooClient*, как показано ниже. Поставщики Google и Yahoo не требуют регистрации и получения ключей.
Предупреждение: Храните идентификатор и секретный код приложения в безопасном месте. Злоумышленник, обладающий идентификатором и секретным кодом приложения, сможет выдать себя за ваше приложение.

     public static void RegisterAuth()
        {
            OAuthWebSecurity.RegisterFacebookClient(
                appId: "enter numeric key here",
                appSecret: "enter numeric secret here");

            OAuthWebSecurity.RegisterGoogleClient();
            OAuthWebSecurity.RegisterYahooClient();
        }

1.  Запустите приложение и щелкните ссылку **Вход**.
2.  Нажмите кнопку **Facebook**.
3.  Введите свои учетные данные в Facebook или учетные данные одного из тестовых пользователей.
4.  Нажмите кнопку **Okay**, чтобы разрешить приложению доступ к вашим ресурсам Facebook.
5.  Вы перейдете на страницу регистрации. Если вход в систему выполнен с помощью тестовой учетной записи, можно изменить **имя пользователя** на более короткое, например "Тест FB Коли". Нажмите кнопку **Зарегистрировать**, чтобы сохранить в базе данных членства псевдоним электронной почты и имя пользователя.
6.  Зарегистрируйте другого пользователя. В настоящее время ошибка в системе входа не позволяет выйти из системы и войти под именем другого пользователя, используя того же поставщика (то есть нельзя выйти из своей учетной записи Facebook и войти, используя другую учетную запись Facebook). Чтобы обойти эту проблему, перейдите на сайт, используя другой браузер, и зарегистрируйте другого пользователя. Один пользователь будет добавлен в роль администратора и получит доступ к приложению с возможностью изменения, другому пользователю на сайте будут доступны только методы, не вносящие изменений. Анонимные пользователи получат доступ только к главной странице.
7.  Зарегистрируйте другого пользователя для другого поставщика.
8.  **Необязательно**: Можно также создать локальную учетную запись, не связанную ни с одним из поставщиков. Далее в этом учебнике возможность создания локальных учетных записей будет удалена. Чтобы создать локальную учетную запись, щелкните ссылку **Выход** (если выполнен вход в систему), а затем щелкните ссылку **Зарегистрировать**. В целях администрирования может понадобиться создать локальную учетную запись, не связанную ни с каким внешним поставщиком проверки подлинности.

## <a name="mbrDB"></a><span class="short-header">База данных членства</span>Добавление ролей в базу данных членства

В этом разделе в базу данных членства будет добавлена роль *canEdit*. Только пользователи, входящие в роль canEdit, смогут изменять данные. Рекомендуется именовать роли по выполняемым ими действиям, например имя *canEdit* предпочтительнее имени *admin*. По мере развития приложения можно добавлять новые роли, например роль *canDeleteMembers*, а не только *superAdmin*.

1.  В меню **Просмотр** выберите **Обозреватель сервера**.

2.  В **Обозревателе сервера** разверните **DefaultConnection**, а затем разверните **Таблицы**.

3.  Щелкните правой кнопкой мыши **UserProfile**, а затем щелкните **Показать данные таблиц**.

    ![Показать данные таблиц][Показать данные таблиц]

4.  Запишите идентификатор **UserId** для пользователя, которому будет назначена роль canEdit. На следующем рисунке пользователю *ricka* с **UserId** 2 будет назначена роль canEdit для веб-сайта.

    ![Идентификаторы пользователей][Идентификаторы пользователей]

5.  Щелкните правой кнопкой мыши **webpages\_Roles**, а затем щелкните **Показать данные таблиц**.
6.  Введите **canEdit** в ячейке **RoleName**. Если роль добавляется впервые, значение **RoleId** будет равно 1. Запишите значение RoleID. Убедитесь в отсутствии замыкающего пробела — "canEdit " в таблице ролей не будет соответствовать "canEdit" в коде контроллера.

    ![roleID][roleID]

7.  Щелкните правой кнопкой мыши **webpages UsersInRoles**, а затем щелкните **Показать данные таблиц**. Введите **ИД пользователя** для пользователя, которому нужно предоставить доступ *canEdit* и **RoleId**.

    ![usr role ID tbl][usr role ID tbl]

Таблица **webpages\_OAuthMembership** содержит поставщика OAuth, ИД пользователя для поставщика и ИД пользователя для каждого зарегистрированного пользователя OAuth. <!-- Don't replace "-" with "_" or it won't validate -->Таблица **webpages-Membership** содержит таблицу членства ASP.NET. Можно добавлять пользователей в эту таблицу с помощью ссылки регистрации. Рекомендуется добавить пользователя с ролью *canEdit*, не связанного с Facebook или другим внешним поставщиком услуг авторизации, чтобы можно было всегда получить доступ *canEdit*, даже когда внешний поставщик услуг авторизации недоступен. Далее в этом учебнике регистрация членства ASP.NET будет отключена.

## Защита приложения с помощью атрибута Authorize

В этом разделе будет применен атрибут [Authorize][Authorize] для ограничения доступа к методам действий. Анонимный пользователь сможет просмотреть только главную страницу. Зарегистрированные пользователи смогут видеть контактные сведения, сведения о программе и страницы контактов. Только пользователи с назначенной ролью *canEdit* получат доступ к методам действий, изменяющих данные.

1.  Добавьте в приложение фильтры [Authorize][Authorize] и [RequireHttps][RequireHttps]. В качестве альтернативы можно добавить атрибуты [Authorize][Authorize] и [RequireHttps][RequireHttps] для каждого контроллера, но с точки зрения безопасности рекомендуется применять их ко всему приложению. В случае глобального добавления атрибутов каждый новый контроллер и метод действия будет защищен автоматически, вам не потребуется помнить о необходимости их применения. Дополнительные сведения см. в разделе [Защита приложения ASP.NET MVC 4 и новый атрибут AllowAnonymous][Защита приложения ASP.NET MVC 4 и новый атрибут AllowAnonymous]. Откройте файл *App\_Start\\FilterConfig.cs* и замените метод *RegisterGlobalFilters* следующим кодом.

        public static void
        RegisterGlobalFilters(GlobalFilterCollection filters)
        {
            filters.Add(new HandleErrorAttribute());
            filters.Add(new System.Web.Mvc.AuthorizeAttribute());
            filters.Add(new RequireHttpsAttribute());
        }

2.  Добавьте атрибут [AllowAnonymous][Защита приложения ASP.NET MVC 4 и новый атрибут AllowAnonymous] в метод **Index**. С помощью атрибута [AllowAnonymous][Защита приложения ASP.NET MVC 4 и новый атрибут AllowAnonymous] можно создать белый список методов, для которых не нужна авторизация.
3.  Добавьте [Authorize(Roles = "canEdit")] в методы Get и Post, изменяющие данные (Create, Edit, Delete).
4.  Добавьте методы *About* и *Contact*. Ниже показана часть готового кода.

        public class HomeController : Controller
        {
            private ContactManagerContext db = new ContactManagerContext();
            [AllowAnonymous]
            public ActionResult Index()
            {
                return View(db.Contacts.ToList());
            }

            public ActionResult About()
            {
                return View();
            }

            public ActionResult Contact()
            {
                return View();
            }

            [Authorize(Roles = "canEdit")]
            public ActionResult Create()
            {
                return View();
            }
            // Methods moved and omitted for clarity.
        }

5.  Удалите регистрацию членства ASP.NET. При текущей регистрации членства ASP.NET в проекте не поддерживается сброс паролей и не проверяется, человек ли регистрируется (например, с помощью запроса [CAPTCHA][CAPTCHA]). Пользователь, прошедший проверку подлинности с использованием одного из сторонних поставщиков, может зарегистрироваться. В контроллере AccountController удалите атрибут *[AllowAnonymous]* из методов GET и POST для действия *Регистрация*. Это не позволит регистрироваться программам-роботам и анонимным пользователям.
6.  В файле *Views\\Shared\_LoginPartial.cshtml* удалите ссылку на действие «Регистрация».
7.  Включение SSL. В обозревателе решений щелкните проект **ContactManager**, а затем нажмите F4, чтобы открыть диалоговое окно свойств. Для параметра **SSL включен** измените значение на "true". Скопируйте **URL-адрес SSL**.

    ![Включение SSL][Включение SSL]

8.  В обозревателе решений щелкните правой кнопкой мыши проект **Contact Manager**, затем щелкните **Свойства**.
9.  На левой вкладке щелкните **Интернет**.
10. Измените **Url-адрес проекта**, чтобы использовать **URL-адрес SSL**.
11. Щелкните **Создать виртуальный каталог**.

    ![Включение SSL][4]

12. Для запуска приложения нажмите сочетание клавиш CTRL+F5. Откроется браузер с предупреждением о сертификате. Для нашего приложения можно безопасно щелкнуть ссылку **Перейти на этот веб-сайт**. Проверьте, что только пользователи с ролью *canEdit* могут изменять данные. Убедитесь, что анонимные пользователи могут только просматривать главную страницу.

    ![Предупреждение о сертификате][Предупреждение о сертификате]

    ![Предупреждение о сертификате][5]

Веб-сайты Azure содержат действующий сертификат безопасности, поэтому при развертывании в Azure это предупреждение не отображается.

## <a name="ppd"></a><span class="short-header">Подготовка базы данных</span>Создание скрипта развертывания данных

</p>
База данных членства не управляется с помощью Entity Framework Code First, поэтому для ее развертывания нельзя использовать Migrations. Для развертывания схемы базы данных будет использоваться поставщик [dbDacFx][dbDacFx], а также будет настроен профиль публикации для запуска скрипта, который вставит первоначальные данные о членстве в таблицы членства.

В этом учебнике для создания скриптов развертывания данных будет использоваться среда SQL Server Management Studio (SSMS).

Установите SSMS из [Центра загрузки Microsoft SQL Server 2012 Express][Центра загрузки Microsoft SQL Server 2012 Express]:

-   [ENU\x64\SQLManagementStudio\_x64\_ENU.exe][ENU\x64\SQLManagementStudio\_x64\_ENU.exe] для 64-разрядных систем.
-   [ENU\x86\SQLManagementStudio\_x86\_ENU.exe][ENU\x86\SQLManagementStudio\_x86\_ENU.exe] для 32-разрядных систем.

Если выбран неправильный вариант, установка закончится неудачей. В этом случае попробуйте другой вариант.

(Обратите внимание, что размер загружаемого файла составляет 600 мегабайт. Процесс установки может занять много времени и потребовать перезагрузить компьютер.)

На первой странице Центра установки SQL Server нажмите кнопку **Новая изолированная установка SQL Server или добавление компонентов к существующему экземпляру** и следуйте инструкциям, принимая значения по умолчанию. На следующем рисунке показано действие для установки SSMS.

![Установка SQL][Установка SQL]

### Создание скрипта разработки базы данных

1.  Запустите SSMS.
2.  В диалоговом окне **Подключение к серверу** введите *(localdb)\\v11.0* как имя сервера, оставьте значение **Проверка подлинности**, равным **Проверка подлинности Windows**, и нажмите кнопку **Подключить**. Если SQL Express уже установлен, введите **.\\SQLEXPRESS**.

    ![con to srvr dlg][con to srvr dlg]

3.  В окне **Обозреватель объектов** разверните **Базы данных**, щелкните правой кнопкой мыши **aspnet-ContactManager**, щелкните **Задачи**, а затем выберите **Создать скрипты**.

    ![Создать скрипты][Создать скрипты]

4.  В диалоговом окне **Создать и опубликовать скрипты** щелкните **Задать параметры скриптов**.
    Шаг **Выбор объектов** можно пропустить, так как по умолчанию выбраны вся база данных скриптов и все объекты базы данных, то есть как раз то, что нужно.

5.  Нажмите кнопку **Дополнительно**.

    ![Задать параметры скриптов][Задать параметры скриптов]

6.  Прокрутите диалоговое окно **Дополнительные параметры скриптов** вниз до поля **Типы данных для скриптов** и выберите в раскрывающемся списке параметр **Только данные**. (См. рисунок под следующим шагом.)

7.  Измените значение **USE DATABASE в скрипте** на **False**. Инструкции USE не подходят для базы данных SQL Azure и не нужны для развертывания SQL Server Express в тестовой среде.

    ![Задать параметры скриптов][6]

8.  Нажмите кнопку **ОК**.
9.  В диалоговом окне **Создание и публикация скриптов** поле **Имя файла** определяет, где будет создан скрипт. Измените путь к папке решения (папка с вашим файлом *Contacts.sln*) и измените имя файла на *aspnet-data-membership.sql*.
10. Нажмите кнопку **Далее** для перехода на вкладку **Сводка**, а затем нажмите кнопку **Далее** еще раз для создания скрипта.

    ![Сохранить или опубликовать][Сохранить или опубликовать]

11. Нажмите кнопку **Готово**

## <a name="bkmk_deploytowindowsazure11"></a>Развертывание приложения в Azure

1.  Откройте корневой файл приложения *Web.config*. Найдите разметку *DefaultConnection*, затем скопируйте и вставьте ее под строкой разметки *DefaultConnection*. Переименуйте скопированный элемент *DefaultConnectionDeploy*. Эта строка подключения понадобится для развертывания данных о пользователях в базе данных членства.
    ![3 cons str][3 cons str]

2.  Создайте приложение.
3.  В Visual Studio щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Опубликовать** в контекстном меню.

    !["Опубликовать" в контекстном меню проекта][7]

Откроется мастер **Публикация веб-сайта**.

1.  Перейдите на вкладку **Параметры**. Щелкните значок **v**, чтобы выбрать параметр **Строка удаленного подключения** для **ContactManagerContext** и **DefaultConnectionDeploy**. Все три перечисленных базы данных будут использовать одну и ту же строку подключения. В базе данных **ContactManagerContext** хранятся контакты, **DefaultConnectionDeploy** используется только для развертывания данных учетных записей пользователей в базе данных членства, а база данных **UsersContext** является базой данных членства.

    ![Параметры][Параметры]

2.  В разделе **ContactManagerContext** выберите **Выполнить Code First Migrations**.

    ![Параметры][8]

3.  В разделе **DefaultConnectionDeploy** установите флажок **Обновить базу данных**, а затем перейдите по ссылке **Настройка обновлений базы данных**.
4.  Щелкните ссылку **Добавить скрипт SQL** и перейдите к файлу *aspnet-data-membership.sql*. Это нужно сделать только один раз. При следующем развертывании снимите флажок **Обновить базы данных**, так как вам не понадобится добавлять пользовательские данные в таблицы членства.

    ![добавить sql][добавить sql]

5.  Щелкните **Опубликовать**.
6.  Перейдите на страницу [][]<https://developers.facebook.com/apps></a> и измените настройки **Домены приложения** и **URL-адрес сайта** на URL-адрес Azure
7.  Выполните тестирование приложения. Проверьте, что только пользователи с ролью *canEdit* могут изменять данные. Убедитесь, что анонимные пользователи могут только просматривать главную страницу. Убедитесь, что прошедшие проверку подлинности пользователи могут переходить по всем ссылкам, которые не изменяют данные.
8.  При следующей публикации приложения не забудьте снять флажок **Обновить базу данных** в разделе **DefaultConnectionDeploy**.

    ![Параметры][8]

## <a name="ppd2"></a><span class="short-header">Обновление базы данных</span>Обновление базы данных членства

После развертывания сайта в Azure и увеличения числа зарегистрированных пользователей может понадобиться назначить некоторым из них роль *canEdit*. В этом разделе для подключения к базе данных SQL и добавления пользователей в роль *canEdit* используется Visual Studio.

![Параметры][8]

1.  В **Обозревателе решений** щелкните правой кнопкой мыши пункт **Опубликовать**.
    ![Опубликовать][Опубликовать]

2.  Перейдите на вкладку **Параметры**.
3.  Скопируйте строку подключения. Например, здесь мы используем строку подключения:
    Data Source=tcp:d015leqjqx.database.windows.net,1433;
    Initial Catalog=ContactDB2;User <Id=ricka0@d015lxyze;Password=xyzxyz>
4.  Закройте диалоговое окно публикации.
5.  В меню **Просмотр** выберите **Обозреватель сервера**.

6.  Щелкните значок **Подключиться к базе данных**.

    ![Опубликовать][9]

7.  Если появится запрос источника данных, выберите **Microsoft SQL Server**.
    ![Опубликовать][10]

8.  Скопируйте и вставьте **Имя сервера**, начинающееся с *tcp* (см. изображение ниже).
9.  Выберите **Использовать проверку подлинности SQL Server**.
10. Введите **Имя пользователя** и **Пароль**, которые находятся в скопированной строке подключения.
11. Введите имя базы данных (ContactDB или строка после «Initial Catalog=» в базе данных, если для нее не было использовано имя ContactDB). При появлении диалогового окна ошибки см. следующий раздел.
12. Нажмите кнопку **Проверить подключение**. При появлении диалогового окна ошибки см. следующий раздел.
    ![add con dlg][add con dlg]

## Ошибка входа: не удается открыть сервер

Если появляется диалоговое окно сообщения об ошибке «Не удается открыть сервер», нужно добавить используемый IP-адрес в список разрешенных IP-адресов.

![Ошибка брандмауэра][Ошибка брандмауэра]

1.  На портале Azure выберите **Базы данных SQL** на левой вкладке.

    ![Выбор SQL][Выбор SQL]

2.  Выберите базу данных, которую нужно открыть.

3.  Щелкните ссылку **Настроить правила брандмауэра Windows Azure для этого IP-адреса**.

    ![Правила брандмауэра][Правила брандмауэра]

4.  При появлении запроса "Текущий IP-адрес xxx.xxx.xxx.xxx не включен в существующие правила брандмауэра. Обновить правила?" щелкните **Да**. Добавление этого адреса часто бывает недостаточно, поэтому понадобится добавить диапазон IP-адресов.

## Добавление диапазона разрешенных IP-адресов

1.  На портале Azure щелкните **Базы данных SQL**.
2.  Щелкните **Сервер**, на котором размещается ваша база данных.

    ![Сервер базы данных][Сервер базы данных]

3.  В верхней части страницы щелкните **Настроить**.
4.  Добавьте имя правила, начальный и конечный IP-адреса.
    ![ip range][ip range]

5.  В нижней части страницы щелкните **Сохранить**.
6.  Теперь можно редактировать базу данных членства, используя ранее описанные действия.

## <a name="nextsteps"></a><span class="short-header">Дальнейшие действия </span>Дальнейшие действия

Этот учебник и пример приложения были написаны [Риком Андерсоном (Rick Anderson)][Риком Андерсоном (Rick Anderson)] (Твиттер [@RickAndMSFT][@RickAndMSFT]) в соавторстве с Томом Дейкстрой (Tom Dykstra), Томом ФитцМакеном (FitzMacken) и Бэрри Доррансом (Barry Dorrans) (Твиттер [@blowdart][@blowdart]).

Пожалуйста, оставьте отзыв о том, что вам понравилось или что вы хотели бы улучшить, не только о самом учебнике, но и о продуктах, которые он демонстрирует. Ваши отзывы помогут нам определить, какие улучшения наиболее приоритетные. Мы особенно заинтересованы узнать, насколько всем хочется получить дополнительные сведения об автоматизации процесса настройки и развертывании базы данных членства.

Чтобы создать цветные кнопки входа в Facebook, Google и Yahoo, воспользуйтесь блогом [Настройка кнопок внешнего входа в ASP.NET MVC 4][Настройка кнопок внешнего входа в ASP.NET MVC 4]. Дополнительные сведения об использовании проверки подлинности Windows см. в следующих статьях:

-   [Проверка подлинности Azure][Проверка подлинности Azure]
-   [Создание сайта интрасети с помощью ASP.NET MVC][Создание сайта интрасети с помощью ASP.NET MVC]

Другой способ хранения данных в приложении Azure — использование хранилища Azure, обеспечивающего хранение нереляционных данных в виде BLOB-объектов и таблиц. Следующие ссылки предоставляют дополнительные сведения о ASP.NET MVC и Azure.

-   [Многоуровневое приложение .NET, использующее таблицы, очереди и BLOB-объекты хранилища][Многоуровневое приложение .NET, использующее таблицы, очереди и BLOB-объекты хранилища].
-   [Введение в ASP.NET MVC 4][Введение в ASP.NET MVC 4]
-   [Общие сведения о работе с Entity Framework с использованием MVC][Общие сведения о работе с Entity Framework с использованием MVC]
-   [OAuth 2.0 и вход][OAuth 2.0 и вход]

Теперь вы знаете, как развертывать веб-приложение на веб-сайте Azure. Дополнительные сведения о настройке, масштабировании веб-сайтов Windows Azure и управлении ими см. в разделах практических руководств на странице [Типичные задачи][Типичные задачи].

Сведения об отладке веб-сайтов Azure см. в разделе [Устранение неполадок веб-сайтов Azure в Visual Studio][Устранение неполадок веб-сайтов Azure в Visual Studio].

Сведения о развертывании приложения в облачной службе Azure см. в [версии этого учебника для облачной службы][версии этого учебника для облачной службы] и в статье [Разработка веб-приложений с использованием Azure][Разработка веб-приложений с использованием Azure]. Выбор для запуска веб-приложения ASP.NET облачной службы Azure вместо веб-сайта Azure может объясняться следующими причинами:

-   нужны права администратора для веб-сервера, на котором выполняется приложение;
-   для доступа к веб-серверу, на котором выполняется приложение, нужно использовать подключение к удаленному рабочему столу;
-   приложение является многоуровневым, и нужно распределить нагрузку по нескольким виртуальным серверам (веб-процессы и рабочие процессы).

Дополнительные сведения о базе данных SQL и хранилище Windows Azure см. в статье [Предлагаемые варианты хранения данных для платформы Azure][Предлагаемые варианты хранения данных для платформы Azure].

Дополнительные сведения об использовании базы данных SQL см. в статье [Работа с базой данных SQL Azure в карте содержимого доступа к данным ASP.NET][Работа с базой данных SQL Azure в карте содержимого доступа к данным ASP.NET].

Для получения дополнительных сведений об Entity Framework и Code First Migrations можно использовать следующие ресурсы:

-   [Общие сведения о работе с Entity Framework с использованием MVC][Общие сведения о работе с Entity Framework с использованием MVC]
-   [Code First Migrations][11]

<!-- bookmarks -->
<!-- links -->
<!-- links from Tom's hopefully no collisions -->
<!-- images-->

  [Страница входа]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxb.png
  [Настройка среды разработки]: #bkmk_setupdevenv
  [Настройка среды Azure]: #bkmk_setupwindowsazure
  [Создание приложения ASP.NET MVC 4]: #bkmk_createmvc4app
  [Развертывание приложения в Azure]: #bkmk_deploytowindowsazure1
  [Добавление базы данных в приложение]: #bkmk_addadatabase
  [Добавление поставщика OAuth]: #addOauth
  [Добавление ролей в базу данных членства]: #mbrDB
  [Создание скрипта развертывания данных]: #ppd
  [1]: #bkmk_deploytowindowsazure11
  [Обновление базы данных членства]: #ppd2
  [Дальнейшие действия]: #nextsteps
  [Пакет Azure SDK для Visual Studio 2012]: http://go.microsoft.com/fwlink/?LinkId=254364
  [Установщик веб-платформы — Azure SDK для .NET]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/WebPIAzureSdk20NetVS12.png
  [портале управления Azure]: https://manage.windowsazure.com
  [Кнопка "Создать" на портале управления]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxWSnew2.png
  [Ссылка "Создать с базой данных" на портале управления]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxCreateWSwithDB.png
  [2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxCreateWSwithDB_2.png
  [Шаг настройки параметров базы данных в мастере «Новый веб-сайт — создать с базой данных»]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-setup-azure-site-004.png
  [3]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxPrevDB.png
  [Диалоговое окно "Новый проект"]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-createapp-002.png
  [Диалоговое окно "Новый проект ASP.NET MVC 4"]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxb2.png
  [\_Layout.cshtml в обозревателе решений]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-createapp-004.png
  [Главная страница списка дел]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxa.png
  [управления Azure]: http://manage.windowsazure.com "портал"
  [Приложение диспетчера контактов на вкладке веб-сайтов портала управления]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-setup-azure-site-006.png
  [Вкладка быстрого запуска и кнопка "Загрузить профиль публикации"]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-deploy1-download-profile.png
  [сохранение файла .publishsettings]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-deploy1-save-profile.png
  ["Опубликовать" в контекстном меню проекта]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/PublishVSSolution.png
  [Параметры импорта публикации]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/ImportPublishSettings.png
  [add win az sub]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rzAddWAsub.png
  [загрузка файла подписки]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rzDownLoad.png
  [download pub file]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rzDown2.png
  [импорт]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rzImp.png
  [Импорт профиля публикации]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/ImportPublishProfile.png
  [Главная страница списка дел на ресурсе Azure]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/newapp005.png
  [Контекстное меню добавления класса в папке "Модели"]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-adddatabase-001.png
  [Диалоговое окно "Добавление нового элемента"]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-adddatabase-002.png
  [Контекстное меню добавления контроллера в папке "Контроллеры"]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-controller-add-context-menu.png
  [Диалоговое окно "Добавление контроллера"]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-controller-add-controller-dialog.png
  [Диалоговое окно Добавление контроллера]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxNewCtx.png
  [Окно сообщения «Добавить контроллер» ]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxOverwrite.png
  [Code First Migrations]: http://msdn.microsoft.com/library/hh770484.aspx
  ["Консоль диспетчера пакетов" в меню "Сервис"]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-migrations-package-manager-menu.png
  [enable-migrations]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxE.png
  [DbContext]: http://msdn.microsoft.com/ru-ru/library/system.data.entity.dbcontext(v=VS.103).aspx
  [Инициализация и отладка баз данных Entity Framework (EF)]: http://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx
  [Команды консоли диспетчера пакетов]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-migrations-package-manager-console.png
  [Представление MVC для данных]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx2.png
  [OAuth]: http://oauth.net/ "http://oauth.net/"
  [Facebook]: http://developers.facebook.com/
  [Microsoft]: http://go.microsoft.com/fwlink/?LinkID=144070
  [Twitter]: http://dev.twitter.com/
  []: https://developers.facebook.com/apps/
  [Создание нового приложения FB]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxFBapp.png
  [Новое приложение FB]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxFB.png
  [Инженеры-испытатели FB]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxFBt.png
  [Показать данные таблиц]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxSTD.png
  [Идентификаторы пользователей]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxUid.png
  [roleID]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxRoleID.png
  [usr role ID tbl]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxUR.png
  [Authorize]: http://msdn.microsoft.com/ru-ru/library/system.web.mvc.authorizeattribute(v=vs.100).aspx
  [RequireHttps]: http://msdn.microsoft.com/ru-ru/library/system.web.mvc.requirehttpsattribute(v=vs.108).aspx
  [Защита приложения ASP.NET MVC 4 и новый атрибут AllowAnonymous]: http://blogs.msdn.com/b/rickandy/archive/2012/03/23/securing-your-asp-net-mvc-4-app-and-the-new-allowanonymous-attribute.aspx
  [CAPTCHA]: http://www.asp.net/web-pages/tutorials/security/16-adding-security-and-membership
  [Включение SSL]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxSSL.png
  [4]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxS2.png
  [Предупреждение о сертификате]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxNOT.png
  [5]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxNOT2.png
  [dbDacFx]: http://msdn.microsoft.com/ru-ru/library/dd394698.aspx
  [Центра загрузки Microsoft SQL Server 2012 Express]: http://www.microsoft.com/ru-ru/download/details.aspx?id=29062
  [Установка SQL]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxSS.png
  [con to srvr dlg]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxC2S.png
  [Создать скрипты]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxGenScripts.png
  [Задать параметры скриптов]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx11.png
  [6]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxAdv.png
  [Сохранить или опубликовать]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx1.png
  [3 cons str]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxd.png
  [7]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-deploy1-publish-001.png
  [Параметры]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxD2.png
  [8]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxSettings.png
  [добавить sql]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxAddSQL2.png
  [Опубликовать]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxP.png
  [9]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxc.png
  [10]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx3.png
  [add con dlg]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx4.png
  [Ошибка брандмауэра]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx5.png
  [Выбор SQL]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx6.png
  [Правила брандмауэра]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx7.png
  [Сервер базы данных]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx8.png
  [ip range]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx9.png
  [Риком Андерсоном (Rick Anderson)]: http://blogs.msdn.com/b/rickandy/
  [@RickAndMSFT]: https://twitter.com/RickAndMSFT
  [@blowdart]: https://twitter.com/blowdart
  [Настройка кнопок внешнего входа в ASP.NET MVC 4]: http://www.beabigrockstar.com/customizing-external-login-buttons-in-asp-net-mvc-4/
  [Проверка подлинности Azure]: http://www.asp.net/vnext/overview/fall-2012-update/windows-azure-authentication
  [Создание сайта интрасети с помощью ASP.NET MVC]: http://msdn.microsoft.com/ru-ru/library/gg703322(v=vs.98).aspx
  [Многоуровневое приложение .NET, использующее таблицы, очереди и BLOB-объекты хранилища]: http://www.windowsazure.com/ru-ru/develop/net/tutorials/multi-tier-web-site/1-overview/
  [Введение в ASP.NET MVC 4]: http://www.asp.net/mvc/tutorials/mvc-4/getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4
  [Общие сведения о работе с Entity Framework с использованием MVC]: http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application
  [OAuth 2.0 и вход]: http://blogs.msdn.com/b/vbertocci/archive/2013/01/02/oauth-2-0-and-sign-in.aspx
  [Типичные задачи]: http://www.windowsazure.com/ru-ru/develop/net/common-tasks/
  [Устранение неполадок веб-сайтов Azure в Visual Studio]: /ru-ru/develop/net/tutorials/troubleshoot-web-sites-in-visual-studio/
  [версии этого учебника для облачной службы]: http://www.windowsazure.com/ru-ru/develop/net/tutorials/cloud-service-with-sql-database/
  [Разработка веб-приложений с использованием Azure]: http://msdn.microsoft.com/ru-ru/library/Hh674484
  [Предлагаемые варианты хранения данных для платформы Azure]: http://social.technet.microsoft.com/wiki/contents/articles/data-storage-offerings-on-the-windows-azure-platform.aspx
  [Работа с базой данных SQL Azure в карте содержимого доступа к данным ASP.NET]: http://go.microsoft.com/fwlink/p/?LinkId=282414#ssdb
  [11]: http://msdn.microsoft.com/ru-ru/library/hh770484
