<properties linkid="" urlDisplayName="" pageTitle="" metaKeywords="" description="" metaCanonical="" services="" documentationCenter="" title=" OAuth" authors="riande" solutions="" manager="wpickett" editor="mollybos" />




# Развертывание безопасного приложения ASP.NET MVC с членством, OAuth и базой данных SQL на веб-сайте Azure

***Авторы: [Рик Андерсон (Rick Anderson)](https://twitter.com/RickAndMSFT) и Том Дайкстра (Tom Dykstra). Обновление: 15 октября 2013 г.***


<div class="dev-center-tutorial-selector sublanding"><a href="/ru-ru/develop/net/tutorials/web-site-with-sql-database/" title="Visual Studio 2013">Visual Studio 2013</a><a href="/ru-ru/develop/net/tutorials/web-site-with-sql-database-vs2012/" title="Visual Studio 2012" class="current">Visual Studio 2012</a></div>

<div class="dev-callout"><strong>Примечание</strong><p>Доступна <a href="/ru-ru/develop/net/tutorials/web-site-with-sql-database/">новая версия этого учебника</a>. Этой версией можно продолжать пользоваться, если планируется использовать Visual Studio 2012, но работать с новой версией намного проще.</p></div>

В этом учебнике показано, как создать безопасное веб-приложение ASP.NET MVC 4, которое позволяет пользователям входить в систему, используя учетные данные из Facebook, Yahoo и Google. Вы также узнаете, как развернуть приложение в Azure.

Можно бесплатно создать учетную запись Azure, а если у вас еще нет Visual Studio 2012, пакет SDK автоматически установит Visual Studio 2012 для Web Express. Вы можете приступить к разработке приложений для Azure совершенно бесплатно.

В данном учебнике предполагается, что у читателя нет опыта использования платформы Azure. По завершении изучения этого учебника вы создадите безопасное приложение на основе данных, выполняемое в облаке и использующее облачную базу данных.

Вы узнаете следующее:

* Подготовка компьютера к разработке для Azure путем установки пакета Azure SDK.
* Создание безопасного проекта Visual Studio ASP.NET MVC 4 и его публикация на веб-сайте Azure.
* Использование OAuth, OpenID и базы данных членства ASP.NET для защиты приложения.
* Развертывание базы данных членства в Azure.
* Использование базы данных SQL для хранения данных в Azure.
* Использование Visual Studio для обновления базы данных членства и управления ей.

Вы создадите простое веб-приложение для списка контактов, основанное на платформе ASP.NET MVC 4 и использующее ADO.NET Entity Framework для доступа к базе данных. На следующем рисунке показана страница входа для готового приложения:

![Страница входа](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxb.png)

[WACOM.INCLUDE [create-account-and-websites-note](../includes/create-account-and-websites-note.md)]

В этом учебнике рассматриваются следующие темы:

- [Настройка среды разработки][setupdbenv]
- [Настройка среды Azure][setupwindowsazureenv]
- [Создание приложения ASP.NET MVC 4][createapplication]
- [Развертывание приложения в Azure][deployapp1]
- [Добавление базы данных в приложение][adddb]
- [Добавление поставщика OAuth][]
- [Добавление ролей в базу данных членства][]
- [Создание скрипта развертывания данных][]
- [Развертывание приложения в Azure][deployapp11]
- [Обновление базы данных членства][]
- [Следующие шаги][]

<h2><a name="bkmk_setupdevenv"></a>Настройка среды разработки</h2>

Для начала работы настройте среду разработки, установив пакет Azure SDK для платформы .NET Framework. 

1. Чтобы установить пакет Azure SDK для .NET, щелкните приведенную ниже ссылку. Если среда Visual Studio 2012 еще не установлена, ее можно установить по ссылке. Для этого учебного курса требуется Visual Studio 2012. 
[Azure SDK для Visual Studio 2012]( http://go.microsoft.com/fwlink/?LinkId=254364)
1. При появлении приглашения запустить или сохранить исполняемый файл установки выберите **Запустить**.
1. В окне установщика веб-платформы нажмите кнопку **Установить** и продолжайте установку.

![Установщик веб-платформы - Azure SDK для .NET][WebPIAzureSdk20NetVS12]


После завершения установки вы получите все компоненты, необходимые для разработки.



<h2><a name="bkmk_setupwindowsazure"></a>Настройка среды Azure</h2>

Затем настройте среду Azure, создав веб-сайт Azure и базу данных SQL.

### Создание веб-сайта и базы данных SQL в Azure

Ваш веб-сайт Azure будет работать в общей среде размещения, а это означает, что он работает на виртуальных машинах, используемых совместно с другими клиентами Azure. Общая среда размещения — недорогой способ начать работу в облаке. Если позднее ваш веб-трафик увеличится, приложение можно масштабировать по необходимости, запуская его на выделенных виртуальных машинах. Если требуется более сложная архитектура, можно перейти в облачную службу Azure. Облачные службы работают на выделенных виртуальных машинах, которые можно настроить в соответствии с конкретными потребностями.

База данных SQL в Azure — это облачная служба реляционной базы данных, построенная на основе технологий SQL Server. Средства и приложения, работающие с SQL Server, работают и с базой данных SQL.

1. На [портале управления Azure](https://manage.windowsazure.com) выберите в левой вкладке **Веб-сайты**, а затем нажмите кнопку **Создать**.

![Кнопка "Создать" на портале управления][rxWSnew]

2. Выберите **НАСТРАИВАЕМОЕ СОЗДАНИЕ**.

	![Ссылка "Создать с базой данных" на портале управления][rxCreateWSwithDB]

Откроется мастер **Новый веб-сайт — настраиваемое создание**. 

3. На шаге **Создать веб-сайт** мастера введите в поле **URL-адрес** строку, которая будет использоваться в качестве уникального URL-адреса вашего приложения. Полный URL-адрес будет состоять из введенной здесь строки и суффикса, который отображается рядом с текстовым полем. На рисунке показана строка "contactmgr2", однако этот URL-адрес может быть занят, так что понадобится выбрать другое значение.

	![Ссылка "Создать с базой данных" на портале управления][rxCreateWSwithDB_2]

4. В раскрывающемся списке **База данных** выберите параметр **Создать базу данных SQL**.

5. В раскрывающемся списке **Область** выберите ту же область, которая была выбрана для веб-сайта. Этот параметр определяет центр обработки данных, в котором будет выполняться ваша виртуальная машина. Для параметра **ИМЯ СТРОКИ ПОДКЛЮЧЕНИЯ К БАЗЕ ДАННЫХ** введите *connectionString1*.

	![Шаг создания нового веб-сайта в мастере "Новый веб-сайт — создать с базой данных"][rxCreateWSwithDB_2]

6. В нижней части окна щелкните стрелку, указывающую вправо. Мастер перейдет к шагу **Параметры базы данных**.

7. В поле **Имя** введите *ContactDB*.

8. В поле **Сервер** выберите **Создать сервер базы данных SQL**. Если же вы ранее создали базу данных SQL Server, можно выбрать в раскрывающемся списке этот SQL Server.

9. Введите **ИМЯ ДЛЯ ВХОДА В СИСТЕМУ** и **ПАРОЛЬ** администратора. Если выбрано действие **Создать сервер базы данных SQL**, не используйте здесь существующие имя и пароль, введите новые, которые в дальнейшем будут использоваться при обращении к базе данных. Если выбран созданный ранее SQL Server, появится запрос на ввод пароля для ранее созданной учетной записи SQL Server. В этом учебнике поле **Дополнительно** не отмечается. Поле **Дополнительно ** позволяет задавать размер БД (по умолчанию 1 ГБ, однако его можно увеличить до 150 ГБ), а также сортировку.

10. Чтобы закончить работу, щелкните значок галочки в нижней части окна.
	
	![Шаг настройки базы данных в мастере "Новый веб-сайт — создать с базой данных"][setup007]
	
	На следующем изображении показано использование существующего SQL Server и входа в систему.
	![Шаг настройки базы данных в мастере "Новый веб-сайт — создать с базой данных"][rxPrevDB]

	Портал управления возвращается на страницу веб-сайтов, и в столбце **Состояние** указывается, что веб-сайт создается. Через какое-то время (обычно меньше минуты) в столбце **Состояние** указывается, что сайт успешно создан. В строке навигации слева число сайтов вашей учетной записи отображается рядом со значком **Веб-сайты**, а число баз данных — рядом со значком **Базы данных SQL**.


<h2><a name="bkmk_createmvc4app"></a>Создание приложения ASP.NET MVC 4</h2>

Веб-сайт Azure создан, но его контент еще отсутствует. Следующим шагом будет создание проекта веб-приложения Visual Studio, которое будет опубликовано в Azure.

### Создание проекта

1. Откройте Visual Studio 2012.
1. В меню **Файл** выберите **Новый проект**.
3. В диалоговом окне **Новый проект** разверните узел **Visual C#** и выберите **Интернет** в разделе **Установленные шаблоны**, а затем выберите **Веб-приложение ASP.NET MVC 4**. Оставьте значение по умолчанию **.NET Framework 4.5**. Присвойте приложению имя **ContactManager** и нажмите кнопку **ОК**.

	![Диалоговое окно "Новый проект"][newapp002]

6. В диалоговом окне **Новый проект ASP.NET MVC 4** выберите шаблон **Веб-приложение**. Оставив **Обработчик представлений** Razor по умолчанию, нажмите кнопку **ОК**.

	![Диалоговое окно "Новый проект ASP.NET MVC 4"][rxb2]

### Задание верхнего и нижнего колонтитула страницы


1. В **обозревателе решений** разверните папку "Views\Shared" и откройте файл *_Layout.cshtml*.

	![_Layout.cshtml в обозревателе решений][newapp004]

1. Замените все вхождения элемента "Мое приложение ASP.NET MVC" на "Contact Manager".
1. Замените элемент "Ваша эмблема" на текст "CM Demo".



### Локальный запуск приложения

1. Нажмите сочетание клавиш CTRL+F5 для запуска приложения. Главная страница приложения откроется в браузере, используемом по умолчанию.
![Главная страница списка дел][rxa]

Это все, что требуется для создания приложения, которое будет развернуто в Azure. Далее вы добавите функции работы с базой данных.

<h2><a name="bkmk_deploytowindowsazure1"></a>Развертывание приложения в Azure</h2>

1. Откройте в браузере [Портал управления Azure](http://manage.windowsazure.com "portal").

2. На вкладке **Веб-сайты** щелкните имя ранее созданного сайта.

	![Приложение диспетчера контактов на вкладке веб-сайтов портала управления][setup009]

3. В правой части окна щелкните **Загрузить профиль публикации**.

	![Вкладка быстрого запуска и кнопка "Загрузить профиль публикации"][firsdeploy001]

	Это действие загружает файл, содержащий все параметры, необходимые для развертывания приложения на веб-сайте. Этот файл будет импортирован в Visual Studio, поэтому вводить эти сведения вручную не понадобится.

4. Сохраните файл .*publishsettings* в папке, доступной из Visual Studio.

	![сохранение файла .publishsettings][firsdeploy002]


	[WACOM.INCLUDE [publishsettingsfilewarningchunk](../includes/publishsettingsfilewarningchunk.md)]

5. В Visual Studio щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Опубликовать** в контекстном меню.

	!["Опубликовать" в контекстном меню проекта][PublishVSSolution]
	
	Откроется мастер **Публикация веб-сайта**.

6. На вкладке **Профиль** мастера **Публикация веб-сайта** выберите **Импорт**.

	![Параметры импорта публикации][ImportPublishSettings]

	Появится диалоговое окно **Импорт профиля публикации**.

1. Если подписка Azure еще не добавлена в Visual Studio, выполните следующие действия. После добавления существующей подписки в раскрывающемся списке в разделе **Импорт с веб-сайта Azure** появится и ваш веб-сайт.
    
	a. В диалоговом окне **Импорт профиля публикации** щелкните **Добавить подписку Azure**. 

	![add win az sub](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rzAddWAsub.png)
	
	b. В диалоговом окне **Импорт подписок Azure** щелкните **Загрузить файл подписки**.
    
	![download sub](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rzDownLoad.png)
	
	c. В окне браузера сохраните файл *.publishsettings*.
    
	![download pub file](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rzDown2.png)
    
	> [WACOM.NOTE]
	> PUBLISHSETTINGS-файл содержит учетные данные (без кодировки), используемые для администрирования подписок и служб Azure. В целях безопасности для этого файла рекомендуется временно хранить его за пределами исходных каталогов (например, в папке Libraries\Documents), а затем удалять после завершения импорта. Злоумышленник, получивший доступ к PUBLISHSETTINGS-файлу, сможет изменять, создавать и удалять ваши службы Azure.
	
    
	d. В диалоговом окне **Импорт подписок Azure** нажмите кнопку **Обзор** и перейдите к файлу *.publishsettings*.
    
	![download sub](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rzDownLoad.png)
	
	e. Щелкните **Импорт**.
    
	![импорт](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rzImp.png)

7. В диалоговом окне **Импорт профиля публикации** выберите **Импорт с веб-сайта Azure**, выберите свой веб-сайт в раскрывающемся списке, затем нажмите кнопку **ОК**.

	![Импорт профиля публикации][ImportPublishProfile]

	Созданное вами приложение теперь выполняется в облаке. При следующем развертывании приложения будут развернуты только измененные (или новые) файлы.
	
	![Главная страница списка дел на ресурсе Azure][newapp005]


<h2><a name="bkmk_addadatabase"></a>Добавление базы данных в приложение</h2>

Теперь вы обновите приложение MVC, чтобы добавить возможности для отображения и обновления контактов и сохранения данных в базе данных. Приложение будет использовать компонент Entity Framework для создания базы данных, а также чтения и обновления данных в базе данных.

### Добавление классов модели данных для контактов

Начните с создания простой модели данных в коде.

1. В **обозревателе решений** щелкните правой кнопкой мыши папку "Модели" и выберите **Добавить**, а затем щелкните **Класс**.

![Контекстное меню добавления класса в папке "Модели"][adddb001]

2. В диалоговом окне **Добавление нового элемента** присвойте новому файлу класса имя *Contact.cs*, а затем нажмите кнопку **Добавить**.

![Диалоговое окно "Добавление нового элемента"][adddb002]

3. Замените содержимое файла Contacts.cs на код, приведенный ниже.

        using System.ComponentModel.DataAnnotations;
        using System.Globalization;
        namespace ContactManager.Models
        {
            public class Contact
            {
                public int ContactId { get; set; }
                public string Name { get; set; }
                public string Address { get; set; }
                public string City { get; set; }
                public string State { get; set; }
                public string Zip { get; set; }
                [DataType(DataType.EmailAddress)]
                public string Email { get; set; }
            }
        }

Класс **Contacts** определяет данные, которые будут храниться для каждого контакта, а также первичный ключ, *ContactID*, необходимый для базы данных.

### Создание веб-страниц, позволяющих пользователям приложений работать с контактами

Компонент формирования шаблонов в ASP.NET MVC может автоматически создавать код, выполняющий операции создания, чтения, обновления и удаления.

<h2><a name="bkmk_addcontroller"></a>Добавление контроллера и представления для данных</h2>

1. Создайте проект **(Ctrl+Shift+B)**. (Проект необходимо создать перед использованием механизма формирования шаблонов.) 
1. В **обозревателе решений** щелкните правой кнопкой мыши папку "Контроллеры" и выберите **Добавить**, а затем выберите **Контроллер**.

	![Контекстное меню добавления контроллера в папке "Контроллеры"][addcode001]

5. В диалоговом окне **Добавление контроллера** введите "Главный_контроллер" в качестве имени контроллера. 
1. Задайте для пункта **Шаблон параметров формирования шаблонов** значение **Контроллер MVC с действиями чтения и записи и представлениями с использованием Entity Framework**.
6. Выберите **Контакт** в качестве класса модели и **&lt;Новый контекст данных...&gt;** в качестве класса контекста данных.

	![Диалоговое окно "Добавление контроллера"][addcode002]

7. В диалоговом окне **Новый контекст данных** примите значение по умолчанию *ContactManager.Models.ContactManagerContext*.
	![Диалоговое окно "Добавление контроллера"][rxNewCtx]

8. Нажмите кнопку **ОК**, затем **Добавить** в диалоговом окне **Добавление контроллера**.
9. В диалоговом окне переопределения **Добавление контроллера** убедитесь, что все параметры помечены флажками, и нажмите кнопку **ОК**.

	[Окно сообщения "Добавление контроллера"][rxOverwrite] 

Visual Studio создает методы и представления контроллера для операций создания, чтения, обновления и удаления в базе данных для объектов **Контакт**.

## Включение Migrations, создание базы данных, добавление примера данных и инициализатора данных ##

Следующая задача заключается в активации компонента [Code First Migrations](http://msdn.microsoft.com/library/hh770484.aspx) для создания базы данных на основе созданной модели данных.

1. В меню **Сервис** выберите **Диспетчер пакетов библиотеки**, а затем **Консоль диспетчера пакетов**.

	![Консоль диспетчера пакетов в меню "Сервис"][addcode008]

2. В окне **Консоль диспетчера пакетов** введите следующую команду:

		enable-migrations -ContextTypeName ContactManagerContext

	![enable-migrations][rxE] 
	Необходимо указать имя типа контекста (**ContactManagerContext**), так как проект содержит два производных класса [DbContext](http://msdn.microsoft.com/ru-ru/library/system.data.entity.dbcontext(v=VS.103).aspx): только что добавленный **ContactManagerContext** и класс **UsersContext**, используемый для базы данных членства. Класс **ContactManagerContext** был добавлен в мастер формирования шаблонов Visual Studio.

	Команда **enable-migrations** создает папку *Migrations* и размещает в этой папке файл *Configuration.cs*, который можно использовать для настройки миграций. 

2. В окне **Консоль диспетчера пакетов** введите следующую команду:

		add-migration Initial


	Команда **add-migration Initial** создает файл с именем **&lt;date_stamp&gt;Initial** в папке *Migrations*, который в свою очередь создает базу данных. Первый параметр (**Initial**) является произвольным и используется для создания имени файла. Новые файлы классов можно просмотреть в **обозревателе решений**.

	В классе **Initial** метод **Up** создает таблицу Contacts, а метод **Down** (используется при возвращении к предыдущему состоянию) удаляет эту таблицу.

3. Откройте файл *Migrations\Configuration.cs*. 
4. Добавьте следующие пространства имен. 

    	 использование ContactManager.Models;



5. Замените метод *Seed* следующим кодом:

        protected override void Seed(ContactManager.Models.ContactManagerContext context)
        {
            context.Contacts.AddOrUpdate(p => p.Name,
               new Contact
               {
                   Name = "Debra Garcia",
                   Address = "1234 Main St",
                   City = "Redmond",
                   State = "WA",
                   Zip = "10999",
                   Email = "debra@example.com",
               },
                new Contact
                {
                    Name = "Thorsten Weinrich",
                    Address = "5678 1st Ave W",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "thorsten@example.com",
                },
                new Contact
                {
                    Name = "Yuhong Li",
                    Address = "9012 State st",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "yuhong@example.com",
                },
                new Contact
                {
                    Name = "Jon Orton",
                    Address = "3456 Maple St",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "jon@example.com",
                },
                new Contact
                {
                    Name = "Diliana Alexieva-Bosseva",
                    Address = "7890 2nd Ave E",
                    City = "Redmond",
                    State = "WA",
                    Zip = "10999",
                    Email = "diliana@example.com",
                }
                );
        }

	Приведенный выше код инициализирует базу данных с контактной информацией. Дополнительные сведения об инициализации базы данных см. в разделе [Инициализация и отладка баз данных Entity Framework (EF)](http://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx).


6. В окне **Консоль диспетчера пакетов** введите команду:

		update-database

	![Команды консоли диспетчера пакетов][addcode009]

	Команда **update-database** выполняет первую миграцию, при которой создается база данных. По умолчанию база данных создается как база данных LocalDB в SQL Server Express. (Если решение SQL Server Express не установлено, база данных создается с помощью экземпляра SQL Server Express.)

7. Для запуска приложения нажмите сочетание клавиш CTRL+F5. 

Приложение показывает начальные данные и предоставляет ссылки для изменения, удаления и просмотра подробных сведений.

![Представление MVC для данных][rx2]

<h2><a name="addOauth"></a><span class="short-header">OAuth</span>Добавление поставщика OAuth</h2>

[OAuth](http://oauth.net/ "http://oauth.net/") — это открытый протокол, обеспечивающий безопасную авторизацию простым и стандартным способом из веб-приложений, мобильных и настольных приложений. В интернет-шаблоне ASP.NET MVC для предоставления Facebook, Twitter, Google, Yahoo и Microsoft в качестве поставщиков проверки подлинности используются OAuth и OpenID. В этом учебнике в качестве поставщиков проверки подлинности используются только Facebook, Google и Yahoo, но можно легко изменить код, чтобы использовался любой другой поставщик. Шаги по реализации других поставщиков очень похожи на шаги, представленные в этом учебнике. 

Помимо проверки подлинности в учебнике будут использоваться роли для реализации авторизации. Только пользователи, добавленные в роль canEdit, смогут создавать, изменять и удалять контакты.

## Регистрация у внешнего поставщика ##

Для проверки подлинности пользователей, использующих учетные данные некоторых внешних поставщиков, необходимо зарегистрировать веб-сайт у соответствующего поставщика, а также получить ключ и секретный код для подключения. Google и Yahoo не требуют регистрации и получения ключей.

В этом учебнике приведены не все действия, необходимые для регистрации у этих поставщиков. Эти действия обычно не являются трудными. Для успешной регистрации веб-сайта следуйте инструкциям, приведенным на сайтах поставщиков. Чтобы начать работу с регистрации веб-сайта, см. сведения на сайте разработчика:

- [Facebook](http://developers.facebook.com/)
- [Microsoft](http://go.microsoft.com/fwlink/?LinkID=144070)
- [Twitter](http://dev.twitter.com/)

Перейдите на страницу [https://developers.facebook.com/apps](https://developers.facebook.com/apps/) и при необходимости войдите в систему. Нажмите кнопку **Зарегистрироваться в качестве разработчика** и выполните процесс регистрации. После завершения регистрации нажмите кнопку **Создать новое приложение**. Введите имя конечной точки для приложения. Введение пространства имен для приложения не требуется.

![Создание нового приложения FB](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxFBapp.png)


Введите "localhost" для параметра **Домен приложения** и "http://localhost/" для параметра **URL-адрес сайта**. Щелкните **Включено** для параметра **Режим изолированной среды**, а затем нажмите кнопку **Сохранить изменения**.


Для реализации OAuth в этом приложении понадобятся **Идентификатор приложения** и **Секрет приложения**.
	![Новое приложение FB][rxFB]

## Создание тестовых пользователей ##
В левой области нажмите в разделе **Параметры** кнопку **Роли разработчика**. Щелкните ссылку **Создать** для строки **Тестовые пользователи** (а не для строки **Инженеры-испытатели**).

![FB testers](./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxFBt.png)

Щелкните ссылку **Изменить**, чтобы получить электронную почту тестовых пользователей (которая будет использоваться для входа в приложение). Щелкните ссылку **Дополнительно**, а затем выберите **Изменить**, чтобы задать пароль тестовых пользователей.

## Добавление идентификатора приложения и секретного кода поставщика ##

Откройте файл *App_Start\AuthConfig.cs*. Удалите символы комментариев из метода *RegisterFacebookClient* и добавьте идентификатор приложения и секретный код приложения. Используйте полученные значения, приведенные ниже значения работать не будут. Удалите символы комментариев из вызова *OAuthWebSecurity.RegisterGoogleClient* и добавьте *OAuthWebSecurity.RegisterYahooClient*, как показано ниже. Поставщики Google и Yahoo не требуют регистрации и получения ключей. 
Предупреждение. Храните идентификатор и секретный код приложения в безопасном месте. Злоумышленник, обладающий идентификатором и секретным кодом приложения, сможет выдать себя за ваше приложение.

     public static void RegisterAuth()
        {
            OAuthWebSecurity.RegisterFacebookClient(
                appId: "введите здесь цифровой ключ",
                appSecret: "введите здесь цифровой секретный код");

            OAuthWebSecurity.RegisterGoogleClient();
            OAuthWebSecurity.RegisterYahooClient();
        }


1. Запустите приложение и щелкните ссылку **Вход**. 
1. Нажмите кнопку **Facebook**. 
1. Введите свои учетные данные в Facebook или учетные данные одного из тестовых пользователей.
1. Нажмите кнопку **ОК**, чтобы разрешить приложению доступ к вашим ресурсам Facebook.
1. Будет выполнено перенаправление на страницу регистрации. Если вход в систему выполнен с помощью тестовой учетной записи, можно изменить **имя пользователя** на более короткое, например "Тест FB Коли". Нажмите кнопку **Зарегистрировать**, чтобы сохранить в базе данных членства псевдоним электронной почты и имя пользователя. 
1. Зарегистрируйте другого пользователя. В настоящее время ошибка в системе входа не позволяет выйти из системы и войти под именем другого пользователя, используя того же поставщика (то есть нельзя выйти из своей учетной записи Facebook и войти, используя другую учетную запись Facebook). Чтобы обойти эту проблему, перейдите на сайт, используя другой браузер, и зарегистрируйте другого пользователя. Один пользователь будет добавлен в роль администратора и получит доступ к приложению с возможностью изменения, другому пользователю на сайте будут доступны только методы, не вносящие изменений. Анонимные пользователи получат доступ только к главной странице.
1. Зарегистрируйте другого пользователя для другого поставщика.
1. **Необязательно**. Можно также создать локальную учетную запись, не связанную ни с одним из поставщиков. Далее в этом учебнике возможность создания локальных учетных записей будет удалена. Чтобы создать локальную учетную запись, щелкните ссылку **Выход** (если выполнен вход в систему), а затем щелкните ссылку **Зарегистрировать**. В целях администрирования может понадобиться создать локальную учетную запись, не связанную ни с каким внешним поставщиком проверки подлинности.

<h2><a name="mbrDB"></a><span class="short-header">База данных членства</span>Добавление ролей в базу данных членства</h2>
В этом разделе в базу данных членства будет добавлена роль *canEdit*. Только пользователи, входящие в роль canEdit, смогут изменять данные. Рекомендуется именовать роли по выполняемым ими действиям, например имя *canEdit* предпочтительнее имени *admin*. По мере развития приложения можно добавлять новые роли, например роль *canDeleteMembers*, а не только *superAdmin*.

1. В меню **Просмотр** выберите **Обозреватель сервера**. 

1. В **обозревателе сервера** разверните **DefaultConnection**, а затем разверните **Таблицы**.

1. Щелкните правой кнопкой мыши **UserProfile** (профиль пользователя) и выберите **Показать данные таблиц**.
 
	![Показать данные таблиц][rxSTD]
 
1. Запишите идентификатор **UserId** для пользователя, которому будет назначена роль canEdit. На следующем рисунке пользователю *ricka* с **UserId** 2 будет назначена роль canEdit для веб-сайта.

	![Идентификаторы пользователей][rxUid]
 
1. Щелкните правой кнопкой мыши **webpages_Roles** и выберите **Показать данные таблиц**.
1. Введите **canEdit** в ячейке **RoleName**. Если роль добавляется впервые, значение **RoleId** будет равно 1. Запишите значение RoleID. Убедитесь в отсутствии замыкающего пробела — "canEdit " в таблице ролей не будет соответствовать "canEdit" в коде контроллера.

	![roleID][rxRoleID] 

1. Щелкните правой кнопкой мыши **webpages UsersInRoles** и выберите **Показать данные таблиц**. Введите **ИД пользователя** для пользователя, которому нужно предоставить доступ *canEdit* и **RoleId**.

	![usr role ID tbl][rxUR] 

Таблица **webpages_OAuthMembership** содержит поставщика OAuth, ИД пользователя для поставщика и ИД пользователя для каждого зарегистрированного пользователя OAuth. <!-- Не заменяйте "-" на "_" — это приведет к неправильной записи имени -->Таблица **webpages-Membership** содержит таблицу членства ASP.NET. Можно добавлять пользователей в эту таблицу с помощью ссылки регистрации. Рекомендуется добавить пользователя с ролью *canEdit*, не связанного с Facebook или другим внешним поставщиком услуг авторизации, чтобы можно было всегда получить доступ *canEdit*, даже когда внешний поставщик услуг авторизации недоступен. Далее в этом учебнике регистрация членства ASP.NET будет отключена.

## Защита приложения с помощью атрибута Authorize ##

В этом разделе для ограничения доступа к методам действий будет применен атрибут [Authorize](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.authorizeattribute(v=vs.100).aspx). Анонимный пользователь сможет просмотреть только главную страницу. Зарегистрированные пользователи смогут видеть контактные сведения, сведения о программе и страницы контактов. Только пользователи с назначенной ролью *canEdit* получат доступ к методам действий, изменяющих данные.

1. Добавьте в приложение фильтры [Authorize](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.authorizeattribute(v=vs.100).aspx) и [RequireHttps](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.requirehttpsattribute(v=vs.108).aspx). В качестве альтернативы можно добавить атрибуты [Authorize](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.authorizeattribute(v=vs.100).aspx) и [RequireHttps](http://msdn.microsoft.com/ru-ru/library/system.web.mvc.requirehttpsattribute(v=vs.108).aspx) для каждого контроллера, но с точки зрения безопасности рекомендуется применять их ко всему приложению. В случае глобального добавления атрибутов каждый новый контроллер и метод действия будет защищен автоматически, вам не потребуется помнить о необходимости их применения. Дополнительные сведения см. в разделе [Защита приложения ASP.NET MVC 4 и новый атрибут AllowAnonymous](http://blogs.msdn.com/b/rickandy/archive/2012/03/23/securing-your-asp-net-mvc-4-app-and-the-new-allowanonymous-attribute.aspx). Откройте файл *App_Start\FilterConfig.cs* замените метод *RegisterGlobalFilters* следующим кодом.

        public static void
        RegisterGlobalFilters(GlobalFilterCollection filters)
        {
            filters.Add(new HandleErrorAttribute());
            filters.Add(new System.Web.Mvc.AuthorizeAttribute());
            filters.Add(new RequireHttpsAttribute());
        }

1. Добавьте атрибут [AllowAnonymous](http://blogs.msdn.com/b/rickandy/archive/2012/03/23/securing-your-asp-net-mvc-4-app-and-the-new-allowanonymous-attribute.aspx) в метод **Index**. С помощью атрибута [AllowAnonymous](http://blogs.msdn.com/b/rickandy/archive/2012/03/23/securing-your-asp-net-mvc-4-app-and-the-new-allowanonymous-attribute.aspx) можно создать белый список методов, для которых не нужна авторизация.
1. Добавьте [Authorize(Roles = "canEdit")] в методы Get и Post, изменяющие данные (Create, Edit, Delete). 
1. Добавьте методы *About* и *Contact*. Ниже показана часть готового кода.

	    public class HomeController : Controller
	    {
	        private ContactManagerContext db = new ContactManagerContext();
	        [AllowAnonymous]
	        public ActionResult Index()
	        {
	            return View(db.Contacts.ToList());
	        }
	
	        public ActionResult About()
	        {
	            return View();
	        }
	
	        public ActionResult Contact()
	        {
	            return View();
	        }
	
	        [Authorize(Roles = "canEdit")]
	        public ActionResult Create()
	        {
	            return View();
	        }
	        // Методы перемещены и опущены для ясности.
	    }

1. Удалите регистрацию членства ASP.NET. При текущей регистрации членства ASP.NET в проекте не поддерживается сброс паролей и не проверяется, человек ли регистрируется (например, с помощью запроса [CAPTCHA](http://www.asp.net/web-pages/tutorials/security/16-adding-security-and-membership)). Пользователь, прошедший проверку подлинности с использованием одного из сторонних поставщиков, может зарегистрироваться. В контроллере AccountController удалите атрибут *[AllowAnonymous]* из методов GET и POST для действия *Регистрация*. Это не позволит регистрироваться программам-роботам и анонимным пользователям.
1. В папке *Views\Shared\_LoginPartial.cshtml* удалите ссылку на действие "Регистрация".
1. Включите SSL. В обозревателе решений щелкните проект **ContactManager**, а затем нажмите F4, чтобы открыть диалоговое окно свойств. Для параметра **SSL включен** измените значение на "true". Скопируйте **URL-адрес SSL**.

	![Включение SSL][rxSSL]
 
1. В обозревателе решений щелкните правой кнопкой мыши проект **Contact Manager** и выберите **Свойства**.
1. На левой вкладке щелкните **Интернет**.
1. Измените **URL-адрес проекта**, чтобы использовать **URL-адрес SSL**.
1. Щелкните **Создать виртуальный каталог**.
	
	![Включение SSL][rxS2]
 
1. Нажмите сочетание клавиш CTRL+F5 для запуска приложения. Откроется браузер с предупреждением о сертификате. Для нашего приложения можно безопасно щелкнуть ссылку **Перейти на этот веб-сайт**. Проверьте, что только пользователи с ролью *canEdit* могут изменять данные. Убедитесь, что анонимные пользователи могут только просматривать главную страницу.

	![Предупреждение о сертификате][rxNOT]

	![Предупреждение о сертификате][rxNOT2]
 
Веб-сайты Azure содержат действующий сертификат безопасности, поэтому при развертывании в Azure это предупреждение не отображается.
<h2><a name="ppd"></a><span class="short-header">Подготовка базы данных</span>Создание скрипта развертывания данных</h2>


База данных членства не управляется с помощью Entity Framework Code First, поэтому для ее развертывания нельзя использовать Migrations.  Для развертывания схемы базы данных будет использоваться поставщик [dbDacFx](http://msdn.microsoft.com/ru-ru/library/dd394698.aspx), а также будет настроен профиль публикации для запуска скрипта, который вставит первоначальные данные о членстве в таблицы членства.

В этом учебнике для создания скриптов развертывания данных будет использоваться среда SQL Server Management Studio (SSMS). 

Установите SSMS из [Центра загрузки Microsoft SQL Server 2012 Express](http://www.microsoft.com/ru-ru/download/details.aspx?id=29062):

- [ENU\x64\SQLManagementStudio_x 64_ENU.exe](http://download.microsoft.com/download/8/D/D/8DD7BDBA-CEF7-4D8E-8C16-D9F69527F909/ENU/x64/SQLManagementStudio_x64_ENU.exe) для 64-разрядных систем.
- [ENU\x86\SQLManagementStudio_x86_ENU.exe](http://download.microsoft.com/download/8/D/D/8DD7BDBA-CEF7-4D8E-8C16-D9F69527F909/ENU/x86/SQLManagementStudio_x86_ENU.exe) для 32-разрядных систем.

 Если выбран неправильный вариант, установка закончится неудачей. В этом случае попробуйте другой вариант.

(Обратите внимание, что размер загружаемого файла составляет 600 мегабайт. Процесс установки может занять много времени и потребовать перезагрузить компьютер.)

На первой странице Центра установки SQL Server нажмите кнопку **Новая изолированная установка SQL Server или добавление компонентов к существующему экземпляру** и следуйте инструкциям, принимая значения по умолчанию. На следующем рисунке показано действие для установки SSMS.

![Установка SQL][rxSS] 

### Создание скрипта разработки базы данных ###


1. Запустите SSMS.
1. В диалоговом окне **Подключение к серверу** введите *(localdb) \v11.0* в качестве имени сервера, оставьте значение **Проверка подлинности** равным **Проверка подлинности Windows** и нажмите кнопку **Подключить**. Если SQL Express уже установлен, введите **.\SQLEXPRESS**.
	
	![con to srvr dlg][rxC2S] 

1. В окне **Обозреватель объектов** разверните **Базы данных**, щелкните правой кнопкой мыши **aspnet-ContactManager**, выберите **Задачи** и нажмите кнопку **Создать скрипты**.
	
	![Создать скрипты][rxGenScripts] 

1. В диалоговом окне **Создание и публикация скриптов** нажмите кнопку **Задать параметры скриптов**.
Можно пропустить шаг **Выбор объектов**, так как по умолчанию выбраны вся база данных скриптов и все объекты базы данных, то есть как раз то, что нужно.

1. Нажмите кнопку **Дополнительно**.

	![Задать параметры скриптов][rx11] 

1. Прокрутите диалоговое окно **Дополнительные параметры скриптов** вниз до поля **Типы данных для скриптов** и выберите в раскрывающемся списке вариант **Только данные**. (См. рисунок под следующим шагом.)

1. Измените значение **USE DATABASE в скрипте** на **False**.  Инструкции USE не подходят для базы данных SQL Azure и не нужны для развертывания SQL Server Express в тестовой среде. 
	
	![Задать параметры скриптов][rxAdv] 

1. Нажмите кнопку **ОК**.
1. В диалоговом окне **Создание и публикация скриптов** поле **Имя файла** определяет, где будет создан скрипт. Измените путь к папке решения (папка с вашим файлом *Contacts.sln*) и измените имя файла на *aspnet-data-membership.sql*.
1. Нажмите кнопку **Далее** для перехода к вкладке **Сводка**, а затем нажмите кнопку **Далее** еще раз, чтобы создать скрипт.

	![Сохранить или опубликовать][rx1] 

1. Нажмите кнопку **Готово**.

<h2><a name="bkmk_deploytowindowsazure11"></a>Развертывание приложения в Azure</h2>

1. Откройте корневой файл приложения *Web.config*. Найдите разметку *DefaultConnection*, затем скопируйте и вставьте ее под строкой разметки *DefaultConnection*. Переименуйте скопированный элемент *DefaultConnectionDeploy*. Эта строка подключения понадобится для развертывания данных о пользователях в базе данных членства.
	![3 cons str][rxD] 

1. Создайте приложение.
1. В Visual Studio щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Опубликовать** в контекстном меню.

	!["Опубликовать" в контекстном меню проекта][firsdeploy003]

Откроется мастер **Публикация веб-сайта**.

1. Выберите вкладку **Параметры**. Щелкните значок **v**, чтобы выбрать параметр **Строка удаленного подключения** для **ContactManagerContext** и **DefaultConnectionDeploy**. Все три перечисленных базы данных будут использовать одну и ту же строку подключения. В базе данных **ContactManagerContext** хранятся контакты, **DefaultConnectionDeploy** используется только для развертывания данных учетных записей пользователей в базе данных членства, а база данных **UsersContext** является базой данных членства.
	
	![Параметры][rxD2] 

1. В разделе **ContactManagerContext** установите флажок **Выполнить Code First Migrations**.
	
	![Параметры][rxSettings] 

1. В разделе **DefaultConnectionDeploy** установите флажок **Обновить базу данных** и щелкните ссылку **Настройка обновлений базы данных**.
1. Щелкните ссылку **Добавить скрипт SQL** и перейдите к файлу *aspnet-data-membership.sql*. Это нужно сделать только один раз. При следующем развертывании снимите флажок **Обновить базы данных**, так как вам не понадобится добавлять пользовательские данные в таблицы членства.

	![add sql][rxAddSQL2] 

1. Щелкните **Опубликовать**.
1. Перейдите на страницу [https://developers.facebook.com/apps](https://developers.facebook.com/apps/) и установите значения **Домены приложения** и **URL-адрес сайта** равными URL-адресу Azure.
1. Выполните тестирование приложения. Проверьте, что только пользователи с ролью *canEdit* могут изменять данные. Убедитесь, что анонимные пользователи могут только просматривать главную страницу. Убедитесь, что прошедшие проверку подлинности пользователи могут переходить по всем ссылкам, которые не изменяют данные.
1. При следующей публикации приложения не забудьте снять флажок **Обновить базу данных** в разделе **DefaultConnectionDeploy**.
	
	![Параметры][rxSettings]

<h2><a name="ppd2"></a><span class="short-header">Обновление базы данных</span>Обновление базы данных членства</h2>

После развертывания сайта в Azure и увеличения числа зарегистрированных пользователей может понадобиться назначить некоторым из них роль *canEdit*. В этом разделе для подключения к базе данных SQL и добавления пользователей в роль *canEdit* используется Visual Studio.

![Параметры][rxSettings] 

1. В **обозревателе решений** щелкните правой кнопкой проект и выберите пункт **Опубликовать**.
	![Опубликовать][rxP]

1. Выберите вкладку **Параметры**.
2. Скопируйте строку подключения. Например, в этом примере используется следующая строка подключения:
	Data Source=tcp:d015leqjqx.database.windows.net,1433;
	Initial Catalog=ContactDB2;User Id=ricka0@d015lxyze;Password=xyzxyz
1. Закройте диалоговое окно публикации.
1. В меню **Просмотр** выберите **Обозреватель сервера**. 

1. Щелкните значок **Подключиться к базе данных**.
	
	![Опубликовать][rxc]

1. Если появится запрос источника данных, выберите **Microsoft SQL Server**.
	![Опубликовать][rx3]

1. Скопируйте и вставьте **Имя сервера**, начинающееся с *tcp* (см. следующий рисунок).
1. Нажмите кнопку **Проверка подлинности SQL Server**.
1. Введите свои значения в поля **Имя пользователя** и **Пароль** из скопированной строки подключения.
1. Введите имя базы данных (ContactDB или строка после "Initial Catalog=" в базе данных, если было использовано другое имя, не ContactDB). При появлении диалогового окна ошибки см. следующий раздел. 
1. Нажмите кнопку **Проверить подключение**. При появлении диалогового окна ошибки см. следующий раздел. 
	![add con dlg][rx4]

## Ошибка входа в систему "Не удается открыть сервер" ##
Если появляется диалоговое окно сообщения об ошибке "Не удается открыть сервер", нужно добавить используемый IP-адрес в список разрешенных IP-адресов.

![Ошибка брандмауэра][rx5]

1. На портале Azure выберите **Базы данных SQL** на левой вкладке.

	![Выбор SQL][rx6]

1. Выберите базу данных, которую нужно открыть.

1. Щелкните ссылку **Настроить правила брандмауэра Azure для этого IP-адреса**.

	![Правила брандмауэра][rx7]

1. При появлении запроса "Текущий IP-адрес xxx.xxx.xxx.xxx не включен в существующие правила брандмауэра. Обновить правила?" щелкните **Да**. Добавление этого адреса часто бывает недостаточно, поэтому понадобится добавить диапазон IP-адресов.

## Добавление диапазона разрешенных IP-адресов ##

1. На портале Azure щелкните **Базы данных SQL**.
1. Щелкните **Сервер**, на котором размещается ваша база данных.

	![Сервер базы данных][rx8]

1. В верхней части страницы щелкните **Настроить**.
1. Добавьте имя правила, начальный и конечный IP-адреса.
	![Диапазон IP-адресов][rx9]

1. В нижней части страницы щелкните **Сохранить**.
1. Теперь можно редактировать базу данных членства, используя ранее описанные действия.

<h2><a name="nextsteps"></a><span class="short-header">Дальнейшие действия</span>Дальнейшие действия</h2>

Этот учебник и пример приложения были написаны [Риком Андерсоном (Rick Anderson)](http://blogs.msdn.com/b/rickandy/) (Твиттер [@RickAndMSFT](https://twitter.com/RickAndMSFT)) в соавторстве с Томом Дайкстрой (Tom Dykstra), Томом ФитцМакеном (Tom FitzMacken) и Бэрри Доррансом (Barry Dorrans) (Твиттер [@blowdart](https://twitter.com/blowdart)). 

Пожалуйста, оставьте отзыв о том, что вам понравилось или что вы хотели бы улучшить, не только о самом учебнике, но и о продуктах, которые он демонстрирует. Ваши отзывы помогут нам определить, какие улучшения наиболее приоритеты. Мы особенно заинтересованы узнать, насколько всем хочется получить дополнительные сведения об автоматизации процесса настройки и развертывании базы данных членства. 

Чтобы создать цветные кнопки входа в Facebook, Google и Yahoo, воспользуйтесь блогом [Настройка кнопок внешнего входа в ASP.NET MVC 4](http://www.beabigrockstar.com/customizing-external-login-buttons-in-asp-net-mvc-4/). Дополнительные сведения об использовании проверки подлинности Windows см. в следующих статьях:

- [Проверка подлинности Azure ](http://www.asp.net/vnext/overview/fall-2012-update/windows-azure-authentication)
- [Создание сайта интрасети с помощью ASP.NET MVC](http://msdn.microsoft.com/ru-ru/library/gg703322(v=vs.98).aspx)

Другой способ хранения данных в приложении Azure — использование хранилища Azure, обеспечивающего хранение нереляционных данных в виде BLOB-объектов и таблиц. Следующие ссылки предоставляют дополнительные сведения о ASP.NET MVC и Azure. 

- [Многоуровневое приложение .NET, использующее таблицы, очереди и BLOB-объекты хранилища](http://www.windowsazure.com/ru-ru/develop/net/tutorials/multi-tier-web-site/1-overview/).
- [Введение в ASP.NET MVC 4](http://www.asp.net/mvc/tutorials/mvc-4/getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4)
- [Общие сведения о работе с Entity Framework с использованием MVC][EFCodeFirstMVCTutorial]
- [OAuth 2.0 и вход](http://blogs.msdn.com/b/vbertocci/archive/2013/01/02/oauth-2-0-and-sign-in.aspx)


Было показано, как развертывать веб-приложение на веб-сайте Azure. Дополнительные сведения о настройке, масштабировании веб-сайтов Azure и управлении ими см. в разделах практических руководств на странице [Типичные задачи][CommonTasks].

Сведения об отладке веб-сайтов Azure см. в разделе [Устранение неполадок веб-сайтов Azure в Visual Studio](/ru-ru/develop/net/tutorials/troubleshoot-web-sites-in-visual-studio/).

Сведения о развертывании приложения в облачной службе Azure см. в [версии этого учебника для облачной службы][NetAppWithSqlAzure] и в статье [Разработка веб-приложений с использованием Azure][DevelopingWebAppsWithWindowsAzure]. Выбор для запуска веб-приложения ASP.NET облачной службы Azure вместо веб-сайта Azure может объясняться следующими причинами:

* нужны права администратора для веб-сервера, на котором выполняется приложение;
* для доступа к веб-серверу, на котором выполняется приложение, нужно использовать подключение к удаленному рабочему столу; 
* приложение является многоуровневым, и нужно распределить нагрузку по нескольким виртуальным серверам (веб-процессы и рабочие процессы).

Дополнительные сведения о базе данных SQL и хранилище Azure см. в статье [Предлагаемые варианты хранения данных для платформы Azure][WindowsAzureDataStorageOfferings].

Дополнительные сведения об использовании базы данных SQL см. в статье [Работа с базой данных SQL Azure в карте содержимого доступа к данным ASP.NET](http://go.microsoft.com/fwlink/p/?LinkId=282414#ssdb).

Для получения дополнительных сведений об Entity Framework и Code First Migrations можно использовать следующие ресурсы:

* [Общие сведения о работе с Entity Framework с использованием MVC][EFCodeFirstMVCTutorial]
* [Code First Migrations][EFCFMigrations]




<!-- bookmarks -->
[Добавление поставщика OAuth]: #addOauth
[Добавление ролей в базу данных членства]:#mbrDB
[Создание скрипта развертывания данных]:#ppd
[Обновление базы данных членства]:#ppd2
[setupdbenv]: #bkmk_setupdevenv
[setupwindowsazureenv]: #bkmk_setupwindowsazure
[createapplication]: #bkmk_createmvc4app
[deployapp1]: #bkmk_deploytowindowsazure1
[deployapp11]: #bkmk_deploytowindowsazure11
[adddb]: #bkmk_addadatabase




<!-- links -->




[WindowsAzureDataStorageOfferings]: http://social.technet.microsoft.com/wiki/contents/articles/data-storage-offerings-on-the-windows-azure-platform.aspx

[NetAppWithSQLAzure]: http://www.windowsazure.com/ru-ru/develop/net/net-app-with-sql-azure





[CommonTasks]: http://windowsazure.com/develop/net/common-tasks/





[EFCodeFirstMVCTutorial]: http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application
[EFCFMigrations]: http://msdn.microsoft.com/ru-ru/library/hh770484


<!-- links from Tom's hopefully no collisions -->

[WindowsAzureDataStorageOfferings]: http://social.technet.microsoft.com/wiki/contents/articles/data-storage-offerings-on-the-windows-azure-platform.aspx

[NetAppWithSQLAzure]: http://www.windowsazure.com/ru-ru/develop/net/tutorials/cloud-service-with-sql-database/





[CommonTasks]: http://www.windowsazure.com/ru-ru/develop/net/common-tasks/







[EFCodeFirstMVCTutorial]: http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application
[EFCFMigrations]: http://msdn.microsoft.com/ru-ru/library/hh770484
[DevelopingWebAppsWithWindowsAzure]: http://msdn.microsoft.com/ru-ru/library/Hh674484

<!-- images-->
[rxE]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxE.png
[rx2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx2.png
[rxP]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxP.png
[rxFB]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxFB.png
[rxSTD]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxSTD.png
[rxUid]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxUid.png
[rxRoleID]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxRoleID.png
[rxUR]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxUR.png
[rxC2S]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxC2S.png
[rxGenScripts]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxGenScripts.png
[rx11]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx11.png
[rxAdv]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxAdv.png
[rx1]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx1.png
[rxd]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxd.png
[rxSettings]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxSettings.png
[rxD2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxD2.png
[rxAddSQL2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxAddSQL2.png
[rxc]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxc.png
[rx3]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx3.png
[rx4]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx4.png
[rx5]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx5.png
[rx6]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx6.png
[rx7]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx7.png
[rx8]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx8.png
[rx9]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rx9.png
[rxa]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxa.png
[rxb]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxb.png
[rxSS]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxSS.png
[rxp2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxp2.png
[rxp3]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxp3.png
[rxSSL]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxSSL.png
[rxS2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxS2.png
[rxNOT]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxNOT.png
[rxNOT2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxNOT2.png
[rxb2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxb2.png
[rxNOT]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxNOT.png
[rxNOT]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxNOT.png
[rxNOT]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxNOT.png
[rxCreateWSwithDB_2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxCreateWSwithDB_2.png
[rxNewCtx]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxNewCtx.png
[rxCreateWSwithDB_2]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxCreateWSwithDB_2.png 
[rxPrevDB]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxPrevDB.png
[rxOverwrite]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxOverwrite.png
[rxNewCtx]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxNewCtx.png
[rxSettings]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxSettings.png
[rxWSnew]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxWSnew2.png
[rxCreateWSwithDB]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/rxCreateWSwithDB.png
[setup007]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-setup-azure-site-004.png
[setup009]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-setup-azure-site-006.png
[newapp002]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-createapp-002.png
[newapp004]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-createapp-004.png
[newapp005]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/newapp005.png
[firsdeploy001]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-deploy1-download-profile.png
[firsdeploy002]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-deploy1-save-profile.png
[firsdeploy003]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-deploy1-publish-001.png
[adddb001]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-adddatabase-001.png
[adddb002]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-adddatabase-002.png
[addcode001]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-controller-add-context-menu.png
[addcode002]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-controller-add-controller-dialog.png

[addcode008]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-migrations-package-manager-menu.png
[addcode009]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/dntutmobile-migrations-package-manager-console.png
[Important information about ASP.NET in Azure Web Sites]: #aspnetwindowsazureinfo
[Следующие шаги]: #nextsteps
[ImportPublishSettings]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/ImportPublishSettings.png
[ImportPublishProfile]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/ImportPublishProfile.png
[PublishVSSolution]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/PublishVSSolution.png
[WebPIAzureSdk20NetVS12]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/WebPIAzureSdk20NetVS12.png
[WebPIAzureSdk20NetVS12]: ./media/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database-vs2012/WebPIAzureSdk20NetVS12.png

