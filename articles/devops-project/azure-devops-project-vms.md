---
title: Развертывание приложения ASP.NET на виртуальных машинах Azure с помощью проекта Azure DevOps | Руководство по Azure DevOps Services
description: Проект DevOps упрощает начало работы с Azure. Проект Azure DevOps упрощает развертывание вашего приложения ASP.NET на виртуальных машинах Azure за несколько простых шагов.
ms.author: mlearned
ms.manager: douge
ms.prod: devops
ms.technology: devops-cicd
ms.topic: tutorial
ms.date: 07/09/2018
author: mlearned
monikerRange: vsts
ms.openlocfilehash: b05e2c2c46aa9bfa8c92d3d3c5c83d018c547b9f
ms.sourcegitcommit: f3bd5c17a3a189f144008faf1acb9fabc5bc9ab7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2018
ms.locfileid: "44299140"
---
# <a name="tutorial--deploy-your-aspnet-app-to-azure-virtual-machines-with-the-azure-devops-project"></a>Руководство. Развертывание приложения ASP.NET на виртуальных машинах Azure с помощью проекта Azure DevOps

Проект Azure DevOps представляет собой упрощенный интерфейс, к которому вы подключаете существующий код и репозиторий Git. Или можно выбрать один из примеров приложений, чтобы создать конвейер непрерывной интеграции (CI) и непрерывной поставки (CD) в Azure.  Проект DevOps автоматически создает такие ресурсы Azure, как новая виртуальная машина Azure, создает и настраивает в Azure DevOps конвейер выпуска, который содержит конвейер сборки CI, настраивает определения выпуска для непрерывного развертывания и создает ресурс Azure Application Insights для мониторинга.

Вы сможете выполнять следующие задачи:

> [!div class="checklist"]
> * Создание проекта Azure DevOps для приложения ASP.NET
> * Настройка Azure DevOps Services и подписки Azure 
> * Изучение конвейера CI в Azure DevOps Services
> * Изучение конвейера CD в Azure DevOps Services
> * Фиксация изменений в Azure DevOps Services и автоматическое развертывание в Azure
> * Настройка мониторинга Azure Application Insights
> * Очистка ресурсов

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Вы можете получить бесплатную подписку с помощью [Visual Studio Dev Essentials](https://visualstudio.microsoft.com/dev-essentials/).

## <a name="create-an-azure-devops-project-for-an-aspnet-app"></a>Создание проекта Azure DevOps для приложения ASP.NET

Проект Azure DevOps создает в Azure конвейер CI/CD.  Вы можете создать **новую организацию Azure DevOps Services** или использовать **существующую организацию**.  Проект Azure DevOps также создает **ресурсы Azure**, такие как виртуальные машины, в **подписке Azure** по вашему выбору.

1. Войдите на портал [Microsoft Azure](https://portal.azure.com).

1. Щелкните значок **Создать ресурс** на панели навигации слева, затем выполните поиск по запросу **Проект DevOps**.  Выберите **Создать**.

    ![Начало непрерывной поставки](_img/azure-devops-project-github/fullbrowser.png)

1. Щелкните **.NET**, а затем нажмите кнопку **Далее**.

1. Для параметра **Выберите платформу приложений** выберите значение **ASP.NET**, а затем нажмите кнопку **Далее**. 

1. Исполняющая среда, которую вы выбрали на предыдущих шагах, определяет тип цели развертывания службы Azure, доступной здесь.  Щелкните **Виртуальная машина**, а затем нажмите кнопку **Далее**.

## <a name="configure-azure-devops-services-and-an-azure-subscription"></a>Настройка Azure DevOps Services и подписки Azure

1. Создайте **новую** организацию Azure DevOps Services или выберите **существующую** организацию.  Выберите **имя** для проекта Azure DevOps.  

1. Выберите **службу подписки Azure**.  Вы можете по желанию щелкнуть ссылку **​​Изменить**, а затем ввести дополнительные сведения о конфигурации, такие как изменение местоположения ресурсов Azure.
 
1. Введите **имя виртуальной машины**, **имя пользователя** и **пароль** для нового ресурса виртуальной машины Azure, а затем нажмите кнопку **Готово**.

1. Подготовка виртуальной машины Azure займет несколько минут.  Пример приложения ASP.NET настраивается в репозитории в вашей организации Azure DevOps Services, выполняется сборка и выпуск, а затем приложение развертывается на созданной виртуальной машине Azure.  

    После этого на портале Azure загружается **панель мониторинга** проекта Azure DevOps.  Вы также можете перейти к **панели мониторинга проекта Azure DevOps** непосредственно на вкладке **Все ресурсы** на **портале Azure**.  

    Эта панель мониторинга предоставляет информацию о **репозитории кода**, **конвейере CI/CD Azure** и **выполняемом в Azure приложении** из Azure DevOps Services.    

    ![Представление панели мониторинга](_img/azure-devops-project-vms/dashboardnopreview.png)

1. Проект Azure DevOps автоматически настраивает триггер сборки и выпуска CI, который автоматически развертывает любые изменения кода в вашем репозитории.  Вы можете настроить дополнительные параметры в Azure DevOps.  В правой части панели мониторинга выберите **Обзор**, чтобы просмотреть запущенное приложение.
    
## <a name="examine-the-azure-devops-services-ci-pipeline"></a>Изучение конвейера CI в Azure DevOps Services
 
Проект Azure DevOps автоматически настраивает конвейер CI/CD Azure в организации Azure DevOps Services.  Вы можете изучить и настроить конвейер.  Выполните следующие шаги, чтобы лучше понять конвейеры сборки в Azure DevOps Services.

1. Щелкните **Конвейеры сборки** в **верхней части** **панели мониторинга проекта Azure DevOps**.  Эта ссылка открывает в новой вкладке браузера конвейер сборки Azure DevOps Services для нового проекта.

1. Поместите указатель мыши справа от конвейера сборки рядом с полем **Состояние**. Выберите отобразившееся **многоточие**.  Это действие открывает меню, в котором можно выполнить несколько действий, таких как **постановка новой сборки в очередь**, **приостановка создания** и **изменение конвейера сборки**.

1. Выберите **Изменить**

1. В этом представлении **рассмотрите различные задачи** для конвейера сборки.  Сборка выполняет несколько задач, например получает источники из репозитория Azure DevOps Services Git, восстанавливает зависимости и публикует используемые для развертывания результаты.

1. Выберите **имя конвейера сборки** в верхней части конвейера сборки.

1. Замените это **имя** более понятным и описательным.  Щелкните **Save & queue** (Сохранить и поместить в очередь), а затем выберите **Сохранить**.

1. Под именем конвейера сборки щелкните **Журнал**.  Вы увидите журнал аудита последних изменений сборки.  Azure DevOps Services отслеживает любые изменения, внесенные в конвейер сборки, и позволяет сравнивать версии.

1. Выберите **Триггеры**.  Проект Azure DevOps автоматически создал триггер CI, и теперь каждая фиксация в репозитории запускает новую сборку.  При желании выберите включение или исключение ветвей из процесса CI.

1. Щелкните **Период удержания**.  На основе вашего сценария можно указать политики для хранения или удаления определенного количества сборок.

## <a name="examine-the-azure-devops-services-cd-pipeline"></a>Изучение конвейера CD в Azure DevOps Services

Проект Azure DevOps автоматически создает и настраивает необходимые шаги для развертывания из организации Azure DevOps Services в подписку Azure.  Эти шаги включают настройку подключения к службе Azure для аутентификации Azure DevOps Services в подписке Azure.  Также служба автоматизации создает конвейер CD Azure DevOps Services, который выполняет непрерывное развертывание на виртуальной машине Azure.  Выполните следующие шаги, чтобы изучить возможности конвейера CD Azure DevOps Services.

1. Щелкните **Сборка и выпуск**, а затем выберите **Выпуски**.  Проект Azure DevOps создал конвейер выпуска Azure DevOps Services для управления развертываниями в Azure.

1. В левой части окна браузера щелкните **многоточие** рядом с конвейером выпуска и выберите **Изменить**.

1. Конвейер выпуска содержит **конвейер**, в котором определен процесс выпуска.  В разделе **Артефакты** выберите **Удалить**.  Конвейер сборки, который вы изучали на предыдущих этапах, создает выходные данные для артефакта. 

1. Справа от значка **Удалить** выберите **значок** **Триггер непрерывного развертывания** (в виде молнии).  Для этого конвейера выпуска активирован триггер непрерывного развертывания.  Триггер запускает развертывание каждый раз, когда имеется новый артефакт сборки.  При желании вы можете отключить триггер, чтобы развертывание требовалось выполнять вручную. 

1. В левой части браузера выберите **Задачи**, а затем выберите **среду**.  

1. Задачами являются действия, выполняемые вашим процессом развертывания, которые сгруппированы по **фазам**.  Для этого конвейера выпуска есть две **фазы**.  Первая фаза содержит **задачу развертывания группы ресурсов Azure**, которая настраивает виртуальную машину для развертывания и добавляет новую виртуальную машину в **группу развертывания Azure DevOps**.  Группа развертывания виртуальных машин в Azure DevOps управляет логическими группами **целевых компьютеров** развертывания.

1. На этом втором этапе была создана задача **Управление веб-приложением IIS** для создания веб-сайта IIS на виртуальной машине.  Для развертывания сайта была создана вторая задача **Развертывание веб-приложения IIS**.

1. В правой части окна браузера выберите **Просмотреть выпуски**.  В этом представлении можно просмотреть журнал выпусков.

1. Щелкните **многоточие** рядом с одним из выпусков и выберите **Открыть**.  В этом представлении есть несколько меню, которые можно изучить, например меню **сводки**, **связанных рабочих элементов** и **тестов**.

1. Щелкните **Фиксации**.  В этом представлении отображаются фиксации кода, связанные с конкретным развертыванием. Сравните выпуски, чтобы просмотреть различия между развертываниями.

1. Выберите **Журналы**.  Журналы содержат полезную информацию о процессе развертывания.  Их можно просматривать как во время, так и после развертывания.

## <a name="commit-changes-to-azure-devops-services-and-automatically-deploy-to-azure"></a>Фиксация изменений в Azure DevOps Services и автоматическое развертывание в Azure 

Теперь вы готовы сотрудничать с командой в своем приложении с процессом CI/CD, который автоматически развертывает данные последней работы на вашем веб-сайте.  Каждое изменение в репозитории Git для Azure DevOps Services запускает сборку в Azure DevOps Services, а затем конвейер CD Azure DevOps Services выполняет развертывание на виртуальной машине Azure.  Выполните следующие действия или используйте другие методы для фиксации изменений в вашем репозитории.  Изменения кода инициируют процесс CI/CD и автоматически развертывают ваши новые изменения на веб-сайте IIS на виртуальной машине Azure.

1. Щелкните **Код** в меню Azure DevOps Services, чтобы открыть репозиторий.

1. Перейдите в каталог **Views\Home**, затем щелкните **многоточие** рядом с **Index.cshtml**, а затем щелкните **Изменить**.

1. Внесите изменения в файл, например, измените некоторый текст внутри одного из тегов **div**.  В правом верхнем углу щелкните **Зафиксировать**.  Щелкните **Зафиксировать** еще раз, чтобы внести изменения. 

1. Через несколько минут **начинается сборка в Azure DevOps Services**, а затем выполняется выпуск для развертывания изменений.  **Состояние сборки** вы можете отслеживать на панели мониторинга для проекта DevOps или на странице браузера, которая отображает организацию Azure DevOps Services.

1. По завершении выпуска **обновите приложение** в браузере, чтобы убедиться, что вы видите изменения.

## <a name="configure-azure-application-insights-monitoring"></a>Настройка мониторинга Azure Application Insights

С помощью Azure Application Insights можно легко отслеживать производительность и использование своего приложения.  Проект Azure DevOps автоматически настроил ресурс Application Insights для вашего приложения.  Вы можете дополнительно настроить различные предупреждения и возможности мониторинга по мере необходимости.

1. Перейдите на панель мониторинга **проекта Azure DevOps** на **портале Azure**.  В правом нижнем углу панели мониторинга выберите ссылку **​​Application Insights** для своего приложения.

1. На портале Azure откроется колонка **Application Insights**.  Это представление содержит информацию об использовании, производительности и доступности приложения.

    ![Application Insights](_img/azure-devops-project-github/appinsights.png) 

1. Щелкните **Диапазон времени**, а затем выберите **За последний час**.  Щелкните **Обновить**, чтобы отфильтровать результаты.  Отобразится вся активность за последние 60 минут.  Щелкните **x**, чтобы закрыть диапазон времени.

1. Вы можете найти **Оповещения** и несколько других полезных ссылок в верхней части панели.  Выберите **Оповещения**, затем щелкните **+ Добавить оповещение метрики**.

1. Введите **имя** оповещения.

1. По умолчанию оповещение отображается, если **время отклика сервера превышает 1 секунду**.  Выберите раскрывающийся список **Метрика**, чтобы просмотреть различные оповещения метрики.  Например, вы можете настроить **время выполнения запроса ASP.NET** для приложения ASP.NET.  Различные оповещения можно легко настроить, чтобы улучшить возможности мониторинга приложения.

1. Установите флажок **Notify via Email owners, contributors, and readers** (Уведомлять по электронной почте владельцев, участников и читателей).  При желании вы можете выполнять дополнительные действия, когда срабатывает оповещение во время выполнения приложения логики Azure.

1. Нажмите кнопку **ОК**, чтобы создать оповещение.  Через несколько секунд предупреждение появится на панели мониторинга как активное.  **Выйдите из** области оповещений и вернитесь в колонку **Application Insights**.

1. Выберите **Доступность**, затем щелкните **+ Add test** (+ Добавить тест). 

1. Введите **имя теста**, а затем выберите **Создать**.  Будет создан простой тест проверки связи для проверки доступности вашего приложения.  Через несколько минут результаты тестирования будут доступны, а на панели мониторинга Application Insights отобразится состояние доступности.

## <a name="clean-up-resources"></a>Очистка ресурсов

 > [!NOTE]
 > При выполнении шагов ниже ресурсы удаляются навсегда.  Используйте эту функцию только после того, как досконально ознакомитесь с подсказками.

Если вы выполняете тестирование, вы можете очистить ресурсы, чтобы избежать непредвиденных расходов.  Вы можете удалить ненужную виртуальную машину Azure и связанные с ней ресурсы, созданные в этом руководстве, с помощью функции **Удалить** на панели мониторинга Azure DevOps.  **Будьте внимательны**, так как функция удаления уничтожает данные, созданные проектом Azure DevOps в Azure и в Azure DevOps, и вы не сможете получить их после этого.

1. На **портале Azure** перейдите к **проекту Azure DevOps**.
2. В **верхней правой** стороне панели мониторинга нажмите кнопку **Удалить**.  Прочитав подсказку, щелкните **Да**, чтобы**навсегда удалить** ресурсы.

## <a name="next-steps"></a>Дополнительная информация

Вы можете по желанию изменить эти конвейеры сборки и выпуска в соответствии с потребностями вашей команды. Вы также можете использовать этот шаблон CI/CD в качестве шаблона для других своих проектов.  Вы научились выполнять следующие задачи:

> [!div class="checklist"]
> * Создание проекта Azure DevOps для приложения ASP.NET
> * Настройка Azure DevOps Services и подписки Azure 
> * Изучение конвейера CI в Azure DevOps Services
> * Изучение конвейера CD в Azure DevOps Services
> * Фиксация изменений в Azure DevOps Services и автоматическое развертывание в Azure
> * Настройка мониторинга Azure Application Insights
> * Очистка ресурсов

Чтобы получить дополнительные сведения о конвейере CI/CD Azure, изучите это руководство:

> [!div class="nextstepaction"]
> [Define your multi-stage continuous deployment (CD) process](https://docs.microsoft.com/azure/devops/pipelines/release/define-multistage-release-process?view=vsts) (Определение многоэтапного процесса непрерывного развертывания)
