---
title: Развертывание приложения ASP.NET в службу Azure Kubernetes (AKS) с помощью проекта Azure DevOps | Руководство по VSTS
description: Проект DevOps упрощает начало работы с Azure. Проект Azure DevOps упрощает развертывание вашего приложения ASP.NET Core со службой Azure Kubernetes (AKS) за несколько простых шагов.
ms.author: mlearned
ms.manager: douge
ms.prod: devops
ms.technology: devops-cicd
ms.topic: tutorial
ms.date: 07/09/2018
author: mlearned
monikerRange: vsts
ms.openlocfilehash: 98c585cc0c6136496fe190cd3eceb27fd856af21
ms.sourcegitcommit: a1e1b5c15cfd7a38192d63ab8ee3c2c55a42f59c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/10/2018
ms.locfileid: "37967426"
---
# <a name="tutorial--deploy-your-aspnet-core-app-to-azure-kubernetes-service-aks-with-the-azure-devops-project"></a>Руководство. Развертывание приложения ASP.NET в службу Azure Kubernetes (AKS) с помощью проекта Azure DevOps

Проект Azure DevOps представляет собой упрощенный интерфейс, к которому вы подключаете существующий код и репозиторий Git. Или можно выбрать один из примеров приложений, чтобы создать конвейер непрерывной интеграции (CI) и непрерывной поставки (CD) в Azure.  Проект DevOps автоматически создает такие ресурсы Azure, как AKS, а также создает и настраивает конвейер выпуска в VSTS, содержащий определение сборки для CI, который позволяет задать определение выпуска для компакт-диска, а затем создает ресурс Azure Application Insights для мониторинга.

Вы сможете выполнять следующие задачи:

> [!div class="checklist"]
> * Создание проекта Azure DevOps для приложения ASP.NET Core и службы Azure Kubernetes.
> * Настройка VSTS и подписки Azure. 
> * Изучение кластера AKS.
> * Изучение определения сборки VSTS CI.
> * Изучение определения Release Management VSTS CD.
> * Фиксация изменений в VSTS и автоматическое развертывание в Azure.
> * Очистка ресурсов

## <a name="prerequisites"></a>предварительным требованиям

* Подписка Azure. Вы можете получить бесплатную подписку с помощью [Visual Studio Dev Essentials](https://visualstudio.microsoft.com/dev-essentials/).

## <a name="create-an-azure-devops-project-for-an-aspnet-core-app-and-aks"></a>Создание проекта Azure DevOps для приложения ASP.NET Core и службы Azure Kubernetes

Проект Azure DevOps создает конвейер CI/CD в VSTS.  Вы можете создать учетную запись **VSTS** или использовать **имеющуюся**.  Проект Azure DevOps также создает **ресурсы Azure**, такие как кластер AKS, в **подписке Azure** по вашему выбору.

1. Войдите на портал [Microsoft Azure](https://portal.azure.com).

1. Щелкните значок **Создать ресурс** на левой панели навигации, затем найдите **проект DevOps**.  Выберите **Создать**.

    ![Начало непрерывной поставки](_img/azure-devops-project-aks/fullbrowser.png)

1. Щелкните **.NET**, а затем нажмите кнопку **Далее**.

1. Для параметра **Выберите платформу приложений** выберите значение **ASP.NET Core**, а затем нажмите кнопку **Далее**.

1. Выберите **Служба Kubernetes**, затем щелкните **Далее**.  

## <a name="configure-vsts-and-an-azure-subscription"></a>Настройка VSTS и подписки Azure

1. **Создайте** учетную запись VSTS или выберите **имеющуюся**.  Выберите **имя** для проекта VSTS.  

1. Выберите свою **подписку Azure**.

1. Щелкните ссылку **Изменение**, чтобы просмотреть дополнительные параметры Azure и определить **количество узлов** для **кластера Kubernetes**.  В этом руководстве существуют различные варианты для настройки типа и расположения служб Azure.
 
1. Выйдите из области конфигурации Azure и щелкните **Готово**.

1. Этот процесс может занять несколько минут.  Пример приложения ASP.NET Core настраивается в репозитории в вашей учетной записи VSTS, выполняется создание кластера AKS, сборка и выпуск, а ваше приложение развертывается в Azure.  

    После этого на портале Azure загружается **панель мониторинга** проекта Azure DevOps.  Вы также можете перейти к **панели мониторинга проекта Azure DevOps** непосредственно на вкладке **Все ресурсы** на **портале Azure**.  

    Эта панель мониторинга обеспечивает видимость **репозитория кода** VSTS, **конвейера VSTS CI/CD** и **кластера AKS**.  Вы можете настроить дополнительные параметры в VSTS.  В правой части панели мониторинга выберите **Обзор**, чтобы просмотреть запущенное приложение.

## <a name="examine-the-aks-cluster"></a>Изучение кластера AKS

Проект Azure DevOps автоматически настраивает кластер AKS.  Вы можете изучить и настроить кластер.  Выполните следующие шаги, чтобы ознакомиться со службой Azure Kubernetes (AKS).

1. Перейдите к **панели мониторинга Azure DevOps**.

1. В правой части панели мониторинга проекта DevOps выберите **Служба Kubernetes**.

1. Откроется колонка для кластера AKS.  Из этого представления вы можете выполнять различные действия, такие как **мониторинг работоспособности контейнера**, **поиск по журналам** и открытие **панель мониторинга Kubernetes**.

1. На правой стороне экрана выберите **Просмотреть панель мониторинга Kubernetes**.  При необходимости выполните следующие действия, чтобы открыть панель мониторинга Kubernetes.

## <a name="examine-the-vsts-ci-build-definition"></a>Изучение определения сборки VSTS CI

Проект Azure DevOps автоматически настраивает полный конвейер VSTS CI/CD в вашей учетной записи VSTS.  Вы можете изучить и настроить конвейер.  Выполните следующие шаги, чтобы ознакомиться с определением сборки VSTS.

1. Перейдите к **панели мониторинга Azure DevOps**.

1. Щелкните **Конвейеры сборки** в **верхней части** **панели мониторинга проекта Azure DevOps**.  Эта ссылка открывает вкладку браузера и определение сборки VSTS нового проекта.

1. Переместите указатель мыши справа от определения сборки рядом с полем **Состояние**. Выберите отобразившееся **многоточие**.  После этого откроется меню, в котором можно начать выполнение нескольких действий, таких как **постановка новой сборки в очередь**, **приостановка создания** и **изменение определения сборки**.

1. Выберите **Изменить**

1. В этом представлении **рассмотрите различные задачи** для определения сборки.  Сборка выполняет различные задачи, такие как выборка источников из репозитория VSTS Git, восстановление зависимостей и публикация результатов, используемых для развертывания.

1. В верхней части определения сборки выберите **имя определения сборки**.

1. Замените **имя** определения сборки более описательным именем.  Щелкните **Save & queue** (Сохранить и поместить в очередь), а затем выберите **Сохранить**.

1. Под именем определения сборки щелкните **Журнал**.  Вы увидите журнал аудита последних изменений сборки.  VSTS отслеживает любые изменения, внесенные в определение сборки, и позволяет сравнивать версии.

1. Выберите **Триггеры**.  Проект Azure DevOps автоматически создал триггер CI, а каждая фиксация в репозитории запускает новую сборку.  При желании выберите включение или исключение ветвей из процесса непрерывной интеграции.

1. Щелкните **Период удержания**.  На основе вашего сценария можно указать политики для хранения или удаления определенного количества сборок.

## <a name="examine-the-vsts-cd-release-management-definition"></a>Изучение определения Release Management VSTS CD

Проект Azure DevOps автоматически создает и настраивает необходимые шаги для развертывания из вашей учетной записи VSTS в вашу подписку Azure.  Эти шаги включают в себя настройку подключения Azure для проверки подлинности VSTS в вашей подписке Azure.  Автоматизация также создает определение выпуска VSTS, которое обеспечивает непрерывное развертывание Azure.  Выполните следующие шаги, чтобы узнать больше об определении выпуска VSTS.

1. Щелкните **Сборка и выпуск**, а затем выберите **Выпуски**.  Проект Azure DevOps создал определение выпуска VSTS для управления развертываниями в Azure.

1. В левой части браузера щелкните **многоточие** рядом с определением выпуска, а затем выберите **Изменить**.

1. Определение выпуска содержит **конвейер**, определяющий процесс выпуска.  В разделе **Артефакты** выберите **Удалить**.  Определение сборки, рассмотренное на предыдущих этапах, создает выходные данные, используемые для артефакта. 

1. Справа от значка **Удалить** выберите **значок** **Триггер непрерывного развертывания** (в виде молнии).  Это определение выпуска имеет активированный триггер непрерывного развертывания.  Триггер создает развертывание каждый раз, когда новый артефакт сборки становится доступным.  При желании вы можете отключить триггер, чтобы развертывание требовалось выполнять вручную. 

1. В правой части окна браузера выберите **Просмотреть выпуски**.  В этом представлении можно просмотреть журнал выпусков.

1. Щелкните **многоточие** рядом с одним из выпусков и выберите **Открыть**.  В этом представлении есть несколько меню, которые можно изучить, например меню **сводки**, **связанных рабочих элементов** и **тестов**.

1. Щелкните **Фиксации**.  В этом представлении отображаются фиксации кода, связанные с конкретным развертыванием. Сравните выпуски, чтобы просмотреть различия между развертываниями.

1. Выберите **Журналы**.  Журналы содержат полезную информацию о процессе развертывания.  Их можно просматривать как во время, так и после развертывания.

## <a name="commit-changes-to-vsts-and-automatically-deploy-to-azure"></a>Фиксация изменений в VSTS и автоматическое развертывание в Azure 

 > [!NOTE]
 > В приведенных ниже шагах тестируется конвейер CI/CD с изменением простого текста в вашем веб-приложении.

Теперь вы готовы сотрудничать с командой в своем приложении с процессом CI/CD, который автоматически развертывает данные последней работы на вашем веб-сайте.  Каждое изменение в репозитории Git VSTS запускает сборку в VSTS, а определение управления выпуском VSTS развертывает изменения в Azure.  Выполните следующие действия или используйте другие методы для фиксации изменений в вашем репозитории.  Например, вы можете **клонировать** репозитории Git в ваш любимый инструмент или интегрированную среду разработки, а затем отправить изменения в этот репозиторий.

1. Щелкните **Код**, а затем — **Файлы** в меню VSTS и перейдите в свой репозиторий.
1. Перейдите в каталог **Views\Home**, затем щелкните **многоточие** рядом с **Index.cshtml**, а затем щелкните **Изменить**.

1. Внесите изменения в файл, например, измените некоторый текст внутри одного из тегов **div**.  В правом верхнем углу щелкните **Зафиксировать**.  Щелкните **Зафиксировать** еще раз, чтобы внести изменения. 

1. Через несколько минут **начинается сборка в VSTS**, а затем выполняется выпуск для развертывания изменений.  Отслеживайте **состояние сборки** с помощью панели мониторинга проекта DevOps или в браузере, используя учетную запись VSTS.

1. По завершении выпуска **обновите приложение** в браузере, чтобы убедиться, что вы видите изменения.

## <a name="clean-up-resources"></a>Очистка ресурсов

 > [!NOTE]
 > При выполнении шагов ниже ресурсы удаляются навсегда.  Используйте эту функцию только после того, как досконально ознакомитесь с подсказками.

Если вы выполняете тестирование, можно очистить ресурсы, чтобы избежать начисления платежей.  Если вам больше не нужен кластер Kubernetes в Azure, вы можете удалить его и связанные с ним ресурсы, созданные в этом руководстве, с помощью функции **Удалить** на панели мониторинга Azure DevOps.  **Будьте внимательны**, так как функция удаления уничтожает данные, созданные проектом Azure DevOps как в Azure, так и в VSTS, и вы не сможете получить их после этого.

1. На **портале Azure** перейдите к **проекту Azure DevOps**.
2. В **верхней правой** стороне панели мониторинга нажмите кнопку **Удалить**.  Прочитав подсказку, щелкните **Да**, чтобы**навсегда удалить** ресурсы.

## <a name="next-steps"></a>Дополнительная информация

Вы можете по желанию изменить эти определения сборки и выпуска в соответствии с потребностями вашей команды. Вы также можете использовать этот шаблон CI/CD в качестве шаблона для других своих проектов.  Вы научились выполнять следующие задачи:

> [!div class="checklist"]
> * Создание проекта Azure DevOps для приложения ASP.NET Core и службы Azure Kubernetes.
> * Настройка VSTS и подписки Azure. 
> * Изучение кластера AKS.
> * Изучение определения сборки VSTS CI.
> * Изучение определения Release Management VSTS CD.
> * Фиксация изменений в VSTS и автоматическое развертывание в Azure.
> * Очистка ресурсов

Дополнительные сведения об использовании панели мониторинга Kubernetes см. ниже:

> [!div class="nextstepaction"]
> [Define your multi-stage continuous deployment (CD) process](https://docs.microsoft.com/vsts/pipelines/release/define-multistage-release-process?view=vsts) (Определение процесса многоэтапного непрерывного развертывания (CD))
