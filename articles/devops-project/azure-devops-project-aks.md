---
title: Развертывание приложения ASP.NET в службу Azure Kubernetes (AKS) с помощью проекта Azure DevOps | Руководство по Azure DevOps
description: Служба проектов Azure DevOps помогает быстро приступить к работе с Azure. Проект Azure DevOps упрощает развертывание приложения ASP.NET Core в службе Azure Kubernetes (AKS) за несколько простых шагов.
ms.author: mlearned
ms.manager: douge
ms.prod: devops
ms.technology: devops-cicd
ms.topic: tutorial
ms.date: 07/09/2018
author: mlearned
monikerRange: vsts
ms.openlocfilehash: 55ea101b3a03fdb7fc375c4594cab36d4cd79978
ms.sourcegitcommit: f3bd5c17a3a189f144008faf1acb9fabc5bc9ab7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2018
ms.locfileid: "44299123"
---
# <a name="tutorial--deploy-your-aspnet-core-app-to-azure-kubernetes-service-aks-with-the-azure-devops-project"></a>Руководство. Развертывание приложения ASP.NET в службу Azure Kubernetes (AKS) с помощью проекта Azure DevOps

Проект Azure DevOps представляет собой упрощенный интерфейс, к которому вы подключаете существующий код и репозиторий Git. Или можно выбрать один из примеров приложений, чтобы создать конвейер непрерывной интеграции (CI) и непрерывной поставки (CD) в Azure.  Проект DevOps автоматически создает такие ресурсы Azure, как AKS, а также создает и настраивает в Azure DevOps Services конвейер выпуска, который содержит определение сборки для CI/CD. Затем он затем создает ресурс Azure Application Insights для мониторинга.

Вы сможете выполнять следующие задачи:

> [!div class="checklist"]
> * Создание проекта Azure DevOps для приложения ASP.NET Core и службы Azure Kubernetes
> * Настройка Azure DevOps Services и подписки Azure 
> * Изучение кластера AKS
> * Изучение конвейера CI в Azure DevOps Services
> * Изучение конвейера CD в Azure DevOps Services
> * Фиксация изменений в Git и автоматическое развертывание в Azure
> * Очистка ресурсов

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Вы можете получить бесплатную подписку с помощью [Visual Studio Dev Essentials](https://visualstudio.microsoft.com/dev-essentials/).

## <a name="create-an-azure-devops-project-for-an-aspnet-core-app-and-aks"></a>Создание проекта Azure DevOps для приложения ASP.NET Core и службы Azure Kubernetes

Проект Azure DevOps создает в Azure конвейер CI/CD.  Вы можете создать **новую организацию Azure DevOps Services** или использовать **существующую организацию**.  Проект Azure DevOps также создает **ресурсы Azure**, такие как кластер AKS, в **подписке Azure** по вашему выбору.

1. Войдите на портал [Microsoft Azure](https://portal.azure.com).

1. Щелкните значок **Создать ресурс** на панели навигации слева, затем выполните поиск по запросу **Проект DevOps**.  Выберите **Создать**.

    ![Начало непрерывной поставки](_img/azure-devops-project-aks/fullbrowser.png)

1. Щелкните **.NET**, а затем нажмите кнопку **Далее**.

1. Для параметра **Выберите платформу приложений** выберите значение **ASP.NET Core**, а затем нажмите кнопку **Далее**.

1. Выберите **Служба Kubernetes**, затем щелкните **Далее**.  

## <a name="configure-azure-devops-services-and-an-azure-subscription"></a>Настройка Azure DevOps Services и подписки Azure

1. Создайте **новую** организацию Azure DevOps Services или примените **существующую** организацию.  Выберите **имя** для проекта.  

1. Выберите свою **подписку Azure**.

1. Щелкните ссылку **Изменение**, чтобы просмотреть дополнительные параметры Azure и определить **количество узлов** для **кластера Kubernetes**.  В этом руководстве существуют различные варианты для настройки типа и расположения служб Azure.
 
1. Выйдите из области конфигурации Azure и щелкните **Готово**.

1. Этот процесс может занять несколько минут.  Он подготовит пример приложения ASP.NET Core в репозитории Azure Repos Git, настроенном для организации Azure DevOps Services, создаст кластер AKS, выполнит конвейер CI/CD и развернет приложение в Azure.  

    После завершения процесса на портале Azure откроется **Панель мониторинга** для проекта Azure DevOps.  Вы также можете перейти к **панели мониторинга проекта Azure DevOps** непосредственно на вкладке **Все ресурсы** на **портале Azure**.  

    Эта панель мониторинга содержит сведения о **репозитории кода** Azure Repos, **конвейере CI/CD Azure DevOps** и **кластере AKS**.  Также вы можете настроить дополнительные параметры CI/CD для конвейера Azure DevOps Services.  В правой части панели мониторинга выберите **Обзор**, чтобы просмотреть запущенное приложение.

## <a name="examine-the-aks-cluster"></a>Изучение кластера AKS

Проект Azure DevOps автоматически настраивает кластер AKS.  Вы можете изучить и настроить кластер.  Выполните следующие шаги, чтобы ознакомиться со службой Azure Kubernetes (AKS).

1. Перейдите к **панели мониторинга Azure DevOps**.

1. В правой части панели мониторинга для проекта DevOps выберите **Служба Kubernetes**.

1. Откроется колонка для кластера AKS.  Из этого представления вы можете выполнять различные действия, такие как **мониторинг работоспособности контейнера**, **поиск по журналам** и открытие **панель мониторинга Kubernetes**.

1. На правой стороне экрана выберите **Просмотреть панель мониторинга Kubernetes**.  При необходимости выполните следующие действия, чтобы открыть панель мониторинга Kubernetes.

## <a name="examine-the-azure-devops-services-ci-pipeline"></a>Изучение конвейера CI в Azure DevOps Services

Проект Azure DevOps автоматически настраивает конвейер VSTS CI/CD в организации Azure DevOps.  Вы можете изучить и настроить конвейер.  Выполните следующие шаги, чтобы лучше понять конвейеры CI/CD в Azure DevOps Services.

1. Перейдите к **панели мониторинга Azure DevOps**.

1. Щелкните **Конвейеры сборки** в **верхней части** **панели мониторинга проекта Azure DevOps**.  Эта ссылка открывает в новой вкладке браузера конвейер сборки Azure DevOps Services для нового проекта.

1. Поместите указатель мыши справа от конвейера сборки рядом с полем **Состояние**. Выберите отобразившееся **многоточие**.  Это действие открывает меню, в котором можно выполнить несколько действий, таких как **постановка новой сборки в очередь**, **приостановка создания** и **изменение конвейера сборки**.

1. Выберите **Изменить**

1. В этом представлении **изучите различные задачи**.  Сборка выполняет несколько задач, например получает источники из репозитория Azure DevOps Services Repos Git, восстанавливает зависимости и публикует используемые для развертывания результаты.

1. Выберите **имя конвейера сборки** в верхней части конвейера сборки.

1. Замените это **имя** более понятным и описательным.  Щелкните **Save & queue** (Сохранить и поместить в очередь), а затем выберите **Сохранить**.

1. Под именем конвейера сборки щелкните **Журнал**.  Вы увидите журнал аудита последних изменений сборки.  Azure DevOps Services отслеживает любые изменения, внесенные в конвейер сборки, и позволяет сравнивать версии.

1. Выберите **Триггеры**.  Проект Azure DevOps автоматически создал триггер CI, и теперь каждая фиксация в репозитории запускает новую сборку.  При желании выберите включение или исключение ветвей из процесса непрерывной интеграции.

1. Щелкните **Период удержания**.  На основе вашего сценария можно указать политики для хранения или удаления определенного количества сборок.

## <a name="examine-the-azure-devops-services-cd-release-pipeline"></a>Изучение конвейера выпуска CD в Azure DevOps Services

Проект Azure DevOps автоматически создает и настраивает необходимые шаги для развертывания из организации Azure DevOps Services в подписку Azure.  Эти шаги включают настройку подключения к службе Azure для аутентификации Azure DevOps Services в подписке Azure.  Также служба автоматизации создает конвейер выпуска Azure DevOps Services, который выполняет непрерывное развертывание в Azure.  Выполните следующие шаги, чтобы изучить возможности конвейера выпуска Azure DevOps Services.

1. Щелкните **Сборка и выпуск**, а затем выберите **Выпуски**.  Проект Azure DevOps создал конвейер выпуска Azure DevOps Services для управления развертываниями в Azure.

1. В левой части окна браузера щелкните **многоточие** рядом с конвейером выпуска и выберите **Изменить**.

1. Конвейер выпуска содержит **конвейер**, в котором определен процесс выпуска.  В разделе **Артефакты** выберите **Удалить**.  Конвейер сборки, который вы изучали на предыдущих этапах, создает выходные данные для артефакта. 

1. Справа от значка **Удалить** выберите **значок** **Триггер непрерывного развертывания** (в виде молнии).  Для этого конвейера выпуска активирован триггер непрерывного развертывания.  Триггер создает развертывание каждый раз, когда новый артефакт сборки становится доступным.  При желании вы можете отключить триггер, чтобы развертывание требовалось выполнять вручную. 

1. В правой части окна браузера выберите **Просмотреть выпуски**.  В этом представлении можно просмотреть журнал выпусков.

1. Щелкните **многоточие** рядом с одним из выпусков и выберите **Открыть**.  В этом представлении есть несколько меню, которые можно изучить, например меню **сводки**, **связанных рабочих элементов** и **тестов**.

1. Щелкните **Фиксации**.  В этом представлении отображаются фиксации кода, связанные с конкретным развертыванием. Сравните выпуски, чтобы просмотреть различия между развертываниями.

1. Выберите **Журналы**.  Журналы содержат полезную информацию о процессе развертывания.  Их можно просматривать как во время, так и после развертывания.

## <a name="commit-changes-to-azure-devops-services-and-automatically-deploy-to-azure"></a>Фиксация изменений в Azure DevOps Services и автоматическое развертывание в Azure 

 > [!NOTE]
 > В приведенных ниже шагах тестируется конвейер CI/CD с изменением простого текста в вашем веб-приложении.

Теперь вы готовы сотрудничать с командой в своем приложении с процессом CI/CD, который автоматически развертывает данные последней работы на вашем веб-сайте.  Каждое изменение в репозитории Git для Azure DevOps Services запускает сборку в Azure DevOps Services, а затем конвейер CD развертывает эти изменения в Azure.  Выполните следующие действия или используйте другие методы для фиксации изменений в вашем репозитории.  Например, вы можете **клонировать** репозитории Git в ваш любимый инструмент или интегрированную среду разработки, а затем отправить изменения в этот репозиторий.

1. В меню Azure DevOps Services щелкните **Код**, а затем — **Файлы**, чтобы открыть репозиторий.
1. Перейдите в каталог **Views\Home**, затем щелкните **многоточие** рядом с **Index.cshtml**, а затем щелкните **Изменить**.

1. Внесите изменения в файл, например, измените некоторый текст внутри одного из тегов **div**.  В правом верхнем углу щелкните **Зафиксировать**.  Щелкните **Зафиксировать** еще раз, чтобы внести изменения. 

1. Через несколько минут **начинается сборка в Azure DevOps Services**, а затем выполняется выпуск для развертывания изменений.  **Состояние сборки** вы можете отслеживать на панели мониторинга для проекта DevOps или на странице браузера, которая отображает организацию Azure DevOps Services.

1. По завершении выпуска **обновите приложение** в браузере, чтобы убедиться, что вы видите изменения.

## <a name="clean-up-resources"></a>Очистка ресурсов

 > [!NOTE]
 > При выполнении шагов ниже ресурсы удаляются навсегда.  Используйте эту функцию только после того, как досконально ознакомитесь с подсказками.

Если вы выполняете тестирование, можно очистить ресурсы, чтобы избежать начисления платежей.  Если вам больше не нужен кластер Kubernetes в Azure, вы можете удалить его и связанные с ним ресурсы, созданные в этом руководстве, с помощью функции **Удалить** на панели мониторинга Azure DevOps.  **Будьте внимательны**, так как функция удаления уничтожает все данные, созданные проектом Azure DevOps в Azure и в Azure DevOps Services, и вы больше не сможете получить эти данные.

1. На **портале Azure** перейдите к **проекту Azure DevOps**.
2. В **верхней правой** стороне панели мониторинга нажмите кнопку **Удалить**.  Прочитав подсказку, щелкните **Да**, чтобы**навсегда удалить** ресурсы.

## <a name="next-steps"></a>Дополнительная информация

Вы можете по желанию изменить эти конвейеры сборки и выпуска в соответствии с потребностями вашей команды. Вы также можете использовать этот шаблон CI/CD в качестве шаблона для других конвейеров.  Вы научились выполнять следующие задачи:

> [!div class="checklist"]
> * Создание проекта Azure DevOps для приложения ASP.NET Core и службы Azure Kubernetes
> * Настройка Azure DevOps Services и подписки Azure 
> * Изучение кластера AKS
> * Изучение конвейера CI в Azure DevOps Services
> * Изучение конвейера CD в Azure DevOps Services
> * Фиксация изменений в Git и автоматическое развертывание в Azure
> * Очистка ресурсов

Дополнительные сведения об использовании панели мониторинга Kubernetes см. ниже:

> [!div class="nextstepaction"]
> [Define your multi-stage continuous deployment (CD) process](https://docs.microsoft.com/azure/devops/pipelines/release/define-multistage-release-process?view=vsts) (Определение процесса многоэтапного непрерывного развертывания (CD))
