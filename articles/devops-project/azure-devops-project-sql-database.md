---
title: Развертывание приложения ASP.NET и базы данных SQL Azure с помощью проекта Azure DevOps | Руководство по VSTS
description: Проект DevOps упрощает начало работы с Azure. Проект Azure DevOps упрощает развертывание вашего приложения ASP.NET с Базой данных SQL за несколько простых шагов.
ms.author: mlearned
ms.manager: douge
ms.prod: devops
ms.technology: devops-cicd
ms.topic: tutorial
ms.date: 07/09/2018
author: mlearned
monikerRange: vsts
ms.openlocfilehash: ba15a57f92ad58a46732444890d9e670fcc75cf3
ms.sourcegitcommit: a1e1b5c15cfd7a38192d63ab8ee3c2c55a42f59c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/10/2018
ms.locfileid: "37967418"
---
# <a name="tutorial--deploy-your-aspnet-app-and-azure-sql-database-with-the-azure-devops-project"></a>Руководство. Развертывание приложения ASP.NET и Базы данных SQL Azure с помощью проекта Azure DevOps

Проект Azure DevOps представляет собой упрощенный интерфейс, к которому вы подключаете существующий код и репозиторий Git. Или можно выбрать один из примеров приложений, чтобы создать конвейер непрерывной интеграции (CI) и непрерывной поставки (CD) в Azure.  Проект DevOps автоматически создает такие ресурсы Azure, как База данных SQL Azure, а также создает и настраивает конвейер выпуска в VSTS, содержащий определение сборки для CI, который позволяет задать определение выпуска для компакт-диска, а затем создает ресурс Azure Application Insights для мониторинга.

Вы сможете выполнять следующие задачи:

> [!div class="checklist"]
> * Создание проекта Azure DevOps для приложения ASP.NET и Базы данных SQL Azure.
> * Настройка VSTS и подписки Azure. 
> * Изучение определения сборки VSTS CI.
> * Изучение определения Release Management VSTS CD.
> * Фиксация изменений в VSTS и автоматическое развертывание в Azure.
> * Подключение к базе данных SQL Azure. 
> * Очистка ресурсов

## <a name="prerequisites"></a>предварительным требованиям

* Подписка Azure. Вы можете получить бесплатную подписку с помощью [Visual Studio Dev Essentials](https://visualstudio.microsoft.com/dev-essentials/).

## <a name="create-an-azure-devops-project-for-an-aspnet-app-and-azure-sql-database"></a>Создание проекта Azure DevOps для приложения ASP.NET и Базы данных SQL Azure

Проект Azure DevOps создает конвейер CI/CD в VSTS.  Вы можете создать учетную запись **VSTS** или использовать **имеющуюся**.  Проект Azure DevOps также создает **ресурсы Azure**, такие как база данных SQL, в **подписке Azure** по вашему выбору.

1. Войдите на портал [Microsoft Azure](https://portal.azure.com).

1. Щелкните значок **Создать ресурс** на левой панели навигации, затем найдите **проект DevOps**.  Выберите **Создать**.

    ![Начало непрерывной поставки](_img/azure-devops-project-github/fullbrowser.png)

1. Щелкните **.NET**, а затем нажмите кнопку **Далее**.

1. Для параметра **Выберите платформу приложений** выберите **ASP.NET**.

1. Щелкните **Добавить базу данных**, а затем нажмите **Далее**.  

1. Исполняющая среда, которую вы выбрали на предыдущих шагах, определяет тип цели развертывания службы Azure, доступной здесь.  Щелкните **Далее**.

## <a name="configure-vsts-and-an-azure-subscription"></a>Настройка VSTS и подписки Azure

1. **Создайте** учетную запись VSTS или выберите **имеющуюся**.  Выберите **имя** для проекта VSTS.  

1. Выберите свою **подписку Azure**.

1. При необходимости перейдите по ссылке **Изменить**, чтобы увидеть дополнительные настройки конфигурации Azure и укажите **имя пользователя** в разделе **Учетные данные для сервера базы данных**.  **Сохраните** **имя пользователя** для следующих шагов этого руководства.
 
1. Если вы выполнили предыдущий шаг, выйдите из области конфигурации Azure и нажмите **Готово**.  В противном случае просто выберите **Готово**.

1. Этот процесс может занять несколько минут.  После этого на портале Azure загружается **панель мониторинга** проекта Azure DevOps.  Вы также можете перейти к **панели мониторинга проекта Azure DevOps** непосредственно на вкладке **Все ресурсы** на **портале Azure**.  В правой части панели мониторинга выберите **Обзор**, чтобы просмотреть запущенное приложение.
    
## <a name="examine-the-vsts-ci-build-definition"></a>Изучение определения сборки VSTS CI

Проект Azure DevOps автоматически настраивает полный конвейер VSTS CI/CD в вашей учетной записи VSTS.  Вы можете изучить и настроить конвейер.  Выполните следующие шаги, чтобы ознакомиться с определением сборки VSTS.

1. Перейдите к **панели мониторинга Azure DevOps**.

1. Щелкните **Конвейеры сборки** в **верхней части** **панели мониторинга проекта Azure DevOps**.  Эта ссылка открывает вкладку браузера и определение сборки VSTS нового проекта.

1. Переместите указатель мыши справа от определения сборки рядом с полем **Состояние**. Выберите отобразившееся **многоточие**.  После этого откроется меню, в котором можно начать выполнение нескольких действий, таких как **постановка новой сборки в очередь**, **приостановка создания** и **изменение определения сборки**.

1. Выберите **Изменить**

1. В этом представлении **рассмотрите различные задачи** для определения сборки.  Сборка выполняет различные задачи, такие как выборка источников из репозитория VSTS Git, восстановление зависимостей и публикация результатов, используемых для развертывания.

1. В верхней части определения сборки выберите **имя определения сборки**.

1. Замените **имя** определения сборки более описательным именем.  Щелкните **Save & queue** (Сохранить и поместить в очередь), а затем выберите **Сохранить**.

1. Под именем определения сборки щелкните **Журнал**.  Вы увидите журнал аудита последних изменений сборки.  VSTS отслеживает любые изменения, внесенные в определение сборки, и позволяет сравнивать версии.

1. Выберите **Триггеры**.  Проект Azure DevOps автоматически создал триггер CI, а каждая фиксация в репозитории запускает новую сборку.  При желании выберите включение или исключение ветвей из процесса непрерывной интеграции.

1. Щелкните **Период удержания**.  На основе вашего сценария можно указать политики для хранения или удаления определенного количества сборок.

## <a name="examine-the-vsts-cd-release-management-definition"></a>Изучение определения Release Management VSTS CD

Проект Azure DevOps автоматически создает и настраивает необходимые шаги для развертывания из вашей учетной записи VSTS в вашу подписку Azure.  Эти шаги включают в себя настройку подключения Azure для проверки подлинности VSTS в вашей подписке Azure.  Автоматизация также создает определение выпуска VSTS, что обеспечивает непрерывное развертывание Azure.  Выполните следующие шаги, чтобы узнать больше об определении выпуска VSTS.

1. Щелкните **Сборка и выпуск**, а затем выберите **Выпуски**.  Проект Azure DevOps создал определение выпуска VSTS для управления развертываниями в Azure.

1. В левой части браузера щелкните **многоточие** рядом с определением выпуска, а затем выберите **Изменить**.

1. Определение выпуска содержит **конвейер**, определяющий процесс выпуска.  В разделе **Артефакты** выберите **Удалить**.  Определение сборки, рассмотренное на предыдущих этапах, создает выходные данные, используемые для артефакта. 

1. Справа от значка **Удалить** выберите **значок** **Триггер непрерывного развертывания** (в виде молнии).  Это определение выпуска имеет активированный триггер непрерывного развертывания.  Триггер запускает развертывание каждый раз, когда имеется новый артефакт сборки.  При желании вы можете отключить триггер, чтобы развертывание требовалось выполнять вручную. 

1. Проект Azure DevOps настраивает случайный пароль SQL и использует этот пароль для определения выпуска.  В левой части окна браузера выберите **Переменные**. 

1. **Выполняйте этот шаг, только если вы изменили пароль SQL Server.**  Существует однонаправленная переменная **Пароль**.  Справа от текстового поля **Значение** щелкните значок **Замок**.  **Введите** новый пароль, а затем щелкните **Сохранить**.

1. В левой части браузера выберите **Задачи**, а затем выберите **среду**.  

1. Задачи являются действиями, выполняемыми в процессе развертывания. Они сгруппированы по **этапам**.  Для этого определения выпуска есть один этап.  Этот этап содержит задачу **Развертывание службы приложений Azure** и задачу **Развертывание Базы данных SQL Azure**.

1. Выберите задачу **Выполнить SQL Azure** и изучите различные свойства, используемые для развертывания SQL.  В разделе **Пакет развертывания** обратите внимание, что задача использует **DACPAC-файл SQL**.

1. В правой части окна браузера выберите **Просмотреть выпуски**.  В этом представлении можно просмотреть журнал выпусков.

1. Щелкните **многоточие** рядом с одним из выпусков и выберите **Открыть**.  В этом представлении есть несколько меню, которые можно изучить, например меню **сводки**, **связанных рабочих элементов** и **тестов**.

1. Щелкните **Фиксации**.  В этом представлении отображаются фиксации кода, связанные с конкретным развертыванием. Сравните выпуски, чтобы просмотреть различия между развертываниями.

1. Выберите **Журналы**.  Журналы содержат полезную информацию о процессе развертывания.  Их можно просматривать как во время, так и после развертывания.

## <a name="commit-changes-to-vsts-and-automatically-deploy-to-azure"></a>Фиксация изменений в VSTS и автоматическое развертывание в Azure 

 > [!NOTE]
 > В приведенных ниже шагах тестируется конвейер CI/CD с изменением простого текста.  При необходимости вы можете внести изменение схемы SQL Server в таблицу, чтобы протестировать процесс развертывания SQL.

Теперь вы готовы сотрудничать с командой в своем приложении с процессом CI/CD, который автоматически развертывает данные последней работы на вашем веб-сайте.  Каждое изменение в репозитории Git VSTS запускает сборку в VSTS, а определение Release Management для VSTS выполняет развертывание в Azure.  Выполните следующие действия или используйте другие методы для фиксации изменений в вашем репозитории.  Изменения кода запускают процесс CI/CD и автоматически развертывают ваши новые изменения в Azure.

1. Щелкните **Код** в меню VSTS и перейдите в свой репозиторий.

1. Перейдите в каталог **SampleWebApplication\Views\Home**, затем щелкните **многоточие** рядом с файлом **Index.cshtml**, а затем выберите **Изменить**.

1. Внесите изменения в файл, например, измените некоторый текст внутри одного из тегов **div**.  В правом верхнем углу щелкните **Зафиксировать**.  Щелкните **Зафиксировать** еще раз, чтобы внести изменения. 

1. Через несколько минут **начинается сборка в VSTS**, а затем выполняется выпуск для развертывания изменений.  Отслеживайте **состояние сборки** с помощью панели мониторинга проекта DevOps или в браузере, используя учетную запись VSTS.

1. По завершении выпуска **обновите приложение** в браузере, чтобы убедиться, что вы видите изменения.

## <a name="connect-to-the-azure-sql-server-database"></a>Подключение к базе данных SQL Azure

Вам нужны соответствующие разрешения для подключения к базе данных SQL Azure.

1. На панели мониторинга проекта DevOps Azure, выберите **База данных SQL** для перехода на страницу управления базой данных SQL.
   
1. Выберите **Настройка брандмауэра для сервера**, а затем нажмите кнопку **+ Добавить IP-адрес клиента**.  

1. Щелкните **Сохранить**.  IP-адрес клиента теперь разрешает доступ к **ресурсам SQL Server Azure**.

1. Вернитесь к колонке **База данных SQL**. 

1. В правой части экрана щелкните **Имя сервера** для перехода на страницу настройки **SQL Server**.

1. Выберите **Сброс пароля**, введите пароль для **имени для входа администратора SQL Server**, а затем щелкните **Сохранить**.  **Сохраните** пароль для следующих шагов этого руководства.

1. Теперь, при необходимости, можно использовать клиентские средства, например **SQL Server Management Studio** или **Visual Studio** для подключения к Azure SQL Server и Базе данных.  Используйте свойство **Имя сервера** для подключения.

   Если вы не изменяли имя пользователя базы данных при первоначальной настройке проекта DevOps, ваше имя пользователя — это локальная часть вашего адреса электронной почты.  Например, если ваш электронный адрес johndoe@microsoft.com, ваше имя пользователя — johndoe.

 > [!NOTE]
 > Если вы изменили пароль для имени входа в SQL, необходимо изменить пароль в переменной определения выпуска VSTS, как описано в разделе **Изучение определения Release Management VSTS CD**

## <a name="clean-up-resources"></a>Очистка ресурсов

 > [!NOTE]
 > При выполнении шагов ниже ресурсы удаляются навсегда.  Используйте эту функцию только после того, как досконально ознакомитесь с подсказками.

Если вы выполняете тестирование, вы можете очистить ресурсы, чтобы избежать непредвиденных расходов.  Вы можете удалить ненужную базу данных SQL Azure и связанные с ней ресурсы, созданные в этом руководстве, с помощью функции **Удалить** на панели мониторинга Azure DevOps.  **Будьте внимательны**, так как функция удаления уничтожает данные, созданные проектом Azure DevOps как в Azure, так и в VSTS, и вы не сможете получить их после этого.

1. На **портале Azure** перейдите к **проекту Azure DevOps**.
2. В **верхней правой** стороне панели мониторинга нажмите кнопку **Удалить**.  Прочитав подсказку, щелкните **Да**, чтобы**навсегда удалить** ресурсы.

## <a name="next-steps"></a>Дополнительная информация

Вы можете по желанию изменить эти определения сборки и выпуска в соответствии с потребностями вашей команды. Вы также можете использовать этот шаблон CI/CD в качестве шаблона для других своих проектов.  Вы научились выполнять следующие задачи:

> [!div class="checklist"]
> * Создание проекта Azure DevOps для приложения ASP.NET и Базы данных SQL Azure.
> * Настройка VSTS и подписки Azure. 
> * Изучение определения сборки VSTS CI.
> * Изучение определения Release Management VSTS CD.
> * Фиксация изменений в VSTS и автоматическое развертывание в Azure.
> * Подключение к базе данных SQL Azure. 
> * Очистка ресурсов

Чтобы получить дополнительные сведения о конвейере VSTS, см. это руководство:

> [!div class="nextstepaction"]
> [Define your multi-stage continuous deployment (CD) process](https://docs.microsoft.com/vsts/pipelines/release/define-multistage-release-process?view=vsts) (Определение многоэтапного процесса непрерывного развертывания)

## <a name="videos"></a>Видеоролики

> [!VIDEO https://channel9.msdn.com/Events/Build/2018/BRK3308/player]